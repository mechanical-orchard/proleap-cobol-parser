000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    TRKCS122.                                         00020000
000300 AUTHOR.        TOM RUSKA. G&R. & SHENG TSANG.                    00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  11-11-93.                                         00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800*---------------------------------------------------------------* 00080000
000900*    Y122 - TRAILER HISTORY LIST                                * 00090000
001000*                                                               * 00100000
001100*    THIS PROGRAM GENERATES A LIST OF ALL TRAILERS INFORMATION  * 00110000
001200*    FROM THE AUDIT TABLES.                                     * 00120000
001300*                                                               * 00130000
001400*---------------------------------------------------------------* 00140000
001410* CHANGED 11/08/2021    BY JIM HUNTER      WR: CHG0263697         00141013
001420* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00142014
001430* MAKING THE CALL DYNAMIC VS STATIC.                              00143014
001440*---------------------------------------------------------------* 00144014
CICS  * CHANGED 11/21/2022    BY JIM HUNTER      WR: CHG0278495         00145024
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00146024
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00147024
CICS  *-----------------------------------------------------------------00148024
001500                                                                  00150000
001600/                                                                 00160000
001700 ENVIRONMENT DIVISION.                                            00170000
001800                                                                  00180000
001900 DATA DIVISION.                                                   00190000
002000                                                                  00200000
002100 WORKING-STORAGE SECTION.                                         00210000
002200                                                                  00220000
002300 01  DK-DB2-KEYS.                                                 00230000
002400     05  DK-OPER-UNT-ID            PIC S9(4) COMP VALUE +0.       00240000
002500     05  DK-OPER-UNT-ID-B          PIC S9(4) COMP VALUE +0.       00250000
002600     05  DK-OPER-UNT-ID-E          PIC S9(4) COMP VALUE +0.       00260000
002700     05  DK-FCLTY-ID-B             PIC S9(4) COMP VALUE +0.       00270000
002800     05  DK-FCLTY-ID-E             PIC S9(4) COMP VALUE +0.       00280000
002900     05  DK-FCLTY-AREA-ID-B        PIC X(06) VALUE SPACES.        00290000
003000     05  DK-FCLTY-AREA-ID-E        PIC X(06) VALUE SPACES.        00300000
003100     05  DK-SUBAREA-OF-ID-B        PIC X(06) VALUE SPACES.        00310000
003200     05  DK-SUBAREA-OF-ID-E        PIC X(06) VALUE SPACES.        00320000
003300     05  DK-DEST-OPER-UNT-ID-B     PIC S9(4) COMP VALUE +0.       00330000
003400     05  DK-DEST-OPER-UNT-ID-E     PIC S9(4) COMP VALUE +0.       00340000
003500     05  DK-DEST-FCLTY-ID-B        PIC S9(4) COMP VALUE +0.       00350000
003600     05  DK-DEST-FCLTY-ID-E        PIC S9(4) COMP VALUE +0.       00360000
003700     05  DK-STATUS-IND-B           PIC X(02) VALUE SPACES.        00370000
003800     05  DK-STATUS-IND-E           PIC X(02) VALUE SPACES.        00380000
003900     05  DK-STATUS-IND-1           PIC X(02) VALUE SPACES.        00390000
004000     05  DK-STATUS-IND-2           PIC X(02) VALUE SPACES.        00400000
004100     05  DK-STATUS-IND-3           PIC X(02) VALUE SPACES.        00410000
004200     05  DK-STATUS-IND-4           PIC X(02) VALUE SPACES.        00420000
004300     05  DK-STATUS-IND-5           PIC X(02) VALUE SPACES.        00430000
004400     05  DK-SCHD-FROM-DTE          PIC X(10) VALUE SPACES.        00440000
004500     05  DK-SCHD-TO-DTE            PIC X(10) VALUE SPACES.        00450000
004600     05  DK-SCHD-FROM-TME          PIC X(08) VALUE SPACES.        00460000
004700     05  DK-SCHD-TO-TME            PIC X(08) VALUE SPACES.        00470000
004800     05  DK-USAGE-IND-B            PIC X(03) VALUE SPACES.        00480000
004900     05  DK-USAGE-IND-E            PIC X(03) VALUE SPACES.        00490000
005000     05  DK-USAGE-IND-1            PIC X(03) VALUE SPACES.        00500000
005100     05  DK-USAGE-IND-2            PIC X(03) VALUE SPACES.        00510000
005200     05  DK-USAGE-IND-3            PIC X(03) VALUE SPACES.        00520000
005300     05  DK-OWNER-SCAC-ID-B        PIC X(04) VALUE SPACES.        00530000
005400     05  DK-OWNER-SCAC-ID-E        PIC X(04) VALUE SPACES.        00540000
005500     05  DK-VEH-NBR-B              PIC X(10) VALUE SPACES.        00550000
005600     05  DK-VEH-NBR-E              PIC X(10) VALUE SPACES.        00560000
005700     05  DK-TRIP-ID                PIC S9(9) COMP VALUE +0.       00570000
005800                                                                  00580000
005900 01  DN-NULL-INDICATORS.                                          00590000
006000     05  DN-EST-AR-TMST            PIC S9(4) COMP VALUE +0.       00600000
006100     05  DN-CSR-TRIP-ST-CDE        PIC S9(4) COMP VALUE +0.       00610016
006110     05  DN-CSR-TRIP-ST-UID       PIC S9(4) COMP VALUE +0.        00611016
006200                                                                  00620000
006300 01  PC-PROGRAM-CONSTANTS.                                        00630000
006400     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00640000
006500                                                    'TR122A  '.   00650000
006600     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00660000
006700                                                    'TRKM122 '.   00670000
006800     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00680000
006900                                                    'TRKCS122'.   00690000
007000     05  PC-APPL-MAP                    PIC S9(04)  VALUE  +1     00700000
007100                                                    COMP.         00710000
007200     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00720000
007300     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00730000
007400     05  PC-INTER-APPL-CODES.                                     00740000
007500         10 PC-INTER-APPL-CRIT-SPEC     PIC  X(01)  VALUE '1'.    00750000
007600         10 PC-INTER-APPL-LIST          PIC  X(01)  VALUE '5'.    00760000
007700     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +15     00770000
007800                                                    COMP SYNC.    00780000
007900     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00790000
008000                                                    COMP SYNC.    00800000
008100     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00810000
008200                                                    +1000000      00820000
008300                                                    COMP-3.       00830000
008400     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00840000
008500                                                    COMP SYNC.    00850000
008600     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      00860000
008700                                                    COMP-3.       00870000
008800     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00880000
008900     05  PC-ADD                         PIC  X(03)  VALUE 'ADD'.  00890000
009000     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00900000
009100     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00910000
009200     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00920000
009300     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00930000
009400                                                                  00940000
009500     05  PC-TSYMSG-NUMBERS.                                       00950000
009600         10  PC-TSYMSG-00007            PIC  9(05)  VALUE 00007.  00960000
009700         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00970000
009800         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00980000
009900         10  PC-TSYMSG-00014            PIC  9(05)  VALUE 00014.  00990000
010000         10  PC-TSYMSG-00017            PIC  9(05)  VALUE 00017.  01000000
010100         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  01010000
010200         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  01020000
010300         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  01030000
010400         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  01040000
010500         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  01050000
010600         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  01060000
010700         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  01070000
010800         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01080000
010900         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01090000
011000         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01100000
011100         10  PC-TSYMSG-00083            PIC  9(05)  VALUE 00083.  01110000
011200         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01120000
011300         10  PC-TSYMSG-00168            PIC  9(05)  VALUE 00168.  01130000
011400         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01140000
011500         10  PC-TSYMSG-00310            PIC  9(05)  VALUE 00310.  01150000
011600         10  PC-TSYMSG-00330            PIC  9(05)  VALUE 00330.  01160000
011700         10  PC-TSYMSG-00338            PIC  9(05)  VALUE 00338.  01170000
011800         10  PC-TSYMSG-00486            PIC  9(05)  VALUE 00486.  01180000
011900         10  PC-TSYMSG-00587            PIC  9(05)  VALUE 00587.  01190000
012000         10  PC-TSYMSG-00588            PIC  9(05)  VALUE 00588.  01200000
012100         10  PC-TSYMSG-00643            PIC  9(05)  VALUE 00643.  01210000
012200         10  PC-TSYMSG-00649            PIC  9(05)  VALUE 00649.  01220000
012300                                                                  01230000
012400 01  PS-PROGRAM-SWITCHES.                                         01240000
012500     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01250000
012600         88  PS-NO-ERROR                            VALUE 'Y'.    01260000
012700         88  PS-ERROR                               VALUE 'N'.    01270000
012800     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01280000
012900         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01290000
013000         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01300000
013100     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01310000
013200         88  PS-DONE                                VALUE 'Y'.    01320000
013300         88  PS-NOT-DONE                            VALUE 'N'.    01330000
013400                                                                  01340000
013500 01  PV-PROGRAM-VARIABLES.                                        01350000
013600     05  PV-SUB                         PIC S9(04)  VALUE +0      01360000
013700                                                    COMP SYNC.    01370000
013800     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01380000
013900                                                    COMP SYNC.    01390000
014000     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01400000
014100                                                    COMP-3.       01410000
014200     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01420000
014300                                                    COMP-3.       01430000
014400     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01440000
014500                                                    COMP-3.       01450000
014600     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01460000
014700                                                    COMP-3.       01470000
014800     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01480000
014900                                                    COMP-3.       01490000
015000     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01500000
015100                                                    COMP-3.       01510000
015200     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01520000
015300                                                    COMP-3.       01530000
015400     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01540000
015500                                                    COMP SYNC.    01550000
015600     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01560000
015700                                                    COMP SYNC.    01570000
015800     05  PV-ITEM                        PIC S9(04)  VALUE +0      01580000
015900                                                    COMP SYNC.    01590000
016000     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01600000
016100                                                    COMP SYNC.    01610000
016200     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01620000
016300                                                    COMP SYNC.    01630000
016400     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01640000
016500                                                    COMP SYNC.    01650000
016600     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01660000
016700                                                    COMP SYNC.    01670000
016800     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01680000
016900                                                    COMP SYNC.    01690000
017000     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01700000
017100                                                    COMP SYNC.    01710000
017200     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01720000
017300                                                    COMP SYNC.    01730000
017400     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01740000
017500                                                    COMP SYNC.    01750000
017600     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01760000
017700                                                    COMP SYNC.    01770000
017800     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01780000
017900                                                    COMP SYNC.    01790000
018000     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01800000
018100                                                    COMP SYNC.    01810000
018200     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01820000
018300                                                    COMP SYNC.    01830000
018400     05  PV-DB2-COUNT                   PIC S9(09)  VALUE +0      01840000
018500                                                    COMP-3.       01850000
018600     05  PV-EDIT-DATE.                                            01860000
018700         10  PV-EDIT-DATE-CC            PIC X(02).                01870000
018800         10  PV-EDIT-DATE-YY            PIC X(02).                01880000
018900         10  FILLER                     PIC X(01).                01890000
019000         10  PV-EDIT-DATE-MM            PIC X(02).                01900000
019100         10  FILLER                     PIC X(01).                01910000
019200         10  PV-EDIT-DATE-DD            PIC X(02).                01920000
019300     05  PV-EDIT-TIME.                                            01930000
019400         10  PV-EDIT-TIME-HH            PIC X(02).                01940000
019500         10  FILLER                     PIC X(01).                01950000
019600         10  PV-EDIT-TIME-MM            PIC X(02).                01960000
019700         10  FILLER                     PIC X(01).                01970000
019800         10  PV-EDIT-TIME-SS            PIC X(02).                01980000
019900     05  PV-STA-TMST.                                             01990000
020000         10  PV-STA-DATE.                                         02000000
020100             15  PV-STA-CC                  PIC X(02).            02010007
020110             15  PV-STA-YY                  PIC X(02).            02011007
020200             15  FILLER                     PIC X(01).            02020000
020300             15  PV-STA-MM                  PIC X(02).            02030000
020400             15  FILLER                     PIC X(01).            02040000
020500             15  PV-STA-DD                  PIC X(02).            02050000
020600         10  PV-STA-TIME.                                         02060000
020800             15  PV-STA-HH-MM               PIC X(05).            02080000
020900             15  FILLER                     PIC X(01).            02090000
021000             15  PV-STA-SS                  PIC X(02).            02100000
021100         10  FILLER                         PIC X(07).            02110000
021200     05  PV-STA-DTE-TME.                                          02120000
021300         10  PV-STA-DT-YY               PIC X(02).                02130007
021400         10  FILLER                     PIC X(01)  VALUE '/'.     02140000
021410         10  PV-STA-DT-MM               PIC X(02).                02141007
021420         10  FILLER                     PIC X(01)  VALUE '/'.     02142007
021500         10  PV-STA-DT-DD               PIC X(02).                02150000
021600         10  FILLER                     PIC X(01)  VALUE SPACES.  02160000
021700         10  PV-STA-DT-HH-MM            PIC X(05).                02170000
021800     05  PV-CURR-LOC.                                             02180000
021900         10  PV-CURR-OPER               PIC ZZZ9.                 02190000
022200     05  PV-DEST.                                                 02220000
022300         10  PV-DEST-OPER               PIC ZZZ9.                 02230000
022600     05  PV-TRIP-STOP-NBR               PIC Z(02).                02260000
022610     05  PV-CSR-TRIP-ST-CDE             PIC X(02).                02261016
022620     05  PV-CSR-TRIP-ST-UID             PIC X(08).                02262016
022630     05  PV-DISP-CSR-4B                 PIC 9999.                 02263020
022640     05  PV-DISP-CSR-4E                 PIC 9999.                 02264020
022700                                                                  02270000
022800                                                                  02280000
022900*---------------------------------------------------------------* 02290000
023000*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   * 02300000
023100*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           * 02310000
023200*   APPLICATION-SPECIFIC COMMAREA.                              * 02320000
023300*---------------------------------------------------------------* 02330000
023400 01  LQW-LIST-QUEUE-WORK-AREA.                                    02340000
023500     05  LQW-BLOCK-MODIFIED             PIC X(01)   VALUE SPACE.  02350000
023600     05  LQW-ITEM-ENTRIES               OCCURS 15 TIMES           02360000
023700                                        INDEXED BY LQW-IDX.       02370000
023800         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02380000
023900         10  LQW-TEMP-SELECTED-SW       PIC X(01).                02390000
024000         10  LQW-SELECTED-SW            PIC X(01).                02400000
024100             88  LQW-SELECT                         VALUE 'S'.    02410000
024200             88  LQW-DESELECT                       VALUE ' '.    02420000
024300         10  LQW-CARR-SCAC-CDE          PIC X(04).                02430000
024400         10  LQW-TRLR-NBR               PIC X(08).                02440000
024500         10  LQW-TRIP-STOP              PIC X(02).                02450000
024600         10  LQW-STAT                   PIC X(02).                02460000
024700         10  LQW-MANIFEST               PIC X(10).                02470000
024800         10  LQW-USE                    PIC X(03).                02480000
024900         10  LQW-LGTH                   PIC X(02).                02490000
025000         10  LQW-CURR-LOC-1             PIC X(04).                02500003
025100         10  LQW-CURR-LOC-2             PIC X(04).                02510003
025200         10  LQW-DEST                   PIC X(04).                02520003
025300         10  LQW-STA-DTE-TME            PIC X(14).                02530007
025310         10  LQW-STA-USERID             PIC X(08).                02531003
025500         10  LQW-OPER-UNT-ID            PIC S9(04) COMP.          02550000
025600         10  LQW-FCLTY-ID               PIC S9(04) COMP.          02560000
025700         10  LQW-TRIP-ID                PIC S9(09) COMP.          02570000
025800                                                                  02580000
025900/                                                                 02590000
026000*---------------------------------------------------------------* 02600000
026100*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * 02610000
026200*---------------------------------------------------------------* 02620000
026300                                                                  02630000
026400     COPY TRWS006.                                                02640000
026500                                                                  02650000
026600/                                                                 02660000
026700*---------------------------------------------------------------* 02670000
026800*    MAP LAYOUT                                                 * 02680000
026900*---------------------------------------------------------------* 02690000
027000                                                                  02700000
027100     COPY TRKM122.                                                02710000
027200                                                                  02720000
027300 01  MR-OCCURS-LAYOUT                   REDEFINES  TR122AO.       02730000
027400     05  FILLER                         PIC X(48).                02740012
027500                                                                  02750000
027600     05  MR-SCROLL-AREA                 OCCURS 15 TIMES.          02760000
027700         10  MR-SELECTL                 PIC S9(04) COMP.          02770000
027800         10  MR-SELECTA                 PIC X(01).                02780000
027900         10  MR-SELECTC                 PIC X(01).                02790000
028000         10  MR-SELECTH                 PIC X(01).                02800000
028100         10  MR-SELECT                  PIC X(01).                02810000
028200                                                                  02820000
028300         10  FILLER                     PIC X(05).                02830000
028400         10  MR-CARR-SCAC-CDE           PIC X(04).                02840000
028500                                                                  02850000
028600         10  FILLER                     PIC X(05).                02860000
028700         10  MR-TRLR-NBR                PIC X(08).                02870000
028800                                                                  02880000
028900         10  FILLER                     PIC X(05).                02890000
029000         10  MR-TRIP-STOP               PIC X(02).                02900000
029100                                                                  02910000
029200         10  FILLER                     PIC X(05).                02920000
029300         10  MR-STAT                    PIC X(02).                02930000
029400                                                                  02940000
029500         10  FILLER                     PIC X(05).                02950000
029600         10  MR-MANIFEST                PIC X(10).                02960000
029700                                                                  02970000
029800         10  FILLER                     PIC X(05).                02980000
029900         10  MR-USE                     PIC X(03).                02990000
030000                                                                  03000000
030100         10  FILLER                     PIC X(05).                03010000
030200         10  MR-LGTH                    PIC X(02).                03020000
030300                                                                  03030000
030400         10  FILLER                     PIC X(05).                03040000
030500         10  MR-CURR-LOC-1              PIC X(04).                03050003
030600                                                                  03060000
030700         10  FILLER                     PIC X(05).                03070000
030800         10  MR-CURR-LOC-2              PIC X(04).                03080003
030900                                                                  03090000
031000         10  FILLER                     PIC X(05).                03100000
031100         10  MR-DEST                    PIC X(04).                03110003
031200                                                                  03120000
031300         10  FILLER                     PIC X(05).                03130000
031400         10  MR-ETA-DTE-TME             PIC X(14).                03140007
031500                                                                  03150000
031510         10  FILLER                     PIC X(05).                03151003
031520         10  MR-STAT-USERID             PIC X(08).                03152010
031530                                                                  03153003
031820     05  FILLER                         PIC X(11).                03182006
031900/                                                                 03190000
032000*---------------------------------------------------------------* 03200000
032100*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03210000
032200*---------------------------------------------------------------* 03220000
032300                                                                  03230000
032400     COPY DPWS015.                                                03240000
032500                                                                  03250000
032600*---------------------------------------------------------------* 03260000
032700*    FUNCTION KEYS COPYBOOK.                                    * 03270000
032800*---------------------------------------------------------------* 03280000
032900                                                                  03290000
033000     COPY DPWS016.                                                03300000
033100                                                                  03310000
033200*---------------------------------------------------------------* 03320000
033300*    NUMERIC EDIT LAYOUT.                                       * 03330000
033400*---------------------------------------------------------------* 03340000
033500                                                                  03350000
033600     COPY DPWS010I.                                               03360000
033700                                                                  03370000
033800/                                                                 03380000
033900*---------------------------------------------------------------* 03390000
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 03400024
034100*---------------------------------------------------------------* 03410000
034200                                                                  03420000
034300     COPY DPWS030.                                                03430000
CICS       COPY DPWS930.                                                03440024
034500/                                                                 03450000
034600*---------------------------------------------------------------* 03460000
034700*    STANDARD COMMAREA.                                         * 03470000
034800*---------------------------------------------------------------* 03480000
034900                                                                  03490000
035000     COPY DPWS020.                                                03500000
035100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03510000
035200                                                                  03520000
035300*---------------------------------------------------------------* 03530000
035400* INTER-APPLICATION COMMAREA.                                   * 03540000
035500*---------------------------------------------------------------* 03550000
035600                                                                  03560000
035700         10  INTER-APPL-COMM-AREA       PIC X(200).               03570000
035800     COPY TRWS005.                                                03580000
035900     COPY TRWS007.                                                03590000
036000*---------------------------------------------------------------* 03600000
036100*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03610000
036200*---------------------------------------------------------------* 03620000
036300         10  ASC-SPECIFIC-COMMAREA.                               03630000
036400             15  ASC-LIST-KEYS.                                   03640000
036500                 20  ASC-KEY-OPER-UNT-ID       PIC S9(4) COMP.    03650000
036600                 20  ASC-KEY-FCLTY-ID          PIC S9(4) COMP.    03660000
036700                 20  ASC-KEY-FCLTY-AREA-ID     PIC X(06).         03670000
036800                 20  ASC-KEY-SUBAREA-OF-ID     PIC X(06).         03680000
036900                 20  ASC-KEY-STATUS-BEG        PIC X(02).         03690000
037000                 20  ASC-KEY-STATUS-END        PIC X(02).         03700000
037100                 20  ASC-KEY-STATUS-IND-1      PIC X(02).         03710000
037200                 20  ASC-KEY-STATUS-IND-2      PIC X(02).         03720000
037300                 20  ASC-KEY-STATUS-IND-3      PIC X(02).         03730000
037400                 20  ASC-KEY-STATUS-IND-4      PIC X(02).         03740000
037500                 20  ASC-KEY-STATUS-IND-5      PIC X(02).         03750000
037600                 20  ASC-KEY-SCHD-FROM-DTE     PIC X(10).         03760000
037700                 20  ASC-KEY-SCHD-TO-DTE       PIC X(10).         03770000
037800                 20  ASC-KEY-USAGE-BEG         PIC X(03).         03780000
037900                 20  ASC-KEY-USAGE-END         PIC X(03).         03790000
038000                 20  ASC-KEY-USAGE-IND-1       PIC X(03).         03800000
038100                 20  ASC-KEY-USAGE-IND-2       PIC X(03).         03810000
038200                 20  ASC-KEY-USAGE-IND-3       PIC X(03).         03820000
038300                 20  ASC-KEY-OWNER-SCAC-ID     PIC X(04).         03830000
038400                 20  ASC-KEY-VEH-NBR           PIC X(10).         03840000
038500                 20  ASC-KEY-DEST-OPER-UNT-ID  PIC S9(4) COMP.    03850000
038600                 20  ASC-KEY-DEST-FCLTY-ID     PIC S9(4) COMP.    03860000
038700             15  ASC-BLOCK-ENTRIES      OCCURS 2 TIMES.           03870000
038800                 20  ASC-BLOCK-MODIFIED-SW                        03880000
038900                                        PIC X(01).                03890000
039000                     88  ASC-BLOCK-NOT-MODIFIED    VALUE 'N'.     03900000
039100                     88  ASC-BLOCK-MODIFIED        VALUE 'Y'.     03910000
039200                                                                  03920000
039300                 20  ASC-ITEM-ARRAY.                              03930000
039400                     25  ASC-ITEM-ENTRIES OCCURS 15 TIMES.        03940000
039500                         30  ASC-LIST-ITEM-NUMBER                 03950000
039600                                        PIC S9(09) COMP-3.        03960000
039700                         30  ASC-TEMP-SELECTED-SW                 03970000
039800                                        PIC X(01).                03980000
039900                             88  ASC-VALID-SELECT  VALUE ' '      03990000
040000                                                         'S'      04000000
040100                                                         'B'      04010000
040200                                                         'E'.     04020000
040300                             88  ASC-TEMP-NO-SELECT               04030000
040400                                                   VALUE ' '.     04040000
040500                             88  ASC-TEMP-SELECT   VALUE 'S'.     04050000
040600                             88  ASC-TEMP-BEGIN    VALUE 'B'.     04060000
040700                             88  ASC-TEMP-END      VALUE 'E'.     04070000
040800                         30  ASC-SELECTED-SW                      04080000
040900                                        PIC X(01).                04090000
041000                             88  ASC-NO-SELECT     VALUE ' '.     04100000
041100                             88  ASC-SELECT        VALUE 'S'.     04110000
041200                             88  ASC-BEGIN         VALUE 'B'.     04120000
041300                             88  ASC-END           VALUE 'E'.     04130000
041400                         30  ASC-CARR-SCAC-CDE  PIC X(04).        04140000
041500                         30  ASC-TRLR-NBR       PIC X(08).        04150000
041600                         30  ASC-TRIP-STOP      PIC X(02).        04160000
041700                         30  ASC-STAT           PIC X(02).        04170000
041800                         30  ASC-MANIFEST       PIC X(10).        04180000
041900                         30  ASC-USE            PIC X(03).        04190000
042000                         30  ASC-LGTH           PIC X(02).        04200000
042100                         30  ASC-CURR-LOC-1     PIC X(04).        04210003
042200                         30  ASC-CURR-LOC-2     PIC X(04).        04220003
042300                         30  ASC-DEST           PIC X(04).        04230003
042400                         30  ASC-STATUS-DTE-TME PIC X(14).        04240007
042410                         30  ASC-STATUS-USERID  PIC X(08).        04241003
042600                         30  ASC-OPER-UNT-ID    PIC S9(04) COMP.  04260000
042700                         30  ASC-FCLTY-ID       PIC S9(04) COMP.  04270000
042800                         30  ASC-TRIP-ID        PIC S9(09) COMP.  04280000
042900                                                                  04290000
043000             15  ASC-BLK-SUB            PIC S9(04) COMP SYNC.     04300000
043100             15  ASC-ITEM-SUB           PIC S9(04) COMP SYNC.     04310000
043200             15  ASC-SEL-SUB            PIC S9(04) COMP.          04320000
043300             15  ASC-SEL-ITEM           PIC S9(04) COMP.          04330000
043400             15  ASC-NUMBER-OF-ITEMS-READ                         04340000
043500                                        PIC S9(09) COMP-3.        04350000
043600             15  ASC-NUMBER-OF-SELECTED-ITEMS                     04360000
043700                                        PIC S9(09) COMP-3.        04370000
043800             15  ASC-NUMBER-OF-TS-ITEMS PIC S9(05) COMP-3.        04380000
043900             15  ASC-ITEMS-DISPLAYED    PIC S9(03) COMP-3.        04390000
044000             15  ASC-ITEM-AT-TOP-OF-PANEL                         04400000
044100                                        PIC S9(09) COMP-3.        04410000
044200             15  ASC-ITEM-AT-BOT-OF-PANEL                         04420000
044300                                        PIC S9(09) COMP-3.        04430000
044400             15  ASC-HIGHEST-BLOCK-WRITTEN                        04440000
044500                                        PIC S9(04) COMP SYNC.     04450000
044600             15  ASC-START-OF-SELECTED-RANGE                      04460000
044700                                        PIC S9(09) COMP-3.        04470000
044800             15  ASC-END-OF-SELECTED-RANGE                        04480000
044900                                        PIC S9(09) COMP-3.        04490000
045000             15  ASC-ITEMS-LEFT-INDICATOR                         04500000
045100                                        PIC X(01).                04510000
045200                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     04520000
045300                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     04530000
045400             15  ASC-TEMP-QUEUE-UPDATE-SW                         04540000
045500                                        PIC X(01).                04550000
045600                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     04560000
045700                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     04570000
045800             15  ASC-LIST-QUEUE-NAME.                             04580000
045900                 20  ASC-LIST-TERM-ID   PIC X(04).                04590000
046000                 20  ASC-LIST-TASK-NUMBER                         04600000
046100                                        PIC S9(05) COMP-3.        04610000
046200                 20  ASC-LIST-SEQ       PIC 9(01).                04620000
046300             15  ASC-SEL-QUEUE-NAME-IN   PIC X(08).               04630000
046400             15  ASC-SEL-QUEUE-NAME-OUT.                          04640000
046500                 20  ASC-SEL-TERM-ID-OUT PIC X(04).               04650000
046600                 20  ASC-SEL-TASK-NUMBER-OUT                      04660000
046700                                         PIC S9(05) COMP-3.       04670000
046800                 20  ASC-SEL-SEQ-OUT     PIC 9(01).               04680000
046900                                                                  04690000
047000             15  ASC-CURSOR-SW          PIC X(02).                04700000
047100                 88  ASC-DOCK-HIST-CURSOR          VALUE 'DH'.    04710000
047200                 88  ASC-SCAC-HIST-CURSOR          VALUE 'SH'.    04720000
047300                 88  ASC-TRLR-HIST-CURSOR          VALUE 'TH'.    04730000
047400             15  ASC-START-ITEM-REQUEST.                          04740000
047500                 20  ASC-START-ITEM-REQUEST-N  PIC 9(07).         04750000
047600             15  ASC-USE-SELECTION-QUEUE-IND   PIC X(01).         04760000
047700                 88  ASC-USE-SELECTION-QUEUE   VALUE 'Y'.         04770000
047800             15  ASC-FCLTY-NME                 PIC X(25).         04780000
047900/                                                                 04790000
048000*---------------------------------------------------------------* 04800000
048100*    ABEND PROCESSING COPYBOOK.                                 * 04810000
048200*---------------------------------------------------------------* 04820000
048300                                                                  04830000
048400     COPY DPWS013.                                                04840000
048500                                                                  04850000
048600/                                                                 04860000
048700*---------------------------------------------------------------* 04870000
048800*    DB2 AREA FOR THE FACLITY TABLE                             * 04880000
048900*---------------------------------------------------------------* 04890000
049000     EXEC SQL                                                     04900000
049100          INCLUDE TFACLTY                                         04910000
049200     END-EXEC.                                                    04920000
049300                                                                  04930000
049400/                                                                 04940000
049500*---------------------------------------------------------------* 04950000
049600*    DB2 AREA FOR THE FACLITY AREA TABLE                        * 04960000
049700*---------------------------------------------------------------* 04970000
049800     EXEC SQL                                                     04980000
049900          INCLUDE TFLAREA                                         04990000
050000     END-EXEC.                                                    05000000
050100                                                                  05010000
050200/                                                                 05020000
050300*---------------------------------------------------------------* 05030000
050400*    DB2 AREA FOR THE FACLITY AREA TYPE CODE TABLE              * 05040000
050500*---------------------------------------------------------------* 05050000
050600     EXEC SQL                                                     05060000
050700          INCLUDE TFLTYPE                                         05070000
050800     END-EXEC.                                                    05080000
050900                                                                  05090000
051000/                                                                 05100000
051100*---------------------------------------------------------------* 05110000
051200*    DB2 AREA FOR THE VEHICLE AUDIT TABLE                       * 05120000
051300*---------------------------------------------------------------* 05130000
051400     EXEC SQL                                                     05140000
051500          INCLUDE TAUVHCL                                         05150000
051600     END-EXEC.                                                    05160000
051700                                                                  05170000
051800/                                                                 05180000
051900*---------------------------------------------------------------* 05190000
052000*    DB2 AREA FOR THE VEHICLE TRIP TABLE                        * 05200000
052100*---------------------------------------------------------------* 05210000
052200     EXEC SQL                                                     05220000
052300          INCLUDE TVHTRIP                                         05230000
052400     END-EXEC.                                                    05240000
052500                                                                  05250000
052600/                                                                 05260000
052700*---------------------------------------------------------------* 05270000
052800*    DB2 AREA FOR THE TRIP STATUS TABLE                         * 05280000
052900*---------------------------------------------------------------* 05290000
053000     EXEC SQL                                                     05300000
053100          INCLUDE TTRIPST                                         05310000
053200     END-EXEC.                                                    05320000
053300                                                                  05330000
053400/                                                                 05340000
053500*---------------------------------------------------------------* 05350000
053600*    DB2 AREA FOR THE TRIP STATUS CODE TABLE                    * 05360000
053700*---------------------------------------------------------------* 05370000
053800     EXEC SQL                                                     05380000
053900          INCLUDE TTRSTYP                                         05390000
054000     END-EXEC.                                                    05400000
054100                                                                  05410000
055000                                                                  05500009
055100*---------------------------------------------------------------* 05510000
055200*    DB2 AREA FOR COMMUNICATIONS                                * 05520000
055300*---------------------------------------------------------------* 05530000
055400     EXEC SQL                                                     05540000
055500          INCLUDE SQLCA                                           05550000
055600     END-EXEC.                                                    05560000
055700                                                                  05570000
055800/                                                                 05580000
055900*---------------------------------------------------------------* 05590000
056000*  CURSOR TO LIST TRAILERS BY DOCK AREA - HISTORY               * 05600000
056100*---------------------------------------------------------------* 05610000
056200                                                                  05620000
056300     EXEC SQL                                                     05630000
056400          DECLARE DOCK-HST-CSR CURSOR FOR                         05640000
056410           SELECT                                                 05641015
056411                  T1.CURR_STATUS_CDE                              05641115
056412                , T1.CURR_STATUS_DTE                              05641215
056413                , T1.CURR_STATUS_TME                              05641315
056414                , T1.CURR_TRIP_ID                                 05641415
056415                 ,T2.TRIP_STATUS_CDE                              05641515
056416                 ,T2.STATUS_UID                                   05641615
056420             FROM                                                 05642015
056430           (                                                      05643015
056500           SELECT                                                 05650000
056600                  A.CURR_STATUS_CDE                               05660000
056700             ,MAX(A.CURR_STATUS_DTE) AS CURR_STATUS_DTE           05670015
056800             ,MAX(A.CURR_STATUS_TME) AS CURR_STATUS_TME           05680015
056900                 ,A.CURR_TRIP_ID                                  05690000
057000           FROM   TAUVHCL A                                       05700000
057100                 ,TVHTRIP B                                       05710000
057300            WHERE A.CURR_OPER_UNT_ID BETWEEN :DK-OPER-UNT-ID-B    05730000
057400                                         AND :DK-OPER-UNT-ID-E    05740000
057500             AND  A.CURR_FCLTY_ID BETWEEN :DK-FCLTY-ID-B          05750000
057600                                      AND :DK-FCLTY-ID-E          05760000
057700             AND  A.CURR_FAC_AREA_ID BETWEEN :DK-FCLTY-AREA-ID-B  05770000
057800                                         AND :DK-FCLTY-AREA-ID-E  05780000
057900             AND  A.OWNER_SCAC_ID BETWEEN :DK-OWNER-SCAC-ID-B     05790000
058000                                      AND :DK-OWNER-SCAC-ID-E     05800000
058100             AND  B.VEH_NBR IS NOT NULL                           05810000
058200             AND ((A.CURR_STATUS_CDE BETWEEN :DK-STATUS-IND-B     05820000
058300                                         AND :DK-STATUS-IND-E)    05830000
058400              OR   A.CURR_STATUS_CDE IN (:DK-STATUS-IND-1         05840000
058500                                        ,:DK-STATUS-IND-2         05850000
058600                                        ,:DK-STATUS-IND-3         05860000
058700                                        ,:DK-STATUS-IND-4         05870000
058800                                        ,:DK-STATUS-IND-5))       05880000
058900             AND ((A.USAGE_CDE BETWEEN :DK-USAGE-IND-B            05890000
059000                                   AND :DK-USAGE-IND-E)           05900000
059100              OR   A.USAGE_CDE IN (:DK-USAGE-IND-1                05910000
059200                                  ,:DK-USAGE-IND-2                05920000
059300                                  ,:DK-USAGE-IND-3))              05930000
059400             AND  A.CURR_STATUS_DTE                               05940000
059500                                  BETWEEN :DK-SCHD-FROM-DTE       05950000
059600                                      AND :DK-SCHD-TO-DTE         05960000
059700             AND  A.CURR_TRIP_ID    = B.TRIP_ID                   05970000
060400             AND  A.CURR_TRIP_ID    = B.TRIP_ID                   06040000
060500           GROUP BY A.CURR_STATUS_CDE,                            06050015
060600                  A.CURR_TRIP_ID                                  06060000
060700           ORDER BY A.CURR_STATUS_CDE                             06070015
060800                 ,A.CURR_TRIP_ID                                  06080000
060810           ) AS T1                                                06081015
060820           LEFT OUTER JOIN                                        06082015
060830           (                                                      06083017
060831           SELECT                                                 06083115
060832                  AA.CURR_STATUS_CDE                              06083215
060833             ,MAX(AA.CURR_STATUS_DTE) AS CURR_STATUS_DTE          06083315
060834             ,MAX(AA.CURR_STATUS_TME) AS CURR_STATUS_TME          06083415
060835                 ,AA.CURR_TRIP_ID                                 06083515
060836                 ,CC.TRIP_STATUS_CDE                              06083615
060839                 ,CC.STATUS_UID                                   06083915
060840                                                                  06084015
060841           FROM   TAUVHCL AA                                      06084115
060842                 ,TVHTRIP BB                                      06084215
060843                 ,TTRIPST CC                                      06084315
060844            WHERE AA.CURR_OPER_UNT_ID BETWEEN :DK-OPER-UNT-ID-B   06084415
060845                                          AND :DK-OPER-UNT-ID-E   06084515
060846             AND  AA.CURR_FCLTY_ID BETWEEN :DK-FCLTY-ID-B         06084615
060847                                       AND :DK-FCLTY-ID-E         06084715
060848             AND  AA.CURR_FAC_AREA_ID BETWEEN :DK-FCLTY-AREA-ID-B 06084815
060849                                          AND :DK-FCLTY-AREA-ID-E 06084915
060850             AND  AA.OWNER_SCAC_ID BETWEEN :DK-OWNER-SCAC-ID-B    06085015
060851                                       AND :DK-OWNER-SCAC-ID-E    06085115
060852             AND  BB.VEH_NBR IS NOT NULL                          06085215
060853             AND ((AA.CURR_STATUS_CDE BETWEEN :DK-STATUS-IND-B    06085315
060854                                          AND :DK-STATUS-IND-E)   06085415
060855              OR   AA.CURR_STATUS_CDE IN (:DK-STATUS-IND-1        06085515
060856                                         ,:DK-STATUS-IND-2        06085615
060857                                         ,:DK-STATUS-IND-3        06085715
060858                                         ,:DK-STATUS-IND-4        06085815
060859                                         ,:DK-STATUS-IND-5))      06085915
060860             AND ((AA.USAGE_CDE BETWEEN :DK-USAGE-IND-B           06086015
060861                                    AND :DK-USAGE-IND-E)          06086115
060862              OR   AA.USAGE_CDE IN (:DK-USAGE-IND-1               06086215
060863                                   ,:DK-USAGE-IND-2               06086315
060864                                   ,:DK-USAGE-IND-3))             06086415
060865             AND  AA.CURR_STATUS_DTE                              06086515
060866                                  BETWEEN :DK-SCHD-FROM-DTE       06086615
060867                                      AND :DK-SCHD-TO-DTE         06086715
060868             AND  AA.CURR_TRIP_ID    = BB.TRIP_ID                 06086815
060869             AND  AA.CURR_TRIP_ID    = BB.TRIP_ID                 06086915
060870             AND  AA.CURR_TRIP_ID    = CC.TRIP_ID                 06087015
060871             AND  AA.CURR_STATUS_CDE = CC.TRIP_STATUS_CDE         06087115
060872           GROUP BY AA.CURR_STATUS_CDE,                           06087215
060873                  AA.CURR_TRIP_ID                                 06087315
060874                 ,CC.TRIP_STATUS_CDE                              06087418
060875                 ,CC.STATUS_UID                                   06087518
060876           ORDER BY AA.CURR_STATUS_CDE                            06087615
060877                 ,AA.CURR_TRIP_ID                                 06087715
060880           ) AS T2                                                06088015
060893           ON  T1.CURR_TRIP_ID     =  T2.CURR_TRIP_ID    AND      06089315
060894               T1.CURR_STATUS_CDE  =  T2.TRIP_STATUS_CDE          06089415
060895         WITH UR                                                  06089515
060900     END-EXEC.                                                    06090000
061000                                                                  06100000
061100/                                                                 06110000
061200*---------------------------------------------------------------* 06120000
061300*  CURSOR TO LIST TRAILERS BY SCAC AND TRAILER - HISTORY        * 06130000
061400*---------------------------------------------------------------* 06140000
061500                                                                  06150000
061600     EXEC SQL                                                     06160000
061700          DECLARE SCAC-HST-CSR CURSOR FOR                         06170000
061800           SELECT                                                 06180000
061900                  T1.CURR_STATUS_CDE                              06190015
062000                 ,T1.LAST_UPD_DTE                                 06200015
062100                 ,T1.LAST_UPD_TME                                 06210015
062200                 ,T1.CURR_TRIP_ID                                 06220015
062300                 ,T1.OWNER_SCAC_ID                                06230015
062400                 ,T1.VEH_NBR                                      06240015
062500                 ,T1.PLND_TRIP_SEQ                                06250015
062501                 ,T2.TRIP_STATUS_CDE                              06250116
062502                 ,T2.STATUS_UID                                   06250216
062503             FROM                                                 06250315
062504           (                                                      06250415
062505           SELECT                                                 06250515
062510                  A.CURR_STATUS_CDE                               06251016
062520                 ,A.LAST_UPD_DTE                                  06252016
062530                 ,A.LAST_UPD_TME                                  06253016
062540                 ,A.CURR_TRIP_ID                                  06254016
062550                 ,B.OWNER_SCAC_ID                                 06255016
062560                 ,B.VEH_NBR                                       06256016
062570                 ,B.PLND_TRIP_SEQ                                 06257016
062600           FROM   TAUVHCL A                                       06260019
062700                 ,TVHTRIP B                                       06270019
062800            WHERE A.CURR_OPER_UNT_ID BETWEEN :DK-OPER-UNT-ID-B    06280000
062900                                         AND :DK-OPER-UNT-ID-E    06290000
063000             AND  A.CURR_FCLTY_ID BETWEEN :DK-FCLTY-ID-B          06300000
063100                                      AND :DK-FCLTY-ID-E          06310000
063200             AND  A.OWNER_SCAC_ID BETWEEN :DK-OWNER-SCAC-ID-B     06320000
063300                                      AND :DK-OWNER-SCAC-ID-E     06330000
063400             AND  A.VEH_NBR       BETWEEN :DK-VEH-NBR-B           06340000
063500                                      AND :DK-VEH-NBR-E           06350000
063600             AND  B.VEH_NBR IS NOT NULL                           06360000
063700             AND ((A.CURR_STATUS_CDE BETWEEN :DK-STATUS-IND-B     06370000
063800                                         AND :DK-STATUS-IND-E)    06380000
063900              OR   A.CURR_STATUS_CDE IN (:DK-STATUS-IND-1         06390000
064000                                        ,:DK-STATUS-IND-2         06400000
064100                                        ,:DK-STATUS-IND-3         06410000
064200                                        ,:DK-STATUS-IND-4         06420000
064300                                        ,:DK-STATUS-IND-5))       06430000
064400             AND  A.CURR_STATUS_DTE                               06440000
064500                                  BETWEEN :DK-SCHD-FROM-DTE       06450000
064600                                      AND :DK-SCHD-TO-DTE         06460000
064700             AND  A.CURR_TRIP_ID    = B.TRIP_ID                   06470000
064800           ORDER BY B.OWNER_SCAC_ID                               06480015
064900                   ,B.VEH_NBR                                     06490015
065000                   ,A.CURR_TRIP_ID                                06500015
065100                   ,B.PLND_TRIP_SEQ                               06510015
065200                   ,A.LAST_UPD_DTE                                06520015
065300                   ,A.LAST_UPD_TME                                06530015
065310           ) AS T1                                                06531015
065320           LEFT OUTER JOIN                                        06532015
065330           (                                                      06533015
065331           SELECT                                                 06533116
065332                  AA.CURR_STATUS_CDE                              06533222
065333                 ,AA.LAST_UPD_DTE                                 06533322
065334                 ,AA.LAST_UPD_TME                                 06533422
065335                 ,AA.CURR_TRIP_ID                                 06533522
065336                 ,BB.OWNER_SCAC_ID                                06533622
065337                 ,BB.VEH_NBR                                      06533722
065338                 ,BB.PLND_TRIP_SEQ                                06533822
065341                 ,CC.TRIP_STATUS_CDE                              06534116
065342                 ,CC.STATUS_UID                                   06534216
065343           FROM   TAUVHCL AA                                      06534316
065344                 ,TVHTRIP BB                                      06534416
065345                 ,TTRIPST CC                                      06534516
065346            WHERE AA.CURR_OPER_UNT_ID BETWEEN :DK-OPER-UNT-ID-B   06534616
065347                                          AND :DK-OPER-UNT-ID-E   06534716
065348             AND  AA.CURR_FCLTY_ID BETWEEN :DK-FCLTY-ID-B         06534816
065349                                       AND :DK-FCLTY-ID-E         06534916
065350             AND  AA.OWNER_SCAC_ID BETWEEN :DK-OWNER-SCAC-ID-B    06535016
065351                                       AND :DK-OWNER-SCAC-ID-E    06535116
065352             AND  AA.VEH_NBR       BETWEEN :DK-VEH-NBR-B          06535216
065353                                       AND :DK-VEH-NBR-E          06535316
065354             AND  BB.VEH_NBR IS NOT NULL                          06535416
065355             AND ((AA.CURR_STATUS_CDE BETWEEN :DK-STATUS-IND-B    06535516
065356                                          AND :DK-STATUS-IND-E)   06535616
065357              OR   AA.CURR_STATUS_CDE IN (:DK-STATUS-IND-1        06535716
065358                                         ,:DK-STATUS-IND-2        06535816
065359                                         ,:DK-STATUS-IND-3        06535916
065360                                         ,:DK-STATUS-IND-4        06536016
065361                                         ,:DK-STATUS-IND-5))      06536116
065362             AND  AA.CURR_STATUS_DTE                              06536216
065363                                   BETWEEN :DK-SCHD-FROM-DTE      06536316
065364                                      AND :DK-SCHD-TO-DTE         06536416
065365             AND  AA.CURR_TRIP_ID    = BB.TRIP_ID                 06536516
065366             AND  AA.CURR_TRIP_ID    = CC.TRIP_ID                 06536616
065367             AND  AA.CURR_STATUS_CDE = CC.TRIP_STATUS_CDE         06536716
065368           ORDER BY BB.OWNER_SCAC_ID                              06536816
065369                   ,BB.VEH_NBR                                    06536916
065370                   ,AA.CURR_TRIP_ID                               06537016
065371                   ,BB.PLND_TRIP_SEQ                              06537116
065372                   ,AA.LAST_UPD_DTE                               06537216
065373                   ,AA.LAST_UPD_TME                               06537316
065374           ) AS T2                                                06537415
065375           ON  T1.CURR_TRIP_ID     =  T2.CURR_TRIP_ID    AND      06537516
065376               T1.CURR_STATUS_CDE  =  T2.TRIP_STATUS_CDE          06537616
065380           WITH UR                                                06538015
065400     END-EXEC.                                                    06540000
065500                                                                  06550000
065600/                                                                 06560000
065700*---------------------------------------------------------------* 06570000
065800*  CURSOR TO LIST TRAILERS BY PURPOSE AND STATUS CODE - HISTORY * 06580000
065900*---------------------------------------------------------------* 06590000
066000                                                                  06600000
066100     EXEC SQL                                                     06610000
066200          DECLARE TRLR-HST-CSR CURSOR FOR                         06620000
066201           SELECT                                                 06620116
066202                  T1.CURR_STATUS_CDE                              06620216
066203                , T1.CURR_STATUS_DTE                              06620316
066204                , T1.CURR_STATUS_TME                              06620416
066205                , T1.CURR_TRIP_ID                                 06620516
066206                , T2.TRIP_STATUS_CDE                              06620616
066207                , T2.STATUS_UID                                   06620716
066208           FROM                                                   06620816
066210          (                                                       06621016
066300           SELECT                                                 06630000
066400                  A.CURR_STATUS_CDE                               06640000
066500             ,MAX(A.CURR_STATUS_DTE) AS CURR_STATUS_DTE           06650016
066600             ,MAX(A.CURR_STATUS_TME) AS CURR_STATUS_TME           06660016
066700                 ,A.CURR_TRIP_ID                                  06670000
066800           FROM   TAUVHCL A                                       06680000
066900                 ,TVHTRIP B                                       06690000
067000            WHERE A.CURR_OPER_UNT_ID BETWEEN :DK-OPER-UNT-ID-B    06700000
067100                                         AND :DK-OPER-UNT-ID-E    06710000
067200             AND  A.CURR_FCLTY_ID BETWEEN :DK-FCLTY-ID-B          06720000
067300                                      AND :DK-FCLTY-ID-E          06730000
067400             AND  A.CURR_STATUS_CDE ^= 'ET'                       06740000
067500             AND ((A.USAGE_CDE BETWEEN :DK-USAGE-IND-B            06750000
067600                                   AND :DK-USAGE-IND-E)           06760000
067700              OR   A.USAGE_CDE IN (:DK-USAGE-IND-1                06770000
067800                                  ,:DK-USAGE-IND-2                06780000
067900                                  ,:DK-USAGE-IND-3))              06790000
068000             AND ((A.CURR_STATUS_CDE BETWEEN :DK-STATUS-IND-B     06800000
068100                                         AND :DK-STATUS-IND-E)    06810000
068200              OR   A.CURR_STATUS_CDE IN (:DK-STATUS-IND-1         06820000
068300                                        ,:DK-STATUS-IND-2         06830000
068400                                        ,:DK-STATUS-IND-3         06840000
068500                                        ,:DK-STATUS-IND-4         06850000
068600                                        ,:DK-STATUS-IND-5))       06860000
068700             AND  A.CURR_STATUS_DTE                               06870000
068800                                  BETWEEN :DK-SCHD-FROM-DTE       06880000
068900                                      AND :DK-SCHD-TO-DTE         06890000
069000             AND  B.VEH_NBR IS NOT NULL                           06900000
069100             AND  A.CURR_TRIP_ID    = B.TRIP_ID                   06910000
069200           GROUP BY A.CURR_STATUS_CDE,                            06920016
069300                    A.CURR_TRIP_ID                                06930016
069400           ORDER BY A.CURR_STATUS_CDE                             06940016
069500                   ,A.CURR_TRIP_ID                                06950016
069510          ) AS T1                                                 06951016
069511          LEFT OUTER JOIN                                         06951116
069520          (                                                       06952016
069521           SELECT                                                 06952116
069522                  AA.CURR_STATUS_CDE                              06952216
069523             ,MAX(AA.CURR_STATUS_DTE) AS CURR_STATUS_DTE          06952316
069524             ,MAX(AA.CURR_STATUS_TME) AS CURR_STATUS_TME          06952416
069525                 ,AA.CURR_TRIP_ID                                 06952516
069526                 ,CC.TRIP_STATUS_CDE                              06952616
069527                 ,CC.STATUS_UID                                   06952716
069528           FROM   TAUVHCL AA                                      06952816
069529                 ,TVHTRIP BB                                      06952916
069530                 ,TTRIPST CC                                      06953016
069531            WHERE AA.CURR_OPER_UNT_ID BETWEEN :DK-OPER-UNT-ID-B   06953116
069532                                          AND :DK-OPER-UNT-ID-E   06953216
069533             AND  AA.CURR_FCLTY_ID BETWEEN :DK-FCLTY-ID-B         06953316
069534                                       AND :DK-FCLTY-ID-E         06953416
069535             AND  AA.CURR_STATUS_CDE ^= 'ET'                      06953516
069536             AND ((AA.USAGE_CDE BETWEEN :DK-USAGE-IND-B           06953616
069537                                    AND :DK-USAGE-IND-E)          06953716
069538              OR   AA.USAGE_CDE IN (:DK-USAGE-IND-1               06953816
069539                                   ,:DK-USAGE-IND-2               06953916
069540                                   ,:DK-USAGE-IND-3))             06954016
069541             AND ((AA.CURR_STATUS_CDE BETWEEN :DK-STATUS-IND-B    06954116
069542                                          AND :DK-STATUS-IND-E)   06954216
069543              OR   AA.CURR_STATUS_CDE IN (:DK-STATUS-IND-1        06954316
069544                                         ,:DK-STATUS-IND-2        06954416
069545                                         ,:DK-STATUS-IND-3        06954516
069546                                         ,:DK-STATUS-IND-4        06954616
069547                                         ,:DK-STATUS-IND-5))      06954716
069548             AND  AA.CURR_STATUS_DTE                              06954816
069549                                  BETWEEN :DK-SCHD-FROM-DTE       06954916
069550                                      AND :DK-SCHD-TO-DTE         06955016
069551             AND  BB.VEH_NBR IS NOT NULL                          06955116
069552             AND  AA.CURR_TRIP_ID    = BB.TRIP_ID                 06955216
069553             AND  AA.CURR_TRIP_ID    = CC.TRIP_ID                 06955316
069554             AND  AA.CURR_STATUS_CDE = CC.TRIP_STATUS_CDE         06955416
069555           GROUP BY AA.CURR_STATUS_CDE,                           06955516
069556                    AA.CURR_TRIP_ID                               06955616
069557                   ,CC.TRIP_STATUS_CDE                            06955716
069558                   ,CC.STATUS_UID                                 06955816
069559           ORDER BY AA.CURR_STATUS_CDE                            06955916
069560                   ,AA.CURR_TRIP_ID                               06956016
069570          ) AS T2                                                 06957016
069580           ON  T1.CURR_TRIP_ID     =  T2.CURR_TRIP_ID    AND      06958016
069590               T1.CURR_STATUS_CDE  =  T2.TRIP_STATUS_CDE          06959016
069591           WITH UR                                                06959116
069600     END-EXEC.                                                    06960000
069700                                                                  06970000
069800     EXEC SQL                                                     06980000
069900          DECLARE DETAIL-CSR CURSOR FOR                           06990000
070000           SELECT                                                 07000000
070100                   A.CURR_OPER_UNT_ID                             07010000
070200                  ,A.CURR_FCLTY_ID                                07020000
070300                  ,A.CURR_FAC_AREA_ID                             07030000
070400                  ,A.OWNER_SCAC_ID                                07040000
070500                  ,A.VEH_NBR                                      07050000
070600                  ,A.USAGE_CDE                                    07060000
070700                  ,A.VEH_SIZE_CDE                                 07070000
070800                  ,A.CURR_STATUS_CDE                              07080000
070900                  ,A.CURR_STATUS_DTE                              07090000
071000                  ,A.CURR_STATUS_TME                              07100000
071100                  ,B.TRIP_ID                                      07110000
071200                  ,B.MANIFEST_NBR                                 07120000
071300                  ,B.PLND_TRIP_SEQ                                07130000
071400                  ,B.REF_TRIP_ID                                  07140000
071500                  ,G.OPER_UNT_ID                                  07150000
071600                  ,G.FCLTY_ID                                     07160000
071700                  ,G.FCLTY_AREA_ID                                07170000
071800                  ,B.EST_AR_TMST                                  07180000
071810                  ,G.STATUS_UID                                   07181003
071900            FROM   TAUVHCL A                                      07190000
072000                  ,TVHTRIP B                                      07200000
072100                  ,TTRIPST G                                      07210000
072200            WHERE  A.CURR_STATUS_CDE =                            07220000
072300                      :AUVHCL-CURR-STATUS-CDE                     07230000
072400              AND  A.CURR_STATUS_DTE =                            07240000
072500                      :AUVHCL-CURR-STATUS-DTE                     07250000
072600              AND  A.CURR_STATUS_TME =                            07260000
072700                      :AUVHCL-CURR-STATUS-TME                     07270000
072800              AND  A.CURR_TRIP_ID = :VHTRIP-TRIP-ID               07280000
072900              AND  A.CURR_TRIP_ID = B.TRIP_ID                     07290000
073000              AND  A.CURR_TRIP_ID = G.TRIP_ID                     07300000
073100              AND  G.TRIP_STATUS_CDE = 'EN'                       07310000
073200         ORDER BY  B.PLND_TRIP_SEQ                                07320000
073300                  ,A.CURR_STATUS_DTE                              07330000
073400      END-EXEC.                                                   07340000
073500/                                                                 07350000
073600     EXEC SQL                                                     07360000
073700          DECLARE DTL-SCAC-CSR CURSOR FOR                         07370000
073800           SELECT                                                 07380000
073900                   A.CURR_OPER_UNT_ID                             07390000
074000                  ,A.CURR_FCLTY_ID                                07400000
074100                  ,A.CURR_FAC_AREA_ID                             07410000
074200                  ,A.OWNER_SCAC_ID                                07420000
074300                  ,A.VEH_NBR                                      07430000
074400                  ,A.USAGE_CDE                                    07440000
074500                  ,A.VEH_SIZE_CDE                                 07450000
074600                  ,A.CURR_STATUS_CDE                              07460000
074700                  ,A.CURR_STATUS_DTE                              07470000
074800                  ,A.CURR_STATUS_TME                              07480000
074900                  ,B.TRIP_ID                                      07490000
075000                  ,B.MANIFEST_NBR                                 07500000
075100                  ,B.PLND_TRIP_SEQ                                07510000
075200                  ,B.REF_TRIP_ID                                  07520000
075300                  ,G.OPER_UNT_ID                                  07530000
075400                  ,G.FCLTY_ID                                     07540000
075500                  ,G.FCLTY_AREA_ID                                07550000
075600                  ,B.EST_AR_TMST                                  07560000
075610                  ,G.STATUS_UID                                   07561003
075700            FROM   TAUVHCL A                                      07570000
075800                  ,TVHTRIP B                                      07580000
075900                  ,TTRIPST G                                      07590000
076000            WHERE  A.CURR_STATUS_CDE =                            07600000
076100                      :AUVHCL-CURR-STATUS-CDE                     07610000
076200              AND  A.LAST_UPD_DTE =                               07620000
076300                      :AUVHCL-LAST-UPD-DTE                        07630000
076400              AND  A.LAST_UPD_TME =                               07640000
076500                      :AUVHCL-LAST-UPD-TME                        07650000
076600              AND  A.CURR_TRIP_ID = :VHTRIP-TRIP-ID               07660000
076700              AND  A.CURR_TRIP_ID = B.TRIP_ID                     07670000
076800              AND  A.CURR_TRIP_ID = G.TRIP_ID                     07680000
076900              AND  G.TRIP_STATUS_CDE = 'EN'                       07690000
077000         ORDER BY  B.PLND_TRIP_SEQ                                07700000
077100                  ,A.CURR_STATUS_DTE                              07710000
077200      END-EXEC.                                                   07720000
077300/                                                                 07730000
077400 LINKAGE SECTION.                                                 07740000
077500                                                                  07750000
077600 01  DFHCOMMAREA.                                                 07760000
077700     05  FILLER                         OCCURS  1 TO 4072 TIMES   07770000
077800                                        DEPENDING ON EIBCALEN.    07780000
077900         10  FILLER                     PIC X.                    07790000
078000                                                                  07800000
078100/                                                                 07810000
078200 PROCEDURE DIVISION.                                              07820000
078300*---------------------------------------------------------------* 07830000
078400*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 07840000
078500*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 07850000
078600*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 07860000
078700*---------------------------------------------------------------* 07870000
078800 0000-MAIN-MODULE.                                                07880000
078900                                                                  07890000
079000     INITIALIZE DP030-CICS-API-FIELDS.                            07900000
079100                                                                  07910000
079200     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       07920000
079300     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          07930000
079400     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         07940000
079500                                                                  07950000
079600     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       07960000
079700                                                                  07970000
079800     MOVE LENGTH OF TR122AI        TO DP030-MAP-LENGTH (1).       07980000
079900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     07990000
080000                                                                  08000000
080100     PERFORM 0001-CALL-CICS-ARCH-API.                             08010000
080200     PERFORM 1000-CONTROL-PROCESSING                              08020000
080300                                                                  08030000
080400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     08040000
080500     PERFORM 0001-CALL-CICS-ARCH-API.                             08050000
080600                                                                  08060000
080700*---------------------------------------------------------------* 08070000
080800*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 08080000
080900*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 08090000
081000*---------------------------------------------------------------* 08100000
081100 0001-CALL-CICS-ARCH-API.                                         08110000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      08120024
081300                                    DFHCOMMAREA                   08130024
081400                                    DP030-CICS-API-FIELDS         08140024
081500                                    DP020-STANDARD-COMMAREA       08150024
081600                                    TR122AI.                      08160024
081700                                                                  08170000
081800     IF  DP030-RC-CALL-SUCCESSFUL                                 08180000
081900         CONTINUE                                                 08190000
082000     ELSE                                                         08200000
082100         SET DP013-NO-ROLLBACK                                    08210000
082200             DP013-XCTL-DISPLAY-RESTART                           08220000
082300             DP013-CICS-ABEND      TO TRUE                        08230000
082400         MOVE '0001-CALL-CICS-ARCH-API'                           08240000
082500                                   TO DP013-PARAGRAPH             08250000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O08260024
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      08270024
082800         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      08280000
082900         PERFORM DP013-0000-PROCESS-ABEND                         08290000
083000     END-IF.                                                      08300000
083100                                                                  08310000
083200*----------------------------------------------------------------*08320000
083300* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *08330000
083400* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *08340000
083500*                                                                *08350000
083600* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *08360000
083700*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *08370000
083800*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *08380000
083900*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *08390000
084000*----------------------------------------------------------------*08400000
084100                                                                  08410000
084200 1000-CONTROL-PROCESSING.                                         08420000
084300                                                                  08430000
084400     EVALUATE TRUE                                                08440000
084500         WHEN DP020-NEXT-ACT-INITIAL                              08450000
084600             INITIALIZE ASC-SPECIFIC-COMMAREA                     08460000
084700             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            08470000
084800                                      ASC-SEL-TERM-ID-OUT         08480000
084900             MOVE DP020-SRC-TASK-NUMBER                           08490000
085000                                   TO ASC-LIST-TASK-NUMBER        08500000
085100                                      ASC-SEL-TASK-NUMBER-OUT     08510000
085200             MOVE PC-LIST-QUEUE-SEQ                               08520000
085300                                   TO ASC-LIST-SEQ                08530000
085400             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ-OUT             08540000
085500             PERFORM 1100-PROCESS-INTER-APPL-COMM                 08550000
085600             IF  PS-COMMAREA-NOT-VALID                            08560000
085700                 SET DP020-MSG-FATAL                              08570000
085800                     DP020-NEXT-ACT-APPL-ERROR                    08580000
085900                                   TO TRUE                        08590000
086000             ELSE                                                 08600000
086100                 PERFORM 4000-BUILD-INITIAL-PANEL                 08610000
086200             END-IF                                               08620000
086300                                                                  08630000
086400         WHEN DP020-NEXT-ACT-READ-MAP                             08640000
086500             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        08650000
086600                                   TO PV-TOP-ITEM                 08660000
086700             PERFORM 2000-PROCESS-PANEL                           08670000
086800                                                                  08680000
086900         WHEN DP020-NEXT-ACT-RETURN                               08690000
087000             PERFORM 2050-DELETE-LIST-QUEUE                       08700000
087100             PERFORM 4000-BUILD-INITIAL-PANEL                     08710000
087200                                                                  08720000
087300         WHEN OTHER                                               08730000
087400             SET DP013-LOGIC-ABEND TO TRUE                        08740000
087500             SET DP013-NO-ROLLBACK TO TRUE                        08750000
087600             MOVE '1000-CONTROL-PROCESSING'                       08760000
087700                                   TO DP013-PARAGRAPH             08770000
087800             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    08780000
087900                                   TO DP013-MESSAGE-TEXT(1)       08790000
088000             PERFORM DP013-0000-PROCESS-ABEND                     08800000
088100     END-EVALUATE.                                                08810000
088200                                                                  08820000
088300/                                                                 08830000
088400*----------------------------------------------------------------*08840000
088500* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *08850000
088600*----------------------------------------------------------------*08860000
088700                                                                  08870000
088800 1100-PROCESS-INTER-APPL-COMM.                                    08880000
088900                                                                  08890000
089000     SET PS-COMMAREA-VALID         TO TRUE.                       08900000
089100     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     08910000
089200                                                                  08920000
089300     EVALUATE DP020-INT-APPL-FORMAT-IND                           08930000
089400                                                                  08940000
089500         WHEN PC-INTER-APPL-CRIT-SPEC                             08950000
089600             IF  TR005-OPER-UNT-ID = ZEROES                       08960000
089700                  AND TR005-DEST-OPER-UNT-ID = ZEROES             08970000
089800                 MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER        08980000
089900                 SET PS-ERROR                                     08990000
090000                     PS-COMMAREA-NOT-VALID                        09000000
090100                     DP020-MSG-FATAL   TO TRUE                    09010000
090200             ELSE                                                 09020000
090300                 IF  PS-NO-ERROR                                  09030000
090400                 AND (TR005-CURR-YARD-LOC-ID  > SPACES            09040000
090500                  AND TR005-CURR-DOCK-AREA    > SPACES)           09050000
090600                 OR  (TR005-CURR-SPACE-LOC-ID > SPACES            09060000
090700                  AND TR005-CURR-DOCK-DOOR    > SPACES)           09070000
090800                     MOVE PC-TSYMSG-00643                         09080000
090900                                     TO DP020-MSG-NUMBER          09090000
091000                     SET PS-ERROR                                 09100000
091100                         PS-COMMAREA-NOT-VALID                    09110000
091200                         DP020-MSG-FATAL TO TRUE                  09120000
091300                 END-IF                                           09130000
091400                 IF  PS-NO-ERROR                                  09140000
091500                 AND TR005-DELIVERY-SCAC-CDE > SPACES             09150000
091600                 AND TR005-PRO-NBR-SCAC-CDE  > SPACES             09160000
091700                     MOVE PC-TSYMSG-00649                         09170000
091800                                     TO DP020-MSG-NUMBER          09180000
091900                     SET PS-ERROR                                 09190000
092000                         PS-COMMAREA-NOT-VALID                    09200000
092100                         DP020-MSG-FATAL TO TRUE                  09210000
092200                 END-IF                                           09220000
092300                 IF  PS-NO-ERROR                                  09230000
092400                     MOVE TR005-OPER-UNT-ID TO ASC-KEY-OPER-UNT-ID09240000
092500                     MOVE TR005-FCLTY-ID    TO ASC-KEY-FCLTY-ID   09250000
092600                     EVALUATE TRUE                                09260000
092700                       WHEN TR005-CURR-YARD-LOC-ID > SPACES       09270000
092800                            MOVE TR005-CURR-YARD-LOC-ID TO        09280000
092900                                 ASC-KEY-SUBAREA-OF-ID            09290000
093000                       WHEN TR005-CURR-DOCK-AREA > SPACES         09300000
093100                            MOVE TR005-CURR-DOCK-AREA TO          09310000
093200                                 ASC-KEY-SUBAREA-OF-ID            09320000
093300                     END-EVALUATE                                 09330000
093400                     EVALUATE TRUE                                09340000
093500                       WHEN TR005-CURR-SPACE-LOC-ID > SPACES      09350000
093600                            MOVE TR005-CURR-SPACE-LOC-ID TO       09360000
093700                                 ASC-KEY-FCLTY-AREA-ID            09370000
093800                       WHEN TR005-CURR-DOCK-DOOR > SPACES         09380000
093900                            MOVE TR005-CURR-DOCK-DOOR TO          09390000
094000                                 ASC-KEY-FCLTY-AREA-ID            09400000
094100                     END-EVALUATE                                 09410000
094200                     MOVE TR005-STATUS-IND-1                      09420000
094300                                      TO ASC-KEY-STATUS-IND-1     09430000
094400                     MOVE TR005-STATUS-IND-2                      09440000
094500                                      TO ASC-KEY-STATUS-IND-2     09450000
094600                     MOVE TR005-STATUS-IND-3                      09460000
094700                                      TO ASC-KEY-STATUS-IND-3     09470000
094800                     MOVE TR005-STATUS-IND-4                      09480000
094900                                      TO ASC-KEY-STATUS-IND-4     09490000
095000                     MOVE TR005-STATUS-IND-5                      09500000
095100                                      TO ASC-KEY-STATUS-IND-5     09510000
095200                     MOVE TR005-TRLR-STAT-FROM-DTE                09520000
095300                                 TO ASC-KEY-SCHD-FROM-DTE         09530000
095400                     MOVE TR005-TRLR-STAT-TO-DTE                  09540000
095500                                 TO ASC-KEY-SCHD-TO-DTE           09550000
095600                     MOVE TR005-USAGE-IND-1                       09560000
095700                                       TO ASC-KEY-USAGE-IND-1     09570000
095800                     MOVE TR005-USAGE-IND-2                       09580000
095900                                       TO ASC-KEY-USAGE-IND-2     09590000
096000                     MOVE TR005-USAGE-IND-3                       09600000
096100                                       TO ASC-KEY-USAGE-IND-3     09610000
096200                     MOVE TR005-DELIVERY-SCAC-CDE                 09620000
096300                                         TO ASC-KEY-OWNER-SCAC-ID 09630000
096400                     MOVE TR005-TRLR-NBR TO ASC-KEY-VEH-NBR       09640000
096500                     MOVE TR005-DEST-OPER-UNT-ID                  09650000
096600                                     TO ASC-KEY-DEST-OPER-UNT-ID  09660000
096700                     MOVE TR005-DEST-FCLTY-ID                     09670000
096800                                     TO ASC-KEY-DEST-FCLTY-ID     09680000
096900                 END-IF                                           09690000
097000             END-IF                                               09700000
097100                                                                  09710000
097200         WHEN PC-INTER-APPL-LIST                                  09720000
097300              SET ASC-USE-SELECTION-QUEUE                         09730000
097400                                   TO TRUE                        09740000
097500              MOVE TR007-NUMBER-OF-SELECTED-ITEMS                 09750000
097600                                   TO ASC-NUMBER-OF-SELECTED-ITEMS09760000
097700              MOVE TR007-NUMBER-OF-TS-ITEMS                       09770000
097800                                   TO ASC-NUMBER-OF-TS-ITEMS      09780000
097900              MOVE TR007-SEL-QUEUE-NAME                           09790000
098000                                   TO ASC-SEL-QUEUE-NAME-IN       09800000
098100              PERFORM 1120-PREPARE-LIST-ENTRY                     09810000
098200                                                                  09820000
098300     END-EVALUATE.                                                09830000
098400                                                                  09840000
098500*----------------------------------------------------------------*09850000
098600*  ENTRY IS FROM A LIST. GET THE KEYS FROM THE TEMP STORAGE      *09860000
098700*  QUEUE PASSED FROM THE LIST.                                   *09870000
098800*----------------------------------------------------------------*09880000
098900                                                                  09890000
099000 1120-PREPARE-LIST-ENTRY.                                         09900000
099100      MOVE TR006-MAX-ITEMS         TO ASC-SEL-SUB.                09910000
099200      MOVE ZERO                    TO ASC-SEL-ITEM.               09920000
099300      PERFORM 2300-GET-NEXT-RECORD.                               09930000
099400                                                                  09940000
099500/                                                                 09950000
099600*----------------------------------------------------------------*09960000
099700* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *09970000
099800* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *09980000
099900* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *09990000
100000* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *10000000
100100* FUNCTION KEYS CAN GET THIS FAR.                                *10010000
100200*----------------------------------------------------------------*10020000
100300                                                                  10030000
100400 2000-PROCESS-PANEL.                                              10040000
100500     EVALUATE TRUE                                                10050000
100600         WHEN DP020-SRC-AID = DP016-CLEAR                         10060000
100700             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    10070000
100800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   10080000
100900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10090000
101000                                                                  10100000
101100         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    10110000
101200             PERFORM 2050-DELETE-LIST-QUEUE                       10120000
101300             PERFORM 4000-BUILD-INITIAL-PANEL                     10130000
101400                                                                  10140000
101500         WHEN DP020-FK-DESELECT (DP020-SRC-AID)                   10150000
101600             PERFORM 2140-DESELECT-ALL-ITEMS                      10160000
101700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10170000
101800                                                                  10180000
101900         WHEN DP020-FK-SELECT-ALL (DP020-SRC-AID)                 10190000
102000              PERFORM 2150-SELECT-ALL-ITEMS                       10200000
102100              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                10210000
102200                                                                  10220000
102300         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             10230000
102400             IF ASC-USE-SELECTION-QUEUE                           10240000
102500                 PERFORM 6200-DEL-LIST-QUEUE                      10250000
102600                 PERFORM 2300-GET-NEXT-RECORD                     10260000
102700                 PERFORM 4000-BUILD-INITIAL-PANEL                 10270000
102800                 PERFORM 3200-RESET-ATTRIBUTES                    10280000
102900             ELSE                                                 10290000
103000*                --- BOTTOM OF LIST ---                           10300000
103100                 MOVE PC-TSYMSG-00070                             10310000
103200                                   TO DP020-MSG-NUMBER            10320000
103300                 SET DP020-MSG-INFORMATIONAL                      10330000
103400                                   TO TRUE                        10340000
103500             END-IF                                               10350000
103600                                                                  10360000
103700         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             10370000
103800             IF ASC-USE-SELECTION-QUEUE                           10380000
103900                 PERFORM 6200-DEL-LIST-QUEUE                      10390000
104000                 PERFORM 2310-GET-PREV-RECORD                     10400000
104100                 PERFORM 4000-BUILD-INITIAL-PANEL                 10410000
104200                 PERFORM 3200-RESET-ATTRIBUTES                    10420000
104300             ELSE                                                 10430000
104400*                --- TOP OF LIST ---                              10440000
104500                 MOVE PC-TSYMSG-00069                             10450000
104600                                   TO DP020-MSG-NUMBER            10460000
104700                 SET DP020-MSG-INFORMATIONAL                      10470000
104800                                   TO TRUE                        10480000
104900             END-IF                                               10490000
105000         WHEN OTHER                                               10500000
105100             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 10510000
105200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   10520000
105300             IF  PS-NO-ERROR                                      10530000
105400                 SET DP030-CONTINUE-GO TO TRUE                    10540000
105500                 PERFORM 2100-CHECK-FUNCTION-KEY                  10550000
105600             ELSE                                                 10560000
105700                 SET DP030-OVERRIDE-GO TO TRUE                    10570000
105800             END-IF                                               10580000
105900     END-EVALUATE.                                                10590000
106000                                                                  10600000
106100/                                                                 10610000
106200*----------------------------------------------------------------*10620000
106300*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *10630000
106400*----------------------------------------------------------------*10640000
106500 2050-DELETE-LIST-QUEUE.                                          10650000
106600                                                                  10660000
106700     EXEC CICS                                                    10670000
106800         DELETEQ TS                                               10680000
106900           QUEUE (ASC-LIST-QUEUE-NAME)                            10690000
107000            RESP (PV-CICS-RESP)                                   10700000
107100     END-EXEC.                                                    10710000
107200                                                                  10720000
107300     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       10730000
107400        (PV-CICS-RESP = DFHRESP(QIDERR))                          10740000
107500         CONTINUE                                                 10750000
107600     ELSE                                                         10760000
107700         SET DP013-CICS-ABEND      TO TRUE                        10770000
107800         SET DP013-NO-ROLLBACK     TO TRUE                        10780000
107900                                                                  10790000
108000         MOVE '2050-DELETE-LIST-QUEUE'                            10800000
108100                                   TO DP013-PARAGRAPH             10810000
108200         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    10820000
108300                                   TO DP013-MESSAGE-TEXT (1)      10830000
108400         PERFORM DP013-0000-PROCESS-ABEND                         10840000
108500     END-IF.                                                      10850000
108600                                                                  10860000
108700     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  10870000
108800                                                                  10880000
108900/                                                                 10890000
109000*----------------------------------------------------------------*10900000
109100* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*10910000
109200* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *10920000
109300* CICS ARCHITECTURE API.                                         *10930000
109400*----------------------------------------------------------------*10940000
109500 2100-CHECK-FUNCTION-KEY.                                         10950000
109600                                                                  10960000
109700     EVALUATE TRUE                                                10970000
109800         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 10980000
109900             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              10990000
110000                 INITIALIZE TR007-INTER-APPL-COMMAREA             11000000
110100                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                11010000
110200                             TO TR007-NUMBER-OF-SELECTED-ITEMS    11020000
110300                 MOVE ASC-KEY-OPER-UNT-ID                         11030000
110400                                   TO TR007-OPER-UNT-ID           11040000
110500                 MOVE ASC-KEY-FCLTY-ID                            11050000
110600                                   TO TR007-FCLTY-ID              11060000
110700                 PERFORM 5000-PREPARE-SEL-QUEUE                   11070000
110800             ELSE                                                 11080000
110900                 SET DP030-OVERRIDE-GO                            11090000
111000                                   TO TRUE                        11100000
111100                 MOVE PC-TSYMSG-00057                             11110000
111200                                   TO DP020-MSG-NUMBER            11120000
111300                 SET DP020-MSG-WARNING                            11130000
111400                                   TO TRUE                        11140000
111500             END-IF                                               11150000
111600                                                                  11160000
111700         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  11170000
111800             MOVE +1               TO PV-TOP-ITEM                 11180000
111900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11190000
112000             PERFORM 3200-RESET-ATTRIBUTES                        11200000
112100                                                                  11210000
112200         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   11220000
112300             PERFORM 2110-BROWSE-BACKWARD                         11230000
112400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11240000
112500             PERFORM 3200-RESET-ATTRIBUTES                        11250000
112600                                                                  11260000
112700         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   11270000
112800             PERFORM 2120-BROWSE-FORWARD                          11280000
112900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11290000
113000             PERFORM 3200-RESET-ATTRIBUTES                        11300000
113100                                                                  11310000
113200         WHEN DP020-SRC-AID = DP016-ENTER                         11320000
113300             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   11330000
113400             IF  PS-ERROR                                         11340000
113500                 CONTINUE                                         11350000
113600             ELSE                                                 11360000
113700                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             11370000
113800             END-IF                                               11380000
113900                                                                  11390000
114000         WHEN OTHER                                               11400000
114100             SET DP013-NO-ROLLBACK                                11410000
114200                 DP013-XCTL-DISPLAY-RESTART                       11420000
114300                 DP013-CICS-ABEND  TO TRUE                        11430000
114400             MOVE '2100-CHECK-FUNCTION-KEY'                       11440000
114500                                   TO DP013-PARAGRAPH             11450000
114600             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      11460000
114700                                   TO DP013-MESSAGE-TEXT (1)      11470000
114800             PERFORM DP013-0000-PROCESS-ABEND                     11480000
114900     END-EVALUATE.                                                11490000
115000                                                                  11500000
115100/                                                                 11510000
115200*----------------------------------------------------------------*11520000
115300*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *11530000
115400*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *11540000
115500*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *11550000
115600*    MESSAGE.                                                    *11560000
115700*----------------------------------------------------------------*11570000
115800                                                                  11580000
115900 2110-BROWSE-BACKWARD.                                            11590000
116000                                                                  11600000
116100     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    11610000
116200         GIVING PV-TOP-ITEM.                                      11620000
116300                                                                  11630000
116400     IF  ((PV-TOP-ITEM < +1)                                      11640000
116500       OR (PV-TOP-ITEM = +1))                                     11650000
116600         MOVE +1                   TO PV-TOP-ITEM                 11660000
116700*        -- TOP OF LIST --                                        11670000
116800         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            11680000
116900         SET DP020-MSG-INFORMATIONAL                              11690000
117000                                   TO TRUE                        11700000
117100     END-IF.                                                      11710000
117200                                                                  11720000
117300/                                                                 11730000
117400*----------------------------------------------------------------*11740000
117500*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *11750000
117600*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *11760000
117700*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *11770000
117800*----------------------------------------------------------------*11780000
117900                                                                  11790000
118000 2120-BROWSE-FORWARD.                                             11800000
118100                                                                  11810000
118200     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              11820000
118300         GIVING PV-TOP-ITEM.                                      11830000
118400                                                                  11840000
118500     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   11850000
118600         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            11860000
118700                                   TO PV-TOP-ITEM                 11870000
118800*        -- BOTTOM OF LIST --                                     11880000
118900         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            11890000
119000         SET DP020-MSG-INFORMATIONAL                              11900000
119100                                   TO TRUE                        11910000
119200     ELSE                                                         11920000
119300         COMPUTE PV-BOTTOM-ITEM =                                 11930000
119400             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 11940000
119500         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            11950000
119600*            -- BOTTOM OF LIST --                                 11960000
119700             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            11970000
119800             SET DP020-MSG-INFORMATIONAL                          11980000
119900                                   TO TRUE                        11990000
120000         END-IF                                                   12000000
120100     END-IF.                                                      12010000
120200                                                                  12020000
120300/                                                                 12030000
120400*----------------------------------------------------------------*12040000
120500*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *12050000
120600*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *12060000
120700*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *12070000
120800*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *12080000
120900*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *12090000
121000*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *12100000
121100*----------------------------------------------------------------*12110000
121200                                                                  12120000
121300 2130-CHECK-FOR-JUMP-BROWSE.                                      12130000
121400                                                                  12140000
121500     SET PS-NO-ERROR               TO TRUE.                       12150000
121600     IF (ASC-START-ITEM-REQUEST = SPACE)                          12160000
121700         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            12170000
121800                                   TO PV-TOP-ITEM                 12180000
121900     ELSE                                                         12190000
122000         MOVE ASC-START-ITEM-REQUEST                              12200000
122100                                   TO DP010I-UNEDITED-FIELD       12210000
122200         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       12220000
122300         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     12230000
122400         SET DP010I-NEGATIVE-NOT-ALLOWED                          12240000
122500                                   TO TRUE                        12250000
122600         CALL DP010I-NUMERIC-EDIT-ROUTINE                         12260014
122610              USING DP010I-NUMERIC-EDIT-AREA                      12261014
122700                                                                  12270000
122800         IF  NOT DP010I-ERROR-DETECTED                            12280000
122900             MOVE DP010I-NUMERIC-FIELD                            12290000
123000                                   TO ASC-START-ITEM-REQUEST-N    12300000
123100             IF  ASC-START-ITEM-REQUEST-N > ZERO                  12310000
123200                 IF  ASC-START-ITEM-REQUEST-N >                   12320000
123300                                          ASC-NUMBER-OF-ITEMS-READ12330000
123400                     MOVE SPACE TO ASC-START-ITEM-REQUEST         12340000
123500                     COMPUTE PV-TOP-ITEM =                        12350000
123600                             ASC-NUMBER-OF-ITEMS-READ             12360000
123700                             - PC-ITEMS-PER-PANEL + 1             12370000
123800                     IF  PV-TOP-ITEM < +1                         12380000
123900                         MOVE +1   TO PV-TOP-ITEM                 12390000
124000                         MOVE PC-TSYMSG-00070                     12400000
124100                                   TO DP020-MSG-NUMBER            12410000
124200                         SET DP020-MSG-INFORMATIONAL              12420000
124300                                   TO TRUE                        12430000
124400                     END-IF                                       12440000
124500                 ELSE                                             12450000
124600                     MOVE ASC-START-ITEM-REQUEST-N                12460000
124700                                   TO PV-TOP-ITEM                 12470000
124800                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      12480000
124900                     COMPUTE PV-BOTTOM-ITEM =                     12490000
125000                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     12500000
125100                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ12510000
125200*                        -- BOTTOM OF LIST --                     12520000
125300                         MOVE PC-TSYMSG-00070                     12530000
125400                                   TO DP020-MSG-NUMBER            12540000
125500                         SET DP020-MSG-INFORMATIONAL              12550000
125600                                   TO TRUE                        12560000
125700                     END-IF                                       12570000
125800                 END-IF                                           12580000
125900             ELSE                                                 12590000
126000*                --- VALUE OUT OF RANGE ----                      12600000
126100                 MOVE PC-TSYMSG-00101                             12610000
126200                                   TO DP020-MSG-NUMBER            12620000
126300                 MOVE -1           TO ASTRTITL                    12630000
126400                 SET DP030-SET-CURSOR-APPL-1                      12640000
126500                                   TO TRUE                        12650000
126600                 MOVE DP015-REVERSE                               12660000
126700                                   TO ASTRTITH                    12670000
126800                 MOVE DP015-RED    TO ASTRTITC                    12680000
126900                 MOVE DP015-UNP-NUM-BRT-MDT                       12690000
127000                                   TO ASTRTITA                    12700000
127100                 SET DP020-MSG-FATAL                              12710000
127200                                   TO TRUE                        12720000
127300                 SET PS-ERROR      TO TRUE                        12730000
127400             END-IF                                               12740000
127500                                                                  12750000
127600         ELSE                                                     12760000
127700             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            12770000
127800             MOVE -1               TO ASTRTITL                    12780000
127900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  12790000
128000             MOVE DP015-REVERSE    TO ASTRTITH                    12800000
128100             MOVE DP015-RED        TO ASTRTITC                    12810000
128200             MOVE DP015-UNP-NUM-BRT-MDT                           12820000
128300                                   TO ASTRTITA                    12830000
128400             SET DP020-MSG-FATAL   TO TRUE                        12840000
128500             SET PS-ERROR          TO TRUE                        12850000
128600         END-IF                                                   12860000
128700     END-IF.                                                      12870000
128800                                                                  12880000
128900/                                                                 12890000
129000*----------------------------------------------------------------*12900000
129100*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *12910000
129200*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *12920000
129300*----------------------------------------------------------------*12930000
129400 2140-DESELECT-ALL-ITEMS.                                         12940000
129500                                                                  12950000
129600     MOVE +1                       TO ASC-BLK-SUB.                12960000
129700                                                                  12970000
129800     PERFORM 2141-CLEAR-SELECTED-INDS                             12980000
129900         VARYING ASC-ITEM-SUB                                     12990000
130000         FROM 1 BY 1                                              13000000
130100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13010000
130200                                                                  13020000
130300     ADD +1                        TO ASC-BLK-SUB.                13030000
130400                                                                  13040000
130500     PERFORM 2141-CLEAR-SELECTED-INDS                             13050000
130600         VARYING ASC-ITEM-SUB                                     13060000
130700         FROM 1 BY 1                                              13070000
130800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13080000
130900                                                                  13090000
131000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               13100000
131100                                   TO PV-LIST-ITEM-NUMBER.        13110000
131200                                                                  13120000
131300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            13130000
131400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    13140000
131500                                                                  13150000
131600     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     13160000
131700        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      13170000
131800         MOVE +1                   TO ASC-BLK-SUB                 13180000
131900                                                                  13190000
132000         PERFORM 5100-WRITE-TEMP-STORAGE                          13200000
132100                                                                  13210000
132200         MOVE +1                   TO PV-BLOCK-NUMBER             13220000
132300                                                                  13230000
132400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         13240000
132500             PV-FIRST-BLOCK-IN-ARRAY - 1                          13250000
132600                                                                  13260000
132700         PERFORM                                                  13270000
132800             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       13280000
132900                                                                  13290000
133000             PERFORM 4410-READ-TEMP-STORAGE                       13300000
133100                                                                  13310000
133200             PERFORM 2141-CLEAR-SELECTED-INDS                     13320000
133300                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 13330000
133400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13340000
133500                                                                  13350000
133600             PERFORM 5100-WRITE-TEMP-STORAGE                      13360000
133700                                                                  13370000
133800             ADD +1                TO PV-BLOCK-NUMBER             13380000
133900                                                                  13390000
134000         END-PERFORM                                              13400000
134100                                                                  13410000
134200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         13420000
134300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     13430000
134400                                                                  13440000
134500         PERFORM                                                  13450000
134600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       13460000
134700                   ASC-HIGHEST-BLOCK-WRITTEN                      13470000
134800                                                                  13480000
134900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          13490000
135000                                   TO PV-BLOCK-NUMBER             13500000
135100                                                                  13510000
135200             PERFORM 4410-READ-TEMP-STORAGE                       13520000
135300                                                                  13530000
135400             PERFORM 2141-CLEAR-SELECTED-INDS                     13540000
135500                 VARYING ASC-ITEM-SUB                             13550000
135600                 FROM 1 BY 1                                      13560000
135700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13570000
135800                                                                  13580000
135900             PERFORM 5100-WRITE-TEMP-STORAGE                      13590000
136000                                                                  13600000
136100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      13610000
136200                                                                  13620000
136300         END-PERFORM                                              13630000
136400                                                                  13640000
136500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             13650000
136600                                   TO PV-BLOCK-NUMBER             13660000
136700                                                                  13670000
136800         PERFORM 4410-READ-TEMP-STORAGE                           13680000
136900     END-IF.                                                      13690000
137000                                                                  13700000
137100                                                                  13710000
137200     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMS13720000
137300     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.13730000
137400     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  13740000
137500                                                                  13750000
137600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        13760000
137700                                                                  13770000
137800/                                                                 13780000
137900*----------------------------------------------------------------*13790000
138000*    MARK EACH ITEM AS BEING NOT SELECTED.                       *13800000
138100*----------------------------------------------------------------*13810000
138200                                                                  13820000
138300 2141-CLEAR-SELECTED-INDS.                                        13830000
138400                                                                  13840000
138500     IF  ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)          13850000
138600             NOT EQUAL ZERO                                       13860000
138700         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          13870000
138800             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          13880000
138900                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    13890000
139000                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  13900000
139100                                   TO TRUE                        13910000
139200         END-IF                                                   13920000
139300     END-IF.                                                      13930000
139400                                                                  13940000
139500/                                                                 13950000
139600*----------------------------------------------------------------*13960000
139700*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *13970000
139800*  FOR ALL ITEMS.                                                *13980000
139900*----------------------------------------------------------------*13990000
140000                                                                  14000000
140100 2150-SELECT-ALL-ITEMS.                                           14010000
140200                                                                  14020000
140300     MOVE +1                       TO ASC-BLK-SUB.                14030000
140400                                                                  14040000
140500     PERFORM 2151-SET-SELECTED-INDS                               14050000
140600         VARYING ASC-ITEM-SUB                                     14060000
140700         FROM 1 BY 1                                              14070000
140800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14080000
140900                                                                  14090000
141000     ADD +1                        TO ASC-BLK-SUB.                14100000
141100                                                                  14110000
141200     PERFORM 2151-SET-SELECTED-INDS                               14120000
141300         VARYING ASC-ITEM-SUB                                     14130000
141400         FROM 1 BY 1                                              14140000
141500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14150000
141600                                                                  14160000
141700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               14170000
141800                                   TO PV-LIST-ITEM-NUMBER.        14180000
141900                                                                  14190000
142000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            14200000
142100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    14210000
142200                                                                  14220000
142300     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     14230000
142400        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    14240000
142500         MOVE +1                   TO ASC-BLK-SUB                 14250000
142600                                                                  14260000
142700         PERFORM 5100-WRITE-TEMP-STORAGE                          14270000
142800                                                                  14280000
142900         MOVE +1                   TO PV-BLOCK-NUMBER             14290000
143000                                                                  14300000
143100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         14310000
143200             PV-FIRST-BLOCK-IN-ARRAY - 1                          14320000
143300                                                                  14330000
143400         PERFORM                                                  14340000
143500             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       14350000
143600                                                                  14360000
143700             PERFORM 4410-READ-TEMP-STORAGE                       14370000
143800                                                                  14380000
143900             PERFORM 2151-SET-SELECTED-INDS                       14390000
144000                 VARYING ASC-ITEM-SUB                             14400000
144100                 FROM 1 BY 1                                      14410000
144200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14420000
144300                                                                  14430000
144400             PERFORM 5100-WRITE-TEMP-STORAGE                      14440000
144500                                                                  14450000
144600             ADD +1                TO PV-BLOCK-NUMBER             14460000
144700         END-PERFORM                                              14470000
144800                                                                  14480000
144900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         14490000
145000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     14500000
145100                                                                  14510000
145200         PERFORM                                                  14520000
145300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       14530000
145400                   ASC-HIGHEST-BLOCK-WRITTEN                      14540000
145500                                                                  14550000
145600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          14560000
145700                                   TO PV-BLOCK-NUMBER             14570000
145800                                                                  14580000
145900             PERFORM 4410-READ-TEMP-STORAGE                       14590000
146000                                                                  14600000
146100             PERFORM 2151-SET-SELECTED-INDS                       14610000
146200                 VARYING ASC-ITEM-SUB                             14620000
146300                 FROM 1 BY 1                                      14630000
146400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14640000
146500                                                                  14650000
146600             PERFORM 5100-WRITE-TEMP-STORAGE                      14660000
146700                                                                  14670000
146800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      14680000
146900         END-PERFORM                                              14690000
147000                                                                  14700000
147100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             14710000
147200                                   TO PV-BLOCK-NUMBER             14720000
147300                                                                  14730000
147400         PERFORM 4410-READ-TEMP-STORAGE                           14740000
147500     END-IF.                                                      14750000
147600                                                                  14760000
147700     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             14770000
147800          ASC-NUMBER-OF-SELECTED-ITEMS.                           14780000
147900                                                                  14790000
148000     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        14800000
148100                                                                  14810000
148200/                                                                 14820000
148300*----------------------------------------------------------------*14830000
148400*    MARK EACH ITEM AS BEING SELECTED.                           *14840000
148500*----------------------------------------------------------------*14850000
148600                                                                  14860000
148700 2151-SET-SELECTED-INDS.                                          14870000
148800                                                                  14880000
148900     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           14890000
149000             NOT EQUAL ZERO                                       14900000
149100         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             14910000
149200             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             14920000
149300                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        14930000
149400                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  14940000
149500                                   TO TRUE                        14950000
149600         END-IF                                                   14960000
149700     END-IF.                                                      14970000
149800                                                                  14980000
149900/                                                                 14990000
150000*----------------------------------------------------------------*15000000
150100*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *15010000
150200*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *15020000
150300*----------------------------------------------------------------*15030000
150400 2200-MOVE-SCREEN-TO-COMMAREA.                                    15040000
150500                                                                  15050000
150600     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             15060000
150700     MOVE +1                       TO PV-SUB.                     15070000
150800                                                                  15080000
150900     PERFORM 3100-SET-SUBSCRIPTS.                                 15090000
151000                                                                  15100000
151100     IF  ASTRTITL > ZERO                                          15110000
151200         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      15120000
151300     ELSE                                                         15130000
151400         IF  ASTRTITF = DP015-ERASE-EOF                           15140000
151500             INITIALIZE ASC-START-ITEM-REQUEST                    15150000
151600         END-IF                                                   15160000
151700     END-IF.                                                      15170000
151800                                                                  15180000
151900     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          15190000
152000         VARYING PV-SUB                                           15200000
152100         FROM 1 BY 1                                              15210000
152200         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      15220000
152300                                                                  15230000
152400/                                                                 15240000
152500*----------------------------------------------------------------*15250000
152600*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *15260000
152700*----------------------------------------------------------------*15270000
152800 2210-MOVE-LINES-TO-COMMAREA.                                     15280000
152900                                                                  15290000
153000     IF  MR-SELECTL (PV-SUB) > ZERO                               15300000
153100         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     15310000
153200                                   TO TRUE                        15320000
153300         MOVE MR-SELECT (PV-SUB)   TO ASC-TEMP-SELECTED-SW        15330000
153400                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      15340000
153500     ELSE                                                         15350000
153600         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                15360000
153700             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         15370000
153800             MOVE SPACE            TO ASC-TEMP-SELECTED-SW        15380000
153900                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      15390000
154000         END-IF                                                   15400000
154100     END-IF.                                                      15410000
154200                                                                  15420000
154300     ADD +1                        TO ASC-ITEM-SUB.               15430000
154400                                                                  15440000
154500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        15450000
154600         ADD +1                    TO ASC-BLK-SUB                 15460000
154700         MOVE +1                   TO ASC-ITEM-SUB                15470000
154800     END-IF.                                                      15480000
154900                                                                  15490000
155000/                                                                 15500000
155100******************************************************************15510000
155200* GET THE KEYS OF THE NEXT SELECTED OBJECT FROM THE              *15520000
155300* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *15530000
155400******************************************************************15540000
155500 2300-GET-NEXT-RECORD.                                            15550000
155600                                                                  15560000
155700     ADD +1                        TO ASC-SEL-SUB.                15570000
155800     IF ASC-SEL-SUB > TR006-MAX-ITEMS                             15580000
155900         ADD +1                    TO ASC-SEL-ITEM                15590000
156000         MOVE +1                   TO ASC-SEL-SUB                 15600000
156100     END-IF.                                                      15610000
156200     IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                 15620000
156300         PERFORM 9100-READ-SEL-QUEUE                              15630000
156400         IF TR006-ITEM (ASC-SEL-SUB) > ZERO                       15640000
156500             MOVE TR006-OPER-UNT-ID (ASC-SEL-SUB)                 15650000
156600                                   TO ASC-KEY-OPER-UNT-ID         15660000
156700             MOVE TR006-FCLTY-ID (ASC-SEL-SUB)                    15670000
156800                                   TO ASC-KEY-FCLTY-ID            15680000
156900             SET TR006-INQ (ASC-SEL-SUB)                          15690000
157000                                   TO TRUE                        15700000
157100             PERFORM 9200-REWRITE-LIST-QUEUE                      15710000
157200         ELSE                                                     15720000
157300             SUBTRACT +1 FROM ASC-SEL-SUB                         15730000
157400*            --- BOTTOM OF LIST ---                               15740000
157500             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            15750000
157600             SET DP020-MSG-INFORMATIONAL                          15760000
157700                                   TO TRUE                        15770000
157800         END-IF                                                   15780000
157900     ELSE                                                         15790000
158000         SUBTRACT +1 FROM ASC-SEL-ITEM                            15800000
158100         MOVE TR006-MAX-ITEMS      TO ASC-SEL-SUB                 15810000
158200         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            15820000
158300         SET DP020-MSG-INFORMATIONAL                              15830000
158400                                   TO TRUE                        15840000
158500     END-IF.                                                      15850000
158600                                                                  15860000
158700/                                                                 15870000
158800******************************************************************15880000
158900* GET THE KEYS OF THE PREVIOUS SELECTED OBJECT FROM THE          *15890000
159000* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *15900000
159100******************************************************************15910000
159200 2310-GET-PREV-RECORD.                                            15920000
159300                                                                  15930000
159400     SUBTRACT +1 FROM ASC-SEL-SUB.                                15940000
159500     IF ASC-SEL-SUB < +1                                          15950000
159600         SUBTRACT +1 FROM ASC-SEL-ITEM                            15960000
159700         MOVE TR006-MAX-ITEMS      TO ASC-SEL-SUB                 15970000
159800     END-IF.                                                      15980000
159900                                                                  15990000
160000     IF ASC-SEL-ITEM > ZERO                                       16000000
160100         PERFORM 9100-READ-SEL-QUEUE                              16010000
160200         MOVE TR006-OPER-UNT-ID (ASC-SEL-SUB)                     16020000
160300                                   TO ASC-KEY-OPER-UNT-ID         16030000
160400         MOVE TR006-FCLTY-ID (ASC-SEL-SUB)                        16040000
160500                                   TO ASC-KEY-FCLTY-ID            16050000
160600     ELSE                                                         16060000
160700         MOVE +1                   TO ASC-SEL-ITEM                16070000
160800                                      ASC-SEL-SUB                 16080000
160900*        --- TOP OF LIST ---                                      16090000
161000         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            16100000
161100         SET DP020-MSG-INFORMATIONAL                              16110000
161200                                   TO TRUE                        16120000
161300     END-IF.                                                      16130000
161400                                                                  16140000
161500/                                                                 16150000
161600*----------------------------------------------------------------*16160000
161700*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *16170000
161800*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *16180000
161900*----------------------------------------------------------------*16190000
162000 3000-EDIT-DATA-IN-COMMAREA.                                      16200000
162100                                                                  16210000
162200     SET PS-NO-ERROR               TO TRUE.                       16220000
162300                                                                  16230000
162400     PERFORM 3200-RESET-ATTRIBUTES.                               16240000
162500                                                                  16250000
162600     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     16260000
162700**                                                                16270000
162800* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              16280000
162900* EDITTING IS DONE FROM THE BOTTOM UP.                            16290000
163000**                                                                16300000
163100     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       16310000
163200         ASC-ITEMS-DISPLAYED - 1.                                 16320000
163300                                                                  16330000
163400     PERFORM 3100-SET-SUBSCRIPTS.                                 16340000
163500     PERFORM 3300-EDIT-SELECTIONS                                 16350000
163600         VARYING PV-SUB                                           16360000
163700         FROM PV-SUB BY -1                                        16370000
163800         UNTIL PV-SUB < +1                                        16380000
163900                                                                  16390000
164000     IF  PS-NO-ERROR                                              16400000
164100         PERFORM 3400-CHECK-RANGE-SEQUENCE                        16410000
164200     END-IF.                                                      16420000
164300                                                                  16430000
164400     IF  ((PS-NO-ERROR)                                           16440000
164500       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   16450000
164600       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    16460000
164700             PERFORM 3500-MARK-RANGE-AS-SELECTED                  16470000
164800     END-IF.                                                      16480000
164900                                                                  16490000
165000/                                                                 16500000
165100*----------------------------------------------------------------*16510000
165200*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *16520000
165300*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*16530000
165400*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *16540000
165500*                                                                *16550000
165600*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *16560000
165700*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *16570000
165800*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *16580000
165900*    US IN THE 2ND BLOCK OF THE ARRAY.                           *16590000
166000*----------------------------------------------------------------*16600000
166100                                                                  16610000
166200 3100-SET-SUBSCRIPTS.                                             16620000
166300                                                                  16630000
166400     COMPUTE ASC-ITEM-SUB =                                       16640000
166500         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        16650000
166600                                                                  16660000
166700     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         16670000
166800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            16680000
166900                                                                  16690000
167000         MOVE PC-MAX-BLOCKS-IN-ARRAY                              16700000
167100                                   TO ASC-BLK-SUB                 16710000
167200     ELSE                                                         16720000
167300         MOVE +1                   TO ASC-BLK-SUB                 16730000
167400     END-IF.                                                      16740000
167500                                                                  16750000
167600*----------------------------------------------------------------*16760000
167700*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *16770000
167800*----------------------------------------------------------------*16780000
167900                                                                  16790000
168000 3200-RESET-ATTRIBUTES.                                           16800000
168100                                                                  16810000
168200     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   16820000
168300     MOVE DP015-GREEN              TO ASTRTITC.                   16830000
168400     MOVE DP015-UNDERLINE          TO ASTRTITH.                   16840000
168500                                                                  16850000
168600     IF DP020-NEXT-ACT-RETURN                                     16860000
168700     OR DP020-NEXT-ACT-READ-MAP                                   16870000
168800        PERFORM                                                   16880000
168900            VARYING PV-SUB                                        16890000
169000            FROM 1 BY 1                                           16900000
169100            UNTIL PV-SUB > ASC-ITEMS-DISPLAYED                    16910000
169200            MOVE DP015-UNP-ALP-NOR-OFF                            16920000
169300                                      TO MR-SELECTA (PV-SUB)      16930000
169400            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      16940000
169500            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      16950000
169600        END-PERFORM                                               16960000
169700     ELSE                                                         16970000
169800        PERFORM                                                   16980000
169900            VARYING PV-SUB                                        16990000
170000            FROM 1 BY 1                                           17000000
170100            UNTIL PV-SUB > PC-ITEMS-PER-PANEL                     17010000
170200            MOVE DP015-UNP-ALP-NOR-OFF                            17020000
170300                                      TO MR-SELECTA (PV-SUB)      17030000
170400            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      17040000
170500            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      17050000
170600        END-PERFORM                                               17060000
170700     END-IF.                                                      17070000
170800                                                                  17080000
170900/                                                                 17090000
171000*----------------------------------------------------------------*17100000
171100*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *17110000
171200*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *17120000
171300*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *17130000
171400*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *17140000
171500*----------------------------------------------------------------*17150000
171600 3300-EDIT-SELECTIONS.                                            17160000
171700                                                                  17170000
171800     EVALUATE TRUE                                                17180000
171900         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     17190000
172000             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         17200000
172100                 CONTINUE                                         17210000
172200                                                                  17220000
172300         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         17230000
172400             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        17240000
172500                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS17250000
172600                 MOVE ASC-TEMP-SELECTED-SW                        17260000
172700                                     (ASC-BLK-SUB ASC-ITEM-SUB)   17270000
172800                                   TO ASC-SELECTED-SW             17280000
172900                                     (ASC-BLK-SUB ASC-ITEM-SUB)   17290000
173000             END-IF                                               17300000
173100                                                                  17310000
173200         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     17320000
173300                 = SPACE                                          17330000
173400             EVALUATE TRUE                                        17340000
173500                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       17350000
173600                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS17360000
173700                     MOVE SPACE    TO ASC-SELECTED-SW             17370000
173800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   17380000
173900                                                                  17390000
174000                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        17400000
174100                     MOVE ZERO     TO ASC-START-OF-SELECTED-RANGE 17410000
174200                     MOVE SPACE    TO ASC-SELECTED-SW             17420000
174300                                     (ASC-BLK-SUB ASC-ITEM-SUB)   17430000
174400                                                                  17440000
174500                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          17450000
174600                     MOVE ZERO     TO ASC-END-OF-SELECTED-RANGE   17460000
174700                     MOVE SPACE    TO ASC-SELECTED-SW             17470000
174800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   17480000
174900             END-EVALUATE                                         17490000
175000                                                                  17500000
175100         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           17510000
175200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            17520000
175300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    17530000
175400             END-IF                                               17540000
175500             PERFORM 3310-EDIT-RANGE                              17550000
175600                                                                  17560000
175700         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             17570000
175800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            17580000
175900                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    17590000
176000             END-IF                                               17600000
176100             PERFORM 3310-EDIT-RANGE                              17610000
176200                                                                  17620000
176300         WHEN OTHER                                               17630000
176400             MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER            17640000
176500             SET DP020-MSG-FATAL   TO TRUE                        17650000
176600             MOVE -1               TO MR-SELECTL (PV-SUB)         17660000
176700             SET DP030-SET-CURSOR-APPL-1                          17670000
176800                                   TO TRUE                        17680000
176900             MOVE DP015-RED        TO MR-SELECTC (PV-SUB)         17690000
177000             MOVE DP015-REVERSE    TO MR-SELECTH (PV-SUB)         17700000
177100             SET PS-ERROR          TO TRUE                        17710000
177200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            17720000
177300                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     17730000
177400                 MOVE SPACE        TO ASC-SELECTED-SW             17740000
177500                                     (ASC-BLK-SUB ASC-ITEM-SUB)   17750000
177600             END-IF                                               17760000
177700     END-EVALUATE.                                                17770000
177800                                                                  17780000
177900     SUBTRACT +1 FROM PV-ITEM-IN-USE.                             17790000
178000     SUBTRACT +1 FROM ASC-ITEM-SUB.                               17800000
178100                                                                  17810000
178200     IF  ASC-ITEM-SUB < 1                                         17820000
178300         SUBTRACT +1 FROM ASC-BLK-SUB                             17830000
178400         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                17840000
178500     END-IF.                                                      17850000
178600                                                                  17860000
178700*----------------------------------------------------------------*17870000
178800*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *17880000
178900*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *17890000
179000*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *17900000
179100*  THE ENDING.                                                   *17910000
179200*----------------------------------------------------------------*17920000
179300 3310-EDIT-RANGE.                                                 17930000
179400                                                                  17940000
179500     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                17950000
179600         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   17960000
179700             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)17970000
179800                                   TO ASC-SELECTED-SW             17980000
179900                                        (ASC-BLK-SUB ASC-ITEM-SUB)17990000
180000             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 18000000
180100         ELSE                                                     18010000
180200             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     18020000
180300                 CONTINUE                                         18030000
180400             ELSE                                                 18040000
180500*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        18050000
180600                 MOVE PC-TSYMSG-00054                             18060000
180700                                   TO DP020-MSG-NUMBER            18070000
180800                 SET DP020-MSG-FATAL                              18080000
180900                                   TO TRUE                        18090000
181000                 MOVE -1           TO MR-SELECTL (PV-SUB)         18100000
181100                 SET DP030-SET-CURSOR-APPL-1                      18110000
181200                                   TO TRUE                        18120000
181300                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         18130000
181400                 MOVE DP015-UNDERLINE                             18140000
181500                                   TO MR-SELECTH (PV-SUB)         18150000
181600                 SET PS-ERROR      TO TRUE                        18160000
181700             END-IF                                               18170000
181800         END-IF                                                   18180000
181900     ELSE                                                         18190000
182000         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     18200000
182100             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 18210000
182200                                   TO ASC-SELECTED-SW             18220000
182300                                     (ASC-BLK-SUB ASC-ITEM-SUB)   18230000
182400             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   18240000
182500         ELSE                                                     18250000
182600             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       18260000
182700                 CONTINUE                                         18270000
182800             ELSE                                                 18280000
182900*                -- ONLY ONE END-OF-RANGE ALLOWED --              18290000
183000                 MOVE PC-TSYMSG-00055                             18300000
183100                                   TO DP020-MSG-NUMBER            18310000
183200                 SET DP020-MSG-FATAL                              18320000
183300                                   TO TRUE                        18330000
183400                 MOVE -1           TO MR-SELECTL (PV-SUB)         18340000
183500                 SET DP030-SET-CURSOR-APPL-1                      18350000
183600                                   TO TRUE                        18360000
183700                 SET PS-ERROR      TO TRUE                        18370000
183800             END-IF                                               18380000
183900         END-IF                                                   18390000
184000     END-IF.                                                      18400000
184100                                                                  18410000
184200*----------------------------------------------------------------*18420000
184300*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *18430000
184400*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *18440000
184500*----------------------------------------------------------------*18450000
184600 3400-CHECK-RANGE-SEQUENCE.                                       18460000
184700                                                                  18470000
184800     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       18480000
184900       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      18490000
185000       AND  ASC-START-OF-SELECTED-RANGE >                         18500000
185100                                         ASC-END-OF-SELECTED-RANGE18510000
185200*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                18520000
185300         MOVE PC-TSYMSG-00052      TO DP020-MSG-NUMBER            18530000
185400         SET DP020-MSG-FATAL       TO TRUE                        18540000
185500         SET PS-ERROR              TO TRUE                        18550000
185600         PERFORM 3410-POSITION-AT-ERROR                           18560000
185700     END-IF.                                                      18570000
185800                                                                  18580000
185900*----------------------------------------------------------------*18590000
186000*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *18600000
186100*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *18610000
186200*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *18620000
186300*----------------------------------------------------------------*18630000
186400 3410-POSITION-AT-ERROR.                                          18640000
186500                                                                  18650000
186600     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       18660000
186700                                                                  18670000
186800     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 18680000
186900                    - PV-TOP-ITEM + 1.                            18690000
187000                                                                  18700000
187100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      18710000
187200         CONTINUE                                                 18720000
187300     ELSE                                                         18730000
187400         MOVE -1                   TO MR-SELECTL (PV-SUB)         18740000
187500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         18750000
187600         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         18760000
187700     END-IF.                                                      18770000
187800                                                                  18780000
187900     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   18790000
188000                    - PV-TOP-ITEM + 1.                            18800000
188100                                                                  18810000
188200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      18820000
188300         CONTINUE                                                 18830000
188400     ELSE                                                         18840000
188500         MOVE -1                   TO MR-SELECTL (PV-SUB)         18850000
188600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         18860000
188700         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         18870000
188800     END-IF.                                                      18880000
188900                                                                  18890000
189000/                                                                 18900000
189100*----------------------------------------------------------------*18910000
189200*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *18920000
189300*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *18930000
189400*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *18940000
189500*----------------------------------------------------------------*18950000
189600                                                                  18960000
189700 3500-MARK-RANGE-AS-SELECTED.                                     18970000
189800                                                                  18980000
189900     MOVE +1                       TO ASC-BLK-SUB.                18990000
190000                                                                  19000000
190100     PERFORM 3510-MARK-SELECTED-INDS                              19010000
190200         VARYING ASC-ITEM-SUB                                     19020000
190300         FROM 1 BY 1                                              19030000
190400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 19040000
190500                                                                  19050000
190600     ADD +1                        TO ASC-BLK-SUB.                19060000
190700                                                                  19070000
190800     PERFORM 3510-MARK-SELECTED-INDS                              19080000
190900         VARYING ASC-ITEM-SUB                                     19090000
191000         FROM 1 BY 1                                              19100000
191100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 19110000
191200                                                                  19120000
191300     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               19130000
191400                                   TO PV-LIST-ITEM-NUMBER.        19140000
191500                                                                  19150000
191600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            19160000
191700         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         19170000
191800               PC-ITEMS-PER-PANEL).                               19180000
191900                                                                  19190000
192000     MOVE ASC-START-OF-SELECTED-RANGE                             19200000
192100                                   TO PV-START-OF-SELECTED-RANGE. 19210000
192200                                                                  19220000
192300     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            19230000
192400         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  19240000
192500               PC-ITEMS-PER-PANEL).                               19250000
192600                                                                  19260000
192700     MOVE ASC-END-OF-SELECTED-RANGE                               19270000
192800                                   TO PV-END-OF-SELECTED-RANGE.   19280000
192900                                                                  19290000
193000     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             19300000
193100         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    19310000
193200               PC-ITEMS-PER-PANEL).                               19320000
193300                                                                  19330000
193400     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             19340000
193500         PV-FIRST-BLOCK-IN-ARRAY + 1.                             19350000
193600                                                                  19360000
193700     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    19370000
193800        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        19380000
193900         MOVE +1                   TO ASC-BLK-SUB                 19390000
194000         PERFORM 5100-WRITE-TEMP-STORAGE                          19400000
194100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         19410000
194200             PV-FIRST-BLOCK-IN-ARRAY - 1                          19420000
194300                                                                  19430000
194400         PERFORM                                                  19440000
194500             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      19450000
194600                   PV-PREV-BLOCK-IN-ARRAY                         19460000
194700             MOVE PV-FIRST-BLOCK-IN-RANGE                         19470000
194800                                   TO PV-BLOCK-NUMBER             19480000
194900             PERFORM 4410-READ-TEMP-STORAGE                       19490000
195000             PERFORM 3510-MARK-SELECTED-INDS                      19500000
195100                 VARYING ASC-ITEM-SUB                             19510000
195200                 FROM 1 BY 1                                      19520000
195300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          19530000
195400             PERFORM 5100-WRITE-TEMP-STORAGE                      19540000
195500             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     19550000
195600         END-PERFORM                                              19560000
195700                                                                  19570000
195800         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         19580000
195900             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     19590000
196000         PERFORM                                                  19600000
196100             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       19610000
196200                   PV-LAST-BLOCK-IN-RANGE                         19620000
196300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          19630000
196400                                   TO PV-BLOCK-NUMBER             19640000
196500             PERFORM 4410-READ-TEMP-STORAGE                       19650000
196600             PERFORM 3510-MARK-SELECTED-INDS                      19660000
196700                 VARYING ASC-ITEM-SUB                             19670000
196800                 FROM 1 BY 1                                      19680000
196900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          19690000
197000             PERFORM 5100-WRITE-TEMP-STORAGE                      19700000
197100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      19710000
197200         END-PERFORM                                              19720000
197300                                                                  19730000
197400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             19740000
197500                                   TO PV-BLOCK-NUMBER             19750000
197600         PERFORM 4410-READ-TEMP-STORAGE                           19760000
197700     END-IF.                                                      19770000
197800                                                                  19780000
197900     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 19790000
198000                                      ASC-END-OF-SELECTED-RANGE.  19800000
198100                                                                  19810000
198200/                                                                 19820000
198300*----------------------------------------------------------------*19830000
198400* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *19840000
198500*----------------------------------------------------------------*19850000
198600                                                                  19860000
198700 3510-MARK-SELECTED-INDS.                                         19870000
198800                                                                  19880000
198900     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) >         19890000
199000         ASC-START-OF-SELECTED-RANGE)                             19900000
199100     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =         19910000
199200         ASC-START-OF-SELECTED-RANGE)                             19920000
199300                                                                  19930000
199400         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) <     19940000
199500             ASC-END-OF-SELECTED-RANGE)                           19950000
199600         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =     19960000
199700             ASC-END-OF-SELECTED-RANGE)                           19970000
199800                                                                  19980000
199900             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          19990000
200000                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   20000000
200100                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   20010000
200200                                   TO TRUE                        20020000
200300                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              20030000
200400                                   TO TRUE                        20040000
200500                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS20050000
200600             END-IF                                               20060000
200700         END-IF                                                   20070000
200800     END-IF.                                                      20080000
200900                                                                  20090000
201000/                                                                 20100000
201100*----------------------------------------------------------------*20110000
201200*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *20120000
201300*    INITIALIZE ALL COUNTERS AND FLAGS.                          *20130000
201400*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *20140000
201500*    DISPLAY THE PANEL TO USER.                                  *20150000
201600*----------------------------------------------------------------*20160000
201700                                                                  20170000
201800 4000-BUILD-INITIAL-PANEL.                                        20180000
201900                                                                  20190000
202000     INITIALIZE ASC-BLOCK-ENTRIES (1)                             20200000
202100                ASC-BLOCK-ENTRIES (2).                            20210000
202200                                                                  20220000
202300     MOVE +1                       TO ASC-BLK-SUB.                20230000
202400                                                                  20240000
202500     SET ASC-ITEMS-LEFT-ON-DB      TO TRUE.                       20250000
202600                                                                  20260000
202700     MOVE +0                       TO ASC-ITEM-SUB                20270000
202800                                      ASC-NUMBER-OF-ITEMS-READ    20280000
202900                                      ASC-NUMBER-OF-SELECTED-ITEMS20290000
203000                                      ASC-HIGHEST-BLOCK-WRITTEN   20300000
203100                                      ASC-START-OF-SELECTED-RANGE 20310000
203200                                      ASC-END-OF-SELECTED-RANGE   20320000
203300                                      ASC-ITEM-AT-TOP-OF-PANEL.   20330000
203400                                                                  20340000
203500     PERFORM 4100-PREPARE-CURSOR.                                 20350000
203600                                                                  20360000
203700     PERFORM 4010-OPEN-CURSOR.                                    20370000
203800                                                                  20380000
203900     PERFORM 4300-READ-ITEMS-FROM-DB.                             20390000
204000                                                                  20400000
204100     PERFORM 4020-CLOSE-CURSOR.                                   20410000
204200                                                                  20420000
204300     MOVE +1                       TO PV-TOP-ITEM.                20430000
204400                                                                  20440000
204500     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          20450000
204600         SET DP020-NEXT-ACT-APPL-ERROR                            20460000
204700                                   TO TRUE                        20470000
204800         SET DP020-MSG-FATAL       TO TRUE                        20480000
204900         MOVE PC-TSYMSG-00050      TO DP020-MSG-NUMBER            20490000
205000     ELSE                                                         20500000
205100         MOVE -1                   TO MR-SELECTL (1)              20510000
205200         SET DP030-SET-CURSOR-APPL-1                              20520000
205300                                   TO TRUE                        20530000
205400         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     20540000
205500     END-IF.                                                      20550000
205600                                                                  20560000
205700/                                                                 20570000
205800*----------------------------------------------------------------*20580000
205900* OPEN THE APPROPRIATE CURSOR                                    *20590000
206000*----------------------------------------------------------------*20600000
206100                                                                  20610000
206200 4010-OPEN-CURSOR.                                                20620000
206300                                                                  20630023
206301*** TEST ONLY                                                     20630120
206302***  DISPLAY ' '                                                  20630223
206303***  DISPLAY ' TRKCS122: 4010-OPEN-CURSOR   '                     20630323
206304***                 '     ASC-CURSOR-SW:    ' ASC-CURSOR-SW       20630423
206305***  MOVE DK-OPER-UNT-ID-B    TO  PV-DISP-CSR-4B                  20630523
206306***  MOVE DK-OPER-UNT-ID-E    TO  PV-DISP-CSR-4E                  20630623
206307***  DISPLAY ' TRKCS122: DK-OPER-UNT-ID-B:  ' PV-DISP-CSR-4B      20630723
206308***                 '    DK-OPER-UNT-ID-E:  ' PV-DISP-CSR-4E      20630823
206309***  MOVE DK-FCLTY-ID-B       TO  PV-DISP-CSR-4B                  20630923
206310***  MOVE DK-FCLTY-ID-E       TO  PV-DISP-CSR-4E                  20631023
206330***  DISPLAY ' TRKCS122: DK-FCLTY-ID-B:     ' PV-DISP-CSR-4B      20633023
206340***                 '    DK-FCLTY-ID-E:     ' PV-DISP-CSR-4E      20634023
206350***  DISPLAY ' TRKCS122: DK-FCLTY-AREA-ID-B:' DK-FCLTY-AREA-ID-B  20635023
206360***                 '    DK-FCLTY-AREA-ID-E:' DK-FCLTY-AREA-ID-E  20636023
206370***  DISPLAY ' TRKCS122: DK-OWNER-SCAC-ID-B:' DK-OWNER-SCAC-ID-B  20637023
206380***                 '    DK-OWNER-SCAC-ID-E:' DK-OWNER-SCAC-ID-E  20638023
206391***  DISPLAY ' TRKCS122: DK-STATUS-IND-B:   ' DK-STATUS-IND-B     20639123
206392***                 '    DK-STATUS-IND-E:   ' DK-STATUS-IND-E     20639223
206393***  DISPLAY ' TRKCS122: DK-STATUS-IND:     ' DK-STATUS-IND-1     20639323
206394***                                       ':' DK-STATUS-IND-2     20639423
206395***                                       ':' DK-STATUS-IND-3     20639523
206396***                                       ':' DK-STATUS-IND-4     20639623
206397***                                       ':' DK-STATUS-IND-5     20639723
206398***  DISPLAY ' TRKCS122: DK-USAGE-IND-B:    ' DK-USAGE-IND-B      20639823
206399***                 '    DK-USAGE-IND-E:    ' DK-USAGE-IND-E      20639923
206400***  DISPLAY ' TRKCS122: DK-USAGE-IND:      ' DK-USAGE-IND-1      20640023
206401***                                       ':' DK-USAGE-IND-2      20640123
206402***                                       ':' DK-USAGE-IND-3      20640223
206403***  DISPLAY ' TRKCS122: DK-SCHD-FROM-DTE:  ' DK-SCHD-FROM-DTE    20640323
206404***                 '    DK-SCHD-TO-DTE:    ' DK-SCHD-TO-DTE      20640423
206409***  DISPLAY ' '                                                  20640923
206410*** TEST ONLY                                                     20641020
206411                                                                  20641120
206412                                                                  20641220
206420     PERFORM                                                      20642000
206500         WITH TEST AFTER                                          20650000
206600         VARYING PV-RETRY-COUNTER                                 20660000
206700         FROM 1 BY 1                                              20670000
206800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               20680000
206900            OR (SQLCODE = +0))                                    20690000
207000                                                                  20700000
207100         EVALUATE TRUE                                            20710000
207200            WHEN  ASC-DOCK-HIST-CURSOR                            20720000
207300                  EXEC SQL                                        20730000
207400                      OPEN DOCK-HST-CSR                           20740000
207500                  END-EXEC                                        20750000
207600                  MOVE 'OPEN DOCK-HST-CSR'                        20760000
207700                                   TO DP013-MESSAGE-TEXT (1)      20770000
207800                                                                  20780000
207900            WHEN  ASC-SCAC-HIST-CURSOR                            20790000
208000                  EXEC SQL                                        20800000
208100                      OPEN SCAC-HST-CSR                           20810000
208200                  END-EXEC                                        20820000
208300                                                                  20830000
208400            WHEN  ASC-TRLR-HIST-CURSOR                            20840000
208500                  EXEC SQL                                        20850000
208600                      OPEN TRLR-HST-CSR                           20860000
208700                  END-EXEC                                        20870000
208800                  MOVE 'OPEN TRLR-HST-CSR'                        20880000
208900                                   TO DP013-MESSAGE-TEXT (1)      20890000
209000                                                                  20900000
209100         END-EVALUATE                                             20910000
209200                                                                  20920000
209300         EVALUATE TRUE                                            20930000
209400             WHEN SQLCODE = +0                                    20940000
209500                  CONTINUE                                        20950000
209600             WHEN SQLCODE = -904                                  20960000
209700             WHEN SQLCODE = -913                                  20970000
209800                  CONTINUE                                        20980000
209900             WHEN SQLWARN0 NOT = SPACE                            20990000
210000             WHEN SQLCODE  NOT = +0                               21000000
210100                  MOVE '4010-OPEN-CURSOR'                         21010000
210200                                   TO DP013-PARAGRAPH             21020000
210500                  MOVE SQLCA       TO DP013-SQLCA                 21050000
210600                  MOVE 'TAUVHCL'   TO DP013-DB2-TABLE-NAME (1)    21060009
210700                  MOVE 'TVHTRIP'   TO DP013-DB2-TABLE-NAME (2)    21070009
210800                  SET DP013-DB2-ABEND                             21080000
210900                                   TO TRUE                        21090000
211000                  PERFORM DP013-0000-PROCESS-ABEND                21100000
211100         END-EVALUATE                                             21110000
211200     END-PERFORM.                                                 21120000
211300                                                                  21130000
211400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        21140000
211500         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             21150000
211600         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              21160000
211700                                   TO DP013-MESSAGE-TEXT (1)      21170000
211800         MOVE SQLCA                TO DP013-SQLCA                 21180000
211900         SET DP013-DB2-ABEND       TO TRUE                        21190000
212000         PERFORM DP013-0000-PROCESS-ABEND                         21200000
212100     END-IF.                                                      21210000
212200                                                                  21220000
212300/                                                                 21230000
212400*----------------------------------------------------------------*21240000
212500* CLOSE THE APPROPRIATE CURSOR                                   *21250000
212600*----------------------------------------------------------------*21260000
212700                                                                  21270000
212800 4020-CLOSE-CURSOR.                                               21280000
212900                                                                  21290000
213000     EVALUATE TRUE                                                21300000
213100        WHEN  ASC-DOCK-HIST-CURSOR                                21310000
213200              EXEC SQL                                            21320000
213300                  CLOSE DOCK-HST-CSR                              21330000
213400              END-EXEC                                            21340000
213500                                                                  21350000
213600        WHEN  ASC-SCAC-HIST-CURSOR                                21360000
213700              EXEC SQL                                            21370000
213800                  CLOSE SCAC-HST-CSR                              21380000
213900              END-EXEC                                            21390000
214000                                                                  21400000
214100        WHEN  ASC-TRLR-HIST-CURSOR                                21410000
214200              EXEC SQL                                            21420000
214300                  CLOSE TRLR-HST-CSR                              21430000
214400              END-EXEC                                            21440000
214500     END-EVALUATE.                                                21450000
214600                                                                  21460000
214700     EVALUATE TRUE                                                21470000
214800         WHEN SQLCODE = +0                                        21480000
214900              CONTINUE                                            21490000
215000         WHEN SQLWARN0 NOT = SPACE                                21500000
215100         WHEN SQLCODE  NOT = +0                                   21510000
215200              MOVE '4020-CLOSE-CURSOR'                            21520000
215300                                   TO DP013-PARAGRAPH             21530000
215400              MOVE 'CLOSE CURSOR'  TO DP013-MESSAGE-TEXT (1)      21540000
215500              MOVE SQLCA           TO DP013-SQLCA                 21550000
215600              MOVE 'TAUVHCL'       TO DP013-DB2-TABLE-NAME (1)    21560009
215700              MOVE 'TVHTRIP'       TO DP013-DB2-TABLE-NAME (2)    21570009
215800              SET DP013-DB2-ABEND  TO TRUE                        21580000
215900              PERFORM DP013-0000-PROCESS-ABEND                    21590000
216000     END-EVALUATE.                                                21600000
216100                                                                  21610000
216200/                                                                 21620000
216300*----------------------------------------------------------------*21630000
216400*    DEPENDING ON WHAT WAS PASSED IN THE COMMAREA, SETUP THE     *21640000
216500*    DB2 KEYS IN PREPARATION FOR THE OPEN CURSROR.               *21650000
216600*----------------------------------------------------------------*21660000
216700                                                                  21670000
216800 4100-PREPARE-CURSOR.                                             21680000
216900                                                                  21690000
217000     IF  ASC-KEY-OPER-UNT-ID > ZERO                               21700000
217100         MOVE ASC-KEY-OPER-UNT-ID     TO DK-OPER-UNT-ID-B         21710000
217200                                         DK-OPER-UNT-ID-E         21720000
217300     ELSE                                                         21730000
217400         MOVE ZEROS                   TO DK-OPER-UNT-ID-B         21740000
217500         MOVE 9999                    TO DK-OPER-UNT-ID-E         21750000
217600     END-IF.                                                      21760000
217700                                                                  21770000
217800     IF  ASC-KEY-FCLTY-ID > ZEROES                                21780000
217900         MOVE ASC-KEY-FCLTY-ID    TO DK-FCLTY-ID-B                21790000
218000                                     DK-FCLTY-ID-E                21800000
218100     ELSE                                                         21810000
218200         MOVE ZEROES              TO DK-FCLTY-ID-B                21820000
218300         MOVE 9999                TO DK-FCLTY-ID-E                21830000
218400     END-IF.                                                      21840000
218500                                                                  21850000
218600     IF  ASC-KEY-FCLTY-AREA-ID > SPACES                           21860000
218700         MOVE ASC-KEY-FCLTY-AREA-ID TO DK-FCLTY-AREA-ID-B         21870000
218800                                       DK-FCLTY-AREA-ID-E         21880000
218900     ELSE                                                         21890000
219000         MOVE SPACES                TO DK-FCLTY-AREA-ID-B         21900000
219100         MOVE '999999'              TO DK-FCLTY-AREA-ID-E         21910000
219200     END-IF.                                                      21920000
219300                                                                  21930000
219400     IF  ASC-KEY-SUBAREA-OF-ID > SPACES                           21940000
219500         MOVE ASC-KEY-SUBAREA-OF-ID TO DK-SUBAREA-OF-ID-B         21950000
219600                                       DK-SUBAREA-OF-ID-E         21960000
219700     ELSE                                                         21970000
219800         MOVE SPACES                TO DK-SUBAREA-OF-ID-B         21980000
219900         MOVE '999999'              TO DK-SUBAREA-OF-ID-E         21990000
220000     END-IF.                                                      22000000
220100                                                                  22010000
220200     IF  ASC-KEY-DEST-OPER-UNT-ID > ZEROS                         22020000
220300         MOVE ASC-KEY-DEST-OPER-UNT-ID  TO DK-DEST-OPER-UNT-ID-B  22030000
220400                                           DK-DEST-OPER-UNT-ID-E  22040000
220500     ELSE                                                         22050000
220600         MOVE ZEROS                     TO DK-DEST-OPER-UNT-ID-B  22060000
220700         MOVE 9999                      TO DK-DEST-OPER-UNT-ID-E  22070000
220800     END-IF.                                                      22080000
220900                                                                  22090000
221000     IF  ASC-KEY-DEST-FCLTY-ID > ZEROES                           22100000
221100         MOVE ASC-KEY-DEST-FCLTY-ID     TO DK-DEST-FCLTY-ID-B     22110000
221200                                           DK-DEST-FCLTY-ID-E     22120000
221300     ELSE                                                         22130000
221400         MOVE ZEROES                    TO DK-DEST-FCLTY-ID-B     22140000
221500         MOVE 9999                      TO DK-DEST-FCLTY-ID-E     22150000
221600     END-IF.                                                      22160000
221700                                                                  22170000
221800     IF  ASC-KEY-STATUS-IND-1 = SPACES                            22180000
221900     AND ASC-KEY-STATUS-IND-2 = SPACES                            22190000
222000     AND ASC-KEY-STATUS-IND-3 = SPACES                            22200000
222100     AND ASC-KEY-STATUS-IND-4 = SPACES                            22210000
222200     AND ASC-KEY-STATUS-IND-5 = SPACES                            22220000
222300         MOVE SPACES                  TO DK-STATUS-IND-B          22230000
222400         MOVE '99'                    TO DK-STATUS-IND-E          22240000
222500     ELSE                                                         22250000
222600         MOVE ASC-KEY-STATUS-IND-1    TO DK-STATUS-IND-1          22260000
222700         MOVE ASC-KEY-STATUS-IND-2    TO DK-STATUS-IND-2          22270000
222800         MOVE ASC-KEY-STATUS-IND-3    TO DK-STATUS-IND-3          22280000
222900         MOVE ASC-KEY-STATUS-IND-4    TO DK-STATUS-IND-4          22290000
223000         MOVE ASC-KEY-STATUS-IND-5    TO DK-STATUS-IND-5          22300000
223100         MOVE '99'                    TO DK-STATUS-IND-B          22310000
223200         MOVE '99'                    TO DK-STATUS-IND-E          22320000
223300     END-IF.                                                      22330000
223400                                                                  22340000
223500     IF  ASC-KEY-SCHD-FROM-DTE > SPACES                           22350000
223600         MOVE ASC-KEY-SCHD-FROM-DTE TO DK-SCHD-FROM-DTE           22360000
223700     ELSE                                                         22370000
223800         MOVE '0001-01-01'          TO DK-SCHD-FROM-DTE           22380000
223900     END-IF.                                                      22390000
224000                                                                  22400000
224100     IF  ASC-KEY-SCHD-TO-DTE > SPACES                             22410000
224200         MOVE ASC-KEY-SCHD-TO-DTE   TO DK-SCHD-TO-DTE             22420000
224300     ELSE                                                         22430000
224400         MOVE '9999-12-31'          TO DK-SCHD-TO-DTE             22440000
224500     END-IF.                                                      22450000
224600                                                                  22460000
224700     IF  ASC-KEY-USAGE-IND-1 = SPACES                             22470000
224800     AND ASC-KEY-USAGE-IND-2 = SPACES                             22480000
224900     AND ASC-KEY-USAGE-IND-3 = SPACES                             22490000
225000         MOVE SPACES                  TO DK-USAGE-IND-B           22500000
225100         MOVE '999'                   TO DK-USAGE-IND-E           22510000
225200     ELSE                                                         22520000
225300         MOVE ASC-KEY-USAGE-IND-1     TO DK-USAGE-IND-1           22530000
225400         MOVE ASC-KEY-USAGE-IND-2     TO DK-USAGE-IND-2           22540000
225500         MOVE ASC-KEY-USAGE-IND-3     TO DK-USAGE-IND-3           22550000
225600         MOVE '999'                   TO DK-USAGE-IND-B           22560000
225700         MOVE '999'                   TO DK-USAGE-IND-E           22570000
225800     END-IF.                                                      22580000
225900                                                                  22590000
226000     IF  ASC-KEY-OWNER-SCAC-ID > SPACES                           22600000
226100         MOVE ASC-KEY-OWNER-SCAC-ID TO DK-OWNER-SCAC-ID-B         22610000
226200                                       DK-OWNER-SCAC-ID-E         22620000
226300     ELSE                                                         22630000
226400         MOVE SPACES                TO DK-OWNER-SCAC-ID-B         22640000
226500         MOVE '9999'                TO DK-OWNER-SCAC-ID-E         22650000
226600     END-IF.                                                      22660000
226700                                                                  22670000
226800     IF  ASC-KEY-VEH-NBR > SPACES                                 22680000
226900         MOVE ASC-KEY-VEH-NBR       TO DK-VEH-NBR-B               22690000
227000                                       DK-VEH-NBR-E               22700000
227100     ELSE                                                         22710000
227200         MOVE SPACES                TO DK-VEH-NBR-B               22720000
227300         MOVE '9999999999'          TO DK-VEH-NBR-E               22730000
227400     END-IF.                                                      22740000
227500                                                                  22750000
227600*----------------------------------------------------------------*22760000
227700*    DECIDE WHICH OF THE THREE CURSORS WILL BE USED BASED ON     *22770000
227800*    CRITERIA PASSED.                                            *22780000
227900*----------------------------------------------------------------*22790000
228000                                                                  22800000
228100     EVALUATE TRUE                                                22810000
228200        WHEN  ASC-KEY-FCLTY-AREA-ID > SPACES                      22820000
228300        WHEN  ASC-KEY-SUBAREA-OF-ID > SPACES                      22830000
228400            SET ASC-DOCK-HIST-CURSOR TO TRUE                      22840000
228500                                                                  22850000
228600        WHEN (ASC-KEY-OWNER-SCAC-ID > SPACES                      22860000
228700          OR  ASC-KEY-VEH-NBR       > SPACES)                     22870000
228800            SET ASC-SCAC-HIST-CURSOR TO TRUE                      22880000
228900                                                                  22890000
229000        WHEN (ASC-KEY-STATUS-IND-1 > SPACES                       22900000
229100          OR  ASC-KEY-STATUS-IND-2 > SPACES                       22910000
229200          OR  ASC-KEY-STATUS-IND-3 > SPACES                       22920000
229300          OR  ASC-KEY-STATUS-IND-4 > SPACES                       22930000
229400          OR  ASC-KEY-STATUS-IND-5 > SPACES                       22940000
229500          OR  ASC-KEY-USAGE-IND-1  > SPACES                       22950000
229600          OR  ASC-KEY-USAGE-IND-2  > SPACES                       22960000
229700          OR  ASC-KEY-USAGE-IND-3  > SPACES)                      22970000
229800            SET ASC-TRLR-HIST-CURSOR TO TRUE                      22980000
229900                                                                  22990000
230000        WHEN OTHER                                                23000000
230100            SET ASC-TRLR-HIST-CURSOR TO TRUE                      23010000
230200     END-EVALUATE.                                                23020000
230300                                                                  23030000
230400/                                                                 23040000
230500*----------------------------------------------------------------*23050000
230600*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *23060000
230700*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *23070000
230800*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *23080000
230900*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *23090000
231000*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *23100000
231100*                                                                *23110000
231200*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *23120000
231300*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *23130000
231400*    UPON INITIALIZATION.                                        *23140000
231500*----------------------------------------------------------------*23150000
231600                                                                  23160000
231700 4300-READ-ITEMS-FROM-DB.                                         23170000
231800                                                                  23180000
231900     PERFORM                                                      23190000
232000         VARYING PV-READ-COUNT                                    23200000
232100         FROM 1 BY 1                                              23210000
232200         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    23220000
232300            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         23230000
232400                                                                  23240000
232500         PERFORM 4310-FETCH                                       23250000
232600                                                                  23260000
232700         IF  ASC-ITEMS-LEFT-ON-DB                                 23270000
232800             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                23280000
232900                 ADD +1            TO ASC-ITEM-SUB                23290000
233000             ELSE                                                 23300000
233100                 ADD +1            TO ASC-BLK-SUB                 23310000
233200                 MOVE +1           TO ASC-ITEM-SUB                23320000
233300                                                                  23330000
233400                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         23340000
233500                     MOVE +1       TO ASC-BLK-SUB                 23350000
233600                     SET ASC-BLOCK-MODIFIED (1)                   23360000
233700                                   TO TRUE                        23370000
233800                     PERFORM 5100-WRITE-TEMP-STORAGE              23380000
233900                     MOVE ASC-BLOCK-ENTRIES                       23390000
234000                               (PC-MAX-BLOCKS-IN-ARRAY)           23400000
234100                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 23410000
234200                     ADD +1        TO ASC-BLK-SUB                 23420000
234300                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   23430000
234400                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      23440000
234500                                   TO TRUE                        23450000
234600                 END-IF                                           23460000
234700             END-IF                                               23470000
234800             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    23480000
234900             MOVE ASC-NUMBER-OF-ITEMS-READ                        23490000
235000                                   TO ASC-LIST-ITEM-NUMBER        23500000
235100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23510000
235200             MOVE AUVHCL-OWNER-SCAC-ID                            23520000
235300                                   TO ASC-CARR-SCAC-CDE           23530000
235400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23540000
235500             MOVE AUVHCL-VEH-NBR   TO ASC-TRLR-NBR                23550000
235600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23560000
235700             MOVE VHTRIP-MANIFEST-NBR                             23570000
235800                                   TO ASC-MANIFEST                23580000
235900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23590000
236000             MOVE AUVHCL-USAGE-CDE TO ASC-USE                     23600000
236100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23610000
236200             MOVE AUVHCL-VEH-SIZE-CDE TO ASC-LGTH                 23620000
236300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23630000
236400             MOVE TRIPST-TRIP-STATUS-CDE                          23640000
236500                                   TO ASC-STAT                    23650000
236600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23660000
236700             MOVE TRIPST-STATUS-DTE       TO PV-STA-DATE          23670000
236800             MOVE TRIPST-STATUS-TME       TO PV-STA-TIME          23680000
236900             MOVE PV-STA-YY        TO PV-STA-DT-YY                23690007
236910             MOVE PV-STA-MM        TO PV-STA-DT-MM                23691007
237000             MOVE PV-STA-DD        TO PV-STA-DT-DD                23700000
237100             MOVE PV-STA-HH-MM     TO PV-STA-DT-HH-MM             23710000
237200             MOVE PV-STA-DTE-TME   TO ASC-STATUS-DTE-TME          23720000
237300                                  (ASC-BLK-SUB ASC-ITEM-SUB)      23730000
237400             MOVE PV-CSR-TRIP-ST-UID TO ASC-STATUS-USERID         23740016
237401                                  (ASC-BLK-SUB ASC-ITEM-SUB)      23740105
237410             MOVE TRIPST-OPER-UNT-ID                              23741003
237500                                   TO PV-DEST-OPER                23750000
237700             MOVE PV-DEST          TO ASC-DEST                    23770000
237800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23780000
237900             COMPUTE PV-TRIP-STOP-NBR = VHTRIP-PLND-TRIP-SEQ + 1  23790000
238000             MOVE PV-TRIP-STOP-NBR TO ASC-TRIP-STOP               23800000
238100                                (ASC-BLK-SUB ASC-ITEM-SUB)        23810000
238200             MOVE AUVHCL-CURR-OPER-UNT-ID                         23820000
238300                                   TO PV-CURR-OPER                23830000
238600             MOVE PV-CURR-LOC      TO ASC-CURR-LOC-1              23860000
238700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23870000
238800             MOVE AUVHCL-CURR-FAC-AREA-ID                         23880000
238900                                   TO ASC-CURR-LOC-2              23890000
239000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23900000
239100                                                                  23910000
239200             MOVE VHTRIP-TRIP-ID   TO ASC-TRIP-ID                 23920000
239300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23930000
239400                                      DK-TRIP-ID                  23940000
239500                                                                  23950000
240400             MOVE AUVHCL-CURR-OPER-UNT-ID                         24040000
240500                                   TO ASC-OPER-UNT-ID             24050000
240600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  24060000
240700             MOVE AUVHCL-CURR-FCLTY-ID                            24070000
240800                                   TO ASC-FCLTY-ID                24080000
240900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  24090000
241000         END-IF                                                   24100000
241100     END-PERFORM.                                                 24110000
241200                                                                  24120000
241300                                                                  24130000
241400     MOVE AUVHCL-CURR-FCLTY-ID     TO DK-FCLTY-ID-B.              24140000
241500     PERFORM 4320-GET-FCLTY-NAME.                                 24150000
241600                                                                  24160000
241700     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          24170000
241800         MOVE +1                   TO ASC-BLK-SUB                 24180000
241900         PERFORM 5100-WRITE-TEMP-STORAGE                          24190000
242000         ADD +1                    TO ASC-BLK-SUB                 24200000
242100         PERFORM 5100-WRITE-TEMP-STORAGE                          24210000
242200                                                                  24220000
242300         MOVE 1                    TO ASC-BLK-SUB                 24230000
242400                                      PV-BLOCK-NUMBER             24240000
242500         PERFORM 4410-READ-TEMP-STORAGE                           24250000
242600         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             24260000
242700             MOVE 2                TO ASC-BLK-SUB                 24270000
242800                                      PV-BLOCK-NUMBER             24280000
242900             PERFORM 4410-READ-TEMP-STORAGE                       24290000
243000         END-IF                                                   24300000
243100     END-IF.                                                      24310000
243200                                                                  24320000
243300/                                                                 24330000
243400*----------------------------------------------------------------*24340000
243500*    FETCH AN AUDIT VEHICLE ROW                                  *24350000
243600*----------------------------------------------------------------*24360000
243700                                                                  24370000
243800 4310-FETCH.                                                      24380000
243900                                                                  24390000
244000     EVALUATE TRUE                                                24400000
244100        WHEN  ASC-DOCK-HIST-CURSOR                                24410000
244200              EXEC SQL                                            24420000
244300                  FETCH DOCK-HST-CSR                              24430000
244400                   INTO :AUVHCL-CURR-STATUS-CDE                   24440000
244500                       ,:AUVHCL-CURR-STATUS-DTE                   24450000
244600                       ,:AUVHCL-CURR-STATUS-TME                   24460000
244700                       ,:VHTRIP-TRIP-ID                           24470000
244800                       ,:VHTRIP-OWNER-SCAC-ID                     24480000
244900                       ,:VHTRIP-VEH-NBR                           24490000
245000                       ,:VHTRIP-PLND-TRIP-SEQ                     24500000
245010                       ,:PV-CSR-TRIP-ST-CDE :DN-CSR-TRIP-ST-CDE   24501016
245020                       ,:PV-CSR-TRIP-ST-UID :DN-CSR-TRIP-ST-UID   24502016
245100              END-EXEC                                            24510000
245200                                                                  24520000
245300        WHEN  ASC-SCAC-HIST-CURSOR                                24530000
245400              EXEC SQL                                            24540000
245500                  FETCH SCAC-HST-CSR                              24550000
245600                   INTO :AUVHCL-CURR-STATUS-CDE                   24560000
245700                       ,:AUVHCL-LAST-UPD-DTE                      24570000
245800                       ,:AUVHCL-LAST-UPD-TME                      24580000
245900                       ,:VHTRIP-TRIP-ID                           24590000
246000                       ,:VHTRIP-OWNER-SCAC-ID                     24600000
246100                       ,:VHTRIP-VEH-NBR                           24610000
246200                       ,:VHTRIP-PLND-TRIP-SEQ                     24620000
246210                       ,:PV-CSR-TRIP-ST-CDE :DN-CSR-TRIP-ST-CDE   24621016
246220                       ,:PV-CSR-TRIP-ST-UID :DN-CSR-TRIP-ST-UID   24622016
246300              END-EXEC                                            24630000
246400                                                                  24640000
246500        WHEN  ASC-TRLR-HIST-CURSOR                                24650000
246600              EXEC SQL                                            24660000
246700                  FETCH TRLR-HST-CSR                              24670000
246800                   INTO :AUVHCL-CURR-STATUS-CDE                   24680000
246900                       ,:AUVHCL-CURR-STATUS-DTE                   24690000
247000                       ,:AUVHCL-CURR-STATUS-TME                   24700000
247100                       ,:VHTRIP-TRIP-ID                           24710000
247200                       ,:VHTRIP-OWNER-SCAC-ID                     24720000
247300                       ,:VHTRIP-VEH-NBR                           24730000
247400                       ,:VHTRIP-PLND-TRIP-SEQ                     24740000
247410                       ,:PV-CSR-TRIP-ST-CDE :DN-CSR-TRIP-ST-CDE   24741016
247420                       ,:PV-CSR-TRIP-ST-UID :DN-CSR-TRIP-ST-UID   24742016
247500              END-EXEC                                            24750000
247600                                                                  24760000
247700     END-EVALUATE.                                                24770000
247800                                                                  24780000
247900     EVALUATE TRUE                                                24790000
248000         WHEN SQLCODE = +0                                        24800000
248010              IF  DN-CSR-TRIP-ST-CDE = -1                         24801016
248020                  MOVE SPACES            TO  PV-CSR-TRIP-ST-CDE   24802016
248030              END-IF                                              24803016
248040              IF  DN-CSR-TRIP-ST-UID = -1                         24804016
248050                  MOVE SPACES            TO  PV-CSR-TRIP-ST-UID   24805016
248060              END-IF                                              24806016
248100              PERFORM 4315-SELECT-DETAIL                          24810000
248200                                                                  24820000
248300         WHEN SQLCODE = +100                                      24830000
248400              SET ASC-NO-ITEMS-LEFT-ON-DB                         24840000
248500                                   TO TRUE                        24850000
248600                                                                  24860000
248700         WHEN SQLWARN0 NOT = SPACE                                24870000
248800         WHEN SQLCODE < +0                                        24880000
248900         WHEN SQLCODE > +0                                        24890000
249000              MOVE '4310-FETCH-CURSOR'                            24900000
249100                                   TO DP013-PARAGRAPH             24910000
249200              MOVE 'FETCH TRAILER CURSOR'                         24920000
249300                                   TO DP013-MESSAGE-TEXT (1)      24930000
249400              MOVE SQLCA           TO DP013-SQLCA                 24940000
249500              MOVE 'TTRIPST'       TO DP013-DB2-TABLE-NAME (1)    24950000
249600              MOVE 'TTRSTTP'       TO DP013-DB2-TABLE-NAME (2)    24960000
249700              SET DP013-DB2-ABEND  TO TRUE                        24970000
249800              PERFORM DP013-0000-PROCESS-ABEND                    24980000
249900     END-EVALUATE.                                                24990000
250000                                                                  25000000
250100/                                                                 25010000
250200*----------------------------------------------------------------*25020000
250300*    GET THE FACILITY NAME                                       *25030000
250400*----------------------------------------------------------------*25040000
250500 4315-SELECT-DETAIL.                                              25050000
250600                                                                  25060000
250700     EVALUATE TRUE                                                25070000
250800        WHEN  ASC-SCAC-HIST-CURSOR                                25080000
250900             PERFORM 4318-OPEN-DTL-SCAC-CSR                       25090000
251000             EXEC SQL                                             25100000
251100                    FETCH DTL-SCAC-CSR                            25110000
251200                      INTO :AUVHCL-CURR-OPER-UNT-ID               25120000
251300                          ,:AUVHCL-CURR-FCLTY-ID                  25130000
251400                          ,:AUVHCL-CURR-FAC-AREA-ID               25140000
251500                          ,:AUVHCL-OWNER-SCAC-ID                  25150000
251600                          ,:AUVHCL-VEH-NBR                        25160000
251700                          ,:AUVHCL-USAGE-CDE                      25170000
251800                          ,:AUVHCL-VEH-SIZE-CDE                   25180000
251900                          ,:AUVHCL-CURR-STATUS-CDE                25190000
252000                          ,:AUVHCL-LAST-UPD-DTE                   25200000
252100                          ,:AUVHCL-LAST-UPD-TME                   25210000
252200                          ,:VHTRIP-TRIP-ID                        25220000
252300                          ,:VHTRIP-MANIFEST-NBR                   25230000
252400                          ,:VHTRIP-PLND-TRIP-SEQ                  25240000
252500                          ,:VHTRIP-REF-TRIP-ID                    25250000
252600                          ,:TRIPST-OPER-UNT-ID                    25260000
252700                          ,:TRIPST-FCLTY-ID                       25270000
252800                          ,:TRIPST-FCLTY-AREA-ID                  25280000
252900                          ,:VHTRIP-EST-AR-TMST :DN-EST-AR-TMST    25290000
252910                          ,:TRIPST-STATUS-UID                     25291003
253000              END-EXEC                                            25300000
253100              EVALUATE TRUE                                       25310000
253200                  WHEN SQLCODE = +0                               25320000
253300                       MOVE AUVHCL-CURR-STATUS-CDE TO             25330000
253400                                 TRIPST-TRIP-STATUS-CDE           25340000
253500                       MOVE AUVHCL-LAST-UPD-DTE    TO             25350000
253600                                 TRIPST-STATUS-DTE                25360000
253700                       MOVE AUVHCL-LAST-UPD-TME    TO             25370000
253800                                 TRIPST-STATUS-TME                25380000
253900                                                                  25390000
254000             END-EVALUATE                                         25400000
254100                                                                  25410000
254200        WHEN  ASC-DOCK-HIST-CURSOR                                25420000
254300        WHEN  ASC-TRLR-HIST-CURSOR                                25430000
254400             PERFORM 4317-OPEN-DETAIL-CSR                         25440000
254500             EXEC SQL                                             25450000
254600                    FETCH DETAIL-CSR                              25460000
254700                      INTO :AUVHCL-CURR-OPER-UNT-ID               25470000
254800                          ,:AUVHCL-CURR-FCLTY-ID                  25480000
254900                          ,:AUVHCL-CURR-FAC-AREA-ID               25490000
255000                          ,:AUVHCL-OWNER-SCAC-ID                  25500000
255100                          ,:AUVHCL-VEH-NBR                        25510000
255200                          ,:AUVHCL-USAGE-CDE                      25520000
255300                          ,:AUVHCL-VEH-SIZE-CDE                   25530000
255400                          ,:AUVHCL-CURR-STATUS-CDE                25540000
255500                          ,:AUVHCL-CURR-STATUS-DTE                25550000
255600                          ,:AUVHCL-CURR-STATUS-TME                25560000
255700                          ,:VHTRIP-TRIP-ID                        25570000
255800                          ,:VHTRIP-MANIFEST-NBR                   25580000
255900                          ,:VHTRIP-PLND-TRIP-SEQ                  25590000
256000                          ,:VHTRIP-REF-TRIP-ID                    25600000
256100                          ,:TRIPST-OPER-UNT-ID                    25610000
256200                          ,:TRIPST-FCLTY-ID                       25620000
256300                          ,:TRIPST-FCLTY-AREA-ID                  25630000
256400                          ,:VHTRIP-EST-AR-TMST :DN-EST-AR-TMST    25640000
256410                          ,:TRIPST-STATUS-UID                     25641003
256500              END-EXEC                                            25650000
256600              EVALUATE TRUE                                       25660000
256700                  WHEN SQLCODE = +0                               25670000
256800                       MOVE AUVHCL-CURR-STATUS-CDE TO             25680000
256900                                 TRIPST-TRIP-STATUS-CDE           25690000
257000                       MOVE AUVHCL-CURR-STATUS-DTE TO             25700000
257100                                 TRIPST-STATUS-DTE                25710000
257200                       MOVE AUVHCL-CURR-STATUS-TME TO             25720000
257300                                 TRIPST-STATUS-TME                25730000
257400                                                                  25740000
257500             END-EVALUATE                                         25750000
257600                                                                  25760000
257700     END-EVALUATE.                                                25770000
257800                                                                  25780000
257900     EVALUATE TRUE                                                25790000
258000          WHEN SQLCODE = +100                                     25800000
258100               SET ASC-NO-ITEMS-LEFT-ON-DB                        25810000
258200                                    TO TRUE                       25820000
258300                                                                  25830000
258400          WHEN SQLWARN0 NOT = SPACE                               25840000
258500          WHEN SQLCODE < +0                                       25850000
258600          WHEN SQLCODE > +0                                       25860000
258700               MOVE '4310-FETCH-CURSOR'                           25870000
258800                            TO DP013-PARAGRAPH                    25880000
258900               MOVE 'SELECT ON TRLR-HIS-CSR'                      25890000
259000                            TO DP013-MESSAGE-TEXT (1)             25900000
259100               MOVE SQLCA     TO DP013-SQLCA                      25910000
259200               MOVE 'TAUTHCL' TO                                  25920000
259300                        DP013-DB2-TABLE-NAME (1)                  25930000
259400               MOVE 'TVHTRIP' TO                                  25940000
259500                        DP013-DB2-TABLE-NAME (2)                  25950000
259600               SET DP013-DB2-ABEND  TO TRUE                       25960000
259700               PERFORM DP013-0000-PROCESS-ABEND                   25970000
259800      END-EVALUATE.                                               25980000
259900                                                                  25990000
260000     EVALUATE TRUE                                                26000000
260100        WHEN  ASC-SCAC-HIST-CURSOR                                26010000
260200             PERFORM 4320-CLOSE-DTL-SCAC-CSR                      26020000
260300        WHEN  ASC-DOCK-HIST-CURSOR                                26030000
260400        WHEN  ASC-TRLR-HIST-CURSOR                                26040000
260500             PERFORM 4319-CLOSE-DETAIL-CSR                        26050000
260600     END-EVALUATE.                                                26060000
260700                                                                  26070000
260800                                                                  26080000
260900 4317-OPEN-DETAIL-CSR.                                            26090000
261000      EXEC SQL                                                    26100000
261100          OPEN DETAIL-CSR                                         26110000
261200      END-EXEC.                                                   26120000
261300                                                                  26130000
261400     EVALUATE TRUE                                                26140000
261500         WHEN SQLCODE = +0                                        26150000
261600              CONTINUE                                            26160000
261700         WHEN SQLCODE = -904                                      26170000
261800         WHEN SQLCODE = -913                                      26180000
261900              CONTINUE                                            26190000
262000         WHEN SQLWARN0 NOT = SPACE                                26200000
262100         WHEN SQLCODE  NOT = +0                                   26210000
262200              MOVE '4317-OPEN-DETAIL-CSR'                         26220000
262300                               TO DP013-PARAGRAPH                 26230000
262400              MOVE 'OPEN CURSOR'                                  26240000
262500                               TO DP013-MESSAGE-TEXT (1)          26250000
262600              MOVE SQLCA       TO DP013-SQLCA                     26260000
262700              MOVE 'TAUVHCL'   TO DP013-DB2-TABLE-NAME (1)        26270000
262800              MOVE 'TVHTRIP'   TO DP013-DB2-TABLE-NAME (2)        26280000
262900              SET DP013-DB2-ABEND                                 26290000
263000                               TO TRUE                            26300000
263100              PERFORM DP013-0000-PROCESS-ABEND                    26310000
263200     END-EVALUATE.                                                26320000
263300                                                                  26330000
263400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        26340000
263500         MOVE '4317-OPEN-DETAIL-CURSOR'   TO DP013-PARAGRAPH      26350000
263600         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              26360000
263700                                   TO DP013-MESSAGE-TEXT (1)      26370000
263800         MOVE SQLCA                TO DP013-SQLCA                 26380000
263900         SET DP013-DB2-ABEND       TO TRUE                        26390000
264000         PERFORM DP013-0000-PROCESS-ABEND                         26400000
264100     END-IF.                                                      26410000
264200                                                                  26420000
264300 4318-OPEN-DTL-SCAC-CSR.                                          26430000
264400      EXEC SQL                                                    26440000
264500          OPEN DTL-SCAC-CSR                                       26450000
264600      END-EXEC.                                                   26460000
264700                                                                  26470000
264800     EVALUATE TRUE                                                26480000
264900         WHEN SQLCODE = +0                                        26490000
265000              CONTINUE                                            26500000
265100         WHEN SQLCODE = -904                                      26510000
265200         WHEN SQLCODE = -913                                      26520000
265300              CONTINUE                                            26530000
265400         WHEN SQLWARN0 NOT = SPACE                                26540000
265500         WHEN SQLCODE  NOT = +0                                   26550000
265600              MOVE '4318-OPEN-DTL-SCAC-CSR'                       26560000
265700                               TO DP013-PARAGRAPH                 26570000
265800              MOVE 'OPEN CURSOR'                                  26580000
265900                               TO DP013-MESSAGE-TEXT (1)          26590000
266000              MOVE SQLCA       TO DP013-SQLCA                     26600000
266100              MOVE 'TAUVHCL'   TO DP013-DB2-TABLE-NAME (1)        26610000
266200              MOVE 'TVHTRIP'   TO DP013-DB2-TABLE-NAME (2)        26620000
266300              SET DP013-DB2-ABEND                                 26630000
266400                               TO TRUE                            26640000
266500              PERFORM DP013-0000-PROCESS-ABEND                    26650000
266600     END-EVALUATE.                                                26660000
266700                                                                  26670000
266800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        26680000
266900         MOVE '4318-OPEN-DTL-SCAC-CURSOR' TO DP013-PARAGRAPH      26690000
267000         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              26700000
267100                                   TO DP013-MESSAGE-TEXT (1)      26710000
267200         MOVE SQLCA                TO DP013-SQLCA                 26720000
267300         SET DP013-DB2-ABEND       TO TRUE                        26730000
267400         PERFORM DP013-0000-PROCESS-ABEND                         26740000
267500     END-IF.                                                      26750000
267600                                                                  26760000
267700 4319-CLOSE-DETAIL-CSR.                                           26770000
267800     EXEC SQL                                                     26780000
267900         CLOSE DETAIL-CSR                                         26790000
268000     END-EXEC                                                     26800000
268100                                                                  26810000
268200     EVALUATE TRUE                                                26820000
268300         WHEN SQLCODE = +0                                        26830000
268400              CONTINUE                                            26840000
268500         WHEN SQLWARN0 NOT = SPACE                                26850000
268600         WHEN SQLCODE  NOT = +0                                   26860000
268700              MOVE '4319-CLOSE-DETAIL-CSR'                        26870000
268800                                   TO DP013-PARAGRAPH             26880000
268900              MOVE 'CLOSE CURSOR'  TO DP013-MESSAGE-TEXT (1)      26890000
269000              MOVE SQLCA           TO DP013-SQLCA                 26900000
269100              MOVE 'TAUVHCL'       TO DP013-DB2-TABLE-NAME (1)    26910000
269200              MOVE 'TVHTRIP'       TO DP013-DB2-TABLE-NAME (2)    26920000
269300              SET DP013-DB2-ABEND  TO TRUE                        26930000
269400              PERFORM DP013-0000-PROCESS-ABEND                    26940000
269500     END-EVALUATE.                                                26950000
269600                                                                  26960000
269700/                                                                 26970000
269800 4320-CLOSE-DTL-SCAC-CSR.                                         26980000
269900     EXEC SQL                                                     26990000
270000         CLOSE DTL-SCAC-CSR                                       27000000
270100     END-EXEC                                                     27010000
270200                                                                  27020000
270300     EVALUATE TRUE                                                27030000
270400         WHEN SQLCODE = +0                                        27040000
270500              CONTINUE                                            27050000
270600         WHEN SQLWARN0 NOT = SPACE                                27060000
270700         WHEN SQLCODE  NOT = +0                                   27070000
270800              MOVE '4320-CLOSE-DTL-SCAC-CSR'                      27080000
270900                                   TO DP013-PARAGRAPH             27090000
271000              MOVE 'CLOSE CURSOR'  TO DP013-MESSAGE-TEXT (1)      27100000
271100              MOVE SQLCA           TO DP013-SQLCA                 27110000
271200              MOVE 'TAUVHCL'       TO DP013-DB2-TABLE-NAME (1)    27120000
271300              MOVE 'TVHTRIP'       TO DP013-DB2-TABLE-NAME (2)    27130000
271400              SET DP013-DB2-ABEND  TO TRUE                        27140000
271500              PERFORM DP013-0000-PROCESS-ABEND                    27150000
271600     END-EVALUATE.                                                27160000
271700                                                                  27170000
271800/                                                                 27180000
271900*----------------------------------------------------------------*27190000
272000*    GET THE FACILITY NAME                                       *27200000
272100*----------------------------------------------------------------*27210000
272200 4320-GET-FCLTY-NAME.                                             27220000
272300                                                                  27230000
272400     PERFORM                                                      27240000
272500         WITH TEST AFTER                                          27250000
272600         VARYING PV-RETRY-COUNTER                                 27260000
272700         FROM 1 BY 1                                              27270000
272800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               27280000
272900             OR (SQLCODE = +0)                                    27290000
273000             OR (SQLCODE = +100))                                 27300000
273100                                                                  27310000
273200         EXEC SQL                                                 27320000
273300              SELECT FCLTY_NME                                    27330000
273400                INTO :FACLTY-FCLTY-NME                            27340000
273500                FROM TFACLTY                                      27350000
273600               WHERE OPER_UNT_ID = :DK-OPER-UNT-ID                27360000
273700                 AND FCLTY_ID    = :DK-FCLTY-ID-B                 27370000
273800         END-EXEC                                                 27380000
273900                                                                  27390000
274000         EVALUATE TRUE                                            27400000
274100             WHEN SQLCODE = +0                                    27410000
274200                  MOVE FACLTY-FCLTY-NME                           27420000
274300                                  TO ASC-FCLTY-NME                27430000
274400                                                                  27440000
274500             WHEN SQLCODE = +100                                  27450000
274600                  MOVE SPACES     TO ASC-FCLTY-NME                27460000
274700                                                                  27470000
274800             WHEN SQLCODE = -904                                  27480000
274900             WHEN SQLCODE = -913                                  27490000
275000                  CONTINUE                                        27500000
275100                                                                  27510000
275200             WHEN SQLWARN0 NOT = SPACES                           27520000
275300             WHEN SQLCODE < +0                                    27530000
275400             WHEN SQLCODE > +0                                    27540000
275500                  MOVE '4320-GET-FCLTY-NAME'                      27550000
275600                                  TO DP013-PARAGRAPH              27560000
275700                  MOVE 'UNSUCCESSFUL SELECT ON FACILITY TABLE'    27570000
275800                                  TO DP013-MESSAGE-TEXT (1)       27580000
275900                  MOVE SQLCA      TO DP013-SQLCA                  27590000
276000                  MOVE 'TFACLTY ' TO DP013-DB2-TABLE-NAME (1)     27600000
276100                  SET DP013-DB2-ABEND                             27610000
276200                      DP013-XCTL-DISPLAY-RESTART                  27620000
276300                                  TO TRUE                         27630000
276400                  PERFORM DP013-0000-PROCESS-ABEND                27640000
276500         END-EVALUATE                                             27650000
276600     END-PERFORM.                                                 27660000
276700                                                                  27670000
276800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        27680000
276900         MOVE '4320-GET-FCLTY-NAME'                               27690000
277000                                  TO DP013-PARAGRAPH              27700000
277100         MOVE 'MAX RETRIES EXCEEDED ON SELECT FACILITY TABLE'     27710000
277200                                  TO DP013-MESSAGE-TEXT (1)       27720000
277300         MOVE SQLCA               TO DP013-SQLCA                  27730000
277400         MOVE 'TFACLTY'           TO DP013-DB2-TABLE-NAME (1)     27740000
277500         SET DP013-DB2-ABEND                                      27750000
277600             DP013-XCTL-DISPLAY-RESTART                           27760000
277700                                  TO TRUE                         27770000
277800         PERFORM DP013-0000-PROCESS-ABEND                         27780000
277900     END-IF.                                                      27790000
278000                                                                  27800000
278100/                                                                 27810000
283800*----------------------------------------------------------------*28380000
283900*    GET THE HIGHEST STATUS CODE FOR TRIP                        *28390000
284000*----------------------------------------------------------------*28400000
284100 4360-GET-MAX-TRIP-STATUS.                                        28410000
284200                                                                  28420000
284300     PERFORM                                                      28430000
284400         WITH TEST AFTER                                          28440000
284500         VARYING PV-RETRY-COUNTER                                 28450000
284600         FROM 1 BY 1                                              28460000
284700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               28470000
284800             OR (SQLCODE = +0)                                    28480000
284900             OR (SQLCODE = +100))                                 28490000
285000                                                                  28500000
285100         EXEC SQL                                                 28510000
285200           SELECT DISTINCT                                        28520000
285300                  A.TRIP_STATUS_CDE                               28530000
285800           INTO   :TRIPST-TRIP-STATUS-CDE                         28580000
286300           FROM   TTRIPST A                                       28630000
286400                 ,TTRSTYP B                                       28640000
286500           WHERE  A.TRIP_ID     = :DK-TRIP-ID                     28650000
286600             AND  A.TRIP_STATUS_CDE = B.TRIP_STATUS_CDE           28660000
286700             AND  B.PRTY_CDE =                                    28670000
286800                 (SELECT DISTINCT                                 28680000
286900                      MAX(D.PRTY_CDE)                             28690000
287000                   FROM   TTRIPST C                               28700000
287100                         ,TTRSTYP D                               28710000
287200                   WHERE  C.TRIP_ID     = :DK-TRIP-ID             28720000
287300                     AND  C.TRIP_STATUS_CDE = D.TRIP_STATUS_CDE)  28730000
287400         END-EXEC                                                 28740000
287500                                                                  28750000
287600         EVALUATE TRUE                                            28760000
287700             WHEN SQLCODE = +0                                    28770000
287800                  CONTINUE                                        28780000
287900             WHEN SQLCODE = +100                                  28790000
288000             WHEN SQLCODE = -904                                  28800000
288100             WHEN SQLCODE = -913                                  28810000
288200                  CONTINUE                                        28820000
288300                                                                  28830000
288400             WHEN SQLWARN0 NOT = SPACES                           28840000
288500             WHEN SQLCODE < +0                                    28850000
288600             WHEN SQLCODE > +0                                    28860000
288700                  MOVE '4360-GET-MAX-TRIP-STATUS'                 28870000
288800                                  TO DP013-PARAGRAPH              28880000
288900                  MOVE 'UNSUCCESSFUL SELECT ON TTRIPST TABLE'     28890000
289000                                  TO DP013-MESSAGE-TEXT (1)       28900000
289100                  MOVE SQLCA      TO DP013-SQLCA                  28910000
289200                  MOVE 'TTRIPST ' TO DP013-DB2-TABLE-NAME (1)     28920000
289300                  SET DP013-DB2-ABEND                             28930000
289400                      DP013-XCTL-DISPLAY-RESTART                  28940000
289500                                  TO TRUE                         28950000
289600                  PERFORM DP013-0000-PROCESS-ABEND                28960000
289700         END-EVALUATE                                             28970000
289800     END-PERFORM.                                                 28980000
289900                                                                  28990000
290000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        29000000
290100         MOVE '4360-GET-MAX-TRIP-STATUS' TO DP013-PARAGRAPH       29010000
290200         MOVE 'SELECT ERROR'      TO DP013-MESSAGE-TEXT (1)       29020000
290300         MOVE SQLCA               TO DP013-SQLCA                  29030000
290400         MOVE 'TTRIPST & TTRSTYP' TO DP013-DB2-TABLE-NAME (1)     29040000
290500         SET DP013-DB2-ABEND                                      29050000
290600             DP013-XCTL-DISPLAY-RESTART                           29060000
290700                                  TO TRUE                         29070000
290800         PERFORM DP013-0000-PROCESS-ABEND                         29080000
290900     END-IF.                                                      29090000
291000                                                                  29100000
291100/                                                                 29110000
291200*----------------------------------------------------------------*29120000
291300* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *29130000
291400*----------------------------------------------------------------*29140000
291500                                                                  29150000
291600 4400-MOVE-COMMAREA-TO-SCREEN.                                    29160000
291700                                                                  29170000
291800     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             29180000
291900         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          29190000
292000         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          29200000
292100             MOVE +1               TO ASC-BLK-SUB                 29210000
292200             PERFORM 5100-WRITE-TEMP-STORAGE                      29220000
292300             ADD +1                TO ASC-BLK-SUB                 29230000
292400             PERFORM 5100-WRITE-TEMP-STORAGE                      29240000
292500             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             29250000
292600                 GIVING PV-BLOCK-NUMBER                           29260000
292700                 REMAINDER PV-REMAINDER                           29270000
292800             IF  PV-REMAINDER > ZERO                              29280000
292900                 ADD +1            TO PV-BLOCK-NUMBER             29290000
293000             END-IF                                               29300000
293100             MOVE +1               TO ASC-BLK-SUB                 29310000
293200             PERFORM 4410-READ-TEMP-STORAGE                       29320000
293300             ADD +1                TO ASC-BLK-SUB                 29330000
293400                                      PV-BLOCK-NUMBER             29340000
293500             PERFORM 4410-READ-TEMP-STORAGE                       29350000
293600     END-IF.                                                      29360000
293700                                                                  29370000
293800     MOVE +1                       TO ASC-BLK-SUB.                29380000
293900                                                                  29390000
294000     COMPUTE ASC-ITEM-SUB =                                       29400000
294100         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              29410000
294200         + PC-ITEMS-PER-PANEL).                                   29420000
294300                                                                  29430000
294400     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        29440000
294500         ADD +1                    TO ASC-BLK-SUB                 29450000
294600         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            29460000
294700     END-IF.                                                      29470000
294800                                                                  29480000
294900     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           29490000
295000         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                29500000
295100                                                                  29510000
295200     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        29520000
295300     PERFORM 4420-FORMAT-LIST-LINES                               29530000
295400         VARYING PV-SUB                                           29540000
295500         FROM PC-ITEMS-PER-PANEL BY -1                            29550000
295600         UNTIL PV-SUB < +1.                                       29560000
295700                                                                  29570000
295800     COMPUTE ASC-ITEMS-DISPLAYED =                                29580000
295900         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          29590000
296000                                                                  29600000
296100     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    29610000
296200                                      ASTRTITO.                   29620000
296300                                                                  29630000
296400                                                                  29640000
296500     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    29650000
296600     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    29660000
296700     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            29670000
296800                                   TO ASELITO.                    29680000
296900                                                                  29690000
297000     IF  DP020-MSG-NUMBER-X = SPACE                               29700000
297100         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  29710000
297200*            --- MORE ITEMS TO DISPLAY ----                       29720000
297300             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            29730000
297400             SET DP020-MSG-INFORMATIONAL                          29740000
297500                                   TO TRUE                        29750000
297600         END-IF                                                   29760000
297700     END-IF.                                                      29770000
297800                                                                  29780000
297900*----------------------------------------------------------------*29790000
298000*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *29800000
298100*----------------------------------------------------------------*29810000
298200                                                                  29820000
298300 4410-READ-TEMP-STORAGE.                                          29830000
298400                                                                  29840000
298500     EXEC CICS                                                    29850000
298600         READQ TS                                                 29860000
298700             QUEUE (ASC-LIST-QUEUE-NAME)                          29870000
298800             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               29880000
298900             ITEM  (PV-BLOCK-NUMBER)                              29890000
299000             RESP  (PV-CICS-RESP)                                 29900000
299100     END-EXEC.                                                    29910000
299200                                                                  29920000
299300     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       29930000
299400       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     29940000
299500         CONTINUE                                                 29950000
299600     ELSE                                                         29960000
299700         SET DP013-CICS-ABEND      TO TRUE                        29970000
299800         SET DP013-NO-ROLLBACK     TO TRUE                        29980000
299900         MOVE '4410-READ-TEMP-STORAGE'                            29990000
300000                                   TO DP013-PARAGRAPH             30000000
300100         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      30010000
300200                                   TO DP013-MESSAGE-TEXT(1)       30020000
300300         PERFORM DP013-0000-PROCESS-ABEND                         30030000
300400     END-IF.                                                      30040000
300500                                                                  30050000
300600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      30060000
300700                                   TO TRUE.                       30070000
300800                                                                  30080000
300900     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         30090000
301000         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               30100000
301100     END-IF.                                                      30110000
301200                                                                  30120000
301300/                                                                 30130000
301400*----------------------------------------------------------------*30140000
301500*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *30150000
301600*----------------------------------------------------------------*30160000
301700                                                                  30170000
301800 4420-FORMAT-LIST-LINES.                                          30180000
301900                                                                  30190000
302000     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      30200000
302100         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                30210000
302200         MOVE DP015-ASK-DRK-OFF    TO MR-SELECTA (PV-SUB)         30220000
302300         MOVE SPACES               TO MR-SELECT  (PV-SUB)         30230000
302400                                      MR-CARR-SCAC-CDE (PV-SUB)   30240000
302500                                      MR-TRLR-NBR (PV-SUB)        30250000
302600                                      MR-TRIP-STOP (PV-SUB)       30260000
302700                                      MR-STAT (PV-SUB)            30270000
302800                                      MR-MANIFEST (PV-SUB)        30280000
302900                                      MR-USE (PV-SUB)             30290000
303000                                      MR-LGTH (PV-SUB)            30300000
303100                                      MR-CURR-LOC-1 (PV-SUB)      30310000
303200                                      MR-CURR-LOC-2 (PV-SUB)      30320000
303300                                      MR-DEST (PV-SUB)            30330000
303400                                      MR-ETA-DTE-TME (PV-SUB)     30340000
303410                                      MR-STAT-USERID (PV-SUB)     30341003
303600     ELSE                                                         30360000
303700         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      30370000
303800                                                   > SPACE        30380000
303900             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 30390000
304000                                   TO MR-SELECT (PV-SUB)          30400000
304100         ELSE                                                     30410000
304200             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      30420000
304300                                   TO MR-SELECT (PV-SUB)          30430000
304400         END-IF                                                   30440000
304500                                                                  30450000
304600         IF  DP030-SET-CURSOR-TRAILER                             30460000
304700             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)30470000
304800                 > SPACE)                                         30480000
304900               OR (PV-SUB = 1))                                   30490000
305000                SET DP030-SET-CURSOR-APPL-1 TO TRUE               30500000
305100                MOVE -1            TO MR-SELECTL (PV-SUB)         30510000
305200             END-IF                                               30520000
305300         END-IF                                                   30530000
305400                                                                  30540000
305500         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           30550000
305600             MOVE ASC-CARR-SCAC-CDE (ASC-BLK-SUB ASC-ITEM-SUB)    30560000
305700                                   TO MR-CARR-SCAC-CDE (PV-SUB)   30570000
305800             MOVE ASC-TRLR-NBR (ASC-BLK-SUB ASC-ITEM-SUB)         30580000
305900                                   TO MR-TRLR-NBR (PV-SUB)        30590000
306000             MOVE ASC-TRIP-STOP (ASC-BLK-SUB ASC-ITEM-SUB)        30600000
306100                                   TO MR-TRIP-STOP (PV-SUB)       30610000
306200             MOVE ASC-STAT (ASC-BLK-SUB ASC-ITEM-SUB)             30620000
306300                                   TO MR-STAT (PV-SUB)            30630000
306400             MOVE ASC-MANIFEST (ASC-BLK-SUB ASC-ITEM-SUB)         30640000
306500                                   TO MR-MANIFEST (PV-SUB)        30650000
306600             MOVE ASC-USE (ASC-BLK-SUB ASC-ITEM-SUB)              30660000
306700                                   TO MR-USE (PV-SUB)             30670000
306800             MOVE ASC-LGTH (ASC-BLK-SUB ASC-ITEM-SUB)             30680000
306900                                   TO MR-LGTH (PV-SUB)            30690000
307000             MOVE ASC-CURR-LOC-1 (ASC-BLK-SUB ASC-ITEM-SUB)       30700000
307100                                   TO MR-CURR-LOC-1 (PV-SUB)      30710000
307200             MOVE ASC-CURR-LOC-2 (ASC-BLK-SUB ASC-ITEM-SUB)       30720000
307300                                   TO MR-CURR-LOC-2 (PV-SUB)      30730000
307400             MOVE ASC-STATUS-DTE-TME (ASC-BLK-SUB ASC-ITEM-SUB)   30740000
307500                                   TO MR-ETA-DTE-TME (PV-SUB)     30750000
307510             MOVE ASC-STATUS-USERID (ASC-BLK-SUB ASC-ITEM-SUB)    30751004
307520                                   TO MR-STAT-USERID   (PV-SUB)   30752005
307600             MOVE ASC-DEST (ASC-BLK-SUB ASC-ITEM-SUB)             30760000
307700                                   TO MR-DEST (PV-SUB)            30770000
308000         END-IF                                                   30800000
308100     END-IF.                                                      30810000
308200                                                                  30820000
308300     SUBTRACT +1 FROM ASC-ITEM-SUB.                               30830000
308400                                                                  30840000
308500     IF  ASC-ITEM-SUB < + 1                                       30850000
308600         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                30860000
308700         MOVE +1                   TO ASC-BLK-SUB                 30870000
308800     END-IF.                                                      30880000
308900                                                                  30890000
309000*----------------------------------------------------------------*30900000
309100*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *30910000
309200*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *30920000
309300*  ISSUE A WARNING.                                              *30930000
309400*----------------------------------------------------------------*30940000
309500 4430-CHECK-FOR-BEGIN-AND-END.                                    30950000
309600                                                                  30960000
309700     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       30970000
309800         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     30980000
309900*            -- NO END-OF-RANGE SPECFIED ---                      30990000
310000             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            31000000
310100             SET DP020-MSG-WARNING TO TRUE                        31010000
310200             PERFORM 4431-POSITION-AT-WARNING                     31020000
310300         END-IF                                                   31030000
310400     ELSE                                                         31040000
310500         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     31050000
310600*            -- NO BEGINNING-OF-RANGE SPECFIED ---                31060000
310700             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            31070000
310800             SET DP020-MSG-WARNING TO TRUE                        31080000
310900             PERFORM 4431-POSITION-AT-WARNING                     31090000
311000         END-IF                                                   31100000
311100     END-IF.                                                      31110000
311200                                                                  31120000
311300*----------------------------------------------------------------*31130000
311400*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *31140000
311500*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *31150000
311600*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *31160000
311700*  POSITION THE CURSOR THERE.                                    *31170000
311800*----------------------------------------------------------------*31180000
311900 4431-POSITION-AT-WARNING.                                        31190000
312000                                                                  31200000
312100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 31210000
312200                    - PV-TOP-ITEM + 1.                            31220000
312300                                                                  31230000
312400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      31240000
312500         CONTINUE                                                 31250000
312600     ELSE                                                         31260000
312700         SET DP030-SET-CURSOR-APPL-1                              31270000
312800                                   TO TRUE                        31280000
312900         MOVE -1                   TO MR-SELECTL (PV-SUB)         31290000
313000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         31300000
313100         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         31310000
313200     END-IF.                                                      31320000
313300                                                                  31330000
313400     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   31340000
313500                    - PV-TOP-ITEM + 1.                            31350000
313600                                                                  31360000
313700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      31370000
313800         CONTINUE                                                 31380000
313900     ELSE                                                         31390000
314000         SET DP030-SET-CURSOR-APPL-1                              31400000
314100                                   TO TRUE                        31410000
314200         MOVE -1                   TO MR-SELECTL (PV-SUB)         31420000
314300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         31430000
314400         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         31440000
314500     END-IF.                                                      31450000
314600                                                                  31460000
314700/                                                                 31470000
314800*----------------------------------------------------------------*31480000
314900* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *31490000
315000* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *31500000
315100* FOR THE SELECTED ITEMS QUEUE.                                  *31510000
315200*                                                                *31520000
315300* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *31530000
315400* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *31540000
315500* THE ARRAY IS FULL.                                             *31550000
315600*----------------------------------------------------------------*31560000
315700                                                                  31570000
315800 5000-PREPARE-SEL-QUEUE.                                          31580000
315900                                                                  31590000
316000     MOVE +1                       TO ASC-BLK-SUB.                31600000
316100     PERFORM 5100-WRITE-TEMP-STORAGE.                             31610000
316200     ADD +1                        TO ASC-BLK-SUB.                31620000
316300     PERFORM 5100-WRITE-TEMP-STORAGE.                             31630000
316400                                                                  31640000
316500     MOVE ASC-SEL-QUEUE-NAME-OUT   TO TR007-SEL-QUEUE-NAME.       31650000
316600     PERFORM 6010-DELETE-SEL-QUEUE.                               31660000
316700                                                                  31670000
316800     IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                      31680000
316900         SET ASC-UPDATE-TSQ        TO TRUE                        31690000
317000     END-IF.                                                      31700000
317100                                                                  31710000
317200     SET TR006-IDX                 TO 1.                          31720000
317300     MOVE ZERO                     TO TR007-NUMBER-OF-TS-ITEMS.   31730000
317400     INITIALIZE TR006-SELECTED-ITEM-ARRAY.                        31740000
317500                                                                  31750000
317600     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           31760000
317700             VARYING PV-ITEM                                      31770000
317800             FROM 1 BY 1                                          31780000
317900             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     31790000
318000                                                                  31800000
318100     IF  TR006-IDX > 1                                            31810000
318200         PERFORM 5205-WRITE-SEL-QUEUE                             31820000
318300         ADD +1                    TO TR007-NUMBER-OF-TS-ITEMS    31830000
318400     END-IF.                                                      31840000
318500                                                                  31850000
318600/                                                                 31860000
318700*----------------------------------------------------------------*31870000
318800*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *31880000
318900*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *31890000
319000*----------------------------------------------------------------*31900000
319100                                                                  31910000
319200 5100-WRITE-TEMP-STORAGE.                                         31920000
319300                                                                  31930000
319400     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     31940000
319500                                   TO PV-LIST-ITEM-NUMBER.        31950000
319600     COMPUTE PV-BLOCK-NUMBER =                                    31960000
319700         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    31970000
319800                                                                  31980000
319900     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             31990000
320000     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             32000000
320100         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      32010000
320200             PERFORM 5105-REWRITE-ASC-LISTQ                       32020000
320300         END-IF                                                   32030000
320400     ELSE                                                         32040000
320500         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       32050000
320600         ASC-HIGHEST-BLOCK-WRITTEN + 1                            32060000
320700         PERFORM 5110-WRITE-ASC-LISTQ                             32070000
320800         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   32080000
320900     END-IF.                                                      32090000
321000                                                                  32100000
321100     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      32110000
321200                                   TO TRUE.                       32120000
321300                                                                  32130000
321400/                                                                 32140000
321500*----------------------------------------------------------------*32150000
321600*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *32160000
321700*  SPECIFIC COMMAREA.                                            *32170000
321800*----------------------------------------------------------------*32180000
321900 5105-REWRITE-ASC-LISTQ.                                          32190000
322000                                                                  32200000
322100     EXEC CICS                                                    32210000
322200         WRITEQ TS                                                32220000
322300             QUEUE (ASC-LIST-QUEUE-NAME)                          32230000
322400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               32240000
322500             ITEM  (PV-BLOCK-NUMBER)                              32250000
322600             REWRITE                                              32260000
322700             RESP  (PV-CICS-RESP)                                 32270000
322800     END-EXEC.                                                    32280000
322900                                                                  32290000
323000     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           32300000
323100         CONTINUE                                                 32310000
323200     ELSE                                                         32320000
323300         SET DP013-CICS-ABEND      TO TRUE                        32330000
323400         SET DP013-NO-ROLLBACK     TO TRUE                        32340000
323500         MOVE '5105-REWRITE-ASC-LISTQ'                            32350000
323600                                   TO DP013-PARAGRAPH             32360000
323700         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     32370000
323800                                   TO DP013-MESSAGE-TEXT(1)       32380000
323900         PERFORM DP013-0000-PROCESS-ABEND                         32390000
324000     END-IF.                                                      32400000
324100                                                                  32410000
324200/                                                                 32420000
324300*----------------------------------------------------------------*32430000
324400*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *32440000
324500*  SPECIFIC COMMAREA.                                            *32450000
324600*----------------------------------------------------------------*32460000
324700 5110-WRITE-ASC-LISTQ.                                            32470000
324800                                                                  32480000
324900     EXEC CICS                                                    32490000
325000         WRITEQ TS                                                32500000
325100             QUEUE (ASC-LIST-QUEUE-NAME)                          32510000
325200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               32520000
325300             ITEM  (PV-BLOCK-NUMBER)                              32530000
325400             RESP  (PV-CICS-RESP)                                 32540000
325500     END-EXEC.                                                    32550000
325600                                                                  32560000
325700     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      32570000
325800         SET DP013-CICS-ABEND      TO TRUE                        32580000
325900         SET DP013-NO-ROLLBACK     TO TRUE                        32590000
326000         MOVE '5110-WRITE-ASC-LISTQ'                              32600000
326100                                   TO DP013-PARAGRAPH             32610000
326200         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           32620000
326300                                   TO DP013-MESSAGE-TEXT(1)       32630000
326400         PERFORM DP013-0000-PROCESS-ABEND                         32640000
326500     END-IF.                                                      32650000
326600                                                                  32660000
326700/                                                                 32670000
326800*----------------------------------------------------------------*32680000
326900* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *32690000
327000* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *32700000
327100*----------------------------------------------------------------*32710000
327200                                                                  32720000
327300 5200-FILL-SEL-QUEUE-RECORD.                                      32730000
327400                                                                  32740000
327500     PERFORM 6112-READ-LIST-QUEUE.                                32750000
327600                                                                  32760000
327700     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       32770000
327800         PERFORM                                                  32780000
327900         VARYING LQW-IDX                                          32790000
328000         FROM 1 BY 1                                              32800000
328100         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            32810000
328200           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          32820000
328300                                                                  32830000
328400             IF  LQW-SELECT (LQW-IDX)                             32840000
328500                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              32850000
328600                                   TO TR006-ITEM (TR006-IDX)      32860000
328700                 MOVE LQW-CARR-SCAC-CDE (LQW-IDX)                 32870000
328800                           TO TR006-OWNER-SCAC-ID (TR006-IDX)     32880000
328900                 MOVE LQW-TRLR-NBR (LQW-IDX)                      32890000
329000                           TO TR006-VEH-NBR (TR006-IDX)           32900000
329100                 MOVE LQW-MANIFEST (LQW-IDX)                      32910000
329200                           TO TR006-MANIFEST-NBR (TR006-IDX)      32920000
329300                 MOVE LQW-OPER-UNT-ID (LQW-IDX)                   32930000
329400                           TO TR006-OPER-UNT-ID (TR006-IDX)       32940000
329500                 MOVE LQW-FCLTY-ID (LQW-IDX)                      32950000
329600                           TO TR006-FCLTY-ID (TR006-IDX)          32960000
329700                 MOVE LQW-TRIP-ID (LQW-IDX)                       32970000
329800                           TO TR006-TRIP-ID (TR006-IDX)           32980000
329900                 MOVE LQW-STAT (LQW-IDX)                          32990000
330000                           TO TR006-STATUS-CDE (TR006-IDX)        33000000
330100                 MOVE SPACE        TO TR006-ACTION-SW (TR006-IDX) 33010000
330200                 SET TR006-IDX UP BY 1                            33020000
330300                 IF  TR006-IDX > TR006-MAX-ITEMS                  33030000
330400                     PERFORM 5205-WRITE-SEL-QUEUE                 33040000
330500                     ADD +1        TO TR007-NUMBER-OF-TS-ITEMS    33050000
330600                     INITIALIZE TR006-SELECTED-ITEM-ARRAY         33060000
330700                     SET TR006-IDX TO 1                           33070000
330800                 END-IF                                           33080000
330900             END-IF                                               33090000
331000         END-PERFORM                                              33100000
331100     END-IF.                                                      33110000
331200                                                                  33120000
331300/                                                                 33130000
331400*----------------------------------------------------------------*33140000
331500*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *33150000
331600*----------------------------------------------------------------*33160000
331700                                                                  33170000
331800 5205-WRITE-SEL-QUEUE.                                            33180000
331900                                                                  33190000
332000     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            33200000
332100                                   TO TR006-SELECTED-ITEMS.       33210000
332200                                                                  33220000
332300     EXEC CICS                                                    33230000
332400          WRITEQ TS                                               33240000
332500              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      33250000
332600              FROM  (TR006-DOCK-SCHEDULE-REC)                     33260000
332700              ITEM  (PV-SEL-QUEUE-ITEM)                           33270000
332800              RESP  (PV-CICS-RESP)                                33280000
332900     END-EXEC.                                                    33290000
333000                                                                  33300000
333100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          33310000
333200         CONTINUE                                                 33320000
333300     ELSE                                                         33330000
333400         SET DP013-CICS-ABEND      TO TRUE                        33340000
333500         SET DP013-NO-ROLLBACK     TO TRUE                        33350000
333600         MOVE '5205-WRITE-SEL-QUEUE'                              33360000
333700                                   TO DP013-PARAGRAPH             33370000
333800         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          33380000
333900                                   TO DP013-MESSAGE-TEXT(1)       33390000
334000         PERFORM DP013-0000-PROCESS-ABEND                         33400000
334100     END-IF.                                                      33410000
334200                                                                  33420000
334300/                                                                 33430000
334400*----------------------------------------------------------------*33440000
334500*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *33450000
334600*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *33460000
334700*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *33470000
334800*  THE USER.                                                     *33480000
334900*----------------------------------------------------------------*33490000
335000 6000-REFRESH-PANEL-FROM-TEMP.                                    33500000
335100                                                                  33510000
335200     IF  ASC-UPDATE-TSQ                                           33520000
335300         SET ASC-NO-TSQ-UPDATE     TO TRUE                        33530000
335400         MOVE ZERO                 TO PV-SAVE-ITEM                33540000
335500                                      PV-SEL-QUEUE-ITEM           33550000
335600         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        33560000
335700                                   TO PV-HOLD-SELECTED-ITEMS      33570000
335800         PERFORM 6100-UPDATE-TSQ                                  33580000
335900             UNTIL PV-ITEMS-PROCESSED >                           33590000
336000                                     ASC-NUMBER-OF-SELECTED-ITEMS 33600000
336100         PERFORM 6010-DELETE-SEL-QUEUE                            33610000
336200         INITIALIZE ASC-BLOCK-ENTRIES (1)                         33620000
336300                    ASC-BLOCK-ENTRIES (2)                         33630000
336400     END-IF.                                                      33640000
336500                                                                  33650000
336600/                                                                 33660000
336700*----------------------------------------------------------------*33670000
336800*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *33680000
336900*----------------------------------------------------------------*33690000
337000 6010-DELETE-SEL-QUEUE.                                           33700000
337100                                                                  33710000
337200     EXEC CICS                                                    33720000
337300         DELETEQ TS                                               33730000
337400             QUEUE (ASC-SEL-QUEUE-NAME-OUT)                       33740000
337500             RESP  (PV-CICS-RESP)                                 33750000
337600     END-EXEC.                                                    33760000
337700                                                                  33770000
337800     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      33780000
337900         (PV-CICS-RESP = DFHRESP(QIDERR)))                        33790000
338000         CONTINUE                                                 33800000
338100     ELSE                                                         33810000
338200         SET DP013-CICS-ABEND      TO TRUE                        33820000
338300         SET DP013-NO-ROLLBACK     TO TRUE                        33830000
338400         MOVE '6010-DELETE-SEL-QUEUE'                             33840000
338500                                   TO DP013-PARAGRAPH             33850000
338600         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         33860000
338700                                   TO DP013-MESSAGE-TEXT (1)      33870000
338800         PERFORM DP013-0000-PROCESS-ABEND                         33880000
338900     END-IF.                                                      33890000
339000                                                                  33900000
339100/                                                                 33910000
339200*----------------------------------------------------------------*33920000
339300*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *33930000
339400*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *33940000
339500*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *33950000
339600*    THE TEMP QUEUE.                                             *33960000
339700*----------------------------------------------------------------*33970000
339800                                                                  33980000
339900 6100-UPDATE-TSQ.                                                 33990000
340000                                                                  34000000
340100     ADD 1                         TO PV-SEL-QUEUE-ITEM.          34010000
340200     PERFORM 6105-READ-SEL-QUEUE.                                 34020000
340300                                                                  34030000
340400     PERFORM                                                      34040000
340500         VARYING TR006-IDX                                        34050000
340600         FROM 1 BY 1                                              34060000
340700         UNTIL ((PV-ITEMS-PROCESSED >                             34070000
340800                              PV-HOLD-SELECTED-ITEMS)             34080000
340900         OR (TR006-IDX GREATER THAN TR006-MAX-ITEMS))             34090000
341000         IF  TR006-ACTION-SW (TR006-IDX) > SPACE                  34100000
341100             PERFORM 6110-PROCESS-ITEMS                           34110000
341200         END-IF                                                   34120000
341300         ADD +1                    TO PV-ITEMS-PROCESSED          34130000
341400     END-PERFORM.                                                 34140000
341500                                                                  34150000
341600     PERFORM 6111-WRITE-LIST-QUEUE.                               34160000
341700                                                                  34170000
341800/                                                                 34180000
341900*----------------------------------------------------------------*34190000
342000*    READ THE LIST QUEUE RECORD.                                 *34200000
342100*----------------------------------------------------------------*34210000
342200                                                                  34220000
342300 6105-READ-SEL-QUEUE.                                             34230000
342400                                                                  34240000
342500     EXEC CICS                                                    34250000
342600          READQ TS                                                34260000
342700              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      34270000
342800              INTO  (TR006-DOCK-SCHEDULE-REC)                     34280000
342900              ITEM  (PV-SEL-QUEUE-ITEM)                           34290000
343000              RESP  (PV-CICS-RESP)                                34300000
343100     END-EXEC.                                                    34310000
343200                                                                  34320000
343300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          34330000
343400         CONTINUE                                                 34340000
343500     ELSE                                                         34350000
343600         SET DP013-CICS-ABEND      TO TRUE                        34360000
343700         SET DP013-NO-ROLLBACK     TO TRUE                        34370000
343800         MOVE '6105-READ-SEL-QUEUE'                               34380000
343900                                   TO DP013-PARAGRAPH             34390000
344000         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           34400000
344100                                   TO DP013-MESSAGE-TEXT(1)       34410000
344200         PERFORM DP013-0000-PROCESS-ABEND                         34420000
344300     END-IF.                                                      34430000
344400                                                                  34440000
344500/                                                                 34450000
344600*----------------------------------------------------------------*34460000
344700*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*34470000
344800*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*34480000
344900*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *34490000
345000*----------------------------------------------------------------*34500000
345100                                                                  34510000
345200 6110-PROCESS-ITEMS.                                              34520000
345300                                                                  34530000
345400     COMPUTE PV-ITEM = 1 + ((TR006-ITEM (TR006-IDX) - 1)          34540000
345500                     / PC-ITEMS-PER-PANEL).                       34550000
345600                                                                  34560000
345700     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           34570000
345800         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          34580000
345900             PERFORM 6111-WRITE-LIST-QUEUE                        34590000
346000         END-IF                                                   34600000
346100         MOVE PV-ITEM              TO PV-SAVE-ITEM                34610000
346200                                                                  34620000
346300         PERFORM 6112-READ-LIST-QUEUE                             34630000
346400         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               34640000
346500             CONTINUE                                             34650000
346600         END-IF                                                   34660000
346700     END-IF.                                                      34670000
346800                                                                  34680000
346900     COMPUTE PV-SUB = (TR006-ITEM (TR006-IDX)                     34690000
347000                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              34700000
347100                                                                  34710000
347200     SET LQW-DESELECT (PV-SUB)     TO TRUE.                       34720000
347300     MOVE LQW-SELECTED-SW (PV-SUB) TO LQW-TEMP-SELECTED-SW        34730000
347400                                     (PV-SUB).                    34740000
347500                                                                  34750000
347600     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                34760000
347700                                                                  34770000
347800/                                                                 34780000
347900*----------------------------------------------------------------*34790000
348000*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *34800000
348100*----------------------------------------------------------------*34810000
348200                                                                  34820000
348300 6111-WRITE-LIST-QUEUE.                                           34830000
348400                                                                  34840000
348500     EXEC CICS                                                    34850000
348600         WRITEQ TS                                                34860000
348700             QUEUE (ASC-LIST-QUEUE-NAME)                          34870000
348800             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     34880000
348900             ITEM  (PV-SAVE-ITEM)                                 34890000
349000             REWRITE                                              34900000
349100             RESP  (PV-CICS-RESP)                                 34910000
349200     END-EXEC.                                                    34920000
349300                                                                  34930000
349400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          34940000
349500         CONTINUE                                                 34950000
349600     ELSE                                                         34960000
349700         SET DP013-CICS-ABEND      TO TRUE                        34970000
349800         SET DP013-NO-ROLLBACK     TO TRUE                        34980000
349900         MOVE '6111-WRITE-LIST-QUEUE'                             34990000
350000                                   TO DP013-PARAGRAPH             35000000
350100         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  35010000
350200                                   TO DP013-MESSAGE-TEXT(1)       35020000
350300         PERFORM DP013-0000-PROCESS-ABEND                         35030000
350400     END-IF.                                                      35040000
350500                                                                  35050000
350600/                                                                 35060000
350700*----------------------------------------------------------------*35070000
350800*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*35080000
350900*----------------------------------------------------------------*35090000
351000                                                                  35100000
351100 6112-READ-LIST-QUEUE.                                            35110000
351200                                                                  35120000
351300     EXEC CICS                                                    35130000
351400         READQ TS                                                 35140000
351500             QUEUE (ASC-LIST-QUEUE-NAME)                          35150000
351600             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     35160000
351700             ITEM  (PV-ITEM)                                      35170000
351800             RESP  (PV-CICS-RESP)                                 35180000
351900     END-EXEC.                                                    35190000
352000                                                                  35200000
352100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          35210000
352200         CONTINUE                                                 35220000
352300     ELSE                                                         35230000
352400         SET DP013-CICS-ABEND      TO TRUE                        35240000
352500         SET DP013-NO-ROLLBACK     TO TRUE                        35250000
352600         MOVE '6112-READ-LIST-QUEUE'                              35260000
352700                                   TO DP013-PARAGRAPH             35270000
352800         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    35280000
352900                                   TO DP013-MESSAGE-TEXT(1)       35290000
353000         PERFORM DP013-0000-PROCESS-ABEND                         35300000
353100     END-IF.                                                      35310000
353200                                                                  35320000
353300/                                                                 35330000
353400******************************************************************35340000
353500* DELETE THE LIST QUEUE WHEN PREV-SEL OR NEXT-SEL WAS ENTERED.   *35350000
353600******************************************************************35360000
353700 6200-DEL-LIST-QUEUE.                                             35370000
353800                                                                  35380000
353900     EXEC CICS                                                    35390000
354000         DELETEQ TS                                               35400000
354100             QUEUE (ASC-LIST-QUEUE-NAME)                          35410000
354200             RESP  (PV-CICS-RESP)                                 35420000
354300     END-EXEC.                                                    35430000
354400                                                                  35440000
354500     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      35450000
354600        (PV-CICS-RESP = DFHRESP(QIDERR)))                         35460000
354700         CONTINUE                                                 35470000
354800     ELSE                                                         35480000
354900        SET DP013-CICS-ABEND       TO TRUE                        35490000
355000        SET DP013-NO-ROLLBACK      TO TRUE                        35500000
355100        MOVE '6200-DEL-LIST-QUEUE' TO DP013-PARAGRAPH             35510000
355200        MOVE 'ERROR TRYING TO DELETE LIST TS QUEUE'               35520000
355300                                   TO DP013-MESSAGE-TEXT (1)      35530000
355400        PERFORM DP013-0000-PROCESS-ABEND                          35540000
355500     END-IF.                                                      35550000
355600                                                                  35560000
355700/                                                                 35570000
355800******************************************************************35580000
355900* READ AN ITEM FROM THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *35590000
356000******************************************************************35600000
356100 9100-READ-SEL-QUEUE.                                             35610000
356200     EXEC CICS                                                    35620000
356300         READQ TS                                                 35630000
356400             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        35640000
356500             INTO  (TR006-DOCK-SCHEDULE-REC)                      35650000
356600             ITEM  (ASC-SEL-ITEM)                                 35660000
356700             RESP  (PV-CICS-RESP)                                 35670000
356800     END-EXEC.                                                    35680000
356900                                                                  35690000
357000     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        35700000
357100         CONTINUE                                                 35710000
357200     ELSE                                                         35720000
357300         SET DP013-LOGIC-ABEND                                    35730000
357400             DP013-NO-ROLLBACK     TO TRUE                        35740000
357500         MOVE '9100-READ-SEL-QUEUE'                               35750000
357600                                   TO DP013-PARAGRAPH             35760000
357700         MOVE 'ATTEMPTING TO READ TO LIST SELECTIONS TS QUEUE'    35770000
357800                                   TO DP013-MESSAGE-TEXT (1)      35780000
357900         PERFORM DP013-0000-PROCESS-ABEND                         35790000
358000     END-IF.                                                      35800000
358100                                                                  35810000
358200/                                                                 35820000
358300******************************************************************35830000
358400* UPDATE AN ITEM IN THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *35840000
358500******************************************************************35850000
358600 9200-REWRITE-LIST-QUEUE.                                         35860000
358700     EXEC CICS                                                    35870000
358800          WRITEQ TS                                               35880000
358900              QUEUE   (ASC-SEL-QUEUE-NAME-IN)                     35890000
359000              FROM    (TR006-DOCK-SCHEDULE-REC)                   35900000
359100              ITEM    (ASC-SEL-ITEM)                              35910000
359200              RESP    (PV-CICS-RESP)                              35920000
359300              REWRITE                                             35930000
359400     END-EXEC.                                                    35940000
359500                                                                  35950000
359600     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    35960000
359700         SET DP013-CICS-ABEND                                     35970000
359800             DP013-NO-ROLLBACK     TO TRUE                        35980000
359900         MOVE '9200-REWRITE-LIST-QUEUE'                           35990000
360000                                   TO DP013-PARAGRAPH             36000000
360100         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   36010000
360200                                   TO DP013-MESSAGE-TEXT (1)      36020000
360300         PERFORM DP013-0000-PROCESS-ABEND                         36030000
360400     END-IF.                                                      36040000
360500                                                                  36050000
360600/                                                                 36060000
360700*----------------------------------------------------------------*36070000
360800*    ABEND PROCESSOR MODULE                                      *36080000
360900*----------------------------------------------------------------*36090000
361000                                                                  36100000
361100     COPY DPPD013.                                                36110000
