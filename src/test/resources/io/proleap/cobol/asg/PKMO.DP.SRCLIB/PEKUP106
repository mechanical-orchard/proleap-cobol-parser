000100*----------------------------------------------------------------*00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*----------------------------------------------------------------*00030000
000400 PROGRAM-ID.    PEKUP106.                                         00040000
000500 AUTHOR.        CHUCK HERO - GENESIS 10.                          00050000
000600 DATE-WRITTEN.  09 NOVEMBER 2007.                                 00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900*----------------------------------------------------------------*00090000
001000*          ** MAINTAIN THE PET_CLR_EVNT TABLES **                *00100000
001100*----------------------------------------------------------------*00110000
001200*   THIS PROGRAM PROCESSES A FILE OF INFORMATION CREATED BY A     00120000
001300*   VALIDATION PROGRAM FROM AN INPUT CSV FILE.                    00130000
001400*   EACH RECORD ON THE FILE REPRESENTS A MARKDOWN EVENT.          00140000
001500*   THE PRIMARY (CORRELATION) KEY IS GENERATED AS A GUID NUMBER   00150000
001600*   WITHIN THE ORIGINAL SOURCE SPREADSHEET.                       00160000
001700* (VALIDATION PROGRAM DETERMINES WHETHER THE EVENT IS NEW OR IF I 00170000
001800*   ALREADY EXISTS IN PET_CLR_EVNT, BASED UPON THE GUI_LOD_ID.)   00180000
001900*   IF IT IS MARKED AS AN UPDATE, AN UPDATE IS ATTEMPTED.         00190000
002000*   IF IT IS MARKED AS AN ADD, AN INSERT IS ATTEMPTED.            00200000
002100*   IF IT IS MARKED AS A DELETE, WE ARE GOING TO MARK THE EVENT   00210000
002200*   INACTIVE IN THE DATABASE.                                     00220000
002300*                                                                 00230000
002400*   IF THE MOS EFFECTIVE DATES FOR A MKDN_CDE FOR AN EVENT        00240000
002500*   ARE ABSENT, WE PLUG IN A PSEUDO DATE - WHICH IS THE LAST      00250000
002600*   DAY OF THE NEXT SEASON, AND WE MARK THESE DATES AS INACTIVE.  00260000
002700*                                                                 00270000
002800*   WE ALSO CONTINUE ON AND CALL STORED PROCEDURES THAT           00280000
002900*   DO THE APPROPRIATE DELETE, UPDATE, OR INSERT FOR ALL          00290000
003000*   OF THE PROJECTIONS AFFECTED BY THE EVENT CALENDAR CHANGES.    00300000
003100*   - ANY ERRORS UPDATING PROJECTIONS ENCOUNTERED BY THE STORED   00310000
003200*     PROCEDURES ARE WRITTEN TO A TEMPORARY ORACLE TABLE.         00320000
003300*     THIS TEMP TABLE IS DELETED UPON THE END OF THIS PROGRAM.    00330000
003400*   - THE PROGRAM THEN EXECUTES A CURSOR TO EXTRACT ANY ERROR ROWS00340000
003500*     WRITTEN TO THE TEMPORARY ERROR TABLE IN ORACLE.             00350000
003600*   - EACH ROW FOUND IS OUTPUT TO AN ERROR FILE, AND THE UPDATE   00360000
003700*     NOTIFICATION E-MAIL HAS A NOTE ADDED TO IT INDICATING THAT  00370000
003800*     ERRORS WERE ENCOUNTERED IN THE PROJECTION UPDATES.          00380000
003900*                                                                 00390000
004000*   A CALENDAR UPDATE E-MAIL FILE IS WRITTEN UPON SUCCESSFUL      00400000
004100*   UPDATE OF THE TABLES.                                         00410000
004200*   - A LATER JOBSTEP SENDS THE E-MAIL TO THE RECIPIENTS.         00420000
004300*   - THIS E-MAIL WILL INCLUDE A NOTE IF ANY PROJECTION UPDATE    00430000
004400*     ERRORS WERE ENCOUNTERED.                                    00440000
004500*                                                                 00450000
004600*   THE TABLES BEING MAINTAINED ARE IN TWO ORACLE DATABASES.      00460000
004700*                                                                 00470000
004800*   TWO DATE CONTROL FILES ARE INPUT INTO THIS PROGRAM:           00480000
004900*   - INP02 HAS DATE-TIMESTAMP OF THE LAST RUN OF THIS PROGRAM.   00490000
005000*   - INP03 HAS THE DATE-TIMESTAMP OF THE LAST SUCCESSFUL         00500000
005100*     EXECUTION OF THE VALIDATION PROCESS (PAK905).               00510000
005200*   IF THE DATE-TIMESTAMP IN INP03 IS NOT GREATER THAN THAT IN    00520000
005300*    INP02, THERE IS NOTHING NEW TO PROCESS, AND THE PROGRAM      00530000
005400*    WILL OUTPUT A NEW RECORD FOR THE RUN TIMESTAMP CARD, AND     00540000
005500*    TERMINATE WITH RC=4090.                                      00550000
005600*                                                                 00560000
005700*----------------------------------------------------------------*00570000
005800* HISTORY LOG:                                                    00580000
005900*----------------------------------------------------------------*00590000
006800* DATE:       2008-05-06                                          00600000
006900* WR/IR#:     WR#30737                                            00610000
007000* PROGRAMMER: RILEY KEHOE (KOHLS)                                 00620000
007100* DESCRIPTION: INITIAL IMPLEMENTATION.                            00630000
007300*                                                                 00640000
005900*----------------------------------------------------------------*00650000
006800* DATE: 2008-06-05                                                00660001
006900* WR/IR#: WR#30737                                                00670001
007000* PROGRAMMER: RILEY KEHOE                                         00680001
007100* DESCRIPTION: ADDITIONAL MARK ADDING                             00690001
007300*                                                                 00700000
007400*----------------------------------------------------------------*00710000
091608* DATE: 2008-09-16                                                00711013
091608* WR/IR#: WR#35421                                                00712013
091608* PROGRAMMER: JOHN BOLDT - STRATAGEM                              00713013
091608* DESCRIPTION: ADD SIX NEW COLUMNS TO PET_CLR_EVNT TABLE.         00714013
091608*                                                                 00715013
091608*----------------------------------------------------------------*00716013
091608* DATE:  2018-07-24                                               00711013
091608* WR/IR#: CHG0203891                                              00712013
091608* PROGRAMMER: MICHAEL LIESENER                                    00713013
091608* DESCRIPTION: UPDATE ORACLE LOGIN EXTERNALIZATION FOR MF REFACTOR00714013
091608*              REMOVE PA REFERENCES FROM JOB                      00715013
091608*----------------------------------------------------------------*00716013
1020ML* DATE:  2020-10-28                                               00711013
1020ML* WR/IR#: CHG0250359                                              00712013
1020ML* PROGRAMMER: MICHAEL LIESENER                                    00713013
1020ML* DESCRIPTION: CHANGED TO ALLOW EVENTS LONGER THAN 3 SEASONS DUE  00714013
1020ML*              TO COVID AND MADE LESS DEPENDENT ON ORACLE         00715013
1020ML*              DATABASE DATE FORMAT                                       
1020ML*----------------------------------------------------------------*00716013
007500 ENVIRONMENT DIVISION.                                            00720000
007600*----------------------------------------------------------------*00730000
007700 CONFIGURATION SECTION.                                           00740000
007800 SOURCE-COMPUTER. IBM-3090.                                       00750000
007900 OBJECT-COMPUTER. IBM-3090.                                       00760000
008000                                                                  00770000
008100 INPUT-OUTPUT SECTION.                                            00780000
008200                                                                  00790000
008300 FILE-CONTROL.                                                    00800000
008400                                                                  00810000
008500     SELECT VLDTD-EVENT-FILE                  ASSIGN TO INP01.    00820000
008600                                                                  00830000
008700     SELECT DTE-CNTL-EXEC-INFILE              ASSIGN TO INP02.    00840000
008800                                                                  00850000
008900     SELECT DTE-CNTL-VLDT-FILE                ASSIGN TO INP03.    00860000
009000                                                                  00870000
0618ML     SELECT ORACLE-LOGON-FILE                 ASSIGN TO ORALOGON. 00880000
009200                                                                  00890000
009300     SELECT PRJCTN-UPDTE-ERROR-FILE           ASSIGN TO OUT01.    00900000
009400                                                                  00910000
009500     SELECT EMAIL-OUTFILE                     ASSIGN TO OUT02.    00920000
009600                                                                  00930000
009700     SELECT DTE-CNTL-EXEC-OUTFILE             ASSIGN TO OUT03.    00940000
009800                                                                  00950000
009900*----------------------------------------------------------------*00960000
010000 DATA DIVISION.                                                   00970000
010100*----------------------------------------------------------------*00980000
010200 FILE SECTION.                                                    00990000
010300                                                                  01000000
010400 FD  VLDTD-EVENT-FILE                                             01010000
010500     RECORDING MODE IS F                                          01020000
010600     LABEL RECORDS ARE STANDARD                                   01030000
010700     BLOCK CONTAINS 0 RECORDS.                                    01040000
010800                                                                  01050000
010900 01  VLDTD-EVENT-RECORD            PIC X(212).                    01060003
011000                                                                  01070000
011100 FD  DTE-CNTL-EXEC-INFILE                                         01080000
011200     RECORDING MODE IS F                                          01090000
011300     LABEL RECORDS ARE STANDARD                                   01100000
011400     BLOCK CONTAINS 0 RECORDS.                                    01110000
011500                                                                  01120000
011600 01  DTE-CNTL-EXECIN-RECORD          PIC X(080).                  01130000
011700                                                                  01140000
011800 FD  DTE-CNTL-VLDT-FILE                                           01150000
011900     RECORDING MODE IS F                                          01160000
012000     LABEL RECORDS ARE STANDARD                                   01170000
012100     BLOCK CONTAINS 0 RECORDS.                                    01180000
012200                                                                  01190000
012300 01  DTE-CNTL-VLDT-RECORD          PIC X(080).                    01200000
012400                                                                  01210000
0618ML FD  ORACLE-LOGON-FILE                                                    
0618ML     RECORDING MODE IS F                                                  
0618ML     LABEL RECORDS ARE STANDARD                                           
0618ML     BLOCK CONTAINS 0 RECORDS                                             
0618ML     RECORD CONTAINS 80 CHARACTERS                                        
0618ML     DATA RECORDS IS OL-ORACLE-LOGON-RECORD.                              
0618ML                                                                          
0618ML 01  OL-ORACLE-LOGON-RECORD        PIC X(80).                             
013300                                                                  01300000
013400 FD  PRJCTN-UPDTE-ERROR-FILE                                      01310000
013500     RECORDING MODE IS F                                          01320000
013600     LABEL RECORDS ARE STANDARD                                   01330000
013700     RECORD CONTAINS 4096 CHARACTERS                              01340000
013800     BLOCK CONTAINS 0 RECORDS.                                    01350000
013900                                                                  01360000
014000 01  PRJCTN-UPDTE-ERROR-RECORD     PIC X(4096).                   01370000
014100                                                                  01380000
014200 FD  EMAIL-OUTFILE                                                01390000
014300     RECORDING MODE IS F                                          01400000
014400     LABEL RECORDS ARE STANDARD                                   01410000
014500     BLOCK CONTAINS 0 RECORDS.                                    01420000
014600                                                                  01430000
014700 01  EMAIL-OUT-RECORD              PIC X(080).                    01440000
014800                                                                  01450000
014900 FD  DTE-CNTL-EXEC-OUTFILE                                        01460000
015000     RECORDING MODE IS F                                          01470000
015100     LABEL RECORDS ARE STANDARD                                   01480000
015200     BLOCK CONTAINS 0 RECORDS.                                    01490000
015300                                                                  01500000
015400 01  DTE-CNTL-EXECOUT-RECORD          PIC X(080).                 01510000
015500                                                                  01520000
015600*----------------------------------------------------------------*01530000
015700                                                                  01540000
015800 WORKING-STORAGE SECTION.                                         01550000
0618ML 01 CC-ORACLE-CONNECTION.                                                 
0618ML    05  CC-ORACLE-USERID       PIC  X(40).                                
0618ML        88 CC-AUTO-LOGON                   VALUE '/'.                     
0618ML    05  CC-ORACLE-PASSWORD     PIC  X(40).                                
015900*----------------------------------------------------------------*01560000
016000* COPYBOOK - VERIFIED EVENT CALENDAR INPUT FILE LAYOUT           *01570000
016100*----------------------------------------------------------------*01580000
016200     COPY PARD905.                                                01590000
016300*----------------------------------------------------------------*01600000
016400* COPYBOOK - VALIDATION SUCCESSFUL EXECUTION DATE CONTROL CARD   *01610000
016500*----------------------------------------------------------------*01620000
016600     COPY PARD025.                                                01630000
016700                                                                  01640000
016800*----------------------------------------------------------------*01650000
016900* RECORD LAYOUT - LAST EXECUTION DATE CARD                       *01660000
017000*----------------------------------------------------------------*01670000
017100     COPY PARD035.                                                01680000
017200                                                                  01690000
017300*----------------------------------------------------------------*01700000
017400* PV- PROGRAM STATUS                                             *01710000
017500*----------------------------------------------------------------*01720000
017600 01 PV-PROGRAM-STATUS.                                            01730000
017700    05  FILLER                        PIC X(27)  VALUE            01740000
017800        'WORKING STORAGE STARTS HERE'.                            01750000
017900    05  PV-PARAGRAPH-NAME             PIC X(50)  VALUE SPACES.    01760000
018000    05  PV-ORA-OPERATION              PIC X(50)  VALUE SPACES.    01770000
018100    05  PV-OPERATION-MSG-1            PIC X(40)  VALUE SPACES.    01780000
018200    05  PV-OPERATION-MSG-2            PIC X(40)  VALUE SPACES.    01790000
018300 01  FILLER                           REDEFINES                   01800000
018400     PV-PROGRAM-STATUS                PIC X(207).                 01810000
018500                                                                  01820000
018600 01  AC-ABEND-CODE                    PIC S9(04) VALUE +0 COMP.   01830000
018700     88  AC-4003-CONTROL-CARD-ERROR              VALUE +4003.     01840000
018800     88  AC-4008-INPUT-FILE-ERROR                VALUE +4008.     01850000
018900     88  AC-4013-ORA-ERROR                       VALUE +4013.     01860000
019000     88  AC-4019-CALENDAR-ROUTINE-ERROR          VALUE +4019.     01870000
019100                                                                  01880000
019200*----------------------------------------------------------------*01890000
019300* PC- PROGRAM CONSTANTS                                          *01900000
019400*----------------------------------------------------------------*01910000
019500 01  PC-PROGRAM-CONSTANTS.                                        01920000
019600     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'PEKUP106'.01930000
019700     05  PC-MAX-RETRIES               PIC  9(01) VALUE 5.         01940000
019800     05  PC-MAX-NUM-MARKS             PIC  9(01) VALUE 7.         01950001
019900     05  PC-FIELD-LENGTH              PIC S9(03) VALUE +10 COMP-3.01960000
020000     05  PC-DFLT-MKDN-QTY-TYP-CDE     PIC  X(03) VALUE 'PCT'.     01970000
020100     05  PC-NO-ACTIONS-FOR-FILE       PIC  X(52) VALUE            01980000
020200         'NO EVENT INSERT OR UPDATE ACTIONS WERE FOUND IN FILE'.  01990000
020300     05  PC-NO-EVENTS-IN-FILE         PIC  X(35) VALUE            02000000
020400                          'NO USABLE EVENTS WERE FOUND IN FILE'.  02010000
020500     05  PC-NO-RECORDS-IN-FILE        PIC  X(43) VALUE            02020000
020600                  'EMPTY INPUT - NO RECORDS WERE FOUND IN FILE'.  02030000
020700     05  PC-BAD-VALIDATION-DTE        PIC  X(40) VALUE            02040000
020800                  'BAD DATE IN VALIDATION DATE CONTROL FILE'.     02050000
020900     05  PC-BAD-UPDATE-DTE            PIC  X(41) VALUE            02060000
021000                  'BAD DATE IN LAST UPDATE DATE CONTROL FILE'.    02070000
021100     05  PC-STORED-PROC-ERRS-FND      PIC  X(53) VALUE            02080000
021200         ' ONE OR MORE PROJECTIONS NOT UPDATED - SEE ERROR FILE'. 02090000
091608     05  PC-PAK106                    PIC  X(08) VALUE 'PAK106'.  02091013
0618ML     05  PC-AUTO-LOGON                PIC  X(01) VALUE '/'.               
021300                                                                  02100000
021400*----------------------------------------------------------------*02110000
021500* PS- PROGRAM SWITCHES                                           *02120000
021600*----------------------------------------------------------------*02130000
021700 01  PS-PROGRAM-SWITCHES.                                         02140000
021800     05  PS-END-OF-INPUT-SW           PIC X(01)  VALUE 'N'.       02150000
021900         88  PS-END-OF-INPUT                     VALUE 'Y'.       02160000
022000         88  PS-NOT-END-OF-INPUT                 VALUE 'N'.       02170000
022100     05  PS-END-OF-EXEC-INPUT-SW      PIC X(01)  VALUE 'N'.       02180000
022200         88  PS-END-OF-EXEC-CNTL                 VALUE 'Y'.       02190000
022300         88  PS-NOT-END-OF-EXEC-CNTL             VALUE 'N'.       02200000
022400     05  PS-END-OF-VLDT-INPUT-SW      PIC X(01)  VALUE 'N'.       02210000
022500         88  PS-END-OF-VLDT-DTE-CNTL             VALUE 'Y'.       02220000
022600         88  PS-NOT-END-OF-VLDT-DTE-CNTL         VALUE 'N'.       02230000
022700     05  PS-DATE-BEING-CHECKED-SW     PIC X(01)  VALUE SPACE.     02240000
022800         88  PS-CHKING-LAST-UPDTE-DTE            VALUE 'U'.       02250000
022900         88  PS-CHKING-VALIDATION-DTE            VALUE 'V'.       02260000
023000     05  PS-INPUT-ERROR-SW            PIC X(01)  VALUE 'N'.       02270000
023100         88  PS-INPUT-ERROR                      VALUE 'Y'.       02280000
023200         88  PS-NO-INPUT-ERROR                   VALUE 'N'.       02290000
023300     05  PS-UPDATES-TO-PROCESS-SW     PIC X(01)  VALUE 'N'.       02300000
023400         88  PS-UPDATES-TO-PROCESS               VALUE 'Y'.       02310000
023500         88  PS-NO-UPDATES-TO-PROCESS            VALUE 'N'.       02320000
023600     05  PS-PSEUDO-MOS-MARK-SW        PIC X(01)  VALUE 'N'.       02330000
023700         88  PS-PSEUDO-MARK                      VALUE 'Y'.       02340000
023800         88  PS-NOT-PSEUDO-MARK                  VALUE 'N'.       02350000
024500     05  PS-ERROR-EMAIL-NEEDED-SW     PIC X(01)  VALUE 'N'.       02420000
024600         88  PS-ERROR-EMAIL-NEEDED               VALUE 'Y'.       02430000
024700         88  PS-NO-ERROR-EMAIL-NEEDED            VALUE 'N'.       02440000
024800     05  PS-READY-TRACE-SW            PIC X(01)  VALUE 'N'.       02450000
024900         88  PS-READY-TRACE                      VALUE 'Y'.       02460000
025000         88  PS-RESET-TRACE                      VALUE 'N'.       02470000
025100     05  PS-UPDATE-EVNT-SW            PIC X(01)  VALUE 'N'.       02480000
025200         88  PS-UPDATE-REQUIRED                  VALUE 'Y'.       02490000
025300         88  PS-NO-UPDATE-REQUIRED               VALUE 'N'.       02500000
091608     05  PS-ACTV-SW                   PIC X(01)  VALUE 'N'.       02501014
091608         88  PS-ACTV                             VALUE 'Y'.       02502014
091608         88  PS-NOT-ACTV                         VALUE 'N'.       02503014
0618ML     05  PS-END-OF-LOGON-FILE-SW      PIC  X(01) VALUE 'N'.               
0618ML         88  PS-END-OF-LOGON-FILE                VALUE 'Y'.               
025400                                                                  02510000
025500*----------------------------------------------------------------*02520000
025600* PV- PROGRAM VARIABLES                                          *02530000
025700*----------------------------------------------------------------*02540000
026300 01  PV-PROGRAM-VARIABLES.                                        02600000
026400     05  PV-BYTE-COUNT                PIC  9(04) VALUE ZERO.      02610000
026500     05  PV-SQL-SUB                   PIC  9(01) VALUE ZERO.      02620000
026600     05  PV-SQLCODE                   PIC  9(09) VALUE 0.         02630000
026700     05  PV-BKUP-ACTV-IND             PIC  X(01).                 02640000
026900     05  PV-TALLY                     PIC S9(03) COMP-3 VALUE +0. 02660000
027000     05  PV-INIT-MAX-CLR-EVNT-ID      PIC S9(10) COMP-3 VALUE +0. 02670000
027100     05  PV-NEXT-CLR-EVNT-ID          PIC S9(10) COMP VALUE +0.   02680000
027200     05  PV-LY-EVNT-GUI-LOD-ID        PIC S9(10) COMP-3 VALUE +0. 02690000
027300     05  PV-MKDN-COUNT                PIC  9(07) VALUE ZERO.      02700001
0618ML     05  PV-ORACLE-USERID-LEN         PIC S9(04) VALUE ZEROS              
0618ML                                        COMP SYNC.                        
0618ML     05  PV-ORACLE-PASSWORD-LEN       PIC S9(04) VALUE ZEROS              
0618ML                                        COMP SYNC.                        
027400                                                                  02710000
027500 01  PV-DISPLAY-VARIABLES.                                        02720000
027600     05  PV-DISP-MAX-CLR-EVNT-ID      PIC  9(10) VALUE ZEROES.    02730000
027700     05  PV-DISP-NEXT-CLR-EVNT-ID     PIC  9(10) VALUE ZEROES.    02740000
027800     05  PV-DISP-CLR-EVNT-ID          PIC  9(10) VALUE ZEROES.    02750000
027900     05  PV-DISP-CLR-EVNT-GUI-ID      PIC  9(10) VALUE ZEROES.    02760000
028000     05  PV-DISP-LY-CLR-EVNT-ID       PIC  9(10) VALUE ZEROES.    02770000
091608     05  PV-DISP-ACTV-IND             PIC  X(01) VALUE SPACES.            
091608     05  PV-DISP-BEG-FSCL-YR          PIC  9(04) VALUE ZEROES.            
028100     05  PV-DISP-LY-EVNT-GUI-ID       PIC  9(10) VALUE ZEROES.    02780000
028200     05  PV-DISP-EA-CLR-EVNT-ID       PIC  9(10) VALUE ZEROES.    02790000
028300     05  PV-DISP-EA-LY-CLR-EVNT-ID    PIC  9(10) VALUE ZEROES.    02800000
028400     05  PV-DISP-EA-GUI-LOD-ID        PIC  9(10) VALUE ZEROES.    02810000
028500     05  PV-DISP-CLR-FRST-EFF-DTE     PIC  X(20) VALUE SPACES.    02820000
028600     05  PV-DISP-UPD                  PIC  9(09) VALUE ZEROES.    02830000
028700     05  PV-DISP-PRJCTN-ID            PIC  9(10) VALUE ZEROES.    02840000
028800     05  PV-DISP-EVNT-YR-NBR          PIC  9(04) VALUE ZEROES.    02850000
028900     05  PV-DISP-EVNT-WK-NBR          PIC  9(02) VALUE ZEROES.    02860000
029000                                                                  02870000
029100 01  PV-NULL-INDICATORS.                                          02880000
029200     05  PV-COL-VAR-TXT-1-NULL-IND    PIC S9(04) COMP VALUE ZERO. 02890000
029300     05  PV-COL-VAR-TXT-2-NULL-IND    PIC S9(04) COMP VALUE ZERO. 02900000
029400     05  PV-COL-NBR-1-NULL-IND        PIC S9(04) COMP VALUE ZERO. 02910000
029500     05  PV-LY-CLR-EVNT-NULL-IND      PIC S9(04) COMP VALUE ZERO. 02920000
029600     05  PV-GUI-LOD-ID-NULL-IND       PIC S9(04) COMP VALUE ZERO. 02930000
029700                                                                  02940000
029800 01  PV-DATE-FIELDS.                                              02950000
029900     05  PV-ENDOF-NEXT-SEAS-DATE.                                 02960000
030000         10  PV-NEXTSEAS-YEAR         PIC  X(04).                 02970000
030100         10  FILLER                   PIC  X(01) VALUE '-'.       02980000
030200         10  PV-NEXTSEAS-MONTH        PIC  X(02).                 02990000
030300         10  FILLER                   PIC  X(01) VALUE '-'.       03000000
030400         10  PV-NEXTSEAS-DAY          PIC  X(02).                 03010000
030500     05  PV-DATE-TODAY                PIC  X(10).                 03020000
030600 01  PV-FSCL-DATE.                                                03030000
030700     05  PV-FSCL-DATE.                                            03040000
030800         10  PV-FSCL-YYYY             PIC  X(04).                 03050000
030900         10  FILLER                   PIC  X(01) VALUE '-'.       03060000
031000         10  PV-FSCL-MM               PIC  X(02).                 03070000
031100         10  FILLER                   PIC  X(01) VALUE '-'.       03080000
031200         10  PV-FSCL-DD               PIC  X(02).                 03090000
1020ML 01  PV-LAST-FSCL-DATE.                                                   
1020ML     05  PV-LAST-FSCL-DATE.                                               
1020ML         10  PV-LAST-MARK-DTE         PIC X(10).                          
031300                                                                  03100000
031400 01  PV-MARK-EVENT-ARRAY.                                         03110000
031500     05  PV-MARK-ELEMENT              OCCURS 500 TIMES            03120000
031600                                      INDEXED BY PV-MARKDEX.      03130000
031700         10  PV-MARK-CLR-EVNT-ID      PIC S9(10) COMP-3.          03140000
031800         10  PV-MARK-CLR-MKDN-CDE     PIC X(01).                  03150000
031900         10  PV-MARK-CLR-FRST-EFF-DTE PIC X(10).                  03160000
032000         10  PV-MARK-CLR-LAST-EFF-DTE PIC X(10).                  03170000
032100                                                                  03180000
032200                                                                  03190000
032300 01  PV-DATE-CONVERSION-AREA.                                     03200000
032400     05  PV-DCA-EXTR-DTE              PIC X(19) VALUE             03210000
032500         '1801-01-01 00.00.00'.                                   03220000
032600     05  PV-DCA-PRC-DTE               PIC X(19) VALUE             03230000
032700         '1801-01-01 00.00.00'.                                   03240000
032800                                                                  03250000
032900*----------------------------------------------------------------*03260000
033000* DF- DATE AND TIME FIELDS USED IN P9990-                        *03270000
033100*----------------------------------------------------------------*03280000
033200 01  DF-DATE-TIME-FIELDS.                                         03290000
033300     05  DF-CURRENT-DATE.                                         03300000
033400         10  DF-CURRENT-YR            PIC  9(04) VALUE ZEROS.     03310000
033500         10  DF-CURRENT-MO            PIC  9(02) VALUE ZEROS.     03320000
033600         10  DF-CURRENT-DY            PIC  9(02) VALUE ZEROS.     03330000
033700     05  DF-ACCEPT-DATE.                                          03340000
033800         10  DF-ACCEPT-YR             PIC  9(02) VALUE ZEROS.     03350000
033900         10  DF-ACCEPT-MO             PIC  9(02) VALUE ZEROS.     03360000
034000         10  DF-ACCEPT-DY             PIC  9(02) VALUE ZEROS.     03370000
034100     05  DF-ACCEPT-TIME.                                          03380000
034200         10  DF-ACCEPT-HR             PIC  9(02) VALUE ZEROS.     03390000
034300         10  DF-ACCEPT-MIN            PIC  9(02) VALUE ZEROS.     03400000
034400         10  DF-ACCEPT-SEC            PIC  9(02) VALUE ZEROS.     03410000
034500         10  DF-ACCEPT-HSEC           PIC  9(02) VALUE ZEROS.     03420000
034600     05  DF-DISPLAY-DATE.                                         03430000
034700         10  DF-DD-YR                 PIC  X(04) VALUE SPACES.    03440000
034800         10  FILLER                   PIC  X(01) VALUE '-'.       03450000
034900         10  DF-DD-MO                 PIC  X(02) VALUE SPACES.    03460000
035000         10  FILLER                   PIC  X(01) VALUE '-'.       03470000
035100         10  DF-DD-DY                 PIC  X(02) VALUE SPACES.    03480000
035200     05  DF-DISPLAY-TIME.                                         03490000
035300         10  DF-DT-HR                 PIC  X(02) VALUE SPACE.     03500000
035400         10  FILLER                   PIC  X(01) VALUE ':'.       03510000
035500         10  DF-DT-MIN                PIC  X(02) VALUE SPACE.     03520000
035600         10  FILLER                   PIC  X(01) VALUE ':'.       03530000
035700         10  DF-DT-SEC                PIC  X(02) VALUE SPACE.     03540000
035800                                                                  03550000
035900*----------------------------------------------------------------*03560000
036000* PV- TABLE RECORD VARIABLES                                     *03570000
036100*----------------------------------------------------------------*03580000
036200 01  PV-CLR-EVNT-RECORD.                                          03590000
036300     05  PV-CER-CLR-EVNT-ID           PIC S9(10) COMP-3.          03600000
036400     05  PV-CER-CLR-EVNT-NM           PIC  X(20) VALUE SPACES.    03610000
036500     05  PV-CER-LY-CLR-EVNT-ID        PIC S9(10) COMP-3.          03620000
036600     05  PV-CER-GUI-LOD-ID            PIC S9(10) COMP-3.          03630000
091608     05  PV-CER-ACTV-IND              PIC  X(01) VALUE SPACES.            
091608     05  PV-CER-BEG-FSCL-YR           PIC  9(04) VALUE ZEROS.             
036700                                                                  03640000
036800 01  PV-CLR-MKDN-EVNT-RECORD.                                     03650000
036900     05  PV-CMER-CLR-EVNT-ID          PIC S9(10) COMP-3.          03660000
037000     05  PV-CMER-CLR-MKDN-CDE         PIC  X(01).                 03670000
037100     05  PV-CMER-CLR-FRST-EFF-DTE     PIC  X(19).                 03680000
037200     05  PV-CMER-CLR-LAST-EFF-DTE     PIC  X(19).                 03690000
037300     05  PV-CMER-MKDN-QTY-TYP-CDE     PIC  X(03).                 03700000
037400     05  PV-CMER-MKDN-PCT             PIC S9(03) COMP-3.          03710000
037500     05  PV-CMER-MKDN-PRPT-AMT        PIC S9(03)V9(2) COMP-3.     03720000
037600     05  PV-CMER-EVNT-MKDN-EXTR-DTE   PIC  X(19).                 03730000
037700     05  PV-CMER-EVNT-MKDN-PRC-DTE    PIC  X(19).                 03740000
037800     05  PV-CMER-ACTV-IND             PIC  X(01).                 03750000
037900     05  PV-CMER-CRE-TMST             PIC  X(19).                 03760000
038000     05  PV-CMER-CRE-BY-USR-ID        PIC  X(08).                 03770000
038100     05  PV-CMER-LAST-UPD-TMST        PIC  X(19).                 03780000
038200     05  PV-CMER-LAST-UPD-BY-USR-ID   PIC  X(08).                 03790000
038300                                                                  03800000
038400*----------------------------------------------------------------*03810000
038500* PV- PROGRAM COUNT VARIABLES                                    *03820000
038600*----------------------------------------------------------------*03830000
038700 01  PV-PROGRAM-COUNTERS.                                         03840000
038800     05  PV-CNTL-RECS-READ            PIC  9(09) VALUE 0.         03850000
038900     05  PV-EVNT-RECS-READ            PIC  9(09) VALUE 0.         03860000
039000     05  PV-CLR-EVNT-INS              PIC  9(09) VALUE 0.         03870000
039100     05  PV-CLR-EVNT-UPD              PIC  9(09) VALUE 0.         03880000
039200     05  PV-CLR-EVNT-DEL              PIC  9(09) VALUE 0.         03890000
039300     05  PV-CLR-MKDN-EVNT-INS         PIC  9(09) VALUE 0.         03900000
039400     05  PV-CLR-MKDN-EVNT-UPD         PIC  9(09) VALUE 0.         03910000
039500     05  PV-CLR-MKDN-EVNT-DEL         PIC  9(09) VALUE 0.         03920000
039900     05  PV-ERROR-TABLE-RCD-COUNT     PIC  9(09) VALUE 0.         03960000
040000     05  PV-ERR-RECS-OUT              PIC  9(09) VALUE 0.         03970000
040100     05  PV-ERR-EMAIL-RECS-OUT        PIC  9(09) VALUE 0.         03980000
040200                                                                  03990000
040300*----------------------------------------------------------------*04000000
040400* PV- PROJECTION UPDATE ERROR FILE RECORD                        *04010000
040500*----------------------------------------------------------------*04020000
040600 01  PV-ERR-DATA.                                                 04030000
040700     05  PV-ERR-PRJCTN-ID             PIC  9(010) VALUE ZEROES.   04040000
040800     05  PV-COL-VAR-TXT-1             PIC  X(040) VALUE SPACES.   04050000
040900     05  PV-COL-VAR-TXT-2             PIC  X(4000) VALUE SPACES.  04060000
041000                                                                  04070000
041100*----------------------------------------------------------------*04080000
041200* PV- EVENT ERROR FILE RECORD                                    *04090000
041300*----------------------------------------------------------------*04100000
041400 01  PV-ERROR-RECORD.                                             04110000
041500     05  PV-ERROR-TYPE                PIC X(016) VALUE SPACES.    04120000
041600         88 PV-ERR-TYP-NO-EVNTS          VALUE ' NO EVENTS     *'.04130000
041700         88 PV-ERR-TYP-STORED-PROC       VALUE 'STORED PROC ERR*'.04140000
041800     05  FILLER                       PIC X(001) VALUE SPACE.     04150000
041900     05  PV-ERROR-MESSAGE             PIC X(4050) VALUE SPACES.   04160000
042000                                                                  04170000
042100*----------------------------------------------------------------*04180000
042200* ERROR EMAIL OUTPUT FILE LAYOUT                                 *04190000
042300*----------------------------------------------------------------*04200000
042400 01  EM-ERROR-EMAIL-RECORD.                                       04210000
042500     05 EM-ERROR-TYPE                 PIC  X(08)  VALUE SPACES.   04220000
042600     05 FILLER                        PIC  X(01)  VALUE '*'.      04230000
042700     05 EM-ERROR-MESSAGE              PIC  X(71)  VALUE SPACES.   04240000
042800                                                                  04250000
042900*----------------------------------------------------------------*04260000
043000* UPDATE EMAIL OUTPUT FILE LAYOUT                                *04270000
043100*----------------------------------------------------------------*04280000
043200 01  EM-UPDTE-EMAIL-RECORD1.                                      04290000
043300     05  EM-UPDTE-MESSAGE             PIC  X(37)  VALUE           04300000
043400        ' THE EVENT CALENDAR HAS BEEN UPDATED '.                  04310000
043500     05  EM-DATE-TIME.                                            04320000
043600         10  EM-DATE                  PIC  X(10)  VALUE SPACES.   04330000
043700         10  FILLER                   PIC  X(01)  VALUE '-'.      04340000
043800         10  EM-TIME                  PIC  X(08)  VALUE SPACES.   04350000
043900     05  FILLER                       PIC  X(03)  VALUE ' - '.    04360000
044000     05  FILLER                       PIC  X(21)  VALUE SPACES.   04370000
044100 01  EM-UPDTE-EMAIL-RECORD2.                                      04380000
044200     05  EM-PRJCTN-UPDTE-SUCCESS      PIC  X(50)  VALUE SPACES.   04390000
044300         88  EM-PRJCTN-UPDTE-ALL-SUCCESS          VALUE           04400000
044400        'ALL PROJECTIONS WERE SUCCESSFULLY UPDATED         '.     04410000
044500         88  EM-PRJCTN-UPDTE-ERRORS-FOUND         VALUE           04420000
044600        'SOME PROJECTIONS WERE NOT UPDATED - SEE ERROR FILE'.     04430000
044700     05  FILLER                       PIC  X(30)  VALUE SPACES.   04440000
044800                                                                  04450000
044900*----------------------------------------------------------------*04460000
045000* ORACLE DELARE SECTION START                                    *04470000
045100*----------------------------------------------------------------*04480000
045200     EXEC SQL                                                     04490000
045300        BEGIN DECLARE SECTION                                     04500000
045400     END-EXEC.                                                    04510000
045500                                                                  04520000
045600*----------------------------------------------------------------*04530000
045700* PD- ORA VARIABLES (NON DCLGEN)                                 *04540000
045800*----------------------------------------------------------------*04550000
045900 01  USERNAME                         PIC  X(10)  VARYING.        04560000
046000 01  PASSWD                           PIC  X(10)  VARYING.        04570000
046100 01  PV-ORACLE-ID                     PIC  X(01)  VALUE '/'.      04580000
046200                                                                  04590000
046300*----------------------------------------------------------------*04600000
046400* PET00001 PET_CLR_MKDN_EVNT COPYBOOK                            *04610000
046600*----------------------------------------------------------------*04630000
046700     EXEC SQL                                                     04640000
046800        INCLUDE PET00001                                          04650000
046900     END-EXEC.                                                    04660000
047000                                                                  04670000
047100*----------------------------------------------------------------*04680000
047200* PET00003 PET_CLR_EVNT COPYBOOK                                 *04690000
047400*----------------------------------------------------------------*04710000
047500     EXEC SQL                                                     04720000
047600         INCLUDE PET00003                                         04730000
047700     END-EXEC.                                                    04740000
047800                                                                  04750000
048600*----------------------------------------------------------------*04830000
048700* NO ORACLE DCLGEN - ORACLE VIEW K_DBLINKS.V_TDTATTR OF DB2 TABLE*04840000
048800* SO, USE COBOL DECLARATION FOR TABLE TDTATTR                    *04850000
048900*----------------------------------------------------------------*04860000
049000 01  DCLTDTATTR.                                                  04870000
049100     10 DTATTR-KY-DTE                 PIC   X(10).                04880000
049200     10 DTATTR-FSCL-YR-NBR            PIC   X(4).                 04890000
049300     10 DTATTR-FSCL-MN-NBR            PIC   X(2).                 04900000
049400     10 DTATTR-FSCL-MN-NM             PIC   X(9).                 04910000
049500     10 DTATTR-FSCL-WK-NBR            PIC   X(2).                 04920000
049600     10 DTATTR-WK-IN-MN-NBR           PIC   X(1).                 04930000
049700     10 DTATTR-DAY-NM                 PIC   X(9).                 04940000
049800     10 DTATTR-DAY-OF-WK-NBR          PIC   X(1).                 04950000
049900     10 DTATTR-FSCL-QTR-NBR           PIC   X(1).                 04960000
050000     10 DTATTR-CAL-MN-NBR             PIC   X(2).                 04970000
050100     10 DTATTR-JLN-DTE                PIC  S9(9) COMP.            04980000
050200     10 DTATTR-LY-THIS-DAY-KY-DTE     PIC   X(10).                04990000
050300     10 DTATTR-FSCL-YR-BEG-DTE        PIC   X(10).                05000000
050400     10 DTATTR-FSCL-YR-END-DTE        PIC   X(10).                05010000
050500     10 DTATTR-FSCL-MN-BEG-DTE        PIC   X(10).                05020000
050600     10 DTATTR-FSCL-MN-END-DTE        PIC   X(10).                05030000
050700     10 DTATTR-FSCL-WK-BEG-DTE        PIC   X(10).                05040000
050800     10 DTATTR-FSCL-WK-END-DTE        PIC   X(10).                05050000
050900     10 DTATTR-SEA-DESC               PIC   X(6).                 05060000
051000     10 DTATTR-SEA-BEG-DTE            PIC   X(10).                05070000
051100     10 DTATTR-SEA-END-DTE            PIC   X(10).                05080000
051200     10 DTATTR-PREV-SEA-END-DTE       PIC   X(10).                05090000
051300     10 DTATTR-PFM-END-DTE            PIC   X(10).                05100000
051400     10 DTATTR-NFM-END-DTE            PIC   X(10).                05110000
051500     10 DTATTR-PFW-END-DTE            PIC   X(10).                05120000
051600                                                                  05130000
052400*----------------------------------------------------------------*05210000
052500* ORACLE END OF DECLARATIVE SECTION                              *05220000
052600*----------------------------------------------------------------*05230000
052700     EXEC SQL                                                     05240000
052800       END DECLARE SECTION                                        05250000
052900     END-EXEC.                                                    05260000
053000                                                                  05270000
053100     EXEC SQL                                                     05280000
053200       INCLUDE SQLCACOB                                           05290000
053300     END-EXEC.                                                    05300000
053400*----------------------------------------------------------------*05310000
053500* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004        *05320000
053600*----------------------------------------------------------------*05330000
053700     COPY DPWS004.                                                05340000
053800                                                                  05350000
053900* WORKING STORAGE FOR DPKUT500 INTERFACE                          05360000
054000     COPY DPWS500.                                                05370000
054100*----------------------------------------------------------------*05380000
054200* ORA ABEND COPYBOOK                                             *05390000
054300*----------------------------------------------------------------*05400000
054400     COPY DPWS900.                                                05410000
054500                                                                  05420000
054600******************************************************************05430000
054700 PROCEDURE DIVISION.                                              05440000
054800******************************************************************05450000
054900 0000-MAINLINE.                                                   05460000
055000*****TEST ONLY                                                    05470000
055100*    SET PS-READY-TRACE            TO TRUE.                       05480000
055200*****TEST ONLY                                                    05490000
055300                                                                  05500000
055400     PERFORM 1000-INITIALIZATION.                                 05510000
055500     IF  PS-UPDATES-TO-PROCESS                                    05520000
055600         PERFORM 2000-EVENT-PROCESSOR                             05530000
055700           UNTIL PS-END-OF-INPUT                                  05540000
055800         MOVE 'Y' TO PA035-LAST-CAL-UPDT-IND                      05550000
056000         PERFORM 1400-CHECK-ACTIVITY                              05570000
056100         PERFORM 8500-WRITE-UPDTE-EMAIL-RECORD                    05580000
056200     ELSE                                                         05590000
056300         SET PS-NO-UPDATES-TO-PROCESS TO TRUE                     05600000
056400         MOVE 'N' TO PA035-LAST-CAL-UPDT-IND                      05610000
056500     END-IF.                                                      05620009
056600                                                                  05630000
056700     PERFORM 8300-WRITE-DTE-CNTL-EXEC.                            05640000
056800                                                                  05650000
056900     PERFORM 9000-WRAPUP.                                         05660000
057000                                                                  05670000
057100     IF  PS-NO-UPDATES-TO-PROCESS                                 05680000
057200         MOVE 4050 TO RETURN-CODE                                 05690000
057300     END-IF.                                                      05700000
057400                                                                  05710000
057500     GOBACK.                                                      05720000
057600                                                                  05730000
057700*0000-EXIT.                                                       05740000
057800******************************************************************05750000
057900*     INTIALIZES VARIABLES, OPENS ANY FILES, AND PERFORMS        *05760000
058000*     ANY SET-UP ROUTINES.                                       *05770000
058100******************************************************************05780000
058200 1000-INITIALIZATION.                                             05790000
058300     MOVE '1000-INITIALIZATION             ' TO PV-PARAGRAPH-NAME.05800000
058400                                                                  05810000
058500     PERFORM 9990-GET-CURRENT.                                    05820000
058600                                                                  05830000
058700     DISPLAY '****************************************'.          05840000
058800     DISPLAY '**          PEKUP106 STARTED          **'.          05850000
058900     DISPLAY '****************************************'.          05860000
059000     DISPLAY '** CURRENT DATE ' DF-DISPLAY-DATE                   05870000
059100             '            **'.                                    05880000
059200     DISPLAY '** CURRENT TIME ' DF-DISPLAY-TIME                   05890000
059300             '              **'.                                  05900000
059400     DISPLAY '****************************************'.          05910000
059500                                                                  05920000
059600     MOVE DF-DISPLAY-DATE TO PV-DATE-TODAY.                       05930000
059700*    DISPLAY 'CURRENT DATE > ' PV-DATE-TODAY.                     05940000
059800                                                                  05950000
059900     INITIALIZE  PS-PROGRAM-SWITCHES                              05960000
060000                 PV-PROGRAM-COUNTERS.                             05970000
060100                                                                  05980000
060200     OPEN INPUT  VLDTD-EVENT-FILE                                 05990000
060300                 DTE-CNTL-VLDT-FILE                               06000000
060400                 DTE-CNTL-EXEC-INFILE                             06010000
060600          OUTPUT PRJCTN-UPDTE-ERROR-FILE                          06030000
060700                 EMAIL-OUTFILE                                    06040000
060800                 DTE-CNTL-EXEC-OUTFILE.                           06050000
060900                                                                  06060000
061000     SET PS-NO-INPUT-ERROR     TO TRUE.                           06070000
061100     SET PS-UPDATES-TO-PROCESS TO TRUE.                           06080000
061200*  SHOULD READ CNTL CARDS FIRST, THEN VALIDATE ALL DATES,         06090000
061300*   THEN READ INPUT FILE, THEN CHECK FOR EMPTY FILE.              06100000
061400     PERFORM 8100-READ-DTE-CNTL-VLDT-FILE.                        06110000
061500     DISPLAY 'CARD IN > ' PA025-DTE-CONTROL-CARD-RCD              06120000
061600     PERFORM 8200-READ-DTE-CNTL-EXEC-FILE.                        06130000
061700     DISPLAY 'CARD IN > ' PA035-DTE-CONTROL-CARD-RCD              06140000
061800     PERFORM 1200-VALIDATE-DTE-CARDS.                             06150000
061900                                                                  06160000
062000     IF PS-NO-INPUT-ERROR                                         06170000
062100        PERFORM 8000-READ-VALID-EVENT-IN-FILE                     06180000
062200     END-IF.                                                      06190000
062300                                                                  06200000
062400     IF PS-END-OF-INPUT                                           06210000
062500        SET   PS-INPUT-ERROR                 TO TRUE              06220000
062600        DISPLAY PC-NO-RECORDS-IN-FILE                             06230000
062700        MOVE '8000-READ-VALID-EVENT-IN-FILE' TO PV-PARAGRAPH-NAME 06240000
062800        MOVE 'VALIDATED EVENT FILE IS EMPTY' TO PV-OPERATION-MSG-106250000
062900        SET   AC-4008-INPUT-FILE-ERROR       TO TRUE              06260000
063000        PERFORM 9800-ABEND                                        06270000
063100     END-IF.                                                      06280000
063200                                                                  06290000
063300     IF PS-NO-INPUT-ERROR                                         06300000
063400        PERFORM 1010-PROCESS-ORACLE-LOGON                         06310000
063500     END-IF.                                                      06320000
063600                                                                  06330000
063700*1000-EXIT.                                                       06340000
0618ML******************************************************************        
0618ML*     PROCESS ORACLE CONTROL CARD AND LOGIN                      *        
0618ML******************************************************************        
0618ML 1010-PROCESS-ORACLE-LOGON.                                               
0618ML     OPEN INPUT ORACLE-LOGON-FILE.                                        
0618ML                                                                          
0618ML     PERFORM 1050-READ-ORACLE-LOGON.                                      
0618ML                                                                          
0618ML     CLOSE ORACLE-LOGON-FILE.                                             
0618ML                                                                          
0618ML     IF ((PS-END-OF-LOGON-FILE)                                           
0618ML         OR (CC-ORACLE-CONNECTION = SPACES))                              
0618ML         DISPLAY '** ABEND **'                                            
0618ML         DISPLAY PC-PROGRAM-NAME ' - ORACLE LOGON CONTROL CARD '          
0618ML               'NOT PROVIDED'                                             
0618ML         SET AC-4003-CONTROL-CARD-ERROR TO TRUE                           
0618ML         CALL 'ILBOABN0' USING AC-ABEND-CODE                              
0618ML     END-IF.                                                              
063400     PERFORM 1100-SETUP-ORACLE.                                   06310000
0618ML*1010-EXIT.                                                               
0618ML******************************************************************        
0618ML*     READ IN THE ORACLE DATABASE CONTROL CARD.                  *        
0618ML******************************************************************        
0618ML 1050-READ-ORACLE-LOGON.                                                  
0618ML     READ ORACLE-LOGON-FILE                                               
0618ML         INTO CC-ORACLE-CONNECTION                                        
0618ML         AT END                                                           
0618ML             SET PS-END-OF-LOGON-FILE TO TRUE                             
0618ML     END-READ.                                                            
0618ML*1050-EXIT.                                                               
063800******************************************************************06350000
063900*     SET UP TO CONNECT TO THE ORACLE DATABASE.                  *06360000
064000******************************************************************06370000
064100 1100-SETUP-ORACLE.                                               06380000
064200     MOVE '1100-SETUP-ORACLE          ' TO      PV-PARAGRAPH-NAME.06390000
064300     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          06400000
064400*                                                                 06410000
083800****************************************************************          
083900* IF USERNAME IS DASH, THE LOGON ID IS MISSING FROM SYSIN.                
084000* THEREFORE IT IS A PRODUCTION RUN WHERE THE LOGON INFO COMES             
084100* FROM THE JCL                                                            
084200****************************************************************          
0618ML     IF CC-AUTO-LOGON                                                     
0618ML         DISPLAY PC-PROGRAM-NAME  ' - AUTO LOGON TO ORACLE'               
0618ML         EXEC SQL                                                         
0618ML             CONNECT :PC-AUTO-LOGON                                       
0618ML         END-EXEC                                                         
0618ML     ELSE                                                                 
0618ML         INITIALIZE PV-ORACLE-USERID-LEN                                  
0618ML                    PV-ORACLE-PASSWORD-LEN                                
0618ML         INSPECT CC-ORACLE-USERID                                         
0618ML             TALLYING PV-ORACLE-USERID-LEN                                
0618ML             FOR CHARACTERS BEFORE INITIAL SPACE                          
0618ML         INSPECT CC-ORACLE-PASSWORD                                       
0618ML             TALLYING PV-ORACLE-PASSWORD-LEN                              
0618ML             FOR CHARACTERS BEFORE INITIAL SPACE                          
0618ML         MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO                
0618ML                 USERNAME-ARR                                             
0618ML         MOVE PV-ORACLE-USERID-LEN TO USERNAME-LEN                        
0618ML         MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO            
0618ML                 PASSWD-ARR                                               
0618ML         MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                        
0618ML         DISPLAY PC-PROGRAM-NAME  ' - LOGON TO ORACLE AS USER '           
0618ML                 USERNAME-ARR                                             
0618ML         EXEC SQL                                                         
0618ML             CONNECT :USERNAME IDENTIFIED BY :PASSWD                      
0618ML         END-EXEC                                                         
0618ML         INITIALIZE CC-ORACLE-PASSWORD                                    
0618ML                    PASSWD                                                
0618ML     END-IF.                                                              
0618ML                                                                          
0618ML     IF (SQLCODE NOT = 0)                                                 
0618ML        DISPLAY '***  ABEND  ***'                                         
0618ML        DISPLAY '1100-SETUP-ORACLE'                                       
0618ML        DISPLAY '** CONNECT TO ORACLE FAILED UNDER: ' USERNAME-ARR        
0618ML        MOVE 'CONNECT TO ORACLE DATABASE'                                 
0618ML                         TO PV-ORA-OPERATION                              
0618ML        PERFORM 9700-ORA-ERROR                                            
0618ML     END-IF.                                                              
067400                                                                  06710000
067500*1100-EXIT.                                                       06720000
067600******************************************************************06730000
067700* 1200-VALIDATE-DTE-CARDS.                                       *06740000
067800*     VALIDATE INPUT DATE CARDS, CHECK WHETHER THIS PROGRAM IS   *06750000
067900*     TO PROCESS AN INPUT EVENT CALENDAR FILE.                   *06760000
068000******************************************************************06770000
068100 1200-VALIDATE-DTE-CARDS.                                         06780000
068200     MOVE '1200-VALIDATE-DTE-CARDS    ' TO      PV-PARAGRAPH-NAME.06790000
068300                                                                  06800000
068400     IF  PA025-DTE-CONTROL-CARD-RCD  = SPACES                     06810000
068500         DISPLAY 'INVALID CONTROL CARD'                           06820000
068600         DISPLAY 'CARD RECORD: ' PA025-DTE-CONTROL-CARD-RCD       06830000
068700         MOVE '1200-VALIDATE-DTE-CARDS'  TO PV-PARAGRAPH-NAME     06840000
068800         MOVE 'CONTROL CARD IS INVALID'  TO PV-OPERATION-MSG-1    06850000
068900         SET  AC-4003-CONTROL-CARD-ERROR TO TRUE                  06860000
069000         PERFORM 9800-ABEND                                       06870000
069100     END-IF.                                                      06880000
069200                                                                  06890000
069300     IF  PA025-LST-SUCCESS-CSV-TMST  = SPACES                     06900000
069400         DISPLAY 'INVALID CONTROL CARD - NO TIMESTAMP'            06910000
069500         DISPLAY 'CARD RECORD: ' PA025-DTE-CONTROL-CARD-RCD       06920000
069600         MOVE '1200-VALIDATE-DTE-CARDS'  TO PV-PARAGRAPH-NAME     06930000
069700         MOVE 'CONTROL CARD IS INVALID'  TO PV-OPERATION-MSG-1    06940000
069800         SET  AC-4003-CONTROL-CARD-ERROR TO TRUE                  06950000
069900         PERFORM 9800-ABEND                                       06960000
070000     END-IF.                                                      06970000
070100                                                                  06980000
070200     INITIALIZE DPG51 DPG52 DPG53                                 06990000
070300                DPG54 DPG55 DPG56.                                07000000
070400                                                                  07010000
070500     SET  PS-CHKING-VALIDATION-DTE  TO TRUE.                      07020000
070600     MOVE PA025-LST-SUCCESS-CSV-DTE TO DPG52-LK-DATE-INPUT.       07030000
070700     PERFORM 6000-VALIDATE-DATE-INPUT.                            07040000
070800                                                                  07050000
070900     IF  PA035-DTE-CONTROL-CARD-RCD  = SPACES                     07060000
071000         DISPLAY 'INVALID CONTROL CARD'                           07070000
071100         DISPLAY 'CARD RECORD: ' PA035-DTE-CONTROL-CARD-RCD       07080000
071200         MOVE '1200-VALIDATE-DTE-CARDS'  TO PV-PARAGRAPH-NAME     07090000
071300         MOVE 'EMPTY UPDATE CNTL CARD '  TO PV-OPERATION-MSG-1    07100000
071400         SET  AC-4003-CONTROL-CARD-ERROR TO TRUE                  07110000
071500         PERFORM 9800-ABEND                                       07120000
071600     END-IF.                                                      07130000
071700                                                                  07140000
071800     IF  PA035-LAST-CAL-UPDT-TMST  = SPACES                       07150000
071900         DISPLAY 'INVALID LAST CALENDAR UPDTE CARD - NO TIMESTAMP'07160000
072000         DISPLAY 'CARD RECORD: ' PA035-DTE-CONTROL-CARD-RCD       07170000
072100         MOVE '1200-VALIDATE-DTE-CARDS'  TO PV-PARAGRAPH-NAME     07180000
072200         MOVE 'NO UPDATE TIMESTAMP    '  TO PV-OPERATION-MSG-1    07190000
072300         SET  AC-4003-CONTROL-CARD-ERROR TO TRUE                  07200000
072400         PERFORM 9800-ABEND                                       07210000
072500     END-IF.                                                      07220000
072600                                                                  07230000
072700     INITIALIZE DPG51 DPG52 DPG53                                 07240000
072800                DPG54 DPG55 DPG56.                                07250000
072900                                                                  07260000
073000     SET  PS-CHKING-LAST-UPDTE-DTE  TO TRUE.                      07270000
073100     MOVE PA035-LAST-CAL-UPDT-DTE   TO DPG52-LK-DATE-INPUT.       07280000
073200     PERFORM 6000-VALIDATE-DATE-INPUT.                            07290000
073300                                                                  07300000
073400     IF  PA025-LST-SUCCESS-CSV-TMST >= PA035-LAST-CAL-UPDT-TMST   07310000
073500       AND PA025-LST-SUCCESS-CSV-IND = 'Y'                        07320000
073600         SET PS-UPDATES-TO-PROCESS  TO TRUE                       07330000
073700     ELSE                                                         07340000
073800         SET PS-NO-UPDATES-TO-PROCESS TO TRUE                     07350000
073900     END-IF.                                                      07360000
074000                                                                  07370000
074100*1200-EXIT.                                                       07380000
076600******************************************************************07630000
076700* 1400-CHECK-ACTIVITY.                                           *07640000
076800*     CHECK WHETHER ANY EVENTS - OR RECORDS - WERE RECEIVED,     *07650000
076900*     AND WHETHER ANY ORACLE TABLE ROWS HAVE BEEN INSERTED OR    *07660000
077000*     UPDATED, AND WRITE AN ERROR RECORD IF NONE.                *07670000
077100******************************************************************07680000
077200 1400-CHECK-ACTIVITY.                                             07690000
077300     MOVE '1400-CHECK-ACTIVITY            ' TO PV-PARAGRAPH-NAME. 07700000
077400                                                                  07710000
077500*    EVENTS                                                       07720000
077600     IF  PV-EVNT-RECS-READ = 0                                    07730000
077700         SET  PV-ERR-TYP-NO-EVNTS       TO TRUE                   07740000
077800         MOVE PC-NO-EVENTS-IN-FILE      TO PV-ERROR-MESSAGE       07750000
077900         DISPLAY '*****  ERROR MESSAGE  ************************' 07760000
078000         DISPLAY  PV-ERROR-RECORD(1:122)                          07770000
078100         DISPLAY '**********************************************' 07780000
078200         PERFORM 8700-WRITE-ERR-RECORD                            07790000
078300     END-IF.                                                      07800000
078400                                                                  07810000
078500*1400-EXIT.                                                       07820000
078600******************************************************************07830000
078700*     TABLE MAINTENANCE DRIVER ROUTINE                           *07840000
078800******************************************************************07850000
078900 2000-EVENT-PROCESSOR.                                            07860000
079000     MOVE '2000-EVENT-PROCESSOR        ' TO PV-PARAGRAPH-NAME.    07870000
079100                                                                  07880000
079200     PERFORM 2300-LOAD-MARK-ARRAY.                                07890000
079300     PERFORM 2400-LOAD-EVNT-INFO.                                 07900000
079400     PERFORM 2450-LOAD-MKDN-EVNT-INFO                             07910000
079500        VARYING PV-MARKDEX FROM 1 BY 1                            07920000
079600         UNTIL PV-MARKDEX     > PC-MAX-NUM-MARKS.                 07930000
079700                                                                  07940000
079800     EXEC SQL                                                     07950000
079900        COMMIT                                                    07960000
080000     END-EXEC                                                     07970000
080100     PERFORM 8000-READ-VALID-EVENT-IN-FILE.                       07980000
080200                                                                  07990000
080300*2000-EXIT.                                                       08000000
080400******************************************************************08010000
080500*     AN ARRAY FOR INSERTING 1 INPUT RECORD TO MANY              *08020000
080600*     PET_CLR_MKDN_EVENT RECORDS                                 *08030000
080700******************************************************************08040000
080800 2300-LOAD-MARK-ARRAY.                                            08050000
080900     MOVE PA905-CLR-EVNT-ID    TO  PV-MARK-CLR-EVNT-ID(1).        08060000
081000     MOVE PA905-MD1-CLR-FRST-EFF-DTE TO                           08070000
081100                          PV-MARK-CLR-FRST-EFF-DTE(1).            08080000
081200     MOVE PA905-MD1-CLR-LAST-EFF-DTE TO                           08090000
081300                          PV-MARK-CLR-LAST-EFF-DTE(1).            08100000
081400     MOVE '1'         TO  PV-MARK-CLR-MKDN-CDE(1).                08110000
1020ML     IF PA905-MD1-CLR-LAST-EFF-DTE NOT = '~'                              
1020ML         MOVE PA905-MD1-CLR-LAST-EFF-DTE TO PV-LAST-MARK-DTE              
1020ML     END-IF.                                                              
081500     MOVE PA905-CLR-EVNT-ID    TO  PV-MARK-CLR-EVNT-ID(2).        08120000
081600     MOVE PA905-MD2-CLR-FRST-EFF-DTE TO                           08130000
081700                          PV-MARK-CLR-FRST-EFF-DTE(2).            08140000
081800     MOVE PA905-MD2-CLR-LAST-EFF-DTE TO                           08150000
081900                          PV-MARK-CLR-LAST-EFF-DTE(2).            08160000
082000     MOVE '2'         TO  PV-MARK-CLR-MKDN-CDE(2).                08170000
1020ML     IF PA905-MD2-CLR-LAST-EFF-DTE NOT = '~'                              
1020ML         MOVE PA905-MD2-CLR-LAST-EFF-DTE TO PV-LAST-MARK-DTE              
1020ML     END-IF.                                                              
082100     MOVE PA905-CLR-EVNT-ID    TO  PV-MARK-CLR-EVNT-ID(3).        08180000
082200     MOVE PA905-MD3-CLR-FRST-EFF-DTE TO                           08190001
082300                          PV-MARK-CLR-FRST-EFF-DTE(3).            08200000
082400     MOVE PA905-MD3-CLR-LAST-EFF-DTE TO                           08210001
082500                          PV-MARK-CLR-LAST-EFF-DTE(3).            08220000
082600     MOVE '3'         TO  PV-MARK-CLR-MKDN-CDE(3).                08230001
1020ML     IF PA905-MD3-CLR-LAST-EFF-DTE NOT = '~'                              
1020ML         MOVE PA905-MD3-CLR-LAST-EFF-DTE TO PV-LAST-MARK-DTE              
1020ML     END-IF.                                                              
082100     MOVE PA905-CLR-EVNT-ID    TO  PV-MARK-CLR-EVNT-ID(4).        08231001
082200     MOVE PA905-MD4-CLR-FRST-EFF-DTE TO                           08232001
082300                          PV-MARK-CLR-FRST-EFF-DTE(4).            08233001
082400     MOVE PA905-MD4-CLR-LAST-EFF-DTE TO                           08234001
082500                          PV-MARK-CLR-LAST-EFF-DTE(4).            08235001
082600     MOVE '4'         TO  PV-MARK-CLR-MKDN-CDE(4).                08236001
1020ML     IF PA905-MD4-CLR-LAST-EFF-DTE NOT = '~'                              
1020ML         MOVE PA905-MD4-CLR-LAST-EFF-DTE TO PV-LAST-MARK-DTE              
1020ML     END-IF.                                                              
082100     MOVE PA905-CLR-EVNT-ID    TO  PV-MARK-CLR-EVNT-ID(5).        08237001
082200     MOVE PA905-MD5-CLR-FRST-EFF-DTE TO                           08238001
082300                          PV-MARK-CLR-FRST-EFF-DTE(5).            08239001
082400     MOVE PA905-MD5-CLR-LAST-EFF-DTE TO                           08239101
082500                          PV-MARK-CLR-LAST-EFF-DTE(5).            08239201
082600     MOVE '5'         TO  PV-MARK-CLR-MKDN-CDE(5).                08239301
1020ML     IF PA905-MD5-CLR-LAST-EFF-DTE NOT = '~'                              
1020ML         MOVE PA905-MD5-CLR-LAST-EFF-DTE TO PV-LAST-MARK-DTE              
1020ML     END-IF.                                                              
082100     MOVE PA905-CLR-EVNT-ID    TO  PV-MARK-CLR-EVNT-ID(6).        08239401
082200     MOVE PA905-MD6-CLR-FRST-EFF-DTE TO                           08239501
082300                          PV-MARK-CLR-FRST-EFF-DTE(6).            08239601
082400     MOVE PA905-MD6-CLR-LAST-EFF-DTE TO                           08239701
082500                          PV-MARK-CLR-LAST-EFF-DTE(6).            08239801
082600     MOVE '6'         TO  PV-MARK-CLR-MKDN-CDE(6).                08239901
1020ML     IF PA905-MD6-CLR-LAST-EFF-DTE NOT = '~'                              
1020ML         MOVE PA905-MD6-CLR-LAST-EFF-DTE TO PV-LAST-MARK-DTE              
1020ML     END-IF.                                                              
082700     MOVE PA905-CLR-EVNT-ID    TO  PV-MARK-CLR-EVNT-ID(7).        08240001
082800     MOVE PA905-MOS-CLR-FRST-EFF-DTE TO                           08250000
082900                          PV-MARK-CLR-FRST-EFF-DTE(7).            08260001
083000     MOVE PA905-MOS-CLR-LAST-EFF-DTE TO                           08270000
083100                          PV-MARK-CLR-LAST-EFF-DTE(7).            08280001
083200     MOVE 'O'         TO  PV-MARK-CLR-MKDN-CDE(7).                08290001
083300*    IF MOS MARK IS EMPTY, WE ARE PUTTING PSEUDO MARK IN PLACE.   08300000
083400*    THE PSEUDO MARK WILL BE THE END OF NEXT SEASON               08310000
083500     SET PS-NOT-PSEUDO-MARK TO TRUE.                              08320000
083600     IF PA905-MOS-CLR-FRST-EFF-DTE = '~'                          08330000
083700          PERFORM 7100-GET-FISCAL-DATE                            08340000
083800          MOVE DTATTR-FSCL-YR-NBR TO PV-FSCL-YYYY                 08350000
083900          MOVE DTATTR-FSCL-MN-NBR TO PV-FSCL-MM                   08360000
084000          PERFORM 6100-GET-NEW-DATES                              08370000
084100          MOVE PV-ENDOF-NEXT-SEAS-DATE                            08380000
084200                               TO  PV-MARK-CLR-FRST-EFF-DTE(7)    08390001
084300                                   PV-MARK-CLR-LAST-EFF-DTE(7)    08400001
1020ML          IF PV-LAST-MARK-DTE > PV-ENDOF-NEXT-SEAS-DATE                   
1020ML             PERFORM 7150-GET-LSTFSCL-DATE                                
1020ML             MOVE DTATTR-SEA-END-DTE                                      
1020ML                               TO  PV-MARK-CLR-FRST-EFF-DTE(7)            
1020ML                                   PV-MARK-CLR-LAST-EFF-DTE(7)            
1020ML          END-IF                                                          
084400          SET PS-PSEUDO-MARK TO TRUE                              08410000
084500     END-IF.                                                      08420000
084600*2300-EXIT.                                                       08430000
084700******************************************************************08440000
084800*     TABLE INSERT / UPDATE DRIVER ROUTINE                       *08450000
084900******************************************************************08460000
085000 2400-LOAD-EVNT-INFO.                                             08470000
085100     MOVE '2400-EVENT-INFO             ' TO PV-PARAGRAPH-NAME.    08480000
085200     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          08490000
085300                                                                  08500000
085400     MOVE PV-DCA-EXTR-DTE      TO EVNT-MKDN-EXTR-DTE IN PET00001  08510000
085500                                  EVNT-MKDN-PRC-DTE  IN PET00001. 08520000
085600     MOVE PC-DFLT-MKDN-QTY-TYP-CDE                                08530000
085700                               TO MKDN-QTY-TYP-CDE   IN PET00001. 08540000
085800     MOVE 'Y'                  TO ACTV-IND           IN PET00001. 08550000
085900     MOVE PC-PROGRAM-NAME      TO CRE-BY-USR-ID      IN PET00001  08560000
086000                                  LAST-UPD-BY-USR-ID IN PET00001. 08570000
086100                                                                  08580000
086200     MOVE PA905-CLR-EVNT-ID    TO CLR-EVNT-ID        IN PET00003. 08590000
086300     MOVE PA905-CLR-EVNT-NM    TO CLR-EVNT-NM        IN PET00003. 08600000
086400     MOVE PA905-GUI-LOD-ID     TO GUI-LOD-ID         IN PET00003. 08610000
086500     MOVE PA905-LY-CLR-EVNT-ID TO LY-CLR-EVNT-ID     IN PET00003. 08620000
091608                                                                          
091608     EVALUATE TRUE                                                08920000
091608        WHEN PA905-CLR-EVNT-ACT-ADD                               08930000
091608        WHEN PA905-CLR-EVNT-INACTIVE                              08680000
091608           MOVE PC-PAK106      TO CRE-BY-USR-ID      IN PET00003          
091608*          MOVE SYSDATE        TO CRE-TMST           IN PET00003          
091608           SET PS-ACTV         TO TRUE                                    
091608           MOVE PS-ACTV-SW     TO ACTV-IND           IN PET00003          
091608           DISPLAY 'PS-ACTV-SW ' PS-ACTV-SW                               
091608           MOVE ACTV-IND IN PET00003 TO PV-DISP-ACTV-IND                  
091608           DISPLAY 'ACTV-IND IN PET00003 ' PV-DISP-ACTV-IND               
091608        WHEN PA905-CLR-EVNT-ACT-DELETE                            08690000
091608           SET PS-NOT-ACTV     TO TRUE                                    
091608           MOVE PS-ACTV-SW     TO ACTV-IND           IN PET00003          
091608        WHEN PA905-CLR-EVNT-ACT-UPDATE                            08700000
091608           IF PA905-CLR-EVNT-ACTIVE                               08740000
091608               SET PS-ACTV     TO TRUE                                    
091608           ELSE                                                           
091608               SET PS-NOT-ACTV TO TRUE                                    
091608           END-IF                                                 08760000
091608           MOVE PS-ACTV-SW     TO ACTV-IND           IN PET00003          
091608     END-EVALUATE.                                                08910000
091608                                                                          
091608     MOVE PA905-FSCL-YR-NBR    TO BEG-FSCL-YR        IN PET00003.         
091608*    MOVE SYSDATE              TO LAST-UPD-TMST      IN PET00003.         
091608     MOVE PC-PAK106            TO LAST-UPD-BY-USR-ID IN PET00003.         
086600                                                                  08630000
086700     SET PS-NO-UPDATE-REQUIRED TO TRUE.                           08640000
086800     DISPLAY '           CLR_EVNT_ID  = ' CLR-EVNT-ID IN PET00003.08650000
086900                                                                  08660000
087000     EVALUATE TRUE                                                08670000
087100        WHEN PA905-CLR-EVNT-INACTIVE                              08680000
087200        WHEN PA905-CLR-EVNT-ACT-DELETE                            08690000
087300        WHEN PA905-CLR-EVNT-ACT-UPDATE                            08700000
087400           PERFORM 7210-SLCT-EVNT-DATA                            08710000
087700           IF (PV-CER-CLR-EVNT-NM NOT = CLR-EVNT-NM IN PET00003)  08740000
091608           OR (PV-CER-ACTV-IND NOT    = ACTV-IND    IN PET00003)  08740000
091608           OR (PV-CER-BEG-FSCL-YR NOT = BEG-FSCL-YR IN PET00003)  08740000
087800              SET PS-UPDATE-REQUIRED TO TRUE                      08750000
087900           END-IF                                                 08760000
088000           IF PV-LY-CLR-EVNT-NULL-IND > -1                        08770000
088300             IF (PV-CER-LY-CLR-EVNT-ID NOT =                      08800000
088400                                 LY-CLR-EVNT-ID IN PET00003)      08810000
088500                SET PS-UPDATE-REQUIRED TO TRUE                    08820000
088600             END-IF                                               08830000
088700           ELSE                                                   08840000
088800             IF LY-CLR-EVNT-ID IN PET00003 > 0                    08850000
089100                SET PS-UPDATE-REQUIRED TO TRUE                    08880000
089200             END-IF                                               08890000
089300           END-IF                                                 08900000
089400     END-EVALUATE.                                                08910000
089500     EVALUATE TRUE                                                08920000
089600        WHEN PA905-CLR-EVNT-ACT-ADD                               08930000
089700            PERFORM 7250-INSERT-CLR-EVNT                          08940000
089800        WHEN PA905-CLR-EVNT-INACTIVE                              08950000
089900        WHEN PA905-CLR-EVNT-ACT-DELETE                            08960000
090000            MOVE 'N' TO   ACTV-IND     IN PET00001                08970000
090100            IF PS-UPDATE-REQUIRED                                 08980000
090200               PERFORM 7200-UPD-CLR-EVNT                          08990000
090300            END-IF                                                09000000
090400        WHEN PA905-CLR-EVNT-ACT-UPDATE                            09010000
090500            IF PS-UPDATE-REQUIRED                                 09020000
090600               PERFORM 7200-UPD-CLR-EVNT                          09030000
090700            END-IF                                                09040000
090800     END-EVALUATE.                                                09050000
090900*                                                                 09060000
091000*2400-EXIT.                                                       09070000
091100******************************************************************09080000
091200*     TABLE INSERT / UPDATE DRIVER ROUTINE                       *09090000
091300******************************************************************09100000
091400 2450-LOAD-MKDN-EVNT-INFO.                                        09110000
091500     MOVE '2450-LOAD-MKDN-EVNT-INFO    ' TO PV-PARAGRAPH-NAME.    09120000
091600     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          09130000
091700                                                                  09140000
091800     MOVE PV-MARK-CLR-EVNT-ID(PV-MARKDEX)                         09150000
091900          TO  CLR-EVNT-ID      IN PET00001.                       09160000
092000     MOVE PV-MARK-CLR-FRST-EFF-DTE(PV-MARKDEX)                    09170000
092100          TO  CLR-FRST-EFF-DTE IN PET00001.                       09180000
092200     MOVE PV-MARK-CLR-LAST-EFF-DTE(PV-MARKDEX)                    09190000
092300          TO  CLR-LAST-EFF-DTE IN PET00001.                       09200000
092400     MOVE PV-MARK-CLR-MKDN-CDE(PV-MARKDEX)                        09210000
092500          TO  CLR-MKDN-CDE     IN PET00001.                       09220000
092600                                                                  09230000
092700*  PREPARING FOR INACTIVATING THE PSEUDO DATE IN MOS              09240000
092800     MOVE ACTV-IND IN PET00001 TO PV-BKUP-ACTV-IND.               09250000
092900     IF PS-PSEUDO-MARK                                            09260000
093000       AND PV-MARKDEX = PC-MAX-NUM-MARKS                          09270000
093100         MOVE 'N'              TO ACTV-IND IN PET00001            09280000
093200     ELSE                                                         09290000
093300         MOVE PV-BKUP-ACTV-IND TO ACTV-IND IN PET00001            09300000
093400     END-IF.                                                      09310000
093500                                                                  09320000
093600*HERE'S THE LOGIC TO DO THE INST,UPD,DEL OF THE PET-MKDN-EVENT TBL09330000
093700     PERFORM 7300-SLCT-CLR-MKDN-COUNT                             09340000
093800     IF  CLR-FRST-EFF-DTE IN PET00001 = '~'                       09350000
093900         IF PV-MKDN-COUNT > 0                                     09360000
094000           PERFORM 7320-CLR-MKDN-EVNT-MARKDEL                     09370000
094200         END-IF                                                   09390000
094300     ELSE                                                         09400000
094400       EVALUATE TRUE                                              09410000
094500          WHEN PA905-CLR-EVNT-ACT-ADD                             09420000
094600              PERFORM 7350-INSERT-EVNT-MARK                       09430000
094700          WHEN PA905-CLR-EVNT-INACTIVE                            09440000
094800          WHEN PA905-CLR-EVNT-ACT-DELETE                          09450000
094900          WHEN PA905-CLR-EVNT-ACT-UPDATE                          09460000
095000             IF PV-MKDN-COUNT > 0                                 09470000
095100                PERFORM 7310-SLCT-CLR-MKDN-EVNT-DATA              09480000
096000                IF (CLR-FRST-EFF-DTE IN PET00001 NOT =            09570000
096100                    PV-CMER-CLR-FRST-EFF-DTE(1:10) OR             09580000
096200                    CLR-LAST-EFF-DTE IN PET00001 NOT =            09590000
096300                    PV-CMER-CLR-LAST-EFF-DTE(1:10) OR             09600000
096400                    ACTV-IND       IN PET00001 NOT =              09610000
096500                                   PV-CMER-ACTV-IND)              09620000
096600                   PERFORM 7500-UPDATE-EVNT-MARK                  09630000
096800                END-IF                                            09650000
096900             ELSE                                                 09660000
097000*            INSERT NEW MARKS                                     09670000
097100                 PERFORM 7350-INSERT-EVNT-MARK                    09680000
097300             END-IF                                               09700000
097400       END-EVALUATE                                               09710000
097500     END-IF.                                                      09720000
097600*2450-EXIT.                                                       09730000
112200******************************************************************11190000
112300* 6000-VALIDATE-DATE-INPUT.                                       11200000
112400*     VALIDATE THE DATE INPUT BY CALLING THE KOHLS CALENDAR       11210000
112500*     ROUTINE AND CHECKING TO SEE WHETHER IT THROWS AN ERROR.     11220000
112600******************************************************************11230000
112700 6000-VALIDATE-DATE-INPUT.                                        11240000
112800                                                                  11250000
112900     SET  DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                     11260000
113000     SET  DPG52-LK-DTE-ISO-FMT       TO TRUE.                     11270000
113100                                                                  11280000
113200     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    11290000
113300                                             DPG54 DPG55 DPG56.   11300000
113400     EVALUATE TRUE                                                11310000
113500         WHEN DPG54-NO-ERROR                                      11320000
113600             DISPLAY ' '                                          11330000
113700             DISPLAY 'INPUT BATCH DATE OK > ' DPG52-LK-DATE-INPUT 11340000
113800         WHEN OTHER                                               11350000
113900             DISPLAY ' '                                          11360000
114000             DISPLAY '** ABEND ** IN ' PC-PROGRAM-NAME            11370000
114100             DISPLAY '** INVALID BATCH DATE PASSED IN CC '        11380000
114200             IF  PS-CHKING-LAST-UPDTE-DTE                         11390000
114300                 DISPLAY '** ' PC-BAD-UPDATE-DTE                  11400000
114400             ELSE                                                 11410000
114500                 IF  PS-CHKING-VALIDATION-DTE                     11420000
114600                     DISPLAY '** ' PC-BAD-VALIDATION-DTE          11430000
114700                 ELSE                                             11440000
114800                     DISPLAY '**  BAD DATE IN INPUT FILE'         11450000
114900                 END-IF                                           11460000
115000             END-IF                                               11470000
115100             DISPLAY '** 6000-VALIDATE-DATE-INPUT'                11480000
115200             DISPLAY '** ERROR MESSAGE = '                        11490000
115300                               DPG54-ERROR-MESSAGE                11500000
115400             DISPLAY '** CALENDAR TYPE = ' DPG51-CALENDAR-TYPE    11510000
115500             DISPLAY '** DATE FORMAT = ' DPG52-LK-DATE-FORMAT-CODE11520000
115600             DISPLAY '** INPUT DATE  = ' DPG52-LK-DATE-INPUT      11530000
115700             MOVE '6000-VALIDATE-DATE-INPUT'                      11540000
115800                                  TO PV-PARAGRAPH-NAME            11550000
115900             MOVE 'ERROR VALIDATING CONTROL CARD INPUT DATE'      11560000
116000                                  TO PV-OPERATION-MSG-1           11570000
116100             MOVE DPG54-ERROR-MESSAGE  TO PV-OPERATION-MSG-2      11580000
116200             SET AC-4019-CALENDAR-ROUTINE-ERROR TO TRUE           11590000
116300             PERFORM 9800-ABEND                                   11600000
116400     END-EVALUATE.                                                11610000
116500                                                                  11620000
116600*6000-EXIT.                                                       11630000
116700******************************************************************11640000
116800* 6100-GET-NEW-DATES.                                             11650000
116900*  CALL CALENDAR ROUTINE TO CALCULATE NEW DATES.                  11660000
117000******************************************************************11670000
117100 6100-GET-NEW-DATES.                                              11680000
117200                                                                  11690000
117300     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              11700000
117400                                                                  11710000
117500     MOVE PA905-MD1-CLR-FRST-EFF-DTE TO DPG52-LK-DATE-INPUT.      11720000
117600     SET  DPG51-FISCAL-454-CALENDAR  TO TRUE.                     11730000
117700     SET  DPG51-INCREMENT-DATE       TO TRUE.                     11740000
117800     SET  DPG52-LK-DTE-FISC-PRD-CC   TO TRUE.                     11750000
117900                                                                  11760000
118000     MOVE PV-FSCL-YYYY            TO DPG52-FISCAL-CC-PRD-YR-X.    11770000
118100     MOVE PV-FSCL-MM              TO DPG52-FISCAL-CC-PRD-PP-X.    11780000
118200     MOVE 6                       TO DPG51-INCR-DECR-FISCAL-PRD-9.11790000
118300                                                                  11800000
118400     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51                11810000
118500                                     DPG52                        11820000
118600                                     DPG53                        11830000
118700                                     DPG54                        11840000
118800                                     DPG55                        11850000
118900                                     DPG56.                       11860000
119000                                                                  11870000
119100     EVALUATE TRUE                                                11880000
119200        WHEN DPG54-NO-ERROR                                       11890000
119300           MOVE  DPG56-LAST-FS-DB2-ISO-FMT                        11900000
119400                            TO  PV-ENDOF-NEXT-SEAS-DATE           11910000
119500        WHEN OTHER                                                11920000
119600           MOVE '6100-GET-NEW-DATES'       TO PV-PARAGRAPH-NAME   11930000
119700           MOVE DPG54-ERROR-MESSAGE        TO PV-OPERATION-MSG-1  11940000
119800           MOVE PA905-MD1-CLR-FRST-EFF-DTE TO PV-OPERATION-MSG-2  11950000
119900           SET AC-4019-CALENDAR-ROUTINE-ERROR  TO TRUE            11960000
120000           PERFORM 9800-ABEND                                     11970000
120100        END-EVALUATE.                                             11980000
120200                                                                  11990000
120300*6100-EXIT.                                                       12000000
123600******************************************************************12330000
123700* 7100-GET-FISCAL-DATE.                                          *12340000
123800*   SELECT FISCAL YEAR AND MONTH FOR INITIAL MARK OF EVENT.      *12350000
123900*   THIS IS EXECUTED WHEN A PSEUDO-MOS DATE IS NEEDED.           *12360000
124000******************************************************************12370000
124100 7100-GET-FISCAL-DATE.                                            12380000
124200                                                                  12390000
124300     EXEC SQL                                                     12400000
124400          SELECT  FSCL_YR_NBR                                     12410000
124500                 ,FSCL_MN_NBR                                     12420000
124600                 ,TO_CHAR(SEA_BEG_DTE, 'YYYY-MM-DD')              12430000
124700                 ,TO_CHAR(SEA_END_DTE, 'YYYY-MM-DD')              12440000
124800            INTO  :DTATTR-FSCL-YR-NBR                             12450000
124900                 ,:DTATTR-FSCL-MN-NBR                             12460000
125000                 ,:DTATTR-SEA-BEG-DTE                             12470000
125100                 ,:DTATTR-SEA-END-DTE                             12480000
125200            FROM  TDTATTR                                         12490000
125300           WHERE  KY_DTE = :PA905-MD1-CLR-FRST-EFF-DTE            12500000
125400     END-EXEC.                                                    12510000
125500                                                                  12520000
125600     EVALUATE TRUE                                                12530000
125700         WHEN SQLCODE = ZERO                                      12540000
125800             CONTINUE                                             12550000
125900         WHEN OTHER                                               12560000
126000             MOVE '7100-GET-FISCAL-DATE' TO PV-PARAGRAPH-NAME     12570000
126100             MOVE 'SELECT FY AND MONTH OF EVENT FROM TDTATTR'     12580000
126200                                         TO PV-ORA-OPERATION      12590000
126300             PERFORM 9700-ORA-ERROR                               12600000
126400     END-EVALUATE.                                                12610000
126500                                                                  12620000
126600*7100-EXIT.                                                       12630000
1020ML******************************************************************        
1020ML* 7150-GET-LSTFSCL-DATE.                                         *        
1020ML*   SELECT FISCAL YEAR AND MONTH FOR LAST MARK OF EVENT.         *        
1020ML*   THIS IS EXECUTED WHEN A PSEUDO-MOS DATE IS NEEDED.           *        
1020ML******************************************************************        
1020ML 7150-GET-LSTFSCL-DATE.                                                   
1020ML                                                                          
1020ML     EXEC SQL                                                             
1020ML          SELECT  FSCL_YR_NBR                                             
1020ML                 ,FSCL_MN_NBR                                             
1020ML                 ,TO_CHAR(SEA_BEG_DTE, 'YYYY-MM-DD')                      
1020ML                 ,TO_CHAR(SEA_END_DTE, 'YYYY-MM-DD')                      
1020ML            INTO  :DTATTR-FSCL-YR-NBR                                     
1020ML                 ,:DTATTR-FSCL-MN-NBR                                     
1020ML                 ,:DTATTR-SEA-BEG-DTE                                     
1020ML                 ,:DTATTR-SEA-END-DTE                                     
1020ML            FROM  TDTATTR                                                 
1020ML           WHERE  KY_DTE = :PV-LAST-MARK-DTE                              
1020ML     END-EXEC.                                                            
1020ML                                                                          
1020ML     EVALUATE TRUE                                                        
1020ML         WHEN SQLCODE = ZERO                                              
1020ML             CONTINUE                                                     
1020ML         WHEN OTHER                                                       
1020ML             MOVE '7150-GET-LSTFSCL-DATE' TO PV-PARAGRAPH-NAME            
1020ML             MOVE 'SELECT FY AND MONTH OF EVENT FROM TDTATTR'             
1020ML                                         TO PV-ORA-OPERATION              
1020ML             PERFORM 9700-ORA-ERROR                                       
1020ML     END-EVALUATE.                                                        
1020ML                                                                          
1020ML*7150-EXIT.                                                               
126700******************************************************************12640000
126800*     UPDATE LY_CLR_EVNT_ID AND CLR_EVNT_NM IN PET_CLR_EVNT      *12650000
126900******************************************************************12660000
127000 7200-UPD-CLR-EVNT.                                               12670000
127100     MOVE '7200-UPD-CLR-EVNT         ' TO PV-PARAGRAPH-NAME.      12680000
127200     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          12690000
127300                                                                  12700000
127400     DISPLAY 'UPDATING EVENT- EVENT ID ' CLR-EVNT-ID  IN PET00003.12710000
127500     PERFORM                                                      12720000
127600         WITH TEST AFTER                                          12730000
127700         VARYING PV-SQL-SUB                                       12740000
127800         FROM 1 BY 1                                              12750000
127900         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 12760000
128000                   OR  SQLCODE = 0                                12770000
128100                   OR  SQLCODE = +1403 )                          12780000
128200                                                                  12790000
128300         IF LY-CLR-EVNT-ID IN PET00003 = 0                        12800000
128400             EXEC SQL                                             12810000
128500                UPDATE PET_CLR_EVNT                               12820000
128600                   SET LY_CLR_EVNT_ID  = NULL                     12830000
128700                     , CLR_EVNT_NM     = :PET00003.CLR-EVNT-NM    12840000
091608                     , ACTV_IND        = :PET00003.ACTV-IND               
091608                     , BEG_FSCL_YR     = :PET00003.BEG-FSCL-YR            
091608                     , LAST_UPD_TMST   = SYSDATE                          
091608                     , LAST_UPD_BY_USR_ID =                               
091608                                   :PET00003.LAST-UPD-BY-USR-ID           
128800                 WHERE                                            12850000
128900                       CLR_EVNT_ID     = :PET00003.CLR-EVNT-ID    12860000
129000                   AND GUI_LOD_ID      = :PET00003.GUI-LOD-ID     12870000
129100             END-EXEC                                             12880000
129200         ELSE                                                     12890000
129300             EXEC SQL                                             12900000
129400                UPDATE PET_CLR_EVNT                               12910000
129500                   SET LY_CLR_EVNT_ID  = :PET00003.LY-CLR-EVNT-ID 12920000
129600                   , CLR_EVNT_NM     = :PET00003.CLR-EVNT-NM      12930000
091608                     , ACTV_IND        = :PET00003.ACTV-IND               
091608                     , BEG_FSCL_YR     = :PET00003.BEG-FSCL-YR            
091608                     , LAST_UPD_TMST   = SYSDATE                          
091608                     , LAST_UPD_BY_USR_ID =                               
091608                                   :PET00003.LAST-UPD-BY-USR-ID           
129700                WHERE                                             12940000
129800                   CLR_EVNT_ID     = :PET00003.CLR-EVNT-ID        12950000
129900                   AND GUI_LOD_ID      = :PET00003.GUI-LOD-ID     12960000
130000             END-EXEC                                             12970000
130100                                                                  12980000
130200         END-IF                                                   12990000
130300                                                                  13000000
130400         EVALUATE TRUE                                            13010000
130500             WHEN SQLCODE = 0                                     13020000
130600                  ADD 1 TO PV-CLR-EVNT-UPD                        13030000
130700             WHEN SQLWARN0 NOT EQUAL SPACE                        13040000
130800             WHEN SQLCODE NOT EQUAL ZERO                          13050000
130900                  MOVE CLR-EVNT-ID     IN PET00003                13060000
131000                                     TO PV-DISP-CLR-EVNT-ID       13070000
131100                  MOVE GUI-LOD-ID      IN PET00003                13080000
131200                                     TO PV-DISP-CLR-EVNT-GUI-ID   13090000
131300                  MOVE LY-CLR-EVNT-ID IN PET00003                 13100000
131400                                        TO PV-DISP-LY-CLR-EVNT-ID 13110000
091608                  MOVE ACTV-IND       IN PET00003                 13100000
091608                                        TO PV-DISP-ACTV-IND       13110000
091608                  MOVE BEG-FSCL-YR    IN PET00003                 13100000
091608                                        TO PV-DISP-BEG-FSCL-YR    13110000
131500                  DISPLAY 'EVNT-ID, NAME, GUI-ID, LY-EVNT-ID'     13120000
091608                          ', ACTV-IND, BEG-FSCL-YR'                       
131600                          ' > ' PV-DISP-CLR-EVNT-ID ' '           13130000
131700                          CLR-EVNT-NM ' ' PV-DISP-CLR-EVNT-GUI-ID 13140000
131800                          ' ' PV-DISP-LY-CLR-EVNT-ID              13150000
091608                          ' ' PV-DISP-ACTV-IND                            
091608                          ' ' PV-DISP-BEG-FSCL-YR '****'                  
131900                  MOVE '7200-UPD-CLR-EVNT  ' TO PV-PARAGRAPH-NAME 13160000
132000                  MOVE 'UPDATE PET_CLR_EVNT' TO PV-ORA-OPERATION  13170000
132100                  PERFORM 9700-ORA-ERROR                          13180000
132200         END-EVALUATE                                             13190000
132300     END-PERFORM.                                                 13200000
132400                                                                  13210000
132500     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         13220000
132600        MOVE 'SELECT RETRIES EXCEEDED'                            13230000
132700                              TO  PV-ORA-OPERATION                13240000
132800        PERFORM 9700-ORA-ERROR                                    13250000
132900     END-IF.                                                      13260000
133000                                                                  13270000
133100*7200-EXIT.  EXIT.                                                13280000
133200******************************************************************13290000
133300*   SELECT DATES FROM PET_CLR_MKDN_EVNT TO CHECK FOR UPDATE      *13300000
133400******************************************************************13310000
133500 7210-SLCT-EVNT-DATA.                                             13320000
133600     MOVE '7210-SLCT-EVNT-DATA    ' TO PV-PARAGRAPH-NAME.         13330000
133700     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          13340000
133800                                                                  13350000
133900     MOVE ZEROS TO PV-CER-CLR-EVNT-ID.                            13360000
134000     MOVE SPACES TO PV-CER-CLR-EVNT-NM.                           13370000
134100     MOVE ZEROS  TO PV-CER-LY-CLR-EVNT-ID.                        13380000
134200     MOVE ZEROS  TO PV-CER-GUI-LOD-ID.                            13390000
091608     MOVE SPACES TO PV-CER-ACTV-IND.                                      
091608     MOVE ZEROS  TO PV-CER-BEG-FSCL-YR.                                   
134300     PERFORM                                                      13400000
134400         WITH TEST AFTER                                          13410000
134500         VARYING PV-SQL-SUB                                       13420000
134600         FROM 1 BY 1                                              13430000
134700         UNTIL ( PV-SQL-SUB GREATER PC-MAX-RETRIES                13440000
134800                   OR  SQLCODE = 0                                13450000
134900                   OR  SQLCODE = +1403 )                          13460000
135000                                                                  13470000
135100         EXEC SQL                                                 13480000
135200            SELECT CLR_EVNT_ID                                    13490000
135300                  ,CLR_EVNT_NM                                    13500000
135400                  ,LY_CLR_EVNT_ID                                 13510000
135500                  ,GUI_LOD_ID                                     13520000
091608                  ,ACTV_IND                                               
091608                  ,BEG_FSCL_YR                                            
135600              INTO                                                13530000
135700                   :PV-CER-CLR-EVNT-ID                            13540000
135800                  ,:PV-CER-CLR-EVNT-NM                            13550000
135900                  ,:PV-CER-LY-CLR-EVNT-ID :PV-LY-CLR-EVNT-NULL-IND13560000
136000                  ,:PV-CER-GUI-LOD-ID     :PV-GUI-LOD-ID-NULL-IND 13570000
091608                  ,:PV-CER-ACTV-IND                                       
091608                  ,:PV-CER-BEG-FSCL-YR                                    
136100              FROM                                                13580000
136200                   PET_CLR_EVNT                                   13590000
136300              WHERE                                               13600000
136400                   CLR_EVNT_ID         = :PET00003.CLR-EVNT-ID    13610000
136500         END-EXEC                                                 13620000
136600                                                                  13630000
136700         EVALUATE TRUE                                            13640000
136800             WHEN SQLCODE = 0                                     13650000
136900                  CONTINUE                                        13660000
137000             WHEN SQLWARN0 NOT EQUAL SPACE                        13670000
137100             WHEN SQLCODE NOT EQUAL ZERO                          13680000
137200                  MOVE 'SELECT EVENT DATES FROM PET_CLR_EVNT'     13690000
137300                                     TO PV-ORA-OPERATION          13700000
137400                  DISPLAY 'EVENT ID > ' PV-DISP-CLR-EVNT-ID       13710000
137500                  PERFORM 9700-ORA-ERROR                          13720000
137600         END-EVALUATE                                             13730000
137700     END-PERFORM.                                                 13740000
137800                                                                  13750000
137900     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         13760000
138000        MOVE 'SELECT RETRIES EXCEEDED'                            13770000
138100                              TO  PV-ORA-OPERATION                13780000
138200        PERFORM 9700-ORA-ERROR                                    13790000
138300     END-IF.                                                      13800000
138400                                                                  13810000
138500*7210-EXIT.  EXIT.                                                13820000
138600******************************************************************13830000
138700*     PET_CLR_EVNT TABLE INSERT ROUTINE                          *13840000
138800******************************************************************13850000
138900 7250-INSERT-CLR-EVNT.                                            13860000
139000     MOVE '7250-INSERT-CLR-EVNT            ' TO PV-PARAGRAPH-NAME.13870000
139100     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          13880000
139200     DISPLAY 'INSERTING EVENT-EVENT ID ' CLR-EVNT-ID  IN PET00003.13890000
139300                                                                  13900000
139400     PERFORM                                                      13910000
139500         WITH TEST AFTER                                          13920000
139600         VARYING PV-SQL-SUB                                       13930000
139700         FROM 1 BY 1                                              13940000
139800         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 13950000
139900                   OR  SQLCODE = 0)                               13960000
140000                                                                  13970000
140100         IF LY-CLR-EVNT-ID IN PET00003 = 0                        13980000
140200             EXEC SQL                                             13990000
140300                INSERT                                            14000000
140400                  INTO PET_CLR_EVNT                               14010000
140500                      (                                           14020000
140600                       CLR_EVNT_ID                                14030000
140700                      ,CLR_EVNT_NM                                14040000
140800                      ,LY_CLR_EVNT_ID                             14050000
140900                      ,GUI_LOD_ID                                 14060000
091608                      ,ACTV_IND                                           
091608                      ,BEG_FSCL_YR                                        
091608                      ,CRE_TMST                                           
091608                      ,CRE_BY_USR_ID                                      
091608                      ,LAST_UPD_TMST                                      
091608                      ,LAST_UPD_BY_USR_ID                                 
141000                      )                                           14070000
141100                VALUES                                            14080000
141200                      (                                           14090000
141300                       :PET00003.CLR-EVNT-ID                      14100000
141400                      ,:PET00003.CLR-EVNT-NM                      14110000
141500                      ,NULL                                       14120000
141600                      ,:PET00003.GUI-LOD-ID                       14130000
091608                      ,:PET00003.ACTV-IND                         14130000
091608                      ,:PET00003.BEG-FSCL-YR                      14130000
091608                      ,SYSDATE                                    14130000
091608                      ,:PET00003.CRE-BY-USR-ID                    14130000
091608                      ,SYSDATE                                    14130000
091608                      ,:PET00003.LAST-UPD-BY-USR-ID               14130000
141700                      )                                           14140000
141800             END-EXEC                                             14150000
141900         ELSE                                                     14160000
142000             EXEC SQL                                             14170000
142100                INSERT                                            14180000
142200                  INTO PET_CLR_EVNT                               14190000
142300                      (                                           14200000
142400                       CLR_EVNT_ID                                14210000
142500                      ,CLR_EVNT_NM                                14220000
142600                      ,LY_CLR_EVNT_ID                             14230000
142700                      ,GUI_LOD_ID                                 14240000
091608                      ,ACTV_IND                                           
091608                      ,BEG_FSCL_YR                                        
091608                      ,CRE_TMST                                           
091608                      ,CRE_BY_USR_ID                                      
091608                      ,LAST_UPD_TMST                                      
091608                      ,LAST_UPD_BY_USR_ID                                 
142800                      )                                           14250000
142900                VALUES                                            14260000
143000                      (                                           14270000
143100                       :PET00003.CLR-EVNT-ID                      14280000
143200                      ,:PET00003.CLR-EVNT-NM                      14290000
143300                      ,:PET00003.LY-CLR-EVNT-ID                   14300000
143400                      ,:PET00003.GUI-LOD-ID                       14310000
091608                      ,:PET00003.ACTV-IND                         14130000
091608                      ,:PET00003.BEG-FSCL-YR                      14130000
091608                      ,SYSDATE                                    14130000
091608                      ,:PET00003.CRE-BY-USR-ID                    14130000
091608                      ,SYSDATE                                    14130000
091608                      ,:PET00003.LAST-UPD-BY-USR-ID               14130000
143500                      )                                           14320000
143600             END-EXEC                                             14330000
143700         END-IF                                                   14340000
143800         EVALUATE TRUE                                            14350000
143900             WHEN SQLCODE = 0                                     14360000
144000                  ADD 1 TO PV-CLR-EVNT-INS                        14370000
144100             WHEN SQLWARN0 NOT EQUAL SPACE                        14380000
144200             WHEN SQLCODE NOT EQUAL ZERO                          14390000
144300                  MOVE 'INSERT TO PET_CLR_EVNT'                   14400000
144400                                         TO PV-ORA-OPERATION      14410000
144500                  PERFORM 9700-ORA-ERROR                          14420000
144600         END-EVALUATE                                             14430000
144700     END-PERFORM.                                                 14440000
144800                                                                  14450000
144900     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         14460000
145000        MOVE 'INSERT RETRIES EXCEEDED'                            14470000
145100                              TO  PV-ORA-OPERATION                14480000
145200        PERFORM 9700-ORA-ERROR                                    14490000
145300     END-IF.                                                      14500000
145400                                                                  14510000
145500*7250-EXIT.  EXIT.                                                14520000
145600******************************************************************14530000
145700*   SELECT DATES FROM PET_CLR_MKDN_EVNT TO CHECK FOR UPDATE      *14540000
145800******************************************************************14550000
145900 7300-SLCT-CLR-MKDN-COUNT.                                        14560000
146000     MOVE '7300-SLCT-CLR-MKDN-EVNT-DATA    ' TO PV-PARAGRAPH-NAME.14570000
146100     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          14580000
146200                                                                  14590000
146300     PERFORM                                                      14600000
146400         WITH TEST AFTER                                          14610000
146500         VARYING PV-SQL-SUB                                       14620000
146600         FROM 1 BY 1                                              14630000
146700         UNTIL ( PV-SQL-SUB GREATER PC-MAX-RETRIES                14640000
146800                   OR  SQLCODE = 0                                14650000
146900                   OR  SQLCODE = +1403 )                          14660000
147000                                                                  14670000
147100         EXEC SQL                                                 14680000
147200            SELECT COUNT(*)                                       14690000
147300              INTO                                                14700000
147400                   :PV-MKDN-COUNT                                 14710000
147500              FROM                                                14720000
147600                   PET_CLR_MKDN_EVNT                              14730000
147700              WHERE                                               14740000
147800                   CLR_EVNT_ID         = :PET00001.CLR-EVNT-ID    14750000
147900               AND CLR_MKDN_CDE        = :PET00001.CLR-MKDN-CDE   14760000
148000         END-EXEC                                                 14770000
148100                                                                  14780000
148200         EVALUATE TRUE                                            14790000
148300             WHEN SQLCODE = 0                                     14800000
148400                  CONTINUE                                        14810000
148500             WHEN SQLWARN0 NOT EQUAL SPACE                        14820000
148600             WHEN SQLCODE NOT EQUAL ZERO                          14830000
148700                  MOVE 'SELECT COUNT  FROM PET_CLR_MKDN_EVNT'     14840000
148800                                     TO PV-ORA-OPERATION          14850000
148900                  DISPLAY 'EVENT ID > ' PV-DISP-CLR-EVNT-ID       14860000
149000                  PERFORM 9700-ORA-ERROR                          14870000
149100         END-EVALUATE                                             14880000
149200     END-PERFORM.                                                 14890000
149300                                                                  14900000
149400                                                                  14910000
149500     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         14920000
149600        MOVE 'SELECT RETRIES EXCEEDED'                            14930000
149700                              TO  PV-ORA-OPERATION                14940000
149800        PERFORM 9700-ORA-ERROR                                    14950000
149900     END-IF.                                                      14960000
150000                                                                  14970000
150100*7300-EXIT.  EXIT.                                                14980000
150200******************************************************************14990000
150300*   SELECT DATES FROM PET_CLR_MKDN_EVNT TO CHECK FOR UPDATE      *15000000
150400******************************************************************15010000
150500 7310-SLCT-CLR-MKDN-EVNT-DATA.                                    15020000
150600     MOVE '7310-SLCT-CLR-MKDN-EVNT-DATA    ' TO PV-PARAGRAPH-NAME.15030000
150700     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          15040000
150800                                                                  15050000
150900     MOVE SPACES TO PV-CMER-CLR-FRST-EFF-DTE.                     15060000
151000     MOVE SPACES TO PV-CMER-CLR-LAST-EFF-DTE.                     15070000
151100     MOVE SPACES TO PV-CMER-ACTV-IND.                             15080000
151200     PERFORM                                                      15090000
151300         WITH TEST AFTER                                          15100000
151400         VARYING PV-SQL-SUB                                       15110000
151500         FROM 1 BY 1                                              15120000
151600         UNTIL ( PV-SQL-SUB GREATER PC-MAX-RETRIES                15130000
151700                   OR  SQLCODE = 0                                15140000
151800                   OR  SQLCODE = +1403 )                          15150000
151900                                                                  15160000
152000         EXEC SQL                                                 15170000
152100            SELECT TO_CHAR(CLR_FRST_EFF_DTE, 'YYYY-MM-DD')        15180000
152200                  ,TO_CHAR(CLR_LAST_EFF_DTE, 'YYYY-MM-DD')        15190000
152300                  ,ACTV_IND                                       15200000
152400              INTO                                                15210000
152500                   :PV-CMER-CLR-FRST-EFF-DTE                      15220000
152600                  ,:PV-CMER-CLR-LAST-EFF-DTE                      15230000
152700                  ,:PV-CMER-ACTV-IND                              15240000
152800              FROM                                                15250000
152900                   PET_CLR_MKDN_EVNT                              15260000
153000              WHERE                                               15270000
153100                   CLR_EVNT_ID         = :PET00001.CLR-EVNT-ID    15280000
153200               AND CLR_MKDN_CDE        = :PET00001.CLR-MKDN-CDE   15290000
153300         END-EXEC                                                 15300000
153400                                                                  15310000
153500         EVALUATE TRUE                                            15320000
153600             WHEN SQLCODE = 0                                     15330000
153700                  CONTINUE                                        15340000
153800             WHEN SQLWARN0 NOT EQUAL SPACE                        15350000
153900             WHEN SQLCODE NOT EQUAL ZERO                          15360000
154000                  MOVE 'SELECT EVENT DATES FROM PET_CLR_MKDN_EVNT'15370000
154100                                     TO PV-ORA-OPERATION          15380000
154200                  DISPLAY 'EVENT ID > ' PV-DISP-CLR-EVNT-ID       15390000
154300                  PERFORM 9700-ORA-ERROR                          15400000
154400         END-EVALUATE                                             15410000
154500     END-PERFORM.                                                 15420000
154600                                                                  15430000
154700     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         15440000
154800        MOVE 'SELECT RETRIES EXCEEDED'                            15450000
154900                              TO  PV-ORA-OPERATION                15460000
155000        PERFORM 9700-ORA-ERROR                                    15470000
155100     END-IF.                                                      15480000
155200                                                                  15490000
155300*7310-EXIT.  EXIT.                                                15500000
155400******************************************************************15510000
155500*     ATTEMPT TO UPDATE PET_CLR_MKDN_EVNT TABLE.                 *15520000
155600******************************************************************15530000
155700 7320-CLR-MKDN-EVNT-MARKDEL.                                      15540000
155800     DISPLAY 'DELETING MARK - EVENT ID ' CLR-EVNT-ID  IN PET00001 15550000
155900             ' MARK ' CLR-MKDN-CDE IN PET00001.                   15560000
156000     MOVE '7320-CLR-MKDN-EVNT-MARKDEL      ' TO PV-PARAGRAPH-NAME.15570000
156100     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          15580000
156200     PERFORM                                                      15590000
156300         WITH TEST AFTER                                          15600000
156400         VARYING PV-SQL-SUB                                       15610000
156500         FROM 1 BY 1                                              15620000
156600         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 15630000
156700                   OR  SQLCODE = 0                                15640000
156800                   OR  SQLCODE = +1403 )                          15650000
156900                                                                  15660000
157000           EXEC SQL                                               15670000
157100              DELETE FROM PET_CLR_MKDN_EVNT                       15680000
157200               WHERE                                              15690000
157300                     CLR_EVNT_ID         = :PET00001.CLR-EVNT-ID  15700000
157400                 AND CLR_MKDN_CDE        = :PET00001.CLR-MKDN-CDE 15710000
157500           END-EXEC                                               15720000
157600                                                                  15730000
157700         EVALUATE TRUE                                            15740000
157800             WHEN SQLCODE = 0                                     15750000
157900*                 CONTINUE                                        15760000
158000                  ADD SQLERRD(3) TO PV-CLR-MKDN-EVNT-DEL          15770000
158100             WHEN SQLCODE = +1403                                 15780000
158200                  DISPLAY PV-PARAGRAPH-NAME                       15790000
158300                  MOVE CLR-EVNT-ID IN PET00001                    15800000
158400                                       TO PV-DISP-CLR-EVNT-ID     15810000
158500                  DISPLAY PV-PARAGRAPH-NAME                       15820000
158600                  DISPLAY 'EVENT / MARK NOT FOUND FOR DELETE: '   15830000
158700                          'EVENT > ' PV-DISP-CLR-EVNT-ID          15840000
158800                          ' MARK > ' CLR-MKDN-CDE IN PET00001     15850000
158900             WHEN SQLWARN0 NOT EQUAL SPACE                        15860000
159000             WHEN SQLCODE NOT EQUAL ZERO                          15870000
159100                  MOVE 'DELETE FROM PET_CLR_MKDN_EVNT'            15880000
159200                                     TO PV-ORA-OPERATION          15890000
159300                  PERFORM 9700-ORA-ERROR                          15900000
159400         END-EVALUATE                                             15910000
159500     END-PERFORM.                                                 15920000
159600                                                                  15930000
159700     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         15940000
159800        MOVE 'DELETE RETRIES EXCEEDED'                            15950000
159900                              TO  PV-ORA-OPERATION                15960000
160000        PERFORM 9700-ORA-ERROR                                    15970000
160100     END-IF.                                                      15980000
160200*7320-EXIT.  EXIT.                                                15990000
160300******************************************************************16000000
160400*     ATTEMPT TO INSERT TO PET_CLR_MKDN_EVNT TABLE.              *16010000
160500******************************************************************16020000
160600 7350-INSERT-EVNT-MARK.                                           16030000
160700     MOVE '7350-INSERT-EVNT-MARK       ' TO     PV-PARAGRAPH-NAME.16040000
160800     DISPLAY 'INSERTING MARK - EVENT ID ' CLR-EVNT-ID  IN PET0000116050000
160900             ' MARK ' CLR-MKDN-CDE IN PET00001.                   16060000
161000                                                                  16070000
161100     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          16080000
161200                                                                  16090000
161300     PERFORM                                                      16100000
161400         WITH TEST AFTER                                          16110000
161500         VARYING PV-SQL-SUB                                       16120000
161600         FROM 1 BY 1                                              16130000
161700         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 16140000
161800                   OR  SQLCODE = 0)                               16150000
161900                                                                  16160000
162000           EXEC SQL                                               16170000
162100              INSERT                                              16180000
162200                INTO PET_CLR_MKDN_EVNT                            16190000
162300                    (                                             16200000
162400                     CLR_EVNT_ID                                  16210000
162500                    ,CLR_MKDN_CDE                                 16220000
162600                    ,CLR_FRST_EFF_DTE                             16230000
162700                    ,CLR_LAST_EFF_DTE                             16240000
162800                    ,MKDN_QTY_TYP_CDE                             16250000
162900                    ,EVNT_MKDN_EXTR_DTE                           16260000
163000                    ,EVNT_MKDN_PRC_DTE                            16270000
163100                    ,ACTV_IND                                     16280000
163200                    ,CRE_TMST                                     16290000
163300                    ,CRE_BY_USR_ID                                16300000
163400                    ,LAST_UPD_TMST                                16310000
163500                    ,LAST_UPD_BY_USR_ID                           16320000
163600                    )                                             16330000
163700              VALUES                                              16340000
163800                    (                                             16350000
163900                     :PET00001.CLR-EVNT-ID                        16360000
164000                    ,:PET00001.CLR-MKDN-CDE                       16370000
164100                    ,TO_DATE(:PET00001.CLR-FRST-EFF-DTE,          16380000
164200                     'YYYY-MM-DD HH24.MI.SS')                     16390000
164300                    ,TO_DATE(:PET00001.CLR-LAST-EFF-DTE,          16400000
164400                     'YYYY-MM-DD HH24.MI.SS')                     16410000
164500                    ,:PET00001.MKDN-QTY-TYP-CDE                   16420000
164600                    ,TO_DATE(:PET00001.EVNT-MKDN-EXTR-DTE,        16430000
164700                     'YYYY-MM-DD HH24.MI.SS')                     16440000
164800                    ,TO_DATE(:PET00001.EVNT-MKDN-PRC-DTE,         16450000
164900                     'YYYY-MM-DD HH24.MI.SS')                     16460000
165000                    ,:PET00001.ACTV-IND                           16470000
165100                    ,SYSDATE                                      16480000
165200                    ,:PET00001.CRE-BY-USR-ID                      16490000
165300                    ,SYSDATE                                      16500000
165400                    ,:PET00001.LAST-UPD-BY-USR-ID                 16510000
165500                    )                                             16520000
165600           END-EXEC                                               16530000
165700                                                                  16540000
165800         EVALUATE TRUE                                            16550000
165900             WHEN SQLCODE = 0                                     16560000
166000                  ADD 1            TO PV-CLR-MKDN-EVNT-INS        16570000
166100             WHEN SQLWARN0 NOT EQUAL SPACE                        16580000
166200             WHEN SQLCODE NOT EQUAL ZERO                          16590000
166300                  MOVE 'INSERT TO PET_CLR_MKDN_EVNT'              16600000
166400                                     TO PV-ORA-OPERATION          16610000
166500                  PERFORM 9700-ORA-ERROR                          16620000
166600         END-EVALUATE                                             16630000
166700     END-PERFORM.                                                 16640000
166800                                                                  16650000
166900     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         16660000
167000        MOVE 'INSERT RETRIES EXCEEDED'                            16670000
167100                              TO  PV-ORA-OPERATION                16680000
167200        PERFORM 9700-ORA-ERROR                                    16690000
167300     END-IF.                                                      16700000
167400                                                                  16710000
167500*7350-EXIT.  EXIT.                                                16720000
167600******************************************************************16730000
167700*     ATTEMPT TO UPDATE TO PET_CLR_MKDN_EVNT TABLE.              *16740000
167800******************************************************************16750000
167900 7500-UPDATE-EVNT-MARK.                                           16760000
168000     DISPLAY 'UPDATING MARK - EVENT ID ' CLR-EVNT-ID  IN PET00001 16770000
168100             ' MARK ' CLR-MKDN-CDE IN PET00001.                   16780000
168200     MOVE '7500-UPDATE-EVNT-MARK       ' TO     PV-PARAGRAPH-NAME.16790000
168300     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          16800000
168400                                                                  16810000
168500     PERFORM                                                      16820000
168600         WITH TEST AFTER                                          16830000
168700         VARYING PV-SQL-SUB                                       16840000
168800         FROM 1 BY 1                                              16850000
168900         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 16860000
169000                   OR  SQLCODE = 0)                               16870000
169100                                                                  16880000
169200           EXEC SQL                                               16890000
169300              UPDATE PET_CLR_MKDN_EVNT                            16900000
169400                     SET CLR_EVNT_ID = :PET00001.CLR-EVNT-ID      16910000
169500                    ,CLR_MKDN_CDE = :PET00001.CLR-MKDN-CDE        16920000
169600                    ,CLR_FRST_EFF_DTE =                           16930000
169700                             TO_DATE(:PET00001.CLR-FRST-EFF-DTE,  16940000
169800                             'YYYY-MM-DD HH24.MI.SS')             16950000
169900                    ,CLR_LAST_EFF_DTE =                           16960000
170000                             TO_DATE(:PET00001.CLR-LAST-EFF-DTE,  16970000
170100                             'YYYY-MM-DD HH24.MI.SS')             16980000
170200                    ,MKDN_QTY_TYP_CDE =                           16990000
170300                             :PET00001.MKDN-QTY-TYP-CDE           17000000
170400                    ,EVNT_MKDN_EXTR_DTE =                         17010000
170500                             TO_DATE(:PET00001.EVNT-MKDN-EXTR-DTE,17020000
170600                             'YYYY-MM-DD HH24.MI.SS')             17030000
170700                    ,EVNT_MKDN_PRC_DTE =                          17040000
170800                             TO_DATE(:PET00001.EVNT-MKDN-PRC-DTE, 17050000
170900                             'YYYY-MM-DD HH24.MI.SS')             17060000
171000                    ,ACTV_IND = :PET00001.ACTV-IND                17070000
171100                    ,CRE_TMST = SYSDATE                           17080000
171200                    ,CRE_BY_USR_ID = :PET00001.CRE-BY-USR-ID      17090000
171300                    ,LAST_UPD_TMST = SYSDATE                      17100000
171400                    ,LAST_UPD_BY_USR_ID =                         17110000
171500                                    :PET00001.LAST-UPD-BY-USR-ID  17120000
171600               WHERE                                              17130000
171700                     CLR_EVNT_ID         = :PET00001.CLR-EVNT-ID  17140000
171800                 AND CLR_MKDN_CDE        = :PET00001.CLR-MKDN-CDE 17150000
171900           END-EXEC                                               17160000
172000         EVALUATE TRUE                                            17170000
172100             WHEN SQLCODE = 0                                     17180000
172200                  ADD 1            TO PV-CLR-MKDN-EVNT-UPD        17190000
172300             WHEN SQLWARN0 NOT EQUAL SPACE                        17200000
172400             WHEN SQLCODE NOT EQUAL ZERO                          17210000
172500                  MOVE 'UPDATE TO PET_CLR_MKDN_EVNT'              17220000
172600                                     TO PV-ORA-OPERATION          17230000
172700                  PERFORM 9700-ORA-ERROR                          17240000
172800         END-EVALUATE                                             17250000
172900     END-PERFORM.                                                 17260000
173000                                                                  17270000
173100     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         17280000
173200        MOVE 'UPDATE RETRIES EXCEEDED'                            17290000
173300                              TO  PV-ORA-OPERATION                17300000
173400        PERFORM 9700-ORA-ERROR                                    17310000
173500     END-IF.                                                      17320000
173600                                                                  17330000
173700*7500-EXIT.  EXIT.                                                17340000
182400******************************************************************18210000
182500*     READ INPUT VLDTD EVENT FILE.                               *18220000
182600******************************************************************18230000
182700 8000-READ-VALID-EVENT-IN-FILE.                                   18240000
182800     MOVE '8000-READ-VALID-EVENT-IN-FILE   ' TO PV-PARAGRAPH-NAME.18250000
182900                                                                  18260000
183000     READ VLDTD-EVENT-FILE INTO PA905-EVNT-CAL-VALID-REC          18270000
183100       AT END                                                     18280000
183200          SET PS-END-OF-INPUT TO TRUE                             18290000
183300       NOT AT END                                                 18300000
183400          ADD 1               TO PV-EVNT-RECS-READ                18310000
183500     END-READ.                                                    18320000
183600                                                                  18330000
183700*8000-EXIT.  EXIT.                                                18340000
183800******************************************************************18350000
183900*     READ DATE CONTROL VALIDATE FILE.                           *18360000
184000******************************************************************18370000
184100 8100-READ-DTE-CNTL-VLDT-FILE.                                    18380000
184200                                                                  18390000
184300     READ DTE-CNTL-VLDT-FILE INTO PA025-DTE-CONTROL-CARD-RCD      18400000
184400       AT END                                                     18410000
184500          SET PS-END-OF-VLDT-DTE-CNTL TO TRUE                     18420000
184600       NOT AT END                                                 18430000
184700          ADD 1               TO PV-CNTL-RECS-READ                18440000
184800     END-READ.                                                    18450000
184900                                                                  18460000
185000** ABEND IF LAST VALIDATED DATE CONTROL CARD IS EMPTY             18470000
185100     IF  PS-END-OF-VLDT-DTE-CNTL                                  18480000
185200         SET  PS-INPUT-ERROR                 TO TRUE              18490000
185300         MOVE '8100-READ-DTE-CNTL-VLDT-FILE' TO PV-PARAGRAPH-NAME 18500000
185400         MOVE 'VALIDATED DATE CARD IS EMPTY' TO PV-OPERATION-MSG-118510000
185500         SET  AC-4008-INPUT-FILE-ERROR       TO TRUE              18520000
185600         PERFORM 9800-ABEND                                       18530000
185700     END-IF.                                                      18540000
185800                                                                  18550000
185900*8100-EXIT.  EXIT.                                                18560000
186000******************************************************************18570000
186100*     READ DATE CONTROL EXEC FILE.                               *18580000
186200******************************************************************18590000
186300 8200-READ-DTE-CNTL-EXEC-FILE.                                    18600000
186400     MOVE '8200-READ-DTE-CNTL-EXEC-FILE    ' TO PV-PARAGRAPH-NAME.18610000
186500                                                                  18620000
186600     READ DTE-CNTL-EXEC-INFILE  INTO PA035-DTE-CONTROL-CARD-RCD   18630000
186700       AT END                                                     18640000
186800          SET PS-END-OF-EXEC-CNTL TO TRUE                         18650000
186900       NOT AT END                                                 18660000
187000          ADD 1               TO PV-CNTL-RECS-READ                18670000
187100     END-READ.                                                    18680000
187200                                                                  18690000
187300** ABEND IF DATE CONTROL CARD IS EMPTY                            18700000
187400     IF  PS-END-OF-EXEC-CNTL                                      18710000
187500         SET  PS-INPUT-ERROR                 TO TRUE              18720000
187600         MOVE '8200-READ-DTE-CNTL-EXEC-FILE' TO PV-PARAGRAPH-NAME 18730000
187700         MOVE 'EXEC CNTL DATE CARD IS EMPTY' TO PV-OPERATION-MSG-118740000
187800         SET   AC-4008-INPUT-FILE-ERROR      TO TRUE              18750000
187900         PERFORM 9800-ABEND                                       18760000
188000     END-IF.                                                      18770000
188100                                                                  18780000
188200*8200-EXIT.  EXIT.                                                18790000
188300******************************************************************18800000
188400* 8300-WRITE-DTE-CNTL-EXEC.                                      *18810000
188500*     REWRITE EXEC DATE CONTROL FILE.                            *18820000
188600******************************************************************18830000
188700 8300-WRITE-DTE-CNTL-EXEC.                                        18840000
188800     MOVE '8300-WRITE-DTE-CNTL-EXEC     ' TO PV-PARAGRAPH-NAME.   18850000
188900                                                                  18860000
189000     MOVE DF-DISPLAY-DATE TO PA035-LAST-CAL-UPDT-DTE.             18870000
189100     MOVE DF-DISPLAY-TIME TO PA035-LAST-CAL-UPDT-TIME.            18880000
189200                                                                  18890000
189300     WRITE DTE-CNTL-EXECOUT-RECORD                                18900000
189400      FROM PA035-DTE-CONTROL-CARD-RCD.                            18910000
189500                                                                  18920000
189600*8300-EXIT.                                                       18930000
192400******************************************************************19210000
192500* 8500-WRITE-UPDTE-EMAIL-RECORD                                   19220000
192600*    - WRITE ONLY IF SUCCESSFUL UPDATES.                          19230000
192700*    - EM-UPDTE-EMAIL-RECORD2 INDICATES WHETHER PROJECTION        19240000
192800*       UPDATE ERRORS EXIST.                                      19250000
192900******************************************************************19260000
193000 8500-WRITE-UPDTE-EMAIL-RECORD.                                   19270000
193100                                                                  19280000
193200     MOVE  DF-DISPLAY-DATE     TO EM-DATE.                        19290000
193300     MOVE  DF-DISPLAY-TIME     TO EM-TIME.                        19300000
193400                                                                  19310000
193500     MOVE  SPACES TO EMAIL-OUT-RECORD.                            19320000
193600     WRITE EMAIL-OUT-RECORD  FROM EM-UPDTE-EMAIL-RECORD1.         19330000
193700                                                                  19340000
193800     MOVE  SPACES TO EMAIL-OUT-RECORD.                            19350000
193900     WRITE EMAIL-OUT-RECORD.                                      19360000
194000                                                                  19370000
194100     MOVE  SPACES TO EMAIL-OUT-RECORD.                            19380000
194200     WRITE EMAIL-OUT-RECORD  FROM EM-UPDTE-EMAIL-RECORD2.         19390000
194300                                                                  19400000
194400*8500-EXIT.                                                       19410000
194500******************************************************************19420000
194600*     WRITE ERROR RECORD TO OUTPUT                               *19430000
194700******************************************************************19440000
194800 8700-WRITE-ERR-RECORD.                                           19450000
194900     MOVE '8700-WRITE-ERR-RECORD          ' TO PV-PARAGRAPH-NAME. 19460000
195000                                                                  19470000
195100     WRITE PRJCTN-UPDTE-ERROR-RECORD FROM PV-ERROR-RECORD.        19480000
195200                                                                  19490000
195300     ADD  1  TO  PV-ERR-RECS-OUT.                                 19500000
195400                                                                  19510000
195500*8700-EXIT.                                                       19520000
195600******************************************************************19530000
195700*     CLOSES ALL FILES AND DISPLAYS ANY NEEDED INFORMATION.      *19540000
195800******************************************************************19550000
195900 9000-WRAPUP.                                                     19560000
196000     MOVE '9000-WRAPUP                     ' TO PV-PARAGRAPH-NAME.19570000
196100                                                                  19580000
196200     PERFORM 9900-DISPLAY-TOTALS.                                 19590000
196300                                                                  19600000
196400     PERFORM 9990-GET-CURRENT.                                    19610000
196500                                                                  19620000
196600     DISPLAY '****************************************'.          19630000
196700     DISPLAY '**          PEKUP106 END              **'.          19640000
196800     DISPLAY '****************************************'.          19650000
196900     DISPLAY '**     END DATE ' DF-DISPLAY-DATE                   19660000
197000             '            **'.                                    19670000
197100     DISPLAY '**     END TIME ' DF-DISPLAY-TIME                   19680000
197200             '              **'.                                  19690000
197300     DISPLAY '****************************************'.          19700000
197400                                                                  19710000
197500     CLOSE VLDTD-EVENT-FILE                                       19720000
197600           DTE-CNTL-EXEC-INFILE                                   19730000
197700           DTE-CNTL-EXEC-OUTFILE                                  19740000
197800           DTE-CNTL-VLDT-FILE                                     19750000
197900           EMAIL-OUTFILE                                          19760000
198000           PRJCTN-UPDTE-ERROR-FILE.                               19770000
198100                                                                  19780000
198200*9000-EXIT.                                                       19790000
198300***************************************************************** 19800000
198400*     ORA ABEND ROUTINE.                                        * 19810000
198500***************************************************************** 19820000
198600 9700-ORA-ERROR.                                                  19830000
198700                                                                  19840000
198800     EXEC SQL                                                     19850000
198900        ROLLBACK                                                  19860000
199000     END-EXEC.                                                    19870000
199100                                                                  19880000
199200     PERFORM 9900-DISPLAY-TOTALS.                                 19890000
199300     PERFORM 9990-GET-CURRENT.                                    19900000
199400                                                                  19910000
199500     SET AC-4013-ORA-ERROR         TO TRUE.                       19920000
199600     DISPLAY '** ABEND     **'.                                   19930000
199700     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                19940000
199800     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              19950000
199900     DISPLAY '** OPERATION ** = ' PV-ORA-OPERATION.               19960000
200000     DISPLAY '** TIME      ** = ' DF-DISPLAY-TIME.                19970000
200100                                                                  19980000
200200     COPY DPPD004.                                                19990000
200300     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         20000000
200400                                                                  20010000
200500*9700-EXIT.                                                       20020000
200600******************************************************************20030000
200700*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                 *20040000
200800******************************************************************20050000
200900 9800-ABEND.                                                      20060000
201000                                                                  20070000
201100     PERFORM 9900-DISPLAY-TOTALS.                                 20080000
201200     PERFORM 9990-GET-CURRENT.                                    20090000
201300                                                                  20100000
201400     DISPLAY '** ABEND           **'.                             20110000
201500     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          20120000
201600     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        20130000
201700     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       20140000
201800     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       20150000
201900     DISPLAY '** TIME            ** = ' DF-DISPLAY-TIME.          20160000
202000                                                                  20170000
202100     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         20180000
202200                                                                  20190000
202300*9800-EXIT.                                                       20200000
202400******************************************************************20210000
202500*     DISPLAY END OF JOB TOTALS                                  *20220000
202600******************************************************************20230000
202700 9900-DISPLAY-TOTALS.                                             20240000
202800                                                                  20250000
202900     DISPLAY '****************************************'.          20260000
203000     DISPLAY '**     EOJ STATISTICS FOR PEKUP106    **'           20270000
203100     DISPLAY '****************************************'.          20280000
203200                                                                  20290000
203300     DISPLAY '** EVENT RECORDS READ ====> '                       20300000
203400             PV-EVNT-RECS-READ                                    20310000
203500             ' **'.                                               20320000
203600     DISPLAY '** CLR EVNT INSERTS ======> '                       20330000
203700             PV-CLR-EVNT-INS                                      20340000
203800             ' **'.                                               20350000
203900     DISPLAY '** CLR EVNT UPDATES ======> '                       20360000
204000             PV-CLR-EVNT-UPD                                      20370000
204100             ' **'.                                               20380000
204200     DISPLAY '** CLR EVNT DELETES ======> '                       20390000
204300             PV-CLR-EVNT-DEL                                      20400000
204400             ' **'.                                               20410000
204500     DISPLAY '** CLR MKDN EVNT INSERTS => '                       20420000
204600             PV-CLR-MKDN-EVNT-INS                                 20430000
204700             ' **'.                                               20440000
204800     DISPLAY '** CLR MKDN EVNT UPDATES => '                       20450000
204900             PV-CLR-MKDN-EVNT-UPD                                 20460000
205000             ' **'.                                               20470000
205100     DISPLAY '** CLR MKDN EVNT DELETES => '                       20480000
205200             PV-CLR-MKDN-EVNT-DEL                                 20490000
205300             ' **'.                                               20500000
206300     DISPLAY '** ERROR RECORDS OUT =====> '                       20600000
206400             PV-ERR-RECS-OUT                                      20610000
206500             ' **'.                                               20620000
206600     DISPLAY '** ERROR RECORDS OUT =====> '                       20630000
206700             PV-ERR-EMAIL-RECS-OUT                                20640000
206800             ' **'.                                               20650000
206900     DISPLAY '****************************************'.          20660000
207000                                                                  20670000
207100*9900-EXIT.                                                       20680000
207200******************************************************************20690000
207300*     GET CURRENT DATE, TIME AND TIMESTAMP FROM ORA / SYSTEM     *20700000
207400******************************************************************20710000
207500 9990-GET-CURRENT.                                                20720000
207600                                                                  20730000
207700     MOVE FUNCTION CURRENT-DATE(1:8) TO DF-CURRENT-DATE.          20740000
207800     ACCEPT DF-ACCEPT-TIME FROM TIME.                             20750000
207900                                                                  20760000
208000     MOVE DF-CURRENT-YR            TO DF-DD-YR.                   20770000
208100     MOVE DF-CURRENT-MO            TO DF-DD-MO.                   20780000
208200     MOVE DF-CURRENT-DY            TO DF-DD-DY.                   20790000
208300     MOVE DF-ACCEPT-HR             TO DF-DT-HR.                   20800000
208400     MOVE DF-ACCEPT-MIN            TO DF-DT-MIN.                  20810000
208500     MOVE DF-ACCEPT-SEC            TO DF-DT-SEC.                  20820000
208600                                                                  20830000
208700*9990-EXIT.                                                       20840000
208800*******************  -  END PROGRAM  -  ************************* 20850000
