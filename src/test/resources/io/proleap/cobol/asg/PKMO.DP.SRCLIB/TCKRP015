      ***************************************************************** 00010000
       IDENTIFICATION DIVISION.                                         00020000
      ***************************************************************** 00030000
                                                                        00040008
       PROGRAM-ID.            TCKRP015.                                 00050007
       AUTHOR.                ROBERTA DEBARTOLO                         00060007
       INSTALLATION.          KOHLS DEPARTMENT STORES.                  00070000
       DATE-WRITTEN.          MAY 2002.                                 00080000
       DATE-COMPILED.                                                   00090000
      ******************************************************************00100007
      *  PURPOSE:                                                      *00110007
      *  CREATE WEEKLY DEBIT DENIED TRANSACTIONS REPORT                *00120017
      ******************************************************************00130007
                                                                        00140019
       ENVIRONMENT DIVISION.                                            00150000
      *                                                                 00160000
       CONFIGURATION SECTION.                                           00170000
       SOURCE-COMPUTER. IBM-3090.                                       00180000
       OBJECT-COMPUTER. IBM-3090.                                       00190000
      *                                                                 00200000
      *                                                                 00210000
       INPUT-OUTPUT SECTION.                                            00220000
       FILE-CONTROL.                                                    00230007
                                                                        00240007
           SELECT MAF-DENIED-FILE                                       00280007
               ASSIGN TO INP01.                                         00290048
                                                                        00300007
           SELECT DATE-CONTROL-FILE                                     00301099
               ASSIGN TO INP02.                                         00302099
                                                                        00303099
           SELECT MAF-DENIED-REPORT                                     00310007
               ASSIGN TO RPT01.                                         00320007
                                                                        00330000
       EJECT                                                            00340000
      *                                                                 00350000
      ***************                                                   00360000
       DATA DIVISION.                                                   00370000
      ***************                                                   00380000
      *                                                                 00390000
       FILE SECTION.                                                    00400000
      *                                                                 00410000
       FD  MAF-DENIED-FILE                                              00490007
           RECORDING MODE IS F                                          00500007
           BLOCK CONTAINS 0 RECORDS.                                    00510007
                                                                        00520007
       01  MAF-DENIED-RECORD            PIC X(80).                      00530007
                                                                        00540007
       FD  DATE-CONTROL-FILE                                            00541099
           RECORDING MODE IS F                                          00542099
           BLOCK CONTAINS 0 RECORDS.                                    00543099
                                                                        00544099
       01  DATE-CONTROL-RECORD          PIC X(80).                      00545099
                                                                        00546099
                                                                        00550007
       FD  MAF-DENIED-REPORT                                            00560007
           RECORDING MODE IS F                                          00570007
           BLOCK CONTAINS 0 RECORDS.                                    00580007
                                                                        00590007
       01  MAF-DENIED-RPT-RECORD        PIC X(200).                     00600013
      *                                                                 00610000
      *                                                                 00620000
           EJECT                                                        00630000
      ******************************************************************00640000
       WORKING-STORAGE SECTION.                                         00650000
      ******************************************************************00660000
                                                                        00670000
       01  AC-ABEND-CODE                    PIC S9(04) VALUE +4003.     00680016
011400 01  ABEND-CODE  COMP                 PIC S9(04)     VALUE ZEROS. 00690016
011500     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 00700016
019600     88  ABEND-4019-CAL-SUB-ERROR                    VALUE +4019. 00701099
019300     88  ABEND-4008-INVALID-CC                       VALUE +4008. 00702099
                                                                        00710000
       01 PA-PROGRAM-ACCUMULATORS.                                      00720013
           05  PA-PAGE-CNT                 PIC S9(05) VALUE ZERO.       00721025
           05  PA-LINE-CNT                 PIC S9(03) VALUE ZERO.       00722025
           05  PA-DENIED-CTR               PIC  9(09) VALUE ZEROS.      00730013
           05  PA-STATE-DENIED-CTR         PIC  9(10) VALUE ZEROS.      00740013
           05  PA-KOHLS-DENIED-CTR         PIC  9(10) VALUE ZEROS.      00750013
           05  PA-APPROVED-CTR             PIC  9(10) VALUE ZEROS.      00760013
           05  PA-STATE-APPROVED-CTR       PIC  9(11) VALUE ZEROS.      00770013
           05  PA-KOHLS-APPROVED-CTR       PIC  9(11) VALUE ZEROS.      00780013
           05  PA-DEBIT-REQUEST-CTR        PIC  9(10) VALUE ZEROS.      00790013
           05  PA-STATE-DEBIT-REQ-CTR      PIC  9(11) VALUE ZEROS.      00800013
           05  PA-KOHLS-DEBIT-REQ-CTR      PIC  9(11) VALUE ZEROS.      00810013
           05  PA-DEBIT-TRANS-CTR          PIC  9(10) VALUE ZEROS.      00820013
           05  PA-STATE-DEBIT-TRANS-CTR    PIC  9(11) VALUE ZEROS.      00830013
           05  PA-KOHLS-DEBIT-TRANS-CTR    PIC  9(11) VALUE ZEROS.      00840013
           05  PA-DEBIT-CREDIT-CTR         PIC  9(10) VALUE ZEROS.      00850013
           05  PA-STATE-DEBIT-CREDIT-CTR   PIC  9(10) VALUE ZEROS.      00860013
           05  PA-KOHLS-DEBIT-CREDIT-CTR   PIC  9(10) VALUE ZEROS.      00870013
           05  PA-INVALID-CARD-CTR         PIC  9(07) VALUE ZEROS.      00880013
           05  PA-STATE-INVALID-CARD-CTR   PIC  9(08) VALUE ZEROS.      00890013
           05  PA-KOHLS-INVALID-CARD-CTR   PIC  9(09) VALUE ZEROS.      00900013
           05  PA-INSUFF-FUNDS-CTR         PIC  9(07) VALUE ZEROS.      00910013
           05  PA-STATE-INSUFF-FUNDS-CTR   PIC  9(08) VALUE ZEROS.      00920013
           05  PA-KOHLS-INSUFF-FUNDS-CTR   PIC  9(09) VALUE ZEROS.      00930013
           05  PA-LIMIT-EXCEED-CTR         PIC  9(07) VALUE ZEROS.      00940013
           05  PA-STATE-LIMIT-EXCEED-CTR   PIC  9(08) VALUE ZEROS.      00950013
           05  PA-KOHLS-LIMIT-EXCEED-CTR   PIC  9(09) VALUE ZEROS.      00960013
           05  PA-2MANY-PIN-CTR            PIC  9(07) VALUE ZEROS.      00970013
           05  PA-STATE-2MANY-PIN-CTR      PIC  9(08) VALUE ZEROS.      00980013
           05  PA-KOHLS-2MANY-PIN-CTR      PIC  9(09) VALUE ZEROS.      00990013
           05  PA-INVALID-PIN-CTR          PIC  9(07) VALUE ZEROS.      01000013
           05  PA-STATE-INVALID-PIN-CTR    PIC  9(08) VALUE ZEROS.      01010013
           05  PA-KOHLS-INVALID-PIN-CTR    PIC  9(09) VALUE ZEROS.      01020013
           05  PA-EXP-LOST-STOLEN-CTR      PIC  9(07) VALUE ZEROS.      01030013
           05  PA-STATE-EXP-LOST-CTR       PIC  9(08) VALUE ZEROS.      01040013
           05  PA-KOHLS-EXP-LOST-CTR       PIC  9(09) VALUE ZEROS.      01050013
           05  PA-COMM-ERROR-CTR           PIC  9(07) VALUE ZEROS.      01060013
           05  PA-STATE-COMM-ERROR-CTR     PIC  9(08) VALUE ZEROS.      01070013
           05  PA-KOHLS-COMM-ERROR-CTR     PIC  9(09) VALUE ZEROS.      01080013
           05  PA-OTHER-CTR                PIC  9(07) VALUE ZEROS.      01090013
           05  PA-STATE-OTHER-CTR          PIC  9(08) VALUE ZEROS.      01100013
           05  PA-KOHLS-OTHER-CTR          PIC  9(09) VALUE ZEROS.      01110013
                                                                        01120013
                                                                        01130000
       01  PC-PROGRAM-CONSTANTS.                                        01140000
           05  PC-LINE-LIMIT               PIC S9(04)    VALUE +75.     01141099
           05  PC-CURRENT-PROGRAM-NAME      PIC X(08)     VALUE         01150000
                                                         'TCKRP015'.    01150135
009200     05  PC-ABEND-MSG                 PIC X(12)      VALUE        01151035
009300         '** ABEND ** '.                                          01152035
009400     05  PC-DB-ERROR-PREFIX           PIC X(09)      VALUE        01153035
009500         'DB2 ERROR'.                                             01154035
009600     05  PC-DB-ATTEMPTING-MSG         PIC X(14)      VALUE        01155035
009700         'ATTEMPTING TO '.                                        01156035
010000     05  PC-CAL-SUB-TRN-DTE-ERROR     PIC X(42)      VALUE        01159099
010100         'CAL SUBROUTINE ERROR ON TRN DTE CONVERSION'.            01160099
                                                                        01170000
       01 PS-PROGRAM-SWITCHES.                                          01180000
                                                                        01190000
           05  PS-END-OF-MAF-DENIED-SW       PIC X(01) VALUE 'N'.       01200007
               88  PS-END-OF-DENIED-FILE               VALUE 'Y'.       01210007
               88  PS-NOT-END-OF-DENIED-FILE           VALUE 'N'.       01220007
           05  PS-FIRST-TIME-THRU-SW         PIC X(01) VALUE 'Y'.       01260006
               88  PS-FIRST-TIME-THRU                  VALUE 'Y'.       01270006
               88  PS-NOT-FIRST-TIME-THRU              VALUE 'N'.       01280006
010800     05  PS-END-OF-CONTROL-FILE-SW    PIC X(01)  VALUE 'N'.       01281099
010900         88  PS-NOT-END-CONTROL-FILE             VALUE 'N'.       01282099
011000         88  PS-END-OF-CONTROL-FILE              VALUE 'Y'.       01283099
                                                                        01290000
       01 PV-PROGRAM-VARIABLES.                                         01300004
                                                                        01310004
           05  PV-PARAGRAPH-NAME           PIC  X(30)   VALUE SPACES.   01320013
           05  PV-OPERATION-MSG-1          PIC  X(40)   VALUE SPACES.   01330013
           05  PV-OPERATION-MSG-2          PIC  X(40)   VALUE SPACES.   01340013
011200     05  PV-DB2-ERROR-MSG            PIC  X(40)   VALUE SPACES.   01350016
           05  PV-PRINT-RECORD             PIC X(200)   VALUE SPACES.   01360016
           05  PV-READ-CNT                 PIC 9(07)    VALUE ZEROES.   01370016
           05  PV-WRITE-CNT                PIC 9(07)    VALUE ZEROES.   01380016
           05  PV-DISPLAY-CNT              PIC Z,ZZZ,ZZ9.               01390016
           05  PV-LINE-SPACING             PIC S9(04)   VALUE ZEROS.    01400016
           05  PV-HOLD-CARD-NBR            PIC  X(19)   VALUE SPACES.   01410013
           05  PV-DATE                     PIC  X(10)   VALUE SPACES.   01420056
           05  PV-DATE-CCYYMMDD.                                        01420159
               10 PV-DATE-CCYY             PIC  X(04)   VALUE SPACES.   01420258
               10 PV-DATE-MM               PIC  X(02)   VALUE SPACES.   01420458
               10 PV-DATE-DD               PIC  X(02)   VALUE SPACES.   01420658
           05  PV-CCYY-MM-DD.                                           01420758
               10 PV-CCYY                  PIC  X(04)   VALUE SPACES.   01420857
               10 FILLER                   PIC  X(01)   VALUE '-'.      01420957
               10 PV-MM                    PIC  X(02)   VALUE SPACES.   01421057
               10 FILLER                   PIC  X(01)   VALUE '-'.      01421157
               10 PV-DD                    PIC  X(02)   VALUE SPACES.   01421257
           05  PV-TRAN-DENIED              PIC  X(01)   VALUE '2'.      01422034
           05  PV-TRAN-APPROVED            PIC  X(01)   VALUE '3'.      01423099
           05  PV-REG-NBR          COMP    PIC  S9(04)   VALUE ZEROS.   01430046
           05  PV-TRAN-NBR         COMP    PIC  S9(04)   VALUE ZEROS.   01430146
           05  PV-HOLD-STORE-NBR    COMP   PIC  S9(04)   VALUE ZEROS.   01430247
015600     05  PV-STORE-NBR     REDEFINES  PV-HOLD-STORE-NBR            01430342
015700                              COMP    PIC S9(04).                 01430446
           05  PV-HOLD-STATE-CDE           PIC  X(02)   VALUE SPACES.   01431033
           05  PV-HOLD-TRAN-RESP-CDE       PIC  9(03)   VALUE ZEROS.    01440013
           05  PV-INVALID-CARD             PIC 9(03)    VALUE 001.      01460037
           05  PV-INSUFF-FUNDS-18          PIC 9(03)    VALUE 018.      01470037
           05  PV-INSUFF-FUNDS-19          PIC 9(03)    VALUE 019.      01471037
           05  PV-INSUFF-FUNDS-58          PIC 9(03)    VALUE 058.      01472037
           05  PV-LIMIT-EXCEED-24          PIC 9(03)    VALUE 024.      01500037
           05  PV-LIMIT-EXCEED-28          PIC 9(03)    VALUE 028.      01501037
           05  PV-LIMIT-EXCEED-127         PIC 9(03)    VALUE 127.      01502037
           05  PV-LIMIT-EXCEED-128         PIC 9(03)    VALUE 128.      01503037
           05  PV-LIMIT-EXCEED-179         PIC 9(03)    VALUE 179.      01504037
           05  PV-TOO-MANY-PIN-44          PIC 9(03)    VALUE 044.      01550037
           05  PV-TOO-MANY-PIN-50          PIC 9(03)    VALUE 050.      01551037
           05  PV-TOO-MANY-PIN-124         PIC 9(03)    VALUE 124.      01552037
           05  PV-INVALID-PIN              PIC 9(03)    VALUE 051.      01580037
           05  PV-EXP-LOST-STOLEN-3        PIC 9(03)    VALUE 003.      01590037
           05  PV-EXP-LOST-STOLEN-82       PIC 9(03)    VALUE 082.      01591037
           05  PV-EXP-LOST-STOLEN-83       PIC 9(03)    VALUE 083.      01592037
           05  PV-EXP-LOST-STOLEN-104      PIC 9(03)    VALUE 104.      01593037
           05  PV-COMM-ERROR-98            PIC 9(03)    VALUE 098.      01630037
           05  PV-COMM-ERROR-99            PIC 9(03)    VALUE 099.      01631037
           05  PV-COMM-ERROR-105           PIC 9(03)    VALUE 105.      01632037
           05  PV-COMM-ERROR-106           PIC 9(03)    VALUE 106.      01633037
           05  PV-APPROVED-TRAN            PIC 9(03)    VALUE 000.      01634037
013100******************************************************************01661031
013200*   DATE AND TIME FIELDS.                                        *01662031
013300******************************************************************01663031
013400 01  PV-DATE-AND-TIME-FIELDS.                                     01664031
013500     05  PV-MMDDYY-DATE.                                          01665031
013600         10  PV-MMDDYY-MM            PIC X(02).                   01666031
013700         10  PV-MMDDYY-DD            PIC X(02).                   01667031
013800         10  PV-MMDDYY-YY            PIC X(02).                   01668031
013900     05  PV-CURR-DATE-CCYYMMDD.                                   01669031
014000         10  PV-CURR-DATE-CCYY       PIC  9(04).                  01669131
014100         10  PV-CURR-DATE-MM         PIC  9(02).                  01669231
014200         10  PV-CURR-DATE-DD         PIC  9(02).                  01669331
013900     05  PV-HEADER-DATE.                                          01669476
014100         10  PV-HEADER-MM            PIC  X(02).                  01669576
               10  FILLER                  PIC  X(01)  VALUE '/'.       01669676
014200         10  PV-HEADER-DD            PIC  X(02).                  01669776
               10  FILLER                  PIC  X(01)  VALUE '/'.       01669876
014000         10  PV-HEADER-CCYY          PIC  X(04).                  01670076
014300     05  PV-CURR-TIME.                                            01670176
014400         10  PV-CURR-TIME-HH         PIC  9(02)    VALUE ZERO.    01670276
014500         10  PV-CURR-TIME-MM         PIC  9(02)    VALUE ZERO.    01670376
014600         10  PV-CURR-TIME-SS         PIC  9(02)    VALUE ZERO.    01670476
007200******************************************************************01670599
007300* RECORD LAYOUT FOR INPUT DATE CARD (POS DATE)                    01670699
007400******************************************************************01670799
007500 01  CC-CONTROL-CARD.                                             01670899
007600     05  CC-DATE-MMDDCCYY.                                        01670999
007700         10 CC-DATE-MM                PIC X(02)    VALUE SPACES.  01671099
007800         10 CC-DATE-DD                PIC X(02)    VALUE SPACES.  01671299
007900         10 CC-DATE-CCYY              PIC X(04)    VALUE SPACES.  01671499
008100     05  FILLER                       PIC X(72)    VALUE SPACES.  01671599
008200                                                                  01671699
019800*----------------------------------------------------------------*01671799
019900*  DATE VALIDATION CALLING PARAMETER LIST                        *01671899
020000*----------------------------------------------------------------*01671999
020100     COPY DPWS500.                                                01672099
      ******************************************************************01673007
      *  TOP OF PAGE HEADING LINE FOR PRINTING A 200 CHARACTER REPORT. *01680016
      ******************************************************************01690007
           COPY DPWS200.                                                01700012
      ******************************************************************01710007
      *  INPUT FILE                                                    *01720007
      ******************************************************************01730007
           COPY TCWS003.                                                01740007
      ******************************************************************01750016
012900*    STANDARD DB2 ERROR HANDLING AREA                            *01760016
013000*----------------------------------------------------------------*01770016
013100     COPY DPWS004.                                                01780016
013200*----------------------------------------------------------------*01790016
013300*    TRANS TABLE TEPTND                                          *01800016
013400*----------------------------------------------------------------*01810016
013500     EXEC SQL                                                     01820016
013600         INCLUDE TEPTND                                           01830016
013700     END-EXEC.                                                    01840016
013200*----------------------------------------------------------------*01840162
013300*    LOCATION DOMAIN TABLE                                       *01840299
013400*----------------------------------------------------------------*01840362
013500     EXEC SQL                                                     01840462
013600         INCLUDE XST00001                                         01840599
013700     END-EXEC.                                                    01840662
013200*----------------------------------------------------------------*01841027
013300*    PARTITION TABLE TEPPART                                     *01842027
013400*----------------------------------------------------------------*01843027
013500     EXEC SQL                                                     01844027
013600         INCLUDE TEPPART                                          01845027
013700     END-EXEC.                                                    01846027
015600*----------------------------------------------------------------*01850016
015700*    STANDARD DB2 COMMUNICATIONS AREA                            *01860016
015800*----------------------------------------------------------------*01870016
015900     EXEC SQL                                                     01880016
016000         INCLUDE SQLCA                                            01890016
016100     END-EXEC.                                                    01900016
017100                                                                  01910011
017200******************************************************************01920011
017300*  T1 TITLE FOR REPORT 1                                         *01930011
017400******************************************************************01940011
017500 01  T1-TITLE-LINE.                                               01950025
017600     05  FILLER                      PIC  X(77)    VALUE SPACES.  01960028
017700     05  T1-TITLE.                                                01970011
017800         10  FILLER                  PIC  X(36)    VALUE          01980086
017900         'DEBIT REQUEST REPORT FOR WEEKENDING '.                  01990086
018030     05  T1-PROCESS-MM               PIC  X(02)    VALUE SPACES.  02000099
018030     05  FILLER                      PIC  X(01)    VALUE '/'.     02001099
018030     05  T1-PROCESS-DD               PIC  X(02)    VALUE SPACES.  02002099
018030     05  FILLER                      PIC  X(01)    VALUE '/'.     02003099
018030     05  T1-PROCESS-CCYY             PIC  X(04)    VALUE SPACES.  02004099
018040     05  FILLER                      PIC  X(77)    VALUE SPACES.  02010086
018050                                                                  02020011
017200******************************************************************02030011
017300*  T2 TITLE FOR REPORT 1                                         *02040011
017400******************************************************************02050011
017500 01  T2-TITLE-LINE.                                               02060025
017600     05  FILLER                      PIC  X(25)    VALUE SPACES.  02070012
017700     05  T2-TITLE.                                                02080011
017800         10  FILLER                  PIC  X(36)    VALUE          02090011
017900         '- - - - - - - - - - - - - - - - '.                      02100012
017800         10  FILLER                  PIC  X(29)    VALUE          02110011
017900         'D E N I E D  R E Q U E S T S '.                         02120012
017800         10  FILLER                  PIC  X(36)    VALUE          02130011
017900         '- - - - - - - - - - - - - - - - '.                      02140012
018040     05  FILLER                      PIC  X(61)    VALUE SPACES.  02150012
018040     05  FILLER                      PIC  X(11)    VALUE          02160012
017900         'DENIED CARD'.                                           02170012
018040     05  FILLER                      PIC  X(02)    VALUE SPACES.  02180012
018050                                                                  02190012
018060******************************************************************02200012
018070*  H1 COLUMN HEADINGS REPORT 1                                   *02210011
018080******************************************************************02220011
018090 01  H1-DENIED-HEADING.                                           02230012
018100     05  FILLER                      PIC  X(25)    VALUE SPACES.  02240012
018200     05  FILLER                      PIC  X(12)    VALUE          02250012
018300         'INVALID CARD'.                                          02260012
018400     05  FILLER                      PIC  X(02)    VALUE SPACES.  02270012
018500     05  FILLER                      PIC  X(12)    VALUE          02280012
018600         'INSUFFICIENT'.                                          02290012
018700     05  FILLER                      PIC  X(03)    VALUE SPACES.  02300012
018800     05  FILLER                      PIC  X(05)    VALUE          02310012
018900         'LIMIT'.                                                 02320012
019000     05  FILLER                      PIC  X(05)    VALUE SPACES.  02330011
019100     05  FILLER                      PIC  X(08)    VALUE          02340012
019200         'TOO MANY'.                                              02350012
019000     05  FILLER                      PIC  X(05)    VALUE SPACES.  02360012
019100     05  FILLER                      PIC  X(07)    VALUE          02370012
019200         'INVALID'.                                               02380012
019300     05  FILLER                      PIC  X(03)    VALUE SPACES.  02390012
019100     05  FILLER                      PIC  X(08)    VALUE          02400012
019200         'EXPIRED/'.                                              02410012
019000     05  FILLER                      PIC  X(05)    VALUE SPACES.  02420012
019100     05  FILLER                      PIC  X(04)    VALUE          02430012
019200         'COMM'.                                                  02440012
019000     05  FILLER                      PIC  X(21)    VALUE SPACES.  02450012
019100     05  FILLER                      PIC  X(05)    VALUE          02460012
019200         'TOTAL'.                                                 02470012
019000     05  FILLER                      PIC  X(10)    VALUE SPACES.  02480012
019100     05  FILLER                      PIC  X(05)    VALUE          02490012
019200         'TOTAL'.                                                 02500012
019000     05  FILLER                      PIC  X(09)    VALUE SPACES.  02510012
019100     05  FILLER                      PIC  X(11)    VALUE          02520012
019200         'TOTAL DEBIT'.                                           02530012
019000     05  FILLER                      PIC  X(06)    VALUE SPACES.  02540012
019100     05  FILLER                      PIC  X(11)    VALUE          02550012
019200         'TOTAL DEBIT'.                                           02560012
019000     05  FILLER                      PIC  X(06)    VALUE SPACES.  02570012
019100     05  FILLER                      PIC  X(07)    VALUE          02580012
019200         'USED AS'.                                               02590012
019000     05  FILLER                      PIC  X(05)    VALUE SPACES.  02600012
019400******************************************************************02610012
019500*  H2 COLUMN HEADINGS REPORT 1                                   *02620012
019600******************************************************************02630011
019700 01  H2-DENIED-HEADING.                                           02640012
018200     05  FILLER                      PIC  X(05)    VALUE          02660012
018300         'STATE'.                                                 02670012
018100     05  FILLER                      PIC  X(01)    VALUE SPACES.  02680012
018100     05  FILLER                      PIC  X(05)    VALUE          02690012
018300         'STORE'.                                                 02700012
018200     05  FILLER                      PIC  X(14)    VALUE SPACES.  02710088
018200     05  FILLER                      PIC  X(12)    VALUE          02720012
018300         'OR TERM TYPE'.                                          02730012
018400     05  FILLER                      PIC  X(05)    VALUE SPACES.  02740012
018500     05  FILLER                      PIC  X(05)    VALUE          02750012
018600         'FUNDS'.                                                 02760012
018700     05  FILLER                      PIC  X(06)    VALUE SPACES.  02770012
018800     05  FILLER                      PIC  X(08)    VALUE          02780012
018900         'EXCEEDED'.                                              02790012
019000     05  FILLER                      PIC  X(02)    VALUE SPACES.  02800012
019100     05  FILLER                      PIC  X(09)    VALUE          02810012
019200         'PIN TRIES'.                                             02820012
019000     05  FILLER                      PIC  X(07)    VALUE SPACES.  02830012
019100     05  FILLER                      PIC  X(03)    VALUE          02840012
019200         'PIN'.                                                   02850012
019300     05  FILLER                      PIC  X(04)    VALUE SPACES.  02860012
019100     05  FILLER                      PIC  X(11)    VALUE          02870012
019200         'LOST/STOLEN'.                                           02880012
019000     05  FILLER                      PIC  X(03)    VALUE SPACES.  02890012
019100     05  FILLER                      PIC  X(05)    VALUE          02900012
019200         'ERROR'.                                                 02910012
019000     05  FILLER                      PIC  X(08)    VALUE SPACES.  02920012
019100     05  FILLER                      PIC  X(05)    VALUE          02930012
019200         'OTHER'.                                                 02940012
019000     05  FILLER                      PIC  X(07)    VALUE SPACES.  02950088
019100     05  FILLER                      PIC  X(06)    VALUE          02960012
019200         'DENIED'.                                                02970012
019000     05  FILLER                      PIC  X(08)    VALUE SPACES.  02980012
019100     05  FILLER                      PIC  X(08)    VALUE          02990012
019200         'APPROVED'.                                              03000012
019000     05  FILLER                      PIC  X(08)    VALUE SPACES.  03010012
019100     05  FILLER                      PIC  X(08)    VALUE          03020012
019200         'REQUESTS'.                                              03030012
019000     05  FILLER                      PIC  X(08)    VALUE SPACES.  03040088
019100     05  FILLER                      PIC  X(12)    VALUE          03050012
019200         'TRANSACTIONS'.                                          03060012
019000     05  FILLER                      PIC  X(04)    VALUE SPACES.  03070099
019100     05  FILLER                      PIC  X(12)    VALUE          03080099
019200         'OTHER TENDER'.                                          03090099
020727******************************************************************03110011
020728*  DETAIL LINE FOR REPORT 1                                       03120011
020729******************************************************************03130011
020730 01  D1-DETAIL-LINE.                                              03140025
020750     05  D1-STATE-CDE                PIC  X(02).                  03141026
020750     05  FILLER                      PIC  X(04)    VALUE SPACES.  03142026
020740     05  D1-STORE-NBR                PIC  X(04).                  03150011
020750     05  FILLER                      PIC  X(01)    VALUE '-'.     03160026
020750     05  FILLER                      PIC  X(01)    VALUE SPACES.  03161026
020760     05  D1-STORE-DESC               PIC  X(10).                  03170026
020770     05  FILLER                      PIC  X(05)    VALUE SPACES.  03180071
020780     05  D1-INVALID-CARD             PIC  Z,ZZZ,ZZ9.              03190026
020790     05  FILLER                      PIC  X(03)    VALUE SPACES.  03200011
020800     05  D1-INSUFF-FUNDS             PIC  Z,ZZZ,ZZ9.              03210026
020900     05  FILLER                      PIC  X(03)    VALUE SPACES.  03220026
021000     05  D1-LIMIT-EXCEEDED           PIC  Z,ZZZ,ZZ9.              03230026
021100     05  FILLER                      PIC  X(03)    VALUE SPACES.  03240011
021200     05  D1-2MANY-PIN                PIC  Z,ZZZ,ZZ9.              03250026
021300     05  FILLER                      PIC  X(03)    VALUE SPACES.  03260011
021400     05  D1-INVALID-PIN              PIC  Z,ZZZ,ZZ9.              03270026
021500     05  FILLER                      PIC  X(03)    VALUE SPACES.  03280011
021600     05  D1-EXP-LOST-STOLEN          PIC  Z,ZZZ,ZZ9.              03290026
021700     05  FILLER                      PIC  X(03)    VALUE SPACES.  03300011
021800     05  D1-COMM-ERROR               PIC  Z,ZZZ,ZZ9.              03310026
021700     05  FILLER                      PIC  X(03)    VALUE SPACES.  03311026
021800     05  D1-OTHER                    PIC  Z,ZZZ,ZZ9.              03312026
021700     05  FILLER                      PIC  X(03)    VALUE SPACES.  03313026
021800     05  D1-TOTAL-DENIED             PIC  ZZZ,ZZZ,ZZ9.            03314026
021700     05  FILLER                      PIC  X(03)    VALUE SPACES.  03315026
021800     05  D1-TOTAL-APPROVED           PIC  Z,ZZZ,ZZZ,ZZ9.          03316026
021700     05  FILLER                      PIC  X(03)    VALUE SPACES.  03317026
021800     05  D1-TOTAL-DEBIT-REQ          PIC  Z,ZZZ,ZZZ,ZZ9.          03318026
021700     05  FILLER                      PIC  X(03)    VALUE SPACES.  03319026
021800     05  D1-TOTAL-DEBIT-TRANS        PIC  Z,ZZZ,ZZZ,ZZ9.          03319126
021700     05  FILLER                      PIC  X(03)    VALUE SPACES.  03319226
021800     05  D1-DENIED-CREDIT            PIC  Z,ZZZ,ZZZ,ZZ9.          03319399
021900                                                                  03320011
022000******************************************************************03330011
022100*  T1 STATE TOTALS LINE                                          *03340025
022200******************************************************************03350011
022300 01  T1-TOTALS-LINE.                                              03360011
020750     05  FILLER                      PIC  X(06)    VALUE          03360128
                'TOTAL '.                                               03360226
020750     05  T1-STATE-CDE                PIC  X(02)    VALUE SPACES.  03361071
020750     05  FILLER                      PIC  X(18)    VALUE SPACES.  03362086
020780     05  T1-INVALID-CARD             PIC  ZZ,ZZZ,ZZ9.             03368026
020790     05  FILLER                      PIC  X(02)    VALUE SPACES.  03369086
020800     05  T1-INSUFF-FUNDS             PIC  ZZ,ZZZ,ZZ9.             03369126
020900     05  FILLER                      PIC  X(02)    VALUE SPACES.  03369286
021000     05  T1-LIMIT-EXCEEDED           PIC  ZZ,ZZZ,ZZ9.             03369326
021100     05  FILLER                      PIC  X(02)    VALUE SPACES.  03369486
021200     05  T1-2MANY-PIN                PIC  ZZ,ZZZ,ZZ9.             03369526
021300     05  FILLER                      PIC  X(02)    VALUE SPACES.  03369686
021400     05  T1-INVALID-PIN              PIC  ZZ,ZZZ,ZZ9.             03369726
021500     05  FILLER                      PIC  X(02)    VALUE SPACES.  03369886
021600     05  T1-EXP-LOST-STOLEN          PIC  ZZ,ZZZ,ZZ9.             03369926
021700     05  FILLER                      PIC  X(02)    VALUE SPACES.  03370086
021800     05  T1-COMM-ERROR               PIC  ZZ,ZZZ,ZZ9.             03370126
021700     05  FILLER                      PIC  X(02)    VALUE SPACES.  03370286
021800     05  T1-OTHER                    PIC  ZZ,ZZZ,ZZ9.             03370326
021700     05  FILLER                      PIC  X(01)    VALUE SPACES.  03370487
021800     05  T1-TOTAL-DENIED             PIC  Z,ZZZ,ZZZ,ZZ9.          03370526
021700     05  FILLER                      PIC  X(02)    VALUE SPACES.  03370686
021800     05  T1-TOTAL-APPROVED           PIC  ZZ,ZZZ,ZZZ,ZZ9.         03370726
021700     05  FILLER                      PIC  X(02)    VALUE SPACES.  03370886
021800     05  T1-TOTAL-DEBIT-REQ          PIC  ZZ,ZZZ,ZZZ,ZZ9.         03370926
021700     05  FILLER                      PIC  X(02)    VALUE SPACES.  03371086
021800     05  T1-TOTAL-DEBIT-TRANS        PIC  ZZ,ZZZ,ZZZ,ZZ9.         03371126
021700     05  FILLER                      PIC  X(03)    VALUE SPACES.  03371287
021800     05  T1-DEBIT-CREDIT             PIC  Z,ZZZ,ZZZ,ZZ9.          03371330
023400******************************************************************03470011
023500*  T2 CORP TOTALS LINE                                           *03480025
023600******************************************************************03490011
023700 01  T2-TOTALS-LINE.                                              03500025
020750     05  FILLER                      PIC  X(13)    VALUE          03501028
                'TOTAL COMPANY'.                                        03502026
020750     05  FILLER                      PIC  X(12)    VALUE SPACES.  03504087
020780     05  T2-INVALID-CARD             PIC  ZZZ,ZZZ,ZZ9.            03505026
020790     05  FILLER                      PIC  X(01)    VALUE SPACES.  03506087
020800     05  T2-INSUFF-FUNDS             PIC  ZZZ,ZZZ,ZZ9.            03507026
020900     05  FILLER                      PIC  X(01)    VALUE SPACES.  03508088
021000     05  T2-LIMIT-EXCEEDED           PIC  ZZZ,ZZZ,ZZ9.            03509026
021100     05  FILLER                      PIC  X(01)    VALUE SPACES.  03509188
021200     05  T2-2MANY-PIN                PIC  ZZZ,ZZZ,ZZ9.            03509226
021300     05  FILLER                      PIC  X(01)    VALUE SPACES.  03509388
021400     05  T2-INVALID-PIN              PIC  ZZZ,ZZZ,ZZ9.            03509426
021500     05  FILLER                      PIC  X(01)    VALUE SPACES.  03509588
021600     05  T2-EXP-LOST-STOLEN          PIC  ZZZ,ZZZ,ZZ9.            03509626
021700     05  FILLER                      PIC  X(01)    VALUE SPACES.  03509788
021800     05  T2-COMM-ERROR               PIC  ZZZ,ZZZ,ZZ9.            03509826
021700     05  FILLER                      PIC  X(01)    VALUE SPACES.  03509988
021800     05  T2-OTHER                    PIC  ZZZ,ZZZ,ZZ9.            03510026
021700     05  FILLER                      PIC  X(01)    VALUE SPACES.  03510188
021800     05  T2-TOTAL-DENIED             PIC  Z,ZZZ,ZZZ,ZZ9.          03510226
021700     05  FILLER                      PIC  X(02)    VALUE SPACES.  03510389
021800     05  T2-TOTAL-APPROVED           PIC  ZZ,ZZZ,ZZZ,ZZ9.         03510426
021700     05  FILLER                      PIC  X(02)    VALUE SPACES.  03510589
021800     05  T2-TOTAL-DEBIT-REQ          PIC  ZZ,ZZZ,ZZZ,ZZ9.         03510626
021700     05  FILLER                      PIC  X(02)    VALUE SPACES.  03510789
021800     05  T2-TOTAL-DEBIT-TRANS        PIC  ZZ,ZZZ,ZZZ,ZZ9.         03510826
021700     05  FILLER                      PIC  X(03)    VALUE SPACES.  03510990
021800     05  T2-DEBIT-CREDIT             PIC  Z,ZZZ,ZZZ,ZZ9.          03511029
      ******************************************************************03620025
      *  END OF REPORT LINE                                             03630025
      ******************************************************************03640025
       01  E1-END-OF-RPT-LINE.                                          03650025
           05  FILLER                      PIC  X(78)    VALUE SPACES.  03660025
           05  FILLER                      PIC  X(43)    VALUE          03670025
               '********  E N D  O F  R E P O R T  ********'.           03680025
           05  FILLER                      PIC  X(79)    VALUE SPACES.  03690025
                                                                        03700025
      *                                                                 04650000
       EJECT                                                            04660000
      *                                                                 04670000
      ****************************************************************  04680000
       PROCEDURE DIVISION.                                              04690000
      ****************************************************************  04700000
      * 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE  *  04710000
      * PROGRAM.                                                     *  04720000
      ****************************************************************  04730000
                                                                        04740000
       0000-PROGRAM-MAINLINE.                                           04750000
                                                                        04760000
           PERFORM 1000-INITIALIZATION.                                 04770000
                                                                        04780003
           PERFORM 2000-PROCESS-DENIED-FILE                             04790010
              UNTIL PS-END-OF-DENIED-FILE.                              04800007
                                                                        04810000
           PERFORM 9900-END-ROUTINE.                                    04820013
                                                                        04830000
           GOBACK.                                                      04840000
                                                                        04850000
           EJECT                                                        04860000
      *                                                                 04870000
      ****************************************************************  04880000
      * 1000-INITIALIZATION OPENS ALL FILES                          *  04890000
      *      READS THE FIRST DEBIT RECORD                            *  04900000
      ****************************************************************  04910000
       1000-INITIALIZATION.                                             04920000
                                                                        04930000
           OPEN INPUT  MAF-DENIED-FILE                                  04940049
                       DATE-CONTROL-FILE                                04950099
                OUTPUT MAF-DENIED-REPORT.                               04960099
                                                                        04970007
           INITIALIZE D1-DETAIL-LINE.                                   04980016
027900     PERFORM 9910-SETUP-DATE.                                     04981099
           PERFORM 5300-FORMAT-HEADERS.                                 04990016
           PERFORM 7000-WRITE-HEADERS.                                  05000081
           PERFORM 5000-READ-DENIED-FILE.                               05010030
                                                                        05020000
      ****************************************************************  05033000
      * 2000-PROCESS-DENIED-FILE                                     *  05040010
      ****************************************************************  05050000
       2000-PROCESS-DENIED-FILE.                                        05060010
                                                                        05070000
           IF PS-FIRST-TIME-THRU                                        05080013
               MOVE TC003-STORE-NBR TO PV-HOLD-STORE-NBR                05110013
               MOVE TC003-CARD-NBR  TO PV-HOLD-CARD-NBR                 05120013
               MOVE TC003-RESPONSE-CDE                                  05130013
                                    TO PV-HOLD-TRAN-RESP-CDE            05140013
               PERFORM 2500-GET-STORE-DESC                              05141068
           END-IF.                                                      05150013
                                                                        05160013
                                                                        05162095
           IF TC003-TRAN-DISP = PV-TRAN-DENIED                          05170013
             IF TC003-STATE-CDE  = PV-HOLD-STATE-CDE                    05180025
                 IF TC003-STORE-NBR = PV-HOLD-STORE-NBR                 05190013
                    IF TC003-CARD-NBR = PV-HOLD-CARD-NBR                05200013
                       IF TC003-RESPONSE-CDE = PV-HOLD-TRAN-RESP-CDE    05210028
                            PERFORM 3000-EVALUATE-RESPONSE              05211097
                            ADD 1 TO PA-DEBIT-REQUEST-CTR               05220025
                            ADD 1 TO PA-DENIED-CTR                      05230099
                       ELSE                                             05280025
                            MOVE TC003-RESPONSE-CDE                     05300028
                                  TO PV-HOLD-TRAN-RESP-CDE              05310021
                            PERFORM 3000-EVALUATE-RESPONSE              05311097
                            ADD 1 TO PA-DENIED-CTR                      05320021
                            ADD 1 TO PA-DEBIT-REQUEST-CTR               05350021
                       END-IF                                           05380025
                    ELSE                                                05390025
                        MOVE TC003-CARD-NBR                             05400013
                                     TO PV-HOLD-CARD-NBR                05410013
                        IF TC003-RESPONSE-CDE = PV-HOLD-TRAN-RESP-CDE   05420028
                            PERFORM 3000-EVALUATE-RESPONSE              05420197
                            ADD 1 TO PA-DENIED-CTR                      05421025
                            ADD 1 TO PA-DEBIT-REQUEST-CTR               05424025
                            ADD 1 TO PA-DEBIT-TRANS-CTR                 05427025
                        ELSE                                            05450013
                            MOVE TC003-RESPONSE-CDE                     05472028
                                  TO PV-HOLD-TRAN-RESP-CDE              05473025
                            PERFORM 3000-EVALUATE-RESPONSE              05473197
                            ADD 1 TO PA-DENIED-CTR                      05474025
                            ADD 1 TO PA-DEBIT-REQUEST-CTR               05477025
                            ADD 1 TO PA-DEBIT-TRANS-CTR                 05479125
                        END-IF                                          05520013
                    END-IF                                              05530013
                 ELSE                                                   05540013
                     IF PS-NOT-FIRST-TIME-THRU                          05542067
                       PERFORM 5400-STORE-BREAK                         05550067
                     END-IF                                             05551067
                     MOVE TC003-STORE-NBR TO PV-HOLD-STORE-NBR          05560013
                     PERFORM 2500-GET-STORE-DESC                        05563068
                     MOVE TC003-CARD-NBR  TO PV-HOLD-CARD-NBR           05570013
                     MOVE TC003-RESPONSE-CDE                            05580028
                                          TO PV-HOLD-TRAN-RESP-CDE      05590013
                     PERFORM 3000-EVALUATE-RESPONSE                     05591097
                     ADD 1 TO PA-DENIED-CTR                             05592025
                     ADD 1 TO PA-DEBIT-REQUEST-CTR                      05595025
                     ADD 1 TO PA-DEBIT-TRANS-CTR                        05598025
                 END-IF                                                 05630013
             ELSE                                                       05640025
               IF PS-NOT-FIRST-TIME-THRU                                05640167
               PERFORM 5450-STATE-BREAK                                 05640367
               END-IF                                                   05640467
               MOVE TC003-STATE-CDE TO PV-HOLD-STATE-CDE                05650033
               MOVE TC003-STORE-NBR TO PV-HOLD-STORE-NBR                05670025
               PERFORM 2500-GET-STORE-DESC                              05673068
               MOVE TC003-CARD-NBR  TO PV-HOLD-CARD-NBR                 05680025
               MOVE TC003-RESPONSE-CDE                                  05690028
                                    TO PV-HOLD-TRAN-RESP-CDE            05700025
               PERFORM 3000-EVALUATE-RESPONSE                           05701097
               ADD 1 TO PA-DENIED-CTR                                   05702025
               ADD 1 TO PA-DEBIT-REQUEST-CTR                            05705025
               ADD 1 TO PA-DEBIT-TRANS-CTR                              05708025
             END-IF                                                     05740025
           END-IF.                                                      05741075
                                                                        05741175
                                                                        05741396
           IF TC003-TRAN-DISP = PV-TRAN-APPROVED                        05741475
             IF TC003-STATE-CDE  = PV-HOLD-STATE-CDE                    05741568
                 IF TC003-STORE-NBR = PV-HOLD-STORE-NBR                 05741668
                   ADD 1 TO PA-APPROVED-CTR                             05742068
                   ADD 1 TO PA-DEBIT-REQUEST-CTR                        05744168
                   ADD 1 TO PA-DEBIT-TRANS-CTR                          05744299
                 ELSE                                                   05747168
                   IF PS-NOT-FIRST-TIME-THRU                            05747268
                     PERFORM 5400-STORE-BREAK                           05747368
                   END-IF                                               05747468
                   MOVE TC003-STORE-NBR TO PV-HOLD-STORE-NBR            05747568
                   PERFORM 2500-GET-STORE-DESC                          05747868
                   MOVE TC003-CARD-NBR  TO PV-HOLD-CARD-NBR             05747968
                   MOVE TC003-RESPONSE-CDE                              05748068
                                        TO PV-HOLD-TRAN-RESP-CDE        05748168
                   ADD 1 TO PA-APPROVED-CTR                             05748268
                   ADD 1 TO PA-DEBIT-REQUEST-CTR                        05748568
                   ADD 1 TO PA-DEBIT-TRANS-CTR                          05748868
                 END-IF                                                 05749168
             ELSE                                                       05749268
               IF PS-NOT-FIRST-TIME-THRU                                05749368
               PERFORM 5450-STATE-BREAK                                 05749468
               END-IF                                                   05749568
               MOVE TC003-STATE-CDE TO PV-HOLD-STATE-CDE                05749668
               MOVE TC003-STORE-NBR TO PV-HOLD-STORE-NBR                05749799
               PERFORM 2500-GET-STORE-DESC                              05750068
               MOVE TC003-CARD-NBR  TO PV-HOLD-CARD-NBR                 05750168
               MOVE TC003-RESPONSE-CDE                                  05750268
                                    TO PV-HOLD-TRAN-RESP-CDE            05750368
               ADD 1 TO PA-APPROVED-CTR                                 05750468
               ADD 1 TO PA-DEBIT-REQUEST-CTR                            05750768
               ADD 1 TO PA-DEBIT-TRANS-CTR                              05751068
             END-IF                                                     05751368
           END-IF.                                                      05751468
                                                                        05751597
           MOVE TC003-REG-NBR    TO PV-REG-NBR.                         05752075
           MOVE TC003-TRAN-NBR   TO PV-TRAN-NBR.                        05753057
           MOVE TC003-SLS-DTE    TO PV-DATE-CCYYMMDD.                   05753158
           MOVE PV-DATE-CCYY     TO PV-CCYY.                            05753258
           MOVE PV-DATE-MM       TO PV-MM.                              05753358
           MOVE PV-DATE-DD       TO PV-DD.                              05753458
           MOVE PV-CCYY-MM-DD    TO PV-DATE.                            05753560
                                                                        05754042
           IF TC003-TRAN-DISP = PV-TRAN-DENIED                          05754199
              PERFORM 3500-CHECK-OTHER-TENDER                           05755099
           END-IF.                                                      05755199
                                                                        05756097
           IF PS-FIRST-TIME-THRU                                        05771067
               SET PS-NOT-FIRST-TIME-THRU TO TRUE                       05772067
           END-IF.                                                      05773067
                                                                        05774067
           PERFORM 5000-READ-DENIED-FILE.                               05780030
      ******************************************************************05790013
      * 2500-GET-STORE-DESC                                             05800061
      ******************************************************************05810013
       2500-GET-STORE-DESC.                                             05820061
                                                                        05830013
022720     EXEC SQL                                                     05830161
022730          SELECT LOC_10_ABBR_NM                                   05830299
022740          INTO :XST00001-LOC-10-ABBR-NM                           05830399
022750          FROM  XST_LOC                                           05830499
037700          WHERE LOC_NBR  =  :PV-HOLD-STORE-NBR                    05830799
022770     END-EXEC.                                                    05831961
022780                                                                  05832061
022790     EVALUATE SQLCODE                                             05832161
022800         WHEN ZERO                                                05832261
                   MOVE XST00001-LOC-10-ABBR-NM TO D1-STORE-DESC        05832399
               WHEN OTHER                                               05832861
023000             MOVE '2500-GET-STORE-DESC'                           05832962
023100                                            TO PV-PARAGRAPH-NAME  05833061
023200             MOVE 'TO SELECT FROM XST00001'                       05833199
023300                                            TO PV-DB2-ERROR-MSG   05833261
                   DISPLAY 'STORE # :  ' TC003-STORE-NBR                05833361
023400             PERFORM 9950-DB2-ERROR                               05833661
023500     END-EVALUATE.                                                05833761
                                                                        05833865
      ******************************************************************05833961
      * 3000-EVALUATE-RESPONSE                                          05834061
      ******************************************************************05834161
       3000-EVALUATE-RESPONSE.                                          05834261
                                                                        05835061
           EVALUATE PV-HOLD-TRAN-RESP-CDE                               05840013
              WHEN PV-APPROVED-TRAN                                     05880036
                   CONTINUE                                             05880138
              WHEN PV-INVALID-CARD                                      05881036
                   ADD 1 TO PA-INVALID-CARD-CTR                         05890038
              WHEN PV-INSUFF-FUNDS-18                                   05920036
              WHEN PV-INSUFF-FUNDS-19                                   05921039
              WHEN PV-INSUFF-FUNDS-58                                   05922039
                   ADD 1 TO PA-INSUFF-FUNDS-CTR                         05930038
              WHEN PV-LIMIT-EXCEED-24                                   05960036
              WHEN PV-LIMIT-EXCEED-28                                   05961039
              WHEN PV-LIMIT-EXCEED-127                                  05962039
              WHEN PV-LIMIT-EXCEED-128                                  05963039
              WHEN PV-LIMIT-EXCEED-179                                  05964039
                   ADD 1 TO PA-LIMIT-EXCEED-CTR                         05970038
              WHEN PV-TOO-MANY-PIN-44                                   06000036
              WHEN PV-TOO-MANY-PIN-50                                   06001039
              WHEN PV-TOO-MANY-PIN-124                                  06002039
                   ADD 1 TO PA-2MANY-PIN-CTR                            06010038
              WHEN PV-INVALID-PIN                                       06040013
                   ADD 1 TO PA-INVALID-PIN-CTR                          06050038
              WHEN PV-EXP-LOST-STOLEN-3                                 06080036
              WHEN PV-EXP-LOST-STOLEN-82                                06081039
              WHEN PV-EXP-LOST-STOLEN-83                                06082039
              WHEN PV-EXP-LOST-STOLEN-104                               06083039
                   ADD 1 TO PA-EXP-LOST-STOLEN-CTR                      06090038
              WHEN PV-COMM-ERROR-98                                     06120036
              WHEN PV-COMM-ERROR-99                                     06121039
              WHEN PV-COMM-ERROR-105                                    06122039
              WHEN PV-COMM-ERROR-106                                    06123039
                   ADD 1 TO PA-COMM-ERROR-CTR                           06130038
              WHEN OTHER                                                06160013
                   ADD 1 TO PA-OTHER-CTR                                06170038
           END-EVALUATE.                                                06200013
                                                                        06210016
      ******************************************************************06340016
      * 3500-CHECK-OTHER-TENDER                                         06350099
      ******************************************************************06360016
       3500-CHECK-OTHER-TENDER.                                         06370099
                                                                        06380016
022720     EXEC SQL                                                     06390016
022730          SELECT TNDR_TYP_CDE                                     06400099
022740          INTO :EPTND-TNDR-TYP-CDE                                06410041
022750          FROM  TEPTND  A                                         06420099
037600               ,TEPPART B                                         06421099
037600               ,TEPTRN  C                                         06422099
037700          WHERE ((B.SLS_DTE  = :PV-DATE)                          06431099
037800            AND (B.PARTN_NBR =  A.PARTN_NBR)                      06431199
037800            AND (A.PARTN_NBR =  C.PARTN_NBR)                      06431299
022760            AND (A.STR_NBR   = :PV-STORE-NBR)                     06432099
022760            AND (A.STR_NBR   = C.STR_NBR)                         06433099
022760            AND (A.RGST_ID   = :PV-REG-NBR)                       06440099
022760            AND (A.RGST_ID   = C.RGST_ID)                         06440199
022760            AND (A.TRN_NBR   = :PV-TRAN-NBR)                      06441099
022760            AND (A.TRN_NBR   = C.TRN_NBR)                         06441199
022760            AND (A.TNDR_VOID_IND = 'N'))                          06442099
022770     END-EXEC.                                                    06450023
022780                                                                  06460023
022790     EVALUATE SQLCODE                                             06470025
022800         WHEN ZERO                                                06480025
               WHEN -811                                                06481099
                   ADD 1 TO PA-DEBIT-CREDIT-CTR                         06482099
022900         WHEN +100                                                06490025
                   CONTINUE                                             06491099
               WHEN OTHER                                               06492025
023000             MOVE '3500-CHECK-OTHER-TENDER'                       06500099
023100                                            TO PV-PARAGRAPH-NAME  06510023
023200             MOVE 'TO SELECT FROM TEPTND  '                       06520023
023300                                            TO PV-DB2-ERROR-MSG   06530023
                   DISPLAY 'STORE # :  ' TC003-STORE-NBR                06540023
                   DISPLAY 'REG #   :  ' TC003-REG-NBR                  06541025
                   DISPLAY 'TRANS # :  ' TC003-TRAN-NBR                 06542025
                   DISPLAY 'DATE    :  ' PV-DATE                        06543099
023400             PERFORM 9950-DB2-ERROR                               06550023
023500     END-EVALUATE.                                                06560023
      ******************************************************************06570023
      * 5000-READ-DENIED-FILE                                           06580023
      ******************************************************************06590023
       5000-READ-DENIED-FILE.                                           06600016
                                                                        06610016
           MOVE SPACES TO TC003-MAF-DATA.                               06620016
                                                                        06630016
           READ MAF-DENIED-FILE                                         06640017
               INTO TC003-MAF-DATA                                      06650016
               AT END                                                   06660016
                   SET PS-END-OF-DENIED-FILE TO TRUE                    06670016
           END-READ.                                                    06680016
                                                                        06690013
      ******************************************************************06700016
      * 5300-FORMAT-HEADERS                                             06710016
      *     FORMAT REPORT HEADERS.                                      06720016
      ******************************************************************06730016
       5300-FORMAT-HEADERS.                                             06740016
                                                                        06750016
           MOVE FUNCTION CURRENT-DATE (1:8) TO PV-CURR-DATE-CCYYMMDD.   06760016
           ACCEPT PV-CURR-TIME FROM TIME.                               06770016
                                                                        06780016
           MOVE PV-CURR-DATE-MM             TO PV-HEADER-MM.            06790076
           MOVE PV-CURR-DATE-DD             TO PV-HEADER-DD.            06800076
           MOVE PV-CURR-DATE-CCYY           TO PV-HEADER-CCYY.          06810076
                                                                        06820016
           MOVE PV-CURR-DATE-MM             TO DP200-RUN-MONTH.         06821076
           MOVE PV-CURR-DATE-DD             TO DP200-RUN-DAY.           06822076
           MOVE PV-CURR-DATE-CCYY           TO DP200-RUN-YEAR.          06823076
                                                                        06824076
           MOVE PV-CURR-TIME-HH             TO DP200-RUN-HOUR.          06830016
           MOVE PV-CURR-TIME-MM             TO DP200-RUN-MINUTE.        06840016
           MOVE PC-CURRENT-PROGRAM-NAME     TO DP200-PROGRAM-NAME.      06850016
           MOVE 1                           TO DP200-REPORT-NUMBER.     06860016
                                                                        06870016
      ******************************************************************06911024
      * 5400-STORE-BREAK                                                06912025
      ******************************************************************06913024
       5400-STORE-BREAK.                                                06914025
                                                                        06915024
            PERFORM 6500-WRITE-REPORT.                                  06916081
            PERFORM 7400-ADD-STATE-TOTALS.                              06917077
                                                                        06917177
            MOVE ZEROES            TO PA-DENIED-CTR.                    06918025
            MOVE ZEROES            TO PA-APPROVED-CTR.                  06918125
            MOVE ZEROES            TO PA-DEBIT-REQUEST-CTR.             06918225
            MOVE ZEROES            TO PA-DEBIT-TRANS-CTR.               06918325
            MOVE ZEROES            TO PA-DEBIT-CREDIT-CTR.              06918425
            MOVE ZEROES            TO PA-INVALID-CARD-CTR.              06918525
            MOVE ZEROES            TO PA-INSUFF-FUNDS-CTR.              06919025
            MOVE ZEROES            TO PA-LIMIT-EXCEED-CTR.              06919125
            MOVE ZEROES            TO PA-2MANY-PIN-CTR.                 06919225
            MOVE ZEROES            TO PA-INVALID-PIN-CTR.               06919325
            MOVE ZEROES            TO PA-EXP-LOST-STOLEN-CTR.           06919425
            MOVE ZEROES            TO PA-COMM-ERROR-CTR.                06919525
            MOVE ZEROES            TO PA-OTHER-CTR.                     06919625
                                                                        06919777
            INITIALIZE D1-DETAIL-LINE.                                  06919825
                                                                        06919975
                                                                        06920075
                                                                        06920124
      ******************************************************************06920225
      * 5450-STATE-BREAK                                                06920325
      ******************************************************************06920425
       5450-STATE-BREAK.                                                06920530
                                                                        06920625
            PERFORM 7400-ADD-STATE-TOTALS.                              06920780
            PERFORM 6300-WRITE-STATE-TOTALS.                            06920881
                                                                        06920979
            MOVE ZEROES            TO PA-DENIED-CTR.                    06921029
            MOVE ZEROES            TO PA-STATE-DENIED-CTR.              06921129
            MOVE ZEROES            TO PA-APPROVED-CTR.                  06921229
            MOVE ZEROES            TO PA-STATE-APPROVED-CTR.            06921329
            MOVE ZEROES            TO PA-DEBIT-REQUEST-CTR.             06921429
            MOVE ZEROES            TO PA-STATE-DEBIT-REQ-CTR.           06921530
            MOVE ZEROES            TO PA-DEBIT-TRANS-CTR.               06921629
            MOVE ZEROES            TO PA-STATE-DEBIT-TRANS-CTR.         06921729
            MOVE ZEROES            TO PA-DEBIT-CREDIT-CTR.              06921829
            MOVE ZEROES            TO PA-STATE-DEBIT-CREDIT-CTR.        06921929
            MOVE ZEROES            TO PA-INVALID-CARD-CTR.              06922029
            MOVE ZEROES            TO PA-STATE-INVALID-CARD-CTR.        06922129
            MOVE ZEROES            TO PA-INSUFF-FUNDS-CTR.              06922229
            MOVE ZEROES            TO PA-STATE-INSUFF-FUNDS-CTR.        06922329
            MOVE ZEROES            TO PA-LIMIT-EXCEED-CTR.              06922429
            MOVE ZEROES            TO PA-STATE-LIMIT-EXCEED-CTR.        06922529
            MOVE ZEROES            TO PA-2MANY-PIN-CTR.                 06922629
            MOVE ZEROES            TO PA-STATE-2MANY-PIN-CTR.           06922729
            MOVE ZEROES            TO PA-INVALID-PIN-CTR.               06922829
            MOVE ZEROES            TO PA-STATE-INVALID-PIN-CTR.         06922929
            MOVE ZEROES            TO PA-EXP-LOST-STOLEN-CTR.           06923029
            MOVE ZEROES            TO PA-STATE-EXP-LOST-CTR.            06923130
            MOVE ZEROES            TO PA-COMM-ERROR-CTR.                06923229
            MOVE ZEROES            TO PA-STATE-COMM-ERROR-CTR.          06923329
            MOVE ZEROES            TO PA-OTHER-CTR.                     06923429
            MOVE ZEROES            TO PA-STATE-OTHER-CTR.               06923529
                                                                        06923679
            INITIALIZE D1-DETAIL-LINE.                                  06923729
            INITIALIZE T1-TOTALS-LINE.                                  06923829
                                                                        06923929
      ******************************************************************08041029
      * 6000-WRITE-CORP-TOTALS                                          08042029
      ******************************************************************08043029
       6000-WRITE-CORP-TOTALS.                                          08044029
                                                                        08045029
           PERFORM 6300-WRITE-STATE-TOTALS.                             08045182
                                                                        08048029
           MOVE PA-KOHLS-DENIED-CTR        TO T2-TOTAL-DENIED.          08049029
           MOVE PA-KOHLS-APPROVED-CTR      TO T2-TOTAL-APPROVED.        08049129
           MOVE PA-KOHLS-DEBIT-REQ-CTR     TO T2-TOTAL-DEBIT-REQ.       08049229
           MOVE PA-KOHLS-DEBIT-TRANS-CTR   TO T2-TOTAL-DEBIT-TRANS.     08049329
           MOVE PA-KOHLS-DEBIT-CREDIT-CTR  TO T2-DEBIT-CREDIT.          08049433
           MOVE PA-KOHLS-INVALID-CARD-CTR  TO T2-INVALID-CARD.          08049533
           MOVE PA-KOHLS-INSUFF-FUNDS-CTR  TO T2-INSUFF-FUNDS.          08049633
           MOVE PA-KOHLS-LIMIT-EXCEED-CTR  TO T2-LIMIT-EXCEEDED.        08049733
           MOVE PA-KOHLS-2MANY-PIN-CTR     TO T2-2MANY-PIN.             08049833
           MOVE PA-KOHLS-INVALID-PIN-CTR   TO T2-INVALID-PIN.           08049933
           MOVE PA-KOHLS-EXP-LOST-CTR      TO T2-EXP-LOST-STOLEN.       08050033
           MOVE PA-KOHLS-COMM-ERROR-CTR    TO T2-COMM-ERROR.            08050133
           MOVE PA-KOHLS-OTHER-CTR         TO T2-OTHER.                 08050233
                                                                        08050329
           ADD 7 TO PA-LINE-CNT.                                        08050499
                                                                        08050529
           IF PA-LINE-CNT > PC-LINE-LIMIT                               08050629
               PERFORM 7000-WRITE-HEADERS                               08050781
           END-IF.                                                      08050829
                                                                        08050929
           MOVE T2-TOTALS-LINE           TO PV-PRINT-RECORD.            08051029
                                                                        08051129
           WRITE MAF-DENIED-RPT-RECORD                                  08051229
            FROM PV-PRINT-RECORD                                        08051329
            AFTER ADVANCING 5 LINES                                     08051429
           END-WRITE.                                                   08051529
                                                                        08051629
           WRITE MAF-DENIED-RPT-RECORD                                  08051729
            FROM E1-END-OF-RPT-LINE                                     08051829
            AFTER ADVANCING 2 LINES                                     08051929
           END-WRITE.                                                   08052029
                                                                        08052129
      ******************************************************************08052281
      * 6300-WRITE-STATE-TOTALS                                         08052381
      ******************************************************************08052481
       6300-WRITE-STATE-TOTALS.                                         08052581
                                                                        08052681
           IF PS-END-OF-DENIED-FILE                                     08052784
             CONTINUE                                                   08052884
           ELSE                                                         08052984
             MOVE D1-DETAIL-LINE TO PV-PRINT-RECORD                     08053085
             PERFORM 6500-WRITE-REPORT                                  08053185
           END-IF.                                                      08053284
                                                                        08053384
           MOVE PV-HOLD-STATE-CDE          TO T1-STATE-CDE.             08053481
           MOVE PA-STATE-DENIED-CTR        TO T1-TOTAL-DENIED.          08053581
           MOVE PA-STATE-APPROVED-CTR      TO T1-TOTAL-APPROVED.        08053681
           MOVE PA-STATE-DEBIT-REQ-CTR     TO T1-TOTAL-DEBIT-REQ.       08053781
           MOVE PA-STATE-DEBIT-TRANS-CTR   TO T1-TOTAL-DEBIT-TRANS.     08053881
           MOVE PA-STATE-DEBIT-CREDIT-CTR  TO T1-DEBIT-CREDIT.          08053981
           MOVE PA-STATE-INVALID-CARD-CTR  TO T1-INVALID-CARD.          08054081
           MOVE PA-STATE-INSUFF-FUNDS-CTR  TO T1-INSUFF-FUNDS.          08054181
           MOVE PA-STATE-LIMIT-EXCEED-CTR  TO T1-LIMIT-EXCEEDED.        08054281
           MOVE PA-STATE-2MANY-PIN-CTR     TO T1-2MANY-PIN.             08054381
           MOVE PA-STATE-INVALID-PIN-CTR   TO T1-INVALID-PIN.           08054481
           MOVE PA-STATE-EXP-LOST-CTR      TO T1-EXP-LOST-STOLEN.       08054581
           MOVE PA-STATE-COMM-ERROR-CTR    TO T1-COMM-ERROR.            08054681
           MOVE PA-STATE-OTHER-CTR         TO T1-OTHER.                 08054781
                                                                        08054881
           ADD 6 TO PA-LINE-CNT.                                        08054999
                                                                        08055081
           IF PA-LINE-CNT > PC-LINE-LIMIT                               08055181
               PERFORM 7000-WRITE-HEADERS                               08055281
           END-IF.                                                      08055381
                                                                        08055481
           MOVE T1-TOTALS-LINE           TO PV-PRINT-RECORD.            08055581
                                                                        08055681
           WRITE MAF-DENIED-RPT-RECORD                                  08055781
            FROM PV-PRINT-RECORD                                        08055881
            AFTER ADVANCING 2 LINES                                     08055981
           END-WRITE.                                                   08056081
                                                                        08056181
           PERFORM 7500-ADD-CORP-TOTALS.                                08056281
                                                                        08056392
           MOVE SPACES TO PV-PRINT-RECORD.                              08056492
                                                                        08056592
           WRITE MAF-DENIED-RPT-RECORD                                  08056692
            FROM PV-PRINT-RECORD                                        08056792
            AFTER ADVANCING 1 LINES                                     08056892
           END-WRITE.                                                   08056992
                                                                        08057181
      ******************************************************************08057281
      * 6500-WRITE-REPORT                                               08057381
      ******************************************************************08057481
       6500-WRITE-REPORT.                                               08057581
                                                                        08057681
           ADD PV-LINE-SPACING   TO PA-LINE-CNT.                        08057781
                                                                        08057881
           IF PA-LINE-CNT > PC-LINE-LIMIT                               08057981
               PERFORM 7000-WRITE-HEADERS                               08058081
           END-IF.                                                      08058181
                                                                        08058281
           MOVE PV-HOLD-STATE-CDE      TO D1-STATE-CDE.                 08058381
           MOVE PV-HOLD-STORE-NBR      TO D1-STORE-NBR.                 08058481
           MOVE PA-INVALID-CARD-CTR    TO D1-INVALID-CARD.              08058581
           MOVE PA-INSUFF-FUNDS-CTR    TO D1-INSUFF-FUNDS.              08058681
           MOVE PA-LIMIT-EXCEED-CTR    TO D1-LIMIT-EXCEEDED.            08058781
           MOVE PA-2MANY-PIN-CTR       TO D1-2MANY-PIN.                 08058881
           MOVE PA-INVALID-PIN-CTR     TO D1-INVALID-PIN.               08058981
           MOVE PA-EXP-LOST-STOLEN-CTR TO D1-EXP-LOST-STOLEN.           08059081
           MOVE PA-COMM-ERROR-CTR      TO D1-COMM-ERROR.                08059181
           MOVE PA-OTHER-CTR           TO D1-OTHER.                     08059281
           MOVE PA-DENIED-CTR          TO D1-TOTAL-DENIED.              08059381
           MOVE PA-APPROVED-CTR        TO D1-TOTAL-APPROVED.            08059481
           MOVE PA-DEBIT-REQUEST-CTR   TO D1-TOTAL-DEBIT-REQ.           08059581
           MOVE PA-DEBIT-TRANS-CTR     TO D1-TOTAL-DEBIT-TRANS.         08059681
           MOVE PA-DEBIT-CREDIT-CTR    TO D1-DENIED-CREDIT.             08059781
           MOVE D1-DETAIL-LINE         TO PV-PRINT-RECORD.              08059881
                                                                        08059981
           WRITE MAF-DENIED-RPT-RECORD                                  08060081
            FROM PV-PRINT-RECORD                                        08060181
            AFTER ADVANCING PV-LINE-SPACING                             08060281
           END-WRITE.                                                   08060381
                                                                        08060481
           MOVE SPACES           TO PV-PRINT-RECORD.                    08060581
                                                                        08060681
      ******************************************************************08060781
      * 7000-WRITE-HEADERS.                                             08060881
      ******************************************************************08060981
       7000-WRITE-HEADERS.                                              08061081
                                                                        08061181
           MOVE +1 TO PA-LINE-CNT.                                      08061281
           ADD  +1 TO PA-PAGE-CNT.                                      08061381
                                                                        08061481
           MOVE PA-PAGE-CNT TO DP200-PAGE-NUMBER.                       08061581
                                                                        08061681
           WRITE MAF-DENIED-RPT-RECORD                                  08061781
            FROM DP200-STANDRD-HEADER-200-COLS                          08061881
            AFTER ADVANCING PAGE                                        08061981
           END-WRITE.                                                   08062081
                                                                        08062181
           MOVE T1-TITLE-LINE            TO PV-PRINT-RECORD.            08062281
           MOVE 2                        TO PV-LINE-SPACING.            08062381
           WRITE MAF-DENIED-RPT-RECORD                                  08062481
            FROM PV-PRINT-RECORD                                        08062581
            AFTER ADVANCING PV-LINE-SPACING                             08062681
           END-WRITE.                                                   08062781
                                                                        08062881
           MOVE T2-TITLE-LINE            TO PV-PRINT-RECORD.            08062981
           MOVE 1                        TO PV-LINE-SPACING.            08063081
           WRITE MAF-DENIED-RPT-RECORD                                  08063181
            FROM PV-PRINT-RECORD                                        08063281
            AFTER ADVANCING PV-LINE-SPACING                             08063381
           END-WRITE.                                                   08063481
                                                                        08063581
           MOVE H1-DENIED-HEADING        TO PV-PRINT-RECORD.            08063681
           MOVE 1                        TO PV-LINE-SPACING.            08063781
           WRITE MAF-DENIED-RPT-RECORD                                  08063881
            FROM PV-PRINT-RECORD                                        08063981
            AFTER ADVANCING PV-LINE-SPACING                             08064081
           END-WRITE.                                                   08064181
                                                                        08064281
           MOVE SPACES           TO PV-PRINT-RECORD.                    08064381
                                                                        08064481
           MOVE H2-DENIED-HEADING        TO PV-PRINT-RECORD.            08064581
           MOVE 1                        TO PV-LINE-SPACING.            08064681
           WRITE MAF-DENIED-RPT-RECORD                                  08064781
            FROM PV-PRINT-RECORD                                        08064881
            AFTER ADVANCING PV-LINE-SPACING                             08064981
           END-WRITE.                                                   08065081
                                                                        08065181
           MOVE SPACES           TO PV-PRINT-RECORD.                    08065281
                                                                        08065381
      ******************************************************************08065477
      * 7400-ADD-STATE-TOTALS.                                          08065577
      ******************************************************************08065677
       7400-ADD-STATE-TOTALS.                                           08065777
                                                                        08065877
           ADD PA-DENIED-CTR           TO PA-STATE-DENIED-CTR.          08065978
           ADD PA-APPROVED-CTR         TO PA-STATE-APPROVED-CTR.        08066078
           ADD PA-DEBIT-REQUEST-CTR    TO PA-STATE-DEBIT-REQ-CTR.       08066178
           ADD PA-DEBIT-TRANS-CTR      TO PA-STATE-DEBIT-TRANS-CTR.     08066278
           ADD PA-DEBIT-CREDIT-CTR     TO PA-STATE-DEBIT-CREDIT-CTR.    08066378
           ADD PA-INVALID-CARD-CTR     TO PA-STATE-INVALID-CARD-CTR.    08066478
           ADD PA-INSUFF-FUNDS-CTR     TO PA-STATE-INSUFF-FUNDS-CTR.    08066578
           ADD PA-LIMIT-EXCEED-CTR     TO PA-STATE-LIMIT-EXCEED-CTR.    08066678
           ADD PA-2MANY-PIN-CTR        TO PA-STATE-2MANY-PIN-CTR.       08066778
           ADD PA-INVALID-PIN-CTR      TO PA-STATE-INVALID-PIN-CTR.     08066878
           ADD PA-EXP-LOST-STOLEN-CTR  TO PA-STATE-EXP-LOST-CTR.        08066978
           ADD PA-COMM-ERROR-CTR       TO PA-STATE-COMM-ERROR-CTR.      08067078
           ADD PA-OTHER-CTR            TO PA-STATE-OTHER-CTR.           08067178
                                                                        08067277
      ******************************************************************08067377
      * 7500-ADD-CORP-TOTALS.                                           08067477
      ******************************************************************08067577
       7500-ADD-CORP-TOTALS.                                            08067677
                                                                        08067777
           ADD PA-STATE-DENIED-CTR       TO PA-KOHLS-DENIED-CTR.        08067877
           ADD PA-STATE-APPROVED-CTR     TO PA-KOHLS-APPROVED-CTR.      08067977
           ADD PA-STATE-DEBIT-REQ-CTR    TO PA-KOHLS-DEBIT-REQ-CTR.     08068077
           ADD PA-STATE-DEBIT-TRANS-CTR  TO PA-KOHLS-DEBIT-TRANS-CTR.   08068177
           ADD PA-STATE-DEBIT-CREDIT-CTR TO PA-KOHLS-DEBIT-CREDIT-CTR.  08068277
           ADD PA-STATE-INVALID-CARD-CTR TO PA-KOHLS-INVALID-CARD-CTR.  08068377
           ADD PA-STATE-INSUFF-FUNDS-CTR TO PA-KOHLS-INSUFF-FUNDS-CTR.  08068477
           ADD PA-STATE-LIMIT-EXCEED-CTR TO PA-KOHLS-LIMIT-EXCEED-CTR.  08068577
           ADD PA-STATE-2MANY-PIN-CTR    TO PA-KOHLS-2MANY-PIN-CTR.     08068677
           ADD PA-STATE-INVALID-PIN-CTR  TO PA-KOHLS-INVALID-PIN-CTR.   08068777
           ADD PA-STATE-EXP-LOST-CTR     TO PA-KOHLS-EXP-LOST-CTR.      08068877
           ADD PA-STATE-COMM-ERROR-CTR   TO PA-KOHLS-COMM-ERROR-CTR.    08068977
           ADD PA-STATE-OTHER-CTR        TO PA-KOHLS-OTHER-CTR.         08069077
                                                                        08069177
      ***************************************************************** 08069277
      * 9900-END-ROUTINE                                              * 08069313
      * CLOSE FILES                                                   * 08070000
      ***************************************************************** 08080000
                                                                        08090000
       9900-END-ROUTINE.                                                08100013
                                                                        08110000
           PERFORM 6000-WRITE-CORP-TOTALS.                              08120073
                                                                        08121073
           CLOSE MAF-DENIED-FILE                                        08130049
                 MAF-DENIED-REPORT.                                     08150007
                                                                        08160000
077600*----------------------------------------------------------------*08161099
077700*    SETUP-DATE                                                  *08162099
077800*      PERFORMED ONLY VIA (0000-MAINLINE) INITAL HOUSEKEEPING    *08163099
077900*    FUNCTION: ONETIME ROUTINE TO GET THE DATE RECORD            *08164099
078000*----------------------------------------------------------------*08165099
078100 9910-SETUP-DATE.                                                 08166099
078200                                                                  08167099
078300     READ DATE-CONTROL-FILE INTO CC-CONTROL-CARD                  08168099
078400        AT END                                                    08169099
078500           SET PS-END-OF-CONTROL-FILE  TO TRUE.                   08169199
078600                                                                  08169299
078700     DISPLAY 'TCKRP015 CONTROL CARD: ' CC-CONTROL-CARD.           08169399
078800                                                                  08169499
078900     CLOSE DATE-CONTROL-FILE.                                     08169599
079000                                                                  08169699
079100     IF PS-END-OF-CONTROL-FILE                                    08169799
079200         SET ABEND-4008-INVALID-CC       TO TRUE                  08169899
079300         MOVE '9910-SETUP-DATE'        TO PV-PARAGRAPH-NAME       08169999
079400         MOVE 'DATE CARD MISSING      ' TO PV-OPERATION-MSG-1     08170099
079500         PERFORM 9999-ABEND                                       08170199
079600     ELSE                                                         08170299
079700         PERFORM 9920-CONVERT-INPUT-DATE                          08170399
079800     END-IF.                                                      08170499
079900                                                                  08170599
080000******************************************************************08170699
080100*     CALL KOHLS CALENDAR ROUTINE:                                08170799
080200*         PASS: CONTROL CARD POS DATE (MMDDCCYY FORMAT).          08170899
080300*       RETURN: ACTUAL CALENDAR DB2 ISO DATE (CCYY-MM-DD FORMAT). 08170999
080400******************************************************************08171099
080500 9920-CONVERT-INPUT-DATE.                                         08171199
080600                                                                  08171299
080700     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              08171399
080800                                                                  08171499
080900     SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   08171599
081000     SET  DPG52-LK-DTE-GREG-CC         TO TRUE.                   08171699
081100     MOVE CC-DATE-MMDDCCYY             TO DPG52-LK-DATE-INPUT.    08171799
081200     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    08171899
081300                                             DPG54 DPG55 DPG56.   08171999
081400     EVALUATE TRUE                                                08172099
081500         WHEN DPG54-SEVERE-ERROR                                  08172199
               WHEN DPG54-DATE-INVALID                                  08172399
081600             DISPLAY PC-ABEND-MSG  PC-CURRENT-PROGRAM-NAME        08172499
081700             DISPLAY PC-CAL-SUB-TRN-DTE-ERROR                     08172599
081800             SET ABEND-4019-CAL-SUB-ERROR                         08172699
081900                                 TO TRUE                          08172799
082000             CALL 'ILBOABN0' USING ABEND-CODE                     08172899
082400     END-EVALUATE.                                                08173299
082500                                                                  08173399
082600     MOVE CC-DATE-MM           TO T1-PROCESS-MM.                  08173499
082600     MOVE CC-DATE-DD           TO T1-PROCESS-DD.                  08173599
082600     MOVE CC-DATE-CCYY         TO T1-PROCESS-CCYY.                08173699
082800                                                                  08173799
083600                                                                  08174299
037646***************************************************************** 08175016
037647*    DB2 ERROR ROUTINE                                          * 08180016
037648***************************************************************** 08190016
037649 9950-DB2-ERROR.                                                  08200016
037650     DISPLAY PC-ABEND-MSG  PC-CURRENT-PROGRAM-NAME.               08210016
037660     DISPLAY PC-DB-ERROR-PREFIX                                   08220016
037670     DISPLAY PC-DB-ATTEMPTING-MSG PV-DB2-ERROR-MSG.               08230016
037680                                                                  08240016
037690     COPY DPPD004.                                                08250016
037700                                                                  08260016
037800     SET ABEND-4013-DB2-ERROR         TO TRUE.                    08270016
037900     CALL 'ILBOABN0' USING ABEND-CODE.                            08280016
                                                                        08290016
                                                                        08300000
      ******************************************************************08310000
      * 9999-ABEND                                                      08320000
      *     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  08330000
      ******************************************************************08340000
       9999-ABEND.                                                      08350000
           DISPLAY '** ABEND           **'.                             08360000
           DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  08370000
           DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        08380000
           DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       08390000
           DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       08400000
           CALL 'ILBOABN0' USING AC-ABEND-CODE.                         08410000
      *                                                                 08420000
      ******************************************************************08430000
      ***                    END  OF  PROGRAM                        ***08440000
      ******************************************************************08450000
