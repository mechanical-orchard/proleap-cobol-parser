000100 IDENTIFICATION DIVISION.                                         00010000
000200                                                                  00020000
000300 PROGRAM-ID.              MLKUT401.                               00030000
000400 INSTALLATION.            KOHLS DEPARTMENT STORES.                00040000
000500 DATE-WRITTEN.            05/19/98.                               00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800******************************************************************00080000
000900*    MLKUT401 - REFORMAT RECEIPT DATA FOR M/L.                    00090000
001000*                                                                 00100000
001100*    THIS PROGRAM PROCESSES THE STORE EXTRACT FILE CREATED BY THE 00110000
001200*    RECEIVING SYSTEM. FOR EACH RECORD, FORMAT A RECORD FOR       00120000
001300*    MERCHANDISE LEDGER.                                          00130000
000800******************************************************************00130102
001300*    01/27/1999 AML   MOVE THE VERIFIED RECEIPT DATE TO THE       00131001
001300*                     INVENTORY CUTOFF DATE FOR RECEIPT           00132001
001300*                     ADJUSTMENTS.                                00133001
0100RM******************************************************************00141002
0100RM*    01/24/2000 RWM   MOVE THE PO TYPE CODE FROM TPURCHS TO       00142002
0100RM*                     MLRD015 FIELD. FOR TWKPOSS UPDATE           00143002
W26603* W26603  03-08-2004 ROD JANSSEN MERCH LEDGER STORE EXPANSION     00144011
P49937* P49937  09-26-2014 MODIFIED PROGRAM TO USE UNIT COST FOR        00144120
P49937*                    IMPORT PO'S AND FIRST COST FOR DOMESTIC PO'S.00144220
I09973* INC0997324 2014-10-07 NEED TO ALSO CHANGE PRIVATE LABEL         00144328
I09973*                       DOMESTIC PO'S TO USE UNIT COST TOO        00144428
I09973*                       NOTE:  SOME CODE COPIED FROM GLKUT015.    00144522
I84040* INC12384040 2021-10-26 MODIFIED TO PROCESS PO WITH              00145430
I84040*                        PURCHS-DERVD-LBL-TYP-CDE = 'E'           00145530
I84040*                        JUST LIKE THOSE WITH TYPE CODE =         00145630
I84040*                        'P'                                      00145730
I84040*                        'E' IS FOR EXCLUSIVE BRAND               00145831
001400******************************************************************00146002
001500                                                                  00150000
001600 ENVIRONMENT DIVISION.                                            00160000
001700                                                                  00170000
001800 CONFIGURATION SECTION.                                           00180000
001900                                                                  00190000
002000 SOURCE-COMPUTER. IBM-3090.                                       00200000
002100 OBJECT-COMPUTER. IBM-3090.                                       00210000
002200                                                                  00220000
002300 INPUT-OUTPUT SECTION.                                            00230000
002400                                                                  00240000
002500 FILE-CONTROL.                                                    00250000
002600                                                                  00260000
002700     SELECT WKLY-RCPT-FILE            ASSIGN TO INP01.            00270000
002800     SELECT CONTROL-CARD-FILE         ASSIGN TO INP02.            00280000
002900     SELECT RCPT-EXT-FILE             ASSIGN TO OUT01.            00290000
003000                                                                  00300000
003100 DATA DIVISION.                                                   00310000
003200                                                                  00320000
003300 FILE SECTION.                                                    00330000
003400                                                                  00340000
003500 FD  WKLY-RCPT-FILE                                               00350000
003600     RECORDING MODE IS F                                          00360000
003700     LABEL RECORDS ARE STANDARD                                   00370000
003800     BLOCK CONTAINS 0 RECORDS.                                    00380000
003900                                                                  00390000
004000 01  WKLY-RCPT-REC                 PIC X(300).                    00400000
004100                                                                  00410000
004200 FD  CONTROL-CARD-FILE                                            00420000
004300     RECORDING MODE IS F                                          00430000
004400     LABEL RECORDS ARE STANDARD                                   00440000
004500     BLOCK CONTAINS 0 RECORDS.                                    00450000
004600                                                                  00460000
004700 01  CONTROL-CARD-REC              PIC X(080).                    00470000
004800                                                                  00480000
004900 FD  RCPT-EXT-FILE                                                00490000
005000     RECORDING MODE IS F                                          00500000
005100     LABEL RECORDS ARE STANDARD                                   00510000
005200     BLOCK CONTAINS 0 RECORDS.                                    00520000
005300                                                                  00530000
W26603 01  RCPT-EXT-REC                  PIC X(150).                    00540011
005500                                                                  00550000
005600 WORKING-STORAGE SECTION.                                         00560000
005700                                                                  00570000
005800 01  PA-PROGRAM-ACCUMULATORS.                                     00580000
005900     05  PA-WKLY-RCPT-CNT          PIC 9(09)     VALUE 0.         00590000
006000     05  PA-RCPT-EXT-CNT           PIC 9(09)     VALUE 0.         00600000
W26603***  05  PA-TPURCHS-CALLS          PIC 9(09)     VALUE 0.         00601012
006100                                                                  00610000
006200 01  PC-PROGRAM-CONSTANTS.                                        00620000
006300     05  PC-DPKUT500               PIC X(08)     VALUE 'DPKUT500'.00630000
W26603     05  PC-MAX-EXTENSION      PIC 9(09)V99  VALUE 999999999.99.  00640013
W26603     05  PC-NEG-EXTENSION      PIC S9(09)V99 VALUE -999999999.99. 00650013
006800     05  PC-NO-IND                 PIC X(01)     VALUE 'N'.       00660000
006900     05  PC-PGM-NAME               PIC X(08)     VALUE 'MLKUT401'.00670000
W26603     05  PC-POS-EXTENSION      PIC S9(09)V99 VALUE +999999999.99. 00680013
007000     05  PC-PURCH-CDE              PIC X(01)     VALUE '1'.       00690000
007100     05  PC-TRANS-CDE-01           PIC X(02)     VALUE '01'.      00700000
007200     05  PC-TRANS-CDE-02           PIC X(02)     VALUE '02'.      00710000
007300     05  PC-YES-IND                PIC X(01)     VALUE 'Y'.       00720000
007500                                                                  00730000
007600 01  PS-PROGRAM-SWITCHES.                                         00740000
007700     05  PS-END-OF-COST-DOLLARS-SW   PIC X(01)   VALUE 'N'.       00750000
007800         88  PS-END-OF-COST-DOLLARS              VALUE 'Y'.       00760000
007810     05  PS-END-OF-MULTIPLE-RECS-SW  PIC X(01)   VALUE 'N'.       00770000
007820         88  PS-END-OF-MULTIPLE-RECS             VALUE 'Y'.       00780000
007830     05  PS-END-OF-RTL-DOLLARS-SW    PIC X(01)   VALUE 'N'.       00781000
007840         88  PS-END-OF-RTL-DOLLARS               VALUE 'Y'.       00782000
008100     05  PS-END-OF-WKLY-RCPT-FILE-SW PIC X(01)   VALUE 'N'.       00783000
008200         88  PS-END-OF-WKLY-RCPT-FILE            VALUE 'Y'.       00784000
008800                                                                  00786000
008900 01  PV-PROGRAM-VARIABLES.                                        00787000
009000     05  PV-BATCH-NBR              PIC 9(03)            VALUE 0.  00788000
009001     05  PV-CNT                    PIC 9(04)            VALUE 0.  00789000
W26603     05  PV-COST-EXTENSION       PIC S9(9)V99  COMP-3 VALUE 0.    00790013
W26603     05  PV-COST-REM             PIC 9(11)V9(4) COMP-3 VALUE 0.   00800013
009100     05  PV-KOHLS-MM               PIC 9(02)            VALUE 0.  00810000
009300     05  PV-NBR-COST-RECS          PIC S9(09)    COMP-3 VALUE +0. 00820000
009301     05  PV-NBR-RECS-TO-WRITE      PIC S9(09)    COMP-3 VALUE +0. 00830000
009302     05  PV-NBR-RTL-RECS           PIC S9(09)    COMP-3 VALUE +0. 00840000
009310     05  PV-PARAGRAPH-NAME         PIC X(30)     VALUE SPACES.    00850000
W26603     05  PV-RTL-EXTENSION        PIC S9(9)V99  COMP-3 VALUE 0.    00860013
W26603     05  PV-RTL-REM              PIC 9(11)V9(4) COMP-3 VALUE 0.   00870013
009400     05  PV-SUB                    PIC 9(04)            VALUE 0.  00880000
W26603     05  PV-WRITE-COST-AMT         PIC S9(09)V99        VALUE +0. 00890013
W26603     05  PV-WRITE-RTL-AMT          PIC S9(09)V99        VALUE +0. 00900013
W26603     05  PV-EDIT-LOC-NBR           PIC 9(05) VALUE ZEROS.         00901011
W26603     05  PV-EDIT-LOC-NBR-ALPH REDEFINES                           00902011
W26603         PV-EDIT-LOC-NBR           PIC X(05).                     00903011
I09973     05  PV-PO-NBR                 PIC S9(9)   VALUE ZEROS        00904028
I09973                                           COMP.                  00905028
I09973     05  PV-PO-BEING-PROCESSED PIC  9(09)  VALUE ZEROS.           00906028
                                                                        00910011
009800 01  PV-FIELD-VARIABLES.                                          00920000
009900     05  PV-INHOUSE-NBR.                                          00930000
009901         10  FILLER                PIC X(02)     VALUE '00'.      00940000
009902         10  PV-VENDOR-NO-INHOUSE  PIC X(03)     VALUE '000'.     00950000
009920                                                                  00970000
009930 01  PV-DATE-VARIABLES.                                           00980000
009940     05  PV-JULIAN-DAY             PIC 9(05)            VALUE 0.  00990000
010000     05  PV-JULIAN-DAY-RED REDEFINES PV-JULIAN-DAY.               01000000
010100         10  FILLER                PIC 9(02).                     01010000
010200         10  PV-JULIAN-DDD         PIC 9(03).                     01020000
I09973                                                                  01020128
I09973                                                                  01020228
I09973 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          01021028
I09973                                             COMP SYNC.           01022028
I09973     88  AC-INVALID-DATA                     VALUE +4008.         01023028
I09973     88  AC-DB2-ERROR                        VALUE +4013.         01024028
I09973     88  AC-NO-INVOICES-ERROR                VALUE +4020.         01025028
I09973                                                                  01026028
       01 ABEND-AREAS.                                                  01040102
           05 PV-ABEND-CODE             PIC S9(04)  VALUE ZERO          01040202
                                                   COMP SYNC.           01040302
               88  AC-CC-ERROR                     VALUE +4003.         01040502
           05  AA-ABEND-LIT            PIC X(40)   VALUE                01040702
                 '*****       ABEND'.                                   01040802
           05  AA-PROGRAM-LIT          PIC X(40)   VALUE                01040902
                   '*****   PROGRAM: MLKUT401'.                         01041002
           05  AA-PARAGRAPH-LIT.                                        01041102
               10  FILLER              PIC X(17)   VALUE                01041202
                   '***** PARAGRAPH: '.                                 01041302
               10  AA-PARAGRAPH-NAME   PIC X(35)   VALUE SPACES.        01041402
           05  AA-MESSAGE-LINE.                                         01041502
               10  FILLER              PIC X(06)   VALUE '*****'.       01041602
               10  AA-MESSAGE          PIC X(127)  VALUE SPACES.        01041702
I09973     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                01041822
I09973             '*****    DB2 ERROR'.                                01041922
I09973     05  AA-DB2-OPERATION-LIT.                                    01042022
I09973         10  FILLER              PIC  X(17)  VALUE                01042122
I09973             '***** OPERATION: '.                                 01042222
I09973         10  AA-DB2-OPERATION.                                    01042322
I09973             15  AA-DB2-OP-1     PIC  X(50)  VALUE SPACES.        01042422
I09973             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        01042522
I09973     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        01042622
I09973                                                                  01042722
                                                                        01043002
010610 01  PV-RETRY-COUNT                PIC S9(04) COMP SYNC VALUE +0. 01050000
010620                                                                  01060000
010700 01  CC-CONTROL-CARD.                                             01070000
010800     05  CC-CALENDAR-TYPE            PIC X(02)   VALUE SPACE.     01080000
010900     05  FILLER                      PIC X(01)   VALUE SPACE.     01090000
011000     05  CC-PROC-DATE                PIC X(10)   VALUE SPACE.     01100000
011100     05  CC-PROC-DATE-RED REDEFINES CC-PROC-DATE.                 01110000
011200         10  CC-PROC-DATE-CC         PIC X(02).                   01120000
011300         10  CC-PROC-DATE-YY         PIC X(02).                   01130000
011400         10  FILLER                  PIC X(01).                   01140000
011500         10  CC-PROC-DATE-MM         PIC X(02).                   01150000
011600         10  FILLER                  PIC X(01).                   01160000
011700         10  CC-PROC-DATE-DD         PIC X(02).                   01170000
011800     05  FILLER                      PIC X(67)   VALUE SPACE.     01180000
011900                                                                  01190000
012000****************************************************************  01200000
012100* DATE ROUTINE COPYBOOK                                           01210000
012200****************************************************************  01220000
012300     COPY DPWS500.                                                01230000
012400                                                                  01240000
012500****************************************************************  01250000
012600* WEEKLY RECEIPT EXTRACT FILE COPYBOOK                            01260000
012700****************************************************************  01270000
W26603     COPY STOREEXT.                                               01280011
012900                                                                  01290000
013000****************************************************************  01300000
013100* RECEIPT EXTRACT FILE COPYBOOK                                   01310000
013200****************************************************************  01320000
W26603     COPY MLRD015.                                                01330011
013400                                                                  01340000
I09973****************************************************************  01340129
I09973*  WORKING STORAGE AREA FOR DPPD004                               01340229
I09973****************************************************************  01340329
I09973     COPY DPWS004.                                                01340428
I09973                                                                  01340528
I09973*                                                                 01340622
I09973* PURCHASE ORDER HEADER                                           01341022
I09973****************************************************************  01341129
I09973*    TPURCHS DCLGEN                                               01342022
I09973****************************************************************  01343029
I09973     EXEC SQL                                                     01344022
I09973         INCLUDE TPURCHS                                          01345022
I09973     END-EXEC.                                                    01346022
I09973                                                                  01347022
I09973****************************************************************  01348029
I09973*    SQL COMMUNICATIONS AREA DCLGEN                               01349022
I09973****************************************************************  01349129
I09973     EXEC SQL                                                     01349222
I09973         INCLUDE SQLCA                                            01349322
I09973     END-EXEC.                                                    01349422
I09973                                                                  01349522
       PROCEDURE DIVISION.                                              01350009
016700                                                                  01360000
016800****************************************************************  01370000
016900* PROGRAM MAINLINE                                                01380000
017000****************************************************************  01390000
017100 0000-MAIN-MODULE.                                                01400000
017200                                                                  01410000
017300     OPEN INPUT  WKLY-RCPT-FILE                                   01420000
017400                 CONTROL-CARD-FILE                                01430000
017500          OUTPUT RCPT-EXT-FILE.                                   01440000
017600                                                                  01450000
017700     PERFORM 1000-INITIALIZATION.                                 01460000
017800                                                                  01470000
017900     PERFORM 7000-READ-WKLY-RCPT-FILE.                            01480000
018000     PERFORM 2000-PROCESS-WKLY-RCPT-FILE                          01490000
018100         UNTIL PS-END-OF-WKLY-RCPT-FILE.                          01500000
018200                                                                  01510000
018210     PERFORM 9000-END-OF-JOB.                                     01520000
018220                                                                  01530000
018300     CLOSE WKLY-RCPT-FILE                                         01540000
018400           CONTROL-CARD-FILE                                      01550000
018500           RCPT-EXT-FILE.                                         01560000
018600                                                                  01570000
018700     STOP RUN.                                                    01580000
018800                                                                  01590000
018900****************************************************************  01600000
019000*    READ AND VALIDATE THE DATE CONTROL CARD.                     01610000
019100*    CALCULATE BATCH NUMBER (CURRENT JULIAN DAY + 500).           01620000
019200*    DETERMINE KOHLS MONTH BASED ON CURRENT JULIAN DAY.           01630000
019400****************************************************************  01640000
019500 1000-INITIALIZATION.                                             01650000
019600                                                                  01660000
019700     READ CONTROL-CARD-FILE INTO CC-CONTROL-CARD                  01670000
019800         AT END                                                   01680000
019900             DISPLAY '** PROGRAM ABEND **'                        01690000
020000             DISPLAY PC-PGM-NAME ' - CONTROL DATE EMPTY'          01700000
020100             MOVE +4003 TO PV-ABEND-CODE                          01710000
020200             PERFORM 9999-ABEND.                                  01720000
020300                                                                  01730000
020400     DISPLAY '** ' PC-PGM-NAME ' CONTROL CARD = ' CC-CONTROL-CARD.01740000
020500                                                                  01750000
020600     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              01760000
020700     MOVE CC-PROC-DATE TO DPG52-LK-DATE-INPUT.                    01770000
020800     SET DPG52-LK-DTE-ISO-FMT TO TRUE.                            01780000
020900                                                                  01790000
021000     PERFORM 6000-CALL-DATE-ROUTINE.                              01800000
021100                                                                  01810000
021200     IF (DPG54-DATE-INVALID OR DPG54-SEVERE-ERROR)                01820000
021300         DISPLAY '** PROGRAM ABEND **'                            01830000
021400         DISPLAY PC-PGM-NAME ' - INVALID CONTROL CARD DATE: '     01840000
021500             CC-PROC-DATE                                         01850000
021600         DISPLAY '           DPKUT500 ERROR MESSAGE: '            01860000
021700             DPG54-ERROR-MESSAGE                                  01870000
021800         MOVE +4003 TO PV-ABEND-CODE                              01880000
021900         PERFORM 9999-ABEND.                                      01890000
022000                                                                  01900000
022100     ACCEPT PV-JULIAN-DAY FROM DAY.                               01910000
022200     MOVE PV-JULIAN-DDD TO PV-BATCH-NBR.                          01920000
022300     DISPLAY '** ' PC-PGM-NAME ' BATCH NBR ASSIGNED = '           01930000
022400         PV-BATCH-NBR.                                            01940000
022500                                                                  01950000
022600     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              01960000
022700     MOVE PV-JULIAN-DAY TO DPG52-LK-DATE-INPUT.                   01970000
022800     SET DPG52-LK-DTE-JULIAN TO TRUE.                             01980000
022900                                                                  01990000
023000     PERFORM 6000-CALL-DATE-ROUTINE.                              02000000
023100                                                                  02010000
023200     IF (DPG54-DATE-INVALID OR DPG54-SEVERE-ERROR)                02020000
023300         DISPLAY '** PROGRAM ABEND **'                            02030000
023400         DISPLAY PC-PGM-NAME ' - INVALID SYSTEM JULIAN DATE: '    02040000
023500             PV-JULIAN-DAY                                        02050000
023600         DISPLAY '           DPKUT500 ERROR MESSAGE: '            02060000
023700             DPG54-ERROR-MESSAGE                                  02070000
023800         MOVE +4003 TO PV-ABEND-CODE                              02080000
023900         PERFORM 9999-ABEND.                                      02090000
024000                                                                  02100000
024100     MOVE DPG56-FISCAL-PERIOD-NBR TO PV-KOHLS-MM.                 02110000
024200                                                                  02120000
024700****************************************************************  02130000
024800*    PROCESS THE CURRENT WEEKLY RECEIPT RECORD. MOVE ALL THE      02140000
024900*    CORRESPONDING FIELDS TO THE WEEKLY EXTRACT RECORD LAYOUT.    02150000
025000*    WRITE THE EXTRACT RECORD. READ THE NEXT WEEKLY RECEIPT       02160000
025100*    RECORD.                                                      02170000
025200****************************************************************  02180000
025300 2000-PROCESS-WKLY-RCPT-FILE.                                     02190000
025400                                                                  02200000
025500     ADD 1 TO PA-WKLY-RCPT-CNT.                                   02210000
025600                                                                  02220000
025700     INITIALIZE ML015-PURCHASE-RECORD.                            02230000
025800                                                                  02240000
I09973     IF SE-PO NOT    = PV-PO-BEING-PROCESSED                      02240128
I09973         MOVE SE-PO TO PV-PO-BEING-PROCESSED                      02240228
I09973                       PV-PO-NBR                                  02240328
I09973         PERFORM 5000-GET-PO-INFO.                                02240422
I09973*                                                                 02243022
025900     MOVE PC-PURCH-CDE             TO ML015-PURCH-CDE.            02250000
025910     MOVE SE-VENDOR-NO-INHOUSE     TO PV-VENDOR-NO-INHOUSE.       02260000
W26603     MOVE PV-INHOUSE-NBR    TO ML015-PURCH-VENDOR-INHSE-NMBR.     02270015
W26603     MOVE ZEROS                    TO ML015-PURCH-ENT-ID.         02271015
026100     MOVE SE-DEPT                  TO ML015-PURCH-DEPT-NBR.       02280000
026200     MOVE SE-CLASS (1:2)           TO ML015-PURCH-CLASS-NBR.      02290000
026201                                                                  02300000
026210     IF SE-RECEIVING-LOCATION = 'DS'                              02310000
W26603       MOVE SE-DR-MM               TO ML015-PURCH-INV-DTE-MM      02320011
W26603       MOVE SE-DR-DD               TO ML015-PURCH-INV-DTE-DD      02321011
W26603       MOVE SE-DR-YY               TO ML015-PURCH-INV-DTE-YY      02322011
W26603       MOVE 20                     TO ML015-PURCH-INV-DTE-CC      02323011
W26603****         MOVE SE-DATE-RECEIVED                                02330011
W26603****                               TO ML015-PURCH-INV-CUT-DTE     02340011
026250     ELSE                                                         02350000
W26603       MOVE SE-DV-MM               TO ML015-PURCH-INV-DTE-MM      02351011
W26603       MOVE SE-DV-DD               TO ML015-PURCH-INV-DTE-DD      02352011
W26603       MOVE SE-DV-YY               TO ML015-PURCH-INV-DTE-YY      02353011
W26603       MOVE 20                     TO ML015-PURCH-INV-DTE-CC      02354011
W26603****         MOVE SE-DATE-VERIFIED-COUNT                          02360011
W26603****                               TO ML015-PURCH-INV-CUT-DTE     02370011
026311     END-IF.                                                      02380000
026312                                                                  02390000
W26603     MOVE SE-PO                    TO ML015-PURCH-PO-NBR.         02400011
W26603**** MOVE SE-PO (4:5)              TO ML015-PURCH-PO-NBR.         02401011
026500                                                                  02410000
026600     MOVE PV-BATCH-NBR             TO ML015-PURCH-BATCH-NBR.      02420000
026700     MOVE PV-KOHLS-MM              TO ML015-PURCH-KOHLS-MM.       02430000
026710     MOVE PC-TRANS-CDE-01          TO ML015-PURCH-AP-TRANS-CDE.   02440000
026800                                                                  02450000
027500     MOVE SE-DR-MM                 TO ML015-PURCH-DOC-DTE-MM.     02461011
027600     MOVE SE-DR-DD                 TO ML015-PURCH-DOC-DTE-DD.     02470000
W26603     MOVE SE-DR-YY                 TO ML015-PURCH-DOC-DTE-YY.     02471011
W26603     MOVE 20                       TO ML015-PURCH-DOC-DTE-CC.     02472011
027700     MOVE ZEROS                    TO ML015-PURCH-DOC-5-NBR.      02480000
W26603     MOVE SE-LOC-NBR               TO PV-EDIT-LOC-NBR.            02491016
W26603     MOVE PV-EDIT-LOC-NBR-ALPH     TO ML015-PURCH-STORE-NBR.      02492011
W26603**** MOVE SE-STORE                 TO ML015-PURCH-STORE-NBR.      02493011
027900     MOVE ZEROS                    TO ML015-PURCH-DISCT-AMT       02500000
028000                                      ML015-PURCH-FRGHT-AMT.      02510000
028100     MOVE PC-TRANS-CDE-01          TO ML015-PURCH-TRANS-CDE.      02520000
                                                                        02520102
0100RM** WR20698 ADD PO-TYPE CODE                                       02521002
0100RM     MOVE SE-PO-TYP-CDE            TO ML015-PURCH-PO-TYP-CDE.     02522009
W26603     MOVE SE-SKU-NBR               TO ML015-PURCH-SKU-NBR.        02524011
W26603     MOVE ZEROS                    TO ML015-PURCH-ENT-ID.         02525011
028200                                                                  02530000
028300     IF SE-COST-EXTENSION GREATER PC-POS-EXTENSION                02540000
028310         OR SE-COST-EXTENSION LESS PC-NEG-EXTENSION               02550000
028400         OR SE-RETAIL-EXTENSION GREATER PC-POS-EXTENSION          02560000
028410         OR SE-RETAIL-EXTENSION LESS PC-NEG-EXTENSION             02570000
P49937         OR SE-1ST-COST-EXTENSION GREATER PC-POS-EXTENSION        02571019
P49937         OR SE-1ST-COST-EXTENSION LESS PC-NEG-EXTENSION           02572019
028500             PERFORM 3000-WRITE-MULTIPLE-RECS                     02580000
028600     ELSE                                                         02590000
P49937         IF SE-PO-TYP-CDE = ('IM' OR 'IE' OR 'IF')                02591019
I09973**       PRIVATE LABEL PO NEEDS TO USE UNIT COST TOO              02592028
I09973             OR  PURCHS-DERVD-LBL-TYP-CDE = 'P'                   02594028
I84040**       EXCLUSIVE BRAND (LABEL) NEEDS TO USE UNIT COST TOO       02594131
I84040             OR  PURCHS-DERVD-LBL-TYP-CDE = 'E'                   02595031
P49937           MOVE SE-COST-EXTENSION TO ML015-PURCH-MERCH-AMT        02600019
P49937                                     ML015-PURCH-NET              02610019
P49937         ELSE                                                     02611019
P49937           MOVE SE-1ST-COST-EXTENSION TO ML015-PURCH-MERCH-AMT    02612019
P49937                                         ML015-PURCH-NET          02613019
P49937         END-IF                                                   02614019
028630         MOVE SE-RETAIL-EXTENSION TO ML015-PURCH-RETAIL           02620000
028640         PERFORM 7100-WRITE-RCPT-EXT-REC.                         02630000
028710                                                                  02640000
029400     PERFORM 7000-READ-WKLY-RCPT-FILE.                            02650000
029500                                                                  02660000
029600****************************************************************  02670000
029700*    IF EITHER THE COST OR RETAIL ON THE INPUT RECORDS EXCEEDS    02680000
029800*    99999.99, THEN MULTIPLE EXTRACT RECORDS MUST BE FORMATTED    02690000
029900*    SINCE THE MAX FIELD SIZE ON THE OUTPUT RECORD IS S9(5)V99.   02700000
030100****************************************************************  02710000
030200 3000-WRITE-MULTIPLE-RECS.                                        02720000
030300                                                                  02730000
032414     MOVE PC-NO-IND TO PS-END-OF-COST-DOLLARS-SW                  02740000
032415                       PS-END-OF-RTL-DOLLARS-SW.                  02750000
P49937     IF SE-PO-TYP-CDE = ('IM' OR 'IE' OR 'IF')                    02751019
I09973**       PRIVATE LABEL PO NEEDS TO USE UNIT COST TOO              02751128
I09973             OR  PURCHS-DERVD-LBL-TYP-CDE = 'P'                   02751528
P49937        MOVE SE-COST-EXTENSION     TO PV-COST-EXTENSION           02752019
P49937     ELSE                                                         02754019
P49937        MOVE SE-1ST-COST-EXTENSION TO PV-COST-EXTENSION           02755019
P49937     END-IF.                                                      02757019
032417     MOVE SE-RETAIL-EXTENSION TO PV-RTL-EXTENSION.                02770000
032418                                                                  02780000
032419     PERFORM 4000-CALC-EXTENSION                                  02790000
032420         UNTIL PS-END-OF-COST-DOLLARS                             02800000
032421           AND PS-END-OF-RTL-DOLLARS.                             02810000
032422                                                                  02820000
032423****************************************************************  02830000
032424*    DETERMINE THE COST AND RETAIL EXTENSION BASED ON THE         02840000
032425*    DOLLARS REMAINING IN EACH BUCKET. WRITE AN EXTRACT RECORD.   02850000
032426****************************************************************  02860000
032427 4000-CALC-EXTENSION.                                             02870000
032428                                                                  02880000
032429     IF PV-COST-EXTENSION GREATER PC-POS-EXTENSION                02890000
032430         SUBTRACT PC-POS-EXTENSION FROM PV-COST-EXTENSION         02900000
032431         MOVE PC-POS-EXTENSION TO ML015-PURCH-MERCH-AMT           02910000
032432                                  ML015-PURCH-NET                 02920000
032433     ELSE                                                         02930000
032434         IF PV-COST-EXTENSION LESS PC-NEG-EXTENSION               02940000
032435             SUBTRACT PC-NEG-EXTENSION FROM PV-COST-EXTENSION     02950000
032436             MOVE PC-NEG-EXTENSION TO ML015-PURCH-MERCH-AMT       02960000
032437                                      ML015-PURCH-NET             02970000
032438         ELSE                                                     02980000
032439             IF PV-COST-EXTENSION NOT EQUAL 0                     02990000
032440                 MOVE PV-COST-EXTENSION TO ML015-PURCH-MERCH-AMT  03000000
032441                                           ML015-PURCH-NET        03010000
032442                 MOVE +0 TO PV-COST-EXTENSION                     03020000
032443                 MOVE PC-YES-IND TO PS-END-OF-COST-DOLLARS-SW     03030000
032444             ELSE                                                 03040000
032445                 MOVE PV-COST-EXTENSION TO ML015-PURCH-MERCH-AMT  03050000
032446                                           ML015-PURCH-NET        03060000
032449             END-IF                                               03070000
032450         END-IF                                                   03080000
032451     END-IF.                                                      03090000
032452                                                                  03100000
032453     IF PV-RTL-EXTENSION GREATER PC-POS-EXTENSION                 03110000
032454         SUBTRACT PC-POS-EXTENSION FROM PV-RTL-EXTENSION          03120000
032455         MOVE PC-POS-EXTENSION TO ML015-PURCH-RETAIL              03130000
032456     ELSE                                                         03140000
032457         IF PV-RTL-EXTENSION LESS PC-NEG-EXTENSION                03150000
032458             SUBTRACT PC-NEG-EXTENSION FROM PV-RTL-EXTENSION      03160000
032459             MOVE PC-NEG-EXTENSION TO ML015-PURCH-RETAIL          03170000
032460         ELSE                                                     03180000
032461             IF PV-RTL-EXTENSION NOT EQUAL 0                      03190000
032462                 MOVE PV-RTL-EXTENSION TO ML015-PURCH-RETAIL      03200000
032463                 MOVE +0 TO PV-RTL-EXTENSION                      03210000
032464                 MOVE PC-YES-IND TO PS-END-OF-RTL-DOLLARS-SW      03220000
032465             ELSE                                                 03230000
032466                 MOVE PV-RTL-EXTENSION TO ML015-PURCH-RETAIL      03240000
032467             END-IF                                               03241000
032468         END-IF                                                   03242000
032469     END-IF.                                                      03243000
032470                                                                  03244000
032480     PERFORM 7100-WRITE-RCPT-EXT-REC.                             03245000
032490                                                                  03246000
I09973****************************************************************  03246129
I09973*    RETRIEVE PO TYPE INFORMATION.                                03246222
I09973*    CALLED FROM                                                  03246322
I09973****************************************************************  03246429
I09973 5000-GET-PO-INFO.                                                03246522
I09973                                                                  03246622
I09973     INITIALIZE  DCLTPURCHS.                                      03246728
I09973                                                                  03247028
I09973     EXEC SQL                                                     03247222
I09973         SELECT  DERVD_LBL_TYP_CDE                                03247527
I09973           INTO :PURCHS-DERVD-LBL-TYP-CDE                         03247827
I09973           FROM  TPURCHS                                          03247922
I09973          WHERE  VER_STATUS_CDE = 'A'                             03248022
I09973            AND  PO_NBR         = :PV-PO-NBR                      03248122
I09973          WITH UR                                                 03248226
I09973     END-EXEC.                                                    03248322
I09973                                                                  03248422
I09973     EVALUATE TRUE                                                03248522
I09973         WHEN SQLCODE = ZERO                                      03248622
I09973              CONTINUE                                            03248722
I09973         WHEN SQLWARN0 NOT = SPACES                               03248822
I09973         WHEN SQLCODE  NOT = ZERO                                 03248922
I09973             MOVE '5000-GET-PO-INFO'     TO AA-PARAGRAPH-NAME     03249022
I09973             MOVE 'UNSUCCESSFUL SELECT ' TO AA-DB2-OP-1           03249122
I09973             MOVE 'TPURCHS'              TO AA-DB2-TABLE-1        03249222
I09973             PERFORM 9998-DB2-ABEND                               03249322
I09973     END-EVALUATE.                                                03249422
I09973                                                                  03249522
034700****************************************************************  03249600
034800*    CALL THE DATE MODULE                                         03249700
034900****************************************************************  03249800
035000 6000-CALL-DATE-ROUTINE.                                          03250000
035100                                                                  03260000
035200     MOVE CC-CALENDAR-TYPE TO DPG51-CALENDAR-TYPE.                03270000
035300     SET DPG51-DO-NOT-INCR-DECR-DATE TO TRUE.                     03280000
035400                                                                  03290000
035500     CALL PC-DPKUT500                                             03300000
035600         USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.               03310000
035700                                                                  03320000
035800****************************************************************  03330000
035900*    READ A RECORD FROM THE WEEKLY RECEIPT INPUT FILE             03340000
036000****************************************************************  03350000
036100 7000-READ-WKLY-RCPT-FILE.                                        03360000
036200                                                                  03370000
036300     READ WKLY-RCPT-FILE                                          03380000
036400         INTO STORE-EXTRACT-LINE                                  03390000
036500             AT END SET PS-END-OF-WKLY-RCPT-FILE TO TRUE.         03400000
036600                                                                  03410000
036700****************************************************************  03420000
036800*    WRITE A RECORD TO THE RECEIPT EXTRACT FILE                   03430000
036900****************************************************************  03440000
037000 7100-WRITE-RCPT-EXT-REC.                                         03450000
037100                                                                  03460000
037200     WRITE RCPT-EXT-REC                                           03470000
037300         FROM ML015-PURCHASE-RECORD.                              03480000
037400                                                                  03490000
037500     ADD 1 TO PA-RCPT-EXT-CNT.                                    03500000
037600                                                                  03510000
      ****************************************************************  03520008
      *    DISPLAY COUNTS OF RECORDS READ AND WRITTEN                   03530008
045830****************************************************************  03540000
045840 9000-END-OF-JOB.                                                 03550000
045850                                                                  03560000
045860     DISPLAY '** ' PC-PGM-NAME ' WEEKLY RECEIPT RECS READ     = ' 03570000
045870         PA-WKLY-RCPT-CNT.                                        03580000
W26603**** DISPLAY '** ' PC-PGM-NAME ' TPURCHS CALLS                = ' 03581012
W26603****     PA-TPURCHS-CALLS.                                        03582012
045880     DISPLAY '** ' PC-PGM-NAME ' RECEIPT EXTRACT RECS WRITTEN = ' 03590000
045890         PA-RCPT-EXT-CNT.                                         03600000
045891     DISPLAY ' '.                                                 03610000
045900                                                                  03620000
I09973****************************************************************  03621029
I09973*    ABEND ROUTINE FOR DB2 ERRORS                                *03622022
I09973*    CALLED FROM 5000-GET-PO-INFO                                *03623022
I09973****************************************************************  03624029
I09973 9998-DB2-ABEND.                                                  03625022
I09973                                                                  03626022
I09973     DISPLAY 'PO BEING PROCESSED    = ' PV-PO-BEING-PROCESSED.    03627022
I09973     DISPLAY AA-ABEND-LIT.                                        03628022
I09973     DISPLAY AA-DB2-ERROR-LIT.                                    03629022
I09973     DISPLAY AA-PROGRAM-LIT.                                      03629122
I09973     DISPLAY AA-PARAGRAPH-LIT.                                    03629222
I09973     DISPLAY AA-DB2-OPERATION-LIT.                                03629322
I09973     DISPLAY AA-DB2-TABLE-1.                                      03629422
I09973     SET AC-DB2-ERROR TO TRUE.                                    03629522
I09973                                                                  03629622
I09973     COPY DPPD004.                                                03629722
I09973                                                                  03629822
I09973     CALL 'ILBOABN0' USING ABEND-CODE.                            03629922
I09973                                                                  03630022
046100****************************************************************  03631000
046200*    CALL ABEND MODULE                                            03640000
046300****************************************************************  03650000
046400 9999-ABEND.                                                      03660000
046500                                                                  03670000
0100RM     DISPLAY AA-ABEND-LIT.                                        03670102
0100RM     DISPLAY AA-PROGRAM-LIT.                                      03670302
0100RM     DISPLAY AA-PARAGRAPH-LIT.                                    03670402
0100RM     DISPLAY AA-MESSAGE-LINE.                                     03670502
046600     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         03680000
