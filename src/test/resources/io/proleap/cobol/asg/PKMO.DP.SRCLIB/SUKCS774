000240*-----------------------*                                         00010033
000250 IDENTIFICATION DIVISION.                                         00020033
000260*-----------------------*                                         00021033
000270 PROGRAM-ID.    SUKCS774.                                         00022033
000280 AUTHOR.        CHRISTINE TWIEHAUS                                00023033
000290 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00024033
000300 DATE-WRITTEN.  DECEMBER 2008.                                    00025033
000400 DATE-COMPILED.                                                   00026033
000500                                                                  00027033
000600*---------------------------------------------------------------* 00028033
000700*    S774 - DIRECTIVE CODE LIST PROGRAM                         * 00029033
000800*                                                               * 00030033
000900*    THIS PROGRAM GENERATES A LIST OF DIRECTIVE CODES           * 00040033
001000*                                                               * 00050033
001500*---------------------------------------------------------------* 00100033
263968* CHANGED 11/15/2021    BY JIM HUNTER      WR: CHG0263968         00102035
263968* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00103035
263968* MAKING THE CALL DYNAMIC VS STATIC.                              00104035
001130*                                                                 00104136
001110* CHANGED 01/09/2023    BY JEAN KURK       WR: CHG0278099         00104236
001120* CHANGE CALL OF DPKCS030 TO BE DYNAMIC                           00104336
263968*---------------------------------------------------------------* 00105035
003000 EJECT                                                            00110033
003100 ENVIRONMENT DIVISION.                                            00120033
003200                                                                  00130033
003300 DATA DIVISION.                                                   00140033
003400                                                                  00150033
003500 WORKING-STORAGE SECTION.                                         00160033
003600                                                                  00170033
003700 01  DK-DB2-KEYS.                                                 00180033
003800     15  DK-MESSAGE-TEXT                PIC  X(70)  VALUE SPACE.  00190033
003900     15  DK-MESSAGE-BYTE                REDEFINES DK-MESSAGE-TEXT 00200033
004000                                        OCCURS 70 TIMES           00210033
004100                                        PIC  X(01).               00220033
004200     15  DK-MESSAGE-NUMBER              PIC S9(05)  VALUE ZERO    00230033
004300                                                    COMP-3.       00240033
004400     15  DK-SYSTEM-ID                   PIC  X(02)  VALUE SPACE.  00250033
004500     15  DK-REVIEW-IND                  PIC  X(01)  VALUE SPACE.  00260033
004600                                                                  00270033
004700 01  PC-PROGRAM-CONSTANTS.                                        00280033
004800     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00290033
004900                                                    'SUK774  '.   00300033
005000     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00310033
005100                                                    'SUKM774 '.   00320033
005200     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00330033
005300                                                    'SUKCS774'.   00340033
005400     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00350033
005500     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00360033
005600     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00370033
005700     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +15     00380033
005800                                                    COMP SYNC.    00390033
005900     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00400033
006000                                                    COMP SYNC.    00410033
006100     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00420033
006200                                                    +1000000      00430033
006300                                                    COMP-3.       00440033
006400     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00450033
006500                                                    COMP SYNC.    00460033
006600     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00470033
006700                                                    COMP-3.       00480033
006800     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00490033
006900     05  PC-D                           PIC  X(01)  VALUE 'D'.    00500033
006910     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00510033
007000     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00520033
007100     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00530033
007200     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00540033
007300*                                                                 00550033
007400     05  PC-TSYMSG-NUMBERS.                                       00560033
007500         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00570033
007600         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00580033
007700         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00590033
007800         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00600033
007900         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00610033
008000         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00620033
008100         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00630033
008200         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00640033
008300         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00650033
008400         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00660033
008500         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00670033
008600         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00680033
008700         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00690033
008800         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00700033
008900*                                                                 00710033
009000 01  PS-PROGRAM-SWITCHES.                                         00720033
009100     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00730033
009200         88  PS-NO-ERROR                            VALUE 'Y'.    00740033
009300         88  PS-ERROR                               VALUE 'N'.    00750033
009400     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00760033
009500         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00770033
009600         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00780033
009700     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    00790033
009800         88  PS-DONE                                VALUE 'Y'.    00800033
009900         88  PS-NOT-DONE                            VALUE 'N'.    00810033
010000*                                                                 00820033
010100 01  PV-PROGRAM-VARIABLES.                                        00830033
010200     05  PV-SUB                         PIC S9(04)  VALUE +0      00840033
010300                                                    COMP SYNC.    00850033
010400     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00860033
010500                                                    COMP SYNC.    00870033
010600     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00880033
010700                                                    COMP-3.       00890033
010800     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      00900033
010900                                                    COMP-3.       00910033
011000     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      00920033
011100                                                    COMP-3.       00930033
011200     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      00940033
011300                                                    COMP-3.       00950033
011400     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      00960033
011500                                                    COMP-3.       00970033
011600     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      00980033
011700                                                    COMP-3.       00990033
011800     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01000033
011900                                                    COMP-3.       01010033
012000     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01020033
012100                                                    COMP SYNC.    01030033
012200     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01040033
012300                                                    COMP SYNC.    01050033
012400     05  PV-ITEM                        PIC S9(04)  VALUE +0      01060033
012500                                                    COMP SYNC.    01070033
012600     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01080033
012700                                                    COMP SYNC.    01090033
012800     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01100033
012900                                                    COMP SYNC.    01110033
013000     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01120033
013100                                                    COMP SYNC.    01130033
013200     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01140033
013300                                                    COMP SYNC.    01150033
013400     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01160033
013500                                                    COMP SYNC.    01170033
013600     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01180033
013700                                                    COMP SYNC.    01190033
013800     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01200033
013900                                                    COMP SYNC.    01210033
014000     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01220033
014100                                                    COMP SYNC.    01230033
014200     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01240033
014300                                                    COMP SYNC.    01250033
014400     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01260033
014500                                                    COMP SYNC.    01270033
014600     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01280033
014700                                                    COMP SYNC.    01290033
014800     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01300033
014900                                                    COMP SYNC.    01310033
015000     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01320033
015100                                                    COMP SYNC.    01330033
015200     05  PV-SCROLL-AREA                 OCCURS 14 TIMES.          01340033
015300         10  MR-SELECTL                 PIC S9(04) COMP.          01350033
015400         10  MR-SELECTA                 PIC  X(01).               01360033
015500         10  MR-SELECTC                 PIC  X(01).               01370033
015600         10  MR-SELECTH                 PIC  X(01).               01380033
015700         10  MR-SELECTI                 PIC  X(01).               01390033
015800                                                                  01400033
015900         10  MR-ACTIONL                 PIC S9(04) COMP.          01410033
016000         10  MR-ACTIONA                 PIC  X(01).               01420033
016100         10  MR-ACTIONC                 PIC  X(01).               01430033
016200         10  MR-ACTIONH                 PIC  X(01).               01440033
016300         10  MR-ACTION                  PIC  X(03).               01450033
016400******************************************************************01460033
016500**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01470033
016600**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE             01480033
016700**  APPLICATION-SPECIFIC COMMAREA.                                01490033
016800******************************************************************01500033
016900 01  LQW-LIST-QUEUE-WORK-AREA.                                    01510033
017000     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01520033
017100     05  LQW-ITEM-ENTRIES               OCCURS 14 TIMES           01530033
017200                                        INDEXED BY LQW-IDX.       01540033
017300         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01550033
017400         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01560033
017500         10  LQW-SELECTED-SW            PIC  X(01).               01570033
017600             88  LQW-SELECT                         VALUE 'S'.    01580033
017700             88  LQW-DESELECT                       VALUE ' '.    01590033
017800*        10  LQW-ACTION                 PIC  X(03).               01600033
017900         10  LQW-DIRV-RSN-CDE-DESC      PIC  X(30).               01610033
018000         10  LQW-DIRV-RSN-CDE           PIC  X(03).               01620033
018100                                                                  01630033
018200     EJECT                                                        01640033
018300*---------------------------------------------------------------* 01650033
018400*  RECORD LAYOUT FOR THE MESSAGE SELECTION TEMP STORAGE QUEUE.  * 01660033
018500*---------------------------------------------------------------* 01670033
018600                                                                  01680033
018700     COPY DPWS057.                                                01690033
018800                                                                  01700033
018900     EJECT                                                        01710033
019000*---------------------------------------------------------------* 01720033
019100*    MAP LAYOUT                                                   01730033
019200*---------------------------------------------------------------* 01740033
019300                                                                  01750033
019400     COPY SUKM774.                                                01760033
019410*---------------------------------------------------------------* 01770033
019500*                                                                 01780033
019600 01  MR-OCCURS-LAYOUT                   REDEFINES  SUK774O.       01790033
019700     05  FILLER                         PIC X(042).               01800033
019800     05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          01810033
021000                                                                  01820033
021100         10  MR-DIRV-RSN-CDEL           PIC S9(04) COMP.          01830033
021200         10  MR-DIRV-RSN-CDEA           PIC  X(01).               01840033
021300         10  MR-DIRV-RSN-CDEC           PIC  X(01).               01850033
021400         10  MR-DIRV-RSN-CDEH           PIC  X(01).               01860033
021500         10  MR-DIRV-RSN-CDE            PIC  X(03).               01870033
021600                                                                  01880033
021700         10  MR-DIRV-RSN-CDE-DESCL      PIC S9(04) COMP.          01890033
021800         10  MR-DIRV-RSN-CDE-DESCA      PIC  X(01).               01900033
021900         10  MR-DIRV-RSN-CDE-DESCC      PIC  X(01).               01910033
022000         10  MR-DIRV-RSN-CDE-DESCH      PIC  X(01).               01920033
022100         10  MR-DIRV-RSN-CDE-DESC       PIC  X(30).               01930033
022200                                                                  01940033
022300     EJECT                                                        01950033
022400*---------------------------------------------------------------* 01960033
022500*    ATTRIBUTE SETTINGS COPYBOOK.                                 01970033
077400*---------------------------------------------------------------* 01980033
022700                                                                  01990033
022800     COPY DPWS015.                                                02000033
022900                                                                  02010033
023000*---------------------------------------------------------------* 02020033
023100*    FUNCTION KEYS COPYBOOK.                                      02030033
023200*---------------------------------------------------------------* 02040033
023300                                                                  02050033
023400     COPY DPWS016.                                                02060033
023500                                                                  02070033
023600*---------------------------------------------------------------* 02080033
023700*    NUMERIC EDIT LAYOUT.                                         02090033
023800*---------------------------------------------------------------* 02100033
023900                                                                  02110033
024000     COPY DPWS010I.                                               02120033
024100 EJECT                                                            02130033
024200*---------------------------------------------------------------* 02140033
024300*    PARAMETERS FOR CALLING CICS ARCHITECTURE API               * 02150036
024400*---------------------------------------------------------------* 02160033
024500                                                                  02170033
024600     COPY DPWS030.                                                02180033
024600     COPY DPWS930.                                                02181036
024700 EJECT                                                            02190033
024800*---------------------------------------------------------------* 02200033
024900*    STANDARD COMMAREA.                                           02210033
025000*---------------------------------------------------------------* 02220033
025100                                                                  02230033
025200     COPY DPWS020.                                                02240033
025300     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02250033
025400                                                                  02260033
025500*---------------------------------------------------------------* 02270033
025600* INTER-APPLICATION COMMAREA.                                     02280033
025700*   CNWS011 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 02290033
025800*             SPEC SCREEN.                                        02300033
026100*---------------------------------------------------------------* 02310033
026200                                                                  02320033
026300         10  INTER-APPL-COMM-AREA       PIC X(200).               02330033
026400     COPY CNWS011.                                                02340033
026600*---------------------------------------------------------------* 02350033
026700*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                     02360033
026800*---------------------------------------------------------------* 02370033
026900         10  ASC-SPECIFIC-COMMAREA.                               02380033
027000             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02390033
027100                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  02400033
027200                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   02410033
027300                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   02420033
027400                                                                  02430033
027500                 20  ASC-ITEM-ARRAY.                              02440033
027600                     25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        02450033
027700                         30  ASC-LIST-ITEM-NUMBER                 02460033
027800                                                     PIC S9(09)   02470033
027900                                                     COMP-3.      02480033
028000                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  02490033
028100                             88  ASC-VALID-SELECT    VALUE ' '    02500033
028200                                                           'S'    02510033
028300                                                           'B'    02520033
028400                                                           'E'.   02530033
028500                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   02540033
028600                             88  ASC-TEMP-SELECT     VALUE 'S'.   02550033
028700                             88  ASC-TEMP-BEGIN      VALUE 'B'.   02560033
028800                             88  ASC-TEMP-END        VALUE 'E'.   02570033
028900                         30  ASC-SELECTED-SW         PIC  X(01).  02580033
029000                             88  ASC-NO-SELECT       VALUE ' '.   02590033
029100                             88  ASC-SELECT          VALUE 'S'.   02600033
029200                             88  ASC-BEGIN           VALUE 'B'.   02610033
029300                             88  ASC-END             VALUE 'E'.   02620033
029400*                        30  ASC-ACTION              PIC  X(03).  02630033
029500                         30  ASC-DIRV-RSN-CDE-DESC   PIC  X(30).  02640033
029600                         30  ASC-DIRV-RSN-CDE        PIC  X(03).  02650033
029700                                                                  02660033
029800             15  ASC-BLK-SUB                         PIC S9(04)   02670033
029900                                                          COMP    02680033
030000                                                          SYNC.   02690033
030100             15  ASC-ITEM-SUB                        PIC S9(04)   02700033
030200                                                          COMP    02710033
030300                                                          SYNC.   02720033
030400             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   02730033
030500                                                          COMP-3. 02740033
030600             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   02750033
030700                                                          COMP-3. 02760033
030800             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   02770033
030900                                                          COMP-3. 02780033
031000             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   02790033
031100                                                          COMP-3. 02800033
031200             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   02810033
031300                                                          COMP-3. 02820033
031400             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   02830033
031500                                                          COMP    02840033
031600                                                          SYNC.   02850033
031700             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   02860033
031800                                                          COMP-3. 02870033
031900             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   02880033
032000                                                          COMP-3. 02890033
032100             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  02900033
032200                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   02910033
032300                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   02920033
032400             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  02930033
032500                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   02940033
032600                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   02950033
032700             15  ASC-LIST-QUEUE-NAME.                             02960033
032800                 20  ASC-LIST-TERM-ID                PIC  X(04).  02970033
032900                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   02980033
033000                                                          COMP-3. 02990033
033100                 20  ASC-LIST-SEQ                    PIC  9(01).  03000033
033200             15  ASC-SEL-QUEUE-NAME.                              03010033
033300                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03020033
033400                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03030033
033500                                                          COMP-3. 03040033
033600                 20  ASC-SEL-SEQ                     PIC  9(01).  03050033
033800             15  ASC-SEL-QUEUE-NAME-IN.                           03051034
                       20  ASC-SEL-TERM-ID-IN       PIC  X(04).         03052034
                       20  ASC-SEL-TASK-NUMBER-IN   PIC S9(05) COMP-3.  03053034
                       20  ASC-SEL-SEQ-IN           PIC  9(01).         03054034
033700                                                                  03060033
033800             15  ASC-START-ITEM-REQUEST.                          03070033
033900                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  03080033
034000     EJECT                                                        03090033
034100*---------------------------------------------------------------* 03100033
034200*    ABEND PROCESSING COPYBOOK.                                   03110033
034300*---------------------------------------------------------------* 03120033
034400                                                                  03130033
034500     COPY DPWS013.                                                03140033
034600                                                                  03150033
034700 EJECT                                                            03160033
036600*---------------------------------------------------------------* 03170033
036700*    DB2 AREA FOR COMMUNICATIONS                                  03180033
036800*---------------------------------------------------------------* 03190033
036900     EXEC SQL                                                     03200033
037000          INCLUDE SQLCA                                           03210033
037100     END-EXEC.                                                    03220033
037200                                                                  03230033
037210*---------------------------------------------------------------* 03240033
037220*    DB2 AREA FOR TSUT00101                                       03250033
037230*---------------------------------------------------------------* 03260033
037231     EXEC SQL                                                     03270033
037232          INCLUDE SUT00101                                        03280033
037233     END-EXEC.                                                    03290033
037234                                                                  03300033
037235*---------------------------------------------------------------* 03310033
037236*    DOOR TYPE CURSOR                                             03320033
037237*---------------------------------------------------------------* 03330033
037238                                                                  03340033
037239     EXEC SQL                                                     03350033
037240          DECLARE   DIRV_RSN_CSR CURSOR FOR                       03360033
037241           SELECT   DIRV_RSN_CDE                                  03370033
037242                  , DIRV_RSN_CDE_DESC                             03380033
037243             FROM   SUT_CNVYR_DIRV_RSN                            03390033
037245          ORDER BY  DIRV_RSN_CDE                                  03410033
037246                  , DIRV_RSN_CDE_DESC                             03420033
037247     END-EXEC.                                                    03430033
037250                                                                  03440033
037300*---------------------------------------------------------------* 03450033
037400                                                                  03460033
043600 LINKAGE SECTION.                                                 03470033
043700                                                                  03480033
043800 01  DFHCOMMAREA.                                                 03490033
043900     05  FILLER                         OCCURS  1 TO 4072 TIMES   03500033
044000                                        DEPENDING ON EIBCALEN.    03510033
044100         10  FILLER                     PIC X.                    03520033
044200                                                                  03530033
044300 EJECT                                                            03540033
044400 PROCEDURE DIVISION.                                              03550033
044500******************************************************************03560033
044600**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **03570033
044700**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **03580033
044800**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **03590033
044900******************************************************************03600033
045000 0000-MAIN-MODULE.                                                03610033
045100     INITIALIZE DP030-CICS-API-FIELDS.                            03620033
045200     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03630033
045300     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03640033
045400     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03650033
045500     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03660033
045600     MOVE LENGTH OF SUK774I        TO DP030-MAP-LENGTH (1).       03670033
045700     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03680033
045800     PERFORM 0001-CALL-CICS-ARCH-API.                             03690033
045900*                                                                 03700033
046000     PERFORM 1000-CONTROL-PROCESSING                              03710033
046100*                                                                 03720033
046200     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03730033
046300     PERFORM 0001-CALL-CICS-ARCH-API.                             03740033
046400                                                                  03750033
046500******************************************************************03760033
046600**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **03770033
046700**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.           03780033
046800******************************************************************03790033
046900 0001-CALL-CICS-ARCH-API.                                         03800033
047000*    CALL 'DPKCS030' USING DFHEIBLK                               03810036
047000     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03811036
047100                           DFHCOMMAREA                            03820033
047200                           DP030-CICS-API-FIELDS                  03830033
047300                           DP020-STANDARD-COMMAREA                03840033
047400                           SUK774I.                               03850033
047500*                                                                 03860033
047600     IF  DP030-RC-CALL-SUCCESSFUL                                 03870033
047700         CONTINUE                                                 03880033
047800     ELSE                                                         03890033
047900         SET DP013-NO-ROLLBACK                                    03900033
048000             DP013-XCTL-DISPLAY-RESTART                           03910033
048100             DP013-CICS-ABEND      TO TRUE                        03920033
048200         MOVE '0001-CALL-CICS-ARCH-API'                           03930033
048300                                   TO DP013-PARAGRAPH             03940033
048400*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NE 03950036
048500*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      03960036
048400         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03961036
048500-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03962036
048600         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      03970033
048700         PERFORM DP013-0000-PROCESS-ABEND                         03980033
048800     END-IF.                                                      03990033
048900*----------------------------------------------------------------*04000033
049000* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT       04010033
049100* COURSE OF ACTION IS FOR THIS TRANSACTION.                       04020033
049200*                                                                 04030033
049300* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE   04040033
049400*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *04050033
049500*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *04060033
049600*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *04070033
049700*----------------------------------------------------------------*04080033
049800                                                                  04090033
049900 1000-CONTROL-PROCESSING.                                         04100033
050000                                                                  04110033
050100     EVALUATE TRUE                                                04120033
050200         WHEN DP020-NEXT-ACT-INITIAL                              04130033
050300             INITIALIZE ASC-SPECIFIC-COMMAREA                     04140033
050400             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            04150033
050500                                      ASC-SEL-TERM-ID             04160033
050600             MOVE DP020-SRC-TASK-NUMBER                           04170033
050700                                   TO ASC-LIST-TASK-NUMBER        04180033
050800                                      ASC-SEL-TASK-NUMBER         04190033
050900             MOVE PC-LIST-QUEUE-SEQ                               04200033
051000                                   TO ASC-LIST-SEQ                04210033
051100             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 04220033
051200             PERFORM 1100-PROCESS-INTER-APPL-COMM                 04230033
051300***-----$TEMPLATE NOTE$-------------------------------------------04240033
051400*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,04250033
051500*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  04260033
051600*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.04270033
051700***---------------------------------------------------------------04280033
051800             IF  PS-COMMAREA-NOT-VALID                            04290033
052300                 SET DP020-NEXT-ACT-APPL-ERROR                    04300033
052400                                   TO TRUE                        04310033
052500             ELSE                                                 04320033
052600                 PERFORM 4000-BUILD-INITIAL-PANEL                 04330033
052700             END-IF                                               04340033
052800                                                                  04350033
052900         WHEN DP020-NEXT-ACT-READ-MAP                             04360033
053000             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        04370033
053100                                   TO PV-TOP-ITEM                 04380033
053200             PERFORM 2000-PROCESS-PANEL                           04390033
053300                                                                  04400033
053400         WHEN DP020-NEXT-ACT-RETURN                               04410033
053500             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        04420033
053600                                   TO PV-TOP-ITEM                 04430033
053700             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    04440033
053800             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 04450033
053900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04460033
054000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04470033
054100                                                                  04480033
054200         WHEN OTHER                                               04490033
054300             SET DP013-LOGIC-ABEND TO TRUE                        04500033
054400             SET DP013-NO-ROLLBACK TO TRUE                        04510033
054500             MOVE '1000-CONTROL-PROCESSING'                       04520033
054600                                   TO DP013-PARAGRAPH             04530033
054700             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    04540033
054800                                   TO DP013-MESSAGE-TEXT(1)       04550033
054900             PERFORM DP013-0000-PROCESS-ABEND                     04560033
055000     END-EVALUATE.                                                04570033
055100                                                                  04580033
055200 EJECT                                                            04590033
055300*----------------------------------------------------------------*04600033
055400* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *04610033
055500* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.               04620033
055600*----------------------------------------------------------------*04630033
055700                                                                  04640033
055800 1100-PROCESS-INTER-APPL-COMM.                                    04650033
055900                                                                  04660033
056000     SET PS-COMMAREA-VALID         TO TRUE.                       04670033
056100     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     04680033
056200                                                                  04690033
056300 EJECT                                                            04700033
056400*----------------------------------------------------------------*04710033
056500* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *04720033
056600* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *04730033
056700* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *04740033
056800* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID       04750033
056900* FUNCTION KEYS CAN GET THIS FAR.                                 04760033
057000*----------------------------------------------------------------*04770033
057100                                                                  04780033
057200 2000-PROCESS-PANEL.                                              04790033
057300     EVALUATE TRUE                                                04800033
057400         WHEN DP020-SRC-AID = DP016-CLEAR                         04810033
057500             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    04820033
057600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04830033
057700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04840033
057800                                                                  04850033
057900         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    04860033
058000             PERFORM 2050-DELETE-LIST-QUEUE                       04870033
058100             PERFORM 4000-BUILD-INITIAL-PANEL                     04880033
058200                                                                  04890033
059100         WHEN OTHER                                               04900033
059200             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 04910033
059300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04920033
059400             IF  PS-NO-ERROR                                      04930033
059500                 SET DP030-CONTINUE-GO                            04940033
059600                                 TO TRUE                          04950033
059700                 PERFORM 2100-CHECK-FUNCTION-KEY                  04960033
059800             ELSE                                                 04970033
059900                 SET DP030-OVERRIDE-GO                            04980033
060000                                 TO TRUE                          04990033
060100             END-IF                                               05000033
060200     END-EVALUATE.                                                05010033
060300 EJECT                                                            05020033
060400*----------------------------------------------------------------*05030033
060500*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                      05040033
060600*----------------------------------------------------------------*05050033
060700 2050-DELETE-LIST-QUEUE.                                          05060033
060800                                                                  05070033
060900     EXEC CICS                                                    05080033
061000         DELETEQ TS                                               05090033
061100             QUEUE (ASC-LIST-QUEUE-NAME)                          05100033
061200             RESP  (PV-CICS-RESP)                                 05110033
061300     END-EXEC.                                                    05120033
061400                                                                  05130033
061500     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       05140033
061600        (PV-CICS-RESP = DFHRESP(QIDERR))                          05150033
061700         CONTINUE                                                 05160033
061800     ELSE                                                         05170033
061900         SET DP013-CICS-ABEND      TO TRUE                        05180033
062000         SET DP013-NO-ROLLBACK     TO TRUE                        05190033
062100                                                                  05200033
062200         MOVE '2050-DELETE-LIST-QUEUE'                            05210033
062300                                   TO DP013-PARAGRAPH             05220033
062400         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    05230033
062500                                   TO DP013-MESSAGE-TEXT (1)      05240033
062600         PERFORM DP013-0000-PROCESS-ABEND                         05250033
062700     END-IF.                                                      05260033
062800                                                                  05270033
062900     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  05280033
063000 EJECT                                                            05290033
063100*----------------------------------------------------------------*05300033
063200* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*05310033
063300* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE   05320033
063400* CICS ARCHITECTURE API.                                          05330033
063500*----------------------------------------------------------------*05340033
063600 2100-CHECK-FUNCTION-KEY.                                         05350033
063700     EVALUATE TRUE                                                05360033
063800         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  05370033
063900             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              05380033
063901                 INITIALIZE CN011-INTER-APPL-COMMAREA             05390033
063920*                MOVE ASC-NUMBER-OF-SELECTED-ITEMS                05400033
063930*                               TO SU101-NUMBER-OF-SELECTED-ITEMS 05410033
063940                 PERFORM 5000-PREPARE-SEL-QUEUE                   05420033
063950             ELSE                                                 05430033
064500                 SET DP030-OVERRIDE-GO                            05440033
064600                                   TO TRUE                        05450033
064700                 MOVE PC-TSYMSG-00057                             05460033
064800                                   TO DP020-MSG-NUMBER            05470033
064900                 SET DP020-MSG-WARNING                            05480033
065000                                   TO TRUE                        05490033
065100             END-IF                                               05500033
065200                                                                  05510033
065300         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  05520033
065400             MOVE -1               TO ASTRTITL                    05530033
065500             SET DP030-SET-CURSOR-APPL-1                          05540033
065600                               TO TRUE                            05550033
065700             MOVE +1               TO PV-TOP-ITEM                 05560033
065800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05570033
065900                                                                  05580033
066000         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   05590033
066100             MOVE -1               TO ASTRTITL                    05600033
066200             SET DP030-SET-CURSOR-APPL-1                          05610033
066300                               TO TRUE                            05620033
066400             PERFORM 2110-BROWSE-BACKWARD                         05630033
066500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05640033
066600                                                                  05650033
066700         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   05660033
066800             MOVE -1               TO ASTRTITL                    05670033
066900             SET DP030-SET-CURSOR-APPL-1                          05680033
067000                               TO TRUE                            05690033
067100             PERFORM 2120-BROWSE-FORWARD                          05700033
067200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05710033
067300                                                                  05720033
067400         WHEN DP020-SRC-AID = DP016-ENTER                         05730033
067500             MOVE -1               TO ASTRTITL                    05740033
067600             SET DP030-SET-CURSOR-APPL-1                          05750033
067700                               TO TRUE                            05760033
068400                                                                  05770033
068500         WHEN OTHER                                               05780033
068600             SET DP013-NO-ROLLBACK                                05790033
068700                 DP013-XCTL-DISPLAY-RESTART                       05800033
068800                 DP013-CICS-ABEND  TO TRUE                        05810033
068900             MOVE '2100-CHECK-FUNCTION-KEY'                       05820033
069000                                   TO DP013-PARAGRAPH             05830033
069100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05840033
069200                                   TO DP013-MESSAGE-TEXT (1)      05850033
069300             PERFORM DP013-0000-PROCESS-ABEND                     05860033
069400     END-EVALUATE.                                                05870033
069500*                                                                 05880033
069600*----------------------------------------------------------------*05890033
069700*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *05900033
069800*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,       05910033
069900*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *05920033
070000*    MESSAGE.                                                     05930033
070100*----------------------------------------------------------------*05940033
070200                                                                  05950033
070300 2110-BROWSE-BACKWARD.                                            05960033
070400     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    05970033
070500         GIVING PV-TOP-ITEM.                                      05980033
070600*                                                                 05990033
070700     IF  ((PV-TOP-ITEM < +1)                                      06000033
070800       OR (PV-TOP-ITEM = +1))                                     06010033
070900         MOVE +1                   TO PV-TOP-ITEM                 06020033
071000*        -- TOP OF LIST --                                        06030033
071100         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            06040033
071200         SET DP020-MSG-INFORMATIONAL TO TRUE                      06050033
071300     END-IF.                                                      06060033
071400                                                                  06070033
071500 EJECT                                                            06080033
071600*----------------------------------------------------------------*06090033
071700*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP       06100033
071800*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO    06110033
071900*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.              06120033
072000*----------------------------------------------------------------*06130033
072100                                                                  06140033
072200 2120-BROWSE-FORWARD.                                             06150033
072300                                                                  06160033
072400     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              06170033
072500         GIVING PV-TOP-ITEM.                                      06180033
072600     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   06190033
072700         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            06200033
072800                                   TO PV-TOP-ITEM                 06210033
072900*        -- BOTTOM OF LIST --                                     06220033
073000         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            06230033
073100         SET DP020-MSG-INFORMATIONAL                              06240033
073200                                   TO TRUE                        06250033
073300     ELSE                                                         06260033
073400         COMPUTE PV-BOTTOM-ITEM =                                 06270033
073500             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 06280033
073600         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            06290033
073700*            -- BOTTOM OF LIST --                                 06300033
073800             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            06310033
073900             SET DP020-MSG-INFORMATIONAL                          06320033
074000                                   TO TRUE                        06330033
074100         END-IF                                                   06340033
074200     END-IF.                                                      06350033
074300 EJECT                                                            06360033
074400*----------------------------------------------------------------*06370033
074500*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *06380033
074600*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *06390033
074700*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *06400033
074800*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.          06410033
074900*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *06420033
075000*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.           06430033
075100*----------------------------------------------------------------*06440033
075200                                                                  06450033
075300 2130-CHECK-FOR-JUMP-BROWSE.                                      06460033
075400     SET PS-NO-ERROR               TO TRUE.                       06470033
075500     IF (ASC-START-ITEM-REQUEST = SPACE)                          06480033
075600         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            06490033
075700                                   TO PV-TOP-ITEM                 06500033
075800     ELSE                                                         06510033
075900         MOVE ASC-START-ITEM-REQUEST                              06520033
076000                                   TO DP010I-UNEDITED-FIELD       06530033
076100         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       06540033
076200         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     06550033
076300         SET DP010I-NEGATIVE-NOT-ALLOWED                          06560033
076400                                   TO TRUE                        06570033
263968         CALL DP010I-NUMERIC-EDIT-ROUTINE                         06581035
263968              USING DP010I-NUMERIC-EDIT-AREA                      06582035
076600                                                                  06590033
076700         IF  NOT DP010I-ERROR-DETECTED                            06600033
076800             MOVE DP010I-NUMERIC-FIELD                            06610033
076900                                   TO  ASC-START-ITEM-REQUEST-N   06620033
077000             IF  ASC-START-ITEM-REQUEST-N > ZERO                  06630033
077100                 IF  ASC-START-ITEM-REQUEST-N >                   06640033
077200                                          ASC-NUMBER-OF-ITEMS-READ06650033
077300                     MOVE SPACE TO ASC-START-ITEM-REQUEST         06660033
077400                     COMPUTE PV-TOP-ITEM =                        06670033
077500                             ASC-NUMBER-OF-ITEMS-READ             06680033
077600                             - PC-ITEMS-PER-PANEL + 1             06690033
077700                     IF  PV-TOP-ITEM < +1                         06700033
077800                         MOVE +1   TO PV-TOP-ITEM                 06710033
077900                         MOVE PC-TSYMSG-00070                     06720033
078000                                   TO DP020-MSG-NUMBER            06730033
078100                         SET DP020-MSG-INFORMATIONAL              06740033
078200                                   TO TRUE                        06750033
078300                     END-IF                                       06760033
078400                 ELSE                                             06770033
078500                     MOVE ASC-START-ITEM-REQUEST-N                06780033
078600                                   TO PV-TOP-ITEM                 06790033
078700                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      06800033
078800                     COMPUTE PV-BOTTOM-ITEM =                     06810033
078900                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     06820033
079000                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ06830033
079100*                        -- BOTTOM OF LIST --                     06840033
079200                         MOVE PC-TSYMSG-00070                     06850033
079300                                   TO DP020-MSG-NUMBER            06860033
079400                         SET DP020-MSG-INFORMATIONAL              06870033
079500                                   TO TRUE                        06880033
079600                     END-IF                                       06890033
079700                 END-IF                                           06900033
079800             ELSE                                                 06910033
079900*                --- VALUE OUT OF RANGE ----                      06920033
080000                 MOVE PC-TSYMSG-00101                             06930033
080100                                   TO DP020-MSG-NUMBER            06940033
080200                 MOVE -1           TO ASTRTITL                    06950033
080300                 SET DP030-SET-CURSOR-APPL-1                      06960033
080400                                   TO TRUE                        06970033
080500                 MOVE DP015-REVERSE                               06980033
080600                                   TO ASTRTITH                    06990033
080700                 MOVE DP015-RED    TO ASTRTITC                    07000033
080800                 MOVE DP015-UNP-NUM-BRT-MDT                       07010033
080900                                   TO ASTRTITA                    07020033
081000                 SET DP020-MSG-FATAL                              07030033
081100                                   TO TRUE                        07040033
081200                 SET PS-ERROR      TO TRUE                        07050033
081300             END-IF                                               07060033
081400                                                                  07070033
081500         ELSE                                                     07080033
081600             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07090033
081700             MOVE -1               TO ASTRTITL                    07100033
081800             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07110033
081900             MOVE DP015-REVERSE    TO ASTRTITH                    07120033
082000             MOVE DP015-RED        TO ASTRTITC                    07130033
082100             MOVE DP015-UNP-NUM-BRT-MDT                           07140033
082200                                   TO ASTRTITA                    07150033
082300             SET DP020-MSG-FATAL   TO TRUE                        07160033
082400             SET PS-ERROR          TO TRUE                        07170033
082500         END-IF                                                   07180033
082600     END-IF.                                                      07190033
082700 EJECT                                                            07200033
082800*----------------------------------------------------------------*07210033
082900*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION       07220033
083000*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.          07230033
083100*----------------------------------------------------------------*07240033
083200 2140-DESELECT-ALL-ITEMS.                                         07250033
083300     MOVE +1                       TO ASC-BLK-SUB.                07260033
083400                                                                  07270033
083500     PERFORM 2141-CLEAR-SELECTED-INDS                             07280033
083600         VARYING ASC-ITEM-SUB                                     07290033
083700         FROM 1 BY 1                                              07300033
083800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 07310033
083900                                                                  07320033
084000     ADD +1                        TO ASC-BLK-SUB.                07330033
084100                                                                  07340033
084200     PERFORM 2141-CLEAR-SELECTED-INDS                             07350033
084300         VARYING ASC-ITEM-SUB                                     07360033
084400         FROM 1 BY 1                                              07370033
084500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 07380033
084600                                                                  07390033
084700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               07400033
084800                                   TO PV-LIST-ITEM-NUMBER.        07410033
084900                                                                  07420033
085000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            07430033
085100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    07440033
085200                                                                  07450033
085300     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     07460033
085400        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      07470033
085500         MOVE +1                   TO ASC-BLK-SUB                 07480033
085600                                                                  07490033
085700         PERFORM 5100-WRITE-TEMP-STORAGE                          07500033
085800                                                                  07510033
085900         MOVE +1                   TO PV-BLOCK-NUMBER             07520033
086000                                                                  07530033
086100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         07540033
086200             PV-FIRST-BLOCK-IN-ARRAY - 1                          07550033
086300                                                                  07560033
086400         PERFORM                                                  07570033
086500             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       07580033
086600                                                                  07590033
086700             PERFORM 4410-READ-TEMP-STORAGE                       07600033
086800                                                                  07610033
086900             PERFORM 2141-CLEAR-SELECTED-INDS                     07620033
087000                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 07630033
087100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          07640033
087200                                                                  07650033
087300             PERFORM 5100-WRITE-TEMP-STORAGE                      07660033
087400                                                                  07670033
087500             ADD +1                TO PV-BLOCK-NUMBER             07680033
087600                                                                  07690033
087700         END-PERFORM                                              07700033
087800                                                                  07710033
087900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         07720033
088000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     07730033
088100                                                                  07740033
088200         PERFORM                                                  07750033
088300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       07760033
088400                   ASC-HIGHEST-BLOCK-WRITTEN                      07770033
088500                                                                  07780033
088600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          07790033
088700                                   TO PV-BLOCK-NUMBER             07800033
088800                                                                  07810033
088900             PERFORM 4410-READ-TEMP-STORAGE                       07820033
089000                                                                  07830033
089100             PERFORM 2141-CLEAR-SELECTED-INDS                     07840033
089200                 VARYING ASC-ITEM-SUB                             07850033
089300                 FROM 1 BY 1                                      07860033
089400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          07870033
089500                                                                  07880033
089600             PERFORM 5100-WRITE-TEMP-STORAGE                      07890033
089700                                                                  07900033
089800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      07910033
089900                                                                  07920033
090000         END-PERFORM                                              07930033
090100                                                                  07940033
090200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             07950033
090300                                   TO PV-BLOCK-NUMBER             07960033
090400                                                                  07970033
090500         PERFORM 4410-READ-TEMP-STORAGE                           07980033
090600     END-IF.                                                      07990033
090700                                                                  08000033
090800                                                                  08010033
090900     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 08020033
091000     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.08030033
091100     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  08040033
091200                                                                  08050033
091300     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        08060033
091400                                                                  08070033
091500 EJECT                                                            08080033
091600*----------------------------------------------------------------*08090033
091700*    MARK EACH ITEM AS BEING NOT SELECTED.                        08100033
091800*----------------------------------------------------------------*08110033
091900                                                                  08120033
092000 2141-CLEAR-SELECTED-INDS.                                        08130033
092100                                                                  08140033
092200     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           08150033
092300             NOT EQUAL ZERO                                       08160033
092400         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          08170033
092500             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          08180033
092600                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    08190033
092700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  08200033
092800                                   TO TRUE                        08210033
092900         END-IF                                                   08220033
093000     END-IF.                                                      08230033
093100                                                                  08240033
093200 EJECT                                                            08250033
093300*----------------------------------------------------------------*08260033
093400*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *08270033
093500*  FOR ALL ITEMS.                                                 08280033
093600*----------------------------------------------------------------*08290033
093700                                                                  08300033
093800 2150-SELECT-ALL-ITEMS.                                           08310033
093900                                                                  08320033
094000     MOVE +1                       TO ASC-BLK-SUB.                08330033
094100                                                                  08340033
094200     PERFORM 2151-SET-SELECTED-INDS                               08350033
094300         VARYING ASC-ITEM-SUB                                     08360033
094400         FROM 1 BY 1                                              08370033
094500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08380033
094600                                                                  08390033
094700     ADD +1                        TO ASC-BLK-SUB.                08400033
094800                                                                  08410033
094900     PERFORM 2151-SET-SELECTED-INDS                               08420033
095000         VARYING ASC-ITEM-SUB                                     08430033
095100         FROM 1 BY 1                                              08440033
095200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08450033
095300                                                                  08460033
095400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               08470033
095500                                   TO PV-LIST-ITEM-NUMBER.        08480033
095600                                                                  08490033
095700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            08500033
095800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    08510033
095900                                                                  08520033
096000     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     08530033
096100        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    08540033
096200         MOVE +1                   TO ASC-BLK-SUB                 08550033
096300                                                                  08560033
096400         PERFORM 5100-WRITE-TEMP-STORAGE                          08570033
096500                                                                  08580033
096600         MOVE +1                   TO PV-BLOCK-NUMBER             08590033
096700                                                                  08600033
096800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         08610033
096900             PV-FIRST-BLOCK-IN-ARRAY - 1                          08620033
097000                                                                  08630033
097100         PERFORM                                                  08640033
097200             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       08650033
097300                                                                  08660033
097400             PERFORM 4410-READ-TEMP-STORAGE                       08670033
097500                                                                  08680033
097600             PERFORM 2151-SET-SELECTED-INDS                       08690033
097700                 VARYING ASC-ITEM-SUB                             08700033
097800                 FROM 1 BY 1                                      08710033
097900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08720033
098000                                                                  08730033
098100             PERFORM 5100-WRITE-TEMP-STORAGE                      08740033
098200                                                                  08750033
098300             ADD +1                TO PV-BLOCK-NUMBER             08760033
098400                                                                  08770033
098500         END-PERFORM                                              08780033
098600                                                                  08790033
098700         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         08800033
098800             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     08810033
098900                                                                  08820033
099000         PERFORM                                                  08830033
099100             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       08840033
099200                   ASC-HIGHEST-BLOCK-WRITTEN                      08850033
099300                                                                  08860033
099400             MOVE PV-NEXT-BLOCK-IN-ARRAY                          08870033
099500                                   TO PV-BLOCK-NUMBER             08880033
099600                                                                  08890033
099700             PERFORM 4410-READ-TEMP-STORAGE                       08900033
099800                                                                  08910033
099900             PERFORM 2151-SET-SELECTED-INDS                       08920033
100000                 VARYING ASC-ITEM-SUB                             08930033
100100                 FROM 1 BY 1                                      08940033
100200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08950033
100300                                                                  08960033
100400             PERFORM 5100-WRITE-TEMP-STORAGE                      08970033
100500                                                                  08980033
100600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      08990033
100700                                                                  09000033
100800         END-PERFORM                                              09010033
100900                                                                  09020033
101000         MOVE PV-FIRST-BLOCK-IN-ARRAY                             09030033
101100                                   TO PV-BLOCK-NUMBER             09040033
101200                                                                  09050033
101300         PERFORM 4410-READ-TEMP-STORAGE                           09060033
101400     END-IF.                                                      09070033
101500                                                                  09080033
101600                                                                  09090033
101700     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             09100033
101800                       ASC-NUMBER-OF-SELECTED-ITEMS.              09110033
101900                                                                  09120033
102000     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09130033
102100                                                                  09140033
102200 EJECT                                                            09150033
102300*----------------------------------------------------------------*09160033
102400*    MARK EACH ITEM AS BEING SELECTED.                            09170033
102500*----------------------------------------------------------------*09180033
102600                                                                  09190033
102700 2151-SET-SELECTED-INDS.                                          09200033
102800                                                                  09210033
102900     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           09220033
103000             NOT EQUAL ZERO                                       09230033
103100         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             09240033
103200             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             09250033
103300                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        09260033
103400                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  09270033
103500                               TO  TRUE                           09280033
103600         END-IF                                                   09290033
103700     END-IF.                                                      09300033
103800******************************************************************09310033
103900** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **09320033
104000** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **09330033
104100******************************************************************09340033
104200 2200-MOVE-SCREEN-TO-COMMAREA.                                    09350033
104300                                                                  09360033
104400     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             09370033
104500     MOVE +1                       TO PV-SUB.                     09380033
104600*                                                                 09390033
104700     PERFORM 3100-SET-SUBSCRIPTS.                                 09400033
104800     IF  ASTRTITL > ZERO                                          09410033
104900         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          09420033
105000     ELSE                                                         09430033
105100         IF  ASTRTITF = DP015-ERASE-EOF                           09440033
105200             INITIALIZE ASC-START-ITEM-REQUEST                    09450033
105300         END-IF                                                   09460033
105400     END-IF.                                                      09470033
105500     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          09480033
105600         VARYING PV-SUB                                           09490033
105700         FROM 1 BY 1                                              09500033
105800         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      09510033
105900******************************************************************09520033
106000** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**09530033
106100******************************************************************09540033
106200 2210-MOVE-LINES-TO-COMMAREA.                                     09550033
106300     IF  MR-SELECTL (PV-SUB) > ZERO                               09560033
106400         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             09570033
106500         MOVE MR-SELECTI (PV-SUB)                                 09580033
106600                                   TO ASC-TEMP-SELECTED-SW        09590033
106700                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      09600033
106800     ELSE                                                         09610033
106900         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                09620033
107000                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     09630033
107100                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        09640033
107200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      09650033
107300         END-IF                                                   09660033
107400     END-IF.                                                      09670033
107500     ADD +1                        TO ASC-ITEM-SUB.               09680033
107600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        09690033
107700         ADD +1                    TO ASC-BLK-SUB                 09700033
107800         MOVE +1                   TO ASC-ITEM-SUB                09710033
107900     END-IF.                                                      09720033
108000******************************************************************09730033
108100** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE        09740033
108200** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **09750033
108300******************************************************************09760033
108400 3000-EDIT-DATA-IN-COMMAREA.                                      09770033
108500     SET PS-NO-ERROR               TO TRUE.                       09780033
108600     PERFORM 3200-RESET-ATTRIBUTES.                               09790033
108700     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     09800033
108800**                                                                09810033
108900* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              09820033
109000* EDITTING IS DONE FROM THE BOTTOM UP.                            09830033
109100**                                                                09840033
109200     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       09850033
109300         ASC-ITEMS-DISPLAYED - 1.                                 09860033
109400     PERFORM 3100-SET-SUBSCRIPTS.                                 09870033
109500     PERFORM 3300-EDIT-SELECTIONS                                 09880033
109600         VARYING PV-SUB                                           09890033
109700         FROM PV-SUB BY -1                                        09900033
109800         UNTIL PV-SUB < +1                                        09910033
109900*                                                                 09920033
110000     IF  PS-NO-ERROR                                              09930033
110100         PERFORM 3400-CHECK-RANGE-SEQUENCE                        09940033
110200     END-IF.                                                      09950033
110300*                                                                 09960033
110400     IF  ((PS-NO-ERROR)                                           09970033
110500       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   09980033
110600       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    09990033
110700             PERFORM 3500-MARK-RANGE-AS-SELECTED                  10000033
110800     END-IF.                                                      10010033
110900 EJECT                                                            10020033
111000*----------------------------------------------------------------*10030033
111100*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM  10040033
111200*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*10050033
111300*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                   10060033
111400*                                                                 10070033
111500*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *10080033
111600*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *10090033
111700*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *10100033
111800*    US IN THE 2ND BLOCK OF THE ARRAY.                            10110033
111900*----------------------------------------------------------------*10120033
112000                                                                  10130033
112100 3100-SET-SUBSCRIPTS.                                             10140033
112200                                                                  10150033
112300     COMPUTE ASC-ITEM-SUB =                                       10160033
112400         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        10170033
112500                                                                  10180033
112600     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         10190033
112700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            10200033
112800                                                                  10210033
112900         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               10220033
113000     ELSE                                                         10230033
113100         MOVE +1                     TO ASC-BLK-SUB               10240033
113200     END-IF.                                                      10250033
113300******************************************************************10260033
113400** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     * 10270033
113500******************************************************************10280033
113600                                                                  10290033
113700 3200-RESET-ATTRIBUTES.                                           10300033
113800     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   10310033
113900     MOVE DP015-GREEN              TO ASTRTITC.                   10320033
114000     MOVE DP015-UNDERLINE          TO ASTRTITH.                   10330033
114100*                                                                 10340033
114200     PERFORM                                                      10350033
114300         VARYING PV-SUB                                           10360033
114400         FROM 1 BY 1                                              10370033
114500         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        10380033
114600         MOVE DP015-UNP-ALP-NOR-OFF                               10390033
114700                                   TO MR-SELECTA (PV-SUB)         10400033
114800         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         10410033
114900         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         10420033
115000     END-PERFORM.                                                 10430033
115100******************************************************************10440033
115200** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **10450033
115300** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **10460033
115400** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **10470033
115500** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.               10480033
115600******************************************************************10490033
115700 3300-EDIT-SELECTIONS.                                            10500033
115800     EVALUATE TRUE                                                10510033
115900         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     10520033
116000             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         10530033
116100                 CONTINUE                                         10540033
116200         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         10550033
116300             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        10560033
116400                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   10570033
116500                 MOVE ASC-TEMP-SELECTED-SW                        10580033
116600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10590033
116700                                TO ASC-SELECTED-SW                10600033
116800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10610033
116900             END-IF                                               10620033
117000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     10630033
117100                 = SPACE                                          10640033
117200             EVALUATE TRUE                                        10650033
117300                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       10660033
117400                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS10670033
117500                     MOVE SPACE TO ASC-SELECTED-SW                10680033
117600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10690033
117700                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        10700033
117800                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    10710033
117900                     MOVE SPACE TO ASC-SELECTED-SW                10720033
118000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10730033
118100                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          10740033
118200                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      10750033
118300                     MOVE SPACE TO ASC-SELECTED-SW                10760033
118400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10770033
118500             END-EVALUATE                                         10780033
118600         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           10790033
118700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            10800033
118800                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    10810033
118900             END-IF                                               10820033
119000             PERFORM 3310-EDIT-RANGE                              10830033
119100         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             10840033
119200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            10850033
119300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    10860033
119400             END-IF                                               10870033
119500             PERFORM 3310-EDIT-RANGE                              10880033
119600         WHEN OTHER                                               10890033
119700             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           10900033
119800             SET DP020-MSG-FATAL    TO TRUE                       10910033
119900             MOVE -1                TO MR-SELECTL (PV-SUB)        10920033
120000             SET DP030-SET-CURSOR-APPL-1                          10930033
120100                                    TO TRUE                       10940033
120200             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        10950033
120300             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        10960033
120400             SET PS-ERROR TO TRUE                                 10970033
120500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            10980033
120600                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     10990033
120700                 MOVE SPACE         TO ASC-SELECTED-SW            11000033
120800                                        (ASC-BLK-SUB ASC-ITEM-SUB)11010033
120900             END-IF                                               11020033
121000     END-EVALUATE.                                                11030033
121100                                                                  11040033
121200     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 11050033
121300     SUBTRACT +1 FROM ASC-ITEM-SUB.                               11060033
121400     IF  ASC-ITEM-SUB < 1                                         11070033
121500         SUBTRACT +1 FROM ASC-BLK-SUB                             11080033
121600         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                11090033
121700     END-IF.                                                      11100033
121800******************************************************************11110033
121900** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A        11120033
122000** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **11130033
122100** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**11140033
122200** THE ENDING.                                                    11150033
122300******************************************************************11160033
122400 3310-EDIT-RANGE.                                                 11170033
122500     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                11180033
177400         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   11190033
122700             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)11200033
122800                                   TO ASC-SELECTED-SW             11210033
122900                                        (ASC-BLK-SUB ASC-ITEM-SUB)11220033
123000             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 11230033
123100         ELSE                                                     11240033
123200             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     11250033
123300                 CONTINUE                                         11260033
123400             ELSE                                                 11270033
123500*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        11280033
123600                 MOVE PC-TSYMSG-00054                             11290033
123700                                   TO DP020-MSG-NUMBER            11300033
123800                 SET DP020-MSG-FATAL                              11310033
123900                                   TO TRUE                        11320033
124000                 MOVE -1           TO MR-SELECTL (PV-SUB)         11330033
124100                 SET DP030-SET-CURSOR-APPL-1                      11340033
124200                                   TO TRUE                        11350033
124300                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         11360033
124400                 MOVE DP015-UNDERLINE                             11370033
124500                                   TO MR-SELECTH (PV-SUB)         11380033
124600                 SET PS-ERROR      TO TRUE                        11390033
124700             END-IF                                               11400033
124800         END-IF                                                   11410033
124900     ELSE                                                         11420033
125000         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     11430033
125100             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 11440033
125200                                   TO ASC-SELECTED-SW             11450033
125300                                     (ASC-BLK-SUB ASC-ITEM-SUB)   11460033
125400             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   11470033
125500         ELSE                                                     11480033
125600             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       11490033
125700                 CONTINUE                                         11500033
125800             ELSE                                                 11510033
125900*                -- ONLY ONE END-OF-RANGE ALLOWED --              11520033
126000                 MOVE PC-TSYMSG-00055                             11530033
126100                                   TO DP020-MSG-NUMBER            11540033
126200                 SET DP020-MSG-FATAL                              11550033
126300                                   TO TRUE                        11560033
126400                 MOVE -1           TO MR-SELECTL (PV-SUB)         11570033
126500                 SET DP030-SET-CURSOR-APPL-1                      11580033
126600                                   TO TRUE                        11590033
126700                 SET PS-ERROR      TO TRUE                        11600033
126800             END-IF                                               11610033
126900         END-IF                                                   11620033
127000     END-IF.                                                      11630033
127100*                                                                 11640033
127200******************************************************************11650033
127300** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **11660033
127400** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **11670033
127500******************************************************************11680033
127600 3400-CHECK-RANGE-SEQUENCE.                                       11690033
127700     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       11700033
127800       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      11710033
127900       AND  ASC-START-OF-SELECTED-RANGE >                         11720033
128000                                         ASC-END-OF-SELECTED-RANGE11730033
128100*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                11740033
128200         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 11750033
128300         SET DP020-MSG-FATAL TO TRUE                              11760033
128400         SET PS-ERROR TO TRUE                                     11770033
128500         PERFORM 3410-POSITION-AT-ERROR                           11780033
128600     END-IF.                                                      11790033
128700******************************************************************11800033
128800** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **11810033
128900** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **11820033
129000** SHOULD BE POSITIONED ON A RANGE ERROR.                         11830033
129100******************************************************************11840033
129200 3410-POSITION-AT-ERROR.                                          11850033
129300     SET DP030-SET-CURSOR-APPL-1                                  11860033
129400                                   TO TRUE.                       11870033
129500     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 11880033
129600                    - PV-TOP-ITEM + 1.                            11890033
129700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      11900033
129800         CONTINUE                                                 11910033
129900     ELSE                                                         11920033
130000         MOVE -1                   TO MR-SELECTL (PV-SUB)         11930033
130100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         11940033
130200         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         11950033
130300     END-IF.                                                      11960033
130400*                                                                 11970033
130500     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   11980033
130600                    - PV-TOP-ITEM + 1.                            11990033
130700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      12000033
130800         CONTINUE                                                 12010033
130900     ELSE                                                         12020033
131000         MOVE -1                   TO MR-SELECTL (PV-SUB)         12030033
131100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         12040033
131200         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         12050033
131300     END-IF.                                                      12060033
131400 EJECT                                                            12070033
131500*----------------------------------------------------------------*12080033
131600*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *12090033
131700*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *12100033
131800*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.              12110033
131900*----------------------------------------------------------------*12120033
132000                                                                  12130033
132100 3500-MARK-RANGE-AS-SELECTED.                                     12140033
132200     MOVE +1                       TO  ASC-BLK-SUB.               12150033
132300     PERFORM 3510-MARK-SELECTED-INDS                              12160033
132400         VARYING ASC-ITEM-SUB                                     12170033
132500         FROM 1 BY 1                                              12180033
132600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12190033
132700                                                                  12200033
132800     ADD +1                        TO ASC-BLK-SUB.                12210033
132900     PERFORM 3510-MARK-SELECTED-INDS                              12220033
133000         VARYING ASC-ITEM-SUB                                     12230033
133100         FROM 1 BY 1                                              12240033
133200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12250033
133300                                                                  12260033
133400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               12270033
133500                                   TO  PV-LIST-ITEM-NUMBER.       12280033
133600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            12290033
133700         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         12300033
133800               PC-ITEMS-PER-PANEL).                               12310033
133900                                                                  12320033
134000     MOVE ASC-START-OF-SELECTED-RANGE                             12330033
134100                                   TO PV-START-OF-SELECTED-RANGE. 12340033
134200     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            12350033
134300         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  12360033
134400               PC-ITEMS-PER-PANEL).                               12370033
134500                                                                  12380033
134600     MOVE ASC-END-OF-SELECTED-RANGE                               12390033
134700                                   TO  PV-END-OF-SELECTED-RANGE.  12400033
134800     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             12410033
134900         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    12420033
135000               PC-ITEMS-PER-PANEL).                               12430033
135100     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             12440033
135200         PV-FIRST-BLOCK-IN-ARRAY + 1.                             12450033
135300                                                                  12460033
135400     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    12470033
135500        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        12480033
135600         MOVE +1                   TO ASC-BLK-SUB                 12490033
135700         PERFORM 5100-WRITE-TEMP-STORAGE                          12500033
135800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         12510033
135900             PV-FIRST-BLOCK-IN-ARRAY - 1                          12520033
136000                                                                  12530033
136100         PERFORM                                                  12540033
136200             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      12550033
136300                   PV-PREV-BLOCK-IN-ARRAY                         12560033
136400             MOVE PV-FIRST-BLOCK-IN-RANGE                         12570033
136500                                   TO PV-BLOCK-NUMBER             12580033
136600             PERFORM 4410-READ-TEMP-STORAGE                       12590033
136700             PERFORM 3510-MARK-SELECTED-INDS                      12600033
136800                 VARYING ASC-ITEM-SUB                             12610033
136900                 FROM 1 BY 1                                      12620033
137000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12630033
137100             PERFORM 5100-WRITE-TEMP-STORAGE                      12640033
137200             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     12650033
137300         END-PERFORM                                              12660033
137400                                                                  12670033
137500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         12680033
137600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     12690033
137700         PERFORM                                                  12700033
137800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       12710033
137900                   PV-LAST-BLOCK-IN-RANGE                         12720033
138000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          12730033
138100                                   TO PV-BLOCK-NUMBER             12740033
138200             PERFORM 4410-READ-TEMP-STORAGE                       12750033
138300             PERFORM 3510-MARK-SELECTED-INDS                      12760033
138400                 VARYING ASC-ITEM-SUB                             12770033
138500                 FROM 1 BY 1                                      12780033
138600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12790033
138700             PERFORM 5100-WRITE-TEMP-STORAGE                      12800033
138800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12810033
138900         END-PERFORM                                              12820033
139000                                                                  12830033
139100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             12840033
139200                                   TO PV-BLOCK-NUMBER             12850033
139300         PERFORM 4410-READ-TEMP-STORAGE                           12860033
139400     END-IF.                                                      12870033
139500                                                                  12880033
139600     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 12890033
139700                                      ASC-END-OF-SELECTED-RANGE.  12900033
139800                                                                  12910033
139900 EJECT                                                            12920033
140000*----------------------------------------------------------------*12930033
140100* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.            12940033
140200*----------------------------------------------------------------*12950033
140300                                                                  12960033
140400 3510-MARK-SELECTED-INDS.                                         12970033
140500                                                                  12980033
140600     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         12990033
140700                                ASC-ITEM-SUB) >                   13000033
140800         ASC-START-OF-SELECTED-RANGE)                             13010033
140900     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         13020033
141000                                ASC-ITEM-SUB) =                   13030033
141100         ASC-START-OF-SELECTED-RANGE)                             13040033
141200                                                                  13050033
141300         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     13060033
141400                                    ASC-ITEM-SUB) <               13070033
141500             ASC-END-OF-SELECTED-RANGE)                           13080033
141600         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     13090033
141700                                    ASC-ITEM-SUB) =               13100033
141800             ASC-END-OF-SELECTED-RANGE)                           13110033
141900                                                                  13120033
142000             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          13130033
142100                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   13140033
142200                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   13150033
142300                               TO TRUE                            13160033
142400                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              13170033
142500                               TO TRUE                            13180033
142600                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    13190033
142700             END-IF                                               13200033
142800         END-IF                                                   13210033
142900     END-IF.                                                      13220033
143000                                                                  13230033
143100 EJECT                                                            13240033
143200*----------------------------------------------------------------*13250033
143300*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                         13260033
143400*    INITIALIZE ALL COUNTERS AND FLAGS.                           13270033
143500*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *13280033
143600*    DISPLAY THE PANEL TO USER.                                   13290033
143700*----------------------------------------------------------------*13300033
143800                                                                  13310033
143900 4000-BUILD-INITIAL-PANEL.                                        13320033
144000                                                                  13330033
144100     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            13340033
144200                                 ASC-BLOCK-ENTRIES (2).           13350033
144300     MOVE +1                 TO ASC-BLK-SUB.                      13360033
144400     SET ASC-ITEMS-LEFT-ON-DB                                     13370033
144500                             TO TRUE.                             13380033
144600                                                                  13390033
144700     MOVE +0                 TO ASC-ITEM-SUB                      13400033
144800                                ASC-NUMBER-OF-ITEMS-READ          13410033
144900                                ASC-NUMBER-OF-SELECTED-ITEMS      13420033
145000                                ASC-HIGHEST-BLOCK-WRITTEN         13430033
145100                                ASC-START-OF-SELECTED-RANGE       13440033
145200                                ASC-END-OF-SELECTED-RANGE         13450033
145300                                ASC-ITEM-AT-TOP-OF-PANEL.         13460033
145400     PERFORM 4010-OPEN-CURSOR.                                    13470033
145500                                                                  13480033
145600     PERFORM 4300-READ-ITEMS-FROM-DB.                             13490033
145700                                                                  13500033
145800     PERFORM 4020-CLOSE-CURSOR.                                   13510033
145900                                                                  13520033
146000     MOVE +1                   TO  PV-TOP-ITEM.                   13530033
146100     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          13540033
146200         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    13550033
146300         SET DP020-MSG-FATAL   TO  TRUE                           13560033
146400         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               13570033
146500     ELSE                                                         13580033
146600*        MOVE -1               TO MR-SELECTL (1)                  13590033
146700         MOVE -1               TO ASTRTITL                        13600033
146800         SET DP030-SET-CURSOR-APPL-1                              13610033
146900                               TO TRUE                            13620033
147000         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     13630033
147100     END-IF.                                                      13640033
147200 EJECT                                                            13650033
147300*----------------------------------------------------------------*13660033
147400* OPEN CURSOR                                                     13670033
147500*----------------------------------------------------------------*13680033
147700 4010-OPEN-CURSOR.                                                13690033
148400                                                                  13700033
148410     PERFORM                                                      13710033
148420         WITH TEST AFTER                                          13720033
148430         VARYING PV-RETRY-COUNTER                                 13730033
148440         FROM 1 BY 1                                              13740033
148450         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13750033
148460                   OR (SQLCODE = ZERO))                           13760033
148470                                                                  13770033
148500                 EXEC SQL                                         13780033
148600                      OPEN DIRV_RSN_CSR                           13790033
148700                 END-EXEC                                         13800033
148800                                                                  13810033
148900         EVALUATE TRUE                                            13820033
149000             WHEN SQLCODE = ZERO                                  13830033
149300                 CONTINUE                                         13840033
149400             WHEN SQLWARN0 NOT = SPACES                           13850033
149500             WHEN SQLCODE < ZERO                                  13860033
149600             WHEN SQLCODE > ZERO                                  13870033
149700                 MOVE '4010-OPEN-CURSOR'                          13880033
149800                                   TO DP013-PARAGRAPH             13890033
149900                 MOVE 'OPEN DOOR TYPE CURSOR - '                  13900033
150000                                   TO DP013-MESSAGE-TEXT (1)      13910033
150100                 MOVE SQLCA        TO DP013-SQLCA                 13920033
150200                 MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)    13930033
150300                 SET DP013-DB2-ABEND                              13940033
150400                     DP013-XCTL-DISPLAY-RESTART TO TRUE           13950033
150500                 PERFORM DP013-0000-PROCESS-ABEND                 13960033
150600         END-EVALUATE                                             13970033
150700     END-PERFORM.                                                 13980033
150800                                                                  13990033
150900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        14000033
151000         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             14010033
151100         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   14020033
151200                                   TO DP013-MESSAGE-TEXT (1)      14030033
151300         MOVE SQLCA                TO DP013-SQLCA                 14040033
151400         MOVE 'TSYMSG  '           TO DP013-DB2-TABLE-NAME (1)    14050033
151500         SET DP013-DB2-ABEND                                      14060033
151600             DP013-XCTL-DISPLAY-RESTART                           14070033
151700                                   TO TRUE                        14080033
151800         PERFORM DP013-0000-PROCESS-ABEND                         14090033
151900     END-IF.                                                      14100033
152000                                                                  14110033
152100 EJECT                                                            14120033
152200*----------------------------------------------------------------*14130033
152300* CLOSE THE DOOR TYPE CURSOR.                                     14140033
152400*----------------------------------------------------------------*14150033
152600 4020-CLOSE-CURSOR.                                               14160033
152700                                                                  14170033
152800             EXEC SQL                                             14180033
152900                 CLOSE DIRV_RSN_CSR                               14190033
153000             END-EXEC                                             14200033
153100                                                                  14210033
153200     EVALUATE TRUE                                                14220033
153300         WHEN SQLCODE = ZERO                                      14230033
153400             CONTINUE                                             14240033
153500         WHEN SQLWARN0 NOT = SPACES                               14250033
153600         WHEN SQLCODE < ZERO                                      14260033
153700         WHEN SQLCODE > ZERO                                      14270033
153800             MOVE '4020-CLOSE-CURSOR'                             14280033
153900                               TO DP013-PARAGRAPH                 14290033
154000             MOVE 'CLOSE DOOR TYPE CURSOR '                       14300033
154100                               TO DP013-MESSAGE-TEXT (1)          14310033
154200             MOVE SQLCA        TO DP013-SQLCA                     14320033
154300             MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)        14330033
154400             SET DP013-DB2-ABEND                                  14340033
154500                 DP013-XCTL-DISPLAY-RESTART TO TRUE               14350033
154600             PERFORM DP013-0000-PROCESS-ABEND                     14360033
154700     END-EVALUATE.                                                14370033
154800                                                                  14380033
154900 EJECT                                                            14390033
155000*----------------------------------------------------------------*14400033
155100*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *14410033
155200*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *14420033
155300*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND   14430033
155400*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *14440033
155500*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                    14450033
155600*                                                                 14460033
155700*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *14470033
155800*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *14480033
155900*    UPON INITIALIZATION.                                         14490033
156000*----------------------------------------------------------------*14500033
156200 4300-READ-ITEMS-FROM-DB.                                         14510033
156300                                                                  14520033
156400     PERFORM                                                      14530033
156500         VARYING PV-READ-COUNT                                    14540033
156600         FROM 1 BY 1                                              14550033
156700         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    14560033
156800            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         14570033
156900                                                                  14580033
157000         PERFORM 4310-FETCH                                       14590033
157100                                                                  14600033
157200         IF  ASC-ITEMS-LEFT-ON-DB                                 14610033
157300             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                14620033
157400                 ADD +1            TO ASC-ITEM-SUB                14630033
157500             ELSE                                                 14640033
157600                 ADD +1            TO ASC-BLK-SUB                 14650033
157700                 MOVE +1           TO ASC-ITEM-SUB                14660033
157800                                                                  14670033
157900                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         14680033
158000                     MOVE +1       TO ASC-BLK-SUB                 14690033
158100                     SET ASC-BLOCK-MODIFIED (1)                   14700033
158200                                   TO TRUE                        14710033
158300                     PERFORM 5100-WRITE-TEMP-STORAGE              14720033
158400                     MOVE ASC-BLOCK-ENTRIES                       14730033
158500                               (PC-MAX-BLOCKS-IN-ARRAY)           14740033
158600                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 14750033
158700                     ADD +1        TO ASC-BLK-SUB                 14760033
158800                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   14770033
158900                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      14780033
159000                                   TO TRUE                        14790033
159100                 END-IF                                           14800033
159200             END-IF                                               14810033
159300             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    14820033
159400             MOVE ASC-NUMBER-OF-ITEMS-READ                        14830033
159500                                   TO ASC-LIST-ITEM-NUMBER        14840033
159600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14850033
159700             MOVE SUT00101-DIRV-RSN-CDE-DESC                      14860033
159800                                   TO ASC-DIRV-RSN-CDE-DESC       14870033
159900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14880033
160000             MOVE SUT00101-DIRV-RSN-CDE                           14890033
160100                                   TO ASC-DIRV-RSN-CDE            14900033
160200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14910033
160300         END-IF                                                   14920033
160400     END-PERFORM.                                                 14930033
160500                                                                  14940033
160600     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          14950033
160700         MOVE +1               TO ASC-BLK-SUB                     14960033
160800         PERFORM 5100-WRITE-TEMP-STORAGE                          14970033
160900         ADD +1                TO ASC-BLK-SUB                     14980033
161000         PERFORM 5100-WRITE-TEMP-STORAGE                          14990033
161100                                                                  15000033
161200         MOVE 1                TO ASC-BLK-SUB                     15010033
161300                                  PV-BLOCK-NUMBER                 15020033
161400         PERFORM 4410-READ-TEMP-STORAGE                           15030033
161500         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             15040033
161600             MOVE 2            TO ASC-BLK-SUB                     15050033
161700                                  PV-BLOCK-NUMBER                 15060033
161800             PERFORM 4410-READ-TEMP-STORAGE                       15070033
161900         END-IF                                                   15080033
162000     END-IF.                                                      15090033
162100 EJECT                                                            15100033
162200*----------------------------------------------------------------*15110033
162300*    FETCH THE MESSAGE CURSOR.                                    15120033
162400*----------------------------------------------------------------*15130033
162500                                                                  15140033
162600 4310-FETCH.                                                      15150033
162700                                                                  15160033
162800        EXEC SQL                                                  15170033
162900             FETCH DIRV_RSN_CSR                                   15180033
163000              INTO :SUT00101-DIRV-RSN-CDE                         15190033
163100                  ,:SUT00101-DIRV-RSN-CDE-DESC                    15200033
163200        END-EXEC.                                                 15210033
163300                                                                  15220033
163400     EVALUATE TRUE                                                15230033
163500         WHEN SQLCODE = ZERO                                      15240033
163600         WHEN SQLCODE = +100                                      15250033
163700              CONTINUE                                            15260033
163800         WHEN SQLWARN0 NOT = SPACE                                15270033
163900         WHEN SQLCODE NOT = ZERO                                  15280033
164000              MOVE '4310-FETCH-CURSOR'                            15290033
164100                               TO DP013-PARAGRAPH                 15300033
164200              MOVE 'DOOR TYPE CURSOR'                             15310033
164300                               TO DP013-MESSAGE-TEXT (1)          15320033
164400              MOVE SQLCA       TO DP013-SQLCA                     15330033
164500              SET DP013-DB2-ABEND                                 15340033
164600                               TO TRUE                            15350033
164700              PERFORM DP013-0000-PROCESS-ABEND                    15360033
164800     END-EVALUATE.                                                15370033
164900                                                                  15380033
165000     IF  SQLCODE EQUAL +100                                       15390033
165100         SET ASC-NO-ITEMS-LEFT-ON-DB                              15400033
165200                                   TO TRUE                        15410033
165300     END-IF.                                                      15420033
165400                                                                  15430033
165500 EJECT                                                            15440033
165600*----------------------------------------------------------------*15450033
165700* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *15460033
165800*----------------------------------------------------------------*15470033
165900                                                                  15480033
166000 4400-MOVE-COMMAREA-TO-SCREEN.                                    15490033
166100     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             15500033
166200         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          15510033
166300         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          15520033
166400             MOVE +1    TO ASC-BLK-SUB                            15530033
166500             PERFORM 5100-WRITE-TEMP-STORAGE                      15540033
166600             ADD +1     TO ASC-BLK-SUB                            15550033
166700             PERFORM 5100-WRITE-TEMP-STORAGE                      15560033
166800             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             15570033
166900                 GIVING PV-BLOCK-NUMBER                           15580033
167000                 REMAINDER PV-REMAINDER                           15590033
167100             IF  PV-REMAINDER > ZERO                              15600033
167200                 ADD +1 TO PV-BLOCK-NUMBER                        15610033
167300             END-IF                                               15620033
167400             MOVE +1    TO ASC-BLK-SUB                            15630033
167500             PERFORM 4410-READ-TEMP-STORAGE                       15640033
167600             ADD +1     TO ASC-BLK-SUB                            15650033
167700                           PV-BLOCK-NUMBER                        15660033
167800             PERFORM 4410-READ-TEMP-STORAGE                       15670033
167900     END-IF.                                                      15680033
168000     MOVE +1            TO ASC-BLK-SUB.                           15690033
168100     COMPUTE ASC-ITEM-SUB =                                       15700033
168200         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              15710033
168300         + PC-ITEMS-PER-PANEL).                                   15720033
168400*                                                                 15730033
168500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        15740033
168600         ADD +1         TO ASC-BLK-SUB                            15750033
168700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            15760033
168800     END-IF.                                                      15770033
168900*                                                                 15780033
169000     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           15790033
169100         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                15800033
169200     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        15810033
169300     PERFORM 4420-FORMAT-LIST-LINES                               15820033
169400         VARYING PV-SUB                                           15830033
169500         FROM PC-ITEMS-PER-PANEL BY -1                            15840033
169600         UNTIL PV-SUB < +1.                                       15850033
169700*                                                                 15860033
169800     COMPUTE ASC-ITEMS-DISPLAYED =                                15870033
169900         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          15880033
170000     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    15890033
170100                                      ASTRTITO.                   15900033
170200     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    15910033
170300     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    15920033
170400*    MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            15930033
170500*                                  TO ASELITO.                    15940033
170600*                                                                 15950033
170700     IF  DP020-MSG-NUMBER-X = SPACE                               15960033
170800         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  15970033
170900*            --- MORE ITEMS TO DISPLAY ----                       15980033
171000             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            15990033
171100             SET DP020-MSG-INFORMATIONAL TO TRUE                  16000033
171200         END-IF                                                   16010033
171300     END-IF.                                                      16020033
171400*----------------------------------------------------------------*16030033
171500*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.          16040033
171600*----------------------------------------------------------------*16050033
171700                                                                  16060033
171800 4410-READ-TEMP-STORAGE.                                          16070033
171900                                                                  16080033
172000     EXEC CICS                                                    16090033
172100         READQ TS                                                 16100033
172200             QUEUE (ASC-LIST-QUEUE-NAME)                          16110033
172300             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               16120033
172400             ITEM  (PV-BLOCK-NUMBER)                              16130033
172500             RESP  (PV-CICS-RESP)                                 16140033
172600     END-EXEC.                                                    16150033
172700                                                                  16160033
172800     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       16170033
172900       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     16180033
173000         CONTINUE                                                 16190033
173100     ELSE                                                         16200033
173200         SET DP013-CICS-ABEND     TO TRUE                         16210033
173300         SET DP013-NO-ROLLBACK    TO TRUE                         16220033
173400         MOVE '4410-READ-TEMP-STORAGE'                            16230033
173500                                  TO DP013-PARAGRAPH              16240033
173600         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      16250033
173700                                  TO DP013-MESSAGE-TEXT(1)        16260033
173800         PERFORM DP013-0000-PROCESS-ABEND                         16270033
173900     END-IF.                                                      16280033
174000                                                                  16290033
174100     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             16300033
174200*                                                                 16310033
174300     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         16320033
174400         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               16330033
174500     END-IF.                                                      16340033
174600 EJECT                                                            16350033
174700*----------------------------------------------------------------*16360033
174800*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *16370033
174900*----------------------------------------------------------------*16380033
175000                                                                  16390033
175100 4420-FORMAT-LIST-LINES.                                          16400033
175200     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      16410033
175300         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                16420033
175400         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           16430033
175500         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           16440033
175600         MOVE SPACE              TO MR-SELECTI (PV-SUB)           16450033
175700         MOVE SPACE              TO MR-SELECTI (PV-SUB)           16460033
175800         MOVE SPACE              TO MR-ACTION (PV-SUB)            16470033
175900         MOVE SPACE              TO MR-DIRV-RSN-CDE-DESC (PV-SUB) 16480033
176000                                    MR-DIRV-RSN-CDE (PV-SUB)      16490033
176100     ELSE                                                         16500033
176200         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      16510033
176300                                                   > SPACE        16520033
176400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 16530033
176500                                 TO MR-SELECTI (PV-SUB)           16540033
176600         ELSE                                                     16550033
176700             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      16560033
176800                                 TO MR-SELECTI (PV-SUB)           16570033
176900         END-IF                                                   16580033
177000                                                                  16590033
177100         IF  DP030-SET-CURSOR-TRAILER                             16600033
177200             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)16610033
177300                 > SPACE)                                         16620033
177400               OR (PV-SUB = 1))                                   16630033
177500                SET DP030-SET-CURSOR-APPL-1 TO TRUE               16640033
177600                MOVE -1          TO MR-SELECTL (PV-SUB)           16650033
177700             END-IF                                               16660033
177800         END-IF                                                   16670033
177900                                                                  16680033
178000         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           16690033
178100*            MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           16700033
178200*                                TO MR-ACTION (PV-SUB)            16710033
178300           MOVE ASC-DIRV-RSN-CDE-DESC (ASC-BLK-SUB ASC-ITEM-SUB)  16720033
178400                                 TO MR-DIRV-RSN-CDE-DESC (PV-SUB) 16730033
178500           MOVE ASC-DIRV-RSN-CDE (ASC-BLK-SUB ASC-ITEM-SUB)       16740033
178600                                 TO MR-DIRV-RSN-CDE (PV-SUB)      16750033
178700         END-IF                                                   16760033
178800     END-IF.                                                      16770033
178900     SUBTRACT +1 FROM ASC-ITEM-SUB                                16780033
179000     IF  ASC-ITEM-SUB < + 1                                       16790033
179100         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  16800033
179200         MOVE +1                 TO ASC-BLK-SUB                   16810033
179300     END-IF.                                                      16820033
179400******************************************************************16830033
179500** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **16840033
179600** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,        16850033
179700** ISSUE A WARNING.                                               16860033
179800******************************************************************16870033
179900 4430-CHECK-FOR-BEGIN-AND-END.                                    16880033
180000     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       16890033
180100         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     16900033
180200*            -- NO END-OF-RANGE SPECFIED ---                      16910033
180300             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            16920033
180400             SET DP020-MSG-WARNING TO TRUE                        16930033
180500             PERFORM 4431-POSITION-AT-WARNING                     16940033
180600         END-IF                                                   16950033
180700     ELSE                                                         16960033
180800         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     16970033
180900*            -- NO BEGINNING-OF-RANGE SPECFIED ---                16980033
181000             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            16990033
181100             SET DP020-MSG-WARNING TO TRUE                        17000033
181200             PERFORM 4431-POSITION-AT-WARNING                     17010033
181300         END-IF                                                   17020033
181400     END-IF.                                                      17030033
181500******************************************************************17040033
181600** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **17050033
181700** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **17060033
181800** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND          17070033
181900** POSITION THE CURSOR THERE.                                     17080033
182000******************************************************************17090033
182100 4431-POSITION-AT-WARNING.                                        17100033
182200     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 17110033
182300                    - PV-TOP-ITEM + 1.                            17120033
182400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      17130033
182500         CONTINUE                                                 17140033
182600     ELSE                                                         17150033
182700         SET DP030-SET-CURSOR-APPL-1                              17160033
182800                                   TO TRUE                        17170033
182900         MOVE -1                   TO MR-SELECTL (PV-SUB)         17180033
183000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         17190033
183100         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         17200033
183200     END-IF.                                                      17210033
183300*                                                                 17220033
183400     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   17230033
183500                    - PV-TOP-ITEM + 1.                            17240033
183600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      17250033
183700         CONTINUE                                                 17260033
183800     ELSE                                                         17270033
183900         SET DP030-SET-CURSOR-APPL-1                              17280033
184000                                   TO TRUE                        17290033
184100         MOVE -1                   TO MR-SELECTL (PV-SUB)         17300033
184200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         17310033
184300         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         17320033
184400     END-IF.                                                      17330033
184500 EJECT                                                            17340033
184600*----------------------------------------------------------------*17350033
184700* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *17360033
184800* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *17370033
184900* FOR THE SELECTED ITEMS QUEUE.                                   17380033
185000*                                                                 17390033
185100* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *17400033
185200* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *17410033
185300* THE ARRAY IS FULL.                                              17420033
185400*----------------------------------------------------------------*17430033
185500                                                                  17440033
185600 5000-PREPARE-SEL-QUEUE.                                          17450033
185700                                                                  17460033
185800     MOVE +1                   TO  ASC-BLK-SUB.                   17470033
185900     PERFORM 5100-WRITE-TEMP-STORAGE.                             17480033
186000     ADD +1                    TO  ASC-BLK-SUB.                   17490033
186100     PERFORM 5100-WRITE-TEMP-STORAGE.                             17500033
186200                                                                  17510033
186300*    MOVE ASC-SEL-QUEUE-NAME   TO  SU101-SEL-QUEUE-NAME.          17520033
186400     PERFORM 6010-DELETE-SEL-QUEUE.                               17530033
186500                                                                  17540033
186600     SET ASC-UPDATE-TSQ        TO  TRUE.                          17550033
186700                                                                  17560033
186800     SET DP057-IDX             TO  1.                             17570033
186900*    MOVE ZERO                 TO SU101-NUMBER-OF-TS-ITEMS.       17580033
187000     INITIALIZE DP057-SELECTED-ITEM-ARRAY.                        17590033
187100                                                                  17600033
187200     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           17610033
187300             VARYING PV-ITEM                                      17620033
187400             FROM 1 BY 1                                          17630033
187500             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     17640033
187600                                                                  17650033
187700     IF  DP057-IDX > 1                                            17660033
187800         PERFORM 5205-WRITE-SEL-QUEUE                             17670033
187900*        ADD +1                TO SU101-NUMBER-OF-TS-ITEMS        17680033
188000     END-IF.                                                      17690033
188100 EJECT                                                            17700033
188200*----------------------------------------------------------------*17710033
188300*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.       17720033
188400*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *17730033
188500*----------------------------------------------------------------*17740033
188600                                                                  17750033
188700 5100-WRITE-TEMP-STORAGE.                                         17760033
188800     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     17770033
188900                                   TO PV-LIST-ITEM-NUMBER.        17780033
189000     COMPUTE PV-BLOCK-NUMBER =                                    17790033
189100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    17800033
189200                                                                  17810033
189300     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             17820033
189400     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             17830033
189500         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      17840033
189600             PERFORM 5105-REWRITE-ASC-LISTQ                       17850033
189700         END-IF                                                   17860033
189800     ELSE                                                         17870033
189900         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       17880033
190000         ASC-HIGHEST-BLOCK-WRITTEN + 1                            17890033
190100         PERFORM 5110-WRITE-ASC-LISTQ                             17900033
190200         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   17910033
190300     END-IF.                                                      17920033
190400                                                                  17930033
190500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             17940033
190600******************************************************************17950033
190700** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **17960033
190800** SPECIFIC COMMAREA.                                             17970033
190900******************************************************************17980033
191000 5105-REWRITE-ASC-LISTQ.                                          17990033
191100     EXEC CICS                                                    18000033
191200         WRITEQ TS                                                18010033
191300             QUEUE (ASC-LIST-QUEUE-NAME)                          18020033
191400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               18030033
191500             ITEM  (PV-BLOCK-NUMBER)                              18040033
191600             REWRITE                                              18050033
191700             RESP  (PV-CICS-RESP)                                 18060033
191800     END-EXEC.                                                    18070033
191900                                                                  18080033
192000     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           18090033
192100         CONTINUE                                                 18100033
192200     ELSE                                                         18110033
192300         SET DP013-CICS-ABEND            TO TRUE                  18120033
192400         SET DP013-NO-ROLLBACK           TO TRUE                  18130033
192500         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       18140033
192600         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     18150033
192700                                         TO DP013-MESSAGE-TEXT(1) 18160033
192800         PERFORM DP013-0000-PROCESS-ABEND                         18170033
192900     END-IF.                                                      18180033
193000                                                                  18190033
193100******************************************************************18200033
193200** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-        18210033
193300** SPECIFIC COMMAREA.                                             18220033
193400******************************************************************18230033
193500 5110-WRITE-ASC-LISTQ.                                            18240033
193600     EXEC CICS                                                    18250033
193700         WRITEQ TS                                                18260033
193800             QUEUE (ASC-LIST-QUEUE-NAME)                          18270033
193900             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               18280033
194000             ITEM  (PV-BLOCK-NUMBER)                              18290033
194100             RESP  (PV-CICS-RESP)                                 18300033
194200     END-EXEC.                                                    18310033
194300     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      18320033
194400         SET DP013-CICS-ABEND      TO TRUE                        18330033
194500         SET DP013-NO-ROLLBACK     TO TRUE                        18340033
194600         MOVE '5110-WRITE-ASC-LISTQ'                              18350033
194700                                   TO DP013-PARAGRAPH             18360033
194800         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           18370033
194900                                   TO DP013-MESSAGE-TEXT(1)       18380033
195000         PERFORM DP013-0000-PROCESS-ABEND                         18390033
195100     END-IF.                                                      18400033
195200 EJECT                                                            18410033
195300*----------------------------------------------------------------*18420033
195400* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *18430033
195500* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.                18440033
195600*----------------------------------------------------------------*18450033
195700                                                                  18460033
195800 5200-FILL-SEL-QUEUE-RECORD.                                      18470033
195900                                                                  18480033
196000     PERFORM 6112-READ-LIST-QUEUE.                                18490033
196100                                                                  18500033
196200     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       18510033
196300         PERFORM                                                  18520033
196400         VARYING LQW-IDX                                          18530033
196500         FROM 1 BY 1                                              18540033
196600         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            18550033
196700           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          18560033
196800                                                                  18570033
196900             IF  LQW-SELECT (LQW-IDX)                             18580033
197000                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              18590033
197100                                   TO DP057-ITEM (DP057-IDX)      18600033
197200*                MOVE LQW-MESSAGE-NUMBER (LQW-IDX)                18610033
197300*                                  TO SU102-MESSAGE-NUMBER        18620033
197400*                                       (DP057-IDX)               18630033
197500                 MOVE SPACE        TO DP057-ACTION-SW (DP057-IDX) 18640033
197600                 SET DP057-IDX UP BY 1                            18650033
197700                 IF  DP057-IDX > DP057-MAX-ITEMS                  18660033
197800                     PERFORM 5205-WRITE-SEL-QUEUE                 18670033
197900*                    ADD +1        TO SU101-NUMBER-OF-TS-ITEMS    18680033
198000                     INITIALIZE DP057-SELECTED-ITEM-ARRAY         18690033
198100                     SET DP057-IDX TO  1                          18700033
198200                 END-IF                                           18710033
198300             END-IF                                               18720033
198400         END-PERFORM                                              18730033
198500     END-IF.                                                      18740033
198600                                                                  18750033
198700*----------------------------------------------------------------*18760033
198800*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                 18770033
198900*----------------------------------------------------------------*18780033
199000                                                                  18790033
199100 5205-WRITE-SEL-QUEUE.                                            18800033
199200                                                                  18810033
199300     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            18820033
199400                                   TO DP057-SELECTED-ITEMS.       18830033
199500                                                                  18840033
199600     EXEC CICS                                                    18850033
199700          WRITEQ TS                                               18860033
199800              QUEUE (ASC-SEL-QUEUE-NAME)                          18870033
199900              FROM  (DP057-MESSAGE-SEL-REC)                       18880033
200000              ITEM  (PV-SEL-QUEUE-ITEM)                           18890033
200100              RESP  (PV-CICS-RESP)                                18900033
200200     END-EXEC.                                                    18910033
200300                                                                  18920033
200400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          18930033
200500         CONTINUE                                                 18940033
200600     ELSE                                                         18950033
200700         SET DP013-CICS-ABEND      TO TRUE                        18960033
200800         SET DP013-NO-ROLLBACK     TO TRUE                        18970033
200900         MOVE '5205-WRITE-SEL-QUEUE'                              18980033
201000                                   TO DP013-PARAGRAPH             18990033
201100         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          19000033
201200                                   TO DP013-MESSAGE-TEXT(1)       19010033
201300         PERFORM DP013-0000-PROCESS-ABEND                         19020033
201400     END-IF.                                                      19030033
201500 EJECT                                                            19040033
201600******************************************************************19050033
201700** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **19060033
201800** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **19070033
201900** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **19080033
202000** THE USER.                                                      19090033
202100******************************************************************19100033
202200 6000-REFRESH-PANEL-FROM-TEMP.                                    19110033
202300     IF  ASC-UPDATE-TSQ                                           19120033
202400         SET ASC-NO-TSQ-UPDATE TO TRUE                            19130033
202500         MOVE ZERO                 TO PV-SAVE-ITEM                19140033
202600                                      PV-SEL-QUEUE-ITEM           19150033
202700         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        19160033
202800                                   TO PV-HOLD-SELECTED-ITEMS      19170033
202900         MOVE +1                   TO PV-ITEMS-PROCESSED          19180033
203000         PERFORM 6100-UPDATE-TSQ                                  19190033
203100             UNTIL PV-ITEMS-PROCESSED >                           19200033
203200                                     PV-HOLD-SELECTED-ITEMS       19210033
203300         PERFORM 6010-DELETE-SEL-QUEUE                            19220033
203400         INITIALIZE ASC-BLOCK-ENTRIES (1)                         19230033
203500                    ASC-BLOCK-ENTRIES (2)                         19240033
203600     END-IF.                                                      19250033
203700                                                                  19260033
203800*----------------------------------------------------------------*19270033
203900*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.                19280033
204000*----------------------------------------------------------------*19290033
204100 6010-DELETE-SEL-QUEUE.                                           19300033
204200                                                                  19310033
204300     EXEC CICS                                                    19320033
204400         DELETEQ TS                                               19330033
204500             QUEUE (ASC-SEL-QUEUE-NAME)                           19340033
204600             RESP  (PV-CICS-RESP)                                 19350033
204700     END-EXEC.                                                    19360033
204800*                                                                 19370033
204900     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      19380033
205000        (PV-CICS-RESP = DFHRESP(QIDERR)))                         19390033
205100         CONTINUE                                                 19400033
205200     ELSE                                                         19410033
205300         SET DP013-CICS-ABEND TO TRUE                             19420033
205400         SET DP013-NO-ROLLBACK TO TRUE                            19430033
205500         MOVE '6010-DELETE-SEL-QUEUE'                             19440033
205600                        TO DP013-PARAGRAPH                        19450033
205700         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         19460033
205800                        TO DP013-MESSAGE-TEXT (1)                 19470033
205900         PERFORM DP013-0000-PROCESS-ABEND                         19480033
206000     END-IF.                                                      19490033
206100                                                                  19500033
206200*----------------------------------------------------------------*19510033
206300*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.       19520033
206400*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *19530033
206500*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *19540033
206600*    THE TEMP QUEUE.                                              19550033
206700*----------------------------------------------------------------*19560033
206800                                                                  19570033
206900 6100-UPDATE-TSQ.                                                 19580033
207000                                                                  19590033
207100     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             19600033
207200     PERFORM 6105-READ-SEL-QUEUE.                                 19610033
207300     PERFORM                                                      19620033
207400         VARYING DP057-IDX                                        19630033
207500         FROM 1 BY 1                                              19640033
207600         UNTIL ((PV-ITEMS-PROCESSED >                             19650033
207700                              PV-HOLD-SELECTED-ITEMS)             19660033
207800         OR (DP057-IDX GREATER THAN DP057-MAX-ITEMS))             19670033
207900         IF  DP057-ACTION-SW (DP057-IDX) > SPACE                  19680033
208000             PERFORM 6110-PROCESS-ITEMS                           19690033
208100         END-IF                                                   19700033
208200         ADD +1                TO PV-ITEMS-PROCESSED              19710033
208300     END-PERFORM.                                                 19720033
208400     PERFORM 6111-WRITE-LIST-QUEUE.                               19730033
208500*----------------------------------------------------------------*19740033
208600*    READ THE LIST QUEUE RECORD.                                  19750033
208700*----------------------------------------------------------------*19760033
208800                                                                  19770033
208900 6105-READ-SEL-QUEUE.                                             19780033
209000                                                                  19790033
209100     EXEC CICS                                                    19800033
209200          READQ TS                                                19810033
209300              QUEUE (ASC-SEL-QUEUE-NAME)                          19820033
209400              INTO  (DP057-MESSAGE-SEL-REC)                       19830033
209500              ITEM  (PV-SEL-QUEUE-ITEM)                           19840033
209600              RESP  (PV-CICS-RESP)                                19850033
209700     END-EXEC.                                                    19860033
209800*                                                                 19870033
209900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          19880033
210000         CONTINUE                                                 19890033
210100     ELSE                                                         19900033
210200         SET DP013-CICS-ABEND      TO  TRUE                       19910033
210300         SET DP013-NO-ROLLBACK     TO  TRUE                       19920033
210400         MOVE '6105-READ-SEL-QUEUE'                               19930033
210500                                   TO  DP013-PARAGRAPH            19940033
210600         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           19950033
210700                                   TO  DP013-MESSAGE-TEXT(1)      19960033
210800         PERFORM DP013-0000-PROCESS-ABEND                         19970033
210900     END-IF.                                                      19980033
211000 EJECT                                                            19990033
211100*----------------------------------------------------------------*20000033
211200*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*20010033
211300*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*20020033
211400*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.            20030033
211500*----------------------------------------------------------------*20040033
211600                                                                  20050033
211700 6110-PROCESS-ITEMS.                                              20060033
211800                                                                  20070033
211900     COMPUTE PV-ITEM = 1 + ((DP057-ITEM (DP057-IDX) - 1)          20080033
212000                     / PC-ITEMS-PER-PANEL).                       20090033
212100                                                                  20100033
212200     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           20110033
212300         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          20120033
212400             PERFORM 6111-WRITE-LIST-QUEUE                        20130033
212500         END-IF                                                   20140033
212600         MOVE PV-ITEM          TO PV-SAVE-ITEM                    20150033
212700                                                                  20160033
212800         PERFORM 6112-READ-LIST-QUEUE                             20170033
212900         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               20180033
213000             CONTINUE                                             20190033
213100         END-IF                                                   20200033
213200     END-IF.                                                      20210033
213300                                                                  20220033
213400     COMPUTE PV-SUB = (DP057-ITEM (DP057-IDX)                     20230033
213500                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              20240033
213600     SET LQW-DESELECT (PV-SUB) TO    TRUE                         20250033
213700     MOVE LQW-SELECTED-SW (PV-SUB)                                20260033
213800                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  20270033
213900*    EVALUATE TRUE                                                20280033
214000*        WHEN SU102-INQ (DP057-IDX)                               20290033
214100*             MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             20300033
214200*                                                                 20310033
214300*        WHEN SU102-UPD (DP057-IDX)                               20320033
214400*             MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             20330033
214500*                                                                 20340033
214600*        WHEN SU102-DEL (DP057-IDX)                               20350033
214700*             MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             20360033
214800*                                                                 20370033
214900*        WHEN SU102-ERR (DP057-IDX)                               20380033
215000*             MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             20390033
215100*    END-EVALUATE.                                                20400033
215200                                                                  20410033
215300     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                20420033
215400                                                                  20430033
215500*----------------------------------------------------------------*20440033
215600*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.              20450033
215700*----------------------------------------------------------------*20460033
215800                                                                  20470033
215900 6111-WRITE-LIST-QUEUE.                                           20480033
216000                                                                  20490033
216100     EXEC CICS                                                    20500033
216200         WRITEQ TS                                                20510033
216300             QUEUE (ASC-LIST-QUEUE-NAME)                          20520033
216400             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     20530033
216500             ITEM  (PV-SAVE-ITEM)                                 20540033
216600             REWRITE                                              20550033
216700             RESP  (PV-CICS-RESP)                                 20560033
216800     END-EXEC.                                                    20570033
216900*                                                                 20580033
217000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          20590033
217100         CONTINUE                                                 20600033
217200     ELSE                                                         20610033
217300         SET DP013-CICS-ABEND  TO  TRUE                           20620033
217400         SET DP013-NO-ROLLBACK TO  TRUE                           20630033
217500         MOVE '6111-WRITE-LIST-QUEUE'                             20640033
217600                               TO  DP013-PARAGRAPH                20650033
217700         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  20660033
217800                               TO  DP013-MESSAGE-TEXT(1)          20670033
217900         PERFORM DP013-0000-PROCESS-ABEND                         20680033
218000     END-IF.                                                      20690033
218100                                                                  20700033
218200 EJECT                                                            20710033
218300*----------------------------------------------------------------*20720033
218400*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA. 20730033
218500*----------------------------------------------------------------*20740033
218600                                                                  20750033
218700 6112-READ-LIST-QUEUE.                                            20760033
218800                                                                  20770033
218900     EXEC CICS                                                    20780033
219000         READQ TS                                                 20790033
219100             QUEUE (ASC-LIST-QUEUE-NAME)                          20800033
219200             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     20810033
219300             ITEM  (PV-ITEM)                                      20820033
219400             RESP  (PV-CICS-RESP)                                 20830033
219500     END-EXEC.                                                    20840033
219600*                                                                 20850033
219700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          20860033
219800         CONTINUE                                                 20870033
219900     ELSE                                                         20880033
220000         SET DP013-CICS-ABEND        TO TRUE                      20890033
220100         SET DP013-NO-ROLLBACK       TO TRUE                      20900033
220200         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           20910033
220300         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    20920033
220400                                     TO DP013-MESSAGE-TEXT(1)     20930033
220500         PERFORM DP013-0000-PROCESS-ABEND                         20940033
220600     END-IF.                                                      20950033
220700                                                                  20960033
220800 EJECT                                                            20970033
220900*----------------------------------------------------------------*20980033
221000*    ABEND PROCESSOR MODULE                                       20990033
221100*----------------------------------------------------------------*21000033
221200                                                                  21010033
221300     COPY DPPD013.                                                21020033
