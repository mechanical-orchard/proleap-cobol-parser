000100 TITLE 'SUMMARIZE VIOLATION EXTRACTS FOR VIOLATION REPORTS'.      00010004
000200 IDENTIFICATION DIVISION.                                         00020004
000300 PROGRAM-ID.    SUKUT068.                                         00030004
000400 AUTHOR.        DENNIS STEFFEN.                                   00040004
000500 DATE-WRITTEN.  WINTER 2002.                                      00050004
000600 ENVIRONMENT DIVISION.                                            00060004
000700 INPUT-OUTPUT SECTION.                                            00070004
000800                                                                  00080004
000900 FILE-CONTROL.                                                    00090004
001000     SELECT VIOLATION-EXTRACT-FILE      ASSIGN TO INP01.          00100004
001100     SELECT SUMMARY-EXTRACT-FILE        ASSIGN TO OUT01.          00110004
001200                                                                  00120004
001300 DATA DIVISION.                                                   00130004
001400 FILE SECTION.                                                    00140004
001500                                                                  00150004
001600                                                                  00160004
001700 FD  VIOLATION-EXTRACT-FILE                                       00170004
001800     RECORDING MODE IS F                                          00180004
001900     LABEL RECORDS ARE STANDARD                                   00190004
002000     RECORD CONTAINS 150                                          00200004
002100     BLOCK CONTAINS 0 RECORDS                                     00210004
002200     DATA RECORD IS VIOLATION-EXTRACT-RECORD.                     00220004
002300 01  VIOLATION-EXTRACT-RECORD         PIC X(150).                 00230004
002400                                                                  00240004
002500 FD  SUMMARY-EXTRACT-FILE                                         00250004
002600     RECORDING MODE IS F                                          00260004
002700     LABEL RECORDS ARE STANDARD                                   00270004
002800     RECORD CONTAINS 150                                          00280004
002900     BLOCK CONTAINS 0 RECORDS                                     00290004
003000     DATA RECORD IS SUMMARY-EXTRACT-RECORD.                       00300004
003100 01  SUMMARY-EXTRACT-RECORD          PIC X(150).                  00310004
003200                                                                  00320004
003300 WORKING-STORAGE SECTION.                                         00330004
003400                                                                  00340004
003500 01  PV-ENT-ID                        PIC  9(09)   VALUE ZERO.    00350010
003600 01  PV-ABEND-CODE                    PIC S9(04)   VALUE ZERO     00360010
003700                                                   COMP SYNC.     00370004
003800                                                                  00380004
003900 01  PS-PROGRAM-SWITCHES.                                         00390004
004000     05  PS-END-EXTRACT-SW            PIC X(1)   VALUE 'N'.       00400004
004100         88  PS-END-EXTRACT                      VALUE 'Y'.       00410004
004200     05  PS-RCVR-COMPLETE-SW          PIC X(1)   VALUE 'N'.       00420008
004300         88  PS-RCVR-NOT-COMPLETE                VALUE 'N'.       00430008
004400         88  PS-RCVR-IS-COMPLETE                 VALUE 'Y'.       00440008
004500     05  PS-RCVR-FAILED-SW            PIC X(1)   VALUE 'N'.       00450008
004600         88  PS-RCVR-NOT-FAILED                  VALUE 'N'.       00460008
004700         88  PS-RCVR-FAILED                      VALUE 'Y'.       00470008
004800     05  PS-PO-FAILED-SW              PIC X(1)   VALUE 'N'.       00480008
004900         88  PS-PO-NOT-FAILED                    VALUE 'N'.       00490009
005000         88  PS-PO-FAILED                        VALUE 'Y'.       00500009
005100     05  PS-PO-COMPLETE-SW            PIC X(1)   VALUE 'N'.       00510008
005200         88  PS-PO-NOT-COMPLETE                  VALUE 'N'.       00520009
005300         88  PS-PO-IS-COMPLETE                   VALUE 'Y'.       00530009
005400                                                                  00540004
005500 01  PV-CURR-KEY.                                                 00550004
005600     05  PV-CURR-VEND-SALES-RANK      PIC 9(04)  VALUE ZERO.      00560004
005700     05  PV-CURR-VEND-ID              PIC 9(09)  VALUE ZERO.      00570004
005800     05  PV-CURR-PKGNG-CDE            PIC X(02)  VALUE ZERO.      00580004
005900     05  PV-CURR-VEND-AUDIT-RANK      PIC X(06)  VALUE ZERO.      00590004
006000 01  PV-CURR-PO-KEY.                                              00600004
006100     05  PV-CURR-PO                   PIC 9(09)  VALUE ZERO.      00610004
006200     05  PV-CURR-RCVR                 PIC 9(09)  VALUE ZERO.      00620004
006300                                                                  00630004
006400 01  PV-PREV-KEY.                                                 00640004
006500     05  PV-PREV-VEND-SALES-RANK      PIC 9(04)  VALUE ZERO.      00650004
006600     05  PV-PREV-VEND-ID              PIC 9(09)  VALUE ZERO.      00660004
006700     05  PV-PREV-PKGNG-CDE            PIC X(02)  VALUE ZERO.      00670004
006800     05  PV-PREV-VEND-AUDIT-RANK      PIC X(06)  VALUE ZERO.      00680004
006900 01  PV-PREV-PO-KEY.                                              00690004
007000     05  PV-PREV-PO                   PIC 9(09)  VALUE ZERO.      00700004
007100     05  PV-PREV-RCVR                 PIC 9(09)  VALUE ZERO.      00710004
007200                                                                  00720004
007300 01  PV-PROGRAM-VARIABLES.                                        00730004
007400     05  PV-RETRY-COUNT               PIC S9(04)  VALUE ZERO      00740004
007500                                                  COMP SYNC.      00750004
007600     05  PV-PARAGRAPH-NAME            PIC X(30)   VALUE SPACES.   00760004
007700     05  PV-ERROR-MESSAGE-1           PIC X(60)   VALUE SPACES.   00770004
007800     05  PV-ERROR-MESSAGE-2           PIC X(60)   VALUE SPACES.   00780004
007900     05  PV-DISP-NBR                  PIC Z(8)9.                  00790004
008000     05  PV-SQLCODE                   PIC 9(9)    VALUE ZERO.     00800004
008100     05  PV-TIMESTAMP                 PIC X(26).                  00810004
008200     05  PV-AUDIT-DURATION            PIC S9(9) COMP-3 VALUE ZERO.00820004
008300     05  PV-PREPACK-COUNT             PIC S9(9) COMP-3 VALUE ZERO.00830004
008400     05  PV-FAILURE-COUNT             PIC S9(9) COMP-3 VALUE ZERO.00840004
008500                                                                  00850004
008600 01  PV-COUNTERS COMP-3.                                          00860004
008700     05  PV-READ-COUNT                PIC S9(9)    VALUE ZERO.    00870004
008800     05  PV-WRITE-COUNT               PIC S9(9)    VALUE ZERO.    00880004
008900     05  PV-B-COUNT                   PIC S9(9)    VALUE ZERO.    00890004
009000     05  PV-C-COUNT                   PIC S9(9)    VALUE ZERO.    00900004
009100                                                                  00910004
009200 01  PC-PROGRAM-CONSTANTS.                                        00920004
009300     05  PC-PROGRAM-NAME              PIC X(08)  VALUE 'SUKUT068'.00930004
009400     05  PC-MAX-RETRIES               PIC S9(04) VALUE +3         00940004
009500                                                 COMP SYNC.       00950004
009600 01  PV-ABEND-FIELDS.                                             00960004
009700     05  PV-ABEND-PROGRAM             PIC X(8)   VALUE 'SUKUT068'.00970004
009800     05  PV-ABEND-PARAGRAPH           PIC X(50)  VALUE SPACES.    00980004
009900     05  PV-ABEND-OPERATION           PIC X(50)  VALUE SPACES.    00990004
010000     05  PV-ABEND-STRUCTURE-1         PIC X(15)  VALUE SPACES.    01000004
010100     05  PV-ABEND-STRUCTURE-2         PIC X(15)  VALUE SPACES.    01010004
010200     05  PV-ABEND-STRUCTURE-3         PIC X(15)  VALUE SPACES.    01020004
010300     05  PV-ABEND-STATUS              PIC XX     VALUE SPACES.    01030004
010400     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01040006
010500     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01050006
010600     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01060006
010700     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    01070006
010800                                                                  01080004
010900/                                                                 01090004
011000*    VIOLATION EXTRACT                                            01100004
011100     COPY SURD033.                                                01110004
011200                                                                  01120004
011300*    VIOLATION SUMMARY RECORD                                     01130004
011400     COPY SURD034.                                                01140004
011500                                                                  01150004
011600*  USED FOR DB2 ERROR MESSAGE BUILDING                            01160004
011700     COPY DPWS004.                                                01170004
011800                                                                  01180004
011900*    VENDOR NAMES                                                 01190005
012000     EXEC SQL                                                     01200005
012100         INCLUDE TENTNME                                          01210005
012200     END-EXEC.                                                    01220005
012300                                                                  01230005
012400*    VENDOR MASTER                                                01240005
012500     EXEC SQL                                                     01250005
012600         INCLUDE TEXTENT                                          01260005
012700     END-EXEC.                                                    01270005
012800*   DB2 SQL COMMUNICATION AREA                                    01280004
012900     EXEC SQL                                                     01290004
013000          INCLUDE SQLCA                                           01300004
013100     END-EXEC.                                                    01310004
013200/                                                                 01320004
013300                                                                  01330004
013400                                                                  01340004
013500 PROCEDURE DIVISION.                                              01350004
013600                                                                  01360004
013700     PERFORM 1000-INIT.                                           01370004
013800                                                                  01380004
013900     PERFORM 2000-PROCESS UNTIL PS-END-EXTRACT.                   01390004
014000                                                                  01400004
014100     PERFORM 9000-TERMINATE.                                      01410004
014200                                                                  01420004
014300     GOBACK.                                                      01430004
014400                                                                  01440004
014500 1000-INIT.                                                       01450004
014600                                                                  01460004
014700     OPEN INPUT  VIOLATION-EXTRACT-FILE                           01470004
014800          OUTPUT SUMMARY-EXTRACT-FILE                             01480004
014900                                                                  01490004
015000     EXEC SQL                                                     01500004
015100         SET :PV-TIMESTAMP = CURRENT TIMESTAMP                    01510004
015200     END-EXEC                                                     01520004
015300                                                                  01530004
015400     PERFORM 8000-READ-VIOLATION-REC.                             01540004
015500     IF NOT PS-END-EXTRACT                                        01550004
015600         MOVE PV-CURR-KEY             TO PV-PREV-KEY              01560004
015700         INITIALIZE SU034-RECORD                                  01570004
015800         PERFORM 3000-MOVE-KEY-FIELDS                             01580004
015900     END-IF.                                                      01590004
016000                                                                  01600004
016100 2000-PROCESS.                                                    01610004
016200                                                                  01620004
016300     EVALUATE TRUE                                                01630004
016400         WHEN PV-CURR-KEY = PV-PREV-KEY                           01640004
016500             PERFORM 2100-ADD-TO-BUCKETS                          01650004
016600         WHEN OTHER                                               01660004
016700             PERFORM 7000-VENDOR-INFO                             01670005
016800             PERFORM 8100-WRITE-EXTRACT-REC                       01680004
016900             INITIALIZE SU034-RECORD                              01690004
017000             PERFORM 3000-MOVE-KEY-FIELDS                         01700004
017100             PERFORM 2100-ADD-TO-BUCKETS                          01710004
017200             MOVE PV-CURR-KEY         TO PV-PREV-KEY              01720004
017300             MOVE PV-CURR-PO-KEY      TO PV-PREV-PO-KEY           01730004
017400     END-EVALUATE.                                                01740004
017500                                                                  01750004
017600     PERFORM 8000-READ-VIOLATION-REC.                             01760004
017700                                                                  01770004
017800 2100-ADD-TO-BUCKETS.                                             01780004
017900                                                                  01790004
018000     ADD SU033-CRTNS-AUDITED          TO SU034-CRTNS-AUDITED      01800004
018100     ADD SU033-CRTNS-W-PICK-ERR       TO SU034-CRTNS-W-PICK-ERR   01810004
018200     ADD SU033-UNITS-AUDITED          TO SU034-UNITS-AUDITED      01820004
018300     ADD SU033-UNITS-PICK-ERR         TO SU034-UNITS-PICK-ERR     01830004
018400     ADD SU033-UNITS-TICK-ERR         TO SU034-UNITS-TICK-ERR     01840004
018500     ADD SU033-UNITS-PACK-ERR         TO SU034-UNITS-PACK-ERR     01850004
018600     ADD SU033-PACKS-AUDITED          TO SU034-PACKS-AUDITED      01860004
018700     ADD SU033-PACKS-W-PACK-ERR       TO SU034-PACKS-W-PACK-ERR.  01870004
018800                                                                  01880004
018900     IF SU033-COMPLETE                                            01890004
019000         ADD 1                        TO SU034-TOTAL-NBR-AUDITS   01900004
019100     END-IF.                                                      01910004
019200                                                                  01920004
019300     IF SU033-FAIL                                                01930004
019400         ADD 1                       TO SU034-TOTAL-FAILED-AUDITS 01940004
019500     END-IF                                                       01950004
019600                                                                  01960004
019700     EVALUATE TRUE                                                01970004
019800         WHEN PV-CURR-PO-KEY = PV-PREV-PO-KEY                     01980004
019900             PERFORM 2110-PO-BUCKETS                              01990008
020000             PERFORM 2120-RCVR-BUCKETS                            02000008
020100                                                                  02010004
020200         WHEN OTHER                                               02020004
020300             EVALUATE TRUE                                        02030004
020400                                                                  02040004
020500*  IF PO CHANGES ADD TO PO AND RCVR BUCKETS                       02050004
020600                 WHEN PV-CURR-PO NOT = PV-PREV-PO                 02060004
020700                     SET PS-PO-NOT-COMPLETE TO TRUE               02070008
020800                     SET PS-PO-NOT-FAILED   TO TRUE               02080008
020900                     SET PS-RCVR-NOT-COMPLETE TO TRUE             02090008
021000                     SET PS-RCVR-NOT-FAILED   TO TRUE             02100008
021100                     PERFORM 2110-PO-BUCKETS                      02110004
021200                     PERFORM 2120-RCVR-BUCKETS                    02120004
021300                     MOVE PV-CURR-PO-KEY                          02130004
021400                                      TO PV-PREV-PO-KEY           02140004
021500                                                                  02150004
021600*  IF RECEIVER NUMBER CHANGES ADD ONLY TO RECEIVER BUCKETS        02160004
021700                 WHEN PV-CURR-RCVR NOT = PV-PREV-RCVR             02170004
021800                     SET PS-RCVR-NOT-COMPLETE TO TRUE             02180008
021900                     SET PS-RCVR-NOT-FAILED   TO TRUE             02190008
022000                     PERFORM 2120-RCVR-BUCKETS                    02200004
022100                     MOVE PV-CURR-RCVR                            02210004
022200                                      TO PV-PREV-RCVR             02220004
022300             END-EVALUATE                                         02230004
022400     END-EVALUATE.                                                02240004
022500                                                                  02250004
022600 2110-PO-BUCKETS.                                                 02260004
022700                                                                  02270004
022800     IF SU033-COMPLETE AND PS-PO-NOT-COMPLETE                     02280008
022900         ADD 1                        TO SU034-TOTAL-NBR-PO       02290004
023000         SET PS-PO-IS-COMPLETE TO TRUE                            02300008
023100     END-IF.                                                      02310004
023200                                                                  02320004
023300     IF SU033-FAILURE-ERROR-YES AND PS-PO-NOT-FAILED              02330008
023400         ADD 1                        TO SU034-TOTAL-NBR-PO-FAIL  02340004
023500         SET PS-PO-FAILED      TO TRUE                            02350008
023600     END-IF.                                                      02360004
023700                                                                  02370004
023800 2120-RCVR-BUCKETS.                                               02380004
023900     IF SU033-COMPLETE AND PS-RCVR-NOT-COMPLETE                   02390008
024000         ADD 1                        TO SU034-TOTAL-NBR-RCVR     02400004
024100         SET PS-RCVR-IS-COMPLETE TO TRUE                          02410008
024200     END-IF.                                                      02420004
024300                                                                  02430004
024400     IF SU033-FAILURE-ERROR-YES AND PS-RCVR-NOT-FAILED            02440008
024500         ADD 1                      TO SU034-TOTAL-NBR-RCVR-FAIL  02450004
024600         SET PS-RCVR-FAILED    TO TRUE                            02460008
024700     END-IF.                                                      02470004
024800                                                                  02480004
024900/                                                                 02490004
025000 3000-MOVE-KEY-FIELDS.                                            02500004
025100                                                                  02510004
025200     MOVE SU033-WEEK-END-DATE         TO SU034-WEEK-END-DATE      02520004
025300     MOVE SU033-FISCAL-YEAR           TO SU034-FISCAL-YEAR        02530004
025400     MOVE SU033-FISCAL-WEEK           TO SU034-FISCAL-WEEK        02540004
025500     MOVE SU033-FISCAL-SEASON         TO SU034-FISCAL-SEASON      02550004
025600     MOVE SU033-FISCAL-MONTH          TO SU034-FISCAL-MONTH       02560004
025700     MOVE SU033-VENDOR-ID             TO SU034-VENDOR-ID          02570004
025800     MOVE SU033-VENDOR-NAME           TO SU034-VENDOR-NAME        02580004
025900     MOVE SU033-VENDOR-AUDIT-RANK     TO SU034-VENDOR-AUDIT-RANK  02590004
026000     MOVE SU033-VENDOR-SALES-RANK     TO SU034-VENDOR-SALES-RANK  02600004
026100     MOVE SU033-PKGNG-TYPE            TO SU034-PKGNG-TYPE.        02610004
026200/                                                                 02620005
026300 7000-VENDOR-INFO.                                                02630005
026400                                                                  02640005
026500     MOVE SU034-VENDOR-ID             TO EXTENT-ENT-ID.           02650005
026600     INITIALIZE EXTENT-CFY-SLSRNK-NBR                             02660010
026700                ENTNME-ENT-NAME-DESC.                             02670011
026800                                                                  02680005
026900     EXEC SQL                                                     02690005
027000         SELECT                                                   02700005
027100             ENT.CFY_SLSRNK_NBR                                   02710005
027200            ,NME.ENT_NAME_DESC                                    02720010
027300         INTO                                                     02730005
027400             :EXTENT-CFY-SLSRNK-NBR                               02740005
027500            ,:ENTNME-ENT-NAME-DESC                                02750011
027600         FROM                                                     02760005
027700             TENTNME NME                                          02770005
027800         ,   TEXTENT ENT                                          02780005
027900         WHERE                                                    02790005
028000             NME.ENT_ID        = ENT.ENT_ID                       02800005
028100         AND ENT.ENT_ID        = :EXTENT-ENT-ID                   02810005
028200         AND ENT.MDSE_VENDOR_IND  = 'Y'                           02820005
028300         AND ENT.STATUS_CDE       = 'A'                           02830005
028400         AND NME.TYPE_CDE         = '01'                          02840005
028500         WITH UR                                                  02850005
028600     END-EXEC.                                                    02860005
028700                                                                  02870005
028800     EVALUATE TRUE                                                02880005
028900         WHEN SQLCODE = ZERO                                      02890005
029000             MOVE EXTENT-CFY-SLSRNK-NBR                           02900010
029100                                      TO SU034-VENDOR-SALES-RANK  02910010
029200             MOVE ENTNME-ENT-NAME-DESC                            02920011
029300                                      TO SU034-VENDOR-NAME        02930010
029400         WHEN SQLCODE = +100                                      02940005
029500             PERFORM 7010-VENDOR-INFO-INACTIVE                    02950010
029600         WHEN SQLWARN0 NOT = SPACE                                02960005
029700         WHEN SQLCODE  NOT = ZERO                                 02970005
029800             MOVE EXTENT-ENT-ID       TO PV-DISP-NBR              02980005
029900             DISPLAY 'EXTENT-ENT-ID= ' PV-DISP-NBR                02990005
030000             MOVE '7000-VENDOR-INFO'   TO PV-ABEND-PARAGRAPH      03000005
030100             MOVE 'SELECT'             TO PV-ABEND-OPERATION      03010005
030200             MOVE 'TENTNME' TO PV-ABEND-STRUCTURE-1               03020005
030300             MOVE 'TEXTENT' TO PV-ABEND-STRUCTURE-2               03030005
030400             PERFORM 9900-DB2-ABEND                               03040005
030500     END-EVALUATE.                                                03050005
030600                                                                  03060010
030700 7010-VENDOR-INFO-INACTIVE.                                       03070010
030800                                                                  03080010
030900     MOVE SU034-VENDOR-ID             TO EXTENT-ENT-ID.           03090010
031000     INITIALIZE ENTNME-ENT-NAME-DESC.                             03100011
031100                                                                  03110010
031200     EXEC SQL                                                     03120010
031300         SELECT                                                   03130010
031310             ENT.CFY_SLSRNK_NBR                                   03131013
031400            ,NME.ENT_NAME_DESC                                    03140013
031500         INTO                                                     03150010
031510             :EXTENT-CFY-SLSRNK-NBR                               03151013
031600            ,:ENTNME-ENT-NAME-DESC                                03160013
031700         FROM                                                     03170010
031800             TENTNME NME                                          03180010
031900         ,   TEXTENT ENT                                          03190010
032000         WHERE                                                    03200010
032100             NME.ENT_ID        = ENT.ENT_ID                       03210010
032200         AND ENT.ENT_ID        = :EXTENT-ENT-ID                   03220010
032300         AND ENT.MDSE_VENDOR_IND  = 'Y'                           03230010
032400         AND ENT.STATUS_CDE       = 'I'                           03240010
032500         AND NME.TYPE_CDE         = '01'                          03250010
032600         WITH UR                                                  03260010
032700     END-EXEC.                                                    03270010
032800                                                                  03280010
032900     EVALUATE TRUE                                                03290010
033000         WHEN SQLCODE = ZERO                                      03300010
033010             MOVE EXTENT-CFY-SLSRNK-NBR                           03301013
033020                                      TO SU034-VENDOR-SALES-RANK  03302013
033100             MOVE ENTNME-ENT-NAME-DESC                            03310011
033200                                      TO SU034-VENDOR-NAME        03320010
033300         WHEN SQLCODE = +100                                      03330010
033400             MOVE SU034-VENDOR-ID     TO PV-ENT-ID                03340010
033500             MOVE PV-ENT-ID           TO SU034-VENDOR-NAME        03350010
033600         WHEN SQLWARN0 NOT = SPACE                                03360010
033700         WHEN SQLCODE  NOT = ZERO                                 03370010
033800             MOVE EXTENT-ENT-ID       TO PV-DISP-NBR              03380010
033900             DISPLAY 'EXTENT-ENT-ID= ' PV-DISP-NBR                03390010
034000             MOVE '7000-VENDOR-INFO'   TO PV-ABEND-PARAGRAPH      03400010
034100             MOVE 'SELECT'             TO PV-ABEND-OPERATION      03410010
034200             MOVE 'TENTNME' TO PV-ABEND-STRUCTURE-1               03420010
034300             MOVE 'TEXTENT' TO PV-ABEND-STRUCTURE-2               03430010
034400             PERFORM 9900-DB2-ABEND                               03440010
034500     END-EVALUATE.                                                03450010
034600/                                                                 03460010
034700 8000-READ-VIOLATION-REC.                                         03470004
034800                                                                  03480004
034900     READ VIOLATION-EXTRACT-FILE INTO SU033-RECORD                03490004
035000     AT END                                                       03500004
035100         SET PS-END-EXTRACT           TO TRUE                     03510004
035200     NOT AT END                                                   03520004
035300         ADD 1                        TO PV-READ-COUNT            03530004
035400         MOVE SU033-VENDOR-SALES-RANK TO PV-CURR-VEND-SALES-RANK  03540004
035500         MOVE SU033-VENDOR-ID         TO PV-CURR-VEND-ID          03550004
035600         MOVE SU033-PKGNG-TYPE        TO PV-CURR-PKGNG-CDE        03560004
035700         MOVE SU033-VENDOR-AUDIT-RANK TO PV-CURR-VEND-AUDIT-RANK  03570004
035800         MOVE SU033-PO-NBR            TO PV-CURR-PO               03580004
035900         MOVE SU033-RCVR-SEQ-NBR      TO PV-CURR-RCVR             03590004
036000     END-READ.                                                    03600004
036100                                                                  03610004
036200 8100-WRITE-EXTRACT-REC.                                          03620004
036300                                                                  03630004
036400     WRITE SUMMARY-EXTRACT-RECORD FROM SU034-RECORD.              03640004
036500     ADD 1                         TO PV-WRITE-COUNT.             03650004
036600/                                                                 03660004
036700 9000-TERMINATE.                                                  03670004
036800                                                                  03680004
036900     IF PV-WRITE-COUNT > ZERO                                     03690004
037000         PERFORM 8100-WRITE-EXTRACT-REC                           03700004
037100     END-IF                                                       03710004
037200                                                                  03720004
037300     CLOSE VIOLATION-EXTRACT-FILE                                 03730004
037400           SUMMARY-EXTRACT-FILE                                   03740004
037500                                                                  03750004
037600     DISPLAY ALL '*'                                              03760004
037700     DISPLAY '******* SUKUT068 *******'.                          03770004
037800     DISPLAY ALL '*'                                              03780004
037900     DISPLAY SPACES                                               03790004
038000                                                                  03800004
038100     MOVE PV-READ-COUNT               TO PV-DISP-NBR              03810004
038200     DISPLAY 'VIOLATION EXTRACTS READ      = ' PV-DISP-NBR        03820004
038300                                                                  03830004
038400                                                                  03840004
038500     MOVE PV-WRITE-COUNT              TO PV-DISP-NBR              03850004
038600     DISPLAY 'SUMMARY EXTRACTS WRITTEN     = ' PV-DISP-NBR        03860004
038700                                                                  03870004
038800     DISPLAY SPACES                                               03880004
038900     DISPLAY ALL '*'.                                             03890004
039000                                                                  03900004
039100                                                                  03910005
039200 9900-DB2-ABEND.                                                  03920005
039300                                                                  03930005
039400     MOVE SQLCODE TO PV-SQLCODE.                                  03940005
039500     DISPLAY '*** DB2 ERROR '.                                    03950005
039600     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       03960005
039700     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 03970005
039800     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               03980005
039900     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               03990005
040000     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       04000005
040100     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       04010005
040200     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       04020005
040300     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             04030005
040400     DISPLAY '*** TABLE 2   = ' PV-ABEND-STRUCTURE-2              04040005
040500                                                                  04050005
040600                                                                  04060005
040700     COPY DPPD004.                                                04070005
040800                                                                  04080005
040900     MOVE +4013                  TO PV-ABEND-CODE.                04090005
041000     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         04100005
041100                                                                  04110005
