000100******************************************************************00010074
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             SVKUP087.                                00050039
000600 AUTHOR.                 COGNIZANT.                               00060051
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN.           JANUARY 2014.                            00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*  THIS PROGRAM GETS THE LIST OF CARDS WHICH HAS TO BE            00120000
001300*  REVERSED FOR TENDER TRANSACTION. THE VALIDATES THE INPUT INFO  00130000
001400*  IN SVT_KOHLS_TRN TABLE FOR TENDER DETAILS, IF MATCH FOUND,     00140000
001400*  VOIDED TENDER TRANSACTION IS DELETED AND THE ORIG TRANSACTION  00141053
001500*  IS REVERSED TO VALID (NON- VOID TRANSACTION). THIS PROGRAM     00150000
001600*  ALSO CREATES AUDIT REPORT OF THE UPDATES AND EXCEPTION REPORT  00160000
001600*  OF THE ORDERS AND CARDS WHICH FAILED VALIDATION ALONG WITH     00161000
001600*  REASON.                                                        00162000
001700******************************************************************00170000
001800******************************************************************00180000
001900 ENVIRONMENT DIVISION.                                            00190000
002000******************************************************************00200000
002100                                                                  00210000
002200 CONFIGURATION SECTION.                                           00220000
002300                                                                  00230000
002400 SOURCE-COMPUTER.    IBM-3090.                                    00240000
002500 OBJECT-COMPUTER.    IBM-3090.                                    00250000
002600                                                                  00260000
002700 INPUT-OUTPUT SECTION.                                            00270000
002800                                                                  00280000
002900 FILE-CONTROL.                                                    00290000
003000                                                                  00300000
003100     SELECT ATG-GIFT-CARD-FILE                                    00310000
003200         ASSIGN TO INP01.                                         00320000
003300                                                                  00330000
003400     SELECT AUDIT-FILE                                            00340051
003500         ASSIGN TO OUT01.                                         00350000
003600                                                                  00360000
003400     SELECT EXCEPTION-FILE                                        00361051
003500         ASSIGN TO OUT02.                                         00362000
003600                                                                  00363000
006400******************************************************************00580000
006500 DATA DIVISION.                                                   00590000
006600******************************************************************00600000
006700                                                                  00610000
006800 FILE SECTION.                                                    00620000
006900                                                                  00630000
007000 FD  ATG-GIFT-CARD-FILE                                           00640000
007100     RECORDING MODE IS F                                          00650000
007200     BLOCK CONTAINS 0 RECORDS                                     00660000
007300     LABEL RECORDS ARE STANDARD.                                  00670000
007400                                                                  00680000
007500 01  ATG-GIFT-CARD-RECORD             PIC X(80).                  00690020
007600                                                                  00700000
007700 FD  AUDIT-FILE                                                   00710051
007800     RECORDING MODE IS F                                          00720000
007900     LABEL RECORDS ARE STANDARD                                   00730000
008000     BLOCK CONTAINS 0 RECORDS                                     00740000
008100     DATA RECORD IS AUDIT-FILE-RECORD.                            00750051
008200                                                                  00760000
008300 01  AUDIT-FILE-RECORD               PIC X(80).                   00770051
008400                                                                  00780000
008500 FD  EXCEPTION-FILE                                               00790051
008600     RECORDING MODE IS F                                          00800000
008700     LABEL RECORDS ARE STANDARD                                   00810000
008800     BLOCK CONTAINS 0 RECORDS                                     00820000
008900     DATA RECORD IS  EXCEPTION-FILE-RECORD.                       00830051
009000                                                                  00840000
009100 01  EXCEPTION-FILE-RECORD            PIC X(80).                  00850051
010000                                                                  00870000
015700 WORKING-STORAGE SECTION.                                         01300000
015800                                                                  01310000
016700******************************************************************01400000
016800* RECORD LAYOUT FOR INPUT ATG GIFT CARD FILE.                     01410000
016900******************************************************************01420000
017000 01  PL-INPUT-GIFT-RECORD.                                        01430000
017300     05  PL-INPUT-ORD-NBR             PIC 9(10).                  01440034
017200     05  FILLER                       PIC X(01).                  01450020
017300     05  PL-INPUT-ORD-TMST            PIC X(25).                  01460020
017400     05  FILLER                       PIC X(01).                  01470020
017800     05  PL-INPUT-CARD-TYPE           PIC X(12).                  01480020
017900     05  FILLER                       PIC X(01).                  01490037
018800     05  PL-INPUT-CARD                PIC 9(12).                  01522056
018700     05  FILLER                       PIC X(01).                  01530020
018800     05  PL-INPUT-TENDER-AMT          PIC S9(03)V99.              01540020
018900     05  FILLER                       PIC X(03).                  01550020
020300                                                                  01580000
020400******************************************************************01581011
020500* HEADER LAYOUT FOR THE VALID GIFT CARD FILE.                     01582011
020600******************************************************************01583011
017000 01  PL-HEADER-AUDIT-RECORD.                                      01584056
017300     05  PL-HEADER-ORD-NBR            PIC X(10) VALUE             01585020
               'ORDER-NUM'.                                             01585120
017200     05  FILLER                       PIC X(01) VALUE ' '.        01586067
018800     05  PL-HEADER-CARD-NUM           PIC X(13) VALUE             01587067
               'GIFT CARD NUM'.                                         01588067
017200     05  FILLER                       PIC X(01) VALUE ' '.        01589067
018800     05  PL-HEADER-TENDER-AMT         PIC X(10) VALUE             01589167
               'TENDER-AMT'.                                            01589267
018900     05  FILLER                       PIC X(45).                  01589467
020300                                                                  01589511
020400******************************************************************01590000
020500* RECORD LAYOUT OUTPUT VALLID GIFT CARD FILE.                     01600000
020600******************************************************************01610000
017000 01  PV-AUDIT-RECORD.                                             01611056
017300     05  PV-OUTPUT-ORD-NBR            PIC 9(10).                  01612056
017200     05  FILLER                       PIC X(01) VALUE ','.        01613020
018800     05  PV-OUTPUT-CARD-NUM           PIC 9(19).                  01619156
018700     05  FILLER                       PIC X(01) VALUE ','.        01619220
018800     05  PV-OUTPUT-TENDER-AMT         PIC ---9.99.                01619356
018900     05  FILLER                       PIC X(44).                  01619556
020300                                                                  01619610
020400******************************************************************01619711
020500* HEADER LAYOUT FOR THE INVALID GIFT CARD FILE.                   01619811
020600******************************************************************01619911
017000 01  PL-HEADER-EXCEPTION-RECORD.                                  01620059
017300     05  PL-HEADIN-ORD-NBR            PIC X(10) VALUE             01620120
               'ORDER-NUM'.                                             01620220
017200     05  FILLER                       PIC X(01) VALUE SPACE.      01620369
018800     05  PL-HEADIN-CARD-NUM           PIC X(13) VALUE             01620469
               'GIFT CARD NUM'.                                         01620569
018700     05  FILLER                       PIC X(01) VALUE SPACE.      01620669
018800     05  PL-HEADIN-TENDER-AMT         PIC X(10) VALUE             01620769
               'TENDER-AMT'.                                            01620869
018900     05  FILLER                       PIC X(01) VALUE SPACE.      01620969
018800     05  PL-HEADIN-ERROR-MSG          PIC X(17) VALUE             01621069
               'EXCEPTION REMARKS'.                                     01621169
018900     05  FILLER                       PIC X(24) VALUE SPACES.     01621373
020400******************************************************************01621411
020500* RECORD LAYOUT OUTPUT ERRORED FILE LAYOUT.                       01621511
020600******************************************************************01621611
017000 01  PV-EXCEPTION-RECORD.                                         01621757
017300     05  PV-ERROR-ORD-NBR            PIC 9(10).                   01621857
017200     05  FILLER                      PIC X(01) VALUE SPACE.       01621971
018800     05  PV-ERROR-CARD-NUM           PIC 9(12).                   01622057
018700     05  FILLER                      PIC X(01) VALUE SPACE.       01622171
018800     05  PV-ERROR-TENDER-AMT         PIC ---9.99.                 01622257
018900     05  FILLER                      PIC X(05) VALUE SPACES.      01622372
018800     05  PV-ERROR-MSG                PIC X(42).                   01622471
018900     05  FILLER                      PIC X(03) VALUE SPACE.       01622571
020400******************************************************************01622711
020500* TRAILR LAYOUT FOR THE VALID GIFT CARD FILE.                     01622811
020600******************************************************************01622911
017000 01  PL-TOTAL-HEADER-RECORD.                                      01623011
018800     05  PL-TRLHRD-CARD-NUM           PIC X(24) VALUE             01623420
               'TOTAL NUMBER OF CARDS'.                                 01623511
018700     05  FILLER                       PIC X(01) VALUE ','.        01623620
018800     05  PL-TRLHRD-TENDER-AMT         PIC X(24) VALUE             01623720
               'TOTAL TENDERED AMOUNT'.                                 01623811
018900     05  FILLER                       PIC X(31) VALUE SPACES.     01624073
020300                                                                  01624111
020400******************************************************************01624210
020500* TRAILER LAYOUT OUTPUT GIFT CARD FILE.                           01624311
020600******************************************************************01624410
017000 01  PL-TRAILR-RECORD.                                            01624511
017200     05  FILLER                       PIC X(08) VALUE SPACES.     01625071
018800     05  PL-TRAILR-CARD-NUM           PIC Z(06).                  01625120
018700     05  FILLER                       PIC X(01) VALUE SPACE.      01625371
018800     05  PL-TRAILR-TENDER-AMT         PIC  -,---,---,--9.99.      01625420
018900     05  FILLER                       PIC X(48).                  01625773
020300                                                                  01625818
020400******************************************************************01626510
020300                                                                  01626610
020300                                                                  01627010
021500 01  AC-ABEND-CODE                    PIC S9(04) VALUE ZERO       01680020
021600                                                  COMP SYNC.      01690000
021700     88  AC-CONTROL-CARD-ERROR                    VALUE +4003.    01700000
021800     88  AC-TABLE-OVERFLOW-ERROR                  VALUE +4004.    01710000
021900     88  AC-DB2-ERROR                             VALUE +4013.    01720000
022000                                                                  01730000
022100 01  ABEND-CODE                       PIC S9(4)  VALUE ZERO       01740020
022200                                                  COMP SYNC.      01750020
022300                                                                  01760000
022400 01  PS-PROGRAM-SWITCHES.                                         01770000
022800     05  PS-END-OF-CARD-FILE-SW       PIC X(01)   VALUE 'N'.      01810020
022900         88  PS-END-OF-CARD-FILE                  VALUE 'Y'.      01820000
023000         88  PS-NOT-END-OF-CARD-FILE              VALUE 'N'.      01830000
022800     05  PS-VOID-EXISTS-SW            PIC X(01)   VALUE 'N'.      01840056
022900         88  PS-VOID-EXISTS-YES                   VALUE 'Y'.      01850056
023000         88  PS-VOID-EXISTS-NO                    VALUE 'N'.      01860056
024900                                                                  02050000
025000 01  PC-PROGRAM-CONSTANTS.                                        02060000
025100     05  PC-CURRENT-PROGRAM-NAME      PIC X(08)   VALUE           02070020
                'SVKUP087'.                                             02071047
024900                                                                  02072020
026100 01  PV-PROGRAM-VARIABLES.                                        02170000
028500     05  PV-TENDER-AMT                PIC S9(07)V99 VALUE ZEROS.  02417020
028500     05  PV-PROCESSED-TENDER-AMT      PIC S9(07)V99 COMP-3        02418056
                                                          VALUE ZEROS.  02418143
028500     05  PV-TRN-AUTH-TMST-VOID        PIC X(26) VALUE SPACES.     02418240
028500     05  PV-TRN-AUTH-TMST-ORIG        PIC X(26) VALUE SPACES.     02418340
028500     05  PV-ERROR-TOTAL-AMT          PIC S9(07)V99 COMP-3         02419057
                                                          VALUE ZERO.   02419120
028500     05  PV-PARAGRAPH-NAME            PIC  X(20).                 02420020
028500     05  PV-DB2-OPERATION             PIC  X(50).                 02430020
031900                                                                  02830000
032000 01  PA-PROGRAM-ACCUMULATORS.                                     02840000
032100     05  PA-TRANSACTION-COUNT         PIC S9(9) COMP-3            02850020
032100                                                 VALUE ZERO.      02850120
032100     05  PV-INPUT-READ-CNT            PIC  9(6)  VALUE ZERO.      02851020
032100     05  PV-INVLD-WRT-CNT             PIC  9(6)  VALUE ZERO.      02852020
032100     05  PV-VALID-WRT-CNT             PIC  9(6)  VALUE ZERO.      02853020
032200                                                                  02860002
048800***************************************************************** 04570000
048900*  SV GENERAL COPBOOK LAYOUT                                      04580001
049000***************************************************************** 04590000
049100     COPY SVWS004.                                                04600001
049200                                                                  04610000
052300******************************************************************04920000
052400*  WORKING STORAGE AREA FOR DB2 ERROR DISPLAY.                    04930000
052500******************************************************************04940000
052600     COPY DPWS004.                                                04950000
052700                                                                  04960000
057000******************************************************************05590000
057100* SVT TRANSACTION TABLE                                           05600001
057200******************************************************************05610000
057300     EXEC SQL                                                     05620000
057400         INCLUDE SVT00002                                         05630001
057500     END-EXEC.                                                    05640000
057600                                                                  05650000
057700******************************************************************05660000
057800*  DB2 AREA FOR COMMUNICATIONS                                    05670000
057900******************************************************************05680000
058000     EXEC SQL                                                     05690000
058100         INCLUDE SQLCA                                            05700000
058200     END-EXEC.                                                    05710000
058300                                                                  05720000
069500******************************************************************06500000
069600 PROCEDURE DIVISION.                                              06510000
069700******************************************************************06520000
069800 0000-MAINLINE.                                                   06530000
069900                                                                  06540000
070000     PERFORM 1000-INITIALIZE.                                     06550000
070100                                                                  06560000
070200     PERFORM 2000-PROCESS-GIFT-CARD                               06570054
070300         UNTIL PS-END-OF-CARD-FILE.                               06580051
070400                                                                  06590000
070500     PERFORM 9000-EOJ-ROUTINE.                                    06600000
070600                                                                  06610000
070700     GOBACK.                                                      06620000
070800                                                                  06630000
070900******************************************************************06640000
071000*  SET UP FOR PROGRAM PROCESSING BY OPENING ALL FILES, FILLING   *06650000
071100*  THE FIELDS OF THE STANDARD REPORT HEADER, INITIALIZING        *06660000
071200*  NECESSARY VARIABLES, AND READING THE FIRST PROCESSABLE RECORD *06670000
071300******************************************************************06680000
071400 1000-INITIALIZE.                                                 06690000
071500                                                                  06700000
071600     OPEN INPUT  ATG-GIFT-CARD-FILE                               06710001
071700          OUTPUT AUDIT-FILE                                       06720051
071800                 EXCEPTION-FILE.                                  06730051
072700                                                                  06790000
075000     PERFORM 3000-READ-INPUT-ATG-FILE.                            06800056
073400                                                                  06860000
073900     IF PS-END-OF-CARD-FILE                                       06910000
074000        DISPLAY '** ABEND ** ' PC-CURRENT-PROGRAM-NAME            06920000
074100        DISPLAY 'ATG GIFT CARD INPUT FILE EMPTY'                  06930001
074200        SET AC-CONTROL-CARD-ERROR    TO TRUE                      06940022
074300        CALL 'ILBOABN0' USING ABEND-CODE                          06950000
           ELSE                                                         06960051
075000        WRITE AUDIT-FILE-RECORD FROM PL-HEADER-AUDIT-RECORD       07020156
075000        WRITE EXCEPTION-FILE-RECORD                               07022056
075000                                FROM PL-HEADER-EXCEPTION-RECORD   07023059
075100     END-IF.                                                      07030051
075200******************************************************************07040000
075300*  PROCESS THE INPUT FILE                                        *07050000
075400******************************************************************07060000
075500 2000-PROCESS-GIFT-CARD.                                          07070054
073900                                                                  07080011
075000     PERFORM 2100-VERIFY-VOID-EXISTS.                             07120154
           IF PS-VOID-EXISTS-YES                                        07120251
               MOVE SVT00002-TRN-AUTH-TMST TO PV-TRN-AUTH-TMST-VOID     07120451
               PERFORM 2200-GET-ORIG-AUTH-TMST                          07120555
               MOVE SVT00002-TRN-AUTH-TMST TO PV-TRN-AUTH-TMST-ORIG     07120652
               PERFORM 2300-DELETE-VOID-TENDER                          07120756
               PERFORM 2400-ACTIVATE-ORIG-TENDER                        07120856
               PERFORM 2500-COMMIT-CHANGES                              07120956
               PERFORM 2600-WTITE-AUDIT-FILE                            07121056
           ELSE                                                         07121152
              PERFORM 2700-WRITE-EXCEPTION-FILE                         07122056
  5200     END-IF.                                                      07160060
075300     PERFORM 3000-READ-INPUT-ATG-FILE.                            07170056
075400                                                                  07300011
075500******************************************************************13130011
156600*  VALIDATE VOID TRANSACTION IS EXISTS FOR THE GIFT CARD ACTIVITY 13140051
156700******************************************************************13150000
156800 2100-VERIFY-VOID-EXISTS.                                         13160054
156900                                                                  13170000
157000     MOVE PL-INPUT-CARD        TO  SVT00002-CRD-NBR.              13180051
157000     MOVE PL-INPUT-ORD-NBR     TO  SVT00002-POS-OPRT-ID.          13190029
157000     MOVE PL-INPUT-TENDER-AMT  TO  PV-TENDER-AMT.                 13191009
157000     MOVE SPACES               TO  PV-TRN-AUTH-TMST-VOID.         13191140
157000     MOVE PV-TENDER-AMT        TO  SVT00002-ORIG-AUTH-AMT.        13192009
159900     MOVE '2100-VERFIY-VOID-EXIST'                                13193051
160000                               TO PV-PARAGRAPH-NAME.              13194051
           SET PS-VOID-EXISTS-NO     TO TRUE.                           13195066
157100                                                                  13200000
157200     EXEC SQL                                                     13210000
157300         SELECT TRN_AUTH_TMST                                     13220009
157700           INTO :SVT00002-TRN-AUTH-TMST                           13270041
158100           FROM SVT_KOHLS_CRD_TXN                                 13320001
158400          WHERE CRD_NBR       = :SVT00002-CRD-NBR                 13350028
158500            AND POS_OPRT_ID   = :SVT00002-POS-OPRT-ID             13360028
158500            AND TRN_RVRSL_CDE = :SV004-REV-CDE-REVERSAL           13361001
158600            AND TRN_VOID_IND  = :SV004-VOID-TRANS                 13370001
158600            AND ORIG_AUTH_AMT = :SVT00002-ORIG-AUTH-AMT           13371046
158700            AND ACTVY_TYP_CDE = 3                                 13380004
158900           WITH UR                                                13400000
159000     END-EXEC.                                                    13410000
159100                                                                  13420000
159200     EVALUATE SQLCODE                                             13430000
159300         WHEN ZERO                                                13440000
159400             SET PS-VOID-EXISTS-YES TO TRUE                       13450051
159500         WHEN +100                                                13460000
               WHEN -811                                                13461075
                   CONTINUE                                             13470052
159700         WHEN OTHER                                               13480000
160100             MOVE 'SELECT OPS FAILED IN SVT_KOHLS_CRD_TXN  '      13520001
160200                               TO PV-DB2-OPERATION                13530022
160300             PERFORM 9200-SQL-ABEND                               13540000
160400     END-EVALUATE.                                                13550000
160500                                                                  13560000
156500******************************************************************13561001
156600*  GET THE ITEM INFORMATION FOR THE SKU                           13562001
156700******************************************************************13563001
156800 2200-GET-ORIG-AUTH-TMST.                                         13564055
156900                                                                  13565001
157000     MOVE SPACES               TO  PV-TRN-AUTH-TMST-ORIG.         13567340
157000     COMPUTE SVT00002-ORIG-AUTH-AMT = SVT00002-ORIG-AUTH-AMT * -1.13567456
157100                                                                  13568201
157200     EXEC SQL                                                     13569001
157300         SELECT TRN_AUTH_TMST                                     13569109
157700           INTO :SVT00002-TRN-AUTH-TMST                           13569241
158100           FROM SVT_KOHLS_CRD_TXN                                 13569301
158400          WHERE CRD_NBR       = :SVT00002-CRD-NBR                 13569401
158500            AND POS_OPRT_ID   = :SVT00002-POS-OPRT-ID             13569501
158500            AND TRN_RVRSL_CDE = :SV004-REV-CDE-NORMAL             13569601
158600            AND TRN_VOID_IND  = :SV004-VOID-TRANS                 13569701
158600            AND ORIG_AUTH_AMT = :SVT00002-ORIG-AUTH-AMT           13569809
158700            AND ACTVY_TYP_CDE = 3                                 13569909
158900           WITH UR                                                13570009
159000     END-EXEC.                                                    13570109
159100                                                                  13570209
159200     EVALUATE SQLCODE                                             13570309
159300         WHEN ZERO                                                13570409
159400             CONTINUE                                             13570755
159700         WHEN OTHER                                               13571501
159900             MOVE '2200-GET-ORIG-AUTH-TMST'                       13571655
160000                               TO PV-PARAGRAPH-NAME               13571722
160100             MOVE 'SELECT OPS FAILED IN SVT_KOHLS_CRD_TXN  '      13571801
160200                               TO PV-DB2-OPERATION                13571922
                   DISPLAY 'SQL CODE:' SQLCODE                          13572055
160300             PERFORM 9200-SQL-ABEND                               13572101
160400     END-EVALUATE.                                                13572201
160500                                                                  13572301
156500******************************************************************13613356
156600*2300-DELETE-VOID-TENDER                                          13613456
156700******************************************************************13613556
156800 2300-DELETE-VOID-TENDER.                                         13613656
156900                                                                  13613756
           MOVE PV-TRN-AUTH-TMST-VOID TO SVT00002-TRN-AUTH-TMST.        13613856
159900     MOVE '2300-DELETE-VOID-TENDER'                               13613956
160000                                TO PV-PARAGRAPH-NAME.             13614056
156900                                                                  13615056
596200     EXEC SQL                                                     13616056
596300         DELETE FROM SVT_KOHLS_CRD_TXN                            13617056
596400          WHERE CRD_NBR       = :SVT00002-CRD-NBR                 13618056
596700            AND TRN_AUTH_TMST = :SVT00002-TRN-AUTH-TMST           13619056
597400     END-EXEC.                                                    13620056
597500                                                                  13630056
597600     EVALUATE TRUE                                                13640056
597700         WHEN SQLCODE = +0                                        13650056
598100             CONTINUE                                             13660056
598300         WHEN OTHER                                               13670056
160100             MOVE 'DELETE OPS FAILED IN SVT_KOHLS_CRD_TXN  '      13680056
160200                                        TO PV-DB2-OPERATION       13690056
160300             PERFORM 9200-SQL-ABEND                               13700056
599600     END-EVALUATE.                                                13710056
597500                                                                  13720056
156500******************************************************************14110101
156600*2400-ACTIVATE-ORIG-TENDER                                        14110256
156700******************************************************************14110301
156800 2400-ACTIVATE-ORIG-TENDER.                                       14110456
156900                                                                  14110511
           MOVE PV-TRN-AUTH-TMST-ORIG        TO SVT00002-TRN-AUTH-TMST. 14110742
159900     MOVE '2400-ACTIVATE-ORIG-TENDER'                             14110856
160000                                        TO PV-PARAGRAPH-NAME      14110956
156900                                                                  14111001
596200     EXEC SQL                                                     14111101
596300         UPDATE SVT_KOHLS_CRD_TXN                                 14111201
596300         SET TRN_VOID_IND  = :SV004-NOT-VOID-TRANS                14111301
596400          WHERE CRD_NBR       = :SVT00002-CRD-NBR                 14111401
596700            AND TRN_AUTH_TMST = :SVT00002-TRN-AUTH-TMST           14111642
597400     END-EXEC.                                                    14111811
597500                                                                  14111911
597600     EVALUATE TRUE                                                14112011
597700         WHEN SQLCODE = +0                                        14112111
598100             CONTINUE                                             14112256
598300         WHEN OTHER                                               14112311
160100             MOVE 'UPDATE OPS FAILED IN SVT_KOHLS_CRD_TXN  '      14112611
160200                                        TO PV-DB2-OPERATION       14112722
160300             PERFORM 9200-SQL-ABEND                               14112811
599600     END-EVALUATE.                                                14112911
599700                                                                  14113011
156500******************************************************************14114056
156600*2500-COMMIT-CHANGES                                              14115056
156700******************************************************************14116056
156800 2500-COMMIT-CHANGES.                                             14117056
067900                                                                  14118056
067600     EXEC SQL                                                     14119056
067700         COMMIT                                                   14120056
067800     END-EXEC.                                                    14121056
156900                                                                  14122056
597600     EVALUATE TRUE                                                14122156
597700         WHEN SQLCODE = +0                                        14122256
598100             CONTINUE                                             14122356
598300         WHEN OTHER                                               14122456
159900             MOVE '2500-COMMIT-CHANGES'                           14122556
160000                                        TO PV-PARAGRAPH-NAME      14122656
160100             MOVE 'COMMIT OPS FAILED IN SVT_KOHLS_CRD_TXN  '      14122756
160200                                        TO PV-DB2-OPERATION       14122856
160300             PERFORM 9200-SQL-ABEND                               14122956
599600     END-EVALUATE.                                                14123056
597500                                                                  14123156
599700                                                                  14123256
156500******************************************************************14123321
156600*2600-WTITE-AUDIT-FILE                                            14123456
156700******************************************************************14123521
156800 2600-WTITE-AUDIT-FILE.                                           14123656
159400                                                                  14123721
157000     MOVE PL-INPUT-ORD-NBR     TO  PV-OUTPUT-ORD-NBR.             14123856
157000     MOVE PL-INPUT-CARD        TO  PV-OUTPUT-CARD-NUM.            14123956
157000     MOVE PL-INPUT-TENDER-AMT  TO  PV-OUTPUT-TENDER-AMT.          14124056
157000     ADD  PL-INPUT-TENDER-AMT  TO  PV-PROCESSED-TENDER-AMT.       14124156
           ADD  1                    TO  PV-VALID-WRT-CNT.              14124256
156900     WRITE AUDIT-FILE-RECORD FROM PV-AUDIT-RECORD.                14124356
156900                                                                  14127021
156500******************************************************************14128056
156600*2700-WRITE-EXCEPTION-FILE.                                       14129056
156700******************************************************************14130056
156800 2700-WRITE-EXCEPTION-FILE.                                       14130156
159400                                                                  14130256
157000     MOVE PL-INPUT-ORD-NBR     TO  PV-ERROR-ORD-NBR.              14130357
157000     MOVE PL-INPUT-CARD        TO  PV-ERROR-CARD-NUM.             14130457
157000     MOVE PL-INPUT-TENDER-AMT  TO  PV-ERROR-TENDER-AMT.           14130557
157000     ADD  PL-INPUT-TENDER-AMT  TO  PV-ERROR-TOTAL-AMT.            14130657
           ADD  1                    TO  PV-INVLD-WRT-CNT.              14130758
           MOVE 'VERIFY TRANSACTION AMOUNT AND ORDER DETAIL'            14130872
                                     TO PV-ERROR-MSG.                   14130972
156900     WRITE EXCEPTION-FILE-RECORD FROM PV-EXCEPTION-RECORD.        14131057
156900                                                                  14131356
156900                                                                  14131456
160800******************************************************************14131556
160900 3000-READ-INPUT-ATG-FILE.                                        14131656
161000                                                                  14131756
073100     READ ATG-GIFT-CARD-FILE       INTO PL-INPUT-GIFT-RECORD      14131856
073200        AT END                                                    14131956
073300           SET PS-END-OF-CARD-FILE TO TRUE                        14132056
073200        NOT AT END                                                14132156
161200           ADD 1                   TO PV-INPUT-READ-CNT.          14132256
073400                                                                  14132356
161300                                                                  14133001
162400******************************************************************14610000
162500*  CLOSE ALL FILES.                                              *14620000
162600******************************************************************14630000
162700 9000-EOJ-ROUTINE.                                                14640000
162800                                                                  14650000
           INITIALIZE  PL-TRAILR-RECORD.                                14800111
157000     WRITE EXCEPTION-FILE-RECORD FROM PL-TOTAL-HEADER-RECORD      14800364
074900                                                                  14801011
157000     MOVE PV-INVLD-WRT-CNT        TO PL-TRAILR-CARD-NUM.          14802159
157000     MOVE PV-ERROR-TOTAL-AMT      TO PL-TRAILR-TENDER-AMT.        14802263
157000     WRITE EXCEPTION-FILE-RECORD FROM PL-TRAILR-RECORD.           14802368
075100                                                                  14804011
157000     WRITE AUDIT-FILE-RECORD FROM PL-TOTAL-HEADER-RECORD.         14804163
075100                                                                  14806111
075100     INITIALIZE  PL-TRAILR-RECORD.                                14806212
157000     MOVE PV-VALID-WRT-CNT        TO PL-TRAILR-CARD-NUM.          14806465
157000     MOVE PV-PROCESSED-TENDER-AMT TO PL-TRAILR-TENDER-AMT.        14806559
157000     WRITE AUDIT-FILE-RECORD FROM PL-TRAILR-RECORD.               14806668
075100                                                                  14806911
075100                                                                  14807011
165500     DISPLAY '**************************************'             14810007
165500     DISPLAY '********     RUN DETAIL        *******'             14810107
165500     DISPLAY '**************************************'             14810207
165500     DISPLAY '                                      '             14810307
165500     DISPLAY ' NUMBER OF INPUT ATG CARDS READ:  '                 14811007
165600             PV-INPUT-READ-CNT.                                   14820002
165900     DISPLAY ' NUMBER OF CARDS REVERSE VOIDED:  '                 14830002
166000             PV-VALID-WRT-CNT.                                    14840002
166100     DISPLAY ' NUMBER OF CARDS ERRORED OUT   :  '                 14850002
166200             PV-INVLD-WRT-CNT.                                    14860002
165500     DISPLAY '                                      '             14870007
165500     DISPLAY '**************************************'             14880007
166700                                                                  14930000
176200     CLOSE ATG-GIFT-CARD-FILE                                     15840002
176300           AUDIT-FILE                                             15850058
176500           EXCEPTION-FILE.                                        15860058
177200                                                                  15910000
177300******************************************************************15920000
177400* 9200-SQL-ABEND                                                  15930000
177500*     ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.15940000
177600******************************************************************15950000
177700 9200-SQL-ABEND.                                                  15960000
177800                                                                  15970000
177900     DISPLAY '** ABEND        **'.                                15980000
178000     DISPLAY '** PROGRAM      ** = ' PC-CURRENT-PROGRAM-NAME.     15990000
178100     DISPLAY '** PARAGRAPH    ** = ' PV-PARAGRAPH-NAME.           16000000
178200     DISPLAY '** OPERATION    ** = ' PV-DB2-OPERATION.            16010000
178300                                                                  16020000
178400******************************************************************16030000
178500* COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     16040000
178600* TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      16050000
178700******************************************************************16060000
178800     COPY DPPD004.                                                16070000
178900                                                                  16080000
179000     SET AC-DB2-ERROR TO TRUE.                                    16090000
179100     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         16100000
179200                                                                  16110000
