000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400******************************************************************00040000
000500*  THIS IS A BATCH VERSION OF THE CICS PROGRAM SUKCS557          *00050002
000600* THIS PROGRAM READS IN A CONVEYOR DIVERT TRANSACTION FILE AND    00060002
000700* UPDATES THE VARIOUS DB2 TABLES.                                 00070002
000800******************************************************************00080000
000700* CHANGE LOG:                                                     00090037
000700*                                                                 00091037
000700* 02/14/2023    JEAN KURK                  CHG0281369             00092037
000700*               REMOVE COPYBOOK FOR UPC CHECK DIGIT ROUTINE       00093037
000800******************************************************************00100037
001400                                                                  00140000
001500 PROGRAM-ID.       SUKUT557.                                      00150002
001600 AUTHOR.           AL PETERS.                                     00160002
001700 INSTALLATION.     KOHLS.                                         00170000
001800 DATE-WRITTEN      AUGUST 2007.                                   00180002
001900 DATE-COMPILED.                                                   00190000
002000                                                                  00200000
002100******************************************************************00210000
002700 ENVIRONMENT DIVISION.                                            00270000
002701                                                                  00270101
002710 CONFIGURATION SECTION.                                           00271001
002720                                                                  00272001
002730 SOURCE-COMPUTER.                          IBM-3090.              00273001
002740 OBJECT-COMPUTER.                          IBM-3090.              00274001
002750                                                                  00275001
002760 INPUT-OUTPUT SECTION.                                            00276001
002770                                                                  00277001
002780 FILE-CONTROL.                                                    00278009
002790                                                                  00279001
002791     SELECT  CONV-DIVERT-FILE                                     00279108
002792         ASSIGN TO INP01.                                         00279201
002793                                                                  00279301
002794******************************************************************00279402
002800 DATA DIVISION.                                                   00280000
002801******************************************************************00280102
002810                                                                  00281001
002820 FILE SECTION.                                                    00282001
002830                                                                  00283001
002840 FD  CONV-DIVERT-FILE                                             00284008
002850     RECORDING MODE IS F                                          00285001
002860     LABEL RECORDS ARE STANDARD                                   00286001
002870     BLOCK CONTAINS 0 RECORDS.                                    00287001
002880 01  DIVERT-RECORD                PIC X(57).                      00288016
002890                                                                  00289001
002891******************************************************************00289102
002900 WORKING-STORAGE SECTION.                                         00290000
002910******************************************************************00291002
003000                                                                  00300000
003100     COPY PCWS208.                                                00310000
003200                                                                  00320002
006000*                                                                 00600000
006100 01  PC-PROGRAM-CONSTANTS.                                        00610000
006200     05  PC-MAX-RETRIES                  PIC S9(03)  VALUE +3     00620000
006300                                                     COMP-3.      00630000
006400     05  PC-CURRENT-PGM-NAME             PIC  X(08)  VALUE        00640000
006500         'SUKUT557'.                                              00650002
006800     05  PC-DEFAULT-TMST            PIC X(26)                     00680000
006900                              VALUE '9999-09-09-09.09.09.999999'. 00690000
007000*                                                                 00700000
007100 01  DK-DB2-KEYS.                                                 00710000
007200     05  DK-BRCDE-NBR                    PIC  X(22) VALUE SPACES. 00720000
007300     05  DK-DATE                         PIC  X(10) VALUE SPACES. 00730000
007400     05  DK-TIME                         PIC  X(08) VALUE SPACES. 00740000
007500     05  DK-FUNC-CDE                     PIC  X(06) VALUE SPACES. 00750000
007600     05  DK-LOC-ID                       PIC S9(04)  COMP.        00760000
007700     05  DK-STR-NBR                      PIC S9(04)  COMP.        00770000
007800     05  DK-CTN                          PIC S9(18)V COMP-3.      00780000
007900     05  DK-SHIPT-UNT-ID                 PIC S9(18)V COMP-3       00790000
008000                                                    VALUE ZERO.   00800000
008100     05  DK-OPER-UNT-ID                  PIC S9(04)  COMP.        00810000
008200     05  DK-DIVERT-ID                    PIC S9(09)  COMP.        00820000
008300     05  DK-DOOR-ID                      PIC X(04)  VALUE SPACES. 00830000
008400     05  DK-ERROR-CODE                   PIC X(03)  VALUE ZERO.   00840000
008500     05  DK-PRC-TMST                     PIC X(26)  VALUE SPACES. 00850000
008600     05  DK-RECS-READ                    PIC S9(9)   COMP         00860000
008700                                                    VALUE ZERO.   00870000
008800                                                                  00880000
008900 01  PS-PROGRAM-SWITCHES.                                         00890000
009000     05  PS-CHILD-SW                     PIC X(01)   VALUE 'N'.   00900000
009100         88  PS-ALL-CHILD                            VALUE 'N'.   00910000
009200         88  PS-END-OF-CHILD                         VALUE 'Y'.   00920000
009300     05  PS-DEST-MATCH-FOUND-SW          PIC X(01)   VALUE 'N'.   00930000
009400         88  PS-NO-DEST-MATCH-FOUND                  VALUE 'N'.   00940000
009500         88  PS-DEST-MATCH-FOUND                     VALUE 'Y'.   00950000
009600     05  PS-CARTON-SW                    PIC X(01)   VALUE 'N'.   00960000
009700         88  PS-ALL-CARTON                           VALUE 'N'.   00970000
009800         88  PS-END-OF-CARTON                        VALUE 'Y'.   00980000
009900     05  PS-LOG-TO-ERR-FILE-SW           PIC X(01)   VALUE ' '.   00990000
010000         88  PS-LOG-TO-ERR-FILE                      VALUE 'Y'.   01000000
010100         88  PS-DO-NOT-LOG                           VALUE 'N'.   01010000
010200     05  PS-PARM-REC-FOUND-SW            PIC X(01)   VALUE ' '.   01020000
010300         88  PS-NO-PARM-REC-FOUND                    VALUE 'N'.   01030000
010400         88  PS-PARM-REC-FOUND                       VALUE 'Y'.   01040000
010500     05  PS-DUPLICATE-CARTON-SW          PIC X(01)   VALUE ' '.   01050000
010600         88  PS-NO-DUPLICATE-CARTON                  VALUE 'N'.   01060000
010700         88  PS-DUPLICATE-CARTON                     VALUE 'Y'.   01070000
010800     05  PS-RDM-FACILITY-SW              PIC X(01)   VALUE 'N'.   01080000
010900         88  PS-RDM-FACILITY-YES                     VALUE 'Y'.   01090000
011000         88  PS-RDM-FACILITY-NO                      VALUE 'N'.   01100000
011100     05  PS-RDM-RECORD-FOUND-SW          PIC X(01)   VALUE 'N'.   01110000
011200         88  PS-RDM-RECORD-FOUND                     VALUE 'Y'.   01120000
011300         88  PS-RDM-RECORD-NOT-FOUND                 VALUE 'N'.   01130000
011400     05  PS-OTBND-CART-FOUND-SW          PIC X(01)   VALUE 'N'.   01140000
011500         88  PS-OTBND-CART-FOUND-YES                 VALUE 'Y'.   01150000
011600         88  PS-OTBND-CART-FOUND-NO                  VALUE 'N'.   01160000
011700     05  PS-PART-RECEIVE-SW              PIC  X(01)  VALUE 'S'.   01170000
011800         88  PS-PART-RECEIVE                         VALUE 'P'.   01180000
011900         88  PS-COMP-RECEIVE                         VALUE 'C'.   01190000
012000         88  PS-ERROR-RECEIVE                        VALUE 'E'.   01200000
012100         88  PS-START-RECEIVE                        VALUE 'S'.   01210000
012200     05  PS-DOOR-CONVERT-NOT-FOUND-SW    PIC X(01)   VALUE 'N'.   01220000
012300         88  PS-DOOR-CONVERT-FOUND                   VALUE 'Y'.   01230000
012400         88  PS-DOOR-CONVERT-NOT-FOUND               VALUE 'N'.   01240000
012500     05  PS-STORE-NUMBER-NOT-FOUND-SW    PIC X(01)   VALUE 'N'.   01250000
012600         88  PS-STORE-NUMBER-FOUND                   VALUE 'Y'.   01260000
012700         88  PS-STORE-NUMBER-NOT-FOUND               VALUE 'N'.   01270000
012800     05  PS-END-DVT-FILE-SWITCH          PIC X(01)   VALUE 'N'.   01280009
012900         88  PS-END-DVT-FILE                         VALUE 'Y'.   01290009
013000         88  PS-NOT-END-DVT-FILE                     VALUE 'N'.   01300009
013100                                                                  01310000
013200 01  PV-PROGRAM-VARIABLES.                                        01320000
013210     05  PV-DIVERT-TIMESTAMP.                                     01321022
013220         10  PV-DIVERT-DTE               PIC X(10).               01322022
013230         10  FILLER                      PIC X(01) VALUE '-'.     01323022
013240         10  PV-DIVERT-TM                PIC X(08).               01324022
013250         10  FILLER                      PIC X(01) VALUE '.'.     01325022
013260         10  FILLER                      PIC X(06) VALUE '000000'.01326028
013261     05 FILLER REDEFINES PV-DIVERT-TIMESTAMP.                     01326128
013262         10  PV-DIV-TMST                 PIC X(26).               01326228
013270                                                                  01327022
013300     05  PV-OTBND-CART-SHIPT-UNT-ID      PIC S9(18)V COMP-3       01330000
013400                                                    VALUE ZERO.   01340000
013500     05  PV-SHIPT-UNIT-ID                PIC  9(18).              01350000
013600     05  PV-PRNT-CART-ID                 PIC S9(18)V COMP-3       01360000
013700                                                    VALUE ZERO.   01370000
013800     05  PV-DISP-SHIPT-UNT-ID            PIC S9(18).              01380000
013900     05  PV-DISP-TCP-COUNT               PIC  9(04).              01390000
014000     05  PV-DISPLAY-SQLCODE              PIC S9(09).              01400000
014100     05  PV-ACTV-IND                     PIC  X(01).              01410000
014200     05  PV-ENTRIES                      PIC S9(03)  VALUE ZEROS  01420000
014300                                                     COMP-3.      01430000
014310     05  PV-DVT-RECS-READ                PIC 9(09) VALUE ZERO.    01431017
014400     05  PV-SQL-CODE                     PIC 9(09).               01440000
014500     05  PV-HOLD-TIMESTAMP               PIC X(26).               01450000
014600     05  PV-TIMESTAMP                    PIC X(26).               01460000
014700     05  PV-DB2-CURRENT-TMST             PIC  X(26).              01470000
014800     05  PV-CONTAINER-ID.                                         01480000
014900         10  PV-CONTAINER-00             PIC X(02).               01490000
015000         10  PV-SHIPT-UNT-ID             PIC 9(18).               01500000
015100         10  PV-CONTAINER-SPACES         PIC X(02).               01510000
015200     05  FILLER REDEFINES PV-CONTAINER-ID.                        01520000
015300         10  FILLER                      PIC X(05).               01530000
015400         10  PV-STORE-NBR                PIC 9(04).               01540000
015500         10  FILLER                      PIC X(13).               01550000
015600     05  PV-SHIPT-UNT-ID-REDEF           PIC 9(18).               01560000
015700     05  FILLER REDEFINES PV-SHIPT-UNT-ID-REDEF.                  01570000
015800         10  PV-SHIPT-UNT-ID-FIL-1       PIC 9(03).               01580000
015900         10  PV-STORE-NUMBER             PIC 9(04).               01590000
016000         10  PV-SHIPT-UNT-ID-FIL-2       PIC 9(11).               01600000
016100     05  PV-DATE.                                                 01610000
016200         10  PV-DATE-CCYY                PIC X(04).               01620000
016300         10  PV-DATE-DASH1               PIC X(01)  VALUE '-'.    01630000
016400         10  PV-DATE-MM                  PIC X(02).               01640000
016500         10  PV-DATE-DASH2               PIC X(01)  VALUE '-'.    01650000
016600         10  PV-DATE-DD                  PIC X(02).               01660000
016700     05  PV-TIME.                                                 01670000
016800         10  PV-TIME-HH                  PIC X(02).               01680000
016900         10  PV-TIME-DOT1                PIC X(01)  VALUE '.'.    01690000
017000         10  PV-TIME-MM                  PIC X(02).               01700000
017100         10  PV-TIME-DOT2                PIC X(01)  VALUE '.'.    01710000
017200         10  PV-TIME-SS                  PIC X(02).               01720000
017300     05  PV-IN-DATE                      PIC 9(08).               01730000
017400     05  FILLER REDEFINES PV-IN-DATE.                             01740000
017500         10  PV-IN-DATE-CCYY             PIC X(04).               01750000
017600         10  PV-IN-DATE-MM               PIC X(02).               01760000
017700         10  PV-IN-DATE-DD               PIC X(02).               01770000
017800     05  PV-IN-TIME                      PIC 9(06).               01780000
017900     05  FILLER REDEFINES PV-IN-TIME.                             01790000
018000         10  PV-IN-TIME-HH               PIC X(02).               01800000
018100         10  PV-IN-TIME-MM               PIC X(02).               01810000
018200         10  PV-IN-TIME-SS               PIC X(02).               01820000
018300     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  01830000
018400                                                     COMP SYNC.   01840000
018500     05  PV-OTBND-CART-INSERT-COUNT      PIC S9(07) COMP-3        01850000
018600                                             VALUE ZERO.          01860000
018700     05  PV-OTBND-CART-DUP-COUNT         PIC S9(07) COMP-3        01870000
018800                                             VALUE ZERO.          01880000
018900     05  PV-SHUUPC-INSERT-COUNT          PIC S9(07) COMP-3        01890000
019000                                             VALUE ZERO.          01900000
019100     05  PV-SHUUPC-DUP-COUNT             PIC S9(07) COMP-3        01910000
019200                                             VALUE ZERO.          01920000
019300     05  PV-PARTIAL-TCP-COUNT            PIC S9(04)  VALUE ZEROS  01930000
019400                                                     COMP SYNC.   01940000
019500     05  PV-RETRY-COUNTER                PIC S9(04)  VALUE ZEROS  01950000
019600                                                     COMP SYNC.   01960000
019700     05  PV-TASK-X.                                               01970000
019800         10  PV-TASK                     PIC 9(07)   VALUE ZERO.  01980000
019900     05  PV-RECEIVE-LENGTH               PIC S9(04)  VALUE +0     01990000
020000                                                     COMP SYNC.   02000000
020100     05  PV-CICS-MSG-AREA                PIC  X(80)  VALUE SPACE. 02010000
020200                                                                  02020000
020300     05  PV-RETCODE                      PIC  9(08)  VALUE ZEROS. 02030000
020400     05  PV-TCPLENG                      PIC  9(08)  VALUE ZEROS. 02040000
020500     05  PV-ERRNO                        PIC  9(08)  VALUE ZEROS. 02050000
020600     05  PV-TCP-BUF                      PIC  X(57)  VALUE SPACES.02060000
020700                                                                  02070000
020800     05  PV-TCP-EXP-LENGTH               PIC 9(08)   VALUE 57.    02080000
020900     05  PV-TCP-RET-LENGTH               PIC 9(08)   VALUE ZEROS. 02090000
021000     05  PV-TCP-REM-LENGTH               PIC 9(08)   VALUE ZEROS. 02100000
021100     05  PV-TCP-PRCSD-LENGTH             PIC 9(08)   VALUE ZEROS. 02110000
021200     05  PV-ABEND-CODE                   PIC S9(04)  COMP SYNC    02120000
021300                                                 VALUE ZERO.      02130000
021400     05  PV-ERROR-COUNT                  PIC 9(03)   VALUE ZERO.  02140000
021500     05  PV-SOCK-ID                      PIC 9(04).               02150000
021600     05  PV-CID-DOMAIN-LSTN              PIC 9(08).               02160000
021700     05  PV-NBR-BYTES                    PIC 9(08).               02170000
021800                                                                  02180000
021810     05  PV-PARAGRAPH                 PIC  X(30) VALUE SPACE.     02181003
021811     05  PV-DIVERT-NBR                PIC  X(04) VALUE SPACE.     02181118
021812     05  PV-DC-NBR                    PIC  X(04) VALUE SPACE.     02181207
021813     05  PV-STR-NBR                   PIC  X(04) VALUE SPACE.     02181307
021814     05  PV-DOOR-NBR                  PIC  X(04) VALUE SPACE.     02181407
021815     05  PV-SHIPT-ID                  PIC  X(18) VALUE SPACE.     02181507
021816     05  PV-ERR-CNT                   PIC  9(09) VALUE ZERO.      02181609
021820     05  PV-DB2-FUNCTION              PIC  X(30) VALUE SPACE.     02182003
021830     05  PV-ABEND-TABLE-1             PIC  X(20) VALUE SPACE.     02183003
021840     05  PV-ABEND-TABLE-2             PIC  X(20) VALUE SPACE.     02184003
021850     05  PV-ABEND-TABLE-3             PIC  X(20) VALUE SPACE.     02185003
021860     05  PV-ABEND-TABLE-4             PIC  X(20) VALUE SPACE.     02186003
021870     05  PV-ABEND-TABLE-5             PIC  X(20) VALUE SPACE.     02187003
021880     05  PV-ERROR-MSG-1               PIC  X(60) VALUE SPACE.     02188003
021890     05  PV-ERROR-MSG-2               PIC  X(60) VALUE SPACE.     02189003
021891     05  PV-ERROR-MSG-3               PIC  X(60) VALUE SPACE.     02189103
021900*                                                                 02190000
021910     05  PV-INPUT-COUNT               PIC 9(05)  VALUE ZERO.      02191033
021920     05  PV-OUTPUT-COUNT              PIC 9(05)  VALUE ZERO.      02192033
022000*                                                                 02200000
022100 01  PT-MSG-TABLE.                                                02210000
022200     05  PT-MESSAGES OCCURS 40 TIMES INDEXED BY PT-MSG-IDX.       02220000
022300         10  PT-MSG.                                              02230000
022400             15 PT-MESSAGE               PIC X(52).               02240000
022500             15 FILLER                   PIC X(1).                02250000
022600             15 PT-TASK                  PIC 9(07).               02260000
022700             15 FILLER                   PIC X(1).                02270000
022800                                                                  02280000
022900                                                                  02290000
023000 01  PT-TCP-RECEIVE-TABLE.                                        02300000
023100     05  PT-TCP-RECEIVE OCCURS 50 TIMES                           02310000
023200                        INDEXED BY PT-RECEIVE-IDX.                02320000
023300         10  PT-TCP-RECEIVE-CHAR         PIC X(01).               02330000
023400                                                                  02340000
023500 01  PT-TCP-ASSEMBLE-TABLE.                                       02350000
023600     05  PT-TCP-DATA-ASSEMBLE OCCURS 50 TIMES                     02360000
023700                              INDEXED BY PT-ASSEMBLE-IDX.         02370000
023800         10  PT-TCP-DATA-CHAR            PIC X(01).               02380000
023900/                                                                 02390000
024000                                                                  02400000
024500                                                                  02450000
024600*                                                                 02460000
024700*  RECORD LAYOUT BEING TRANSMITTED FROM THE CONVEYOR SYSTEM       02470000
024800*                                                                 02480000
024900     COPY SURD014.                                                02490000
025000                                                                  02500000
025600*                                                                 02560000
025700*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                02570000
025800*                                                                 02580000
025900     COPY DPWS013.                                                02590000
026000                                                                  02600000
026010*                                                                 02601005
026020*  RECORD LAYOUT FOR SYSTEM MESSAGES FILE USED FOR CICS MESSAGES  02602005
026030*                                                                 02603005
026040     COPY DPRD507I.                                               02604005
026050                                                                  02605005
026100*                                                                 02610005
026200*  FORMATS CICS SYSTEM MESSAGES FOR NON-ARCHITECTURE PROGRAMS     02620005
026300*                                                                 02630005
026400     COPY DPWS011.                                                02640005
026500                                                                  02650005
027100*                                                                 02710000
027200*  DATE VALIDATION CALLING PARAMETER LIST                        *02720000
027300*                                                                 02730000
027400     COPY DPWS500.                                                02740000
027500                                                                  02750000
027600*                                                                 02760000
028200*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE KOHLS/RETEK        02820000
028300*  PARM TABLE                                                     02830000
028400     EXEC SQL                                                     02840000
028500          INCLUDE TKRPRPM                                         02850000
028600     END-EXEC.                                                    02860000
028700                                                                  02870000
028800*                                                                 02880000
028900*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE CONTAINER DIVERT   02890000
029000*  TABLE                                                          02900000
029100     EXEC SQL                                                     02910000
029200         INCLUDE TSUCRDV                                          02920000
029300     END-EXEC.                                                    02930000
029400                                                                  02940000
029500*                                                                 02950000
029600*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      02960000
029700*  TABLE                                                          02970000
029800     EXEC SQL                                                     02980000
029900         INCLUDE SUT00024                                         02990000
030000     END-EXEC.                                                    03000000
030100                                                                  03010000
030200*                                                                 03020000
030300*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING           03030000
030400*  UPC TABLE                                                      03040000
030500*                                                                 03050000
030600*    EXEC SQL                                                     03060000
030700*         INCLUDE TSHUUPC                                         03070000
030800*    END-EXEC.                                                    03080000
030900                                                                  03090000
031000*                                                                 03100000
031100*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE CEPLIT TABLE       03110000
031200*                                                                 03120000
031300*    EXEC SQL                                                     03130000
031400*         INCLUDE TCEPLIT                                         03140000
031500*    END-EXEC.                                                    03150000
031600                                                                  03160000
031700*                                                                 03170000
031800*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE UPC SKU TABLE      03180000
031900*                                                                 03190000
032000*    EXEC SQL                                                     03200000
032100*         INCLUDE T-U-P-C-S-K-U                                   03210000
032200*    END-EXEC.                                                    03220000
032300                                                                  03230000
032400*                                                                 03240000
032500*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE UPLOAD ERROR TABLE 03250000
032600*                                                                 03260000
032700     EXEC SQL                                                     03270000
032800         INCLUDE TUPLDER                                          03280000
032900     END-EXEC.                                                    03290000
033000                                                                  03300000
033100*                                                                 03310000
033200*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE CONTROL DC DOOR    03320000
033300*  TABLE                                                          03330000
033400     EXEC SQL                                                     03340000
033500          INCLUDE TCNDCDR                                         03350000
033600     END-EXEC.                                                    03360000
033700                                                                  03370000
033800     EXEC SQL                                                     03380000
033900          INCLUDE TCNDRST                                         03390000
034000     END-EXEC.                                                    03400000
034100                                                                  03410000
034200     EXEC SQL                                                     03420000
034300          INCLUDE TCNDRTY                                         03430000
034400     END-EXEC.                                                    03440000
034500                                                                  03450000
034600     EXEC SQL DECLARE CHILD-CSR CURSOR FOR                        03460000
034700         SELECT UNT1.SHIPT_UNT_ID                                 03470000
034800            ,   UNT1.DEST_LOC_NBR                                 03480000
034900         FROM   SUT_OTBND_CART UNT1                               03490000
035000         WHERE  UNT1.PRNT_CART_ID      = :DK-SHIPT-UNT-ID         03500000
035100          AND   UNT1.SHIPT_UNT_ID     <> :DK-SHIPT-UNT-ID         03510000
035200          AND   UNT1.ACTV_IND          = 'Y'                      03520000
035300          AND   UNT1.MSTR_CART_IND     = 'N'                      03530000
035400     END-EXEC.                                                    03540000
035500                                                                  03550000
035600*                                                                 03560000
035700*  COMMUNICATIONS AREA FOR DB2                                    03570000
035800*                                                                 03580000
035900     EXEC SQL                                                     03590000
036000         INCLUDE SQLCA                                            03600000
036100     END-EXEC.                                                    03610000
036200     COPY SQLCA2.                                                 03620000
036300*                                                                 03630000
036400 01  PC-PROGRAM-CONSTANTS.                                        03640000
036500     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        03650000
036600         'SUKCS557'.                                              03660000
036700*    05  PC-CALENDAR-PGM                 PIC  X(08)  VALUE        03670000
036800*        'DPKUT500'.                                              03680000
036900*                                                                 03690000
037000 01  PS-PROGRAM-SWITCHES.                                         03700000
037100     05  PS-ACTIVE-XREF-ROW-FOUND-SW     PIC  X(01)  VALUE 'Y'.   03710000
037200         88  PS-ACTIVE-XREF-ROW-FOUND                VALUE 'Y'.   03720000
037300         88  PS-ACTIVE-XREF-ROW-NOT-FOUND            VALUE 'N'.   03730000
037400*                                                                 03740000
037500                                                                  03750000
037600**                                                                03760000
037700 PROCEDURE DIVISION.                                              03770000
037710************************************************************      03771001
037720*  MAINLINE LOGIC FOR PROGRAM                                     03772001
037730************************************************************      03773001
037740 0000-MAINLINE.                                                   03774001
037750     PERFORM 1000-INITIALIZE.                                     03775001
037760                                                                  03776001
037770     PERFORM 2000-PROCESS-DIVERT-REQUEST                          03777001
037780         UNTIL PS-ERROR-RECEIVE                                   03778031
037781            OR PS-END-DVT-FILE.                                   03778131
037790                                                                  03779001
037791     DISPLAY '******************'.                                03779133
037792     DISPLAY '*** INPUT COUNT:  '  PV-INPUT-COUNT.                03779233
037793     DISPLAY '*** ERROR COUNT:  '  PV-ERROR-COUNT.                03779335
037794     DISPLAY '*** OUTPUT-COUNT: '  PV-OUTPUT-COUNT.               03779435
037795     DISPLAY '******************'.                                03779533
037796                                                                  03779633
037797     PERFORM 9000-EOJ.                                            03779733
037798                                                                  03779833
037799     STOP RUN.                                                    03779933
037800                                                                  03780033
037801************************************************************      03780133
037802*  INITIALIZATION PARAGRAPH                                       03780233
037803************************************************************      03780333
037804                                                                  03780433
037810 1000-INITIALIZE.                                                 03781001
037820     OPEN INPUT CONV-DIVERT-FILE.                                 03782009
037821                                                                  03782101
037822     MOVE ' 0000-PROGRAM-MAINLINE'                                03782201
037823                                 TO DP013-PARAGRAPH.              03782301
037824     PERFORM 1500-READ-DIVERT-FILE-INPUT.                         03782408
037830                                                                  03783001
040500     MOVE 'CNVERR'         TO DK-FUNC-CDE.                        04050000
040600     PERFORM 7900-CHECK-PARM-TABLE.                               04060000
040700     MOVE PV-TIMESTAMP     TO PV-HOLD-TIMESTAMP.                  04070000
040800     IF PS-PARM-REC-FOUND                                         04080000
040900         IF KRPRPM-FUNC-TXT = 'Y'                                 04090000
041000             SET PS-LOG-TO-ERR-FILE  TO TRUE                      04100000
041100         ELSE                                                     04110000
041200             SET PS-DO-NOT-LOG      TO TRUE                       04120000
041300         END-IF                                                   04130000
041400     ELSE                                                         04140000
041500         SET PS-DO-NOT-LOG      TO TRUE                           04150000
041600     END-IF.                                                      04160000
041610                                                                  04161008
041700************************************************************      04170008
041800* READ THE CONVEYOR DIVERT TRANS FILE                             04180010
041900************************************************************      04190008
042000 1500-READ-DIVERT-FILE-INPUT.                                     04200010
042100     READ CONV-DIVERT-FILE                                        04210010
042200         INTO SU014-CONV-DIVERT-RECORD                            04220010
042300            AT END                                                04230010
042400               SET PS-END-DVT-FILE                                04240010
042500                          TO TRUE.                                04250010
042600     IF PS-NOT-END-DVT-FILE                                       04260010
042700         ADD 1    TO PV-DVT-RECS-READ                             04270010
042710         ADD 1    TO PV-INPUT-COUNT                               04271033
042800     END-IF.                                                      04280010
044100                                                                  04410008
062900******************************************************************06290000
063000*    DETERMINE WHAT TYPE OF ACTION WAS REQUESTED.                 06300000
063100******************************************************************06310000
063200 2000-PROCESS-DIVERT-REQUEST.                                     06320000
063300                                                                  06330000
063400     EXEC SQL                                                     06340000
063500         SET :PV-DB2-CURRENT-TMST = CURRENT TIMESTAMP             06350000
063600     END-EXEC.                                                    06360000
063700     MOVE ' 2000-PROCESS-DIVERT-REQUEST'                          06370000
063800                                 TO DP013-PARAGRAPH.              06380000
063900     MOVE SU014-BAR-CODE         TO DK-BRCDE-NBR.                 06390001
064000     IF SU014-DC-NUMBER = 865                                     06400000
064100         MOVE 1   TO PC-MAX-RETRIES                               06410000
064200     END-IF.                                                      06420000
064300     MOVE '000'            TO DK-ERROR-CODE.                      06430000
064400     MOVE SU014-BAR-CODE   TO  PV-CONTAINER-ID.                   06440000
064500     IF PV-SHIPT-UNT-ID IS NUMERIC AND                            06450000
064600        SU014-DC-NUMBER IS NUMERIC AND                            06460000
064700        SU014-DIVERT-NUMBER IS NUMERIC                            06470000
064800         SET PS-DOOR-CONVERT-FOUND TO TRUE                        06480000
064900         PERFORM 7800-VALIDATE-DIVERT                             06490000
065000         SET PS-STORE-NUMBER-FOUND TO TRUE                        06500000
065100         IF PS-DOOR-CONVERT-FOUND AND                             06510000
065200            CNDCDR-DOOR-TYP-CDE = 'SH'                            06520000
065300             PERFORM 8700-VALIDATE-STORE-NBR                      06530000
065400         END-IF                                                   06540000
065500         IF PS-STORE-NUMBER-NOT-FOUND                             06550000
065600             MOVE '107'    TO DK-ERROR-CODE                       06560000
065700             PERFORM 7700-WRITE-UPLOAD-ERROR-TABLE                06570000
065800         END-IF                                                   06580000
065900         IF PV-DB2-CURRENT-TMST > PV-HOLD-TIMESTAMP               06590000
066000             PERFORM 7900-CHECK-PARM-TABLE                        06600000
066100             MOVE PV-TIMESTAMP     TO PV-HOLD-TIMESTAMP           06610000
066200             IF PS-PARM-REC-FOUND                                 06620000
066300                 IF KRPRPM-FUNC-TXT = 'Y'                         06630000
066400                     SET PS-LOG-TO-ERR-FILE  TO TRUE              06640000
066500                 ELSE                                             06650000
066600                     SET PS-DO-NOT-LOG      TO TRUE               06660000
066700                 END-IF                                           06670000
066800             ELSE                                                 06680000
066900                 SET PS-DO-NOT-LOG      TO TRUE                   06690000
067000             END-IF                                               06700000
067100         END-IF                                                   06710000
067200         IF PS-DOOR-CONVERT-NOT-FOUND                             06720000
067300             MOVE '101'    TO DK-ERROR-CODE                       06730000
067400             PERFORM 7700-WRITE-UPLOAD-ERROR-TABLE                06740000
067500         ELSE                                                     06750000
067600             IF CNDRTY-DIVERT-TYP-CDE = 'D'                       06760000
067700                 IF SU014-BAR-CODE (1:4) NOT EQUAL TO '0041'      06770000
067710* DMH 11/2012 - BEGIN                                             06771036
067720                    AND                                           06772036
067730                    SU014-BAR-CODE (1:4) NOT EQUAL TO '0042'      06773036
067740* DMH 11/2012 - END                                               06774036
067800                     MOVE '100'    TO DK-ERROR-CODE               06780000
067900                     PERFORM 7700-WRITE-UPLOAD-ERROR-TABLE        06790000
068000                 ELSE                                             06800000
068100                     PERFORM 2600-MOVE-DIVERT-DATA                06810000
068200                     IF PS-LOG-TO-ERR-FILE                        06820000
068300                         MOVE '104'    TO DK-ERROR-CODE           06830000
068400                         PERFORM 7700-WRITE-UPLOAD-ERROR-TABLE    06840000
068500                     ELSE                                         06850000
068600                         PERFORM 8000-SELECT-TSUCRDV              06860000
068700                         IF PS-DUPLICATE-CARTON                   06870000
068800                             MOVE '103'    TO DK-ERROR-CODE       06880000
068900                             PERFORM 7700-WRITE-UPLOAD-ERROR-TABLE06890000
069000                         END-IF                                   06900000
069100                     END-IF                                       06910000
069200                     IF PS-DUPLICATE-CARTON AND                   06920000
069300                       SUCRDV-DIVERT-SYS-DTE = PV-DATE AND        06930000
069400                       SUCRDV-DIVERT-SYS-TM = PV-TIME             06940000
069500                         CONTINUE                                 06950000
069600                     ELSE                                         06960000
069700                         PERFORM 7600-SELECT-OTBND-CART           06970000
069800                         IF PS-OTBND-CART-FOUND-YES AND           06980000
069900                            SUT00024-CART-SRC-CDE = 'MST' AND     06990000
069910                            CNDCDR-DOOR-TYP-CDE NOT = 'DS' AND    06991000
069920                            CNDCDR-DOOR-TYP-CDE NOT = 'ST'        06992000
070000***                  INACTIVATE MST RECORD - SHPUNT               07000000
070100                             MOVE SUT00024-PRNT-CART-ID           07010000
070200                                              TO PV-PRNT-CART-ID  07020000
070300                             MOVE 'N'         TO PV-ACTV-IND      07030000
070400                             PERFORM 8200-UPDATE-SHPUNT           07040000
070500                             PERFORM 8250-INACT-TSUCRDV           07050000
070600***                  INSERT NEW INACTIVE RECORD - SUCRDV          07060000
070700                             PERFORM 2600-MOVE-DIVERT-DATA        07070000
070800                             MOVE 'I'         TO  SUCRDV-ACTV-CDE 07080000
070900                             PERFORM 7000-INSERT-TSUCRDV          07090000
071000****                 SELECT ALL CHILDREN SHPUNT                   07100000
071100                             MOVE 'A'         TO  SUCRDV-ACTV-CDE 07110000
071200                             MOVE 'Y'         TO PV-ACTV-IND      07120000
071300                             PERFORM 8300-PROCESS-CHILDREN        07130000
071400****                 INSERT ACTIVE DIVERT FOR EACH CHILD - SUCRDV 07140000
071500****                 INACTIVATE CHILDREN AND SET PRNT_CART_ID     07150000
071600****                       TO ZERO - SHPUNT                       07160000
071700****                 INACTIVATE PARENT - SHPUNT                   07170000
071800                         ELSE                                     07180000
071900                             PERFORM 2600-MOVE-DIVERT-DATA        07190000
072000                             PERFORM 7000-INSERT-TSUCRDV          07200000
072100                         END-IF                                   07210000
072200                     END-IF                                       07220000
072300                 END-IF                                           07230000
072400             ELSE                                                 07240000
072500                 IF CNDCDR-DOOR-TYP-CDE = 'NR'                    07250000
072600***    NO READS  - 105                                            07260000
072700                     MOVE '105'    TO DK-ERROR-CODE               07270000
072800                 ELSE                                             07280000
072900***    CONVEYOR TO CONVEYOR - 106                                 07290000
073000                     MOVE '106'    TO DK-ERROR-CODE               07300000
073100                 END-IF                                           07310000
073200                 PERFORM 7700-WRITE-UPLOAD-ERROR-TABLE            07320000
073300             END-IF                                               07330000
073400         END-IF                                                   07340000
073500     ELSE                                                         07350000
073600         MOVE '102'    TO DK-ERROR-CODE                           07360000
073700         PERFORM 7700-WRITE-UPLOAD-ERROR-TABLE                    07370000
073800     END-IF.                                                      07380000
073900                                                                  07390000
074000**   CHECK CARTON DATA                                            07400000
074100                                                                  07410000
074200*  IF ALL OPERATIONS WERE SUCCESSFUL UP TO THIS POINT, THIS       07420000
074300*  COMPLETES A LOGICAL UNIT OF WORK.  ABENDS WILL NOT INCLUDE     07430000
074400*  A ROLLBACK COMMAND BECAUSE ANY RETRANSMISSION WILL OVERLAY     07440000
074500*  THE PACK VALUES.                                               07450000
074600                                                                  07460000
075900     IF PV-PARTIAL-TCP-COUNT > 4 AND                              07590000
076000        (DK-ERROR-CODE = '101' OR                                 07600000
076100         DK-ERROR-CODE = '102')                                   07610000
076200         SET PS-ERROR-RECEIVE TO TRUE                             07620000
076300     END-IF.                                                      07630000
076400                                                                  07640000
076410     EXEC SQL                                                     07641030
076420         COMMIT                                                   07642030
076430     END-EXEC.                                                    07643030
076431                                                                  07643130
076432     PERFORM 1500-READ-DIVERT-FILE-INPUT.                         07643230
076440                                                                  07644030
076500/                                                                 07650000
095400*----------------------------------------------------------------*09540000
095500 2600-MOVE-DIVERT-DATA.                                           09550000
095600     MOVE ' 2600-MOVE-DIVERT-DATA'                                09560000
095700                                 TO DP013-PARAGRAPH.              09570000
095800     INITIALIZE DCLTSUCRDV.                                       09580000
095900     MOVE SU014-DC-NUMBER          TO  SUCRDV-OPER-UNT-ID         09590000
096000     MOVE SU014-BAR-CODE           TO  PV-CONTAINER-ID.           09600000
096100     MOVE PV-SHIPT-UNT-ID          TO  SUCRDV-SHIPT-UNT-ID        09610000
096200                                       PV-SHIPT-UNT-ID-REDEF.     09620000
096300     MOVE PV-STORE-NUMBER          TO  SUCRDV-DEST-OPER-UNT-ID.   09630000
096400     MOVE SU014-BAR-CODE           TO  SUCRDV-BRCDE-NBR.          09640000
096500     MOVE SU014-DIVERT-NUMBER      TO  SUCRDV-DIVERT-NBR.         09650000
096600     MOVE SU014-DOOR-NUMBER        TO  SUCRDV-DIVERT-LOC-ID.      09660000
096700     MOVE 'A'                      TO  SUCRDV-ACTV-CDE.           09670000
096800     MOVE CNDCDR-DOOR-ID           TO  SUCRDV-DOOR-ID.            09680000
096900     MOVE SU014-DATE (1:4)         TO  PV-DATE-CCYY.              09690000
097000     MOVE SU014-DATE (5:2)         TO  PV-DATE-MM.                09700000
097100     MOVE SU014-DATE (7:2)         TO  PV-DATE-DD.                09710000
097200     MOVE PV-DATE                  TO  SUCRDV-DIVERT-SYS-DTE.     09720000
097300     MOVE SU014-TIME (1:2)         TO  PV-TIME-HH.                09730000
097400     MOVE SU014-TIME (3:2)         TO  PV-TIME-MM.                09740000
097500     MOVE SU014-TIME (5:2)         TO  PV-TIME-SS.                09750000
097600     MOVE PV-TIME                  TO  SUCRDV-DIVERT-SYS-TM.      09760000
097700     MOVE SU014-MESSAGE-SEQ-NUMBER TO  SUCRDV-BTCH-NBR.           09770000
097710* BUILD DIVERT SYSTEM DATE & TIME STAMP FOR INSERT                09771023
097800     MOVE SUCRDV-DIVERT-SYS-DTE    TO  PV-DIVERT-DTE.             09780023
097900     MOVE SUCRDV-DIVERT-SYS-TM     TO  PV-DIVERT-TM.              09790023
138100*                                                                 13810000
138200*----------------------------------------------------------------*13820000
138300*    INSERT A ROW INTO THE TSUCRDV TABLE                         *13830000
138400*----------------------------------------------------------------*13840000
138500 7000-INSERT-TSUCRDV.                                             13850000
138600     MOVE ' 7000-INSERT-TSUCRDV'                                  13860000
138700                                 TO DP013-PARAGRAPH.              13870000
138800     MOVE 0       TO PV-PARTIAL-TCP-COUNT.                        13880000
138900     PERFORM                                                      13890000
139000         WITH TEST AFTER                                          13900000
139100         VARYING PV-RETRY-COUNTER                                 13910000
139200         FROM 1 BY 1                                              13920000
139300         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES)                13930000
139400             OR (SQLCODE = +0)                                    13940000
139500                                                                  13950000
139600                                                                  13960000
139700         EXEC SQL                                                 13970000
139800              INSERT INTO TSUCRDV                                 13980000
139900                     (OPER_UNT_ID                                 13990000
140000                   ,  DIVERT_NBR                                  14000000
140100                   ,  DIVERT_LOC_ID                               14010000
140200                   ,  DIVERT_TMST                                 14020000
140300                   ,  BRCDE_NBR                                   14030000
140400                   ,  PRC_RSN_CDE                                 14040000
140500                   ,  SHIPT_UNT_ID                                14050000
140600                   ,  BTCH_NBR                                    14060000
140700                   ,  BTCH_RVSN_NBR                               14070000
140800                   ,  ACTV_CDE                                    14080000
140900                   ,  NACTV_USR_ID                                14090000
141000                   ,  DOOR_ID                                     14100000
141100                   ,  DEST_OPER_UNT_ID                            14110000
141200                   ,  DIVERT_SYS_DTE                              14120000
141300                   ,  DIVERT_SYS_TM)                              14130000
141400              VALUES (                                            14140000
141500                      :SUCRDV-OPER-UNT-ID                         14150000
141600                   ,  :SUCRDV-DIVERT-NBR                          14160000
141700                   ,  :SUCRDV-DIVERT-LOC-ID                       14170000
141800***                ,  :PV-DIV-TMST                                14180032
141810                   ,   CURRENT TIMESTAMP                          14181032
141900                   ,  :SUCRDV-BRCDE-NBR                           14190000
142000                   ,  :SUCRDV-PRC-RSN-CDE                         14200000
142100                   ,  :SUCRDV-SHIPT-UNT-ID                        14210000
142200                   ,  :SUCRDV-BTCH-NBR                            14220000
142300                   ,  :SUCRDV-BTCH-RVSN-NBR                       14230000
142400                   ,  :SUCRDV-ACTV-CDE                            14240000
142500                   ,  :SUCRDV-NACTV-USR-ID                        14250000
142600                   ,  :SUCRDV-DOOR-ID                             14260000
142700                   ,  :SUCRDV-DEST-OPER-UNT-ID                    14270000
142800                   ,  :SUCRDV-DIVERT-SYS-DTE                      14280000
142900                   ,  :SUCRDV-DIVERT-SYS-TM)                      14290000
143000         END-EXEC                                                 14300000
143100                                                                  14310000
143200         EVALUATE TRUE                                            14320000
143300             WHEN SQLCODE = +0                                    14330000
143310                  ADD  1  TO  PV-OUTPUT-COUNT                     14331033
143400             WHEN SQLCODE = -904                                  14340000
143500             WHEN SQLCODE = -911                                  14350000
143600             WHEN SQLCODE = -913                                  14360000
143700                  CONTINUE                                        14370000
143800                                                                  14380000
143900             WHEN SQLWARN0 NOT = SPACES                           14390000
144000             WHEN SQLCODE < +0                                    14400000
144100             WHEN SQLCODE > +0                                    14410000
144200                  MOVE ' 7000-INSERT-TSUCRDV'                     14420000
144300                                  TO PV-PARAGRAPH                 14430003
144400                  MOVE 'UNSUCCESSFUL SELECT ON TRECEIV  '         14440000
144500                                  TO PV-DB2-FUNCTION              14450006
144600                  MOVE SU014-DC-NUMBER                            14460000
144700                                  TO PV-DC-NBR                    14470006
144800                  MOVE SU014-DIVERT-NUMBER                        14480000
144900                                  TO PV-DIVERT-NBR                14490006
145000                  MOVE PV-SHIPT-UNT-ID                            14500000
145100                                  TO PV-SHIPT-ID                  14510006
145300                  MOVE 'TSUCRDV ' TO PV-ABEND-TABLE-1             14530007
145310**                                                                14531029
145400**                DISPLAY  'OPER:'                                14540029
145410                  DISPLAY 'OPER: '    SUCRDV-OPER-UNT-ID          14541029
145420                  DISPLAY 'DVRT: '    SUCRDV-DIVERT-NBR           14542029
145430                  DISPLAY 'LOC:  '    SUCRDV-DIVERT-LOC-ID        14543029
145440                  DISPLAY 'TMST: '    PV-DIV-TMST                 14544029
145450                  DISPLAY 'BRCD: '    SUCRDV-BRCDE-NBR            14545029
145460                  DISPLAY 'RSN:  '    SUCRDV-PRC-RSN-CDE          14546029
145470                  DISPLAY 'SHIPT:'    SUCRDV-SHIPT-UNT-ID         14547029
145480                  DISPLAY 'BATCH:'    SUCRDV-BTCH-NBR             14548029
145490                  DISPLAY 'RVSN: '    SUCRDV-BTCH-RVSN-NBR        14549029
145491                  DISPLAY 'ACVT: '    SUCRDV-ACTV-CDE             14549129
145492                  DISPLAY 'USER: '    SUCRDV-NACTV-USR-ID         14549229
145493                  DISPLAY 'DOOR: '    SUCRDV-DOOR-ID              14549329
145494                  DISPLAY 'DEST: '    SUCRDV-DEST-OPER-UNT-ID     14549429
145495                  DISPLAY 'SYSDT:'    SUCRDV-DIVERT-SYS-DTE       14549529
145496                  DISPLAY 'SYSTM:'    SUCRDV-DIVERT-SYS-TM        14549629
145500**                                                                14550029
145900                  PERFORM 9200-SQL-ERROR                          14590006
146000         END-EVALUATE                                             14600000
146100     END-PERFORM.                                                 14610000
146200                                                                  14620000
146300                                                                  14630000
146400     IF  (PV-RETRY-COUNTER > PC-MAX-RETRIES) AND                  14640000
146500         (SQLCODE NOT = +0)                                       14650000
146800         MOVE ' 7000-INSERT-TSUCRDV'                              14680000
146900                                  TO PV-PARAGRAPH                 14690006
147000         MOVE 'MAX RETRIES EXCEEDED ON TRECEIV SELECT'            14700000
147100                                  TO PV-DB2-FUNCTION              14710006
147300         MOVE 'TSUCRDV '          TO PV-ABEND-TABLE-1             14730007
147600         PERFORM 9200-SQL-ERROR                                   14760006
147700     END-IF.                                                      14770000
147800                                                                  14780000
147900/                                                                 14790000
148000                                                                  14800000
148100 EJECT                                                            14810000
148200 7300-INSERT-OTBND-CART.                                          14820000
148300                                                                  14830000
148400     MOVE ' 7300-INSERT-OTBND-CART'                               14840000
148500                                 TO DP013-PARAGRAPH.              14850000
148600                                                                  14860000
148700     MOVE SU014-DC-NUMBER             TO SUT00024-ORGN-LOC-NBR.   14870000
148800     MOVE SU014-DC-NUMBER             TO SUT00024-DEST-LOC-NBR.   14880000
148900     MOVE 'RDM'                       TO SUT00024-CART-SRC-CDE.   14890000
149000     MOVE 'N'                         TO SUT00024-MSTR-CART-IND.  14900000
149100     MOVE ZERO                        TO SUT00024-ORIG-CART-ID.   14910000
149200     MOVE SPACES                      TO SUT00024-CRE-USR-ID.     14920000
149300     MOVE 'SUKCS557'                  TO SUT00024-CRE-PGM-NM.     14930000
149400     MOVE ZERO                        TO SUT00024-CART-RVSN-NBR.  14940000
149500     MOVE SU014-DATE                  TO PV-IN-DATE.              14950000
149600     MOVE PV-IN-DATE-CCYY             TO PV-DATE-CCYY.            14960000
149700     MOVE PV-IN-DATE-MM               TO PV-DATE-MM.              14970000
149800     MOVE PV-IN-DATE-DD               TO PV-DATE-DD.              14980000
149900     MOVE PV-DATE                     TO DK-DATE.                 14990000
150000     MOVE SU014-TIME                  TO PV-IN-TIME.              15000000
150100     MOVE PV-IN-TIME-HH               TO PV-TIME-HH.              15010000
150200     MOVE PV-IN-TIME-MM               TO PV-TIME-MM.              15020000
150300     MOVE PV-IN-TIME-SS               TO PV-TIME-SS.              15030000
150400     MOVE PV-TIME                     TO DK-TIME.                 15040000
150500                                                                  15050000
150600     PERFORM                                                      15060000
150700         WITH TEST AFTER                                          15070000
150800         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     15080000
150900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES) OR            15090000
151000                (SQLCODE = ZERO) OR (SQLCODE = -803))             15100000
151100                                                                  15110000
151200     EXEC SQL                                                     15120000
151300         INSERT INTO SUT_OTBND_CART                               15130000
151400             (SHIPT_UNT_ID                                        15140000
151500         ,    ORGN_LOC_NBR                                        15150000
151600         ,    DEST_LOC_NBR                                        15160000
151700         ,    CART_SRC_CDE                                        15170000
151800         ,    MSTR_CART_IND                                       15180000
151900         ,    PRNT_CART_ID                                        15190000
152000         ,    ORIG_CART_ID                                        15200000
152100         ,    ACTV_IND                                            15210000
152200         ,    CRE_DTE                                             15220000
152300         ,    CRE_TM                                              15230000
152400         ,    CRE_USR_ID                                          15240000
152500         ,    CRE_PGM_NM                                          15250000
152600         ,    CART_RVSN_NBR                                       15260000
152700         ,    CART_TYP_CDE                                        15270000
152800         ,    OTBND_TRIP_ID                                       15280000
152900         )                                                        15290000
153000             VALUES                                               15300000
153100            (:DK-SHIPT-UNT-ID                                     15310000
153200         ,   :SUT00024-ORGN-LOC-NBR                               15320000
153300         ,   :SUT00024-DEST-LOC-NBR                               15330000
153400         ,   :SUT00024-CART-SRC-CDE                               15340000
153500         ,   :SUT00024-MSTR-CART-IND                              15350000
153600         ,   :DK-SHIPT-UNT-ID                                     15360000
153700         ,   :SUT00024-ORIG-CART-ID                               15370000
153800         ,   :SUT00024-ACTV-IND                                   15380000
153900         ,   :DK-DATE                                             15390000
154000         ,   :DK-TIME                                             15400000
154100         ,   :SUT00024-CRE-USR-ID                                 15410000
154200         ,   'SUKCS557'                                           15420000
154300         ,   :SUT00024-CART-RVSN-NBR                              15430000
154400         ,   'S'                                                  15440000
154500         ,   0                                                    15450000
154600         )                                                        15460000
154700         END-EXEC                                                 15470000
154800                                                                  15480000
154900         EVALUATE TRUE                                            15490000
155000             WHEN SQLCODE = ZERO                                  15500000
155100             WHEN SQLCODE = -803                                  15510000
155200             WHEN SQLCODE = -904                                  15520000
155300             WHEN SQLCODE = -911                                  15530000
155400             WHEN SQLCODE = -913                                  15540000
155500                 CONTINUE                                         15550000
155600                                                                  15560000
155700             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              15570000
155800                 DISPLAY '**************************************' 15580000
155900                 DISPLAY 'WARNING ISSD ON INSRT OF SUT_OTBND_CART'15590000
156000                 DISPLAY 'SUT00024-SHIPT-UNT-ID =  '              15600000
156100                          DK-SHIPT-UNT-ID                         15610000
156200                 DISPLAY '**********************************'     15620000
156300                 PERFORM 9800-SQL-WARNING                         15630000
156400                                                                  15640000
156500             WHEN SQLCODE < ZERO                                  15650000
156600                 DISPLAY '**************************************' 15660000
156700                 DISPLAY 'ERROR ISSD ON INSRT OF SUT_OTBND_CART'  15670000
156800                 DISPLAY 'SUT00024-SHIPT-UNT-ID =  '              15680000
156900                          DK-SHIPT-UNT-ID                         15690000
157000                 DISPLAY 'DK-DATE = '                             15700000
157100                          DK-DATE                                 15710000
157200                 DISPLAY 'DK-TIME = '                             15720000
157300                          DK-TIME                                 15730000
157400                 DISPLAY '**************************************' 15740000
157500                 PERFORM 9200-SQL-ERROR                           15750021
157600                                                                  15760000
157700         END-EVALUATE                                             15770000
157800     END-PERFORM.                                                 15780000
157900                                                                  15790000
158000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    15800000
158100         SQLCODE NOT = ZERO                                       15810000
158200         DISPLAY '**************************************'         15820000
158300         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         15830000
158400         DISPLAY 'INSERT TO SUT_OTBND_CART                     '  15840000
158500         DISPLAY 'SUT00024-SHIPT-UNT-ID =  '                      15850000
158600                  SUT00024-SHIPT-UNT-ID                           15860000
158700         DISPLAY '**************************************'         15870000
158800         PERFORM 9200-SQL-ERROR                                   15880021
158900     END-IF.                                                      15890000
159000                                                                  15900000
174000/                                                                 17400000
174100 7600-SELECT-OTBND-CART.                                          17410000
174200                                                                  17420000
174300     MOVE ' 7600-SELECT-OTBND-CART'                               17430000
174400                                 TO DP013-PARAGRAPH.              17440000
174500     MOVE SU014-BAR-CODE              TO PV-CONTAINER-ID.         17450000
174600     MOVE PV-SHIPT-UNT-ID             TO DK-SHIPT-UNT-ID.         17460000
174700                                                                  17470000
174800     EXEC SQL                                                     17480000
174900         SELECT                                                   17490000
175000              SHIPT_UNT_ID                                        17500000
175100         ,    ORGN_LOC_NBR                                        17510000
175200         ,    DEST_LOC_NBR                                        17520000
175300         ,    CART_SRC_CDE                                        17530000
175400         ,    MSTR_CART_IND                                       17540000
175500         ,    PRNT_CART_ID                                        17550000
175600         ,    ORIG_CART_ID                                        17560000
175700         ,    ACTV_IND                                            17570000
175800         ,    CRE_DTE                                             17580000
175900         ,    CRE_TM                                              17590000
176000         ,    CRE_USR_ID                                          17600000
176100         ,    CRE_PGM_NM                                          17610000
176200         ,    CART_RVSN_NBR                                       17620000
176300         ,    CART_TYP_CDE                                        17630000
176400         ,    LBL_PRT_SEQ_NBR                                     17640000
176500           INTO                                                   17650000
176600             :SUT00024-SHIPT-UNT-ID                               17660000
176700         ,   :SUT00024-ORGN-LOC-NBR                               17670000
176800         ,   :SUT00024-DEST-LOC-NBR                               17680000
176900         ,   :SUT00024-CART-SRC-CDE                               17690000
177000         ,   :SUT00024-MSTR-CART-IND                              17700000
177100         ,   :SUT00024-PRNT-CART-ID                               17710000
177200         ,   :SUT00024-ORIG-CART-ID                               17720000
177300         ,   :SUT00024-ACTV-IND                                   17730000
177400         ,   :SUT00024-CRE-DTE                                    17740000
177500         ,   :SUT00024-CRE-TM                                     17750000
177600         ,   :SUT00024-CRE-USR-ID                                 17760000
177700         ,   :SUT00024-CRE-PGM-NM                                 17770000
177800         ,   :SUT00024-CART-RVSN-NBR                              17780000
177900         ,   :SUT00024-CART-TYP-CDE                               17790000
178000         ,   :SUT00024-LBL-PRT-SEQ-NBR                            17800000
178100           FROM SUT_OTBND_CART                                    17810000
178200         WHERE                                                    17820000
178300             SHIPT_UNT_ID = :DK-SHIPT-UNT-ID                      17830000
178400     END-EXEC.                                                    17840000
178500                                                                  17850000
178600     EVALUATE TRUE                                                17860000
178700         WHEN SQLCODE = ZERO                                      17870000
178800              SET PS-OTBND-CART-FOUND-YES TO TRUE                 17880000
178900         WHEN SQLCODE = +100                                      17890000
179000              SET PS-OTBND-CART-FOUND-NO TO TRUE                  17900000
179100         WHEN SQLWARN0 NOT = SPACE                                17910000
179200         WHEN SQLCODE  NOT = ZERO                                 17920000
179300              MOVE ' 7600-SELECT-OTBND-CART'                      17930000
179400                              TO PV-PARAGRAPH                     17940006
179500              MOVE 'UNSUCCESSFUL SELECT ON SUT_OTBND_CART  '      17950000
179600                              TO PV-DB2-FUNCTION                  17960006
179700              MOVE PV-SHIPT-UNT-ID                                17970000
179800                              TO PV-SHIPT-ID                      17980006
180300              MOVE 'SUT00024' TO PV-ABEND-TABLE-1                 18030007
180600              PERFORM 9200-SQL-ERROR                              18060006
180700     END-EVALUATE.                                                18070000
180800/                                                                 18080000
180900*                                                                 18090000
181000 7700-WRITE-UPLOAD-ERROR-TABLE.                                   18100000
181100                                                                  18110000
181200     MOVE ' 7700-WRITE-UPLOAD-ERROR-TABLE'                        18120000
181300                                 TO PV-PARAGRAPH.                 18130011
181400     INITIALIZE                       UPLDER-PKT-TXT              18140000
181500                                      UPLDER-UPLD-TRN-CDE.        18150000
181600     MOVE SU014-DC-NUMBER             TO DK-OPER-UNT-ID.          18160000
181700     ADD 1                            TO PV-ERROR-COUNT.          18170000
181800     MOVE PV-ERROR-COUNT              TO UPLDER-UPLD-SEQ-NBR.     18180000
181900     MOVE SU014-CONV-DIVERT-RECORD    TO UPLDER-PKT-TXT.          18190000
182000                                                                  18200000
182100     EXEC SQL                                                     18210000
182200     INSERT INTO TUPLDER                                          18220000
182300         (                                                        18230000
182400           OPER_UNT_ID                                            18240000
182500         , UPLD_TRN_CDE                                           18250000
182600         , ERR_CDE                                                18260000
182700         , PRC_TMST                                               18270000
182800         , UPLD_SEQ_NBR                                           18280000
182900         , PKT_TXT                                                18290000
183000         )                                                        18300000
183100         VALUES                                                   18310000
183200         (                                                        18320000
183300           :DK-OPER-UNT-ID                                        18330000
183400         , 'B'                                                    18340000
183500         , :DK-ERROR-CODE                                         18350000
183600         , CURRENT TIMESTAMP                                      18360000
183700         , :DK-RECS-READ                                          18370000
183800         , :UPLDER-PKT-TXT                                        18380000
183900         )                                                        18390000
184000     END-EXEC.                                                    18400000
184100                                                                  18410000
184200     EVALUATE TRUE                                                18420000
184300         WHEN SQLCODE = ZERO                                      18430000
184400             CONTINUE                                             18440000
184500         WHEN SQLWARN0 NOT = SPACES                               18450000
184600         WHEN SQLCODE  NOT = ZERO                                 18460000
184700             MOVE ' 7700-WRITE-UPLOAD-ERROR-TABLE'                18470000
184800                                       TO PV-PARAGRAPH            18480006
184900             MOVE 'PROBLEM WITH RETRIEVING ROW'                   18490000
185000                                 TO PV-DB2-FUNCTION               18500006
185100             MOVE SU014-DC-NUMBER                                 18510000
185200                                 TO PV-DC-NBR                     18520006
185300             MOVE PV-ERROR-COUNT                                  18530000
185400                                 TO PV-ERR-CNT                    18540006
185900             MOVE 'TUPLDER'  TO PV-ABEND-TABLE-1                  18590007
186200             PERFORM 9200-SQL-ERROR                               18620006
186400     END-EVALUATE.                                                18640000
186500                                                                  18650000
186600 7800-VALIDATE-DIVERT.                                            18660000
186700     MOVE ' 7800-VALIDATE-DIVERT'                                 18670000
186800                                 TO PV-PARAGRAPH.                 18680011
186900      MOVE SU014-DC-NUMBER   TO DK-OPER-UNT-ID.                   18690000
187000      MOVE SU014-DIVERT-NUMBER                                    18700000
187100                             TO DK-DIVERT-ID.                     18710000
187200      MOVE SU014-DOOR-NUMBER                                      18720000
187300                             TO DK-DOOR-ID.                       18730000
187400                                                                  18740000
187500        EXEC SQL                                                  18750000
187600          SELECT  A.DOOR_ID                                       18760000
187700              ,   A.DOOR_TYP_CDE                                  18770000
187800              ,   B.DIVERT_TYP_CDE                                18780000
187900              ,   CURRENT TIMESTAMP                               18790000
188000            INTO :CNDCDR-DOOR-ID                                  18800000
188100              ,  :CNDCDR-DOOR-TYP-CDE                             18810000
188200              ,  :CNDRTY-DIVERT-TYP-CDE                           18820000
188300              ,  :PV-TIMESTAMP                                    18830000
188400            FROM  TCNDCDR A                                       18840000
188500             ,    TCNDRTY B                                       18850000
188600           WHERE  A.OPER_UNT_ID  = :DK-OPER-UNT-ID                18860000
188700             AND  A.DIVERT_LOC_ID= :DK-DOOR-ID                    18870000
188800             AND  A.DIVERT_NBR   = :DK-DIVERT-ID                  18880000
188900             AND  A.DOOR_TYP_CDE = B.DOOR_TYP_CDE                 18890000
189000        END-EXEC                                                  18900000
189100                                                                  18910000
189200        EVALUATE TRUE                                             18920000
189300            WHEN SQLCODE = +0                                     18930000
189400                CONTINUE                                          18940000
189500            WHEN SQLCODE = +100                                   18950000
189600                SET PS-DOOR-CONVERT-NOT-FOUND TO TRUE             18960000
189700            WHEN SQLCODE = -811                                   18970000
189800                PERFORM 7850-VALIDATE-DIVERT-DUP                  18980000
189900            WHEN SQLWARN0 NOT = SPACES                            18990000
190000            WHEN SQLCODE < +0                                     19000000
190100            WHEN SQLCODE > +0                                     19010000
190200                MOVE ' 7800-VALIDATE-DIVERT'                      19020000
190300                                          TO PV-PARAGRAPH         19030006
190400                MOVE 'PROBLEM WITH RETRIEVING ROW'                19040000
190500                                    TO PV-DB2-FUNCTION            19050006
190600                MOVE SU014-DC-NUMBER                              19060000
190700                                    TO PV-DC-NBR                  19070006
190800                MOVE SU014-DIVERT-NUMBER                          19080000
190900                                    TO PV-DIVERT-NBR              19090006
191000                MOVE SU014-DOOR-NUMBER                            19100000
191100                                    TO PV-DOOR-NBR                19110006
191300                MOVE 'TCNDCDR'  TO PV-ABEND-TABLE-1               19130007
191400                MOVE 'TCNDRTY'  TO PV-ABEND-TABLE-2               19140007
192000                PERFORM 9200-SQL-ERROR                            19200006
192200        END-EVALUATE.                                             19220000
192300                                                                  19230000
192400*                                                                 19240000
192500 7850-VALIDATE-DIVERT-DUP.                                        19250000
192600     MOVE ' 7850-VALIDATE-DIVERT-DUP'                             19260000
192700                                 TO PV-PARAGRAPH.                 19270011
192800      MOVE SU014-DC-NUMBER   TO DK-OPER-UNT-ID.                   19280000
192900      MOVE SU014-DIVERT-NUMBER                                    19290000
193000                             TO DK-DIVERT-ID.                     19300000
193100      MOVE SU014-DOOR-NUMBER                                      19310000
193200                             TO DK-DOOR-ID.                       19320000
193300      MOVE PV-STORE-NBR      TO DK-STR-NBR.                       19330000
193400                                                                  19340000
193500        EXEC SQL                                                  19350000
193600          SELECT  A.DOOR_ID                                       19360000
193700              ,   B.DIVERT_TYP_CDE                                19370000
193800              ,   CURRENT TIMESTAMP                               19380000
193900            INTO :CNDCDR-DOOR-ID                                  19390000
194000              ,  :CNDRTY-DIVERT-TYP-CDE                           19400000
194100              ,  :PV-TIMESTAMP                                    19410000
194200            FROM  TCNDCDR A                                       19420000
194300              ,   TCNDRTY B                                       19430000
194400              ,   TCNDRST C                                       19440000
194500           WHERE  A.OPER_UNT_ID  = :DK-OPER-UNT-ID                19450000
194600             AND  A.DIVERT_LOC_ID= :DK-DOOR-ID                    19460000
194700             AND  A.DIVERT_NBR   = :DK-DIVERT-ID                  19470000
194800             AND  A.DOOR_TYP_CDE = B.DOOR_TYP_CDE                 19480000
194900             AND  A.OPER_UNT_ID  =  C.OPER_UNT_ID                 19490000
195000             AND  A.DOOR_ID      =  C.DOOR_ID                     19500000
195100             AND  C.STR_NBR      =  :DK-STR-NBR                   19510000
195200             AND  C.END_TMST     =  :PC-DEFAULT-TMST              19520000
195300        END-EXEC                                                  19530000
195400                                                                  19540000
195500        EVALUATE TRUE                                             19550000
195600            WHEN SQLCODE = +0                                     19560000
195700                CONTINUE                                          19570000
195800            WHEN SQLCODE = +100                                   19580000
195900                SET PS-DOOR-CONVERT-NOT-FOUND TO TRUE             19590000
196000            WHEN SQLWARN0 NOT = SPACES                            19600000
196100            WHEN SQLCODE < +0                                     19610000
196200            WHEN SQLCODE > +0                                     19620000
196300                MOVE ' 7850-VALIDATE-DIVERT-DUP'                  19630000
196400                                          TO PV-PARAGRAPH         19640006
196500                MOVE 'PROBLEM WITH RETRIEVING ROW'                19650000
196600                                    TO PV-DB2-FUNCTION            19660006
196700                MOVE SU014-DC-NUMBER                              19670000
196800                                    TO PV-DC-NBR                  19680006
196900                MOVE SU014-DIVERT-NUMBER                          19690000
197000                                    TO PV-DIVERT-NBR              19700006
197100                MOVE SU014-DOOR-NUMBER                            19710000
197200                                    TO PV-DOOR-NBR                19720006
197400                MOVE 'TCNDCDR'  TO PV-ABEND-TABLE-1               19740007
197500                MOVE 'TCNDRTY'  TO PV-ABEND-TABLE-2               19750007
197600                MOVE 'TCNDRST'  TO PV-ABEND-TABLE-3               19760007
198200                PERFORM 9200-SQL-ERROR                            19820006
198400        END-EVALUATE.                                             19840000
198500                                                                  19850000
198600*                                                                 19860000
198700******************************************************************19870000
198800 7900-CHECK-PARM-TABLE.                                           19880000
198900                                                                  19890000
199000     MOVE ' 7900-CHECK-PARM-TABLE'                                19900000
199100                                 TO PV-PARAGRAPH.                 19910011
199200     MOVE SU014-DC-NUMBER     TO DK-LOC-ID.                       19920000
199300                                                                  19930000
199400     EXEC SQL                                                     19940000
199500         SELECT FUNC_TXT                                          19950000
199600            ,   (CURRENT_TIMESTAMP + 1 HOUR)                      19960000
199700           INTO :KRPRPM-FUNC-TXT                                  19970000
199800            ,   :PV-TIMESTAMP                                     19980000
199900           FROM TKRPRPM                                           19990000
200000          WHERE SYS_PRC_FUNC_CDE  = :DK-FUNC-CDE                  20000000
200100            AND LOC_ID            = :DK-LOC-ID                    20010000
200200            AND INTFC_SYS_CDE     = 'RDM'                         20020000
200300            AND FUNC_PRC_STAT_CDE = 'AC'                          20030000
200400            AND (CURRENT_DATE                                     20040000
200500        BETWEEN DATE(FUNC_BEG_TMST) AND                           20050000
200600                DATE(FUNC_END_TMST) )                             20060000
200700     END-EXEC.                                                    20070000
200800                                                                  20080000
200900     EVALUATE SQLCODE                                             20090000
201000         WHEN ZERO                                                20100000
201100             SET PS-PARM-REC-FOUND   TO TRUE                      20110000
201200         WHEN +100                                                20120000
201300             SET PS-NO-PARM-REC-FOUND TO TRUE                     20130000
201400         WHEN OTHER                                               20140000
201500              MOVE ' 7900-CHECK-PARM-TABLE'                       20150000
201600                               TO PV-PARAGRAPH                    20160006
201700              MOVE 'SELECT RDM FACILITY'                          20170000
201800                               TO PV-DB2-FUNCTION                 20180006
201900              MOVE SU014-DC-NUMBER                                20190000
202000                               TO PV-DC-NBR                       20200006
202700              PERFORM 9200-SQL-ERROR                              20270006
202900     END-EVALUATE.                                                20290000
203000                                                                  20300000
203100*----------------------------------------------------------------*20310000
203200*    INSERT A ROW INTO THE TSUCRDV TABLE                         *20320000
203300*----------------------------------------------------------------*20330000
203400 8000-SELECT-TSUCRDV.                                             20340000
203500     MOVE ' 8000-SELECT-TSUCRDV'                                  20350000
203600                                 TO PV-PARAGRAPH.                 20360011
203700     PERFORM                                                      20370000
203800         WITH TEST AFTER                                          20380000
203900         VARYING PV-RETRY-COUNTER                                 20390000
204000         FROM 1 BY 1                                              20400000
204100         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES)                20410000
204200             OR (SQLCODE = +0)                                    20420000
204300             OR (SQLCODE = +100)                                  20430000
204400             OR (SQLCODE = -811)                                  20440000
204500                                                                  20450000
204600                                                                  20460000
204700         EXEC SQL                                                 20470000
204800              SELECT  A.DIVERT_SYS_DTE                            20480000
204900                  ,   A.DIVERT_SYS_TM                             20490000
205000              INTO    :SUCRDV-DIVERT-SYS-DTE                      20500000
205100                  ,   :SUCRDV-DIVERT-SYS-TM                       20510000
205200              FROM    TSUCRDV A                                   20520000
205300              WHERE   A.SHIPT_UNT_ID  = :SUCRDV-SHIPT-UNT-ID      20530000
205400                AND   A.DIVERT_TMST   =                           20540000
205500                 (SELECT  MAX(B.DIVERT_TMST)                      20550000
205600                  FROM    TSUCRDV B                               20560000
205700                  WHERE   B.SHIPT_UNT_ID  = :SUCRDV-SHIPT-UNT-ID) 20570000
205800         END-EXEC                                                 20580000
205900                                                                  20590000
206000         EVALUATE TRUE                                            20600000
206100             WHEN SQLCODE = +0                                    20610000
206200             WHEN SQLCODE = -811                                  20620000
206300                 SET PS-DUPLICATE-CARTON TO TRUE                  20630000
206400             WHEN SQLCODE = -904                                  20640000
206500             WHEN SQLCODE = -911                                  20650000
206600             WHEN SQLCODE = -913                                  20660000
206700                  CONTINUE                                        20670000
206800                                                                  20680000
206900             WHEN SQLCODE = +100                                  20690000
207000                 SET PS-NO-DUPLICATE-CARTON TO TRUE               20700000
207100                                                                  20710000
207200             WHEN SQLWARN0 NOT = SPACES                           20720000
207300             WHEN SQLCODE < +0                                    20730000
207400             WHEN SQLCODE > +0                                    20740000
207500                  MOVE ' 8000-SELECT-TSUCRDV'                     20750000
207600                                  TO PV-PARAGRAPH                 20760006
207700                  MOVE 'UNSUCCESSFUL SELECT ON TSUCRDV  '         20770000
207800                                  TO PV-DB2-FUNCTION              20780006
207900                  MOVE PV-SHIPT-UNT-ID                            20790000
208000                                  TO PV-SHIPT-ID                  20800006
208500                  MOVE 'TSUCRDV ' TO PV-ABEND-TABLE-1             20850007
208800                  PERFORM 9200-SQL-ERROR                          20880006
208900         END-EVALUATE                                             20890000
209000     END-PERFORM.                                                 20900000
209100                                                                  20910000
209200                                                                  20920000
209300     IF  (PV-RETRY-COUNTER > PC-MAX-RETRIES) AND                  20930000
209400         (SQLCODE NOT = +0)                                       20940000
209700         MOVE ' 8000-SELECT-TSUCRDV'                              20970000
209800                                  TO PV-PARAGRAPH                 20980006
209900         MOVE 'MAX RETRIES EXCEEDED ON TSUCRDV SELECT'            20990000
210000                                  TO PV-DB2-FUNCTION              21000006
210200         MOVE 'TSUCRDV '          TO PV-ABEND-TABLE-1             21020007
210500         PERFORM 9200-SQL-ERROR                                   21050006
210600     END-IF.                                                      21060000
210700                                                                  21070000
210800 8200-UPDATE-SHPUNT.                                              21080000
210900                                                                  21090000
211000     EXEC SQL                                                     21100000
211100         UPDATE SUT_OTBND_CART                                    21110000
211200             SET ACTV_IND      = :PV-ACTV-IND                     21120000
211300         ,   PRNT_CART_ID = :PV-PRNT-CART-ID                      21130000
211400         WHERE                                                    21140000
211500             SHIPT_UNT_ID = :SUT00024-SHIPT-UNT-ID                21150000
211600     END-EXEC.                                                    21160000
211700                                                                  21170000
211800     EVALUATE TRUE                                                21180000
211900         WHEN SQLCODE = ZERO                                      21190000
212000             CONTINUE                                             21200000
212100         WHEN SQLWARN0 NOT = SPACES                               21210000
212200         WHEN SQLCODE NOT EQUAL ZERO                              21220000
212300             MOVE ' 8200-UPDATE-SHPUNT'                           21230000
212400                              TO PV-PARAGRAPH                     21240006
212500             MOVE 'SUKCS557 - UPDATE SUT_OTBND_CART ROW'          21250000
212600                              TO PV-DB2-FUNCTION                  21260006
212700              MOVE PV-PRNT-CART-ID                                21270000
212800                              TO PV-DISP-SHIPT-UNT-ID             21280000
212900              MOVE PV-DISP-SHIPT-UNT-ID                           21290000
213000                              TO PV-SHIPT-ID                      21300006
213500              MOVE 'SUT00024' TO PV-ABEND-TABLE-1                 21350007
213800              PERFORM 9200-SQL-ERROR                              21380006
213900     END-EVALUATE.                                                21390000
214000                                                                  21400000
214100                                                                  21410000
214200 8250-INACT-TSUCRDV.                                              21420000
214300                                                                  21430000
214400     EXEC SQL                                                     21440000
214500         UPDATE TSUCRDV                                           21450000
214600             SET ACTV_CDE          = 'I'                          21460000
214700         WHERE                                                    21470000
214800             SHIPT_UNT_ID = :SUT00024-SHIPT-UNT-ID                21480000
214900     END-EXEC.                                                    21490000
215000                                                                  21500000
215100     EVALUATE TRUE                                                21510000
215200         WHEN SQLCODE = ZERO                                      21520000
215300         WHEN SQLCODE = +100                                      21530000
215400             CONTINUE                                             21540000
215500         WHEN SQLWARN0 NOT = SPACES                               21550000
215600         WHEN SQLCODE NOT EQUAL ZERO                              21560000
215700             MOVE ' 8250-INACT-TSUCRDV'                           21570000
215800                              TO PV-PARAGRAPH                     21580006
215900             MOVE 'SUKCS557 - UPDATE TSUCRDV ROW'                 21590000
216000                              TO PV-DB2-FUNCTION                  21600006
216100              MOVE SUT00024-SHIPT-UNT-ID                          21610000
216200                              TO PV-DISP-SHIPT-UNT-ID             21620000
216300              MOVE PV-DISP-SHIPT-UNT-ID                           21630000
216400                              TO PV-SHIPT-ID                      21640006
216900              MOVE 'TSUCRDV ' TO PV-ABEND-TABLE-1                 21690007
217200              PERFORM 9200-SQL-ERROR                              21720006
217300     END-EVALUATE.                                                21730000
217400                                                                  21740000
217500 8300-PROCESS-CHILDREN.                                           21750000
217600     PERFORM 8400-OPEN-CHILD-CSR.                                 21760000
217700     PERFORM 8500-FETCH-CHILD-CSR.                                21770000
217800     PERFORM 2600-MOVE-DIVERT-DATA.                               21780000
217900     MOVE PV-OTBND-CART-SHIPT-UNT-ID   TO PV-SHIPT-UNIT-ID.       21790000
218000     PERFORM UNTIL PS-END-OF-CHILD                                21800000
218100         SET PS-DEST-MATCH-FOUND TO TRUE                          21810000
218200         MOVE PV-OTBND-CART-SHIPT-UNT-ID                          21820000
218300                                       TO SUCRDV-SHIPT-UNT-ID     21830000
218400                                          PV-SHIPT-UNT-ID         21840000
218500         MOVE '00'                     TO PV-CONTAINER-00         21850000
218600         MOVE SPACES                   TO PV-CONTAINER-SPACES     21860000
218700         MOVE PV-CONTAINER-ID          TO SUCRDV-BRCDE-NBR        21870000
218800         PERFORM 7000-INSERT-TSUCRDV                              21880000
218900         MOVE PV-OTBND-CART-SHIPT-UNT-ID                          21890000
219000                                     TO SUT00024-SHIPT-UNT-ID     21900000
219100                                        PV-PRNT-CART-ID           21910000
219200         PERFORM 8200-UPDATE-SHPUNT                               21920000
219300         PERFORM 8500-FETCH-CHILD-CSR                             21930000
219400         MOVE PV-OTBND-CART-SHIPT-UNT-ID                          21940000
219500                                       TO PV-SHIPT-UNIT-ID        21950000
219600     END-PERFORM.                                                 21960000
219700     PERFORM 8600-CLOSE-CHILD-CSR.                                21970000
219800                                                                  21980000
219900 8400-OPEN-CHILD-CSR.                                             21990000
220000                                                                  22000000
220100     EXEC SQL                                                     22010000
220200         OPEN CHILD-CSR                                           22020000
220300     END-EXEC.                                                    22030000
220400                                                                  22040000
220500     EVALUATE TRUE                                                22050000
220600         WHEN SQLCODE = ZERO                                      22060000
220700             SET PS-ALL-CHILD         TO TRUE                     22070000
220800         WHEN SQLWARN0 NOT = SPACES                               22080000
220900         WHEN SQLCODE NOT EQUAL ZERO                              22090000
221000             MOVE ' 8400-OPEN-CHILD-CSR'                          22100000
221100                              TO PV-PARAGRAPH                     22110006
221200             MOVE 'SUKCS557 - FIND ALL CHILDREN'                  22120000
221300                              TO PV-DB2-FUNCTION                  22130006
221400              MOVE DK-SHIPT-UNT-ID                                22140000
221500                              TO PV-DISP-SHIPT-UNT-ID             22150000
221600              MOVE PV-DISP-SHIPT-UNT-ID                           22160000
221700                              TO PV-SHIPT-ID                      22170006
222200              MOVE 'SUT00024' TO PV-ABEND-TABLE-1                 22220007
222500              PERFORM 9200-SQL-ERROR                              22250006
222600     END-EVALUATE.                                                22260000
222700                                                                  22270000
222800 8500-FETCH-CHILD-CSR.                                            22280000
222900                                                                  22290000
223000     EXEC SQL                                                     22300000
223100         FETCH CHILD-CSR                                          22310000
223200         INTO                                                     22320000
223300             :PV-OTBND-CART-SHIPT-UNT-ID                          22330000
223400          ,  :SUT00024-DEST-LOC-NBR                               22340000
223500     END-EXEC.                                                    22350000
223600                                                                  22360000
223700     EVALUATE TRUE                                                22370000
223800         WHEN SQLCODE = ZERO                                      22380000
223900             CONTINUE                                             22390000
224000         WHEN SQLCODE = +100                                      22400000
224100             SET PS-END-OF-CHILD      TO TRUE                     22410000
224200         WHEN SQLWARN0 NOT = SPACES                               22420000
224300         WHEN SQLCODE NOT EQUAL ZERO                              22430000
224400             MOVE ' 8500-FETCH-CHILD-CSR'                         22440000
224500                              TO PV-PARAGRAPH                     22450006
224600             MOVE 'SUKCS557 - FETCH A CHILD'                      22460000
224700                              TO PV-DB2-FUNCTION                  22470006
224800              MOVE DK-SHIPT-UNT-ID                                22480000
224900                              TO PV-DISP-SHIPT-UNT-ID             22490000
225000              MOVE PV-DISP-SHIPT-UNT-ID                           22500000
225100                              TO PV-SHIPT-ID                      22510006
225600              MOVE 'SUT00024' TO PV-ABEND-TABLE-1                 22560007
225900              PERFORM 9200-SQL-ERROR                              22590006
226000     END-EVALUATE.                                                22600000
226100                                                                  22610000
226200                                                                  22620000
226300 8600-CLOSE-CHILD-CSR.                                            22630000
226400                                                                  22640000
226500     EXEC SQL                                                     22650000
226600         CLOSE CHILD-CSR                                          22660000
226700     END-EXEC.                                                    22670000
226800                                                                  22680000
226900     EVALUATE TRUE                                                22690000
227000         WHEN SQLCODE = ZERO                                      22700000
227100             CONTINUE                                             22710000
227200         WHEN SQLWARN0 NOT = SPACES                               22720000
227300         WHEN SQLCODE NOT EQUAL ZERO                              22730000
227400             MOVE ' 8600-CLOSE-CHILD-CSR'                         22740000
227500                              TO PV-PARAGRAPH                     22750006
227600             MOVE 'SUKCS557 - CLOSE CHILD CURSOR'                 22760000
227700                              TO PV-DB2-FUNCTION                  22770006
227800             MOVE DK-SHIPT-UNT-ID                                 22780000
227900                              TO PV-DISP-SHIPT-UNT-ID             22790000
228000             MOVE PV-DISP-SHIPT-UNT-ID                            22800000
228100                              TO PV-SHIPT-ID                      22810006
228600             MOVE 'SUT00024'  TO PV-ABEND-TABLE-1                 22860007
228900              PERFORM 9200-SQL-ERROR                              22890009
229000     END-EVALUATE.                                                22900000
229100                                                                  22910000
229200 8700-VALIDATE-STORE-NBR.                                         22920000
229300      MOVE PV-STORE-NBR      TO DK-STR-NBR.                       22930000
229400      EXEC SQL                                                    22940000
229500        SELECT  STR_NBR                                           22950000
229600          INTO :CNDRST-STR-NBR                                    22960000
229700          FROM  TCNDRST                                           22970000
229800         WHERE  OPER_UNT_ID  =  :DK-OPER-UNT-ID                   22980000
229900           AND  DOOR_ID      =  :CNDCDR-DOOR-ID                   22990000
230000           AND  STR_NBR      =  :DK-STR-NBR                       23000000
230100           AND  END_TMST     =  '9999-09-09-09.09.09.999999'      23010000
230200      END-EXEC.                                                   23020000
230300                                                                  23030000
230400      EVALUATE TRUE                                               23040000
230500          WHEN SQLCODE = +0                                       23050000
230600              CONTINUE                                            23060000
230700          WHEN SQLCODE = +100                                     23070000
230800              SET PS-STORE-NUMBER-NOT-FOUND TO TRUE               23080000
230900          WHEN SQLWARN0 NOT = SPACES                              23090000
231000          WHEN SQLCODE < +0                                       23100000
231100          WHEN SQLCODE > +0                                       23110000
231200              MOVE ' 8700-VALIDATE-STORE-NBR'                     23120000
231300                                        TO PV-PARAGRAPH           23130006
231400              MOVE 'PROBLEM WITH RETRIEVING ROW'                  23140000
231500                                  TO PV-DB2-FUNCTION              23150006
231600              MOVE SU014-DC-NUMBER                                23160000
231700                                  TO PV-DC-NBR                    23170006
231800              MOVE PV-STORE-NBR                                   23180000
231900                                  TO PV-STR-NBR                   23190006
232000              MOVE SU014-DOOR-NUMBER                              23200000
232100                                  TO PV-DOOR-NBR                  23210006
232300              MOVE 'TCNDRST'  TO PV-ABEND-TABLE-1                 23230007
232900              PERFORM 9200-SQL-ERROR                              23290009
233100      END-EVALUATE.                                               23310000
233200******************************************************************23320000
233700                                                                  23370000
233800 9000-EOJ.                                                        23380002
233900     CLOSE CONV-DIVERT-FILE.                                      23390009
235200                                                                  23520000
235201******************************************************************23520109
235202*  PARAGRAPH EXECUTED WHEN SERIOUS DB2 ERROR OCCURRED             23520209
235203******************************************************************23520309
235204 9200-SQL-ERROR.                                                  23520409
235205     CLOSE CONV-DIVERT-FILE.                                      23520513
235206                                                                  23520609
235207     MOVE SQLCODE                     TO SQLCODE2.                23520713
235208     MOVE SQLERRD(3)                  TO SQLERRD3.                23520813
235209                                                                  23520909
235210     DISPLAY '** ABEND **         ** = SQLERROR'.                 23521013
235211     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PGM-NAME.            23521113
235216     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH.                   23521613
235217     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                23521713
235218     DISPLAY '** DC NBR    ** = ' PV-DC-NBR.                      23521815
235219     DISPLAY '** DIVERT NO ** = ' PV-DIVERT-NBR.                  23521914
235220     DISPLAY '** DOOR NBR  ** = ' PV-DOOR-NBR.                    23522014
235221     DISPLAY '** SHIP ID   ** = ' PV-SHIPT-ID.                    23522114
235222     DISPLAY '** ERR CNT   ** = ' PV-ERR-CNT.                     23522215
235223     DISPLAY '**           ** = ' PV-ABEND-TABLE-1.               23522314
235224     DISPLAY '**           ** = ' PV-ABEND-TABLE-2.               23522414
235225     DISPLAY '**           ** = ' PV-ABEND-TABLE-3.               23522514
235226     DISPLAY '**           ** = ' PV-ABEND-TABLE-4.               23522614
235227     DISPLAY '**           ** = ' PV-ABEND-TABLE-5.               23522714
235228     DISPLAY '**           ** = ' PV-ERROR-MSG-1                  23522814
235229     DISPLAY '**           ** = ' PV-ERROR-MSG-2                  23522914
235230     DISPLAY '**           ** = ' PV-ERROR-MSG-3                  23523014
235231                                                                  23523109
235232     DISPLAY '** SQLCODE          ** = ' SQLCODE2.                23523214
235233     DISPLAY '** ROWS PROCESSED   ** = ' SQLERRD3.                23523314
235234     DISPLAY '** SQLERRM          ** = ' SQLERRM.                 23523414
235235     DISPLAY '** SQLERRMC         ** = ' SQLERRMC.                23523514
235236                                                                  23523609
235237     MOVE +4013                       TO PV-ABEND-CODE.           23523717
235238     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         23523814
235239******************************************************************23523909
235240*  PARAGRAPH EXECUTED WHEN WARNING DB2 ERROR OCCURS               23524009
235241******************************************************************23524109
235242 9800-SQL-WARNING.                                                23524209
235243                                                                  23524309
235244     MOVE SQLCODE               TO SQLCODE2.                      23524409
235245     MOVE SQLERRD(3)            TO SQLERRD3.                      23524509
235250     DISPLAY '** ABEND **       ** = SQLWARNING'.                 23525004
235260     DISPLAY '** PROGRAM        ** = ' PC-CURRENT-PGM-NAME.       23526004
235270     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  23527004
235280     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  23528004
235290     DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                  23529004
235291     DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                  23529104
235292     DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                  23529204
235293     DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                  23529304
235294     DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                  23529404
235295     DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                  23529504
235296     DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                  23529604
235297     DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                  23529704
235298                                                                  23529804
235299     MOVE 4013                  TO PV-ABEND-CODE.                 23529904
235300     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         23530004
235310                                                                  23531004
236000*                                                                 23600009
