000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400 PROGRAM-ID.    CEKUP001.                                         00040000
000500 AUTHOR.        JOE LAROSA.                                       00050000
000600 INSTALLATION.  KOHLS.                                            00060000
000700 DATE-WRITTEN.  JUNE 2000.                                        00070000
000800 DATE-COMPILED.                                                   00080000
000900***************************************************************** 00090000
001000*  THIS PROGRAM READS IN THE REFORMATTED MANIFESTED UNIT FILE   * 00100000
001100*  (FORMAT CERD026) AND UPDATES THE CENTRAL STOCK DATABASES     * 00110000
001200*  (TCEPLDS & TCEPLMF).                                         * 00120000
001300*                                                               * 00130000
001400*  IF INVALID CONDITIONS OCCUR DURING UPDATING, AN ERROR RECORD * 00140000
001500*  IS WRITTEN TO AN OUTPUT FILE FOR REPORTING PURPOSES.         * 00150000
001600*                                                               * 00160000
001700*  NOTE:  THIS PROGRAM USES CHECKPOINT/RESTART LOGIC.           * 00170000
001800*                                                               * 00180000
001900****CHANGES****                                                 * 00190000
002000* 08.11.10 - DAVID KIEFER CODEWORKDS                            * 00200000
002100* INC000001358660 - MODIFIED BATCH NUMBER SO THAT WAREHOUSE TRAN* 00210000
002101*     FERS ARE NOT PICKED UP.  THEY ARE NOT TO BE COUNTED       * 00210100
002102*                                                               * 00210200
002103* 11.15.10 - CHRISTINE TWIEHAUS                                 * 00210300
002104* WR38972 - REMOVE CHANGES MADE BY DAVID.  E-STORES WILL NOW    * 00210400
002105*     FLOW DOWN STREAM/HAVE THEIR OWN FINANCIALS SO TRANSFERS   * 00210500
002106*     NEED TO BE PROCESSED.                                     * 00210600
002103* 01.09.20 - JEAN KURK                                          * 00210700
002104* PROGRAM WAS RENAMED FROM WMKUP001 TO CEKUP001                 * 00210800
002107***************************************************************** 00211100
002108 ENVIRONMENT DIVISION.                                            00211200
002109 INPUT-OUTPUT SECTION.                                            00211300
002200                                                                  00211400
002300 FILE-CONTROL.                                                    00212000
002400                                                                  00213000
002500     SELECT INPUT-FILE    ASSIGN TO UT-S-INP01.                   00214000
002600     SELECT OUTPUT-FILE   ASSIGN TO UT-S-OUT01.                   00215000
002700                                                                  00216000
002800***************************************************************** 00217000
002900 DATA DIVISION.                                                   00218000
003000 FILE SECTION.                                                    00219000
003100                                                                  00220000
003200 FD  INPUT-FILE                                                   00230000
003300     RECORDING MODE IS F                                          00240000
003400     LABEL RECORDS ARE STANDARD                                   00250000
003500     RECORD CONTAINS 150                                          00260000
003600     BLOCK CONTAINS 0 RECORDS                                     00270000
003700     DATA RECORD IS INPUT-RECORD.                                 00280000
003800 01  INPUT-RECORD                PIC X(150).                      00290000
003900                                                                  00300000
004000 FD  OUTPUT-FILE                                                  00310000
004100     RECORDING MODE IS F                                          00320000
004200     LABEL RECORDS ARE STANDARD                                   00330000
004300     RECORD CONTAINS 150                                          00340000
004400     BLOCK CONTAINS 0 RECORDS                                     00350000
004500     DATA RECORD IS OUTPUT-RECORD.                                00360000
004600 01  OUTPUT-RECORD               PIC X(150).                      00370000
004700                                                                  00380000
004800***************************************************************** 00390000
004900 WORKING-STORAGE SECTION.                                         00400000
005000                                                                  00410000
005100 01  PS-PROGRAM-SWITCHES.                                         00420000
005200     05  PS-END-OF-INPUT-SW           PIC  X(01) VALUE 'N'.       00430000
005300         88  PS-END-OF-INPUT                     VALUE 'Y'.       00440000
005400         88  PS-NOT-END-OF-INPUT                 VALUE 'N'.       00450000
005500     05  PS-RUN-TYPE-SW               PIC  X(01) VALUE ' '.       00460000
005600         88  PS-NORMAL-RUN                       VALUE '0'.       00470000
005700         88  PS-RESTART-RUN                      VALUE '9'.       00480000
005800     05  PS-COMMITS-TAKEN-SW          PIC  X(01) VALUE 'N'.       00490000
005900         88  PS-COMMITS-TAKEN                    VALUE 'T'.       00500000
006000         88  PS-NO-COMMITS-TAKEN                 VALUE 'N'.       00510000
006100     05  PS-TCEPLRQ-SW                PIC  X(01) VALUE 'N'.       00520000
006200         88  PS-TCEPLRQ-FOUND                    VALUE 'Y'.       00530000
006300         88  PS-TCEPLRQ-NOT-FOUND                VALUE 'N'.       00540000
006400     05  PS-TCEPLIT-SW                PIC  X(01) VALUE 'N'.       00550000
006500         88  PS-TCEPLIT-FOUND                    VALUE 'Y'.       00560000
006600         88  PS-TCEPLIT-NOT-FOUND                VALUE 'N'.       00570000
006700     05  PS-TCEPLDS-SW                PIC  X(01) VALUE 'N'.       00580000
006800         88  PS-TCEPLDS-FOUND                    VALUE 'Y'.       00590000
006900         88  PS-TCEPLDS-NOT-FOUND                VALUE 'N'.       00600000
007000     05  PS-END-OF-CURSOR-SW          PIC  X(01) VALUE 'N'.       00610000
007100         88  PS-END-OF-CURSOR-YES                VALUE 'Y'.       00620000
007200         88  PS-END-OF-CURSOR-NO                 VALUE 'N'.       00630000
007210     05  PS-FIRST-TIME-THRU-SW        PIC  X(01) VALUE 'Y'.       00640000
007220         88  PS-FIRST-TIME-THRU                  VALUE 'Y'.       00650000
007230         88  PS-NOT-FIRST-TIME-THRU              VALUE 'N'.       00660000
007300                                                                  00670000
007400 01  DK-DB2-KEY-FIELDS.                                           00680000
007500     05  DK-REQ-PL-NBR                PIC S9(09) VALUE +0 COMP.   00690000
007600     05  DK-PL-LNE-NBR                PIC S9(04) VALUE +0 COMP.   00700000
007700     05  DK-STR-NBR                   PIC S9(04) VALUE +0 COMP.   00710000
007800                                                                  00720000
007900 01  PV-PROGRAM-VARIABLES.                                        00730000
008000     05  PV-SQLCODE                   PIC  9999-.                 00740000
008100     05  PV-TMST                      PIC  X(26) VALUE SPACES.    00750000
008200     05  PV-HOLD-TMST                 PIC  X(26) VALUE SPACES.    00760000
008300     05  PV-CKPT-STAT-CODE            PIC  X(01) VALUE SPACES.    00770000
008400     05  PV-RETRY-COUNTER             PIC S9(04) VALUE +0         00780000
008500                                                 COMP SYNC.       00790000
008600     05  PV-PREV-PULL-NBR             PIC  9(08) VALUE ZERO.      00800000
008700     05  PV-PREV-PULL-LNE-NBR         PIC  9(04) VALUE ZERO.      00810000
008800     05  PV-PREV-RECV-STORE-NBR       PIC  9(04) VALUE ZERO.      00820000
008900     05  PV-CEPLRQ-STS                PIC  X(01) VALUE SPACES.    00830000
009000     05  PV-CEPLIT-STS                PIC  X(01) VALUE SPACES.    00840000
009100     05  PV-CEPLDS-STS                PIC  X(01) VALUE SPACES.    00850000
009200     05  PV-ACCUM-MANIFEST-QTY        PIC  9(08) VALUE ZERO.      00860000
009300     05  PV-CURR-DATE-YYMMDD.                                     00870000
009400         10  PV-CURR-DATE-YY          PIC  9(02) VALUE ZERO.      00880000
009500         10  PV-CURR-DATE-MM          PIC  9(02) VALUE ZERO.      00890000
009600         10  PV-CURR-DATE-DD          PIC  9(02) VALUE ZERO.      00900000
009700     05  PV-CURR-TIME.                                            00910000
009800         10  PV-CURR-TIME-HH          PIC  9(02) VALUE ZERO.      00920000
009900         10  PV-CURR-TIME-MM          PIC  9(02) VALUE ZERO.      00930000
010000         10  PV-CURR-TIME-SS          PIC  9(02) VALUE ZERO.      00940000
010100         10  PV-CURR-TIME-REST.                                   00950000
010200             15  PV-CURR-TIME-F2      PIC  9(02) VALUE ZERO.      00960000
010300             15  PV-CURR-TIME-L4      PIC  9(04) VALUE 9999.      00970000
010400     05  PV-SQL-OUTPUT-TMST           PIC  X(26) VALUE SPACES.    00980000
010410     05  PV-OUTPUT-TMST.                                          00990000
010500         10  PV-OUT-CC                PIC  9(02) VALUE ZERO.      01000000
010600         10  PV-OUT-YR                PIC  9(02) VALUE ZERO.      01010000
010700         10  PV-OUT-H1                PIC  X(01) VALUE '-'.       01020000
010800         10  PV-OUT-MON               PIC  9(02) VALUE ZERO.      01030000
010900         10  PV-OUT-H2                PIC  X(01) VALUE '-'.       01040000
011000         10  PV-OUT-DAY               PIC  9(02) VALUE ZERO.      01050000
011100         10  PV-OUT-H3                PIC  X(01) VALUE '-'.       01060000
011200         10  PV-OUT-HR                PIC  9(02) VALUE ZERO.      01070000
011300         10  PV-OUT-P1                PIC  X(01) VALUE '.'.       01080000
011400         10  PV-OUT-MIN               PIC  9(02) VALUE ZERO.      01090000
011500         10  PV-OUT-P2                PIC  X(01) VALUE '.'.       01100000
011600         10  PV-OUT-SEC               PIC  9(02) VALUE ZERO.      01110000
011700         10  PV-OUT-P3                PIC  X(01) VALUE '.'.       01120000
011800         10  PV-OUT-REST              PIC  9(06) VALUE ZERO.      01130000
011900     05  PV-CEPLDS-DISTRB-QTY         PIC S9(09) VALUE +0 COMP.   01140000
012000     05  PV-NULL-IND-1                PIC S9(04) VALUE +0 COMP.   01150000
012100     05  PV-TOTAL-COMMITS             PIC S9(08) VALUE ZERO.      01160000
012200     05  PV-RECORDS-READ              PIC S9(08) VALUE ZERO.      01170000
012300     05  PV-RECORDS-INSERTED          PIC S9(08) VALUE ZERO.      01180000
012400     05  PV-RECORDS-ERRED             PIC S9(08) VALUE ZERO.      01190000
012500     05  PV-DISPLAY-RECORD            PIC ZZ,ZZZ,ZZ9-.            01200000
012600                                                                  01210000
012700 01 PC-PROGRAM-CONSTANTS.                                         01220000
012800     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'CEKUP001'.01230000
012900     05  PC-MAX-RETRIES               PIC S9(03) VALUE +5 COMP-3. 01240000
013000     05  PC-IN-PROCESS-CODE           PIC  X(01) VALUE '9'.       01250000
013100     05  PC-RUN-COMPLETE-CODE         PIC  X(01) VALUE '0'.       01260000
013200     05  PC-DEFAULT-TMST              PIC  X(26) VALUE            01270000
013300                                     '9999-09-09-09.09.09.999999'.01280000
013400 01  PV-ABEND-FIELDS.                                             01290000
013500     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         01300000
013600                                                 COMP SYNC.       01310000
013700     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'CEKUP001'.01320000
013800     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01330000
013900     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    01340000
014000     05  PV-ABEND-STRUCTURE-1         PIC  X(08) VALUE SPACES.    01350000
014100     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01360000
014200     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01370000
014300     05  PV-DB2-TABLE-NAME            PIC  X(08) VALUE SPACES.    01380000
014400                                                                  01390000
014500 01  CKPT-RESTART-INFO.                                           01400000
014600     05  CR-TOTAL-COMMITS             PIC S9(08) VALUE ZERO.      01410000
014700     05  CR-RECORDS-READ              PIC S9(08) VALUE ZEROES.    01420000
014800     05  CR-RECORDS-INSERTED          PIC S9(08) VALUE ZEROES.    01430000
014900     05  CR-RECORDS-ERRED             PIC S9(08) VALUE ZEROES.    01440000
015000     05  CR-PREV-PULL-NBR             PIC  9(08) VALUE ZERO.      01450000
015100     05  CR-PREV-PULL-LNE-NBR         PIC  9(04) VALUE ZERO.      01460000
015200     05  CR-PREV-RECV-STORE-NBR       PIC  9(04) VALUE ZERO.      01470000
015300     05  CR-CEPLRQ-STS                PIC  X(01) VALUE SPACES.    01480000
015400     05  CR-CEPLIT-STS                PIC  X(01) VALUE SPACES.    01490000
015500     05  CR-CEPLDS-STS                PIC  X(01) VALUE SPACES.    01500000
015600     05  CR-ACCUM-MANIFEST-QTY        PIC  9(08) VALUE ZEROES.    01510000
015700                                                                  01520000
015800***********************************************************       01530000
015900*  COPYBOOK USED BY INPUT AND OUTPUT FILE.                *       01540000
016000***********************************************************       01550000
016100     COPY CERD026.                                                01560000
016200                                                                  01570000
016300***********************************************************       01580000
016400*  USED FOR DB2 ERROR MESSAGE BUILDING                    *       01590000
016500***********************************************************       01600000
016600     COPY DPWS004.                                                01610000
016700                                                                  01620000
016800***********************************************************       01630000
016900*  DB2 SQL COMMUNICATION AREA                             *       01640000
017000***********************************************************       01650000
017100     EXEC SQL                                                     01660000
017200         INCLUDE SQLCA                                            01670000
017300     END-EXEC.                                                    01680000
017400                                                                  01690000
017500***********************************************************       01700000
017600*  COMPANY CONTROL TABLE                                  *       01710000
017700***********************************************************       01720000
017800     EXEC SQL                                                     01730000
017900         INCLUDE TCOCNTL                                          01740000
018000     END-EXEC.                                                    01750000
018100                                                                  01760000
018110***********************************************************       01770000
018120*  CENTRAL STOCK - REQUEST TABLE                          *       01780000
018130***********************************************************       01790000
018140     EXEC SQL                                                     01800000
018150         INCLUDE TCEPLRQ                                          01810000
018160     END-EXEC.                                                    01811000
018170                                                                  01812000
018200***********************************************************       01813000
018300*  CENTRAL STOCK - LINE ITEM TABLE                        *       01814000
018400***********************************************************       01815000
018500     EXEC SQL                                                     01816000
018600         INCLUDE TCEPLIT                                          01817000
018700     END-EXEC.                                                    01818000
018800                                                                  01819000
018900***********************************************************       01820000
019000*  CENTRAL STOCK - STORE (DISTRIBUTION) TABLE             *       01830000
019100***********************************************************       01840000
019200     EXEC SQL                                                     01850000
019300         INCLUDE TCEPLDS                                          01860000
019400     END-EXEC.                                                    01870000
019500                                                                  01880000
019600***********************************************************       01890000
019700*  CENTRAL STOCK - MANIFEST TABLE                         *       01900000
019800***********************************************************       01910000
019900     EXEC SQL                                                     01920000
020000         INCLUDE TCEPLMF                                          01930000
020100     END-EXEC.                                                    01940000
020200                                                                  01950000
020300***********************************************************       01960000
020400*  CHECKPOINT RESTART INFORMATION TABLE (TCKRSTINF) -     *       01970000
020500*  THIS TABLE IS USED TO KEEP WORKING STORAGE INFORMATION *       01980000
020600*  FOR CHECKPOINT RESTARTS.                               *       01990000
020700***********************************************************       02000000
020800     EXEC SQL                                                     02010000
020900         INCLUDE TCKRSTIN                                         02020000
021000     END-EXEC.                                                    02030000
021100                                                                  02040000
021200***********************************************************       02050000
021300*  CHECKPOINT RESTART CONTROL (TCKRSTCNTL) -              *       02060000
021400*  THIS TABLE IS USED TO CONTROL COMMIT INTERVALS.        *       02070000
021500***********************************************************       02080000
021600     EXEC SQL                                                     02090000
021700         INCLUDE TCKRSTCN                                         02100000
021800     END-EXEC.                                                    02110000
021900                                                                  02120000
022000***********************************************************       02130000
022100***********************************************************       02140000
022200 PROCEDURE DIVISION.                                              02150000
022300     DISPLAY '*** START OF CEKUP001 ***'.                         02160000
022400     DISPLAY ' '.                                                 02170000
022500                                                                  02180000
022600*INITIALIZATION.                                                  02190000
022700     PERFORM 0100-INITIALIZATION.                                 02200000
022800                                                                  02210000
022900*PROCESS INPUT FILE.                                              02220000
023000     IF PS-END-OF-INPUT                                           02230000
023100         DISPLAY '**** NO INPUT FILE FOUND FOR CEKUP001 ****'     02240000
023200     ELSE                                                         02250000
023300         PERFORM 1000-PROCESS-INPUT                               02260000
023400           UNTIL PS-END-OF-INPUT                                  02270000
023500     END-IF.                                                      02280000
023600                                                                  02290000
023700*DISPLAY RECORD COUNTS.                                           02300000
023800     DISPLAY ' '.                                                 02310000
023900     DISPLAY '****************************************'.          02320000
024000     MOVE PV-RECORDS-READ        TO PV-DISPLAY-RECORD.            02330000
024100     DISPLAY '*** RECORDS READ     ==> ' PV-DISPLAY-RECORD.       02340000
024200     MOVE PV-RECORDS-INSERTED    TO PV-DISPLAY-RECORD.            02350000
024300     DISPLAY '*** RECORDS INSERTED ==> ' PV-DISPLAY-RECORD.       02360000
024400     MOVE PV-RECORDS-ERRED       TO PV-DISPLAY-RECORD.            02370000
024500     DISPLAY '*** ERRORS WRITTEN   ==> ' PV-DISPLAY-RECORD.       02380000
024600     DISPLAY '****************************************'.          02390000
024700     DISPLAY ' '.                                                 02400000
024800                                                                  02410000
024900*CLOSE FILES.                                                     02420000
025000     CLOSE INPUT-FILE                                             02430000
025100           OUTPUT-FILE.                                           02440000
025200                                                                  02450000
025300     MOVE PC-RUN-COMPLETE-CODE TO PV-CKPT-STAT-CODE.              02460000
025400     PERFORM 4210-UPDATE-TCKRSTCNTL.                              02470000
025500                                                                  02480000
025600     DISPLAY '***  END OF CEKUP001  ***'.                         02490000
025700     GOBACK.                                                      02500000
025800                                                                  02510000
025900******************************************************************02520000
026000 0100-INITIALIZATION.                                             02530000
026100******************************************************************02540000
026200     MOVE '0100-INITIALIZATION        ' TO PV-ABEND-PARAGRAPH.    02550000
026300                                                                  02560000
026400     OPEN INPUT  INPUT-FILE                                       02570000
026500          OUTPUT OUTPUT-FILE.                                     02580000
026600                                                                  02590000
026700     ACCEPT PV-CURR-DATE-YYMMDD FROM DATE.                        02600000
026800     ACCEPT PV-CURR-TIME        FROM TIME.                        02610000
026900                                                                  02620000
027000*CHECKPOINT RESTART LOGIC.                                        02630000
027100     PERFORM 4000-GET-CHECKPOINT-CNTL.                            02640000
027200     MOVE PV-CKPT-STAT-CODE TO PS-RUN-TYPE-SW.                    02650000
027300                                                                  02660000
027400     IF PS-RESTART-RUN                                            02670000
027500         PERFORM 4100-CHECKPOINT-RESTART                          02680000
027600     ELSE                                                         02690000
027700*READ FIRST INPUT RECORD (IF NOT RESTART).                        02700000
027900         READ INPUT-FILE INTO CE026-CS-STR-MANIFEST-RECORD        02710000
028000           AT END                                                 02720000
028100             SET PS-END-OF-INPUT TO TRUE                          02730000
028101           NOT AT END                                             02740000
028102             SET PS-NOT-END-OF-INPUT TO TRUE                      02750000
181800             PERFORM 4600-SET-CHECKPOINT-TIME                     02760000
181801         END-READ                                                 02770000
181802     END-IF.                                                      02780000
181803                                                                  02790000
181804******************************************************************02800000
181805 1000-PROCESS-INPUT.                                              02810000
181806******************************************************************02820000
181807     MOVE '1000-PROCESS-INPUT         ' TO PV-ABEND-PARAGRAPH.    02830000
181808                                                                  02840000
181809     ADD +1 TO PV-RECORDS-READ.                                   02850000
181810***  DISPLAY 'INPUT = ' CE026-PULL-NBR '/' CE026-PULL-LNE-NBR     02860000
181811***                     '/' CE026-RECV-STORE-NBR.                 02870000
181812                                                                  02880000
181813*RETAIN THE PREVIOUS PULL#, LINE & STORE SO UNNEEDED SELECTS ARE  02890000
181814*NOT PERFORMED (IF DATA IS THE SAME).  PREVIOUS RECORD STATUSES   02900000
181815*MUST ALSO BE RETAINED FOR WRITING ERRORS OUT AS NEEDED.          02910000
181816                                                                  02920000
181817*READ PULL REQUEST TABLE.                                         02930000
181818     MOVE CE026-PULL-NBR TO DK-REQ-PL-NBR.                        02940000
181819     IF CE026-PULL-NBR NOT = PV-PREV-PULL-NBR                     02950000
181820         MOVE 9999 TO PV-PREV-PULL-LNE-NBR                        02960000
181821                      PV-PREV-RECV-STORE-NBR                      02970000
181822         MOVE ' '  TO PV-CEPLIT-STS                               02980000
181823                      PV-CEPLDS-STS                               02990000
181824         PERFORM 1100-PROCESS-TCEPLRQ                             03000000
181825     ELSE                                                         03010000
181826         IF PV-CEPLRQ-STS NOT = ' '                               03020000
181827             PERFORM 1120-WRITE-TCEPLRQ-ERR                       03030000
181828         END-IF                                                   03040000
181829     END-IF.                                                      03050000
181830                                                                  03060000
181831*READ PULL ITEM TABLE.                                            03070000
181832     MOVE CE026-PULL-LNE-NBR TO DK-PL-LNE-NBR.                    03080000
181833     IF PV-CEPLRQ-STS = ' '                                       03090000
181834         IF CE026-PULL-LNE-NBR NOT = PV-PREV-PULL-LNE-NBR         03100000
181835             MOVE 9999 TO PV-PREV-RECV-STORE-NBR                  03110000
181836             MOVE ' '  TO PV-CEPLDS-STS                           03120000
181837             PERFORM 1200-PROCESS-TCEPLIT                         03130000
181838         ELSE                                                     03140000
181839             IF PV-CEPLIT-STS NOT = ' '                           03150000
181840                 PERFORM 1220-WRITE-TCEPLIT-ERR                   03160000
181841             END-IF                                               03170000
181842         END-IF                                                   03180000
181843     END-IF.                                                      03190000
181844                                                                  03200000
181845*READ STORE DISTRIBUTION TABLE.                                   03210000
181846     MOVE CE026-RECV-STORE-NBR TO DK-STR-NBR.                     03220000
181847     IF PV-CEPLRQ-STS = ' '                                       03230000
181848       AND PV-CEPLIT-STS = ' '                                    03240000
181849         IF CE026-RECV-STORE-NBR NOT = PV-PREV-RECV-STORE-NBR     03250000
181850             PERFORM 1300-PROCESS-TCEPLDS                         03260000
181851         ELSE                                                     03270000
181852             IF PV-CEPLDS-STS NOT = ' '                           03280000
181853                 PERFORM 1320-WRITE-TCEPLDS-ERR                   03290000
181854             END-IF                                               03300000
181855         END-IF                                                   03310000
181856     END-IF.                                                      03320000
181857                                                                  03330000
181858*INSERT MANIFEST (TCEPLMF) RECORD IF NO ERRORS.                   03340000
181859     IF  PV-CEPLRQ-STS = ' '                                      03350000
181860     AND PV-CEPLIT-STS = ' '                                      03360000
181861     AND PV-CEPLDS-STS = ' '                                      03370000
181862         PERFORM 3000-INSERT-TCEPLMF                              03380000
181863     END-IF.                                                      03390000
181864                                                                  03400000
181865* IF FIRST TIME THROUGH PROGRAM AND NO ERRORS, MOVE THE           03410000
181866* MANIFEST QUANTITY FROM THE INPUT RECORD TO THE PV-ACCUM         03420000
181867* FIELD SO THAT IT GETS ACCUMULATED TO UPDATE THE TCEPLDS         03430000
181868* TABLE.                                                          03440000
181869                                                                  03450000
181870     IF  PS-FIRST-TIME-THRU                                       03460000
181871         SET PS-NOT-FIRST-TIME-THRU TO TRUE                       03470000
181872         IF  PV-CEPLRQ-STS = ' '                                  03480000
181873         AND PV-CEPLIT-STS = ' '                                  03490000
181874         AND PV-CEPLDS-STS = ' '                                  03500000
181875             MOVE CE026-MANIFEST-QTY  TO PV-ACCUM-MANIFEST-QTY    03510000
181876         END-IF                                                   03520000
181877     END-IF.                                                      03530000
181878                                                                  03540000
181879*READ NEXT INPUT RECORD.                                          03550000
181880     PERFORM 2000-READ-INPUT-FILE.                                03560000
181881                                                                  03570000
181882*ACCUMULATE MANIFEST QTY AND UPDATE TCEPLDS (IF NO ERRORS).       03580000
181883     IF  (CE026-PULL-NBR NOT = PV-PREV-PULL-NBR)                  03590000
181884     OR  (CE026-PULL-LNE-NBR NOT = PV-PREV-PULL-LNE-NBR)          03600000
181885     OR  (CE026-RECV-STORE-NBR NOT = PV-PREV-RECV-STORE-NBR)      03610000
181886     OR  PS-END-OF-INPUT                                          03620000
181887         IF  PV-CEPLRQ-STS = ' '                                  03630000
181888         AND PV-CEPLIT-STS = ' '                                  03640000
181889         AND PV-CEPLDS-STS = ' '                                  03650000
181890             PERFORM 3100-UPDATE-TCEPLDS                          03660000
181891             MOVE CE026-MANIFEST-QTY  TO PV-ACCUM-MANIFEST-QTY    03670000
181892         ELSE                                                     03680000
181893             MOVE CE026-MANIFEST-QTY  TO PV-ACCUM-MANIFEST-QTY    03690000
181894         END-IF                                                   03700000
181895     ELSE                                                         03710000
181896         COMPUTE PV-ACCUM-MANIFEST-QTY = PV-ACCUM-MANIFEST-QTY    03720000
181897                                       + CE026-MANIFEST-QTY       03730000
181898     END-IF.                                                      03740000
181899                                                                  03750000
181900*CHECK TO SEE IF A COMMIT/CHECKPOINT SHOULD BE TAKEN.             03760000
181901     PERFORM 4200-COMMIT-CHECK.                                   03770000
181902                                                                  03780000
181903***************************************************************** 03790000
181904 1100-PROCESS-TCEPLRQ.                                            03800000
181905***************************************************************** 03810000
181906     MOVE '1100-PROCESS-TCEPLRQ         ' TO PV-ABEND-PARAGRAPH.  03820000
181907                                                                  03830000
181908     MOVE CE026-PULL-NBR TO PV-PREV-PULL-NBR.                     03840000
181909     MOVE ' '            TO PV-CEPLRQ-STS.                        03850000
181910                                                                  03860000
181911     PERFORM 1110-READ-TCEPLRQ.                                   03870000
181912                                                                  03880000
181913     IF PS-TCEPLRQ-NOT-FOUND                                      03890000
181914         SET CE026-PULL-NBR-NOT-FOUND TO TRUE                     03900000
181915         MOVE 'A' TO PV-CEPLRQ-STS                                03910000
181916         WRITE OUTPUT-RECORD                                      03920000
181917          FROM CE026-CS-STR-MANIFEST-RECORD                       03930000
181918         ADD +1 TO PV-RECORDS-ERRED                               03940000
181919     ELSE                                                         03950000
181920         IF CEPLRQ-STAT-CDE = 'CA'                                03960000
181921             SET CE026-CANCEL-PULL-NBR TO TRUE                    03970000
181922             MOVE 'B' TO PV-CEPLRQ-STS                            03980000
181923             WRITE OUTPUT-RECORD                                  03990000
181924              FROM CE026-CS-STR-MANIFEST-RECORD                   04000000
181925             ADD +1 TO PV-RECORDS-ERRED                           04010000
181926         ELSE                                                     04020000
181927             IF CEPLRQ-STAT-CDE = 'PD'                            04030000
181928                 SET CE026-POSTED-PULL-NBR TO TRUE                04040000
181929                 MOVE 'C' TO PV-CEPLRQ-STS                        04050000
181930                 WRITE OUTPUT-RECORD                              04060000
181931                  FROM CE026-CS-STR-MANIFEST-RECORD               04070000
181932                     ADD +1 TO PV-RECORDS-ERRED                   04080000
181933             END-IF                                               04090000
181934         END-IF                                                   04100000
181935     END-IF.                                                      04110000
181936                                                                  04120000
181937***************************************************************** 04130000
181938 1110-READ-TCEPLRQ.                                               04140000
181939***************************************************************** 04150000
181940     MOVE '1100-READ-TCEPLRQ            ' TO PV-ABEND-PARAGRAPH.  04160000
181941                                                                  04170000
181942     EXEC SQL                                                     04180000
181943         SELECT  CNSTK_LOC_ID                                     04190000
181944              ,  SRC_REF_NBR                                      04200000
181945              ,  SRC_TYP_CDE                                      04210000
181946              ,  STAT_CDE                                         04220000
181947           INTO  :CEPLRQ-CNSTK-LOC-ID                             04230000
181948              ,  :CEPLRQ-SRC-REF-NBR                              04240000
181949              ,  :CEPLRQ-SRC-TYP-CDE                              04250000
181950              ,  :CEPLRQ-STAT-CDE                                 04260000
181951           FROM  TCEPLRQ                                          04270000
181952          WHERE  CNSTK_REQ_PL_NBR = :DK-REQ-PL-NBR                04280000
181953          WITH UR                                                 04290000
181954     END-EXEC.                                                    04300000
181955                                                                  04310000
181956     EVALUATE TRUE                                                04320000
181957       WHEN SQLCODE = +0                                          04330000
181958           SET PS-TCEPLRQ-FOUND TO TRUE                           04340000
181959                                                                  04350000
181960       WHEN SQLCODE = +100                                        04360000
181961           SET PS-TCEPLRQ-NOT-FOUND TO TRUE                       04370000
181962                                                                  04380000
181963       WHEN OTHER                                                 04390000
181964           MOVE 'TCEPLRQ' TO PV-DB2-TABLE-NAME                    04400000
181965           MOVE 'SELECT CE PULL REQUEST'                          04410000
181966                          TO PV-DB2-OPERATION-MESSAGE-1           04420000
181967           PERFORM 9900-DB2-ABEND                                 04430000
181968     END-EVALUATE.                                                04440000
181969                                                                  04450000
181970***************************************************************** 04460000
181971 1120-WRITE-TCEPLRQ-ERR.                                          04470000
181972***************************************************************** 04480000
181973     MOVE '1120-WRITE-TCEPLRQ-ERR       ' TO PV-ABEND-PARAGRAPH.  04490000
181974                                                                  04500000
181975     IF PV-CEPLRQ-STS = 'A'                                       04510000
181976         SET CE026-PULL-NBR-NOT-FOUND TO TRUE                     04520000
181977         WRITE OUTPUT-RECORD                                      04530000
181978          FROM CE026-CS-STR-MANIFEST-RECORD                       04540000
181979         ADD +1 TO PV-RECORDS-ERRED                               04550000
181980     END-IF.                                                      04560000
181981                                                                  04570000
181982     IF PV-CEPLRQ-STS = 'B'                                       04580000
181983         SET CE026-CANCEL-PULL-NBR TO TRUE                        04590000
181984         WRITE OUTPUT-RECORD                                      04600000
181985          FROM CE026-CS-STR-MANIFEST-RECORD                       04610000
181986         ADD +1 TO PV-RECORDS-ERRED                               04620000
181987     END-IF.                                                      04630000
181988                                                                  04640000
181989     IF PV-CEPLRQ-STS = 'C'                                       04650000
181990         SET CE026-POSTED-PULL-NBR TO TRUE                        04660000
181991         WRITE OUTPUT-RECORD                                      04670000
181992          FROM CE026-CS-STR-MANIFEST-RECORD                       04680000
181993         ADD +1 TO PV-RECORDS-ERRED                               04690000
181994     END-IF.                                                      04700000
181995                                                                  04710000
181996     IF PV-CEPLRQ-STS NOT = 'A' AND 'B' AND 'C'                   04720000
181997         DISPLAY '** ERROR ON TCEPLRQ ' CE026-PULL-NBR            04730000
181998         DISPLAY '** UNKNOWN STATUS = ' PV-CEPLRQ-STS             04740000
181999     END-IF.                                                      04750000
182000                                                                  04760000
182001***************************************************************** 04770000
182002 1200-PROCESS-TCEPLIT.                                            04780000
182003***************************************************************** 04790000
182004     MOVE '1200-PROCESS-TCEPLIT         ' TO PV-ABEND-PARAGRAPH.  04800000
182005                                                                  04810000
182006     MOVE CE026-PULL-LNE-NBR TO PV-PREV-PULL-LNE-NBR.             04820000
182007     MOVE ' '                TO PV-CEPLIT-STS.                    04830000
182008                                                                  04840000
182009     PERFORM 1210-READ-TCEPLIT.                                   04850000
182010     IF PS-TCEPLIT-NOT-FOUND                                      04860000
182011         SET CE026-LINE-NBR-NOT-FOUND TO TRUE                     04870000
182012         MOVE 'A' TO PV-CEPLIT-STS                                04880000
182013         WRITE OUTPUT-RECORD                                      04890000
182014          FROM CE026-CS-STR-MANIFEST-RECORD                       04900000
182015         ADD +1 TO PV-RECORDS-ERRED                               04910000
182016     ELSE                                                         04920000
182017         IF CEPLIT-STAT-CDE = 'CA'                                04930000
182018             SET CE026-CANCEL-LINE-NBR TO TRUE                    04940000
182019             MOVE 'B' TO PV-CEPLIT-STS                            04950000
182020             WRITE OUTPUT-RECORD                                  04960000
182021              FROM CE026-CS-STR-MANIFEST-RECORD                   04970000
182022             ADD +1 TO PV-RECORDS-ERRED                           04980000
182023         ELSE                                                     04990000
182024             IF CEPLIT-STAT-CDE = 'PD'                            05000000
182025                 SET CE026-POSTED-LINE-NBR TO TRUE                05010000
182026                 MOVE 'C' TO PV-CEPLIT-STS                        05020000
182027                 WRITE OUTPUT-RECORD                              05030000
182028                  FROM CE026-CS-STR-MANIFEST-RECORD               05040000
182029                 ADD +1 TO PV-RECORDS-ERRED                       05050000
182030             END-IF                                               05060000
182031         END-IF                                                   05070000
182032     END-IF.                                                      05080000
182033                                                                  05090000
182034***************************************************************** 05100000
182035 1210-READ-TCEPLIT.                                               05110000
182036***************************************************************** 05120000
182037     MOVE '1210-READ-TCEPLIT            ' TO PV-ABEND-PARAGRAPH.  05130000
182038                                                                  05140000
182039     EXEC SQL                                                     05150000
182040         SELECT  ITM_NBR                                          05160000
182041              ,  STAT_CDE                                         05170000
182042           INTO  :CEPLIT-ITM-NBR                                  05180000
182043              ,  :CEPLIT-STAT-CDE                                 05190000
182044           FROM  TCEPLIT                                          05200000
182045          WHERE  CNSTK_REQ_PL_NBR = :DK-REQ-PL-NBR                05210000
182046            AND  PL_LNE_NBR       = :DK-PL-LNE-NBR                05220000
182047          WITH UR                                                 05230000
182048     END-EXEC.                                                    05240000
182049                                                                  05250000
182050     EVALUATE TRUE                                                05260000
182051       WHEN SQLCODE = +0                                          05270000
182052           SET PS-TCEPLIT-FOUND TO TRUE                           05280000
182053                                                                  05290000
182054       WHEN SQLCODE = +100                                        05300000
182055           SET PS-TCEPLIT-NOT-FOUND TO TRUE                       05310000
182056                                                                  05320000
182057       WHEN OTHER                                                 05330000
182058           MOVE 'TCEPLIT' TO PV-DB2-TABLE-NAME                    05340000
182059           MOVE 'SELECT CE PULL ITEM   '                          05350000
182060                          TO PV-DB2-OPERATION-MESSAGE-1           05360000
182061           PERFORM 9900-DB2-ABEND                                 05370000
182062     END-EVALUATE.                                                05380000
182063                                                                  05390000
182064***************************************************************** 05400000
182065 1220-WRITE-TCEPLIT-ERR.                                          05410000
182066***************************************************************** 05420000
182067     MOVE '1220-WRITE-TCEPLIT-ERR       ' TO PV-ABEND-PARAGRAPH.  05430000
182068                                                                  05440000
182069     IF PV-CEPLIT-STS = 'A'                                       05450000
182070         SET CE026-LINE-NBR-NOT-FOUND TO TRUE                     05460000
182071         WRITE OUTPUT-RECORD                                      05470000
182072          FROM CE026-CS-STR-MANIFEST-RECORD                       05480000
182073         ADD +1 TO PV-RECORDS-ERRED                               05490000
182074     END-IF.                                                      05500000
182075                                                                  05510000
182076     IF PV-CEPLIT-STS = 'B'                                       05520000
182077         SET CE026-CANCEL-LINE-NBR TO TRUE                        05530000
182078         WRITE OUTPUT-RECORD                                      05540000
182079          FROM CE026-CS-STR-MANIFEST-RECORD                       05550000
182080         ADD +1 TO PV-RECORDS-ERRED                               05560000
182081     END-IF.                                                      05570000
182082                                                                  05580000
182083     IF PV-CEPLIT-STS = 'C'                                       05590000
182084         SET CE026-POSTED-LINE-NBR TO TRUE                        05600000
182085         WRITE OUTPUT-RECORD                                      05610000
182086          FROM CE026-CS-STR-MANIFEST-RECORD                       05620000
182087         ADD +1 TO PV-RECORDS-ERRED                               05630000
182088     END-IF.                                                      05640000
182089                                                                  05650000
182090     IF PV-CEPLIT-STS NOT = 'A' AND 'B' AND 'C'                   05660000
182091         DISPLAY '** ERROR ON TCEPLIT ' CE026-PULL-NBR '/'        05670000
182092                                        CE026-PULL-LNE-NBR        05680000
182093         DISPLAY '** UNKNOWN STATUS = ' PV-CEPLIT-STS             05690000
182094     END-IF.                                                      05700000
182095                                                                  05710000
182096***************************************************************** 05720000
182097 1300-PROCESS-TCEPLDS.                                            05730000
182098***************************************************************** 05740000
182099     MOVE '1300-PROCESS-TCEPLDS         ' TO PV-ABEND-PARAGRAPH.  05750000
182100                                                                  05760000
182101     MOVE CE026-RECV-STORE-NBR TO PV-PREV-RECV-STORE-NBR.         05770000
182102     MOVE ' '                  TO PV-CEPLDS-STS.                  05780000
182103                                                                  05790000
182104     PERFORM 1310-READ-TCEPLDS.                                   05800000
182105                                                                  05810000
182106     IF PS-TCEPLDS-NOT-FOUND                                      05820000
182107         SET CE026-STR-NOT-ON-PULL TO TRUE                        05830000
182108         MOVE 'N' TO PV-CEPLDS-STS                                05840000
182109         WRITE OUTPUT-RECORD                                      05850000
182110          FROM CE026-CS-STR-MANIFEST-RECORD                       05860000
182111         ADD +1 TO PV-RECORDS-ERRED                               05870000
182112     END-IF.                                                      05880000
182113                                                                  05890000
182114***************************************************************** 05900000
182115 1310-READ-TCEPLDS.                                               05910000
182116***************************************************************** 05920000
182117     MOVE '1310-READ-TCEPLDS            ' TO PV-ABEND-PARAGRAPH.  05930000
182118                                                                  05940000
182119     INITIALIZE  PV-CEPLDS-DISTRB-QTY.                            05950000
182120                                                                  05960000
182121     EXEC SQL                                                     05970000
182122         SELECT  ACTL_DISTRB_QTY                                  05980000
182123           INTO :PV-CEPLDS-DISTRB-QTY :PV-NULL-IND-1              05990000
182124           FROM  TCEPLDS                                          06000000
182125          WHERE  CNSTK_REQ_PL_NBR = :DK-REQ-PL-NBR                06010000
182126            AND  PL_LNE_NBR       = :DK-PL-LNE-NBR                06020000
182127            AND  STR_NBR          = :DK-STR-NBR                   06030000
182128          WITH UR                                                 06040000
182129     END-EXEC.                                                    06050000
182130                                                                  06060000
182131     EVALUATE TRUE                                                06070000
182132       WHEN SQLCODE = +0                                          06080000
182133           SET PS-TCEPLDS-FOUND TO TRUE                           06090000
182134                                                                  06100000
182135       WHEN SQLCODE = +100                                        06110000
182136           SET PS-TCEPLDS-NOT-FOUND TO TRUE                       06120000
182137                                                                  06130000
182138       WHEN OTHER                                                 06140000
182139           MOVE 'TCEPLDS' TO PV-DB2-TABLE-NAME                    06150000
182140           MOVE 'SELECT STORE DISTRIBUTION'                       06160000
182141                          TO PV-DB2-OPERATION-MESSAGE-1           06170000
182142           PERFORM 9900-DB2-ABEND                                 06180000
182143     END-EVALUATE.                                                06190000
182144                                                                  06200000
182145***************************************************************** 06210000
182146 1320-WRITE-TCEPLDS-ERR.                                          06220000
182147***************************************************************** 06230000
182148     MOVE '1320-WRITE-TCEPLDS-ERR       ' TO PV-ABEND-PARAGRAPH.  06240000
182149                                                                  06250000
182150     IF PV-CEPLDS-STS = 'N'                                       06260000
182151         SET CE026-STR-NOT-ON-PULL TO TRUE                        06270000
182152         WRITE OUTPUT-RECORD                                      06280000
182153          FROM CE026-CS-STR-MANIFEST-RECORD                       06290000
182154         ADD +1 TO PV-RECORDS-ERRED                               06300000
182155     END-IF.                                                      06310000
182156                                                                  06320000
182157     IF PV-CEPLDS-STS NOT = 'N'                                   06330000
182158         DISPLAY '** ERROR ON TCEPLDS ' CE026-PULL-NBR '/'        06340000
182159                                        CE026-PULL-LNE-NBR        06350000
182160         DISPLAY '** UNKNOWN STATUS = ' PV-CEPLIT-STS             06360000
182161     END-IF.                                                      06370000
182162                                                                  06380000
182163***************************************************************** 06390000
182164 2000-READ-INPUT-FILE.                                            06400000
182165***************************************************************** 06410000
182166     MOVE '2000-READ-INPUT-FILE       ' TO PV-ABEND-PARAGRAPH.    06420000
182167                                                                  06430000
182168     READ INPUT-FILE                                              06440000
182169       INTO CE026-CS-STR-MANIFEST-RECORD                          06450000
182170         AT END                                                   06460000
182171           SET PS-END-OF-INPUT TO TRUE.                           06470000
182172                                                                  06480000
182173******************************************************************06490000
182174 3000-INSERT-TCEPLMF.                                             06500000
182175******************************************************************06510000
182176     MOVE '3000-INSERT-TCEPLMF        ' TO PV-ABEND-PARAGRAPH.    06520000
182177                                                                  06530000
182178     INITIALIZE DCLTCEPLMF.                                       06540000
182179                                                                  06550000
182180     MOVE CE026-PULL-NBR         TO CEPLMF-CNSTK-REQ-PL-NBR.      06560000
182181     MOVE CE026-PULL-LNE-NBR     TO CEPLMF-PL-LNE-NBR.            06570000
182182     MOVE CE026-RECV-STORE-NBR   TO CEPLMF-STR-NBR.               06580000
182183                                                                  06590000
182184     PERFORM 5000-GET-CURRENT-TIMESTAMP.                          06600000
182185                                                                  06610000
182186     MOVE CE026-MANIFEST-DATE-CC TO PV-OUT-CC.                    06620000
182187     MOVE CE026-MANIFEST-DATE-YY TO PV-OUT-YR.                    06630000
182188     MOVE CE026-MANIFEST-DATE-MM TO PV-OUT-MON.                   06640000
182189     MOVE CE026-MANIFEST-DATE-DD TO PV-OUT-DAY.                   06650000
182190     MOVE '-'                    TO PV-OUT-H1                     06660000
182191                                    PV-OUT-H2                     06670000
182192                                    PV-OUT-H3.                    06680000
182193*    MOVE PV-CURR-TIME-HH        TO PV-OUT-HR.                    06690000
182194*    MOVE PV-CURR-TIME-MM        TO PV-OUT-MIN.                   06700000
182195*    MOVE PV-CURR-TIME-SS        TO PV-OUT-SEC.                   06710000
182196*    MOVE 9999                   TO PV-CURR-TIME-L4.              06720000
182197*    MOVE PV-CURR-TIME-REST      TO PV-OUT-REST.                  06730000
182198     MOVE '.'                    TO PV-OUT-P1                     06740000
182199                                    PV-OUT-P2                     06750000
182200                                    PV-OUT-P3.                    06760000
182201     MOVE PV-OUTPUT-TMST         TO CEPLMF-MFST-TMST.             06770000
182202     MOVE CE026-MANIFEST-QTY     TO CEPLMF-MFST-UNT-QTY.          06780000
182203     MOVE CE026-BOL-NBR          TO CEPLMF-BOL-NBR.               06790000
182204**SET THE BATCH ID TO 9'S SO THAT WAREHOUSE TRANSFERS ARE NOT     06800000
182205**PICKED UP AND PROCESSED.                                        06810000
182206* CLT 11/15/2010 WR38972 START                                    06820000
182207*    IF CEPLRQ-SRC-TYP-CDE = 'XF'                                 06830000
182208*        MOVE  '999'             TO CEPLMF-EXPRT-PRC-BTCH-ID      06840000
182209*    ELSE                                                         06850000
182210*        MOVE SPACES             TO CEPLMF-EXPRT-PRC-BTCH-ID      06860000
182211*    END-IF.                                                      06870000
182212     MOVE SPACES             TO CEPLMF-EXPRT-PRC-BTCH-ID.         06880000
182213* CLT 11/15/2010 WR38972 END                                      06890000
182214                                                                  06900000
182215     EXEC SQL                                                     06910000
182216         INSERT                                                   06920000
182217         INTO  TCEPLMF                                            06930000
182218               (CNSTK_REQ_PL_NBR                                  06940000
182219               ,PL_LNE_NBR                                        06950000
182220               ,STR_NBR                                           06960000
182221               ,MFST_TMST                                         06970000
182222               ,MFST_UNT_QTY                                      06980000
182223               ,BOL_NBR                                           06990000
182224               ,EXPRT_PRC_BTCH_ID)                                07000000
182225        VALUES                                                    07010000
182226              (:CEPLMF-CNSTK-REQ-PL-NBR                           07020000
182227              ,:CEPLMF-PL-LNE-NBR                                 07030000
182228              ,:CEPLMF-STR-NBR                                    07040000
182229              ,:CEPLMF-MFST-TMST                                  07050000
182230              ,:CEPLMF-MFST-UNT-QTY                               07060000
182231              ,:CEPLMF-BOL-NBR                                    07070000
182232              ,:CEPLMF-EXPRT-PRC-BTCH-ID)                         07080000
182233     END-EXEC.                                                    07090000
182234                                                                  07100000
182235     EVALUATE TRUE                                                07110000
182236         WHEN SQLCODE = ZERO                                      07120000
182237             ADD +1 TO PV-RECORDS-INSERTED                        07130000
182238                                                                  07140000
182239         WHEN OTHER                                               07150000
182240           MOVE 'TCEPLMF' TO PV-DB2-TABLE-NAME                    07160000
182241           MOVE 'INSERT MANIFEST RECORD'                          07170000
182242                          TO PV-DB2-OPERATION-MESSAGE-1           07180000
182243           STRING 'PULL# / LINE / STORE = '                       07190000
182244                  CE026-PULL-NBR ' / '                            07200000
182245                  CE026-PULL-LNE-NBR ' / '                        07210000
182246                  CE026-RECV-STORE-NBR                            07220000
182247             DELIMITED BY SIZE                                    07230000
182248             INTO PV-DB2-OPERATION-MESSAGE-2                      07240000
182249           PERFORM 9900-DB2-ABEND                                 07250000
182250     END-EVALUATE.                                                07260000
182251                                                                  07270000
182252******************************************************************07280000
182253 3100-UPDATE-TCEPLDS.                                             07290000
182254******************************************************************07300000
182255     MOVE '3100-UPDATE-TCEPLDS        ' TO PV-ABEND-PARAGRAPH.    07310000
182256                                                                  07320000
182257     COMPUTE PV-CEPLDS-DISTRB-QTY = PV-CEPLDS-DISTRB-QTY          07330000
182258                                  + PV-ACCUM-MANIFEST-QTY.        07340000
182259                                                                  07350000
182260     MOVE PV-CEPLDS-DISTRB-QTY   TO CEPLDS-ACTL-DISTRB-QTY.       07360000
182261                                                                  07370000
182262     EXEC SQL                                                     07380000
182263         UPDATE TCEPLDS                                           07390000
182264            SET  ACTL_DISTRB_QTY  = :CEPLDS-ACTL-DISTRB-QTY       07400000
182265          WHERE  CNSTK_REQ_PL_NBR = :DK-REQ-PL-NBR                07410000
182266            AND  PL_LNE_NBR       = :DK-PL-LNE-NBR                07420000
182267            AND  STR_NBR          = :DK-STR-NBR                   07430000
182268     END-EXEC.                                                    07440000
182269                                                                  07450000
182270     EVALUATE TRUE                                                07460000
182271       WHEN SQLCODE = ZERO                                        07470000
182272           CONTINUE                                               07480000
182273                                                                  07490000
182274       WHEN OTHER                                                 07500000
182275           MOVE 'TCEPLDS' TO PV-DB2-TABLE-NAME                    07510000
182276           MOVE 'UPDATE DISTRIBUTION RECORD'                      07520000
182277                          TO PV-DB2-OPERATION-MESSAGE-1           07530000
182278           STRING 'PULL# / LINE / STORE = '                       07540000
182279                  CE026-PULL-NBR ' / '                            07550000
182280                  CE026-PULL-LNE-NBR ' / '                        07560000
182281                  CE026-RECV-STORE-NBR                            07570000
182282             DELIMITED BY SIZE                                    07580000
182283             INTO PV-DB2-OPERATION-MESSAGE-2                      07590000
182284           PERFORM 9900-DB2-ABEND                                 07600000
182285     END-EVALUATE.                                                07610000
182286                                                                  07620000
182287******************************************************************07630000
182288 4000-GET-CHECKPOINT-CNTL.                                        07640000
182289******************************************************************07650000
182290     MOVE '4000-GET-CHECKPOINT-CNTL   ' TO PV-ABEND-PARAGRAPH.    07660000
182291                                                                  07670000
182292     PERFORM WITH TEST AFTER                                      07680000
182293       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       07690000
182294         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  07700000
182295            OR SQLCODE = ZERO                                     07710000
182296                                                                  07720000
182297         EXEC SQL                                                 07730000
182298           SELECT  CKPT_STAT_CODE                                 07740000
182299             INTO :PV-CKPT-STAT-CODE                              07750000
182300             FROM  TCKRSTCNTL                                     07760000
182301            WHERE  PLAN_NAME = :PC-PROGRAM-NAME                   07770000
182302         END-EXEC                                                 07780000
182303                                                                  07790000
182304         EVALUATE TRUE                                            07800000
182305           WHEN SQLCODE = ZERO                                    07810000
182306           WHEN SQLCODE = -904                                    07820000
182307           WHEN SQLCODE = -913                                    07830000
182308               CONTINUE                                           07840000
182309                                                                  07850000
182310           WHEN SQLWARN0 NOT EQUAL SPACE                          07860000
182311           WHEN SQLCODE NOT EQUAL ZERO                            07870000
182312               DISPLAY '**************************************'   07880000
182313               DISPLAY '** ABEND                            **'   07890000
182314               DISPLAY '** PROGRAM = CEKUP001               **'   07900000
182315               DISPLAY '** PARAGRAPH = 4000-GET-CHECKPOINT- **'   07910000
182316               DISPLAY '**                  CNTL            **'   07920000
182317               DISPLAY '** SELECT FROM TCKRSTCNTL           **'   07930000
182318               DISPLAY '**CKPT-STAT-CODE ='                       07940000
182319               DISPLAY              TCKRSTCNTL-CKPT-STAT-CODE     07950000
182320               DISPLAY '**************************************'   07960000
182321               PERFORM 9900-DB2-ABEND                             07970000
182322         END-EVALUATE                                             07980000
182323     END-PERFORM.                                                 07990000
182324                                                                  08000000
182325     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         08010000
182326       AND SQLCODE NOT = ZERO                                     08020000
182327         DISPLAY '****************************************'       08030000
182328         DISPLAY '** MAX RETRIES EXCEEDED ON SELECT     **'       08040000
182329         DISPLAY '** FROM TCKRSTCNTL                    **'       08050000
182330         DISPLAY '** PARAGRAPH = 4000-GET-CHECKPOINT-CNTL*'       08060000
182331         DISPLAY '****************************************'       08070000
182332         PERFORM 9900-DB2-ABEND                                   08080000
182333     END-IF.                                                      08090000
182334                                                                  08100000
182335******************************************************************08110000
182336 4100-CHECKPOINT-RESTART.                                         08120000
182337******************************************************************08130000
182338     MOVE '4100-CHECKPOINT-RESTART    ' TO PV-ABEND-PARAGRAPH.    08140000
182339                                                                  08150000
182340     PERFORM 4110-GET-CHECKPOINT-INFO.                            08160000
182341     MOVE TCKRSTINF-WORK-STRG-DESC-TEXT TO CKPT-RESTART-INFO.     08170000
182342                                                                  08180000
182343     DISPLAY '***********************************************'.   08190000
182344     DISPLAY '** CEKUP001 CHECKPOINT RESTART               **'.   08200000
182345     DISPLAY '** INPUT RECORDS BYPASSED ON RESTART = '.           08210000
182346     MOVE CR-RECORDS-READ TO PV-DISPLAY-RECORD.                   08220000
182347     DISPLAY  PV-DISPLAY-RECORD.                                  08230000
182348     DISPLAY '***********************************************'.   08240000
182349                                                                  08250000
182350     PERFORM 2000-READ-INPUT-FILE                                 08260000
182351       CR-RECORDS-READ TIMES.                                     08270000
182352                                                                  08280000
182353     MOVE CR-TOTAL-COMMITS       TO PV-TOTAL-COMMITS.             08290000
182354     MOVE CR-RECORDS-READ        TO PV-RECORDS-READ.              08300000
182355     MOVE CR-RECORDS-INSERTED    TO PV-RECORDS-INSERTED.          08310000
182356     MOVE CR-RECORDS-ERRED       TO PV-RECORDS-ERRED.             08320000
182357     MOVE CR-PREV-PULL-NBR       TO PV-PREV-PULL-NBR.             08330000
182358     MOVE CR-PREV-PULL-LNE-NBR   TO PV-PREV-PULL-LNE-NBR.         08340000
182359     MOVE CR-PREV-RECV-STORE-NBR TO PV-PREV-RECV-STORE-NBR.       08350000
182360     MOVE CR-CEPLRQ-STS          TO PV-CEPLRQ-STS.                08360000
182361     MOVE CR-CEPLIT-STS          TO PV-CEPLIT-STS.                08370000
182362     MOVE CR-CEPLDS-STS          TO PV-CEPLDS-STS.                08380000
182363     MOVE CR-ACCUM-MANIFEST-QTY  TO PV-ACCUM-MANIFEST-QTY.        08390000
182364                                                                  08400000
182365     SET PS-COMMITS-TAKEN TO TRUE.                                08410000
182366     SET PS-NOT-FIRST-TIME-THRU TO TRUE.                          08420000
182367                                                                  08430000
182368******************************************************************08440000
182369 4110-GET-CHECKPOINT-INFO.                                        08450000
182370******************************************************************08460000
182371     MOVE '4110-GET-CHECKPOINT-INFO   ' TO PV-ABEND-PARAGRAPH.    08470000
182372                                                                  08480000
182373     PERFORM                                                      08490000
182374       WITH TEST AFTER                                            08500000
182375         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     08510000
182376           UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                08520000
182377              OR SQLCODE = ZERO                                   08530000
182378                                                                  08540000
182379         EXEC SQL                                                 08550000
182380           SELECT  WORK_STRG_DESC                                 08560000
182381             INTO :TCKRSTINF-WORK-STRG-DESC                       08570000
182382             FROM  TCKRSTINF                                      08580000
182383            WHERE  PLAN_NAME = :PC-PROGRAM-NAME                   08590000
182384         END-EXEC                                                 08600000
182385                                                                  08610000
182386         EVALUATE TRUE                                            08620000
182387           WHEN SQLCODE = ZERO                                    08630000
182388           WHEN SQLCODE = -904                                    08640000
182389           WHEN SQLCODE = -913                                    08650000
182390               CONTINUE                                           08660000
182391                                                                  08670000
182392           WHEN SQLWARN0 NOT EQUAL SPACE                          08680000
182393           WHEN SQLCODE NOT EQUAL ZERO                            08690000
182394               DISPLAY '**************************************'   08700000
182395               DISPLAY '** ABEND                            **'   08710000
182396               DISPLAY '** PROGRAM = CEKUP001               **'   08720000
182397               DISPLAY '** PARAGRAPH = 4110-GET-CHECKPOINT- **'   08730000
182398               DISPLAY '**                  INFO            **'   08740000
182399               DISPLAY '** SELECT FROM TCKRSTINF            **'   08750000
182400               DISPLAY '**************************************'   08760000
182401               PERFORM 9900-DB2-ABEND                             08770000
182402         END-EVALUATE                                             08780000
182403     END-PERFORM.                                                 08790000
182404                                                                  08800000
182405     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         08810000
182406       AND SQLCODE NOT = ZERO                                     08820000
182407         DISPLAY '****************************************'       08830000
182408         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO **'       08840000
182409         DISPLAY '** SELECT FROM TCKRSTINF              **'       08850000
182410         DISPLAY '** PARAGRAPH = 4110-GET-CHECKPOINT-INFO*'       08860000
182411         DISPLAY '****************************************'       08870000
182412         PERFORM 9900-DB2-ABEND                                   08880000
182413     END-IF.                                                      08890000
182414                                                                  08900000
182415******************************************************************08910000
182416 4200-COMMIT-CHECK.                                               08920000
182417******************************************************************08930000
182418     MOVE '4200-COMMIT-CHECK          ' TO PV-ABEND-PARAGRAPH.    08940000
182419                                                                  08950000
182420     EXEC SQL                                                     08960000
182421       SET :PV-TMST = CURRENT TIMESTAMP                           08970000
182422     END-EXEC.                                                    08980000
182423                                                                  08990000
182424     EVALUATE TRUE                                                09000000
182425       WHEN SQLWARN0 NOT EQUAL SPACE                              09010000
182426       WHEN SQLCODE NOT EQUAL ZERO                                09020000
182427           DISPLAY '**********************************'           09030000
182428           DISPLAY '** ABEND                        **'           09040000
182429           DISPLAY '** PROGRAM = CEKUP001          ***'           09050000
182430           DISPLAY '** PARAGRAPH = 4200-COMMIT-CHECK**'           09060000
182431           DISPLAY '**UNSUCCESSFUL SELECT TIMESTAMP **'           09070000
182432           DISPLAY '**********************************'           09080000
182433           PERFORM 9900-DB2-ABEND                                 09090000
182434     END-EVALUATE.                                                09100000
182435                                                                  09110000
182436     IF PV-TMST > PV-HOLD-TMST                                    09120000
182437         IF PS-COMMITS-TAKEN                                      09130000
182438            CONTINUE                                              09140000
182439         ELSE                                                     09150000
182440             MOVE PC-IN-PROCESS-CODE TO PV-CKPT-STAT-CODE         09160000
182441             PERFORM 4210-UPDATE-TCKRSTCNTL                       09170000
182442             SET PS-COMMITS-TAKEN TO TRUE                         09180000
182443         END-IF                                                   09190000
182444                                                                  09200000
182445         PERFORM 4220-UPDATE-TCKRSTINF                            09210000
182446         PERFORM 4230-COMMIT                                      09220000
182447         PERFORM 4600-SET-CHECKPOINT-TIME                         09230000
182448     END-IF.                                                      09240000
182449/                                                                 09250000
182450******************************************************************09260000
182451 4210-UPDATE-TCKRSTCNTL.                                          09270000
182452******************************************************************09280000
182453     MOVE '4210-UPATE-TCKRSTCNTL      ' TO PV-ABEND-PARAGRAPH.    09290000
182454                                                                  09300000
182455*UPDATE THE CHECKPOINT RESTART CONTROL TABLE.  THE STATUS CODE    09310000
182456*IS SET TO '9' (RUN IN PROGRESS) OR '0' (RUN COMPLETE).           09320000
182457                                                                  09330000
182458     PERFORM WITH TEST AFTER                                      09340000
182459       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       09350000
182460         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  09360000
182461            OR SQLCODE = ZERO                                     09370000
182462                                                                  09380000
182463         EXEC SQL                                                 09390000
182464             UPDATE TCKRSTCNTL                                    09400000
182465                SET CKPT_STAT_CODE = :PV-CKPT-STAT-CODE           09410000
182466              WHERE PLAN_NAME      = :PC-PROGRAM-NAME             09420000
182467         END-EXEC                                                 09430000
182468                                                                  09440000
182469         EVALUATE TRUE                                            09450000
182470           WHEN SQLCODE = ZERO                                    09460000
182471           WHEN SQLCODE = -904                                    09470000
182472           WHEN SQLCODE = -913                                    09480000
182473               CONTINUE                                           09490000
182474                                                                  09500000
182475           WHEN SQLWARN0 NOT EQUAL SPACE                          09510000
182476           WHEN SQLCODE NOT EQUAL ZERO                            09520000
182477               DISPLAY '**************************************'   09530000
182478               DISPLAY '** ABEND                            **'   09540000
182479               DISPLAY '** PROGRAM = CEKUP001               **'   09550000
182480               DISPLAY '** PARAGRAPH = 4210-UPDATE-TCKRSTCNTL*'   09560000
182481               DISPLAY '** UPDATE TCKRSTCNTL                **'   09570000
182482               DISPLAY '**' PV-CKPT-STAT-CODE                     09580000
182483               DISPLAY '**************************************'   09590000
182484               PERFORM 9900-DB2-ABEND                             09600000
182485         END-EVALUATE                                             09610000
182486     END-PERFORM.                                                 09620000
182487                                                                  09630000
182488     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         09640000
182489       AND SQLCODE NOT = ZERO                                     09650000
182490         DISPLAY '****************************************'       09660000
182491         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO **'       09670000
182492         DISPLAY '** UPDATE TO TCKRSTCNTL               **'       09680000
182493         DISPLAY '** PARAGRAPH = 4210-UPDATE-TCKRSTCNTL **'       09690000
182494         DISPLAY '**' PV-CKPT-STAT-CODE                           09700000
182495         DISPLAY '****************************************'       09710000
182496         PERFORM 9900-DB2-ABEND                                   09720000
182497     END-IF.                                                      09730000
182498                                                                  09740000
182499******************************************************************09750000
182500 4220-UPDATE-TCKRSTINF.                                           09760000
182501******************************************************************09770000
182502     MOVE '4220-UPATE-TCKRSTINF       ' TO PV-ABEND-PARAGRAPH.    09780000
182503                                                                  09790000
182504     MOVE PV-TOTAL-COMMITS       TO CR-TOTAL-COMMITS.             09800000
182505     MOVE PV-RECORDS-READ        TO CR-RECORDS-READ.              09810000
182506     MOVE PV-RECORDS-INSERTED    TO CR-RECORDS-INSERTED.          09820000
182507     MOVE PV-RECORDS-ERRED       TO CR-RECORDS-ERRED.             09830000
182508     MOVE PV-PREV-PULL-NBR       TO CR-PREV-PULL-NBR.             09840000
182509     MOVE PV-PREV-PULL-LNE-NBR   TO CR-PREV-PULL-LNE-NBR.         09850000
182510     MOVE PV-PREV-RECV-STORE-NBR TO CR-PREV-RECV-STORE-NBR.       09860000
182511     MOVE PV-CEPLRQ-STS          TO CR-CEPLRQ-STS.                09870000
182512     MOVE PV-CEPLIT-STS          TO CR-CEPLIT-STS.                09880000
182513     MOVE PV-CEPLDS-STS          TO CR-CEPLDS-STS.                09890000
182514     MOVE PV-ACCUM-MANIFEST-QTY  TO CR-ACCUM-MANIFEST-QTY.        09900000
182515                                                                  09910000
182516     MOVE CKPT-RESTART-INFO   TO TCKRSTINF-WORK-STRG-DESC-TEXT.   09920000
182517     MOVE 4022                TO TCKRSTINF-WORK-STRG-DESC-LEN.    09930000
182518                                                                  09940000
182519     PERFORM WITH TEST AFTER                                      09950000
182520       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       09960000
182521         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  09970000
182522            OR SQLCODE = ZERO                                     09980000
182523                                                                  09990000
182524         EXEC SQL                                                 10000000
182525             UPDATE TCKRSTINF                                     10010000
182526                SET  WORK_STRG_DESC = :TCKRSTINF-WORK-STRG-DESC   10020000
182527              WHERE  PLAN_NAME      = :PC-PROGRAM-NAME            10030000
182528         END-EXEC                                                 10040000
182529                                                                  10050000
182530         EVALUATE TRUE                                            10060000
182531           WHEN SQLCODE = ZERO                                    10070000
182532           WHEN SQLCODE = -904                                    10080000
182533           WHEN SQLCODE = -913                                    10090000
182534               CONTINUE                                           10100000
182535                                                                  10110000
182536           WHEN SQLWARN0 NOT EQUAL SPACE                          10120000
182537           WHEN SQLCODE NOT EQUAL ZERO                            10130000
182538               DISPLAY '**************************************'   10140000
182539               DISPLAY '** ABEND                            **'   10150000
182540               DISPLAY '** PROGRAM = CEKUP001               **'   10160000
182541               DISPLAY '** PARAGRAPH = 4220-UPDATE-TCKRSTINF**'   10170000
182542               DISPLAY '** UPDATE TCKRSTINF                 **'   10180000
182543               DISPLAY '**' TCKRSTINF-WORK-STRG-DESC              10190000
182544               DISPLAY '**************************************'   10200000
182545               PERFORM 9900-DB2-ABEND                             10210000
182546         END-EVALUATE                                             10220000
182547     END-PERFORM.                                                 10230000
182548                                                                  10240000
182549     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         10250000
182550       AND SQLCODE NOT = ZERO                                     10260000
182551         DISPLAY '****************************************'       10270000
182552         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO **'       10280000
182553         DISPLAY '** UPDATE TCKRSTINF                   **'       10290000
182554         DISPLAY '** PARAGRAPH = 4220-UPDATE-TCKRSTINF  **'       10300000
182555         DISPLAY '**' TCKRSTINF-WORK-STRG-DESC                    10310000
182556         DISPLAY '****************************************'       10320000
182557         PERFORM 9900-DB2-ABEND                                   10330000
182558     END-IF.                                                      10340000
182559                                                                  10350000
182560******************************************************************10360000
182561 4230-COMMIT.                                                     10370000
182562******************************************************************10380000
182563     MOVE '4230-COMMIT                ' TO PV-ABEND-PARAGRAPH.    10390000
182564                                                                  10400000
182565     EXEC SQL                                                     10410000
182566         COMMIT                                                   10420000
182567     END-EXEC.                                                    10430000
182568                                                                  10440000
182569     EVALUATE TRUE                                                10450000
182570       WHEN SQLCODE = ZERO                                        10460000
182571         ADD +1 TO PV-TOTAL-COMMITS                               10470000
182572         DISPLAY 'COMMIT TAKEN AT '                               10480000
182573            PV-TMST (6:2) '/' PV-TMST (9:2) '/' PV-TMST (3:2) '  '10490000
182574            PV-TMST (12:2) ':' PV-TMST (15:2) ':' PV-TMST (18:2)  10500000
182575                                                                  10510000
182576       WHEN SQLWARN0 NOT EQUAL SPACE                              10520000
182577       WHEN SQLCODE NOT EQUAL ZERO                                10530000
182578           DISPLAY '**********************************'           10540000
182579           DISPLAY '** ABEND                        **'           10550000
182580           DISPLAY '** PROGRAM = CEKUP001           **'           10560000
182581           DISPLAY '** PARAGRAPH = 4230-COMMIT      **'           10570000
182582           DISPLAY '**UNSUCCESSFUL COMMIT           **'           10580000
182583           DISPLAY '**********************************'           10590000
182584           PERFORM 9900-DB2-ABEND                                 10600000
182585     END-EVALUATE.                                                10610000
182586                                                                  10620000
182587 4600-SET-CHECKPOINT-TIME.                                        10630000
182588                                                                  10640000
182589* SET THE TIME FOR THE NEXT CHECKPOINT.                           10650000
182590                                                                  10660000
182591      EXEC SQL                                                    10670000
182592          SELECT (CURRENT TIMESTAMP + CKPT_FRQNCY_QTY SECONDS)    10680000
182593          INTO :PV-HOLD-TMST                                      10690000
182594          FROM TCKRSTCNTL                                         10700000
182595          WHERE PLAN_NAME = :PC-PROGRAM-NAME                      10710000
182596      END-EXEC.                                                   10720000
182600                                                                  10730000
182700     EVALUATE TRUE                                                10740000
182800         WHEN SQLWARN0 NOT EQUAL SPACE                            10750000
182900         WHEN SQLCODE NOT EQUAL ZERO                              10760000
182901           DISPLAY '*****************************************'    10770000
182902           DISPLAY '** ABEND                               **'    10780000
182903           DISPLAY '** PROGRAM = CEKUP001                  **'    10790000
182904           DISPLAY '** PARAGRAPH = 4600-SET-CHEKPOINT-TIME **'    10800000
182905           DISPLAY '**UNSUCCESSFUL SELECT                  **'    10810000
182906           DISPLAY '*****************************************'    10820000
182907           PERFORM 9900-DB2-ABEND                                 10830000
183500     END-EVALUATE.                                                10840000
183501******************************************************************10850000
183502 5000-GET-CURRENT-TIMESTAMP.                                      10860000
183503******************************************************************10870000
183504                                                                  10880000
183505     EXEC SQL                                                     10890000
183506         SELECT  CURRENT TIMESTAMP                                10900000
183507           INTO  :PV-SQL-OUTPUT-TMST                              10910000
183508           FROM  TCOCNTL                                          10920000
183509          WHERE  OPER_UNT_ID = 90                                 10930000
183510     END-EXEC.                                                    10940000
183511                                                                  10950000
183512     EVALUATE TRUE                                                10960000
183513       WHEN SQLCODE = ZERO                                        10970000
183514            MOVE PV-SQL-OUTPUT-TMST TO                            10980000
183515                 PV-OUTPUT-TMST                                   10990000
183516*           DISPLAY 'CURRENT TIMESTAMP IS '                       11000000
183517*                   PV-OUTPUT-TMST                                11010000
183518                                                                  11020000
183519       WHEN SQLWARN0 NOT EQUAL SPACE                              11030000
183520       WHEN SQLCODE NOT EQUAL ZERO                                11040000
183521           DISPLAY '**********************************'           11050000
183522           DISPLAY '** ABEND                        **'           11060000
183523           DISPLAY '** PROGRAM = CEKUP001           **'           11070000
183524           DISPLAY '** PARAGRAPH = 5000-GET-TMST    **'           11080000
183525           DISPLAY '** UNSUCCESSFUL SELECT          **'           11090000
183526           DISPLAY '**********************************'           11100000
183527           PERFORM 9900-DB2-ABEND                                 11110000
183528     END-EVALUATE.                                                11120000
183529                                                                  11130000
183530******************************************************************11140000
183531 9900-DB2-ABEND.                                                  11150000
183532******************************************************************11160000
183533     MOVE '9900-DB2-ABEND             ' TO PV-ABEND-PARAGRAPH.    11170000
183534                                                                  11180000
183535     MOVE SQLCODE TO PV-SQLCODE.                                  11190000
183536     DISPLAY '*** DB2 ERROR '.                                    11200000
183537     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       11210000
183538     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 11220000
183539     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               11230000
183540     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               11240000
183541     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       11250000
183542     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       11260000
183543     DISPLAY '*** TABLE 1   = ' PV-DB2-TABLE-NAME.                11270000
183544                                                                  11280000
183545     COPY DPPD004.                                                11290000
183546                                                                  11300000
183547     MOVE +4013 TO PV-ABEND-CODE.                                 11310000
183548     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         11320000
183549                                                                  11330000
183550******************************************************************11340000
183560******************************************************************11350000
