      ******************************************************************00010047
       IDENTIFICATION DIVISION.                                         00020047
      ******************************************************************00030047
                                                                        00040047
       PROGRAM-ID.             TFKRP473.                                00050047
       AUTHOR.                 WILLIAM B. BURT.                         00060047
       INSTALLATION.           KOHLS.                                   00070047
       DATE-WRITTEN            JUNE, 1997.                              00080047
       DATE-COMPILED.                                                   00090047
                                                                        00100047
      ******************************************************************00110047
      *      THIS PROGRAM PRODUCES THE TRANSFER DISCREPANCY REPORT      00120047
      *  FOR A USER SPECIFIED TIME PERIOD.                              00130047
      ******************************************************************00140047
100404** 10/04/2004 CHANGED BY: RAY GRAF                                00142048
100404**     EXPAND STORE NUMBER. MAKE DOMAIN COMPLIANT.                00143048
      ***************************************************************** 00144048
031405** 03/14/2005 CHANGED BY: RAY GRAF                                00145056
031405**     MAKE SEPARATE CALL TO XST_LOC_DIST TABLE SINCE RTV'S DO    00146056
031405**     NOT RESIDE IN THAT TABLE.                                  00146156
      ***************************************************************** 00147056
                                                                        00150047
      ******************************************************************00160047
       ENVIRONMENT DIVISION.                                            00170047
      ******************************************************************00180047
                                                                        00190047
       CONFIGURATION SECTION.                                           00200047
                                                                        00210047
       SOURCE-COMPUTER.        IBM-3090.                                00220047
       OBJECT-COMPUTER.        IBM-3090.                                00230047
                                                                        00240047
       INPUT-OUTPUT SECTION.                                            00250047
                                                                        00260047
       FILE-CONTROL.                                                    00270047
                                                                        00280047
           SELECT PROCESS-DATES-FILE                                    00290047
               ASSIGN TO INP01.                                         00300047
                                                                        00310047
           SELECT XFER-DISCREPANCY-RPT-FILE                             00320047
               ASSIGN TO INP02.                                         00330047
                                                                        00340047
           SELECT STR-TOT-DISCREPANCY-FILE                              00341047
               ASSIGN TO OUT01.                                         00342047
                                                                        00343047
           SELECT XFER-DISCREPANCY-REPORT                               00350047
               ASSIGN TO RPT01.                                         00360047
                                                                        00370047
      ******************************************************************00380047
       DATA DIVISION.                                                   00390047
      ******************************************************************00400047
                                                                        00410047
       FILE SECTION.                                                    00420047
                                                                        00430047
       FD  PROCESS-DATES-FILE                                           00440047
           RECORDING MODE IS F                                          00450047
           LABEL RECORDS ARE STANDARD                                   00460047
           BLOCK CONTAINS 0 RECORDS.                                    00470047
                                                                        00480047
       01  PROCESS-DATES-RECORD                PIC  X(16).              00490047
                                                                        00500047
       FD  XFER-DISCREPANCY-RPT-FILE                                    00510047
           RECORDING MODE IS F                                          00520047
           LABEL RECORDS ARE STANDARD                                   00530047
           BLOCK CONTAINS 0 RECORDS.                                    00540047
                                                                        00550047
       01  XFER-DISCREPANCY-RPT-RECORD         PIC  X(43).              00560052
                                                                        00570047
       FD  STR-TOT-DISCREPANCY-FILE                                     00571047
           RECORDING MODE IS F                                          00572047
           LABEL RECORDS ARE STANDARD                                   00573047
           BLOCK CONTAINS 0 RECORDS.                                    00574047
                                                                        00575047
       01  STR-TOT-DISCREPANCY-RECORD          PIC  X(39).              00576058
                                                                        00577047
       FD  XFER-DISCREPANCY-REPORT                                      00580047
           RECORDING MODE IS F                                          00590047
           LABEL RECORDS ARE STANDARD                                   00600047
           BLOCK CONTAINS 0 RECORDS.                                    00610047
                                                                        00620047
       01  XFER-DISCREPANCY-LINE               PIC X(132).              00630047
                                                                        00640047
      ******************************************************************00650047
       WORKING-STORAGE SECTION.                                         00660047
      ******************************************************************00670047
                                                                        00680047
      *                                                                 00690047
      *  STANDARD REPORT HEADER FOR 132 COLUMN REPORT                   00700047
      *                                                                 00710047
           COPY DPWS132O.                                               00720047
                                                                        00730047
      *                                                                 00740047
      *  RECORD LAYOUT FOR THE PROCESS DATES FILE                       00750047
      *                                                                 00760047
           COPY TFRD029.                                                00770047
                                                                        00780047
      *                                                                 00790047
      *  RECORD LAYOUT FOR THE TRANSFER DISCREPANCY REPORT FILE         00800047
      *                                                                 00810047
           COPY TFRD038.                                                00820047
                                                                        00830047
      *                                                                 00831047
      *  RECORD LAYOUT FOR THE STORE TOTAL DISCREPANCY FILE             00832047
      *                                                                 00833047
           COPY TFRD037.                                                00834047
                                                                        00835047
      *---------------------------------------------------------------* 00836049
100404*    DB2 AREA FOR XST_LOC TABLE                                 * 00837049
      *---------------------------------------------------------------* 00838049
           EXEC SQL                                                     00839049
100404          INCLUDE XST00001                                        00839149
           END-EXEC.                                                    00839249
      *---------------------------------------------------------------* 00839349
100404*    DB2 AREA FOR XST_LOC_DIST TABLE                            * 00839449
      *---------------------------------------------------------------* 00839549
           EXEC SQL                                                     00839649
100404          INCLUDE XST00002                                        00839749
           END-EXEC.                                                    00839849
                                                                        00900047
      *                                                                 00910047
      *  COMMUNICATIONS AREA FOR DB2                                    00920047
      *                                                                 00930047
           EXEC SQL                                                     00940047
               INCLUDE SQLCA                                            00950047
           END-EXEC.                                                    00960047
                                                                        00970047
      *                                                                 00980047
      *  DB2 FORMATTED ERROR MESSAGE                                    00990047
      *                                                                 01000047
           COPY DPWS004.                                                01010047
                                                                        01020047
       01  ABEND-CODE                          PIC S9(04)  VALUE +0     01030047
                                                           COMP SYNC.   01040047
                                                                        01050047
       01  CD-CURRENT-DATE.                                             01060047
           05  CD-CURRENT-YEAR                 PIC  9(02)  VALUE ZEROS. 01070047
           05  CD-CURRENT-MONTH                PIC  9(02)  VALUE ZEROS. 01080047
           05  CD-CURRENT-DAY                  PIC  9(02)  VALUE ZEROS. 01090047
                                                                        01100047
       01  CT-CURRENT-TIME.                                             01110047
           05  CT-CURRENT-HOUR                 PIC  9(02)  VALUE ZEROS. 01120047
           05  CT-CURRENT-MINUTE               PIC  9(02)  VALUE ZEROS. 01130047
           05  FILLER                          PIC  9(04)  VALUE ZEROS. 01140047
                                                                        01150047
       01  CK-CURRENT-KEY-AREA.                                         01160047
100404*    05  CK-FROM-STR-NBR                 PIC  9(03)  VALUE ZEROS. 01170049
100404     05  CK-FROM-STR-NBR                 PIC  9(05)  VALUE ZEROS. 01171049
                                                                        01180047
       01  DA-DETAIL-ACCUMULATORS.                                      01190047
           05  DA-XFERS                        PIC  9(06)  VALUE ZEROS. 01200047
           05  DA-ADJ-UNITS                    PIC  9(08)  VALUE ZEROS. 01210047
           05  DA-ADJ-RTL                      PIC S9(09)V99            01220047
                                                           VALUE ZEROS  01230047
                                                           COMP-3.      01240047
                                                                        01250047
       01  DL-DETAIL-LINE.                                              01260047
           05  FILLER                          PIC  X(04)  VALUE SPACE. 01270047
           05  DL-XFER-NBR.                                             01280047
100404*        10  DL-FROM-STR-NBR             PIC  X(03)  VALUE SPACE. 01290049
100404         10  DL-FROM-STR-NBR             PIC  9(04)  VALUE ZEROS. 01291054
               10  DL-DASH-ONE                 PIC  X(01)  VALUE SPACE. 01300047
               10  DL-XFER-SEQ-NBR             PIC  X(06)  VALUE SPACE. 01310047
           05  FILLER                          PIC  X(04)  VALUE SPACE. 01320047
           05  DL-COMPLETED-DATE.                                       01330047
               10  DL-COMPLETED-MONTH          PIC  X(02)  VALUE SPACE. 01340047
               10  DL-SLASH-ONE                PIC  X(01)  VALUE SPACE. 01350047
               10  DL-COMPLETED-DAY            PIC  X(02)  VALUE SPACE. 01360047
               10  DL-SLASH-TWO                PIC  X(01)  VALUE SPACE. 01370047
               10  DL-COMPLETED-CENTURY        PIC  X(02)  VALUE SPACE. 01380047
               10  DL-COMPLETED-YEAR           PIC  X(02)  VALUE SPACE. 01390047
           05  FILLER                          PIC  X(03)  VALUE SPACE. 01400047
           05  DL-RECEIVED-DATE.                                        01410047
               10  DL-RECEIVED-MONTH           PIC  X(02)  VALUE SPACE. 01420047
               10  DL-SLASH-THREE              PIC  X(01)  VALUE SPACE. 01430047
               10  DL-RECEIVED-DAY             PIC  X(02)  VALUE SPACE. 01440047
               10  DL-SLASH-FOUR               PIC  X(01)  VALUE SPACE. 01450047
               10  DL-RECEIVED-CENTURY         PIC  X(02)  VALUE SPACE. 01460047
               10  DL-RECEIVED-YEAR            PIC  X(02)  VALUE SPACE. 01470047
           05  FILLER                          PIC  X(02)  VALUE SPACE. 01480047
           05  DL-ADJ-UNITS                    PIC  ZZZ,ZZ9             01490047
                                                           VALUE ZEROS. 01500047
           05  FILLER                          PIC  X(06)  VALUE SPACE. 01510047
           05  DL-ADJ-RTL                      PIC  ZZ,ZZZ,ZZ9.99-      01520047
                                                           VALUE ZEROS. 01530047
           05  FILLER                          PIC  X(62)  VALUE SPACE. 01540047
                                                                        01550047
       01  DK-DB2-KEYS.                                                 01560047
100404*    10  DK-STR-NBR                      PIC  X(03)  VALUE SPACE. 01570049
100404     10  DK-STR-NBR                      PIC S9(04)  VALUE ZEROS  01571049
                                                           COMP-3.      01580049
                                                                        01581049
       01  NO-DATA-LINE.                                                01590047
           05  FILLER                          PIC  X(52)  VALUE SPACE. 01600047
           05  FILLER                          PIC  X(28)  VALUE        01610047
               'NO DATA FOR REQUESTED PERIOD'.                          01620047
           05  FILLER                          PIC  X(52)  VALUE SPACE. 01630047
                                                                        01640047
       01  END-OF-REPORT-LINE.                                          01650047
           05  FILLER                          PIC  X(54)  VALUE SPACE. 01660047
           05  FILLER                          PIC  X(25)  VALUE        01670047
               '***** END OF REPORT *****'.                             01680047
           05  FILLER                          PIC  X(53)  VALUE SPACE. 01690047
                                                                        01700047
       01  FT-FINAL-TOTAL.                                              01710047
           05  FILLER                          PIC  X(03)  VALUE SPACE. 01720047
           05  FILLER                          PIC  X(14)  VALUE        01730047
               'COMPANY TOTALS'.                                        01740047
           05  FILLER                          PIC  X(01)  VALUE SPACE. 01750047
           05  FILLER                          PIC  X(09)  VALUE        01760047
               'TRANSFERS'.                                             01770047
           05  FILLER                          PIC  X(01)  VALUE SPACE. 01780047
           05  FT-XFERS                        PIC  ZZ,ZZZ,ZZ9          01790047
                                                           VALUE ZEROS. 01800047
100404     05  FILLER                          PIC  X(02)  VALUE SPACE. 01810055
           05  FT-ADJ-UNITS                    PIC  ZZZ,ZZZ,ZZ9         01820047
                                                           VALUE ZEROS. 01830047
           05  FILLER                          PIC  X(02)  VALUE SPACE. 01840047
           05  FT-ADJ-RTL                      PIC  ZZ,ZZZ,ZZZ,ZZ9.99-  01850047
                                                           VALUE ZEROS. 01860047
           05  FILLER                          PIC  X(62)  VALUE SPACE. 01870047
                                                                        01880047
       01  HL1-HEADING-LINE-1.                                          01890047
           05  FILLER                          PIC  X(53)  VALUE SPACE. 01900047
           05  FILLER                          PIC  X(27)  VALUE        01910047
               'TRANSFER DISCREPANCY REPORT'.                           01920047
           05  FILLER                          PIC  X(52)  VALUE SPACE. 01930047
                                                                        01940047
       01  HL2-HEADING-LINE-2.                                          01950047
           05  FILLER                          PIC  X(49)  VALUE SPACE. 01960047
           05  FILLER                          PIC  X(10)  VALUE        01970047
               'FOR PERIOD'.                                            01980047
           05  FILLER                          PIC  X(01)  VALUE SPACE. 01990047
           05  HL2-PERIOD-START-DTE.                                    02000047
               10  HL2-PERIOD-START-MONTH      PIC  9(02)  VALUE ZEROS. 02010047
               10  FILLER                      PIC  X(01)  VALUE '/'.   02020047
               10  HL2-PERIOD-START-DAY        PIC  9(02)  VALUE ZEROS. 02030047
               10  FILLER                      PIC  X(01)  VALUE '/'.   02040047
               10  HL2-PERIOD-START-CENTURY    PIC  9(02)  VALUE ZEROS. 02050047
               10  HL2-PERIOD-START-YEAR       PIC  9(02)  VALUE ZEROS. 02060047
           05  FILLER                          PIC  X(01)  VALUE SPACE. 02070047
           05  FILLER                          PIC  X(02)  VALUE        02080047
               'TO'.                                                    02090047
           05  FILLER                          PIC  X(01)  VALUE SPACE. 02100047
           05  HL2-PERIOD-END-DTE.                                      02110047
               10  HL2-PERIOD-END-MONTH        PIC  9(02)  VALUE ZEROS. 02120047
               10  FILLER                      PIC  X(01)  VALUE '/'.   02130047
               10  HL2-PERIOD-END-DAY          PIC  9(02)  VALUE ZEROS. 02140047
               10  FILLER                      PIC  X(01)  VALUE '/'.   02150047
               10  HL2-PERIOD-END-CENTURY      PIC  9(02)  VALUE ZEROS. 02160047
               10  HL2-PERIOD-END-YEAR         PIC  9(02)  VALUE ZEROS. 02170047
           05  FILLER                          PIC  X(48)  VALUE SPACE. 02180047
                                                                        02190047
       01  HL3-HEADING-LINE-3.                                          02200047
           05  FILLER                          PIC  X(03)  VALUE SPACE. 02210047
           05  FILLER                          PIC  X(05)  VALUE        02220047
               'STORE'.                                                 02230047
           05  FILLER                          PIC  X(01)  VALUE SPACE. 02240047
           05  HL3-FROM-STR-NBR-X              PIC  X(04)  VALUE SPACE. 02250047
           05  HL3-FROM-STR-NBR  REDEFINES  HL3-FROM-STR-NBR-X          02260047
                                               PIC  9999.               02270059
           05  FILLER                          PIC  X(01)  VALUE SPACE. 02280047
           05  HL3-STR-DESC                    PIC  X(10)  VALUE SPACE. 02290047
           05  FILLER                          PIC X(108)  VALUE SPACE. 02300047
                                                                        02310047
       01  HL4-HEADING-LINE-4.                                          02320047
           05  FILLER                          PIC  X(18)  VALUE SPACE. 02330047
           05  FILLER                          PIC  X(09)  VALUE        02340047
               'COMPLETED'.                                             02350047
           05  FILLER                          PIC  X(05)  VALUE SPACE. 02360047
           05  FILLER                          PIC  X(08)  VALUE        02370047
               'RECEIVED'.                                              02380047
           05  FILLER                          PIC  X(03)  VALUE SPACE. 02390047
           05  FILLER                          PIC  X(08)  VALUE        02400047
               'ADJUSTED'.                                              02410047
           05  FILLER                          PIC  X(08)  VALUE SPACE. 02420047
           05  FILLER                          PIC  X(08)  VALUE        02430047
               'ADJUSTED'.                                              02440047
           05  FILLER                          PIC  X(65)  VALUE SPACE. 02450047
                                                                        02460047
       01  HL5-HEADING-LINE-5.                                          02470047
           05  FILLER                          PIC  X(03)  VALUE SPACE. 02480047
           05  FILLER                          PIC  X(12)  VALUE        02490047
               'TRANSFER NBR'.                                          02500047
           05  FILLER                          PIC  X(05)  VALUE SPACE. 02510047
           05  FILLER                          PIC  X(04)  VALUE        02520047
               'DATE'.                                                  02530047
           05  FILLER                          PIC  X(10)  VALUE SPACE. 02540047
           05  FILLER                          PIC  X(04)  VALUE        02550047
               'DATE'.                                                  02560047
           05  FILLER                          PIC  X(06)  VALUE SPACE. 02570047
           05  FILLER                          PIC  X(05)  VALUE        02580047
               'UNITS'.                                                 02590047
           05  FILLER                          PIC  X(11)  VALUE SPACE. 02600047
           05  FILLER                          PIC  X(06)  VALUE        02610047
               'RETAIL'.                                                02620047
           05  FILLER                          PIC  X(66)  VALUE SPACE. 02630047
                                                                        02640047
       01  ST-STORE-TOTAL.                                              02650047
           05  FILLER                          PIC  X(03)  VALUE SPACE. 02660047
           05  FILLER                          PIC  X(12)  VALUE        02670047
               'STORE TOTALS'.                                          02680047
           05  FILLER                          PIC  X(03)  VALUE SPACE. 02690047
           05  FILLER                          PIC  X(09)  VALUE        02700047
               'TRANSFERS'.                                             02710047
           05  FILLER                          PIC  X(04)  VALUE SPACE. 02720047
           05  ST-XFERS                        PIC  ZZZ,ZZ9             02730047
                                                           VALUE ZEROS. 02740047
100404     05  FILLER                          PIC  X(03)  VALUE SPACE. 02750055
           05  ST-ADJ-UNITS                    PIC  ZZ,ZZZ,ZZ9          02760047
                                                           VALUE ZEROS. 02770047
           05  FILLER                          PIC  X(05)  VALUE SPACE. 02780047
           05  ST-ADJ-RTL                      PIC  ZZZ,ZZZ,ZZ9.99-     02790047
                                                           VALUE ZEROS. 02800047
           05  FILLER                          PIC  X(63)  VALUE SPACE. 02810047
                                                                        02820047
       01  PC-PROGRAM-CONSTANTS.                                        02830047
           05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        02840047
               'TFKRP473'.                                              02850047
           05  PC-DASH                         PIC  X(01)  VALUE '-'.   02860047
           05  PC-SLASH                        PIC  X(01)  VALUE '/'.   02870047
           05  PC-ONE                          PIC  9(01)  VALUE 1.     02880047
           05  PC-PAGE-SIZE                    PIC S9(04)  VALUE +60    02890047
                                                           COMP SYNC.   02900047
           05  PC-PAGE-BREAK                   PIC S9(04)  VALUE +64    02910047
                                                           COMP SYNC.   02920047
           05  PC-LINES-NEEDED-FOR-TOTALS      PIC S9(04)  VALUE +3     02930047
                                                           COMP SYNC.   02940047
                                                                        02950047
       01  PS-PROGRAM-SWITCHES.                                         02960047
           05  PS-END-OF-DSCRP-RPT-FILE-IND    PIC  X(01)  VALUE 'N'.   02970047
               88  PS-END-OF-DSCRP-RPT-FILE                VALUE 'Y'.   02980047
                                                                        02990047
       01  PV-PROGRAM-VARIABLES.                                        03000047
           05  PV-DISPLAY-AREA.                                         03010047
100404*        10  PV-DISPLAY-STR-NBR          PIC  X(03)  VALUE SPACE. 03020049
100404         10  PV-DISPLAY-STR-NBR          PIC  X(04)  VALUE SPACE. 03021049
           05  PV-PARAGRAPH-NAME               PIC  X(30)  VALUE SPACE. 03030047
           05  PV-DB2-OPERATION-ATTEMPTED      PIC  X(30)  VALUE SPACE. 03040047
           05  PV-PAGE-COUNT                   PIC S9(04)  VALUE +0     03050047
                                                           COMP.        03060047
           05  PV-LINE-COUNT                   PIC S9(04)  VALUE +0     03070047
                                                           COMP.        03080047
           05  PV-ADVANCE-COUNT                PIC S9(04)  VALUE +0     03090047
                                                           COMP.        03100047
                                                                        03110047
       01  TA-TOTAL-ACCUMULATORS.                                       03120047
           05  TA-XFERS                        PIC  9(08)  VALUE ZEROS. 03130047
           05  TA-ADJ-UNITS                    PIC  9(09)  VALUE ZEROS. 03140047
           05  TA-ADJ-RTL                      PIC S9(11)V99            03150047
                                                           VALUE ZEROS  03160047
                                                           COMP-3.      03170047
                                                                        03180047
      ******************************************************************03190047
       PROCEDURE DIVISION.                                              03200047
      ******************************************************************03210047
                                                                        03220047
      ******************************************************************03230047
      *  0000-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM    03240047
      ******************************************************************03250047
       0000-PROGRAM-MAINLINE.                                           03260047
           PERFORM 1000-INITIALIZE.                                     03270047
                                                                        03280047
           PERFORM 2000-CREATE-XFER-DISCRP-RPT                          03290047
               UNTIL  PS-END-OF-DSCRP-RPT-FILE.                         03300047
                                                                        03310047
           PERFORM 9000-EOJ-ROUTINE.                                    03320047
                                                                        03330047
           STOP RUN.                                                    03340047
      *                                                                 03350047
       1000-INITIALIZE.                                                 03360047
           ACCEPT CD-CURRENT-DATE       FROM  DATE.                     03370047
           MOVE CD-CURRENT-YEAR             TO  DP132O-RUN-YEAR.        03380047
           MOVE CD-CURRENT-MONTH            TO  DP132O-RUN-MONTH.       03390047
           MOVE CD-CURRENT-DAY              TO  DP132O-RUN-DAY.         03400047
                                                                        03410047
           ACCEPT CT-CURRENT-TIME       FROM  TIME.                     03420047
           MOVE CT-CURRENT-HOUR             TO  DP132O-RUN-HOUR.        03430047
           MOVE CT-CURRENT-MINUTE           TO  DP132O-RUN-MINUTE.      03440047
                                                                        03450047
           MOVE PC-CURRENT-PROGRAM-NAME     TO  DP132O-PROGRAM-NAME.    03460047
           MOVE PC-ONE                      TO  DP132O-REPORT-NUMBER.   03470047
                                                                        03480047
           OPEN  INPUT PROCESS-DATES-FILE                               03490047
                       XFER-DISCREPANCY-RPT-FILE                        03500047
                OUTPUT STR-TOT-DISCREPANCY-FILE                         03510047
                       XFER-DISCREPANCY-REPORT.                         03511047
                                                                        03520047
           PERFORM 7000-READ-PROCESS-DATES-FILE.                        03530047
                                                                        03540047
           MOVE TF029-PROCESS-START-MONTH   TO HL2-PERIOD-START-MONTH.  03550047
           MOVE TF029-PROCESS-START-DAY     TO HL2-PERIOD-START-DAY.    03560047
           MOVE TF029-PROCESS-START-CENTURY TO HL2-PERIOD-START-CENTURY.03570047
           MOVE TF029-PROCESS-START-YEAR    TO HL2-PERIOD-START-YEAR.   03580047
           MOVE TF029-PROCESS-END-MONTH     TO HL2-PERIOD-END-MONTH.    03590047
           MOVE TF029-PROCESS-END-DAY       TO HL2-PERIOD-END-DAY.      03600047
           MOVE TF029-PROCESS-END-CENTURY   TO HL2-PERIOD-END-CENTURY.  03610047
           MOVE TF029-PROCESS-END-YEAR      TO HL2-PERIOD-END-YEAR.     03620047
                                                                        03630047
           PERFORM 7100-READ-XFER-DSCRP-FILE.                           03640047
                                                                        03650047
           IF PS-END-OF-DSCRP-RPT-FILE                                  03660047
               MOVE SPACES  TO  HL3-HEADING-LINE-3                      03670047
                                HL4-HEADING-LINE-4                      03680047
                                HL5-HEADING-LINE-5                      03690047
                                                                        03700047
               PERFORM 8500-WRITE-HEADING-LINES                         03710047
                                                                        03720047
               WRITE XFER-DISCREPANCY-LINE                              03730047
                   FROM NO-DATA-LINE                                    03740047
                   AFTER ADVANCING PV-ADVANCE-COUNT LINES               03750047
                                                                        03760047
               MOVE 3 TO PV-ADVANCE-COUNT                               03770047
               PERFORM 8400-WRITE-END-OF-REPORT-LINE                    03780047
           ELSE                                                         03790047
               INITIALIZE DA-DETAIL-ACCUMULATORS                        03800047
                          TA-TOTAL-ACCUMULATORS                         03810047
                                                                        03820047
               MOVE PC-DASH                     TO DL-DASH-ONE          03830047
               MOVE PC-SLASH                    TO DL-SLASH-ONE         03840047
                                                   DL-SLASH-TWO         03850047
                                                   DL-SLASH-THREE       03860047
                                                   DL-SLASH-FOUR        03870047
           END-IF.                                                      03880047
      *                                                                 03890047
       2000-CREATE-XFER-DISCRP-RPT.                                     03900047
           MOVE TF038-FROM-STR-NBR          TO  HL3-FROM-STR-NBR        03910047
                                                CK-FROM-STR-NBR         03920047
                                                DK-STR-NBR              03930047
                                                TF037-STORE-NBR.        03931047
                                                                        03940047
           PERFORM 6000-SELECT-10-CHAR-STR-NAME.                        03950047
100404     MOVE XST00001-LOC-10-ABBR-NM     TO  HL3-STR-DESC            03960049
                                                TF037-STORE-NAME.       03960147
100404     MOVE XST00002-DIST-NBR           TO  TF037-DISTRICT-NBR.     03960249
                                                                        03970047
           PERFORM 8500-WRITE-HEADING-LINES.                            03980047
                                                                        03990047
           PERFORM 2100-PROCESS-STR                                     04000047
               UNTIL ((PS-END-OF-DSCRP-RPT-FILE)                        04010047
                  OR  (TF038-FROM-STR-NBR  NOT =  CK-FROM-STR-NBR)).    04020047
                                                                        04030047
           PERFORM 3000-CONTROL-BREAK.                                  04040047
                                                                        04050047
           IF PS-END-OF-DSCRP-RPT-FILE                                  04060047
               INITIALIZE HL3-HEADING-LINE-3                            04070047
               PERFORM 8500-WRITE-HEADING-LINES                         04080047
               MOVE TA-XFERS      TO  FT-XFERS                          04090047
               MOVE TA-ADJ-UNITS  TO  FT-ADJ-UNITS                      04100047
               MOVE TA-ADJ-RTL    TO  FT-ADJ-RTL                        04110047
               PERFORM 8300-WRITE-FINAL-TOTAL-LINE                      04120047
               MOVE 3 TO PV-ADVANCE-COUNT                               04130047
               PERFORM 8400-WRITE-END-OF-REPORT-LINE                    04140047
           END-IF.                                                      04150047
      *                                                                 04160047
       2100-PROCESS-STR.                                                04170047
           MOVE TF038-FROM-STR-NBR       TO  DL-FROM-STR-NBR.           04180047
           MOVE TF038-XFER-SEQ-NBR       TO  DL-XFER-SEQ-NBR.           04190047
           MOVE TF038-COMPLETED-MONTH    TO  DL-COMPLETED-MONTH.        04200047
           MOVE TF038-COMPLETED-DAY      TO  DL-COMPLETED-DAY.          04210047
           MOVE TF038-COMPLETED-CENTURY  TO  DL-COMPLETED-CENTURY.      04220047
           MOVE TF038-COMPLETED-YEAR     TO  DL-COMPLETED-YEAR.         04230047
           MOVE TF038-RECEIVED-MONTH     TO  DL-RECEIVED-MONTH.         04240047
           MOVE TF038-RECEIVED-DAY       TO  DL-RECEIVED-DAY.           04250047
           MOVE TF038-RECEIVED-CENTURY   TO  DL-RECEIVED-CENTURY.       04260047
           MOVE TF038-RECEIVED-YEAR      TO  DL-RECEIVED-YEAR.          04270047
           MOVE TF038-ADJ-UNITS          TO  DL-ADJ-UNITS.              04280047
           MOVE TF038-ADJ-RTL            TO  DL-ADJ-RTL.                04290047
                                                                        04300047
           PERFORM 8100-WRITE-DETAIL-LINE.                              04310047
                                                                        04320047
           COMPUTE DA-XFERS  =                                          04330047
               (DA-XFERS  +  1).                                        04340047
                                                                        04350047
           COMPUTE DA-ADJ-UNITS  =                                      04360047
               (DA-ADJ-UNITS  +  TF038-ADJ-UNITS).                      04370047
                                                                        04380047
           COMPUTE DA-ADJ-RTL  =                                        04390047
               (DA-ADJ-RTL  +  TF038-ADJ-RTL).                          04400047
                                                                        04410047
           PERFORM 7100-READ-XFER-DSCRP-FILE.                           04420047
      *                                                                 04430047
      ******************************************************************04440047
      * CONTROL BREAK ON CHANGE IN STORE NUMBER.                        04450047
      ******************************************************************04460047
       3000-CONTROL-BREAK.                                              04470047
           PERFORM 8000-LINES-NEEDED-FOR-TOTALS.                        04480047
                                                                        04490047
           COMPUTE TA-XFERS  =                                          04500047
               (TA-XFERS  +  DA-XFERS).                                 04510047
                                                                        04520047
           COMPUTE TA-ADJ-UNITS  =                                      04530047
               (TA-ADJ-UNITS  +  DA-ADJ-UNITS).                         04540047
                                                                        04550047
           COMPUTE TA-ADJ-RTL  =                                        04560047
               (TA-ADJ-RTL  +  DA-ADJ-RTL).                             04570047
                                                                        04580047
           MOVE DA-XFERS      TO  ST-XFERS                              04590047
                                  TF037-XFERS-WITH-DSCRPS.              04591047
           MOVE DA-ADJ-UNITS  TO  ST-ADJ-UNITS                          04600047
                                  TF037-ADJ-UNITS.                      04600147
           MOVE DA-ADJ-RTL    TO  ST-ADJ-RTL                            04610047
                                  TF037-ADJ-RTL.                        04611047
           PERFORM 8200-WRITE-STR-TOTAL-LINE.                           04620047
           PERFORM 8600-WRITE-STR-TOT-DSCRP.                            04621047
                                                                        04630047
           INITIALIZE DA-DETAIL-ACCUMULATORS                            04640047
                      PV-PAGE-COUNT.                                    04650047
      *                                                                 04660047
       6000-SELECT-10-CHAR-STR-NAME.                                    04670047
100404     INITIALIZE DCLXST00001.                                      04680056
                                                                        04690047
           EXEC SQL                                                     04700047
100404           SELECT LOC_10_ABBR_NM                                  04701049
100404             INTO :XST00001-LOC-10-ABBR-NM                        04702049
100404             FROM XST_LOC      A                                  04703049
100404            WHERE A.LOC_NBR  = :DK-STR-NBR                        04704050
           END-EXEC.                                                    04750047
                                                                        04760047
           EVALUATE TRUE                                                04770047
               WHEN SQLCODE = ZERO                                      04771049
031405             PERFORM 6010-SELECT-DISTRICT                         04771156
               WHEN OTHER                                               04780049
                   MOVE '6000-SELECT-10-CHAR-STR-NAME'                  04810047
                       TO PV-PARAGRAPH-NAME                             04820047
                   MOVE 'SELECT 10 CHAR STR NAME'                       04830047
                       TO PV-DB2-OPERATION-ATTEMPTED                    04840047
                   MOVE DK-STR-NBR  TO  PV-DISPLAY-STR-NBR              04850047
                   PERFORM 9100-SQL-ABEND                               04860047
           END-EVALUATE.                                                04890047
      *                                                                 04891056
031405 6010-SELECT-DISTRICT.                                            04892057
031405     INITIALIZE DCLXST00002.                                      04893056
                                                                        04894056
031405     EXEC SQL                                                     04895056
031405           SELECT DIST_NBR                                        04897056
031405             INTO :XST00002-DIST-NBR                              04899056
031405             FROM XST_LOC_DIST A                                  04899256
031405            WHERE A.LOC_NBR  = :DK-STR-NBR                        04899356
031405              AND A.END_DTE IS NULL                               04899556
           END-EXEC.                                                    04899656
                                                                        04899756
031405     EVALUATE TRUE                                                04899856
031405         WHEN SQLCODE = ZERO                                      04899956
031405             CONTINUE                                             04900056
031405         WHEN SQLCODE = +100                                      04900156
031405             CONTINUE                                             04900256
031405         WHEN OTHER                                               04900356
031405             MOVE '6010-SELECT-DISTRICT'                          04900456
031405                 TO PV-PARAGRAPH-NAME                             04900556
031405             MOVE 'SELECT DISTRICT'                               04900656
031405                 TO PV-DB2-OPERATION-ATTEMPTED                    04900756
031405             MOVE DK-STR-NBR  TO  PV-DISPLAY-STR-NBR              04900856
031405             PERFORM 9100-SQL-ABEND                               04900956
031405     END-EVALUATE.                                                04901056
      *                                                                 04902047
       7000-READ-PROCESS-DATES-FILE.                                    04910047
           READ PROCESS-DATES-FILE                                      04920047
               INTO TF029-PROCESS-DATES-RECORD                          04930047
           END-READ.                                                    04940047
      *                                                                 04950047
       7100-READ-XFER-DSCRP-FILE.                                       04960047
           READ XFER-DISCREPANCY-RPT-FILE                               04970047
               INTO TF038-XFER-DSCRP-RPT-RECORD                         04980047
                   AT END                                               04990047
                       SET PS-END-OF-DSCRP-RPT-FILE  TO  TRUE           05000047
           END-READ.                                                    05010047
                                                                        05020047
      ******************************************************************05030047
      * 8000-LINES-NEEDED-FOR-TOTALS - PERFORMS A CHECK VERYING THAT THE05040047
      * CURRENT LEVEL OF BREAK TOTALS WILL FIT ON THE PAGE.  IF NOT,    05050047
      * HEADING LINE ARE PRODUCED, THE LINE COUNT INITIALIZED AND THE   05060047
      * DETAIL LINE IS FILLED WITH THE APPROPRIATE INFORMATION BASED    05070047
      * UPON THE CURRENT LEVEL OF CONTROL BREAK.                        05080047
      ******************************************************************05090047
       8000-LINES-NEEDED-FOR-TOTALS.                                    05100047
           IF (PV-LINE-COUNT + PC-LINES-NEEDED-FOR-TOTALS) >            05110047
                   PC-PAGE-SIZE                                         05120047
               INITIALIZE PV-LINE-COUNT                                 05130047
               PERFORM 8500-WRITE-HEADING-LINES                         05140047
           END-IF.                                                      05150047
      *                                                                 05160047
      ******************************************************************05170047
      * WRITES A DETAIL LINE AND COMPUTES THE LINE COUNT.               05180047
      ******************************************************************05190047
       8100-WRITE-DETAIL-LINE.                                          05200047
           IF (PV-LINE-COUNT + PV-ADVANCE-COUNT) >                      05210047
                   PC-PAGE-SIZE                                         05220047
               INITIALIZE PV-LINE-COUNT                                 05230047
               PERFORM 8500-WRITE-HEADING-LINES                         05240047
           END-IF.                                                      05250047
                                                                        05260047
           WRITE XFER-DISCREPANCY-LINE                                  05270047
               FROM DL-DETAIL-LINE                                      05280047
               AFTER ADVANCING PV-ADVANCE-COUNT LINES.                  05290047
           COMPUTE PV-LINE-COUNT =                                      05300047
                   PV-LINE-COUNT + PV-ADVANCE-COUNT.                    05310047
           MOVE SPACES TO DL-DETAIL-LINE.                               05320047
           MOVE PC-DASH   TO  DL-DASH-ONE.                              05330047
           MOVE PC-SLASH  TO  DL-SLASH-ONE                              05340047
                              DL-SLASH-TWO                              05350047
                              DL-SLASH-THREE                            05360047
                              DL-SLASH-FOUR.                            05370047
           MOVE 1 TO PV-ADVANCE-COUNT.                                  05380047
      *                                                                 05390047
       8200-WRITE-STR-TOTAL-LINE.                                       05400047
           MOVE 2 TO PV-ADVANCE-COUNT.                                  05410047
           WRITE XFER-DISCREPANCY-LINE                                  05420047
               FROM ST-STORE-TOTAL                                      05430047
               AFTER ADVANCING PV-ADVANCE-COUNT LINES.                  05440047
      *                                                                 05450047
       8300-WRITE-FINAL-TOTAL-LINE.                                     05460047
           WRITE XFER-DISCREPANCY-LINE                                  05470047
               FROM FT-FINAL-TOTAL                                      05480047
               AFTER ADVANCING PV-ADVANCE-COUNT LINES.                  05490047
      *                                                                 05500047
      ******************************************************************05510047
      * WRITES THE KOHLS STANDARD END OF REPORT LINE, VERIFYING IT WILL 05520047
      * STILL FIT ON THE PAGE.                                          05530047
      ******************************************************************05540047
       8400-WRITE-END-OF-REPORT-LINE.                                   05550047
           IF (PV-LINE-COUNT + PV-ADVANCE-COUNT) >                      05560047
                   PC-PAGE-SIZE                                         05570047
               INITIALIZE PV-LINE-COUNT                                 05580047
               PERFORM 8500-WRITE-HEADING-LINES                         05590047
           END-IF.                                                      05600047
           WRITE XFER-DISCREPANCY-LINE                                  05610047
               FROM END-OF-REPORT-LINE                                  05620047
               AFTER ADVANCING PV-ADVANCE-COUNT LINES.                  05630047
      *                                                                 05640047
      ******************************************************************05650047
      * PRODUCES HEADINGS ASSOCIATED WITH THE TRANSFER DISCREPANCY      05660047
      * REPORT.                                                         05670047
      ******************************************************************05680047
       8500-WRITE-HEADING-LINES.                                        05690047
           ADD 1 TO PV-PAGE-COUNT.                                      05700047
           MOVE PV-PAGE-COUNT TO DP132O-PAGE-NUMBER.                    05710047
                                                                        05720047
           WRITE XFER-DISCREPANCY-LINE                                  05730047
               FROM DP132O-STANDRD-HEADER-132-COLS                      05740047
               AFTER ADVANCING PAGE.                                    05750047
                                                                        05760047
           WRITE XFER-DISCREPANCY-LINE                                  05770047
               FROM HL1-HEADING-LINE-1                                  05780047
               AFTER ADVANCING 2 LINES.                                 05790047
                                                                        05800047
           WRITE XFER-DISCREPANCY-LINE                                  05810047
               FROM HL2-HEADING-LINE-2                                  05820047
               AFTER ADVANCING 1 LINES.                                 05830047
                                                                        05840047
           WRITE XFER-DISCREPANCY-LINE                                  05850047
               FROM HL3-HEADING-LINE-3                                  05860047
               AFTER ADVANCING 2 LINES.                                 05870047
                                                                        05880047
           WRITE XFER-DISCREPANCY-LINE                                  05890047
               FROM HL4-HEADING-LINE-4                                  05900047
               AFTER ADVANCING 2 LINES.                                 05910047
                                                                        05920047
           WRITE XFER-DISCREPANCY-LINE                                  05930047
               FROM HL5-HEADING-LINE-5                                  05940047
               AFTER ADVANCING 1 LINES.                                 05950047
                                                                        05960047
           MOVE 2 TO PV-ADVANCE-COUNT.                                  05970047
           MOVE 9 TO PV-LINE-COUNT.                                     05980047
      *                                                                 05990047
       8600-WRITE-STR-TOT-DSCRP.                                        05996047
           WRITE STR-TOT-DISCREPANCY-RECORD                             05996247
               FROM TF037-STR-TOT-DSCRP-RECORD                          05996447
           END-WRITE.                                                   05996547
      *                                                                 05997047
       9000-EOJ-ROUTINE.                                                06000047
           CLOSE PROCESS-DATES-FILE                                     06010047
                 XFER-DISCREPANCY-RPT-FILE                              06020047
                 STR-TOT-DISCREPANCY-FILE                               06021047
                 XFER-DISCREPANCY-REPORT.                               06030047
      *                                                                 06040047
      ******************************************************************06050047
      *  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    06060047
      *  ERROR OR WARNING CODE OCCURS.                                  06070047
      ******************************************************************06080047
       9100-SQL-ABEND.                                                  06090047
           DISPLAY '** ABEND     **'.                                   06100047
           DISPLAY '** PROGRAM   ** = TFKRP473'.                        06110047
           DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              06120047
           DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     06130047
           DISPLAY '** KEYS      ** = ' PV-DISPLAY-AREA.                06140047
                                                                        06150047
      ******************************************************************06160047
      * THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    06170047
      * MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         06180047
      * 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     06190047
      * FORMAT.                                                         06200047
      ******************************************************************06210047
           COPY DPPD004.                                                06220047
                                                                        06230047
           MOVE +4013  TO  ABEND-CODE.                                  06240047
           CALL 'ILBOABN0' USING ABEND-CODE.                            06250047
