000100 IDENTIFICATION DIVISION.                                         00010001
000200 TITLE 'WMS SHIPMENT CONTROL MODULE - ONLINE VERSION'.            00020001
000300*                                                                 00030001
000400 PROGRAM-ID.   WSKCS305.                                          00040001
000500 AUTHOR.        JEAN KURKOWSKI.                                   00050001
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060001
000700 DATE-WRITTEN.  FEBRUARY 2007.                                    00070001
000800 DATE-COMPILED.                                                   00080001
000900 ENVIRONMENT DIVISION.                                            00090001
001000 CONFIGURATION SECTION.                                           00100001
001100 SOURCE-COMPUTER. IBM-3090.                                       00110001
001200 OBJECT-COMPUTER. IBM-3090.                                       00120001
001300                                                                  00130001
001400 DATA DIVISION.                                                   00140001
001500 WORKING-STORAGE SECTION.                                         00150001
001600 01  PV-VARIABLES.                                                00160001
001700     05  PV-CURRENT-TIMESTAMP         PIC X(26) VALUE SPACES.     00170001
001800     05  PV-EIBTASKN                  PIC Z(06)9.                 00180001
001900     05  PV-SQL-RETURN-CD             PIC S9(04) VALUE +0.        00190001
002000     05  PV-CNT-CURSOR                PIC S9(09) COMP VALUE +0.   00200001
002100     05  PV-SHIPMNT-NBR               PIC X(20)  VALUE SPACES.    00210001
002200     05  PV-SHIPMNT-NBR-R REDEFINES PV-SHIPMNT-NBR.               00220001
002300         10  PV-K                     PIC X(1).                   00230001
002400         10  PV-RANDOM-NBR            PIC 9(09).                  00240001
002500         10  PV-D                     PIC X(1).                   00250001
002600         10  PV-DUMMY-NBR             PIC 9(04).                  00260001
002700         10  PV-UNUSED                PIC X(05).                  00270001
002800     05  PV-CICS-RESP                    PIC S9(04)  VALUE +0     00280001
002900                                                     COMP SYNC.   00290001
003000     05  PV-CICS-MSG-AREA                PIC  X(100) VALUE SPACE. 00300001
003100     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     00310001
003200                                                     COMP SYNC.   00320001
003300     05  PV-CRTN-CNT                  PIC S9(09)  COMP.           00330001
003400     05  PV-UCC128-CRTN-CNT           PIC S9(09)  COMP.           00340001
003500     05  PV-UCC128-CRTN-UNTS          PIC S9(09)  COMP.           00350001
003600     05  PV-UCC128-TOT-UNTS           PIC S9(09)  COMP.           00360001
003700     05  PV-UCC128-TOT-OTPK-QTYS      PIC S9(09)  COMP.           00370001
003800     05  PV-UCC128-OTPK-QTY           PIC S9(09)V COMP-3.         00380001
003900     05  PV-UCC128-LINES-PER-CRTN     PIC S9(09)V COMP-3.         00390005
004000     05  PV-TRANSCRIBE-SUM            PIC S9(09)  COMP            00400005
004100                                                     VALUE ZEROES.00410001
004200     05  PV-PROCESS-QTY               PIC  9(05)  VALUE ZEROES.   00420005
004300     05  PV-CARTON-COUNT-CALC         PIC  9(04).                 00430005
004400     05  PV-CARTON-COUNT-REM          PIC  9(04).                 00440005
004500     05  PV-EXPTED-ITM-QTY            PIC S9(09)  COMP.           00450005
004501                                                                  00450105
004510     05  PV-RANDOM-TMST               PIC  X(26) VALUE SPACES.    00451005
004530     05  PV-CAPTURE-RANDOM-NBR        PIC  9(09) VALUE ZEROES.    00453005
004540     05  PV-CAPTURE-CNT               PIC S9(09) COMP             00454006
004550                                                 VALUE ZEROES.    00455006
004600                                                                  00460001
004700                                                                  00470001
004800 01  WS-FIELDS.                                                   00480001
004900     05  WS-EXT-SHP-ID                PIC X(20).                  00490001
005000     05  WS-OLD-EXT-SHP-ID            PIC X(20).                  00500001
005100     05  WS-NEW-EXT-SHP-ID            PIC X(20).                  00510001
005200     05  WS-TRIP-ID                   PIC S9(09) COMP.            00520001
005300     05  WS-DWNLD-TMST                PIC X(26).                  00530001
005400     05  WS-RCPT-TMST                 PIC X(26).                  00540001
005500     05  WS-DMY-SEQ-NBR               PIC S9(04) COMP.            00550001
005600     05  WS-OPER-UNT-ID               PIC S9(04) COMP.            00560001
005700     05  WS-SQL-CNT                   PIC S9(09) COMP.            00570001
005800     05  WS-PO-NBR                    PIC S9(09) COMP.            00580001
005900     05  WS-RCVR-SEQ-NBR              PIC S9(09) COMP.            00590001
006000     05  WS-PREPK-ID                  PIC S9(04) COMP.            00600001
006100     05  WS-PO-LNE-NBR                PIC S9(09) COMP.            00610001
006200     05  WS-PKGNG-CDE                 PIC X(01).                  00620001
006300     05  WS-DWNLD-CDE                 PIC X(01).                  00630001
006400     05  WS-HOLD-PO-NBR               PIC S9(09) COMP.            00640001
006500     05  WS-HOLD-RCVR-SEQ-NBR         PIC S9(09) COMP.            00650001
006600     05  WS-HOLD-EXT-SHP-ID           PIC X(20).                  00660001
006700     05  WS-ORIG-EXT-SHP-ID           PIC X(20).                  00670001
006800     05  WS-SHIPT-ID                  PIC S9(09) COMP VALUE +0.   00680001
006900     05  WS-DISPLAY-1                 PIC -Z(08)9.                00690001
007000     05  WS-DISPLAY-2                 PIC -Z(08)9.                00700001
007100     05  WS-DISPLAY-3                 PIC -Z(03)9.                00710001
007200     05  WS-DISPLAY-4                 PIC -Z(08)9.                00720001
007300     05  WS-DISPLAY-5                 PIC -Z(14)9.                00730001
007400     05  WS-DISPLAY-6                 PIC -Z(03)9.                00740001
007500     05  WS-DISPLAY-PO-NBR            PIC -Z(08)9.                00750001
007600     05  WS-DISPLAY-RCVR-NBR          PIC -Z(08)9.                00760001
007700     05  WS-DISPLAY-LNE-NBR           PIC -Z(08)9.                00770001
007800                                                                  00780001
007900 01  DK-KEYS.                                                     00790001
008000     05  DK-TRIP-ID                   PIC S9(09) COMP VALUE +0.   00800001
008100     05  DK-PO-NBR                    PIC S9(09) COMP VALUE +0.   00810001
008200     05  DK-RCVR-SEQ-NBR              PIC S9(09) COMP VALUE +0.   00820001
008300     05  DK-PREPK-ID                  PIC S9(04) COMP VALUE +0.   00830001
008400     05  DK-SKU-NBR                   PIC S9(08)V COMP-3          00840001
008500                                                      VALUE +0.   00850001
008600     05  DK-PO-LNE-NBR                PIC S9(09) COMP VALUE +0.   00860001
008700     05  DK-SHIPT-ID                  PIC S9(09) COMP VALUE +0.   00870001
008800     05  DK-EXT-SHP-ID                PIC  X(20) VALUE SPACE.     00880001
008900                                                                  00890001
009000 01  DN-DB2-NULL-INDICATORS.                                      00900001
009100     05  DN-VEH-NBR                 PIC S9(04) COMP VALUE ZEROES. 00910001
009200                                                                  00920001
009300 01  PS-SWITCHES.                                                 00930001
009400     05  PS-FIRST-RECORD-SW          PIC X(01)  VALUE 'Y'.        00940001
009500         88  PS-FIRST-RECORD-YES                VALUE 'Y'.        00950001
009600         88  PS-FIRST-RECORD-NO                 VALUE 'N'.        00960001
009700     05  PS-FIRST-DUMMY-REC-SW       PIC X(01)  VALUE 'Y'.        00970001
009800         88  PS-FIRST-DUMMY-REC-YES             VALUE 'Y'.        00980001
009900         88  PS-FIRST-DUMMY-REC-NO              VALUE 'N'.        00990001
010000     05  PS-FIRST-HDR-CSR-1          PIC X(01)  VALUE 'N'.        01000001
010100         88  PS-FIRST-HDR-CSR-1-YES             VALUE 'Y'.        01010001
010200         88  PS-FIRST-HDR-CSR-1-NO              VALUE 'N'.        01020001
010300     05  PS-DUMMY-HEADER             PIC X(01)  VALUE 'N'.        01030001
010400         88  PS-DUMMY-HEADER-YES                VALUE 'Y'.        01040001
010500         88  PS-DUMMY-HEADER-NO                 VALUE 'N'.        01050001
010600     05  PS-HEADER-EXIST-SW          PIC X(01)  VALUE 'N'.        01060001
010700         88  PS-HEADER-EXIST-YES                VALUE 'Y'.        01070001
010800         88  PS-HEADER-EXIST-NO                 VALUE 'N'.        01080001
010900     05  PS-APPT-SENT                PIC X(01)  VALUE 'N'.        01090001
011000         88  PS-APPT-SENT-YES                   VALUE 'Y'.        01100001
011100         88  PS-APPT-SENT-NO                    VALUE 'N'.        01110001
011200     05  PS-CHECK-ASN                PIC X(01)  VALUE 'Y'.        01120001
011300         88  PS-CHECK-ASN-YES                   VALUE 'Y'.        01130001
011400         88  PS-CHECK-ASN-NO                    VALUE 'N'.        01140001
011500     05  PS-MANUAL-UPDATE            PIC X(01)  VALUE 'N'.        01150001
011600         88  PS-MANUAL-UPDATE-YES               VALUE 'Y'.        01160001
011700         88  PS-MANUAL-UPDATE-NO                VALUE 'N'.        01170001
011800     05  PS-ASN-NEW-HEADER           PIC X(01)  VALUE 'N'.        01180001
011900         88  PS-ASN-NEW-HDR-YES                 VALUE 'Y'.        01190001
012000         88  PS-ASN-NEW-HDR-NO                  VALUE 'N'.        01200001
012100     05  PS-MULT-ASN                 PIC X(01)  VALUE 'Y'.        01210001
012200         88  PS-MULT-ASN-YES                    VALUE 'Y'.        01220001
012300         88  PS-MULT-ASN-NO                     VALUE 'N'.        01230001
012400     05  PS-IMMED-DOWNLOAD           PIC X(01)  VALUE 'N'.        01240001
012500         88  PS-IMMED-DOWNLOAD-YES              VALUE 'Y'.        01250001
012600         88  PS-IMMED-DOWNLOAD-NO               VALUE 'N'.        01260001
012700     05  PS-PACK-BY-STORE            PIC X(01)  VALUE 'N'.        01270001
012800         88  PS-PACK-BY-STORE-YES               VALUE 'Y'.        01280001
012900         88  PS-PACK-BY-STORE-NO                VALUE 'N'.        01290001
013000     05  PS-PBS-CASE-INVALID         PIC X(01)  VALUE 'N'.        01300001
013100         88  PS-PBS-CASE-INVALID-YES            VALUE 'Y'.        01310001
013200         88  PS-PBS-CASE-INVALID-NO             VALUE 'N'.        01320001
013300     05  PS-EOF-TRIP-ID-CSR          PIC X(01)  VALUE 'N'.        01330001
013400         88  PS-EOF-TRIP-ID-CSR-YES             VALUE 'Y'.        01340001
013500         88  PS-EOF-TRIP-ID-CSR-NO              VALUE 'N'.        01350001
013600     05  PS-EOF-TRIP-INACT-CSR       PIC X(01)  VALUE 'N'.        01360001
013700         88  PS-EOF-TRIP-INACT-CSR-YES          VALUE 'Y'.        01370001
013800         88  PS-EOF-TRIP-INACT-CSR-NO           VALUE 'N'.        01380001
013900     05  PS-EOF-TRIP-DWNLD-CSR       PIC X(01)  VALUE 'N'.        01390001
014000         88  PS-EOF-TRIP-DWNLD-CSR-YES          VALUE 'Y'.        01400001
014100         88  PS-EOF-TRIP-DWNLD-CSR-NO           VALUE 'N'.        01410001
014200     05  PS-EOF-SHIP-TO-CSR          PIC X(01)  VALUE 'N'.        01420001
014300         88  PS-EOF-SHIP-TO-CSR-YES             VALUE 'Y'.        01430001
014400         88  PS-EOF-SHIP-TO-CSR-NO              VALUE 'N'.        01440001
014500     05  PS-EOF-HDR-CSR-1            PIC X(01)  VALUE 'N'.        01450001
014600         88  PS-EOF-HDR-CSR-1-YES               VALUE 'Y'.        01460001
014700         88  PS-EOF-HDR-CSR-1-NO                VALUE 'N'.        01470001
014800     05  PS-EOF-RECV-ITM-CSR         PIC X(01)  VALUE 'N'.        01480001
014900         88  PS-EOF-RECV-ITM-CSR-YES            VALUE 'Y'.        01490001
015000         88  PS-EOF-RECV-ITM-CSR-NO             VALUE 'N'.        01500001
015100     05  PS-EOF-RCVR-LINE-CSR        PIC X(01)  VALUE 'N'.        01510001
015200         88  PS-EOF-RCVR-LINE-CSR-YES           VALUE 'Y'.        01520001
015300         88  PS-EOF-RCVR-LINE-CSR-NO            VALUE 'N'.        01530001
015400     05  PS-EOF-PO-RCVR-CSR          PIC X(01)  VALUE 'N'.        01540001
015500         88  PS-EOF-PO-RCVR-CSR-YES             VALUE 'Y'.        01550001
015600         88  PS-EOF-PO-RCVR-CSR-NO              VALUE 'N'.        01560001
015700     05  PS-EOF-PO-RCVR-CSR2         PIC X(01)  VALUE 'N'.        01570001
015800         88  PS-EOF-PO-RCVR-CSR2-YES            VALUE 'Y'.        01580001
015900         88  PS-EOF-PO-RCVR-CSR2-NO             VALUE 'N'.        01590001
016000     05  PS-EOF-HDR-CSR-2            PIC X(01)  VALUE 'N'.        01600001
016100         88  PS-EOF-HDR-CSR-2-YES               VALUE 'Y'.        01610001
016200         88  PS-EOF-HDR-CSR-2-NO                VALUE 'N'.        01620001
016300     05  PS-EOF-SKU-CSR              PIC X(01)  VALUE 'N'.        01630001
016400         88  PS-EOF-SKU-CSR-YES                 VALUE 'Y'.        01640001
016500         88  PS-EOF-SKU-CSR-NO                  VALUE 'N'.        01650001
016600     05  PS-EOF-DTL-CSR-1            PIC X(01)  VALUE 'N'.        01660001
016700         88  PS-EOF-DTL-CSR-1-YES               VALUE 'Y'.        01670001
016800         88  PS-EOF-DTL-CSR-1-NO                VALUE 'N'.        01680001
016900     05  PS-EOF-ACTIVE-REC-CSR       PIC X(01)  VALUE 'N'.        01690001
017000         88  PS-EOF-ACTIVE-REC-CSR-YES          VALUE 'Y'.        01700001
017100         88  PS-EOF-ACTIVE-REC-CSR-NO           VALUE 'N'.        01710001
017200     05  PS-EOF-DUMMY-CSR            PIC X(01)  VALUE 'N'.        01720001
017300         88  PS-EOF-DUMMY-CSR-YES               VALUE 'Y'.        01730001
017400         88  PS-EOF-DUMMY-CSR-NO                VALUE 'N'.        01740001
017500     05  PS-CICS-SWITCH-IND          PIC X(01)  VALUE 'N'.        01750001
017600         88 PS-CICS-SWITCH-NO                   VALUE 'N'.        01760001
017700         88 PS-CICS-SWITCH-YES                  VALUE 'Y'.        01770001
017800     05  PS-LNE-UCC128-DATA-IND       PIC X(01) VALUE 'N'.        01780001
017900         88  PS-LNE-UCC128-DATA-YES             VALUE 'Y'.        01790001
018000         88  PS-LNE-UCC128-DATA-NO              VALUE 'N'.        01800001
018100     05  PS-PBS-CARTON-DATA-IND       PIC X(01) VALUE 'N'.        01810001
018200         88  PS-PBS-CARTON-DATA-YES             VALUE 'Y'.        01820001
018300         88  PS-PBS-CARTON-DATA-NO              VALUE 'N'.        01830001
018400     05  PS-TRIP-HDR-EXIST-SW         PIC X(01) VALUE 'N'.        01840001
018500         88  PS-TRIP-HDR-EXIST-YES              VALUE 'Y'.        01850001
018600         88  PS-TRIP-HDR-EXIST-NO               VALUE 'N'.        01860001
018700     05  PS-DISTRO-TRBL-SW            PIC X(01) VALUE 'N'.        01870001
018800         88  PS-DISTRO-TRBL-YES                 VALUE 'Y'.        01880001
018900         88  PS-DISTRO-TRBL-NO                  VALUE 'N'.        01890001
019000     05  PS-XREF-HDR-EXIST-SW         PIC X(01) VALUE 'N'.        01900001
019100         88  PS-XREF-HDR-EXIST-YES              VALUE 'Y'.        01910001
019200         88  PS-XREF-HDR-EXIST-NO               VALUE 'N'.        01920001
019300     05  PS-HEADER-CREATED-SW         PIC X(01) VALUE 'N'.        01930001
019400         88  PS-HEADER-CREATED-YES              VALUE 'Y'.        01940001
019500         88  PS-HEADER-CREATED-NO               VALUE 'N'.        01950001
019600     05  PS-DETAIL-CREATED-SW         PIC X(01) VALUE 'N'.        01960001
019700         88  PS-DETAIL-CREATED-YES              VALUE 'Y'.        01970001
019800         88  PS-DETAIL-CREATED-NO               VALUE 'N'.        01980001
019900     05  PS-VALID-TRIP-SW             PIC X(01) VALUE 'N'.        01990001
020000         88  PS-VALID-TRIP                      VALUE 'Y'.        02000001
020100         88  PS-VALID-TRIP-NO                   VALUE 'N'.        02010001
020200     05  PS-CANCEL-SHPMT-SW           PIC X(01) VALUE 'N'.        02020001
020300         88  PS-CANCEL-SHPMT-NO                 VALUE 'N'.        02030001
020400         88  PS-CANCEL-SHPMT-YES                VALUE 'Y'.        02040001
020500* JAK 09/2007 ADD SWITCH TO INDICATE HOW MANY HDR RECS EXIST      02050001
020600     05  PS-NUMBER-HEADER-SW          PIC X(01) VALUE 'N'.        02060001
020700         88  PS-SINGLE-HEADER                   VALUE 'Y'.        02070001
020800         88  PS-MULTIPLE-HEADER                 VALUE 'N'.        02080001
020900     05  PS-AP-RECEIVER-FOUND-SW      PIC X(01) VALUE 'N'.        02090001
021000         88  PS-AP-RECEIVER-FOUND-YES           VALUE 'Y'.        02100001
021100         88  PS-AP-RECEIVER-FOUND-NO            VALUE 'N'.        02110001
021101* DMH - 12/13/2016 - BEGIN                                        02110102
021110     05  PS-CAPTURE-DOWNLOAD-SW       PIC X(01) VALUE 'N'.        02111002
021120         88  PS-CAPTURE-DOWNLOAD-YES            VALUE 'Y'.        02112002
021130         88  PS-CAPTURE-DOWNLOAD-NO             VALUE 'N'.        02113002
021140* DMH - 12/13/2016 - END                                          02114002
021200                                                                  02120001
021300 01  PC-CONSTANTS.                                                02130001
021400     05  PC-DEFAULT-NINES            PIC X(26)  VALUE             02140001
021500                              '9999-09-09-09.09.09.999999'.       02150001
021600     05  PC-RANDOM-NBR-GENERATOR     PIC X(08)  VALUE             02160001
021700                                                 'DPKUT902'.      02170001
021800     05  PC-CASEPACK-SPLIT-MOD       PIC X(08)  VALUE             02180001
021900                                                 'PCKUT719'.      02190001
022000     05  PC-CASEPACK-SPLIT-LEN       PIC S9(4) VALUE +400         02200001
022100                                                COMP SYNC.        02210001
022200     05  PC-DOWNLOAD-MOD-TRAN        PIC X(04)  VALUE 'W301'.     02220001
022210     05  PC-RANDOM-PGM               PIC  X(08) VALUE 'DPKUT902'. 02221005
022220     05  PC-DEFAULT-TMST            PIC X(26)                     02222006
022230                              VALUE '9999-09-09-09.09.09.999999'. 02223006
022300/                                                                 02230001
022400* * *  RANDOM NUMBER AREA.                                        02240001
022500     COPY DPWS902.                                                02250001
022600* * *  DOWNLOAD MODULE AREA                                       02260001
022700     COPY WSWS003.                                                02270001
022800* * *  MINI CASEPACK SPLIT AREA                                   02280001
022900     COPY PCWS251.                                                02290001
023000* * *  COMMAREA                                                   02300001
023100     COPY WSWS001.                                                02310001
023200* * * LAYOUT FOR THE ABEND COMMUNICATIONS AREA                    02320001
023300     COPY DPWS013.                                                02330001
023400                                                                  02340001
023410* * * LAYOUT OF TEXT AREA ON WFT_DAT_XFER RECORD                  02341004
023420     COPY WSWS025.                                                02342002
023430                                                                  02343002
023500* * * COMMUNICATIONS AREA FOR DB2                                 02350001
023600     EXEC SQL                                                     02360001
023700          INCLUDE SQLCA                                           02370001
023800     END-EXEC.                                                    02380001
023900* * * WST_SHPMT_XREF_HDR VIEW - WMS SHIPMENT XREF HEADER          02390001
024000     EXEC SQL                                                     02400001
024100         INCLUDE WST00001                                         02410001
024200     END-EXEC.                                                    02420001
024300* * * WST_SHPMT_XREF_DTL VIEW - WMS SHIPMENT XREF DETAIL          02430001
024400     EXEC SQL                                                     02440001
024500         INCLUDE WST00002                                         02450001
024600     END-EXEC.                                                    02460001
024700* * * WST_INTGRTN_TYP VIEW                                        02470001
024800     EXEC SQL                                                     02480001
024900         INCLUDE WST00008                                         02490001
025000     END-EXEC.                                                    02500001
025100* * * WST_ATTR_DEFN VIEW                                          02510001
025200     EXEC SQL                                                     02520001
025300         INCLUDE WST00009                                         02530001
025400     END-EXEC.                                                    02540001
025500* * * WST_ATTR_ELEM VIEW                                          02550001
025600     EXEC SQL                                                     02560001
025700         INCLUDE WST00010                                         02570001
025800     END-EXEC.                                                    02580001
025900* * * XLT_SKU VIEW                                                02590001
026000     EXEC SQL                                                     02600001
026100         INCLUDE XLT00003                                         02610001
026200     END-EXEC.                                                    02620001
026300* * * TVHTRIP VIEW - VEHICLE TRIP TABLE                           02630001
026400     EXEC SQL                                                     02640001
026500         INCLUDE TVHTRIP                                          02650001
026600     END-EXEC.                                                    02660001
026700* * * TSHIPMT VIEW - SHIPMENT TABLE                               02670001
026800     EXEC SQL                                                     02680001
026900         INCLUDE TSHIPMT                                          02690001
027000     END-EXEC.                                                    02700001
027100* * * TSHPTPO VIEW - SHIPMENT PO TABLE                            02710001
027200     EXEC SQL                                                     02720001
027300         INCLUDE TSHPTPO                                          02730001
027400     END-EXEC.                                                    02740001
027500* * * TRECEIV VIEW - RECEIVER TABLE                               02750001
027600     EXEC SQL                                                     02760001
027700         INCLUDE TRECEIV                                          02770001
027800     END-EXEC.                                                    02780001
027900* * * TRECITM VIEW - RECEIVER ITEM TABLE                          02790001
028000     EXEC SQL                                                     02800001
028100         INCLUDE TRECITM                                          02810001
028200     END-EXEC.                                                    02820001
028300* * * TRECDIS VIEW - RECEIPT DISTRIBUTION TABLE                   02830001
028400     EXEC SQL                                                     02840001
028500         INCLUDE TRECDIS                                          02850001
028600     END-EXEC.                                                    02860001
028700* * * TPURITM VIEW - PURCHASE ORDER LINE ITEM TABLE               02870001
028800     EXEC SQL                                                     02880001
028900         INCLUDE TPURITM                                          02890001
029000     END-EXEC.                                                    02900001
029100* * * TPKSLIP VIEW - PACK SLIP HEADER TABLE                       02910001
029200     EXEC SQL                                                     02920001
029300         INCLUDE TPKSLIP                                          02930001
029400     END-EXEC.                                                    02940001
029500* * * TINPKSU VIEW - INBOUND EDI PACKLIST/VENDOR SHIPMENT         02950001
029600     EXEC SQL                                                     02960001
029700         INCLUDE TINPKSU                                          02970001
029800     END-EXEC.                                                    02980001
029900* * * TSHUNLO VIEW - SHIPMENT UNIT LOCATION                       02990001
030000     EXEC SQL                                                     03000001
030100         INCLUDE TSHUNLO                                          03010001
030200     END-EXEC.                                                    03020001
030300* * * TSHUUPC VIEW - STATUS TYPE TABLE                            03030001
030400     EXEC SQL                                                     03040001
030500         INCLUDE TSHUUPC                                          03050001
030600     END-EXEC.                                                    03060001
030700                                                                  03070001
030710* * * TKRPRPM - PARM TABLE TO SEE IF CAPTURE FOR TUPLDER          03071002
030720     EXEC SQL                                                     03072002
030730         INCLUDE TKRPRPM                                          03073002
030740     END-EXEC.                                                    03074002
030741                                                                  03074102
030749******************************************************************03074904
030750*    wft_dat_cntl - 1 header                                      03075004
030751******************************************************************03075104
030752     EXEC SQL                                                     03075204
030753         INCLUDE wft00004                                         03075304
030754     END-EXEC.                                                    03075404
030755                                                                  03075504
030756******************************************************************03075604
030757*    wft_dat_xfer - 1 to many detail                              03075704
030758******************************************************************03075804
030759     EXEC SQL                                                     03075904
030760         INCLUDE wft00005                                         03076004
030761     END-EXEC.                                                    03076104
030762                                                                  03076204
030770                                                                  03077002
030800                                                                  03080001
030900**DECLARE THE TRIP-ID-CSR                                         03090001
031000     EXEC SQL                                                     03100001
031100          DECLARE TRIP-ID-CSR CURSOR FOR                          03110001
031200           SELECT  DISTINCT                                       03120001
031300                   H.EXT_SHP_ID                                   03130001
031400                  ,H.DWNLD_TMST                                   03140001
031500                  ,H.DMY_SEQ_NBR                                  03150001
031600                  ,H.CRE_TMST                                     03160001
031700           FROM    WST_SHPMT_XREF_HDR H                           03170001
031800                  ,WST_SHPMT_XREF_DTL D                           03180001
031900           WHERE   H.EXT_SHP_ID = D.EXT_SHP_ID                    03190001
032000           AND     H.INTR_TRIP_ID = :DK-TRIP-ID                   03200001
032100           AND     D.PO_NBR       = :DK-PO-NBR                    03210001
032200           AND     D.RCVR_SEQ_NBR = :DK-RCVR-SEQ-NBR              03220001
032300           AND     D.ACTV_CDE     = 'A'                           03230001
032400           ORDER BY H.CRE_TMST                                    03240001
032500     END-EXEC.                                                    03250001
032600                                                                  03260001
032700**DECLARE THE HDR-CSR-1                                           03270001
032800     EXEC SQL                                                     03280001
032900          DECLARE HDR-CSR-1 CURSOR FOR                            03290001
033000           SELECT  EXT_SHP_ID                                     03300001
033100                 , DWNLD_TMST                                     03310001
033200           FROM    WST_SHPMT_XREF_HDR                             03320001
033300           WHERE   INTR_TRIP_ID = :DK-TRIP-ID                     03330001
033400           AND     SOR_CDE      = 'RC'                            03340001
033500           AND     RCPT_TMST    = :PC-DEFAULT-NINES               03350001
033600     END-EXEC.                                                    03360001
033700                                                                  03370001
033800**DECLARE THE HDR-CSR-2                                           03380001
033900     EXEC SQL                                                     03390001
034000          DECLARE HDR-CSR-2 CURSOR FOR                            03400001
034100           SELECT  EXT_SHP_ID                                     03410001
034200           FROM    WST_SHPMT_XREF_HDR                             03420001
034300           WHERE   INTR_TRIP_ID = :DK-TRIP-ID                     03430001
034400           AND     SOR_CDE      = 'RC'                            03440001
034500           AND     RCPT_TMST    = :PC-DEFAULT-NINES               03450001
034600           AND     DWNLD_CDE   <> 'X'                             03460001
034700     END-EXEC.                                                    03470001
034800                                                                  03480001
034900**DECLARE THE SHIP-TO-CSR                                         03490001
035000     EXEC SQL                                                     03500001
035100          DECLARE SHIP-TO-CSR CURSOR FOR                          03510001
035200           SELECT  PO_NBR                                         03520001
035300                  ,REC_SEQ_NBR                                    03530001
035400           FROM    TSHPTPO                                        03540001
035500           WHERE   SHIPT_ID     = :DK-SHIPT-ID                    03550001
035600           AND     REC_SEQ_NBR  > 0                               03560001
035700     END-EXEC.                                                    03570001
035800                                                                  03580001
035900**DECLARE THE PO-RCVR-CSR                                         03590001
036000     EXEC SQL                                                     03600001
036100          DECLARE PO-RCVR-CSR CURSOR FOR                          03610001
036200           SELECT  DISTINCT                                       03620001
036300                   C.PO_NBR                                       03630001
036400                 , C.REC_SEQ_NBR                                  03640001
036500           FROM    TVHTRIP A                                      03650001
036600                 , TSHIPMT B                                      03660001
036700                 , TSHPTPO C                                      03670001
036800                 , TRECEIV D                                      03680001
036900           WHERE   A.TRIP_ID        = :DK-TRIP-ID                 03690001
037000           AND     A.TRIP_ID        = B.TRIP_ID                   03700001
037100           AND     C.SHIPT_ID       = B.SHIPT_ID                  03710001
037200           AND     C.PO_NBR         = D.ORD_NBR                   03720001
037300           AND     C.REC_SEQ_NBR    = D.REC_SEQ_NBR               03730001
037400           AND     D.VER_STATUS_CDE = 'A'                         03740001
037500           ORDER BY C.PO_NBR, C.REC_SEQ_NBR                       03750001
037600     END-EXEC.                                                    03760001
037700                                                                  03770001
037800**DECLARE THE PO-RCVR-CSR2                                        03780001
037900     EXEC SQL                                                     03790001
038000          DECLARE PO-RCVR-CSR2 CURSOR FOR                         03800001
038100           SELECT  DISTINCT                                       03810001
038200                   C.PO_NBR                                       03820001
038300                 , C.REC_SEQ_NBR                                  03830001
038400           FROM    TSHPTPO C                                      03840001
038500                 , TRECEIV D                                      03850001
038600           WHERE   C.SHIPT_ID       = :DK-SHIPT-ID                03860001
038700           AND     C.PO_NBR         = D.ORD_NBR                   03870001
038800           AND     C.REC_SEQ_NBR    = D.REC_SEQ_NBR               03880001
038900           AND     D.VER_STATUS_CDE = 'A'                         03890001
039000           ORDER BY C.PO_NBR, C.REC_SEQ_NBR                       03900001
039100     END-EXEC.                                                    03910001
039200                                                                  03920001
039300**DECLARE THE RECV-ITM-CSR                                        03930001
039400     EXEC SQL                                                     03940001
039500          DECLARE RECV-ITM-CSR CURSOR FOR                         03950001
039600           SELECT  ORD_LNE_NBR                                    03960001
039700           FROM    TRECITM                                        03970001
039800           WHERE   ORD_NBR        = :DK-PO-NBR                    03980001
039900           AND     REC_SEQ_NBR    = :DK-RCVR-SEQ-NBR              03990001
040000           AND     PREPK_ID       = :DK-PREPK-ID                  04000001
040100           AND     VER_STATUS_CDE = 'A'                           04010001
040200     END-EXEC.                                                    04020001
040300                                                                  04030001
040400**DECLARE THE RCVR-LINE-CSR                                       04040001
040500     EXEC SQL                                                     04050001
040600          DECLARE RCVR-LINE-CSR CURSOR FOR                        04060001
040700           SELECT  ORD_LNE_NBR                                    04070001
040800                 , PREPK_ID                                       04080001
040900           FROM    TRECITM                                        04090001
041000           WHERE   ORD_NBR        = :DK-PO-NBR                    04100001
041100           AND     REC_SEQ_NBR    = :DK-RCVR-SEQ-NBR              04110001
041200           AND     VER_STATUS_CDE = 'A'                           04120001
041300           ORDER BY PREPK_ID, ORD_LNE_NBR                         04130001
041400     END-EXEC.                                                    04140001
041500                                                                  04150001
041600**DECLARE THE SKU-CSR                                             04160001
041700     EXEC SQL                                                     04170001
041800          DECLARE SKU-CSR CURSOR FOR                              04180001
041900           SELECT  DISTINCT                                       04190001
042000                   B.PO_NBR                                       04200001
042100                 , D.SKU_NBR                                      04210001
042200           FROM    WST_SHPMT_XREF_DTL B                           04220001
042300                 , TPURITM C                                      04230001
042400                 , XLT_SKU D                                      04240001
042500           WHERE   B.EXT_SHP_ID     = :DK-EXT-SHP-ID              04250001
042600           AND     B.PO_NBR         = C.PO_NBR                    04260001
042700           AND     B.PO_LNE_NBR     = C.APP_PO_LNE_NBR            04270001
042800           AND     C.ITM_NBR        = D.ITM_NBR                   04280001
042900           AND     C.VER_STATUS_CDE = 'A'                         04290001
043000           AND     B.ACTV_CDE       = 'A'                         04300001
043100           GROUP BY B.PO_NBR, D.SKU_NBR                           04310001
043200     END-EXEC.                                                    04320001
043300                                                                  04330001
043400**DECLARE THE DTL-CSR-1                                           04340001
043500     EXEC SQL                                                     04350001
043600          DECLARE DTL-CSR-1 CURSOR FOR                            04360001
043700           SELECT  B.PO_NBR                                       04370001
043800                 , B.RCVR_SEQ_NBR                                 04380001
043900                 , B.PO_LNE_NBR                                   04390001
044000                 , B.PREPK_ID                                     04400001
044100           FROM    WST_SHPMT_XREF_DTL B                           04410001
044200                 , TPURITM C                                      04420001
044300                 , XLT_SKU D                                      04430001
044400           WHERE   B.EXT_SHP_ID     = :DK-EXT-SHP-ID              04440001
044500           AND     D.SKU_NBR        = :DK-SKU-NBR                 04450001
044600           AND     B.PO_NBR         = C.PO_NBR                    04460001
044700           AND     B.PO_LNE_NBR     = C.APP_PO_LNE_NBR            04470001
044800           AND     C.ITM_NBR        = D.ITM_NBR                   04480001
044900           AND     C.VER_STATUS_CDE = 'A'                         04490001
045000           AND     B.ASN_LVL_CDE    = 'C'                         04500001
045100           AND     B.ACTV_CDE       = 'A'                         04510001
045200     END-EXEC.                                                    04520001
045300                                                                  04530001
045400**DECLARE THE ACTIVE-REC-CSR                                      04540001
045500     EXEC SQL                                                     04550001
045600          DECLARE ACTIVE-REC-CSR CURSOR FOR                       04560001
045700           SELECT  PO_NBR                                         04570001
045800                 , RCVR_SEQ_NBR                                   04580001
045900                 , PO_LNE_NBR                                     04590001
046000                 , PREPK_ID                                       04600001
046100           FROM    WST_SHPMT_XREF_DTL                             04610001
046200           WHERE   EXT_SHP_ID     = :DK-EXT-SHP-ID                04620001
046300           AND     PO_NBR         = :DK-PO-NBR                    04630001
046400           AND     PREPK_ID       = :DK-PREPK-ID                  04640001
046500           AND     RCVR_SEQ_NBR   = :DK-RCVR-SEQ-NBR              04650001
046600           AND     ACTV_CDE       = 'A'                           04660001
046700     END-EXEC.                                                    04670001
046800                                                                  04680001
046900**DECLARE THE DUMMY-CSR                                           04690001
047000     EXEC SQL                                                     04700001
047100          DECLARE DUMMY-CSR CURSOR FOR                            04710001
047200           SELECT  PO_NBR                                         04720001
047300                 , PO_LNE_NBR                                     04730001
047400                 , RCVR_SEQ_NBR                                   04740001
047500                 , PREPK_ID                                       04750001
047600                 , ASN_LVL_CDE                                    04760001
047700                 , DWNLD_CDE                                      04770001
047800                 , ACTV_CDE                                       04780001
047900           FROM    WST_SHPMT_XREF_DTL                             04790001
048000           WHERE   EXT_SHP_ID     = :DK-EXT-SHP-ID                04800001
048100           AND     DWNLD_CDE     <> 'D'                           04810001
048200     END-EXEC.                                                    04820001
048300                                                                  04830001
048400**DECLARE THE TRIP-INACT-CSR                                      04840001
048500     EXEC SQL                                                     04850001
048600          DECLARE TRIP-INACT-CSR CURSOR FOR                       04860001
048700           SELECT  DISTINCT                                       04870001
048800                   H.EXT_SHP_ID                                   04880001
048900                  ,H.DWNLD_TMST                                   04890001
049000           FROM    WST_SHPMT_XREF_HDR H                           04900001
049100                  ,WST_SHPMT_XREF_DTL D                           04910001
049200           WHERE   H.EXT_SHP_ID = D.EXT_SHP_ID                    04920001
049300           AND     H.INTR_TRIP_ID = :DK-TRIP-ID                   04930001
049400           AND     D.PO_NBR       = :DK-PO-NBR                    04940001
049500           AND     D.RCVR_SEQ_NBR = :DK-RCVR-SEQ-NBR              04950001
049600           AND     D.ACTV_CDE     = 'I'                           04960001
049700           AND     H.DWNLD_CDE   <> 'X'                           04970001
049800           AND NOT EXISTS                                         04980001
049900              (SELECT *                                           04990001
050000               FROM   WST_SHPMT_XREF_DTL A                        05000001
050100               WHERE  D.EXT_SHP_ID   = A.EXT_SHP_ID               05010001
050200               AND    A.ACTV_CDE     = 'A')                       05020001
050300           WITH UR                                                05030001
050400     END-EXEC.                                                    05040001
050500                                                                  05050001
050600**DECLARE THE TRIP-DWNLD-CSR                                      05060001
050700     EXEC SQL                                                     05070001
050800          DECLARE TRIP-DWNLD-CSR CURSOR FOR                       05080001
050900           SELECT  DISTINCT H.EXT_SHP_ID                          05090001
051000           FROM    WST_SHPMT_XREF_HDR H                           05100001
051100                  ,WST_SHPMT_XREF_DTL D                           05110001
051200           WHERE   H.EXT_SHP_ID = D.EXT_SHP_ID                    05120001
051300           AND     H.INTR_TRIP_ID = :DK-TRIP-ID                   05130001
051400           AND     D.PO_NBR       = :DK-PO-NBR                    05140001
051500           AND     D.RCVR_SEQ_NBR = :DK-RCVR-SEQ-NBR              05150001
051600           AND     D.ACTV_CDE     = 'A'                           05160001
051700           AND     H.DWNLD_TMST  <> :PC-DEFAULT-NINES             05170001
051800           WITH UR                                                05180001
051900     END-EXEC.                                                    05190001
052000                                                                  05200001
052100******************************************************************05210001
052200 LINKAGE SECTION.                                                 05220001
052300******************************************************************05230001
052400 01  DFHCOMMAREA.                                                 05240001
052500     05  FILLER                         OCCURS  1 TO 4072 TIMES   05250001
052600                                      DEPENDING ON EIBCALEN.      05260001
052700         10  FILLER                   PIC X.                      05270001
052800                                                                  05280001
052900******************************************************************05290001
053000 PROCEDURE DIVISION.                                              05300001
053100******************************************************************05310001
053200 0000-PROGRAM-MAINLINE.                                           05320001
053300                                                                  05330001
053400     MOVE EIBTASKN                 TO  PV-EIBTASKN.               05340001
053500     INITIALIZE                        WS001-FIELDS.              05350001
053600     MOVE DFHCOMMAREA              TO  WS001-FIELDS.              05360001
053700                                                                  05370001
053800     INITIALIZE PV-CICS-MSG-AREA.                                 05380001
053900     STRING   ' ' WS001-SRC-TASK-NUMBER                           05390001
054000              ' WSKCS305 CALLED FROM '                            05400001
054100              WS001-CALLING-PROGRAM-NAME                          05410001
054200              DELIMITED BY SIZE                                   05420001
054300                                 INTO PV-CICS-MSG-AREA.           05430001
054400     PERFORM 7000-WRITE-TO-CICS-LOG.                              05440001
054500                                                                  05450001
054600     PERFORM 0500-INITIALIZE.                                     05460001
054700     MOVE WS001-TRIP-ID               TO DK-TRIP-ID               05470001
054800                                         WS-TRIP-ID.              05480001
054900     MOVE WS001-PO-NBR                TO WS-PO-NBR                05490001
055000                                         DK-PO-NBR.               05500001
055100     MOVE WS001-RCVR-NBR              TO WS-RCVR-SEQ-NBR          05510001
055200                                         DK-RCVR-SEQ-NBR.         05520001
055300     MOVE WS001-PO-LNE-NBR            TO WS-PO-LNE-NBR            05530001
055400                                         DK-PO-LNE-NBR.           05540001
055500     MOVE WS001-PREPK-ID              TO WS-PREPK-ID              05550001
055600                                         DK-PREPK-ID.             05560001
055700     MOVE WS001-KOHLS-SHIPT-ID        TO WS-SHIPT-ID              05570001
055800                                         DK-SHIPT-ID.             05580001
055900     MOVE WS001-EXT-SHP-ID            TO DK-EXT-SHP-ID            05590001
056000                                         WS-EXT-SHP-ID.           05600001
056100     MOVE WS001-OPER-UNT-ID           TO WS-OPER-UNT-ID.          05610001
056200                                                                  05620001
056210*DMH - 12/13/2016 BEGIN                                           05621002
056220     SET  PS-CAPTURE-DOWNLOAD-NO      TO TRUE.                    05622002
056221     PERFORM 0530-CHECK-CAPTURE.                                  05622102
056222     IF  PS-CAPTURE-DOWNLOAD-YES                                  05622202
056226         perform 0540-wft-dat-cntl                                05622605
056227         perform 0550-wft-dat-xfer                                05622705
056238     END-IF.                                                      05623802
056239*DMH - 12/13/2016 END                                             05623902
056240                                                                  05624002
056300     IF PS-CICS-SWITCH-YES                                        05630001
056400         INITIALIZE PV-CICS-MSG-AREA                              05640001
056500         STRING   ' ' WS001-SRC-TASK-NUMBER                       05650001
056600                  ' WSKCS305-0000'                                05660001
056700                  ' FUNCTION IND='                                05670001
056800                  WS001-FUNCTION-IND                              05680001
056900                  DELIMITED BY SIZE                               05690001
057000                                 INTO PV-CICS-MSG-AREA            05700001
057100         PERFORM 7000-WRITE-TO-CICS-LOG                           05710001
057200     END-IF.                                                      05720001
057300                                                                  05730001
057400                                                                  05740001
057500* MAKE SURE THAT THE TRIP-ID IS SENT IN (IT SHOULD BE)            05750001
057600* IF NOT, THEN GET IT FROM THE SHIPT-ID                           05760001
057700* THE ONLY TRANSACTION WHERE WE DEFINATELY DO NOT HAVE A TRIP-ID  05770001
057800* IS THE CREATE-DUMMY TRANSACTIONS                                05780001
057900                                                                  05790001
058000     IF DK-TRIP-ID = 0                                            05800001
058100        PERFORM 2070-GET-TRIP-ID                                  05810001
058200     END-IF.                                                      05820001
058300                                                                  05830001
058400* MAKE SURE THAT THE TRIP IS NOT A DUMMY TRIP.  IF THE VEH-NBR    05840001
058500* IS LOADED ON THE TVHTRIP TABLE, THIS IS AN ACTUAL TRIP.         05850001
058600* RETURN TO CALLING PROGRAM FOR DUMMY TRIPS.                      05860001
058700                                                                  05870001
058800     PERFORM 2080-SELECT-TVHTRIP.                                 05880001
058900     IF PS-VALID-TRIP-NO                                          05890001
059000         SET WS001-SUCCESSFUL TO TRUE                             05900001
059100         PERFORM 9990-RETURN                                      05910001
059200     END-IF.                                                      05920001
059300                                                                  05930001
059400* CHECK FOR 'AP' TYPE RECEIVERS.  IF FOUND, RETURN TO CALLING     05940001
059500* PROGRAM                                                         05950001
059600                                                                  05960001
059700*DMH - CHANGED 4/1/08 - ONLY PERFORM 2090 IF PO NUMBER IS         05970001
059800*DMH -                - POPULATED.                                05980001
059900     IF  DK-PO-NBR  >  0                                          05990001
060000         PERFORM 2090-CHECK-RECEIVER-TYPE                         06000001
060100     END-IF.                                                      06010001
060200                                                                  06020001
060300     IF PS-AP-RECEIVER-FOUND-YES                                  06030001
060400         SET WS001-SUCCESSFUL TO TRUE                             06040001
060500         PERFORM 9990-RETURN                                      06050001
060600     END-IF                                                       06060001
060700                                                                  06070001
060800     EVALUATE TRUE                                                06080001
060900         WHEN WS001-INSERT                                        06090001
061000             PERFORM 1000-INSERT                                  06100001
061100         WHEN WS001-SHIPMT-DETACH                                 06110001
061200             PERFORM 2000-SHIPMT-DETACH                           06120001
061300         WHEN WS001-PKSLIP-INACTIVE                               06130001
061400             PERFORM 3000-PKSLIP-INACTIVE                         06140001
061500         WHEN WS001-MANUAL-DOWNLOAD                               06150001
061600             PERFORM 4000-MANUAL-DOWNLOAD                         06160001
061700         WHEN WS001-CREATE-DUMMY                                  06170001
061800             PERFORM 8000-CREATE-DUMMY                            06180001
061900         WHEN OTHER                                               06190001
062000             SET WS001-ERROR              TO TRUE                 06200001
062100             MOVE '0000-PROGRAM-MAINLINE' TO WS001-PARAGRAPH-NAME 06210001
062200                                             DP013-PARAGRAPH      06220001
062300             MOVE 'UNKNOWN FUNCTION IND'  TO WS001-CRA-RET-MSG    06230001
062400                                             DP013-MESSAGE-TEXT(1)06240001
062500             SET DP013-DB2-ABEND  TO TRUE                         06250001
062600             PERFORM 9999-ABEND                                   06260001
062700     END-EVALUATE.                                                06270001
062800                                                                  06280001
062900* IF A HEADER WAS CREATED, BUT NO DETAIL RECORDS WERE ADDED,      06290001
063000*   THEN SET THE CANCEL INDICATOR (XREF_HDR DWNLD_CDE WILL BE     06300001
063100*                                  SET TO 'X' IN WSKCS302)        06310001
063200*        TURN OFF THE CHECK ASN INDICATOR                         06320001
063300*        TURN ON THE IMMED DOWNLOAD INDICATOR                     06330001
063400                                                                  06340001
063500     IF PS-HEADER-CREATED-YES                                     06350001
063600        AND PS-DETAIL-CREATED-NO                                  06360001
063700*        MOVE WS-EXT-SHP-ID         TO DK-EXT-SHP-ID              06370001
063800*        PERFORM 2110-UPDATE-HDR-X                                06380001
063900         SET PS-CANCEL-SHPMT-YES    TO TRUE                       06390001
064000         SET PS-CHECK-ASN-NO        TO TRUE                       06400001
064100         SET PS-IMMED-DOWNLOAD-YES   TO TRUE                      06410001
064200     END-IF.                                                      06420001
064300                                                                  06430001
064400     IF PS-CHECK-ASN-YES                                          06440001
064500         SET PS-FIRST-DUMMY-REC-YES TO TRUE                       06450001
064600         PERFORM 5800-CHECK-ASN                                   06460001
064700     END-IF.                                                      06470001
064800                                                                  06480001
064900     IF PS-IMMED-DOWNLOAD-YES                                     06490001
065000**       IF A SECOND HEADER RECORD WAS CREATED TO SPLIT OUT       06500001
065100**       A SHIPMENT, THEN BOTH HAVE TO BE SENT TO WMS             06510001
065200         IF PS-ASN-NEW-HDR-YES                                    06520001
065300             MOVE WS-OLD-EXT-SHP-ID    TO WS-EXT-SHP-ID           06530001
065400             PERFORM 5700-CALL-DOWNLOAD-MOD                       06540001
065500             MOVE WS-NEW-EXT-SHP-ID    TO WS-EXT-SHP-ID           06550001
065600         END-IF                                                   06560001
065700         PERFORM 5700-CALL-DOWNLOAD-MOD                           06570001
065800     END-IF.                                                      06580001
065801                                                                  06580102
065810*DMH - 12/13/2016 BEGIN                                           06581002
065840     IF  PS-CAPTURE-DOWNLOAD-YES                                  06584002
065850         PERFORM 0550-WFT-DAT-xfer                                06585005
065860     END-IF.                                                      06586002
065870*DMH - 12/13/2016 END                                             06587002
065880                                                                  06588002
065900                                                                  06590001
066000     PERFORM 9990-RETURN.                                         06600001
066100                                                                  06610001
066200/                                                                 06620001
066300 0500-INITIALIZE.                                                 06630001
066400     MOVE '0500-INITIALIZE'      TO WS001-PARAGRAPH-NAME.         06640001
066500                                                                  06650001
066600     SET WS001-SUCCESSFUL        TO TRUE.                         06660001
066700     INITIALIZE DCLWST00001                                       06670001
066800                DCLWST00002                                       06680001
066900                DCLXLT00003                                       06690001
067000                DCLTVHTRIP                                        06700001
067100                DCLTSHIPMT                                        06710001
067200                DCLTSHPTPO                                        06720001
067300                DCLTRECEIV                                        06730001
067400                DCLTRECITM                                        06740001
067500                DCLTPURITM                                        06750001
067600                DCLTPKSLIP                                        06760001
067700                DCLTINPKSU                                        06770001
067800                DCLTSHUNLO.                                       06780001
067900     INITIALIZE PV-VARIABLES.                                     06790001
068000     INITIALIZE PS-SWITCHES.                                      06800001
068100     SET PS-CHECK-ASN-YES        TO TRUE.                         06810001
068200     SET PS-ASN-NEW-HDR-NO       TO TRUE.                         06820001
068300     SET PS-HEADER-EXIST-NO      TO TRUE.                         06830001
068400     SET PS-IMMED-DOWNLOAD-NO    TO TRUE.                         06840001
068500     SET PS-HEADER-CREATED-NO    TO TRUE.                         06850001
068600     SET PS-DETAIL-CREATED-NO    TO TRUE.                         06860001
068700     SET PS-CANCEL-SHPMT-NO      TO TRUE.                         06870001
068800     SET PS-CANCEL-SHPMT-NO      TO TRUE.                         06880001
068900                                                                  06890001
069000     PERFORM 0510-GET-CURRENT-TIMESTAMP.                          06900001
069100     PERFORM 0520-CICS-LOGGING.                                   06910001
069200                                                                  06920001
069300/                                                                 06930001
069400 0510-GET-CURRENT-TIMESTAMP.                                      06940001
069500                                                                  06950001
069600     MOVE '0510-GET-CURRENT-TIMESTAMP'                            06960001
069700                                 TO WS001-PARAGRAPH-NAME.         06970001
069800                                                                  06980001
069900     EXEC SQL                                                     06990001
070000         SET :PV-CURRENT-TIMESTAMP = CURRENT TIMESTAMP            07000001
070100     END-EXEC.                                                    07010001
070200                                                                  07020001
070300/                                                                 07030001
070400 0520-CICS-LOGGING.                                               07040001
070500                                                                  07050001
070600     MOVE '0520-CICS-LOGGING'    TO WS001-PARAGRAPH-NAME.         07060001
070700                                                                  07070001
070800* READ PARM TO DETERMINE CICS LOGGING                             07080001
070900     EXEC SQL                                                     07090001
071000         SELECT  D.ATTR_ELEM_TXT                                  07100001
071100         INTO  :PS-CICS-SWITCH-IND                                07110001
071200         FROM   WST_INTGRTN_TYP A                                 07120001
071300              , WST_ATTR_DEFN   B                                 07130001
071400              , WST_ATTR_ELEM   C                                 07140001
071500              , WST_ATTR_ELEM   D                                 07150001
071600         WHERE  A.INTGRTN_TYP_CDE   = 'CSSLLOG'                   07160001
071700           AND  A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE           07170001
071800           AND  B.ATTR_DEFN_SEQ_NBR = 1                           07180001
071900           AND  B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE           07190001
072000           AND  C.ATTR_DEFN_SEQ_NBR = 1                           07200001
072100           AND  B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE           07210001
072200           AND  D.ATTR_DEFN_SEQ_NBR = 2                           07220001
072300           AND  C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR         07230001
072400           AND  C.ATTR_ELEM_TXT     = 'WSKCS305'                  07240001
072500     END-EXEC.                                                    07250001
072600                                                                  07260001
072700     EVALUATE TRUE                                                07270001
072800         WHEN SQLCODE = ZERO                                      07280001
072900             IF PS-CICS-SWITCH-YES                                07290001
073000                 INITIALIZE PV-CICS-MSG-AREA                      07300001
073100                 STRING   ' ' WS001-SRC-TASK-NUMBER               07310001
073200                          ' WSKCS305-0520:'                       07320001
073300                          ' CICS LOGGING: '                       07330001
073400                          PS-CICS-SWITCH-IND                      07340001
073500                          DELIMITED BY SIZE                       07350001
073600                          INTO PV-CICS-MSG-AREA                   07360001
073700                 PERFORM 7000-WRITE-TO-CICS-LOG                   07370001
073800             END-IF                                               07380001
073900         WHEN SQLCODE = -904                                      07390001
074000         WHEN SQLCODE = -913                                      07400001
074100         WHEN SQLCODE = -911                                      07410001
074200         WHEN SQLCODE = -803                                      07420001
074300             CONTINUE                                             07430001
074400         WHEN SQLWARN0 NOT = SPACES                               07440001
074500         WHEN SQLCODE NOT = ZERO                                  07450001
074600             INITIALIZE PV-CICS-MSG-AREA                          07460001
074700             MOVE SQLCODE               TO PV-SQL-RETURN-CD       07470001
074800             STRING   ' ' WS001-SRC-TASK-NUMBER                   07480001
074900                      ' WSKCS305-0520 ERROR:'                     07490001
075000                      ' SQL='                                     07500001
075100                      PV-SQL-RETURN-CD                            07510001
075200                      DELIMITED BY SIZE                           07520001
075300                                      INTO PV-CICS-MSG-AREA       07530001
075400             PERFORM 7000-WRITE-TO-CICS-LOG                       07540001
075500                                                                  07550001
075600             SET WS001-INVALID-SQL      TO TRUE                   07560001
075700             STRING 'SQL='                                        07570001
075800                  PV-SQL-RETURN-CD                                07580001
075900                  DELIMITED BY SIZE                               07590001
076000                                      INTO WS001-CRA-RET-MSG      07600001
076100             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  07610001
076200             MOVE SQLCA                 TO WS001-SQLCA            07620001
076300                                           DP013-SQLCA            07630001
076400             MOVE '0520-CICS-LOGGING'   TO DP013-PARAGRAPH        07640001
076500             MOVE 'WST_INTGRTN_TYP'     TO                        07650001
076600                                       DP013-DB2-TABLE-NAME (1)   07660001
076700             MOVE 'WST_ATTR_DEFN'       TO                        07670001
076800                                       DP013-DB2-TABLE-NAME (2)   07680001
076900             MOVE 'WST_ATTR_ELEM'       TO                        07690001
077000                                       DP013-DB2-TABLE-NAME (3)   07700001
077100             SET DP013-DB2-ABEND        TO TRUE                   07710001
077200             PERFORM 9999-ABEND                                   07720001
077300                                                                  07730001
077400     END-EVALUATE.                                                07740001
077500                                                                  07750001
077501*-----------------------------------------------------------------07750102
077502* CHECK TO SEE IF CAPTURE OF DOWNLOAD IS TO BE TRACKED            07750202
077503* DMH - 12/13/2016                                                07750302
077504*-----------------------------------------------------------------07750402
077510 0530-CHECK-CAPTURE.                                              07751002
077512                                                                  07751202
077520     SET  PS-CAPTURE-DOWNLOAD-NO  TO  TRUE.                       07752002
077521     MOVE WS001-OPER-UNT-ID       TO  KRPRPM-LOC-ID               07752102
077522                                                                  07752202
077523     EXEC SQL                                                     07752302
077524         SELECT FUNC_TXT                                          07752402
077528         INTO  :PS-CAPTURE-DOWNLOAD-SW                            07752802
077532         FROM  TKRPRPM                                            07753203
077533        WHERE  LOC_ID             = :KRPRPM-LOC-ID                07753302
077534          AND  INTFC_SYS_CDE      = 'KHL'                         07753402
077535          AND  SYS_PRC_FUNC_CDE   = 'WMCAPT'                      07753502
077536          AND  FUNC_PRC_STAT_CDE  = 'AC'                          07753602
077537          AND  FUNC_BEG_TMST     <=  CURRENT TIMESTAMP            07753702
077538          AND  FUNC_END_TMST     >=  CURRENT TIMESTAMP            07753802
077540     END-EXEC.                                                    07754002
077541                                                                  07754102
077543     EVALUATE TRUE                                                07754302
077544         WHEN SQLCODE = ZERO                                      07754402
077546              CONTINUE                                            07754602
077566         WHEN SQLCODE = +100                                      07756602
077574             SET PS-CAPTURE-DOWNLOAD-NO  TO  TRUE                 07757402
077575                                                                  07757502
077592         WHEN SQLCODE = -904                                      07759202
077593         WHEN SQLCODE = -913                                      07759302
077594         WHEN SQLCODE = -911                                      07759402
077595             CONTINUE                                             07759502
077596         WHEN SQLWARN0 NOT = SPACES                               07759602
077597         WHEN SQLCODE NOT = ZERO                                  07759702
077598             INITIALIZE PV-CICS-MSG-AREA                          07759802
077599             MOVE SQLCODE               TO PV-SQL-RETURN-CD       07759902
077600             STRING   ' ' WS001-SRC-TASK-NUMBER                   07760002
077601                      ' WSKCS305-0530 ERROR:'                     07760103
077602                      ' SQL='                                     07760202
077603                      PV-SQL-RETURN-CD                            07760302
077604                      DELIMITED BY SIZE                           07760402
077605                                      INTO PV-CICS-MSG-AREA       07760502
077606             PERFORM 7000-WRITE-TO-CICS-LOG                       07760602
077607                                                                  07760702
077608             SET WS001-INVALID-SQL      TO TRUE                   07760802
077609             STRING 'SQL='                                        07760902
077610                  PV-SQL-RETURN-CD                                07761002
077611                  DELIMITED BY SIZE                               07761102
077612                                      INTO WS001-CRA-RET-MSG      07761202
077613             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  07761302
077614             MOVE SQLCA                 TO WS001-SQLCA            07761402
077615                                           DP013-SQLCA            07761502
077616             MOVE '0530-CHECK '         TO DP013-PARAGRAPH        07761603
077617             MOVE 'TKRPRPM           '  TO                        07761702
077618                                       DP013-DB2-TABLE-NAME (1)   07761802
077619             SET DP013-DB2-ABEND        TO TRUE                   07761902
077620             PERFORM 9999-ABEND                                   07762002
077621     END-EVALUATE.                                                07762102
077622                                                                  07762202
077623                                                                  07762302
077624*-----------------------------------------------------------------07762402
077625* IF CAPTURE OF DOWNLOAD TO WMOS IS TO BE TRACKED THIS PARAGRAPH  07762502
077626* WILL INSERT A ROW INTO THE wft_dat_cntl  (header) for the data  07762605
077627* capture                                                         07762705
077628* DMH - 12/13/2016                                                07762802
077629*-----------------------------------------------------------------07762902
077630 0540-WFT-DAT-CNTL.                                               07763005
077632                                                                  07763205
077633     CALL PC-RANDOM-PGM USING DFHEIBLK                            07763305
077634                              DFHCOMMAREA                         07763405
077635                              DP902-RANDNBR-ROUTINE-FIELDS.       07763505
077636                                                                  07763605
077637     move DP902-RANDOM-NUMBER     to PV-CAPTURE-RANDOM-NBR        07763705
077638                                                                  07763805
077639     EXEC SQL                                                     07763905
077640          SET :PV-RANDOM-TMST = CURRENT TIMESTAMP                 07764005
077641     END-EXEC.                                                    07764105
077642                                                                  07764205
077643     MOVE 'WMOSDWLD'               TO WFT00004-TRN-TYP-CDE        07764305
077644     MOVE PV-CAPTURE-RANDOM-NBR    TO WFT00004-PRC-GP-ID          07764405
077645     MOVE PV-RANDOM-TMST           TO WFT00004-PRC-CNTL-TMST      07764505
077646     MOVE 0                        TO WFT00004-STR-NBR            07764605
077647     MOVE 'READY'                  TO WFT00004-STAT-CDE           07764705
077648     MOVE PV-RANDOM-TMST           TO WFT00004-BEG-PRC-TMST       07764805
077649     MOVE PC-DEFAULT-TMST          TO WFT00004-END-PRC-TMST       07764905
077650     MOVE 0                        TO WFT00004-DAT-LOD-VER-NBR    07765005
077651                                                                  07765105
077652     EXEC SQL                                                     07765205
077653        INSERT INTO WFT_DAT_CNTL                                  07765305
077654               ( TRN_TYP_CDE                                      07765405
077655                ,PRC_GP_ID                                        07765505
077656                ,PRC_CNTL_TMST                                    07765605
077657                ,STR_NBR                                          07765705
077658                ,STAT_CDE                                         07765805
077659                ,BEG_PRC_TMST                                     07765905
077660                ,END_PRC_TMST                                     07766005
077661                ,DAT_LOD_VER_NBR)                                 07766105
077662        VALUES (:WFT00004-TRN-TYP-CDE                             07766205
077663              , :WFT00004-PRC-GP-ID                               07766305
077664              , :WFT00004-PRC-CNTL-TMST                           07766405
077665              , :WFT00004-STR-NBR                                 07766505
077666              , :WFT00004-STAT-CDE                                07766605
077667              , :WFT00004-BEG-PRC-TMST                            07766705
077668              , :WFT00004-END-PRC-TMST                            07766805
077669              , :WFT00004-DAT-LOD-VER-NBR)                        07766905
077670     END-EXEC.                                                    07767005
077671                                                                  07767105
077672         EVALUATE TRUE                                            07767205
077673             WHEN SQLCODE = ZERO                                  07767305
077674                 CONTINUE                                         07767405
077675             WHEN SQLWARN0 NOT = SPACES                           07767505
077676             WHEN SQLCODE < ZERO                                  07767605
077677             WHEN SQLCODE > ZERO                                  07767705
077678                                                                  07767805
077679             MOVE '0540-WFT-DAT-CNTL  '      TO DP013-PARAGRAPH   07767905
077680             MOVE 'WRITE HEADER TO WFT_DAT_CNTL'                  07768005
077681                                      TO DP013-MESSAGE-TEXT (1)   07768105
077682             MOVE SQLCA        TO DP013-SQLCA                     07768205
077683             MOVE 'WFT_DAT_CNTL      '  TO                        07768305
077684                                  DP013-DB2-TABLE-NAME (1)        07768405
077685             SET DP013-DB2-ABEND        to true                   07768505
077686                                                                  07768605
077687         END-EVALUATE.                                            07768705
077688                                                                  07768805
077689                                                                  07768905
077690 0550-WFT-DAT-xfer.                                               07769005
077692                                                                  07769202
077693                                                                  07769302
077694     ADD 1  TO  PV-CAPTURE-CNT.                                   07769405
077695                                                                  07769505
077696     INITIALIZE WS025-UPLOAD-ERROR-RECORD.                        07769605
077697     MOVE WS001-FUNCTION-IND        TO  WS025-FUNCTION-IND.       07769705
077698     MOVE WS001-TRIP-ID             TO  WS025-TRIP-ID.            07769805
077699     MOVE WS001-KOHLS-SHIPT-ID      TO  WS025-KOHLS-SHIPT-ID.     07769905
077700     MOVE WS001-OPER-UNT-ID         TO  WS025-OPER-UNT-ID.        07770005
077701     MOVE WS001-SHIPMENT-SOURCE     TO  WS025-SHIPMENT-SOURCE.    07770105
077702     MOVE WS001-USER-ID             TO  WS025-USER-ID.            07770205
077703     MOVE WS001-COC-UPD-TIMESTAMP   TO  WS025-COC-UPD-TIMESTAMP.  07770305
077704     MOVE WS001-BEGIN-RCV-IND       TO  WS025-BEGIN-RCV-IND.      07770405
077705     MOVE WS001-PO-NBR              TO  WS025-PO-NBR.             07770505
077706     MOVE WS001-RCVR-NBR            TO  WS025-RCVR-NBR.           07770605
077707     MOVE WS001-PO-LNE-NBR          TO  WS025-PO-LNE-NBR.         07770705
077708     MOVE WS001-PREPK-ID            TO  WS025-PREPK-ID.           07770805
077709     MOVE WS001-SKU-NBR             TO  WS025-SKU-NBR.            07770905
077710     MOVE WS001-DTL-ASN-LEVEL-IND   TO  WS025-DTL-ASN-LEVEL-IND.  07771005
077711     MOVE WS001-CALLING-PROGRAM-NAME                              07771105
077712                                  TO WS025-CALLING-PROGRAM-NAME.  07771205
077713     MOVE WS001-SUCCESS-IND         TO  WS025-SUCCESS-IND.        07771305
077714     MOVE WS001-PARAGRAPH-NAME      TO  WS025-PARAGRAPH-NAME.     07771405
077715     MOVE WS001-CRA-RET-MSG         TO  WS025-CRA-RET-MSG.        07771505
077716     MOVE WS001-EXT-SHP-ID          TO  WS025-EXT-SHP-ID.         07771605
077717                                                                  07771705
077817     MOVE 'WMOSDWLD'               TO WFT00005-TRN-TYP-CDE        07781707
077818     MOVE PV-CAPTURE-RANDOM-NBR    TO WFT00005-PRC-GP-ID          07781807
077819     MOVE PV-RANDOM-TMST           TO WFT00005-PRC-CNTL-TMST      07781905
077820     MOVE PV-CAPTURE-CNT           TO WFT00005-PRC-LOD-SEQ-ID     07782005
077821     MOVE 'WSWS025'                TO WFT00005-RDM-PRC-TYP-CDE    07782109
077822     MOVE LENGTH OF WS025-UPLOAD-ERROR-RECORD                     07782205
077823                                   TO WFT00005-LOD-DAT-TXT-LEN    07782305
077824     MOVE WS025-UPLOAD-ERROR-RECORD                               07782405
077825                                   TO WFT00005-LOD-DAT-TXT-TEXT   07782505
077826                                                                  07782605
077827     EXEC SQL                                                     07782705
077828        INSERT INTO WFT_dat_XFER                                  07782805
077829               ( TRN_TYP_CDE                                      07782905
077830                ,PRC_GP_ID                                        07783005
077831                ,PRC_CNTL_TMST                                    07783105
077832                ,PRC_LOD_SEQ_ID                                   07783205
077833                ,RDM_PRC_TYP_CDE                                  07783305
077834                ,LOD_DAT_TXT)                                     07783405
077835        VALUES (:WFT00005-TRN-TYP-CDE                             07783505
077836               ,:WFT00005-PRC-GP-ID                               07783605
077837               ,:WFT00005-PRC-CNTL-TMST                           07783705
077838               ,:WFT00005-PRC-LOD-SEQ-ID                          07783805
077839               ,:WFT00005-RDM-PRC-TYP-CDE                         07783905
077840               ,:WFT00005-LOD-DAT-TXT)                            07784005
077841     END-EXEC.                                                    07784105
077842                                                                  07784205
077843         EVALUATE TRUE                                            07784305
077844             WHEN SQLCODE = ZERO                                  07784405
077845                 CONTINUE                                         07784505
077846             WHEN SQLWARN0 NOT = SPACES                           07784605
077847             WHEN SQLCODE < ZERO                                  07784705
077848             WHEN SQLCODE > ZERO                                  07784805
077849                                                                  07784905
077850             MOVE '0550-WFT-DAT-xfer  '      TO DP013-PARAGRAPH   07785005
077851             MOVE 'WRITE detail TO WFT_DAT_xfer'                  07785105
077852                                      TO DP013-MESSAGE-TEXT (1)   07785205
077853             MOVE SQLCA        TO DP013-SQLCA                     07785305
077854             MOVE 'WFT_DAT_xfer      '  TO                        07785405
077855                                  DP013-DB2-TABLE-NAME (1)        07785505
077856             SET DP013-DB2-ABEND        to true                   07785605
077857                                                                  07785705
077858         END-EVALUATE.                                            07785805
077859                                                                  07785905
077860                                                                  07786005
077863                                                                  07786308
077864 0560-WFT-DAT-xfer.                                               07786408
077865                                                                  07786508
077866                                                                  07786608
077867     ADD 1  TO  PV-CAPTURE-CNT.                                   07786708
077868                                                                  07786808
077995     MOVE WS001-PARAGRAPH-NAME      TO  WS025-PARAGRAPH-NAME.     07799508
077997     MOVE WS001-EXT-SHP-ID          TO  WS025-EXT-SHP-ID.         07799708
077998                                                                  07799808
077999     MOVE 'WMOSDWLD'               TO WFT00005-TRN-TYP-CDE        07799908
078000     MOVE PV-CAPTURE-RANDOM-NBR    TO WFT00005-PRC-GP-ID          07800008
078001     MOVE PV-RANDOM-TMST           TO WFT00005-PRC-CNTL-TMST      07800108
078002     MOVE PV-CAPTURE-CNT           TO WFT00005-PRC-LOD-SEQ-ID     07800208
078003     MOVE 'WSWS025'                TO WFT00005-RDM-PRC-TYP-CDE    07800310
078004     MOVE LENGTH OF WS025-UPLOAD-ERROR-RECORD                     07800408
078005                                   TO WFT00005-LOD-DAT-TXT-LEN    07800508
078006     MOVE WS025-UPLOAD-ERROR-RECORD                               07800608
078007                                   TO WFT00005-LOD-DAT-TXT-TEXT   07800708
078008                                                                  07800808
078009     EXEC SQL                                                     07800908
078010        INSERT INTO WFT_dat_XFER                                  07801008
078011               ( TRN_TYP_CDE                                      07801108
078012                ,PRC_GP_ID                                        07801208
078013                ,PRC_CNTL_TMST                                    07801308
078014                ,PRC_LOD_SEQ_ID                                   07801408
078015                ,RDM_PRC_TYP_CDE                                  07801508
078016                ,LOD_DAT_TXT)                                     07801608
078017        VALUES (:WFT00005-TRN-TYP-CDE                             07801708
078018               ,:WFT00005-PRC-GP-ID                               07801808
078019               ,:WFT00005-PRC-CNTL-TMST                           07801908
078020               ,:WFT00005-PRC-LOD-SEQ-ID                          07802008
078021               ,:WFT00005-RDM-PRC-TYP-CDE                         07802108
078022               ,:WFT00005-LOD-DAT-TXT)                            07802208
078023     END-EXEC.                                                    07802308
078024                                                                  07802408
078025         EVALUATE TRUE                                            07802508
078026             WHEN SQLCODE = ZERO                                  07802608
078027                 CONTINUE                                         07802708
078028             WHEN SQLWARN0 NOT = SPACES                           07802808
078029             WHEN SQLCODE < ZERO                                  07802908
078030             WHEN SQLCODE > ZERO                                  07803008
078031                                                                  07803108
078032             MOVE '0560-WFT-DAT-xfer  '      TO DP013-PARAGRAPH   07803208
078033             MOVE 'WRITE detail TO WFT_DAT_xfer'                  07803308
078034                                      TO DP013-MESSAGE-TEXT (1)   07803408
078035             MOVE SQLCA        TO DP013-SQLCA                     07803508
078036             MOVE 'WFT_DAT_xfer      '  TO                        07803608
078037                                  DP013-DB2-TABLE-NAME (1)        07803708
078038             SET DP013-DB2-ABEND        to true                   07803808
078039                                                                  07803908
078040         END-EVALUATE.                                            07804008
078041                                                                  07804108
078042                                                                  07804208
078043                                                                  07804308
078044/                                                                 07804405
078045 1000-INSERT.                                                     07804505
078046                                                                  07804605
078047     MOVE '1000-INSERT'          TO WS001-PARAGRAPH-NAME.         07804705
078050                                                                  07805001
078100* CHECK TO SEE IF THE TRIP-ID EXISTS ON THE HEADER                07810001
078200                                                                  07820001
078300     EXEC SQL                                                     07830001
078400         SELECT EXT_SHP_ID                                        07840001
078500            ,   DWNLD_TMST                                        07850001
078600            ,   DWNLD_CDE                                         07860001
078700            ,   RCPT_TMST                                         07870001
078800         INTO  :WST00001-EXT-SHP-ID                               07880001
078900            ,  :WST00001-DWNLD-TMST                               07890001
079000            ,  :WST00001-DWNLD-CDE                                07900001
079100            ,  :WST00001-RCPT-TMST                                07910001
079200         FROM  WST_SHPMT_XREF_HDR                                 07920001
079300        WHERE  INTR_TRIP_ID   = :DK-TRIP-ID                       07930001
079400          AND  SOR_CDE = 'RC'                                     07940001
079500     END-EXEC.                                                    07950001
079600                                                                  07960001
079700* JAK 09/2007 - SET SWITCH TO INDICATE HOW MANY HDR RECS EXIST    07970001
079800     EVALUATE TRUE                                                07980001
079900         WHEN SQLCODE = ZERO                                      07990001
080000* 1 RECORD ON TABLE                                               08000001
080100             MOVE WST00001-EXT-SHP-ID TO WS-EXT-SHP-ID            08010001
080200                                         DK-EXT-SHP-ID            08020001
080300             MOVE WST00001-DWNLD-TMST TO WS-DWNLD-TMST            08030001
080400             MOVE WST00001-RCPT-TMST  TO WS-RCPT-TMST             08040001
080500             MOVE WST00001-DWNLD-CDE  TO WS-DWNLD-CDE             08050001
080600             SET PS-SINGLE-HEADER     TO TRUE                     08060001
080700             IF PS-CICS-SWITCH-YES                                08070001
080800                 INITIALIZE PV-CICS-MSG-AREA                      08080001
080900                 MOVE DK-TRIP-ID TO WS-DISPLAY-1                  08090001
081000                 STRING   ' ' WS001-SRC-TASK-NUMBER               08100001
081100                          ' WSKCS305-1000:'                       08110001
081200                          ' SHPMT: '                              08120001
081300                          WS-EXT-SHP-ID                           08130001
081400                          ' TRIP: ' WS-DISPLAY-1                  08140001
081500                          DELIMITED BY SIZE                       08150001
081600                          INTO PV-CICS-MSG-AREA                   08160001
081700                 PERFORM 7000-WRITE-TO-CICS-LOG                   08170001
081800             END-IF                                               08180001
081900             SET PS-HEADER-EXIST-YES    TO TRUE                   08190001
082000             PERFORM 5200-EVAL-SHIP-STATUS                        08200001
082100         WHEN SQLCODE = +100                                      08210001
082200* NO RECORDS ON TABLE                                             08220001
082300*    CREATE THE RECORDS NOW                                       08230001
082400             MOVE WS-TRIP-ID           TO WST00001-INTR-TRIP-ID   08240001
082500             MOVE 0                    TO WST00001-DMY-SEQ-NBR    08250001
082600             MOVE 'N'                  TO WS-DWNLD-CDE            08260001
082700             SET PS-DUMMY-HEADER-NO    TO TRUE                    08270001
082710*                                                                 08271009
082720* dmh 12/13/2016 - begin                                          08272009
082730              if  PS-CAPTURE-DOWNLOAD-YES                         08273009
082740                MOVE '1000-insert      '  tO WS025-PARAGRAPH-NAME 08274009
082750                MOVE 'NO RECORDS ON TABLE' TO WS025-INFORMATION   08275009
082760                perform 0560-WFT-DAT-xfer                         08276009
082770              end-if                                              08277009
082780* dmh 12/13/2016 - end                                            08278009
082790*                                                                 08279009
082800             PERFORM 5000-INSERT-HEADER                           08280001
082900             SET PS-SINGLE-HEADER     TO TRUE                     08290001
083000                                                                  08300001
083100             PERFORM 5100-INSERT-DETAIL                           08310001
083200* JAK 09/2007 - LOAD WS-DWNLD-TMST - WILL BE PC-DEFAULT-NINES     08320001
083300             MOVE WST00001-DWNLD-TMST TO WS-DWNLD-TMST            08330001
083400         WHEN SQLCODE = -811                                      08340001
083500* MULTIPLE RECORDS ON TABLE                                       08350001
083600*    THERE IS ALREADY A DUMMY RECORD                              08360001
083700             MOVE WST00001-EXT-SHP-ID   TO WS-EXT-SHP-ID          08370001
083800             MOVE WST00001-DWNLD-TMST   TO WS-DWNLD-TMST          08380001
083900             SET PS-HEADER-EXIST-YES    TO TRUE                   08390001
084000             SET PS-DUMMY-HEADER-YES    TO TRUE                   08400001
084100             MOVE 'N'                   TO WS-DWNLD-CDE           08410001
084101*                                                                 08410108
084110* dmh 12/13/2016 - begin                                          08411008
084111              if  PS-CAPTURE-DOWNLOAD-YES                         08411108
084112                MOVE '1000-INSERT      '   tO WS025-PARAGRAPH-NAME08411208
084113                MOVE 'WHEN SQLCODE = -811' TO WS025-information   08411308
084114                perform 0560-WFT-DAT-xfer                         08411408
084115              end-if                                              08411508
084116* dmh 12/13/2016 - end                                            08411608
084120*                                                                 08412008
084200             PERFORM 5000-INSERT-HEADER                           08420001
084300             SET PS-MULTIPLE-HEADER   TO TRUE                     08430001
084400                                                                  08440001
084500             PERFORM 5100-INSERT-DETAIL                           08450001
084600             SET PS-IMMED-DOWNLOAD-YES  TO TRUE                   08460001
084700         WHEN SQLCODE = -904                                      08470001
084800         WHEN SQLCODE = -913                                      08480001
084900         WHEN SQLCODE = -911                                      08490001
085000             CONTINUE                                             08500001
085100         WHEN SQLWARN0 NOT = SPACES                               08510001
085200         WHEN SQLCODE NOT = ZERO                                  08520001
085300             INITIALIZE PV-CICS-MSG-AREA                          08530001
085400             MOVE SQLCODE               TO PV-SQL-RETURN-CD       08540001
085500             STRING   ' ' WS001-SRC-TASK-NUMBER                   08550001
085600                      ' WSKCS305-1010 ERROR:'                     08560001
085700                      ' SQL='                                     08570001
085800                      PV-SQL-RETURN-CD                            08580001
085900                      DELIMITED BY SIZE                           08590001
086000                                      INTO PV-CICS-MSG-AREA       08600001
086100             PERFORM 7000-WRITE-TO-CICS-LOG                       08610001
086200                                                                  08620001
086300             SET WS001-INVALID-SQL      TO TRUE                   08630001
086400             STRING 'SQL='                                        08640001
086500                  PV-SQL-RETURN-CD                                08650001
086600                  DELIMITED BY SIZE                               08660001
086700                                      INTO WS001-CRA-RET-MSG      08670001
086800             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  08680001
086900             MOVE SQLCA                 TO WS001-SQLCA            08690001
087000                                           DP013-SQLCA            08700001
087100             MOVE '1000-INSERT'         TO DP013-PARAGRAPH        08710001
087200             MOVE 'WST_SHPMT_XREF_HDR'  TO                        08720001
087300                                       DP013-DB2-TABLE-NAME (1)   08730001
087400             SET DP013-DB2-ABEND        TO TRUE                   08740001
087500             PERFORM 9999-ABEND                                   08750001
087600     END-EVALUATE.                                                08760001
087700                                                                  08770001
087800* JAK 09/2007 - IF THERE IS ONLY 1 HEADER RECORD, AND THERE       08780001
087900*               ARE NO DETAIL RECORDS OR ALL DETAIL RECORDS ARE   08790001
088000*               INACTIVE, THEN CHECK TO SEE IF IT HAS BEEN        08800001
088100*               DOWNLOADED OR NOT.  IF IS HAS NOT BEEN DOWNLOADED 08810001
088200*               CHG XREF HDR TO 'X' AND RESET THE SWITCHES,       08820001
088300*               SO NO FURTHER PROCESSING IS DONE                  08830001
088400*               IF IS HAS BEEN DOWNLOADED, SET THE SWITCHES SO    08840001
088500*               THAT IT GETS DOWNLOADED AS A CANCEL TRANSACTION   08850001
088600     IF PS-SINGLE-HEADER                                          08860001
088700         MOVE WS-EXT-SHP-ID TO DK-EXT-SHP-ID                      08870001
088800         PERFORM 2100-CHECK-FOR-INACTIVE                          08880001
088900         IF PS-CANCEL-SHPMT-YES                                   08890001
089000             IF WS-DWNLD-TMST = PC-DEFAULT-NINES                  08900001
089100                 MOVE WS-EXT-SHP-ID         TO DK-EXT-SHP-ID      08910001
089200                 PERFORM 2110-UPDATE-HDR-X                        08920001
089300                 SET PS-CANCEL-SHPMT-NO     TO TRUE               08930001
089400                 SET PS-CHECK-ASN-NO        TO TRUE               08940001
089500                 SET PS-IMMED-DOWNLOAD-NO    TO TRUE              08950001
089600                 SET PS-HEADER-CREATED-NO    TO TRUE              08960001
089700             ELSE                                                 08970001
089800                 SET PS-CHECK-ASN-NO        TO TRUE               08980001
089900                 SET PS-IMMED-DOWNLOAD-YES   TO TRUE              08990001
090000                 SET PS-HEADER-CREATED-NO    TO TRUE              09000001
090100         END-IF                                                   09010001
090200     END-IF.                                                      09020001
090300                                                                  09030001
090400/                                                                 09040001
090500 2000-SHIPMT-DETACH.                                              09050001
090600                                                                  09060001
090700     MOVE '2000-SHIPMT-DETACH'   TO WS001-PARAGRAPH-NAME.         09070001
090800                                                                  09080001
090900* FIND ALL OF THE PO/RCVRS THAT ARE ATTACHED TO THE SHIPMENT      09090001
091000     PERFORM 2010-OPEN-SHIP-TO-CSR.                               09100001
091100     PERFORM 2020-FETCH-SHIP-TO-CSR UNTIL                         09110001
091200             PS-EOF-SHIP-TO-CSR-YES.                              09120001
091300     PERFORM 2030-CLOSE-SHIP-TO-CSR.                              09130001
091400                                                                  09140001
091500     IF PS-XREF-HDR-EXIST-YES                                     09150001
091600         PERFORM 2100-CHECK-FOR-INACTIVE                          09160001
091700                                                                  09170001
091800*  IF IT HAS BEEN DOWNLOADED PREVIOUSLY, THEN SET THE SWITCH      09180001
091900*  TO INDICATE THAT IT SHOULD BE DOWNLOADED AGAIN                 09190001
092000*                                                                 09200001
092100*  IF IT HASN'T BEEN DOWNLOADED PREVIOUSLY, BUT IS A CANCEL       09210001
092200*  TRANSACTION, THEN UPDATE THE XREF_HDR DWNLD_CDE TO 'X'         09220001
092300*                                                                 09230001
092400         IF WS-DWNLD-TMST NOT = PC-DEFAULT-NINES                  09240001
092500             SET PS-APPT-SENT-NO          TO TRUE                 09250001
092600             SET PS-IMMED-DOWNLOAD-YES    TO TRUE                 09260001
092700* JAK 08/2007 - ADDED ELSE STMT                                   09270001
092800         ELSE                                                     09280001
092900             IF PS-CANCEL-SHPMT-YES                               09290001
093000                 PERFORM 2110-UPDATE-HDR-X                        09300001
093100             END-IF                                               09310001
093200         END-IF                                                   09320001
093300     END-IF.                                                      09330001
093400                                                                  09340001
093500/                                                                 09350001
093600 2010-OPEN-SHIP-TO-CSR.                                           09360001
093700                                                                  09370001
093800     MOVE '2010-OPEN-SHIP-TO-CSR'                                 09380001
093900                                 TO WS001-PARAGRAPH-NAME.         09390001
094000                                                                  09400001
094100     SET PS-FIRST-RECORD-YES          TO TRUE.                    09410001
094200     SET PS-EOF-SHIP-TO-CSR-NO        TO TRUE.                    09420001
094300* JAK 08/2007 - INITIALIZE THE XREF HDR SWITCH                    09430001
094400     SET PS-XREF-HDR-EXIST-NO         TO TRUE.                    09440001
094500                                                                  09450001
094600     EXEC SQL                                                     09460001
094700          OPEN SHIP-TO-CSR                                        09470001
094800     END-EXEC.                                                    09480001
094900                                                                  09490001
095000     EVALUATE TRUE                                                09500001
095100         WHEN SQLCODE = ZERO                                      09510001
095200             IF PS-CICS-SWITCH-YES                                09520001
095300                 INITIALIZE PV-CICS-MSG-AREA                      09530001
095400                 MOVE DK-SHIPT-ID TO WS-DISPLAY-1                 09540001
095500                 STRING   ' ' WS001-SRC-TASK-NUMBER               09550001
095600                          ' WSKCS305-2010:'                       09560001
095700                          ' OPENED SHIP-TO-CSR'                   09570001
095800                          ' FOR SHIPT-ID=' WS-DISPLAY-1           09580001
095900                          DELIMITED BY SIZE                       09590001
096000                          INTO PV-CICS-MSG-AREA                   09600001
096100                 PERFORM 7000-WRITE-TO-CICS-LOG                   09610001
096200             END-IF                                               09620001
096300         WHEN SQLCODE = -904                                      09630001
096400         WHEN SQLCODE = -913                                      09640001
096500         WHEN SQLCODE = -911                                      09650001
096600              CONTINUE                                            09660001
096700         WHEN SQLWARN0 NOT = SPACES                               09670001
096800         WHEN SQLCODE NOT = ZERO                                  09680001
096900             INITIALIZE PV-CICS-MSG-AREA                          09690001
097000             MOVE SQLCODE               TO PV-SQL-RETURN-CD       09700001
097100             STRING   ' ' WS001-SRC-TASK-NUMBER                   09710001
097200                      ' WSKCS305-2010 ERROR:'                     09720001
097300                      ' SQL='                                     09730001
097400                      PV-SQL-RETURN-CD                            09740001
097500                      DELIMITED BY SIZE                           09750001
097600                      INTO PV-CICS-MSG-AREA                       09760001
097700             PERFORM 7000-WRITE-TO-CICS-LOG                       09770001
097800                                                                  09780001
097900             SET WS001-INVALID-SQL      TO TRUE                   09790001
098000             STRING 'SQL='                                        09800001
098100                  PV-SQL-RETURN-CD                                09810001
098200                  DELIMITED BY SIZE                               09820001
098300                                      INTO WS001-CRA-RET-MSG      09830001
098400             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  09840001
098500             MOVE SQLCA                 TO WS001-SQLCA            09850001
098600                                           DP013-SQLCA            09860001
098700             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        09870001
098800             SET DP013-DB2-ABEND        TO TRUE                   09880001
098900             PERFORM 9999-ABEND                                   09890001
099000     END-EVALUATE.                                                09900001
099100                                                                  09910001
099200/                                                                 09920001
099300 2020-FETCH-SHIP-TO-CSR.                                          09930001
099400                                                                  09940001
099500     MOVE '2020-FETCH-SHIP-TO-CSR'                                09950001
099600                                 TO WS001-PARAGRAPH-NAME.         09960001
099700                                                                  09970001
099800* GET THE PO & LNE FOR THE ROWS ON TSHPTPO.  THE KEY IS SHIPT-ID. 09980001
099900                                                                  09990001
100000     EXEC SQL                                                     10000001
100100          FETCH SHIP-TO-CSR                                       10010001
100200          INTO                                                    10020001
100300                :SHPTPO-PO-NBR                                    10030001
100400               ,:SHPTPO-REC-SEQ-NBR                               10040001
100500     END-EXEC.                                                    10050001
100600                                                                  10060001
100700     EVALUATE TRUE                                                10070001
100800         WHEN SQLCODE = ZERO                                      10080001
100900* JAK 08/2007 - CHANGE FROM FIRST RECORD, TO ALL RECORDS -        10090001
101000*               UNTIL HEADER IS FOUND                             10100001
101100******        IF PS-FIRST-RECORD-YES                              10110001
101200              IF PS-XREF-HDR-EXIST-NO                             10120001
101300                  MOVE SHPTPO-PO-NBR     TO WS-PO-NBR             10130001
101400                                            DK-PO-NBR             10140001
101500                  MOVE SHPTPO-REC-SEQ-NBR TO                      10150001
101600                                        WS-RCVR-SEQ-NBR           10160001
101700                                        DK-RCVR-SEQ-NBR           10170001
101800                  SET PS-FIRST-RECORD-NO TO TRUE                  10180001
101900                  IF PS-CICS-SWITCH-YES                           10190001
102000                      INITIALIZE PV-CICS-MSG-AREA                 10200001
102100                      MOVE WS-PO-NBR TO WS-DISPLAY-1              10210001
102200                      MOVE WS-RCVR-SEQ-NBR TO WS-DISPLAY-2        10220001
102300                      STRING   ' ' WS001-SRC-TASK-NUMBER          10230001
102400                               ' WSKCS305-2020:'                  10240001
102500                               ' FIRST RECORD-'                   10250001
102600                               ' PO NBR='                         10260001
102700                               WS-DISPLAY-1                       10270001
102800                               ' RCVR SEQ='                       10280001
102900                               WS-DISPLAY-2                       10290001
103000                               DELIMITED BY SIZE                  10300001
103100                               INTO PV-CICS-MSG-AREA              10310001
103200                      PERFORM 7000-WRITE-TO-CICS-LOG              10320001
103300                  END-IF                                          10330001
103400                  PERFORM 2040-GET-WMS-SHIPMENT                   10340001
103500                  IF PS-XREF-HDR-EXIST-YES                        10350001
103600                     IF WS-RCPT-TMST NOT = PC-DEFAULT-NINES       10360001
103700                        SET WS001-ERROR        TO TRUE            10370001
103800                        MOVE 'RECEIVED, UNABLE TO DETACH'         10380001
103900                                           TO WS001-CRA-RET-MSG   10390001
104000                        MOVE SQLCA           TO WS001-SQLCA       10400001
104100                        IF PS-CICS-SWITCH-YES                     10410001
104200                           INITIALIZE PV-CICS-MSG-AREA            10420001
104300                           STRING   ' ' WS001-SRC-TASK-NUMBER     10430001
104400                                    ' WSKCS305-2020:'             10440001
104500                                    ' RECEIVED, UNABLE TO'        10450001
104600                                    ' DETACH'                     10460001
104700                                    DELIMITED BY SIZE             10470001
104800                                          INTO PV-CICS-MSG-AREA   10480001
104900                           PERFORM 7000-WRITE-TO-CICS-LOG         10490001
105000                        END-IF                                    10500001
105100                                                                  10510001
105200                        MOVE WS001-CRA-RET-MSG                    10520001
105300                                        TO DP013-MESSAGE-TEXT(1)  10530001
105400                        MOVE SQLCA                 TO WS001-SQLCA 10540001
105500                                                      DP013-SQLCA 10550001
105600                        MOVE WS001-PARAGRAPH-NAME                 10560001
105700                                        TO DP013-PARAGRAPH        10570001
105800                        MOVE 'WST_SHPMT_XREF_DTL'  TO             10580001
105900                                       DP013-DB2-TABLE-NAME (1)   10590001
106000                        SET DP013-DB2-ABEND        TO TRUE        10600001
106100                        PERFORM 9999-ABEND                        10610001
106200                     END-IF                                       10620001
106300                     MOVE WS-EXT-SHP-ID   TO DK-EXT-SHP-ID        10630001
106400                     PERFORM 2060-UPDATE-HDR-REC                  10640001
106500                  END-IF                                          10650001
106600              END-IF                                              10660001
106700                                                                  10670001
106800              IF PS-XREF-HDR-EXIST-YES                            10680001
106900                  MOVE SHPTPO-PO-NBR      TO DK-PO-NBR            10690001
107000                  MOVE SHPTPO-REC-SEQ-NBR TO DK-RCVR-SEQ-NBR      10700001
107100                  PERFORM 2050-UPDATE-DTL-REC                     10710001
107200              END-IF                                              10720001
107300         WHEN SQLCODE = -904                                      10730001
107400         WHEN SQLCODE = -913                                      10740001
107500         WHEN SQLCODE = -911                                      10750001
107600              CONTINUE                                            10760001
107700         WHEN SQLCODE = +100                                      10770001
107800              SET PS-EOF-SHIP-TO-CSR-YES TO TRUE                  10780001
107900         WHEN SQLWARN0 NOT = SPACES                               10790001
108000         WHEN SQLCODE NOT = ZERO                                  10800001
108100             INITIALIZE PV-CICS-MSG-AREA                          10810001
108200             MOVE SQLCODE               TO PV-SQL-RETURN-CD       10820001
108300             STRING   ' ' WS001-SRC-TASK-NUMBER                   10830001
108400                      ' WSKCS305-2020 ERROR:'                     10840001
108500                      ' SQL='                                     10850001
108600                      PV-SQL-RETURN-CD                            10860001
108700                      DELIMITED BY SIZE                           10870001
108800                      INTO PV-CICS-MSG-AREA                       10880001
108900             PERFORM 7000-WRITE-TO-CICS-LOG                       10890001
109000                                                                  10900001
109100             SET WS001-INVALID-SQL      TO TRUE                   10910001
109200             STRING 'SQL='                                        10920001
109300                  PV-SQL-RETURN-CD                                10930001
109400                  DELIMITED BY SIZE                               10940001
109500                                      INTO WS001-CRA-RET-MSG      10950001
109600             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  10960001
109700             MOVE SQLCA                 TO WS001-SQLCA            10970001
109800                                           DP013-SQLCA            10980001
109900             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        10990001
110000             MOVE 'TSHPTPO'             TO                        11000001
110100                                       DP013-DB2-TABLE-NAME (1)   11010001
110200             SET DP013-DB2-ABEND        TO TRUE                   11020001
110300             PERFORM 9999-ABEND                                   11030001
110400     END-EVALUATE.                                                11040001
110500                                                                  11050001
110600/                                                                 11060001
110700 2030-CLOSE-SHIP-TO-CSR.                                          11070001
110800                                                                  11080001
110900     MOVE '2030-CLOSE-SHIP-TO-CSR'                                11090001
111000                                 TO WS001-PARAGRAPH-NAME.         11100001
111100                                                                  11110001
111200     EXEC SQL                                                     11120001
111300          CLOSE SHIP-TO-CSR                                       11130001
111400     END-EXEC.                                                    11140001
111500                                                                  11150001
111600     EVALUATE TRUE                                                11160001
111700         WHEN SQLCODE = ZERO                                      11170001
111800             IF PS-CICS-SWITCH-YES                                11180001
111900                 INITIALIZE PV-CICS-MSG-AREA                      11190001
112000                 STRING   ' ' WS001-SRC-TASK-NUMBER               11200001
112100                          ' WSKCS305-2030:'                       11210001
112200                          ' CLOSED SHIP-TO-CSR'                   11220001
112300                          DELIMITED BY SIZE                       11230001
112400                          INTO PV-CICS-MSG-AREA                   11240001
112500                 PERFORM 7000-WRITE-TO-CICS-LOG                   11250001
112600             END-IF                                               11260001
112700         WHEN SQLCODE = -904                                      11270001
112800         WHEN SQLCODE = -913                                      11280001
112900         WHEN SQLCODE = -911                                      11290001
113000              CONTINUE                                            11300001
113100         WHEN SQLWARN0 NOT = SPACES                               11310001
113200         WHEN SQLCODE NOT = ZERO                                  11320001
113300             INITIALIZE PV-CICS-MSG-AREA                          11330001
113400             MOVE SQLCODE               TO PV-SQL-RETURN-CD       11340001
113500             STRING   ' ' WS001-SRC-TASK-NUMBER                   11350001
113600                      ' WSKCS305-2030-ERROR:'                     11360001
113700                      ' SQL='                                     11370001
113800                      PV-SQL-RETURN-CD                            11380001
113900                      DELIMITED BY SIZE                           11390001
114000                      INTO PV-CICS-MSG-AREA                       11400001
114100             PERFORM 7000-WRITE-TO-CICS-LOG                       11410001
114200                                                                  11420001
114300             SET WS001-INVALID-SQL      TO TRUE                   11430001
114400             STRING 'SQL='                                        11440001
114500                  PV-SQL-RETURN-CD                                11450001
114600                  DELIMITED BY SIZE                               11460001
114700                                      INTO WS001-CRA-RET-MSG      11470001
114800             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  11480001
114900             MOVE SQLCA                 TO WS001-SQLCA            11490001
115000                                           DP013-SQLCA            11500001
115100             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        11510001
115200             SET DP013-DB2-ABEND        TO TRUE                   11520001
115300             PERFORM 9999-ABEND                                   11530001
115400     END-EVALUATE.                                                11540001
115500                                                                  11550001
115600/                                                                 11560001
115700 2040-GET-WMS-SHIPMENT.                                           11570001
115800                                                                  11580001
115900     MOVE '2040-GET-WMS-SHIPMENT'                                 11590001
116000                                 TO WS001-PARAGRAPH-NAME.         11600001
116100                                                                  11610001
116200* FIND OUT WHAT WMS SHIPMENT THE TRIP/PO/RCVR IS ON               11620001
116300                                                                  11630001
116400     EXEC SQL                                                     11640001
116500         SELECT DISTINCT                                          11650001
116600             H.EXT_SHP_ID                                         11660001
116700         ,   H.DWNLD_TMST                                         11670001
116800         ,   H.RCPT_TMST                                          11680001
116900         INTO                                                     11690001
117000            :WST00001-EXT-SHP-ID                                  11700001
117100         ,  :WST00001-DWNLD-TMST                                  11710001
117200         ,  :WST00001-RCPT-TMST                                   11720001
117300         FROM                                                     11730001
117400             WST_SHPMT_XREF_HDR H                                 11740001
117500            ,WST_SHPMT_XREF_DTL D                                 11750001
117600         WHERE  H.EXT_SHP_ID    = D.EXT_SHP_ID                    11760001
117700           AND  H.INTR_TRIP_ID  = :DK-TRIP-ID                     11770001
117800           AND  D.PO_NBR        = :DK-PO-NBR                      11780001
117900           AND  D.RCVR_SEQ_NBR  = :DK-RCVR-SEQ-NBR                11790001
118000           AND  H.SOR_CDE       = 'RC'                            11800001
118100     END-EXEC.                                                    11810001
118200                                                                  11820001
118300     EVALUATE TRUE                                                11830001
118400         WHEN SQLCODE = ZERO                                      11840001
118500             MOVE WST00001-RCPT-TMST TO WS-RCPT-TMST              11850001
118600             MOVE WST00001-EXT-SHP-ID TO WS-EXT-SHP-ID            11860001
118700                                         DK-EXT-SHP-ID            11870001
118800             MOVE WST00001-DWNLD-TMST TO WS-DWNLD-TMST            11880001
118900             SET PS-XREF-HDR-EXIST-YES TO TRUE                    11890001
119000             IF PS-CICS-SWITCH-YES                                11900001
119100                 INITIALIZE PV-CICS-MSG-AREA                      11910001
119200                 STRING   ' ' WS001-SRC-TASK-NUMBER               11920001
119300                          ' WSKCS305-2040:'                       11930001
119400                          ' RCPT TMST='                           11940001
119500                          WS-RCPT-TMST                            11950001
119600                          ' SHPMT='                               11960001
119700                          WS-EXT-SHP-ID                           11970001
119800                          ' DWNLD TMST='                          11980001
119900                          WS-DWNLD-TMST                           11990001
120000                          DELIMITED BY SIZE                       12000001
120100                          INTO PV-CICS-MSG-AREA                   12010001
120200                 PERFORM 7000-WRITE-TO-CICS-LOG                   12020001
120300             END-IF                                               12030001
120400         WHEN SQLCODE = -904                                      12040001
120500         WHEN SQLCODE = -913                                      12050001
120600         WHEN SQLCODE = -911                                      12060001
120700             CONTINUE                                             12070001
120800         WHEN SQLCODE = -811                                      12080001
120900             SET WS001-ERROR            TO TRUE                   12090001
121000             MOVE 'SQL=-811, UNABLE TO DETACH'                    12100001
121100                                        TO WS001-CRA-RET-MSG      12110001
121200             IF PS-CICS-SWITCH-YES                                12120001
121300                 INITIALIZE PV-CICS-MSG-AREA                      12130001
121400                 STRING   ' ' WS001-SRC-TASK-NUMBER               12140001
121500                          ' WSKCS305-2040:'                       12150001
121600                          ' RETURN CD= -811,'                     12160001
121700                          ' UNABLE TO DETACH'                     12170001
121800                          DELIMITED BY SIZE                       12180001
121900                          INTO PV-CICS-MSG-AREA                   12190001
122000                 PERFORM 7000-WRITE-TO-CICS-LOG                   12200001
122100             END-IF                                               12210001
122200                                                                  12220001
122300             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  12230001
122400             MOVE SQLCA                 TO WS001-SQLCA            12240001
122500                                           DP013-SQLCA            12250001
122600             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        12260001
122700             MOVE 'WST_SHPMT_XREF_HDR'  TO                        12270001
122800                                       DP013-DB2-TABLE-NAME (1)   12280001
122900             MOVE 'WST_SHPMT_XREF_DTL'  TO                        12290001
123000                                       DP013-DB2-TABLE-NAME (2)   12300001
123100             SET DP013-DB2-ABEND        TO TRUE                   12310001
123200             PERFORM 9999-ABEND                                   12320001
123300         WHEN SQLCODE = +100                                      12330001
123400* JAK 05/07/07 - IF +100, THEN JUST CONTINUE, NOT AN ERROR        12340001
123500             SET PS-XREF-HDR-EXIST-NO   TO TRUE                   12350001
123600             SET PS-CHECK-ASN-NO        TO TRUE                   12360001
123700             SET PS-IMMED-DOWNLOAD-NO   TO TRUE                   12370001
123800                                                                  12380001
123900*            SET WS001-ERROR           TO TRUE                    12390001
124000*            MOVE 'SQL=+100, UNABLE TO DETACH'                    12400001
124100*                                      TO WS001-CRA-RET-MSG       12410001
124200*            IF PS-CICS-SWITCH-YES                                12420001
124300*                INITIALIZE PV-CICS-MSG-AREA                      12430001
124400*                MOVE DK-TRIP-ID       TO WS-DISPLAY-1            12440001
124500*                STRING   ' ' WS001-SRC-TASK-NUMBER               12450001
124600*                         ' WSKCS305-2040:'                       12460001
124700*                         ' RETURN CD= +100,'                     12470001
124800*                         ' UNABLE TO DETACH'                     12480001
124900*                         ' TRIP=' WS-DISPLAY-1                   12490001
125000*                         DELIMITED BY SIZE                       12500001
125100*                         INTO PV-CICS-MSG-AREA                   12510001
125200*                PERFORM 7000-WRITE-TO-CICS-LOG                   12520001
125300*            END-IF                                               12530001
125400*                                                                 12540001
125500*            MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  12550001
125600*            MOVE SQLCA                 TO WS001-SQLCA            12560001
125700*                                          DP013-SQLCA            12570001
125800*            MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        12580001
125900*            MOVE 'WST_SHPMT_XREF_HDR'  TO                        12590001
126000*                                      DP013-DB2-TABLE-NAME (1)   12600001
126100*            MOVE 'WST_SHPMT_XREF_DTL'  TO                        12610001
126200*                                      DP013-DB2-TABLE-NAME (2)   12620001
126300*            SET DP013-DB2-ABEND        TO TRUE                   12630001
126400*            PERFORM 9999-ABEND                                   12640001
126500         WHEN SQLWARN0 NOT = SPACES                               12650001
126600         WHEN SQLCODE NOT = ZERO                                  12660001
126700             INITIALIZE PV-CICS-MSG-AREA                          12670001
126800             MOVE SQLCODE               TO PV-SQL-RETURN-CD       12680001
126900             STRING   ' ' WS001-SRC-TASK-NUMBER                   12690001
127000                      ' WSKCS305-2040 ERROR:'                     12700001
127100                      ' SQL='                                     12710001
127200                      PV-SQL-RETURN-CD                            12720001
127300                      DELIMITED BY SIZE                           12730001
127400                      INTO PV-CICS-MSG-AREA                       12740001
127500             PERFORM 7000-WRITE-TO-CICS-LOG                       12750001
127600                                                                  12760001
127700             SET WS001-INVALID-SQL      TO TRUE                   12770001
127800             STRING 'SQL='                                        12780001
127900                  PV-SQL-RETURN-CD                                12790001
128000                  DELIMITED BY SIZE                               12800001
128100                                      INTO WS001-CRA-RET-MSG      12810001
128200             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  12820001
128300             MOVE SQLCA                 TO WS001-SQLCA            12830001
128400                                           DP013-SQLCA            12840001
128500             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        12850001
128600             MOVE 'WST_SHPMT_XREF_HDR'  TO                        12860001
128700                                       DP013-DB2-TABLE-NAME (1)   12870001
128800             MOVE 'WST_SHPMT_XREF_DTL'  TO                        12880001
128900                                       DP013-DB2-TABLE-NAME (2)   12890001
129000             SET DP013-DB2-ABEND        TO TRUE                   12900001
129100             PERFORM 9999-ABEND                                   12910001
129200     END-EVALUATE.                                                12920001
129300*                                                                 12930001
129400/                                                                 12940001
129500 2050-UPDATE-DTL-REC.                                             12950001
129600                                                                  12960001
129700     MOVE '2050-UPDATE-DTL-REC'  TO WS001-PARAGRAPH-NAME.         12970001
129800                                                                  12980001
129900     EXEC SQL                                                     12990001
130000          UPDATE WST_SHPMT_XREF_DTL                               13000001
130100             SET ACTV_CDE         = 'I'                           13010001
130200             WHERE EXT_SHP_ID     = :DK-EXT-SHP-ID                13020001
130300             AND   PO_NBR         = :DK-PO-NBR                    13030001
130400             AND   RCVR_SEQ_NBR   = :DK-RCVR-SEQ-NBR              13040001
130500     END-EXEC.                                                    13050001
130600                                                                  13060001
130700     EVALUATE TRUE                                                13070001
130800         WHEN SQLCODE = ZERO                                      13080001
130900             IF PS-CICS-SWITCH-YES                                13090001
131000                 MOVE DK-PO-NBR TO WS-DISPLAY-1                   13100001
131100                 MOVE DK-RCVR-SEQ-NBR TO WS-DISPLAY-2             13110001
131200                 INITIALIZE PV-CICS-MSG-AREA                      13120001
131300                 STRING   ' ' WS001-SRC-TASK-NUMBER               13130001
131400                          ' WSKCS305-2050:'                       13140001
131500                          ' UPDATE WST_SHPMT_XREF_DTL'            13150001
131600                          ' FOR SHPMT='                           13160001
131700                          DK-EXT-SHP-ID                           13170001
131800                          ' PO NBR='                              13180001
131900                          WS-DISPLAY-1                            13190001
132000                          ' RCVR SEQ='                            13200001
132100                          WS-DISPLAY-2                            13210001
132200                          DELIMITED BY SIZE                       13220001
132300                          INTO PV-CICS-MSG-AREA                   13230001
132400                 PERFORM 7000-WRITE-TO-CICS-LOG                   13240001
132500             END-IF                                               13250001
132600         WHEN SQLCODE = -904                                      13260001
132700         WHEN SQLCODE = -913                                      13270001
132800         WHEN SQLCODE = -911                                      13280001
132900         WHEN SQLCODE = 100                                       13290001
133000              CONTINUE                                            13300001
133100         WHEN SQLWARN0 NOT = SPACES                               13310001
133200         WHEN SQLCODE NOT = ZERO                                  13320001
133300             INITIALIZE PV-CICS-MSG-AREA                          13330001
133400             MOVE SQLCODE               TO PV-SQL-RETURN-CD       13340001
133500             STRING   ' ' WS001-SRC-TASK-NUMBER                   13350001
133600                      ' WSKCS305-2050 ERROR:'                     13360001
133700                      ' SQL='                                     13370001
133800                      PV-SQL-RETURN-CD                            13380001
133900                      DELIMITED BY SIZE                           13390001
134000                      INTO PV-CICS-MSG-AREA                       13400001
134100             PERFORM 7000-WRITE-TO-CICS-LOG                       13410001
134200                                                                  13420001
134300             SET WS001-INVALID-SQL      TO TRUE                   13430001
134400             STRING 'SQL='                                        13440001
134500                  PV-SQL-RETURN-CD                                13450001
134600                  DELIMITED BY SIZE                               13460001
134700                                      INTO WS001-CRA-RET-MSG      13470001
134800             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  13480001
134900             MOVE SQLCA                 TO WS001-SQLCA            13490001
135000                                           DP013-SQLCA            13500001
135100             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        13510001
135200             MOVE 'WST_SHPMT_XREF_DTL'  TO                        13520001
135300                                       DP013-DB2-TABLE-NAME (1)   13530001
135400             SET DP013-DB2-ABEND        TO TRUE                   13540001
135500             PERFORM 9999-ABEND                                   13550001
135600     END-EVALUATE.                                                13560001
135700                                                                  13570001
135800/                                                                 13580001
135900 2060-UPDATE-HDR-REC.                                             13590001
136000                                                                  13600001
136100     MOVE '2060-UPDATE-HDR-REC'  TO WS001-PARAGRAPH-NAME.         13610001
136200                                                                  13620001
136300     EXEC SQL                                                     13630001
136400          UPDATE WST_SHPMT_XREF_HDR                               13640001
136500             SET LAST_PRCG_TMST   = CURRENT TIMESTAMP             13650001
136600                ,DWNLD_CDE        = 'P'                           13660001
136700             WHERE EXT_SHP_ID     = :DK-EXT-SHP-ID                13670001
136800     END-EXEC.                                                    13680001
136900                                                                  13690001
137000     EVALUATE TRUE                                                13700001
137100         WHEN SQLCODE = ZERO                                      13710001
137200             IF PS-CICS-SWITCH-YES                                13720001
137300                 INITIALIZE PV-CICS-MSG-AREA                      13730001
137400                 STRING   ' ' WS001-SRC-TASK-NUMBER               13740001
137500                          ' WSKCS305-2060:'                       13750001
137600                          ' UPDATE WST_SHPMT_XREF_HDR'            13760001
137700                          ' FOR SHPMT='                           13770001
137800                          DK-EXT-SHP-ID                           13780001
137900                          DELIMITED BY SIZE                       13790001
138000                          INTO PV-CICS-MSG-AREA                   13800001
138100                 PERFORM 7000-WRITE-TO-CICS-LOG                   13810001
138200             END-IF                                               13820001
138300         WHEN SQLCODE = -904                                      13830001
138400         WHEN SQLCODE = -913                                      13840001
138500         WHEN SQLCODE = -911                                      13850001
138600              CONTINUE                                            13860001
138700         WHEN SQLWARN0 NOT = SPACES                               13870001
138800         WHEN SQLCODE NOT = ZERO                                  13880001
138900             INITIALIZE PV-CICS-MSG-AREA                          13890001
139000             MOVE SQLCODE               TO PV-SQL-RETURN-CD       13900001
139100             STRING   ' ' WS001-SRC-TASK-NUMBER                   13910001
139200                      ' WSKCS305-2060 ERROR:'                     13920001
139300                      ' SQL='                                     13930001
139400                      PV-SQL-RETURN-CD                            13940001
139500                      DELIMITED BY SIZE                           13950001
139600                      INTO PV-CICS-MSG-AREA                       13960001
139700             PERFORM 7000-WRITE-TO-CICS-LOG                       13970001
139800                                                                  13980001
139900             SET WS001-INVALID-SQL      TO TRUE                   13990001
140000             STRING 'SQL='                                        14000001
140100                  PV-SQL-RETURN-CD                                14010001
140200                  DELIMITED BY SIZE                               14020001
140300                                      INTO WS001-CRA-RET-MSG      14030001
140400             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  14040001
140500             MOVE SQLCA                 TO WS001-SQLCA            14050001
140600                                           DP013-SQLCA            14060001
140700             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        14070001
140800             MOVE 'WST_SHPMT_XREF_HDR'  TO                        14080001
140900                                       DP013-DB2-TABLE-NAME (1)   14090001
141000             SET DP013-DB2-ABEND        TO TRUE                   14100001
141100             PERFORM 9999-ABEND                                   14110001
141200     END-EVALUATE.                                                14120001
141300                                                                  14130001
141400/                                                                 14140001
141500 2070-GET-TRIP-ID.                                                14150001
141600                                                                  14160001
141700     MOVE '2070-GET-TRIP-ID'     TO WS001-PARAGRAPH-NAME.         14170001
141800                                                                  14180001
141900     EXEC SQL                                                     14190001
142000         SELECT  TRIP_ID                                          14200001
142100         INTO                                                     14210001
142200                :SHIPMT-TRIP-ID                                   14220001
142300         FROM    TSHIPMT                                          14230001
142400         WHERE   SHIPT_ID         = :DK-SHIPT-ID                  14240001
142500     END-EXEC.                                                    14250001
142600                                                                  14260001
142700     EVALUATE TRUE                                                14270001
142800         WHEN SQLCODE = ZERO                                      14280001
142900             MOVE SHIPMT-TRIP-ID  TO WS-TRIP-ID                   14290001
143000                                     DK-TRIP-ID                   14300001
143100             IF PS-CICS-SWITCH-YES                                14310001
143200                 MOVE WS-TRIP-ID TO WS-DISPLAY-1                  14320001
143300                 INITIALIZE PV-CICS-MSG-AREA                      14330001
143400                 STRING   ' ' WS001-SRC-TASK-NUMBER               14340001
143500                          ' WSKCS305-2070:'                       14350001
143600                          ' TRIP-ID='                             14360001
143700                          WS-DISPLAY-1                            14370001
143800                          DELIMITED BY SIZE                       14380001
143900                          INTO PV-CICS-MSG-AREA                   14390001
144000                 PERFORM 7000-WRITE-TO-CICS-LOG                   14400001
144100             END-IF                                               14410001
144200         WHEN SQLCODE = +100                                      14420001
144300         WHEN SQLCODE = -811                                      14430001
144400         WHEN SQLCODE = -904                                      14440001
144500         WHEN SQLCODE = -913                                      14450001
144600         WHEN SQLCODE = -911                                      14460001
144700             CONTINUE                                             14470001
144800         WHEN SQLWARN0 NOT = SPACES                               14480001
144900         WHEN SQLCODE NOT = ZERO                                  14490001
145000             MOVE SQLCODE               TO PV-SQL-RETURN-CD       14500001
145100             INITIALIZE PV-CICS-MSG-AREA                          14510001
145200             STRING   ' ' WS001-SRC-TASK-NUMBER                   14520001
145300                      ' WSKCS305-2070 ERROR:'                     14530001
145400                      ' SQL='                                     14540001
145500                      PV-SQL-RETURN-CD                            14550001
145600                      DELIMITED BY SIZE                           14560001
145700                      INTO PV-CICS-MSG-AREA                       14570001
145800             PERFORM 7000-WRITE-TO-CICS-LOG                       14580001
145900                                                                  14590001
146000             SET WS001-INVALID-SQL      TO TRUE                   14600001
146100             STRING 'SQL='                                        14610001
146200                  PV-SQL-RETURN-CD                                14620001
146300                  DELIMITED BY SIZE                               14630001
146400                                      INTO WS001-CRA-RET-MSG      14640001
146500             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  14650001
146600             MOVE SQLCA                 TO WS001-SQLCA            14660001
146700                                           DP013-SQLCA            14670001
146800             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        14680001
146900             MOVE 'TSHIPMT'             TO                        14690001
147000                                       DP013-DB2-TABLE-NAME (1)   14700001
147100             SET DP013-DB2-ABEND        TO TRUE                   14710001
147200             PERFORM 9999-ABEND                                   14720001
147300     END-EVALUATE.                                                14730001
147400*                                                                 14740001
147500/                                                                 14750001
147600 2080-SELECT-TVHTRIP.                                             14760001
147700                                                                  14770001
147800     MOVE '2080-SELECT-TVHTRIP'  TO WS001-PARAGRAPH-NAME.         14780001
147900                                                                  14790001
148000     EXEC SQL                                                     14800001
148100         SELECT   VEH_NBR                                         14810001
148200           INTO  :VHTRIP-VEH-NBR :DN-VEH-NBR                      14820001
148300           FROM   TVHTRIP                                         14830001
148400          WHERE   TRIP_ID    = :DK-TRIP-ID                        14840001
148500     END-EXEC.                                                    14850001
148600                                                                  14860001
148700     EVALUATE TRUE                                                14870001
148800         WHEN SQLCODE = ZERO                                      14880001
148900             IF DN-VEH-NBR = -1                                   14890001
149000                SET PS-VALID-TRIP-NO   TO TRUE                    14900001
149100             ELSE                                                 14910001
149200                SET PS-VALID-TRIP      TO TRUE                    14920001
149300             END-IF                                               14930001
149400             IF PS-CICS-SWITCH-YES                                14940001
149500                 MOVE WS-TRIP-ID       TO WS-DISPLAY-1            14950001
149600                 INITIALIZE PV-CICS-MSG-AREA                      14960001
149700                 STRING   ' ' WS001-SRC-TASK-NUMBER               14970001
149800                          ' WSKCS305-2080:'                       14980001
149900                          ' TRIP='                                14990001
150000                          WS-DISPLAY-1                            15000001
150100                          ' VALID TRIP=' PS-VALID-TRIP-SW         15010001
150200                          DELIMITED BY SIZE                       15020001
150300                          INTO PV-CICS-MSG-AREA                   15030001
150400                 PERFORM 7000-WRITE-TO-CICS-LOG                   15040001
150500             END-IF                                               15050001
150600         WHEN SQLCODE = +100                                      15060001
150700         WHEN SQLCODE = -811                                      15070001
150800         WHEN SQLCODE = -904                                      15080001
150900         WHEN SQLCODE = -913                                      15090001
151000         WHEN SQLCODE = -911                                      15100001
151100             CONTINUE                                             15110001
151200         WHEN SQLWARN0 NOT = SPACES                               15120001
151300         WHEN SQLCODE NOT = ZERO                                  15130001
151400             MOVE SQLCODE               TO PV-SQL-RETURN-CD       15140001
151500             INITIALIZE PV-CICS-MSG-AREA                          15150001
151600             STRING   ' ' WS001-SRC-TASK-NUMBER                   15160001
151700                      ' WSKCS305-2070 ERROR:'                     15170001
151800                      ' SQL='                                     15180001
151900                      PV-SQL-RETURN-CD                            15190001
152000                      DELIMITED BY SIZE                           15200001
152100                      INTO PV-CICS-MSG-AREA                       15210001
152200             PERFORM 7000-WRITE-TO-CICS-LOG                       15220001
152300                                                                  15230001
152400             SET WS001-INVALID-SQL      TO TRUE                   15240001
152500             STRING 'SQL='                                        15250001
152600                  PV-SQL-RETURN-CD                                15260001
152700                  DELIMITED BY SIZE                               15270001
152800                                      INTO WS001-CRA-RET-MSG      15280001
152900             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  15290001
153000             MOVE SQLCA                 TO WS001-SQLCA            15300001
153100                                           DP013-SQLCA            15310001
153200             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        15320001
153300             MOVE 'TSHIPMT'             TO                        15330001
153400                                       DP013-DB2-TABLE-NAME (1)   15340001
153500             SET DP013-DB2-ABEND        TO TRUE                   15350001
153600             PERFORM 9999-ABEND                                   15360001
153700     END-EVALUATE.                                                15370001
153800*                                                                 15380001
153900/                                                                 15390001
154000 2090-CHECK-RECEIVER-TYPE.                                        15400001
154100                                                                  15410001
154200     MOVE '2090-CHECK-RECEIVER-TYPE' TO  WS001-PARAGRAPH-NAME.    15420001
154300     SET  PS-AP-RECEIVER-FOUND-NO    TO  TRUE                     15430001
154400                                                                  15440001
154500     EXEC SQL                                                     15450001
154600         SELECT   REC_TYP_CDE                                     15460001
154700           INTO  :RECEIV-REC-TYP-CDE                              15470001
154800           FROM   TRECEIV                                         15480001
154900          WHERE   ORD_NBR         = :DK-PO-NBR                    15490001
155000            AND   REC_SEQ_NBR     = :DK-RCVR-SEQ-NBR              15500001
155100            AND   VER_STATUS_CDE  = 'A'                           15510001
155200     END-EXEC.                                                    15520001
155300                                                                  15530001
155400                                                                  15540001
155500     EVALUATE TRUE                                                15550001
155600         WHEN SQLCODE = ZERO                                      15560001
155700             IF RECEIV-REC-TYP-CDE = 'AP'                         15570001
155800                SET PS-AP-RECEIVER-FOUND-YES TO TRUE              15580001
155900             END-IF                                               15590001
156000             IF PS-CICS-SWITCH-YES                                15600001
156100                                                                  15610001
156200                 MOVE DK-PO-NBR  TO  WS-DISPLAY-PO-NBR            15620001
156300                 MOVE DK-RCVR-SEQ-NBR TO  WS-DISPLAY-RCVR-NBR     15630001
156400                 INITIALIZE PV-CICS-MSG-AREA                      15640001
156500                 STRING   ' ' WS001-SRC-TASK-NUMBER               15650001
156600                          ' WSKCS305-2090:'                       15660001
156700                          ' PO NUMBER '                           15670001
156800                          WS-DISPLAY-PO-NBR                       15680001
156900                          ' RCVR NUM '  WS-DISPLAY-RCVR-NBR       15690001
157000                          DELIMITED BY SIZE                       15700001
157100                          INTO PV-CICS-MSG-AREA                   15710001
157200                 PERFORM 7000-WRITE-TO-CICS-LOG                   15720001
157300             END-IF                                               15730001
157400         WHEN SQLCODE = +100                                      15740001
157500         WHEN SQLCODE = -811                                      15750001
157600         WHEN SQLCODE = -904                                      15760001
157700         WHEN SQLCODE = -913                                      15770001
157800         WHEN SQLCODE = -911                                      15780001
157900             MOVE SQLCODE         TO PV-SQL-RETURN-CD             15790001
158000             MOVE DK-PO-NBR       TO  WS-DISPLAY-PO-NBR           15800001
158100             MOVE DK-RCVR-SEQ-NBR TO  WS-DISPLAY-RCVR-NBR         15810001
158200             INITIALIZE PV-CICS-MSG-AREA                          15820001
158300             STRING   ' ' WS001-SRC-TASK-NUMBER                   15830001
158400                          ' WSKCS305-2090:'                       15840001
158500                          ' PO NUMBER '                           15850001
158600                          WS-DISPLAY-PO-NBR                       15860001
158700                          ' RCVR NUM '  WS-DISPLAY-RCVR-NBR       15870001
158800                          DELIMITED BY SIZE                       15880001
158900                          INTO PV-CICS-MSG-AREA                   15890001
159000                 PERFORM 7000-WRITE-TO-CICS-LOG                   15900001
159100             INITIALIZE PV-CICS-MSG-AREA                          15910001
159200             STRING   ' ' WS001-SRC-TASK-NUMBER                   15920001
159300                      ' WSKCS305-2090 ERROR:'                     15930001
159400                      ' SQL='                                     15940001
159500                      PV-SQL-RETURN-CD                            15950001
159600                      DELIMITED BY SIZE                           15960001
159700                      INTO PV-CICS-MSG-AREA                       15970001
159800             PERFORM 7000-WRITE-TO-CICS-LOG                       15980001
159900         WHEN SQLWARN0 NOT = SPACES                               15990001
160000         WHEN SQLCODE NOT = ZERO                                  16000001
160100             MOVE SQLCODE               TO PV-SQL-RETURN-CD       16010001
160200             MOVE DK-PO-NBR       TO  WS-DISPLAY-PO-NBR           16020001
160300             MOVE DK-RCVR-SEQ-NBR TO  WS-DISPLAY-RCVR-NBR         16030001
160400             INITIALIZE PV-CICS-MSG-AREA                          16040001
160500             STRING   ' ' WS001-SRC-TASK-NUMBER                   16050001
160600                          ' WSKCS305-2090:'                       16060001
160700                          ' PO NUMBER '                           16070001
160800                          WS-DISPLAY-PO-NBR                       16080001
160900                          ' RCVR NUM '  WS-DISPLAY-RCVR-NBR       16090001
161000                          DELIMITED BY SIZE                       16100001
161100                          INTO PV-CICS-MSG-AREA                   16110001
161200                 PERFORM 7000-WRITE-TO-CICS-LOG                   16120001
161300             INITIALIZE PV-CICS-MSG-AREA                          16130001
161400             STRING   ' ' WS001-SRC-TASK-NUMBER                   16140001
161500                      ' WSKCS305-2070 ERROR:'                     16150001
161600                      ' SQL='                                     16160001
161700                      PV-SQL-RETURN-CD                            16170001
161800                      DELIMITED BY SIZE                           16180001
161900                      INTO PV-CICS-MSG-AREA                       16190001
162000             PERFORM 7000-WRITE-TO-CICS-LOG                       16200001
162100                                                                  16210001
162200             SET WS001-INVALID-SQL      TO TRUE                   16220001
162300             STRING 'SQL='                                        16230001
162400                  PV-SQL-RETURN-CD                                16240001
162500                  DELIMITED BY SIZE                               16250001
162600                                      INTO WS001-CRA-RET-MSG      16260001
162700             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  16270001
162800             MOVE SQLCA                 TO WS001-SQLCA            16280001
162900                                           DP013-SQLCA            16290001
163000             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        16300001
163100             MOVE 'TRECEIV'             TO                        16310001
163200                                       DP013-DB2-TABLE-NAME (1)   16320001
163300             SET DP013-DB2-ABEND        TO TRUE                   16330001
163400             PERFORM 9999-ABEND                                   16340001
163500     END-EVALUATE.                                                16350001
163600*                                                                 16360001
163700/                                                                 16370001
163800 2100-CHECK-FOR-INACTIVE.                                         16380001
163900                                                                  16390001
164000     MOVE '2100-CHECK-FOR-INACTIVE' TO WS001-PARAGRAPH-NAME.      16400001
164100                                                                  16410001
164200*  IF ALL OF THE DETAIL ROWS ARE MARKED INACTIVE                  16420001
164300*  OR THERE ARE NO DETAIL ROWS,                                   16430001
164400*  THEN WE WANT TO CHANGE THE DWNLD_CDE TO 'X'                    16440001
164500                                                                  16450001
164600     EXEC SQL                                                     16460001
164700         SELECT  H.EXT_SHP_ID                                     16470001
164800         INTO                                                     16480001
164900                :WST00001-EXT-SHP-ID                              16490001
165000         FROM    WST_SHPMT_XREF_HDR H                             16500001
165100               , WST_SHPMT_XREF_DTL D                             16510001
165200         WHERE   H.EXT_SHP_ID     = :DK-EXT-SHP-ID                16520001
165300         AND     H.EXT_SHP_ID     = D.EXT_SHP_ID                  16530001
165400         AND     D.ACTV_CDE       = 'A'                           16540001
165500         WITH UR                                                  16550001
165600     END-EXEC.                                                    16560001
165700                                                                  16570001
165800     EVALUATE TRUE                                                16580001
165900         WHEN SQLCODE = +100                                      16590001
166000             IF PS-CICS-SWITCH-YES                                16600001
166100                 INITIALIZE PV-CICS-MSG-AREA                      16610001
166200                 STRING   ' ' WS001-SRC-TASK-NUMBER               16620001
166300                          ' WSKCS305-2100:'                       16630001
166400                          ' SHPMT='                               16640001
166500                          DK-EXT-SHP-ID                           16650001
166600                          DELIMITED BY SIZE                       16660001
166700                          INTO PV-CICS-MSG-AREA                   16670001
166800                 PERFORM 7000-WRITE-TO-CICS-LOG                   16680001
166900             END-IF                                               16690001
167000*            PERFORM 2110-UPDATE-HDR-X                            16700001
167100             SET PS-CANCEL-SHPMT-YES    TO TRUE                   16710001
167200         WHEN SQLCODE = ZERO                                      16720001
167300         WHEN SQLCODE = -811                                      16730001
167400         WHEN SQLCODE = -904                                      16740001
167500         WHEN SQLCODE = -913                                      16750001
167600         WHEN SQLCODE = -911                                      16760001
167700             CONTINUE                                             16770001
167800         WHEN SQLWARN0 NOT = SPACES                               16780001
167900         WHEN SQLCODE NOT = ZERO                                  16790001
168000             MOVE SQLCODE               TO PV-SQL-RETURN-CD       16800001
168100             INITIALIZE PV-CICS-MSG-AREA                          16810001
168200             STRING   ' ' WS001-SRC-TASK-NUMBER                   16820001
168300                      ' WSKCS305-2100 ERROR:'                     16830001
168400                      ' SQL='                                     16840001
168500                      PV-SQL-RETURN-CD                            16850001
168600                      DELIMITED BY SIZE                           16860001
168700                      INTO PV-CICS-MSG-AREA                       16870001
168800             PERFORM 7000-WRITE-TO-CICS-LOG                       16880001
168900                                                                  16890001
169000             SET WS001-INVALID-SQL      TO TRUE                   16900001
169100             STRING 'SQL='                                        16910001
169200                  PV-SQL-RETURN-CD                                16920001
169300                  DELIMITED BY SIZE                               16930001
169400                                      INTO WS001-CRA-RET-MSG      16940001
169500             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  16950001
169600             MOVE SQLCA                 TO WS001-SQLCA            16960001
169700                                           DP013-SQLCA            16970001
169800             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        16980001
169900             MOVE 'WST_SHPMT_XREF_HDR'  TO                        16990001
170000                                       DP013-DB2-TABLE-NAME (1)   17000001
170100             MOVE 'WST_SHPMT_XREF_DTL'  TO                        17010001
170200                                       DP013-DB2-TABLE-NAME (2)   17020001
170300             SET DP013-DB2-ABEND        TO TRUE                   17030001
170400             PERFORM 9999-ABEND                                   17040001
170500     END-EVALUATE.                                                17050001
170600                                                                  17060001
170700/                                                                 17070001
170800* JAK 08/2007 - UNCOMMENT PROC 2110-                              17080001
170900 2110-UPDATE-HDR-X.                                               17090001
171000                                                                  17100001
171100     MOVE '2110-UPDATE-HDR-X'    TO WS001-PARAGRAPH-NAME.         17110001
171200                                                                  17120001
171300     EXEC SQL                                                     17130001
171400          UPDATE WST_SHPMT_XREF_HDR                               17140001
171500             SET DWNLD_CDE        = 'X'                           17150001
171600             WHERE EXT_SHP_ID     = :DK-EXT-SHP-ID                17160001
171700     END-EXEC.                                                    17170001
171800                                                                  17180001
171900     EVALUATE TRUE                                                17190001
172000         WHEN SQLCODE = ZERO                                      17200001
172100             IF PS-CICS-SWITCH-YES                                17210001
172200                 INITIALIZE PV-CICS-MSG-AREA                      17220001
172300                 STRING   ' ' WS001-SRC-TASK-NUMBER               17230001
172400                          ' WSKCS305-2110:'                       17240001
172500                          ' UPDATE WST_SHPMT_XREF_HDR'            17250001
172600                          ' FOR SHPMT='                           17260001
172700                          DK-EXT-SHP-ID                           17270001
172800                          DELIMITED BY SIZE                       17280001
172900                          INTO PV-CICS-MSG-AREA                   17290001
173000                 PERFORM 7000-WRITE-TO-CICS-LOG                   17300001
173100             END-IF                                               17310001
173200         WHEN SQLCODE = -904                                      17320001
173300         WHEN SQLCODE = -913                                      17330001
173400         WHEN SQLCODE = -911                                      17340001
173500         WHEN SQLCODE = +100                                      17350001
173600              CONTINUE                                            17360001
173700         WHEN SQLWARN0 NOT = SPACES                               17370001
173800         WHEN SQLCODE NOT = ZERO                                  17380001
173900             MOVE SQLCODE               TO PV-SQL-RETURN-CD       17390001
174000             INITIALIZE PV-CICS-MSG-AREA                          17400001
174100             STRING   ' ' WS001-SRC-TASK-NUMBER                   17410001
174200                      ' WSKCS305-2110 ERROR:'                     17420001
174300                      ' SQL='                                     17430001
174400                      PV-SQL-RETURN-CD                            17440001
174500                      DELIMITED BY SIZE                           17450001
174600                      INTO PV-CICS-MSG-AREA                       17460001
174700             PERFORM 7000-WRITE-TO-CICS-LOG                       17470001
174800                                                                  17480001
174900             SET WS001-INVALID-SQL      TO TRUE                   17490001
175000             STRING 'SQL='                                        17500001
175100                  PV-SQL-RETURN-CD                                17510001
175200                  DELIMITED BY SIZE                               17520001
175300                                      INTO WS001-CRA-RET-MSG      17530001
175400             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  17540001
175500             MOVE SQLCA                 TO WS001-SQLCA            17550001
175600                                           DP013-SQLCA            17560001
175700             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        17570001
175800             MOVE 'WST_SHPMT_XREF_HDR'  TO                        17580001
175900                                       DP013-DB2-TABLE-NAME (1)   17590001
176000             SET DP013-DB2-ABEND        TO TRUE                   17600001
176100             PERFORM 9999-ABEND                                   17610001
176200     END-EVALUATE.                                                17620001
176300*                                                                 17630001
176400/                                                                 17640001
176500 3000-PKSLIP-INACTIVE.                                            17650001
176600                                                                  17660001
176700     MOVE '3000-PKSLIP-INACTIVE' TO WS001-PARAGRAPH-NAME.         17670001
176800                                                                  17680001
176900* THE ASSUMPTION HERE IS THAT THE CALLING PROGRAM HAS ALREADY     17690001
177000* CHECKED TO MAKE SURE THAT RECEIVING HAS NOT BEGUN, SO WE ARE    17700001
177100* NOT CHECKING FOR THAT HERE.                                     17710001
177200                                                                  17720001
177300* SUMMARY OF PROCESSING FOR PACKSLIP INACTIVATE:                  17730001
177400*   - SET WS-DWNLD-TMST TO DEFAULT NINES.  IF NO ROWS ARE RETURNED17740001
177500*     FROM THE TRIP-ID-CSR, WE NEED THIS FIELD TO BE DEFAULTED,   17750001
177600*     SO THAT THE IMMED-DOWNLOAD SWITCH DOES NOT GET SET          17760001
177700*   - SELECT ALL ROWS FROM XREF TABLES FOR TRIP/PO/RCVR           17770001
177800*   - UPDATE ALL DETAIL ROWS TO INACTIVE, NOT DOWNLOADED          17780001
177900*   - IF THE SHIPMENT HAS BEEN DOWNLOADED PREVIOUSLY              17790001
178000*        THEN UPDATE THE HEADER ROW DWNLD-CDE TO P                17800001
178100*   - IF THERE ARE NO ROWS FOR THE TRIP/PO/RCVR                   17810001
178200*        THEN CHECK TO SEE IF THERE IS A HEADER FOR THE TRIP      17820001
178300*   - IF THERE IS NO HEADER FOR THE TRIP                          17830001
178400*        THEN INSERT A HEADER FOR THE TRIP                        17840001
178500*   - UPDATE/INSERT ALL VALID DETAIL ROWS, MAKING THEM ACTIVE     17850001
178600*   - IF ALL DETAIL ROWS FOR THE SHIPMENT ARE INACTIVE            17860001
178700*        THEN UPDATE THE HEADER ROW DWNLD-CDE TO X                17870001
178800*   - IF THE SHIPMENT HAS BEEN DOWNLOADED PREVIOUSLY              17880001
178900*        THEN DOWNLOAD AGAIN                                      17890001
179000                                                                  17900001
179100                                                                  17910001
179200     MOVE PC-DEFAULT-NINES            TO WS-DWNLD-TMST.           17920001
179300     PERFORM 3010-OPEN-TRIP-ID-CSR.                               17930001
179400     PERFORM 3020-FETCH-TRIP-ID-CSR UNTIL                         17940001
179500             PS-EOF-TRIP-ID-CSR-YES.                              17950001
179600     PERFORM 3030-CLOSE-TRIP-ID-CSR.                              17960001
179700                                                                  17970001
179800* CHECK TO SEE IS XREF HDR EXISTS FOR TRIP/PO/RCVR                17980001
179900* IF NOT, THEN CHECK FOR AN XREF HDR FOR THE TRIP                 17990001
180000* IF THAT DOES NOT EXIST, THEN INSERT A NEW XREF HDR              18000001
180100                                                                  18010001
180200     IF PS-FIRST-RECORD-YES                                       18020001
180300         SET PS-TRIP-HDR-EXIST-NO     TO TRUE                     18030001
180400         PERFORM 3060-CHECK-FOR-TRIP-HDR                          18040001
180500         IF PS-TRIP-HDR-EXIST-NO                                  18050001
180600             MOVE WS-TRIP-ID          TO WST00001-INTR-TRIP-ID    18060001
180700             MOVE 0                   TO WST00001-DMY-SEQ-NBR     18070001
180800             MOVE 'N'                 TO WS-DWNLD-CDE             18080001
180900             SET PS-DUMMY-HEADER-NO   TO TRUE                     18090001
180910*                                                                 18091009
180920* dmh 12/13/2016 - begin                                          18092009
180930              if  PS-CAPTURE-DOWNLOAD-YES                         18093009
180940                MOVE '3000-PKSLIP-Inact'  tO WS025-PARAGRAPH-NAME 18094009
180950                MOVE 'first/no hdr exists' TO WS025-INFORMATION   18095009
180960                perform 0560-WFT-DAT-xfer                         18096009
180970              end-if                                              18097009
180980* dmh 12/13/2016 - end                                            18098009
180990*                                                                 18099009
181000             PERFORM 5000-INSERT-HEADER                           18100001
181100             MOVE WS-EXT-SHP-ID       TO DK-EXT-SHP-ID            18110001
181200         END-IF                                                   18120001
181300     ELSE                                                         18130001
181400         MOVE WS-HOLD-EXT-SHP-ID      TO WS-EXT-SHP-ID            18140001
181500                                         DK-EXT-SHP-ID            18150001
181600     END-IF.                                                      18160001
181700                                                                  18170001
181800* INSERT/UPDATE ANY DETAIL ROWS THAT ARE STILL ACTIVE             18180001
181900     PERFORM 5610-CHECK-FOR-PBS.                                  18190001
182000     IF PS-PACK-BY-STORE-YES                                      18200001
182100        PERFORM 5620-CHECK-FOR-PBS-ERRS                           18210001
182200     END-IF.                                                      18220001
182300                                                                  18230001
182400     PERFORM 5600-DETAIL-PO-RCVR.                                 18240001
182500     PERFORM 3100-CHECK-FOR-INACTIVE.                             18250001
182600                                                                  18260001
182700* JAK 09/2007 - ADD ADDL CHECK FOR INACTIVE SHIPMENT              18270001
182800* IF A HEADER WAS CREATED, BUT NO DETAIL RECORDS WERE ADDED,      18280001
182900*   THEN SET THE DWNLD-CDE ON XREF-HDR TO 'X' AND RESET THE       18290001
183000*   SWITCHES, SO THE SHIPMENT DOES NOT GET DOWNLOADED             18300001
183100                                                                  18310001
183200     IF PS-HEADER-CREATED-YES                                     18320001
183300        AND PS-DETAIL-CREATED-NO                                  18330001
183400         MOVE WS-EXT-SHP-ID          TO DK-EXT-SHP-ID             18340001
183500         PERFORM 2110-UPDATE-HDR-X                                18350001
183600         SET PS-CANCEL-SHPMT-NO      TO TRUE                      18360001
183700         SET PS-CHECK-ASN-NO         TO TRUE                      18370001
183800         SET PS-IMMED-DOWNLOAD-NO    TO TRUE                      18380001
183900         SET PS-HEADER-CREATED-NO    TO TRUE                      18390001
184000     END-IF.                                                      18400001
184100                                                                  18410001
184200     PERFORM 3150-CHECK-FOR-DOWNLOAD.                             18420001
184300                                                                  18430001
184400*    IF WS-DWNLD-TMST NOT = PC-DEFAULT-NINES                      18440001
184500*        SET PS-APPT-SENT-NO         TO TRUE                      18450001
184600*        SET PS-IMMED-DOWNLOAD-YES   TO TRUE                      18460001
184700*    END-IF.                                                      18470001
184800                                                                  18480001
184900/                                                                 18490001
185000 3010-OPEN-TRIP-ID-CSR.                                           18500001
185100     MOVE '3010-OPEN-TRIP-ID-CSR'                                 18510001
185200                                 TO WS001-PARAGRAPH-NAME.         18520001
185300                                                                  18530001
185400     SET PS-FIRST-RECORD-YES          TO TRUE.                    18540001
185500     SET PS-EOF-TRIP-ID-CSR-NO        TO TRUE.                    18550001
185600                                                                  18560001
185700     EXEC SQL                                                     18570001
185800          OPEN TRIP-ID-CSR                                        18580001
185900     END-EXEC.                                                    18590001
186000                                                                  18600001
186100     EVALUATE TRUE                                                18610001
186200         WHEN SQLCODE = ZERO                                      18620001
186300             IF PS-CICS-SWITCH-YES                                18630001
186400                 INITIALIZE PV-CICS-MSG-AREA                      18640001
186500                 MOVE DK-TRIP-ID        TO WS-DISPLAY-1           18650001
186600                 MOVE DK-PO-NBR         TO WS-DISPLAY-2           18660001
186700                 MOVE DK-RCVR-SEQ-NBR   TO WS-DISPLAY-4           18670001
186800                 STRING   ' ' WS001-SRC-TASK-NUMBER               18680001
186900                          ' WSKCS305-3010:'                       18690001
187000                          ' OPEN TRIP-ID-CSR'                     18700001
187100                          ' FOR TRIP=' WS-DISPLAY-1               18710001
187200                          ' PO=' WS-DISPLAY-2                     18720001
187300                          ' -' WS-DISPLAY-4                       18730001
187400                          DELIMITED BY SIZE                       18740001
187500                          INTO PV-CICS-MSG-AREA                   18750001
187600                 PERFORM 7000-WRITE-TO-CICS-LOG                   18760001
187700             END-IF                                               18770001
187800         WHEN SQLCODE = -904                                      18780001
187900         WHEN SQLCODE = -913                                      18790001
188000         WHEN SQLCODE = -911                                      18800001
188100              CONTINUE                                            18810001
188200         WHEN SQLWARN0 NOT = SPACES                               18820001
188300         WHEN SQLCODE NOT = ZERO                                  18830001
188400             MOVE SQLCODE               TO PV-SQL-RETURN-CD       18840001
188500             INITIALIZE PV-CICS-MSG-AREA                          18850001
188600             STRING   ' ' WS001-SRC-TASK-NUMBER                   18860001
188700                      ' WSKCS305-3010 ERROR:'                     18870001
188800                      ' SQL='                                     18880001
188900                      PV-SQL-RETURN-CD                            18890001
189000                      DELIMITED BY SIZE                           18900001
189100                      INTO PV-CICS-MSG-AREA                       18910001
189200             PERFORM 7000-WRITE-TO-CICS-LOG                       18920001
189300                                                                  18930001
189400             SET WS001-INVALID-SQL      TO TRUE                   18940001
189500             STRING 'SQL='                                        18950001
189600                  PV-SQL-RETURN-CD                                18960001
189700                  DELIMITED BY SIZE                               18970001
189800                                      INTO WS001-CRA-RET-MSG      18980001
189900             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  18990001
190000             MOVE SQLCA                 TO WS001-SQLCA            19000001
190100                                           DP013-SQLCA            19010001
190200             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        19020001
190300             SET DP013-DB2-ABEND        TO TRUE                   19030001
190400             PERFORM 9999-ABEND                                   19040001
190500     END-EVALUATE.                                                19050001
190600                                                                  19060001
190700/                                                                 19070001
190800 3020-FETCH-TRIP-ID-CSR.                                          19080001
190900                                                                  19090001
191000     MOVE '3020-FETCH-TRIP-ID-CSR'                                19100001
191100                                 TO WS001-PARAGRAPH-NAME.         19110001
191200                                                                  19120001
191300* GET DATA FROM WST_SHPMT_XREF_HDR & WST_SHPMT_XREF_DTL.          19130001
191400* KEYS ARE TRIP/PO/RCVR                                           19140001
191500* THERE COULD BE MULTIPLE ROWS RETURNED DUE TO DUMMY SHIPMENTS    19150001
191600                                                                  19160001
191700     EXEC SQL                                                     19170001
191800          FETCH TRIP-ID-CSR                                       19180001
191900          INTO                                                    19190001
192000                :WST00001-EXT-SHP-ID                              19200001
192100               ,:WST00001-DWNLD-TMST                              19210001
192200               ,:WST00001-DMY-SEQ-NBR                             19220001
192300               ,:WST00001-CRE-TMST                                19230001
192400     END-EXEC.                                                    19240001
192500                                                                  19250001
192600     EVALUATE TRUE                                                19260001
192700         WHEN SQLCODE = ZERO                                      19270001
192800             IF PS-FIRST-RECORD-YES                               19280001
192900                 MOVE WST00001-EXT-SHP-ID                         19290001
193000                                TO WS-HOLD-EXT-SHP-ID             19300001
193100                 SET PS-FIRST-RECORD-NO TO TRUE                   19310001
193200             END-IF                                               19320001
193300             MOVE WST00001-EXT-SHP-ID TO DK-EXT-SHP-ID            19330001
193400                                         WS-EXT-SHP-ID            19340001
193500             MOVE WST00001-DWNLD-TMST TO WS-DWNLD-TMST            19350001
193600             IF PS-CICS-SWITCH-YES                                19360001
193700                 INITIALIZE PV-CICS-MSG-AREA                      19370001
193800                 STRING   ' ' WS001-SRC-TASK-NUMBER               19380001
193900                          ' WSKCS305-3020:'                       19390001
194000                          ' SHPMT='                               19400001
194100                          DK-EXT-SHP-ID                           19410001
194200                          DELIMITED BY SIZE                       19420001
194300                          INTO PV-CICS-MSG-AREA                   19430001
194400                 PERFORM 7000-WRITE-TO-CICS-LOG                   19440001
194500             END-IF                                               19450001
194600             PERFORM 3040-UPDATE-DTL-REC                          19460001
194700             IF WS-DWNLD-TMST NOT = PC-DEFAULT-NINES              19470001
194800                 PERFORM 3050-UPDATE-HDR-REC                      19480001
194900             END-IF                                               19490001
195000                                                                  19500001
195100         WHEN SQLCODE = -904                                      19510001
195200         WHEN SQLCODE = -913                                      19520001
195300         WHEN SQLCODE = -911                                      19530001
195400              CONTINUE                                            19540001
195500         WHEN SQLCODE = +100                                      19550001
195600              SET PS-EOF-TRIP-ID-CSR-YES TO TRUE                  19560001
195700         WHEN SQLWARN0 NOT = SPACES                               19570001
195800         WHEN SQLCODE NOT = ZERO                                  19580001
195900             MOVE SQLCODE               TO PV-SQL-RETURN-CD       19590001
196000             INITIALIZE PV-CICS-MSG-AREA                          19600001
196100             STRING   ' ' WS001-SRC-TASK-NUMBER                   19610001
196200                      ' WSKCS305-3020 ERROR:'                     19620001
196300                      ' SQL='                                     19630001
196400                      PV-SQL-RETURN-CD                            19640001
196500                      DELIMITED BY SIZE                           19650001
196600                      INTO PV-CICS-MSG-AREA                       19660001
196700             PERFORM 7000-WRITE-TO-CICS-LOG                       19670001
196800                                                                  19680001
196900             SET WS001-INVALID-SQL      TO TRUE                   19690001
197000             STRING 'SQL='                                        19700001
197100                  PV-SQL-RETURN-CD                                19710001
197200                  DELIMITED BY SIZE                               19720001
197300                                      INTO WS001-CRA-RET-MSG      19730001
197400             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  19740001
197500             MOVE SQLCA                 TO WS001-SQLCA            19750001
197600                                           DP013-SQLCA            19760001
197700             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        19770001
197800             MOVE 'WST_SHPMT_XREF_HDR'  TO                        19780001
197900                                       DP013-DB2-TABLE-NAME (1)   19790001
198000             MOVE 'WST_SHPMT_XREF_DTL'  TO                        19800001
198100                                       DP013-DB2-TABLE-NAME (2)   19810001
198200             SET DP013-DB2-ABEND        TO TRUE                   19820001
198300             PERFORM 9999-ABEND                                   19830001
198400     END-EVALUATE.                                                19840001
198500                                                                  19850001
198600/                                                                 19860001
198700 3030-CLOSE-TRIP-ID-CSR.                                          19870001
198800                                                                  19880001
198900     MOVE '3030-CLOSE-TRIP-ID-CSR'                                19890001
199000                                 TO WS001-PARAGRAPH-NAME.         19900001
199100                                                                  19910001
199200     EXEC SQL                                                     19920001
199300          CLOSE TRIP-ID-CSR                                       19930001
199400     END-EXEC.                                                    19940001
199500                                                                  19950001
199600     EVALUATE TRUE                                                19960001
199700         WHEN SQLCODE = ZERO                                      19970001
199800             IF PS-CICS-SWITCH-YES                                19980001
199900                 INITIALIZE PV-CICS-MSG-AREA                      19990001
200000                 STRING   ' ' WS001-SRC-TASK-NUMBER               20000001
200100                          ' WSKCS305-3030:'                       20010001
200200                          ' CLOSE TRIP-ID-CSR'                    20020001
200300                          DELIMITED BY SIZE                       20030001
200400                          INTO PV-CICS-MSG-AREA                   20040001
200500                 PERFORM 7000-WRITE-TO-CICS-LOG                   20050001
200600             END-IF                                               20060001
200700         WHEN SQLCODE = -904                                      20070001
200800         WHEN SQLCODE = -913                                      20080001
200900         WHEN SQLCODE = -911                                      20090001
201000              CONTINUE                                            20100001
201100         WHEN SQLWARN0 NOT = SPACES                               20110001
201200         WHEN SQLCODE NOT = ZERO                                  20120001
201300             MOVE SQLCODE               TO PV-SQL-RETURN-CD       20130001
201400             INITIALIZE PV-CICS-MSG-AREA                          20140001
201500             STRING   ' ' WS001-SRC-TASK-NUMBER                   20150001
201600                      ' WSKCS305-3030 ERROR:'                     20160001
201700                      ' SQL='                                     20170001
201800                      PV-SQL-RETURN-CD                            20180001
201900                      DELIMITED BY SIZE                           20190001
202000                      INTO PV-CICS-MSG-AREA                       20200001
202100             PERFORM 7000-WRITE-TO-CICS-LOG                       20210001
202200                                                                  20220001
202300             SET WS001-INVALID-SQL      TO TRUE                   20230001
202400             STRING 'SQL='                                        20240001
202500                  PV-SQL-RETURN-CD                                20250001
202600                  DELIMITED BY SIZE                               20260001
202700                                      INTO WS001-CRA-RET-MSG      20270001
202800             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  20280001
202900             MOVE SQLCA                 TO WS001-SQLCA            20290001
203000                                           DP013-SQLCA            20300001
203100             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        20310001
203200             SET DP013-DB2-ABEND        TO TRUE                   20320001
203300             PERFORM 9999-ABEND                                   20330001
203400     END-EVALUATE.                                                20340001
203500                                                                  20350001
203600/                                                                 20360001
203700 3040-UPDATE-DTL-REC.                                             20370001
203800                                                                  20380001
203900     MOVE '3040-UPDATE-DTL-REC'  TO WS001-PARAGRAPH-NAME.         20390001
204000                                                                  20400001
204100     EXEC SQL                                                     20410001
204200          UPDATE WST_SHPMT_XREF_DTL                               20420001
204300             SET ACTV_CDE         = 'I'                           20430001
204400                ,DWNLD_CDE        = 'N'                           20440001
204500             WHERE EXT_SHP_ID     = :DK-EXT-SHP-ID                20450001
204600             AND   PO_NBR         = :DK-PO-NBR                    20460001
204700             AND   RCVR_SEQ_NBR   = :DK-RCVR-SEQ-NBR              20470001
204800     END-EXEC.                                                    20480001
204900                                                                  20490001
205000     EVALUATE TRUE                                                20500001
205100         WHEN SQLCODE = ZERO                                      20510001
205200             IF PS-CICS-SWITCH-YES                                20520001
205300                 MOVE DK-PO-NBR TO WS-DISPLAY-1                   20530001
205400                 MOVE DK-RCVR-SEQ-NBR TO WS-DISPLAY-2             20540001
205500                 INITIALIZE PV-CICS-MSG-AREA                      20550001
205600                 STRING   ' ' WS001-SRC-TASK-NUMBER               20560001
205700                          ' WSKCS305-3040:'                       20570001
205800                          ' UPDATE WST_SHPMT_XREF_DTL'            20580001
205900                          ' FOR SHPMT='                           20590001
206000                          DK-EXT-SHP-ID                           20600001
206100                          ' PO NBR='                              20610001
206200                          WS-DISPLAY-1                            20620001
206300                          ' RCVR SEQ='                            20630001
206400                          WS-DISPLAY-2                            20640001
206500                          DELIMITED BY SIZE                       20650001
206600                          INTO PV-CICS-MSG-AREA                   20660001
206700                 PERFORM 7000-WRITE-TO-CICS-LOG                   20670001
206800             END-IF                                               20680001
206900         WHEN SQLCODE = -904                                      20690001
207000         WHEN SQLCODE = -913                                      20700001
207100         WHEN SQLCODE = -911                                      20710001
207200              CONTINUE                                            20720001
207300         WHEN SQLWARN0 NOT = SPACES                               20730001
207400         WHEN SQLCODE NOT = ZERO                                  20740001
207500             MOVE SQLCODE               TO PV-SQL-RETURN-CD       20750001
207600             INITIALIZE PV-CICS-MSG-AREA                          20760001
207700             STRING   ' ' WS001-SRC-TASK-NUMBER                   20770001
207800                      ' WSKCS305-3040 ERROR:'                     20780001
207900                      ' SQL='                                     20790001
208000                      PV-SQL-RETURN-CD                            20800001
208100                      DELIMITED BY SIZE                           20810001
208200                      INTO PV-CICS-MSG-AREA                       20820001
208300             PERFORM 7000-WRITE-TO-CICS-LOG                       20830001
208400                                                                  20840001
208500             SET WS001-INVALID-SQL      TO TRUE                   20850001
208600             STRING 'SQL='                                        20860001
208700                  PV-SQL-RETURN-CD                                20870001
208800                  DELIMITED BY SIZE                               20880001
208900                                      INTO WS001-CRA-RET-MSG      20890001
209000             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  20900001
209100             MOVE SQLCA                 TO WS001-SQLCA            20910001
209200                                           DP013-SQLCA            20920001
209300             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        20930001
209400             MOVE 'WST_SHPMT_XREF_DTL'  TO                        20940001
209500                                       DP013-DB2-TABLE-NAME (1)   20950001
209600             SET DP013-DB2-ABEND        TO TRUE                   20960001
209700             PERFORM 9999-ABEND                                   20970001
209800     END-EVALUATE.                                                20980001
209900                                                                  20990001
210000/                                                                 21000001
210100 3050-UPDATE-HDR-REC.                                             21010001
210200                                                                  21020001
210300     MOVE '3050-UPDATE-HDR-REC'  TO WS001-PARAGRAPH-NAME.         21030001
210400                                                                  21040001
210500     EXEC SQL                                                     21050001
210600          UPDATE WST_SHPMT_XREF_HDR                               21060001
210700             SET DWNLD_CDE        = 'P'                           21070001
210800             WHERE EXT_SHP_ID     = :DK-EXT-SHP-ID                21080001
210900     END-EXEC.                                                    21090001
211000                                                                  21100001
211100     EVALUATE TRUE                                                21110001
211200         WHEN SQLCODE = ZERO                                      21120001
211300             IF PS-CICS-SWITCH-YES                                21130001
211400                 INITIALIZE PV-CICS-MSG-AREA                      21140001
211500                 STRING   ' ' WS001-SRC-TASK-NUMBER               21150001
211600                          ' WSKCS305-3050:'                       21160001
211700                          ' UPDATE WST_SHPMT_XREF_HDR'            21170001
211800                          ' FOR SHPMT='                           21180001
211900                          DK-EXT-SHP-ID                           21190001
212000                          DELIMITED BY SIZE                       21200001
212100                          INTO PV-CICS-MSG-AREA                   21210001
212200                 PERFORM 7000-WRITE-TO-CICS-LOG                   21220001
212300             END-IF                                               21230001
212400         WHEN SQLCODE = -904                                      21240001
212500         WHEN SQLCODE = -913                                      21250001
212600         WHEN SQLCODE = -911                                      21260001
212700              CONTINUE                                            21270001
212800         WHEN SQLWARN0 NOT = SPACES                               21280001
212900         WHEN SQLCODE NOT = ZERO                                  21290001
213000             MOVE SQLCODE               TO PV-SQL-RETURN-CD       21300001
213100             INITIALIZE PV-CICS-MSG-AREA                          21310001
213200             STRING   ' ' WS001-SRC-TASK-NUMBER                   21320001
213300                      ' WSKCS305-3050 ERROR:'                     21330001
213400                      ' SQL='                                     21340001
213500                      PV-SQL-RETURN-CD                            21350001
213600                      DELIMITED BY SIZE                           21360001
213700                      INTO PV-CICS-MSG-AREA                       21370001
213800             PERFORM 7000-WRITE-TO-CICS-LOG                       21380001
213900                                                                  21390001
214000             SET WS001-INVALID-SQL      TO TRUE                   21400001
214100             STRING 'SQL='                                        21410001
214200                  PV-SQL-RETURN-CD                                21420001
214300                  DELIMITED BY SIZE                               21430001
214400                                      INTO WS001-CRA-RET-MSG      21440001
214500             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  21450001
214600             MOVE SQLCA                 TO WS001-SQLCA            21460001
214700                                           DP013-SQLCA            21470001
214800             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        21480001
214900             MOVE 'WST_SHPMT_XREF_HDR'  TO                        21490001
215000                                       DP013-DB2-TABLE-NAME (1)   21500001
215100             SET DP013-DB2-ABEND        TO TRUE                   21510001
215200             PERFORM 9999-ABEND                                   21520001
215300     END-EVALUATE.                                                21530001
215400                                                                  21540001
215500/                                                                 21550001
215600 3060-CHECK-FOR-TRIP-HDR.                                         21560001
215700                                                                  21570001
215800     MOVE '3060-CHECK-FOR-TRIP-HDR' TO WS001-PARAGRAPH-NAME.      21580001
215900                                                                  21590001
216000     EXEC SQL                                                     21600001
216100          SELECT EXT_SHP_ID                                       21610001
216200          INTO   :WST00001-EXT-SHP-ID                             21620001
216300          FROM   WST_SHPMT_XREF_HDR                               21630001
216400          WHERE  INTR_TRIP_ID  = :DK-TRIP-ID                      21640001
216500          AND    SOR_CDE       = 'RC'                             21650001
216600     END-EXEC.                                                    21660001
216700                                                                  21670001
216800     EVALUATE TRUE                                                21680001
216900         WHEN SQLCODE = ZERO                                      21690001
217000         WHEN SQLCODE = -811                                      21700001
217100             SET PS-TRIP-HDR-EXIST-YES TO TRUE                    21710001
217200             MOVE WST00001-EXT-SHP-ID  TO WS-EXT-SHP-ID           21720001
217300                                          DK-EXT-SHP-ID           21730001
217400             IF PS-CICS-SWITCH-YES                                21740001
217500                 INITIALIZE PV-CICS-MSG-AREA                      21750001
217600                 MOVE DK-TRIP-ID TO WS-DISPLAY-1                  21760001
217700                 STRING   ' ' WS001-SRC-TASK-NUMBER               21770001
217800                          ' WSKCS305-3060:'                       21780001
217900                          ' FOUND XREF_HDR FOR TRIP='             21790001
218000                          WS-DISPLAY-1                            21800001
218100                          ' SHPMT=' WST00001-EXT-SHP-ID           21810001
218200                          DELIMITED BY SIZE                       21820001
218300                          INTO PV-CICS-MSG-AREA                   21830001
218400                 PERFORM 7000-WRITE-TO-CICS-LOG                   21840001
218500             END-IF                                               21850001
218600         WHEN SQLCODE = +100                                      21860001
218700         WHEN SQLCODE = -904                                      21870001
218800         WHEN SQLCODE = -913                                      21880001
218900         WHEN SQLCODE = -911                                      21890001
219000              CONTINUE                                            21900001
219100         WHEN SQLWARN0 NOT = SPACES                               21910001
219200         WHEN SQLCODE NOT = ZERO                                  21920001
219300             MOVE SQLCODE               TO PV-SQL-RETURN-CD       21930001
219400             INITIALIZE PV-CICS-MSG-AREA                          21940001
219500             STRING   ' ' WS001-SRC-TASK-NUMBER                   21950001
219600                      ' WSKCS305-3060 ERROR:'                     21960001
219700                      ' SQL='                                     21970001
219800                      PV-SQL-RETURN-CD                            21980001
219900                      DELIMITED BY SIZE                           21990001
220000                      INTO PV-CICS-MSG-AREA                       22000001
220100             PERFORM 7000-WRITE-TO-CICS-LOG                       22010001
220200                                                                  22020001
220300             SET WS001-INVALID-SQL      TO TRUE                   22030001
220400             STRING 'SQL='                                        22040001
220500                  PV-SQL-RETURN-CD                                22050001
220600                  DELIMITED BY SIZE                               22060001
220700                                      INTO WS001-CRA-RET-MSG      22070001
220800             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  22080001
220900             MOVE SQLCA                 TO WS001-SQLCA            22090001
221000                                           DP013-SQLCA            22100001
221100             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        22110001
221200             MOVE 'WST_SHPMT_XREF_HDR'  TO                        22120001
221300                                       DP013-DB2-TABLE-NAME (1)   22130001
221400             SET DP013-DB2-ABEND        TO TRUE                   22140001
221500             PERFORM 9999-ABEND                                   22150001
221600     END-EVALUATE.                                                22160001
221700                                                                  22170001
221800 3100-CHECK-FOR-INACTIVE.                                         22180001
221900                                                                  22190001
222000* CHECK FOR ANY OF THE HEADERS FOR THIS TRIP/PO/RCVR WHERE        22200001
222100* ALL OF THE DETAIL ROWS ARE INACTIVE.  IF FOUND, THEN            22210001
222200* SET THE CANCEL SWITCH.  THIS WILL CAUSE THE DWNLD-CDE           22220001
222300* FOR THE HEADER TO GET SET TO 'X' IN WSKCS302.                   22230001
222400                                                                  22240001
222500     MOVE '3100-CHECK-FOR-INACTIVE' TO WS001-PARAGRAPH-NAME.      22250001
222600                                                                  22260001
222700     PERFORM 3110-OPEN-TRIP-INACT-CSR.                            22270001
222800     PERFORM 3120-FETCH-TRIP-INACT-CSR UNTIL                      22280001
222900             PS-EOF-TRIP-INACT-CSR-YES.                           22290001
223000     PERFORM 3130-CLOSE-TRIP-INACT-CSR.                           22300001
223100/                                                                 22310001
223200 3110-OPEN-TRIP-INACT-CSR.                                        22320001
223300     MOVE '3110-OPEN-TRIP-INACT-CSR'                              22330001
223400                                 TO WS001-PARAGRAPH-NAME.         22340001
223500                                                                  22350001
223600     SET PS-EOF-TRIP-INACT-CSR-NO     TO TRUE.                    22360001
223700                                                                  22370001
223800     EXEC SQL                                                     22380001
223900          OPEN TRIP-INACT-CSR                                     22390001
224000     END-EXEC.                                                    22400001
224100                                                                  22410001
224200     EVALUATE TRUE                                                22420001
224300         WHEN SQLCODE = ZERO                                      22430001
224400             IF PS-CICS-SWITCH-YES                                22440001
224500                 INITIALIZE PV-CICS-MSG-AREA                      22450001
224600                 MOVE DK-TRIP-ID        TO WS-DISPLAY-1           22460001
224700                 MOVE DK-PO-NBR         TO WS-DISPLAY-2           22470001
224800                 MOVE DK-RCVR-SEQ-NBR   TO WS-DISPLAY-4           22480001
224900                 STRING   ' ' WS001-SRC-TASK-NUMBER               22490001
225000                          ' WSKCS305-3110:'                       22500001
225100                          ' OPEN TRIP-INACT-CSR'                  22510001
225200                          ' FOR TRIP=' WS-DISPLAY-1               22520001
225300                          ' PO=' WS-DISPLAY-2                     22530001
225400                          ' -' WS-DISPLAY-4                       22540001
225500                          DELIMITED BY SIZE                       22550001
225600                          INTO PV-CICS-MSG-AREA                   22560001
225700                 PERFORM 7000-WRITE-TO-CICS-LOG                   22570001
225800             END-IF                                               22580001
225900         WHEN SQLCODE = -904                                      22590001
226000         WHEN SQLCODE = -913                                      22600001
226100         WHEN SQLCODE = -911                                      22610001
226200              CONTINUE                                            22620001
226300         WHEN SQLWARN0 NOT = SPACES                               22630001
226400         WHEN SQLCODE NOT = ZERO                                  22640001
226500             MOVE SQLCODE               TO PV-SQL-RETURN-CD       22650001
226600             INITIALIZE PV-CICS-MSG-AREA                          22660001
226700             STRING   ' ' WS001-SRC-TASK-NUMBER                   22670001
226800                      ' WSKCS305-3110 ERROR:'                     22680001
226900                      ' SQL='                                     22690001
227000                      PV-SQL-RETURN-CD                            22700001
227100                      DELIMITED BY SIZE                           22710001
227200                      INTO PV-CICS-MSG-AREA                       22720001
227300             PERFORM 7000-WRITE-TO-CICS-LOG                       22730001
227400                                                                  22740001
227500             SET WS001-INVALID-SQL      TO TRUE                   22750001
227600             STRING 'SQL='                                        22760001
227700                  PV-SQL-RETURN-CD                                22770001
227800                  DELIMITED BY SIZE                               22780001
227900                                      INTO WS001-CRA-RET-MSG      22790001
228000             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  22800001
228100             MOVE SQLCA                 TO WS001-SQLCA            22810001
228200                                           DP013-SQLCA            22820001
228300             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        22830001
228400             SET DP013-DB2-ABEND        TO TRUE                   22840001
228500             PERFORM 9999-ABEND                                   22850001
228600     END-EVALUATE.                                                22860001
228700                                                                  22870001
228800/                                                                 22880001
228900 3120-FETCH-TRIP-INACT-CSR.                                       22890001
229000                                                                  22900001
229100     MOVE '3120-FETCH-TRIP-INACT-CSR'                             22910001
229200                                 TO WS001-PARAGRAPH-NAME.         22920001
229300                                                                  22930001
229400* GET DATA FROM WST_SHPMT_XREF_HDR & WST_SHPMT_XREF_DTL.          22940001
229500* KEYS ARE TRIP/PO/RCVR                                           22950001
229600* THERE COULD BE MULTIPLE ROWS RETURNED DUE TO DUMMY SHIPMENTS    22960001
229700                                                                  22970001
229800     EXEC SQL                                                     22980001
229900          FETCH TRIP-INACT-CSR                                    22990001
230000          INTO                                                    23000001
230100                :WST00001-EXT-SHP-ID                              23010001
230200               ,:WST00001-DWNLD-TMST                              23020001
230300     END-EXEC.                                                    23030001
230400                                                                  23040001
230500     EVALUATE TRUE                                                23050001
230600         WHEN SQLCODE = ZERO                                      23060001
230700             MOVE WST00001-EXT-SHP-ID TO DK-EXT-SHP-ID            23070001
230800                                         WS-EXT-SHP-ID            23080001
230900             MOVE WST00001-DWNLD-TMST TO WS-DWNLD-TMST            23090001
231000             IF PS-CICS-SWITCH-YES                                23100001
231100                 INITIALIZE PV-CICS-MSG-AREA                      23110001
231200                 STRING   ' ' WS001-SRC-TASK-NUMBER               23120001
231300                          ' WSKCS305-3120:'                       23130001
231400                          ' SHPMT='                               23140001
231500                          DK-EXT-SHP-ID                           23150001
231600                          DELIMITED BY SIZE                       23160001
231700                          INTO PV-CICS-MSG-AREA                   23170001
231800                 PERFORM 7000-WRITE-TO-CICS-LOG                   23180001
231900             END-IF                                               23190001
232000*            PERFORM 2110-UPDATE-HDR-X                            23200001
232100             SET PS-CANCEL-SHPMT-YES    TO TRUE                   23210001
232200             IF WS-DWNLD-TMST NOT = PC-DEFAULT-NINES              23220001
232300                 SET PS-APPT-SENT-NO         TO TRUE              23230001
232400                 PERFORM 5700-CALL-DOWNLOAD-MOD                   23240001
232500                 SET PS-IMMED-DOWNLOAD-NO    TO TRUE              23250001
232600             ELSE                                                 23260001
232700                 PERFORM 2110-UPDATE-HDR-X                        23270001
232800                 SET PS-IMMED-DOWNLOAD-NO    TO TRUE              23280001
232900                 SET PS-CHECK-ASN-NO         TO TRUE              23290001
233000             END-IF                                               23300001
233100                                                                  23310001
233200         WHEN SQLCODE = -904                                      23320001
233300         WHEN SQLCODE = -913                                      23330001
233400         WHEN SQLCODE = -911                                      23340001
233500              CONTINUE                                            23350001
233600         WHEN SQLCODE = +100                                      23360001
233700              SET PS-EOF-TRIP-INACT-CSR-YES TO TRUE               23370001
233800         WHEN SQLWARN0 NOT = SPACES                               23380001
233900         WHEN SQLCODE NOT = ZERO                                  23390001
234000             MOVE SQLCODE               TO PV-SQL-RETURN-CD       23400001
234100             INITIALIZE PV-CICS-MSG-AREA                          23410001
234200             STRING   ' ' WS001-SRC-TASK-NUMBER                   23420001
234300                      ' WSKCS305-3120 ERROR:'                     23430001
234400                      ' SQL='                                     23440001
234500                      PV-SQL-RETURN-CD                            23450001
234600                      DELIMITED BY SIZE                           23460001
234700                      INTO PV-CICS-MSG-AREA                       23470001
234800             PERFORM 7000-WRITE-TO-CICS-LOG                       23480001
234900                                                                  23490001
235000             SET WS001-INVALID-SQL      TO TRUE                   23500001
235100             STRING 'SQL='                                        23510001
235200                  PV-SQL-RETURN-CD                                23520001
235300                  DELIMITED BY SIZE                               23530001
235400                                      INTO WS001-CRA-RET-MSG      23540001
235500             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  23550001
235600             MOVE SQLCA                 TO WS001-SQLCA            23560001
235700                                           DP013-SQLCA            23570001
235800             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        23580001
235900             MOVE 'WST_SHPMT_XREF_HDR'  TO                        23590001
236000                                       DP013-DB2-TABLE-NAME (1)   23600001
236100             MOVE 'WST_SHPMT_XREF_DTL'  TO                        23610001
236200                                       DP013-DB2-TABLE-NAME (2)   23620001
236300             SET DP013-DB2-ABEND        TO TRUE                   23630001
236400             PERFORM 9999-ABEND                                   23640001
236500     END-EVALUATE.                                                23650001
236600                                                                  23660001
236700/                                                                 23670001
236800 3130-CLOSE-TRIP-INACT-CSR.                                       23680001
236900                                                                  23690001
237000     MOVE '3130-CLOSE-TRIP-INACT-CSR'                             23700001
237100                                 TO WS001-PARAGRAPH-NAME.         23710001
237200                                                                  23720001
237300     EXEC SQL                                                     23730001
237400          CLOSE TRIP-INACT-CSR                                    23740001
237500     END-EXEC.                                                    23750001
237600                                                                  23760001
237700     EVALUATE TRUE                                                23770001
237800         WHEN SQLCODE = ZERO                                      23780001
237900             IF PS-CICS-SWITCH-YES                                23790001
238000                 INITIALIZE PV-CICS-MSG-AREA                      23800001
238100                 STRING   ' ' WS001-SRC-TASK-NUMBER               23810001
238200                          ' WSKCS305-3130:'                       23820001
238300                          ' CLOSE TRIP-INACT-CSR'                 23830001
238400                          DELIMITED BY SIZE                       23840001
238500                          INTO PV-CICS-MSG-AREA                   23850001
238600                 PERFORM 7000-WRITE-TO-CICS-LOG                   23860001
238700             END-IF                                               23870001
238800         WHEN SQLCODE = -904                                      23880001
238900         WHEN SQLCODE = -913                                      23890001
239000         WHEN SQLCODE = -911                                      23900001
239100              CONTINUE                                            23910001
239200         WHEN SQLWARN0 NOT = SPACES                               23920001
239300         WHEN SQLCODE NOT = ZERO                                  23930001
239400             MOVE SQLCODE               TO PV-SQL-RETURN-CD       23940001
239500             INITIALIZE PV-CICS-MSG-AREA                          23950001
239600             STRING   ' ' WS001-SRC-TASK-NUMBER                   23960001
239700                      ' WSKCS305-3130 ERROR:'                     23970001
239800                      ' SQL='                                     23980001
239900                      PV-SQL-RETURN-CD                            23990001
240000                      DELIMITED BY SIZE                           24000001
240100                      INTO PV-CICS-MSG-AREA                       24010001
240200             PERFORM 7000-WRITE-TO-CICS-LOG                       24020001
240300                                                                  24030001
240400             SET WS001-INVALID-SQL      TO TRUE                   24040001
240500             STRING 'SQL='                                        24050001
240600                  PV-SQL-RETURN-CD                                24060001
240700                  DELIMITED BY SIZE                               24070001
240800                                      INTO WS001-CRA-RET-MSG      24080001
240900             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  24090001
241000             MOVE SQLCA                 TO WS001-SQLCA            24100001
241100                                           DP013-SQLCA            24110001
241200             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        24120001
241300             SET DP013-DB2-ABEND        TO TRUE                   24130001
241400             PERFORM 9999-ABEND                                   24140001
241500     END-EVALUATE.                                                24150001
241600                                                                  24160001
241700/                                                                 24170001
241800 3150-CHECK-FOR-DOWNLOAD.                                         24180001
241900                                                                  24190001
242000* CHECK FOR ANY OF THE HEADERS FOR THIS TRIP/PO/RCVR WHERE        24200001
242100* THE HEADER HAS BEEN DOWNLOADED PREVIOUSLY.  FOR EACH ONE        24210001
242200* FOUND, CALL THE ASN DOWNLOAD MODULE.                            24220001
242300                                                                  24230001
242400     MOVE '3150-CHECK-FOR-DOWNLOAD' TO WS001-PARAGRAPH-NAME.      24240001
242500                                                                  24250001
242600     PERFORM 3160-OPEN-TRIP-DWNLD-CSR.                            24260001
242700     PERFORM 3170-FETCH-TRIP-DWNLD-CSR UNTIL                      24270001
242800             PS-EOF-TRIP-DWNLD-CSR-YES.                           24280001
242900     PERFORM 3180-CLOSE-TRIP-DWNLD-CSR.                           24290001
243000/                                                                 24300001
243100 3160-OPEN-TRIP-DWNLD-CSR.                                        24310001
243200     MOVE '3160-OPEN-TRIP-DWNLD-CSR'                              24320001
243300                                 TO WS001-PARAGRAPH-NAME.         24330001
243400                                                                  24340001
243500     SET PS-EOF-TRIP-DWNLD-CSR-NO     TO TRUE.                    24350001
243600                                                                  24360001
243700     EXEC SQL                                                     24370001
243800          OPEN TRIP-DWNLD-CSR                                     24380001
243900     END-EXEC.                                                    24390001
244000                                                                  24400001
244100     EVALUATE TRUE                                                24410001
244200         WHEN SQLCODE = ZERO                                      24420001
244300             IF PS-CICS-SWITCH-YES                                24430001
244400                 INITIALIZE PV-CICS-MSG-AREA                      24440001
244500                 MOVE DK-TRIP-ID        TO WS-DISPLAY-1           24450001
244600                 MOVE DK-PO-NBR         TO WS-DISPLAY-2           24460001
244700                 MOVE DK-RCVR-SEQ-NBR   TO WS-DISPLAY-4           24470001
244800                 STRING   ' ' WS001-SRC-TASK-NUMBER               24480001
244900                          ' WSKCS305-3160:'                       24490001
245000                          ' OPEN TRIP-DWNLD-CSR'                  24500001
245100                          ' FOR TRIP=' WS-DISPLAY-1               24510001
245200                          ' PO=' WS-DISPLAY-2                     24520001
245300                          ' -' WS-DISPLAY-4                       24530001
245400                          DELIMITED BY SIZE                       24540001
245500                          INTO PV-CICS-MSG-AREA                   24550001
245600                 PERFORM 7000-WRITE-TO-CICS-LOG                   24560001
245700             END-IF                                               24570001
245800         WHEN SQLCODE = -904                                      24580001
245900         WHEN SQLCODE = -913                                      24590001
246000         WHEN SQLCODE = -911                                      24600001
246100              CONTINUE                                            24610001
246200         WHEN SQLWARN0 NOT = SPACES                               24620001
246300         WHEN SQLCODE NOT = ZERO                                  24630001
246400             MOVE SQLCODE               TO PV-SQL-RETURN-CD       24640001
246500             INITIALIZE PV-CICS-MSG-AREA                          24650001
246600             STRING   ' ' WS001-SRC-TASK-NUMBER                   24660001
246700                      ' WSKCS305-3160 ERROR:'                     24670001
246800                      ' SQL='                                     24680001
246900                      PV-SQL-RETURN-CD                            24690001
247000                      DELIMITED BY SIZE                           24700001
247100                      INTO PV-CICS-MSG-AREA                       24710001
247200             PERFORM 7000-WRITE-TO-CICS-LOG                       24720001
247300                                                                  24730001
247400             SET WS001-INVALID-SQL      TO TRUE                   24740001
247500             STRING 'SQL='                                        24750001
247600                  PV-SQL-RETURN-CD                                24760001
247700                  DELIMITED BY SIZE                               24770001
247800                                      INTO WS001-CRA-RET-MSG      24780001
247900             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  24790001
248000             MOVE SQLCA                 TO WS001-SQLCA            24800001
248100                                           DP013-SQLCA            24810001
248200             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        24820001
248300             SET DP013-DB2-ABEND        TO TRUE                   24830001
248400             PERFORM 9999-ABEND                                   24840001
248500     END-EVALUATE.                                                24850001
248600                                                                  24860001
248700/                                                                 24870001
248800 3170-FETCH-TRIP-DWNLD-CSR.                                       24880001
248900                                                                  24890001
249000     MOVE '3170-FETCH-TRIP-DWNLD-CSR'                             24900001
249100                                 TO WS001-PARAGRAPH-NAME.         24910001
249200                                                                  24920001
249300* GET DATA FROM WST_SHPMT_XREF_HDR                                24930001
249400* KEYS ARE TRIP/PO/RCVR                                           24940001
249500* THERE COULD BE MULTIPLE ROWS RETURNED DUE TO DUMMY SHIPMENTS    24950001
249600                                                                  24960001
249700     EXEC SQL                                                     24970001
249800          FETCH TRIP-DWNLD-CSR                                    24980001
249900          INTO                                                    24990001
250000                :WST00001-EXT-SHP-ID                              25000001
250100     END-EXEC.                                                    25010001
250200                                                                  25020001
250300     EVALUATE TRUE                                                25030001
250400         WHEN SQLCODE = ZERO                                      25040001
250500             MOVE WST00001-EXT-SHP-ID TO DK-EXT-SHP-ID            25050001
250600                                         WS-EXT-SHP-ID            25060001
250700             IF PS-CICS-SWITCH-YES                                25070001
250800                 INITIALIZE PV-CICS-MSG-AREA                      25080001
250900                 STRING   ' ' WS001-SRC-TASK-NUMBER               25090001
251000                          ' WSKCS305-3170:'                       25100001
251100                          ' SHPMT='                               25110001
251200                          DK-EXT-SHP-ID                           25120001
251300                          DELIMITED BY SIZE                       25130001
251400                          INTO PV-CICS-MSG-AREA                   25140001
251500                 PERFORM 7000-WRITE-TO-CICS-LOG                   25150001
251600             END-IF                                               25160001
251700             SET PS-APPT-SENT-NO         TO TRUE                  25170001
251800             PERFORM 5700-CALL-DOWNLOAD-MOD                       25180001
251900                                                                  25190001
252000         WHEN SQLCODE = -904                                      25200001
252100         WHEN SQLCODE = -913                                      25210001
252200         WHEN SQLCODE = -911                                      25220001
252300              CONTINUE                                            25230001
252400         WHEN SQLCODE = +100                                      25240001
252500              SET PS-EOF-TRIP-DWNLD-CSR-YES TO TRUE               25250001
252600         WHEN SQLWARN0 NOT = SPACES                               25260001
252700         WHEN SQLCODE NOT = ZERO                                  25270001
252800             MOVE SQLCODE               TO PV-SQL-RETURN-CD       25280001
252900             INITIALIZE PV-CICS-MSG-AREA                          25290001
253000             STRING   ' ' WS001-SRC-TASK-NUMBER                   25300001
253100                      ' WSKCS305-3170 ERROR:'                     25310001
253200                      ' SQL='                                     25320001
253300                      PV-SQL-RETURN-CD                            25330001
253400                      DELIMITED BY SIZE                           25340001
253500                      INTO PV-CICS-MSG-AREA                       25350001
253600             PERFORM 7000-WRITE-TO-CICS-LOG                       25360001
253700                                                                  25370001
253800             SET WS001-INVALID-SQL      TO TRUE                   25380001
253900             STRING 'SQL='                                        25390001
254000                  PV-SQL-RETURN-CD                                25400001
254100                  DELIMITED BY SIZE                               25410001
254200                                      INTO WS001-CRA-RET-MSG      25420001
254300             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  25430001
254400             MOVE SQLCA                 TO WS001-SQLCA            25440001
254500                                           DP013-SQLCA            25450001
254600             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        25460001
254700             MOVE 'WST_SHPMT_XREF_HDR'  TO                        25470001
254800                                       DP013-DB2-TABLE-NAME (1)   25480001
254900             SET DP013-DB2-ABEND        TO TRUE                   25490001
255000             PERFORM 9999-ABEND                                   25500001
255100     END-EVALUATE.                                                25510001
255200                                                                  25520001
255300/                                                                 25530001
255400 3180-CLOSE-TRIP-DWNLD-CSR.                                       25540001
255500                                                                  25550001
255600     MOVE '3180-CLOSE-TRIP-DWNLD-CSR'                             25560001
255700                                 TO WS001-PARAGRAPH-NAME.         25570001
255800                                                                  25580001
255900     EXEC SQL                                                     25590001
256000          CLOSE TRIP-DWNLD-CSR                                    25600001
256100     END-EXEC.                                                    25610001
256200                                                                  25620001
256300     EVALUATE TRUE                                                25630001
256400         WHEN SQLCODE = ZERO                                      25640001
256500             IF PS-CICS-SWITCH-YES                                25650001
256600                 INITIALIZE PV-CICS-MSG-AREA                      25660001
256700                 STRING   ' ' WS001-SRC-TASK-NUMBER               25670001
256800                          ' WSKCS305-3180:'                       25680001
256900                          ' CLOSE TRIP-DWNLD-CSR'                 25690001
257000                          DELIMITED BY SIZE                       25700001
257100                          INTO PV-CICS-MSG-AREA                   25710001
257200                 PERFORM 7000-WRITE-TO-CICS-LOG                   25720001
257300             END-IF                                               25730001
257400         WHEN SQLCODE = -904                                      25740001
257500         WHEN SQLCODE = -913                                      25750001
257600         WHEN SQLCODE = -911                                      25760001
257700              CONTINUE                                            25770001
257800         WHEN SQLWARN0 NOT = SPACES                               25780001
257900         WHEN SQLCODE NOT = ZERO                                  25790001
258000             MOVE SQLCODE               TO PV-SQL-RETURN-CD       25800001
258100             INITIALIZE PV-CICS-MSG-AREA                          25810001
258200             STRING   ' ' WS001-SRC-TASK-NUMBER                   25820001
258300                      ' WSKCS305-3180 ERROR:'                     25830001
258400                      ' SQL='                                     25840001
258500                      PV-SQL-RETURN-CD                            25850001
258600                      DELIMITED BY SIZE                           25860001
258700                      INTO PV-CICS-MSG-AREA                       25870001
258800             PERFORM 7000-WRITE-TO-CICS-LOG                       25880001
258900                                                                  25890001
259000             SET WS001-INVALID-SQL      TO TRUE                   25900001
259100             STRING 'SQL='                                        25910001
259200                  PV-SQL-RETURN-CD                                25920001
259300                  DELIMITED BY SIZE                               25930001
259400                                      INTO WS001-CRA-RET-MSG      25940001
259500             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  25950001
259600             MOVE SQLCA                 TO WS001-SQLCA            25960001
259700                                           DP013-SQLCA            25970001
259800             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        25980001
259900             SET DP013-DB2-ABEND        TO TRUE                   25990001
260000             PERFORM 9999-ABEND                                   26000001
260100     END-EVALUATE.                                                26010001
260200                                                                  26020001
260300/                                                                 26030001
260400 4000-MANUAL-DOWNLOAD.                                            26040001
260500                                                                  26050001
260600**************************************************************    26060001
260700* MANUAL DOWNLOAD PROCESSING - SUMMARY                            26070001
260800*   - CHECK TO SEE IF THERE ARE ANY DUMMY SHIPMENTS FOR THIS TRIP 26080001
260900*     IF THERE ARE 1 OR MORE DUMMY SHIPMENTS, THEN SET THE        26090001
261000*     SWITCH TO INDICATE THAT NO UPDATING WILL BE DONE.           26100001
261100*                                                                 26110001
261200*   - OPEN THE HDR-CSR-1.  THIS CURSOR GETS THE EXT_SHP_ID FROM   26120001
261300*     WST_SHPMT_XREF_HDR FOR THE INPUT TRIP_ID, WHERE THE         26130001
261400*     SOR_CDE = 'RC' AND RECEIVING HAS NOT BEGUN.                 26140001
261500*                                                                 26150001
261600*   - IF THERE ARE NO RECORDS ON THE HDR FILE, THEN CREATE THE    26160001
261700*     HDR AND DTL ROWS.  SET THE CHECK-ASN SWITCH ON, SO THAT THE 26170001
261800*     SHIPMENT WILL BE SPLIT OUT IF THERE ARE BOTH CASE AND SKU   26180001
261900*     DATA ON THE SHIPMENT.  THE HEADER(S) WILL BE DOWNLOADED.    26190001
262000*                                                                 26200001
262100*   - IF THERE IS ONE RECORD ON THE HDR FILE, THEN CHECK TO SEE   26210001
262200*     IF THERE ARE ADDITIONAL PO'S THAT SHOULD BE ADDED TO THE    26220001
262300*     SHIPMENT.  SET THE CHECK-ASN SWITCH ON, SO THAT THE         26230001
262400*     SHIPMENT WILL BE SPLIT OUT IF THERE ARE BOTH CASE AND SKU   26240001
262500*     DATA ON THE SHIPMENT.  THE HEADER(S) WILL BE DOWNLOADED.    26250001
262600*                                                                 26260001
262700*   - IF THERE IS MORE THAN ONE RECORD ON THE HDR FILE (THIS      26270001
262800*     WILL BE AN ORIGINAL AND ONE OR MORE DUMMY SHIPMENTS),       26280001
262900*     DO NOT UPDATE OR INSERT TO ANY OF THE HEADERS.              26290001
263000*     THE HEADER(S) WILL BE DOWNLOADED.                           26300001
263100**************************************************************    26310001
263200                                                                  26320001
263300     MOVE '4000-MANUAL-DOWNLOAD' TO WS001-PARAGRAPH-NAME.         26330001
263400     SET PS-CHECK-ASN-NO              TO TRUE.                    26340001
263500                                                                  26350001
263600* CHECK TO SEE IF THERE ARE ANY DUMMY RECORDS FOR THIS SHIPMENT   26360001
263700* IF THERE ARE, THEN WE DO NOT WANT TO ADD PO'S TO THIS SHIPMENT  26370001
263800                                                                  26380001
263900     PERFORM 5010-GET-MAX-DMY-NBR.                                26390001
264000     IF WS-DMY-SEQ-NBR > 0                                        26400001
264100         SET PS-MANUAL-UPDATE-NO      TO TRUE                     26410001
264200     ELSE                                                         26420001
264300         SET PS-MANUAL-UPDATE-YES     TO TRUE                     26430001
264400     END-IF.                                                      26440001
264500                                                                  26450001
264600     PERFORM 4010-OPEN-HDR-CSR-1.                                 26460001
264700     PERFORM 4020-FETCH-HDR-CSR-1 UNTIL                           26470001
264800             PS-EOF-HDR-CSR-1-YES.                                26480001
264900     PERFORM 4030-CLOSE-HDR-CSR-1.                                26490001
265000                                                                  26500001
265100/                                                                 26510001
265200 4010-OPEN-HDR-CSR-1.                                             26520001
265300                                                                  26530001
265400     MOVE '4010-OPEN-HDR-CSR-1'  TO WS001-PARAGRAPH-NAME.         26540001
265500                                                                  26550001
265600     SET PS-EOF-HDR-CSR-1-NO        TO TRUE.                      26560001
265700                                                                  26570001
265800     EXEC SQL                                                     26580001
265900          OPEN HDR-CSR-1                                          26590001
266000     END-EXEC.                                                    26600001
266100                                                                  26610001
266200     EVALUATE TRUE                                                26620001
266300         WHEN SQLCODE = ZERO                                      26630001
266400             IF PS-CICS-SWITCH-YES                                26640001
266500                 INITIALIZE PV-CICS-MSG-AREA                      26650001
266600                 MOVE DK-TRIP-ID         TO WS-DISPLAY-1          26660001
266700                 STRING   ' ' WS001-SRC-TASK-NUMBER               26670001
266800                          ' WSKCS305-4010:'                       26680001
266900                          ' OPEN HDR-CSR-1'                       26690001
267000                          ' FOR TRIP=' WS-DISPLAY-1               26700001
267100                          DELIMITED BY SIZE                       26710001
267200                          INTO PV-CICS-MSG-AREA                   26720001
267300                 PERFORM 7000-WRITE-TO-CICS-LOG                   26730001
267400             END-IF                                               26740001
267500         WHEN SQLCODE = -904                                      26750001
267600         WHEN SQLCODE = -913                                      26760001
267700         WHEN SQLCODE = -911                                      26770001
267800              CONTINUE                                            26780001
267900         WHEN SQLWARN0 NOT = SPACES                               26790001
268000         WHEN SQLCODE NOT = ZERO                                  26800001
268100               MOVE SQLCODE               TO PV-SQL-RETURN-CD     26810001
268200               INITIALIZE PV-CICS-MSG-AREA                        26820001
268300               STRING   ' ' WS001-SRC-TASK-NUMBER                 26830001
268400                        ' WSKCS305-4010 ERROR:'                   26840001
268500                        ' SQL='                                   26850001
268600                        PV-SQL-RETURN-CD                          26860001
268700                        DELIMITED BY SIZE                         26870001
268800                        INTO PV-CICS-MSG-AREA                     26880001
268900               PERFORM 7000-WRITE-TO-CICS-LOG                     26890001
269000                                                                  26900001
269100             SET WS001-INVALID-SQL      TO TRUE                   26910001
269200             STRING 'SQL='                                        26920001
269300                  PV-SQL-RETURN-CD                                26930001
269400                  DELIMITED BY SIZE                               26940001
269500                                      INTO WS001-CRA-RET-MSG      26950001
269600             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  26960001
269700             MOVE SQLCA                 TO WS001-SQLCA            26970001
269800                                           DP013-SQLCA            26980001
269900             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        26990001
270000             SET DP013-DB2-ABEND        TO TRUE                   27000001
270100             PERFORM 9999-ABEND                                   27010001
270200     END-EVALUATE.                                                27020001
270300                                                                  27030001
270400     SET PS-FIRST-HDR-CSR-1-YES    TO TRUE.                       27040001
270500                                                                  27050001
270600/                                                                 27060001
270700 4020-FETCH-HDR-CSR-1.                                            27070001
270800                                                                  27080001
270900     MOVE '4020-FETCH-HDR-CSR-1' TO WS001-PARAGRAPH-NAME.         27090001
271000                                                                  27100001
271100* GET EXT-SHP-ID FROM WST_SHPMT_XREF_HDR.  KEY IS TRIP-ID.        27110001
271200                                                                  27120001
271300     EXEC SQL                                                     27130001
271400          FETCH HDR-CSR-1                                         27140001
271500          INTO                                                    27150001
271600                :WST00001-EXT-SHP-ID                              27160001
271700              , :WST00001-DWNLD-TMST                              27170001
271800     END-EXEC.                                                    27180001
271900                                                                  27190001
272000     EVALUATE TRUE                                                27200001
272100         WHEN SQLCODE = ZERO                                      27210001
272200             IF PS-FIRST-HDR-CSR-1-YES                            27220001
272300*                IF WST00001-DWNLD-TMST NOT = PC-DEFAULT-NINES    27230001
272400*                    PERFORM 4040-UPDATE-HDR-RECS                 27240001
272500*                END-IF                                           27250001
272600                 SET PS-FIRST-HDR-CSR-1-NO TO TRUE                27260001
272700             END-IF                                               27270001
272800             MOVE WST00001-EXT-SHP-ID TO WS-EXT-SHP-ID            27280001
272900             IF PS-CICS-SWITCH-YES                                27290001
273000                 INITIALIZE PV-CICS-MSG-AREA                      27300001
273100                 STRING   ' ' WS001-SRC-TASK-NUMBER               27310001
273200                          ' WSKCS305-4020:'                       27320001
273300                          ' SHPMT='                               27330001
273400                          WS-EXT-SHP-ID                           27340001
273500                          DELIMITED BY SIZE                       27350001
273600                          INTO PV-CICS-MSG-AREA                   27360001
273700                 PERFORM 7000-WRITE-TO-CICS-LOG                   27370001
273800             END-IF                                               27380001
273900* JAK 05/2007 - CHECK TO SEE IF THERE ARE ANY ADDITIONAL PO'S     27390001
274000             IF PS-MANUAL-UPDATE-YES                              27400001
274100                 PERFORM 5100-INSERT-DETAIL                       27410001
274200                 SET PS-CHECK-ASN-YES     TO TRUE                 27420001
274300             END-IF                                               27430001
274400             SET PS-APPT-SENT-NO      TO TRUE                     27440001
274500             SET PS-IMMED-DOWNLOAD-NO TO TRUE                     27450001
274600             PERFORM 5700-CALL-DOWNLOAD-MOD                       27460001
274700         WHEN SQLCODE = -904                                      27470001
274800         WHEN SQLCODE = -913                                      27480001
274900         WHEN SQLCODE = -911                                      27490001
275000              CONTINUE                                            27500001
275100         WHEN SQLCODE = +100                                      27510001
275200              SET PS-EOF-HDR-CSR-1-YES TO TRUE                    27520001
275300              IF PS-FIRST-HDR-CSR-1-YES                           27530001
275400                  SET PS-DUMMY-HEADER-NO    TO TRUE               27540001
275500                  MOVE 'N'                  TO WS-DWNLD-CDE       27550001
275510*                                                                 27551009
275520* dmh 12/13/2016 - begin                                          27552009
275530              if  PS-CAPTURE-DOWNLOAD-YES                         27553009
275540                MOVE '4020-FETCH-HDR   '  tO WS025-PARAGRAPH-NAME 27554009
275550                MOVE 'SQLCODE = +100    ' TO WS025-INFORMATION    27555009
275560                perform 0560-WFT-DAT-xfer                         27556009
275570              end-if                                              27557009
275580* dmh 12/13/2016 - end                                            27558009
275590*                                                                 27559009
275600                  PERFORM 5000-INSERT-HEADER                      27560001
275700                  PERFORM 5100-INSERT-DETAIL                      27570001
275800                  SET PS-APPT-SENT-YES      TO TRUE               27580001
275900                  SET PS-IMMED-DOWNLOAD-YES TO TRUE               27590001
276000                  SET PS-CHECK-ASN-YES      TO TRUE               27600001
276100              END-IF                                              27610001
276200         WHEN SQLWARN0 NOT = SPACES                               27620001
276300         WHEN SQLCODE NOT = ZERO                                  27630001
276400             MOVE SQLCODE               TO PV-SQL-RETURN-CD       27640001
276500             INITIALIZE PV-CICS-MSG-AREA                          27650001
276600             STRING   ' ' WS001-SRC-TASK-NUMBER                   27660001
276700                      ' WSKCS305-4020 ERROR:'                     27670001
276800                      ' SQL='                                     27680001
276900                      PV-SQL-RETURN-CD                            27690001
277000                      DELIMITED BY SIZE                           27700001
277100                      INTO PV-CICS-MSG-AREA                       27710001
277200             PERFORM 7000-WRITE-TO-CICS-LOG                       27720001
277300                                                                  27730001
277400             SET WS001-INVALID-SQL      TO TRUE                   27740001
277500             STRING 'SQL='                                        27750001
277600                  PV-SQL-RETURN-CD                                27760001
277700                  DELIMITED BY SIZE                               27770001
277800                                      INTO WS001-CRA-RET-MSG      27780001
277900             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  27790001
278000             MOVE SQLCA                 TO WS001-SQLCA            27800001
278100                                           DP013-SQLCA            27810001
278200             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        27820001
278300             MOVE 'WST_SHPMT_XREF_HDR'  TO                        27830001
278400                                       DP013-DB2-TABLE-NAME (1)   27840001
278500             SET DP013-DB2-ABEND        TO TRUE                   27850001
278600             PERFORM 9999-ABEND                                   27860001
278700     END-EVALUATE.                                                27870001
278800                                                                  27880001
278900/                                                                 27890001
279000 4030-CLOSE-HDR-CSR-1.                                            27900001
279100                                                                  27910001
279200     MOVE '4030-CLOSE-HDR-CSR-1' TO WS001-PARAGRAPH-NAME.         27920001
279300                                                                  27930001
279400     EXEC SQL                                                     27940001
279500          CLOSE HDR-CSR-1                                         27950001
279600     END-EXEC.                                                    27960001
279700                                                                  27970001
279800     EVALUATE TRUE                                                27980001
279900         WHEN SQLCODE = ZERO                                      27990001
280000             IF PS-CICS-SWITCH-YES                                28000001
280100                 INITIALIZE PV-CICS-MSG-AREA                      28010001
280200                 STRING   ' ' WS001-SRC-TASK-NUMBER               28020001
280300                          ' WSKCS305-4030:'                       28030001
280400                          ' CLOSE HDR-CSR-1'                      28040001
280500                          DELIMITED BY SIZE                       28050001
280600                          INTO PV-CICS-MSG-AREA                   28060001
280700                 PERFORM 7000-WRITE-TO-CICS-LOG                   28070001
280800             END-IF                                               28080001
280900         WHEN SQLCODE = -904                                      28090001
281000         WHEN SQLCODE = -913                                      28100001
281100         WHEN SQLCODE = -911                                      28110001
281200              CONTINUE                                            28120001
281300         WHEN SQLWARN0 NOT = SPACES                               28130001
281400         WHEN SQLCODE NOT = ZERO                                  28140001
281500             MOVE SQLCODE               TO PV-SQL-RETURN-CD       28150001
281600             INITIALIZE PV-CICS-MSG-AREA                          28160001
281700             STRING   ' ' WS001-SRC-TASK-NUMBER                   28170001
281800                      ' WSKCS305-4030 ERROR:'                     28180001
281900                      ' SQL='                                     28190001
282000                      PV-SQL-RETURN-CD                            28200001
282100                      DELIMITED BY SIZE                           28210001
282200                      INTO PV-CICS-MSG-AREA                       28220001
282300             PERFORM 7000-WRITE-TO-CICS-LOG                       28230001
282400                                                                  28240001
282500             SET WS001-INVALID-SQL      TO TRUE                   28250001
282600             STRING 'SQL='                                        28260001
282700                  PV-SQL-RETURN-CD                                28270001
282800                  DELIMITED BY SIZE                               28280001
282900                                      INTO WS001-CRA-RET-MSG      28290001
283000             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  28300001
283100             MOVE SQLCA                 TO WS001-SQLCA            28310001
283200                                           DP013-SQLCA            28320001
283300             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        28330001
283400             SET DP013-DB2-ABEND        TO TRUE                   28340001
283500             PERFORM 9999-ABEND                                   28350001
283600     END-EVALUATE.                                                28360001
283700                                                                  28370001
283800/                                                                 28380001
283900*4040-UPDATE-HDR-RECS.                                            28390001
284000*                                                                 28400001
284100*    MOVE '4040-UPDATE-HDR-RECS' TO WS001-PARAGRAPH-NAME.         28410001
284200*                                                                 28420001
284300*    EXEC SQL                                                     28430001
284400*         UPDATE WST_SHPMT_XREF_HDR                               28440001
284500*            SET DWNLD_CDE        = 'P'                           28450001
284600*            WHERE INTR_TRIP_ID   = :DK-TRIP-ID                   28460001
284700*            AND   SOR_CDE        = 'RC'                          28470001
284800*            AND   RCPT_TMST      = :PC-DEFAULT-NINES             28480001
284900*    END-EXEC.                                                    28490001
285000*                                                                 28500001
285100*    EVALUATE TRUE                                                28510001
285200*        WHEN SQLCODE = ZERO                                      28520001
285300*            IF PS-CICS-SWITCH-YES                                28530001
285400*                MOVE DK-TRIP-ID TO WS-DISPLAY-1                  28540001
285500*                INITIALIZE PV-CICS-MSG-AREA                      28550001
285600*                STRING   ' ' WS001-SRC-TASK-NUMBER               28560001
285700*                         ' WSKCS305-4040:'                       28570001
285800*                         ' UPDATE XREF_SHPMT_XREF_HDR'           28580001
285900*                         ' FOR TRIP ID='                         28590001
286000*                         WS-DISPLAY-1                            28600001
286100*                         DELIMITED BY SIZE                       28610001
286200*                         INTO PV-CICS-MSG-AREA                   28620001
286300*                PERFORM 7000-WRITE-TO-CICS-LOG                   28630001
286400*            END-IF                                               28640001
286500*        WHEN SQLCODE = -904                                      28650001
286600*        WHEN SQLCODE = -913                                      28660001
286700*        WHEN SQLCODE = -911                                      28670001
286800*             CONTINUE                                            28680001
286900*        WHEN SQLWARN0 NOT = SPACES                               28690001
287000*        WHEN SQLCODE NOT = ZERO                                  28700001
287100*            MOVE SQLCODE               TO PV-SQL-RETURN-CD       28710001
287200*            INITIALIZE PV-CICS-MSG-AREA                          28720001
287300*            STRING   ' ' WS001-SRC-TASK-NUMBER                   28730001
287400*                     ' WSKCS305-4040 ERROR:'                     28740001
287500*                     ' SQL='                                     28750001
287600*                     PV-SQL-RETURN-CD                            28760001
287700*                     DELIMITED BY SIZE                           28770001
287800*                     INTO PV-CICS-MSG-AREA                       28780001
287900*            PERFORM 7000-WRITE-TO-CICS-LOG                       28790001
288000*                                                                 28800001
288100*            SET WS001-INVALID-SQL      TO TRUE                   28810001
288200*            STRING 'SQL='                                        28820001
288300*                 PV-SQL-RETURN-CD                                28830001
288400*                 DELIMITED BY SIZE                               28840001
288500*                                     INTO WS001-CRA-RET-MSG      28850001
288600*            MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  28860001
288700*            MOVE SQLCA                 TO WS001-SQLCA            28870001
288800*                                          DP013-SQLCA            28880001
288900*            MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        28890001
289000*            MOVE 'WST_SHPMT_XREF_HDR'  TO                        28900001
289100*                                      DP013-DB2-TABLE-NAME (1)   28910001
289200*            SET DP013-DB2-ABEND        TO TRUE                   28920001
289300*            PERFORM 9999-ABEND                                   28930001
289400*    END-EVALUATE.                                                28940001
289500                                                                  28950001
289600/                                                                 28960001
289700 5000-INSERT-HEADER.                                              28970001
289800                                                                  28980001
289900     MOVE '5000-INSERT-HEADER'        TO WS001-PARAGRAPH-NAME.    28990001
290000                                                                  29000001
290100     IF PS-DUMMY-HEADER-YES                                       29010001
290200         PERFORM 5010-GET-MAX-DMY-NBR                             29020001
290300         ADD 1                        TO WS-DMY-SEQ-NBR           29030001
290400         MOVE WS-EXT-SHP-ID           TO PV-SHIPMNT-NBR           29040001
290500         MOVE PV-SHIPMNT-NBR(1:10)    TO WS-ORIG-EXT-SHP-ID       29050001
290600         MOVE 'D'                     TO PV-D                     29060001
290700         MOVE WS-DMY-SEQ-NBR          TO PV-DUMMY-NBR             29070001
290800         MOVE PV-SHIPMNT-NBR          TO WST00001-EXT-SHP-ID      29080001
290900                                         WS-EXT-SHP-ID            29090001
291000         MOVE WS-DMY-SEQ-NBR          TO WST00001-DMY-SEQ-NBR     29100001
291100     ELSE                                                         29110001
291200         PERFORM 6000-CREATE-RANDOM-NBR                           29120001
291300                                                                  29130001
291400         INITIALIZE PV-SHIPMNT-NBR                                29140001
291500         MOVE DP902-RANDOM-NUMBER     TO PV-RANDOM-NBR            29150001
291600         MOVE 'K'                     TO PV-K                     29160001
291700         MOVE PV-SHIPMNT-NBR          TO WST00001-EXT-SHP-ID      29170001
291800                                         WS-EXT-SHP-ID            29180001
291900         MOVE 0                       TO WST00001-DMY-SEQ-NBR     29190001
292000     END-IF.                                                      29200001
292100                                                                  29210001
292200     MOVE WS-TRIP-ID           TO WST00001-INTR-TRIP-ID.          29220001
292300     MOVE 'RC'                 TO WST00001-SOR-CDE.               29230001
292400     MOVE WS001-OPER-UNT-ID    TO WST00001-DEST-LOC-NBR.          29240001
292500     MOVE WS-DWNLD-CDE         TO WST00001-DWNLD-CDE.             29250001
292600     MOVE PC-DEFAULT-NINES     TO WST00001-RCPT-TMST.             29260001
292700     MOVE WS001-USER-ID        TO WST00001-CRE-USR-ID.            29270001
292800     MOVE PV-CURRENT-TIMESTAMP TO WST00001-CRE-TMST.              29280001
292900     MOVE PC-DEFAULT-NINES     TO WST00001-DWNLD-TMST.            29290001
293000     MOVE PV-CURRENT-TIMESTAMP TO WST00001-LAST-PRCG-TMST.        29300001
293100     MOVE 'N'                  TO WST00001-PRC-CDE.               29310001
293200     MOVE 0                    TO WST00001-VER-NBR.               29320001
293300     MOVE WS001-CALLING-PROGRAM-NAME                              29330001
293400                               TO WST00001-CRE-PGM-CDE.           29340001
293500                                                                  29350001
293600     PERFORM 5020-WRITE-HEADER.                                   29360001
293700                                                                  29370001
293800* JAK 05/2007 - DO NOT UPDATE ORIG HDR WHEN DUMMY CREATED         29380001
293900*    IF PS-DUMMY-HEADER-YES                                       29390001
294000*        PERFORM 5030-UPDATE-ORIG-HDR                             29400001
294100*    END-IF.                                                      29410001
294200                                                                  29420001
294300/                                                                 29430001
294400 5010-GET-MAX-DMY-NBR.                                            29440001
294500                                                                  29450001
294600     MOVE '5010-GET-MAX-DMY-NBR' TO WS001-PARAGRAPH-NAME.         29460001
294700                                                                  29470001
294800     EXEC SQL                                                     29480001
294900         SELECT MAX (DMY_SEQ_NBR)                                 29490001
295000         INTO  :WS-DMY-SEQ-NBR                                    29500001
295100         FROM  WST_SHPMT_XREF_HDR                                 29510001
295200        WHERE  INTR_TRIP_ID   = :DK-TRIP-ID                       29520001
295300     END-EXEC.                                                    29530001
295400                                                                  29540001
295500     EVALUATE TRUE                                                29550001
295600         WHEN SQLCODE = ZERO                                      29560001
295700             IF PS-CICS-SWITCH-YES                                29570001
295800                 MOVE WS-DMY-SEQ-NBR TO WS-DISPLAY-3              29580001
295900                 INITIALIZE PV-CICS-MSG-AREA                      29590001
296000                 STRING   ' ' WS001-SRC-TASK-NUMBER               29600001
296100                          ' WSKCS305-5010:'                       29610001
296200                          ' MAX DMY SEQ NBR='                     29620001
296300                          WS-DISPLAY-3                            29630001
296400                          ' SHPMT='                               29640001
296500                          WST00001-EXT-SHP-ID (1:10)              29650001
296600                          DELIMITED BY SIZE                       29660001
296700                          INTO PV-CICS-MSG-AREA                   29670001
296800                 PERFORM 7000-WRITE-TO-CICS-LOG                   29680001
296900             END-IF                                               29690001
297000         WHEN SQLCODE = +100                                      29700001
297100         WHEN SQLCODE = -305                                      29710001
297200                 MOVE 0              TO WS-DMY-SEQ-NBR            29720001
297300         WHEN SQLCODE = -811                                      29730001
297400         WHEN SQLCODE = -904                                      29740001
297500         WHEN SQLCODE = -913                                      29750001
297600         WHEN SQLCODE = -911                                      29760001
297700             CONTINUE                                             29770001
297800         WHEN SQLWARN0 NOT = SPACES                               29780001
297900         WHEN SQLCODE NOT = ZERO                                  29790001
298000             MOVE SQLCODE               TO PV-SQL-RETURN-CD       29800001
298100             INITIALIZE PV-CICS-MSG-AREA                          29810001
298200             STRING   ' ' WS001-SRC-TASK-NUMBER                   29820001
298300                      ' WSKCS305-5010 ERROR:'                     29830001
298400                      ' SQL='                                     29840001
298500                      PV-SQL-RETURN-CD                            29850001
298600                      DELIMITED BY SIZE                           29860001
298700                      INTO PV-CICS-MSG-AREA                       29870001
298800             PERFORM 7000-WRITE-TO-CICS-LOG                       29880001
298900                                                                  29890001
299000             SET WS001-INVALID-SQL      TO TRUE                   29900001
299100             STRING 'SQL='                                        29910001
299200                  PV-SQL-RETURN-CD                                29920001
299300                  DELIMITED BY SIZE                               29930001
299400                                      INTO WS001-CRA-RET-MSG      29940001
299500             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  29950001
299600             MOVE SQLCA                 TO WS001-SQLCA            29960001
299700                                           DP013-SQLCA            29970001
299800             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        29980001
299900             MOVE 'WST_SHPMT_XREF_HDR'  TO                        29990001
300000                                       DP013-DB2-TABLE-NAME (1)   30000001
300100             SET DP013-DB2-ABEND        TO TRUE                   30010001
300200             PERFORM 9999-ABEND                                   30020001
300300     END-EVALUATE.                                                30030001
300400*                                                                 30040001
300500/                                                                 30050001
300600 5020-WRITE-HEADER.                                               30060001
300700                                                                  30070001
300800     EXEC SQL                                                     30080001
300900         INSERT INTO WST_SHPMT_XREF_HDR                           30090001
301000               (EXT_SHP_ID                                        30100001
301100              , INTR_TRIP_ID                                      30110001
301200              , SOR_CDE                                           30120001
301300              , DMY_SEQ_NBR                                       30130001
301400              , DEST_LOC_NBR                                      30140001
301500              , DWNLD_CDE                                         30150001
301600              , RCPT_TMST                                         30160001
301700              , CRE_USR_ID                                        30170001
301800              , CRE_TMST                                          30180001
301900              , DWNLD_TMST                                        30190001
302000              , LAST_PRCG_TMST                                    30200001
302100              , PRC_CDE                                           30210001
302200              , VER_NBR                                           30220001
302300              , CRE_PGM_CDE )                                     30230001
302400         VALUES                                                   30240001
302500              (:WST00001-EXT-SHP-ID                               30250001
302600             , :WST00001-INTR-TRIP-ID                             30260001
302700             , :WST00001-SOR-CDE                                  30270001
302800             , :WST00001-DMY-SEQ-NBR                              30280001
302900             , :WST00001-DEST-LOC-NBR                             30290001
303000             , :WST00001-DWNLD-CDE                                30300001
303100             , :WST00001-RCPT-TMST                                30310001
303200             , :WST00001-CRE-USR-ID                               30320001
303300             , :WST00001-CRE-TMST                                 30330001
303400             , :WST00001-DWNLD-TMST                               30340001
303500             , :WST00001-LAST-PRCG-TMST                           30350001
303600             , :WST00001-PRC-CDE                                  30360001
303700             , :WST00001-VER-NBR                                  30370001
303800             , :WST00001-CRE-PGM-CDE)                             30380001
303900    END-EXEC.                                                     30390001
304000                                                                  30400001
304100     EVALUATE TRUE                                                30410001
304200         WHEN SQLCODE = ZERO                                      30420001
304300              SET PS-HEADER-CREATED-YES  TO TRUE                  30430001
304400              IF PS-CICS-SWITCH-YES                               30440001
304500                  MOVE WST00001-INTR-TRIP-ID TO WS-DISPLAY-1      30450001
304600                  INITIALIZE PV-CICS-MSG-AREA                     30460001
304700                  STRING   ' ' WS001-SRC-TASK-NUMBER              30470001
304800                           ' WSKCS305-5020:'                      30480001
304900                           ' INSERT XREF_SHPMT_XREF_HDR'          30490001
305000                           ' FOR SHPMT='                          30500001
305100                           WST00001-EXT-SHP-ID                    30510001
305200                           ' TRIP=' WS-DISPLAY-1                  30520001
305300                           DELIMITED BY SIZE                      30530001
305400                           INTO PV-CICS-MSG-AREA                  30540001
305500                  PERFORM 7000-WRITE-TO-CICS-LOG                  30550001
305600              END-IF                                              30560001
305601*                                                                 30560108
305602* dmh 12/13/2016 - begin                                          30560208
305610              if  PS-CAPTURE-DOWNLOAD-YES                         30561008
305611                MOVE '5020-WRITE-HEADER'  tO WS025-PARAGRAPH-NAME 30561108
305612                MOVE WST00001-EXT-SHP-ID  TO WS025-EXT-SHP-Id     30561208
305613                perform 0560-WFT-DAT-xfer                         30561308
305614              end-if                                              30561408
305615* dmh 12/13/2016 - end                                            30561508
305620*                                                                 30562008
305630                                                                  30563008
305700         WHEN SQLCODE = -904                                      30570001
305800         WHEN SQLCODE = -913                                      30580001
305900         WHEN SQLCODE = -911                                      30590001
306000             CONTINUE                                             30600001
306100         WHEN SQLWARN0 NOT = SPACES                               30610001
306200         WHEN SQLCODE NOT = ZERO                                  30620001
306300             MOVE SQLCODE               TO PV-SQL-RETURN-CD       30630001
306400             INITIALIZE PV-CICS-MSG-AREA                          30640001
306500             STRING   ' ' WS001-SRC-TASK-NUMBER                   30650001
306600                      ' WSKCS305-5020 ERROR:'                     30660001
306700                      ' SQL='                                     30670001
306800                      PV-SQL-RETURN-CD                            30680001
306900                      DELIMITED BY SIZE                           30690001
307000                      INTO PV-CICS-MSG-AREA                       30700001
307100             PERFORM 7000-WRITE-TO-CICS-LOG                       30710001
307200                                                                  30720001
307300             SET WS001-INVALID-SQL      TO TRUE                   30730001
307400             STRING 'SQL='                                        30740001
307500                  PV-SQL-RETURN-CD                                30750001
307600                  DELIMITED BY SIZE                               30760001
307700                                      INTO WS001-CRA-RET-MSG      30770001
307800             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  30780001
307900             MOVE SQLCA                 TO WS001-SQLCA            30790001
308000                                           DP013-SQLCA            30800001
308100             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        30810001
308200             MOVE 'WST_SHPMT_XREF_HDR'  TO                        30820001
308300                                       DP013-DB2-TABLE-NAME (1)   30830001
308400             SET DP013-DB2-ABEND        TO TRUE                   30840001
308500             PERFORM 9999-ABEND                                   30850001
308600     END-EVALUATE.                                                30860001
308700                                                                  30870001
308800/                                                                 30880001
308900*5030-UPDATE-ORIG-HDR.                                            30890001
309000                                                                  30900001
309100* UPDATE THE ORIGINAL SHIPMENT HEADER RECORD WITH THE LATEST      30910001
309200* DUMMY SEQUENCE NUMBER USED                                      30920001
309300                                                                  30930001
309400*    EXEC SQL                                                     30940001
309500*        UPDATE WST_SHPMT_XREF_HDR                                30950001
309600*        SET    DMY_SEQ_NBR = :WS-DMY-SEQ-NBR                     30960001
309700*        WHERE  EXT_SHP_ID  = :WS-ORIG-EXT-SHP-ID                 30970001
309800*   END-EXEC.                                                     30980001
309900                                                                  30990001
310000*    EVALUATE TRUE                                                31000001
310100*        WHEN SQLCODE = ZERO                                      31010001
310200*             IF PS-CICS-SWITCH-YES                               31020001
310300*                 INITIALIZE PV-CICS-MSG-AREA                     31030001
310400*                 STRING   ' ' WS001-SRC-TASK-NUMBER              31040001
310500*                          ' WSKCS305-5030:'                      31050001
310600*                          ' UPDATE XREF_SHPMT_XREF_HDR'          31060001
310700*                          ' FOR SHPMT='                          31070001
310800*                          WS-ORIG-EXT-SHP-ID                     31080001
310900*                          DELIMITED BY SIZE                      31090001
311000*                          INTO PV-CICS-MSG-AREA                  31100001
311100*                 PERFORM 7000-WRITE-TO-CICS-LOG                  31110001
311200*             END-IF                                              31120001
311300*        WHEN SQLCODE = -904                                      31130001
311400*        WHEN SQLCODE = -913                                      31140001
311500*        WHEN SQLCODE = -911                                      31150001
311600*            CONTINUE                                             31160001
311700*        WHEN SQLWARN0 NOT = SPACES                               31170001
311800*        WHEN SQLCODE NOT = ZERO                                  31180001
311900*            MOVE SQLCODE               TO PV-SQL-RETURN-CD       31190001
312000*            INITIALIZE PV-CICS-MSG-AREA                          31200001
312100*            STRING   ' ' WS001-SRC-TASK-NUMBER                   31210001
312200*                     ' WSKCS305-5030 ERROR:'                     31220001
312300*                     ' SQL='                                     31230001
312400*                     PV-SQL-RETURN-CD                            31240001
312500*                     DELIMITED BY SIZE                           31250001
312600*                     INTO PV-CICS-MSG-AREA                       31260001
312700*            PERFORM 7000-WRITE-TO-CICS-LOG                       31270001
312800*                                                                 31280001
312900*            SET WS001-INVALID-SQL      TO TRUE                   31290001
313000*            STRING 'SQL='                                        31300001
313100*                 PV-SQL-RETURN-CD                                31310001
313200*                 DELIMITED BY SIZE                               31320001
313300*                                     INTO WS001-CRA-RET-MSG      31330001
313400*            MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  31340001
313500*            MOVE SQLCA                 TO WS001-SQLCA            31350001
313600*                                          DP013-SQLCA            31360001
313700*            MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        31370001
313800*            MOVE 'WST_SHPMT_XREF_HDR'  TO                        31380001
313900*                                      DP013-DB2-TABLE-NAME (1)   31390001
314000*            SET DP013-DB2-ABEND        TO TRUE                   31400001
314100*            PERFORM 9999-ABEND                                   31410001
314200*    END-EVALUATE.                                                31420001
314300                                                                  31430001
314400/                                                                 31440001
314500 5100-INSERT-DETAIL.                                              31450001
314600                                                                  31460001
314700     MOVE '5100-INSERT-DETAIL'   TO WS001-PARAGRAPH-NAME.         31470001
314800                                                                  31480001
314900     EVALUATE TRUE                                                31490001
315000         WHEN WS-TRIP-ID > 0                                      31500001
315100          AND WS-PO-NBR = 0                                       31510001
315200          AND WS-RCVR-SEQ-NBR = 0                                 31520001
315300          AND WS-PO-LNE-NBR = 0                                   31530001
315400          AND WS-PREPK-ID = 0                                     31540001
315500             PERFORM 5300-DETAIL-TRIP                             31550001
315600         WHEN WS-TRIP-ID > 0                                      31560001
315700          AND WS-PO-NBR > 0                                       31570001
315800          AND WS-RCVR-SEQ-NBR > 0                                 31580001
315900          AND WS-PO-LNE-NBR = 0                                   31590001
316000          AND WS-PREPK-ID = 0                                     31600001
316100             PERFORM 5610-CHECK-FOR-PBS                           31610001
316200             IF PS-PACK-BY-STORE-YES                              31620001
316300                 PERFORM 5620-CHECK-FOR-PBS-ERRS                  31630001
316400             END-IF                                               31640001
316500             PERFORM 5600-DETAIL-PO-RCVR                          31650001
316600         WHEN WS-TRIP-ID > 0                                      31660001
316700           AND WS-PO-NBR > 0                                      31670001
316800           AND WS-RCVR-SEQ-NBR > 0                                31680001
316900           AND (WS-PO-LNE-NBR > 0                                 31690001
317000                OR WS-PREPK-ID > 0)                               31700001
317100             PERFORM 5610-CHECK-FOR-PBS                           31710001
317200             IF PS-PACK-BY-STORE-YES                              31720001
317300                 PERFORM 5620-CHECK-FOR-PBS-ERRS                  31730001
317400             END-IF                                               31740001
317500             PERFORM 5400-DETAIL-LINE-PACK                        31750001
317600     END-EVALUATE.                                                31760001
317700*                                                                 31770001
317800/                                                                 31780001
317900 5200-EVAL-SHIP-STATUS.                                           31790001
318000     MOVE '5200-EVAL-SHIP-STATUS'                                 31800001
318100                                 TO WS001-PARAGRAPH-NAME.         31810001
318200                                                                  31820001
318300* THIS IS A WS001-INSERT                                          31830001
318400* ONLY ONE RECORD WAS FOUND ON HEADER TABLE FOR THE TRIP-ID       31840001
318500                                                                  31850001
318600     IF WS-DWNLD-TMST = PC-DEFAULT-NINES                          31860001
318700* HAS NOT BEEN DOWNLOADED PREVIOUSLY                              31870001
318800         IF WS-DWNLD-CDE = 'X'                                    31880001
318900             MOVE 'N'                       TO WS-DWNLD-CDE       31890001
319000             PERFORM 5210-UPD-HDR-FOR-TRIP-AND-SHP                31900001
319100         END-IF                                                   31910001
319200         IF WS001-INSERT                                          31920001
319300             PERFORM 5100-INSERT-DETAIL                           31930001
319400         END-IF                                                   31940001
319500     ELSE                                                         31950001
319600* HAS BEEN DOWNLOADED PREVIOUSLY                                  31960001
319700         IF WS-RCPT-TMST = PC-DEFAULT-NINES                       31970001
319800* NO RECEIVING HAS BEGUN, CAN ATTACH MORE INFO TO TRAILER         31980001
319900             MOVE 'P'                       TO WS-DWNLD-CDE       31990001
320000             PERFORM 5210-UPD-HDR-FOR-TRIP-AND-SHP                32000001
320100             IF WS001-INSERT                                      32010001
320200                 MOVE WS-EXT-SHP-ID         TO PV-SHIPMNT-NBR     32020001
320300                 PERFORM 5100-INSERT-DETAIL                       32030001
320400             END-IF                                               32040001
320500             SET PS-APPT-SENT-NO            TO TRUE               32050001
320600*            SET PS-IMMED-DOWNLOAD-YES      TO TRUE               32060001
320700         ELSE                                                     32070001
320800* RECEIVING HAS BEGUN, DUMMY SHIPMENT IS NEEDED                   32080001
320900             IF WS001-INSERT                                      32090001
321000                 SET PS-DUMMY-HEADER-YES    TO TRUE               32100001
321100                 MOVE 'N'                   TO WS-DWNLD-CDE       32110001
321110*                                                                 32111009
321120* dmh 12/13/2016 - begin                                          32112009
321130              if  PS-CAPTURE-DOWNLOAD-YES                         32113009
321140                MOVE '5200-EVAL-SHIP   '  tO WS025-PARAGRAPH-NAME 32114009
321150                MOVE 'rcvg has begun    ' TO WS025-INFORMATION    32115009
321160                perform 0560-WFT-DAT-xfer                         32116009
321170              end-if                                              32117009
321180* dmh 12/13/2016 - end                                            32118009
321190*                                                                 32119009
321200                 PERFORM 5000-INSERT-HEADER                       32120001
321300                 PERFORM 5100-INSERT-DETAIL                       32130001
321400                 SET PS-IMMED-DOWNLOAD-YES  TO TRUE               32140001
321500             END-IF                                               32150001
321600         END-IF                                                   32160001
321700     END-IF.                                                      32170001
321800                                                                  32180001
321900/                                                                 32190001
322000 5210-UPD-HDR-FOR-TRIP-AND-SHP.                                   32200001
322100     MOVE '5210-UPD-HDR-FOR-TRIP-AND-SHP'                         32210001
322200                                 TO WS001-PARAGRAPH-NAME.         32220001
322300                                                                  32230001
322400     EXEC SQL                                                     32240001
322500          UPDATE WST_SHPMT_XREF_HDR                               32250001
322600             SET LAST_PRCG_TMST   = CURRENT TIMESTAMP             32260001
322700                ,DWNLD_CDE        = :WS-DWNLD-CDE                 32270001
322800             WHERE EXT_SHP_ID     = :DK-EXT-SHP-ID                32280001
322900             AND   INTR_TRIP_ID   = :DK-TRIP-ID                   32290001
323000     END-EXEC.                                                    32300001
323100                                                                  32310001
323200     EVALUATE TRUE                                                32320001
323300         WHEN SQLCODE = ZERO                                      32330001
323400             IF PS-CICS-SWITCH-YES                                32340001
323500                 MOVE DK-TRIP-ID TO WS-DISPLAY-1                  32350001
323600                 INITIALIZE PV-CICS-MSG-AREA                      32360001
323700                 STRING   ' ' WS001-SRC-TASK-NUMBER               32370001
323800                          ' WSKCS305-5210:'                       32380001
323900                          ' UPDATE WST_SHPMT_XREF_HDR '           32390001
324000                          ' FOR SHPMT='                           32400001
324100                          DK-EXT-SHP-ID                           32410001
324200                          ' TRIP ID='                             32420001
324300                          WS-DISPLAY-1                            32430001
324400                          DELIMITED BY SIZE                       32440001
324500                          INTO PV-CICS-MSG-AREA                   32450001
324600                 PERFORM 7000-WRITE-TO-CICS-LOG                   32460001
324700             END-IF                                               32470001
324800         WHEN SQLCODE = -904                                      32480001
324900         WHEN SQLCODE = -913                                      32490001
325000         WHEN SQLCODE = -911                                      32500001
325100              CONTINUE                                            32510001
325200         WHEN SQLWARN0 NOT = SPACES                               32520001
325300         WHEN SQLCODE NOT = ZERO                                  32530001
325400             MOVE SQLCODE               TO PV-SQL-RETURN-CD       32540001
325500             INITIALIZE PV-CICS-MSG-AREA                          32550001
325600             STRING   ' ' WS001-SRC-TASK-NUMBER                   32560001
325700                      ' WSKCS305-5210 ERROR:'                     32570001
325800                      ' SQL='                                     32580001
325900                      PV-SQL-RETURN-CD                            32590001
326000                      DELIMITED BY SIZE                           32600001
326100                      INTO PV-CICS-MSG-AREA                       32610001
326200             PERFORM 7000-WRITE-TO-CICS-LOG                       32620001
326300                                                                  32630001
326400             SET WS001-INVALID-SQL      TO TRUE                   32640001
326500             STRING 'SQL='                                        32650001
326600                  PV-SQL-RETURN-CD                                32660001
326700                  DELIMITED BY SIZE                               32670001
326800                                      INTO WS001-CRA-RET-MSG      32680001
326900             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  32690001
327000             MOVE SQLCA                 TO WS001-SQLCA            32700001
327100                                           DP013-SQLCA            32710001
327200             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        32720001
327300             MOVE 'WST_SHPMT_XREF_HDR'  TO                        32730001
327400                                       DP013-DB2-TABLE-NAME (1)   32740001
327500             SET DP013-DB2-ABEND        TO TRUE                   32750001
327600             PERFORM 9999-ABEND                                   32760001
327700     END-EVALUATE.                                                32770001
327800                                                                  32780001
327900/                                                                 32790001
328000 5300-DETAIL-TRIP.                                                32800001
328100                                                                  32810001
328200     MOVE '5300-DETAIL-TRIP'     TO WS001-PARAGRAPH-NAME.         32820001
328300                                                                  32830001
328400*  DO NOT HAVE THE PO/RCVR, IF IN HERE                            32840001
328500*  SELECT ALL PO/RCVR FOR THE TRIP/SHIPMENT                       32850001
328600                                                                  32860001
328700* IF COMING FROM RCKCS261, SELECT THE PO/RCVR USING THE           32870001
328800* SHIPT-ID, ELSE USE THE TRIP-ID.                                 32880001
328900*                                                                 32890001
329000* IF THERE IS ALREADY A DUMMY RECORD IN EXISTENCE, AND THE        32900001
329100* SHIPT-ID WAS SENT IN BY THE CALLING PROGRAM, THEN ONLY          32910001
329200* PROCESS THE PO/RCVR ON THE SHIPT-ID, NOT THE TRIP-ID            32920001
329300                                                                  32930001
329400     IF WS001-CALLING-PROGRAM-NAME = 'RCKCS261'                   32940001
329500        OR (PS-HEADER-EXIST-YES AND                               32950001
329600            WS001-KOHLS-SHIPT-ID > 0)                             32960001
329700         PERFORM 5340-OPEN-PO-RCVR-CSR2                           32970001
329800         PERFORM 5350-FETCH-PO-RCVR-CSR2 UNTIL                    32980001
329900                     PS-EOF-PO-RCVR-CSR2-YES                      32990001
330000         PERFORM 5360-CLOSE-PO-RCVR-CSR2                          33000001
330100     ELSE                                                         33010001
330200         PERFORM 5310-OPEN-PO-RCVR-CSR                            33020001
330300         PERFORM 5320-FETCH-PO-RCVR-CSR UNTIL                     33030001
330400                     PS-EOF-PO-RCVR-CSR-YES                       33040001
330500         PERFORM 5330-CLOSE-PO-RCVR-CSR                           33050001
330600     END-IF.                                                      33060001
330700                                                                  33070001
330800/                                                                 33080001
330900 5310-OPEN-PO-RCVR-CSR.                                           33090001
331000                                                                  33100001
331100     MOVE '5310-OPEN-PO-RCVR-CSR'                                 33110001
331200                                 TO WS001-PARAGRAPH-NAME.         33120001
331300                                                                  33130001
331400     SET PS-EOF-PO-RCVR-CSR-NO        TO TRUE.                    33140001
331500                                                                  33150001
331600     EXEC SQL                                                     33160001
331700         OPEN PO-RCVR-CSR                                         33170001
331800     END-EXEC.                                                    33180001
331900                                                                  33190001
332000     EVALUATE TRUE                                                33200001
332100         WHEN SQLCODE = ZERO                                      33210001
332200             IF PS-CICS-SWITCH-YES                                33220001
332300                 INITIALIZE PV-CICS-MSG-AREA                      33230001
332400                 MOVE DK-TRIP-ID         TO WS-DISPLAY-1          33240001
332500                 STRING   ' ' WS001-SRC-TASK-NUMBER               33250001
332600                          ' WSKCS305-5310:'                       33260001
332700                          ' OPEN PO-RCVR-CSR'                     33270001
332800                          ' FOR TRIP=' WS-DISPLAY-1               33280001
332900                          DELIMITED BY SIZE                       33290001
333000                          INTO PV-CICS-MSG-AREA                   33300001
333100                 PERFORM 7000-WRITE-TO-CICS-LOG                   33310001
333200             END-IF                                               33320001
333300         WHEN SQLCODE = -904                                      33330001
333400         WHEN SQLCODE = -913                                      33340001
333500         WHEN SQLCODE = -911                                      33350001
333600             CONTINUE                                             33360001
333700         WHEN SQLWARN0 NOT = SPACES                               33370001
333800         WHEN SQLCODE NOT = ZERO                                  33380001
333900             MOVE SQLCODE               TO PV-SQL-RETURN-CD       33390001
334000             INITIALIZE PV-CICS-MSG-AREA                          33400001
334100             STRING   ' ' WS001-SRC-TASK-NUMBER                   33410001
334200                      ' WSKCS305-5310 ERROR:'                     33420001
334300                      ' SQL='                                     33430001
334400                      PV-SQL-RETURN-CD                            33440001
334500                      DELIMITED BY SIZE                           33450001
334600                      INTO PV-CICS-MSG-AREA                       33460001
334700             PERFORM 7000-WRITE-TO-CICS-LOG                       33470001
334800                                                                  33480001
334900             SET WS001-INVALID-SQL      TO TRUE                   33490001
335000             STRING 'SQL='                                        33500001
335100                  PV-SQL-RETURN-CD                                33510001
335200                  DELIMITED BY SIZE                               33520001
335300                                      INTO WS001-CRA-RET-MSG      33530001
335400             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  33540001
335500             MOVE SQLCA                 TO WS001-SQLCA            33550001
335600                                           DP013-SQLCA            33560001
335700             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        33570001
335800             SET DP013-DB2-ABEND        TO TRUE                   33580001
335900             PERFORM 9999-ABEND                                   33590001
336000     END-EVALUATE.                                                33600001
336100                                                                  33610001
336200     SET PS-FIRST-RECORD-YES          TO TRUE.                    33620001
336300     MOVE 0                           TO WS-HOLD-PO-NBR.          33630001
336400     MOVE 0                           TO WS-HOLD-RCVR-SEQ-NBR.    33640001
336500                                                                  33650001
336600/                                                                 33660001
336700 5320-FETCH-PO-RCVR-CSR.                                          33670001
336800                                                                  33680001
336900     MOVE '5320-FETCH-PO-RCVR-CSR'                                33690001
337000                                 TO WS001-PARAGRAPH-NAME.         33700001
337100                                                                  33710001
337200* GET PO/REC FROM TVHTRIP, TSHIPMT, TSHPTPO, TRECIEV.  KEY=TRIP-ID33720001
337300                                                                  33730001
337400     EXEC SQL                                                     33740001
337500          FETCH PO-RCVR-CSR                                       33750001
337600          INTO                                                    33760001
337700                :SHPTPO-PO-NBR                                    33770001
337800               ,:SHPTPO-REC-SEQ-NBR                               33780001
337900     END-EXEC.                                                    33790001
338000                                                                  33800001
338100     EVALUATE TRUE                                                33810001
338200         WHEN SQLCODE = ZERO                                      33820001
338300             MOVE SHPTPO-PO-NBR      TO WS-PO-NBR                 33830001
338400                                        DK-PO-NBR                 33840001
338500             MOVE SHPTPO-REC-SEQ-NBR TO WS-RCVR-SEQ-NBR           33850001
338600                                        DK-RCVR-SEQ-NBR           33860001
338700             IF PS-CICS-SWITCH-YES                                33870001
338800                 INITIALIZE PV-CICS-MSG-AREA                      33880001
338900                 MOVE WS-PO-NBR TO WS-DISPLAY-1                   33890001
339000                 MOVE WS-RCVR-SEQ-NBR TO WS-DISPLAY-2             33900001
339100                 STRING   ' ' WS001-SRC-TASK-NUMBER               33910001
339200                          ' WSKCS305-5320:'                       33920001
339300                          ' PO NBR='                              33930001
339400                          WS-DISPLAY-1                            33940001
339500                          ' RCVR SEQ NBR='                        33950001
339600                          WS-DISPLAY-2                            33960001
339700                          DELIMITED BY SIZE                       33970001
339800                          INTO PV-CICS-MSG-AREA                   33980001
339900                 PERFORM 7000-WRITE-TO-CICS-LOG                   33990001
340000             END-IF                                               34000001
340100             IF SHPTPO-PO-NBR NOT = WS-HOLD-PO-NBR                34010001
340200               OR SHPTPO-REC-SEQ-NBR NOT =                        34020001
340300                                      WS-HOLD-RCVR-SEQ-NBR        34030001
340400                 MOVE SHPTPO-PO-NBR TO WS-HOLD-PO-NBR             34040001
340500                 MOVE SHPTPO-REC-SEQ-NBR TO                       34050001
340600                                          WS-HOLD-RCVR-SEQ-NBR    34060001
340700                 IF PS-CICS-SWITCH-YES                            34070001
340800                     MOVE WS-HOLD-PO-NBR TO WS-DISPLAY-1          34080001
340900                     MOVE WS-HOLD-RCVR-SEQ-NBR TO WS-DISPLAY-2    34090001
341000                     INITIALIZE PV-CICS-MSG-AREA                  34100001
341100                     STRING   ' ' WS001-SRC-TASK-NUMBER           34110001
341200                              ' WSKCS305-5320:'                   34120001
341300                              ' HOLD PO NBR='                     34130001
341400                              WS-DISPLAY-1                        34140001
341500                              ' HOLD RCVR SEQ NBR='               34150001
341600                              WS-DISPLAY-2                        34160001
341700                              DELIMITED BY SIZE                   34170001
341800                              INTO PV-CICS-MSG-AREA               34180001
341900                     PERFORM 7000-WRITE-TO-CICS-LOG               34190001
342000                 END-IF                                           34200001
342100                 PERFORM 5610-CHECK-FOR-PBS                       34210001
342200                 IF PS-PACK-BY-STORE-YES                          34220001
342300                     PERFORM 5620-CHECK-FOR-PBS-ERRS              34230001
342400                 END-IF                                           34240001
342500             END-IF                                               34250001
342600             PERFORM 5600-DETAIL-PO-RCVR                          34260001
342700         WHEN SQLCODE = -904                                      34270001
342800         WHEN SQLCODE = -913                                      34280001
342900         WHEN SQLCODE = -911                                      34290001
343000             CONTINUE                                             34300001
343100         WHEN SQLCODE = +100                                      34310001
343200             SET PS-EOF-PO-RCVR-CSR-YES TO TRUE                   34320001
343300         WHEN SQLWARN0 NOT = SPACES                               34330001
343400         WHEN SQLCODE NOT = ZERO                                  34340001
343500             MOVE SQLCODE               TO PV-SQL-RETURN-CD       34350001
343600             INITIALIZE PV-CICS-MSG-AREA                          34360001
343700             STRING   ' ' WS001-SRC-TASK-NUMBER                   34370001
343800                      ' WSKCS305-5320 ERROR:'                     34380001
343900                      ' SQL='                                     34390001
344000                      PV-SQL-RETURN-CD                            34400001
344100                      DELIMITED BY SIZE                           34410001
344200                      INTO PV-CICS-MSG-AREA                       34420001
344300             PERFORM 7000-WRITE-TO-CICS-LOG                       34430001
344400                                                                  34440001
344500             SET WS001-INVALID-SQL      TO TRUE                   34450001
344600             STRING 'SQL='                                        34460001
344700                  PV-SQL-RETURN-CD                                34470001
344800                  DELIMITED BY SIZE                               34480001
344900                                      INTO WS001-CRA-RET-MSG      34490001
345000             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  34500001
345100             MOVE SQLCA                 TO WS001-SQLCA            34510001
345200                                           DP013-SQLCA            34520001
345300             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        34530001
345400             MOVE 'TVHTRIP'             TO                        34540001
345500                                       DP013-DB2-TABLE-NAME (1)   34550001
345600             MOVE 'TSHIPMT'             TO                        34560001
345700                                       DP013-DB2-TABLE-NAME (2)   34570001
345800             MOVE 'TSHPTPO'             TO                        34580001
345900                                       DP013-DB2-TABLE-NAME (3)   34590001
346000             MOVE 'TRECEIV'             TO                        34600001
346100                                       DP013-DB2-TABLE-NAME (4)   34610001
346200             SET DP013-DB2-ABEND        TO TRUE                   34620001
346300             PERFORM 9999-ABEND                                   34630001
346400     END-EVALUATE.                                                34640001
346500                                                                  34650001
346600/                                                                 34660001
346700 5330-CLOSE-PO-RCVR-CSR.                                          34670001
346800                                                                  34680001
346900     MOVE '5330-CLOSE-PO-RCVR-CSR'                                34690001
347000                                 TO WS001-PARAGRAPH-NAME.         34700001
347100                                                                  34710001
347200     EXEC SQL                                                     34720001
347300          CLOSE PO-RCVR-CSR                                       34730001
347400     END-EXEC.                                                    34740001
347500                                                                  34750001
347600     EVALUATE TRUE                                                34760001
347700         WHEN SQLCODE = ZERO                                      34770001
347800             IF PS-CICS-SWITCH-YES                                34780001
347900                 INITIALIZE PV-CICS-MSG-AREA                      34790001
348000                 STRING   ' ' WS001-SRC-TASK-NUMBER               34800001
348100                          ' WSKCS305-5330:'                       34810001
348200                          ' CLOSE PO-RCVR-CSR'                    34820001
348300                          DELIMITED BY SIZE                       34830001
348400                          INTO PV-CICS-MSG-AREA                   34840001
348500                 PERFORM 7000-WRITE-TO-CICS-LOG                   34850001
348600             END-IF                                               34860001
348700         WHEN SQLCODE = -904                                      34870001
348800         WHEN SQLCODE = -913                                      34880001
348900         WHEN SQLCODE = -911                                      34890001
349000              CONTINUE                                            34900001
349100         WHEN SQLWARN0 NOT = SPACES                               34910001
349200         WHEN SQLCODE NOT = ZERO                                  34920001
349300             MOVE SQLCODE               TO PV-SQL-RETURN-CD       34930001
349400             INITIALIZE PV-CICS-MSG-AREA                          34940001
349500             STRING   ' ' WS001-SRC-TASK-NUMBER                   34950001
349600                      ' WSKCS305-5330 ERROR:'                     34960001
349700                      ' SQL='                                     34970001
349800                      PV-SQL-RETURN-CD                            34980001
349900                      DELIMITED BY SIZE                           34990001
350000                      INTO PV-CICS-MSG-AREA                       35000001
350100             PERFORM 7000-WRITE-TO-CICS-LOG                       35010001
350200                                                                  35020001
350300             SET WS001-INVALID-SQL      TO TRUE                   35030001
350400             STRING 'SQL='                                        35040001
350500                  PV-SQL-RETURN-CD                                35050001
350600                  DELIMITED BY SIZE                               35060001
350700                                      INTO WS001-CRA-RET-MSG      35070001
350800             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  35080001
350900             MOVE SQLCA                 TO WS001-SQLCA            35090001
351000                                           DP013-SQLCA            35100001
351100             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        35110001
351200             SET DP013-DB2-ABEND        TO TRUE                   35120001
351300             PERFORM 9999-ABEND                                   35130001
351400     END-EVALUATE.                                                35140001
351500                                                                  35150001
351600/                                                                 35160001
351700 5340-OPEN-PO-RCVR-CSR2.                                          35170001
351800                                                                  35180001
351900     MOVE '5340-OPEN-PO-RCVR-CSR2'                                35190001
352000                                 TO WS001-PARAGRAPH-NAME.         35200001
352100                                                                  35210001
352200     SET PS-EOF-PO-RCVR-CSR2-NO       TO TRUE.                    35220001
352300                                                                  35230001
352400     EXEC SQL                                                     35240001
352500         OPEN PO-RCVR-CSR2                                        35250001
352600     END-EXEC.                                                    35260001
352700                                                                  35270001
352800     EVALUATE TRUE                                                35280001
352900         WHEN SQLCODE = ZERO                                      35290001
353000             IF PS-CICS-SWITCH-YES                                35300001
353100                 INITIALIZE PV-CICS-MSG-AREA                      35310001
353200                 MOVE DK-SHIPT-ID    TO WS-DISPLAY-1              35320001
353300                 STRING   ' ' WS001-SRC-TASK-NUMBER               35330001
353400                          ' WSKCS305-5340:'                       35340001
353500                          ' OPEN PO-RCVR-CSR2'                    35350001
353600                          ' SHIPT-ID=' WS-DISPLAY-1               35360001
353700                          DELIMITED BY SIZE                       35370001
353800                          INTO PV-CICS-MSG-AREA                   35380001
353900                 PERFORM 7000-WRITE-TO-CICS-LOG                   35390001
354000             END-IF                                               35400001
354100         WHEN SQLCODE = -904                                      35410001
354200         WHEN SQLCODE = -913                                      35420001
354300         WHEN SQLCODE = -911                                      35430001
354400             CONTINUE                                             35440001
354500         WHEN SQLWARN0 NOT = SPACES                               35450001
354600         WHEN SQLCODE NOT = ZERO                                  35460001
354700             MOVE SQLCODE               TO PV-SQL-RETURN-CD       35470001
354800             INITIALIZE PV-CICS-MSG-AREA                          35480001
354900             STRING   ' ' WS001-SRC-TASK-NUMBER                   35490001
355000                      ' WSKCS305-5340 ERROR:'                     35500001
355100                      ' SQL='                                     35510001
355200                      PV-SQL-RETURN-CD                            35520001
355300                      DELIMITED BY SIZE                           35530001
355400                      INTO PV-CICS-MSG-AREA                       35540001
355500             PERFORM 7000-WRITE-TO-CICS-LOG                       35550001
355600                                                                  35560001
355700             SET WS001-INVALID-SQL      TO TRUE                   35570001
355800             STRING 'SQL='                                        35580001
355900                  PV-SQL-RETURN-CD                                35590001
356000                  DELIMITED BY SIZE                               35600001
356100                                      INTO WS001-CRA-RET-MSG      35610001
356200             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  35620001
356300             MOVE SQLCA                 TO WS001-SQLCA            35630001
356400                                           DP013-SQLCA            35640001
356500             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        35650001
356600             SET DP013-DB2-ABEND        TO TRUE                   35660001
356700             PERFORM 9999-ABEND                                   35670001
356800     END-EVALUATE.                                                35680001
356900                                                                  35690001
357000     SET PS-FIRST-RECORD-YES          TO TRUE.                    35700001
357100     MOVE 0                           TO WS-HOLD-PO-NBR.          35710001
357200     MOVE 0                           TO WS-HOLD-RCVR-SEQ-NBR.    35720001
357300                                                                  35730001
357400/                                                                 35740001
357500 5350-FETCH-PO-RCVR-CSR2.                                         35750001
357600                                                                  35760001
357700     MOVE '5350-FETCH-PO-RCVR-CSR2'                               35770001
357800                                 TO WS001-PARAGRAPH-NAME.         35780001
357900                                                                  35790001
358000* GET PO/REC FROM TSHPTPO, TRECIEV.  KEY=SHIPT-ID                 35800001
358100                                                                  35810001
358200     EXEC SQL                                                     35820001
358300          FETCH PO-RCVR-CSR2                                      35830001
358400          INTO                                                    35840001
358500                :SHPTPO-PO-NBR                                    35850001
358600               ,:SHPTPO-REC-SEQ-NBR                               35860001
358700     END-EXEC.                                                    35870001
358800                                                                  35880001
358900     EVALUATE TRUE                                                35890001
359000         WHEN SQLCODE = ZERO                                      35900001
359100             MOVE SHPTPO-PO-NBR      TO WS-PO-NBR                 35910001
359200                                        DK-PO-NBR                 35920001
359300             MOVE SHPTPO-REC-SEQ-NBR TO WS-RCVR-SEQ-NBR           35930001
359400                                        DK-RCVR-SEQ-NBR           35940001
359500             IF PS-CICS-SWITCH-YES                                35950001
359600                 INITIALIZE PV-CICS-MSG-AREA                      35960001
359700                 MOVE WS-PO-NBR TO WS-DISPLAY-1                   35970001
359800                 MOVE WS-RCVR-SEQ-NBR TO WS-DISPLAY-2             35980001
359900                 STRING   ' ' WS001-SRC-TASK-NUMBER               35990001
360000                          ' WSKCS305-5350:'                       36000001
360100                          ' PO NBR='                              36010001
360200                          WS-DISPLAY-1                            36020001
360300                          ' RCVR SEQ NBR='                        36030001
360400                          WS-DISPLAY-2                            36040001
360500                          DELIMITED BY SIZE                       36050001
360600                          INTO PV-CICS-MSG-AREA                   36060001
360700                 PERFORM 7000-WRITE-TO-CICS-LOG                   36070001
360800             END-IF                                               36080001
360900             IF SHPTPO-PO-NBR NOT = WS-HOLD-PO-NBR                36090001
361000               OR SHPTPO-REC-SEQ-NBR NOT =                        36100001
361100                                      WS-HOLD-RCVR-SEQ-NBR        36110001
361200                 MOVE SHPTPO-PO-NBR TO WS-HOLD-PO-NBR             36120001
361300                 MOVE SHPTPO-REC-SEQ-NBR TO                       36130001
361400                                          WS-HOLD-RCVR-SEQ-NBR    36140001
361500                 IF PS-CICS-SWITCH-YES                            36150001
361600                     MOVE WS-HOLD-PO-NBR TO WS-DISPLAY-1          36160001
361700                     MOVE WS-HOLD-RCVR-SEQ-NBR TO WS-DISPLAY-2    36170001
361800                     INITIALIZE PV-CICS-MSG-AREA                  36180001
361900                     STRING   ' ' WS001-SRC-TASK-NUMBER           36190001
362000                              ' WSKCS305-5350:'                   36200001
362100                              ' HOLD PO NBR='                     36210001
362200                              WS-DISPLAY-1                        36220001
362300                              ' HOLD RCVR SEQ NBR='               36230001
362400                              WS-DISPLAY-2                        36240001
362500                              DELIMITED BY SIZE                   36250001
362600                              INTO PV-CICS-MSG-AREA               36260001
362700                     PERFORM 7000-WRITE-TO-CICS-LOG               36270001
362800                 END-IF                                           36280001
362900                 PERFORM 5610-CHECK-FOR-PBS                       36290001
363000                 IF PS-PACK-BY-STORE-YES                          36300001
363100                     PERFORM 5620-CHECK-FOR-PBS-ERRS              36310001
363200                 END-IF                                           36320001
363300             END-IF                                               36330001
363400             PERFORM 5600-DETAIL-PO-RCVR                          36340001
363500         WHEN SQLCODE = -904                                      36350001
363600         WHEN SQLCODE = -913                                      36360001
363700         WHEN SQLCODE = -911                                      36370001
363800             CONTINUE                                             36380001
363900         WHEN SQLCODE = +100                                      36390001
364000             SET PS-EOF-PO-RCVR-CSR2-YES TO TRUE                  36400001
364100         WHEN SQLWARN0 NOT = SPACES                               36410001
364200         WHEN SQLCODE NOT = ZERO                                  36420001
364300             MOVE SQLCODE               TO PV-SQL-RETURN-CD       36430001
364400             INITIALIZE PV-CICS-MSG-AREA                          36440001
364500             STRING   ' ' WS001-SRC-TASK-NUMBER                   36450001
364600                      ' WSKCS305-5350 ERROR:'                     36460001
364700                      ' SQL='                                     36470001
364800                      PV-SQL-RETURN-CD                            36480001
364900                      DELIMITED BY SIZE                           36490001
365000                      INTO PV-CICS-MSG-AREA                       36500001
365100             PERFORM 7000-WRITE-TO-CICS-LOG                       36510001
365200                                                                  36520001
365300             SET WS001-INVALID-SQL      TO TRUE                   36530001
365400             STRING 'SQL='                                        36540001
365500                  PV-SQL-RETURN-CD                                36550001
365600                  DELIMITED BY SIZE                               36560001
365700                                      INTO WS001-CRA-RET-MSG      36570001
365800             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  36580001
365900             MOVE SQLCA                 TO WS001-SQLCA            36590001
366000                                           DP013-SQLCA            36600001
366100             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        36610001
366200             MOVE 'TSHPTPO'             TO                        36620001
366300                                       DP013-DB2-TABLE-NAME (1)   36630001
366400             MOVE 'TRECEIV'             TO                        36640001
366500                                       DP013-DB2-TABLE-NAME (2)   36650001
366600             SET DP013-DB2-ABEND        TO TRUE                   36660001
366700             PERFORM 9999-ABEND                                   36670001
366800     END-EVALUATE.                                                36680001
366900                                                                  36690001
367000/                                                                 36700001
367100 5360-CLOSE-PO-RCVR-CSR2.                                         36710001
367200                                                                  36720001
367300     MOVE '5360-CLOSE-PO-RCVR-CSR2'                               36730001
367400                                 TO WS001-PARAGRAPH-NAME.         36740001
367500                                                                  36750001
367600     EXEC SQL                                                     36760001
367700          CLOSE PO-RCVR-CSR2                                      36770001
367800     END-EXEC.                                                    36780001
367900                                                                  36790001
368000     EVALUATE TRUE                                                36800001
368100         WHEN SQLCODE = ZERO                                      36810001
368200             IF PS-CICS-SWITCH-YES                                36820001
368300                 INITIALIZE PV-CICS-MSG-AREA                      36830001
368400                 STRING   ' ' WS001-SRC-TASK-NUMBER               36840001
368500                          ' WSKCS305-5360:'                       36850001
368600                          ' CLOSE PO-RCVR-CSR2'                   36860001
368700                          DELIMITED BY SIZE                       36870001
368800                          INTO PV-CICS-MSG-AREA                   36880001
368900                 PERFORM 7000-WRITE-TO-CICS-LOG                   36890001
369000             END-IF                                               36900001
369100         WHEN SQLCODE = -904                                      36910001
369200         WHEN SQLCODE = -913                                      36920001
369300         WHEN SQLCODE = -911                                      36930001
369400              CONTINUE                                            36940001
369500         WHEN SQLWARN0 NOT = SPACES                               36950001
369600         WHEN SQLCODE NOT = ZERO                                  36960001
369700             MOVE SQLCODE               TO PV-SQL-RETURN-CD       36970001
369800             INITIALIZE PV-CICS-MSG-AREA                          36980001
369900             STRING   ' ' WS001-SRC-TASK-NUMBER                   36990001
370000                      ' WSKCS305-5360 ERROR:'                     37000001
370100                      ' SQL='                                     37010001
370200                      PV-SQL-RETURN-CD                            37020001
370300                      DELIMITED BY SIZE                           37030001
370400                      INTO PV-CICS-MSG-AREA                       37040001
370500             PERFORM 7000-WRITE-TO-CICS-LOG                       37050001
370600                                                                  37060001
370700             SET WS001-INVALID-SQL      TO TRUE                   37070001
370800             STRING 'SQL='                                        37080001
370900                  PV-SQL-RETURN-CD                                37090001
371000                  DELIMITED BY SIZE                               37100001
371100                                      INTO WS001-CRA-RET-MSG      37110001
371200             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  37120001
371300             MOVE SQLCA                 TO WS001-SQLCA            37130001
371400                                           DP013-SQLCA            37140001
371500             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        37150001
371600             SET DP013-DB2-ABEND        TO TRUE                   37160001
371700             PERFORM 9999-ABEND                                   37170001
371800     END-EVALUATE.                                                37180001
371900                                                                  37190001
372000/                                                                 37200001
372100 5400-DETAIL-LINE-PACK.                                           37210001
372200                                                                  37220001
372300     MOVE '5400-DETAIL-LINE-PACK'                                 37230001
372400                                 TO WS001-PARAGRAPH-NAME.         37240001
372500                                                                  37250001
372600     IF WS001-PREPK-ID > 0                                        37260001
372700         PERFORM 5410-OPEN-RECV-ITM-CSR                           37270001
372800         PERFORM 5420-FETCH-RECV-ITM-CSR UNTIL                    37280001
372900                       PS-EOF-RECV-ITM-CSR-YES                    37290001
373000         PERFORM 5430-CLOSE-RECV-ITM-CSR                          37300001
373100     ELSE                                                         37310001
373200         PERFORM 5440-CHECK-SHIP-XREF-DTL                         37320001
373300     END-IF.                                                      37330001
373400                                                                  37340001
373500/                                                                 37350001
373600 5410-OPEN-RECV-ITM-CSR.                                          37360001
373700                                                                  37370001
373800     MOVE '5410-OPEN-RECV-ITM-CSR'                                37380001
373900                                 TO WS001-PARAGRAPH-NAME.         37390001
374000                                                                  37400001
374100     SET PS-EOF-RECV-ITM-CSR-NO        TO TRUE.                   37410001
374200                                                                  37420001
374300     EXEC SQL                                                     37430001
374400          OPEN RECV-ITM-CSR                                       37440001
374500     END-EXEC.                                                    37450001
374600                                                                  37460001
374700     EVALUATE TRUE                                                37470001
374800         WHEN SQLCODE = ZERO                                      37480001
374900             IF PS-CICS-SWITCH-YES                                37490001
375000                 INITIALIZE PV-CICS-MSG-AREA                      37500001
375100                 MOVE DK-PO-NBR          TO WS-DISPLAY-1          37510001
375200                 MOVE DK-RCVR-SEQ-NBR    TO WS-DISPLAY-2          37520001
375300                 MOVE DK-PREPK-ID        TO WS-DISPLAY-3          37530001
375400                 STRING   ' ' WS001-SRC-TASK-NUMBER               37540001
375500                          ' WSKCS305-5410:'                       37550001
375600                          ' OPEN RECV-ITEM-CSR'                   37560001
375700                          ' FOR PO=' WS-DISPLAY-1                 37570001
375800                          '-' WS-DISPLAY-2                        37580001
375900                          ' PREPK=' WS-DISPLAY-3                  37590001
376000                          DELIMITED BY SIZE                       37600001
376100                          INTO PV-CICS-MSG-AREA                   37610001
376200                 PERFORM 7000-WRITE-TO-CICS-LOG                   37620001
376300             END-IF                                               37630001
376400         WHEN SQLCODE = -904                                      37640001
376500         WHEN SQLCODE = -913                                      37650001
376600         WHEN SQLCODE = -911                                      37660001
376700             CONTINUE                                             37670001
376800         WHEN SQLWARN0 NOT = SPACES                               37680001
376900         WHEN SQLCODE NOT = ZERO                                  37690001
377000             MOVE SQLCODE               TO PV-SQL-RETURN-CD       37700001
377100             INITIALIZE PV-CICS-MSG-AREA                          37710001
377200             STRING   ' ' WS001-SRC-TASK-NUMBER                   37720001
377300                      ' WSKCS305-5410 ERROR:'                     37730001
377400                      ' SQL='                                     37740001
377500                      PV-SQL-RETURN-CD                            37750001
377600                      DELIMITED BY SIZE                           37760001
377700                      INTO PV-CICS-MSG-AREA                       37770001
377800             PERFORM 7000-WRITE-TO-CICS-LOG                       37780001
377900                                                                  37790001
378000             SET WS001-INVALID-SQL      TO TRUE                   37800001
378100             STRING 'SQL='                                        37810001
378200                  PV-SQL-RETURN-CD                                37820001
378300                  DELIMITED BY SIZE                               37830001
378400                                      INTO WS001-CRA-RET-MSG      37840001
378500             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  37850001
378600             MOVE SQLCA                 TO WS001-SQLCA            37860001
378700                                           DP013-SQLCA            37870001
378800             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        37880001
378900             SET DP013-DB2-ABEND        TO TRUE                   37890001
379000             PERFORM 9999-ABEND                                   37900001
379100     END-EVALUATE.                                                37910001
379200                                                                  37920001
379300/                                                                 37930001
379400 5420-FETCH-RECV-ITM-CSR.                                         37940001
379500                                                                  37950001
379600     MOVE '5420-FETCH-RECV-ITM-CSR'                               37960001
379700                                 TO WS001-PARAGRAPH-NAME.         37970001
379800                                                                  37980001
379900* GET ORD LNE FROM TRECITM.  KEYS ARE PO/RCVR/PREPK.              37990001
380000                                                                  38000001
380100     EXEC SQL                                                     38010001
380200          FETCH RECV-ITM-CSR                                      38020001
380300          INTO                                                    38030001
380400                :RECITM-ORD-LNE-NBR                               38040001
380500     END-EXEC.                                                    38050001
380600                                                                  38060001
380700     EVALUATE TRUE                                                38070001
380800         WHEN SQLCODE = ZERO                                      38080001
380900              MOVE RECITM-ORD-LNE-NBR TO WS-PO-LNE-NBR            38090001
381000              IF PS-CICS-SWITCH-YES                               38100001
381100                  MOVE WS-PO-LNE-NBR TO WS-DISPLAY-1              38110001
381200                  INITIALIZE PV-CICS-MSG-AREA                     38120001
381300                  STRING   ' ' WS001-SRC-TASK-NUMBER              38130001
381400                           ' WSKCS305-5420:'                      38140001
381500                           ' PO LNE NBR='                         38150001
381600                           WS-DISPLAY-1                           38160001
381700                           DELIMITED BY SIZE                      38170001
381800                           INTO PV-CICS-MSG-AREA                  38180001
381900                  PERFORM 7000-WRITE-TO-CICS-LOG                  38190001
382000              END-IF                                              38200001
382100              PERFORM 5440-CHECK-SHIP-XREF-DTL                    38210001
382200         WHEN SQLCODE = -904                                      38220001
382300         WHEN SQLCODE = -913                                      38230001
382400         WHEN SQLCODE = -911                                      38240001
382500             CONTINUE                                             38250001
382600         WHEN SQLCODE = +100                                      38260001
382700             SET PS-EOF-RECV-ITM-CSR-YES TO TRUE                  38270001
382800         WHEN SQLWARN0 NOT = SPACES                               38280001
382900         WHEN SQLCODE NOT = ZERO                                  38290001
383000             MOVE SQLCODE               TO PV-SQL-RETURN-CD       38300001
383100             INITIALIZE PV-CICS-MSG-AREA                          38310001
383200             STRING   ' ' WS001-SRC-TASK-NUMBER                   38320001
383300                      ' WSKCS305-5420 ERROR:'                     38330001
383400                      ' SQL='                                     38340001
383500                      PV-SQL-RETURN-CD                            38350001
383600                      DELIMITED BY SIZE                           38360001
383700                      INTO PV-CICS-MSG-AREA                       38370001
383800             PERFORM 7000-WRITE-TO-CICS-LOG                       38380001
383900                                                                  38390001
384000             SET WS001-INVALID-SQL      TO TRUE                   38400001
384100             STRING 'SQL='                                        38410001
384200                  PV-SQL-RETURN-CD                                38420001
384300                  DELIMITED BY SIZE                               38430001
384400                                      INTO WS001-CRA-RET-MSG      38440001
384500             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  38450001
384600             MOVE SQLCA                 TO WS001-SQLCA            38460001
384700                                           DP013-SQLCA            38470001
384800             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        38480001
384900             MOVE 'TRECITM'             TO                        38490001
385000                                       DP013-DB2-TABLE-NAME (1)   38500001
385100             SET DP013-DB2-ABEND        TO TRUE                   38510001
385200             PERFORM 9999-ABEND                                   38520001
385300     END-EVALUATE.                                                38530001
385400                                                                  38540001
385500/                                                                 38550001
385600 5430-CLOSE-RECV-ITM-CSR.                                         38560001
385700                                                                  38570001
385800     MOVE '5430-CLOSE-RECV-ITM-CSR'                               38580001
385900                                 TO WS001-PARAGRAPH-NAME.         38590001
386000                                                                  38600001
386100     EXEC SQL                                                     38610001
386200          CLOSE RECV-ITM-CSR                                      38620001
386300     END-EXEC.                                                    38630001
386400                                                                  38640001
386500     EVALUATE TRUE                                                38650001
386600         WHEN SQLCODE = ZERO                                      38660001
386700              IF PS-CICS-SWITCH-YES                               38670001
386800                  INITIALIZE PV-CICS-MSG-AREA                     38680001
386900                  STRING   ' ' WS001-SRC-TASK-NUMBER              38690001
387000                           ' WSKCS305-5430:'                      38700001
387100                           ' CLOSE RECV-ITM-CSR'                  38710001
387200                           DELIMITED BY SIZE                      38720001
387300                           INTO PV-CICS-MSG-AREA                  38730001
387400                  PERFORM 7000-WRITE-TO-CICS-LOG                  38740001
387500              END-IF                                              38750001
387600         WHEN SQLCODE = -904                                      38760001
387700         WHEN SQLCODE = -913                                      38770001
387800         WHEN SQLCODE = -911                                      38780001
387900             CONTINUE                                             38790001
388000         WHEN SQLWARN0 NOT = SPACES                               38800001
388100         WHEN SQLCODE NOT = ZERO                                  38810001
388200             MOVE SQLCODE               TO PV-SQL-RETURN-CD       38820001
388300             INITIALIZE PV-CICS-MSG-AREA                          38830001
388400             STRING   ' ' WS001-SRC-TASK-NUMBER                   38840001
388500                      ' WSKCS305-5430 ERROR:'                     38850001
388600                      ' SQL='                                     38860001
388700                      PV-SQL-RETURN-CD                            38870001
388800                      DELIMITED BY SIZE                           38880001
388900                      INTO PV-CICS-MSG-AREA                       38890001
389000             PERFORM 7000-WRITE-TO-CICS-LOG                       38900001
389100                                                                  38910001
389200             SET WS001-INVALID-SQL      TO TRUE                   38920001
389300             STRING 'SQL='                                        38930001
389400                  PV-SQL-RETURN-CD                                38940001
389500                  DELIMITED BY SIZE                               38950001
389600                                      INTO WS001-CRA-RET-MSG      38960001
389700             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  38970001
389800             MOVE SQLCA                 TO WS001-SQLCA            38980001
389900                                           DP013-SQLCA            38990001
390000             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        39000001
390100             SET DP013-DB2-ABEND        TO TRUE                   39010001
390200             PERFORM 9999-ABEND                                   39020001
390300     END-EVALUATE.                                                39030001
390400                                                                  39040001
390500/                                                                 39050001
390600 5440-CHECK-SHIP-XREF-DTL.                                        39060001
390700                                                                  39070001
390800     MOVE '5440-CHECK-SHIP-XREF-DTL'                              39080001
390900                                 TO WS001-PARAGRAPH-NAME.         39090001
391000                                                                  39100001
391100     IF PS-PACK-BY-STORE-YES                                      39110001
391200         IF PS-PBS-CARTON-DATA-YES                                39120001
391300             IF PS-PBS-CASE-INVALID-YES                           39130001
391400                 MOVE 'S'             TO WST00002-ASN-LVL-CDE     39140001
391500             ELSE                                                 39150001
391600                 MOVE 'C'             TO WST00002-ASN-LVL-CDE     39160001
391700             END-IF                                               39170001
391800         ELSE                                                     39180001
391900             MOVE 'S'                 TO WST00002-ASN-LVL-CDE     39190001
392000         END-IF                                                   39200001
392100     ELSE                                                         39210001
392200         INITIALIZE PC251-FIELDS                                  39220001
392300         PERFORM 5450-PROCESS-FOR-UCC128-DATA                     39230001
392400         PERFORM 5470-GET-TRANSCRIBE                              39240001
392500                                                                  39250001
392600*RPK     IF PC251-TOTAL-CARTONS = PV-TRANSCRIBE-SUM               39260001
392700         IF PV-UCC128-CRTN-UNTS = PV-TRANSCRIBE-SUM               39270001
392800             CONTINUE                                             39280001
392900         ELSE                                                     39290001
392910**26/07/2013**AMIT**INITIAL                                       39291001
392920*            SET PS-LNE-UCC128-DATA-NO TO TRUE                    39292001
392930           IF PV-UCC128-CRTN-UNTS > 0                             39293001
392940             SET PS-LNE-UCC128-DATA-YES TO TRUE                   39294001
392950           ELSE                                                   39295001
392960             SET PS-LNE-UCC128-DATA-NO   TO TRUE                  39296001
392970           END-IF                                                 39297001
392971*            SET PS-LNE-UCC128-DATA-NO TO TRUE                    39297101
392972**26/07/2013**AMIT**INITIAL                                       39297201
392973         END-IF                                                   39297301
392974                                                                  39297401
392975         IF PS-LNE-UCC128-DATA-YES                                39297501
392976             PERFORM 5480-GET-OUTER-PK-QTY                        39297601
392977             PERFORM 5500-CASEPACK-SPLIT                          39297701
392978         END-IF                                                   39297801
392979                                                                  39297901
393110*ROOPA FOR MIXED SKU REQUIREMENT                                  39311001
393120*        IF PS-LNE-UCC128-DATA-YES                                39312001
393130*          AND NOT PC251-PRE-PACK-ORDER                           39313001
393140*            PERFORM 5465-CHECK-CRTN-MLT-LNES                     39314001
393150*        END-IF                                                   39315001
393200                                                                  39320001
393300         IF PS-LNE-UCC128-DATA-YES                                39330001
393400             MOVE 'C'                 TO WST00002-ASN-LVL-CDE     39340001
393500         ELSE                                                     39350001
393600             MOVE 'S'                 TO WST00002-ASN-LVL-CDE     39360001
393700         END-IF                                                   39370001
393800     END-IF.                                                      39380001
393900                                                                  39390001
394000     MOVE WS-EXT-SHP-ID         TO WST00002-EXT-SHP-ID.           39400001
394100     MOVE WS-PO-NBR             TO WST00002-PO-NBR.               39410001
394200     MOVE WS-RCVR-SEQ-NBR       TO WST00002-RCVR-SEQ-NBR.         39420001
394300     MOVE WS-PO-LNE-NBR         TO WST00002-PO-LNE-NBR.           39430001
394400     MOVE WS-PREPK-ID           TO WST00002-PREPK-ID.             39440001
394500     MOVE WS001-USER-ID         TO WST00002-CRE-USR-ID.           39450001
394600     MOVE PV-CURRENT-TIMESTAMP  TO WST00002-CRE-TMST.             39460001
394700     MOVE 'N'                   TO WST00002-DWNLD-CDE.            39470001
394800     MOVE 'A'                   TO WST00002-ACTV-CDE.             39480001
394900     MOVE WS001-CALLING-PROGRAM-NAME                              39490001
395000                                TO WST00002-CRE-PGM-CDE.          39500001
395100                                                                  39510001
395200     PERFORM 5445-INSERT-SHIP-XREF-DTL.                           39520001
395300                                                                  39530001
395400/                                                                 39540001
395500 5445-INSERT-SHIP-XREF-DTL.                                       39550001
395600                                                                  39560001
395700* BEFORE DOING THE ACTUAL INSERT TO THE TABLE, CHECK TO           39570001
395800* MAKE SURE THAT THE PO/RCVR/LINE IS ON THE TRECDIS TABLE.        39580001
395900* IF IT IS NOT, THEN DO NOT INSERT TO WST_SHPMT_XREF_DTL.         39590001
396000* WS-SQL-CNT WILL BE ZERO IF A ROW IS FOUND ON TRECDIS.           39600001
396100                                                                  39610001
396200     MOVE '5445-INSERT-SHIP-XREF-DTL'                             39620001
396300                                 TO WS001-PARAGRAPH-NAME.         39630001
396400     EXEC SQL                                                     39640001
396500         SELECT COUNT(*)                                          39650001
396600         INTO   :WS-SQL-CNT                                       39660001
396700         FROM   TRECITM A                                         39670001
396800         WHERE  A.ORD_NBR        = :WST00002-PO-NBR               39680001
396900         AND    A.ORD_LNE_NBR    = :WST00002-PO-LNE-NBR           39690001
397000         AND    A.REC_SEQ_NBR    = :WST00002-RCVR-SEQ-NBR         39700001
397100         AND    A.VER_STATUS_CDE = 'A'                            39710001
397200         AND NOT EXISTS                                           39720001
397300            (SELECT *                                             39730001
397400             FROM   TRECDIS B                                     39740001
397500             WHERE  B.ORD_NBR     = A.ORD_NBR                     39750001
397600             AND    B.ORD_LNE_NBR = A.ORD_LNE_NBR                 39760001
397700             AND    B.REC_SEQ_NBR = A.REC_SEQ_NBR)                39770001
397800     END-EXEC.                                                    39780001
397900                                                                  39790001
398000     EVALUATE TRUE                                                39800001
398100         WHEN SQLCODE = ZERO                                      39810001
398200             IF PS-CICS-SWITCH-YES                                39820001
398300                AND WS-SQL-CNT = 0                                39830001
398400                 MOVE WST00002-PO-NBR       TO WS-DISPLAY-PO-NBR  39840001
398500                 MOVE WST00002-PO-LNE-NBR   TO WS-DISPLAY-1       39850001
398600                 MOVE WST00002-RCVR-SEQ-NBR TO WS-DISPLAY-2       39860001
398700                 INITIALIZE PV-CICS-MSG-AREA                      39870001
398800                 STRING   ' ' WS001-SRC-TASK-NUMBER               39880001
398900                          ' WSKCS305-5445:'                       39890001
399000                          ' LINE ON TRECDIS'                      39900001
399100                          ' FOR PO=' WS-DISPLAY-PO-NBR            39910001
399200                          ' RCVR=' WS-DISPLAY-2                   39920001
399300                          ' LINE=' WS-DISPLAY-1                   39930001
399400                          DELIMITED BY SIZE                       39940001
399500                          INTO PV-CICS-MSG-AREA                   39950001
399600                 PERFORM 7000-WRITE-TO-CICS-LOG                   39960001
399700             END-IF                                               39970001
399800             IF WS-SQL-CNT = 0                                    39980001
399900                 PERFORM 5447-INSERT-SHIP-XREF-DTL                39990001
400000             END-IF                                               40000001
400100         WHEN SQLCODE = -904                                      40010001
400200         WHEN SQLCODE = -913                                      40020001
400300         WHEN SQLCODE = -911                                      40030001
400400             CONTINUE                                             40040001
400500         WHEN SQLWARN0 NOT = SPACES                               40050001
400600         WHEN SQLCODE NOT = ZERO                                  40060001
400700             MOVE SQLCODE               TO PV-SQL-RETURN-CD       40070001
400800             INITIALIZE PV-CICS-MSG-AREA                          40080001
400900             STRING   ' ' WS001-SRC-TASK-NUMBER                   40090001
401000                      ' WSKCS305-5445 ERROR:'                     40100001
401100                      ' SQL='                                     40110001
401200                      PV-SQL-RETURN-CD                            40120001
401300                      DELIMITED BY SIZE                           40130001
401400                      INTO PV-CICS-MSG-AREA                       40140001
401500             PERFORM 7000-WRITE-TO-CICS-LOG                       40150001
401600                                                                  40160001
401700             SET WS001-INVALID-SQL      TO TRUE                   40170001
401800             STRING 'SQL='                                        40180001
401900                  PV-SQL-RETURN-CD                                40190001
402000                  DELIMITED BY SIZE                               40200001
402100                                      INTO WS001-CRA-RET-MSG      40210001
402200             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  40220001
402300             MOVE SQLCA                 TO WS001-SQLCA            40230001
402400                                           DP013-SQLCA            40240001
402500             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        40250001
402600             MOVE 'WST_SHPMT_XREF_DTL'  TO                        40260001
402700                                       DP013-DB2-TABLE-NAME (1)   40270001
402800             SET DP013-DB2-ABEND        TO TRUE                   40280001
402900             PERFORM 9999-ABEND                                   40290001
403000     END-EVALUATE.                                                40300001
403100*                                                                 40310001
403200/                                                                 40320001
403300 5447-INSERT-SHIP-XREF-DTL.                                       40330001
403400                                                                  40340001
403500* DO THE INSERT TO THE TABLE.  IF THE RECORD ALREADY EXISTS,      40350001
403600* THEN CALL 5530- WHICH WILL DO AN UPDATE INSTEAD.                40360001
403700* THE KEY TO THE TABLE IS EXT-SHP-ID/PO/RCVR/LINE/PREPK-ID        40370001
403800                                                                  40380001
403900     MOVE '5447-INSERT-SHIP-XREF-DTL'                             40390001
404000                                 TO WS001-PARAGRAPH-NAME.         40400001
404100     EXEC SQL                                                     40410001
404200         INSERT INTO WST_SHPMT_XREF_DTL                           40420001
404300               (EXT_SHP_ID                                        40430001
404400              , PO_NBR                                            40440001
404500              , PO_LNE_NBR                                        40450001
404600              , RCVR_SEQ_NBR                                      40460001
404700              , ASN_LVL_CDE                                       40470001
404800              , PREPK_ID                                          40480001
404900              , CRE_USR_ID                                        40490001
405000              , CRE_TMST                                          40500001
405100              , DWNLD_CDE                                         40510001
405200              , ACTV_CDE                                          40520001
405300              , CRE_PGM_CDE )                                     40530001
405400         VALUES                                                   40540001
405500              (:WST00002-EXT-SHP-ID                               40550001
405600             , :WST00002-PO-NBR                                   40560001
405700             , :WST00002-PO-LNE-NBR                               40570001
405800             , :WST00002-RCVR-SEQ-NBR                             40580001
405900             , :WST00002-ASN-LVL-CDE                              40590001
406000             , :WST00002-PREPK-ID                                 40600001
406100             , :WST00002-CRE-USR-ID                               40610001
406200             , :WST00002-CRE-TMST                                 40620001
406300             , :WST00002-DWNLD-CDE                                40630001
406400             , :WST00002-ACTV-CDE                                 40640001
406500             , :WST00002-CRE-PGM-CDE)                             40650001
406600     END-EXEC.                                                    40660001
406700                                                                  40670001
406800     EVALUATE TRUE                                                40680001
406900         WHEN SQLCODE = ZERO                                      40690001
407000             SET PS-DETAIL-CREATED-YES  TO TRUE                   40700001
407100             IF PS-CICS-SWITCH-YES                                40710001
407200                 MOVE WST00002-PO-NBR TO WS-DISPLAY-1             40720001
407300                 INITIALIZE PV-CICS-MSG-AREA                      40730001
407400                 STRING   ' ' WS001-SRC-TASK-NUMBER               40740001
407500                          ' WSKCS305-5447:'                       40750001
407600                          ' INSERT WST_SHPMT_XREF_DTL'            40760001
407700                          ' FOR SHPMT='                           40770001
407800                          WST00002-EXT-SHP-ID                     40780001
407900                          ' PO NBR='                              40790001
408000                          WS-DISPLAY-1                            40800001
408100                          DELIMITED BY SIZE                       40810001
408200                          INTO PV-CICS-MSG-AREA                   40820001
408300                 PERFORM 7000-WRITE-TO-CICS-LOG                   40830001
408400             END-IF                                               40840001
408500         WHEN SQLCODE = -904                                      40850001
408600         WHEN SQLCODE = -913                                      40860001
408700         WHEN SQLCODE = -911                                      40870001
408800             CONTINUE                                             40880001
408900         WHEN SQLCODE = -803                                      40890001
409000             PERFORM 5530-UPDATE-SHIP-XREF-DTL                    40900001
409100         WHEN SQLWARN0 NOT = SPACES                               40910001
409200         WHEN SQLCODE NOT = ZERO                                  40920001
409300             MOVE SQLCODE               TO PV-SQL-RETURN-CD       40930001
409400             INITIALIZE PV-CICS-MSG-AREA                          40940001
409500             STRING   ' ' WS001-SRC-TASK-NUMBER                   40950001
409600                      ' WSKCS305-5447 ERROR:'                     40960001
409700                      ' SQL='                                     40970001
409800                      PV-SQL-RETURN-CD                            40980001
409900                      DELIMITED BY SIZE                           40990001
410000                      INTO PV-CICS-MSG-AREA                       41000001
410100             PERFORM 7000-WRITE-TO-CICS-LOG                       41010001
410200                                                                  41020001
410300             SET WS001-INVALID-SQL      TO TRUE                   41030001
410400             STRING 'SQL='                                        41040001
410500                  PV-SQL-RETURN-CD                                41050001
410600                  DELIMITED BY SIZE                               41060001
410700                                      INTO WS001-CRA-RET-MSG      41070001
410800             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  41080001
410900             MOVE SQLCA                 TO WS001-SQLCA            41090001
411000                                           DP013-SQLCA            41100001
411100             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        41110001
411200             MOVE 'WST_SHPMT_XREF_DTL'  TO                        41120001
411300                                       DP013-DB2-TABLE-NAME (1)   41130001
411400             SET DP013-DB2-ABEND        TO TRUE                   41140001
411500             PERFORM 9999-ABEND                                   41150001
411600     END-EVALUATE.                                                41160001
411700*                                                                 41170001
411800/                                                                 41180001
411900******************************************************************41190001
412000* CHECK IF THE PO RCVR HAS UCC128 DATA                           *41200001
412100******************************************************************41210001
412200 5450-PROCESS-FOR-UCC128-DATA.                                    41220001
412300                                                                  41230001
412400     MOVE '5450-PROCESS-FOR-UCC128-DATA' TO WS001-PARAGRAPH-NAME. 41240001
412500                                                                  41250001
412600     SET PS-LNE-UCC128-DATA-NO           TO TRUE.                 41260001
412700     PERFORM 5455-CHECK-UCC128-CRTN-DATA                          41270001
412800     IF PS-LNE-UCC128-DATA-YES                                    41280001
412900         PERFORM 5460-CHECK-UCC128-QTY-DATA                       41290001
413000     END-IF.                                                      41300001
413100                                                                  41310001
413200/                                                                 41320001
413300 5455-CHECK-UCC128-CRTN-DATA.                                     41330001
413400                                                                  41340001
413500     MOVE '5455-CHECK-UCC128-CRTN-DATA'                           41350001
413600                                 TO WS001-PARAGRAPH-NAME.         41360001
413700                                                                  41370001
413800     EXEC SQL                                                     41380001
413900          SELECT SUM(C.SHPD_QTY)                                  41390001
414000            INTO :PV-UCC128-CRTN-UNTS                             41400001
414100            FROM TPKSLIP A                                        41410001
414200                ,TINPKSU B                                        41420001
414300                ,TSHUUPC C                                        41430001
414400           WHERE A.PO_NBR        = :WS-PO-NBR                     41440001
414500             AND A.REC_SEQ_NBR   = :WS-RCVR-SEQ-NBR               41450001
414600             AND A.VER_STAT_CDE  = 'A'                            41460001
414700             AND A.PKSL_STAT_CDE = 'AC'                           41470001
414800             AND B.PO_NBR        = A.PO_NBR                       41480001
414900             AND B.SEQ_NBR       = A.SEQ_NBR                      41490001
415000             AND C.SHIPT_UNT_ID  = B.SHIPT_UNT_ID                 41500001
415100             AND C.TRN_NBR       = A.PO_NBR                       41510001
415200             AND C.TRN_LNE_NBR   = :WS-PO-LNE-NBR                 41520001
415300     END-EXEC.                                                    41530001
415400                                                                  41540001
415500                                                                  41550001
415600     EVALUATE TRUE                                                41560001
415700        WHEN SQLCODE = ZERO                                       41570001
415800*RPK        IF PV-UCC128-CRTN-CNT  >  0                           41580001
415900            IF PV-UCC128-CRTN-UNTS >  0                           41590001
416000               SET PS-LNE-UCC128-DATA-YES TO TRUE                 41600001
416100*RPK           MOVE PV-UCC128-CRTN-CNT    TO PC251-TOTAL-CARTONS  41610001
416200            ELSE                                                  41620001
416300*RPK           MOVE ZEROES                TO PC251-TOTAL-CARTONS  41630001
416400               SET PS-LNE-UCC128-DATA-NO  TO TRUE                 41640001
416500            END-IF                                                41650001
416600            IF PS-CICS-SWITCH-YES                                 41660001
416700                MOVE PV-UCC128-CRTN-UNTS  TO WS-DISPLAY-1         41670001
416800                INITIALIZE PV-CICS-MSG-AREA                       41680001
416900                STRING   ' ' WS001-SRC-TASK-NUMBER                41690001
417000                         ' WSKCS305-5455:'                        41700001
417100                         ' UCC128 CRTN CNT=' WS-DISPLAY-1         41710001
417200                         DELIMITED BY SIZE                        41720001
417300                                      INTO PV-CICS-MSG-AREA       41730001
417400                PERFORM 7000-WRITE-TO-CICS-LOG                    41740001
417500            END-IF                                                41750001
417600        WHEN SQLCODE = -305                                       41760001
417700            SET PS-LNE-UCC128-DATA-NO   TO TRUE                   41770001
417800*RPK        MOVE ZEROES                 TO PC251-TOTAL-CARTONS    41780001
417900            MOVE ZEROES                 TO PV-UCC128-CRTN-UNTS    41790001
418000        WHEN SQLWARN0 NOT = SPACES                                41800001
418100        WHEN SQLCODE NOT = ZERO                                   41810001
418200            SET WS001-INVALID-SQL       TO TRUE                   41820001
418300            MOVE SQLCODE                TO PV-SQL-RETURN-CD       41830001
418400            STRING 'SQL='                                         41840001
418500                 PV-SQL-RETURN-CD                                 41850001
418600                 DELIMITED BY SIZE                                41860001
418700                                      INTO WS001-CRA-RET-MSG      41870001
418800            MOVE SQLCA                  TO WS001-SQLCA            41880001
418900            IF PS-CICS-SWITCH-YES                                 41890001
419000                MOVE WS-PO-NBR          TO WS-DISPLAY-PO-NBR      41900001
419100                MOVE WS-RCVR-SEQ-NBR    TO WS-DISPLAY-RCVR-NBR    41910001
419200                MOVE WS-PO-LNE-NBR      TO WS-DISPLAY-LNE-NBR     41920001
419300                INITIALIZE PV-CICS-MSG-AREA                       41930001
419400                STRING   ' ' WS001-SRC-TASK-NUMBER                41940001
419500                         ' WSKCS305-5455 ERROR:'                  41950001
419600                         ' SQL='                                  41960001
419700                         PV-SQL-RETURN-CD                         41970001
419800                         ' PO= ' WS-DISPLAY-PO-NBR                41980001
419900                         ' RCVR= ' WS-DISPLAY-RCVR-NBR            41990001
420000                         ' LNE= ' WS-DISPLAY-LNE-NBR              42000001
420100                         DELIMITED BY SIZE                        42010001
420200                                      INTO PV-CICS-MSG-AREA       42020001
420300                PERFORM 7000-WRITE-TO-CICS-LOG                    42030001
420400            END-IF                                                42040001
420500     END-EVALUATE.                                                42050001
420600                                                                  42060001
420700/                                                                 42070001
420800 5460-CHECK-UCC128-QTY-DATA.                                      42080001
420900                                                                  42090001
421000      MOVE '5460-CHECK-UCC128-QTY-DATA '                          42100001
421100                                 TO WS001-PARAGRAPH-NAME.         42110001
421200      EXEC SQL                                                    42120001
421300          SELECT SUM(C.SHPD_QTY)                                  42130001
421400                ,COUNT(DISTINCT C.SHPD_QTY)                       42140001
421500            INTO :PV-UCC128-TOT-UNTS                              42150001
421600                ,:PV-UCC128-TOT-OTPK-QTYS                         42160001
421700            FROM TPKSLIP A                                        42170001
421800                ,TINPKSU B                                        42180001
421900                ,TSHUUPC C                                        42190001
422000           WHERE A.PO_NBR        = :WS-PO-NBR                     42200001
422100             AND A.REC_SEQ_NBR   = :WS-RCVR-SEQ-NBR               42210001
422200             AND A.VER_STAT_CDE  = 'A'                            42220001
422300             AND A.PKSL_STAT_CDE = 'AC'                           42230001
422400             AND B.PO_NBR        = A.PO_NBR                       42240001
422500             AND B.SEQ_NBR       = A.SEQ_NBR                      42250001
422600             AND C.SHIPT_UNT_ID  = B.SHIPT_UNT_ID                 42260001
422700             AND C.TRN_NBR       = A.PO_NBR                       42270001
422800             AND C.TRN_LNE_NBR   = :WS-PO-LNE-NBR                 42280001
422900      END-EXEC.                                                   42290001
423000                                                                  42300001
423100      EVALUATE TRUE                                               42310001
423200          WHEN SQLCODE = ZERO                                     42320001
423300              SET PS-LNE-UCC128-DATA-YES    TO TRUE               42330001
423400              IF PS-CICS-SWITCH-YES                               42340001
423500                  INITIALIZE PV-CICS-MSG-AREA                     42350001
423600                  MOVE PV-UCC128-TOT-UNTS   TO WS-DISPLAY-1       42360001
423700                  STRING  ' ' WS001-SRC-TASK-NUMBER               42370001
423800                          ' WSKCS305-5460:'                       42380001
423900                          ' UCC128 UNTS='                         42390001
424000                          WS-DISPLAY-1                            42400001
424100                          DELIMITED BY SIZE                       42410001
424200                                          INTO PV-CICS-MSG-AREA   42420001
424300                  PERFORM 7000-WRITE-TO-CICS-LOG                  42430001
424400              END-IF                                              42440001
424500          WHEN SQLCODE = -305                                     42450001
424600              SET PS-LNE-UCC128-DATA-NO  TO TRUE                  42460001
424700          WHEN SQLWARN0 NOT = SPACES                              42470001
424800          WHEN SQLCODE NOT = ZERO                                 42480001
424900              MOVE SQLCODE               TO PV-SQL-RETURN-CD      42490001
425000              MOVE WS-PO-NBR             TO WS-DISPLAY-PO-NBR     42500001
425100              MOVE WS-RCVR-SEQ-NBR       TO WS-DISPLAY-RCVR-NBR   42510001
425200              MOVE WS-PO-LNE-NBR         TO WS-DISPLAY-LNE-NBR    42520001
425300              INITIALIZE PV-CICS-MSG-AREA                         42530001
425400              STRING   ' ' WS001-SRC-TASK-NUMBER                  42540001
425500                       ' WSKCS305-5460 ERROR:'                    42550001
425600                       ' SQL='                                    42560001
425700                       PV-SQL-RETURN-CD                           42570001
425800                       ' PO= ' WS-DISPLAY-PO-NBR                  42580001
425900                       ' RCVR= ' WS-DISPLAY-RCVR-NBR              42590001
426000                       ' LNE= ' WS-DISPLAY-LNE-NBR                42600001
426100                       DELIMITED BY SIZE                          42610001
426200                                       INTO PV-CICS-MSG-AREA      42620001
426300              PERFORM 7000-WRITE-TO-CICS-LOG                      42630001
426400                                                                  42640001
426500             SET WS001-INVALID-SQL      TO TRUE                   42650001
426600             STRING 'SQL='                                        42660001
426700                  PV-SQL-RETURN-CD                                42670001
426800                  DELIMITED BY SIZE                               42680001
426900                                      INTO WS001-CRA-RET-MSG      42690001
427000             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  42700001
427100             MOVE SQLCA                 TO WS001-SQLCA            42710001
427200                                           DP013-SQLCA            42720001
427300             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        42730001
427400             MOVE 'TPKSLIP'             TO                        42740001
427500                                       DP013-DB2-TABLE-NAME (1)   42750001
427600             MOVE 'TINPKSU'             TO                        42760001
427700                                       DP013-DB2-TABLE-NAME (2)   42770001
427800             MOVE 'TSHUUPC'             TO                        42780001
427900                                       DP013-DB2-TABLE-NAME (3)   42790001
428000             SET DP013-DB2-ABEND        TO TRUE                   42800001
428100             PERFORM 9999-ABEND                                   42810001
428200      END-EVALUATE.                                               42820001
428300                                                                  42830001
428400/                                                                 42840001
428500 5465-CHECK-CRTN-MLT-LNES.                                        42850001
428600                                                                  42860001
428700      MOVE '5465-CHECK-CRTN-MLT-LNES '                            42870001
428800                                 TO WS001-PARAGRAPH-NAME.         42880001
428900      EXEC SQL                                                    42890001
429000          SELECT COUNT(DISTINCT D.TRN_LNE_NBR)                    42900001
429100            INTO :PV-UCC128-LINES-PER-CRTN                        42910001
429200            FROM TPKSLIP A                                        42920001
429300                ,TINPKSU B                                        42930001
429400                ,TSHUUPC C                                        42940001
429500                ,TSHUUPC D                                        42950001
429600           WHERE A.PO_NBR        = :WS-PO-NBR                     42960001
429700             AND A.REC_SEQ_NBR   = :WS-RCVR-SEQ-NBR               42970001
429800             AND A.VER_STAT_CDE  = 'A'                            42980001
429900             AND A.PKSL_STAT_CDE = 'AC'                           42990001
430000             AND B.PO_NBR        = A.PO_NBR                       43000001
430100             AND B.SEQ_NBR       = A.SEQ_NBR                      43010001
430200             AND C.SHIPT_UNT_ID  = B.SHIPT_UNT_ID                 43020001
430300             AND C.TRN_NBR       = B.PO_NBR                       43030001
430400             AND C.TRN_LNE_NBR   = :WS-PO-LNE-NBR                 43040001
430500             AND D.SHIPT_UNT_ID  = C.SHIPT_UNT_ID                 43050001
430600             AND D.TRN_NBR       = B.PO_NBR                       43060001
430700      END-EXEC.                                                   43070001
430800                                                                  43080001
430900      EVALUATE TRUE                                               43090001
431000          WHEN SQLCODE = ZERO                                     43100001
431100              IF PV-UCC128-LINES-PER-CRTN > 1                     43110001
431200                  SET PS-LNE-UCC128-DATA-NO     TO TRUE           43120001
431300              END-IF                                              43130001
431400              IF PS-CICS-SWITCH-YES                               43140001
431500                  INITIALIZE PV-CICS-MSG-AREA                     43150001
431600                  MOVE PV-UCC128-LINES-PER-CRTN TO WS-DISPLAY-1   43160001
431700                  STRING  ' ' WS001-SRC-TASK-NUMBER               43170001
431800                          ' WSKCS305-5465:'                       43180001
431900                          ' UCC128 LNES PER CRTN='                43190001
432000                          WS-DISPLAY-1                            43200001
432100                          DELIMITED BY SIZE                       43210001
432200                                          INTO PV-CICS-MSG-AREA   43220001
432300                  PERFORM 7000-WRITE-TO-CICS-LOG                  43230001
432400              END-IF                                              43240001
432500          WHEN SQLWARN0 NOT = SPACES                              43250001
432600          WHEN SQLCODE NOT = ZERO                                 43260001
432700              MOVE SQLCODE               TO PV-SQL-RETURN-CD      43270001
432800              MOVE WS-PO-NBR             TO WS-DISPLAY-PO-NBR     43280001
432900              MOVE WS-RCVR-SEQ-NBR       TO WS-DISPLAY-RCVR-NBR   43290001
433000              MOVE WS-PO-LNE-NBR         TO WS-DISPLAY-LNE-NBR    43300001
433100              INITIALIZE PV-CICS-MSG-AREA                         43310001
433200              STRING   ' ' WS001-SRC-TASK-NUMBER                  43320001
433300                       ' WSKCS305-5465 ERROR:'                    43330001
433400                       ' SQL='                                    43340001
433500                       PV-SQL-RETURN-CD                           43350001
433600                       ' PO= ' WS-DISPLAY-PO-NBR                  43360001
433700                       ' RCVR= ' WS-DISPLAY-RCVR-NBR              43370001
433800                       ' LNE= ' WS-DISPLAY-LNE-NBR                43380001
433900                       DELIMITED BY SIZE                          43390001
434000                                       INTO PV-CICS-MSG-AREA      43400001
434100              PERFORM 7000-WRITE-TO-CICS-LOG                      43410001
434200                                                                  43420001
434300             SET WS001-INVALID-SQL      TO TRUE                   43430001
434400             STRING 'SQL='                                        43440001
434500                  PV-SQL-RETURN-CD                                43450001
434600                  DELIMITED BY SIZE                               43460001
434700                                      INTO WS001-CRA-RET-MSG      43470001
434800             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  43480001
434900             MOVE SQLCA                 TO WS001-SQLCA            43490001
435000                                           DP013-SQLCA            43500001
435100             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        43510001
435200             MOVE 'TPKSLIP'             TO                        43520001
435300                                       DP013-DB2-TABLE-NAME (1)   43530001
435400             MOVE 'TINPKSU'             TO                        43540001
435500                                       DP013-DB2-TABLE-NAME (2)   43550001
435600             MOVE 'TSHUUPC'             TO                        43560001
435700                                       DP013-DB2-TABLE-NAME (3)   43570001
435800             SET DP013-DB2-ABEND        TO TRUE                   43580001
435900             PERFORM 9999-ABEND                                   43590001
436000      END-EVALUATE.                                               43600001
436100                                                                  43610001
436200/                                                                 43620001
436300 5470-GET-TRANSCRIBE.                                             43630001
436400                                                                  43640001
436500     MOVE '5470-GET-TRANSCRIBE  '                                 43650001
436600                                 TO WS001-PARAGRAPH-NAME.         43660001
436700     IF PS-CICS-SWITCH-YES                                        43670001
436800         MOVE WS-PO-NBR TO WS-DISPLAY-PO-NBR                      43680001
436900         MOVE WS-RCVR-SEQ-NBR TO WS-DISPLAY-RCVR-NBR              43690001
437000         MOVE WS-PO-LNE-NBR TO WS-DISPLAY-LNE-NBR                 43700001
437100         INITIALIZE PV-CICS-MSG-AREA                              43710001
437200         STRING   ' ' WS001-SRC-TASK-NUMBER                       43720001
437300                  ' WSKCS305-5470: BEFORE:'                       43730001
437400                  ' PO= ' WS-DISPLAY-PO-NBR                       43740001
437500                  ' RCVR= ' WS-DISPLAY-RCVR-NBR                   43750001
437600                  ' LNE= ' WS-DISPLAY-LNE-NBR                     43760001
437700                  DELIMITED BY SIZE                               43770001
437800                  INTO PV-CICS-MSG-AREA                           43780001
437900         PERFORM 7000-WRITE-TO-CICS-LOG                           43790001
438000     END-IF.                                                      43800001
438100                                                                  43810001
438200     EXEC SQL                                                     43820001
438300        SELECT  SUM(EXPTED_ITM_QTY)                               43830001
438400          INTO :PV-TRANSCRIBE-SUM                                 43840001
438500          FROM  TRECDIS                                           43850001
438600      WHERE ORD_NBR        = :WS-PO-NBR                           43860001
438700        AND REC_SEQ_NBR    = :WS-RCVR-SEQ-NBR                     43870001
438800        AND ORD_LNE_NBR    = :WS-PO-LNE-NBR                       43880001
438900      WITH UR                                                     43890001
439000     END-EXEC.                                                    43900001
439100                                                                  43910001
439200     EVALUATE TRUE                                                43920001
439300         WHEN SQLCODE = ZERO                                      43930001
439400             IF PS-CICS-SWITCH-YES                                43940001
439500                 MOVE PV-TRANSCRIBE-SUM    TO WS-DISPLAY-1        43950001
439600                 INITIALIZE PV-CICS-MSG-AREA                      43960001
439700                 STRING  ' ' WS001-SRC-TASK-NUMBER                43970001
439800                         ' WSKCS305-5470:'                        43980001
439900                         ' TRANSCRIBE UNTS='                      43990001
440000                         WS-DISPLAY-1                             44000001
440100                         DELIMITED BY SIZE                        44010001
440200                                         INTO PV-CICS-MSG-AREA    44020001
440300                 PERFORM 7000-WRITE-TO-CICS-LOG                   44030001
440400             END-IF                                               44040001
440500         WHEN SQLCODE = +100                                      44050001
440600         WHEN SQLCODE = -305                                      44060001
440700             MOVE ZEROES                   TO PV-TRANSCRIBE-SUM   44070001
440800*            IF PS-CICS-SWITCH-YES                                44080001
440900*                MOVE SQLCODE              TO PV-SQL-RETURN-CD    44090001
441000*                INITIALIZE PV-CICS-MSG-AREA                      44100001
441100*                STRING  ' ' WS001-SRC-TASK-NUMBER                44110001
441200*                        ' WSKCS305-5470:'                        44120001
441300*                        ' SQLCODE='                              44130001
441400*                        PV-SQL-RETURN-CD                         44140001
441500*                        DELIMITED BY SIZE                        44150001
441600*                                        INTO PV-CICS-MSG-AREA    44160001
441700*                PERFORM 7000-WRITE-TO-CICS-LOG                   44170001
441800*            END-IF                                               44180001
441900         WHEN SQLWARN0 NOT = SPACES                               44190001
442000         WHEN SQLCODE NOT = ZERO                                  44200001
442100            MOVE SQLCODE               TO PV-SQL-RETURN-CD        44210001
442200            MOVE WS-PO-NBR TO WS-DISPLAY-PO-NBR                   44220001
442300            MOVE WS-RCVR-SEQ-NBR TO WS-DISPLAY-RCVR-NBR           44230001
442400            MOVE WS-PO-LNE-NBR TO WS-DISPLAY-LNE-NBR              44240001
442500            INITIALIZE PV-CICS-MSG-AREA                           44250001
442600            STRING   ' ' WS001-SRC-TASK-NUMBER                    44260001
442700                     ' WSKCS305-5470 ERROR:'                      44270001
442800                     ' SQL='                                      44280001
442900                     PV-SQL-RETURN-CD                             44290001
443000                     ' PO= ' WS-DISPLAY-PO-NBR                    44300001
443100                     ' RCVR= ' WS-DISPLAY-RCVR-NBR                44310001
443200                     ' LNE= ' WS-DISPLAY-LNE-NBR                  44320001
443300                     DELIMITED BY SIZE                            44330001
443400                     INTO PV-CICS-MSG-AREA                        44340001
443500            PERFORM 7000-WRITE-TO-CICS-LOG                        44350001
443600                                                                  44360001
443700             SET WS001-INVALID-SQL      TO TRUE                   44370001
443800             STRING 'SQL='                                        44380001
443900                  PV-SQL-RETURN-CD                                44390001
444000                  DELIMITED BY SIZE                               44400001
444100                                      INTO WS001-CRA-RET-MSG      44410001
444200             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  44420001
444300             MOVE SQLCA                 TO WS001-SQLCA            44430001
444400                                           DP013-SQLCA            44440001
444500             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        44450001
444600             MOVE 'TRECDIS'             TO                        44460001
444700                                       DP013-DB2-TABLE-NAME (1)   44470001
444800             SET DP013-DB2-ABEND        TO TRUE                   44480001
444900             PERFORM 9999-ABEND                                   44490001
445000     END-EVALUATE.                                                44500001
445100                                                                  44510001
445200/                                                                 44520001
445300 5480-GET-OUTER-PK-QTY.                                           44530001
445400                                                                  44540001
445500     MOVE '5480-GET-OUTER-PK-QTY'                                 44550001
445600                                 TO WS001-PARAGRAPH-NAME.         44560001
445700                                                                  44570001
445800     EXEC SQL                                                     44580001
445900        SELECT  A.ITM_NBR                                         44590001
446000              , A.CASE_PACK_QTY                                   44600001
446100              , A.PREPK_RATO_QTY                                  44610001
446200              , A.INNR_PACK_QTY                                   44620001
446300              , B.SKU_NBR                                         44630001
446400              , B.OUTR_PK_QTY                                     44640001
446500          INTO :RECITM-ITM-NBR                                    44650001
446600             , :RECITM-CASE-PACK-QTY                              44660001
446700             , :RECITM-PREPK-RATO-QTY                             44670001
446800             , :RECITM-INNR-PACK-QTY                              44680001
446900             , :XLT00003-SKU-NBR                                  44690001
447000             , :XLT00003-OUTR-PK-QTY                              44700001
447100          FROM  TRECITM A                                         44710001
447200             ,  XLT_SKU B                                         44720001
447300      WHERE A.ORD_NBR        = :WS-PO-NBR                         44730001
447400        AND A.REC_SEQ_NBR    = :WS-RCVR-SEQ-NBR                   44740001
447500        AND A.ORD_LNE_NBR    = :WS-PO-LNE-NBR                     44750001
447600        AND A.VER_STATUS_CDE = 'A'                                44760001
447700        AND A.ITM_NBR        = B.ITM_NBR                          44770001
447800     END-EXEC.                                                    44780001
447900                                                                  44790001
448000     EVALUATE TRUE                                                44800001
448100         WHEN SQLCODE = ZERO                                      44810001
448200             IF PS-CICS-SWITCH-YES                                44820001
448300                 MOVE RECITM-ITM-NBR        TO WS-DISPLAY-5       44830001
448400                 MOVE RECITM-CASE-PACK-QTY  TO WS-DISPLAY-1       44840001
448500                 MOVE RECITM-PREPK-RATO-QTY TO WS-DISPLAY-2       44850001
448600                 MOVE RECITM-INNR-PACK-QTY  TO WS-DISPLAY-3       44860001
448700                 MOVE XLT00003-SKU-NBR      TO WS-DISPLAY-4       44870001
448800                 MOVE XLT00003-OUTR-PK-QTY  TO WS-DISPLAY-6       44880001
448900                 INITIALIZE PV-CICS-MSG-AREA                      44890001
449000                 STRING  ' ' WS001-SRC-TASK-NUMBER                44900001
449100                         ' WSKCS305-5480:'                        44910001
449200                         ' ITM NBR=' WS-DISPLAY-5                 44920001
449300                         ' CASE QTY=' WS-DISPLAY-1                44930001
449400                         ' PREPK QTY=' WS-DISPLAY-2               44940001
449500                         ' INNR QTY=' WS-DISPLAY-3                44950001
449600                         ' SKU NBR=' WS-DISPLAY-4                 44960001
449700                         ' OUTR QTY=' WS-DISPLAY-6                44970001
449800                         DELIMITED BY SIZE                        44980001
449900                                         INTO PV-CICS-MSG-AREA    44990001
450000                 PERFORM 7000-WRITE-TO-CICS-LOG                   45000001
450100             END-IF                                               45010001
450200         WHEN SQLCODE = +100                                      45020001
450300             CONTINUE                                             45030001
450400         WHEN SQLWARN0 NOT = SPACES                               45040001
450500         WHEN SQLCODE NOT = ZERO                                  45050001
450600            MOVE SQLCODE               TO PV-SQL-RETURN-CD        45060001
450700            MOVE WS-PO-NBR TO WS-DISPLAY-PO-NBR                   45070001
450800            MOVE WS-RCVR-SEQ-NBR TO WS-DISPLAY-RCVR-NBR           45080001
450900            MOVE WS-PO-LNE-NBR TO WS-DISPLAY-LNE-NBR              45090001
451000            INITIALIZE PV-CICS-MSG-AREA                           45100001
451100            STRING   ' ' WS001-SRC-TASK-NUMBER                    45110001
451200                     ' WSKCS305-5480 ERROR:'                      45120001
451300                     ' SQL='                                      45130001
451400                     PV-SQL-RETURN-CD                             45140001
451500                     ' PO= ' WS-DISPLAY-PO-NBR                    45150001
451600                     ' RCVR= ' WS-DISPLAY-RCVR-NBR                45160001
451700                     ' LNE= ' WS-DISPLAY-LNE-NBR                  45170001
451800                     DELIMITED BY SIZE                            45180001
451900                     INTO PV-CICS-MSG-AREA                        45190001
452000            PERFORM 7000-WRITE-TO-CICS-LOG                        45200001
452100                                                                  45210001
452200             SET WS001-INVALID-SQL      TO TRUE                   45220001
452300             STRING 'SQL='                                        45230001
452400                  PV-SQL-RETURN-CD                                45240001
452500                  DELIMITED BY SIZE                               45250001
452600                                      INTO WS001-CRA-RET-MSG      45260001
452700             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  45270001
452800             MOVE SQLCA                 TO WS001-SQLCA            45280001
452900                                           DP013-SQLCA            45290001
453000             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        45300001
453100             MOVE 'TRECITM'             TO                        45310001
453200                                       DP013-DB2-TABLE-NAME (1)   45320001
453300             MOVE 'XLT_SKU'             TO                        45330001
453400                                       DP013-DB2-TABLE-NAME (2)   45340001
453500             SET DP013-DB2-ABEND        TO TRUE                   45350001
453600             PERFORM 9999-ABEND                                   45360001
453700     END-EVALUATE.                                                45370001
453800                                                                  45380001
453900/                                                                 45390001
454000 5500-CASEPACK-SPLIT.                                             45400001
454100                                                                  45410001
454200     MOVE '5500-CASEPACK-SPLIT'  TO WS001-PARAGRAPH-NAME.         45420001
454300                                                                  45430001
454400     MOVE WS-PO-NBR                   TO PC251-PO-NBR.            45440001
454500     MOVE WS-RCVR-SEQ-NBR             TO PC251-RCVR-SEQ-NBR.      45450001
454600     MOVE WS-PO-LNE-NBR               TO PC251-PO-LNE-NBR.        45460001
454700     MOVE WS-PREPK-ID                 TO PC251-PREPK-ID.          45470001
454800     MOVE WS-PKGNG-CDE                TO PC251-PKGNG-CD.          45480001
454900     MOVE 'WSKCS305'                  TO PC251-CALLING-PROGRAM.   45490001
455000     MOVE WS-OPER-UNT-ID              TO PC251-OPER-UNT-ID.       45500001
455100     MOVE 1                           TO PC251-MOD-NBR.           45510001
455200     SET PC251-FUNC-LBL-CALC          TO TRUE.                    45520001
455300     SET PC251-PRT-SHUFFLED           TO TRUE.                    45530001
455400     SET PC251-CREATE-BOTH            TO TRUE.                    45540001
455500     CALL PC-CASEPACK-SPLIT-MOD  USING  DFHEIBLK                  45550001
455600                                        PC251-COMMAREA            45560001
455700                                        PC251-FIELDS.             45570001
455800     EVALUATE TRUE                                                45580001
455900         WHEN PC251-SUCCESSFUL                                    45590001
456000             PERFORM 5510-VALIDATE-LBL-CALC-CALL                  45600001
456100         WHEN OTHER                                               45610001
456200              MOVE PC251-ERROR-PARA-NBR  TO WS001-PARAGRAPH-NAME  45620001
456300              MOVE PC251-SQL-CODE        TO PV-SQL-RETURN-CD      45630001
456400              STRING 'BAD CALL 719,SQL= '                         45640001
456500                   PV-SQL-RETURN-CD                               45650001
456600                   DELIMITED BY SIZE                              45660001
456700                                       INTO WS001-CRA-RET-MSG     45670001
456800              MOVE WS-PO-NBR TO WS-DISPLAY-PO-NBR                 45680001
456900              MOVE WS-RCVR-SEQ-NBR TO WS-DISPLAY-RCVR-NBR         45690001
457000              MOVE WS-PO-LNE-NBR TO WS-DISPLAY-LNE-NBR            45700001
457100              INITIALIZE PV-CICS-MSG-AREA                         45710001
457200              STRING   ' ' WS001-SRC-TASK-NUMBER                  45720001
457300                       ' WSKCS305-5500 ERROR:'                    45730001
457400                       ' SQL='                                    45740001
457500                       PV-SQL-RETURN-CD                           45750001
457600                    ' PO= ' WS-DISPLAY-PO-NBR                     45760001
457700                    ' RCVR= ' WS-DISPLAY-RCVR-NBR                 45770001
457800                    ' LNE= ' WS-DISPLAY-LNE-NBR                   45780001
457900                    DELIMITED BY SIZE                             45790001
458000                    INTO PV-CICS-MSG-AREA                         45800001
458100              PERFORM 7000-WRITE-TO-CICS-LOG                      45810001
458200             SET WS001-ERROR         TO TRUE                      45820001
458300                                                                  45830001
458400             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  45840001
458500             MOVE SQLCA                 TO WS001-SQLCA            45850001
458600                                           DP013-SQLCA            45860001
458700             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        45870001
458800             SET DP013-DB2-ABEND        TO TRUE                   45880001
458900             PERFORM 9999-ABEND                                   45890001
459000     END-EVALUATE.                                                45900001
459100                                                                  45910001
459200/                                                                 45920001
459300 5510-VALIDATE-LBL-CALC-CALL.                                     45930001
459400                                                                  45940001
459500     MOVE '5510-VALIDATE-LBL-CALC-CALL' TO WS001-PARAGRAPH-NAME.  45950001
459600                                                                  45960001
459700     IF PC251-PRE-PACK-ORDER                                      45970001
459800         IF PC251-PREPK-UCC128-NO                                 45980001
459900             SET PS-LNE-UCC128-DATA-NO    TO TRUE                 45990001
460000         END-IF                                                   46000001
460100     END-IF.                                                      46010001
460200                                                                  46020001
460300     IF PS-CICS-SWITCH-YES                                        46030001
460400         INITIALIZE PV-CICS-MSG-AREA                              46040001
460500         STRING      ' ' WS001-SRC-TASK-NUMBER                    46050001
460600                     ' WSKCS305-5510:'                            46060001
460700                     ' PRCS-QTY=' PC251-PRCS-QTY                  46070001
460800                     ' TRNS-QTY=' PC251-TRNS-QTY                  46080001
460900                     DELIMITED BY SIZE                            46090001
461000                                      INTO PV-CICS-MSG-AREA       46100001
461100         PERFORM 7000-WRITE-TO-CICS-LOG                           46110001
461200     END-IF.                                                      46120001
461300                                                                  46130001
461400*      IF PS-LNE-UCC128-DATA-NO                                   46140001
461500*         PERFORM 5520-CALCULATE-PROCESS-QTY                      46150001
461600*      END-IF.                                                    46160001
461700*                                                                 46170001
461800/                                                                 46180001
461900*5520-CALCULATE-PROCESS-QTY.                                      46190001
462000                                                                  46200001
462100*    MOVE '5520-CALCULATE-PROCESS-QTY ' TO WS001-PARAGRAPH-NAME.  46210001
462200                                                                  46220001
462300*    IF WS-PKGNG-CDE = 'M' OR WS-PKGNG-CDE = 'I'                  46230001
462400*        COMPUTE XLT00003-OUTR-PK-QTY =                           46240001
462500*                RECITM-CASE-PACK-QTY  *                          46250001
462600*                RECITM-PREPK-RATO-QTY                            46260001
462700*    END-IF.                                                      46270001
462800                                                                  46280001
462900*    IF XLT00003-OUTR-PK-QTY > 0 AND                              46290001
463000*       PV-UCC128-CRTN-CNT   > 0                                  46300001
463100*          MULTIPLY  PV-UCC128-CRTN-CNT                           46310001
463200*                BY  XLT00003-OUTR-PK-QTY                         46320001
463300*            GIVING  PV-PROCESS-QTY                               46330001
463400*    END-IF.                                                      46340001
463500                                                                  46350001
463600*    IF PV-TRANSCRIBE-SUM = PV-PROCESS-QTY                        46360001
463700*       CONTINUE                                                  46370001
463800*    ELSE                                                         46380001
463900                                                                  46390001
464000*       MOVE  ZEROES  TO  PV-CARTON-COUNT-CALC                    46400001
464100*                         PV-CARTON-COUNT-REM                     46410001
464200                                                                  46420001
464300*       IF  XLT00003-OUTR-PK-QTY      >  0                        46430001
464400*          DIVIDE  PV-TRANSCRIBE-SUM                              46440001
464500*              BY  XLT00003-OUTR-PK-QTY                           46450001
464600*          GIVING  PV-CARTON-COUNT-CALC                           46460001
464700*                  REMAINDER PV-CARTON-COUNT-REM                  46470001
464800*          END-DIVIDE                                             46480001
464900                                                                  46490001
465000*          IF  PV-CARTON-COUNT-REM  >  +0                         46500001
465100*              MOVE PV-UCC128-CRTN-CNT TO PC251-P2L-LBL-CNT       46510001
465200*          ELSE                                                   46520001
465300*              MOVE PV-CARTON-COUNT-CALC TO PC251-TOTAL-CARTONS   46530001
465400*                                           PC251-FCSE-LBL-CNT    46540001
465500*          END-IF                                                 46550001
465600                                                                  46560001
465700*      END-IF                                                     46570001
465800*    END-IF.                                                      46580001
465900                                                                  46590001
466000/                                                                 46600001
466100 5530-UPDATE-SHIP-XREF-DTL.                                       46610001
466200                                                                  46620001
466300     MOVE '5530-UPDATE-SHIP-XREF-DTL'                             46630001
466400                                 TO WS001-PARAGRAPH-NAME.         46640001
466500                                                                  46650001
466600     EXEC SQL                                                     46660001
466700           UPDATE WST_SHPMT_XREF_DTL                              46670001
466800              SET ASN_LVL_CDE      = :WST00002-ASN-LVL-CDE        46680001
466900                , DWNLD_CDE        = :WST00002-DWNLD-CDE          46690001
467000                , ACTV_CDE         = :WST00002-ACTV-CDE           46700001
467100            WHERE EXT_SHP_ID     = :WST00002-EXT-SHP-ID           46710001
467200            AND   PO_NBR         = :WST00002-PO-NBR               46720001
467300            AND   RCVR_SEQ_NBR   = :WST00002-RCVR-SEQ-NBR         46730001
467400            AND   PO_LNE_NBR     = :WST00002-PO-LNE-NBR           46740001
467500            AND   PREPK_ID       = :WST00002-PREPK-ID             46750001
467600     END-EXEC.                                                    46760001
467700                                                                  46770001
467800     EVALUATE TRUE                                                46780001
467900         WHEN SQLCODE = ZERO                                      46790001
468000             IF PS-CICS-SWITCH-YES                                46800001
468100                 MOVE WST00002-PO-NBR TO WS-DISPLAY-1             46810001
468200                 MOVE WST00002-RCVR-SEQ-NBR TO WS-DISPLAY-2       46820001
468300                 MOVE WST00002-PO-LNE-NBR TO WS-DISPLAY-4         46830001
468400                 INITIALIZE PV-CICS-MSG-AREA                      46840001
468500                 STRING   ' ' WS001-SRC-TASK-NUMBER               46850001
468600                          ' WSKCS305-5530:'                       46860001
468700                          ' UPDATE WST_SHPMT_XREF_DTL'            46870001
468800                          ' FOR SHPMT='                           46880001
468900                          WST00002-EXT-SHP-ID                     46890001
469000                          DELIMITED BY SIZE                       46900001
469100                          INTO PV-CICS-MSG-AREA                   46910001
469200                 PERFORM 7000-WRITE-TO-CICS-LOG                   46920001
469300                 INITIALIZE PV-CICS-MSG-AREA                      46930001
469400                 STRING   ' ' WS001-SRC-TASK-NUMBER               46940001
469500                          ' WSKCS305-5530:'                       46950001
469600                          ' PO NBR='                              46960001
469700                          WS-DISPLAY-1                            46970001
469800                          ' RCVR SEQ NBR='                        46980001
469900                          WS-DISPLAY-2                            46990001
470000                          ' PO LNE NBR='                          47000001
470100                          WS-DISPLAY-4                            47010001
470200                          DELIMITED BY SIZE                       47020001
470300                          INTO PV-CICS-MSG-AREA                   47030001
470400                 PERFORM 7000-WRITE-TO-CICS-LOG                   47040001
470500             END-IF                                               47050001
470600         WHEN SQLCODE = -904                                      47060001
470700         WHEN SQLCODE = -913                                      47070001
470800         WHEN SQLCODE = -911                                      47080001
470900             CONTINUE                                             47090001
471000         WHEN SQLWARN0 NOT = SPACES                               47100001
471100         WHEN SQLCODE NOT = ZERO                                  47110001
471200             MOVE SQLCODE               TO PV-SQL-RETURN-CD       47120001
471300             INITIALIZE PV-CICS-MSG-AREA                          47130001
471400             STRING   ' ' WS001-SRC-TASK-NUMBER                   47140001
471500                      ' WSKCS305-5530 ERROR:'                     47150001
471600                      ' SQL='                                     47160001
471700                      PV-SQL-RETURN-CD                            47170001
471800                      DELIMITED BY SIZE                           47180001
471900                      INTO PV-CICS-MSG-AREA                       47190001
472000             PERFORM 7000-WRITE-TO-CICS-LOG                       47200001
472100                                                                  47210001
472200             SET WS001-INVALID-SQL      TO TRUE                   47220001
472300             STRING 'SQL='                                        47230001
472400                  PV-SQL-RETURN-CD                                47240001
472500                  DELIMITED BY SIZE                               47250001
472600                                      INTO WS001-CRA-RET-MSG      47260001
472700             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  47270001
472800             MOVE SQLCA                 TO WS001-SQLCA            47280001
472900                                           DP013-SQLCA            47290001
473000             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        47300001
473100             MOVE 'WST_SHPMT_XREF_HDR'  TO                        47310001
473200                                       DP013-DB2-TABLE-NAME (1)   47320001
473300             SET DP013-DB2-ABEND        TO TRUE                   47330001
473400             PERFORM 9999-ABEND                                   47340001
473500     END-EVALUATE.                                                47350001
473600                                                                  47360001
473700/                                                                 47370001
473800 5600-DETAIL-PO-RCVR.                                             47380001
473900                                                                  47390001
474000     MOVE '5600-DETAIL-PO-RCVR'  TO WS001-PARAGRAPH-NAME.         47400001
474100                                                                  47410001
474200     PERFORM 5630-OPEN-RCVR-LINE-CSR.                             47420001
474300     PERFORM 5640-FETCH-RCVR-LINE-CSR UNTIL                       47430001
474400                 PS-EOF-RCVR-LINE-CSR-YES.                        47440001
474500     PERFORM 5650-CLOSE-RCVR-LINE-CSR.                            47450001
474600                                                                  47460001
474700/                                                                 47470001
474800 5610-CHECK-FOR-PBS.                                              47480001
474900                                                                  47490001
475000     MOVE '5610-CHECK-FOR-PBS'   TO WS001-PARAGRAPH-NAME.         47500001
475100                                                                  47510001
475200     EXEC SQL                                                     47520001
475300         SELECT  PACK_BY_ST_IND                                   47530001
475400               , PKGNG_CDE                                        47540001
475500         INTO                                                     47550001
475600                :RECEIV-PACK-BY-ST-IND                            47560001
475700               ,:RECEIV-PKGNG-CDE                                 47570001
475800         FROM    TRECEIV                                          47580001
475900         WHERE   ORD_NBR        = :DK-PO-NBR                      47590001
476000         AND     REC_SEQ_NBR    = :DK-RCVR-SEQ-NBR                47600001
476100         AND     VER_STATUS_CDE = 'A'                             47610001
476200     END-EXEC.                                                    47620001
476300                                                                  47630001
476400     EVALUATE TRUE                                                47640001
476500         WHEN SQLCODE = ZERO                                      47650001
476600             MOVE RECEIV-PKGNG-CDE   TO WS-PKGNG-CDE              47660001
476700             IF PS-CICS-SWITCH-YES                                47670001
476800                 INITIALIZE PV-CICS-MSG-AREA                      47680001
476900                 STRING   ' ' WS001-SRC-TASK-NUMBER               47690001
477000                          ' WSKCS305-5610:'                       47700001
477100                          ' PKGNG CDE='                           47710001
477200                          WS-PKGNG-CDE                            47720001
477300                          DELIMITED BY SIZE                       47730001
477400                          INTO PV-CICS-MSG-AREA                   47740001
477500                 PERFORM 7000-WRITE-TO-CICS-LOG                   47750001
477600             END-IF                                               47760001
477700             IF RECEIV-PACK-BY-ST-IND = 'Y'                       47770001
477800                 SET PS-PACK-BY-STORE-YES TO TRUE                 47780001
477900                 PERFORM 5660-CHECK-FOR-CARTONS                   47790001
478000             END-IF                                               47800001
478100         WHEN SQLCODE = +100                                      47810001
478200         WHEN SQLCODE = -811                                      47820001
478300         WHEN SQLCODE = -904                                      47830001
478400         WHEN SQLCODE = -913                                      47840001
478500         WHEN SQLCODE = -911                                      47850001
478600             CONTINUE                                             47860001
478700         WHEN SQLWARN0 NOT = SPACES                               47870001
478800         WHEN SQLCODE NOT = ZERO                                  47880001
478900             SET WS001-INVALID-SQL      TO TRUE                   47890001
479000             MOVE SQLCODE               TO PV-SQL-RETURN-CD       47900001
479100             STRING 'SQL='                                        47910001
479200                  PV-SQL-RETURN-CD                                47920001
479300                  DELIMITED BY SIZE                               47930001
479400                                      INTO WS001-CRA-RET-MSG      47940001
479500             MOVE SQLCA                 TO WS001-SQLCA            47950001
479600             INITIALIZE PV-CICS-MSG-AREA                          47960001
479700             STRING   ' ' WS001-SRC-TASK-NUMBER                   47970001
479800                      ' WSKCS305-5610 ERROR:'                     47980001
479900                      ' SQL='                                     47990001
480000                      PV-SQL-RETURN-CD                            48000001
480100                      DELIMITED BY SIZE                           48010001
480200                      INTO PV-CICS-MSG-AREA                       48020001
480300             PERFORM 7000-WRITE-TO-CICS-LOG                       48030001
480400     END-EVALUATE.                                                48040001
480500*                                                                 48050001
480600/                                                                 48060001
480700 5620-CHECK-FOR-PBS-ERRS.                                         48070001
480800                                                                  48080001
480900     MOVE '5620-CHECK-FOR-PBS-ERRS'                               48090001
481000                                 TO WS001-PARAGRAPH-NAME.         48100001
481100                                                                  48110001
481200     EXEC SQL                                                     48120001
481300         SELECT  COUNT (*)                                        48130001
481400         INTO   :PV-CNT-CURSOR                                    48140001
481500         FROM    TPKSLIP A                                        48150001
481600               , TINPKSU B                                        48160001
481700               , TSHUNLO C                                        48170001
481800         WHERE   A.PO_NBR         = :DK-PO-NBR                    48180001
481900         AND     A.REC_SEQ_NBR    = :DK-RCVR-SEQ-NBR              48190001
482000         AND     A.SEQ_NBR        = B.SEQ_NBR                     48200001
482100         AND     A.PO_NBR         = B.PO_NBR                      48210001
482200         AND     B.SHIPT_UNT_ID   = C.SHIPT_UNT_ID                48220001
482300         AND     C.ACTV_CDE       = 'I'                           48230001
482400         AND     C.SCN_LOC_ID     IN                              48240001
482500                      ('PBSA','PBSB','PBSC','PBSD','PBSE')        48250001
482600     END-EXEC.                                                    48260001
482700                                                                  48270001
482800     EVALUATE TRUE                                                48280001
482900         WHEN SQLCODE = ZERO                                      48290001
483000             IF PV-CNT-CURSOR > 0                                 48300001
483100                SET PS-PBS-CASE-INVALID-YES TO TRUE               48310001
483200             END-IF                                               48320001
483300             IF PS-CICS-SWITCH-YES                                48330001
483400                 INITIALIZE PV-CICS-MSG-AREA                      48340001
483500                 STRING   ' ' WS001-SRC-TASK-NUMBER               48350001
483600                          ' WSKCS305-5620:'                       48360001
483700                          ' PBS CASE IS INVALID'                  48370001
483800                          DELIMITED BY SIZE                       48380001
483900                          INTO PV-CICS-MSG-AREA                   48390001
484000                 PERFORM 7000-WRITE-TO-CICS-LOG                   48400001
484100             END-IF                                               48410001
484200         WHEN SQLCODE = +100                                      48420001
484300         WHEN SQLCODE = -811                                      48430001
484400         WHEN SQLCODE = -904                                      48440001
484500         WHEN SQLCODE = -913                                      48450001
484600         WHEN SQLCODE = -911                                      48460001
484700             CONTINUE                                             48470001
484800         WHEN SQLWARN0 NOT = SPACES                               48480001
484900         WHEN SQLCODE NOT = ZERO                                  48490001
485000             MOVE SQLCODE               TO PV-SQL-RETURN-CD       48500001
485100             INITIALIZE PV-CICS-MSG-AREA                          48510001
485200             STRING   ' ' WS001-SRC-TASK-NUMBER                   48520001
485300                      ' WSKCS305-5620 ERROR:'                     48530001
485400                      ' SQL='                                     48540001
485500                      PV-SQL-RETURN-CD                            48550001
485600                      DELIMITED BY SIZE                           48560001
485700                      INTO PV-CICS-MSG-AREA                       48570001
485800             PERFORM 7000-WRITE-TO-CICS-LOG                       48580001
485900                                                                  48590001
486000             SET WS001-INVALID-SQL      TO TRUE                   48600001
486100             STRING 'SQL='                                        48610001
486200                  PV-SQL-RETURN-CD                                48620001
486300                  DELIMITED BY SIZE                               48630001
486400                                      INTO WS001-CRA-RET-MSG      48640001
486500             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  48650001
486600             MOVE SQLCA                 TO WS001-SQLCA            48660001
486700                                           DP013-SQLCA            48670001
486800             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        48680001
486900             MOVE 'TPKSLIP'             TO                        48690001
487000                                       DP013-DB2-TABLE-NAME (1)   48700001
487100             MOVE 'TINPKSU'             TO                        48710001
487200                                       DP013-DB2-TABLE-NAME (2)   48720001
487300             MOVE 'TSHUNLO'             TO                        48730001
487400                                       DP013-DB2-TABLE-NAME (3)   48740001
487500             SET DP013-DB2-ABEND        TO TRUE                   48750001
487600             PERFORM 9999-ABEND                                   48760001
487700     END-EVALUATE.                                                48770001
487800*                                                                 48780001
487900/                                                                 48790001
488000 5630-OPEN-RCVR-LINE-CSR.                                         48800001
488100                                                                  48810001
488200     MOVE '5630-OPEN-RCVR-LINE-CSR'                               48820001
488300                                 TO WS001-PARAGRAPH-NAME.         48830001
488400                                                                  48840001
488500     SET PS-EOF-RCVR-LINE-CSR-NO        TO TRUE.                  48850001
488600                                                                  48860001
488700     EXEC SQL                                                     48870001
488800          OPEN RCVR-LINE-CSR                                      48880001
488900     END-EXEC.                                                    48890001
489000                                                                  48900001
489100     EVALUATE TRUE                                                48910001
489200         WHEN SQLCODE = ZERO                                      48920001
489300             IF PS-CICS-SWITCH-YES                                48930001
489400                 INITIALIZE PV-CICS-MSG-AREA                      48940001
489500                 MOVE DK-PO-NBR          TO WS-DISPLAY-1          48950001
489600                 MOVE DK-RCVR-SEQ-NBR    TO WS-DISPLAY-2          48960001
489700                 STRING   ' ' WS001-SRC-TASK-NUMBER               48970001
489800                          ' WSKCS305-5630:'                       48980001
489900                          ' OPEN RCVR-LINE-CSR'                   48990001
490000                          ' FOR PO=' WS-DISPLAY-1                 49000001
490100                          '-' WS-DISPLAY-2                        49010001
490200                          DELIMITED BY SIZE                       49020001
490300                          INTO PV-CICS-MSG-AREA                   49030001
490400                 PERFORM 7000-WRITE-TO-CICS-LOG                   49040001
490500             END-IF                                               49050001
490600         WHEN SQLCODE = -904                                      49060001
490700         WHEN SQLCODE = -913                                      49070001
490800         WHEN SQLCODE = -911                                      49080001
490900             CONTINUE                                             49090001
491000         WHEN SQLWARN0 NOT = SPACES                               49100001
491100         WHEN SQLCODE NOT = ZERO                                  49110001
491200             MOVE SQLCODE               TO PV-SQL-RETURN-CD       49120001
491300             INITIALIZE PV-CICS-MSG-AREA                          49130001
491400             STRING   ' ' WS001-SRC-TASK-NUMBER                   49140001
491500                      ' WSKCS305-5630 ERROR:'                     49150001
491600                      ' SQL='                                     49160001
491700                      PV-SQL-RETURN-CD                            49170001
491800                      DELIMITED BY SIZE                           49180001
491900                      INTO PV-CICS-MSG-AREA                       49190001
492000             PERFORM 7000-WRITE-TO-CICS-LOG                       49200001
492100                                                                  49210001
492200             SET WS001-INVALID-SQL      TO TRUE                   49220001
492300             STRING 'SQL='                                        49230001
492400                  PV-SQL-RETURN-CD                                49240001
492500                  DELIMITED BY SIZE                               49250001
492600                                      INTO WS001-CRA-RET-MSG      49260001
492700             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  49270001
492800             MOVE SQLCA                 TO WS001-SQLCA            49280001
492900                                           DP013-SQLCA            49290001
493000             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        49300001
493100             SET DP013-DB2-ABEND        TO TRUE                   49310001
493200             PERFORM 9999-ABEND                                   49320001
493300     END-EVALUATE.                                                49330001
493400                                                                  49340001
493500/                                                                 49350001
493600 5640-FETCH-RCVR-LINE-CSR.                                        49360001
493700                                                                  49370001
493800     MOVE '5640-FETCH-RCVR-LINE-CSR'                              49380001
493900                                 TO WS001-PARAGRAPH-NAME.         49390001
494000                                                                  49400001
494100* GET ORD LNE/PREPK FROM TRECITM.  KEYS ARE PO/RCVR.              49410001
494200                                                                  49420001
494300     EXEC SQL                                                     49430001
494400          FETCH RCVR-LINE-CSR                                     49440001
494500          INTO                                                    49450001
494600                :RECITM-ORD-LNE-NBR                               49460001
494700              , :RECITM-PREPK-ID                                  49470001
494800     END-EXEC.                                                    49480001
494900                                                                  49490001
495000     EVALUATE TRUE                                                49500001
495100         WHEN SQLCODE = ZERO                                      49510001
495200              MOVE RECITM-ORD-LNE-NBR TO WS-PO-LNE-NBR            49520001
495300              MOVE RECITM-PREPK-ID    TO WS-PREPK-ID              49530001
495400              IF PS-CICS-SWITCH-YES                               49540001
495500                  INITIALIZE PV-CICS-MSG-AREA                     49550001
495600                  MOVE DK-PO-NBR     TO WS-DISPLAY-2              49560001
495700                  MOVE WS-PO-LNE-NBR TO WS-DISPLAY-1              49570001
495800                  MOVE WS-PREPK-ID   TO WS-DISPLAY-3              49580001
495900                  STRING   ' ' WS001-SRC-TASK-NUMBER              49590001
496000                           ' WSKCS305-5640:'                      49600001
496100                           ' PO NBR='                             49610001
496200                           WS-DISPLAY-2                           49620001
496300                           ' PO LNE NBR='                         49630001
496400                           WS-DISPLAY-1                           49640001
496500                           ' PREPK ID='                           49650001
496600                           WS-DISPLAY-3                           49660001
496700                           DELIMITED BY SIZE                      49670001
496800                           INTO PV-CICS-MSG-AREA                  49680001
496900                  PERFORM 7000-WRITE-TO-CICS-LOG                  49690001
497000              END-IF                                              49700001
497100              PERFORM 5440-CHECK-SHIP-XREF-DTL                    49710001
497200         WHEN SQLCODE = -904                                      49720001
497300         WHEN SQLCODE = -913                                      49730001
497400         WHEN SQLCODE = -911                                      49740001
497500             CONTINUE                                             49750001
497600         WHEN SQLCODE = +100                                      49760001
497700             SET PS-EOF-RCVR-LINE-CSR-YES TO TRUE                 49770001
497800         WHEN SQLWARN0 NOT = SPACES                               49780001
497900         WHEN SQLCODE NOT = ZERO                                  49790001
498000             MOVE SQLCODE               TO PV-SQL-RETURN-CD       49800001
498100             INITIALIZE PV-CICS-MSG-AREA                          49810001
498200             STRING   ' ' WS001-SRC-TASK-NUMBER                   49820001
498300                      ' WSKCS305-5640 ERROR:'                     49830001
498400                      ' SQL='                                     49840001
498500                      PV-SQL-RETURN-CD                            49850001
498600                      DELIMITED BY SIZE                           49860001
498700                      INTO PV-CICS-MSG-AREA                       49870001
498800             PERFORM 7000-WRITE-TO-CICS-LOG                       49880001
498900                                                                  49890001
499000             SET WS001-INVALID-SQL      TO TRUE                   49900001
499100             STRING 'SQL='                                        49910001
499200                  PV-SQL-RETURN-CD                                49920001
499300                  DELIMITED BY SIZE                               49930001
499400                                      INTO WS001-CRA-RET-MSG      49940001
499500             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  49950001
499600             MOVE SQLCA                 TO WS001-SQLCA            49960001
499700                                           DP013-SQLCA            49970001
499800             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        49980001
499900             MOVE 'RECITM'              TO                        49990001
500000                                       DP013-DB2-TABLE-NAME (1)   50000001
500100             SET DP013-DB2-ABEND        TO TRUE                   50010001
500200             PERFORM 9999-ABEND                                   50020001
500300     END-EVALUATE.                                                50030001
500400                                                                  50040001
500500/                                                                 50050001
500600 5650-CLOSE-RCVR-LINE-CSR.                                        50060001
500700                                                                  50070001
500800     MOVE '5650-CLOSE-RCVR-LINE-CSR'                              50080001
500900                                 TO WS001-PARAGRAPH-NAME.         50090001
501000                                                                  50100001
501100     EXEC SQL                                                     50110001
501200         CLOSE RCVR-LINE-CSR                                      50120001
501300     END-EXEC.                                                    50130001
501400                                                                  50140001
501500     EVALUATE TRUE                                                50150001
501600         WHEN SQLCODE = ZERO                                      50160001
501700              IF PS-CICS-SWITCH-YES                               50170001
501800                  INITIALIZE PV-CICS-MSG-AREA                     50180001
501900                  STRING   ' ' WS001-SRC-TASK-NUMBER              50190001
502000                           ' WSKCS305-5650:'                      50200001
502100                           ' CLOSE RCVR-LINE-CSR'                 50210001
502200                           DELIMITED BY SIZE                      50220001
502300                           INTO PV-CICS-MSG-AREA                  50230001
502400                  PERFORM 7000-WRITE-TO-CICS-LOG                  50240001
502500              END-IF                                              50250001
502600         WHEN SQLCODE = -904                                      50260001
502700         WHEN SQLCODE = -913                                      50270001
502800         WHEN SQLCODE = -911                                      50280001
502900             CONTINUE                                             50290001
503000         WHEN SQLWARN0 NOT = SPACES                               50300001
503100         WHEN SQLCODE NOT = ZERO                                  50310001
503200             MOVE SQLCODE               TO PV-SQL-RETURN-CD       50320001
503300             INITIALIZE PV-CICS-MSG-AREA                          50330001
503400             STRING   ' ' WS001-SRC-TASK-NUMBER                   50340001
503500                      ' WSKCS305-5650 ERROR:'                     50350001
503600                      ' SQL='                                     50360001
503700                      PV-SQL-RETURN-CD                            50370001
503800                      DELIMITED BY SIZE                           50380001
503900                      INTO PV-CICS-MSG-AREA                       50390001
504000             PERFORM 7000-WRITE-TO-CICS-LOG                       50400001
504100                                                                  50410001
504200             SET WS001-INVALID-SQL      TO TRUE                   50420001
504300             STRING 'SQL='                                        50430001
504400                  PV-SQL-RETURN-CD                                50440001
504500                  DELIMITED BY SIZE                               50450001
504600                                      INTO WS001-CRA-RET-MSG      50460001
504700             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  50470001
504800             MOVE SQLCA                 TO WS001-SQLCA            50480001
504900                                           DP013-SQLCA            50490001
505000             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        50500001
505100             SET DP013-DB2-ABEND        TO TRUE                   50510001
505200             PERFORM 9999-ABEND                                   50520001
505300     END-EVALUATE.                                                50530001
505400                                                                  50540001
505500     SET PS-PBS-CASE-INVALID-NO       TO TRUE.                    50550001
505600     SET PS-PACK-BY-STORE-NO          TO TRUE.                    50560001
505700                                                                  50570001
505800/                                                                 50580001
505900 5660-CHECK-FOR-CARTONS.                                          50590001
506000                                                                  50600001
506100     MOVE '5660-CHECK-FOR-CARTONS'                                50610001
506200                                 TO WS001-PARAGRAPH-NAME.         50620001
506300                                                                  50630001
506400     EXEC SQL                                                     50640001
506500          SELECT SUM(C.SHPD_QTY)                                  50650001
506600            INTO :PV-CRTN-CNT                                     50660001
506700            FROM TPKSLIP A                                        50670001
506800                ,TINPKSU B                                        50680001
506900                ,TSHUUPC C                                        50690001
507000           WHERE A.PO_NBR        = :WS-PO-NBR                     50700001
507100             AND A.REC_SEQ_NBR   = :WS-RCVR-SEQ-NBR               50710001
507200             AND A.VER_STAT_CDE  = 'A'                            50720001
507300             AND A.PKSL_STAT_CDE = 'AC'                           50730001
507400             AND B.PO_NBR        = A.PO_NBR                       50740001
507500             AND B.SEQ_NBR       = A.SEQ_NBR                      50750001
507600             AND C.SHIPT_UNT_ID  = B.SHIPT_UNT_ID                 50760001
507700             AND C.TRN_NBR       = A.PO_NBR                       50770001
507800     END-EXEC.                                                    50780001
507900                                                                  50790001
508000                                                                  50800001
508100     EVALUATE TRUE                                                50810001
508200        WHEN SQLCODE = ZERO                                       50820001
508300            IF PV-CRTN-CNT  >  0                                  50830001
508400               SET PS-PBS-CARTON-DATA-YES TO TRUE                 50840001
508500            ELSE                                                  50850001
508600               SET PS-PBS-CARTON-DATA-NO  TO TRUE                 50860001
508700            END-IF                                                50870001
508800            IF PS-CICS-SWITCH-YES                                 50880001
508900                MOVE PV-CRTN-CNT          TO WS-DISPLAY-1         50890001
509000                INITIALIZE PV-CICS-MSG-AREA                       50900001
509100                STRING   ' ' WS001-SRC-TASK-NUMBER                50910001
509200                         ' WSKCS305-5660:'                        50920001
509300                         ' CRTN CNT=' WS-DISPLAY-1                50930001
509400                         DELIMITED BY SIZE                        50940001
509500                                      INTO PV-CICS-MSG-AREA       50950001
509600                PERFORM 7000-WRITE-TO-CICS-LOG                    50960001
509700            END-IF                                                50970001
509800        WHEN SQLCODE = -305                                       50980001
509900            SET PS-PBS-CARTON-DATA-NO  TO TRUE                    50990001
510000        WHEN SQLWARN0 NOT = SPACES                                51000001
510100        WHEN SQLCODE NOT = ZERO                                   51010001
510200            SET WS001-INVALID-SQL       TO TRUE                   51020001
510300            MOVE SQLCODE                TO PV-SQL-RETURN-CD       51030001
510400            STRING 'SQL='                                         51040001
510500                 PV-SQL-RETURN-CD                                 51050001
510600                 DELIMITED BY SIZE                                51060001
510700                                      INTO WS001-CRA-RET-MSG      51070001
510800            MOVE SQLCA                  TO WS001-SQLCA            51080001
510900            IF PS-CICS-SWITCH-YES                                 51090001
511000                MOVE WS-PO-NBR          TO WS-DISPLAY-PO-NBR      51100001
511100                MOVE WS-RCVR-SEQ-NBR    TO WS-DISPLAY-RCVR-NBR    51110001
511200                INITIALIZE PV-CICS-MSG-AREA                       51120001
511300                STRING   ' ' WS001-SRC-TASK-NUMBER                51130001
511400                         ' WSKCS305-5660 ERROR:'                  51140001
511500                         ' SQL='                                  51150001
511600                         PV-SQL-RETURN-CD                         51160001
511700                         ' PO= ' WS-DISPLAY-PO-NBR                51170001
511800                         ' RCVR= ' WS-DISPLAY-RCVR-NBR            51180001
511900                         DELIMITED BY SIZE                        51190001
512000                                      INTO PV-CICS-MSG-AREA       51200001
512100                PERFORM 7000-WRITE-TO-CICS-LOG                    51210001
512200            END-IF                                                51220001
512300     END-EVALUATE.                                                51230001
512400                                                                  51240001
512500/                                                                 51250001
512600 5700-CALL-DOWNLOAD-MOD.                                          51260001
512700                                                                  51270001
512800     MOVE '5700-CALL-DOWNLOAD-MOD'                                51280001
512900                                 TO WS001-PARAGRAPH-NAME.         51290001
513000                                                                  51300001
513100     INITIALIZE WS003-SHIPT-COMMAREA.                             51310001
513200     MOVE WS-TRIP-ID               TO WS003-TRIP-ID.              51320001
513300     MOVE WS-EXT-SHP-ID            TO WS003-WM-SHIPT-NBR.         51330001
513400     MOVE 'WSKCS305'               TO WS003-CALLING-PROGRAM-NAME. 51340001
513500     MOVE WS001-SRC-TASK-NUMBER    TO WS003-SRC-TASK-NUMBER.      51350001
513600     MOVE WS001-USER-ID            TO WS003-USERID.               51360001
513700     IF PS-APPT-SENT-YES                                          51370001
513800         SET WS003-APPOINTMENT-YES    TO TRUE                     51380001
513900     ELSE                                                         51390001
514000         SET WS003-APPOINTMENT-NO     TO TRUE                     51400001
514100     END-IF.                                                      51410001
514200     IF PS-CANCEL-SHPMT-YES                                       51420001
514300         SET WS003-CANCEL-SHPMT-YES   TO TRUE                     51430001
514400     ELSE                                                         51440001
514500         SET WS003-CANCEL-SHPMT-NO    TO TRUE                     51450001
514600     END-IF.                                                      51460001
514700                                                                  51470001
514800     IF PS-CICS-SWITCH-YES                                        51480001
514900         MOVE WS-TRIP-ID          TO WS-DISPLAY-1                 51490001
515000         INITIALIZE PV-CICS-MSG-AREA                              51500001
515100         STRING   ' ' WS001-SRC-TASK-NUMBER                       51510001
515200                  ' WSKCS305-5700:'                               51520001
515300                  ' STARTING ASN DOWNLOAD PROCESS'                51530001
515400                  ' FOR SHPMT=' WS-EXT-SHP-ID                     51540001
515500                  ' TRIP=' WS-DISPLAY-1                           51550001
515600                  DELIMITED BY SIZE                               51560001
515700                                 INTO PV-CICS-MSG-AREA            51570001
515800         PERFORM 7000-WRITE-TO-CICS-LOG                           51580001
515900     END-IF.                                                      51590001
516000                                                                  51600001
516100* THIS IS A STARTED TASK - IT WILL NOT RETURN BACK TO HERE        51610001
516200* TRANID IS W301 - IT EXECUTES WSKCS301                           51620001
516300                                                                  51630001
516400     EXEC CICS                                                    51640001
516500          START TRANSID (PC-DOWNLOAD-MOD-TRAN)                    51650001
516600                FROM (WS003-SHIPT-COMMAREA)                       51660001
516700     END-EXEC.                                                    51670001
516800                                                                  51680001
516900/                                                 .K              51690001
517000 5800-CHECK-ASN.                                                  51700001
517100                                                                  51710001
517200***************************************************************   51720001
517300* CHECK-ASN - SUMMARY OF PROCESSING                               51730001
517400*   CHECK THE SHIPMENT - IF THERE ARE BOTH CASE LEVEL AND SKU     51740001
517500*   LEVEL RECEIVERS ON THE SHIPMENT, THEN THE SHIPMENT WILL       51750001
517600*   HAVE TO BE SPLIT INTO 2 SHIPMENTS - THE ORIGINAL AND A        51760001
517700*   DUMMY.                                                        51770001
517800*                                                                 51780001
517900*   THE CASE LEVEL DATA WILL BE MOVED TO THE DUMMY SHIPMENT (THE  51790001
518000*   ROWS ON THE DETAIL TABLE FOR THE ORIGINAL SHIPMENT WILL BE    51800001
518100*   SET TO INACTIVE.                                              51810001
518200*                                                                 51820001
518300*   THE SKU LEVEL DATA WILL REMAIN ON THE ORIGINAL SHIPMENT.      51830001
518400***************************************************************   51840001
518500                                                                  51850001
518600     MOVE '5800-CHECK-ASN'       TO WS001-PARAGRAPH-NAME.         51860001
518700                                                                  51870001
518800     PERFORM 5810-OPEN-HDR-CSR-2.                                 51880001
518900     PERFORM 5820-FETCH-HDR-CSR-2 UNTIL                           51890001
519000                 PS-EOF-HDR-CSR-2-YES.                            51900001
519100     PERFORM 5830-CLOSE-HDR-CSR-2.                                51910001
519200                                                                  51920001
519300/                                                                 51930001
519400 5810-OPEN-HDR-CSR-2.                                             51940001
519500                                                                  51950001
519600     MOVE '5810-OPEN-HDR-CSR-2'  TO WS001-PARAGRAPH-NAME.         51960001
519700                                                                  51970001
519800     SET PS-EOF-HDR-CSR-2-NO        TO TRUE.                      51980001
519900     EXEC SQL                                                     51990001
520000          OPEN HDR-CSR-2                                          52000001
520100     END-EXEC.                                                    52010001
520200                                                                  52020001
520300     EVALUATE TRUE                                                52030001
520400         WHEN SQLCODE = ZERO                                      52040001
520500              IF PS-CICS-SWITCH-YES                               52050001
520600                  INITIALIZE PV-CICS-MSG-AREA                     52060001
520700                  MOVE DK-TRIP-ID     TO WS-DISPLAY-1             52070001
520800                  STRING   ' ' WS001-SRC-TASK-NUMBER              52080001
520900                           ' WSKCS305-5810:'                      52090001
521000                           ' OPEN HDR-CSR-2'                      52100001
521100                           ' FOR TRIP=' WS-DISPLAY-1              52110001
521200                           DELIMITED BY SIZE                      52120001
521300                           INTO PV-CICS-MSG-AREA                  52130001
521400                  PERFORM 7000-WRITE-TO-CICS-LOG                  52140001
521500              END-IF                                              52150001
521600         WHEN SQLCODE = -904                                      52160001
521700         WHEN SQLCODE = -913                                      52170001
521800         WHEN SQLCODE = -911                                      52180001
521900             CONTINUE                                             52190001
522000         WHEN SQLWARN0 NOT = SPACES                               52200001
522100         WHEN SQLCODE NOT = ZERO                                  52210001
522200             MOVE SQLCODE               TO PV-SQL-RETURN-CD       52220001
522300             INITIALIZE PV-CICS-MSG-AREA                          52230001
522400             STRING   ' ' WS001-SRC-TASK-NUMBER                   52240001
522500                      ' WSKCS305-5810 ERROR:'                     52250001
522600                      ' SQL='                                     52260001
522700                      PV-SQL-RETURN-CD                            52270001
522800                      DELIMITED BY SIZE                           52280001
522900                      INTO PV-CICS-MSG-AREA                       52290001
523000             PERFORM 7000-WRITE-TO-CICS-LOG                       52300001
523100                                                                  52310001
523200             SET WS001-INVALID-SQL      TO TRUE                   52320001
523300             STRING 'SQL='                                        52330001
523400                  PV-SQL-RETURN-CD                                52340001
523500                  DELIMITED BY SIZE                               52350001
523600                                      INTO WS001-CRA-RET-MSG      52360001
523700             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  52370001
523800             MOVE SQLCA                 TO WS001-SQLCA            52380001
523900                                           DP013-SQLCA            52390001
524000             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        52400001
524100             MOVE 'RECITM'              TO                        52410001
524200                                       DP013-DB2-TABLE-NAME (1)   52420001
524300             SET DP013-DB2-ABEND        TO TRUE                   52430001
524400             PERFORM 9999-ABEND                                   52440001
524500     END-EVALUATE.                                                52450001
524600                                                                  52460001
524700/                                                                 52470001
524800 5820-FETCH-HDR-CSR-2.                                            52480001
524900                                                                  52490001
525000     MOVE '5820-FETCH-HDR-CSR-2' TO WS001-PARAGRAPH-NAME.         52500001
525100                                                                  52510001
525200* GET THE EXT-SHP-ID FOR THE ROWS ON WST_SHPMT_XREF_HDR           52520001
525300* AND WST_SHPMT_XREF_DTL.  THE KEY IS TRIP-ID.                    52530001
525400                                                                  52540001
525500     EXEC SQL                                                     52550001
525600          FETCH HDR-CSR-2                                         52560001
525700          INTO                                                    52570001
525800               :WST00001-EXT-SHP-ID                               52580001
525900     END-EXEC.                                                    52590001
526000                                                                  52600001
526100     EVALUATE TRUE                                                52610001
526200         WHEN SQLCODE = ZERO                                      52620001
526300              MOVE WST00001-EXT-SHP-ID TO DK-EXT-SHP-ID           52630001
526400              IF PS-CICS-SWITCH-YES                               52640001
526500                  INITIALIZE PV-CICS-MSG-AREA                     52650001
526600                  STRING   ' ' WS001-SRC-TASK-NUMBER              52660001
526700                           ' WSKCS305-5820:'                      52670001
526800                           ' SHPMT='                              52680001
526900                           DK-EXT-SHP-ID                          52690001
527000                           DELIMITED BY SIZE                      52700001
527100                           INTO PV-CICS-MSG-AREA                  52710001
527200                  PERFORM 7000-WRITE-TO-CICS-LOG                  52720001
527300              END-IF                                              52730001
527400              PERFORM 5840-OPEN-SKU-CSR                           52740001
527500              PERFORM 5845-FETCH-SKU-CSR UNTIL                    52750001
527600                  PS-EOF-SKU-CSR-YES                              52760001
527700              PERFORM 5850-CLOSE-SKU-CSR                          52770001
527800         WHEN SQLCODE = -904                                      52780001
527900         WHEN SQLCODE = -913                                      52790001
528000         WHEN SQLCODE = -911                                      52800001
528100              CONTINUE                                            52810001
528200         WHEN SQLCODE = +100                                      52820001
528300              SET PS-EOF-HDR-CSR-2-YES TO TRUE                    52830001
528400         WHEN SQLWARN0 NOT = SPACES                               52840001
528500         WHEN SQLCODE NOT = ZERO                                  52850001
528600             MOVE SQLCODE               TO PV-SQL-RETURN-CD       52860001
528700             INITIALIZE PV-CICS-MSG-AREA                          52870001
528800             STRING   ' ' WS001-SRC-TASK-NUMBER                   52880001
528900                      ' WSKCS305-5820 ERROR:'                     52890001
529000                      ' SQL='                                     52900001
529100                      PV-SQL-RETURN-CD                            52910001
529200                      DELIMITED BY SIZE                           52920001
529300                      INTO PV-CICS-MSG-AREA                       52930001
529400             PERFORM 7000-WRITE-TO-CICS-LOG                       52940001
529500                                                                  52950001
529600             SET WS001-INVALID-SQL      TO TRUE                   52960001
529700             STRING 'SQL='                                        52970001
529800                  PV-SQL-RETURN-CD                                52980001
529900                  DELIMITED BY SIZE                               52990001
530000                                      INTO WS001-CRA-RET-MSG      53000001
530100             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  53010001
530200             MOVE SQLCA                 TO WS001-SQLCA            53020001
530300                                           DP013-SQLCA            53030001
530400             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        53040001
530500             MOVE 'WST_SHPMT_XREF_HDR'  TO                        53050001
530600                                       DP013-DB2-TABLE-NAME (1)   53060001
530700             SET DP013-DB2-ABEND        TO TRUE                   53070001
530800             PERFORM 9999-ABEND                                   53080001
530900     END-EVALUATE.                                                53090001
531000                                                                  53100001
531100/                                                                 53110001
531200 5830-CLOSE-HDR-CSR-2.                                            53120001
531300                                                                  53130001
531400     MOVE '5830-CLOSE-HDR-CSR-2' TO WS001-PARAGRAPH-NAME.         53140001
531500                                                                  53150001
531600     EXEC SQL                                                     53160001
531700          CLOSE HDR-CSR-2                                         53170001
531800     END-EXEC.                                                    53180001
531900                                                                  53190001
532000     EVALUATE TRUE                                                53200001
532100         WHEN SQLCODE = ZERO                                      53210001
532200              IF PS-CICS-SWITCH-YES                               53220001
532300                  INITIALIZE PV-CICS-MSG-AREA                     53230001
532400                  STRING   ' ' WS001-SRC-TASK-NUMBER              53240001
532500                           ' WSKCS305-5830:'                      53250001
532600                           ' CLOSE HDR-CSR-2'                     53260001
532700                           DELIMITED BY SIZE                      53270001
532800                           INTO PV-CICS-MSG-AREA                  53280001
532900                  PERFORM 7000-WRITE-TO-CICS-LOG                  53290001
533000              END-IF                                              53300001
533100         WHEN SQLCODE = -904                                      53310001
533200         WHEN SQLCODE = -913                                      53320001
533300         WHEN SQLCODE = -911                                      53330001
533400              CONTINUE                                            53340001
533500         WHEN SQLWARN0 NOT = SPACES                               53350001
533600         WHEN SQLCODE NOT = ZERO                                  53360001
533700             MOVE SQLCODE               TO PV-SQL-RETURN-CD       53370001
533800             INITIALIZE PV-CICS-MSG-AREA                          53380001
533900             STRING   ' ' WS001-SRC-TASK-NUMBER                   53390001
534000                      ' WSKCS305-5830 ERROR:'                     53400001
534100                      ' SQL='                                     53410001
534200                      PV-SQL-RETURN-CD                            53420001
534300                      DELIMITED BY SIZE                           53430001
534400                      INTO PV-CICS-MSG-AREA                       53440001
534500             PERFORM 7000-WRITE-TO-CICS-LOG                       53450001
534600                                                                  53460001
534700             SET WS001-INVALID-SQL      TO TRUE                   53470001
534800             STRING 'SQL='                                        53480001
534900                  PV-SQL-RETURN-CD                                53490001
535000                  DELIMITED BY SIZE                               53500001
535100                                      INTO WS001-CRA-RET-MSG      53510001
535200             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  53520001
535300             MOVE SQLCA                 TO WS001-SQLCA            53530001
535400                                           DP013-SQLCA            53540001
535500             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        53550001
535600             MOVE 'WST_SHPMT_XREF_HDR'  TO                        53560001
535700                                       DP013-DB2-TABLE-NAME (1)   53570001
535800             SET DP013-DB2-ABEND        TO TRUE                   53580001
535900             PERFORM 9999-ABEND                                   53590001
536000     END-EVALUATE.                                                53600001
536100                                                                  53610001
536200/                                                                 53620001
536300 5840-OPEN-SKU-CSR.                                               53630001
536400                                                                  53640001
536500     MOVE '5840-OPEN-SKU-CSR'    TO WS001-PARAGRAPH-NAME.         53650001
536600     SET PS-EOF-SKU-CSR-NO        TO TRUE.                        53660001
536700                                                                  53670001
536800     EXEC SQL                                                     53680001
536900          OPEN SKU-CSR                                            53690001
537000     END-EXEC.                                                    53700001
537100                                                                  53710001
537200     EVALUATE TRUE                                                53720001
537300         WHEN SQLCODE = ZERO                                      53730001
537400              IF PS-CICS-SWITCH-YES                               53740001
537500                  INITIALIZE PV-CICS-MSG-AREA                     53750001
537600                  STRING   ' ' WS001-SRC-TASK-NUMBER              53760001
537700                           ' WSKCS305-5840:'                      53770001
537800                           ' OPEN SKU-CSR'                        53780001
537900                           ' FOR SHPMT=' DK-EXT-SHP-ID            53790001
538000                           DELIMITED BY SIZE                      53800001
538100                           INTO PV-CICS-MSG-AREA                  53810001
538200                  PERFORM 7000-WRITE-TO-CICS-LOG                  53820001
538300              END-IF                                              53830001
538400*        WHEN SQLCODE = -904                                      53840001
538500*        WHEN SQLCODE = -913                                      53850001
538600*        WHEN SQLCODE = -911                                      53860001
538700*             CONTINUE                                            53870001
538800         WHEN SQLWARN0 NOT = SPACES                               53880001
538900         WHEN SQLCODE NOT = ZERO                                  53890001
539000             MOVE SQLCODE               TO PV-SQL-RETURN-CD       53900001
539100             INITIALIZE PV-CICS-MSG-AREA                          53910001
539200             STRING   ' ' WS001-SRC-TASK-NUMBER                   53920001
539300                      ' WSKCS305-5840 ERROR:'                     53930001
539400                      ' SQL='                                     53940001
539500                      PV-SQL-RETURN-CD                            53950001
539600                      ' FOR SHPMT=' DK-EXT-SHP-ID                 53960001
539700                      DELIMITED BY SIZE                           53970001
539800                      INTO PV-CICS-MSG-AREA                       53980001
539900             PERFORM 7000-WRITE-TO-CICS-LOG                       53990001
540000                                                                  54000001
540100             SET WS001-INVALID-SQL      TO TRUE                   54010001
540200             STRING 'SQL='                                        54020001
540300                  PV-SQL-RETURN-CD                                54030001
540400                  DELIMITED BY SIZE                               54040001
540500                                      INTO WS001-CRA-RET-MSG      54050001
540600             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  54060001
540700             MOVE SQLCA                 TO WS001-SQLCA            54070001
540800                                           DP013-SQLCA            54080001
540900             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        54090001
541000             MOVE 'WST_SHPMT_XREF_HDR'  TO                        54100001
541100                                       DP013-DB2-TABLE-NAME (1)   54110001
541200             SET DP013-DB2-ABEND        TO TRUE                   54120001
541300             PERFORM 9999-ABEND                                   54130001
541400     END-EVALUATE.                                                54140001
541500                                                                  54150001
541600/                                                                 54160001
541700 5845-FETCH-SKU-CSR.                                              54170001
541800                                                                  54180001
541900     MOVE '5845-FETCH-SKU-CSR'   TO WS001-PARAGRAPH-NAME.         54190001
542000                                                                  54200001
542100* FOR THE EXT_SHP_ID RETRIEVED IN HDR-CSR-2, GET THE DETAIL ROWS  54210001
542200* FROM WST_SHPMT_XREF_DTL, ALONG WITH THE PO-NBR, AND SKU-NBR.    54220001
542300                                                                  54230001
542400* THEN CALL 5855 TO GET THE DISTINCT ASN LVL CDES.  IF MORE THAN 154240001
542500* ASN LVL CDE, IT MEANS THAT THE SKU-NBR IS IN BOTH CASES & PACKS.54250001
542600* WE ONLY WANT TO PROCESS THE ONES THAT ARE IN BOTH               54260001
542700                                                                  54270001
542800     EXEC SQL                                                     54280001
542900          FETCH SKU-CSR                                           54290001
543000          INTO                                                    54300001
543100                :WST00002-PO-NBR                                  54310001
543200              , :XLT00003-SKU-NBR                                 54320001
543300     END-EXEC.                                                    54330001
543400                                                                  54340001
543500     EVALUATE TRUE                                                54350001
543600         WHEN SQLCODE = ZERO                                      54360001
543700              MOVE XLT00003-SKU-NBR TO DK-SKU-NBR                 54370001
543800              MOVE WST00002-PO-NBR  TO DK-PO-NBR                  54380001
543900              IF PS-CICS-SWITCH-YES                               54390001
544000                  MOVE DK-SKU-NBR TO WS-DISPLAY-1                 54400001
544100                  INITIALIZE PV-CICS-MSG-AREA                     54410001
544200                  STRING   ' ' WS001-SRC-TASK-NUMBER              54420001
544300                           ' WSKCS305-5845:'                      54430001
544400                           ' SKU NBR='                            54440001
544500                           WS-DISPLAY-1                           54450001
544600                           DELIMITED BY SIZE                      54460001
544700                           INTO PV-CICS-MSG-AREA                  54470001
544800                  PERFORM 7000-WRITE-TO-CICS-LOG                  54480001
544900              END-IF                                              54490001
545000              PERFORM 5855-COUNT-ASN-FOR-SKU                      54500001
545100*             IF PV-CNT-CURSOR > 1                                54510001
545200              IF PS-MULT-ASN-YES                                  54520001
545300                  PERFORM 5860-OPEN-DTL-CSR-1                     54530001
545400                  PERFORM 5865-FETCH-DTL-CSR-1 UNTIL              54540001
545500                      PS-EOF-DTL-CSR-1-YES                        54550001
545600                  PERFORM 5870-CLOSE-DTL-CSR-1                    54560001
545700              END-IF                                              54570001
545800*        WHEN SQLCODE = -904                                      54580001
545900*        WHEN SQLCODE = -913                                      54590001
546000*        WHEN SQLCODE = -911                                      54600001
546100*             CONTINUE                                            54610001
546200         WHEN SQLCODE = +100                                      54620001
546300              SET PS-EOF-SKU-CSR-YES TO TRUE                      54630001
546400         WHEN SQLWARN0 NOT = SPACES                               54640001
546500         WHEN SQLCODE NOT = ZERO                                  54650001
546600             MOVE SQLCODE               TO PV-SQL-RETURN-CD       54660001
546700             INITIALIZE PV-CICS-MSG-AREA                          54670001
546800             STRING   ' ' WS001-SRC-TASK-NUMBER                   54680001
546900                      ' WSKCS305-5845 ERROR:'                     54690001
547000                      ' SQL='                                     54700001
547100                      PV-SQL-RETURN-CD                            54710001
547200                      ' FOR SHPMT=' DK-EXT-SHP-ID                 54720001
547300                      DELIMITED BY SIZE                           54730001
547400                      INTO PV-CICS-MSG-AREA                       54740001
547500             PERFORM 7000-WRITE-TO-CICS-LOG                       54750001
547600                                                                  54760001
547700             SET WS001-INVALID-SQL      TO TRUE                   54770001
547800             STRING 'SQL='                                        54780001
547900                  PV-SQL-RETURN-CD                                54790001
548000                  DELIMITED BY SIZE                               54800001
548100                                      INTO WS001-CRA-RET-MSG      54810001
548200             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  54820001
548300             MOVE SQLCA                 TO WS001-SQLCA            54830001
548400                                           DP013-SQLCA            54840001
548500             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        54850001
548600             MOVE 'WST_SHPMT_XREF_HDR'  TO                        54860001
548700                                       DP013-DB2-TABLE-NAME (1)   54870001
548800             MOVE 'TPURITM'             TO                        54880001
548900                                       DP013-DB2-TABLE-NAME (2)   54890001
549000             MOVE 'XLT_SKU'             TO                        54900001
549100                                       DP013-DB2-TABLE-NAME (3)   54910001
549200             SET DP013-DB2-ABEND        TO TRUE                   54920001
549300             PERFORM 9999-ABEND                                   54930001
549400     END-EVALUATE.                                                54940001
549500                                                                  54950001
549600/                                                                 54960001
549700 5850-CLOSE-SKU-CSR.                                              54970001
549800                                                                  54980001
549900     MOVE '5850-CLOSE-SKU-CSR'   TO WS001-PARAGRAPH-NAME.         54990001
550000                                                                  55000001
550100     EXEC SQL                                                     55010001
550200          CLOSE SKU-CSR                                           55020001
550300     END-EXEC.                                                    55030001
550400                                                                  55040001
550500     EVALUATE TRUE                                                55050001
550600         WHEN SQLCODE = ZERO                                      55060001
550700              IF PS-CICS-SWITCH-YES                               55070001
550800                  INITIALIZE PV-CICS-MSG-AREA                     55080001
550900                  STRING   ' ' WS001-SRC-TASK-NUMBER              55090001
551000                           ' WSKCS305-5850:'                      55100001
551100                           ' CLOSE SKU-CSR'                       55110001
551200                           DELIMITED BY SIZE                      55120001
551300                           INTO PV-CICS-MSG-AREA                  55130001
551400                  PERFORM 7000-WRITE-TO-CICS-LOG                  55140001
551500              END-IF                                              55150001
551600*        WHEN SQLCODE = -904                                      55160001
551700*        WHEN SQLCODE = -913                                      55170001
551800*        WHEN SQLCODE = -911                                      55180001
551900*             CONTINUE                                            55190001
552000         WHEN SQLWARN0 NOT = SPACES                               55200001
552100         WHEN SQLCODE NOT = ZERO                                  55210001
552200             MOVE SQLCODE               TO PV-SQL-RETURN-CD       55220001
552300             INITIALIZE PV-CICS-MSG-AREA                          55230001
552400             STRING   ' ' WS001-SRC-TASK-NUMBER                   55240001
552500                      ' WSKCS305-5850 ERROR:'                     55250001
552600                      ' SQL='                                     55260001
552700                      PV-SQL-RETURN-CD                            55270001
552800                      DELIMITED BY SIZE                           55280001
552900                      INTO PV-CICS-MSG-AREA                       55290001
553000             PERFORM 7000-WRITE-TO-CICS-LOG                       55300001
553100                                                                  55310001
553200             SET WS001-INVALID-SQL      TO TRUE                   55320001
553300             STRING 'SQL='                                        55330001
553400                  PV-SQL-RETURN-CD                                55340001
553500                  DELIMITED BY SIZE                               55350001
553600                                      INTO WS001-CRA-RET-MSG      55360001
553700             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  55370001
553800             MOVE SQLCA                 TO WS001-SQLCA            55380001
553900                                           DP013-SQLCA            55390001
554000             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        55400001
554100             SET DP013-DB2-ABEND        TO TRUE                   55410001
554200             PERFORM 9999-ABEND                                   55420001
554300     END-EVALUATE.                                                55430001
554400                                                                  55440001
554500/                                                                 55450001
554600 5855-COUNT-ASN-FOR-SKU.                                          55460001
554700     MOVE '5855-COUNT-ASN-FOR-SKU'                                55470001
554800                                 TO WS001-PARAGRAPH-NAME.         55480001
554900                                                                  55490001
555000* GET THE DISTINCT TYPES OF ASN-LVL-CDE.  IF MORE THAN 1 ROW      55500001
555100* IS RETURNED, THEN THE SKU-NBR IS SPLIT BETWEEN CASE AND SKU     55510001
555200                                                                  55520001
555300     EXEC SQL                                                     55530001
555400        SELECT  DISTINCT                                          55540001
555500                D.ASN_LVL_CDE                                     55550001
555600        INTO   :WST00002-ASN-LVL-CDE                              55560001
555700        FROM    WST_SHPMT_XREF_DTL D                              55570001
555800              , TPURITM C                                         55580001
555900              , XLT_SKU B                                         55590001
556000        WHERE   EXT_SHP_ID       = :DK-EXT-SHP-ID                 55600001
556100        AND     D.PO_NBR         = :DK-PO-NBR                     55610001
556200        AND     D.PO_NBR         = C.PO_NBR                       55620001
556300        AND     B.SKU_NBR        = :DK-SKU-NBR                    55630001
556400        AND     C.ITM_NBR        = B.ITM_NBR                      55640001
556500        AND     D.PO_LNE_NBR     = C.APP_PO_LNE_NBR               55650001
556600        AND     C.VER_STATUS_CDE = 'A'                            55660001
556700     END-EXEC.                                                    55670001
556800                                                                  55680001
556900     EVALUATE TRUE                                                55690001
557000         WHEN SQLCODE = ZERO                                      55700001
557100* 1 RECORD ON TABLE - NO NEED TO PROCESS THIS ONE                 55710001
557200             SET PS-MULT-ASN-NO          TO TRUE                  55720001
557300         WHEN SQLCODE = -811                                      55730001
557400* MULTIPLE RECORDS ON TABLE - THIS NEEDS TO BE PROCESSED          55740001
557500             SET PS-MULT-ASN-YES         TO TRUE                  55750001
557600         WHEN SQLCODE = -904                                      55760001
557700         WHEN SQLCODE = -913                                      55770001
557800         WHEN SQLCODE = -911                                      55780001
557900             CONTINUE                                             55790001
558000         WHEN SQLWARN0 NOT = SPACES                               55800001
558100         WHEN SQLCODE NOT = ZERO                                  55810001
558200             MOVE SQLCODE               TO PV-SQL-RETURN-CD       55820001
558300             INITIALIZE PV-CICS-MSG-AREA                          55830001
558400             STRING   ' ' WS001-SRC-TASK-NUMBER                   55840001
558500                      ' WSKCS305-5855 ERROR:'                     55850001
558600                      ' SQL='                                     55860001
558700                      PV-SQL-RETURN-CD                            55870001
558800                      DELIMITED BY SIZE                           55880001
558900                      INTO PV-CICS-MSG-AREA                       55890001
559000             PERFORM 7000-WRITE-TO-CICS-LOG                       55900001
559100                                                                  55910001
559200             SET WS001-INVALID-SQL      TO TRUE                   55920001
559300             STRING 'SQL='                                        55930001
559400                  PV-SQL-RETURN-CD                                55940001
559500                  DELIMITED BY SIZE                               55950001
559600                                      INTO WS001-CRA-RET-MSG      55960001
559700             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  55970001
559800             MOVE SQLCA                 TO WS001-SQLCA            55980001
559900                                           DP013-SQLCA            55990001
560000             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        56000001
560100             MOVE 'WST_SHPMT_XREF_DTL'  TO                        56010001
560200                                       DP013-DB2-TABLE-NAME (1)   56020001
560300             MOVE 'TPURITM'             TO                        56030001
560400                                       DP013-DB2-TABLE-NAME (2)   56040001
560500             MOVE 'XLT_SKU'             TO                        56050001
560600                                       DP013-DB2-TABLE-NAME (3)   56060001
560700             SET DP013-DB2-ABEND        TO TRUE                   56070001
560800             PERFORM 9999-ABEND                                   56080001
560900     END-EVALUATE.                                                56090001
561000                                                                  56100001
561100/                                                                 56110001
561200 5860-OPEN-DTL-CSR-1.                                             56120001
561300                                                                  56130001
561400     MOVE '5860-OPEN-DTL-CSR-1'  TO WS001-PARAGRAPH-NAME.         56140001
561500                                                                  56150001
561600     SET PS-EOF-DTL-CSR-1-NO        TO TRUE.                      56160001
561700                                                                  56170001
561800     EXEC SQL                                                     56180001
561900          OPEN DTL-CSR-1                                          56190001
562000     END-EXEC.                                                    56200001
562100                                                                  56210001
562200     EVALUATE TRUE                                                56220001
562300         WHEN SQLCODE = ZERO                                      56230001
562400              IF PS-CICS-SWITCH-YES                               56240001
562500                  INITIALIZE PV-CICS-MSG-AREA                     56250001
562600                  MOVE DK-SKU-NBR         TO WS-DISPLAY-1         56260001
562700                  STRING   ' ' WS001-SRC-TASK-NUMBER              56270001
562800                           ' WSKCS305-5860:'                      56280001
562900                           ' OPEN DTL-CSR-1'                      56290001
563000                           ' FOR SHPMT=' DK-EXT-SHP-ID            56300001
563100                           ' SKU=' WS-DISPLAY-1                   56310001
563200                           DELIMITED BY SIZE                      56320001
563300                           INTO PV-CICS-MSG-AREA                  56330001
563400                  PERFORM 7000-WRITE-TO-CICS-LOG                  56340001
563500              END-IF                                              56350001
563600         WHEN SQLCODE = -904                                      56360001
563700         WHEN SQLCODE = -913                                      56370001
563800         WHEN SQLCODE = -911                                      56380001
563900              CONTINUE                                            56390001
564000         WHEN SQLWARN0 NOT = SPACES                               56400001
564100         WHEN SQLCODE NOT = ZERO                                  56410001
564200             MOVE SQLCODE               TO PV-SQL-RETURN-CD       56420001
564300             INITIALIZE PV-CICS-MSG-AREA                          56430001
564400             STRING   ' ' WS001-SRC-TASK-NUMBER                   56440001
564500                      ' WSKCS305-5860 ERROR:'                     56450001
564600                      ' SQL='                                     56460001
564700                      PV-SQL-RETURN-CD                            56470001
564800                      DELIMITED BY SIZE                           56480001
564900                      INTO PV-CICS-MSG-AREA                       56490001
565000             PERFORM 7000-WRITE-TO-CICS-LOG                       56500001
565100                                                                  56510001
565200             SET WS001-INVALID-SQL      TO TRUE                   56520001
565300             STRING 'SQL='                                        56530001
565400                  PV-SQL-RETURN-CD                                56540001
565500                  DELIMITED BY SIZE                               56550001
565600                                      INTO WS001-CRA-RET-MSG      56560001
565700             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  56570001
565800             MOVE SQLCA                 TO WS001-SQLCA            56580001
565900                                           DP013-SQLCA            56590001
566000             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        56600001
566100             SET DP013-DB2-ABEND        TO TRUE                   56610001
566200             PERFORM 9999-ABEND                                   56620001
566300     END-EVALUATE.                                                56630001
566400                                                                  56640001
566500/                                                                 56650001
566600 5865-FETCH-DTL-CSR-1.                                            56660001
566700                                                                  56670001
566800     MOVE '5865-FETCH-DTL-CSR-1' TO WS001-PARAGRAPH-NAME.         56680001
566900                                                                  56690001
567000* USING THE EXT-SHP-ID FROM HDR-CSR-2, AND THE SKU-NBR FROM       56700001
567100* SKU-CSR, GET THE CASE LEVEL DATA (NOT THE SKU LEVEL DATA).      56710001
567200* THE CASE DATA WILL MOVE TO A DUMMY SHIPMENT, THE SKU LEVEL      56720001
567300* WILL REMAIN ON THE ORIGINAL SHIPMENT                            56730001
567400                                                                  56740001
567500     EXEC SQL                                                     56750001
567600          FETCH DTL-CSR-1                                         56760001
567700          INTO                                                    56770001
567800                :WST00002-PO-NBR                                  56780001
567900              , :WST00002-RCVR-SEQ-NBR                            56790001
568000              , :WST00002-PO-LNE-NBR                              56800001
568100              , :WST00002-PREPK-ID                                56810001
568200     END-EXEC.                                                    56820001
568300                                                                  56830001
568400     EVALUATE TRUE                                                56840001
568500         WHEN SQLCODE = ZERO                                      56850001
568600              MOVE WST00002-PO-NBR     TO DK-PO-NBR               56860001
568700              MOVE WST00002-RCVR-SEQ-NBR TO                       56870001
568800                                           DK-RCVR-SEQ-NBR        56880001
568900              MOVE WST00002-PO-LNE-NBR TO DK-PO-LNE-NBR           56890001
569000              MOVE WST00002-PREPK-ID   TO DK-PREPK-ID             56900001
569100              IF PS-CICS-SWITCH-YES                               56910001
569200                  MOVE DK-PO-NBR       TO WS-DISPLAY-1            56920001
569300                  MOVE DK-RCVR-SEQ-NBR TO WS-DISPLAY-2            56930001
569400                  MOVE DK-PREPK-ID     TO WS-DISPLAY-3            56940001
569500                  MOVE DK-PO-LNE-NBR   TO WS-DISPLAY-4            56950001
569600                  INITIALIZE PV-CICS-MSG-AREA                     56960001
569700                  STRING   ' ' WS001-SRC-TASK-NUMBER              56970001
569800                           ' WSKCS305-5865:'                      56980001
569900                           ' PO NBR='                             56990001
570000                           WS-DISPLAY-1                           57000001
570100                           ' RCVR SEQ NBR='                       57010001
570200                           WS-DISPLAY-2                           57020001
570300                           ' PO LNE NBR='                         57030001
570400                           WS-DISPLAY-4                           57040001
570500                           ' PREPK ID='                           57050001
570600                           WS-DISPLAY-3                           57060001
570700                           DELIMITED BY SIZE                      57070001
570800                           INTO PV-CICS-MSG-AREA                  57080001
570900                  PERFORM 7000-WRITE-TO-CICS-LOG                  57090001
571000              END-IF                                              57100001
571100              PERFORM 5900-SPLIT-SHPMNT                           57110001
571200         WHEN SQLCODE = -904                                      57120001
571300         WHEN SQLCODE = -913                                      57130001
571400         WHEN SQLCODE = -911                                      57140001
571500              CONTINUE                                            57150001
571600         WHEN SQLCODE = +100                                      57160001
571700              SET PS-EOF-DTL-CSR-1-YES TO TRUE                    57170001
571800         WHEN SQLWARN0 NOT = SPACES                               57180001
571900         WHEN SQLCODE NOT = ZERO                                  57190001
572000             MOVE SQLCODE               TO PV-SQL-RETURN-CD       57200001
572100             INITIALIZE PV-CICS-MSG-AREA                          57210001
572200             STRING   ' ' WS001-SRC-TASK-NUMBER                   57220001
572300                      ' WSKCS305-5865 ERROR:'                     57230001
572400                      ' SQL='                                     57240001
572500                      PV-SQL-RETURN-CD                            57250001
572600                      DELIMITED BY SIZE                           57260001
572700                      INTO PV-CICS-MSG-AREA                       57270001
572800             PERFORM 7000-WRITE-TO-CICS-LOG                       57280001
572900                                                                  57290001
573000             SET WS001-INVALID-SQL      TO TRUE                   57300001
573100             STRING 'SQL='                                        57310001
573200                  PV-SQL-RETURN-CD                                57320001
573300                  DELIMITED BY SIZE                               57330001
573400                                      INTO WS001-CRA-RET-MSG      57340001
573500             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  57350001
573600             MOVE SQLCA                 TO WS001-SQLCA            57360001
573700                                           DP013-SQLCA            57370001
573800             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        57380001
573900             MOVE 'WST_SHPMT_XREF_DTL'  TO                        57390001
574000                                       DP013-DB2-TABLE-NAME (1)   57400001
574100             MOVE 'TPURITM'             TO                        57410001
574200                                       DP013-DB2-TABLE-NAME (2)   57420001
574300             MOVE 'XLT_SKU'             TO                        57430001
574400                                       DP013-DB2-TABLE-NAME (3)   57440001
574500             SET DP013-DB2-ABEND        TO TRUE                   57450001
574600             PERFORM 9999-ABEND                                   57460001
574700     END-EVALUATE.                                                57470001
574800                                                                  57480001
574900/                                                                 57490001
575000 5870-CLOSE-DTL-CSR-1.                                            57500001
575100                                                                  57510001
575200     MOVE '5870-CLOSE-DTL-CSR-1' TO WS001-PARAGRAPH-NAME.         57520001
575300                                                                  57530001
575400     EXEC SQL                                                     57540001
575500          CLOSE DTL-CSR-1                                         57550001
575600     END-EXEC                                                     57560001
575700                                                                  57570001
575800     EVALUATE TRUE                                                57580001
575900         WHEN SQLCODE = ZERO                                      57590001
576000              IF PS-CICS-SWITCH-YES                               57600001
576100                  INITIALIZE PV-CICS-MSG-AREA                     57610001
576200                  STRING   ' ' WS001-SRC-TASK-NUMBER              57620001
576300                           ' WSKCS305-5870:'                      57630001
576400                           ' CLOSE DTL-CSR-1'                     57640001
576500                           DELIMITED BY SIZE                      57650001
576600                           INTO PV-CICS-MSG-AREA                  57660001
576700                  PERFORM 7000-WRITE-TO-CICS-LOG                  57670001
576800              END-IF                                              57680001
576900         WHEN SQLCODE = -904                                      57690001
577000         WHEN SQLCODE = -913                                      57700001
577100         WHEN SQLCODE = -911                                      57710001
577200              CONTINUE                                            57720001
577300         WHEN SQLWARN0 NOT = SPACES                               57730001
577400         WHEN SQLCODE NOT = ZERO                                  57740001
577500             MOVE SQLCODE               TO PV-SQL-RETURN-CD       57750001
577600             INITIALIZE PV-CICS-MSG-AREA                          57760001
577700             STRING   ' ' WS001-SRC-TASK-NUMBER                   57770001
577800                      ' WSKCS305-5870 ERROR:'                     57780001
577900                      ' SQL='                                     57790001
578000                      PV-SQL-RETURN-CD                            57800001
578100                      DELIMITED BY SIZE                           57810001
578200                      INTO PV-CICS-MSG-AREA                       57820001
578300             PERFORM 7000-WRITE-TO-CICS-LOG                       57830001
578400                                                                  57840001
578500             SET WS001-INVALID-SQL      TO TRUE                   57850001
578600             STRING 'SQL='                                        57860001
578700                  PV-SQL-RETURN-CD                                57870001
578800                  DELIMITED BY SIZE                               57880001
578900                                      INTO WS001-CRA-RET-MSG      57890001
579000             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  57900001
579100             MOVE SQLCA                 TO WS001-SQLCA            57910001
579200                                           DP013-SQLCA            57920001
579300             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        57930001
579400             SET DP013-DB2-ABEND        TO TRUE                   57940001
579500             PERFORM 9999-ABEND                                   57950001
579600     END-EVALUATE.                                                57960001
579700                                                                  57970001
579800/                                                                 57980001
579900 5900-SPLIT-SHPMNT.                                               57990001
580000                                                                  58000001
580100     MOVE '5900-SPLIT-SHPMNT'    TO WS001-PARAGRAPH-NAME.         58010001
580200                                                                  58020001
580300     PERFORM 5910-OPEN-ACTIVE-REC-CSR.                            58030001
580400     PERFORM 5920-FETCH-ACTIVE-REC-CSR UNTIL                      58040001
580500                 PS-EOF-ACTIVE-REC-CSR-YES.                       58050001
580600     PERFORM 5930-CLOSE-ACTIVE-REC-CSR.                           58060001
580700                                                                  58070001
580800/                                                                 58080001
580900 5910-OPEN-ACTIVE-REC-CSR.                                        58090001
581000                                                                  58100001
581100     MOVE '5910-OPEN-ACTIVE-REC-CSR'                              58110001
581200                                 TO WS001-PARAGRAPH-NAME.         58120001
581300                                                                  58130001
581400     SET PS-EOF-ACTIVE-REC-CSR-NO        TO TRUE.                 58140001
581500     SET PS-FIRST-RECORD-YES             TO TRUE.                 58150001
581600                                                                  58160001
581700     EXEC SQL                                                     58170001
581800          OPEN ACTIVE-REC-CSR                                     58180001
581900     END-EXEC                                                     58190001
582000                                                                  58200001
582100     EVALUATE TRUE                                                58210001
582200         WHEN SQLCODE = ZERO                                      58220001
582300              IF PS-CICS-SWITCH-YES                               58230001
582400                  INITIALIZE PV-CICS-MSG-AREA                     58240001
582500                  MOVE DK-PO-NBR          TO WS-DISPLAY-1         58250001
582600                  MOVE DK-PREPK-ID        TO WS-DISPLAY-3         58260001
582700                  STRING   ' ' WS001-SRC-TASK-NUMBER              58270001
582800                           ' WSKCS305-5910:'                      58280001
582900                           ' OPEN ACTIVE-REC-CSR'                 58290001
583000                           ' FOR SHPMT=' DK-EXT-SHP-ID            58300001
583100                           ' PO=' WS-DISPLAY-1                    58310001
583200                           ' PREPK=' WS-DISPLAY-3                 58320001
583300                           DELIMITED BY SIZE                      58330001
583400                           INTO PV-CICS-MSG-AREA                  58340001
583500                  PERFORM 7000-WRITE-TO-CICS-LOG                  58350001
583600              END-IF                                              58360001
583700         WHEN SQLCODE = -904                                      58370001
583800         WHEN SQLCODE = -913                                      58380001
583900         WHEN SQLCODE = -911                                      58390001
584000              CONTINUE                                            58400001
584100         WHEN SQLWARN0 NOT = SPACES                               58410001
584200         WHEN SQLCODE NOT = ZERO                                  58420001
584300             MOVE SQLCODE               TO PV-SQL-RETURN-CD       58430001
584400             INITIALIZE PV-CICS-MSG-AREA                          58440001
584500             STRING   ' ' WS001-SRC-TASK-NUMBER                   58450001
584600                      ' WSKCS305-5910 ERROR:'                     58460001
584700                      ' SQL='                                     58470001
584800                      PV-SQL-RETURN-CD                            58480001
584900                      DELIMITED BY SIZE                           58490001
585000                      INTO PV-CICS-MSG-AREA                       58500001
585100             PERFORM 7000-WRITE-TO-CICS-LOG                       58510001
585200                                                                  58520001
585300             SET WS001-INVALID-SQL      TO TRUE                   58530001
585400             STRING 'SQL='                                        58540001
585500                  PV-SQL-RETURN-CD                                58550001
585600                  DELIMITED BY SIZE                               58560001
585700                                      INTO WS001-CRA-RET-MSG      58570001
585800             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  58580001
585900             MOVE SQLCA                 TO WS001-SQLCA            58590001
586000                                           DP013-SQLCA            58600001
586100             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        58610001
586200             SET DP013-DB2-ABEND        TO TRUE                   58620001
586300             PERFORM 9999-ABEND                                   58630001
586400     END-EVALUATE.                                                58640001
586500                                                                  58650001
586600/                                                                 58660001
586700 5920-FETCH-ACTIVE-REC-CSR.                                       58670001
586800                                                                  58680001
586900     MOVE '5920-FETCH-ACTIVE-REC-CSR'                             58690001
587000                                 TO WS001-PARAGRAPH-NAME.         58700001
587100                                                                  58710001
587200* GET PO/RCVR/LNE/PREPK FROM WST_SHPMT_XREF_DTL.                  58720001
587300* KEYS ARE EXT-SHIP-ID/PO/PREPK/RCVR.                             58730001
587400                                                                  58740001
587500     EXEC SQL                                                     58750001
587600          FETCH ACTIVE-REC-CSR                                    58760001
587700          INTO                                                    58770001
587800                :WST00002-PO-NBR                                  58780001
587900              , :WST00002-RCVR-SEQ-NBR                            58790001
588000              , :WST00002-PO-LNE-NBR                              58800001
588100              , :WST00002-PREPK-ID                                58810001
588200     END-EXEC.                                                    58820001
588300                                                                  58830001
588400     EVALUATE TRUE                                                58840001
588500         WHEN SQLCODE = ZERO                                      58850001
588600              MOVE WST00002-PO-NBR          TO WS-PO-NBR          58860001
588700              MOVE WST00002-RCVR-SEQ-NBR    TO WS-RCVR-SEQ-NBR    58870001
588800              MOVE WST00002-PO-LNE-NBR      TO WS-PO-LNE-NBR      58880001
588900              MOVE WST00002-PREPK-ID        TO WS-PREPK-ID        58890001
589000                                                                  58900001
589100              IF PS-CICS-SWITCH-YES                               58910001
589200                  INITIALIZE PV-CICS-MSG-AREA                     58920001
589300                  MOVE WS-PO-NBR TO WS-DISPLAY-1                  58930001
589400                  MOVE WS-RCVR-SEQ-NBR TO WS-DISPLAY-2            58940001
589500                  MOVE WS-PO-LNE-NBR TO WS-DISPLAY-4              58950001
589600                  STRING   ' ' WS001-SRC-TASK-NUMBER              58960001
589700                               ' WSKCS305-5920:'                  58970001
589800                               ' PO NBR='                         58980001
589900                               WS-DISPLAY-1                       58990001
590000                               ' RCVR SEQ NBR='                   59000001
590100                               WS-DISPLAY-2                       59010001
590200                               ' PO LNE NBR='                     59020001
590300                               WS-DISPLAY-4                       59030001
590400                               DELIMITED BY SIZE                  59040001
590500                               INTO PV-CICS-MSG-AREA              59050001
590600                  PERFORM 7000-WRITE-TO-CICS-LOG                  59060001
590700              END-IF                                              59070001
590800              IF PS-FIRST-DUMMY-REC-YES                           59080001
590900                  MOVE DK-EXT-SHP-ID        TO WS-OLD-EXT-SHP-ID  59090001
591000                  MOVE 'N'                  TO WS-DWNLD-CDE       59100001
591100                  SET PS-DUMMY-HEADER-YES   TO TRUE               59110001
591110*                                                                 59111009
591120* dmh 12/13/2016 - begin                                          59112009
591130              if  PS-CAPTURE-DOWNLOAD-YES                         59113009
591140                MOVE '5920-FETCH-ACTive'  tO WS025-PARAGRAPH-NAME 59114009
591150                MOVE 'first dummy record' TO WS025-INFORMATION    59115009
591160                perform 0560-WFT-DAT-xfer                         59116009
591170              end-if                                              59117009
591180* dmh 12/13/2016 - end                                            59118009
591190*                                                                 59119009
591200                  PERFORM 5000-INSERT-HEADER                      59120001
591300                  SET PS-FIRST-DUMMY-REC-NO TO TRUE               59130001
591400                  SET PS-ASN-NEW-HDR-YES    TO TRUE               59140001
591500                  MOVE WS-EXT-SHP-ID        TO WS-NEW-EXT-SHP-ID  59150001
591600              END-IF                                              59160001
591700              MOVE WS-NEW-EXT-SHP-ID        TO DK-EXT-SHP-ID      59170001
591800              PERFORM 5100-INSERT-DETAIL                          59180001
591900              MOVE WS-OLD-EXT-SHP-ID        TO DK-EXT-SHP-ID      59190001
592000              PERFORM 5940-UPDATE-DETAIL                          59200001
592100         WHEN SQLCODE = -904                                      59210001
592200         WHEN SQLCODE = -913                                      59220001
592300         WHEN SQLCODE = -911                                      59230001
592400              CONTINUE                                            59240001
592500         WHEN SQLCODE = +100                                      59250001
592600              SET PS-EOF-ACTIVE-REC-CSR-YES TO TRUE               59260001
592700         WHEN SQLWARN0 NOT = SPACES                               59270001
592800         WHEN SQLCODE NOT = ZERO                                  59280001
592900             MOVE SQLCODE               TO PV-SQL-RETURN-CD       59290001
593000             INITIALIZE PV-CICS-MSG-AREA                          59300001
593100             STRING   ' ' WS001-SRC-TASK-NUMBER                   59310001
593200                      ' WSKCS305-5920 ERROR:'                     59320001
593300                      ' SQL='                                     59330001
593400                      PV-SQL-RETURN-CD                            59340001
593500                      DELIMITED BY SIZE                           59350001
593600                      INTO PV-CICS-MSG-AREA                       59360001
593700             PERFORM 7000-WRITE-TO-CICS-LOG                       59370001
593800                                                                  59380001
593900             SET WS001-INVALID-SQL      TO TRUE                   59390001
594000             STRING 'SQL='                                        59400001
594100                  PV-SQL-RETURN-CD                                59410001
594200                  DELIMITED BY SIZE                               59420001
594300                                      INTO WS001-CRA-RET-MSG      59430001
594400             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  59440001
594500             MOVE SQLCA                 TO WS001-SQLCA            59450001
594600                                           DP013-SQLCA            59460001
594700             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        59470001
594800             MOVE 'WST_SHPMT_XREF_DTL'  TO                        59480001
594900                                       DP013-DB2-TABLE-NAME (1)   59490001
595000             SET DP013-DB2-ABEND        TO TRUE                   59500001
595100             PERFORM 9999-ABEND                                   59510001
595200     END-EVALUATE.                                                59520001
595300                                                                  59530001
595400/                                                                 59540001
595500 5930-CLOSE-ACTIVE-REC-CSR.                                       59550001
595600                                                                  59560001
595700     MOVE '5930-CLOSE-ACTIVE-REC-CSR'                             59570001
595800                                 TO WS001-PARAGRAPH-NAME.         59580001
595900                                                                  59590001
596000     EXEC SQL                                                     59600001
596100          CLOSE ACTIVE-REC-CSR                                    59610001
596200     END-EXEC.                                                    59620001
596300                                                                  59630001
596400     EVALUATE TRUE                                                59640001
596500         WHEN SQLCODE = ZERO                                      59650001
596600              IF PS-CICS-SWITCH-YES                               59660001
596700                  INITIALIZE PV-CICS-MSG-AREA                     59670001
596800                  STRING   ' ' WS001-SRC-TASK-NUMBER              59680001
596900                           ' WSKCS305-5930:'                      59690001
597000                           ' CLOSE ACTIVE-REC-CSR'                59700001
597100                           DELIMITED BY SIZE                      59710001
597200                           INTO PV-CICS-MSG-AREA                  59720001
597300                  PERFORM 7000-WRITE-TO-CICS-LOG                  59730001
597400              END-IF                                              59740001
597500         WHEN SQLCODE = -904                                      59750001
597600         WHEN SQLCODE = -913                                      59760001
597700         WHEN SQLCODE = -911                                      59770001
597800              CONTINUE                                            59780001
597900         WHEN SQLWARN0 NOT = SPACES                               59790001
598000         WHEN SQLCODE NOT = ZERO                                  59800001
598100             MOVE SQLCODE               TO PV-SQL-RETURN-CD       59810001
598200             INITIALIZE PV-CICS-MSG-AREA                          59820001
598300             STRING   ' ' WS001-SRC-TASK-NUMBER                   59830001
598400                      ' WSKCS305-5930 ERROR:'                     59840001
598500                      ' SQL='                                     59850001
598600                      PV-SQL-RETURN-CD                            59860001
598700                      DELIMITED BY SIZE                           59870001
598800                      INTO PV-CICS-MSG-AREA                       59880001
598900             PERFORM 7000-WRITE-TO-CICS-LOG                       59890001
599000                                                                  59900001
599100             SET WS001-INVALID-SQL      TO TRUE                   59910001
599200             STRING 'SQL='                                        59920001
599300                  PV-SQL-RETURN-CD                                59930001
599400                  DELIMITED BY SIZE                               59940001
599500                                      INTO WS001-CRA-RET-MSG      59950001
599600             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  59960001
599700             MOVE SQLCA                 TO WS001-SQLCA            59970001
599800                                           DP013-SQLCA            59980001
599900             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        59990001
600000             SET DP013-DB2-ABEND        TO TRUE                   60000001
600100             PERFORM 9999-ABEND                                   60010001
600200     END-EVALUATE.                                                60020001
600300                                                                  60030001
600400/                                                                 60040001
600500 5940-UPDATE-DETAIL.                                              60050001
600600                                                                  60060001
600700     MOVE '5940-UPDATE-DETAIL'   TO WS001-PARAGRAPH-NAME.         60070001
600800                                                                  60080001
600900     EXEC SQL                                                     60090001
601000          UPDATE WST_SHPMT_XREF_DTL                               60100001
601100             SET   ACTV_CDE       = 'I'                           60110001
601200           WHERE   EXT_SHP_ID     = :DK-EXT-SHP-ID                60120001
601300             AND   PO_NBR         = :WS-PO-NBR                    60130001
601400             AND   PO_LNE_NBR     = :WS-PO-LNE-NBR                60140001
601500             AND   RCVR_SEQ_NBR   = :WS-RCVR-SEQ-NBR              60150001
601600             AND   PREPK_ID       = :WS-PREPK-ID                  60160001
601700     END-EXEC.                                                    60170001
601800                                                                  60180001
601900     EVALUATE TRUE                                                60190001
602000         WHEN SQLCODE = ZERO                                      60200001
602100              IF PS-CICS-SWITCH-YES                               60210001
602200                  MOVE DK-PO-NBR       TO WS-DISPLAY-1            60220001
602300                  MOVE DK-RCVR-SEQ-NBR TO WS-DISPLAY-2            60230001
602400                  MOVE DK-PREPK-ID     TO WS-DISPLAY-3            60240001
602500                 INITIALIZE PV-CICS-MSG-AREA                      60250001
602600                  STRING   ' ' WS001-SRC-TASK-NUMBER              60260001
602700                           ' WSKCS305-5940:'                      60270001
602800                           ' UPDATE WST_SHPMT_XREF_DTL'           60280001
602900                           ' FOR SHPMT='                          60290001
603000                           DK-EXT-SHP-ID                          60300001
603100                           ' PO NBR='                             60310001
603200                           WS-DISPLAY-1                           60320001
603300                           ' RCVR SEQ NBR='                       60330001
603400                           WS-DISPLAY-2                           60340001
603500                           ' PREPK ID='                           60350001
603600                           WS-DISPLAY-3                           60360001
603700                           DELIMITED BY SIZE                      60370001
603800                           INTO PV-CICS-MSG-AREA                  60380001
603900                  PERFORM 7000-WRITE-TO-CICS-LOG                  60390001
604000              END-IF                                              60400001
604100         WHEN SQLCODE = -904                                      60410001
604200         WHEN SQLCODE = -913                                      60420001
604300         WHEN SQLCODE = -911                                      60430001
604400              CONTINUE                                            60440001
604500         WHEN SQLWARN0 NOT = SPACES                               60450001
604600         WHEN SQLCODE NOT = ZERO                                  60460001
604700                                                                  60470001
604800*** DMH - BEGIN - 4/1/08 ADDED ADDITIONAL DISPLAY                 60480001
604900             MOVE DK-PO-NBR       TO WS-DISPLAY-1                 60490001
605000             MOVE DK-RCVR-SEQ-NBR TO WS-DISPLAY-2                 60500001
605100             MOVE DK-PREPK-ID     TO WS-DISPLAY-3                 60510001
605200             INITIALIZE PV-CICS-MSG-AREA                          60520001
605300             STRING   ' ' WS001-SRC-TASK-NUMBER                   60530001
605400                      ' WSKCS305-5940 '                           60540001
605500                      ' PO:' WS-DISPLAY-1                         60550001
605600                      '-'    WS-DISPLAY-2                         60560001
605700                      '  PREPK:' WS-DISPLAY-3                     60570001
605800                      '  SHPMT:' DK-EXT-SHP-ID                    60580001
605900                      DELIMITED BY SIZE                           60590001
606000                      INTO PV-CICS-MSG-AREA                       60600001
606100             PERFORM 7000-WRITE-TO-CICS-LOG                       60610001
606200*** DMH -  END - 4/1/08 ADDED ADDITIONAL DISPLAY                  60620001
606300                                                                  60630001
606400             MOVE SQLCODE               TO PV-SQL-RETURN-CD       60640001
606500             INITIALIZE PV-CICS-MSG-AREA                          60650001
606600             STRING   ' ' WS001-SRC-TASK-NUMBER                   60660001
606700                      ' WSKCS305-5940 ERROR:'                     60670001
606800                      ' SQL='                                     60680001
606900                      PV-SQL-RETURN-CD                            60690001
607000                      DELIMITED BY SIZE                           60700001
607100                      INTO PV-CICS-MSG-AREA                       60710001
607200             PERFORM 7000-WRITE-TO-CICS-LOG                       60720001
607300                                                                  60730001
607400             SET WS001-INVALID-SQL      TO TRUE                   60740001
607500             STRING 'SQL='                                        60750001
607600                  PV-SQL-RETURN-CD                                60760001
607700                  DELIMITED BY SIZE                               60770001
607800                                      INTO WS001-CRA-RET-MSG      60780001
607900             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  60790001
608000             MOVE SQLCA                 TO WS001-SQLCA            60800001
608100                                           DP013-SQLCA            60810001
608200             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        60820001
608300             MOVE 'WST_SHPMT_XREF_DTL'  TO                        60830001
608400                                       DP013-DB2-TABLE-NAME (1)   60840001
608500             SET DP013-DB2-ABEND        TO TRUE                   60850001
608600             PERFORM 9999-ABEND                                   60860001
608700     END-EVALUATE.                                                60870001
608800                                                                  60880001
608900/                                                                 60890001
609000 6000-CREATE-RANDOM-NBR.                                          60900001
609100                                                                  60910001
609200     MOVE '6000-CREATE-RANDOM-NBR'                                60920001
609300                                 TO WS001-PARAGRAPH-NAME.         60930001
609400                                                                  60940001
609500     INITIALIZE DP902-RANDNBR-ROUTINE-FIELDS.                     60950001
609600     CALL PC-RANDOM-NBR-GENERATOR USING DFHEIBLK                  60960001
609700                            DFHCOMMAREA                           60970001
609800                            DP902-RANDNBR-ROUTINE-FIELDS.         60980001
609900                                                                  60990001
610000     IF DP902-SUCCESSFUL                                          61000001
610100         CONTINUE                                                 61010001
610200     ELSE                                                         61020001
610300         SET WS001-ERROR              TO TRUE                     61030001
610400         STRING 'DP902-RETURN-CODE='                              61040001
610500                DP902-RETURN-CODE                                 61050001
610600                DELIMITED BY SIZE                                 61060001
610700                                    INTO WS001-CRA-RET-MSG        61070001
610800         MOVE SQLCA                   TO WS001-SQLCA              61080001
610900     END-IF.                                                      61090001
611000                                                                  61100001
611100/                                                                 61110001
611200 7000-WRITE-TO-CICS-LOG.                                          61120001
611300                                                                  61130001
611400*    MOVE '7000-WRITE-TO-CICS-LOG'                                61140001
611500*                                TO WS001-PARAGRAPH-NAME.         61150001
611600     MOVE LENGTH OF PV-CICS-MSG-AREA TO PV-COMMAREA-LENGTH.       61160001
611700                                                                  61170001
611800     EXEC CICS                                                    61180001
611900          WRITEQ TD                                               61190001
612000          QUEUE  ('CSSL')                                         61200001
612100          FROM  (PV-CICS-MSG-AREA)                                61210001
612200          LENGTH  (PV-COMMAREA-LENGTH)                            61220001
612300          RESP  (PV-CICS-RESP)                                    61230001
612400     END-EXEC.                                                    61240001
612500                                                                  61250001
612600     MOVE SPACES TO PV-CICS-MSG-AREA.                             61260001
612700                                                                  61270001
612800/                                                                 61280001
612900 8000-CREATE-DUMMY.                                               61290001
613000                                                                  61300001
613100* GET ORIGINAL SHIPMENT                                           61310001
613200* ADD DUMMY SHIPMENT HEADER RECORD WITH DWNLD-CDE = P             61320001
613300* CHG ORIGINAL SHIPMENT HEADER TO HAVE DWNLD-CDE = C              61330001
613400* FOR EACH DETAIL RECORD WHERE THE DWNLD-CDE NOT = D              61340001
613500*     ADD DETAIL RECORD TO DUMMY SHIPMENT                         61350001
613600*     INACTIVATE DETAIL RECORD FOR ORIGINAL SHIPMENT              61360001
613700* SET IMMED-DWNLD-SWITCH, SO THAT THE DOWNLOAD MOD IS CALLED      61370001
613800                                                                  61380001
613900     PERFORM 8040-GET-HDR-INFO.                                   61390001
614000                                                                  61400001
614100     SET PS-DUMMY-HEADER-YES    TO TRUE.                          61410001
614200     MOVE 'P'                   TO WS-DWNLD-CDE.                  61420001
614210*                                                                 61421009
614220* dmh 12/13/2016 - begin                                          61422009
614230              if  PS-CAPTURE-DOWNLOAD-YES                         61423009
614240                MOVE '8000-create-dummy'  tO WS025-PARAGRAPH-NAME 61424009
614250                MOVE '                  ' TO WS025-INFORMATION    61425009
614260                perform 0560-WFT-DAT-xfer                         61426009
614270              end-if                                              61427009
614280* dmh 12/13/2016 - end                                            61428009
614290*                                                                 61429009
614300     PERFORM 5000-INSERT-HEADER.                                  61430001
614400     PERFORM 8060-UPDATE-HDR-REC.                                 61440001
614500                                                                  61450001
614600     PERFORM 8010-OPEN-DUMMY-CSR.                                 61460001
614700     PERFORM 8020-FETCH-DUMMY-CSR UNTIL                           61470001
614800             PS-EOF-DUMMY-CSR-YES.                                61480001
614900     PERFORM 8030-CLOSE-DUMMY-CSR.                                61490001
615000                                                                  61500001
615100     SET PS-IMMED-DOWNLOAD-YES  TO TRUE.                          61510001
615200     SET PS-CHECK-ASN-NO        TO TRUE.                          61520001
615300                                                                  61530001
615400/                                                                 61540001
615500 8010-OPEN-DUMMY-CSR.                                             61550001
615600                                                                  61560001
615700     MOVE '8010-OPEN-DUMMY-CSR'                                   61570001
615800                                 TO WS001-PARAGRAPH-NAME.         61580001
615900                                                                  61590001
616000     SET PS-EOF-DUMMY-CSR-NO          TO TRUE.                    61600001
616100                                                                  61610001
616200     EXEC SQL                                                     61620001
616300          OPEN DUMMY-CSR                                          61630001
616400     END-EXEC.                                                    61640001
616500                                                                  61650001
616600     EVALUATE TRUE                                                61660001
616700         WHEN SQLCODE = ZERO                                      61670001
616800             IF PS-CICS-SWITCH-YES                                61680001
616900                 INITIALIZE PV-CICS-MSG-AREA                      61690001
617000                 STRING   ' ' WS001-SRC-TASK-NUMBER               61700001
617100                          ' WSKCS305-8010:'                       61710001
617200                          ' OPENED DUMMY-CSR'                     61720001
617300                          ' FOR SHPMT=' DK-EXT-SHP-ID             61730001
617400                          DELIMITED BY SIZE                       61740001
617500                          INTO PV-CICS-MSG-AREA                   61750001
617600                 PERFORM 7000-WRITE-TO-CICS-LOG                   61760001
617700             END-IF                                               61770001
617800         WHEN SQLCODE = -904                                      61780001
617900         WHEN SQLCODE = -913                                      61790001
618000         WHEN SQLCODE = -911                                      61800001
618100              CONTINUE                                            61810001
618200         WHEN SQLWARN0 NOT = SPACES                               61820001
618300         WHEN SQLCODE NOT = ZERO                                  61830001
618400             INITIALIZE PV-CICS-MSG-AREA                          61840001
618500             MOVE SQLCODE               TO PV-SQL-RETURN-CD       61850001
618600             STRING   ' ' WS001-SRC-TASK-NUMBER                   61860001
618700                      ' WSKCS305-8010 ERROR:'                     61870001
618800                      ' SQL='                                     61880001
618900                      PV-SQL-RETURN-CD                            61890001
619000                      DELIMITED BY SIZE                           61900001
619100                      INTO PV-CICS-MSG-AREA                       61910001
619200             PERFORM 7000-WRITE-TO-CICS-LOG                       61920001
619300                                                                  61930001
619400             SET WS001-INVALID-SQL      TO TRUE                   61940001
619500             STRING 'SQL='                                        61950001
619600                  PV-SQL-RETURN-CD                                61960001
619700                  DELIMITED BY SIZE                               61970001
619800                                      INTO WS001-CRA-RET-MSG      61980001
619900             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  61990001
620000             MOVE SQLCA                 TO WS001-SQLCA            62000001
620100                                           DP013-SQLCA            62010001
620200             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        62020001
620300             SET DP013-DB2-ABEND        TO TRUE                   62030001
620400             PERFORM 9999-ABEND                                   62040001
620500     END-EVALUATE.                                                62050001
620600                                                                  62060001
620700/                                                                 62070001
620800 8020-FETCH-DUMMY-CSR.                                            62080001
620900                                                                  62090001
621000     MOVE '8020-FETCH-DUMMY-CSR'                                  62100001
621100                                 TO WS001-PARAGRAPH-NAME.         62110001
621200                                                                  62120001
621300* GET ALL DATA FROM THE XREF DTL, KEY IS THE ORIG EXT-SHP-ID.     62130001
621400                                                                  62140001
621500     EXEC SQL                                                     62150001
621600          FETCH DUMMY-CSR                                         62160001
621700          INTO                                                    62170001
621800                :WST00002-PO-NBR                                  62180001
621900               ,:WST00002-PO-LNE-NBR                              62190001
622000               ,:WST00002-RCVR-SEQ-NBR                            62200001
622100               ,:WST00002-PREPK-ID                                62210001
622200               ,:WST00002-ASN-LVL-CDE                             62220001
622300               ,:WST00002-DWNLD-CDE                               62230001
622400               ,:WST00002-ACTV-CDE                                62240001
622500     END-EXEC.                                                    62250001
622600                                                                  62260001
622700     EVALUATE TRUE                                                62270001
622800         WHEN SQLCODE = ZERO                                      62280001
622900             IF PS-CICS-SWITCH-YES                                62290001
623000                 INITIALIZE PV-CICS-MSG-AREA                      62300001
623100                 MOVE WST00002-PO-NBR       TO WS-DISPLAY-1       62310001
623200                 MOVE WST00002-PO-LNE-NBR   TO WS-DISPLAY-2       62320001
623300                 MOVE WST00002-RCVR-SEQ-NBR TO WS-DISPLAY-3       62330001
623400                 STRING   ' ' WS001-SRC-TASK-NUMBER               62340001
623500                          ' WSKCS305-8020:'                       62350001
623600                          ' PO='                                  62360001
623700                          WS-DISPLAY-1                            62370001
623800                          ' PO LNE='                              62380001
623900                          WS-DISPLAY-2                            62390001
624000                          ' RCVR='                                62400001
624100                          WS-DISPLAY-3                            62410001
624200                          DELIMITED BY SIZE                       62420001
624300                                          INTO PV-CICS-MSG-AREA   62430001
624400                 PERFORM 7000-WRITE-TO-CICS-LOG                   62440001
624500             END-IF                                               62450001
624600                                                                  62460001
624700            MOVE WS-EXT-SHP-ID          TO WST00002-EXT-SHP-ID    62470001
624800            MOVE WS001-USER-ID          TO WST00002-CRE-USR-ID    62480001
624900            MOVE PV-CURRENT-TIMESTAMP   TO WST00002-CRE-TMST      62490001
625000            MOVE 'N'                    TO WST00002-DWNLD-CDE     62500001
625100            MOVE 'A'                    TO WST00002-ACTV-CDE      62510001
625200            MOVE WS001-CALLING-PROGRAM-NAME                       62520001
625300                                        TO WST00002-CRE-PGM-CDE   62530001
625400            PERFORM 5447-INSERT-SHIP-XREF-DTL                     62540001
625500                                                                  62550001
625600            MOVE WST00002-PO-NBR        TO DK-PO-NBR              62560001
625700            MOVE WST00002-PO-LNE-NBR    TO DK-PO-LNE-NBR          62570001
625800            MOVE WST00002-RCVR-SEQ-NBR  TO DK-RCVR-SEQ-NBR        62580001
625900            PERFORM 8050-UPDATE-DTL-REC                           62590001
626000                                                                  62600001
626100         WHEN SQLCODE = -904                                      62610001
626200         WHEN SQLCODE = -913                                      62620001
626300         WHEN SQLCODE = -911                                      62630001
626400              CONTINUE                                            62640001
626500         WHEN SQLCODE = +100                                      62650001
626600              SET PS-EOF-DUMMY-CSR-YES TO TRUE                    62660001
626700         WHEN SQLWARN0 NOT = SPACES                               62670001
626800         WHEN SQLCODE NOT = ZERO                                  62680001
626900             INITIALIZE PV-CICS-MSG-AREA                          62690001
627000             MOVE SQLCODE               TO PV-SQL-RETURN-CD       62700001
627100             STRING   ' ' WS001-SRC-TASK-NUMBER                   62710001
627200                      ' WSKCS305-8020 ERROR:'                     62720001
627300                      ' SQL='                                     62730001
627400                      PV-SQL-RETURN-CD                            62740001
627500                      DELIMITED BY SIZE                           62750001
627600                      INTO PV-CICS-MSG-AREA                       62760001
627700             PERFORM 7000-WRITE-TO-CICS-LOG                       62770001
627800                                                                  62780001
627900             SET WS001-INVALID-SQL      TO TRUE                   62790001
628000             STRING 'SQL='                                        62800001
628100                  PV-SQL-RETURN-CD                                62810001
628200                  DELIMITED BY SIZE                               62820001
628300                                      INTO WS001-CRA-RET-MSG      62830001
628400             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  62840001
628500             MOVE SQLCA                 TO WS001-SQLCA            62850001
628600                                           DP013-SQLCA            62860001
628700             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        62870001
628800             MOVE 'WST_SHPMT_XREF_DTL'  TO                        62880001
628900                                       DP013-DB2-TABLE-NAME (1)   62890001
629000             SET DP013-DB2-ABEND        TO TRUE                   62900001
629100             PERFORM 9999-ABEND                                   62910001
629200     END-EVALUATE.                                                62920001
629300                                                                  62930001
629400/                                                                 62940001
629500 8030-CLOSE-DUMMY-CSR.                                            62950001
629600                                                                  62960001
629700     MOVE '8030-CLOSE-DUMMY-CSR'                                  62970001
629800                                 TO WS001-PARAGRAPH-NAME.         62980001
629900                                                                  62990001
630000     EXEC SQL                                                     63000001
630100          CLOSE DUMMY-CSR                                         63010001
630200     END-EXEC.                                                    63020001
630300                                                                  63030001
630400     EVALUATE TRUE                                                63040001
630500         WHEN SQLCODE = ZERO                                      63050001
630600             IF PS-CICS-SWITCH-YES                                63060001
630700                 INITIALIZE PV-CICS-MSG-AREA                      63070001
630800                 STRING   ' ' WS001-SRC-TASK-NUMBER               63080001
630900                          ' WSKCS305-8030:'                       63090001
631000                          ' CLOSED DUMMY-CSR'                     63100001
631100                          DELIMITED BY SIZE                       63110001
631200                          INTO PV-CICS-MSG-AREA                   63120001
631300                 PERFORM 7000-WRITE-TO-CICS-LOG                   63130001
631400             END-IF                                               63140001
631500         WHEN SQLCODE = -904                                      63150001
631600         WHEN SQLCODE = -913                                      63160001
631700         WHEN SQLCODE = -911                                      63170001
631800              CONTINUE                                            63180001
631900         WHEN SQLWARN0 NOT = SPACES                               63190001
632000         WHEN SQLCODE NOT = ZERO                                  63200001
632100             INITIALIZE PV-CICS-MSG-AREA                          63210001
632200             MOVE SQLCODE               TO PV-SQL-RETURN-CD       63220001
632300             STRING   ' ' WS001-SRC-TASK-NUMBER                   63230001
632400                      ' WSKCS305-8030-ERROR:'                     63240001
632500                      ' SQL='                                     63250001
632600                      PV-SQL-RETURN-CD                            63260001
632700                      DELIMITED BY SIZE                           63270001
632800                      INTO PV-CICS-MSG-AREA                       63280001
632900             PERFORM 7000-WRITE-TO-CICS-LOG                       63290001
633000                                                                  63300001
633100             SET WS001-INVALID-SQL      TO TRUE                   63310001
633200             STRING 'SQL='                                        63320001
633300                  PV-SQL-RETURN-CD                                63330001
633400                  DELIMITED BY SIZE                               63340001
633500                                      INTO WS001-CRA-RET-MSG      63350001
633600             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  63360001
633700             MOVE SQLCA                 TO WS001-SQLCA            63370001
633800                                           DP013-SQLCA            63380001
633900             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        63390001
634000             SET DP013-DB2-ABEND        TO TRUE                   63400001
634100             PERFORM 9999-ABEND                                   63410001
634200     END-EVALUATE.                                                63420001
634300                                                                  63430001
634400/                                                                 63440001
634500 8040-GET-HDR-INFO.                                               63450001
634600                                                                  63460001
634700     MOVE '8040-GET-HDR-INFO'    TO WS001-PARAGRAPH-NAME.         63470001
634800                                                                  63480001
634900     EXEC SQL                                                     63490001
635000         SELECT  DISTINCT                                         63500001
635100                 INTR_TRIP_ID                                     63510001
635200               , DEST_LOC_NBR                                     63520001
635300         INTO                                                     63530001
635400                :WST00001-INTR-TRIP-ID                            63540001
635500              , :WST00001-DEST-LOC-NBR                            63550001
635600         FROM    WST_SHPMT_XREF_HDR                               63560001
635700         WHERE   EXT_SHP_ID     = :DK-EXT-SHP-ID                  63570001
635800     END-EXEC.                                                    63580001
635900                                                                  63590001
636000     EVALUATE TRUE                                                63600001
636100         WHEN SQLCODE = ZERO                                      63610001
636200             MOVE WST00001-INTR-TRIP-ID    TO DK-TRIP-ID          63620001
636300                                              WS-TRIP-ID          63630001
636400             MOVE WST00001-DEST-LOC-NBR    TO WS001-OPER-UNT-ID   63640001
636500             IF PS-CICS-SWITCH-YES                                63650001
636600                 MOVE DK-TRIP-ID           TO WS-DISPLAY-1        63660001
636700                 INITIALIZE PV-CICS-MSG-AREA                      63670001
636800                 STRING   ' ' WS001-SRC-TASK-NUMBER               63680001
636900                          ' WSKCS305-8040:'                       63690001
637000                          ' TRIP='                                63700001
637100                          WS-DISPLAY-1                            63710001
637200                          DELIMITED BY SIZE                       63720001
637300                          INTO PV-CICS-MSG-AREA                   63730001
637400                 PERFORM 7000-WRITE-TO-CICS-LOG                   63740001
637500             END-IF                                               63750001
637600         WHEN SQLCODE = -811                                      63760001
637700         WHEN SQLCODE = -904                                      63770001
637800         WHEN SQLCODE = -913                                      63780001
637900         WHEN SQLCODE = -911                                      63790001
638000             CONTINUE                                             63800001
638100         WHEN SQLWARN0 NOT = SPACES                               63810001
638200         WHEN SQLCODE NOT = ZERO                                  63820001
638300             SET WS001-INVALID-SQL      TO TRUE                   63830001
638400             MOVE SQLCODE               TO PV-SQL-RETURN-CD       63840001
638500             STRING 'SQL='                                        63850001
638600                  PV-SQL-RETURN-CD                                63860001
638700                  DELIMITED BY SIZE                               63870001
638800                                      INTO WS001-CRA-RET-MSG      63880001
638900             MOVE SQLCA                 TO WS001-SQLCA            63890001
639000             INITIALIZE PV-CICS-MSG-AREA                          63900001
639100             STRING   ' ' WS001-SRC-TASK-NUMBER                   63910001
639200                      ' WSKCS305-8040 ERROR:'                     63920001
639300                      ' SQL='                                     63930001
639400                      PV-SQL-RETURN-CD                            63940001
639500                      DELIMITED BY SIZE                           63950001
639600                      INTO PV-CICS-MSG-AREA                       63960001
639700             PERFORM 7000-WRITE-TO-CICS-LOG                       63970001
639800     END-EVALUATE.                                                63980001
639900*                                                                 63990001
640000/                                                                 64000001
640100 8050-UPDATE-DTL-REC.                                             64010001
640200                                                                  64020001
640300     MOVE '8050-UPDATE-DTL-REC'  TO WS001-PARAGRAPH-NAME.         64030001
640400                                                                  64040001
640500     EXEC SQL                                                     64050001
640600          UPDATE WST_SHPMT_XREF_DTL                               64060001
640700             SET ACTV_CDE         = 'I'                           64070001
640800             WHERE EXT_SHP_ID     = :DK-EXT-SHP-ID                64080001
640900             AND   PO_NBR         = :DK-PO-NBR                    64090001
641000             AND   PO_LNE_NBR     = :DK-PO-LNE-NBR                64100001
641100             AND   RCVR_SEQ_NBR   = :DK-RCVR-SEQ-NBR              64110001
641200     END-EXEC.                                                    64120001
641300                                                                  64130001
641400     EVALUATE TRUE                                                64140001
641500         WHEN SQLCODE = ZERO                                      64150001
641600             IF PS-CICS-SWITCH-YES                                64160001
641700                 MOVE DK-PO-NBR       TO WS-DISPLAY-1             64170001
641800                 MOVE DK-PO-LNE-NBR   TO WS-DISPLAY-2             64180001
641900                 MOVE DK-RCVR-SEQ-NBR TO WS-DISPLAY-3             64190001
642000                 INITIALIZE PV-CICS-MSG-AREA                      64200001
642100                 STRING   ' ' WS001-SRC-TASK-NUMBER               64210001
642200                          ' WSKCS305-8050:'                       64220001
642300                          ' UPDATE WST_SHPMT_XREF_DTL'            64230001
642400                          ' FOR SHPMT=' DK-EXT-SHP-ID             64240001
642500                          ' PO NBR=' WS-DISPLAY-1                 64250001
642600                          ' PO LNE=' WS-DISPLAY-2                 64260001
642700                          ' RCVR SEQ=' WS-DISPLAY-3               64270001
642800                          DELIMITED BY SIZE                       64280001
642900                          INTO PV-CICS-MSG-AREA                   64290001
643000                 PERFORM 7000-WRITE-TO-CICS-LOG                   64300001
643100             END-IF                                               64310001
643200         WHEN SQLCODE = -904                                      64320001
643300         WHEN SQLCODE = -913                                      64330001
643400         WHEN SQLCODE = -911                                      64340001
643500              CONTINUE                                            64350001
643600         WHEN SQLCODE = 100                                       64360001
643700         WHEN SQLWARN0 NOT = SPACES                               64370001
643800         WHEN SQLCODE NOT = ZERO                                  64380001
643900             INITIALIZE PV-CICS-MSG-AREA                          64390001
644000             MOVE SQLCODE               TO PV-SQL-RETURN-CD       64400001
644100             STRING   ' ' WS001-SRC-TASK-NUMBER                   64410001
644200                      ' WSKCS305-8050 ERROR:'                     64420001
644300                      ' SQL='                                     64430001
644400                      PV-SQL-RETURN-CD                            64440001
644500                      DELIMITED BY SIZE                           64450001
644600                      INTO PV-CICS-MSG-AREA                       64460001
644700             PERFORM 7000-WRITE-TO-CICS-LOG                       64470001
644800                                                                  64480001
644900             SET WS001-INVALID-SQL      TO TRUE                   64490001
645000             STRING 'SQL='                                        64500001
645100                  PV-SQL-RETURN-CD                                64510001
645200                  DELIMITED BY SIZE                               64520001
645300                                      INTO WS001-CRA-RET-MSG      64530001
645400             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  64540001
645500             MOVE SQLCA                 TO WS001-SQLCA            64550001
645600                                           DP013-SQLCA            64560001
645700             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        64570001
645800             MOVE 'WST_SHPMT_XREF_DTL'  TO                        64580001
645900                                       DP013-DB2-TABLE-NAME (1)   64590001
646000             SET DP013-DB2-ABEND        TO TRUE                   64600001
646100             PERFORM 9999-ABEND                                   64610001
646200     END-EVALUATE.                                                64620001
646300                                                                  64630001
646400/                                                                 64640001
646500 8060-UPDATE-HDR-REC.                                             64650001
646600                                                                  64660001
646700     MOVE '8060-UPDATE-HDR-REC'  TO WS001-PARAGRAPH-NAME.         64670001
646800                                                                  64680001
646900     EXEC SQL                                                     64690001
647000          UPDATE WST_SHPMT_XREF_HDR                               64700001
647100             SET DWNLD_CDE        = 'C'                           64710001
647200             WHERE EXT_SHP_ID     = :DK-EXT-SHP-ID                64720001
647300     END-EXEC.                                                    64730001
647400                                                                  64740001
647500     EVALUATE TRUE                                                64750001
647600         WHEN SQLCODE = ZERO                                      64760001
647700             IF PS-CICS-SWITCH-YES                                64770001
647800                 INITIALIZE PV-CICS-MSG-AREA                      64780001
647900                 STRING   ' ' WS001-SRC-TASK-NUMBER               64790001
648000                          ' WSKCS305-8060:'                       64800001
648100                          ' UPDATE WST_SHPMT_XREF_HDR'            64810001
648200                          ' FOR SHPMT='                           64820001
648300                          DK-EXT-SHP-ID                           64830001
648400                          DELIMITED BY SIZE                       64840001
648500                          INTO PV-CICS-MSG-AREA                   64850001
648600                 PERFORM 7000-WRITE-TO-CICS-LOG                   64860001
648700             END-IF                                               64870001
648800         WHEN SQLCODE = -904                                      64880001
648900         WHEN SQLCODE = -913                                      64890001
649000         WHEN SQLCODE = -911                                      64900001
649100              CONTINUE                                            64910001
649200         WHEN SQLWARN0 NOT = SPACES                               64920001
649300         WHEN SQLCODE NOT = ZERO                                  64930001
649400             INITIALIZE PV-CICS-MSG-AREA                          64940001
649500             MOVE SQLCODE               TO PV-SQL-RETURN-CD       64950001
649600             STRING   ' ' WS001-SRC-TASK-NUMBER                   64960001
649700                      ' WSKCS305-8060 ERROR:'                     64970001
649800                      ' SQL='                                     64980001
649900                      PV-SQL-RETURN-CD                            64990001
650000                      DELIMITED BY SIZE                           65000001
650100                      INTO PV-CICS-MSG-AREA                       65010001
650200             PERFORM 7000-WRITE-TO-CICS-LOG                       65020001
650300                                                                  65030001
650400             SET WS001-INVALID-SQL      TO TRUE                   65040001
650500             STRING 'SQL='                                        65050001
650600                  PV-SQL-RETURN-CD                                65060001
650700                  DELIMITED BY SIZE                               65070001
650800                                      INTO WS001-CRA-RET-MSG      65080001
650900             MOVE WS001-CRA-RET-MSG     TO DP013-MESSAGE-TEXT(1)  65090001
651000             MOVE SQLCA                 TO WS001-SQLCA            65100001
651100                                           DP013-SQLCA            65110001
651200             MOVE WS001-PARAGRAPH-NAME  TO DP013-PARAGRAPH        65120001
651300             MOVE 'WST_SHPMT_XREF_HDR'  TO                        65130001
651400                                       DP013-DB2-TABLE-NAME (1)   65140001
651500             SET DP013-DB2-ABEND        TO TRUE                   65150001
651600             PERFORM 9999-ABEND                                   65160001
651700     END-EVALUATE.                                                65170001
651800                                                                  65180001
651900/                                                                 65190001
652000***************************************************************   65200001
652100*   STANDARD RETURN ROUTINE                                       65210001
652200***************************************************************   65220001
652300 9990-RETURN.                                                     65230001
652400                                                                  65240001
652500     INITIALIZE PV-CICS-MSG-AREA.                                 65250001
652600     STRING   ' ' WS001-SRC-TASK-NUMBER                           65260001
652700              ' EXITING WSKCS305'                                 65270001
652800              DELIMITED BY SIZE                                   65280001
652900                                 INTO PV-CICS-MSG-AREA.           65290001
653000     PERFORM 7000-WRITE-TO-CICS-LOG.                              65300001
653100                                                                  65310001
653200     EXEC CICS                                                    65320001
653300         RETURN                                                   65330001
653400     END-EXEC.                                                    65340001
653500                                                                  65350001
653600                                                                  65360001
653700***************************************************************   65370001
653800*   STANDARD ABEND ROUTINE                                        65380001
653900* ==> PROCESSES:                                                  65390001
654000*   - ISSUES THE ABEND.                                           65400001
654100***************************************************************   65410001
654200 9999-ABEND.                                                      65420001
654300     MOVE WS001-FIELDS                TO DFHCOMMAREA.             65430001
654400     MOVE 'WSKCS305'                  TO DP013-PROGRAM.           65440001
654500     MOVE DFHEIBLK                    TO DP013-DFHEIBLK.          65450001
654600     INITIALIZE DP013-SRC-TASK-NUMBER                             65460001
654700                DP013-STACK.                                      65470001
654800     SET DP013-LINK-RETURN TO TRUE.                               65480001
654900     SET DP013-ROLLBACK    TO TRUE.                               65490001
655000                                                                  65500001
655100     EXEC CICS                                                    65510001
655200         LINK                                                     65520001
655300             PROGRAM  (DP013-NAME)                                65530001
655400             COMMAREA (DP013-PARAMETERS)                          65540001
655500             LENGTH   (DP013-LENGTH)                              65550001
655600     END-EXEC.                                                    65560001
655700                                                                  65570001
655800     PERFORM 9990-RETURN.                                         65580001
655900                                                                  65590001
