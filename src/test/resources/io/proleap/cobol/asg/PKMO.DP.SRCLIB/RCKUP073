000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400                                                                  00040000
000500 PROGRAM-ID.      RCKUP073.                                       00050000
000600 AUTHOR.          DENISE HAHN.                                    00060000
000700 DATE-WRITTEN.    FEBRUARY 2022.                                  00070000
000800                                                                  00080000
000900*---------------------------------------------------------------* 00090000
001000* THIS PROGRAM READS AN INPUT FILE.                               00100000
001100* THE FILE WILL CONTAIN THE RECEIVER / P.O INFO.                  00110000
001200*                                                                 00120000
001300* THIS PROGRAM WILL RETRIEVE THE ORDER LINES AND THEN PASS THE    00130000
001400* 3 KEY FIELDS (PO-NBR-RCVR-SEQ-NBR-LINE) TO                      00140001
001500* PCKUP759 WHICH WILL THEN PERFORM INSERTS INTO THE WF LOAD       00150000
001600* CONTROL AND XFER TABLES WHICH WILL NOTIFY RMS THAT              00160000
001700* THE 3WD VERIFIED RECEIVERS HAVE BEEN GENERATED.                 00170001
001800*                                                                 00180000
001904*---------------------------------------------------------------* 00190400
001905 ENVIRONMENT DIVISION.                                            00190500
001906 CONFIGURATION SECTION.                                           00190600
001907                                                                  00190700
001908 SOURCE-COMPUTER. IBM-3090.                                       00190800
001909 OBJECT-COMPUTER. IBM-3090.                                       00190900
001910                                                                  00191000
001920 INPUT-OUTPUT SECTION.                                            00192000
001930 FILE-CONTROL.                                                    00193000
001940                                                                  00194000
001950 DATA DIVISION.                                                   00195000
001960                                                                  00196000
001970 FILE SECTION.                                                    00197000
001980                                                                  00198000
001990                                                                  00199000
002000 WORKING-STORAGE SECTION.                                         00200000
002100                                                                  00210000
002200 01  ABEND-CODE                  PIC S9(04)     VALUE +0  COMP.   00220000
002300                                                                  00230000
002400 01  PROGRAM-CONSTANTS.                                           00240000
002500     05  PC-MAX-RETRIES          PIC S9(04)     VALUE +3          00250000
002600                                                COMP SYNC.        00260000
002700     05  PC-MAX-DEADLOCKS        PIC S9(04)     VALUE +3          00270000
002800                                                COMP SYNC.        00280000
002900     05  PC-CKPT-JOB-NAME        PIC  X(08)     VALUE 'RCK016'.   00290000
003000     05  PC-CKPT-PLAN-NAME       PIC  X(08)     VALUE 'RCKUP073'. 00300000
003100                                                                  00310000
003200     05  PC-PCKUP759-PROGRAM     PIC  X(08)     VALUE 'PCKUP759'. 00320000
003300                                                                  00330000
003400     05  PC-TRAN-PRES-FUNC-CODES.                                 00340000
003500         10  PC-TRAN-PRES-FUNC-OPEN   PIC  X(05)  VALUE 'OPEN '.  00350000
003600         10  PC-TRAN-PRES-FUNC-TRANS  PIC  X(05)  VALUE 'TRANS'.  00360000
003700         10  PC-TRAN-PRES-FUNC-RSTRT  PIC  X(05)  VALUE 'RSTRT'.  00370000
003800         10  PC-TRAN-PRES-FUNC-CLOSE  PIC  X(05)  VALUE 'CLOSE'.  00380000
003900                                                                  00390000
004000******************************************************************00400000
004100*PV - PROGRAM VARIABLES                                           00410000
004200******************************************************************00420000
004300 01  PROGRAM-VARIABLES.                                           00430000
004400     05  PV-DEADLOCK-COUNTER          PIC  9(03)   VALUE ZERO.    00440000
004500     05  PV-PARAGRAPH-NAME            PIC  X(30)   VALUE SPACE.   00450000
004600     05  PV-DB2-OPER-ATTEMPTED        PIC  X(30)   VALUE SPACE.   00460000
004700     05  PV-DISP-SQLCODE              PIC -9(09)   VALUE ZERO.    00470000
004800                                                                  00480000
004900******************************************************************00490000
005000*PS - PROGRAM SWITCHES                                            00500000
005100******************************************************************00510000
005200 01  PROGRAM-SWITCHES.                                            00520000
005300     05  PS-RESTART-REQUIRED-SW         PIC X   VALUE 'N'.        00530000
005400         88  PS-RESTART-REQUIRED                VALUE 'Y'.        00540000
005500         88  PS-RESTART-NOT-REQUIRED            VALUE 'N'.        00550000
005600     05  PS-END-OF-ORDER-LINE-CSR-SW    PIC X   VALUE 'N'.        00560000
005700         88  PS-NOT-END-OF-ORDER-LINE-CSR       VALUE 'N'.        00570000
005800         88  PS-END-OF-ORDER-LINE-CSR           VALUE 'Y'.        00580000
005900                                                                  00590000
006000 01  AC-ABEND-CODE                      PIC S9(04) VALUE ZERO     00600000
006100                                                  COMP SYNC.      00610000
006200     88  AC-CONTROL-CARD-ERROR                    VALUE +4003.    00620000
006300     88  AC-DB2-ERROR                             VALUE +4013.    00630000
006400     88  AC-CALENDAR-ROUTINE-ERROR                VALUE +4019.    00640000
006500     88  AC-TOTALS-ERROR                          VALUE +4020.    00650000
006600                                                                  00660000
006700 01  PC-PROGRAM-CONSTANTS.                                        00670000
006800     05  PC-CURRENT-PROGRAM-NAME      PIC X(08)      VALUE        00680000
006900         'RCKUP073'.                                              00690000
007000     05  PC-PROGRAM-ABEND-MESSAGE     PIC X(11)      VALUE        00700000
007100         '** ABEND **'.                                           00710000
007200                                                                  00720000
007300******************************************************************00730000
007400*    STANDARD DB2 ERROR HANDLING AREA                            *00740000
007500******************************************************************00750000
007600     COPY DPWS004.                                                00760000
007700                                                                  00770000
007800                                                                  00780000
007900******************************************************************00790000
008000*  COMMUNICATIONS AREA FOR DB2                                    00800000
008100******************************************************************00810000
008200     EXEC SQL                                                     00820000
008300          INCLUDE SQLCA                                           00830000
008400     END-EXEC.                                                    00840000
008500                                                                  00850000
008600******************************************************************00860000
008700*  SQL COMMUNICATIONS WORK AREA                                  *00870000
008800******************************************************************00880000
008900     COPY SQLCA2.                                                 00890000
009000                                                                  00900000
009100******************************************************************00910000
009200*    DB2 AREA FOR RECEIVER ITEM TABLE                           * 00920000
009300******************************************************************00930000
009400     EXEC SQL                                                     00940000
009500          INCLUDE TRECITM                                         00950000
009600     END-EXEC.                                                    00960000
009700                                                                  00970000
009710******************************************************************00971002
009720*    DB2 AREA FOR RECEIVER TABLE                                * 00972002
009730******************************************************************00973002
009740     EXEC SQL                                                     00974002
009750          INCLUDE TRECEIV                                         00975002
009760     END-EXEC.                                                    00976002
009770                                                                  00977002
009780******************************************************************00978002
009790*    DB2 AREA FOR XLT_LOC TABLE                                 * 00979002
009791******************************************************************00979102
009792     EXEC SQL                                                     00979202
009793          INCLUDE XLT00010                                        00979302
009794     END-EXEC.                                                    00979402
009795                                                                  00979502
009800***************************************************************** 00980000
009900*  ORDER LINE CURSOR                                              00990000
010000***************************************************************** 01000000
010100     EXEC SQL                                                     01010000
010200       DECLARE ORDER-LINE-CSR CURSOR FOR                          01020000
010300         SELECT A.ORD_LNE_NBR                                     01030000
010400              , A.PREPK_ID                                        01040000
010500              , A.PREPK_DRV_LNE_CDE                               01050000
010510              , C.LOC_TYP_CDE                                     01051002
010600          FROM  TRECITM A                                         01060000
010610             ,  TRECEIV B                                         01061002
010620             ,  XLT_LOC C                                         01062002
010700          WHERE A.ORD_NBR        = :RECITM-ORD-NBR                01070000
010800            AND A.REC_SEQ_NBR    = :RECITM-REC-SEQ-NBR            01080000
010900            AND A.VER_STATUS_CDE = 'A'                            01090000
010910            AND B.ORD_NBR        = A.ORD_NBR                      01091002
010911            AND B.REC_SEQ_NBR    = A.REC_SEQ_NBR                  01091103
010920            AND C.LOC_NBR        = B.CURR_OPER_UNT_ID             01092002
011000       ORDER BY A.ORD_LNE_NBR                                     01100000
011100     END-EXEC                                                     01110000
011200                                                                  01120000
011300                                                                  01130000
011400******************************************************************01140000
011500*  LAYOUT FOR INPUT FILE                                          01150000
011600******************************************************************01160000
011700     COPY RCRD095.                                                01170000
011800                                                                  01180000
011900******************************************************************01190000
012000* COMMAREA USED WHEN CALLING PROGRAM PCKUP759                     01200000
012100******************************************************************01210000
012200     COPY PCWS238.                                                01220000
012300                                                                  01230000
012400******************************************************************01240000
012500*  TRANSACTION PREPARATION MODULE COMMUNICATIONS AREA            *01250000
012600******************************************************************01260000
012700     COPY DPWS991.                                                01270000
012800                                                                  01280000
012900     COPY DPLS001.                                                01290000
013000     05  WORK-STORAGE-PASSED.                                     01300000
013100******************************************************************01310000
013200*PA - PROGRAM ACCUMULATORS                                        01320000
013300******************************************************************01330000
013400         10  PROGRAM-ACCUMULATORS.                                01340000
013500             15  PA-RECORDS-READ           PIC S9(7)              01350000
013600                                           VALUE +0  COMP-3.      01360000
013700             15  PA-SUBROUTINE-CALLED      PIC S9(7)              01370000
013800                                           VALUE +0  COMP-3.      01380000
013900             15  PA-CHECKPOINTS-TAKEN      PIC S9(7)              01390000
014000                                           VALUE +0  COMP-3.      01400000
014100                                                                  01410000
014200  01  FILLER                          PIC X(4096)  VALUE SPACE.   01420000
014300                                                                  01430000
014400*---------------------------------------------------------------* 01440000
014500 PROCEDURE DIVISION.                                              01450000
014600*---------------------------------------------------------------* 01460000
014700                                                                  01470000
014800 A100-MAINLINE.                                                   01480000
014900                                                                  01490000
015000     PERFORM B100-INITIALIZE.                                     01500000
015100                                                                  01510000
015200     PERFORM B200-PROCESS-INPUT-RECORDS                           01520000
015300        UNTIL DP001-PREP-TRANS-EOF.                               01530000
015400                                                                  01540000
015500     PERFORM B300-EOJ-ROUTINE.                                    01550000
015600                                                                  01560000
015700     GOBACK.                                                      01570000
015800                                                                  01580000
015900******************************************************************01590000
016000*     B100-INITIALIZE                                            *01600000
016100* - GET FIRST INPUT RECORD FROM TRANS PREP MODULE                *01610000
016200******************************************************************01620000
016300 B100-INITIALIZE.                                                 01630000
016400                                                                  01640000
016500     MOVE PC-TRAN-PRES-FUNC-OPEN TO DP001-FUNC-CODE.              01650000
016600     PERFORM Z100-BUILD-COMM-AREA-TRAN-PRES.                      01660000
016700                                                                  01670000
016800******************************************************************01680000
016900*     B200-PROCESS-INPUT-RECORDS                                 *01690000
017000* - INITIALIZE PC238 FIELDS AFTER EACH CALL TO PCKUP759          *01700000
017100* - PROCESS ALL INPUT RECORDS UNTIL END OF FILE                  *01710000
017200* - FOR EACH INPUT RECORD, READ AND PROCESS ALL ORDER LINES      *01720000
017300* - CHECK TO SEE IF THIS IS A NORMAL OR RESTART RUN              *01730000
017400******************************************************************01740000
017500 B200-PROCESS-INPUT-RECORDS.                                      01750000
017600                                                                  01760000
017700     SET PS-RESTART-NOT-REQUIRED TO TRUE.                         01770000
017800                                                                  01780000
017900     INITIALIZE PC238-COMM-AREA.                                  01790000
018000     SET PC238-TRANS-LINE-VERIFY      TO TRUE.                    01800000
018100**   SET PC238-DRIVE-LINE             TO TRUE.                    01810000
018110                                                                  01811002
018400     MOVE RC095-PO-NBR       TO   RECITM-ORD-NBR                  01840000
018500                                  PC238-PO-NBR.                   01850000
018600     MOVE RC095-REC-SEQ-NBR  TO   RECITM-REC-SEQ-NBR              01860000
018700                                  PC238-RCVR-SEQ-NBR.             01870000
018800                                                                  01880000
018900     SET PS-NOT-END-OF-ORDER-LINE-CSR TO TRUE.                    01890000
019000                                                                  01900000
019100     PERFORM C100-OPEN-ORDER-LINE-CSR.                            01910000
019200                                                                  01920000
019300     PERFORM C200-PROCESS-ORDER-LINE                              01930000
019400         UNTIL PS-END-OF-ORDER-LINE-CSR.                          01940000
019500                                                                  01950000
019600     PERFORM C300-CLOSE-ORDER-LINE-CSR.                           01960000
019700                                                                  01970000
019800                                                                  01980000
019900*----------------------------------------------------------------*01990000
020000*  IF A RESTART IS REQUIRED, ISSUE A RESTART CALL RATHER THAN A  *02000000
020100*  TRANS CALL.  THIS WILL ALLOW PROCESSING TO RESUME WITH THE    *02010000
020200*  FIRST TRANSACTION AFTER THE LAST COMMIT.                      *02020000
020300*----------------------------------------------------------------*02030000
020400     IF PS-RESTART-REQUIRED                                       02040000
020500         MOVE PC-TRAN-PRES-FUNC-RSTRT TO DP001-FUNC-CODE          02050000
020600     ELSE                                                         02060000
020700         MOVE PC-TRAN-PRES-FUNC-TRANS TO DP001-FUNC-CODE          02070000
020800     END-IF.                                                      02080000
020900                                                                  02090000
021000     PERFORM Z100-BUILD-COMM-AREA-TRAN-PRES.                      02100000
021100                                                                  02110000
021200******************************************************************02120000
021300*     B300-EOJ-ROUTINE                                           *02130000
021400* - CLOSE THE TRANS PREP PROCESS                                 *02140000
021500* - DISPLAY PROGRAM COUNTS                                       *02150000
021600******************************************************************02160000
021700 B300-EOJ-ROUTINE.                                                02170000
021800                                                                  02180000
021900     MOVE PC-TRAN-PRES-FUNC-CLOSE TO DP001-FUNC-CODE.             02190000
022000     PERFORM Z100-BUILD-COMM-AREA-TRAN-PRES.                      02200000
022100                                                                  02210000
022200     DISPLAY 'RECORDS READ         = ' PA-RECORDS-READ.           02220000
022300     DISPLAY 'CALLS TO PCKUP759    = ' PA-SUBROUTINE-CALLED.      02230000
022400     DISPLAY 'CHECKPOINTS TAKEN    = ' PA-CHECKPOINTS-TAKEN.      02240000
022500                                                                  02250000
022600                                                                  02260000
022700******************************************************************02270000
022800*     C100-OPEN-ORDER-LINE-CSR                                   *02280000
022900******************************************************************02290000
023000 C100-OPEN-ORDER-LINE-CSR.                                        02300000
023100     EXEC SQL                                                     02310000
023200          OPEN ORDER-LINE-CSR                                     02320000
023300     END-EXEC.                                                    02330000
023400                                                                  02340000
023500     EVALUATE TRUE                                                02350000
023600         WHEN SQLCODE = ZERO                                      02360000
023700              CONTINUE                                            02370000
023800         WHEN OTHER                                               02380000
023900             MOVE SQLCODE                TO PV-DISP-SQLCODE       02390000
024000             MOVE 'C100-OPEN-ORDER-LINE-CSR'                      02400000
024100                                         TO PV-PARAGRAPH-NAME     02410000
024200             MOVE 'TRECITM         '     TO PV-DB2-OPER-ATTEMPTED 02420000
024300             PERFORM Z900-SQL-ABEND                               02430000
024400     END-EVALUATE.                                                02440000
024500                                                                  02450000
024600                                                                  02460000
024700******************************************************************02470000
024800*     C200-PROCESS-ORDER-LINE                                    *02480000
024900*     FOR PREPACKS (PREPK-ID > 0), ONLY CALL PCKUP759 FOR THE    *02490000
025000*     PREPACK DRIVER LINE (PREPK-DRV-LNE-CDE = 'A'), NOT FOR     *02500000
025100*     EACH OF THE PREPACK SKUS TO AVOID DUPLICATE UPDATING.      *02510000
025200******************************************************************02520000
025300 C200-PROCESS-ORDER-LINE.                                         02530000
025400                                                                  02540000
025500     EXEC SQL                                                     02550000
025600          FETCH ORDER-LINE-CSR                                    02560000
025700           INTO :RECITM-ORD-LNE-NBR                               02570000
025800              , :RECITM-PREPK-ID                                  02580000
025900              , :RECITM-PREPK-DRV-LNE-CDE                         02590000
025910              , :XLT00010-LOC-TYP-CDE                             02591002
026000     END-EXEC.                                                    02600000
026100                                                                  02610000
026200     EVALUATE TRUE                                                02620000
026300         WHEN SQLCODE = ZERO                                      02630000
026400             IF (RECITM-PREPK-ID = 0)                             02640000
026500             OR (RECITM-PREPK-DRV-LNE-CDE = 'A')                  02650000
026600                 MOVE RECITM-ORD-LNE-NBR  TO PC238-PO-LNE-NBR     02660000
026700                 MOVE RECITM-PREPK-DRV-LNE-CDE                    02670000
026800                                      TO PC238-VRFY-ADJ-DRIVE-LNE 02680000
026810                 IF  XLT00010-LOC-TYP-CDE  = 'DC'                 02681004
026820                     SET PC238-DIRECT-STORE-NO    TO TRUE         02682004
026830                 ELSE                                             02683004
026840                     SET PC238-DIRECT-STORE-YES   TO TRUE         02684004
026850                 END-IF                                           02685004
026900                 PERFORM C400-CALL-PCKUP759                       02690000
027000             END-IF                                               02700000
027100                                                                  02710000
027200         WHEN SQLCODE = +100                                      02720000
027300             SET PS-END-OF-ORDER-LINE-CSR TO TRUE                 02730000
027400         WHEN OTHER                                               02740000
027500             MOVE SQLCODE                TO PV-DISP-SQLCODE       02750000
027600             MOVE 'C200-PROCESS-ORDER-LINE'                       02760000
027700                                         TO PV-PARAGRAPH-NAME     02770000
027800             MOVE 'TRECITM         '     TO PV-DB2-OPER-ATTEMPTED 02780000
027900             PERFORM Z900-SQL-ABEND                               02790000
028000     END-EVALUATE.                                                02800000
028100                                                                  02810000
028200                                                                  02820000
028300******************************************************************02830000
028400*     C300-CLOSE-ORDER-LINE-CSR                                  *02840000
028500******************************************************************02850000
028600 C300-CLOSE-ORDER-LINE-CSR.                                       02860000
028700     EXEC SQL                                                     02870000
028800          CLOSE ORDER-LINE-CSR                                    02880000
028900     END-EXEC.                                                    02890000
029000                                                                  02900000
029100     EVALUATE TRUE                                                02910000
029200         WHEN SQLCODE = ZERO                                      02920000
029300              CONTINUE                                            02930000
029400         WHEN OTHER                                               02940000
029500             MOVE SQLCODE                TO PV-DISP-SQLCODE       02950000
029600             MOVE 'C300-CLOSE-ORDER-LINE-CSR'                     02960000
029700                                         TO PV-PARAGRAPH-NAME     02970000
029800             MOVE 'TRECITM         '     TO PV-DB2-OPER-ATTEMPTED 02980000
029900             PERFORM Z900-SQL-ABEND                               02990000
030000     END-EVALUATE.                                                03000000
030100                                                                  03010000
030200                                                                  03020000
030300******************************************************************03030000
030400*   C400-CALL-PCKUP759.                                           03040000
030500******************************************************************03050000
030600* - NEED TO PERFORM THIS PARAGRAPH ONCE FOR EACH:                 03060000
030700*    P.O. / ORDER LINE / RECEIVER SEQUENCE NUMBER.                03070000
030800* - CALL PCKUP759 WHICH IS A BATCH COPY OF PCKCS759 TO INSERT     03080000
030900*   TO THE WF LOD CNTL AND XFER TABLES.                           03090000
031000******************************************************************03100000
031100 C400-CALL-PCKUP759.                                              03110000
031200                                                                  03120000
031300     CALL PC-PCKUP759-PROGRAM  USING  PC238-COMM-AREA.            03130000
031400                                                                  03140000
031500     ADD  +1               TO PA-SUBROUTINE-CALLED.               03150000
031600                                                                  03160000
031700     EVALUATE TRUE                                                03170000
031800       WHEN PC238-MOD-SUCCESSFUL                                  03180000
031900             CONTINUE                                             03190000
032000                                                                  03200000
032100       WHEN OTHER                                                 03210000
032200             DISPLAY ' RCKUP073 ABENDING -'                       03220000
032300                     ' UNSUCCESSFUL CALL TO PCKUP759'             03230000
032400                                                                  03240000
032500             DISPLAY ' AT INPUT RECORD = '  PA-RECORDS-READ       03250000
032600             DISPLAY ' PO NBR          = '  RC095-PO-NBR          03260000
032700             DISPLAY ' RCVR SEQ NBR    = '  RC095-REC-SEQ-NBR     03270000
032800             DISPLAY ' PO-LINE-NBR     = '  RECITM-ORD-LNE-NBR    03280000
032900             DISPLAY ' PC238-COMM-AREA = '  PC238-COMM-AREA       03290000
033000                                                                  03300000
033100             MOVE PC238-BAD-SQL-CDE      TO PV-DISP-SQLCODE       03310000
033200                                            SQLCODE               03320000
033300             MOVE 'C400-CALL-PCKUP759'   TO PV-PARAGRAPH-NAME     03330000
033400             STRING PC238-BAD-TABLE-FUNCTION ' '                  03340000
033500                    PC238-BAD-TABLE-NAME                          03350000
033600               DELIMITED BY SIZE                                  03360000
033700               INTO PV-DB2-OPER-ATTEMPTED                         03370000
033800             PERFORM Z900-SQL-ABEND                               03380000
033900                                                                  03390000
034000     END-EVALUATE.                                                03400000
034100                                                                  03410000
034200                                                                  03420000
034300******************************************************************03430000
034400*   Z100-BUILD-COMM-AREA-TRAN-PRES                               *03440000
034500******************************************************************03450000
034600* - BUILD THE COMMUNICATION AREA FOR A CALL TO THE TRANSACTION   *03460000
034700*   PRESENTATION MODULE (GET THE NEXT INPUT RECORD)              *03470000
034800******************************************************************03480000
034900 Z100-BUILD-COMM-AREA-TRAN-PRES.                                  03490000
035000                                                                  03500000
035100     MOVE LENGTH OF WORK-STORAGE-PASSED                           03510000
035200                                       TO DP001-WORK-STRG-LENGTH. 03520000
035300     MOVE PC-CKPT-JOB-NAME             TO DP001-JOB-NAME.         03530000
035400     MOVE PC-CKPT-PLAN-NAME            TO DP001-PLAN-NAME.        03540000
035500     PERFORM Z900-CALL-TRANS-PRES-MODULE.                         03550000
035600     MOVE DP001-TRANS-RECORD           TO RC095-TRKG-REC.         03560000
035700                                                                  03570000
035800     IF DP001-CKPT-TAKEN                                          03580000
035900         INITIALIZE PV-DEADLOCK-COUNTER                           03590000
036000         ADD +1 TO  PA-CHECKPOINTS-TAKEN                          03600000
036100     END-IF.                                                      03610000
036200                                                                  03620000
036300     IF NOT DP001-PREP-TRANS-EOF                                  03630000
036400         ADD +1 TO  PA-RECORDS-READ                               03640000
036500     END-IF.                                                      03650000
036600                                                                  03660000
036700**   THE FOLLOWING CODE FORCES AN ABEND SO THAT CHECKPOINT        03670000
036800**   RESTART PROCESSING CAN BE TESTED.                            03680000
036900*    IF RC095-TRKG-NBR  = 'ABEND'                                 03690000
037000*        MOVE SQLCODE                TO PV-DISP-SQLCODE           03700000
037100*        MOVE 'Z100- TESTING CHKPT RESTART'                       03710000
037200*                                    TO PV-PARAGRAPH-NAME         03720000
037300*        MOVE 'COMMENT ABEND AND RESTART'                         03730000
037400*                                    TO PV-DB2-OPER-ATTEMPTED     03740000
037500*        PERFORM Z900-SQL-ABEND.                                  03750000
037600                                                                  03760000
037700******************************************************************03770000
037800*   Z900-SQL-ABEND                                               *03780000
037900******************************************************************03790000
038000* - ABEND THE PROGRAM IN THE EVENT THAT A SQL ERROR OR WARNING   *03800000
038100*   CODE OCCURS.                                                 *03810000
038200******************************************************************03820000
038300 Z900-SQL-ABEND.                                                  03830000
038400                                                                  03840000
038500     DISPLAY '**********************************************'.    03850000
038600     DISPLAY '** ABEND       **'.                                 03860000
038700     DISPLAY '** PROGRAM     ** = ' PC-CURRENT-PROGRAM-NAME.      03870000
038800     DISPLAY '** PARAGRAPH   ** = ' PV-PARAGRAPH-NAME.            03880000
038900     DISPLAY '** OPERATION   ** = ' PV-DB2-OPER-ATTEMPTED.        03890000
039000     DISPLAY '** SQLCODE     ** = ' PV-DISP-SQLCODE.              03900000
039100     DISPLAY '**********************************************'.    03910000
039200     DISPLAY '** PO NBR      ** = ' RC095-PO-NBR.                 03920000
039300     DISPLAY '** PO LINE NBR ** = ' RECITM-ORD-LNE-NBR.           03930000
039400     DISPLAY '** RECV SEQ    ** = ' RC095-REC-SEQ-NBR.            03940000
039500     DISPLAY '** STORE       ** = ' RC095-STR-NBR.                03950000
039600     DISPLAY '**********************************************'.    03960000
039700                                                                  03970000
039800                                                                  03980000
039900***************************************************************** 03990000
040000* COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     04000000
040100* TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      04010000
040200***************************************************************** 04020000
040300     COPY DPPD004.                                                04030000
040400                                                                  04040000
040500     MOVE +4013 TO ABEND-CODE.                                    04050000
040600     CALL 'ILBOABN0' USING ABEND-CODE.                            04060000
040700                                                                  04070000
040800******************************************************************04080000
040900*  THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-  *04090000
041000*  MENTS THAT ARE REQUIRED TO INVOKE THE TRANSACTION PRESENTATION*04100000
041100*  MODULE (DPKUT901) OF THE DB2 CHECKPOINT RESTART SYSTEM.       *04110000
041200******************************************************************04120000
041300     COPY DPPD001.                                                04130000
