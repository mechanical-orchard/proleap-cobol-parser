000100*-----------------------*                                         00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000210*-----------------------*                                         00021001
000220 PROGRAM-ID.    CNKCS243.                                         00022001
000230 AUTHOR.        DENISE HAHN.                                      00023001
000240 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00024001
000250 DATE-WRITTEN.  NOV 2016.                                         00025001
000260 DATE-COMPILED.                                                   00026001
000270*----------------------------------------------------------------*00027001
000280*    Y243 - DC-INTEGRATION PARAMETERS AND FUNCTION CRIT SPEC     *00028019
000290*                                                                *00029001
000300*    THIS PROGRAM ALLOWS THE USER TO ENTER DATA TO BE USED BY    *00030001
000400*    SUBSEQUENT PROGRAMS.  FROM THIS SCREEN THE USER CAN PRESS:  *00040001
000410*                                                                *00041001
000500*    F13 TO ADD A CODE TO WST_INTGRTN_TYP                        *00050001
000600*    F15 TO UPDATE A CODE TO WST_INTGRTN_TYP                     *00060001
000700*    F17 TO ADD A PARM TO WST_ATTR_DEFN                          *00070001
000720*    F22 TO DISPLAY A LIST OF CODES FROM WST_INTGRTN_TYP         *00072001
000730*    F23 TO DISPLAY A LIST OF PARMS FROM WST_ATTR_DEFN           *00073001
000731*    F24 TO DISPLAY A LIST OF PARMS FROM WST_ATTR_ELEM           *00073101
000740*----------------------------------------------------------------*00074001
263455* CHANGED 11/03/2021    BY JIM HUNTER      WR: CHG0263455         00074130
263455* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00074230
263455* MAKING THE CALL DYNAMIC VS STATIC.                              00074330
263455*----------------------------------------------------------------*00074430
CICS  * CHANGED 10/25/2022    BY JIM HUNTER      WR: CHG0276961         00074531
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00074631
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00074731
CICS  *-----------------------------------------------------------------00074831
000750 ENVIRONMENT DIVISION.                                            00075001
000760 DATA DIVISION.                                                   00076001
000770                                                                  00077001
000780 WORKING-STORAGE SECTION.                                         00078001
000790                                                                  00079001
000800 01  DK-DB2-KEYS.                                                 00080001
000900     05  DK-OPER-UNT-ID            PIC S9(04) COMP VALUE +0.      00090001
001000     05  DK-PARM-NAME              PIC X(10)       VALUE SPACES.  00100001
001010     05  DK-ELEM-SEQ               PIC S9(10)V9(5) COMP-3.        00101021
001100                                                                  00110001
001200 01  PV-PROGRAM-VARIABLES.                                        00120001
001300     05  PV-CICS-RESPONSE          PIC S9(08)  VALUE ZEROES       00130001
001400                                   COMP SYNC.                     00140001
001500                                                                  00150001
001600     05  PV-RETRY-COUNTER                PIC S9(04)  VALUE +0     00160001
001700                                                    COMP SYNC.    00170001
001800                                                                  00180001
001900 01  PC-PROGRAM-CONSTANTS.                                        00190001
002000     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'CNK243'.   00200001
002100     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'CNKM243'.  00210001
002200     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'CNKCS243'. 00220001
002300     05  PC-REPORT-PGM-1           PIC  X(08)  VALUE  'CNKCS243'. 00230001
002400     05  PC-01                     PIC  X(02)  VALUE  '01'.       00240001
002500     05  PC-DC                     PIC  X(02)  VALUE  'DC'.       00250001
002600     05  PC-B                      PIC  X(01)  VALUE  'B'.        00260001
002700     05  PC-D                      PIC  X(01)  VALUE  'D'.        00270001
002800     05  PC-N                      PIC  X(01)  VALUE  'N'.        00280001
002900     05  PC-U                      PIC  X(01)  VALUE  'U'.        00290001
003000     05  PC-V                      PIC  X(01)  VALUE  'V'.        00300001
003100     05  PC-Y                      PIC  X(01)  VALUE  'Y'.        00310001
003200     05  PC-MAX-RETRIES            PIC S9(03)  VALUE 3            00320001
003300                                               COMP-3.            00330001
003400*                                                                 00340001
003500 01  PS-PROGRAM-SWITCHES.                                         00350001
003600     05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.        00360001
003700         88  PS-ERROR                          VALUE  'Y'.        00370001
003800         88  PS-NO-ERROR                       VALUE  'N'.        00380001
003900     05  PS-PARM-EXISTS-SW         PIC  X(01)  VALUE  'N'.        00390001
004000         88  PS-PARM-EXISTS                    VALUE  'Y'.        00400001
004100         88  PS-PARM-DOESNT-EXIST              VALUE  'N'.        00410001
004200                                                                  00420001
004300*----------------------------------------------------------------*00430001
004400*  SYSTEM MESSAGES                                               *00440001
004500*----------------------------------------------------------------*00450001
004600*   00005 - INVALID VALUE                                         00460001
004700*   00007 - REQUIRED ENTRY                                        00470001
004800*   00008 - MUST BE NUMERIC                                       00480001
004900*   02571 - UNABLE TO UPD - CURRENT OPER UNT AND OPER UNIT ID ENTE00490001
005000*   02572 - INVALID VALUE - OPER UNIT ID MUST BE A DC LOCATION    00500001
005100*   03707 - ADD FUNCTION INVALID - FUNCTION CODE ALREADY DEFINED F00510001
005200*   03708 - UPDATE FUNCTION INVALID - FUNCTION CODE IS CURRENTLY N00520001
005300*   03709 - ADD FUNCTION INVALID - PARM CODE ALREADY DEFINED FOR D00530001
005400*   03710 - UPDATE FUNCTION INVALID - PARM CODE IS CURRENTLY NOT D00540001
005500*   03721 - ADD PARM INVALID - CODE IS NOT DEFINED               *00550001
005510*   03722 - UPD PARM INVALID - CODE IS NOT DEFINED               *00551001
005520*   03723 - UPD PARM INVALID - PARM NOT DEFINED FOR FACILITY     *00552001
005521*   03801 - INVALID UPDATE-ELEM SEQ DOES NOT EXIST FOR PARM      *00552120
005530*----------------------------------------------------------------*00553001
005540 01  PC-TSYMSG-NUMBERS.                                           00554001
005550     05  PC-TSYMSG-00005       PIC  9(05)  VALUE  00005.          00555001
005560     05  PC-TSYMSG-00007       PIC  9(05)  VALUE  00007.          00556001
005570     05  PC-TSYMSG-00008       PIC  9(05)  VALUE  00008.          00557001
005580     05  PC-TSYMSG-02571       PIC  9(05)  VALUE  02571.          00558001
005590     05  PC-TSYMSG-02572       PIC  9(05)  VALUE  02572.          00559001
005900     05  PC-TSYMSG-03707       PIC  9(05)  VALUE  03707.          00590001
006000     05  PC-TSYMSG-03708       PIC  9(05)  VALUE  03708.          00600001
006100     05  PC-TSYMSG-03709       PIC  9(05)  VALUE  03709.          00610001
006200     05  PC-TSYMSG-03710       PIC  9(05)  VALUE  03710.          00620001
006300     05  PC-TSYMSG-03721       PIC  9(05)  VALUE  03721.          00630001
006400     05  PC-TSYMSG-03722       PIC  9(05)  VALUE  03722.          00640001
006500     05  PC-TSYMSG-03723       PIC  9(05)  VALUE  03723.          00650001
006510     05  PC-TSYMSG-03801       PIC  9(05)  VALUE  03801.          00651020
006600*                                                                 00660001
006700 01  PM-PROGRAM-MESSAGES.                                         00670001
006800     05  PM-ABEND-INFO-A.                                         00680001
006900         10  FILLER                PIC X(15)   VALUE              00690001
007000                                   'DP020-SRC-AID: '.             00700001
007100         10  PM-A-SRC-AID          PIC X(02)   VALUE  SPACE.      00710001
007200         10  FILLER                PIC X(19)   VALUE              00720001
007300                                   '. DP020-FK-ACTION: '.         00730001
007400         10  PM-A-FK-ACTION        PIC X(01)   VALUE  SPACE.      00740001
007500         10  FILLER                PIC X(22)   VALUE              00750001
007600                                   '. DP020-FK-DISPN-IND: '.      00760001
007700         10  PM-A-FK-DISPN         PIC X(01)   VALUE  SPACE.      00770001
007800         10  FILLER                PIC X(01)   VALUE '.'.         00780001
007900         10  FILLER                PIC X(19)   VALUE SPACE.       00790001
008000                                                                  00800001
008100*----------------------------------------------------------------*00810001
008200*    MAP LAYOUT                                                  *00820001
008300*----------------------------------------------------------------*00830001
008400     COPY CNKM243.                                                00840001
008500                                                                  00850001
008600*----------------------------------------------------------------*00860001
008700*    ATTRIBUTE SETTINGS COPYBOOK.                                *00870001
008800*----------------------------------------------------------------*00880001
008900     COPY DPWS015.                                                00890001
009000                                                                  00900001
009100*----------------------------------------------------------------*00910001
009200*    FUNCTION KEYS COPYBOOK                                      *00920001
009300*----------------------------------------------------------------*00930001
009400     COPY DPWS016.                                                00940001
009500                                                                  00950001
009600******************************************************************00960001
009700** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **00970001
009800** SUB-ROUTINE (DPKUT100).                                      **00980001
009900******************************************************************00990001
010000     COPY DPWS010I.                                               01000001
010100                                                                  01010001
010200******************************************************************01020001
010300** THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS            **01030001
010400** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **01040001
010500******************************************************************01050001
010600     COPY DPWS030.                                                01060001
CICS       COPY DPWS930.                                                01061031
010700                                                                  01070001
010800***************************************************************** 01080001
010900*    STANDARD COMMAREA.                                           01090001
011000***************************************************************** 01100001
011100     COPY DPWS020.                                                01110001
011200     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01120001
011300                                                                  01130001
011400***************************************************************** 01140001
011500*    INTER-APPLICATION COMMAREA.                                  01150001
011600***************************************************************** 01160001
011700         10  INTER-APPL-COMM-AREA PIC X(200).                     01170001
011800     COPY CNWS022.                                                01180001
011900                                                                  01190001
012000***************************************************************** 01200001
012100*    SPECIFIC COMMAREA FOR CNKCS243.                              01210001
012200***************************************************************** 01220001
012300         10  ASC-SPECIFIC-COMMAREA.                               01230001
012400             15  ASC-OPER-UNT-ID             PIC  X(04).          01240001
012500             15  ASC-OPER-UNT-ID-N REDEFINES ASC-OPER-UNT-ID      01250001
012600                                             PIC  9(04).          01260001
012700             15  ASC-OPER-UNT-NAME           PIC  X(25).          01270001
012800             15  ASC-FUNCTION                PIC  X(02).          01280001
012900                 88  ASC-ADD-PARM                  VALUE 'AP'.    01290006
013000                 88  ASC-UPD-PARM                  VALUE 'UP'.    01300006
013100                 88  ASC-ADD-DEFN                  VALUE 'AD'.    01310005
013300             15  ASC-PARM-NAME               PIC  X(10).          01330005
013400             15  ASC-PARM-DESC               PIC  X(50).          01340005
013500             15  ASC-PARM-FUNC               PIC  X(10).          01350005
013501* DMH 10/27/17 BEGIN                                              01350119
013510             15  ASC-ELEM-SEQ                PIC  X(09).          01351029
013520             15  ASC-ELEM-SEQ-N REDEFINES ASC-ELEM-SEQ            01352018
013530                                             PIC  9(09).          01353029
013540* DMH 10/27/17 END                                                01354019
013600             15  FILLER                      PIC  X(118).         01360018
013700                                                                  01370001
013800*----------------------------------------------------------------*01380001
013900*    ABEND PROCESSING COPYBOOK.                                  *01390001
014000*----------------------------------------------------------------*01400001
014100     COPY DPWS013.                                                01410001
014200                                                                  01420001
014300*----------------------------------------------------------------*01430001
014400*    INTEGRATION PARM ATTRIBUTE DEFINITION                        01440001
014500*----------------------------------------------------------------*01450001
014600     EXEC SQL                                                     01460001
014700          INCLUDE WST00009                                        01470001
014800     END-EXEC.                                                    01480001
014900                                                                  01490001
015000*----------------------------------------------------------------*01500001
015100*    INTEGRATION PARM TYPE CODE                                   01510001
015200*----------------------------------------------------------------*01520001
015300     EXEC SQL                                                     01530001
015400          INCLUDE WST00008                                        01540001
015500     END-EXEC.                                                    01550001
015600                                                                  01560001
015610*----------------------------------------------------------------*01561020
015620*    INTEGRATION PARM ELEMENT  WST_ATTR_ELEM                      01562020
015630*----------------------------------------------------------------*01563020
015640     EXEC SQL                                                     01564020
015650          INCLUDE WST00010                                        01565020
015660     END-EXEC.                                                    01566020
015670                                                                  01567020
015700*----------------------------------------------------------------*01570003
015800*    COMMAREA USED TO CALL XLKUT071                               01580003
015900*----------------------------------------------------------------*01590003
016000     COPY XLWS071.                                                01600003
016100                                                                  01610003
016200*----------------------------------------------------------------*01620001
016300*  COMMUNICATION AREAS FOR DB2                                    01630001
016400*----------------------------------------------------------------*01640001
016500     EXEC SQL                                                     01650001
016600         INCLUDE SQLCA                                            01660001
016700     END-EXEC.                                                    01670001
016800                                                                  01680001
016900*----------------------------------------------------------------*01690001
017000 LINKAGE SECTION.                                                 01700001
017100                                                                  01710001
017200 01  DFHCOMMAREA.                                                 01720001
017300     05  FILLER                         OCCURS  1 TO 4072 TIMES   01730001
017400                                        DEPENDING ON EIBCALEN.    01740001
017500         10  FILLER                     PIC X.                    01750001
017600                                                                  01760001
017700                                                                  01770001
017800 PROCEDURE DIVISION.                                              01780009
017900***************************************************************** 01790001
018000** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 01800001
018100** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 01810001
018200** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 01820001
018300**                                                             ** 01830001
018400** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 01840001
018500** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 01850001
018600***************************************************************** 01860001
018700 0000-MAIN-MODULE.                                                01870001
018800     INITIALIZE DP030-CICS-API-FIELDS.                            01880001
018900     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       01890001
019000     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          01900001
019100     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         01910001
019200     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       01920001
019300     MOVE LENGTH OF CNK243I       TO DP030-MAP-LENGTH (1).        01930001
019400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     01940001
019500     PERFORM 0001-CALL-CICS-ARCH-API.                             01950001
019600*                                                                 01960001
019700     PERFORM 1000-CONTROL-PROCESSING                              01970001
019800*                                                                 01980001
019900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     01990001
020000     PERFORM 0001-CALL-CICS-ARCH-API.                             02000001
020100                                                                  02010001
020200*---------------------------------------------------------------- 02020001
020300 0001-CALL-CICS-ARCH-API.                                         02030001
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      02040031
020500                                    DFHCOMMAREA                   02050031
020600                                    DP030-CICS-API-FIELDS         02060031
020700                                    DP020-STANDARD-COMMAREA       02070031
020800                                    CNK243I.                      02080031
020900*                                                                 02090001
021000     IF  DP030-RC-CALL-SUCCESSFUL                                 02100001
021100         CONTINUE                                                 02110001
021200     ELSE                                                         02120001
021300         SET DP013-NO-ROLLBACK                                    02130001
021400             DP013-XCTL-DISPLAY-RESTART                           02140001
021500             DP013-CICS-ABEND      TO TRUE                        02150001
021600         MOVE 'BEFORE 0000-MAIN-MODULE'                           02160001
021700                                   TO DP013-PARAGRAPH             02170001
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O02171031
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02172031
022000         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      02200001
022100         PERFORM DP013-0000-PROCESS-ABEND                         02210001
022200     END-IF.                                                      02220001
022300                                                                  02230001
022400*----------------------------------------------------------------*02240001
022500*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *02250001
022600*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *02260001
022700*----------------------------------------------------------------*02270001
022800 1000-CONTROL-PROCESSING.                                         02280001
022900                                                                  02290001
023000     EVALUATE TRUE                                                02300001
023100         WHEN DP020-NEXT-ACT-INITIAL                              02310001
023200             INITIALIZE ASC-SPECIFIC-COMMAREA                     02320001
023300             MOVE DP020-LOCATION-NBR TO ASC-OPER-UNT-ID           02330001
023400             PERFORM 4000-BUILD-INITIAL-PANEL                     02340001
023500             PERFORM 3200-RESET-ATTRIBUTES                        02350001
023600                                                                  02360001
023700         WHEN DP020-NEXT-ACT-RETURN                               02370001
023800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02380001
023900             PERFORM 3200-RESET-ATTRIBUTES                        02390001
024000                                                                  02400001
024100         WHEN DP020-NEXT-ACT-READ-MAP                             02410001
024200             PERFORM 2000-FKEY-PROCESSING                         02420001
024300                                                                  02430001
024400         WHEN OTHER                                               02440001
024500             SET DP013-LOGIC-ABEND                                02450001
024600                 DP013-NO-ROLLBACK TO TRUE                        02460001
024700             MOVE 'CNKCS243 - 1000-CONTROL-PROCESSING'            02470001
024800                                   TO  DP013-PARAGRAPH            02480001
024900             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   02490001
025000                                   TO  DP013-MESSAGE-TEXT(1)      02500001
025100             MOVE DP020-NEXT-APPL-ACTIVITY                        02510001
025200                                   TO DP013-MESSAGE-TEXT(2)       02520001
025300             PERFORM DP013-0000-PROCESS-ABEND                     02530001
025400     END-EVALUATE.                                                02540001
025500                                                                  02550001
025600*----------------------------------------------------------------*02560001
025700* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*02570001
025800* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*02580001
025900* EDITS.                                                         *02590001
026000*----------------------------------------------------------------*02600001
026100 2000-FKEY-PROCESSING.                                            02610001
026200                                                                  02620001
026300     EVALUATE TRUE                                                02630001
026400                                                                  02640001
026500         WHEN DP020-SRC-AID = DP016-CLEAR                         02650001
026600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02660001
026700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02670001
026800                                                                  02680001
026900*F5-REFRESH                                                       02690001
027000         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     02700001
027100             INITIALIZE ASC-SPECIFIC-COMMAREA                     02710001
027400             MOVE SPACES          TO APRMNMEO                     02740009
027500                                     APRMDSCO                     02750001
027600                                     APRMTYPO                     02760001
027700             MOVE DP020-LOCATION-NBR TO ASC-OPER-UNT-ID           02770001
027800             PERFORM 4000-BUILD-INITIAL-PANEL                     02780001
027900             PERFORM 3200-RESET-ATTRIBUTES                        02790001
028000                                                                  02800001
028100         WHEN OTHER                                               02810001
028200             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 02820001
028300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02830001
028400             IF  PS-NO-ERROR                                      02840001
028500                 SET DP030-CONTINUE-GO TO TRUE                    02850001
028600                 PERFORM 2100-CHECK-FUNCTION-KEY                  02860001
028700                 IF  PS-ERROR                                     02870001
028800                     SET DP030-OVERRIDE-GO TO TRUE                02880001
028900                 END-IF                                           02890001
029000             ELSE                                                 02900001
029100                 SET DP030-OVERRIDE-GO TO TRUE                    02910001
029200             END-IF                                               02920001
029300     END-EVALUATE.                                                02930001
029400                                                                  02940001
029500******************************************************************02950001
029600** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **02960001
029700** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **02970001
029800** FROM THE CICS ARCHITECTURE API.                              **02980001
029900******************************************************************02990001
030000 2100-CHECK-FUNCTION-KEY.                                         03000001
030100     EVALUATE TRUE                                                03010001
030200                                                                  03020001
030300         WHEN DP020-SRC-AID = DP016-ENTER                         03030001
030310               IF  ASC-PARM-NAME > SPACES                         03031001
030320                   MOVE SPACES  TO  ASC-FUNCTION                  03032001
030330                   PERFORM 3040-CHECK-4-ROW-ON-WST00008           03033001
030340                   PERFORM 2110-PREPARE-INTER-APPL-COMM           03034001
030350               END-IF                                             03035001
030351*                                                                 03035128
030352*VALIDATE ELEMENT SEQUENCE EXISTS                                 03035228
030353* DMH 10/27/17 BEGIN                                              03035328
030354*                                                                 03035428
030355               IF  ASC-ELEM-SEQ  NOT = SPACES                     03035528
030356                   PERFORM 3015-VALIDATE-ELEM-SEQ                 03035628
030357               END-IF                                             03035728
030358*                                                                 03035828
030359* DMH 10/27/17 END                                                03035928
030360*                                                                 03036028
030361                                                                  03036101
030370           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   03037001
030380                                                                  03038001
030390*F13 ADDCODE  ----> ADD CODE - WST_INTGRTN_TYP                    03039005
030400         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              03040001
030500               SET  ASC-ADD-PARM  TO  TRUE                        03050014
031600               PERFORM 3030-CHECK-4-ROW-ON-WST00008               03160001
031800               PERFORM 2110-PREPARE-INTER-APPL-COMM               03180001
031900                                                                  03190009
032000               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN               03200011
032100                                                                  03210001
032200*F15 UPDCODE  ----> UPDATE CODE - WST_INTGRTN_TYP                 03220005
032300         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              03230001
033500               IF  ASC-PARM-NAME = SPACES                         03350001
033600                   SET PS-ERROR                                   03360001
033700                       DP020-MSG-FATAL         TO TRUE            03370001
033800                   MOVE PC-TSYMSG-00007   TO DP020-MSG-NUMBER     03380001
033900                   MOVE DP015-UNP-ALP-BRT-OFF  TO APRMNMEA        03390001
034000                   MOVE DP015-RED              TO APRMNMEC        03400001
034100                   MOVE DP015-REVERSE          TO APRMNMEH        03410001
034200                   MOVE -1                     TO APRMNMEL        03420001
034300                   SET DP030-SET-CURSOR-APPL-1 TO TRUE            03430001
034400               ELSE                                               03440001
034500                   SET  ASC-UPD-PARM  TO  TRUE                    03450006
034600                   PERFORM 3040-CHECK-4-ROW-ON-WST00008           03460001
034700                   PERFORM 2110-PREPARE-INTER-APPL-COMM           03470001
034800               END-IF                                             03480001
034900                                                                  03490009
035000               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN               03500011
035100                                                                  03510001
035200*F17 ADDDEFN  ----> ADD DEFN - WST_ATTR_DEFN                      03520005
035300         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              03530001
036500               IF  ASC-PARM-NAME = SPACES                         03650001
036600                   SET PS-ERROR                                   03660001
036700                       DP020-MSG-FATAL         TO TRUE            03670001
036800                   MOVE PC-TSYMSG-00007   TO DP020-MSG-NUMBER     03680001
036900                   MOVE DP015-UNP-ALP-BRT-OFF  TO APRMNMEA        03690001
037000                   MOVE DP015-RED              TO APRMNMEC        03700001
037100                   MOVE DP015-REVERSE          TO APRMNMEH        03710001
037110                   MOVE -1                     TO APRMNMEL        03711001
037120                   SET DP030-SET-CURSOR-APPL-1 TO TRUE            03712001
037130               ELSE                                               03713001
037140                   SET  ASC-ADD-DEFN  TO  TRUE                    03714006
037150                   PERFORM 3040-CHECK-4-ROW-ON-WST00008           03715001
037160                   PERFORM 2110-PREPARE-INTER-APPL-COMM           03716001
037170               END-IF                                             03717001
037180                                                                  03718014
037190               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN               03719014
037200                                                                  03720001
037300*F22 CODELIST ----> LIST - WST_INTGRTN_TYP                        03730005
037400         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              03740005
037500           IF  ASC-OPER-UNT-ID = SPACES                           03750005
037600               SET PS-ERROR                                       03760005
037700                   DP020-MSG-FATAL         TO TRUE                03770005
037800               MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER    03780005
037810               MOVE DP015-UNP-ALP-BRT-OFF  TO AOPRUNTA            03781005
037820               MOVE DP015-RED              TO AOPRUNTC            03782005
037830               MOVE DP015-REVERSE          TO AOPRUNTH            03783005
037840               MOVE -1                     TO AOPRUNTL            03784005
037850               SET DP030-SET-CURSOR-APPL-1 TO TRUE                03785005
037851               MOVE SPACES                 TO AOPRNMEO            03785105
037852           ELSE                                                   03785205
037853               PERFORM 2110-PREPARE-INTER-APPL-COMM               03785305
037854           END-IF                                                 03785405
037855           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   03785505
037860                                                                  03786001
037870*F23 DEFNLIST ----> LIST - WST_ATTR_DEFN                          03787005
037880         WHEN DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)              03788001
037890           IF  ASC-OPER-UNT-ID = SPACES                           03789001
037900               SET PS-ERROR                                       03790001
038000                   DP020-MSG-FATAL         TO TRUE                03800001
038100               MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER    03810001
038200               MOVE DP015-UNP-ALP-BRT-OFF  TO AOPRUNTA            03820001
038300               MOVE DP015-RED              TO AOPRUNTC            03830001
038310               MOVE DP015-REVERSE          TO AOPRUNTH            03831001
038320               MOVE -1                     TO AOPRUNTL            03832001
038330               SET DP030-SET-CURSOR-APPL-1 TO TRUE                03833001
038340               MOVE SPACES                 TO AOPRNMEO            03834001
038341           ELSE                                                   03834105
038342               IF  ASC-PARM-NAME = SPACES                         03834205
038343                   SET PS-ERROR                                   03834305
038344                       DP020-MSG-FATAL         TO TRUE            03834405
038345                   MOVE PC-TSYMSG-00007   TO DP020-MSG-NUMBER     03834505
038346                   MOVE DP015-UNP-ALP-BRT-OFF  TO APRMNMEA        03834605
038347                   MOVE DP015-RED              TO APRMNMEC        03834705
038348                   MOVE DP015-REVERSE          TO APRMNMEH        03834805
038349                   MOVE -1                     TO APRMNMEL        03834905
038350                   SET DP030-SET-CURSOR-APPL-1 TO TRUE            03835005
038351               ELSE                                               03835105
038352                   PERFORM 3040-CHECK-4-ROW-ON-WST00008           03835216
038353                   PERFORM 2110-PREPARE-INTER-APPL-COMM           03835316
038354               END-IF                                             03835416
038370           END-IF                                                 03837001
038380           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   03838001
038390                                                                  03839001
038400*F24 ELEMLIST ----> LIST - WST_ATTR_ELEM                          03840005
038500         WHEN DP020-FK-LOCAL-FUNC-06 (DP020-SRC-AID)              03850001
038600           IF  ASC-OPER-UNT-ID = SPACES                           03860001
038700               SET PS-ERROR                                       03870001
038800                   DP020-MSG-FATAL         TO TRUE                03880001
038900               MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER    03890001
039000               MOVE DP015-UNP-ALP-BRT-OFF  TO AOPRUNTA            03900001
039100               MOVE DP015-RED              TO AOPRUNTC            03910001
039110               MOVE DP015-REVERSE          TO AOPRUNTH            03911001
039120               MOVE -1                     TO AOPRUNTL            03912001
039130               SET DP030-SET-CURSOR-APPL-1 TO TRUE                03913001
039140               MOVE SPACES                 TO AOPRNMEO            03914001
039150           ELSE                                                   03915001
039160               IF  ASC-PARM-NAME = SPACES                         03916001
039161                   SET PS-ERROR                                   03916101
039162                       DP020-MSG-FATAL         TO TRUE            03916201
039163                   MOVE PC-TSYMSG-00007   TO DP020-MSG-NUMBER     03916301
039164                   MOVE DP015-UNP-ALP-BRT-OFF  TO APRMNMEA        03916401
039165                   MOVE DP015-RED              TO APRMNMEC        03916501
039166                   MOVE DP015-REVERSE          TO APRMNMEH        03916601
039167                   MOVE -1                     TO APRMNMEL        03916701
039168                   SET DP030-SET-CURSOR-APPL-1 TO TRUE            03916801
039169               ELSE                                               03916901
039170                   PERFORM 3040-CHECK-4-ROW-ON-WST00008           03917017
039171                   PERFORM 2110-PREPARE-INTER-APPL-COMM           03917101
039180               END-IF                                             03918001
039181           END-IF                                                 03918101
039182*                                                                 03918224
039183*VALIDATE ELEMENT SEQUENCE EXISTS                                 03918324
039184* DMH 10/27/17 BEGIN                                              03918424
039185*                                                                 03918524
039186           IF  ASC-ELEM-SEQ  NOT = SPACES                         03918624
039187               PERFORM 3015-VALIDATE-ELEM-SEQ                     03918724
039188           END-IF                                                 03918824
039189*                                                                 03918924
039190* DMH 10/27/17 END                                                03919024
039191*                                                                 03919124
039192           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   03919224
039193                                                                  03919324
039194     END-EVALUATE.                                                03919424
039195                                                                  03919524
039196******************************************************************03919624
039197** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **03919724
039198** INTER-APPLICATION COMMAREA.                                  **03919824
039199******************************************************************03919924
039200 2110-PREPARE-INTER-APPL-COMM.                                    03920024
039210                                                                  03921001
039300     INITIALIZE CN022-INTER-APPL-COMMAREA.                        03930001
039400                                                                  03940001
039500     MOVE ASC-FUNCTION             TO CN022-FUNCTION.             03950001
039600     MOVE ASC-OPER-UNT-ID          TO CN022-OPER-UNT-ID.          03960001
039700     MOVE ASC-OPER-UNT-NAME        TO CN022-OPER-UNT-NAME.        03970001
039800     MOVE ASC-PARM-NAME            TO CN022-PARM-NAME.            03980001
039900     MOVE ASC-PARM-DESC            TO CN022-PARM-DESC.            03990001
040000     MOVE ASC-PARM-FUNC            TO CN022-PARM-FUNC.            04000005
040001* DMH 10/27/17 BEGIN                                              04000119
040010     MOVE ASC-ELEM-SEQ             TO CN022-ELEM-SEQ.             04001018
040020* DMH 10/27/17 END                                                04002019
040100                                                                  04010001
040200*----------------------------------------------------------------*04020001
040300* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*04030001
040400* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *04040001
040500* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *04050001
040600*----------------------------------------------------------------*04060001
040700 2200-MOVE-SCREEN-TO-COMMAREA.                                    04070001
040800*OPER UNT ID                                                      04080001
040900     IF  AOPRUNTL > ZERO                                          04090001
041000         MOVE AOPRUNTI      TO ASC-OPER-UNT-ID                    04100001
041100     ELSE                                                         04110001
041200         IF AOPRUNTF = DP015-ERASE-EOF                            04120001
041300            MOVE SPACES      TO ASC-OPER-UNT-ID                   04130001
041400         END-IF                                                   04140001
041500     END-IF.                                                      04150001
041600*                                                                 04160001
041700*PARM NAME                                                        04170001
041800     IF  APRMNMEL > ZERO                                          04180001
041900         MOVE APRMNMEI              TO ASC-PARM-NAME              04190001
042000     ELSE                                                         04200001
042100         IF APRMNMEF = DP015-ERASE-EOF                            04210001
042200            MOVE SPACES            TO ASC-PARM-NAME               04220001
042300         END-IF                                                   04230001
042400     END-IF.                                                      04240001
042500*                                                                 04250001
042600*PARM DESC                                                        04260001
042700     IF  APRMDSCL > ZERO                                          04270001
042800         MOVE APRMDSCI             TO ASC-PARM-DESC               04280001
042900     ELSE                                                         04290001
043000         IF APRMDSCF = DP015-ERASE-EOF                            04300001
043100            MOVE SPACES            TO ASC-PARM-DESC               04310001
043200         END-IF                                                   04320001
043300     END-IF.                                                      04330001
043400                                                                  04340001
043500*PARM TYPE                                                        04350001
043600     IF  APRMTYPL > ZERO                                          04360001
043700         MOVE APRMTYPI             TO ASC-PARM-FUNC               04370006
043800     ELSE                                                         04380001
043900         IF APRMTYPF = DP015-ERASE-EOF                            04390001
044000            MOVE SPACES            TO ASC-PARM-FUNC               04400006
044100         END-IF                                                   04410001
044200     END-IF.                                                      04420001
044210                                                                  04421001
044211* DMH 10/27/17 BEGIN                                              04421119
044212*ELEMENT SEQUENCE                                                 04421218
044213     IF  AELEMSQL > ZERO                                          04421318
044214         MOVE AELEMSQI             TO ASC-ELEM-SEQ                04421418
044215     ELSE                                                         04421518
044216         IF AELEMSQF = DP015-ERASE-EOF                            04421618
044217            MOVE ZEROES            TO  ASC-ELEM-SEQ               04421722
044218         END-IF                                                   04421818
044219     END-IF.                                                      04421918
044220* DMH 10/27/17 END                                                04422019
044221                                                                  04422118
044222******************************************************************04422201
044230* ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *04423001
044240* CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *04424001
044250* A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE     *04425001
044260* DONE IN THE DESTINATION PROGRAM, NOT HERE.                     *04426001
044270******************************************************************04427001
044280 3000-EDIT-DATA-IN-COMMAREA.                                      04428001
044290     PERFORM 3200-RESET-ATTRIBUTES.                               04429001
044300                                                                  04430001
044400*EDIT OPER UNIT TO MAKE SURE NUMERIC                              04440001
044500     IF  ASC-OPER-UNT-ID NOT = SPACES                             04450001
044600         MOVE ASC-OPER-UNT-ID    TO DP010I-UNEDITED-FIELD         04460001
044700         MOVE LENGTH OF ASC-OPER-UNT-ID TO DP010I-MAXIMUM-DIGITS  04470001
044800         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       04480001
044900         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  04490001
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                         04501030
263455              USING DP010I-NUMERIC-EDIT-AREA                      04502030
045100         IF  DP010I-ERROR-DETECTED                                04510001
045200             SET PS-ERROR                                         04520001
045300                 DP020-MSG-FATAL         TO TRUE                  04530001
045400             MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER      04540001
045500             MOVE DP015-UNP-ALP-BRT-OFF  TO AOPRUNTA              04550001
045600             MOVE DP015-RED              TO AOPRUNTC              04560001
045700             MOVE DP015-REVERSE          TO AOPRUNTH              04570001
045800             MOVE -1                     TO AOPRUNTL              04580001
045900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  04590001
046000             MOVE SPACES                 TO AOPRNMEO              04600001
046100         ELSE                                                     04610001
046200             MOVE DP010I-NUMERIC-FIELD TO ASC-OPER-UNT-ID-N       04620001
046300             MOVE ASC-OPER-UNT-ID      TO AOPRUNTO                04630001
046400*VALIDATE OPER UNIT                                               04640001
046500             PERFORM 3010-VALIDATE-OPER-UNT-ID                    04650001
046900         END-IF                                                   04690001
047000     END-IF.                                                      04700001
047100                                                                  04710001
047200                                                                  04720001
047201* DMH 10/27/17 BEGIN                                              04720119
047210*EDIT ELEMENT SEQUENCE TO MAKE SURE NUMERIC                       04721018
047220     IF  ASC-ELEM-SEQ  NOT = SPACES                               04722018
047230         MOVE ASC-ELEM-SEQ       TO DP010I-UNEDITED-FIELD         04723018
047240         MOVE LENGTH OF ASC-ELEM-SEQ TO DP010I-MAXIMUM-DIGITS     04724018
047250         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       04725018
047260         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  04726018
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                         04727130
263455              USING DP010I-NUMERIC-EDIT-AREA                      04727230
047280         IF  DP010I-ERROR-DETECTED                                04728018
047290             SET PS-ERROR                                         04729018
047291                 DP020-MSG-FATAL         TO TRUE                  04729118
047292             MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER      04729218
047293             MOVE DP015-UNP-ALP-BRT-OFF  TO AELEMSQA              04729318
047294             MOVE DP015-RED              TO AELEMSQC              04729418
047295             MOVE DP015-REVERSE          TO AELEMSQH              04729518
047296             MOVE -1                     TO AELEMSQL              04729618
047297             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  04729718
047298             MOVE SPACES                 TO AELEMSQO              04729818
047299         ELSE                                                     04729918
047300             MOVE DP010I-NUMERIC-FIELD TO ASC-ELEM-SEQ-N          04730018
047301             MOVE ASC-ELEM-SEQ         TO AOPRUNTO                04730118
047307         END-IF                                                   04730718
047308     END-IF.                                                      04730818
047309* DMH 10/27/17 END                                                04730919
047310                                                                  04731018
047311     IF  PS-ERROR                                                 04731118
047312         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     04731218
047313     END-IF.                                                      04731318
047314                                                                  04731418
047315                                                                  04731518
047320****************************************************************  04732001
047400*    VERIFY OPER UNIT ID.                                      *  04740001
047500*                                                              *  04750001
047600****************************************************************  04760001
047700                                                                  04770001
047800 3010-VALIDATE-OPER-UNT-ID.                                       04780001
047900                                                                  04790001
048000     INITIALIZE XL071-COMMAREA.                                   04800001
048100     MOVE ASC-OPER-UNT-ID TO XL071-LOCATION-NUMBER.               04810001
048200                                                                  04820001
048300     CALL XL071-LOCATION-MODULE USING                             04830001
048400                                DFHEIBLK                          04840001
048500                                XL071-COMMAREA                    04850001
048600                                XL071-COMMAREA-REC.               04860001
048700                                                                  04870001
048800     EVALUATE TRUE                                                04880001
048900         WHEN XL071-NO-ERRORS                                     04890001
049000         WHEN XL071-DC-ASGMT-NOT-FND                              04900001
049100              MOVE XL071-LOC-NM TO ASC-OPER-UNT-NAME              04910001
049200                                                                  04920001
049300         WHEN XL071-LOC-NOT-FOUND                                 04930001
049400              MOVE 'NAME NOT FOUND'   TO ASC-OPER-UNT-NAME        04940001
049500              SET PS-ERROR                                        04950001
049600                  DP020-MSG-FATAL         TO TRUE                 04960001
049700              MOVE PC-TSYMSG-02572        TO DP020-MSG-NUMBER     04970001
049800              MOVE DP015-UNP-ALP-BRT-OFF  TO AOPRUNTA             04980001
049900              MOVE DP015-RED              TO AOPRUNTC             04990001
050000              MOVE DP015-REVERSE          TO AOPRUNTH             05000001
050100              MOVE -1                     TO AOPRUNTL             05010001
050200              SET DP030-SET-CURSOR-APPL-1 TO TRUE                 05020001
050300              MOVE SPACES                 TO AOPRNMEO             05030001
050400                                                                  05040001
050500         WHEN OTHER                                               05050001
050600              MOVE '3010-VALIDATE-OPER-UNT-ID'                    05060001
050700                                  TO DP013-PARAGRAPH              05070001
050800              STRING 'SELECT STORE NUMBER - '                     05080001
050900                      XL071-LOCATION-NUMBER                       05090001
051000                     ' - BAD RETURN CODE FROM XLKUT071 - '        05100001
051100                      XL071-RETURN-CODE                           05110001
051200                      DELIMITED BY SIZE                           05120001
051300                      INTO DP013-MESSAGE-TEXT (1)                 05130001
051400              STRING 'SQLCODE - '                                 05140001
051500                      XL071-SQLCODE                               05150001
051600                     ' - '                                        05160001
051700                      XL071-DB2-TABLE                             05170001
051800                      DELIMITED BY SIZE                           05180001
051900                      INTO DP013-MESSAGE-TEXT (2)                 05190001
052000              MOVE XL071-SQLCA     TO DP013-SQLCA                 05200001
052100              MOVE XL071-DB2-TABLE TO DP013-DB2-TABLE-NAME (1)    05210001
052200              MOVE XL071-SQLCODE TO SQLCODE                       05220001
052300              SET DP013-DB2-ABEND                                 05230001
052400                  DP013-XCTL-DISPLAY-RESTART TO TRUE              05240001
052500              PERFORM DP013-0000-PROCESS-ABEND                    05250001
052600                                                                  05260001
052700     END-EVALUATE.                                                05270001
052800                                                                  05280001
052900                                                                  05290001
052901******************************************************************05290118
052902** CHECK FOR ROW ON WST_ATTR_ELEM                                 05290218
052903*  DMH 10/27/17 ADDED                                             05290319
052904******************************************************************05290418
052910 3015-VALIDATE-ELEM-SEQ.                                          05291018
052911      MOVE ASC-OPER-UNT-ID   TO DK-OPER-UNT-ID.                   05291120
052912      MOVE ASC-PARM-NAME     TO DK-PARM-NAME.                     05291220
052913      MOVE ASC-ELEM-SEQ-N    TO DK-ELEM-SEQ.                      05291320
052914                                                                  05291420
052915        EXEC SQL                                                  05291520
052916          SELECT  C.ATTR_ELEM_SEQ_NBR                             05291620
052923            INTO :WST00010-ATTR-ELEM-SEQ-NBR                      05292321
052930            FROM WST_INTGRTN_TYP A                                05293020
052931               , WST_ATTR_DEFN B                                  05293120
052932               , WST_ATTR_ELEM C                                  05293220
052933           WHERE A.INTGRTN_TYP_CDE    = :DK-PARM-NAME             05293320
052934             AND A.INTGRTN_TYP_CDE    =  B.INTGRTN_TYP_CDE        05293420
052935             AND B.INTGRTN_TYP_CDE    =  C.INTGRTN_TYP_CDE        05293520
052936             AND B.ATTR_DEFN_SEQ_NBR  =  C.ATTR_DEFN_SEQ_NBR      05293620
052937             AND C.ATTR_ELEM_SEQ_NBR  = :DK-ELEM-SEQ              05293720
052938           FETCH FIRST 1 ROW ONLY                                 05293825
052939            WITH UR                                               05293920
052948        END-EXEC                                                  05294820
052949                                                                  05294920
052950        EVALUATE TRUE                                             05295020
052951            WHEN SQLCODE = +0                                     05295120
052952            WHEN SQLCODE = -811                                   05295223
052953                 CONTINUE                                         05295323
052954                                                                  05295423
052955            WHEN SQLCODE = +100                                   05295523
052956                SET PS-ERROR                                      05295623
052957                    DP020-MSG-FATAL         TO TRUE               05295723
052959                MOVE PC-TSYMSG-03801     TO DP020-MSG-NUMBER      05295922
052968                MOVE DP015-UNP-ALP-BRT-OFF  TO AELEMSQA           05296820
052969                MOVE DP015-RED              TO AELEMSQC           05296920
052970                MOVE DP015-REVERSE          TO AELEMSQH           05297020
052971                MOVE -1                     TO AELEMSQL           05297120
052972                SET DP030-SET-CURSOR-APPL-1 TO TRUE               05297220
052973                                                                  05297320
052974            WHEN SQLWARN0 NOT = SPACES                            05297420
052975            WHEN SQLCODE < +0                                     05297520
052976            WHEN SQLCODE > +0                                     05297620
052977                MOVE '3015-VALIDATE-ELEM-SEQ      '               05297720
052978                                          TO DP013-PARAGRAPH      05297820
052979                MOVE 'PROBLEM WITH RETRIEVING ROW'                05297920
052980                                    TO DP013-MESSAGE-TEXT (1)     05298020
052981                MOVE SQLCA      TO DP013-SQLCA                    05298120
052982                MOVE 'WST_INTGRTN_TYP'                            05298220
052983                                     TO DP013-DB2-TABLE-NAME (1)  05298320
052984                MOVE 'WST_ATTR_DEFN' TO DP013-DB2-TABLE-NAME (2)  05298420
052985                MOVE 'WST_ATTR_ELEM' TO DP013-DB2-TABLE-NAME (3)  05298520
052986                SET DP013-DB2-ABEND                               05298620
052987                    DP013-XCTL-DISPLAY-RESTART TO TRUE            05298720
052988                PERFORM DP013-0000-PROCESS-ABEND                  05298820
052989        END-EVALUATE.                                             05298920
052990                                                                  05299020
052993                                                                  05299320
053000******************************************************************05300001
053100** CHECK FOR ROW ON WST00008                                      05310003
053200******************************************************************05320001
053300 3030-CHECK-4-ROW-ON-WST00008.                                    05330001
053400      MOVE ASC-PARM-NAME     TO DK-PARM-NAME.                     05340001
053500                                                                  05350001
053600        EXEC SQL                                                  05360001
053700          SELECT  A.INTGRTN_TYP_CDE                               05370002
053800                 ,A.INTGRTN_TYP_DESC                              05380002
053900                 ,A.APPL_FUNC_DESC                                05390002
054000            INTO :WST00008-INTGRTN-TYP-CDE                        05400002
054100                ,:WST00008-INTGRTN-TYP-DESC                       05410002
054200                ,:WST00008-APPL-FUNC-DESC                         05420002
054300            FROM  WST_INTGRTN_TYP A                               05430001
054400           WHERE  A.INTGRTN_TYP_CDE  = :DK-PARM-NAME              05440003
054500        END-EXEC                                                  05450001
054600                                                                  05460001
054700        EVALUATE TRUE                                             05470001
054800            WHEN SQLCODE = +0                                     05480001
054900                  MOVE WST00008-INTGRTN-TYP-DESC  TO              05490002
055000                              ASC-PARM-DESC                       05500001
055100                  MOVE WST00008-APPL-FUNC-DESC   TO               05510002
055200                              ASC-PARM-FUNC                       05520006
055300                SET PS-ERROR                                      05530001
055400                    DP020-MSG-FATAL         TO TRUE               05540001
055500                MOVE PC-TSYMSG-03707        TO DP020-MSG-NUMBER   05550001
055600                MOVE DP015-UNP-ALP-BRT-OFF  TO APRMNMEA           05560015
055800                MOVE DP015-RED              TO APRMNMEC           05580015
056000                MOVE DP015-REVERSE          TO APRMNMEH           05600015
056200                MOVE -1                     TO APRMNMEL           05620001
056300                SET DP030-SET-CURSOR-APPL-1 TO TRUE               05630001
056400*--OPER UNT ID MUST EQUAL CURR OPER UNT ID INORDER TO ADD.        05640001
056500            WHEN SQLCODE = +100                                   05650001
056600                 SET  ASC-ADD-PARM   TO  TRUE                     05660006
056700            WHEN SQLWARN0 NOT = SPACES                            05670001
056800            WHEN SQLCODE < +0                                     05680001
056900            WHEN SQLCODE > +0                                     05690001
057000                MOVE '3030-CHECK-4-ROW-ON-WST00008'               05700001
057100                                          TO DP013-PARAGRAPH      05710001
057200                MOVE 'PROBLEM WITH RETRIEVING ROW'                05720001
057300                                    TO DP013-MESSAGE-TEXT (1)     05730001
057400                MOVE SQLCA      TO DP013-SQLCA                    05740001
057500                MOVE 'WST_INTGRTN_TYP' TO DP013-DB2-TABLE-NAME (1)05750001
057600                SET DP013-DB2-ABEND                               05760001
057700                    DP013-XCTL-DISPLAY-RESTART TO TRUE            05770001
057800                PERFORM DP013-0000-PROCESS-ABEND                  05780001
057900        END-EVALUATE.                                             05790001
058000                                                                  05800001
058100                                                                  05810001
058200******************************************************************05820001
058300** CHECK FOR ROW ON WST00008 - IF A ROW EXISTS - GOTO CNKCS225    05830001
058400******************************************************************05840001
058500 3040-CHECK-4-ROW-ON-WST00008.                                    05850001
058600      MOVE ASC-OPER-UNT-ID   TO DK-OPER-UNT-ID.                   05860001
058700      MOVE ASC-PARM-NAME     TO DK-PARM-NAME.                     05870001
058800                                                                  05880001
058900        EXEC SQL                                                  05890001
059000          SELECT  A.INTGRTN_TYP_CDE                               05900002
059100                 ,A.INTGRTN_TYP_DESC                              05910002
059200                 ,A.APPL_FUNC_DESC                                05920002
059300            INTO :WST00008-INTGRTN-TYP-CDE                        05930002
059400                ,:WST00008-INTGRTN-TYP-DESC                       05940002
059500                ,:WST00008-APPL-FUNC-DESC                         05950002
059600            FROM  WST_INTGRTN_TYP A                               05960001
059700           WHERE  A.INTGRTN_TYP_CDE  = :DK-PARM-NAME              05970003
059800        END-EXEC                                                  05980001
059900                                                                  05990001
060000        EVALUATE TRUE                                             06000001
060100            WHEN SQLCODE = +0                                     06010001
060200                  MOVE WST00008-INTGRTN-TYP-DESC  TO              06020002
060300                              ASC-PARM-DESC                       06030001
060400                  MOVE WST00008-APPL-FUNC-DESC    TO              06040004
060500                              ASC-PARM-FUNC                       06050006
060600                                                                  06060001
060700            WHEN SQLCODE = +100                                   06070001
060800                SET PS-ERROR                                      06080001
060900                    DP020-MSG-FATAL         TO TRUE               06090001
061000                EVALUATE TRUE                                     06100001
061100                    WHEN ASC-UPD-PARM                             06110006
061200                         MOVE PC-TSYMSG-03710                     06120001
061300                                            TO DP020-MSG-NUMBER   06130001
061400                    WHEN ASC-ADD-DEFN                             06140006
061500                         MOVE PC-TSYMSG-03721                     06150001
061600                                            TO DP020-MSG-NUMBER   06160001
061700                    WHEN OTHER                                    06170001
061800                         MOVE PC-TSYMSG-03722                     06180001
061900                                            TO DP020-MSG-NUMBER   06190001
062000                END-EVALUATE                                      06200001
062100                MOVE DP015-UNP-ALP-BRT-OFF  TO APRMNMEA           06210015
062300                MOVE DP015-RED              TO APRMNMEC           06230015
062500                MOVE DP015-REVERSE          TO APRMNMEH           06250015
062700                MOVE -1                     TO APRMNMEL           06270001
062800                SET DP030-SET-CURSOR-APPL-1 TO TRUE               06280001
062900            WHEN SQLWARN0 NOT = SPACES                            06290001
063000            WHEN SQLCODE < +0                                     06300001
063100            WHEN SQLCODE > +0                                     06310001
063200                MOVE '3040-CHECK-4-ROW-ON-WST00008'               06320001
063300                                          TO DP013-PARAGRAPH      06330001
063400                MOVE 'PROBLEM WITH RETRIEVING ROW'                06340001
063500                                    TO DP013-MESSAGE-TEXT (1)     06350001
063600                MOVE SQLCA      TO DP013-SQLCA                    06360001
063700                MOVE 'WST_INTGRTN_TYP' TO DP013-DB2-TABLE-NAME (1)06370001
063800                SET DP013-DB2-ABEND                               06380001
063900                    DP013-XCTL-DISPLAY-RESTART TO TRUE            06390001
064000                PERFORM DP013-0000-PROCESS-ABEND                  06400001
064100        END-EVALUATE.                                             06410001
064200                                                                  06420001
064300                                                                  06430001
064400******************************************************************06440001
064500** CHECK FOR ROW ON WST00009                                      06450003
064600******************************************************************06460001
064700 3045-CHECK-4-ROW-ON-WST00009.                                    06470001
064800      MOVE ASC-OPER-UNT-ID   TO DK-OPER-UNT-ID.                   06480001
064900      MOVE ASC-PARM-NAME     TO DK-PARM-NAME.                     06490001
065000                                                                  06500001
065100        EXEC SQL                                                  06510001
065200          SELECT  A.INTGRTN_TYP_CDE                               06520002
065300                 ,A.ATTR_DEFN_SEQ_NBR                             06530002
065400                 ,A.ATTR_DEFN_DESC                                06540002
065500                 ,A.REQR_IND                                      06550002
065600                 ,A.DATYP_CDE                                     06560002
065700                 ,A.MAX_LEN_QTY                                   06570002
065800                 ,A.MAX_PCSN_QTY                                  06580002
066100            INTO :WST00009-INTGRTN-TYP-CDE                        06610002
066200                ,:WST00009-ATTR-DEFN-SEQ-NBR                      06620002
066300                ,:WST00009-ATTR-DEFN-DESC                         06630002
066400                ,:WST00009-REQR-IND                               06640002
066500                ,:WST00009-DATYP-CDE                              06650002
066600                ,:WST00009-MAX-LEN-QTY                            06660002
066700                ,:WST00009-MAX-PCSN-QTY                           06670002
067000            FROM  WST_ATTR_DEFN A                                 06700001
067200           WHERE  A.INTGRTN_TYP_CDE  = :DK-PARM-NAME              06720003
067300        END-EXEC                                                  06730001
067400                                                                  06740001
067500        EVALUATE TRUE                                             06750001
067600            WHEN SQLCODE = +0                                     06760001
067700                 CONTINUE                                         06770001
067800                                                                  06780001
067900            WHEN SQLCODE = +100                                   06790001
068000                SET PS-ERROR                                      06800001
068100                    DP020-MSG-FATAL         TO TRUE               06810001
068200                EVALUATE TRUE                                     06820001
068300                    WHEN ASC-UPD-PARM                             06830006
068400                         MOVE PC-TSYMSG-03710                     06840001
068500                                            TO DP020-MSG-NUMBER   06850001
068600                    WHEN ASC-ADD-DEFN                             06860006
068700                         MOVE PC-TSYMSG-03721                     06870001
068800                                            TO DP020-MSG-NUMBER   06880001
068900                    WHEN OTHER                                    06890001
069000                         MOVE PC-TSYMSG-03723                     06900001
069100                                            TO DP020-MSG-NUMBER   06910001
069200                END-EVALUATE                                      06920001
069300                MOVE DP015-UNP-ALP-BRT-OFF  TO APRMNMEA           06930015
069500                MOVE DP015-RED              TO APRMNMEC           06950015
069700                MOVE DP015-REVERSE          TO APRMNMEH           06970015
069900                MOVE -1                     TO APRMNMEL           06990001
070000                SET DP030-SET-CURSOR-APPL-1 TO TRUE               07000001
070100            WHEN SQLWARN0 NOT = SPACES                            07010001
070200            WHEN SQLCODE < +0                                     07020001
070300            WHEN SQLCODE > +0                                     07030001
070400                MOVE '3045-CHECK-4-ROW-ON-WST00009'               07040001
070500                                          TO DP013-PARAGRAPH      07050001
070600                MOVE 'PROBLEM WITH RETRIEVING ROW'                07060001
070700                                    TO DP013-MESSAGE-TEXT (1)     07070001
070800                MOVE SQLCA      TO DP013-SQLCA                    07080001
070900                MOVE 'WST_ATTR_DEFN' TO DP013-DB2-TABLE-NAME (1)  07090001
071000                SET DP013-DB2-ABEND                               07100001
071100                    DP013-XCTL-DISPLAY-RESTART TO TRUE            07110001
071200                PERFORM DP013-0000-PROCESS-ABEND                  07120001
071300        END-EVALUATE.                                             07130001
071400                                                                  07140001
071500                                                                  07150001
071600                                                                  07160001
071700******************************************************************07170001
071800** MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE **07180001
071900** MAP.                                                         **07190001
072000******************************************************************07200001
072100 3200-RESET-ATTRIBUTES.                                           07210001
072200     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       07220001
072300                                                                  07230001
073700         MOVE DP015-UNP-ALP-NOR-OFF TO APRMNMEA                   07370010
073800                                       APRMDSCA                   07380001
073900                                       APRMTYPA                   07390027
074000                                       AELEMSQA                   07400027
074100         MOVE DP015-GREEN          TO APRMNMEC                    07410010
074200                                      APRMDSCC                    07420001
074300                                      APRMTYPC                    07430001
074400                                      AELEMSQC                    07440026
074500         MOVE DP015-UNDERLINE      TO APRMNMEH                    07450027
074600                                      APRMDSCH                    07460027
074700                                      APRMTYPH                    07470027
074710                                      AELEMSQH                    07471027
074800         MOVE -1                   TO APRMNMEL.                   07480010
075000                                                                  07500001
075100     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       07510001
075200*----------------------------------------------------------------*07520001
075210*  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *07521001
075220*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *07522001
075230*  IT HERE.                                                      *07523001
075240*----------------------------------------------------------------*07524001
075250 4000-BUILD-INITIAL-PANEL.                                        07525001
075260                                                                  07526001
075270     PERFORM 3010-VALIDATE-OPER-UNT-ID.                           07527001
075280                                                                  07528001
075290     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       07529001
075300                                                                  07530001
075400     MOVE ASC-OPER-UNT-ID          TO AOPRUNTO.                   07540001
075500     MOVE ASC-OPER-UNT-NAME        TO AOPRNMEO.                   07550001
075600                                                                  07560001
075700                                                                  07570001
075800*----------------------------------------------------------------*07580001
075900*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *07590001
076000*----------------------------------------------------------------*07600001
076100 4400-MOVE-COMMAREA-TO-SCREEN.                                    07610001
076200     MOVE ASC-OPER-UNT-ID          TO AOPRUNTO.                   07620001
076300     MOVE ASC-OPER-UNT-NAME        TO AOPRNMEO.                   07630001
076400     MOVE ASC-PARM-NAME            TO APRMNMEO.                   07640001
076500     MOVE ASC-PARM-DESC            TO APRMDSCO.                   07650001
076600     MOVE ASC-PARM-FUNC            TO APRMTYPO.                   07660013
076610     MOVE ASC-ELEM-SEQ             TO AELEMSQO.                   07661018
076700                                                                  07670001
076800*----------------------------------------------------------------*07680001
076900*    ABEND PROCESSOR MODULE                                      *07690001
077000*----------------------------------------------------------------*07700001
077100                                                                  07710001
077200     COPY DPPD013.                                                07720001
