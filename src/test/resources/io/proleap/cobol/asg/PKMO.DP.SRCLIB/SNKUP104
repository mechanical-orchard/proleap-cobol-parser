000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300 PROGRAM-ID.   SNKUP104.                                          00030073
000400 AUTHOR.       JOE LAROSA.                                        00040073
000500 INSTALLATION. KOHLS DEPARTMENT STORES.                           00050073
000600 DATE-WRITTEN. NOVEMBER 2005.                                     00060073
000700 DATE-COMPILED.                                                   00070073
000800******************************************************************00080073
000900*                   ASN SPLITTER PROGRAM                          00090073
001000*                                                                 00100073
001100* THIS PROGRAM READS RECORDS FROM THE INPUT REPOSITORY TABLES     00110073
001200* (SNT_DAT_CNTL & SNT_DAT_XFER) USING A CURSOR BASED ON A         00120073
001300* "READY" STATUS AND AN ASN TYPE OF "C"(CORPORATE).  A CORPORATE  00130073
001400* ASN IS ANY ASN FOR DC 90 OR FLAGGED AS 'OCEAN' OR 'AIR'.        00140073
001500*                                                                 00150073
001600* WHEN A ROW IS FOUND ON THE CONTROL TABLE, THE DETAIL ROWS ARE   00160073
001700* WRITTEN TO A SEQUENTIAL OUTPUT FILE.  THE STATUS ON THE CONTROL 00170073
001800* ROW IS THEN CHANGED TO 'COMPLETED' AND A COMMIT IS DONE.        00180073
001900*CHG0136579 - START                                               00190073
002000* Error file is written if landed asn is present with invalid     00200073
002100* transportation mode (i.e other than 'A' or 'S').                00210073
002200*CHG0136579 - END                                                 00220073
002300*---------------------------------------------------------------* 00230073
002400* CHANGED 11/04/2021    BY JIM HUNTER      WR: CHG0263627         00240073
002500* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00250073
002600* MAKING THE CALL DYNAMIC VS STATIC.                              00260073
002601*---------------------------------------------------------------* 00260173
002602*                                                                 00260200
002603 ENVIRONMENT DIVISION.                                            00260300
002604*                                                                 00260400
002605 CONFIGURATION SECTION.                                           00260500
002606 SOURCE-COMPUTER.        IBM-3090.                                00260600
002607 OBJECT-COMPUTER.        IBM-3090.                                00260700
002608                                                                  00260800
002700 INPUT-OUTPUT SECTION.                                            00270000
002800 FILE-CONTROL.                                                    00280000
002900     SELECT OUTPUT-FILE  ASSIGN TO OUT01.                         00290000
003000     SELECT CNTL-ID-FILE ASSIGN TO OUT02.                         00300073
003001*CHG0136579 - START                                               00300173
003002     SELECT OUTPUT-ERROR-FILE ASSIGN TO OUT03.                    00300200
003003*CHG0136579 - END                                                 00300373
003004*                                                                 00300400
003100 DATA DIVISION.                                                   00310000
003200*                                                                 00320000
003300 FILE SECTION.                                                    00330000
003400                                                                  00340000
003500 FD  OUTPUT-FILE                                                  00350000
003600     RECORDING MODE IS F                                          00360000
003700     LABEL RECORDS ARE STANDARD                                   00370000
003800     RECORD CONTAINS 400 CHARACTERS                               00380000
003900     BLOCK CONTAINS 0 RECORDS                                     00390000
004000     DATA RECORD IS OUTPUT-RECORD.                                00400000
004100                                                                  00410000
004200 01  OUTPUT-RECORD                   PIC X(400).                  00420000
004300                                                                  00430000
004301 FD  CNTL-ID-FILE                                                 00430173
004302     RECORDING MODE IS F                                          00430200
004303     LABEL RECORDS ARE STANDARD                                   00430300
004304     RECORD CONTAINS 20 CHARACTERS                                00430400
004305     BLOCK CONTAINS 0 RECORDS                                     00430500
004306     DATA RECORD IS CNTL-ID-RECORD.                               00430600
004307                                                                  00430700
004308 01  CNTL-ID-RECORD                  PIC X(020).                  00430800
004309                                                                  00430900
004310*CHG0136579 - START                                               00431073
004311 FD  OUTPUT-ERROR-FILE                                            00431100
004312     RECORDING MODE IS F                                          00431200
004313     LABEL RECORDS ARE STANDARD                                   00431300
004314     RECORD CONTAINS 092 CHARACTERS                               00431400
004315     BLOCK CONTAINS 0 RECORDS                                     00431500
004316     DATA RECORD IS OUTPUT-ERROR-RECORD.                          00431600
004317                                                                  00431700
004318 01  OUTPUT-ERROR-RECORD             PIC X(092).                  00431800
004319*CHG0136579 - END                                                 00431973
004320                                                                  00432000
004400******************************************************************00440000
004500 WORKING-STORAGE SECTION.                                         00450000
004600                                                                  00460000
004700 01  PS-PROGRAM-SWITCHES.                                         00470000
004800     05  PS-END-OF-CNTL-CSR-SW       PIC X(01) VALUE 'N'.         00480000
004900         88  PS-END-OF-CNTL-CSR-YES            VALUE 'Y'.         00490000
005000         88  PS-END-OF-CNTL-CSR-NO             VALUE 'N'.         00500000
005100     05  PS-END-OF-XFER-CSR-SW       PIC X(01) VALUE 'N'.         00510000
005200         88  PS-END-OF-XFER-CSR-YES            VALUE 'Y'.         00520000
005300         88  PS-END-OF-XFER-CSR-NO             VALUE 'N'.         00530000
027600     05  PS-TD5-SW                    PIC X(01) VALUE 'N'.        02760000
027601                                                                  02760173
027602 01  PC-PROGRAM-CONSTANTS.                                        02760200
027603     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'SNKUP104'.  02760300
027604     05  PC-MAX-RETRIES              PIC S9(3) VALUE +5 COMP-3.   02760400
027605                                                                  02760500
027606 01  PA-PROGRAM-ACCUMULATORS.                                     02760600
027607     05  PA-TOTALS.                                               02760700
027608         10  PA-TOTAL-CNTL-READ      PIC S9(7) VALUE +0 COMP-3.   02760800
027609         10  PA-TOTAL-XFER-READ      PIC S9(7) VALUE +0 COMP-3.   02760900
027610         10  PA-TOTAL-XFER-WRITTEN   PIC S9(7) VALUE +0 COMP-3.   02761000
027620         10  PA-TOTAL-CNTL-WRITTEN   PIC S9(7) VALUE +0 COMP-3.   02762000
027621*CHG0136579 - START                                               02762173
027622         10  PA-TOTAL-ERROR-WRITTEN  PIC S9(7) VALUE +0 COMP-3.   02762200
027623*CHG0136579 - END                                                 02762373
027624                                                                  02762400
027625 01  PV-PROGRAM-VARIABLES.                                        02762500
027626     05  PV-DISPLAY-RECORD           PIC Z,ZZZ,ZZ9-.              02762600
027627     05  PV-DB2-COUNT                PIC S9(9) VALUE +0 COMP-3.   02762700
027628     05  PV-COMMIT-COUNT-XFER        PIC 9(07) VALUE ZEROES.      02762800
027629     05  WS-ASN-COUNT                PIC  9(7)  VALUE 0.          02762900
027630     05  WS-NUMERIC-1                PIC  S9(11) VALUE 0.         02763000
027631     05  WS-NUMERIC-2                PIC  S9(11) VALUE 0.         02763100
027632     05  WS-NUMERIC-3                PIC  S9(9) VALUE 0.          02763200
027633     05  WS-NUMERIC-4                PIC  S9(7) VALUE 0.          02763300
027634     05  PV-SAVE-ISA-CNTL-NBR        PIC 9(9) VALUE 0.            02763400
027635     05  PV-SAVE-SHIPT-ID-SEQ        PIC X(30) VALUE SPACES.      02763500
027636     05  PV-SAVE-DAT-XFER-CNTL       PIC 9(9) VALUE 0.            02763600
027637     05  PV-TD5-VALUE                PIC X VALUE SPACE.           02763773
027638                                                                  02763873
027639 01  PV-ASN-ERROR-MSG.                                            02763973
027640     05  FILLER                       PIC X(11) VALUE             02764073
027650         ' ASN ERROR '.                                           02765073
027660     05  FILLER                       PIC X(11) VALUE             02766073
027670         ' ASN NBR = '.                                           02767073
027680     05  PV-MSG-ASN                   PIC 9(09) VALUE ZERO.       02768073
027690     05  FILLER                       PIC X(17) VALUE             02769073
027700         ' / ISA ID QUAL = '.                                     02770073
027800     05  PV-MSG-ISA-ID-QUAL           PIC X(02) VALUE SPACES.     02780073
027900     05  FILLER                       PIC X(12) VALUE             02790073
028000         ' / ISA ID = '.                                          02800073
028100     05  PV-MSG-ISA-ID                PIC X(15) VALUE SPACES.     02810073
028200     05  FILLER                       PIC X(14) VALUE             02820073
028300         ' / TD5 CODE = '.                                        02830073
028400     05  PV-MSG-TD5-CDE               PIC X(01) VALUE SPACES.     02840073
028401                                                                  02840173
028402                                                                  02840200
028403*    05  PV-PRC-CNTL-TMST            PIC X(26) VALUE SPACE.       02840336
028404*    05  FILLER REDEFINES PV-PRC-CNTL-TMST.                       02840436
028405*        10  PV-TMST-DATE.                                        02840536
028406*            15  PV-TMST-CCYY        PIC 9(04).                   02840636
028407*            15  FILLER              PIC X(01).                   02840736
028408*            15  PV-TMST-MONTH       PIC 9(02).                   02840836
028409*            15  FILLER              PIC X(01).                   02840936
028410*            15  PV-TMST-DAY         PIC 9(02).                   02841036
028411*        10  FILLER                  PIC X(01).                   02841136
028412*        10  PV-TMST-HOUR            PIC 9(02).                   02841236
028413*        10  FILLER                  PIC X(01).                   02841336
028414*        10  PV-TMST-MINUTE          PIC 9(02).                   02841436
028415*        10  FILLER                  PIC X(01).                   02841536
028416*        10  PV-TMST-SECOND          PIC 9(02).                   02841636
028417*        10  FILLER                  PIC X(01).                   02841736
028418*        10  PV-TMST-LAST6           PIC 9(06).                   02841836
028419                                                                  02841900
028420 01  PV-ABEND-VARIABLES.                                          02842000
028421     05  PV-ABEND-CODE               PIC S9(4) VALUE +0 COMP SYNC.02842100
028422     05  PV-RETRY-COUNTER            PIC S9(4) VALUE +0 COMP.     02842200
028423     05  PV-SQLCODE                  PIC S9(9).                   02842300
028424     05  PV-DISPLAY-SQLCODE          PIC -------999.              02842400
028425     05  PV-ABEND-PROGRAM            PIC X(08) VALUE 'SNKUP104'.  02842500
028426     05  PV-ABEND-PARAGRAPH          PIC X(25) VALUE SPACES.      02842600
028427     05  PV-ABEND-OPERATION          PIC X(20) VALUE SPACES.      02842700
028428     05  PV-ABEND-STRUCTURE-1        PIC X(08) VALUE SPACES.      02842800
028429     05  PV-DB2-OPERATION-MESSAGE-1  PIC X(79) VALUE SPACES.      02842900
028430                                                                  02843000
028431******************************************************************02843100
028432* NUMERIC EDIT ROUTINE                                            02843200
028433*                                                                 02843373
028434     COPY DPWS010I.                                               02843400
028435*                                                                 02843573
028436* INPUT FILE LAYOUT FOR COLUMN SNT_DAT_XFER.LOD_DAT_TXT           02843600
028437*                                                                 02843773
028438     COPY SNRD005.                                                02843800
028439                                                                  02843973
028440*  OUTPUT FILE LAYOUT - GOES TO TRK212                            02844000
028450     COPY TRRD063.                                                02845000
028451                                                                  02845173
028452*  DAT-XFER-CNTL-ID PULLER FILE - DRIVES TRKUP106 UPDATE          02845200
028453     COPY SNRD006.                                                02845300
028454                                                                  02845473
028455*  WORK AREA PASSED IN CALL TO DPKUT500                           02845500
028456     COPY DPWS500.                                                02845600
028457                                                                  02845773
028458*  DB2 FORMATTED MESSAGE AREA                                     02845800
028459     COPY DPWS004.                                                02845900
028460                                                                  02846073
028461*  COMMUNICATIONS AREA FOR DB2                                    02846100
028462     EXEC SQL                                                     02846200
028463         INCLUDE SQLCA                                            02846300
028464     END-EXEC.                                                    02846400
028465                                                                  02846500
028466*                                                                 02846673
028467*  DB2 TABLE DECLARATION                                          02846700
028468*  (SNT_DAT_CNTL - ASN DATA TRANSFER CONTROL TABLE)               02846800
028469*                                                                 02846973
028470     EXEC SQL                                                     02847000
028471         INCLUDE SNT00000                                         02847100
028472     END-EXEC.                                                    02847200
028473                                                                  02847300
028474*                                                                 02847473
028475*  DB2 TABLE DECLARATION                                          02847500
028476*  (SNT_DAT_XFER - ASN DATA TRANSFER DETAIL TABLE)                02847600
028477*                                                                 02847773
028478     EXEC SQL                                                     02847800
028479         INCLUDE SNT00001                                         02847900
028480     END-EXEC.                                                    02848000
028490                                                                  02849000
028491*                                                                 02849173
028492     EXEC SQL                                                     02849200
028493       DECLARE CNTL-CSR CURSOR FOR                                02849300
028494        SELECT DAT_XFER_CNTL_ID                                   02849400
028495          FROM SNT_DAT_CNTL                                       02849500
028496         WHERE STAT_CDE  = 'R'                                    02849600
028497           AND ASN_TYP_CDE  = 'C'                                 02849700
028498         ORDER BY DAT_XFER_CNTL_ID                                02849873
028499     END-EXEC.                                                    02849900
028500                                                                  02850000
028501     EXEC SQL                                                     02850100
028502       DECLARE XFER-CSR CURSOR FOR                                02850200
028503        SELECT                                                    02850300
028504               DAT_XFER_CNTL_ID                                   02850473
028505             , LOD_DAT_TXT                                        02850500
028506          FROM SNT_DAT_XFER                                       02850600
028507         WHERE DAT_XFER_CNTL_ID = :SNT00000-DAT-XFER-CNTL-ID      02850700
028508         ORDER BY PRC_LOD_SEQ_NBR                                 02850874
028509     END-EXEC.                                                    02850900
028510                                                                  02851000
028511* NOT USED   , PRC_LOD_SEQ_NBR                                    02851100
028520* NOT USED   , DAT_CTG_CDE                                        02852000
028521                                                                  02852173
028522 LINKAGE SECTION.                                                 02852200
028523/                                                                 02852373
028524 PROCEDURE DIVISION.                                              02852400
028525                                                                  02852573
028526     DISPLAY '************ START OF SNKUP104 ***************'     02852600
028527                                                                  02852700
028528     PERFORM 1000-INITIALIZE.                                     02852800
028529                                                                  02852900
028530*    SPLIT OUT 'CORPORATE' ASNS.                                  02853000
028531     PERFORM 2000-SPLIT-ASN-RECORDS                               02853100
028532         UNTIL PS-END-OF-CNTL-CSR-YES                             02853200
028533                                                                  02853300
028534     PERFORM 9000-EOJ-ROUTINE.                                    02853400
028535                                                                  02853500
028536     STOP RUN.                                                    02853600
028537/                                                                 02853700
028538 1000-INITIALIZE.                                                 02853800
028539                                                                  02853900
028540     OPEN OUTPUT OUTPUT-FILE                                      02854036
028550                 CNTL-ID-FILE                                     02855036
028551*CHG0136579 - START                                               02855173
028552                 OUTPUT-ERROR-FILE                                02855236
028553*CHG0136579 - END                                                 02855373
028554                                                                  02855436
028555*INIT COUNTERS.                                                   02855500
028556     INITIALIZE PA-TOTAL-CNTL-READ                                02855600
028557                PA-TOTAL-XFER-READ                                02855700
028558                PA-TOTAL-XFER-WRITTEN                             02855800
028559                PV-COMMIT-COUNT-XFER                              02855900
028560*CHG0136579 - START                                               02856073
028570                PA-TOTAL-ERROR-WRITTEN.                           02857000
028571*CHG0136579 - END                                                 02857173
028572                                                                  02857200
028573     PERFORM 2100-OPEN-CNTL-CURSOR.                               02857300
028574                                                                  02857400
028575     PERFORM 2200-FETCH-CNTL-CURSOR.                              02857500
028576                                                                  02857600
028577     IF PS-END-OF-CNTL-CSR-YES                                    02857700
028578         DISPLAY ' '                                              02857800
028579         DISPLAY '*************************************'          02857900
028580         DISPLAY '**    NO CORPORATE TRANSACTIONS    **'          02858000
028581         DISPLAY '**      FOUND ON SNT_DAT_CNTL      **'          02858100
028582         DISPLAY '*************************************'          02858200
028583         DISPLAY ' '                                              02858300
028584     END-IF.                                                      02858400
028585                                                                  02858500
028586*     THIS IS USELESS                                             02858636
028587*GET CURRENT TIMESTAMP.                                           02858700
028588*    EXEC SQL                                                     02858836
028589*        SET :PV-PRC-CNTL-TMST = CURRENT TIMESTAMP                02858936
028590*    END-EXEC.                                                    02859036
028591*                                                                 02859136
028592*    EVALUATE TRUE                                                02859236
028593*      WHEN SQLCODE = ZERO                                        02859336
028594*          DISPLAY ' CURRENT TIMESTAMP = ' PV-PRC-CNTL-TMST       02859436
028595*                                                                 02859536
028596*      WHEN OTHER                                                 02859636
028597*          MOVE '1000-INITIALIZATION' TO PV-ABEND-PARAGRAPH       02859736
028598*          MOVE 'GET DB2 TMST'        TO PV-ABEND-OPERATION       02859836
028599*          PERFORM 9900-DB2-ABEND                                 02859936
028600*    END-EVALUATE.                                                02860036
028601                                                                  02860100
028602******************************************************************02860200
028603*                                                                *02860300
028604*      P R O C E S S   A S N   I N P U T   R E C O R D S         *02860400
028605*                                                                *02860500
028606******************************************************************02860600
028607 2000-SPLIT-ASN-RECORDS.                                          02860700
028608***  DISPLAY '2000-SPLIT-ASN-RECORDS'.                            02860800
028609                                                                  02860900
028610*        PROCESS CORPORATE TRANSACTIONS.                          02861000
028611                                                                  02861100
028612                                                                  02861200
028613*        WRITE 'XFER' RECORDS ASSOCIATED WITH THE 'CNTL' RECORD.  02861300
028614         PERFORM 3000-WRITE-XFER-RECORDS                          02861400
028615                                                                  02861500
028616*        UPDATE 'CNTL' RECORD. (THIS FUNCTION MOVED TO SNKUP106)  02861600
028617*        PERFORM 2400-UPDATE-CNTL                                 02861700
028618                                                                  02861800
028619*        COMMIT THE DATA.  THIS IS NOW IN SNKUP106                02861900
028620*        PERFORM 2800-COMMIT                                      02862000
028621                                                                  02862100
028622*        GET NEXT 'CNTL' RECORD.                                  02862200
028623         PERFORM 2200-FETCH-CNTL-CURSOR.                          02862300
028624/                                                                 02862400
028625 2100-OPEN-CNTL-CURSOR.                                           02862500
028626                                                                  02862600
028627     EXEC SQL                                                     02862700
028628         OPEN CNTL-CSR                                            02862800
028629     END-EXEC.                                                    02862900
028630                                                                  02863000
028631     EVALUATE TRUE                                                02863100
028632       WHEN SQLCODE = ZERO                                        02863200
028633           SET PS-END-OF-CNTL-CSR-NO TO TRUE                      02863300
028634                                                                  02863400
028635       WHEN OTHER                                                 02863500
028636           MOVE '2100-OPEN-CNTL-CURSOR'                           02863600
028637                                 TO PV-ABEND-PARAGRAPH            02863700
028638           MOVE 'OPEN CNTL-CSR ' TO PV-ABEND-OPERATION            02863800
028639           PERFORM 9900-DB2-ABEND                                 02863900
028640     END-EVALUATE.                                                02864000
028641                                                                  02864100
028642*                                                                 02864200
028643 2200-FETCH-CNTL-CURSOR.                                          02864300
028644                                                                  02864400
028645     EXEC SQL                                                     02864500
028646         FETCH CNTL-CSR                                           02864600
028647          INTO :SNT00000-DAT-XFER-CNTL-ID                         02864700
028648                                                                  02864873
028649* NOT USED   , :SNT00000-CRE-TMST                                 02864900
028650* NOT USED   , :SNT00000-STAT-CDE                                 02865000
028651* NOT USED   , :SNT00000-END-PRC-TMST                             02865100
028652* NOT USED   , :SNT00000-ASN-TYP-CDE                              02865200
028653                                                                  02865373
028654     END-EXEC.                                                    02865400
028655                                                                  02865500
028656     EVALUATE TRUE                                                02865600
028700         WHEN SQLCODE = ZERO                                      02870000
028701                                                                  02870173
028702             ADD +1 TO PA-TOTAL-CNTL-READ                         02870200
028900                                                                  02890000
028901       WHEN SQLCODE = +100                                        02890173
028902           SET PS-END-OF-CNTL-CSR-YES TO TRUE                     02890200
028903                                                                  02890300
029000       WHEN OTHER                                                 02900000
029100           MOVE '2200-FETCH-CNTL-CURSOR'                          02910000
029200                                  TO PV-ABEND-PARAGRAPH           02920000
029300           MOVE 'FETCH CNTL-CSR ' TO PV-ABEND-OPERATION           02930000
029400           PERFORM 9900-DB2-ABEND                                 02940000
029500     END-EVALUATE.                                                02950000
029600                                                                  02960000
029700******************************************************************02970000
029800*2400-UPDATE-CNTL.                                                02980000
029900***  DISPLAY ' 2400-UPDATE-CNTL'.                                 02990000
030000*                                                                 03000000
030100*    EXEC SQL                                                     03010000
030200*        UPDATE SNT_DAT_CNTL                                      03020000
030300*           SET STAT_CDE         = 'C'                            03030000
030400*            ,  END_PRC_TMST     = CURRENT TIMESTAMP              03040000
030500*         WHERE DAT_XFER_CNTL_ID = :SNT00000-DAT-XFER-CNTL-ID     03050000
030600*    END-EXEC.                                                    03060000
030700*                                                                 03070000
030800*    EVALUATE TRUE                                                03080000
030900*      WHEN SQLCODE = ZERO                                        03090000
031000*          ADD +1 TO PA-TOTAL-CNTL-UPDATED                        03100000
031100*                                                                 03110000
031200*      WHEN OTHER                                                 03120000
031300*          MOVE '2400-UPDATE-CNTL'    TO PV-ABEND-PARAGRAPH       03130000
031400*          MOVE 'UPDATE SNT_DAT_CNTL' TO PV-ABEND-OPERATION       03140000
031500*          MOVE DCLSNT00000 TO PV-DB2-OPERATION-MESSAGE-1         03150000
031600*          PERFORM 9900-DB2-ABEND                                 03160000
031700*    END-EVALUATE.                                                03170000
031800*                                                                 03180000
031900******************************************************************03190000
032000 2500-CLOSE-CNTL-CURSOR.                                          03200000
032100                                                                  03210000
032200     EXEC SQL                                                     03220000
032300         CLOSE CNTL-CSR                                           03230000
032400     END-EXEC.                                                    03240000
032500                                                                  03250000
032600     EVALUATE TRUE                                                03260000
032700       WHEN SQLCODE = ZERO                                        03270000
032800           CONTINUE                                               03280000
032900                                                                  03290000
033000       WHEN OTHER                                                 03300000
033100           MOVE '2500-CLOSE-CNTL-CURSOR'                          03310000
033200                                  TO PV-ABEND-PARAGRAPH           03320000
033300           MOVE 'CLOSE CNTL-CSR ' TO PV-ABEND-OPERATION           03330000
033400           PERFORM 9900-DB2-ABEND                                 03340000
033500     END-EVALUATE.                                                03350000
033600                                                                  03360000
033700******************************************************************03370000
033800*2800-COMMIT.                                                     03380000
033900*                                                                 03390000
034000*    EXEC SQL                                                     03400000
034100*        COMMIT                                                   03410000
034200*    END-EXEC.                                                    03420000
034300*                                                                 03430000
034400*    EVALUATE TRUE                                                03440000
034500*      WHEN SQLCODE = ZERO                                        03450000
034600*          CONTINUE                                               03460000
034700*                                                                 03470000
034800*      WHEN OTHER                                                 03480000
034900*          MOVE '2800-COMMIT'        TO PV-ABEND-PARAGRAPH        03490000
035000*          MOVE 'COMMIT LOAD TABLES' TO PV-ABEND-OPERATION        03500000
035100*          PERFORM 9900-DB2-ABEND                                 03510000
035200*    END-EVALUATE.                                                03520000
035300*                                                                 03530000
035400******************************************************************03540000
035500 3000-WRITE-XFER-RECORDS.                                         03550000
035600                                                                  03560000
035700     PERFORM 3100-OPEN-XFER-CURSOR.                               03570000
035800                                                                  03580000
035900     PERFORM                                                      03590000
036000       UNTIL PS-END-OF-XFER-CSR-YES                               03600000
036100                                                                  03610000
036200          PERFORM 3200-PROCESS-XFER-ROWS                          03620000
036300                                                                  03630000
036400     END-PERFORM.                                                 03640000
036500                                                                  03650000
036600     PERFORM 3300-CLOSE-XFER-CURSOR.                              03660000
036700                                                                  03670000
036800******************************************************************03680000
036900 3100-OPEN-XFER-CURSOR.                                           03690000
037000                                                                  03700000
037100     EXEC SQL                                                     03710000
037200         OPEN XFER-CSR                                            03720000
037300     END-EXEC.                                                    03730000
037400                                                                  03740000
037500     EVALUATE TRUE                                                03750000
037600       WHEN SQLCODE = ZERO                                        03760000
037700           SET PS-END-OF-XFER-CSR-NO TO TRUE                      03770000
037800                                                                  03780000
037900       WHEN OTHER                                                 03790000
038000           MOVE '3100-OPEN-XFER-CURSOR'                           03800000
038100                                     TO PV-ABEND-PARAGRAPH        03810000
038200           MOVE 'OPEN XFER-CSR '     TO PV-ABEND-OPERATION        03820000
038300           PERFORM 9900-DB2-ABEND                                 03830000
038400     END-EVALUATE.                                                03840000
038500                                                                  03850000
038600******************************************************************03860000
038700 3200-PROCESS-XFER-ROWS.                                          03870000
038800                                                                  03880000
038900     EXEC SQL                                                     03890000
039000         FETCH XFER-CSR                                           03900000
039100          INTO :SNT00001-DAT-XFER-CNTL-ID                         03910000
039400             , :SNT00001-LOD-DAT-TXT                              03940000
039500     END-EXEC.                                                    03950000
039501                                                                  03950173
039502* NOT USED   , :SNT00001-PRC-LOD-SEQ-NBR                          03950200
039503* NOT USED   , :SNT00001-DAT-CTG-CDE                              03950300
039600                                                                  03960000
039700     EVALUATE TRUE                                                03970000
040100       WHEN SQLCODE = ZERO                                        04010000
040200           ADD +1 TO PA-TOTAL-XFER-READ                           04020000
040300           PERFORM 3250-BUILD-OUTPUT-RECORD                       04030000
040400                                                                  04040000
040401       WHEN SQLCODE = +100                                        04040173
040402           SET PS-END-OF-XFER-CSR-YES TO TRUE                     04040200
040403                                                                  04040300
040500       WHEN OTHER                                                 04050000
040600           MOVE '3200-PROCESS-XFER-ROWS' TO PV-ABEND-PARAGRAPH    04060000
040700           MOVE 'FETCH XFER ROW'         TO PV-ABEND-OPERATION    04070000
040800           PERFORM 9900-DB2-ABEND                                 04080000
040900     END-EVALUATE.                                                04090000
041000                                                                  04100000
041100******************************************************************04110000
041200 3250-BUILD-OUTPUT-RECORD.                                        04120000
041300                                                                  04130000
041400     INITIALIZE OUTPUT-RECORD                                     04140000
041500                SN005-ASN-UNPACKED                                04150000
041600                TR063-ADV-SHIP-NOTICE-DTL-REC                     04160000
041610                SN006-CONTROL-RECORD.                             04161073
041700                                                                  04170000
041900     MOVE SNT00001-LOD-DAT-TXT-TEXT TO SN005-ASN-UNPACKED.        04190000
041910*                                                                 04191073
042000                                                                  04200000
042100     IF SN005-REC-TYP-CDE = 'ID'                                  04210000
042101         PERFORM 7400-CHECK-FOR-TD5                               04210173
042102         IF PS-TD5-SW = 'Y'                                       04210200
042103             MOVE 'C'                 TO SN006-STAT-CDE           04210300
042104             PERFORM 8100-WRITE-CNTL-ID-REC                       04210473
042105         ELSE                                                     04210500
042106             PERFORM 7410-GET-TD5-VALUE                           04210600
042107             MOVE 'E'                 TO SN006-STAT-CDE           04210700
042300             MOVE SN005-ASN-UNPACKED                              04230000
042400                                      TO                          04240073
042500                                   TR063-ADV-SHIP-NOTICE-DTL-REC  04250073
042600                                                                  04260073
042700             MOVE SN005-ISA-CNTL-NBR  TO PV-MSG-ASN               04270073
042800             MOVE TR063-ISA-ID-QUAL   TO PV-MSG-ISA-ID-QUAL       04280073
042900             MOVE TR063-ISA-ID        TO PV-MSG-ISA-ID            04290073
043000             MOVE PV-TD5-VALUE        TO PV-MSG-TD5-CDE           04300073
043100                                                                  04310073
043200             DISPLAY PV-ASN-ERROR-MSG                             04320073
043300             PERFORM 8100-WRITE-CNTL-ID-REC                       04330073
043400*CHG0136579 - START                                               04340073
043500             PERFORM 8200-WRITE-ERROR-ASN-FILE                    04350073
043501*CHG0136579 - END                                                 04350173
043502         END-IF                                                   04350200
043503     END-IF                                                       04350300
043504                                                                  04350400
043505     IF PS-TD5-SW = 'Y'                                           04350500
043506                                                                  04350600
043507         EVALUATE SN005-REC-TYP-CDE                               04350700
043508            WHEN 'ID'                                             04350800
043509                 PERFORM 3251-BUILD-ID-REC                        04350973
043510                 PERFORM 8000-WRITE-ASN-FILE                      04351000
043520            WHEN 'PO4'                                            04352000
043521                 PERFORM 3252-BUILD-PO4-REC                       04352173
043522                 PERFORM 8000-WRITE-ASN-FILE                      04352200
043523                                                                  04352300
043524            WHEN 'TD1'                                            04352400
043525                 PERFORM 3253-BUILD-TD1-REC                       04352573
043526                 PERFORM 8000-WRITE-ASN-FILE                      04352600
043527                                                                  04352700
043528            WHEN 'TD5'                                            04352800
043529                 PERFORM 3254-BUILD-TD5-REC                       04352973
043530                 PERFORM 8000-WRITE-ASN-FILE                      04353000
043531                                                                  04353100
043532            WHEN 'CUR'                                            04353200
043533                 PERFORM 3255-BUILD-CUR-REC                       04353373
043534                 PERFORM 8000-WRITE-ASN-FILE                      04353400
043535                                                                  04353500
043536            WHEN 'SN1'                                            04353600
043537                 PERFORM 3256-BUILD-SN1-REC                       04353773
043538                 PERFORM 8000-WRITE-ASN-FILE                      04353800
043539                                                                  04353900
043540            WHEN 'SLN'                                            04354000
043541                 PERFORM 3257-BUILD-SLN-REC                       04354173
043542                 PERFORM 8000-WRITE-ASN-FILE                      04354200
043543                                                                  04354300
043544            WHEN OTHER                                            04354400
043545                 PERFORM 3258-BUILD-OTHER-REC                     04354573
043546                 PERFORM 8000-WRITE-ASN-FILE                      04354600
043547         END-EVALUATE                                             04354700
043548                                                                  04354800
043549     END-IF.                                                      04354900
043550                                                                  04355000
043551 3251-BUILD-ID-REC.                                               04355173
043552     MOVE SN005-ASN-UNPACKED    TO TR063-ADV-SHIP-NOTICE-DTL-REC  04355200
043553     MOVE SN005-ISA-CNTL-NBR    TO TR063-ISA-CNTL-NBR-SEQ         04355300
043554                                   PV-SAVE-ISA-CNTL-NBR           04355400
043555     MOVE SN005-BSN02-SHIPT-ID  TO TR063-SHIPT-ID-SEQ             04355500
043556                                    PV-SAVE-SHIPT-ID-SEQ          04355600
043557     MOVE SNT00001-DAT-XFER-CNTL-ID TO TR063-DAT-XFER-CNTL        04355700
043558                                     PV-SAVE-DAT-XFER-CNTL.       04355800
043559 3252-BUILD-PO4-REC.                                              04355973
043560     INITIALIZE DP010I-UNEDITED-FIELD                             04356000
043561                WS-NUMERIC-4                                      04356100
043562     MOVE SN005-PO401-PKG-SIZE-QTY TO DP010I-UNEDITED-FIELD       04356200
043563     PERFORM 7100-NUMERIC-4                                       04356300
043564     MOVE WS-NUMERIC-4 TO TR063-PO401-PKG-SIZE-QTY                04356400
043565     INITIALIZE DP010I-UNEDITED-FIELD                             04356500
043566                WS-NUMERIC-1                                      04356600
043567     MOVE SN005-PO402-SIZE-MSMT TO DP010I-UNEDITED-FIELD          04356700
043568     PERFORM 7000-NUMERIC-1                                       04356800
043569     IF WS-NUMERIC-1 > 0                                          04356900
043570         COMPUTE TR063-PO402-SIZE-MSMT =                          04357000
043571                 WS-NUMERIC-1 / 100                               04357100
043572         END-COMPUTE                                              04357200
043573     ELSE                                                         04357300
043574         MOVE 0 TO TR063-PO402-SIZE-MSMT                          04357400
043575     END-IF                                                       04357500
043576     INITIALIZE DP010I-UNEDITED-FIELD                             04357600
043577                WS-NUMERIC-1                                      04357700
043578     MOVE SN005-PO406-GRO-WGHT-MSMT TO DP010I-UNEDITED-FIELD      04357800
043579     PERFORM 7000-NUMERIC-1                                       04357900
043580     COMPUTE TR063-PO406-GRO-WGHT-MSMT =                          04358000
043581              WS-NUMERIC-1 / 100                                  04358100
043582     END-COMPUTE                                                  04358200
043583     INITIALIZE DP010I-UNEDITED-FIELD                             04358300
043584                WS-NUMERIC-1                                      04358400
043585     MOVE SN005-PO408-GRO-VOL-MSMT TO DP010I-UNEDITED-FIELD       04358500
043586     PERFORM 7000-NUMERIC-1                                       04358600
043587     COMPUTE TR063-PO408-GRO-VOL-MSMT =                           04358700
043588              WS-NUMERIC-1 / 100                                  04358800
043589     END-COMPUTE                                                  04358900
043590     INITIALIZE DP010I-UNEDITED-FIELD                             04359000
043591                WS-NUMERIC-1                                      04359100
043592     MOVE SN005-PO410-LEN-MSMT TO DP010I-UNEDITED-FIELD           04359200
043593     PERFORM 7000-NUMERIC-1                                       04359300
043594     IF WS-NUMERIC-1 > ZERO                                       04359400
043595         COMPUTE TR063-PO410-LEN-MSMT =                           04359500
043596                 WS-NUMERIC-1 / 100                               04359600
043597         END-COMPUTE                                              04359700
043598     ELSE                                                         04359800
043599         MOVE ZERO TO TR063-PO410-LEN-MSMT                        04359900
043600     END-IF                                                       04360000
043601     INITIALIZE DP010I-UNEDITED-FIELD                             04360100
043602                WS-NUMERIC-1                                      04360200
043603     MOVE SN005-PO411-WDTH-MSMT TO DP010I-UNEDITED-FIELD          04360300
043604     PERFORM 7000-NUMERIC-1                                       04360400
043605     IF WS-NUMERIC-1 > ZERO                                       04360500
043606         COMPUTE TR063-PO411-WDTH-MSMT =                          04360600
043607                 WS-NUMERIC-1 / 100                               04360700
043608         END-COMPUTE                                              04360800
043609     ELSE                                                         04360900
043610         MOVE ZERO TO TR063-PO411-WDTH-MSMT                       04361000
043611     END-IF                                                       04361100
043612     INITIALIZE DP010I-UNEDITED-FIELD                             04361200
043613                WS-NUMERIC-1                                      04361300
043614     MOVE SN005-PO412-HT-MSMT TO DP010I-UNEDITED-FIELD            04361400
043615     PERFORM 7000-NUMERIC-1                                       04361500
043616     IF WS-NUMERIC-1 > ZERO                                       04361600
043617         COMPUTE TR063-PO412-HT-MSMT =                            04361700
043618                 WS-NUMERIC-1 / 100                               04361800
043619         END-COMPUTE                                              04361900
043620     ELSE                                                         04362000
043621         MOVE ZERO TO TR063-PO412-HT-MSMT                         04362100
043622     END-IF                                                       04362200
043623     MOVE SN005-PO4-ID TO TR063-PO4-ID                            04362300
043624     MOVE SN005-PO403-SIZE-UM-CDE TO                              04362400
043625              TR063-PO403-SIZE-UM-CDE                             04362500
043626     MOVE SN005-PO405-WGHT-QUAL-CDE TO                            04362600
043627              TR063-PO405-WGHT-QUAL-CDE                           04362700
043628     MOVE SN005-PO407-WGHT-UM-CDE TO                              04362800
043629              TR063-PO407-WGHT-UM-CDE                             04362900
043630     MOVE SN005-PO409-VOL-UM-CDE TO                               04363000
043631              TR063-PO409-VOL-UM-CDE                              04363100
043632     MOVE SN005-PO413-UM-CDE TO                                   04363200
043633              TR063-PO413-UM-CDE                                  04363300
043634     MOVE SN005-PO414-INPK-EA-QTY TO                              04363400
043635              TR063-PO414-INPK-EA-QTY                             04363500
043636     MOVE SPACE TO TR063-PO4-FILLER                               04363600
043637                                                                  04363700
043638     MOVE PV-SAVE-ISA-CNTL-NBR                                    04363800
043639                TO TR063-ISA-CNTL-NBR-SEQ-PO4                     04363900
043640     MOVE PV-SAVE-SHIPT-ID-SEQ                                    04364000
043641                TO TR063-SHIPT-ID-SEQ-PO4                         04364100
043642     MOVE PV-SAVE-DAT-XFER-CNTL                                   04364200
043643                TO TR063-DAT-XFER-CNTL-PO4.                       04364300
043644                                                                  04364473
043645 3253-BUILD-TD1-REC.                                              04364573
043646     INITIALIZE DP010I-UNEDITED-FIELD                             04364600
043647                WS-NUMERIC-4                                      04364700
043648     MOVE SN005-TD102-SHIPT-QTY TO DP010I-UNEDITED-FIELD          04364800
043649     PERFORM 7100-NUMERIC-4                                       04364900
043650     MOVE WS-NUMERIC-4 TO TR063-TD102-SHIPT-QTY                   04365000
043651     INITIALIZE DP010I-UNEDITED-FIELD                             04365100
043652                WS-NUMERIC-1                                      04365200
043653     MOVE SN005-TD107-WGHT-MSMT TO DP010I-UNEDITED-FIELD          04365300
043654     PERFORM 7000-NUMERIC-1                                       04365400
043655     IF WS-NUMERIC-1 > 0                                          04365500
043656         COMPUTE TR063-TD107-WGHT-MSMT =                          04365600
043657                 WS-NUMERIC-1 / 100                               04365700
043658         END-COMPUTE                                              04365800
043659     ELSE                                                         04365900
043660         MOVE ZERO TO TR063-TD107-WGHT-MSMT                       04366000
043661     END-IF                                                       04366100
043662     MOVE SN005-TD1-ID TO TR063-TD1-ID                            04366200
043663     MOVE SN005-TD101-PKG-CDE TO TR063-TD101-PKG-CDE              04366300
043664     MOVE SN005-TD106-WGHT-QUAL-CDE TO                            04366400
043665              TR063-TD106-WGHT-QUAL-CDE                           04366500
043666     MOVE SN005-TD108-UM-CDE TO                                   04366600
043667              TR063-TD108-UM-CDE                                  04366700
043668     MOVE SPACES TO TR063-TD1-FILLER                              04366800
043669                                                                  04366900
043670     MOVE PV-SAVE-ISA-CNTL-NBR                                    04367000
043671                TO TR063-ISA-CNTL-NBR-SEQ-TD1                     04367100
043672     MOVE PV-SAVE-SHIPT-ID-SEQ                                    04367200
043673                TO TR063-SHIPT-ID-SEQ-TD1                         04367300
043674     MOVE PV-SAVE-DAT-XFER-CNTL                                   04367400
043675                TO TR063-DAT-XFER-CNTL-TD1.                       04367500
043676                                                                  04367673
043677 3254-BUILD-TD5-REC.                                              04367773
043678     INITIALIZE DP010I-UNEDITED-FIELD                             04367800
043679                WS-NUMERIC-3                                      04367900
043680     MOVE SN005-TD511-TRNST-TIME TO DP010I-UNEDITED-FIELD         04368000
043681     PERFORM 7200-NUMERIC-3                                       04368100
043682     IF WS-NUMERIC-3 > ZERO                                       04368200
043683         COMPUTE TR063-TD511-TRNST-TIME =                         04368300
043684                 WS-NUMERIC-3 / 100000                            04368400
043685         END-COMPUTE                                              04368500
043686     ELSE                                                         04368600
043687         MOVE ZERO TO TR063-TD511-TRNST-TIME                      04368700
043688     END-IF                                                       04368800
043689     MOVE SN005-TD5-ID TO                                         04368900
043690              TR063-TD5-ID                                        04369000
043691     MOVE SN005-TD501-RTE-SEQ-CDE TO                              04369100
043692              TR063-TD501-RTE-SEQ-CDE                             04369200
043693     MOVE SN005-TD502-CARR-ID-QUAL-CDE TO                         04369300
043694              TR063-TD502-CARR-ID-QUAL-CDE                        04369400
043695     MOVE SN005-TD503-CARR-ID-CDE TO                              04369500
043696              TR063-TD503-CARR-ID-CDE                             04369600
043697     MOVE SN005-TD504-TRANS-MTHD-CDE TO                           04369700
043698              TR063-TD504-TRANS-MTHD-CDE                          04369800
043699     MOVE SN005-TD505-CARR-NME TO                                 04369900
043700              TR063-TD505-CARR-NME                                04370000
043701     MOVE SN005-TD506-STATUS-CDE TO                               04370100
043702              TR063-TD506-STATUS-CDE                              04370200
043703     MOVE SN005-TD507-LOC-QUAL TO                                 04370300
043704              TR063-TD507-LOC-QUAL                                04370400
043705     MOVE SN005-TD508-LOC-ID TO                                   04370500
043706              TR063-TD508-LOC-ID                                  04370600
043707     MOVE SN005-TD510-TRNS-TME-QUAL-CDE TO                        04370700
043708              TR063-TD510-TRNS-TME-QUAL-CDE                       04370800
043709     MOVE SPACES TO TR063-TD5-FILLER                              04370900
043710     MOVE PV-SAVE-ISA-CNTL-NBR                                    04371000
043711                TO TR063-ISA-CNTL-NBR-SEQ-TD5                     04371100
043712     MOVE PV-SAVE-SHIPT-ID-SEQ                                    04371200
043713                TO TR063-SHIPT-ID-SEQ-TD5                         04371300
043714     MOVE PV-SAVE-DAT-XFER-CNTL                                   04371400
043715                TO TR063-DAT-XFER-CNTL-TD5.                       04371500
043716                                                                  04371600
043717 3255-BUILD-CUR-REC.                                              04371773
043718     INITIALIZE DP010I-UNEDITED-FIELD                             04371800
043719                WS-NUMERIC-2                                      04371900
043720     MOVE SN005-CUR03-EXCH-FCTR TO DP010I-UNEDITED-FIELD          04372000
043721     PERFORM 7300-NUMERIC-2                                       04372100
043722     IF WS-NUMERIC-2 > ZERO                                       04372200
043723         COMPUTE TR063-CUR03-EXCH-FCTR =                          04372300
043724                 WS-NUMERIC-2 / 100000                            04372400
043725         END-COMPUTE                                              04372500
043726     ELSE                                                         04372600
043727         MOVE ZERO TO TR063-CUR03-EXCH-FCTR                       04372700
043728     END-IF                                                       04372800
043729     MOVE SN005-CUR-ID TO                                         04372900
043730              TR063-CUR-ID                                        04373000
043731     MOVE SN005-CUR01-ID-CDE TO                                   04373100
043732              TR063-CUR01-ID-CDE                                  04373200
043733     MOVE SN005-CUR02-CURR-CDE TO                                 04373300
043734              TR063-CUR02-CURR-CDE                                04373400
043735     MOVE SN005-CUR04-ID-CDE TO                                   04373500
043736              TR063-CUR04-ID-CDE                                  04373600
043737     MOVE SN005-CUR05-CURR-CDE TO                                 04373700
043738              TR063-CUR05-CURR-CDE                                04373800
043739     MOVE SPACES TO TR063-CUR-FILLER                              04373900
043740     MOVE PV-SAVE-ISA-CNTL-NBR                                    04374000
043741                TO TR063-ISA-CNTL-NBR-SEQ-CUR                     04374100
043742     MOVE PV-SAVE-SHIPT-ID-SEQ                                    04374200
043743                TO TR063-SHIPT-ID-SEQ-CUR                         04374300
043744     MOVE PV-SAVE-DAT-XFER-CNTL                                   04374400
043745                TO TR063-DAT-XFER-CNTL-CUR.                       04374500
043746                                                                  04374600
043747 3256-BUILD-SN1-REC.                                              04374773
043748     INITIALIZE DP010I-UNEDITED-FIELD                             04374800
043749                WS-NUMERIC-4                                      04374900
043750     MOVE SN005-SN102-SHIP-QTY TO DP010I-UNEDITED-FIELD           04375000
043751     PERFORM 7100-NUMERIC-4                                       04375100
043752     MOVE WS-NUMERIC-4 TO TR063-SN102-SHIP-QTY                    04375200
043753     INITIALIZE DP010I-UNEDITED-FIELD                             04375300
043754                WS-NUMERIC-4                                      04375400
043755     MOVE SN005-SN104-SHIPT-DTE-QTY TO DP010I-UNEDITED-FIELD      04375500
043756     PERFORM 7100-NUMERIC-4                                       04375600
043757     MOVE WS-NUMERIC-4 TO TR063-SN104-SHIPT-DTE-QTY               04375700
043758     INITIALIZE DP010I-UNEDITED-FIELD                             04375800
043759                WS-NUMERIC-4                                      04375900
043760     MOVE SN005-SN105-ORD-QTY TO DP010I-UNEDITED-FIELD            04376000
043761     PERFORM 7100-NUMERIC-4                                       04376100
043762     MOVE WS-NUMERIC-4 TO TR063-SN105-ORD-QTY                     04376200
043763     MOVE SN005-SN1-ID TO                                         04376300
043764              TR063-SN1-ID                                        04376400
043765     MOVE SN005-SN101-ID-CDE TO                                   04376500
043766              TR063-SN101-ID-CDE                                  04376600
043767     MOVE SN005-SN103-SHIP-UM-CDE TO                              04376700
043768              TR063-SN103-SHIP-UM-CDE                             04376800
043769     MOVE PV-SAVE-ISA-CNTL-NBR                                    04376900
043770                TO TR063-ISA-CNTL-NBR-SEQ-SN1                     04377000
043771     MOVE PV-SAVE-SHIPT-ID-SEQ                                    04377100
043772                TO TR063-SHIPT-ID-SEQ-SN1                         04377200
043773     MOVE PV-SAVE-DAT-XFER-CNTL                                   04377300
043774                TO TR063-DAT-XFER-CNTL-SN1.                       04377400
043775                                                                  04377500
043776 3257-BUILD-SLN-REC.                                              04377673
043777     INITIALIZE DP010I-UNEDITED-FIELD                             04377700
043778                WS-NUMERIC-4                                      04377800
043779     MOVE SN005-SLN04-QTY TO DP010I-UNEDITED-FIELD                04377900
043780     PERFORM 7100-NUMERIC-4                                       04378000
043781     MOVE WS-NUMERIC-4 TO TR063-SLN04-QTY                         04378100
043782     INITIALIZE DP010I-UNEDITED-FIELD                             04378200
043783                WS-NUMERIC-1                                      04378300
043784     MOVE SN005-SLN06-UNIT-PRICE-AMT TO                           04378400
043785              DP010I-UNEDITED-FIELD                               04378500
043786     PERFORM 7000-NUMERIC-1                                       04378600
043787     IF WS-NUMERIC-1 > ZERO                                       04378700
043788         COMPUTE TR063-SLN06-UNIT-PRICE-AMT =                     04378800
043789                 WS-NUMERIC-1 / 100                               04378900
043790         END-COMPUTE                                              04379000
043791     ELSE                                                         04379100
043792         MOVE ZERO TO TR063-SLN06-UNIT-PRICE-AMT                  04379200
043793     END-IF                                                       04379300
043794     MOVE SN005-SLN-ID TO                                         04379400
043795              TR063-SLN-ID                                        04379500
043796     MOVE SN005-SLN01-ID TO                                       04379600
043797              TR063-SLN01-ID                                      04379700
043798     MOVE SN005-SLN03-CONFIG-CDE TO                               04379800
043799              TR063-SLN03-CONFIG-CDE                              04379900
043800     MOVE SN005-SLN05-UM-CDE TO                                   04380000
043801              TR063-SLN05-UM-CDE                                  04380100
043802     MOVE SN005-SLN07-UNIT-PRICE-CDE TO                           04380200
043803              TR063-SLN07-UNIT-PRICE-CDE                          04380300
043804     MOVE SN005-SLN08-PRICE-CD TO                                 04380400
043805              TR063-SLN08-PRICE-CD                                04380500
043806     MOVE SN005-SLN09-PROD-ID-QUAL-CDE(1) TO                      04380600
043807              TR063-SLN09-PROD-ID-QUAL-CDE(1)                     04380700
043808     MOVE SN005-SLN10-PROD-ID(1) TO                               04380800
043809              TR063-SLN10-PROD-ID(1)                              04380900
043810     MOVE SN005-SLN09-PROD-ID-QUAL-CDE(2) TO                      04381000
043811              TR063-SLN09-PROD-ID-QUAL-CDE(2)                     04381100
043812     MOVE SN005-SLN10-PROD-ID(2) TO                               04381200
043813              TR063-SLN10-PROD-ID(2)                              04381300
043814     MOVE SN005-SLN09-PROD-ID-QUAL-CDE(3) TO                      04381400
043815              TR063-SLN09-PROD-ID-QUAL-CDE(3)                     04381500
043816     MOVE SN005-SLN10-PROD-ID(3) TO                               04381600
043817              TR063-SLN10-PROD-ID(3)                              04381700
043818     MOVE SN005-SLN09-PROD-ID-QUAL-CDE(4) TO                      04381800
043819              TR063-SLN09-PROD-ID-QUAL-CDE(4)                     04381900
043820     MOVE SN005-SLN10-PROD-ID(4) TO                               04382000
043821              TR063-SLN10-PROD-ID(4)                              04382100
043822     MOVE SN005-SLN09-PROD-ID-QUAL-CDE(5) TO                      04382200
043823              TR063-SLN09-PROD-ID-QUAL-CDE(5)                     04382300
043824     MOVE SN005-SLN10-PROD-ID(5) TO                               04382400
043825              TR063-SLN10-PROD-ID(5)                              04382500
043826     MOVE SN005-SLN09-PROD-ID-QUAL-CDE(6) TO                      04382600
043827              TR063-SLN09-PROD-ID-QUAL-CDE(6)                     04382700
043828     MOVE SN005-SLN10-PROD-ID(6) TO                               04382800
043829              TR063-SLN10-PROD-ID(6)                              04382900
043830     MOVE SN005-SLN09-PROD-ID-QUAL-CDE(7) TO                      04383000
043831              TR063-SLN09-PROD-ID-QUAL-CDE(7)                     04383100
043832     MOVE SN005-SLN10-PROD-ID(7) TO                               04383200
043833              TR063-SLN10-PROD-ID(7)                              04383300
043834     MOVE SN005-SLN09-PROD-ID-QUAL-CDE(8) TO                      04383400
043835              TR063-SLN09-PROD-ID-QUAL-CDE(8)                     04383500
043836     MOVE SN005-SLN10-PROD-ID(8) TO                               04383600
043837              TR063-SLN10-PROD-ID(8)                              04383700
043838     MOVE SN005-SLN09-PROD-ID-QUAL-CDE(9) TO                      04383800
043839              TR063-SLN09-PROD-ID-QUAL-CDE(9)                     04383900
043840     MOVE SN005-SLN10-PROD-ID(9) TO                               04384000
043841              TR063-SLN10-PROD-ID(9)                              04384100
043842     MOVE SPACES TO TR063-SLN09-PROD-ID-QUAL-CDE(10)              04384200
043843     MOVE SPACES TO TR063-SLN10-PROD-ID(10)                       04384300
043844     MOVE SPACES TO TR063-SLN-FILLER                              04384400
043845     MOVE PV-SAVE-ISA-CNTL-NBR                                    04384500
043846                TO TR063-ISA-CNTL-NBR-SEQ-SLN                     04384600
043847     MOVE PV-SAVE-SHIPT-ID-SEQ                                    04384700
043848                TO TR063-SHIPT-ID-SEQ-SLN                         04384800
043849     MOVE PV-SAVE-DAT-XFER-CNTL                                   04384900
043850                TO TR063-DAT-XFER-CNTL-SLN.                       04385000
043860                                                                  04386000
043861 3258-BUILD-OTHER-REC.                                            04386173
043862     MOVE SN005-ASN-UNPACKED                                      04386200
043863                TO TR063-ADV-SHIP-NOTICE-DTL-REC                  04386373
043864                                                                  04386400
043865     MOVE PV-SAVE-ISA-CNTL-NBR                                    04386500
043866                TO TR063-ISA-CNTL-NBR-SEQ                         04386600
043867     MOVE PV-SAVE-SHIPT-ID-SEQ                                    04386700
043868                TO TR063-SHIPT-ID-SEQ                             04386800
043869     MOVE PV-SAVE-DAT-XFER-CNTL                                   04386900
043870                TO TR063-DAT-XFER-CNTL.                           04387000
043871                                                                  04387100
043872******************************************************************04387200
043873 3300-CLOSE-XFER-CURSOR.                                          04387300
043874                                                                  04387400
043875     EXEC SQL                                                     04387500
043876         CLOSE XFER-CSR                                           04387600
043877     END-EXEC.                                                    04387700
043878                                                                  04387800
043879     EVALUATE TRUE                                                04387900
043880       WHEN SQLCODE = ZERO                                        04388000
043881           CONTINUE                                               04388100
043882                                                                  04388200
043883       WHEN OTHER                                                 04388300
043884           MOVE '3300-CLOSE-XFER-CURSOR' TO PV-ABEND-PARAGRAPH    04388400
043885           MOVE 'CLOSE XFER-CSR '        TO PV-ABEND-OPERATION    04388500
043886           PERFORM 9900-DB2-ABEND                                 04388600
043887     END-EVALUATE.                                                04388700
043888                                                                  04388800
043889 7000-NUMERIC-1.                                                  04388900
043900     MOVE 11 TO DP010I-MAXIMUM-DIGITS                             04390000
044000     MOVE 0 TO DP010I-MAXIMUM-DECIMALS                            04400000
044100     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                      04410000
044200     CALL DP010I-NUMERIC-EDIT-ROUTINE                             04420073
044210          USING DP010I-NUMERIC-EDIT-AREA                          04421073
044300     IF DP010I-ERROR-DETECTED                                     04430000
044400         MOVE ZEROES TO WS-NUMERIC-1                              04440000
044410     ELSE                                                         04441000
044420         MOVE DP010I-NUMERIC-FIELD TO WS-NUMERIC-1                04442000
044430     END-IF.                                                      04443000
044440                                                                  04444000
044450 7100-NUMERIC-4.                                                  04445000
044460     MOVE 7 TO DP010I-MAXIMUM-DIGITS                              04446000
044470     MOVE 0 TO DP010I-MAXIMUM-DECIMALS                            04447000
044480     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                      04448000
044490     CALL DP010I-NUMERIC-EDIT-ROUTINE                             04449073
044491          USING DP010I-NUMERIC-EDIT-AREA                          04449173
044500     IF DP010I-ERROR-DETECTED                                     04450000
044600         MOVE ZEROES TO WS-NUMERIC-4                              04460000
044700     ELSE                                                         04470000
044800         MOVE DP010I-NUMERIC-FIELD TO WS-NUMERIC-4                04480000
044900     END-IF.                                                      04490000
045000                                                                  04500000
045100 7200-NUMERIC-3.                                                  04510000
045200     MOVE 9 TO DP010I-MAXIMUM-DIGITS                              04520000
045300     MOVE 0 TO DP010I-MAXIMUM-DECIMALS                            04530000
045400     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                      04540000
045500     CALL DP010I-NUMERIC-EDIT-ROUTINE                             04550073
045510          USING DP010I-NUMERIC-EDIT-AREA                          04551073
045600     IF DP010I-ERROR-DETECTED                                     04560000
045700         MOVE ZEROES TO WS-NUMERIC-3                              04570000
045800     ELSE                                                         04580000
045900         MOVE DP010I-NUMERIC-FIELD TO WS-NUMERIC-3                04590000
046000     END-IF.                                                      04600000
046100                                                                  04610000
046200 7300-NUMERIC-2.                                                  04620000
046300     MOVE 11 TO DP010I-MAXIMUM-DIGITS                             04630000
046400     MOVE 0 TO DP010I-MAXIMUM-DECIMALS                            04640000
046500     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                      04650000
046600     CALL DP010I-NUMERIC-EDIT-ROUTINE                             04660073
046610          USING DP010I-NUMERIC-EDIT-AREA                          04661073
046700     IF DP010I-ERROR-DETECTED                                     04670000
046701         MOVE ZEROES TO WS-NUMERIC-2                              04670100
046702     ELSE                                                         04670200
046703         MOVE DP010I-NUMERIC-FIELD TO WS-NUMERIC-2                04670300
046704     END-IF.                                                      04670400
046705                                                                  04670500
046706 7400-CHECK-FOR-TD5.                                              04670673
046707                                                                  04670700
046708     MOVE 'N'                         TO PS-TD5-SW                04670800
046709                                                                  04670973
046710     EXEC SQL                                                     04671000
046720         SELECT 'Y'                                               04672000
046721             ,   SUBSTR(LOD_DAT_TXT,25,1)                         04672173
046722             INTO :PS-TD5-SW                                      04672200
046723             ,    :PV-TD5-VALUE                                   04672373
046724         FROM SNT_DAT_XFER                                        04672473
046725         WHERE                                                    04672573
046726             DAT_XFER_CNTL_ID = :SNT00000-DAT-XFER-CNTL-ID        04672673
046727             AND DAT_CTG_CDE = 'TD5'                              04672773
046728             AND SUBSTR(LOD_DAT_TXT,25,1) IN ('A', 'S')           04672873
046729         FETCH FIRST 1 ROW ONLY                                   04672973
046730     END-EXEC.                                                    04673000
046731                                                                  04673100
046732     EVALUATE TRUE                                                04673200
046733         WHEN SQLCODE = ZERO                                      04673300
046734         WHEN SQLCODE = +100                                      04673400
046735             CONTINUE                                             04673500
046736                                                                  04673600
046737       WHEN OTHER                                                 04673700
046738           MOVE '7400-CHECK-FOR-TD5'                              04673800
046739                                  TO PV-ABEND-PARAGRAPH           04673900
046740           MOVE 'SELECT TD5     ' TO PV-ABEND-OPERATION           04674000
046741           PERFORM 9900-DB2-ABEND                                 04674100
046742     END-EVALUATE.                                                04674200
046743                                                                  04674373
046744 7410-GET-TD5-VALUE.                                              04674400
046745                                                                  04674573
046746     INITIALIZE PV-TD5-VALUE                                      04674673
046747     EXEC SQL                                                     04674700
046748         SELECT                                                   04674800
046749               SUBSTR(LOD_DAT_TXT,25,1)                           04674973
046750             INTO                                                 04675000
046760               :PV-TD5-VALUE                                      04676073
046770         FROM SNT_DAT_XFER                                        04677073
046780         WHERE                                                    04678073
046790             DAT_XFER_CNTL_ID = :SNT00000-DAT-XFER-CNTL-ID        04679073
046800             AND DAT_CTG_CDE = 'TD5'                              04680073
046801         FETCH FIRST 1 ROW ONLY                                   04680173
046802     END-EXEC.                                                    04680200
046803                                                                  04680300
046804     EVALUATE TRUE                                                04680400
046805         WHEN SQLCODE = ZERO                                      04680500
046806         WHEN SQLCODE = +100                                      04680600
046807             CONTINUE                                             04680700
046808                                                                  04680800
046809       WHEN OTHER                                                 04680900
046810           MOVE '7410-GET-TD5-VALUE'                              04681000
046811                                  TO PV-ABEND-PARAGRAPH           04681100
046812           MOVE 'SELECT TD5     ' TO PV-ABEND-OPERATION           04681200
046813           PERFORM 9900-DB2-ABEND                                 04681300
046814     END-EVALUATE.                                                04681400
046815/                                                                 04681500
046816 8000-WRITE-ASN-FILE.                                             04681600
046817*    DISPLAY '8000-WRITE-ASN-FILE'.                               04681700
046818     WRITE OUTPUT-RECORD                                          04681800
046819         FROM TR063-ADV-SHIP-NOTICE-DTL-REC.                      04681900
046820                                                                  04682000
046830     ADD +1 TO PA-TOTAL-XFER-WRITTEN.                             04683000
046831                                                                  04683173
046832 8100-WRITE-CNTL-ID-REC.                                          04683200
046833*                                                                 04683300
046834     MOVE SNT00000-DAT-XFER-CNTL-ID   TO SN006-DAT-XFER-CNTL-ID   04683473
046835                                                                  04683573
046836     WRITE CNTL-ID-RECORD                                         04683600
046837         FROM SN006-CONTROL-RECORD.                               04683700
046838                                                                  04683800
046839     ADD +1 TO PA-TOTAL-CNTL-WRITTEN.                             04683900
046840                                                                  04684073
046841*CHG0136579 - START                                               04684173
046842 8200-WRITE-ERROR-ASN-FILE.                                       04684200
046843*    DISPLAY '8200-WRITE-ERROR-ASN-FILE'.                         04684300
046844     WRITE OUTPUT-ERROR-RECORD                                    04684400
046845         FROM PV-ASN-ERROR-MSG.                                   04684500
046846                                                                  04684600
046847     ADD +1 TO PA-TOTAL-ERROR-WRITTEN.                            04684700
046848*CHG0136579 - END                                                 04684873
046849                                                                  04684973
046850 9000-EOJ-ROUTINE.                                                04685000
046851                                                                  04685100
046852*CLOSE THE 'CNTL' CURSOR.                                         04685200
046853                                                                  04685373
046854     DISPLAY ' '.                                                 04685400
046855     DISPLAY '*******************************************'.       04685500
046856     DISPLAY '      * SNKUP104 SUMMARY STATISTICS *      '.       04685600
046857     DISPLAY ' '.                                                 04685700
046858     DISPLAY '     --------------------------------    '.         04685800
046859     DISPLAY '     INPUT REPOSITORY EXTRACT RESULTS    '.         04685900
046860     DISPLAY '     --------------------------------    '.         04686000
046861     MOVE PA-TOTAL-CNTL-READ                TO PV-DISPLAY-RECORD. 04686100
046862     DISPLAY '  CORPORATE ASN HDR ROWS READ =' PV-DISPLAY-RECORD. 04686200
046863     MOVE PA-TOTAL-XFER-READ                TO PV-DISPLAY-RECORD. 04686300
046864     DISPLAY '  CORPORATE ASN DTL ROWS READ =' PV-DISPLAY-RECORD. 04686400
046865     MOVE PA-TOTAL-XFER-WRITTEN             TO PV-DISPLAY-RECORD. 04686500
046866     DISPLAY '  CORP ASN DTL ROWS WRITTEN   =' PV-DISPLAY-RECORD. 04686600
046867*CHG0136579 - START                                               04686773
046868     MOVE PA-TOTAL-ERROR-WRITTEN            TO PV-DISPLAY-RECORD. 04686800
046869     DISPLAY '  CORP ASN ERR ROWS WRITTEN   =' PV-DISPLAY-RECORD. 04686900
046870*CHG0136579 - END                                                 04687073
046871     DISPLAY '*******************************************'.       04687100
046872                                                                  04687200
046873     PERFORM 2500-CLOSE-CNTL-CURSOR.                              04687300
046874                                                                  04687473
046875     CLOSE OUTPUT-FILE                                            04687500
046876           CNTL-ID-FILE                                           04687673
046877*CHG0136579 - START                                               04687773
046878           OUTPUT-ERROR-FILE.                                     04687873
046879*CHG0136579 - END                                                 04687973
046880                                                                  04688000
046881     DISPLAY SPACES.                                              04688100
046882     DISPLAY '************  END OF SNKUP104  ***************'.    04688200
046883                                                                  04688373
046884******************************************************************04688400
046885* 9900-DB2-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      04688500
046886* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 04688600
046887******************************************************************04688700
046888 9900-DB2-ABEND.                                                  04688800
046889                                                                  04688900
046890     MOVE SQLCODE    TO PV-SQLCODE.                               04689000
046891     MOVE PV-SQLCODE TO PV-DISPLAY-SQLCODE.                       04689100
046892     DISPLAY '*** DB2 ERROR ***'.                                 04689200
046900     DISPLAY '*** SQLCODE   = ' PV-DISPLAY-SQLCODE.               04690000
047000     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 04700000
047100     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               04710000
047200     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               04720000
047300     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       04730000
047400     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             04740000
047500                                                                  04750000
047600******************************************************************04760000
047700* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    04770000
047800* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         04780000
047900* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     04790000
048000* FORMAT.                                                         04800000
048100******************************************************************04810000
048200     COPY DPPD004.                                                04820000
048300                                                                  04830000
048400     IF SQLCODE NOT = -911                                        04840000
048500         EXEC SQL                                                 04850000
048600             ROLLBACK                                             04860000
048700         END-EXEC                                                 04870000
048800     END-IF.                                                      04880000
048900                                                                  04890000
049000     MOVE +4013         TO PV-ABEND-CODE.                         04900000
049100     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         04910000
049200******************************************************************04920000
