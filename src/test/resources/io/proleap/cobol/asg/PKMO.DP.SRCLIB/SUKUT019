000100******************************************************************00010012
000200 IDENTIFICATION DIVISION.                                         00020012
000300******************************************************************00030012
000400                                                                  00040012
000500 PROGRAM-ID.    SUKUT019.                                         00050012
000600 AUTHOR.        STEPHANIE HERON.                                  00060012
000700 INSTALLATION.  KOHLS.                                            00070012
000800 DATE-WRITTEN   DECEMBER, 1997.                                   00080012
000900 DATE-COMPILED.                                                   00090012
001000                                                                  00100012
001100******************************************************************00110012
001200*  THIS PROGRAM CREATES AN EXTRACT FILE OF AUDITS THAT CAN BE     00120012
001300*  DELETED FROM THE AUDIT DATABASE.  IT WILL ALSO CREATE A FILE   00130012
001400*  OF CARTONS THAT ARE INVOLVED IN THE AUDITS, IF THESE CARTONS AR00140012
001500*  NOT ON ANY OTHER AUDITS THEY THEN CAN BE DELETE FROM THE CARTON00150012
001600*  DATABASE.                                                      00160012
001700******************************************************************00170012
001800                                                                  00180012
001900******************************************************************00190012
002000 ENVIRONMENT DIVISION.                                            00200012
002100******************************************************************00210012
002200                                                                  00220012
002300 CONFIGURATION SECTION.                                           00230012
002400                                                                  00240012
002500 SOURCE-COMPUTER.        IBM-3090.                                00250012
002600 OBJECT-COMPUTER.        IBM-3090.                                00260012
002700                                                                  00270012
002800 INPUT-OUTPUT SECTION.                                            00280012
002900                                                                  00290012
003000 FILE-CONTROL.                                                    00300012
003100                                                                  00310012
003200     SELECT SUNAUD-OUTPUT-FILE                                    00320012
003300         ASSIGN TO OUT01.                                         00330012
003400                                                                  00340012
003500     SELECT SHPUNT-OUTPUT-FILE                                    00350012
003600         ASSIGN TO OUT02.                                         00360012
003700                                                                  00370012
003800     SELECT SUATRN-AUDIT-FILE                                     00380012
003900         ASSIGN TO OUT03.                                         00390012
003910                                                                  00391012
003920     SELECT SUT00015-AUDIT-FILE                                   00392012
003930         ASSIGN TO OUT04.                                         00393012
004000******************************************************************00400012
004100 DATA DIVISION.                                                   00410012
004200******************************************************************00420012
004300                                                                  00430012
004400 FILE SECTION.                                                    00440012
004500                                                                  00450012
004600 FD  SUNAUD-OUTPUT-FILE                                           00460012
004700     RECORDING MODE IS F                                          00470012
004800     LABEL RECORDS ARE STANDARD                                   00480012
004900     BLOCK CONTAINS 0 RECORDS.                                    00490012
005000                                                                  00500012
005100 01  SUNAUD-OUTPUT-RECORD       PIC  X(088).                      00510017
005200*                                                                 00520012
005300 FD  SHPUNT-OUTPUT-FILE                                           00530012
005400     RECORDING MODE IS F                                          00540012
005500     LABEL RECORDS ARE STANDARD                                   00550012
005600     BLOCK CONTAINS 0 RECORDS.                                    00560012
005700                                                                  00570012
005800 01  SHPUNT-OUTPUT-RECORD       PIC  X(077).                      00580012
005900*                                                                 00590012
006000 FD  SUATRN-AUDIT-FILE                                            00600012
006100     RECORDING MODE IS F                                          00610012
006200     LABEL RECORDS ARE STANDARD                                   00620012
006300     BLOCK CONTAINS 0 RECORDS.                                    00630012
006400                                                                  00640012
006500 01  SUATRN-AUDIT-RECORD        PIC  X(103).                      00650017
006501*                                                                 00650112
006510 FD  SUT00015-AUDIT-FILE                                          00651012
006520     RECORDING MODE IS F                                          00652012
006530     LABEL RECORDS ARE STANDARD                                   00653012
006540     BLOCK CONTAINS 0 RECORDS.                                    00654012
006550                                                                  00655012
006560 01  SUT00015-OUTPUT-RECORD     PIC  X(120).                      00656018
006600*                                                                 00660012
006700*                                                                 00670012
006800******************************************************************00680012
006900 WORKING-STORAGE SECTION.                                         00690012
007000******************************************************************00700012
007100*  DB2 FORMATTED MESSAGE AREA                                     00710012
007200******************************************************************00720012
007300     COPY DPWS004.                                                00730017
007400*                                                                 00740012
007500******************************************************************00750012
007600*  COMMUNICATIONS AREA FOR DB2                                    00760012
007700******************************************************************00770012
007800     EXEC SQL                                                     00780012
007900          INCLUDE SQLCA                                           00790012
008000     END-EXEC.                                                    00800012
008100*                                                                 00810012
008900******************************************************************00890012
009000*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE SHIPMENT UNIT      00900012
009100*  TABLE                                                          00910012
009200******************************************************************00920012
009300     EXEC SQL                                                     00930012
009400          INCLUDE TSHPUNT                                         00940012
009500     END-EXEC.                                                    00950012
009600******************************************************************00960012
009700*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE SHIPMENT UNIT      00970012
009800*  AUDIT TABLE                                                    00980012
009900******************************************************************00990012
010000     EXEC SQL                                                     01000012
010100          INCLUDE TSUNAUD                                         01010012
010200     END-EXEC.                                                    01020012
010300******************************************************************01030012
010400*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE SHIPMENT UNIT      01040012
010500*  CARTON AUDIT TABLE                                             01050012
010600******************************************************************01060012
010700     EXEC SQL                                                     01070012
010800          INCLUDE TSUATRN                                         01080012
010900     END-EXEC.                                                    01090012
011000                                                                  01100012
011100******************************************************************01110012
011200*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE SHIPMENT UNIT      01120012
011300*  PO AUDIT REQUEST TABLE (SUT_PO_AUD_REQ)                        01130012
011400******************************************************************01140012
011500     EXEC SQL                                                     01150012
011600          INCLUDE SUT00015                                        01160012
011700     END-EXEC.                                                    01170012
011800                                                                  01180012
011810******************************************************************01181032
011820*  WST_INTGRTN_TYP                                                01182032
011840******************************************************************01184032
011850     EXEC SQL                                                     01185032
011860          INCLUDE WST00008                                        01186032
011870     END-EXEC.                                                    01187032
011880                                                                  01188032
011890******************************************************************01189032
011891*  WST_ATTR_DEFN                                                  01189132
011892******************************************************************01189232
011893     EXEC SQL                                                     01189332
011894          INCLUDE WST00009                                        01189432
011895     END-EXEC.                                                    01189532
011896                                                                  01189632
011897******************************************************************01189732
011898*  WST_ATTR_ELEM                                                  01189832
011899******************************************************************01189932
011900     EXEC SQL                                                     01190032
011901          INCLUDE WST00010                                        01190132
011902     END-EXEC.                                                    01190232
011903                                                                  01190332
011910 01  ABEND-CODE                      PIC S9(04)    VALUE +0       01191012
012000                                                   COMP SYNC.     01200012
012100                                                                  01210012
012200 01  PS-PROGRAM-SWITCHES.                                         01220012
012300     05  PS-EOF-COMPLETE-CSR-SW      PIC  X(01)    VALUE 'N'.     01230012
012400         88  PS-EOF-COMPLETE-CSR                   VALUE 'Y'.     01240012
012500         88  PS-MORE-COMPLETE-CSR                  VALUE 'N'.     01250012
012600     05  PS-EOF-INPROCESS-CSR-SW     PIC  X(01)    VALUE 'N'.     01260012
012700         88  PS-EOF-INPROCESS-CSR                  VALUE 'Y'.     01270012
012800         88  PS-MORE-INPROCESS-CSR                 VALUE 'N'.     01280012
012810     05  PS-EOF-AGED-CSR-SW          PIC  X(01)    VALUE 'N'.     01281022
012820         88  PS-EOF-AGED-CSR                       VALUE 'Y'.     01282020
012830         88  PS-MORE-AGED-CSR                      VALUE 'N'.     01283020
012900     05  PS-EOF-CARTON-CSR-SW        PIC  X(01)    VALUE 'N'.     01290021
013000         88  PS-EOF-CARTON-CSR                     VALUE 'Y'.     01300012
013100         88  PS-MORE-CARTON-CSR                    VALUE 'N'.     01310012
013110     05  PS-PO-AUD-REQ-REC-FOUND-SW  PIC  X(01)    VALUE 'N'.     01311012
013120         88  PS-PO-AUD-REQ-REC-FOUND               VALUE 'Y'.     01312012
013130         88  PS-NO-PO-AUD-REQ-REC-FOUND            VALUE 'N'.     01313012
013200                                                                  01320012
013300 01  PC-PROGRAM-CONSTANTS.                                        01330012
013400     05  PC-ROW-NOT-FOUND            PIC S9(04)    VALUE +100     01340012
013500                                                   COMP SYNC.     01350012
013600     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          01360012
013700         'SUKUT019'.                                              01370012
013800     05  PC-CURRENT-OPERATING-COMPANY                             01380012
013900                                     PIC  X(02)    VALUE '03'.    01390012
014000     05  PC-MAX-RETRIES              PIC S9(04)    VALUE +3       01400012
014100                                                   COMP SYNC.     01410012
014410     05  PC-DEFAULT-TIMESTAMP        PIC  X(26)    VALUE          01441014
014500                                    '9999-09-09-09.09.09.999999'. 01450014
014600 01  PV-PROGRAM-VARIABLES.                                        01460012
014700     05  PV-ITEM-NBR                 PIC  9(15)    VALUE ZERO.    01470012
014800     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  01480012
014900     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  01490012
015000     05  PV-OPEN-COUNTER             PIC S9(04)    VALUE ZERO     01500012
015100                                                   COMP SYNC.     01510012
015200     05  PV-CLOSE-COUNTER            PIC S9(04)    VALUE ZERO     01520012
015300                                                   COMP SYNC.     01530012
015400     05  PV-FETCH-COUNTER            PIC S9(04)    VALUE ZERO     01540012
015500                                                   COMP SYNC.     01550012
015600     05  PV-WRITE-COUNTER            PIC S9(09)    VALUE ZERO     01560012
015700                                                   COMP SYNC.     01570012
015800     05  PV-WRITE2-COUNTER           PIC S9(09)    VALUE ZERO     01580012
015900                                                   COMP SYNC.     01590012
016000     05  PV-WRITE3-COUNTER           PIC S9(09)    VALUE ZERO     01600012
016100                                                   COMP SYNC.     01610012
016110     05  PV-WRITE4-COUNTER           PIC S9(09)    VALUE ZERO     01611012
016120                                                   COMP SYNC.     01612012
016200     05  PV-CARTON-COUNTER           PIC S9(09)    VALUE ZERO     01620012
016300                                                   COMP SYNC.     01630012
016400     05  PV-COMPLETE-COUNTER         PIC S9(09)    VALUE ZERO     01640012
016500                                                   COMP SYNC.     01650012
016600     05  PV-INPROCESS-COUNTER        PIC S9(09)    VALUE ZERO     01660012
016700                                                   COMP SYNC.     01670012
016710     05  PV-AGED-COUNTER             PIC S9(09)    VALUE ZERO     01671019
016720                                                   COMP SYNC.     01672019
016800     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             01680012
016900                                                                  01690012
017000     05  PV-DB2-COUNT                PIC S9(09)    VALUE ZERO     01700012
017100                                                   COMP-3.        01710012
017200                                                                  01720012
017210     05  PV-CURRENT-TIMESTAMP        PIC  X(26)    VALUE SPACES.  01721032
017220     05  PV-COMPLETE-DAYS            PIC  S9(10)V9(5) COMP-3.     01722032
017230     05  PV-COMPLETE-TIMESTAMP       PIC  X(26)    VALUE SPACES.  01723032
017240     05  PV-INPROCESS-DAYS           PIC  S9(10)V9(5) COMP-3.     01724032
017250     05  PV-INPROCESS-TIMESTAMP      PIC  X(26)    VALUE SPACES.  01725032
017260     05  PV-AGED-DAYS                PIC  S9(10)V9(5) COMP-3.     01726032
017270     05  PV-AGED-TIMESTAMP           PIC  X(26)    VALUE SPACES.  01727032
017280     05  PV-DISP-DAYS                PIC  9(04)    VALUE ZEROES.  01728032
017300                                                                  01730012
017400 01  SD-SYSTEM-DATE.                                              01740012
017500     05  SD-SYSTEM-DATE-YY           PIC  9(02)      VALUE ZERO.  01750012
017600     05  SD-SYSTEM-DATE-MM           PIC  9(02)      VALUE ZERO.  01760012
017700     05  SD-SYSTEM-DATE-DD           PIC  9(02)      VALUE ZERO.  01770012
017800                                                                  01780012
017900*                                                                 01790012
018000*  CURSOR DECLARATION FOR ALL THE AUDITS THAT HAVE BEEN COMPLETED 01800012
018100*  FOR THREE WEEKS OR MORE.                                       01810012
018200*                                                                 01820012
018300                                                                  01830012
018400     EXEC SQL                                                     01840012
018500          DECLARE COMPLETE_CURSOR CURSOR FOR                      01850012
018600           SELECT AUD_CNTL_NBR                                    01860012
018700                 ,AUD_STRT_TMST                                   01870012
018800                 ,AUD_STP_TMST                                    01880012
018900                 ,AUD_PSPND_MNIT_QTY                              01890012
019000                 ,AUD_CLO_MNIT_QTY                                01900012
019100                 ,AUD_USR_ID                                      01910012
019200                 ,OPER_UNT_ID                                     01920012
019300                 ,FCLTY_ID                                        01930012
019400                 ,PRC_FCLTY_AREA_ID                               01940012
019500                 ,AUD_STAT_CDE                                    01950012
019600                 ,AUD_TYP_CDE                                     01960012
019610                 ,AUD_CAT_CDE                                     01961018
019620                 ,DEST_TYP_CDE                                    01962019
019700             FROM TSUNAUD                                         01970012
019800            WHERE AUD_STAT_CDE = 'CM'                             01980012
019900              AND AUD_STP_TMST < :PV-COMPLETE-TIMESTAMP           01990032
020000     END-EXEC.                                                    02000012
020100                                                                  02010012
020200     EXEC SQL                                                     02020012
020300          DECLARE INPROCESS_CURSOR CURSOR FOR                     02030012
020400           SELECT AUD_CNTL_NBR                                    02040012
020500                 ,AUD_STRT_TMST                                   02050012
020600                 ,AUD_STP_TMST                                    02060012
020700                 ,AUD_PSPND_MNIT_QTY                              02070012
020800                 ,AUD_CLO_MNIT_QTY                                02080012
020900                 ,AUD_USR_ID                                      02090012
021000                 ,OPER_UNT_ID                                     02100012
021100                 ,FCLTY_ID                                        02110012
021200                 ,PRC_FCLTY_AREA_ID                               02120012
021300                 ,AUD_STAT_CDE                                    02130012
021400                 ,AUD_TYP_CDE                                     02140012
021410                 ,AUD_CAT_CDE                                     02141019
021420                 ,DEST_TYP_CDE                                    02142019
021500             FROM TSUNAUD                                         02150012
021600            WHERE AUD_STAT_CDE IN ('IP', 'PP')                    02160012
021700              AND AUD_STRT_TMST < :PV-INPROCESS-TIMESTAMP         02170032
021710            UNION                                                 02171014
021730             SELECT A.AUD_CNTL_NBR                                02173014
021740                   ,A.AUD_STRT_TMST                               02174014
021750                   ,A.AUD_STP_TMST                                02175014
021760                   ,A.AUD_PSPND_MNIT_QTY                          02176014
021770                   ,A.AUD_CLO_MNIT_QTY                            02177014
021780                   ,A.AUD_USR_ID                                  02178014
021790                   ,A.OPER_UNT_ID                                 02179014
021791                   ,A.FCLTY_ID                                    02179114
021792                   ,A.PRC_FCLTY_AREA_ID                           02179214
021793                   ,A.AUD_STAT_CDE                                02179314
021794                   ,A.AUD_TYP_CDE                                 02179414
021795                   ,A.AUD_CAT_CDE                                 02179519
021796                   ,A.DEST_TYP_CDE                                02179619
021797              FROM TSUNAUD A                                      02179714
021798                 , SUT_PO_AUD_REQ B                               02179814
021799              WHERE A.AUD_STAT_CDE    = 'IP'                      02179914
021800                AND A.AUD_STRT_TMST   = :PC-DEFAULT-TIMESTAMP     02180014
021801                AND A.AUD_STP_TMST    = :PC-DEFAULT-TIMESTAMP     02180114
021802                AND A.AUD_CNTL_NBR    =  B.AUD_CNTL_NBR           02180214
021803                AND B.CRE_TMST        < :PV-INPROCESS-TIMESTAMP   02180332
021830     END-EXEC.                                                    02183012
021840                                                                  02184019
021850     EXEC SQL                                                     02185019
021860          DECLARE AGED_CURSOR CURSOR FOR                          02186019
021926             SELECT A.AUD_CNTL_NBR                                02192619
021927                   ,A.AUD_STRT_TMST                               02192719
021928                   ,A.AUD_STP_TMST                                02192819
021929                   ,A.AUD_PSPND_MNIT_QTY                          02192919
021930                   ,A.AUD_CLO_MNIT_QTY                            02193019
021931                   ,A.AUD_USR_ID                                  02193119
021932                   ,A.OPER_UNT_ID                                 02193219
021933                   ,A.FCLTY_ID                                    02193319
021934                   ,A.PRC_FCLTY_AREA_ID                           02193419
021935                   ,A.AUD_STAT_CDE                                02193519
021936                   ,A.AUD_TYP_CDE                                 02193619
021937                   ,A.AUD_CAT_CDE                                 02193719
021938                   ,A.DEST_TYP_CDE                                02193819
021939              FROM TSUNAUD A                                      02193919
021940                 , SUT_PO_AUD_REQ B                               02194019
021941             WHERE  A.AUD_CNTL_NBR    =  B.AUD_CNTL_NBR           02194119
021942                AND B.CRE_TMST        < :PV-AGED-TIMESTAMP        02194232
021943     END-EXEC.                                                    02194319
021950                                                                  02195012
022000     EXEC SQL                                                     02200012
022100          DECLARE CARTON_CURSOR CURSOR FOR                        02210012
022200           SELECT AUD_CNTL_NBR                                    02220012
022300                 ,SHIPT_UNT_ID                                    02230012
022400                 ,UNT_AUD_STRT_TMST                               02240012
022500                 ,UNT_AUD_STP_TMST                                02250012
022600                 ,UNT_PSPND_MNIT_QTY                              02260012
022700                 ,UNT_CLO_MNIT_QTY                                02270012
022800                 ,UNT_AUD_USR_ID                                  02280012
022900                 ,UNT_AUD_STAT_CDE                                02290012
023000                 ,TRN_NBR                                         02300012
023100                 ,REC_SEQ_NBR                                     02310012
023200                 ,DEST_OPER_UNT_ID                                02320012
023300                 ,DEST_FCLTY_ID                                   02330012
023400                 ,UNT_AUD_ERR_IND                                 02340012
023500                 ,UNT_RSTRT_MNIT_QTY                              02350012
023510                 ,INPK_QTY                                        02351017
023600             FROM TSUATRN                                         02360012
023700            WHERE AUD_CNTL_NBR  = :SUNAUD-AUD-CNTL-NBR            02370012
023800     END-EXEC.                                                    02380012
023900                                                                  02390012
024000                                                                  02400012
024100******************************************************************02410012
024200 PROCEDURE DIVISION.                                              02420012
024300******************************************************************02430012
024400                                                                  02440012
024500 0000-PROGRAM-MAINLINE.                                           02450012
024600******************************************************************02460012
024700* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     02470012
024800*      PROGRAM.                                                   02480012
024900******************************************************************02490012
025000                                                                  02500012
025100     PERFORM 1000-INITIALIZE.                                     02510012
025200                                                                  02520012
025300     IF PS-MORE-COMPLETE-CSR                                      02530012
025400         PERFORM 2000-PROCESS-COMPLETE-AUDITS                     02540012
025500            UNTIL PS-EOF-COMPLETE-CSR                             02550012
025600     END-IF.                                                      02560012
025700                                                                  02570012
025800     PERFORM 7200-OPEN-INPROCESS-CURSOR.                          02580012
025900     PERFORM 7300-FETCH-INPROCESS-CURSOR.                         02590012
026000     IF PS-MORE-INPROCESS-CSR                                     02600012
026100         PERFORM 3000-PROCESS-INPROCESS-AUDITS                    02610012
026200            UNTIL PS-EOF-INPROCESS-CSR                            02620012
026300     END-IF.                                                      02630012
026410                                                                  02641019
026411*                                                                 02641119
026412*** DMH 2/4/13 BEGIN                                              02641219
026420     PERFORM 7350-OPEN-AGED-CURSOR.                               02642019
026430     PERFORM 7360-FETCH-AGED-CURSOR.                              02643019
026440     IF PS-MORE-AGED-CSR                                          02644019
026450         PERFORM 4000-PROCESS-AGED-AUDITS                         02645019
026460            UNTIL PS-EOF-AGED-CSR                                 02646019
026470     END-IF.                                                      02647019
026472*** DMH 2/4/13 END                                                02647219
026473*                                                                 02647319
026480                                                                  02648019
026500     PERFORM 9000-EOJ-ROUTINE.                                    02650012
026600                                                                  02660012
026700     STOP RUN.                                                    02670012
026800                                                                  02680012
026900 1000-INITIALIZE.                                                 02690012
027000******************************************************************02700012
027100*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    02710012
027200*    -- OPEN OUTPUT FILE                                          02720012
027300*    -- OPEN CURSOR                                               02730012
027400*    -- FETCH CURSOR                                              02740012
027500******************************************************************02750012
027600                                                                  02760012
027700     ACCEPT SD-SYSTEM-DATE FROM DATE.                             02770012
027800                                                                  02780012
027900     OPEN OUTPUT SUNAUD-OUTPUT-FILE                               02790012
028000                 SHPUNT-OUTPUT-FILE                               02800012
028100                 SUATRN-AUDIT-FILE                                02810012
028110                 SUT00015-AUDIT-FILE.                             02811012
028200                                                                  02820012
028210     PERFORM 1010-GET-PURGE-TMST.                                 02821032
030700                                                                  03070012
030800     PERFORM 7000-OPEN-COMPLETE-CURSOR.                           03080012
030900     PERFORM 7100-FETCH-COMPLETE-CURSOR.                          03090012
031000                                                                  03100012
031001                                                                  03100132
031002******************************************************************03100232
031003*                                                                 03100332
031004******************************************************************03100432
031010 1010-GET-PURGE-TMST.                                             03101032
031011                                                                  03101132
031020     EXEC SQL                                                     03102032
031021          SELECT CURRENT TIMESTAMP                                03102132
031022               , C.ATTR_ELEM_NBR                                  03102232
031023               , CURRENT TIMESTAMP - C.ATTR_ELEM_NBR DAYS         03102332
031024               , D.ATTR_ELEM_NBR                                  03102432
031025               , CURRENT TIMESTAMP - D.ATTR_ELEM_NBR DAYS         03102532
031026               , E.ATTR_ELEM_NBR                                  03102632
031027               , CURRENT TIMESTAMP - E.ATTR_ELEM_NBR DAYS         03102732
031028            INTO :PV-CURRENT-TIMESTAMP                            03102832
031029               , :PV-COMPLETE-DAYS                                03102933
031030               , :PV-COMPLETE-TIMESTAMP                           03103033
031031               , :PV-INPROCESS-DAYS                               03103133
031032               , :PV-INPROCESS-TIMESTAMP                          03103233
031033               , :PV-AGED-DAYS                                    03103333
031034               , :PV-AGED-TIMESTAMP                               03103433
031036            FROM                                                  03103632
031037                  WST_INTGRTN_TYP  A                              03103733
031038               ,  WST_ATTR_DEFN    B                              03103833
031039               ,  WST_ATTR_ELEM    C                              03103933
031040               ,  WST_ATTR_ELEM    D                              03104033
031041               ,  WST_ATTR_ELEM    E                              03104133
031042            WHERE                                                 03104232
031043                  A.INTGRTN_TYP_CDE   = 'CRTNAUDPRG'              03104332
031044              AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE         03104432
031045              AND B.ATTR_DEFN_SEQ_NBR = 1                         03104532
031046              AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE         03104632
031047              AND C.ATTR_DEFN_SEQ_NBR = 1                         03104732
031048              AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE         03104832
031049              AND D.ATTR_DEFN_SEQ_NBR = 2                         03104932
031050              AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE         03105032
031051              AND E.ATTR_DEFN_SEQ_NBR = 3                         03105132
031052              AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR       03105232
031053              AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR       03105332
031054     END-EXEC.                                                    03105434
031093                                                                  03109332
031094     EVALUATE TRUE                                                03109432
031095         WHEN SQLCODE = ZERO                                      03109532
031096             DISPLAY 'SUKUT019: AUDIT EXTRACT '                   03109632
031097                     ' -  PARM:  CRTNAUDPRG   '                   03109732
031098             DISPLAY ' '                                          03109832
031099                                                                  03109932
031100             DISPLAY 'CURRENT TIMESTAMP:     '                    03110032
031101                         PV-CURRENT-TIMESTAMP                     03110132
031102             DISPLAY ' '                                          03110232
031103                                                                  03110332
031104             MOVE  PV-COMPLETE-DAYS  TO  PV-DISP-DAYS             03110432
031105             DISPLAY 'COMPLETE TIMESTAMP:    '                    03110532
031106                         PV-COMPLETE-TIMESTAMP                    03110632
031107                     '   DAYS:'          PV-DISP-DAYS             03110732
031108             DISPLAY ' '                                          03110832
031109                                                                  03110932
031110             MOVE  PV-INPROCESS-DAYS TO  PV-DISP-DAYS             03111036
031111             DISPLAY 'INPROCESS TIMESTAMP:   '                    03111132
031112                         PV-INPROCESS-TIMESTAMP                   03111232
031113                     '   DAYS:'          PV-DISP-DAYS             03111332
031114             DISPLAY ' '                                          03111432
031115                                                                  03111532
031116             MOVE  PV-AGED-DAYS      TO  PV-DISP-DAYS             03111637
031117             DISPLAY 'AGED TIMESTAMP:        '                    03111732
031118                         PV-AGED-TIMESTAMP                        03111832
031119                     '   DAYS:'          PV-DISP-DAYS             03111932
031120             DISPLAY ' '                                          03112032
031121                                                                  03112132
031122         WHEN SQLWARN0 NOT = SPACES                               03112232
031123         WHEN SQLCODE < ZERO                                      03112332
031124         WHEN SQLCODE > ZERO                                      03112432
031125             MOVE '1010-GET-PURGE-TMST             '              03112532
031126                             TO PV-PARAGRAPH-NAME                 03112632
031127             MOVE 'CALCULATE PURGE DAYS           '               03112732
031128                             TO PV-DB2-OPERATION-ATTEMPTED        03112832
031129             PERFORM 9100-SQL-ABEND                               03112932
031130     END-EVALUATE.                                                03113035
031131                                                                  03113132
031132                                                                  03113232
031140 2000-PROCESS-COMPLETE-AUDITS.                                    03114032
031200******************************************************************03120012
031300*  PROCESS THE AUDITS THAT FALL INTO THE REQUIRED TIME FRAME TO   03130012
031400*  BE DELETED.  A CURSOR WILL BE OPENED FOR EACH AUDIT TO BRING   03140012
031500*  BACK ALL THE CARTONS THAT ARE ASSOCIATED TO IT, AND A FILE     03150012
031600*  CONTAINING THESE CARTONS WILL BE WRITTEN.                      03160012
031700******************************************************************03170012
031800                                                                  03180012
031900     PERFORM 8000-WRITE-AUDIT-FILE.                               03190012
032000     PERFORM 7400-OPEN-CARTON-CURSOR.                             03200012
032100     PERFORM 7500-FETCH-CARTON-CURSOR.                            03210012
032200                                                                  03220012
032300     PERFORM UNTIL PS-EOF-CARTON-CSR                              03230012
032400        PERFORM 8100-WRITE-CARTON-FILE                            03240012
032500        PERFORM 7500-FETCH-CARTON-CURSOR                          03250012
032600     END-PERFORM.                                                 03260012
032700                                                                  03270012
032800     SET PS-MORE-CARTON-CSR TO TRUE.                              03280012
032900     PERFORM 7600-CLOSE-CARTON-CURSOR.                            03290012
032910                                                                  03291012
032920     SET PS-PO-AUD-REQ-REC-FOUND TO TRUE.                         03292012
032930     PERFORM 7700-SELECT-AUD-REQ-RECORDS.                         03293012
032931                                                                  03293112
032940     IF PS-PO-AUD-REQ-REC-FOUND                                   03294012
032950        PERFORM 8200-WRITE-AUD-REQ-FILE                           03295012
032960     END-IF                                                       03296012
033000                                                                  03300012
033100     PERFORM 7100-FETCH-COMPLETE-CURSOR.                          03310012
033200                                                                  03320012
033300 3000-PROCESS-INPROCESS-AUDITS.                                   03330012
033400******************************************************************03340012
033500*  PROCESS THE AUDITS THAT FALL INTO THE REQUIRED TIME FRAME TO   03350012
033600*  BE DELETED.  A CURSOR WILL BE OPENED FOR EACH AUDIT TO BRING   03360012
033700*  BACK ALL THE CARTONS THAT ARE ASSOCIATED TO IT, AND A FILE     03370012
033800*  CONTAINING THESE CARTONS WILL BE WRITTEN.                      03380012
033900******************************************************************03390012
034000                                                                  03400012
034100     PERFORM 8000-WRITE-AUDIT-FILE.                               03410012
034200     PERFORM 7400-OPEN-CARTON-CURSOR.                             03420012
034300     PERFORM 7500-FETCH-CARTON-CURSOR.                            03430012
034400                                                                  03440012
034500     PERFORM UNTIL PS-EOF-CARTON-CSR                              03450012
034600        PERFORM 8100-WRITE-CARTON-FILE                            03460012
034700        PERFORM 7500-FETCH-CARTON-CURSOR                          03470012
034800     END-PERFORM.                                                 03480012
034900                                                                  03490012
035000     SET PS-MORE-CARTON-CSR TO TRUE.                              03500012
035100     PERFORM 7600-CLOSE-CARTON-CURSOR.                            03510012
035110                                                                  03511015
035120     SET PS-PO-AUD-REQ-REC-FOUND TO TRUE.                         03512015
035130     PERFORM 7700-SELECT-AUD-REQ-RECORDS.                         03513015
035140                                                                  03514015
035150     IF PS-PO-AUD-REQ-REC-FOUND                                   03515015
035160        PERFORM 8200-WRITE-AUD-REQ-FILE                           03516015
035170     END-IF                                                       03517015
035200                                                                  03520012
035300     PERFORM 7300-FETCH-INPROCESS-CURSOR.                         03530012
035400                                                                  03540012
035410 4000-PROCESS-AGED-AUDITS.                                        03541019
035420******************************************************************03542019
035430*  PROCESS THE AUDITS THAT FALL INTO THE REQUIRED TIME FRAME TO   03543019
035440*  BE DELETED.  A CURSOR WILL BE OPENED FOR EACH AUDIT TO BRING   03544019
035450*  BACK ALL THE CARTONS THAT ARE ASSOCIATED TO IT, AND A FILE     03545019
035460*  CONTAINING THESE CARTONS WILL BE WRITTEN.                      03546019
035470******************************************************************03547019
035480                                                                  03548019
035490     PERFORM 8000-WRITE-AUDIT-FILE.                               03549019
035491     PERFORM 7400-OPEN-CARTON-CURSOR.                             03549119
035492     PERFORM 7500-FETCH-CARTON-CURSOR.                            03549219
035493                                                                  03549319
035494     PERFORM UNTIL PS-EOF-CARTON-CSR                              03549419
035495        PERFORM 8100-WRITE-CARTON-FILE                            03549519
035496        PERFORM 7500-FETCH-CARTON-CURSOR                          03549619
035497     END-PERFORM.                                                 03549719
035498                                                                  03549819
035499     SET PS-MORE-CARTON-CSR TO TRUE.                              03549919
035500     PERFORM 7600-CLOSE-CARTON-CURSOR.                            03550019
035501                                                                  03550119
035502     SET PS-PO-AUD-REQ-REC-FOUND TO TRUE.                         03550219
035503     PERFORM 7700-SELECT-AUD-REQ-RECORDS.                         03550319
035504                                                                  03550419
035505     IF PS-PO-AUD-REQ-REC-FOUND                                   03550519
035506        PERFORM 8200-WRITE-AUD-REQ-FILE                           03550619
035507     END-IF                                                       03550719
035508                                                                  03550819
035509     PERFORM 7360-FETCH-AGED-CURSOR.                              03550920
035510                                                                  03551019
035511                                                                  03551119
035520 7000-OPEN-COMPLETE-CURSOR.                                       03552012
035600******************************************************************03560012
035700*  OPEN THE CURSOR.                                               03570012
035800******************************************************************03580012
035900     EXEC SQL                                                     03590012
036000          OPEN COMPLETE_CURSOR                                    03600012
036100     END-EXEC.                                                    03610012
036200                                                                  03620012
036300     EVALUATE TRUE                                                03630012
036400         WHEN SQLCODE = ZERO                                      03640012
036500             CONTINUE                                             03650012
036600         WHEN SQLWARN0 NOT = SPACES                               03660012
036700         WHEN SQLCODE < ZERO                                      03670012
036800         WHEN SQLCODE > ZERO                                      03680012
036900             MOVE '7000-OPEN-COMPLETE-CURSOR       '              03690012
037000                             TO PV-PARAGRAPH-NAME                 03700012
037100             MOVE 'OPEN THE COMPLETE_CURSOR      '                03710012
037200                             TO PV-DB2-OPERATION-ATTEMPTED        03720012
037300             DISPLAY 'TIMESTAMP BEING PROCESSED IS '              03730012
037400                     PV-COMPLETE-TIMESTAMP                        03740032
037500             PERFORM 9100-SQL-ABEND                               03750012
037600     END-EVALUATE.                                                03760012
037700                                                                  03770012
037800 7100-FETCH-COMPLETE-CURSOR.                                      03780012
037900******************************************************************03790012
038000*  FETCH THE RESULTS FROM THE COMPLETE CURSOR.                    03800012
038100******************************************************************03810012
038200     EXEC SQL                                                     03820012
038300          FETCH COMPLETE_CURSOR                                   03830012
038400             INTO :SUNAUD-AUD-CNTL-NBR                            03840012
038500                 ,:SUNAUD-AUD-STRT-TMST                           03850012
038600                 ,:SUNAUD-AUD-STP-TMST                            03860012
038700                 ,:SUNAUD-AUD-PSPND-MNIT-QTY                      03870012
038800                 ,:SUNAUD-AUD-CLO-MNIT-QTY                        03880012
038900                 ,:SUNAUD-AUD-USR-ID                              03890012
039000                 ,:SUNAUD-OPER-UNT-ID                             03900012
039100                 ,:SUNAUD-FCLTY-ID                                03910012
039200                 ,:SUNAUD-PRC-FCLTY-AREA-ID                       03920012
039300                 ,:SUNAUD-AUD-STAT-CDE                            03930012
039400                 ,:SUNAUD-AUD-TYP-CDE                             03940012
039410                 ,:SUNAUD-AUD-CAT-CDE                             03941017
039420                 ,:SUNAUD-DEST-TYP-CDE                            03942017
039500     END-EXEC.                                                    03950012
039600                                                                  03960012
039700     EVALUATE TRUE                                                03970012
039800         WHEN SQLCODE = ZERO                                      03980012
039900             ADD +1 TO PV-COMPLETE-COUNTER                        03990012
040000         WHEN SQLCODE = +100                                      04000012
040100             SET PS-EOF-COMPLETE-CSR                              04010012
040200                                 TO TRUE                          04020012
040300         WHEN SQLWARN0 NOT = SPACES                               04030012
040400         WHEN SQLCODE < ZERO                                      04040012
040500         WHEN SQLCODE > ZERO                                      04050012
040600             MOVE '7100-FETCH-COMPLETE-CURSOR  '                  04060012
040700                                 TO PV-PARAGRAPH-NAME             04070012
040800             MOVE 'FETCH THE COMPLETE-CURSOR   '                  04080012
040900                                 TO PV-DB2-OPERATION-ATTEMPTED    04090012
041000             DISPLAY 'TIMESTAMP BEING PROCESSED IS '              04100012
041100                     PV-COMPLETE-TIMESTAMP                        04110032
041200             PERFORM 9100-SQL-ABEND                               04120012
041300     END-EVALUATE.                                                04130012
041400                                                                  04140012
041500 7200-OPEN-INPROCESS-CURSOR.                                      04150012
041600******************************************************************04160012
041700*  OPEN THE CURSOR.                                               04170012
041800******************************************************************04180012
041900     EXEC SQL                                                     04190012
042000          OPEN INPROCESS_CURSOR                                   04200012
042100     END-EXEC.                                                    04210012
042200                                                                  04220012
042300     EVALUATE TRUE                                                04230012
042400         WHEN SQLCODE = ZERO                                      04240012
042500             CONTINUE                                             04250012
042600         WHEN SQLWARN0 NOT = SPACES                               04260012
042700         WHEN SQLCODE < ZERO                                      04270012
042800         WHEN SQLCODE > ZERO                                      04280012
042900             MOVE '7200-OPEN-INPROCESS-CURSOR       '             04290012
043000                             TO PV-PARAGRAPH-NAME                 04300012
043100             MOVE 'OPEN THE INPROCESS_CURSOR      '               04310012
043200                             TO PV-DB2-OPERATION-ATTEMPTED        04320012
043300             DISPLAY 'TIMESTAMP BEING PROCESSED IS '              04330012
043400                     PV-INPROCESS-TIMESTAMP                       04340032
043500             PERFORM 9100-SQL-ABEND                               04350012
043600     END-EVALUATE.                                                04360012
043700                                                                  04370012
043800 7300-FETCH-INPROCESS-CURSOR.                                     04380012
043900******************************************************************04390012
044000*  FETCH THE RESULTS FROM THE INPROCESS CURSOR.                   04400012
044100******************************************************************04410012
044200     EXEC SQL                                                     04420012
044300          FETCH INPROCESS_CURSOR                                  04430012
044400             INTO :SUNAUD-AUD-CNTL-NBR                            04440012
044500                 ,:SUNAUD-AUD-STRT-TMST                           04450012
044600                 ,:SUNAUD-AUD-STP-TMST                            04460012
044700                 ,:SUNAUD-AUD-PSPND-MNIT-QTY                      04470012
044800                 ,:SUNAUD-AUD-CLO-MNIT-QTY                        04480012
044900                 ,:SUNAUD-AUD-USR-ID                              04490012
045000                 ,:SUNAUD-OPER-UNT-ID                             04500012
045100                 ,:SUNAUD-FCLTY-ID                                04510012
045200                 ,:SUNAUD-PRC-FCLTY-AREA-ID                       04520012
045300                 ,:SUNAUD-AUD-STAT-CDE                            04530012
045400                 ,:SUNAUD-AUD-TYP-CDE                             04540012
045410                 ,:SUNAUD-AUD-CAT-CDE                             04541017
045420                 ,:SUNAUD-DEST-TYP-CDE                            04542017
045500     END-EXEC.                                                    04550012
045600                                                                  04560012
045700     EVALUATE TRUE                                                04570012
045800         WHEN SQLCODE = ZERO                                      04580012
045900             ADD +1 TO PV-INPROCESS-COUNTER                       04590012
046000         WHEN SQLCODE = +100                                      04600012
046100             SET PS-EOF-INPROCESS-CSR                             04610012
046200                                 TO TRUE                          04620012
046300         WHEN SQLWARN0 NOT = SPACES                               04630012
046400         WHEN SQLCODE < ZERO                                      04640012
046500         WHEN SQLCODE > ZERO                                      04650012
046600             MOVE '7300-FETCH-INPROCESS-CURSOR '                  04660012
046700                                 TO PV-PARAGRAPH-NAME             04670012
046800             MOVE 'FETCH THE INPROCESS-CURSOR  '                  04680012
046900                                 TO PV-DB2-OPERATION-ATTEMPTED    04690012
047000             DISPLAY 'TIMESTAMP BEING PROCESSED IS '              04700012
047100                     PV-INPROCESS-TIMESTAMP                       04710032
047200             PERFORM 9100-SQL-ABEND                               04720012
047300     END-EVALUATE.                                                04730012
047400                                                                  04740012
047401                                                                  04740119
047426******************************************************************04742627
047427*  OPEN AGED CURSOR    - MORE THAN 2 MONTHS OLD                   04742727
047428******************************************************************04742827
047429 7350-OPEN-AGED-CURSOR.                                           04742927
047430                                                                  04743027
047431     EXEC SQL                                                     04743127
047432          OPEN AGED_CURSOR                                        04743227
047433     END-EXEC.                                                    04743327
047434                                                                  04743427
047435     EVALUATE TRUE                                                04743527
047436         WHEN SQLCODE = ZERO                                      04743627
047437             CONTINUE                                             04743727
047438         WHEN SQLWARN0 NOT = SPACES                               04743827
047439         WHEN SQLCODE < ZERO                                      04743927
047440         WHEN SQLCODE > ZERO                                      04744027
047441             MOVE '7350-OPEN-AGED-CURSOR            '             04744127
047442                             TO PV-PARAGRAPH-NAME                 04744227
047443             MOVE 'OPEN THE AGED_CURSOR           '               04744327
047444                             TO PV-DB2-OPERATION-ATTEMPTED        04744427
047445             DISPLAY 'TIMESTAMP BEING PROCESSED IS '              04744527
047446                     PV-AGED-TIMESTAMP                            04744632
047447             PERFORM 9100-SQL-ABEND                               04744727
047448     END-EVALUATE.                                                04744827
047449                                                                  04744927
047450                                                                  04745027
047451******************************************************************04745127
047452*  FETCHED AGED AUDITS - MORE THAN 2 MONTHS OLD                   04745227
047453******************************************************************04745327
047454 7360-FETCH-AGED-CURSOR.                                          04745427
047455     EXEC SQL                                                     04745527
047456          FETCH AGED_CURSOR                                       04745627
047457             INTO :SUNAUD-AUD-CNTL-NBR                            04745727
047458                 ,:SUNAUD-AUD-STRT-TMST                           04745827
047459                 ,:SUNAUD-AUD-STP-TMST                            04745927
047460                 ,:SUNAUD-AUD-PSPND-MNIT-QTY                      04746027
047461                 ,:SUNAUD-AUD-CLO-MNIT-QTY                        04746127
047462                 ,:SUNAUD-AUD-USR-ID                              04746227
047463                 ,:SUNAUD-OPER-UNT-ID                             04746327
047464                 ,:SUNAUD-FCLTY-ID                                04746427
047465                 ,:SUNAUD-PRC-FCLTY-AREA-ID                       04746527
047466                 ,:SUNAUD-AUD-STAT-CDE                            04746627
047467                 ,:SUNAUD-AUD-TYP-CDE                             04746727
047468                 ,:SUNAUD-AUD-CAT-CDE                             04746827
047469                 ,:SUNAUD-DEST-TYP-CDE                            04746927
047470     END-EXEC.                                                    04747027
047471                                                                  04747127
047472     EVALUATE TRUE                                                04747227
047473         WHEN SQLCODE = ZERO                                      04747327
047474             ADD +1 TO PV-AGED-COUNTER                            04747427
047475         WHEN SQLCODE = +100                                      04747527
047476             SET PS-EOF-AGED-CSR                                  04747627
047477                                 TO TRUE                          04747727
047478         WHEN SQLWARN0 NOT = SPACES                               04747827
047479         WHEN SQLCODE < ZERO                                      04747927
047480         WHEN SQLCODE > ZERO                                      04748027
047481             MOVE '7360-FETCH-AGED-CURSOR      '                  04748127
047482                                 TO PV-PARAGRAPH-NAME             04748227
047483             MOVE 'FETCH THE AGED-CURSOR       '                  04748327
047484                                 TO PV-DB2-OPERATION-ATTEMPTED    04748427
047485             DISPLAY 'TIMESTAMP BEING PROCESSED IS '              04748527
047486                     PV-AGED-TIMESTAMP                            04748632
047487             PERFORM 9100-SQL-ABEND                               04748727
047488     END-EVALUATE.                                                04748827
047489                                                                  04748927
047515                                                                  04751519
047520 7400-OPEN-CARTON-CURSOR.                                         04752012
047600******************************************************************04760012
047700*  OPEN THE CURSOR.                                               04770012
047800******************************************************************04780012
047900     EXEC SQL                                                     04790012
048000          OPEN CARTON_CURSOR                                      04800012
048100     END-EXEC.                                                    04810012
048200                                                                  04820012
048300     EVALUATE TRUE                                                04830012
048400         WHEN SQLCODE = ZERO                                      04840012
048500             CONTINUE                                             04850012
048600         WHEN SQLWARN0 NOT = SPACES                               04860012
048700         WHEN SQLCODE < ZERO                                      04870012
048800         WHEN SQLCODE > ZERO                                      04880012
048900             MOVE '7400-OPEN-CARTON-CUSROR          '             04890012
049000                             TO PV-PARAGRAPH-NAME                 04900012
049100             MOVE 'OPEN THE CARTON_CURSOR         '               04910012
049200                             TO PV-DB2-OPERATION-ATTEMPTED        04920012
049300             DISPLAY 'AUDIT CONTROL NUMBER '                      04930012
049400                     SUNAUD-AUD-CNTL-NBR                          04940012
049500             PERFORM 9100-SQL-ABEND                               04950012
049600     END-EVALUATE.                                                04960012
049700                                                                  04970012
049800 7500-FETCH-CARTON-CURSOR.                                        04980012
049900******************************************************************04990012
050000*  FETCH THE RESULTS FROM THE CARTON CURSOR.                      05000012
050100******************************************************************05010012
050200     EXEC SQL                                                     05020012
050300          FETCH CARTON_CURSOR                                     05030012
050400             INTO                                                 05040012
050500                  :SUATRN-AUD-CNTL-NBR                            05050012
050600                 ,:SUATRN-SHIPT-UNT-ID                            05060012
050700                 ,:SUATRN-UNT-AUD-STRT-TMST                       05070012
050800                 ,:SUATRN-UNT-AUD-STP-TMST                        05080012
050900                 ,:SUATRN-UNT-PSPND-MNIT-QTY                      05090012
051000                 ,:SUATRN-UNT-CLO-MNIT-QTY                        05100012
051100                 ,:SUATRN-UNT-AUD-USR-ID                          05110012
051200                 ,:SUATRN-UNT-AUD-STAT-CDE                        05120012
051300                 ,:SUATRN-TRN-NBR                                 05130012
051400                 ,:SUATRN-REC-SEQ-NBR                             05140012
051500                 ,:SUATRN-DEST-OPER-UNT-ID                        05150012
051600                 ,:SUATRN-DEST-FCLTY-ID                           05160012
051700                 ,:SUATRN-UNT-AUD-ERR-IND                         05170012
051800                 ,:SUATRN-UNT-RSTRT-MNIT-QTY                      05180012
051810                 ,:SUATRN-INPK-QTY                                05181017
051900     END-EXEC.                                                    05190012
052000                                                                  05200012
052100     EVALUATE TRUE                                                05210012
052200         WHEN SQLCODE = ZERO                                      05220012
052300             ADD +1 TO PV-CARTON-COUNTER                          05230012
052400         WHEN SQLCODE = +100                                      05240012
052500             SET PS-EOF-CARTON-CSR                                05250012
052600                                 TO TRUE                          05260012
052700         WHEN SQLWARN0 NOT = SPACES                               05270012
052800         WHEN SQLCODE < ZERO                                      05280012
052900         WHEN SQLCODE > ZERO                                      05290012
053000             MOVE '7500-FETCH-CARTON-CURSOR    '                  05300012
053100                                 TO PV-PARAGRAPH-NAME             05310012
053200             MOVE 'FETCH THE CARTON-CURSOR     '                  05320012
053300                                 TO PV-DB2-OPERATION-ATTEMPTED    05330012
053400             DISPLAY 'AUDIT CONTROL NUMBER IS '                   05340012
053500                     SUNAUD-AUD-CNTL-NBR                          05350012
053600             DISPLAY 'LAST CART ID PROCESSED WAS '                05360012
053700                     SHPUNT-SHIPT-UNT-ID                          05370012
053800             PERFORM 9100-SQL-ABEND                               05380012
053900     END-EVALUATE.                                                05390012
054000                                                                  05400012
054100 7600-CLOSE-CARTON-CURSOR.                                        05410012
054200******************************************************************05420012
054300*  CLOSE THE CARTON CURSOR.                                       05430012
054400******************************************************************05440012
054500     EXEC SQL                                                     05450012
054600          CLOSE CARTON_CURSOR                                     05460012
054700     END-EXEC.                                                    05470012
054800                                                                  05480012
054900     EVALUATE TRUE                                                05490012
055000         WHEN SQLCODE = ZERO                                      05500012
055100             CONTINUE                                             05510012
055200         WHEN SQLWARN0 NOT = SPACES                               05520012
055300         WHEN SQLCODE < ZERO                                      05530012
055400         WHEN SQLCODE > ZERO                                      05540012
055500             MOVE '7600-CLOSE-CARTON-CURSOR    '                  05550012
055600                                 TO PV-PARAGRAPH-NAME             05560012
055700             MOVE 'FETCH THE CARTON-CURSOR     '                  05570012
055800                                 TO PV-DB2-OPERATION-ATTEMPTED    05580012
055900             DISPLAY 'AUDIT CONTROL NUMBER IS '                   05590012
056000                     SUNAUD-AUD-CNTL-NBR                          05600012
056100             DISPLAY 'LAST CART ID PROCESSED WAS '                05610012
056200                     SHPUNT-SHIPT-UNT-ID                          05620012
056300             PERFORM 9100-SQL-ABEND                               05630012
056400     END-EVALUATE.                                                05640012
056500                                                                  05650012
056600******************************************************************05660012
056700 7700-SELECT-AUD-REQ-RECORDS.                                     05670012
056800******************************************************************05680012
056900                                                                  05690012
057000     EXEC SQL                                                     05700012
057100         SELECT PO_NBR                                            05710012
057200               ,PO_LNE_NBR                                        05720012
057300               ,PO_PREPK_ID                                       05730012
057400               ,OPER_UNT_ID                                       05740012
057500               ,INBND_TRIP_ID                                     05750012
057600               ,RCVR_SEQ_NBR                                      05760012
057700               ,AUD_CNTL_NBR                                      05770012
057800               ,CART_QTY                                          05780012
057900               ,UNT_QTY                                           05790012
058000               ,AUD_CART_QTY                                      05800012
058100               ,AUD_UNT_QTY                                       05810012
058200               ,AUD_STAT_CDE                                      05820012
058300               ,DFRD_AUD_IND                                      05830012
058400               ,AUD_ERR_PCT                                       05840012
058500               ,CRE_TMST                                          05850012
058600               ,CART_PRMPT_CDE                                    05860012
058700               ,VND_RNKG_CDE                                      05870012
058800               ,PKGNG_TYP_CDE                                     05880012
058900               ,EFF_BEG_TMST                                      05890012
059000               ,ENT_ID                                            05900012
059100               ,DEPT_NBR                                          05910012
059101               ,AUD_STAT_RSN_CDE                                  05910117
059110               ,MOD_QTY_IND                                       05911017
059130               ,DIRV_RLSE_IND                                     05913017
059200         INTO   :SUT00015-PO-NBR                                  05920012
059300               ,:SUT00015-PO-LNE-NBR                              05930012
059400               ,:SUT00015-PO-PREPK-ID                             05940012
059500               ,:SUT00015-OPER-UNT-ID                             05950012
059600               ,:SUT00015-INBND-TRIP-ID                           05960012
059700               ,:SUT00015-RCVR-SEQ-NBR                            05970012
059800               ,:SUT00015-AUD-CNTL-NBR                            05980012
059900               ,:SUT00015-CART-QTY                                05990012
060000               ,:SUT00015-UNT-QTY                                 06000012
060100               ,:SUT00015-AUD-CART-QTY                            06010012
060200               ,:SUT00015-AUD-UNT-QTY                             06020012
060300               ,:SUT00015-AUD-STAT-CDE                            06030012
060400               ,:SUT00015-DFRD-AUD-IND                            06040012
060500               ,:SUT00015-AUD-ERR-PCT                             06050012
060600               ,:SUT00015-CRE-TMST                                06060012
060700               ,:SUT00015-CART-PRMPT-CDE                          06070012
060800               ,:SUT00015-VND-RNKG-CDE                            06080012
060900               ,:SUT00015-PKGNG-TYP-CDE                           06090012
061000               ,:SUT00015-EFF-BEG-TMST                            06100012
061100               ,:SUT00015-ENT-ID                                  06110012
061200               ,:SUT00015-DEPT-NBR                                06120012
061210               ,:SUT00015-AUD-STAT-RSN-CDE                        06121017
061220               ,:SUT00015-MOD-QTY-IND                             06122017
061240               ,:SUT00015-DIRV-RLSE-IND                           06124017
061300         FROM   SUT_PO_AUD_REQ                                    06130012
061400         WHERE  AUD_CNTL_NBR   = :SUNAUD-AUD-CNTL-NBR             06140012
061500     END-EXEC.                                                    06150012
061600                                                                  06160012
061700     EVALUATE TRUE                                                06170012
061800         WHEN SQLCODE = ZERO                                      06180012
061810             SET PS-PO-AUD-REQ-REC-FOUND TO TRUE                  06181012
061820         WHEN SQLCODE = +100                                      06182012
061830             SET PS-NO-PO-AUD-REQ-REC-FOUND TO TRUE               06183012
062000         WHEN SQLWARN0 NOT = SPACES                               06200012
062100         WHEN SQLCODE < ZERO                                      06210012
062200         WHEN SQLCODE > ZERO                                      06220012
062300             MOVE '7700-SELECT-AUD-REQ-RECORDS '                  06230012
062400                                 TO PV-PARAGRAPH-NAME             06240012
062500             MOVE 'SELECT AUD REQUEST RECORDS  '                  06250012
062600                                 TO PV-DB2-OPERATION-ATTEMPTED    06260012
062700             DISPLAY 'AUDIT CONTROL NUMBER IS '                   06270012
062800                     SUNAUD-AUD-CNTL-NBR                          06280012
062900             DISPLAY 'LAST CART ID PROCESSED WAS '                06290012
063000                     SHPUNT-SHIPT-UNT-ID                          06300012
063100             PERFORM 9100-SQL-ABEND                               06310012
063200     END-EVALUATE.                                                06320012
063300                                                                  06330012
063400 8000-WRITE-AUDIT-FILE.                                           06340012
063500******************************************************************06350012
063600*  WRITE THE SUNAUD-OUTPUT-RECORD                                 06360012
063700******************************************************************06370012
063800     INITIALIZE SUNAUD-OUTPUT-RECORD.                             06380012
063900     WRITE SUNAUD-OUTPUT-RECORD                                   06390012
064000         FROM DCLTSUNAUD.                                         06400012
064100     ADD +1 TO PV-WRITE-COUNTER.                                  06410012
064200                                                                  06420012
064300 8100-WRITE-CARTON-FILE.                                          06430012
064400******************************************************************06440012
064500*  WRITE THE CARTON RECORD                                        06450012
064600******************************************************************06460012
064700     INITIALIZE SHPUNT-OUTPUT-RECORD                              06470012
064800                DCLTSHPUNT                                        06480012
064900                SUATRN-AUDIT-RECORD.                              06490012
065000                                                                  06500012
065100     MOVE SUATRN-SHIPT-UNT-ID TO SHPUNT-SHIPT-UNT-ID.             06510012
065500                                                                  06550012
065800     WRITE SUATRN-AUDIT-RECORD                                    06580012
065900         FROM DCLTSUATRN.                                         06590012
066000                                                                  06600012
066100     ADD +1 TO PV-WRITE3-COUNTER.                                 06610012
066200                                                                  06620012
066210 8200-WRITE-AUD-REQ-FILE.                                         06621012
066220******************************************************************06622012
066230*  WRITE THE SUT00015-OUTPUT-RECORD                               06623012
066240******************************************************************06624012
066250     INITIALIZE SUT00015-OUTPUT-RECORD.                           06625012
066260     WRITE SUT00015-OUTPUT-RECORD                                 06626012
066270         FROM DCLSUT00015.                                        06627012
066280     ADD +1 TO PV-WRITE4-COUNTER.                                 06628012
066290                                                                  06629012
066300 9000-EOJ-ROUTINE.                                                06630012
066400******************************************************************06640012
066500*  CLOSE OUTPUT FILE.  CLOSE THE CURSOR.                          06650012
066600******************************************************************06660012
066700     CLOSE SUNAUD-OUTPUT-FILE                                     06670012
066800           SHPUNT-OUTPUT-FILE                                     06680012
066900           SUATRN-AUDIT-FILE                                      06690012
066910           SUT00015-AUDIT-FILE.                                   06691012
067000                                                                  06700012
067010     DISPLAY ' '.                                                 06701023
067100     MOVE PV-COMPLETE-COUNTER TO PV-DISPLAY-COUNT.                06710012
067200     DISPLAY 'TOTAL ROWS FETCHED FROM COMPLETE CURSOR  '          06720012
067300     PV-DISPLAY-COUNT.                                            06730012
067400     MOVE PV-INPROCESS-COUNTER TO PV-DISPLAY-COUNT.               06740012
067500     DISPLAY 'TOTAL ROWS FETCHED FROM INPROCESS CURSOR '          06750012
067600     PV-DISPLAY-COUNT.                                            06760012
067601     MOVE PV-AGED-COUNTER TO PV-DISPLAY-COUNT.                    06760119
067620     DISPLAY 'TOTAL ROWS FETCHED FROM AGED CURSOR      '          06762019
067630     PV-DISPLAY-COUNT.                                            06763019
067640     DISPLAY ' '.                                                 06764023
067700     MOVE PV-CARTON-COUNTER TO PV-DISPLAY-COUNT.                  06770012
067800     DISPLAY 'TOTAL CARTON ROWS FETCHED FROM CURSOR    '          06780012
067900     PV-DISPLAY-COUNT.                                            06790012
068000     MOVE PV-WRITE-COUNTER TO PV-DISPLAY-COUNT.                   06800012
068100     DISPLAY 'TOTAL AUDIT DELETE RECORDS WRITTEN       '          06810012
068200     PV-DISPLAY-COUNT.                                            06820012
068300     MOVE PV-WRITE2-COUNTER TO PV-DISPLAY-COUNT.                  06830012
068400     DISPLAY 'TOTAL CARTON DELETE RECORDS WRITTEN      '          06840012
068500                                                 PV-DISPLAY-COUNT.06850012
068600     MOVE PV-WRITE3-COUNTER TO PV-DISPLAY-COUNT.                  06860012
068700     DISPLAY 'TOTAL SUATRN AUDIT RECORDS WRITTEN       '          06870012
068800                                                 PV-DISPLAY-COUNT.06880012
068810     MOVE PV-WRITE4-COUNTER TO PV-DISPLAY-COUNT.                  06881012
068820     DISPLAY 'TOTAL PO AUDIT REQ RECORDS WRITTEN       '          06882012
068830                                                 PV-DISPLAY-COUNT.06883012
068900                                                                  06890012
069000     EXEC SQL                                                     06900012
069100          CLOSE COMPLETE_CURSOR                                   06910012
069200     END-EXEC.                                                    06920012
069300                                                                  06930012
069400     EVALUATE TRUE                                                06940012
069500         WHEN SQLCODE = ZERO                                      06950012
069600             CONTINUE                                             06960012
069700         WHEN SQLWARN0 NOT = SPACES                               06970012
069800         WHEN SQLCODE < ZERO                                      06980012
069900         WHEN SQLCODE > ZERO                                      06990012
070000             MOVE '9000-EOJ-ROUTINE               '               07000012
070100                             TO PV-PARAGRAPH-NAME                 07010012
070200             MOVE 'CLOSE THE COMPLETE_CURSOR    '                 07020012
070300                             TO PV-DB2-OPERATION-ATTEMPTED        07030012
070400             DISPLAY 'TIMESTAMP BEING USED IS '                   07040012
070500                      PV-COMPLETE-TIMESTAMP                       07050032
070600             PERFORM 9100-SQL-ABEND                               07060012
070700     END-EVALUATE.                                                07070012
070800                                                                  07080012
070900     EXEC SQL                                                     07090012
071000          CLOSE INPROCESS_CURSOR                                  07100012
071100     END-EXEC.                                                    07110012
071200                                                                  07120012
071300     EVALUATE TRUE                                                07130012
071400         WHEN SQLCODE = ZERO                                      07140012
071500             CONTINUE                                             07150012
071600         WHEN SQLWARN0 NOT = SPACES                               07160012
071700         WHEN SQLCODE < ZERO                                      07170012
071800         WHEN SQLCODE > ZERO                                      07180012
071900             MOVE '9000-EOJ-ROUTINE               '               07190012
072000                             TO PV-PARAGRAPH-NAME                 07200012
072100             MOVE 'CLOSE THE INPROCESS_CURSOR    '                07210012
072200                             TO PV-DB2-OPERATION-ATTEMPTED        07220012
072300             DISPLAY 'TIMESTAMP BEING USED IS '                   07230012
072400                      PV-INPROCESS-TIMESTAMP                      07240032
072500             PERFORM 9100-SQL-ABEND                               07250012
072600     END-EVALUATE.                                                07260012
072700                                                                  07270012
072800 9100-SQL-ABEND.                                                  07280012
072900******************************************************************07290012
073000*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    07300012
073100*  ERROR OR WARNING CODE OCCURS.                                  07310012
073200******************************************************************07320012
073300     DISPLAY '9100-SQL-ABEND'.                                    07330012
073400     DISPLAY '** ABEND     **'.                                   07340012
073500     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        07350012
073600     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              07360012
073700     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     07370012
073800                                                                  07380012
073900******************************************************************07390012
074000* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    07400012
074100* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         07410012
074200* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     07420012
074300* FORMAT.                                                         07430012
074400******************************************************************07440012
074500     COPY DPPD004.                                                07450012
074600                                                                  07460012
074700     MOVE +4013                  TO ABEND-CODE.                   07470012
074800     CALL 'ILBOABN0' USING ABEND-CODE.                            07480012
