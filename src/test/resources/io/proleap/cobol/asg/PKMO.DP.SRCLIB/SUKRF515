000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300 PROGRAM-ID.             SUKRF515.                                00030000
000400 AUTHOR.                 MICHAEL WALTERS.                         00040000
000500 INSTALLATION.           KOHLS.                                   00050000
000600 DATE-WRITTEN            SEPTEMBER, 1997.                         00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900******************************************************************00090000
001000* THIS PROGRAM DISPLAYS THE CARTON CLOSE SCREEN                   00100000
001100******************************************************************00110000
001200* 10/20/13 - JIM ARENDT   - CHG0068598                            00120043
001300* - CHANGED PROGRAM TO ALLOW IT TO PROCESS 2 AUDITS WHEN A        00130044
001400*   COMBINED (QC AND RFID) AUDIT IS BEING PERFORMED FOR A CARTON. 00140044
001500******************************************************************00150021
001600***RLK 04/14 BEG                                                  00160022
001700* 004/14/14 - RICH KELLEN - CHG0078145                            00170023
001800* - CHANGED PROGRAM TO SET SU006-AUD-ERR ON IN PARA 4190 WHEN     00180021
001900*   A TYPE '42' EXCEPTION IS CREATED.                             00190021
002000***RLK 04/14 END                                                  00200022
002100***RLK 05/14 BEG                                                  00210027
002200* 05/14/14 - RICH KELLEN - CHG0079586                             00220028
002300* - CHANGED PROGRAM TO COMMENT OUT LOGIC TO NOT EXECUTE           00230027
002400* - PARA 4100-CHECK-OVER-SHORT FOR A MANUAL AUDIT WHEN OTHER      00240027
002500* - EXCEPTIONS EXIST. WE WILL NOW CREATE OVER/UNDER EXCEPTIONS    00250027
002600* - WHEN OTHER EXCEPTIONS DO EXIST.                               00260027
002700***RLK 05/14 END                                                  00270027
002800******************************************************************00280000
002900* 04/22/14 - JIM ARENDT   - CHG0080352                            00290042
003000* - ADDED CODE IN 3100-REOPEN-SHIP-UNIT TO POPULATE FIELD         00300036
003100*   DK-SHIP-UNIT-NBR.                                             00310036
003200******************************************************************00320036
003202* CHANGED 11/16/2021    BY JIM HUNTER      WR: CHG0263968         00320243
003203* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00320343
003204* MAKING THE CALL DYNAMIC VS STATIC.                              00320443
003210******************************************************************00321043
003300 ENVIRONMENT DIVISION.                                            00330000
003400 DATA DIVISION.                                                   00340000
003500******************************************************************00350000
003600                                                                  00360000
003700******************************************************************00370000
003800 WORKING-STORAGE SECTION.                                         00380000
003900******************************************************************00390000
004000 01  CA-COMMAREA.                                                 00400000
004100     COPY SUWS006.                                                00410000
004200    05  CA-PROGRAM-COMMAREA.                                      00420000
004300         10  CA-SELECTION-X              PIC  X(01)  VALUE SPACES.00430000
004400         10  CA-SELECTION  REDEFINES  CA-SELECTION-X              00440000
004500                                         PIC  9(01).              00450000
004600             88  CA-VALID-SELECTION      VALUE 1, 2, 3, 4, 5.     00460000
004700             88  CA-CONTINUE-SELECTION   VALUE 1.                 00470000
004800             88  CA-POSTPONE-SELECTION   VALUE 2.                 00480000
004900             88  CA-CLOSE-SELECTION      VALUE 3.                 00490000
005000             88  CA-RESTART-SELECTION    VALUE 4.                 00500000
005100             88  CA-PRINT-SELECTION      VALUE 5.                 00510000
005200         10  CA-CONFIRM-SW               PIC X(01)  VALUE SPACE.  00520000
005300             88  CA-CONFIRMED            VALUE 'C'.               00530000
005400             88  CA-IN-CONFIRM-STATE     VALUE 'Y'.               00540000
005500             88  CA-NOT-IN-CONFIRM-STATE VALUE 'N'.               00550000
005600     05  CA-PRTR-CNTL-IND                PIC  X(01).              00560000
005700     05  CA-TRACK-NBR                    PIC  9(01).              00570000
005800     05  CA-SYSTEM-ID.                                            00580000
005900         10  FILLER              PIC  X(04)   VALUE SPACE.        00590000
006000         10  CA-REGION-IND       PIC  X(01).                      00600000
006100             88  CA-TEST-CICS                 VALUE 'T'.          00610000
006200             88  CA-QA-CICS                   VALUE 'Q'.          00620000
006300             88  CA-PROD-CICS                 VALUE 'P'.          00630000
006400             88  CA-LEARN-CICS                VALUE 'L'.          00640000
006500         10  FILLER              PIC X(03)    VALUE SPACES.       00650000
006600     05  CA-OVER-SHORT-IND               PIC  X(01).              00660000
006700         88  CA-OVER-SHORT                    VALUE 'Y'.          00670000
006800         88  CA-OVER-SHORT-FALSE              VALUE 'N'.          00680000
006900                                                                  00690000
007000 01  DK-DB2-KEYS.                                                 00700000
007100     05  DK-AUDIT-CNTL-NBR               PIC S9(09) COMP.         00710000
007200     05  DK-AUDIT-CNTL-NBR-X             PIC  X(09) VALUE SPACE.  00720000
007300     05  DK-SHIP-UNIT-NBR                PIC S9(18) COMP-3.       00730000
007400     05  DK-SHIP-UNIT-NBR-X              PIC  X(18) VALUE SPACE.  00740033
007500     05  DK-SUQADJ-SHIPT-UNT-ID          PIC S9(18) COMP-3.       00750000
007600     05  DK-OPER-UNT-ID                  PIC S9(04) COMP.         00760000
007700     05  DK-LOC-ID                       PIC  S9(4) COMP.         00770000
007800     05  DK-AUDITR-CNTL-NBR              PIC S9(09) COMP.         00780000
007801                                                                  00780148
007820     05  DK-WST-RPT-NAME                 PIC X(050) VALUE SPACE.  00782048
007830     05  DK-WST-RPT-NBR                  PIC X(015) VALUE SPACE.  00783048
007831     05  DK-WST-JOB                      PIC X(008) VALUE SPACE.  00783148
007840     05  DK-WST-AC-IN                    PIC X(002) VALUE SPACE.  00784048
007850     05  DK-WST-PROG-NBR                 PIC X(008) VALUE SPACE.  00785048
007860     05  DK-WST-MENU-SEQ                 PIC  S9(9) COMP.         00786048
007870                                                                  00787048
007900*                                                                 00790000
008000 01  SE-SYSTEM-ERROR-MESSAGE.                                     00800000
008100     05  FILLER                  PIC X(43)    VALUE               00810000
008200         'A SYSTEM ERROR HAS OCCURRED - CONTACT DP - '.           00820000
008300     05  FILLER                  PIC X(31)    VALUE               00830000
008400         'PROGRAM SUKRF515     EIBRESP = '.                       00840000
008500     05  SE-CICS-RESPONSE        PIC 9(4)     VALUE ZERO.         00850000
008600     05  FILLER                  PIC X(2)     VALUE SPACES.       00860000
008700     05  FILLER                  PIC X(14)    VALUE               00870000
008800         'ATTEMPTING TO '.                                        00880000
008900     05  SE-ATTEMPTED-ACTION     PIC X(61)    VALUE SPACES.       00890000
009000*                                                                 00900000
009100 01  PC-PROGRAM-CONSTANTS.                                        00910000
009200     05  PC-SUKUT701              PIC X(08) VALUE 'SUKUT701'.     00920000
009300     05  PC-AUDIT                 PIC X(10) VALUE 'AUDIT     '.   00930000
009400     05  PC-CARTON                PIC X(10) VALUE 'CARTON    '.   00940000
009500     05  PC-01                    PIC X(02) VALUE '01'.           00950000
009600     05  PC-A                     PIC X(01) VALUE 'A'.            00960000
009700     05  PC-N                     PIC X(01) VALUE 'N'.            00970000
009800     05  PC-Y                     PIC X(01) VALUE 'Y'.            00980000
009900     05  PC-AUDIT-NO-LONGER-NEEDED-MSG   PIC  X(19)  VALUE        00990000
010000         'AUDIT COMPLETE     '.                                   01000000
010100     05  PC-CANNOT-POSTPONE-AUDIT-MSG    PIC  X(19)  VALUE        01010000
010200         'CANT POSTPN INS AUD'.                                   01020000
010300     05  PC-POSTPONE-TRY-AGAIN-MSG       PIC  X(19)  VALUE        01030000
010400         'POSTPONE/TRY AGAIN '.                                   01040000
010500     05  PC-CLOSED-W-FAILED-ADJ-MSG      PIC  X(19)  VALUE        01050000
010600         'CLOSED W/FAILED ADJ'.                                   01060000
010700     05  PC-MUST-CLOSE-AUDIT-MSG         PIC  X(19)  VALUE        01070000
010800         'MUST CLOSE AUDIT   '.                                   01080000
010900     05  PC-TRANS-UNAVAILABLE-MSG        PIC  X(19)  VALUE        01090000
011000         'TRANS NOT AVAILABLE'.                                   01100000
011100     05  PC-CCC-PARM-ERR-MSG             PIC  X(19)  VALUE        01110000
011200         'PARM ERROR-SUKCS769'.                                   01120000
011300     05  PC-CCC-DB2-ERR-MSG              PIC  X(19)  VALUE        01130000
011400         'DB2  ERROR-SUKCS769'.                                   01140000
011500     05  PC-CCC-MQ-ERR-MSG               PIC  X(19)  VALUE        01150000
011600         'MQ   ERROR-SUKCS769'.                                   01160000
011700     05  PC-CCC-OTHR-ERR-MSG             PIC  X(19)  VALUE        01170000
011800         'OTHR ERROR-SUKCS769'.                                   01180000
011900     05  PC-REPORT-PGM                   PIC  X(08)  VALUE        01190000
012000         'SUKRP002'.                                              01200000
012100     05  PC-PRTR-VALIDATION-PGM          PIC  X(08)  VALUE        01210000
012200         'DPKCS060'.                                              01220000
012300     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        01230000
012400         'SUKRF515'.                                              01240000
012500     05  PC-CARTON-OPEN-PROGRAM-NAME     PIC  X(08)  VALUE        01250000
012600         'SUKRF511'.                                              01260000
012700     05  PC-UPC-SCAN-PROGRAM-NAME        PIC  X(08)  VALUE        01270000
012800         'SUKRF518'.                                              01280000
012900     05  PC-PRINT-PROGRAM-NAME           PIC  X(08)  VALUE        01290000
013000         'SUKRF523'.                                              01300000
013100     05  PC-PREPK-QTY-SCREEN-PROGRAM     PIC  X(08)  VALUE        01310000
013200         'SUKRF540'.                                              01320000
013300     05  PC-AUDIT-STATUS-PROGRAM         PIC  X(08)  VALUE        01330000
013400         'SUKRF536'.                                              01340000
013500     05  PC-COMMON-CARTON-CLOSE-PGM      PIC  X(08)  VALUE        01350000
013600         'SUKCS769'.                                              01360000
013700     05  PC-CURRENT-TRANID               PIC  X(04)  VALUE 'S515'.01370000
013800     05  PC-DEFAULT-TMST                 PIC  X(26)  VALUE        01380000
013900                                     '9999-09-09-09.09.09.999999'.01390000
013910     05  PC-PRINT-TO-FILE                PIC  X(04) VALUE 'FILE'. 01391054
013920     05  PC-PRINT-TO-FILE-ERR-MSG   PIC X(19) VALUE               01392044
013930                                           'PRT-TO-FILE INVALID'. 01393044
013940     05  PC-REPORT-TO-FILE-ERR-MSG  PIC X(19) VALUE               01394052
013950                                           'RPT-TO-FILE UNAVAIL'. 01395049
014000                                                                  01400000
014100 01  PS-PROGRAM-SWITCHES.                                         01410000
014200     05  PS-CARTON-ALREADY-COMPLETE-SW  PIC X(01)    VALUE 'N'.   01420000
014300         88  PS-CARTON-ALREADY-COMPLETE              VALUE 'Y'.   01430000
014400         88  PS-CARTON-NOT-ALREADY-COMPLETE          VALUE 'N'.   01440000
014500     05  PS-PRIOR-ADJUSTMENTS-SW        PIC X(01)    VALUE 'N'.   01450000
014600         88  PS-PRIOR-ADJUSTMENTS                    VALUE 'Y'.   01460000
014700         88  PS-NO-PRIOR-ADJUSTMENTS                 VALUE 'N'.   01470000
014800     05  PS-OUTBOUND-CARTON-SW          PIC X(01)    VALUE 'Y'.   01480000
014900         88  PS-OUTBOUND-CARTON                      VALUE 'Y'.   01490000
015000         88  PS-NO-OUTBOUND-CARTON                   VALUE 'N'.   01500000
015100     05  PS-MANIFESTING-DC-SW           PIC X(01)    VALUE 'N'.   01510000
015200         88  PS-MANIFESTING-DC                       VALUE 'Y'.   01520000
015300         88  PS-NOT-MANIFESTING-DC                   VALUE 'N'.   01530000
015400     05  PS-CARTON-ADJUST-DC-SW         PIC X(01)    VALUE 'N'.   01540000
015500         88  PS-CARTON-ADJUST-DC                     VALUE 'Y'.   01550000
015600         88  PS-NOT-CARTON-ADJUST-DC                 VALUE 'N'.   01560000
015700     05  PS-INNER-PACK-CONVEY-SW        PIC X(01)    VALUE 'N'.   01570000
015800         88  PS-INNER-PACK-YES                       VALUE 'Y'.   01580000
015900         88  PS-INNER-PACK-NO                        VALUE 'N'.   01590000
016000     05  PS-PRINT-REPORT-SW             PIC X(01)    VALUE 'N'.   01600000
016100         88  PS-DO-PRINT-REPORT                      VALUE 'Y'.   01610000
016200         88  PS-DO-NOT-PRINT-REPORT                  VALUE 'N'.   01620000
016300     05  PS-SYSTEM-AUDIT-FOUND-SW       PIC X(01)    VALUE 'N'.   01630000
016400         88  PS-SYSTEM-AUDIT-NOT-FOUND               VALUE 'N'.   01640000
016500         88  PS-SYSTEM-AUDIT-FOUND                   VALUE 'Y'.   01650000
016600     05  PS-ABEND-IND                   PIC X(01)    VALUE 'N'.   01660000
016700         88  PS-NO-ABEND-IN-PROGRESS                 VALUE 'N'.   01670000
016800         88  PS-ABEND-IN-PROGRESS                    VALUE 'Y'.   01680000
016900     05  PS-INTERNAL-READER-ENQ-DEQ-IND                           01690000
017000                                        PIC X(01)    VALUE 'D'.   01700000
017100         88  PS-INTERNAL-READER-ENQUEUED             VALUE 'E'.   01710000
017200         88  PS-INTERNAL-READER-DEQUEUED             VALUE 'D'.   01720000
017300     05  PS-OVER-SHORT-IND               PIC  X(01)  VALUE 'N'.   01730000
017400         88  PS-OVER-SHORT-ERROR                     VALUE 'Y'.   01740000
017500         88  PS-NO-OVER-SHORT-ERROR                  VALUE 'N'.   01750000
017600     05  PS-CARTON-ITEM-CURSOR-IND       PIC  X(01)  VALUE 'N'.   01760000
017700         88  PS-NOT-EOC-CARTON-ITEM-CURSOR           VALUE 'N'.   01770000
017800         88  PS-EOC-CARTON-ITEM-CURSOR               VALUE 'Y'.   01780000
017900     05  PS-AUDIT-ITEM-CURSOR-IND        PIC  X(01)  VALUE 'N'.   01790000
018000         88  PS-NOT-EOC-AUDIT-ITEM-CURSOR            VALUE 'N'.   01800000
018100         88  PS-EOC-AUDIT-ITEM-CURSOR                VALUE 'Y'.   01810000
018200     05  PS-CARTON-UPC-CURSOR-IND        PIC  X(01)  VALUE 'N'.   01820000
018300         88  PS-NOT-EOC-CARTON-UPC-CURSOR            VALUE 'N'.   01830000
018400         88  PS-EOC-CARTON-UPC-CURSOR                VALUE 'Y'.   01840000
018500     05  PS-AUDIT-UPC-CURSOR-IND         PIC  X(01)  VALUE 'N'.   01850000
018600         88  PS-NOT-EOC-AUDIT-UPC-CURSOR             VALUE 'N'.   01860000
018700         88  PS-EOC-AUDIT-UPC-CURSOR                 VALUE 'Y'.   01870000
018800     05  PS-CTN-EXCEPT-IND               PIC  X(01)  VALUE 'N'.   01880000
018900         88  PS-CTN-EXCEPT-EXIST                     VALUE 'Y'.   01890000
019000         88  PS-CTN-EXCEPT-DONT-EXIST                VALUE 'N'.   01900000
019100     05  PS-DLX-LIVE-INTERFACE-IND       PIC  X(01)  VALUE 'N'.   01910000
019200         88  PS-DLX-LIVE-INTERFACE                   VALUE 'Y'.   01920000
019300         88  PS-DLX-NOT-LIVE-INTERFACE               VALUE 'N'.   01930000
019400     05  PS-CALLED-MODULE-IND            PIC  X(01)  VALUE 'N'.   01940000
019500         88  PS-CALLED-MODULE-OK                     VALUE 'Y'.   01950000
019600         88  PS-CALLED-MODULE-NOT-OK                 VALUE 'N'.   01960000
019800     05  PS-PRCS-SEC-AUDIT-SW            PIC  X(01)  VALUE 'F'.   01980000
019900         88  PS-PRCS-FIRST-AUDIT                     VALUE 'F'.   01990000
020000         88  PS-PRCS-SEC-AUDIT                       VALUE 'S'.   02000000
020100     05  PS-SCAN-CURSOR-IND              PIC  X(01)  VALUE 'N'.   02010000
020200         88  PS-NOT-EOC-SCAN-CURSOR                  VALUE 'N'.   02020000
020300         88  PS-EOC-SCAN-CURSOR                      VALUE 'Y'.   02030000
020400     05  PS-PRINT-TO-FILE-SW             PIC  X(01)  VALUE 'N'.   02040044
020410         88  PS-PRINT-TO-FILE-NO                     VALUE 'N'.   02041044
020420         88  PS-PRINT-TO-FILE-YES                    VALUE 'Y'.   02042044
020430     05  PS-REPORT-TO-FILE-SW            PIC  X(01)  VALUE 'N'.   02043048
020440         88  PS-REPORT-TO-FILE-NO                    VALUE 'N'.   02044048
020450         88  PS-REPORT-TO-FILE-YES                   VALUE 'Y'.   02045048
020500                                                                  02050000
020600 01  PV-PROGRAM-VARIABLES.                                        02060000
020700     05  PV-BRCDE-NBR                    PIC X(22).               02070000
020800     05  FILLER REDEFINES PV-BRCDE-NBR.                           02080000
020900         10  PV-BRCDE-NBR-FILLER-1       PIC  X(02).              02090000
021000         10  PV-BRCDE-NBR-N              PIC  9(18).              02100000
021100         10  PV-BRCDE-NBR-FILLER-2       PIC  X(02).              02110000
021200     05  PV-SAVE-SHIP-UNIT-STATUS        PIC  X(02).              02120000
021300     05  PV-DISP-COUNTS                  PIC  9(09).              02130000
021400     05  PV-CURRENT-TIMESTAMP            PIC  X(26)  VALUE SPACE. 02140000
021500     05  PV-SUQADJ-COUNT                 PIC S9(09)  VALUE ZERO   02150000
021600                                                     COMP.        02160000
021700     05  PV-ITEM-COUNT-CARTON            PIC S9(09)  VALUE ZERO   02170000
021800                                                     COMP SYNC.   02180000
021900     05  PV-ITEM-COUNT-AUDIT             PIC S9(09)  VALUE ZERO   02190000
022000                                                     COMP SYNC.   02200000
022100     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE ZERO   02210000
022200                                                     COMP SYNC.   02220000
022300     05  PV-OPENED-DAYS                  PIC S9(09)  VALUE ZERO   02230039
022400                                                     COMP.        02240000
022500     05  PV-OPENED-HOURS                 PIC S9(09)  VALUE ZERO   02250041
022600                                                     COMP.        02260000
022700     05  PV-OPENED-MINUTES               PIC S9(09)  VALUE ZERO   02270041
022800                                                     COMP.        02280000
022900     05  PV-TOTAL-OPENED-MINUTES         PIC S9(09)  VALUE ZERO   02290000
023000                                                     COMP.        02300000
023100     05  PV-CLOSED-DAYS                  PIC S9(09)  VALUE ZERO   02310037
023200                                                     COMP.        02320000
023300     05  PV-CLOSED-HOURS                 PIC S9(09)  VALUE ZERO   02330037
023400                                                     COMP.        02340000
023500     05  PV-CLOSED-MINUTES               PIC S9(09)  VALUE ZERO   02350037
023600                                                     COMP.        02360000
023700     05  PV-TOTAL-CLOSED-MINUTES         PIC S9(09)  VALUE ZERO   02370000
023800                                                     COMP.        02380000
023900     05  PV-EXP-QTY                      PIC S9(09)  VALUE ZERO   02390000
024000                                                     COMP.        02400000
024100     05  PV-EXP-QTY-SHRT                 PIC 9(04)   VALUE ZERO.  02410000
024200                                                                  02420000
024300     05  PV-SCN-QTY                      PIC S9(09)  VALUE ZERO   02430000
024400                                                     COMP.        02440000
024500     05  PV-AUDIT-CRTN-COUNT             PIC S9(09)  VALUE ZERO   02450000
024600                                                     COMP.        02460000
024700     05  PV-AUDIT-UNIT-QTY               PIC S9(09)  VALUE ZERO   02470000
024800                                                     COMP.        02480000
024900     05  PV-AUDIT-COMBO-UNIT-QTY         PIC S9(09)  VALUE ZERO   02490000
025000                                                     COMP.        02500000
025100     05  PV-TOTAL-SCND-UNT-QTY           PIC S9(09)  VALUE ZERO   02510000
025200                                                     COMP.        02520000
025300     05  PV-SCN-QTY-SHRT                 PIC 9(04)   VALUE ZERO.  02530000
025400     05  PV-MESSAGE-AREA                 PIC  X(19)  VALUE SPACE. 02540000
025500     05  PV-BLANKS                      PIC  X(50)  VALUE SPACES. 02550000
025600     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  02560000
025700                                                     COMP SYNC.   02570000
025800     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACE. 02580000
025900     05  PV-AUDIT-INTR-UPC               PIC  S9(9)  COMP.        02590000
026000     05  PV-EXPECT-INTR-UPC              PIC  S9(9)  COMP.        02600000
026100     05  PV-AUDIT-HOLD-UPC-NBR           PIC  S9(15)V COMP-3.     02610000
026200     05  PV-EXPECT-HOLD-UPC-NBR          PIC  S9(15)V COMP-3.     02620000
026300     05  PV-INTR-UPC                     PIC   9(9).              02630000
026400     05  PV-SCND-UNT-QTY                 PIC  S9(9)  COMP.        02640000
026500     05  PV-AUDIT-UPC-NBR                PIC  S9(15)V COMP-3.     02650000
026600     05  PV-AUDIT-SHPD-QTY               PIC  S9(9)V COMP-3.      02660000
026700     05  PV-COMP-UPC-NBR                 PIC  S9(15)V COMP-3.     02670000
026800     05  PV-COMP-UPC-NBR2                PIC  S9(15)V COMP-3.     02680000
026900     05  PV-COMP-SCAN-QTY                PIC  S9(9)V COMP-3.      02690000
027000     05  PV-COMP-TAG-QTY                 PIC  S9(9)V COMP-3.      02700000
027100     05  PV-CARTON-UPC-NBR               PIC  S9(15)V COMP-3.     02710000
027200     05  PV-CARTON-SHPD-QTY              PIC  S9(9)V COMP-3.      02720000
027300     05  PV-DISPLAY-NUMBER               PIC   9(09).             02730000
027400     05  PV-DISPLAY-SQLCODE              PIC  -9(03).             02740000
027500     05  PV-DISPLAY-OPER                 PIC   9(05).             02750000
027600     05  PV-DISPLAY-KEYS.                                         02760000
027700         10 FILLER                       PIC X(12)                02770000
027800            VALUE 'KEY VALUES: '.                                 02780000
027900         10 PV-DISP-AUD-CNTL-NBR         PIC 9(09).               02790000
028000         10 FILLER                       PIC X(04)                02800000
028100            VALUE ' -- '.                                         02810000
028200         10 PV-DISP-SHIPT-UNT-ID         PIC 9(18).               02820000
028300         10 FILLER                       PIC X(04)                02830000
028400            VALUE ' -- '.                                         02840000
028500         10 PV-DISP-UPC-NBR              PIC 9(15).               02850000
028600         10 FILLER                       PIC X(04)                02860000
028700            VALUE ' -- '.                                         02870000
028800         10 PV-DISP-SCN-TMST             PIC X(26).               02880000
028900     05  PV-CICS-MSG-AREA2               PIC X(100) VALUE SPACE.  02890000
028901                                                                  02890148
028910     05  PV-WST-SEQ                      PIC S9(9) COMP.          02891051
028920     05  PV-WST-RPT-NAME                 PIC  X(50) VALUE SPACE.  02892051
028930     05  PV-WST-RPT-NBR                  PIC  X(15) VALUE SPACE.  02893051
028931     05  PV-WST-JOB                      PIC  X(08) VALUE SPACE.  02893151
028940     05  PV-WST-AC-IN                    PIC  X(02) VALUE SPACE.  02894051
028950     05  PV-WST-PROG-NBR                 PIC  X(08) VALUE SPACE.  02895051
028960     05  PV-WST-MENU-SEQ                 PIC S9(10)V9(5) COMP-3.  02896051
029000                                                                  02900044
029100 01  PV-DB2-NULL-INDICATORS.                                      02910000
029200     05  PV-SCN-QTY-NULL            PIC S9(04) COMP VALUE ZEROES. 02920000
029300     05  PV-EXP-QTY-NULL            PIC S9(04) COMP VALUE ZEROES. 02930000
029400                                                                  02940044
029500******************************************************************02950000
029600*  JCL LINES FOR REQUESTING THE VARIOUS REPORT                    02960000
029700******************************************************************02970000
029800                                                                  02980000
029900 01  JL-JCL-LINE-AREA.                                            02990000
030000     05  JL-JCL-LINE-1           PIC X(80).                       03000000
030100     05  JL-JOB-LINE-PROD.                                        03010000
030200         10  FILLER              PIC X(02)    VALUE               03020000
030300             '//'.                                                03030000
030400         10  JL-JOB-NAME         PIC X(08).                       03040000
030500         10  FILLER              PIC X(11)    VALUE               03050000
030600             ' JOB KOHLS,'.                                       03060000
030700         10  FILLER              PIC X(1)     VALUE QUOTE.        03070000
030800         10  JL-JOB-DESC         PIC X(13).                       03080000
030900         10  FILLER              PIC X(1)     VALUE QUOTE.        03090000
031000         10  FILLER              PIC X(19)    VALUE               03100000
031100             ',MSGCLASS=P,CLASS=Q'.                               03110000
031200         10  FILLER              PIC X(16)    VALUE SPACES.       03120000
031300     05  JL-JOB-LINE-TEST.                                        03130000
031400         10  FILLER              PIC X(02)    VALUE               03140000
031500             '//'.                                                03150000
031600         10  JL-TEST-JOB-NAME    PIC X(07)    VALUE SPACES.       03160000
031700         10  FILLER              PIC X(01)    VALUE               03170000
031800             'Q'.                                                 03180000
031900         10  FILLER              PIC X(11)    VALUE               03190000
032000             ' JOB KOHLS,'.                                       03200000
032100         10  FILLER              PIC X(1)     VALUE QUOTE.        03210000
032200         10  JL-TEST-JOB-DESC    PIC X(13).                       03220000
032300         10  FILLER              PIC X(1)     VALUE QUOTE.        03230000
032400         10  FILLER              PIC X(19)    VALUE               03240000
032500             ',MSGCLASS=X,CLASS=E'.                               03250000
032600         10  FILLER              PIC X(08)    VALUE               03260000
032700             ',NOTIFY='.                                          03270000
032800         10  JL-TEST-NOTIFY      PIC X(07)    VALUE SPACES.       03280000
032900         10  FILLER              PIC X(03)    VALUE SPACES.       03290000
033000     05  JL-JCL-LINE-3.                                           03300000
033100         10  FILLER              PIC X(13)    VALUE               03310000
033200             '/*JOBPARM K=0'.                                     03320000
033300         10  FILLER              PIC X(67)    VALUE SPACES.       03330000
033400     05  JL-JCL-LINE-4-PROD.                                      03340000
033500         10  FILLER              PIC X(39)    VALUE               03350000
033600             '//JOBLIB   DD DSN=PKMO.LOADLIB,DISP=SHR'.           03360000
033700         10  FILLER              PIC X(41)    VALUE SPACES.       03370000
033800     05  JL-JCL-LINE-4-TEST.                                      03380000
033900         10  FILLER              PIC X(39)    VALUE               03390000
034000             '//JOBLIB   DD DSN=TKMA.LOADLIB,DISP=SHR'.           03400000
034100         10  FILLER              PIC X(41)    VALUE SPACES.       03410000
034200                                                                  03420044
034300     05  JL-JCL-LINE-4-QA.                                        03430000
034400         10  FILLER              PIC X(39)    VALUE               03440000
034500             '//JOBLIB   DD DSN=QKMO.LOADLIB,DISP=SHR'.           03450000
034600         10  FILLER              PIC X(41)    VALUE SPACES.       03460000
034700     05  JL-JCL-LINE-4-LEARN.                                     03470000
034800         10  FILLER              PIC X(39)    VALUE               03480000
034900             '//JOBLIB   DD DSN=LKMO.LOADLIB,DISP=SHR'.           03490000
035000         10  FILLER              PIC X(41)    VALUE SPACES.       03500000
035100     05  JL-JCL-LINE-12.                                          03510000
035200         10  FILLER              PIC X(16)    VALUE               03520000
035300             '//PS020    EXEC '.                                  03530000
035400         10  JL-PROC-NAME        PIC X(08).                       03540000
035500         10  FILLER              PIC X(56)    VALUE SPACES.       03550000
035600     05  JL-JCL-LINE-13.                                          03560000
035700         10  FILLER              PIC  X(34)  VALUE                03570000
035800             '//JOBOUT01 OUTPUT FORMS=STD,FCB=8S'.                03580000
035900         10  FILLER              PIC  X(17)  VALUE                03590000
036000             ',CLASS=A,COPIES=1'.                                 03600000
036100         10  FILLER              PIC  X(06)  VALUE                03610000
036200             ',DEST='.                                            03620000
036300         10  JL-LINE-13-PRINTER  PIC  X(08)  VALUE SPACES.        03630000
036400         10  FILLER              PIC  X(16)  VALUE SPACE.         03640000
036500                                                                  03650044
037200     05  JL-SYSUT1-PARM-LINE.                                     03720000
037300         10  FILLER              PIC X(02)    VALUE               03730000
037400             '//'.                                                03740000
037500         10  JL-SYSUT1-STEP      PIC X(04)    VALUE SPACE.        03750000
037600         10  FILLER              PIC X(12)    VALUE               03760000
037700             '.SYSUT1 DD *'.                                      03770000
037800         10  FILLER              PIC X(62)    VALUE SPACES.       03780000
037900     05  JL-SYSUT1-PARM-VALUE    PIC X(80)    VALUE SPACES.       03790000
038000     05  JL-JCL-LINE-EOF.                                         03800000
038100         10  FILLER              PIC X(5)     VALUE '/*EOF'.      03810000
038200         10  FILLER              PIC X(75)    VALUE SPACES.       03820000
038300                                                                  03830000
038400 01  JL-SYSUT1-VALUES.                                            03840000
038500     05  JL-SYSUT1-AUD-CNTL-LINE.                                 03850000
038600         10  JL-SYSUT1-AUD-CNTL-NBR                               03860000
038700                                 PIC 9(09).                       03870000
038800         10  JL-SYSUT1-SHIP-UNT-NBR                               03880000
038900                                 PIC 9(18).                       03890000
039000         10  JL-SYSTEM-MANUAL-AUDIT                               03900008
039100                                 PIC X(01)    VALUE SPACES.       03910008
039200             88  JL-SYSTEM-GENERATED-AUDIT    VALUE 'S'.          03920008
039300             88  JL-MANUAL-GENERATED-AUDIT    VALUE 'M'.          03930008
039400         10  JL-RFID-QC-AUDIT-IND                                 03940008
039500                                 PIC X(01)    VALUE SPACES.       03950008
039600             88  JL-RFID-AUDIT                VALUE 'R'.          03960008
039700             88  JL-QC-AUDIT                  VALUE 'S'.          03970008
039800         10  JL-RFID-QC-AUD-CMB-IND                               03980008
039900                                 PIC X(01)    VALUE SPACES.       03990008
040000             88  JL-RFID-AUD-ONLY             VALUE 'R'.          04000008
040100             88  JL-QC-AUD-ONLY               VALUE 'S'.          04010008
040200             88  JL-QC-AND-RFID-AUD           VALUE 'B'.          04020008
040300         10  FILLER              PIC X(50)    VALUE SPACES.       04030008
040400     05  JL-SYSUT1-PRT-LINE.                                      04040000
040500         10  JL-SYSUT1-PRINTER   PIC X(08)    VALUE SPACES.       04050000
040600         10  JL-SYSUT1-PRTR-IND  PIC X(01)    VALUE SPACES.       04060000
040700         10  JL-SYSUT1-TRACK-NBR PIC  9(1)    VALUE 0.            04070000
040900         10  JL-SYSUT1-BRCDE-IND PIC X(01)    VALUE SPACES.       04090000
041000         10  JL-SYSUT1-CUT-IND   PIC X(01)    VALUE SPACES.       04100000
041100         10  FILLER              PIC X(68)    VALUE SPACES.       04110000
041200                                                                  04120000
041300 01  TD-TRANSIENT-DATA-AREA.                                      04130000
041400     05  TD-QUEUE-NAME           PIC X(4)     VALUE 'IRTD'.       04140000
041500     05  TD-QUEUE-NAME-LENGTH    PIC S9(4)    VALUE +4            04150000
041600                                 COMP SYNC.                       04160000
041700     05  TD-JCL-LINE             PIC X(80)    VALUE SPACES.       04170000
041800     05  TD-JCL-LINE-LENGTH      PIC S9(4)    VALUE +80           04180000
041900                                 COMP SYNC.                       04190000
042000                                                                  04200000
042100 01  TS-TEMP-STORAGE-QUEUE-INFO.                                  04210000
042200     05  TS-INFO-QUEUE-NAME.                                      04220000
042300         10  TS-INFO-QUEUE-TERMINAL      PIC  X(04)  VALUE SPACE. 04230000
042400         10  FILLER                      PIC  X(04)  VALUE 'INFO'.04240000
042500/                                                                 04250000
042600******************************************************************04260000
042700*    COMMON CARTON CLOSE COMMUNICATION AREA                       04270000
042800******************************************************************04280000
042900     COPY SUWS091.                                                04290000
043000/                                                                 04300000
043100******************************************************************04310000
043200* COPYBOOK FOR LOGISTICS DOMAIN ITEM ACCESS MODULE                04320000
043300******************************************************************04330000
043400     COPY XLWS001.                                                04340000
043500                                                                  04350000
043600******************************************************************04360000
043700*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      04370000
043800******************************************************************04380000
043900     COPY DFHAID.                                                 04390000
044000                                                                  04400000
044100******************************************************************04410000
044200*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                04420000
044300******************************************************************04430000
044400     COPY DPWS013.                                                04440000
044500                                                                  04450000
044600******************************************************************04460000
044700*  SENDING/RECEIVING AREA FOR THE                                 04470000
044800*  PRINTER VALIDATION ROUTING (DPKCS060)                          04480000
044900******************************************************************04490000
045000     COPY DPWS072.                                                04500000
045100                                                                  04510000
045200******************************************************************04520000
045300*    COPY BOOK FOR THE CICSAUTH SUBROUTINE                        04530000
045400******************************************************************04540000
045500     COPY DPWS008.                                                04550000
045600                                                                  04560000
045700******************************************************************04570000
045800*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 04580000
045900******************************************************************04590000
046000     COPY DPWS010I.                                               04600000
046100                                                                  04610000
046200******************************************************************04620000
046300*  RANDOM NUMBER AREA.                                            04630000
046400******************************************************************04640000
046500     COPY DPWS902.                                                04650000
046600                                                                  04660000
046700******************************************************************04670000
046800*  GENERATED DSECT FOR THE SUKM515 MAPSET                         04680000
046900******************************************************************04690000
047000     COPY SUKM515.                                                04700000
047100                                                                  04710000
047200     COPY SUWS034.                                                04720000
047300                                                                  04730000
047400******************************************************************04740000
047500*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   04750000
047600******************************************************************04760000
047700     COPY DPWS015.                                                04770000
047800                                                                  04780000
047900******************************************************************04790000
048000* HELP SCREEN COMMAREA                                            04800000
048100******************************************************************04810000
048200     COPY PCWS192.                                                04820000
048300                                                                  04830000
048400******************************************************************04840000
048500* HELP SCREEN WORK AREA                                           04850000
048600******************************************************************04860000
048700     COPY PCWS188.                                                04870000
048800                                                                  04880000
048900******************************************************************04890000
049000*         DLKUP001 COMMAREA                                       04900000
049100******************************************************************04910000
049200     COPY DLWS001.                                                04920000
049300                                                                  04930000
049400*----------------------------------------------------------------*04940000
049500*         DLKUT001 COMMAREA                                       04950000
049600*----------------------------------------------------------------*04960000
049700     COPY DLWS003.                                                04970000
049800                                                                  04980000
049900*----------------------------------------------------------------*04990000
050000*         DLWS011 COPYBOOK                                        05000000
050100*----------------------------------------------------------------*05010000
050200     COPY DLWS011.                                                05020000
050300                                                                  05030000
050400*----------------------------------------------------------------*05040000
050500*         DLKCS410 COMMAREA                                       05050000
050600*----------------------------------------------------------------*05060000
050700     COPY DLWS016.                                                05070000
050800                                                                  05080000
050900*----------------------------------------------------------------*05090000
051000*         XLKUP033 COMMAREA                                       05100000
051100*----------------------------------------------------------------*05110000
051200     COPY XLWS072.                                                05120000
051300                                                                  05130000
051400*----------------------------------------------------------------*05140000
051500*         XLKUP033 COPYBOOK TO DEFINE BUSINESS EVENT DETAILS      05150000
051600*----------------------------------------------------------------*05160000
051700     COPY SUWS050.                                                05170000
051800                                                                  05180000
051900******************************************************************05190000
052000*  COPY BOOK CONTAINING ERROR/WARNING/INFORMATIONAL MESSAGES      05200000
052100*  TO BE DISPLAYED ON THE LRT                                     05210000
052200******************************************************************05220000
052300     COPY SUWS005.                                                05230000
052400                                                                  05240000
052500******************************************************************05250000
052600*    DB2 AREA FOR THE CHECK IN CROSS REFERENCE TABLE              05260000
052700******************************************************************05270000
052800     EXEC SQL                                                     05280000
052900         INCLUDE TSULBXF                                          05290000
053000     END-EXEC.                                                    05300000
053100                                                                  05310000
053200******************************************************************05320000
053300*    DB2 AREA FOR THE AUDIT ADJUSTMENTS TABLE                     05330000
053400******************************************************************05340000
053500     EXEC SQL                                                     05350000
053600         INCLUDE TSUQADJ                                          05360000
053700     END-EXEC.                                                    05370000
053800                                                                  05380000
053900******************************************************************05390000
054000*  SQL AND COBOL DECLARATIONS FOR THE KOHLS/RETEK PARMS (TKRPRPM) 05400000
054100******************************************************************05410000
054200     EXEC SQL                                                     05420000
054300          INCLUDE TKRPRPM                                         05430000
054400     END-EXEC.                                                    05440000
054500                                                                  05450000
054600******************************************************************05460000
054700*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE COMPANY CONTROL    05470000
054800*  TABLE (TCOCNTL)                                                05480000
054900******************************************************************05490000
055000     EXEC SQL                                                     05500000
055100         INCLUDE TCOCNTL                                          05510000
055200     END-EXEC.                                                    05520000
055300                                                                  05530000
055400******************************************************************05540000
055500*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      05550000
055600*  AUDIT TABLE (TSUNAUD)                                          05560000
055700******************************************************************05570000
055800     EXEC SQL                                                     05580000
055900         INCLUDE TSUNAUD                                          05590000
056000     END-EXEC.                                                    05600000
056100                                                                  05610000
056200******************************************************************05620000
056300*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      05630000
056400*  AUDIT TRANSATIONS(CARTONS) TABLE (TSUATRN)                     05640000
056500******************************************************************05650000
056600     EXEC SQL                                                     05660000
056700         INCLUDE TSUATRN                                          05670000
056800     END-EXEC.                                                    05680000
056900                                                                  05690000
057000******************************************************************05700000
057100*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      05710000
057200*  AUDIT CONTENT TABLE - UPC'S  (TSUAUPC)                         05720000
057300******************************************************************05730000
057400     EXEC SQL                                                     05740000
057500         INCLUDE TSUAUPC                                          05750000
057600     END-EXEC.                                                    05760000
057700                                                                  05770000
057800******************************************************************05780000
057900*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE UPC TABLE (XLT_UPC)05790000
058000******************************************************************05800000
058100     EXEC SQL                                                     05810000
058200         INCLUDE XLT00006                                         05820000
058300     END-EXEC.                                                    05830000
058400                                                                  05840000
058500******************************************************************05850000
058600*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      05860000
058700*  UPC TABLE (TSHUUPC)                                            05870000
058800******************************************************************05880000
058900     EXEC SQL                                                     05890000
059000         INCLUDE TSHUUPC                                          05900000
059100     END-EXEC.                                                    05910000
059200                                                                  05920000
059300******************************************************************05930000
059400*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE CARTON AUDIT       05940000
059500*  EXCEPTION TABLE (TCTEXCP)                                      05950000
059600******************************************************************05960000
059700     EXEC SQL                                                     05970000
059800         INCLUDE TCTEXCP                                          05980000
059900     END-EXEC.                                                    05990000
060000                                                                  06000000
060100******************************************************************06010000
060200*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      06020000
060300*  ITEM AUDIT EXCEPTION TABLE (TSUEXCP)                           06030000
060400******************************************************************06040000
060500     EXEC SQL                                                     06050000
060600         INCLUDE TSUEXCP                                          06060000
060700     END-EXEC.                                                    06070000
060800                                                                  06080000
060900******************************************************************06090000
061000*    DB2 AREA FOR THE PO AUDIT REQUEST TABLE (SUT_PO_AUD_REQ)     06100000
061100******************************************************************06110000
061200     EXEC SQL                                                     06120000
061300         INCLUDE SUT00015                                         06130000
061400     END-EXEC.                                                    06140000
061500                                                                  06150000
061600******************************************************************06160000
061700*    DB2 AREA FOR THE OUTBOUND CARTON TABLE (SUT_OTBND_CART)      06170000
061800******************************************************************06180000
061900     EXEC SQL                                                     06190000
062000         INCLUDE SUT00024                                         06200000
062100     END-EXEC.                                                    06210000
062200                                                                  06220000
062210******************************************************************06221047
062220*    WST_INTGRTN_TYP                                              06222047
062230******************************************************************06223047
062240     EXEC SQL                                                     06224047
062250         INCLUDE WST00008                                         06225047
062260     END-EXEC.                                                    06226047
062270                                                                  06227047
062271******************************************************************06227147
062272*    WST_ATTR_DEFN                                                06227247
062273******************************************************************06227347
062274     EXEC SQL                                                     06227447
062275         INCLUDE WST00009                                         06227547
062276     END-EXEC.                                                    06227647
062277                                                                  06227747
062280******************************************************************06228047
062290*    WST_ATTR_ELEM                                                06229047
062291******************************************************************06229147
062292     EXEC SQL                                                     06229247
062293         INCLUDE WST00010                                         06229347
062294     END-EXEC.                                                    06229447
062295                                                                  06229547
062300******************************************************************06230000
062400*  COMMUNICATIONS AREA FOR DB2                                    06240000
062500******************************************************************06250000
062600     EXEC SQL                                                     06260000
062700         INCLUDE SQLCA                                            06270000
062800     END-EXEC.                                                    06280000
062900                                                                  06290000
063000******************************************************************06300000
063100*  CURSOR DECLARATION TO SELECT ALL THE ITEMS THAT ARE SUPPOSED   06310000
063200*  TO BE ON THE CARTON ALONG WITH THE QUANTITY OF EACH            06320000
063300******************************************************************06330000
063400     EXEC SQL                                                     06340000
063500         DECLARE CARTON_ITEM_CURSOR CURSOR                        06350000
063600             FOR SELECT                                           06360000
063700                 B.INTR_UPC_ID                                    06370000
063800               , 0                                                06380000
063900               , SUM(A.SHPD_QTY)                                  06390000
064000             FROM TSHUUPC A                                       06400000
064100                , XLT_UPC B                                       06410000
064200             WHERE SHIPT_UNT_ID = :DK-SHIP-UNIT-NBR               06420000
064300               AND A.UPC_NBR = B.UPC_NBR                          06430000
064400             GROUP BY B.INTR_UPC_ID                               06440000
064500         UNION                                                    06450000
064600             SELECT                                               06460000
064700                 999999999                                        06470000
064800               , A.UPC_NBR                                        06480000
064900               , SUM(A.SHPD_QTY)                                  06490000
065000             FROM TSHUUPC A                                       06500000
065100             WHERE A.SHIPT_UNT_ID = :DK-SHIP-UNIT-NBR             06510000
065200               AND NOT EXISTS                                     06520000
065300              (SELECT  *                                          06530000
065400                 FROM XLT_UPC B                                   06540000
065500                 WHERE B.UPC_NBR = A.UPC_NBR)                     06550000
065600             GROUP BY A.UPC_NBR                                   06560000
065700         ORDER BY 1,2                                             06570000
065800     END-EXEC.                                                    06580000
065900                                                                  06590000
066000******************************************************************06600000
066100*  CURSOR DECLARATION TO SELECT ALL THE ITEMS THAT HAVE BEEN      06610000
066200*  SCANNED INTO THE AUDIT ALONG WITH THE QUANTITY OF EACH         06620000
066300******************************************************************06630000
066400     EXEC SQL                                                     06640000
066500         DECLARE AUDIT_ITEM_CURSOR CURSOR                         06650000
066600             FOR SELECT                                           06660000
066700                 B.INTR_UPC_ID                                    06670000
066800               , 0                                                06680000
066900               , SUM(SCND_UNT_QTY)                                06690000
067000             FROM TSUAUPC A                                       06700000
067100                , XLT_UPC B                                       06710000
067200             WHERE SHIPT_UNT_ID = :DK-SHIP-UNIT-NBR               06720000
067300               AND AUD_CNTL_NBR = :DK-AUDIT-CNTL-NBR              06730000
067400               AND A.UPC_NBR    = B.UPC_NBR                       06740000
067500               AND A.SCN_TYP_CDE <> 'E'                           06750000
067600             GROUP BY B.INTR_UPC_ID                               06760000
067700         UNION                                                    06770000
067800             SELECT                                               06780000
067900                 999999999                                        06790000
068000               , A.UPC_NBR                                        06800000
068100               , SUM(SCND_UNT_QTY)                                06810000
068200             FROM TSUAUPC A                                       06820000
068300             WHERE A.SHIPT_UNT_ID = :DK-SHIP-UNIT-NBR             06830000
068400               AND A.AUD_CNTL_NBR = :DK-AUDIT-CNTL-NBR            06840000
068500               AND A.SCN_TYP_CDE <> 'E'                           06850000
068600               AND NOT EXISTS                                     06860000
068700              (SELECT  *                                          06870000
068800                 FROM XLT_UPC B                                   06880000
068900                 WHERE A.UPC_NBR = B.UPC_NBR)                     06890000
069000             GROUP BY A.UPC_NBR                                   06900000
069100         ORDER BY 1,2                                             06910000
069200     END-EXEC.                                                    06920000
069300                                                                  06930000
069400******************************************************************06940000
069500     EXEC SQL                                                     06950000
069600         DECLARE CARTON_UPC_CURSOR CURSOR                         06960000
069700             FOR SELECT                                           06970000
069800                 A.UPC_NBR                                        06980000
069900               , SUM(A.SHPD_QTY)                                  06990000
070000             FROM TSHUUPC A                                       07000000
070100                , XLT_UPC B                                       07010000
070200             WHERE SHIPT_UNT_ID        = :DK-SHIP-UNIT-NBR        07020000
070300               AND A.UPC_NBR           = B.UPC_NBR                07030000
070400               AND B.INTR_UPC_ID       = :PV-EXPECT-INTR-UPC      07040000
070500             GROUP BY A.UPC_NBR                                   07050000
070600             ORDER BY A.UPC_NBR                                   07060000
070700     END-EXEC.                                                    07070000
070800                                                                  07080000
070900******************************************************************07090000
071000     EXEC SQL                                                     07100000
071100         DECLARE AUDIT_UPC_CURSOR CURSOR WITH HOLD                07110000
071200             FOR SELECT                                           07120000
071300                 A.UPC_NBR                                        07130000
071400               , SUM(A.SCND_UNT_QTY)                              07140000
071500             FROM TSUAUPC A                                       07150000
071600                , XLT_UPC B                                       07160000
071700             WHERE SHIPT_UNT_ID        = :DK-SHIP-UNIT-NBR        07170000
071800               AND AUD_CNTL_NBR        = :DK-AUDIT-CNTL-NBR       07180000
071900               AND A.UPC_NBR           = B.UPC_NBR                07190000
072000               AND B.INTR_UPC_ID       = :PV-EXPECT-INTR-UPC      07200000
072100               AND A.SCN_TYP_CDE      <> 'E'                      07210000
072200             GROUP BY A.UPC_NBR                                   07220000
072300             ORDER BY A.UPC_NBR                                   07230000
072400     END-EXEC.                                                    07240000
072500                                                                  07250000
072600******************************************************************07260000
072800                                                                  07280000
072900     EXEC SQL                                                     07290000
073000         DECLARE RFTAG_SCAN_CURSOR CURSOR WITH HOLD               07300000
073100             FOR SELECT                                           07310000
073200                 UPC_NBR                                          07320000
073300               , SUM(SCND_UNT_QTY)                                07330000
073400               , SUM(RFID_TGD_QTY)                                07340000
073500             FROM TSUAUPC                                         07350000
073600            WHERE AUD_CNTL_NBR  = :DK-AUDIT-CNTL-NBR              07360000
073700              AND SHIPT_UNT_ID  = :DK-SHIP-UNIT-NBR               07370000
073800              AND SCN_TYP_CDE   <> 'E'                            07380003
073900            GROUP BY UPC_NBR                                      07390000
074000            ORDER BY UPC_NBR                                      07400000
074100     END-EXEC.                                                    07410000
074200                                                                  07420000
074500******************************************************************07450000
074600 LINKAGE SECTION.                                                 07460000
074700******************************************************************07470000
074800 01  DFHCOMMAREA.                                                 07480000
074900     05  FILLER                         OCCURS  1 TO 4072 TIMES   07490000
075000                                        DEPENDING ON EIBCALEN.    07500000
075100         10  FILLER                     PIC X.                    07510000
075200                                                                  07520000
075300                                                                  07530000
075400******************************************************************07540000
075500 PROCEDURE DIVISION.                                              07550000
075600******************************************************************07560000
075700 0000-PROGRAM-MAINLINE.                                           07570000
075800                                                                  07580000
075900     MOVE DFHCOMMAREA  TO CA-COMMAREA.                            07590000
076000     MOVE LOW-VALUES   TO SU515AI.                                07600000
076100                                                                  07610000
076200     EVALUATE TRUE                                                07620000
076300         WHEN EIBTRNID = 'Z278'                                   07630000
076400*          *******************************************            07640000
076500*          *DPKRF278 IS THE PGM FOR THE HELP SCREEN.              07650000
076600*          *******************************************            07660000
076700             MOVE DFHCOMMAREA          TO PC192-COMMAREA          07670000
076800             MOVE PC192-HOST-SAVE-AREA TO CA-COMMAREA             07680000
076900             SET SU006-PROCESS-SCREEN  TO TRUE                    07690000
077000             PERFORM 1000-SETUP-SCREEN                            07700000
077100             PERFORM 8000-SEND-MAP                                07710000
077200             PERFORM 8200-RETURN-TRANID                           07720000
077300                                                                  07730000
077400         WHEN EIBCALEN = ZERO                                     07740000
077500         WHEN EIBAID = DFHCLEAR                                   07750000
077600         WHEN SU006-INITIALIZE-SCREEN                             07760000
077700             INITIALIZE CA-PROGRAM-COMMAREA                       07770000
077800             SET SU006-PROCESS-SCREEN    TO TRUE                  07780000
077900             PERFORM 1000-SETUP-SCREEN                            07790000
078000             PERFORM 8000-SEND-MAP                                07800000
078100             PERFORM 8200-RETURN-TRANID                           07810000
078200             SET CA-NOT-IN-CONFIRM-STATE  TO TRUE                 07820000
078300                                                                  07830000
078400         WHEN EIBAID = DFHENTER                                   07840000
078500             PERFORM 1200-RECEIVE-MAP                             07850000
078600             PERFORM 1300-EDIT-SELECTION                          07860000
078700                                                                  07870000
078800             PERFORM 2000-PROCESS-SCREEN                          07880000
078810                                                                  07881044
078900*          FOR COMBINED AUDITS (QC AND RFID) BOTH SETS OF AUDITS  07890000
079000*          MUST BE UPDATED AND KEPT IN SYNC                       07900000
079010                                                                  07901044
079100             IF SU006-QC-AND-RFID-AUD                             07910000
079200                PERFORM 2050-PROCESS-SCREEN-FOR-CMBND             07920000
079300             END-IF                                               07930000
079400                                                                  07940000
079500*        F2 TO CONFIRM WAS PRESSED.  IF IT'S IN A CONFIRMED       07950000
079600*        STATE, SET FLAG TO SAY THE ACTION HAS BEEN CONFIRMED.    07960000
079700*        IF IT'S NOT IN A CONFIRMED STATE, IT'S AN INVALID KEY    07970000
079710                                                                  07971044
079800         WHEN EIBAID = DFHPF2                                     07980000
079900             IF CA-IN-CONFIRM-STATE                               07990000
080000                SET CA-CONFIRMED                 TO TRUE          08000000
080100                PERFORM 2000-PROCESS-SCREEN                       08010000
080110                                                                  08011044
080200*            FOR COMBINED AUDITS (QC AND RFID) BOTH SETS OF AUDITS08020000
080300*            MUST BE UPDATED AND KEPT IN SYNC                     08030000
080310                                                                  08031044
080400                 IF SU006-QC-AND-RFID-AUD                         08040000
080500                    PERFORM 2050-PROCESS-SCREEN-FOR-CMBND         08050000
080600                 END-IF                                           08060000
080700             ELSE                                                 08070000
080800                MOVE PM-UNRECOGNIZED-PF-KEY-MSG  TO  AMSGLNO      08080000
080900             END-IF                                               08090000
081000                                                                  08100000
081100         WHEN EIBAID = DFHPF3                                     08110000
081200             PERFORM 1200-RECEIVE-MAP                             08120000
081300             PERFORM 1300-EDIT-SELECTION                          08130000
081400                                                                  08140000
081500              PERFORM 3700-SELECT-AUDIT                           08150000
081600              IF  PS-SYSTEM-AUDIT-FOUND                           08160000
081700              AND NOT SU006-SYSTEM-GENERATED-AUDIT                08170000
081800                  MOVE SPACES TO PV-CICS-MSG-AREA2                08180000
081900                  STRING                                          08190000
082000                  ' SUKRF515 - SU006-SYSTEM-GENERATED-AUD ERR'    08200000
082100                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08210000
082200                  PERFORM 999A-WRITE-CSSL-MSG                     08220000
082300                  MOVE SPACES TO PV-CICS-MSG-AREA2                08230000
082400                  STRING ' USER = ' SU006-USERID                  08240000
082500                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08250000
082600                  PERFORM 999A-WRITE-CSSL-MSG                     08260000
082700                  MOVE SPACES TO PV-CICS-MSG-AREA2                08270000
082800                  STRING ' AUDIT= ' SU006-AUDIT-CNTL-NBR          08280000
082900                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08290000
083000                  PERFORM 999A-WRITE-CSSL-MSG                     08300000
083100                  MOVE SPACES TO PV-CICS-MSG-AREA2                08310000
083200                  STRING ' CART = ' SU006-SHIP-UNIT-NBR           08320000
083300                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08330000
083400                  PERFORM 999A-WRITE-CSSL-MSG                     08340000
083500                  MOVE SPACES TO PV-CICS-MSG-AREA2                08350000
083600                  STRING ' PKG-CDE = ' SU006-PKGNG-CDE-IND        08360000
083700                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08370000
083800                  PERFORM 999A-WRITE-CSSL-MSG                     08380000
083900                  MOVE SPACES TO PV-CICS-MSG-AREA2                08390000
084000                  STRING ' AUDIT  = ' SU006-SYSTEM-MANUAL-AUDIT   08400000
084100                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08410000
084200                  PERFORM 999A-WRITE-CSSL-MSG                     08420000
084300                  MOVE SPACES TO PV-CICS-MSG-AREA2                08430000
084400                  STRING ' LOC    = ' SU006-LOCATION-LOGON-IND    08440000
084500                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08450000
084600                  PERFORM 999A-WRITE-CSSL-MSG                     08460000
084700                  SET SU006-SYSTEM-GENERATED-AUDIT TO TRUE        08470000
084800              ELSE                                                08480000
084900                IF PS-SYSTEM-AUDIT-FOUND                          08490000
085000                  IF (SUT00015-CART-QTY > SUT00015-AUD-CART-QTY   08500000
085100                  AND SUT00015-UNT-QTY  > SUT00015-AUD-UNT-QTY)   08510000
085200                   OR                                             08520000
085300                     (SUT00015-CART-QTY > SUT00015-AUD-CART-QTY   08530000
085400                  AND SUT00015-UNT-QTY  = 0)                      08540000
085500                      CONTINUE                                    08550000
085600                  ELSE                                            08560000
085700                   MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR 08570000
085800                   MOVE SU006-SHIP-UNIT-NBR  TO DK-SHIP-UNIT-NBR  08580000
085900                   PERFORM 3050-GET-STAT-CDE                      08590000
086000                   IF NOT SU006-SHIP-UNIT-COMPLETE                08600000
086100                    MOVE SPACES TO PV-CICS-MSG-AREA2              08610000
086200                    STRING                                        08620000
086300                    ' SUKRF515 - SU006-SHIP-UNIT-COMPLETE-ERR'    08630000
086400                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08640000
086500                    PERFORM 999A-WRITE-CSSL-MSG                   08650000
086600                    MOVE SPACES TO PV-CICS-MSG-AREA2              08660000
086700                    STRING ' USER = ' SU006-USERID                08670000
086800                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08680000
086900                    PERFORM 999A-WRITE-CSSL-MSG                   08690000
087000                    MOVE SPACES TO PV-CICS-MSG-AREA2              08700000
087100                    STRING ' AUDIT= ' SU006-AUDIT-CNTL-NBR        08710000
087200                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08720000
087300                    PERFORM 999A-WRITE-CSSL-MSG                   08730000
087400                    MOVE SPACES TO PV-CICS-MSG-AREA2              08740000
087500                    STRING ' CART = ' SU006-SHIP-UNIT-NBR         08750000
087600                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08760000
087700                    PERFORM 999A-WRITE-CSSL-MSG                   08770000
087800                    MOVE SPACES TO PV-CICS-MSG-AREA2              08780000
087900                    STRING ' STATUS=' SU006-SHIP-UNIT-STATUS      08790000
088000                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08800000
088100                    PERFORM 999A-WRITE-CSSL-MSG                   08810000
088200                    MOVE SPACES TO PV-CICS-MSG-AREA2              08820000
088300                    STRING ' CTN STAT=' SUATRN-UNT-AUD-STAT-CDE   08830000
088400                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08840000
088500                    PERFORM 999A-WRITE-CSSL-MSG                   08850000
088600                    MOVE SPACES TO PV-CICS-MSG-AREA2              08860000
088700                    MOVE SUT00015-CART-QTY     TO PV-DISP-COUNTS  08870000
088800                    STRING ' CTN QTY =' PV-DISP-COUNTS            08880000
088900                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08890000
089000                    PERFORM 999A-WRITE-CSSL-MSG                   08900000
089100                    MOVE SPACES TO PV-CICS-MSG-AREA2              08910000
089200                    MOVE SUT00015-AUD-CART-QTY TO PV-DISP-COUNTS  08920000
089300                    STRING ' AUD CART QTY =' PV-DISP-COUNTS       08930000
089400                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08940000
089500                    PERFORM 999A-WRITE-CSSL-MSG                   08950000
089600                    MOVE SPACES TO PV-CICS-MSG-AREA2              08960000
089700                    MOVE SUT00015-UNT-QTY      TO PV-DISP-COUNTS  08970000
089800                    STRING ' UNT QTY =' PV-DISP-COUNTS            08980000
089900                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08990000
090000                    PERFORM 999A-WRITE-CSSL-MSG                   09000000
090100                    MOVE SPACES TO PV-CICS-MSG-AREA2              09010000
090200                    MOVE SUT00015-AUD-UNT-QTY  TO PV-DISP-COUNTS  09020000
090300                    STRING ' AUD UNT QTY =' PV-DISP-COUNTS        09030000
090400                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     09040000
090500                    PERFORM 999A-WRITE-CSSL-MSG                   09050000
090600                    IF SUATRN-UNT-AUD-STAT-CDE = 'CM'             09060000
090700                      SET SU006-SHIP-UNIT-COMPLETE  TO TRUE       09070000
090800                    END-IF                                        09080000
090900                   END-IF                                         09090000
091000                  END-IF                                          09100000
091100                END-IF                                            09110000
091200              END-IF                                              09120000
091300                                                                  09130000
091400              IF SU006-SYSTEM-GENERATED-AUDIT AND                 09140000
091500                 SU006-SHIP-UNIT-COMPLETE                         09150000
091510                                                                  09151044
091600*    PRINTER ID IS REQUIRED                                       09160000
091610                                                                  09161044
091700                IF SU006-PRINTER-DEST = SPACES                    09170000
091800                   MOVE PM-PRINTER-ID-REQUIRED-MSG  TO  AMSGLNO   09180000
091900                   MOVE -1                          TO  ASELECTL  09190000
092000                   PERFORM 8100-SEND-DATA-ONLY                    09200000
092100                   PERFORM 8200-RETURN-TRANID                     09210000
092200                ELSE                                              09220000
092201                                                                  09220145
092202                  IF SU006-PRINTER-DEST = PC-PRINT-TO-FILE        09220245
092203                     SET PS-PRINT-TO-FILE-NO  TO TRUE             09220345
092204                     PERFORM 1320-VALIDATE-PRINT-TO-FILE          09220445
092205                                                                  09220556
092216                     IF  PS-PRINT-TO-FILE-YES                     09221645
092217                         MOVE SPACES       TO  CA-PRTR-CNTL-IND   09221745
092218                         MOVE ZEROES       TO  CA-TRACK-NBR       09221845
092219                     ELSE                                         09221948
092220                        MOVE PC-PRINT-TO-FILE-ERR-MSG TO AMSGLNO  09222048
092221                        MOVE -1                       TO  ASELECTL09222148
092222                        PERFORM 8100-SEND-DATA-ONLY               09222248
092223                        PERFORM 8200-RETURN-TRANID                09222348
092224                     END-IF                                       09222448
092225                  ELSE                                            09222548
092230                    PERFORM 1310-VALIDATE-PRINTER                 09223047
092400                    IF DP072-PRTR-PRTR-TRK-STAT-CDE NOT EQUAL 'A' 09240045
092500                       MOVE PM-INVALID-PRINTER-ID-MSG TO  AMSGLNO 09250000
092600                       MOVE -1                       TO  ASELECTL 09260000
092700                       PERFORM 8100-SEND-DATA-ONLY                09270000
092800                       PERFORM 8200-RETURN-TRANID                 09280000
092900                    ELSE                                          09290045
093000                       MOVE PC-AUDIT-STATUS-PROGRAM               09300000
093100                                          TO  PV-TRANSFER-PROGRAM 09310000
093200                       PERFORM 2100-XCTL-TO-SELECTED-PROGRAM      09320000
093300                    END-IF                                        09330045
093400                  END-IF                                          09340045
093410                END-IF                                            09341045
093500              ELSE                                                09350000
093600                  IF SU006-INSTREAM-AUDIT                         09360000
093700                     MOVE PC-MUST-CLOSE-AUDIT-MSG                 09370000
093800                                         TO AMSGLNO               09380000
093900                 ELSE                                             09390000
094000                      MOVE PC-CARTON-OPEN-PROGRAM-NAME            09400000
094100                                         TO PV-TRANSFER-PROGRAM   09410000
094200                      PERFORM 2100-XCTL-TO-SELECTED-PROGRAM       09420000
094300                  END-IF                                          09430000
094400              END-IF                                              09440000
094500                                                                  09450000
094600         WHEN EIBAID = DFHPF1                                     09460000
094700              PERFORM 1400-HELP-SCREEN                            09470000
094800                                                                  09480000
094900         WHEN OTHER                                               09490000
095000             SET CA-NOT-IN-CONFIRM-STATE      TO TRUE             09500000
095100             MOVE PM-UNRECOGNIZED-PF-KEY-MSG  TO AMSGLNO          09510000
095200                                                                  09520000
095300     END-EVALUATE.                                                09530000
095400                                                                  09540000
095500     PERFORM 8100-SEND-DATA-ONLY.                                 09550000
095600     PERFORM 8200-RETURN-TRANID.                                  09560000
095700                                                                  09570000
095800     GOBACK.                                                      09580000
095900                                                                  09590000
096000******************************************************************09600000
096100* 1000-SETUP-SCREEN                                               09610000
096200*    INITIAL SETUP OF AUDIT NUMBER AND STATUS                     09620000
096300******************************************************************09630000
096400 1000-SETUP-SCREEN.                                               09640000
096500                                                                  09650000
096600*    SET SHIPPING UNIT NUMBER (CARTON)                            09660000
096610                                                                  09661044
096700     MOVE SU006-SHIP-UNIT-NBR-X       TO ACARTONO.                09670000
096800                                                                  09680000
096900*    IF NEEDED, GET DEFAULT PRINTER ID                            09690000
096910                                                                  09691044
097000     IF SU006-PRINTER-DEST = SPACES                               09700000
097100         PERFORM 1010-GET-DEFAULT-PRINTER                         09710000
097200     END-IF.                                                      09720000
097300                                                                  09730000
097400     MOVE SU006-PRINTER-DEST TO ADESTO.                           09740000
097500                                                                  09750000
097600*   GET THE EXPECTED AND SCANNED QUANTITY                         09760000
097700     IF SU006-RFID-AUD-ONLY                                       09770000
097800        PERFORM 4180-CHCK-RFID-ONLY-QTYS                          09780000
097900     ELSE                                                         09790000
098000        PERFORM 1020-GET-EXP-QTY                                  09800000
098100        PERFORM 1040-GET-SCN-QTY                                  09810000
098200     END-IF.                                                      09820000
098300                                                                  09830000
098400*    IF THERE ARE ERRORS, TELL THE USER.  IF NOT, CHECK IF THERE  09840000
098500*    ARE OVER/SHORT ERRORS...IF THERE ARE TELL THE USER.          09850000
098510                                                                  09851044
098600     IF SU006-SYSTEM-GENERATED-AUDIT                              09860000
098700         CONTINUE                                                 09870000
098800     ELSE                                                         09880000
099500         PERFORM 4100-CHECK-OVER-SHORT                            09950044
099600         IF  PS-OVER-SHORT-ERROR                                  09960044
099700             OR SU006-AUD-ERR                                     09970044
099800             MOVE PM-ERROR-EXISTS-MSG                             09980044
099900                                 TO AMSGLNO                       09990000
100000         END-IF                                                   10000044
100200     END-IF.                                                      10020000
100300                                                                  10030000
100400     MOVE -1                  TO ASELECTL.                        10040000
100500                                                                  10050000
100600******************************************************************10060000
100700* 1010-GET-DEFAULT-PRINTER                                       *10070000
100800*    SELECT THE DEFAULT PRINTER FROM THE COMPANY CONTROL TABLE   *10080000
100900* THERE ARE DEFAULTS FOR EACH AUDITING PROCESS AREA & LOGISTICS  *10090000
101000* WITHIN EACH FACILITY.  SELECT OF ALL FOUR ID'S FOR THE GIVEN   *10100000
101100* OPER UNIT ID AND THEN DETERMINE WHICH TO DISPLAY.              *10110000
101200******************************************************************10120000
101300 1010-GET-DEFAULT-PRINTER.                                        10130000
101400                                                                  10140000
101500     MOVE SU006-OPER-UNT-ID     TO DK-OPER-UNT-ID.                10150000
101600                                                                  10160000
101700     EXEC SQL                                                     10170000
101800            SELECT  CA_RCVG_PRTR_ID                               10180000
101900                   ,CA_FLAT_PRTR_ID                               10190000
102000                   ,CA_SHIP_PRTR_ID                               10200000
102100            INTO   :COCNTL-CA-RCVG-PRTR-ID                        10210000
102200                  ,:COCNTL-CA-FLAT-PRTR-ID                        10220000
102300                  ,:COCNTL-CA-SHIP-PRTR-ID                        10230000
102400            FROM    TCOCNTL                                       10240000
102500            WHERE OPER_UNT_ID  = :DK-OPER-UNT-ID                  10250000
102600              AND FCLTY_ID     = 1                                10260000
102700     END-EXEC.                                                    10270000
102800                                                                  10280000
102900     IF SQLCODE = ZERO                                            10290000
103000         EVALUATE TRUE                                            10300000
103100           WHEN SU006-RECV-PRCS-AREA                              10310000
103200               MOVE COCNTL-CA-RCVG-PRTR-ID                        10320000
103300                                      TO SU006-PRINTER-DEST       10330000
103400                                                                  10340000
103500           WHEN SU006-FLAT-PRCS-AREA                              10350000
103600               MOVE COCNTL-CA-FLAT-PRTR-ID                        10360000
103700                                      TO SU006-PRINTER-DEST       10370000
103800                                                                  10380000
103900           WHEN SU006-SHIP-PRCS-AREA                              10390000
104000               MOVE COCNTL-CA-SHIP-PRTR-ID                        10400000
104100                                      TO SU006-PRINTER-DEST       10410000
104200         END-EVALUATE                                             10420000
104300     ELSE                                                         10430000
104400         MOVE '1010-GET-DEFAULT-PRINTER' TO DP013-PARAGRAPH       10440000
104500         MOVE 'SELECT OF TCOCNTL'        TO DP013-MESSAGE-TEXT (1)10450000
104600         MOVE DK-OPER-UNT-ID             TO DP013-MESSAGE-TEXT (2)10460000
104700         MOVE SQLCA                      TO DP013-SQLCA           10470000
104800         MOVE 'TCOCNTL'                  TO                       10480000
104900                                         DP013-DB2-TABLE-NAME (1) 10490000
105000         SET DP013-DB2-ABEND             TO TRUE                  10500000
105100         SET DP013-NO-ROLLBACK           TO TRUE                  10510000
105200         PERFORM 9999-WRITE-CICS-LOG-MSG                          10520000
105300                                                                  10530000
105400         MOVE PM-DB2-FATAL-ERROR-MSG     TO AMSGLNO               10540000
105500         MOVE -1                         TO ASELECTL              10550000
105600         PERFORM 8100-SEND-DATA-ONLY                              10560000
105700         PERFORM 8200-RETURN-TRANID                               10570000
105800     END-IF.                                                      10580000
105900                                                                  10590000
106000******************************************************************10600000
106100* 1020-GET-EXP-QTY                                               *10610000
106200*    SELECT THE QUANTITY EXPECTED IN THE CARTON                  *10620000
106300******************************************************************10630000
106400 1020-GET-EXP-QTY.                                                10640000
106500                                                                  10650000
106600     MOVE SU006-SHIP-UNIT-NBR   TO DK-SHIP-UNIT-NBR.              10660000
106700                                                                  10670000
106800     EXEC SQL                                                     10680000
106900          SELECT SUM(SHPD_QTY)                                    10690000
107000            INTO :PV-EXP-QTY                                      10700000
107100            FROM TSHUUPC                                          10710000
107200            WHERE SHIPT_UNT_ID = :DK-SHIP-UNIT-NBR                10720000
107300     END-EXEC.                                                    10730000
107400                                                                  10740000
107500     IF SQLCODE = ZERO                                            10750000
107600        MOVE PV-EXP-QTY      TO PV-EXP-QTY-SHRT                   10760000
107700        MOVE PV-EXP-QTY-SHRT TO AEXPQTYO                          10770000
107800     ELSE                                                         10780000
107900        IF SQLCODE = +100                                         10790000
108000        OR SQLCODE = -305                                         10800000
108100           MOVE ZERO                     TO AEXPQTYO              10810000
108200        ELSE                                                      10820000
108300           MOVE '1020-GET-EXP-QTY'       TO DP013-PARAGRAPH       10830000
108400           MOVE 'SELECT OF TSHUUPC'      TO DP013-MESSAGE-TEXT (1)10840000
108500           MOVE DK-SHIP-UNIT-NBR         TO DP013-MESSAGE-TEXT (2)10850000
108600           MOVE SQLCA                    TO DP013-SQLCA           10860000
108700           MOVE 'TSHUUPC'              TO DP013-DB2-TABLE-NAME (1)10870000
108800           SET DP013-DB2-ABEND           TO TRUE                  10880000
108900           SET DP013-NO-ROLLBACK         TO TRUE                  10890000
109000           PERFORM 9999-WRITE-CICS-LOG-MSG                        10900000
109100                                                                  10910000
109200           MOVE PM-DB2-FATAL-ERROR-MSG   TO AMSGLNO               10920000
109300           MOVE -1                       TO ASELECTL              10930000
109400           PERFORM 8100-SEND-DATA-ONLY                            10940000
109500           PERFORM 8200-RETURN-TRANID                             10950000
109600        END-IF                                                    10960000
109700     END-IF.                                                      10970000
109800                                                                  10980000
109900******************************************************************10990000
110000* 1040-GET-SCN-QTY                                               *11000000
110100*    SELECT THE QUANTITY AUDITED IN THE CARTON                   *11010000
110200******************************************************************11020000
110300 1040-GET-SCN-QTY.                                                11030000
110400                                                                  11040000
110500*    IF THIS IS THE FIRST AUDIT PROCESSED IT SHOULD BE A QC AUDIT 11050000
110600*    AND WE WANT TO PROCESS USING THE QC AUDIT NUMBER.  IF THIS IS11060000
110700*    AN RFID ONLY AUDIT, THEN THE RFID AUDIT NUMBER WILL BE       11070000
110800*    CONTAINED IN THIS FIELD AND WE WANT TO USE IT.  IF NEITHER,  11080000
110900*    THEN IT'S A COMBINED AUDIT AND THE RFID AUDIT SHOULD PROCESS 11090000
111000*    SECOND IN THIS SCENARIO.                                     11100000
111010                                                                  11101044
111100     IF PS-PRCS-FIRST-AUDIT                                       11110000
111200     OR SU006-RFID-AUD-ONLY                                       11120000
111300     OR SU006-MANUAL-GENERATED-AUDIT                              11130000
111400         MOVE SU006-AUDIT-CNTL-NBR   TO DK-AUDIT-CNTL-NBR         11140000
111500     ELSE                                                         11150000
111600         MOVE SU006-RFID-AUDIT-CNTL-NBR                           11160000
111700                                     TO DK-AUDIT-CNTL-NBR         11170000
111800     END-IF.                                                      11180000
111900                                                                  11190044
112000     MOVE SU006-SHIP-UNIT-NBR   TO DK-SHIP-UNIT-NBR.              11200000
112100                                                                  11210000
113300     EXEC SQL                                                     11330000
113400          SELECT SUM(SCND_UNT_QTY)                                11340000
113500            INTO :PV-SCN-QTY                                      11350000
113600            FROM TSUAUPC                                          11360000
113700            WHERE AUD_CNTL_NBR = :DK-AUDIT-CNTL-NBR               11370000
113800              AND SHIPT_UNT_ID = :DK-SHIP-UNIT-NBR                11380000
113900              AND SCN_TYP_CDE <> 'E'                              11390000
114000     END-EXEC.                                                    11400000
114100                                                                  11410000
114200*IF THE ASSOCIATE GOES TO THE CARTON CLOSE WITHOUT SCANNING A UPC 11420000
114300*THE SQLCODE WILL BE -305                                         11430000
114400                                                                  11440000
114500     EVALUATE TRUE                                                11450000
114600        WHEN SQLCODE = ZERO                                       11460000
114700          MOVE PV-SCN-QTY       TO PV-SCN-QTY-SHRT                11470000
114800          MOVE PV-SCN-QTY-SHRT  TO ASCNQTYO                       11480000
114900                                                                  11490000
115000        WHEN SQLCODE = -305                                       11500000
115100           MOVE ZEROES           TO PV-SCN-QTY                    11510000
115200                                    PV-SCN-QTY-SHRT               11520000
115300           MOVE PV-SCN-QTY-SHRT  TO ASCNQTYO                      11530000
115400                                                                  11540000
115500        WHEN SQLCODE = +100                                       11550000
115600           MOVE ZERO          TO ASCNQTYO                         11560000
115700                                                                  11570000
115800        WHEN OTHER                                                11580000
115900             MOVE '1040-GET-SCN-QTY'     TO DP013-PARAGRAPH       11590000
116000             MOVE 'SELECT OF TSUAUPC'    TO DP013-MESSAGE-TEXT (1)11600000
116100             MOVE DK-AUDIT-CNTL-NBR      TO DK-AUDIT-CNTL-NBR-X   11610000
116200             MOVE DK-AUDIT-CNTL-NBR-X    TO DP013-MESSAGE-TEXT (2)11620000
116300             MOVE DK-SHIP-UNIT-NBR       TO DP013-MESSAGE-TEXT (3)11630000
116400             MOVE SQLCA                  TO DP013-SQLCA           11640000
116500             MOVE 'TSUAUPC'            TO DP013-DB2-TABLE-NAME (1)11650000
116600             SET DP013-DB2-ABEND         TO TRUE                  11660000
116700             SET DP013-NO-ROLLBACK       TO TRUE                  11670000
116800             PERFORM 9999-WRITE-CICS-LOG-MSG                      11680000
116900             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               11690000
117000             MOVE -1                     TO ASELECTL              11700000
117100             PERFORM 8100-SEND-DATA-ONLY                          11710000
117200             PERFORM 8200-RETURN-TRANID                           11720000
117300     END-EVALUATE.                                                11730000
117400                                                                  11740000
117500******************************************************************11750000
117600* THIS PARAGRAPH WILL GET THE TOTAL NUMBER OF CARTONS AUDITED FOR*11760000
117700* THIS AUDIT SO FAR.  ONLY COUNTS CLOSED CARTONS.                *11770000
117800******************************************************************11780000
117900 1045-CALC-AUDIT-CRTNS.                                           11790000
118000                                                                  11800000
118100**   MOVE SU006-AUDIT-CNTL-NBR  TO DK-AUDIT-CNTL-NBR.             11810000
118200                                                                  11820000
118300     EXEC SQL                                                     11830000
118400          SELECT COUNT(*)                                         11840000
118500            INTO :PV-AUDIT-CRTN-COUNT                             11850000
118600            FROM TSUATRN A                                        11860000
118700           WHERE A.AUD_CNTL_NBR       = :DK-AUDIT-CNTL-NBR        11870000
118800             AND A.UNT_AUD_STRT_TMST <> :PC-DEFAULT-TMST          11880000
118900             AND A.UNT_AUD_STP_TMST  <> :PC-DEFAULT-TMST          11890000
119000     END-EXEC.                                                    11900000
119100                                                                  11910000
119200     EVALUATE TRUE                                                11920000
119300        WHEN SQLCODE = ZERO                                       11930000
119400             CONTINUE                                             11940000
119500                                                                  11950000
119600        WHEN SQLCODE = +100                                       11960000
119700           MOVE ZERO            TO PV-AUDIT-CRTN-COUNT            11970000
119800                                                                  11980000
119900        WHEN OTHER                                                11990000
120000             MOVE '1045-CALC-AUDIT-CRTNS'                         12000000
120100                                         TO DP013-PARAGRAPH       12010000
120200             MOVE 'CALC AUDITED CARTONS' TO DP013-MESSAGE-TEXT (1)12020000
120300             MOVE DK-AUDIT-CNTL-NBR      TO DK-AUDIT-CNTL-NBR-X   12030000
120400             MOVE DK-AUDIT-CNTL-NBR-X    TO DP013-MESSAGE-TEXT (2)12040000
120500             MOVE SQLCA                  TO DP013-SQLCA           12050000
120600             MOVE 'TSUATRN'            TO DP013-DB2-TABLE-NAME (1)12060000
120700             SET DP013-DB2-ABEND         TO TRUE                  12070000
120800             SET DP013-NO-ROLLBACK       TO TRUE                  12080000
120900             PERFORM 9999-WRITE-CICS-LOG-MSG                      12090000
121000             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               12100000
121100             MOVE -1                     TO ASELECTL              12110000
121200             PERFORM 8100-SEND-DATA-ONLY                          12120000
121300             PERFORM 8200-RETURN-TRANID                           12130000
121400     END-EVALUATE.                                                12140000
121500                                                                  12150000
121600******************************************************************12160000
121700* THIS PARAGRAPH WILL GET THE TOTAL NUMBER OF UNITS AUDITED FOR  *12170000
121800* THIS AUDIT SO FAR. COUNTS UNITS IN CLOSED CARTONS ONLY.        *12180000
121900******************************************************************12190000
122000 1050-CALC-AUDIT-UNITS.                                           12200000
122100                                                                  12210000
122200                                                                  12220000
122300     EXEC SQL                                                     12230000
122400           SELECT SUM(B.SCND_UNT_QTY)                             12240000
122500             INTO :PV-AUDIT-UNIT-QTY                              12250000
122600             FROM TSUATRN A                                       12260000
122700                , TSUAUPC B                                       12270000
122800            WHERE A.AUD_CNTL_NBR        = :DK-AUDIT-CNTL-NBR      12280000
122900              AND A.AUD_CNTL_NBR        =  B.AUD_CNTL_NBR         12290000
123000              AND A.SHIPT_UNT_ID        =  B.SHIPT_UNT_ID         12300000
123100              AND A.UNT_AUD_STRT_TMST  <> :PC-DEFAULT-TMST        12310000
123200              AND A.UNT_AUD_STP_TMST   <> :PC-DEFAULT-TMST        12320000
123300              AND SCN_TYP_CDE <> 'E'                              12330000
123400     END-EXEC.                                                    12340000
123500                                                                  12350000
123600*IF THE ASSOCIATE GOES TO THE CARTON CLOSE WITHOUT SCANNING A UPC 12360000
123700*THE SQLCODE WILL BE -305                                         12370000
123800                                                                  12380000
123900     EVALUATE TRUE                                                12390000
124000        WHEN SQLCODE = ZERO                                       12400000
124100             CONTINUE                                             12410000
124200                                                                  12420000
124300        WHEN SQLCODE = +100                                       12430000
124400        WHEN SQLCODE = -305                                       12440000
124500             MOVE ZEROES                 TO PV-AUDIT-UNIT-QTY     12450000
124600                                                                  12460000
124700        WHEN OTHER                                                12470000
124800             MOVE '1050-CALC-AUDIT-UNITS'                         12480000
124900                                         TO DP013-PARAGRAPH       12490000
125000             MOVE 'CALC AUDITED UNITS'   TO DP013-MESSAGE-TEXT (1)12500000
125100             MOVE DK-AUDIT-CNTL-NBR      TO DK-AUDIT-CNTL-NBR-X   12510000
125200             MOVE DK-AUDIT-CNTL-NBR-X    TO DP013-MESSAGE-TEXT (2)12520000
125300             MOVE SQLCA                  TO DP013-SQLCA           12530000
125400             MOVE 'TSUATRN'            TO DP013-DB2-TABLE-NAME (1)12540000
125500             MOVE 'TSUAUPC'            TO DP013-DB2-TABLE-NAME (2)12550000
125600             SET DP013-DB2-ABEND         TO TRUE                  12560000
125700             SET DP013-NO-ROLLBACK       TO TRUE                  12570000
125800             PERFORM 9999-WRITE-CICS-LOG-MSG                      12580000
125900             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               12590000
126000             MOVE -1                     TO ASELECTL              12600000
126100             PERFORM 8100-SEND-DATA-ONLY                          12610000
126200             PERFORM 8200-RETURN-TRANID                           12620000
126300     END-EVALUATE.                                                12630000
126400                                                                  12640000
126500******************************************************************12650000
126600* THIS PARAGRAPH WILL GET THE TOTAL NUMBER OF UNITS AUDITED FOR  *12660000
126700* THIS AUDIT SO FAR. COUNTS UNITS IN CLOSED CARTONS ONLY.        *12670000
126800******************************************************************12680000
126900 1052-CALC-RFID-AUDIT-UNITS.                                      12690000
127000                                                                  12700000
127100     EXEC SQL                                                     12710000
127200           SELECT SUM(B.RFID_TGD_QTY)                             12720000
127300             INTO :PV-AUDIT-UNIT-QTY                              12730000
127400             FROM TSUATRN A                                       12740000
127500                , TSUAUPC B                                       12750000
127600            WHERE A.AUD_CNTL_NBR        = :DK-AUDIT-CNTL-NBR      12760000
127700              AND A.AUD_CNTL_NBR        =  B.AUD_CNTL_NBR         12770000
127800              AND A.SHIPT_UNT_ID        =  B.SHIPT_UNT_ID         12780000
127900              AND A.UNT_AUD_STRT_TMST  <> :PC-DEFAULT-TMST        12790000
128000              AND A.UNT_AUD_STP_TMST   <> :PC-DEFAULT-TMST        12800000
128100              AND SCN_TYP_CDE <> 'E'                              12810000
128200     END-EXEC.                                                    12820000
128300                                                                  12830000
128400*IF THE ASSOCIATE GOES TO THE CARTON CLOSE WITHOUT SCANNING A UPC 12840000
128500*THE SQLCODE WILL BE -305                                         12850000
128600                                                                  12860000
128700     EVALUATE TRUE                                                12870000
128800        WHEN SQLCODE = ZERO                                       12880000
128900             CONTINUE                                             12890000
129000                                                                  12900000
129100        WHEN SQLCODE = +100                                       12910000
129200        WHEN SQLCODE = -305                                       12920000
129300             MOVE ZEROES                 TO PV-AUDIT-UNIT-QTY     12930000
129400                                                                  12940000
129500        WHEN OTHER                                                12950000
129600             MOVE '1052-CALC-RFID-AUDIT-UNITS'                    12960000
129700                                         TO DP013-PARAGRAPH       12970000
129800             MOVE 'CALC RF AUDIT UNITS'  TO DP013-MESSAGE-TEXT (1)12980000
129900             MOVE DK-AUDIT-CNTL-NBR      TO DK-AUDIT-CNTL-NBR-X   12990000
130000             MOVE DK-AUDIT-CNTL-NBR-X    TO DP013-MESSAGE-TEXT (2)13000000
130100             MOVE SQLCA                  TO DP013-SQLCA           13010000
130200             MOVE 'TSUATRN'            TO DP013-DB2-TABLE-NAME (1)13020000
130300             MOVE 'TSUAUPC'            TO DP013-DB2-TABLE-NAME (2)13030000
130400             SET DP013-DB2-ABEND         TO TRUE                  13040000
130500             SET DP013-NO-ROLLBACK       TO TRUE                  13050000
130600             PERFORM 9999-WRITE-CICS-LOG-MSG                      13060000
130700             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               13070000
130800             MOVE -1                     TO ASELECTL              13080000
130900             PERFORM 8100-SEND-DATA-ONLY                          13090000
131000             PERFORM 8200-RETURN-TRANID                           13100000
131100     END-EVALUATE.                                                13110000
131200                                                                  13120000
131300******************************************************************13130000
131400* 1055-GET-TGD-QTY                                               *13140000
131500*    SELECT THE QUANTITY TAGGED IN THE CARTON                    *13150000
131600******************************************************************13160000
131700 1055-GET-TGD-QTY.                                                13170000
131800                                                                  13180000
131900     IF SU006-QC-AND-RFID-AUD                                     13190000
132000        MOVE SU006-RFID-AUDIT-CNTL-NBR                            13200000
132100                                TO DK-AUDIT-CNTL-NBR              13210000
132200     ELSE                                                         13220000
132300        MOVE SU006-AUDIT-CNTL-NBR                                 13230000
132400                                TO DK-AUDIT-CNTL-NBR              13240000
132500     END-IF.                                                      13250000
132600     MOVE SU006-SHIP-UNIT-NBR   TO DK-SHIP-UNIT-NBR.              13260000
132700                                                                  13270000
132800     EXEC SQL                                                     13280000
132900          SELECT SUM(RFID_TGD_QTY)                                13290000
133000            INTO :PV-SCN-QTY                                      13300000
133100            FROM TSUAUPC                                          13310000
133200           WHERE AUD_CNTL_NBR = :DK-AUDIT-CNTL-NBR                13320000
133300             AND SHIPT_UNT_ID = :DK-SHIP-UNIT-NBR                 13330000
133400             AND SCN_TYP_CDE <> 'E'                               13340000
133500     END-EXEC.                                                    13350000
133600                                                                  13360000
133700*IF THE ASSOCIATE GOES TO THE CARTON CLOSE WITHOUT TAGGING A UPC  13370000
133800*THE SQLCODE WILL BE -305                                         13380000
133900                                                                  13390000
134000     EVALUATE TRUE                                                13400000
134100        WHEN SQLCODE = ZERO                                       13410000
134200          MOVE PV-SCN-QTY          TO PV-SCN-QTY-SHRT             13420000
134300          IF SU006-RFID-AUD-ONLY                                  13430000
134400             MOVE PV-SCN-QTY-SHRT  TO ASCNQTYO                    13440000
134500          END-IF                                                  13450000
134600                                                                  13460000
134700        WHEN SQLCODE = -305                                       13470000
134800           MOVE ZEROES             TO PV-SCN-QTY                  13480000
134900                                      PV-SCN-QTY-SHRT             13490000
135000          IF SU006-RFID-AUD-ONLY                                  13500000
135100             MOVE PV-SCN-QTY-SHRT  TO ASCNQTYO                    13510000
135200          END-IF                                                  13520000
135300                                                                  13530000
135400        WHEN SQLCODE = +100                                       13540000
135500           MOVE ZERO               TO ASCNQTYO                    13550000
135600                                                                  13560000
135700        WHEN OTHER                                                13570000
135800             MOVE '1055-GET-TGD-QTY'     TO DP013-PARAGRAPH       13580000
135900             MOVE 'SELECT OF TSUAUPC'    TO DP013-MESSAGE-TEXT (1)13590000
136000             MOVE DK-AUDIT-CNTL-NBR      TO DK-AUDIT-CNTL-NBR-X   13600000
136100             MOVE DK-AUDIT-CNTL-NBR-X    TO DP013-MESSAGE-TEXT (2)13610000
136200             MOVE DK-SHIP-UNIT-NBR       TO DP013-MESSAGE-TEXT (3)13620000
136300             MOVE SQLCA                  TO DP013-SQLCA           13630000
136400             MOVE 'TSUAUPC'            TO DP013-DB2-TABLE-NAME (1)13640000
136500             SET DP013-DB2-ABEND         TO TRUE                  13650000
136600             SET DP013-NO-ROLLBACK       TO TRUE                  13660000
136700             PERFORM 9999-WRITE-CICS-LOG-MSG                      13670000
136800             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               13680000
136900             MOVE -1                     TO ASELECTL              13690000
137000             PERFORM 8100-SEND-DATA-ONLY                          13700000
137100             PERFORM 8200-RETURN-TRANID                           13710000
137200     END-EVALUATE.                                                13720000
137300                                                                  13730000
137400******************************************************************13740000
137500* 1060-GET-COMBO-SCND-QTY                                        *13750000
137600*    SELECT THE QUANTITY TAGGED IN THE CARTON                    *13760000
137700******************************************************************13770000
137800 1060-GET-COMBO-SCND-QTY.                                         13780000
137900                                                                  13790000
138000     MOVE SU006-AUDIT-CNTL-NBR                                    13800000
138100                                TO DK-AUDIT-CNTL-NBR.             13810000
138200     MOVE SU006-OPER-UNT-ID     TO DK-OPER-UNT-ID.                13820000
138300     EXEC SQL                                                     13830000
138400          SELECT SUM(B.SCND_UNT_QTY)   SCND_UNT_QTY               13840000
138500          INTO :PV-AUDIT-COMBO-UNIT-QTY                           13850000
138600          FROM TSUATRN A                                          13860000
138700              ,TSUAUPC B                                          13870000
138800          WHERE A.AUD_CNTL_NBR        =                           13880000
138900          (SELECT A.AUD_CNTL_NBR                                  13890000
139000           FROM SUT_PO_AUD_REQ     A                              13900000
139100               ,TSUATRN            B                              13910000
139200           WHERE OPER_UNT_ID       = :DK-OPER-UNT-ID              13920000
139300             AND RWRK_AUD_CNTL_NBR = :DK-AUDIT-CNTL-NBR           13930000
139400             AND A.AUD_CNTL_NBR    = B.AUD_CNTL_NBR)              13940000
139500             AND A.AUD_CNTL_NBR        =  B.AUD_CNTL_NBR          13950000
139600             AND A.SHIPT_UNT_ID        =  B.SHIPT_UNT_ID          13960000
139700             AND A.UNT_AUD_STRT_TMST  <> :PC-DEFAULT-TMST         13970000
139800             AND A.UNT_AUD_STP_TMST   <> :PC-DEFAULT-TMST         13980000
139900             AND SCN_TYP_CDE <> 'E'                               13990000
140000     END-EXEC.                                                    14000000
140100                                                                  14010000
140200                                                                  14020000
140300     EVALUATE TRUE                                                14030000
140400        WHEN SQLCODE = ZERO                                       14040000
140500          CONTINUE                                                14050000
140600                                                                  14060000
140700        WHEN SQLCODE = +100                                       14070000
140800           MOVE ZERO               TO PV-AUDIT-COMBO-UNIT-QTY     14080000
140900                                                                  14090000
141000        WHEN OTHER                                                14100000
141100             MOVE '1060-GET-COMBO-SCND-QTY' TO DP013-PARAGRAPH    14110000
141200             MOVE 'SELECT OF SUT_PO_AUD_REQ'                      14120000
141300                                         TO DP013-MESSAGE-TEXT (1)14130000
141400             MOVE DK-AUDIT-CNTL-NBR      TO DK-AUDIT-CNTL-NBR-X   14140000
141500             MOVE DK-AUDIT-CNTL-NBR-X    TO DP013-MESSAGE-TEXT (2)14150000
141600             MOVE SQLCA                  TO DP013-SQLCA           14160000
141700             MOVE 'SUT_PO_AUD_REQ'     TO DP013-DB2-TABLE-NAME (1)14170000
141800             MOVE 'TSUATRN'            TO DP013-DB2-TABLE-NAME (2)14180000
141900             SET DP013-DB2-ABEND         TO TRUE                  14190000
142000             SET DP013-NO-ROLLBACK       TO TRUE                  14200000
142100             PERFORM 9999-WRITE-CICS-LOG-MSG                      14210000
142200             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               14220000
142300             MOVE -1                     TO ASELECTL              14230000
142400             PERFORM 8100-SEND-DATA-ONLY                          14240000
142500             PERFORM 8200-RETURN-TRANID                           14250000
142600     END-EVALUATE.                                                14260000
142700                                                                  14270000
142800******************************************************************14280000
142900 1200-RECEIVE-MAP.                                                14290000
143000                                                                  14300000
143100     EXEC CICS                                                    14310000
143200         RECEIVE                                                  14320000
143300             MAP     ('SU515A')                                   14330000
143400             MAPSET  ('SUKM515')                                  14340000
143500             RESP    (PV-CICS-RESPONSE)                           14350000
143600     END-EXEC.                                                    14360000
143700                                                                  14370000
143800     EVALUATE TRUE                                                14380000
143900         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 14390000
144000              PERFORM 1210-RECEIVE-SCREEN-FIELDS                  14400000
144100                                                                  14410000
144200         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                14420000
144300              CONTINUE                                            14430000
144400                                                                  14440000
144500         WHEN OTHER                                               14450000
144600              MOVE '1200-RECEIVE-MAP'                             14460000
144700                                     TO DP013-PARAGRAPH           14470000
144800              MOVE 'UNABLE TO RECEIVE MAP'                        14480000
144900                                     TO DP013-MESSAGE-TEXT (1)    14490000
145000              SET DP013-LOGIC-ABEND  TO TRUE                      14500000
145100              SET DP013-NO-ROLLBACK  TO TRUE                      14510000
145200              PERFORM 9999-WRITE-CICS-LOG-MSG                     14520000
145300     END-EVALUATE.                                                14530000
145400                                                                  14540000
145500******************************************************************14550000
145600 1210-RECEIVE-SCREEN-FIELDS.                                      14560000
145700                                                                  14570000
145800     IF  ASELECTL > ZERO                                          14580000
145900         MOVE ASELECTI               TO CA-SELECTION-X            14590000
146000     END-IF.                                                      14600000
146100                                                                  14610000
146200     IF  ADESTL   > ZERO                                          14620000
146300         MOVE ADESTI                 TO SU006-PRINTER-DEST        14630000
146400     ELSE IF  ADESTF   = DP015-ERASE-EOF                          14640000
146500         MOVE SPACES                 TO SU006-PRINTER-DEST        14650000
146600                                        ADESTO                    14660000
146700     END-IF.                                                      14670000
146800                                                                  14680000
146900******************************************************************14690000
147000* EDIT ALL ENTERABLE FIELDS (OPERATING UNIT ID, AND SELECT)      *14700000
147100******************************************************************14710000
147200 1300-EDIT-SELECTION.                                             14720000
147300                                                                  14730000
147400*    CHECK TO MAKE SURE THE ENTERED SELECTION IS NUMERIC          14740000
147410                                                                  14741044
147500     MOVE CA-SELECTION-X             TO DP010I-UNEDITED-FIELD.    14750000
147600     MOVE 1                          TO DP010I-MAXIMUM-DIGITS.    14760000
147700     MOVE 0                          TO DP010I-MAXIMUM-DECIMALS.  14770000
147800     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     14780000
147900                                                                  14790000
148010     CALL DP010I-NUMERIC-EDIT-ROUTINE                             14801043
148020          USING DP010I-NUMERIC-EDIT-AREA.                         14802043
148100                                                                  14810000
148200     IF  DP010I-ERROR-DETECTED                                    14820000
148300         MOVE PM-NUMERIC-VALUE-REQUIRED-MSG                       14830000
148400                                     TO AMSGLNO                   14840000
148500         PERFORM 8100-SEND-DATA-ONLY                              14850000
148600         PERFORM 8200-RETURN-TRANID                               14860000
148700     ELSE                                                         14870000
148800         MOVE DP010I-NUMERIC-FIELD   TO CA-SELECTION              14880000
148900         IF NOT CA-VALID-SELECTION                                14890000
149000             MOVE PM-INVALID-SELECTION-MSG                        14900000
149100                                     TO AMSGLNO                   14910000
149200             PERFORM 8100-SEND-DATA-ONLY                          14920000
149300             PERFORM 8200-RETURN-TRANID                           14930000
149400         END-IF                                                   14940000
149500     END-IF.                                                      14950000
149600                                                                  14960000
149700******************************************************************14970000
149800*   1310-VALIDATE-PRINTER                                        *14980000
149900* CALLS DPKCS060 TO VALIDATE THE PRINTER ID                      *14990000
150000******************************************************************15000000
150100 1310-VALIDATE-PRINTER.                                           15010000
150200                                                                  15020000
150300     MOVE SU006-PRINTER-DEST         TO DP072-PRINTER-ID.         15030000
150400     MOVE PC-REPORT-PGM              TO DP072-RPT-PGM-NME.        15040000
150500     MOVE PC-01                      TO DP072-RPT-PGM-TYP-ID.     15050000
150600     MOVE SU006-DFLT-OPER-UNT-ID     TO DP072-ORIGIN-OPER-UNT-ID. 15060000
150700     MOVE SU006-OPER-UNT-ID          TO DP072-OPER-UNT-ID.        15070000
150800     MOVE 1                          TO DP072-ORIGIN-FCLTY-ID     15080000
150900                                        DP072-FCLTY-ID.           15090000
151000     SET DP072-VALIDATE              TO TRUE.                     15100000
151100                                                                  15110000
151200     EXEC CICS                                                    15120000
151300         LINK PROGRAM  (PC-PRTR-VALIDATION-PGM)                   15130000
151400              COMMAREA (DP072-COMM-AREA)                          15140000
151500              RESP     (PV-CICS-RESPONSE)                         15150000
151600     END-EXEC                                                     15160000
151700                                                                  15170000
151800     EVALUATE TRUE                                                15180000
151900         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 15190000
152000             IF DP072-PRTR-PRTR-TRK-STAT-CDE NOT EQUAL 'A'        15200000
152100                 MOVE SPACES TO PV-CICS-MSG-AREA2                 15210000
152200                 STRING ' SUKRF515 - DP072-PRTR-PRTR-ERROR'       15220000
152300                    DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2      15230000
152400                 PERFORM 999A-WRITE-CSSL-MSG                      15240000
152500                                                                  15250000
152600                 MOVE SPACES TO PV-CICS-MSG-AREA2                 15260000
152700                 STRING 'USER = ' SU006-USERID                    15270000
152800                    DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2      15280000
152900                 PERFORM 999A-WRITE-CSSL-MSG                      15290000
153000                 MOVE SPACES TO PV-CICS-MSG-AREA2                 15300000
153100                 STRING 'AUDIT= ' SU006-AUDIT-CNTL-NBR            15310000
153200                    DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2      15320000
153300                 PERFORM 999A-WRITE-CSSL-MSG                      15330000
153400                                                                  15340000
153500                 MOVE SPACES TO PV-CICS-MSG-AREA2                 15350000
153600                 STRING 'PRINTER DEST = ' SU006-PRINTER-DEST      15360000
153700                    DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2      15370000
153800                 PERFORM 999A-WRITE-CSSL-MSG                      15380000
153900                                                                  15390000
154000                 MOVE SPACES TO PV-CICS-MSG-AREA2                 15400000
154100                 STRING 'REPORT PGM = ' PC-REPORT-PGM             15410000
154200                    DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2      15420000
154300                 PERFORM 999A-WRITE-CSSL-MSG                      15430000
154400                                                                  15440000
154500                 MOVE SPACES TO PV-CICS-MSG-AREA2                 15450000
154600                 STRING 'DEFALT OPR = ' SU006-DFLT-OPER-UNT-ID-X  15460000
154700                    DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2      15470000
154800                 PERFORM 999A-WRITE-CSSL-MSG                      15480000
154900                                                                  15490000
155000                 MOVE SPACES TO PV-CICS-MSG-AREA2                 15500000
155100                 STRING 'OPER ID    = ' SU006-OPER-UNT-ID-X       15510000
155200                    DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2      15520000
155300                 PERFORM 999A-WRITE-CSSL-MSG                      15530000
155400             END-IF                                               15540000
155500                                                                  15550000
155600         WHEN OTHER                                               15560000
155700               MOVE '1310-VALIDATE-PRINTER'                       15570000
155800                                    TO DP013-PARAGRAPH            15580000
155900               MOVE PV-CICS-RESPONSE                              15590000
156000                                    TO DP013-MESSAGE-TEXT(1)      15600000
156100               SET DP013-LINK-RETURN                              15610000
156200                   DP013-CICS-ABEND                               15620000
156300                   DP013-NO-ROLLBACK TO TRUE                      15630000
156400               PERFORM DP014-0000-PROCESS-ABEND                   15640000
156500     END-EVALUATE.                                                15650000
156600                                                                  15660000
156601                                                                  15660145
156610***************************************************************** 15661045
156620* CHECK TO SEE THAT DC IS SET UP TO SEND REPORT AS A .TXT       * 15662045
156630* INSTEAD OF PRINTING TO AN ACTUAL PRINTER.                     * 15663045
156640***************************************************************** 15664045
156650 1320-VALIDATE-PRINT-TO-FILE.                                     15665045
156660                                                                  15666045
156670     SET PS-PRINT-TO-FILE-NO  TO TRUE                             15667045
156671     MOVE  SU006-OPER-UNT-ID  TO  KRPRPM-LOC-ID                   15667145
156680                                                                  15668045
156690     EXEC SQL                                                     15669045
156691            SELECT  FUNC_TXT                                      15669145
156692              INTO :KRPRPM-FUNC-TXT                               15669245
156693              FROM  TKRPRPM                                       15669345
156694             WHERE  LOC_ID            = :KRPRPM-LOC-ID            15669445
156695               AND  INTFC_SYS_CDE     = 'KHL'                     15669545
156696               AND  SYS_PRC_FUNC_CDE  = 'PRTFIL'                  15669645
156697               AND  FUNC_PRC_STAT_CDE = 'AC'                      15669745
156698               AND  FUNC_BEG_TMST    <= CURRENT TIMESTAMP         15669845
156699               AND  FUNC_END_TMST    >= CURRENT TIMESTAMP         15669945
156700               AND  FUNC_TXT          = 'Y'                       15670045
156701     END-EXEC.                                                    15670145
156702                                                                  15670245
156703     IF  SQLCODE = ZERO                                           15670345
156704         SET PS-PRINT-TO-FILE-YES TO TRUE                         15670445
156705     ELSE                                                         15670545
156706     IF  SQLCODE = +100                                           15670645
156707         SET PS-PRINT-TO-FILE-NO  TO TRUE                         15670745
156708     ELSE                                                         15670845
156709               MOVE '1320-VALIDATE-PRINT-TO-FILE'                 15670945
156710                                    TO DP013-PARAGRAPH            15671045
156711               MOVE PV-CICS-RESPONSE                              15671145
156712                                    TO DP013-MESSAGE-TEXT(1)      15671245
156713               SET DP013-LINK-RETURN                              15671345
156714                   DP013-CICS-ABEND                               15671445
156715                   DP013-NO-ROLLBACK TO TRUE                      15671545
156716               PERFORM DP014-0000-PROCESS-ABEND                   15671645
156717     END-IF.                                                      15671745
156718                                                                  15671845
156719                                                                  15671945
156720***************************************************************** 15672048
156721* CHECK TO SEE IF THE REPORT IS SET UP TO BE PRINTED AS A .TXT  * 15672148
156722* FILE INSTEAD OF BEING PHYSICALLY PRINT.                       * 15672248
156723***************************************************************** 15672348
156724 1330-CHECK-PRNTTOFILE.                                           15672448
156725                                                                  15672548
156726                                                                  15672655
156737     SET  PS-REPORT-TO-FILE-NO TO TRUE.                           15673748
156738                                                                  15673848
156739     EXEC SQL                                                     15673948
156740          SELECT C.ATTR_ELEM_SEQ_NBR                              15674048
156741               , C.ATTR_ELEM_TXT                                  15674148
156742               , D.ATTR_ELEM_TXT                                  15674248
156743               , E.ATTR_ELEM_TXT                                  15674348
156744               , F.ATTR_ELEM_TXT                                  15674448
156745               , G.ATTR_ELEM_TXT                                  15674548
156746               , H.ATTR_ELEM_NBR                                  15674648
156747            INTO :PV-WST-SEQ                                      15674748
156748               , :PV-WST-RPT-NAME                                 15674848
156749               , :PV-WST-RPT-NBR                                  15674948
156750               , :PV-WST-JOB                                      15675051
156751               , :PV-WST-AC-IN                                    15675151
156752               , :PV-WST-PROG-NBR                                 15675251
156753               , :PV-WST-MENU-SEQ                                 15675351
156754            FROM  WST_INTGRTN_TYP A                               15675448
156755               ,  WST_ATTR_DEFN   B                               15675548
156756               ,  WST_ATTR_ELEM   C                               15675648
156757               ,  WST_ATTR_ELEM   D                               15675748
156758               ,  WST_ATTR_ELEM   E                               15675848
156759               ,  WST_ATTR_ELEM   F                               15675948
156760               ,  WST_ATTR_ELEM   G                               15676048
156761               ,  WST_ATTR_ELEM   H                               15676148
156762           WHERE A.INTGRTN_TYP_CDE   = 'PRNTTOFILE'               15676248
156763             AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE          15676348
156764             AND B.ATTR_DEFN_SEQ_NBR = 1                          15676448
156765             AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE          15676548
156766             AND C.ATTR_DEFN_SEQ_NBR = 1                          15676648
156767             AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE          15676748
156768             AND D.ATTR_DEFN_SEQ_NBR = 2                          15676848
156769             AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE          15676948
156770             AND E.ATTR_DEFN_SEQ_NBR = 3                          15677048
156771             AND B.INTGRTN_TYP_CDE   = F.INTGRTN_TYP_CDE          15677148
156772             AND F.ATTR_DEFN_SEQ_NBR = 4                          15677248
156773             AND B.INTGRTN_TYP_CDE   = G.INTGRTN_TYP_CDE          15677348
156774             AND G.ATTR_DEFN_SEQ_NBR = 5                          15677448
156775             AND B.INTGRTN_TYP_CDE   = H.INTGRTN_TYP_CDE          15677548
156776             AND H.ATTR_DEFN_SEQ_NBR = 6                          15677648
156777             AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR        15677748
156778             AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR        15677848
156779             AND C.ATTR_ELEM_SEQ_NBR = F.ATTR_ELEM_SEQ_NBR        15677948
156780             AND C.ATTR_ELEM_SEQ_NBR = G.ATTR_ELEM_SEQ_NBR        15678048
156781             AND C.ATTR_ELEM_SEQ_NBR = H.ATTR_ELEM_SEQ_NBR        15678148
156782             AND C.ATTR_ELEM_TXT     = :DK-WST-RPT-NAME           15678248
156783             AND D.ATTR_ELEM_TXT     = :DK-WST-RPT-NBR            15678348
156784             AND E.ATTR_ELEM_TXT     = :DK-WST-JOB                15678448
156785             AND F.ATTR_ELEM_TXT     = :DK-WST-AC-IN              15678548
156786             AND G.ATTR_ELEM_TXT     = :DK-WST-PROG-NBR           15678648
156787             AND H.ATTR_ELEM_NBR     = :DK-WST-MENU-SEQ           15678748
156791            WITH UR                                               15679148
156792     END-EXEC.                                                    15679248
156793                                                                  15679348
156794     IF  SQLCODE = ZERO                                           15679448
156795         SET PS-REPORT-TO-FILE-YES TO TRUE                        15679548
156796     ELSE                                                         15679648
156797     IF  SQLCODE = +100                                           15679748
156798         SET PS-REPORT-TO-FILE-NO  TO TRUE                        15679848
156799     ELSE                                                         15679948
156800               MOVE '1330-CHECK-PRNTTOFILE'                       15680048
156801                                    TO DP013-PARAGRAPH            15680148
156802               MOVE PV-CICS-RESPONSE                              15680248
156803                                    TO DP013-MESSAGE-TEXT(1)      15680348
156804               SET DP013-LINK-RETURN                              15680448
156805                   DP013-CICS-ABEND                               15680548
156806                   DP013-NO-ROLLBACK TO TRUE                      15680648
156807               PERFORM DP014-0000-PROCESS-ABEND                   15680748
156808     END-IF.                                                      15680848
156809                                                                  15680948
156810                                                                  15681048
156811******************************************************************15681148
156820 1400-HELP-SCREEN.                                                15682048
156900                                                                  15690000
157000     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      15700000
157100     MOVE 'SUKRF515'                  TO PC192-PROGRAM-NAME       15710000
157200     COPY PCPD188.                                                15720000
157300     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      15730000
157400     PERFORM 4700-XCTL-TO-HELP.                                   15740000
157500                                                                  15750000
157600******************************************************************15760000
157700*2000-PROCESS-SCREEN                                             *15770000
157800* THIS PARAGRAPH WILL PROCESS THE DATA ON THE SCREEN DEPENDING ON*15780000
157900* THE OPTION SELECTED.                                           *15790000
158000******************************************************************15800000
158100* * * * * * * * *  N O T E  * * * * * *  N O T E  * * * * * * * **15810000
158200* ANY CHANGES TO THIS PARAGRAPH MUST BE COPIED TO THE SAME       *15820000
158300* SECTION IN SUKRF512 (CARTON CONTINUATION)                      *15830000
158400* * * * * * * * *  N O T E  * * * * * *  N O T E  * * * * * * * **15840000
158500******************************************************************15850000
158600 2000-PROCESS-SCREEN.                                             15860000
158700                                                                  15870000
158800     EVALUATE TRUE                                                15880000
158900*        THE USER WANTS TO CONTINUE WITH THE SHIPPING UNIT AUDIT. 15890000
159000*        IF THE SHIPPING UNIT HAS ALREADY BEEN COMPLETED, RE-OPEN 15900000
159100*        IT, IF IT HAS BEEN POSTPONED, CONTINUE IT...             15910000
159110                                                                  15911044
159200         WHEN CA-CONTINUE-SELECTION                               15920000
159300             SET CA-NOT-IN-CONFIRM-STATE         TO TRUE          15930000
159400             IF SU006-SHIP-UNIT-COMPLETE                          15940000
159410                                                                  15941044
159500**     BACK OUT THE CARTON AND UNIT QUANTITIES FROM THE           15950000
159600**     SUT_PO_AUD_REQ TABLE FOR THIS AUDIT                        15960000
159610                                                                  15961044
159700                 PERFORM 3700-SELECT-AUDIT                        15970000
159800                 IF PS-SYSTEM-AUDIT-FOUND                         15980000
159900                     IF SU006-QC-AUDIT                            15990000
160000                        PERFORM 1040-GET-SCN-QTY                  16000000
160100                     ELSE                                         16010000
160200                        PERFORM 1055-GET-TGD-QTY                  16020000
160300                     END-IF                                       16030000
160400                                                                  16040044
160500                     COMPUTE SUT00015-AUD-CART-QTY =              16050000
160600                             SUT00015-AUD-CART-QTY - 1            16060000
160700                     COMPUTE SUT00015-AUD-UNT-QTY =               16070000
160800                             SUT00015-AUD-UNT-QTY - PV-SCN-QTY    16080000
160900                     PERFORM 3800-UPDATE-SUT-PO-AUD-REQ           16090000
161000                 END-IF                                           16100000
161100                 PERFORM 3100-REOPEN-SHIP-UNIT                    16110000
161200                 PERFORM 3500-DELETE-E-RECORDS                    16120000
161300                 SET SU006-NO-AUD-ERR TO TRUE                     16130000
161400             ELSE                                                 16140000
161500                 IF SU006-SHIP-UNIT-POSTPONE                      16150000
161600                     PERFORM 3200-CONTINUE-SHIP-UNIT              16160000
161700                 END-IF                                           16170000
161800             END-IF                                               16180000
161810                                                                  16181044
161900**         CONTINUE ON TO THE UPC SCAN PROGRAM                    16190000
162000**         IF NOT A COMBINED AUDIT                                16200000
162010                                                                  16201044
162100             IF SU006-QC-AND-RFID-AUD                             16210000
162200                CONTINUE                                          16220000
162300             ELSE                                                 16230000
162400                MOVE PC-UPC-SCAN-PROGRAM-NAME                     16240000
162500                                        TO PV-TRANSFER-PROGRAM    16250000
162600                PERFORM 2100-XCTL-TO-SELECTED-PROGRAM             16260000
162700             END-IF                                               16270000
163100                                                                  16310000
163200*        THE USER WANTS TO CLOSE THE SHIPPING UNIT.  IF IT'S      16320000
163300*        ALREADY CLOSED, SAY SO.  IF IT'S POSTPONED, FIRST        16330000
163400*        CONTINUE IT (GET THE MINUTES POSTPONED), THEN CHECK THE  16340000
163500*        OVER/SHORT, THEN CLOSE IT                                16350000
163510                                                                  16351044
163600         WHEN CA-CLOSE-SELECTION                                  16360000
163700             SET CA-NOT-IN-CONFIRM-STATE         TO TRUE          16370000
163800             IF SU006-SHIP-UNIT-COMPLETE                          16380000
163900                 MOVE PM-ALREADY-CLOSED-MSG                       16390000
164000                                        TO AMSGLNO                16400000
164100                 PERFORM 8100-SEND-DATA-ONLY                      16410000
164200                 PERFORM 8200-RETURN-TRANID                       16420000
164300             ELSE                                                 16430000
164400                 IF SU006-SHIP-UNIT-POSTPONE                      16440000
164500                     PERFORM 3200-CONTINUE-SHIP-UNIT              16450000
164600                 END-IF                                           16460000
164700             END-IF                                               16470000
164710                                                                  16471044
164800*         IF THE AUDIT IS SYSTEM GENERATED, CHECK FOR OVER/SHORT, 16480000
164900*         SET THE APPROPRIATE INDICATORS AND CREATE EXCEPTIONS    16490000
164910                                                                  16491044
165000             IF SU006-SYSTEM-GENERATED-AUDIT                      16500000
165100                IF SU006-PRINTER-DEST = SPACES                    16510000
165200                   MOVE PM-PRINTER-ID-REQUIRED-MSG  TO  AMSGLNO   16520000
165300                   MOVE -1                          TO  ASELECTL  16530000
165400                   PERFORM 8100-SEND-DATA-ONLY                    16540000
165500                   PERFORM 8200-RETURN-TRANID                     16550000
165600                ELSE                                              16560000
165620                                                                  16562045
165630                  IF SU006-PRINTER-DEST = PC-PRINT-TO-FILE        16563045
165640                     SET PS-PRINT-TO-FILE-NO  TO TRUE             16564045
165650                     PERFORM 1320-VALIDATE-PRINT-TO-FILE          16565045
165660                                                                  16566045
165670                     IF  PS-PRINT-TO-FILE-YES                     16567045
165680                         MOVE SPACES       TO  CA-PRTR-CNTL-IND   16568045
165691                         MOVE ZEROES       TO  CA-TRACK-NBR       16569145
165700                     ELSE                                         16570045
165701                        MOVE PC-PRINT-TO-FILE-ERR-MSG TO AMSGLNO  16570145
165702                        MOVE -1                       TO  ASELECTL16570245
165703                        PERFORM 8100-SEND-DATA-ONLY               16570345
165704                        PERFORM 8200-RETURN-TRANID                16570445
165705                     END-IF                                       16570545
165706                  ELSE                                            16570645
165710                    PERFORM 1310-VALIDATE-PRINTER                 16571045
165800                    IF DP072-PRTR-PRTR-TRK-STAT-CDE NOT EQUAL 'A' 16580045
165900                       MOVE PM-INVALID-PRINTER-ID-MSG TO  AMSGLNO 16590000
166000                       MOVE -1                       TO  ASELECTL 16600000
166100                       PERFORM 8100-SEND-DATA-ONLY                16610000
166200                       PERFORM 8200-RETURN-TRANID                 16620000
166300                    ELSE                                          16630045
166400                        IF SU006-RFID-AUDIT                       16640045
166500                           PERFORM 4220-TAG-SCAN-QUANTITY-RTN     16650045
166600                        ELSE                                      16660045
166700                           PERFORM 4150-CHECK-OVER-SHORT          16670045
166800                        END-IF                                    16680045
166900                        IF PS-OVER-SHORT-ERROR                    16690045
167000                            SET SU006-AUD-ERR   TO TRUE           16700045
167100                            SET CA-OVER-SHORT   TO TRUE           16710045
167200                        END-IF                                    16720045
167300                    END-IF                                        16730045
167310                  END-IF                                          16731045
167400                END-IF                                            16740000
167500             ELSE                                                 16750000
167510                                                                  16751044
167600*            IF THERE ARE NO ERRORS, CHECK OVER/SHORT AND SET THE 16760000
167700*            INDICATOR APPROPRIATELY (NO EXCEPTION CREATED).      16770000
167710                                                                  16771044
167800                IF SU006-RFID-AUDIT OR                            16780001
167900                   SU006-QC-AND-RFID-AUD                          16790001
168000                  PERFORM 4220-TAG-SCAN-QUANTITY-RTN              16800001
168100                END-IF                                            16810001
168600                  IF  (SU006-QC-AND-RFID-AUD                      16860025
168700                   OR SU006-QC-AUD-ONLY)                          16870006
168800                       PERFORM 4150-CHECK-OVER-SHORT              16880000
168900                       IF PS-OVER-SHORT-ERROR                     16890000
169000                          SET SU006-AUD-ERR   TO TRUE             16900000
169100                          SET CA-OVER-SHORT   TO TRUE             16910000
169200                       END-IF                                     16920000
169300                 END-IF                                           16930000
169400             END-IF                                               16940000
169500             PERFORM 2200-SELECT-PRINT-IND                        16950000
169600             IF (SU006-AUD-ERR OR SU006-RFID-ERROR )              16960009
169700             AND PS-DO-PRINT-REPORT                               16970000
169710                                                                  16971044
169800*    IF THE CLOSE OPTION WAS SELECTED AND ERRORS EXISTS THE       16980000
169900*    PRINTER ID IS REQUIRED                                       16990000
169910                                                                  16991044
170000                IF SU006-PRINTER-DEST = SPACES                    17000000
170100                   MOVE PM-PRINTER-ID-REQUIRED-MSG  TO  AMSGLNO   17010000
170200                   MOVE -1                          TO  ASELECTL  17020000
170300                   PERFORM 8100-SEND-DATA-ONLY                    17030000
170400                   PERFORM 8200-RETURN-TRANID                     17040000
170500                ELSE                                              17050000
170510                                                                  17051045
170520                  IF SU006-PRINTER-DEST = PC-PRINT-TO-FILE        17052045
170530                     SET PS-PRINT-TO-FILE-NO  TO TRUE             17053045
170540                     PERFORM 1320-VALIDATE-PRINT-TO-FILE          17054045
170541                                                                  17054156
170560                     IF  PS-PRINT-TO-FILE-YES                     17056045
170570                         MOVE SPACES       TO  CA-PRTR-CNTL-IND   17057045
170590                         MOVE ZEROES       TO  CA-TRACK-NBR       17059045
170591                         MOVE 'CARTON DETAIL'                     17059148
170592                                           TO  DK-WST-RPT-NAME    17059248
170593                         MOVE 'SUKRP012'   TO  DK-WST-RPT-NBR     17059348
170594                         MOVE 'SUK915'     TO  DK-WST-JOB         17059452
170595                         MOVE 'AC'         TO  DK-WST-AC-IN       17059548
170596                         MOVE PC-CURRENT-PROGRAM-NAME             17059648
170597                                           TO  DK-WST-PROG-NBR    17059748
170598                         MOVE 0            TO  DK-WST-MENU-SEQ    17059848
170599                         PERFORM 1330-CHECK-PRNTTOFILE            17059948
170600***                                                               17060048
170601*** NOTE:  THIS REPORT IS NOT SET UP TO PRINT TO A FILE AT        17060148
170602***        THIS TIME.  WHEN IT DOES PARAGRAPH 3600 WILL NEED TO   17060248
170603***        BE MODIFIED - OR A NEW PARAGRAPH EXECUTED.             17060348
170604***                                                               17060448
170605                         IF  PS-REPORT-TO-FILE-YES                17060548
170606                             PERFORM 3600-SUBMIT-CART-DETAIL      17060648
170607                         ELSE                                     17060748
170608                             MOVE PC-REPORT-TO-FILE-ERR-MSG       17060848
170609                                                      TO AMSGLNO  17060948
170610                             MOVE -1                  TO ASELECTL 17061048
170611                             PERFORM 8100-SEND-DATA-ONLY          17061148
170612                             PERFORM 8200-RETURN-TRANID           17061248
170613                         END-IF                                   17061348
170614                     ELSE                                         17061448
170615                        MOVE PC-PRINT-TO-FILE-ERR-MSG TO AMSGLNO  17061548
170616                        MOVE -1                       TO  ASELECTL17061648
170617                        PERFORM 8100-SEND-DATA-ONLY               17061748
170618                        PERFORM 8200-RETURN-TRANID                17061848
170619                     END-IF                                       17061948
170620                  ELSE                                            17062048
170630                    PERFORM 1310-VALIDATE-PRINTER                 17063045
170700                    IF DP072-PRTR-PRTR-TRK-STAT-CDE NOT EQUAL 'A' 17070045
170800                       MOVE PM-INVALID-PRINTER-ID-MSG TO AMSGLNO  17080000
170900                       MOVE -1                        TO ASELECTL 17090000
171000                       PERFORM 8100-SEND-DATA-ONLY                17100000
171100                       PERFORM 8200-RETURN-TRANID                 17110000
171200                    ELSE                                          17120045
171300                       MOVE DP072-PRTR-PRTR-CNTL-IND              17130000
171400                                    TO CA-PRTR-CNTL-IND           17140000
171500                                                                  17150044
171600                       MOVE DP072-PRTR-AUTO-CUTTER-IND            17160000
171700                                          TO  JL-SYSUT1-CUT-IND   17170000
171800                       MOVE DP072-PRTR-TRACK-NBR                  17180000
171900                                          TO CA-TRACK-NBR         17190000
172000                       PERFORM 3600-SUBMIT-CART-DETAIL            17200000
172100                    END-IF                                        17210045
172200                  END-IF                                          17220045
172210                END-IF                                            17221045
172300             END-IF                                               17230000
172400             MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR       17240000
172500             MOVE SU006-SHIP-UNIT-NBR  TO DK-SHIP-UNIT-NBR        17250000
172600             PERFORM 3050-GET-STAT-CDE                            17260000
172700             IF SUATRN-UNT-AUD-STAT-CDE = 'CM'                    17270000
172800                 SET PS-CARTON-ALREADY-COMPLETE  TO TRUE          17280000
172900             ELSE                                                 17290000
173000                 SET PS-CARTON-NOT-ALREADY-COMPLETE  TO TRUE      17300000
173100             END-IF                                               17310000
173200             MOVE SU006-SHIP-UNIT-STATUS                          17320000
173300                                    TO PV-SAVE-SHIP-UNIT-STATUS   17330000
173400             SET SU006-SHIP-UNIT-COMPLETE TO TRUE                 17340000
173500             PERFORM 3300-CLOSE-SHIP-UNIT                         17350000
173600             IF ( SU006-MANUAL-GENERATED-AUDIT )                  17360000
173700                 PERFORM 3250-LINK-COMMON-CARTON-CLOSE            17370000
173800                 IF ( SU091-SUCCESS )                             17380000
173900                     CONTINUE                                     17390000
174000                 ELSE                                             17400000
174100                     PERFORM 8100-SEND-DATA-ONLY                  17410000
174200                     PERFORM 8200-RETURN-TRANID                   17420000
174300                 END-IF                                           17430000
174400             END-IF                                               17440000
174500             PERFORM 3700-SELECT-AUDIT                            17450000
174600                                                                  17460044
176000                                                                  17600044
176100             IF PS-SYSTEM-AUDIT-FOUND                             17610000
176110                                                                  17611044
176200*              PERFORM PARA 1040- FOR QC AUDIT AND PARA 1055-     17620000
176300*              PARA RFID AUDIT                                    17630000
176310                                                                  17631044
176400                 IF SU006-QC-AUDIT                                17640000
176500                    PERFORM 1040-GET-SCN-QTY                      17650000
176600                 ELSE                                             17660000
176700                    PERFORM 1055-GET-TGD-QTY                      17670000
176800                 END-IF                                           17680000
176900                                                                  17690044
177000                 MOVE SU006-AUDIT-CNTL-NBR                        17700000
177100                                TO DK-AUDIT-CNTL-NBR              17710000
177200                 PERFORM 1045-CALC-AUDIT-CRTNS                    17720000
177300                 PERFORM 1050-CALC-AUDIT-UNITS                    17730000
177400                 MOVE PV-AUDIT-CRTN-COUNT TO SUT00015-AUD-CART-QTY17740000
177500                 MOVE PV-AUDIT-UNIT-QTY   TO SUT00015-AUD-UNT-QTY 17750000
177600                 PERFORM 3800-UPDATE-SUT-PO-AUD-REQ               17760000
177700             END-IF                                               17770000
177800                                                                  17780044
178000***      CARTON ADJMNTS ONLY NEED TO BE MADE FOR QC AUDITS        17800000
178010                                                                  17801044
178100             MOVE PM-SHIP-UNIT-CLOSE-MSG TO AMSGLNO               17810000
178200             IF SU006-QC-AUDIT                                    17820000
178300               PERFORM 3900-CHECK-FOR-ADJUSTMENTS                 17830000
178400             END-IF                                               17840000
178500                                                                  17850000
178600*        THE USER WANTS TO POSTPONE THE SHIPPING UNIT.  IF IT'S   17860000
178700*        ALREADY POSTPONED, SAY SO.  IF IT'S CLOSED, REOPEN IT    17870000
178800*        (TO GET THE MINUETES CLOSED) AND THEN POSTPONE IT        17880000
178810                                                                  17881044
178900         WHEN CA-POSTPONE-SELECTION                               17890000
179000             IF SU006-INSTREAM-AUDIT                              17900000
179100                 MOVE PC-CANNOT-POSTPONE-AUDIT-MSG                17910000
179200                                     TO AMSGLNO                   17920000
179300                 MOVE -1             TO ASELECTL                  17930000
179400                 PERFORM 8100-SEND-DATA-ONLY                      17940000
179500                 PERFORM 8200-RETURN-TRANID                       17950000
179600             ELSE                                                 17960000
179700                 SET CA-NOT-IN-CONFIRM-STATE         TO TRUE      17970000
179800                 IF SU006-SHIP-UNIT-POSTPONE                      17980000
179900                     MOVE PM-ALREADY-POSTPONED-MSG                17990000
180000                                            TO AMSGLNO            18000000
180100                     PERFORM 8100-SEND-DATA-ONLY                  18010000
180200                     PERFORM 8200-RETURN-TRANID                   18020000
180300                 ELSE                                             18030000
180400                     IF SU006-SHIP-UNIT-COMPLETE                  18040000
180500                                                                  18050044
180700                         MOVE 'CLOSED--CANT POSTPN'               18070000
180800                                                TO AMSGLNO        18080000
180900                         PERFORM 8100-SEND-DATA-ONLY              18090000
181000                         PERFORM 8200-RETURN-TRANID               18100000
181100                                                                  18110044
181200                     END-IF                                       18120000
181300                 END-IF                                           18130000
181400                 MOVE SU006-SHIP-UNIT-STATUS                      18140000
181500                                      TO PV-SAVE-SHIP-UNIT-STATUS 18150000
181600                 SET SU006-SHIP-UNIT-POSTPONE TO TRUE             18160000
181700                 PERFORM 3300-CLOSE-SHIP-UNIT                     18170000
181800                 MOVE PM-SHIP-UNIT-POSTPONED-MSG                  18180000
181900                                            TO AMSGLNO            18190000
182000             END-IF                                               18200000
182100                                                                  18210000
182200*        THE USER WANTS TO RESTART THE SHIPPING UNIT FROM SCRATCH.18220000
182300*        IF IT'S COMPLETE OR POSPONED, IT WILL HAVE TO FIRST BE   18230000
182400*        RE-OPENED.  THEN DELETE THE DETAIL/EXCPETIONS FOR THE    18240000
182500*        SHIPPING UNIT, AND GO ON TO THE UPC SCAN SCREEN.         18250000
182510                                                                  18251044
182600         WHEN CA-RESTART-SELECTION                                18260000
182610                                                                  18261044
182700*            IF THE USER HAS CONFIRMED THE RESTART -- DO IT       18270000
182710                                                                  18271044
182800             IF CA-CONFIRMED                                      18280000
182900                IF SU006-SHIP-UNIT-COMPLETE                       18290000
182910                                                                  18291044
183000**               BACK OUT THE CARTON AND UNIT QUANTITIES FROM THE 18300000
183100**               SUT_PO_AUD_REQ TABLE FOR THIS AUDIT              18310000
183110                                                                  18311044
183200                    PERFORM 3700-SELECT-AUDIT                     18320000
183300                    IF PS-SYSTEM-AUDIT-FOUND                      18330000
183310                                                                  18331044
183400*                     PERFORM PARA 1040- FOR QC AUDIT AND PARA    18340000
183500*                     1055- FOR RFID AUDIT                        18350000
183510                                                                  18351044
183600                        IF SU006-QC-AUDIT                         18360000
183700                           PERFORM 1040-GET-SCN-QTY               18370000
183800                        ELSE                                      18380000
183900                           PERFORM 1055-GET-TGD-QTY               18390000
184000                        END-IF                                    18400000
184100                                                                  18410044
184200                        COMPUTE SUT00015-AUD-CART-QTY =           18420000
184300                                SUT00015-AUD-CART-QTY - 1         18430000
184400                        COMPUTE SUT00015-AUD-UNT-QTY =            18440000
184500                                SUT00015-AUD-UNT-QTY - PV-SCN-QTY 18450000
184600                        PERFORM 3800-UPDATE-SUT-PO-AUD-REQ        18460000
184700                    END-IF                                        18470000
184800                    PERFORM 3100-REOPEN-SHIP-UNIT                 18480000
184900                ELSE                                              18490000
185000                    IF SU006-SHIP-UNIT-POSTPONE                   18500000
185100                        PERFORM 3200-CONTINUE-SHIP-UNIT           18510000
185200                    END-IF                                        18520000
185300                END-IF                                            18530000
185400                PERFORM 3400-RESTART-SHIP-UNIT                    18540000
185410                                                                  18541044
185500*            FOR I-PREPACK AND NOT ECOMMERCE GO TO                18550000
185600*            PREPACK QTY SCREEN, OTHERWISE                        18560000
185700*            CONTINUE ON TO THE UPC SCAN PROGRAM                  18570000
185800                                                                  18580044
185900                IF SU006-PREPK-ITYPE-PKGNG-CDE                    18590000
186000                   SET SU006-PREPACK-NOT-CLOSED TO TRUE           18600000
186100                   MOVE PC-PREPK-QTY-SCREEN-PROGRAM               18610000
186200                                           TO PV-TRANSFER-PROGRAM 18620000
186300                ELSE                                              18630000
186400                   MOVE PC-UPC-SCAN-PROGRAM-NAME                  18640000
186500                                           TO PV-TRANSFER-PROGRAM 18650000
186600                END-IF                                            18660000
186700                                                                  18670044
186800*            IF NOT A COMBINED AUDIT XFER TO OTHER PROGRAM        18680000
186900                IF SU006-QC-AND-RFID-AUD                          18690000
187000                   CONTINUE                                       18700000
187100                ELSE                                              18710000
187200                   PERFORM 2100-XCTL-TO-SELECTED-PROGRAM          18720000
187300                END-IF                                            18730000
187400                                                                  18740044
187500            ELSE                                                  18750000
187510                                                                  18751044
187600*               THE PROGRAM IS EXPECTING TO CONFIRM IT, AND IT    18760000
187700*               WASN'T (IE AN ENTER WAS PRESSED), CANCEL THE      18770000
187800*               RESTART                                           18780000
187810                                                                  18781044
187900                IF CA-IN-CONFIRM-STATE                            18790000
188000                    SET CA-NOT-IN-CONFIRM-STATE TO TRUE           18800000
188100                    MOVE PM-CANCEL-RESTART-MSG  TO AMSGLNO        18810000
188200                    MOVE SPACES                 TO ASELECTO       18820000
188300                                                   CA-SELECTION-X 18830000
188310                                                                  18831044
188400*               IF IT GOT TO HERE, IT WAS NOT IN CONFIRM STATUS   18840000
188500*               (INITIAL SELECTION OF RESTART) SET TO CONFIRM     18850000
188600*               STATE AND DISPLAY KEY TO F2 TO CONFIRM.           18860000
188610                                                                  18861044
188700                ELSE                                              18870000
188800                    PERFORM 3700-SELECT-AUDIT                     18880000
188900                    IF PS-SYSTEM-AUDIT-FOUND AND                  18890000
189000                      (SUT00015-AUD-STAT-CDE = 'N' OR             18900000
189100                       SUT00015-AUD-STAT-CDE = 'P' OR             18910000
189200                       SUT00015-AUD-STAT-CDE = 'F')               18920000
189300                        MOVE PC-AUDIT-NO-LONGER-NEEDED-MSG        18930000
189400                          TO AMSGLNO                              18940000
189500                        IF ( SUT00015-AUD-STAT-CDE = 'N' )        18950000
189600                            PERFORM 3250-LINK-COMMON-CARTON-CLOSE 18960000
189700                        END-IF                                    18970000
189800                        PERFORM 8100-SEND-DATA-ONLY               18980000
189900                        PERFORM 8200-RETURN-TRANID                18990000
190000                    ELSE                                          19000000
190100                        PERFORM 4000-SELECT-TSUNAUD               19010000
190200                        IF SUNAUD-AUD-STAT-CDE = 'CM'             19020000
190300                            MOVE PC-AUDIT-NO-LONGER-NEEDED-MSG    19030000
190400                              TO AMSGLNO                          19040000
190500                            IF ( NOT PS-SYSTEM-AUDIT-FOUND )      19050000
190600                                PERFORM                           19060000
190700                                  3250-LINK-COMMON-CARTON-CLOSE   19070000
190800                            END-IF                                19080000
190900                            PERFORM 8100-SEND-DATA-ONLY           19090000
191000                            PERFORM 8200-RETURN-TRANID            19100000
191100                        ELSE                                      19110000
191200                            IF SU006-QC-AND-RFID-AUD              19120000
191300                               CONTINUE                           19130000
191400                            ELSE                                  19140000
191500                               SET CA-IN-CONFIRM-STATE  TO TRUE   19150000
191600                            END-IF                                19160000
191700                            MOVE PM-CONFIRM-RESTART-MSG TO AMSGLNO19170000
191800                        END-IF                                    19180000
191900                    END-IF                                        19190000
192000                END-IF                                            19200000
192100                MOVE -1                         TO ASELECTL       19210000
192200            END-IF                                                19220000
192300                                                                  19230000
192500         WHEN CA-PRINT-SELECTION                                  19250000
192600             SET CA-NOT-IN-CONFIRM-STATE        TO TRUE           19260000
192610                                                                  19261044
192700*          CONTINUE ON TO THE PRINT PROGRAM                       19270000
192800*          IF THIS IS A COMBINED AUDIT, NEED TO PROCESS BOTH THE  19280000
192900*          QC AND RF AUDITS BEFORE X-FERRING TO THE PRINT PROGRAM 19290000
192910                                                                  19291044
193000             IF SU006-QC-AND-RFID-AUD                             19300000
193100                CONTINUE                                          19310000
193200             ELSE                                                 19320000
193300                MOVE PC-PRINT-PROGRAM-NAME TO PV-TRANSFER-PROGRAM 19330000
193400                PERFORM 2100-XCTL-TO-SELECTED-PROGRAM             19340000
193500             END-IF                                               19350000
193510                                                                  19351044
193600**           MOVE PC-PRINT-PROGRAM-NAME    TO PV-TRANSFER-PROGRAM 19360000
193700**           PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                19370000
193800                                                                  19380000
193900         WHEN OTHER                                               19390000
194000             SET CA-NOT-IN-CONFIRM-STATE   TO TRUE                19400000
194100             MOVE SPACES                   TO AMSGLNO             19410000
194200     END-EVALUATE.                                                19420000
194300                                                                  19430000
194400     SET PS-PRCS-SEC-AUDIT                 TO TRUE.               19440000
194500                                                                  19450000
194600******************************************************************19460000
194700*2050-PROCESS-SCREEN-FOR-CMBND                                   *19470000
194800* THIS PARAGRAPH WILL PROCESS THE DATA ON THE SCREEN DEPENDING ON*19480000
194900* THE OPTION SELECTED.                                           *19490000
195000******************************************************************19500000
195100* * * * * * * * *  N O T E  * * * * * *  N O T E  * * * * * * * **19510000
195200* ANY CHANGES TO THIS PARAGRAPH MUST BE COPIED TO THE SAME       *19520000
195300* SECTION IN SUKRF512 (CARTON CONTINUATION)                      *19530000
195400* * * * * * * * *  N O T E  * * * * * *  N O T E  * * * * * * * **19540000
195500******************************************************************19550000
195600 2050-PROCESS-SCREEN-FOR-CMBND.                                   19560000
195700                                                                  19570000
195800     SET CA-OVER-SHORT-FALSE TO TRUE.                             19580000
195900     SET PS-NO-OVER-SHORT-ERROR TO TRUE.                          19590000
196000     IF SU006-MANUAL-GENERATED-AUDIT                              19600000
196100        MOVE SU006-AUDIT-CNTL-NBR          TO DK-AUDIT-CNTL-NBR   19610000
196200     ELSE                                                         19620000
196300        MOVE SU006-RFID-AUDIT-CNTL-NBR     TO DK-AUDIT-CNTL-NBR   19630000
196400     END-IF.                                                      19640000
196500     MOVE SU006-SHIP-UNIT-NBR              TO DK-SHIP-UNIT-NBR.   19650000
196600     PERFORM 3050-GET-STAT-CDE.                                   19660000
196700     IF  SUATRN-UNT-AUD-STAT-CDE = 'CM'                           19670000
196800     AND SU006-SYSTEM-GENERATED-AUDIT                             19680000
196900        SET PS-CARTON-ALREADY-COMPLETE     TO TRUE                19690000
197000     ELSE                                                         19700000
197100        SET PS-CARTON-NOT-ALREADY-COMPLETE TO TRUE                19710000
197200     END-IF.                                                      19720000
197300                                                                  19730000
197400     EVALUATE TRUE                                                19740000
197410                                                                  19741044
197500*        THE USER WANTS TO CONTINUE WITH THE SHIPPING UNIT AUDIT. 19750000
197600*        IF THE SHIPPING UNIT HAS ALREADY BEEN COMPLETED, RE-OPEN 19760000
197700*        IT, IF IT HAS BEEN POSTPONED, CONTINUE IT...             19770000
197710                                                                  19771044
197800         WHEN CA-CONTINUE-SELECTION                               19780000
197900             SET CA-NOT-IN-CONFIRM-STATE         TO TRUE          19790000
198000             IF  PS-CARTON-ALREADY-COMPLETE                       19800000
198100             AND SU006-SYSTEM-GENERATED-AUDIT                     19810000
198110                                                                  19811044
198200**             BACK OUT THE CARTON AND UNIT QUANTITIES FROM THE   19820000
198300**             SUT_PO_AUD_REQ TABLE FOR THIS AUDIT                19830000
198310                                                                  19831044
198400                 PERFORM 3700-SELECT-AUDIT                        19840000
198500                 IF PS-SYSTEM-AUDIT-FOUND                         19850000
198600                     PERFORM 1055-GET-TGD-QTY                     19860000
198700                     COMPUTE SUT00015-AUD-CART-QTY =              19870000
198800                             SUT00015-AUD-CART-QTY - 1            19880000
198900                     COMPUTE SUT00015-AUD-UNT-QTY =               19890000
199000                             SUT00015-AUD-UNT-QTY - PV-SCN-QTY    19900000
199100                     PERFORM 3800-UPDATE-SUT-PO-AUD-REQ           19910000
199200                 END-IF                                           19920000
199300                 PERFORM 3100-REOPEN-SHIP-UNIT                    19930000
199400                 PERFORM 3500-DELETE-E-RECORDS                    19940000
199500                 SET SU006-NO-AUD-ERR TO TRUE                     19950000
199600             ELSE                                                 19960000
199700                 IF SU006-SHIP-UNIT-POSTPONE                      19970000
199800                     PERFORM 3200-CONTINUE-SHIP-UNIT              19980000
199900                 END-IF                                           19990000
200000             END-IF                                               20000000
200010                                                                  20001044
200100*            CONTINUE ON TO THE UPC SCAN PROGRAM                  20010000
200110                                                                  20011044
200200             MOVE PC-UPC-SCAN-PROGRAM-NAME                        20020000
200300                                        TO PV-TRANSFER-PROGRAM    20030000
200400             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                20040000
200500                                                                  20050000
200600*        THE USER WANTS TO CLOSE THE SHIPPING UNIT.  IF IT'S      20060000
200700*        ALREADY CLOSED, SAY SO.  IF IT'S POSTPONED, FIRST        20070000
200800*        CONTINUE IT (GET THE MINUTES POSTPONED), THEN CHECK THE  20080000
200900*        OVER/SHORT, THEN CLOSE IT                                20090000
200910                                                                  20091044
201000         WHEN CA-CLOSE-SELECTION                                  20100000
201100             SET CA-NOT-IN-CONFIRM-STATE         TO TRUE          20110000
201200             IF  PS-CARTON-ALREADY-COMPLETE                       20120000
201300             AND SU006-SYSTEM-GENERATED-AUDIT                     20130000
201310                                                                  20131044
201400*             THIS LOGIC SHOULD NEVER BE PERFORMED AS THE         20140000
201500*             EXECUTION OF THIS SAME LOGIC FOR THE QC AUDIT SHOULD20150000
201600*             HAVE RETURNED THE SCREEN BACK TO THE USER.          20160000
201610                                                                  20161044
201700                 MOVE PM-ALREADY-CLOSED-MSG                       20170000
201800                                        TO AMSGLNO                20180000
201900                 PERFORM 8100-SEND-DATA-ONLY                      20190000
202000                 PERFORM 8200-RETURN-TRANID                       20200000
202100             ELSE                                                 20210000
202200                 IF SU006-SHIP-UNIT-POSTPONE                      20220000
202300                    PERFORM 3200-CONTINUE-SHIP-UNIT               20230000
202400                 END-IF                                           20240000
202500             END-IF                                               20250000
202510                                                                  20251044
202600*         IF THE AUDIT IS SYSTEM GENERATED, CHECK FOR OVER/SHORT, 20260000
202700*         SET THE APPROPRIATE INDICATORS AND CREATE EXCEPTIONS    20270000
202710                                                                  20271044
202800             IF SU006-SYSTEM-GENERATED-AUDIT                      20280000
202900                IF SU006-PRINTER-DEST = SPACES                    20290000
203000                   MOVE PM-PRINTER-ID-REQUIRED-MSG  TO  AMSGLNO   20300000
203100                   MOVE -1                          TO  ASELECTL  20310000
203110                                                                  20311044
203200*                THIS LOGIC SHOULD NEVER BE PERFORMED AS THE      20320000
203300*                EXECUTION OF THIS SAME LOGIC FOR THE QC AUDIT    20330000
203400*                SHOULD HAVE RETURNED THE SCREEN BACK TO THE USER 20340000
203410                                                                  20341044
203500                   PERFORM 8100-SEND-DATA-ONLY                    20350000
203600                   PERFORM 8200-RETURN-TRANID                     20360000
203700                ELSE                                              20370000
203720                                                                  20372045
203730                  IF SU006-PRINTER-DEST = PC-PRINT-TO-FILE        20373045
203740                     SET PS-PRINT-TO-FILE-NO  TO TRUE             20374045
203750                     PERFORM 1320-VALIDATE-PRINT-TO-FILE          20375045
203751                                                                  20375156
203770                     IF  PS-PRINT-TO-FILE-YES                     20377045
203780                         MOVE SPACES       TO  CA-PRTR-CNTL-IND   20378045
203791                         MOVE ZEROES       TO  CA-TRACK-NBR       20379145
203800                     ELSE                                         20380045
203801                        MOVE PC-PRINT-TO-FILE-ERR-MSG TO AMSGLNO  20380145
203802                        MOVE -1                       TO  ASELECTL20380245
203803                        PERFORM 8100-SEND-DATA-ONLY               20380345
203804                        PERFORM 8200-RETURN-TRANID                20380445
203805                     END-IF                                       20380545
203806                   ELSE                                           20380645
203807                                                                  20380745
203810                     PERFORM 1310-VALIDATE-PRINTER                20381045
203900                     IF DP072-PRTR-PRTR-TRK-STAT-CDE NOT EQUAL 'A'20390045
204000                        MOVE PM-INVALID-PRINTER-ID-MSG TO AMSGLNO 20400045
204100                        MOVE -1                       TO  ASELECTL20410045
204110                                                                  20411044
204200*                 THIS LOGIC SHOULD NEVER BE PERFORMED AS THE     20420000
204300*                 EXECUTION OF THIS SAME LOGIC FOR THE QC AUDIT   20430000
204400*                 SHOULD HAVE RETURNED THE SCREEN BACK TO THE USER20440000
204410                                                                  20441044
204500                        PERFORM 8100-SEND-DATA-ONLY               20450045
204600                        PERFORM 8200-RETURN-TRANID                20460045
204700                     ELSE                                         20470045
204800                        PERFORM 4240-OTHER-QUANTITY-RTN           20480045
204900                        IF PS-OVER-SHORT-ERROR                    20490045
205000                           SET SU006-AUD-ERR   TO TRUE            20500045
205100                           SET CA-OVER-SHORT   TO TRUE            20510045
205200                        END-IF                                    20520045
205300                    END-IF                                        20530045
205400                  END-IF                                          20540045
205410                END-IF                                            20541045
205500             ELSE                                                 20550000
205510                                                                  20551044
205600*               IF THERE ARE NO ERRORS, CHECK OVER/SHORT AND SET  20560000
205700*               THE INDICATOR APPROPRIATELY (NO EXCEPTION CREATED)20570000
205800                                                                  20580044
206100                     IF SU006-QC-AUD-ONLY                         20610000
206200                        PERFORM 4100-CHECK-OVER-SHORT             20620000
206300                        IF PS-OVER-SHORT-ERROR                    20630000
206400                          OR SU006-NO-AUD-ERR                     20640031
206500                           SET SU006-AUD-ERR   TO TRUE            20650000
206600                          IF PS-OVER-SHORT-ERROR                  20660031
206700                           SET CA-OVER-SHORT   TO TRUE            20670000
206800                          END-IF                                  20680031
206900                        END-IF                                    20690031
207000                     END-IF                                       20700000
207100                                                                  20710044
207200                 IF SU006-QC-AUD-ONLY                             20720000
207300                   OR SU006-QC-AND-RFID-AUD                       20730003
207400                   CONTINUE                                       20740000
207500                 ELSE                                             20750000
207600                   PERFORM 4220-TAG-SCAN-QUANTITY-RTN             20760000
207700                 END-IF                                           20770000
207800             END-IF                                               20780000
207900             PERFORM 2200-SELECT-PRINT-IND                        20790000
208000                                                                  20800044
211300             MOVE SU006-SHIP-UNIT-STATUS                          21130000
211400                                      TO PV-SAVE-SHIP-UNIT-STATUS 21140000
211500             SET PS-CARTON-ALREADY-COMPLETE TO TRUE               21150000
211600             IF SU006-SYSTEM-GENERATED-AUDIT                      21160000
211700                PERFORM 3300-CLOSE-SHIP-UNIT                      21170000
211800             END-IF                                               21180000
211900             PERFORM 3700-SELECT-AUDIT                            21190000
212000                                                                  21200000
212100             IF PS-SYSTEM-AUDIT-FOUND                             21210000
212200                 PERFORM 1055-GET-TGD-QTY                         21220000
212300                 MOVE SU006-RFID-AUDIT-CNTL-NBR                   21230000
212400                                  TO DK-AUDIT-CNTL-NBR            21240000
212500                 PERFORM 1045-CALC-AUDIT-CRTNS                    21250000
212600                 MOVE SU006-AUDIT-CNTL-NBR  TO DK-AUDIT-CNTL-NBR  21260000
212700                 PERFORM 1050-CALC-AUDIT-UNITS                    21270000
212800                 MOVE PV-AUDIT-CRTN-COUNT TO SUT00015-AUD-CART-QTY21280000
212900                 MOVE PV-AUDIT-UNIT-QTY   TO SUT00015-AUD-UNT-QTY 21290000
213000                 MOVE SU006-RFID-AUDIT-CNTL-NBR                   21300000
213100                                  TO DK-AUDIT-CNTL-NBR            21310000
213200                 PERFORM 3800-UPDATE-SUT-PO-AUD-REQ               21320000
213300             END-IF                                               21330000
213400                                                                  21340000
213500*        THE USER WANTS TO POSTPONE THE SHIPPING UNIT.  IF IT'S   21350000
213600*        ALREADY POSTPONED, SAY SO.  IF IT'S CLOSED, REOPEN IT    21360000
213700*        (TO GET THE MINUETES CLOSED) AND THEN POSTPONE IT        21370000
213710                                                                  21371044
213800         WHEN CA-POSTPONE-SELECTION                               21380000
213900             IF SU006-INSTREAM-AUDIT                              21390000
214000                 MOVE PC-CANNOT-POSTPONE-AUDIT-MSG                21400000
214100                                     TO AMSGLNO                   21410000
214200                 MOVE -1             TO ASELECTL                  21420000
214210                                                                  21421044
214300*              THIS LOGIC SHOULD NEVER BE PERFORMED AS THE        21430000
214400*              EXECUTION OF THIS SAME LOGIC FOR THE QC AUDIT      21440000
214500*              SHOULD HAVE RETURNED THE SCREEN BACK TO THE USER.  21450000
214510                                                                  21451044
214600                 PERFORM 8100-SEND-DATA-ONLY                      21460000
214700                 PERFORM 8200-RETURN-TRANID                       21470000
214800             ELSE                                                 21480000
214900                 SET CA-NOT-IN-CONFIRM-STATE         TO TRUE      21490000
215000                 IF SU006-SHIP-UNIT-POSTPONE                      21500000
215100                     MOVE PM-ALREADY-POSTPONED-MSG                21510000
215200                                            TO AMSGLNO            21520000
215210                                                                  21521044
215300*                 THIS LOGIC SHOULD NEVER BE PERFORMED AS THE     21530000
215400*                 EXECUTION OF THIS SAME LOGIC FOR THE QC AUDIT   21540000
215500*                 SHOULD HAVE RETURNED THE SCREEN BACK TO THE USER21550000
215510                                                                  21551044
215600                     PERFORM 8100-SEND-DATA-ONLY                  21560000
215700                     PERFORM 8200-RETURN-TRANID                   21570000
215800                 ELSE                                             21580000
215900                     IF PS-CARTON-ALREADY-COMPLETE                21590000
216000                         MOVE 'CLOSED--CANT POSTPN'               21600000
216100                                                TO AMSGLNO        21610000
216110                                                                  21611044
216200*                 THIS LOGIC SHOULD NEVER BE PERFORMED AS THE     21620000
216300*                 EXECUTION OF THIS SAME LOGIC FOR THE QC AUDIT   21630000
216400*                 SHOULD HAVE RETURNED THE SCREEN BACK TO THE USER21640000
216410                                                                  21641044
216500                         PERFORM 8100-SEND-DATA-ONLY              21650000
216600                         PERFORM 8200-RETURN-TRANID               21660000
216700                     END-IF                                       21670000
216800                 END-IF                                           21680000
216900                 MOVE SU006-SHIP-UNIT-STATUS                      21690000
217000                                      TO PV-SAVE-SHIP-UNIT-STATUS 21700000
217100                 SET SU006-SHIP-UNIT-POSTPONE TO TRUE             21710000
217200                 PERFORM 3300-CLOSE-SHIP-UNIT                     21720000
217300                 MOVE PM-SHIP-UNIT-POSTPONED-MSG                  21730000
217400                                            TO AMSGLNO            21740000
217500             END-IF                                               21750000
217600                                                                  21760000
217700*        THE USER WANTS TO RESTART THE SHIPPING UNIT FROM SCRATCH.21770000
217800*        IF IT'S COMPLETE OR POSPONED, IT WILL HAVE TO FIRST BE   21780000
217900*        RE-OPENED.  THEN DELETE THE DETAIL/EXCPETIONS FOR THE    21790000
218000*        SHIPPING UNIT, AND GO ON TO THE UPC SCAN SCREEN          21800000
218010                                                                  21801044
218100         WHEN CA-RESTART-SELECTION                                21810000
218200*          IF THE USER HAS CONFIRMED THE RESTART -- DO IT         21820000
218300             IF CA-CONFIRMED                                      21830000
218400                IF PS-CARTON-ALREADY-COMPLETE                     21840000
218410                                                                  21841044
218500**               BACK OUT THE CARTON AND UNIT QUANTITIES FROM THE 21850000
218600**               SUT_PO_AUD_REQ TABLE FOR THIS AUDIT              21860000
218610                                                                  21861044
218700                    PERFORM 3700-SELECT-AUDIT                     21870000
218800                    IF PS-SYSTEM-AUDIT-FOUND                      21880000
218900                        PERFORM 1055-GET-TGD-QTY                  21890000
219000                        COMPUTE SUT00015-AUD-CART-QTY =           21900000
219100                                SUT00015-AUD-CART-QTY - 1         21910000
219200                        COMPUTE SUT00015-AUD-UNT-QTY =            21920000
219300                                SUT00015-AUD-UNT-QTY - PV-SCN-QTY 21930000
219400                        PERFORM 3800-UPDATE-SUT-PO-AUD-REQ        21940000
219500                    END-IF                                        21950000
219600                    PERFORM 3100-REOPEN-SHIP-UNIT                 21960000
219700                ELSE                                              21970000
219800                    IF SU006-SHIP-UNIT-POSTPONE                   21980000
219900                        PERFORM 3200-CONTINUE-SHIP-UNIT           21990000
220000                    END-IF                                        22000000
220100                END-IF                                            22010000
220200                PERFORM 3400-RESTART-SHIP-UNIT                    22020000
220210                                                                  22021044
220300*            FOR I-PREPACK AND NOT ECOMMERCE GO TO PREPACK QTY    22030000
220400*            SCREEN, OTHERWISE CONTINUE ON TO THE UPC SCAN PROGRAM22040000
220410                                                                  22041044
220500                IF SU006-PREPK-ITYPE-PKGNG-CDE                    22050000
220600                   SET SU006-PREPACK-NOT-CLOSED TO TRUE           22060000
220700                   MOVE PC-PREPK-QTY-SCREEN-PROGRAM               22070000
220800                                           TO PV-TRANSFER-PROGRAM 22080000
220900                ELSE                                              22090000
221000                   MOVE PC-UPC-SCAN-PROGRAM-NAME                  22100000
221100                                           TO PV-TRANSFER-PROGRAM 22110000
221200                END-IF                                            22120000
221300                PERFORM 2100-XCTL-TO-SELECTED-PROGRAM             22130000
221400            ELSE                                                  22140000
221410                                                                  22141044
221500*               THE PROGRAM IS EXPECTING TO CONFIRM IT, AND IT    22150000
221600*               WASN'T (IE AN ENTER WAS PRESSED), CANCEL THE      22160000
221700*               RESTART                                           22170000
221710                                                                  22171044
221800                IF CA-IN-CONFIRM-STATE                            22180000
221900                    SET CA-NOT-IN-CONFIRM-STATE TO TRUE           22190000
222000                    MOVE PM-CANCEL-RESTART-MSG  TO AMSGLNO        22200000
222100                    MOVE SPACES                 TO ASELECTO       22210000
222200                                                   CA-SELECTION-X 22220000
222210                                                                  22221044
222300*                 IF IT GOT TO HERE, IT WAS NOT IN CONFIRM STATUS 22230000
222400*                 (INITIAL SELECTION OF RESTART) SET TO CONFIRM   22240000
222500*                 STATE AND DISPLAY KEY TO F2 TO CONFIRM.         22250000
222510                                                                  22251044
222600                ELSE                                              22260000
222700                    PERFORM 3700-SELECT-AUDIT                     22270000
222800                    IF  PS-SYSTEM-AUDIT-FOUND                     22280000
222900                    AND (SUT00015-AUD-STAT-CDE = 'N'              22290000
223000                     OR  SUT00015-AUD-STAT-CDE = 'P'              22300000
223100                     OR  SUT00015-AUD-STAT-CDE = 'F')             22310000
223200                        MOVE PC-AUDIT-NO-LONGER-NEEDED-MSG        22320000
223300                                                TO AMSGLNO        22330000
223400                        IF ( SUT00015-AUD-STAT-CDE = 'N' )        22340000
223500                            PERFORM 3250-LINK-COMMON-CARTON-CLOSE 22350000
223600                        END-IF                                    22360000
223700                        PERFORM 8100-SEND-DATA-ONLY               22370000
223800                        PERFORM 8200-RETURN-TRANID                22380000
223900                    ELSE                                          22390000
224000                        PERFORM 4000-SELECT-TSUNAUD               22400000
224100                        IF SUNAUD-AUD-STAT-CDE = 'CM'             22410000
224200                            MOVE PC-AUDIT-NO-LONGER-NEEDED-MSG    22420000
224300                              TO AMSGLNO                          22430000
224400                            IF ( NOT PS-SYSTEM-AUDIT-FOUND )      22440000
224500                                PERFORM                           22450000
224600                                  3250-LINK-COMMON-CARTON-CLOSE   22460000
224700                            END-IF                                22470000
224800                            PERFORM 8100-SEND-DATA-ONLY           22480000
224900                            PERFORM 8200-RETURN-TRANID            22490000
225000                        ELSE                                      22500000
225100                            SET CA-IN-CONFIRM-STATE     TO TRUE   22510000
225200                            MOVE PM-CONFIRM-RESTART-MSG TO AMSGLNO22520000
225300                        END-IF                                    22530000
225400                    END-IF                                        22540000
225500                END-IF                                            22550000
225600                MOVE -1                   TO ASELECTL             22560000
225700            END-IF                                                22570000
225800                                                                  22580000
225900*                                                                 22590044
226000         WHEN CA-PRINT-SELECTION                                  22600000
226100             SET CA-NOT-IN-CONFIRM-STATE  TO TRUE                 22610000
226110                                                                  22611044
226200*          CONTINUE ON TO THE PRINT PROGRAM                       22620000
226210                                                                  22621044
226300             MOVE PC-PRINT-PROGRAM-NAME   TO PV-TRANSFER-PROGRAM  22630000
226400             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                22640000
226500                                                                  22650000
226600         WHEN OTHER                                               22660000
226700             SET CA-NOT-IN-CONFIRM-STATE  TO TRUE                 22670000
226800             MOVE SPACES                  TO AMSGLNO              22680000
226900     END-EVALUATE.                                                22690000
227000                                                                  22700000
227100******************************************************************22710000
227200 2100-XCTL-TO-SELECTED-PROGRAM.                                   22720000
227300                                                                  22730000
227400     SET SU006-INITIALIZE-SCREEN   TO TRUE.                       22740000
227500     MOVE LENGTH OF CA-COMMAREA    TO PV-COMMAREA-LENGTH.         22750000
227600     MOVE PC-CURRENT-PROGRAM-NAME  TO SU006-LAST-PROGRAM.         22760000
227700                                                                  22770000
227800     EXEC CICS                                                    22780000
227900         XCTL                                                     22790000
228000             PROGRAM   (PV-TRANSFER-PROGRAM)                      22800000
228100             COMMAREA  (CA-COMMAREA)                              22810000
228200             LENGTH    (PV-COMMAREA-LENGTH)                       22820000
228300             RESP      (PV-CICS-RESPONSE)                         22830000
228400     END-EXEC.                                                    22840000
228500                                                                  22850000
228600     EVALUATE TRUE                                                22860000
228700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 22870000
228800              CONTINUE                                            22880000
228900                                                                  22890000
229000         WHEN OTHER                                               22900000
229100              MOVE '2100-XCTL-TO-SELECTED-PROGRAM'                22910000
229200                                     TO DP013-PARAGRAPH           22920000
229300              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       22930000
229400                                     TO DP013-MESSAGE-TEXT (1)    22940000
229500              MOVE PV-TRANSFER-PROGRAM                            22950000
229600                                     TO DP013-MESSAGE-TEXT (2)    22960000
229700              SET DP013-CICS-ABEND   TO TRUE                      22970000
229900              PERFORM 9999-WRITE-CICS-LOG-MSG                     22990000
230000              MOVE PM-TRANS-NOT-AVAILABLE-MSG                     23000000
230100                                     TO AMSGLNO                   23010000
230200              SET SU006-PROCESS-SCREEN TO TRUE                    23020000
230300              PERFORM 8100-SEND-DATA-ONLY                         23030000
230400              PERFORM 8200-RETURN-TRANID                          23040000
230500     END-EVALUATE.                                                23050000
230600                                                                  23060000
230700******************************************************************23070000
230800 2200-SELECT-PRINT-IND.                                           23080000
230900                                                                  23090000
231000     MOVE SU006-OPER-UNT-ID        TO DK-LOC-ID.                  23100000
231100                                                                  23110000
231200     EXEC SQL                                                     23120000
231300         SELECT FUNC_TXT                                          23130000
231400           INTO :KRPRPM-FUNC-TXT                                  23140000
231500           FROM TKRPRPM                                           23150000
231600          WHERE SYS_PRC_FUNC_CDE  = 'CAUDRP'                      23160000
231700            AND LOC_ID            = :DK-LOC-ID                    23170000
231800            AND INTFC_SYS_CDE     = 'KHL'                         23180000
231900            AND FUNC_PRC_STAT_CDE = 'AC'                          23190000
232000            AND (CURRENT DATE                                     23200000
232100        BETWEEN DATE(FUNC_BEG_TMST) AND                           23210000
232200                DATE(FUNC_END_TMST) )                             23220000
232300     END-EXEC.                                                    23230000
232400                                                                  23240000
232500     EVALUATE SQLCODE                                             23250000
232600         WHEN ZERO                                                23260000
232700             IF KRPRPM-FUNC-TXT = 'Y'                             23270000
232800                 SET PS-DO-PRINT-REPORT     TO TRUE               23280000
232900             ELSE                                                 23290000
233000                 SET PS-DO-NOT-PRINT-REPORT TO TRUE               23300000
233100             END-IF                                               23310000
233200                                                                  23320000
233300         WHEN OTHER                                               23330000
233400              MOVE '2200-SELECT-PRINT-IND'                        23340000
233500                               TO DP013-PARAGRAPH                 23350000
233600              MOVE 'SELECT PRINT IND'                             23360000
233700                               TO DP013-MESSAGE-TEXT (1)          23370000
233800              MOVE SQLCA       TO DP013-SQLCA                     23380000
233900              SET DP013-DB2-ABEND                                 23390000
234000                               TO TRUE                            23400000
234100              PERFORM DP014-0000-PROCESS-ABEND                    23410000
234200     END-EVALUATE.                                                23420000
234300                                                                  23430000
234400******************************************************************23440000
234500*  3000-GET-CLOSED-MINUTES.                                      *23450000
234600*  SELECT THE NUMBER OF DAYS, HOURS AND MINUTES SINCE THE CARTON *23460000
234700*  WAS CLOSED/POSTPONED.                                         *23470000
234800******************************************************************23480000
234900 3000-GET-CLOSED-MINUTES.                                         23490000
235000                                                                  23500000
235100     EXEC SQL                                                     23510000
235200         SELECT                                                   23520000
235300            UNT_PSPND_MNIT_QTY                                    23530000
235400          , UNT_CLO_MNIT_QTY                                      23540000
235500          , DAYS(CURRENT TIMESTAMP)    - DAYS(UNT_AUD_STP_TMST)   23550000
235600          , HOUR(CURRENT TIMESTAMP)    - HOUR(UNT_AUD_STP_TMST)   23560000
235700          , MINUTE(CURRENT TIMESTAMP)  - MINUTE(UNT_AUD_STP_TMST) 23570000
235800          , CURRENT TIMESTAMP                                     23580000
235900         INTO                                                     23590000
236000                :SUATRN-UNT-PSPND-MNIT-QTY                        23600000
236100              , :SUATRN-UNT-CLO-MNIT-QTY                          23610000
236200              , :PV-CLOSED-DAYS                                   23620000
236300              , :PV-CLOSED-HOURS                                  23630000
236400              , :PV-CLOSED-MINUTES                                23640000
236500              , :PV-CURRENT-TIMESTAMP                             23650000
236600         FROM   TSUATRN                                           23660000
236700         WHERE  AUD_CNTL_NBR  = :DK-AUDIT-CNTL-NBR                23670000
236800           AND  SHIPT_UNT_ID  = :DK-SHIP-UNIT-NBR                 23680000
236900     END-EXEC.                                                    23690000
237000                                                                  23700000
237100     EVALUATE TRUE                                                23710000
237200         WHEN SQLCODE = ZERO                                      23720000
237300             COMPUTE PV-TOTAL-CLOSED-MINUTES =                    23730000
237400                ((PV-CLOSED-DAYS     * 1440) +                    23740000
237500                 (PV-CLOSED-HOURS    * 60)   +                    23750000
237600                  PV-CLOSED-MINUTES)                              23760000
237700                                                                  23770000
237800         WHEN SQLWARN0 NOT = SPACES                               23780000
237900         WHEN SQLCODE < ZERO                                      23790000
238000         WHEN SQLCODE > ZERO                                      23800000
238100             MOVE '3000-GET-CLOSED-MINUTES'                       23810000
238200                                   TO DP013-PARAGRAPH             23820000
238300             MOVE 'SELECT OF TSUATRN TABLE'                       23830000
238400                                   TO DP013-MESSAGE-TEXT (1)      23840000
238500             MOVE DK-AUDIT-CNTL-NBR                               23850000
238600                                   TO DK-AUDIT-CNTL-NBR-X         23860000
238700             MOVE DK-AUDIT-CNTL-NBR-X                             23870000
238800                                   TO DP013-MESSAGE-TEXT (2)      23880000
238900             MOVE DK-SHIP-UNIT-NBR TO DK-SHIP-UNIT-NBR-X          23890032
239000             MOVE DK-SHIP-UNIT-NBR-X                              23900032
239100                                   TO DP013-MESSAGE-TEXT (3)      23910032
239200             MOVE SQLCA            TO DP013-SQLCA                 23920000
239300             MOVE 'TSUATRN'        TO DP013-DB2-TABLE-NAME (1)    23930000
239400             SET DP013-DB2-ABEND   TO TRUE                        23940000
239600             PERFORM 9999-WRITE-CICS-LOG-MSG                      23960000
239700             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               23970000
239800             PERFORM 8100-SEND-DATA-ONLY                          23980000
239900             PERFORM 8200-RETURN-TRANID                           23990000
240000     END-EVALUATE.                                                24000000
240100                                                                  24010000
240200******************************************************************24020000
240300*  3001-GET-OPENED-MINUTES.                                      *24030000
240400*  SELECT THE NUMBER OF DAYS, HOURS AND MINUTES SINCE THE CARTON *24040000
240500*  WAS OPENED -- THIS IS USED WHEN RESTARTING THE AUDIT          *24050000
240600******************************************************************24060000
240700 3001-GET-OPENED-MINUTES.                                         24070000
240800                                                                  24080000
240900     EXEC SQL                                                     24090000
241000         SELECT                                                   24100000
241100            UNT_RSTRT_MNIT_QTY                                    24110000
241200          , UNT_PSPND_MNIT_QTY                                    24120000
241300          , UNT_CLO_MNIT_QTY                                      24130000
241400          , DAYS(CURRENT TIMESTAMP)   - DAYS(UNT_AUD_STRT_TMST)   24140000
241500          , HOUR(CURRENT TIMESTAMP)   - HOUR(UNT_AUD_STRT_TMST)   24150000
241600          , MINUTE(CURRENT TIMESTAMP) - MINUTE(UNT_AUD_STRT_TMST) 24160000
241700          , CURRENT TIMESTAMP                                     24170000
241800         INTO                                                     24180000
241900                :SUATRN-UNT-RSTRT-MNIT-QTY                        24190000
242000              , :SUATRN-UNT-PSPND-MNIT-QTY                        24200000
242100              , :SUATRN-UNT-CLO-MNIT-QTY                          24210000
242200              , :PV-OPENED-DAYS                                   24220000
242300              , :PV-OPENED-HOURS                                  24230000
242400              , :PV-OPENED-MINUTES                                24240000
242500              , :PV-CURRENT-TIMESTAMP                             24250000
242600         FROM                                                     24260000
242700                TSUATRN                                           24270000
242800         WHERE  AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             24280000
242900           AND  SHIPT_UNT_ID     = :DK-SHIP-UNIT-NBR              24290000
243000     END-EXEC.                                                    24300000
243100                                                                  24310000
243200     EVALUATE TRUE                                                24320000
243300         WHEN SQLCODE = ZERO                                      24330000
243310                                                                  24331044
243400*        THE CALCULATION OF THE OPENED MINUTES WILL FIRST CALC    24340000
243500*        THE NUMBER OF MINUTES FROM START TO CURRENT TIMESTAMP,   24350000
243600*        AND THEN SUBTRACT THE TOTAL POSTPONED AND CLOSED MINUTES.24360000
243610                                                                  24361044
243700             COMPUTE PV-TOTAL-OPENED-MINUTES =                    24370000
243800               (((PV-OPENED-DAYS     * 1440) +                    24380000
243900                 (PV-OPENED-HOURS    * 60)   +                    24390000
244000                  PV-OPENED-MINUTES) -                            24400000
244100                 SUATRN-UNT-PSPND-MNIT-QTY -                      24410000
244200                 SUATRN-UNT-CLO-MNIT-QTY )                        24420000
244300                                                                  24430000
244400         WHEN SQLWARN0 NOT = SPACES                               24440000
244500         WHEN SQLCODE < ZERO                                      24450000
244600         WHEN SQLCODE > ZERO                                      24460000
244700             MOVE '3001-GET-OPENED-MINUTES'                       24470000
244800                                   TO DP013-PARAGRAPH             24480000
244900             MOVE 'SELECT OF TSUATRN TABLE'                       24490000
245000                                   TO DP013-MESSAGE-TEXT (1)      24500000
245100             MOVE DK-AUDIT-CNTL-NBR                               24510000
245200                                   TO DK-AUDIT-CNTL-NBR-X         24520000
245300             MOVE DK-AUDIT-CNTL-NBR-X                             24530000
245400                                   TO DP013-MESSAGE-TEXT (2)      24540000
245500             MOVE DK-SHIP-UNIT-NBR TO DP013-MESSAGE-TEXT (3)      24550000
245600             MOVE SQLCA            TO DP013-SQLCA                 24560000
245700             MOVE 'TSUATRN'        TO DP013-DB2-TABLE-NAME (1)    24570000
245800             SET DP013-DB2-ABEND   TO TRUE                        24580000
246000             PERFORM 9999-WRITE-CICS-LOG-MSG                      24600000
246100             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               24610000
246200             PERFORM 8100-SEND-DATA-ONLY                          24620000
246300             PERFORM 8200-RETURN-TRANID                           24630000
246400     END-EVALUATE.                                                24640000
246500                                                                  24650000
246600******************************************************************24660000
246700 3050-GET-STAT-CDE.                                               24670000
246800                                                                  24680000
246900     EXEC SQL                                                     24690000
247000         SELECT UNT_AUD_STAT_CDE                                  24700000
247100           INTO :SUATRN-UNT-AUD-STAT-CDE                          24710000
247200           FROM TSUATRN                                           24720000
247300          WHERE AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             24730000
247400            AND SHIPT_UNT_ID     = :DK-SHIP-UNIT-NBR              24740000
247500     END-EXEC.                                                    24750000
247600                                                                  24760000
247700     EVALUATE TRUE                                                24770000
247800         WHEN SQLCODE = ZERO                                      24780000
247900             CONTINUE                                             24790000
248000                                                                  24800000
248100         WHEN SQLWARN0 NOT = SPACES                               24810000
248200         WHEN SQLCODE < ZERO                                      24820000
248300         WHEN SQLCODE > ZERO                                      24830000
248400             MOVE '3050-GET-STAT-CDE'                             24840000
248500                                   TO DP013-PARAGRAPH             24850000
248600             MOVE 'SELECT OF TSUATRN TABLE'                       24860000
248700                                   TO DP013-MESSAGE-TEXT (1)      24870000
248800             MOVE DK-AUDIT-CNTL-NBR                               24880000
248900                                   TO DK-AUDIT-CNTL-NBR-X         24890000
249000             MOVE DK-AUDIT-CNTL-NBR-X                             24900000
249100                                   TO DP013-MESSAGE-TEXT (2)      24910000
249200             MOVE SU006-SHIP-UNIT-NBR-X                           24920000
249300                                   TO DP013-MESSAGE-TEXT (3)      24930000
249400             MOVE SQLCA            TO DP013-SQLCA                 24940000
249500             MOVE 'TSUATRN'        TO DP013-DB2-TABLE-NAME (1)    24950000
249600             SET DP013-DB2-ABEND   TO TRUE                        24960000
249800             PERFORM 9999-WRITE-CICS-LOG-MSG                      24980000
249900             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               24990000
250000             PERFORM 8100-SEND-DATA-ONLY                          25000000
250100             PERFORM 8200-RETURN-TRANID                           25010000
250200     END-EVALUATE.                                                25020000
250300                                                                  25030000
250400******************************************************************25040000
250500*  3100-REOPEN-SHIP-UNIT.                                        *25050000
250600*  THE SHIPPING UNIT HAS BEEN CLOSED, BUT THE USER WANTS TO RE-  *25060000
250700*  OPEN IT: 1) UPDATE THE "CLOSED TIMESTAMP".  CALC MINUTES FROM *25070000
250800*              CURRENT TIMESTAMP TO CLOSE TIMESTAMP              *25080000
250900*           2) UPDATE THE STOP TIMESTAMP TO INITIAL VALUES       *25090000
251000*           3) UPDATE THE STATUS TO INPROCESS                    *25100000
251100******************************************************************25110000
251200 3100-REOPEN-SHIP-UNIT.                                           25120000
251300                                                                  25130000
251400*    IF THIS IS THE FIRST AUDIT PROCESSED IT SHOULD BE A QC AUDIT 25140000
251500*    AND WE WANT TO PROCESS USING THE QC AUDIT NUMBER.  IF THIS IS25150000
251600*    AN RFID ONLY AUDIT, THEN THE RFID AUDIT NUMBER WILL BE       25160000
251700*    CONTAINED IN THIS FIELD AND WE WANT TO USE IT.  IF NEITHER,  25170000
251800*    THEN IT'S A COMBINED AUDIT AND THE RFID AUDIT SHOULD PROCESS 25180000
251900*    SECOND IN THIS SCENARIO.                                     25190000
251910                                                                  25191044
252000     IF PS-PRCS-FIRST-AUDIT                                       25200000
252100     OR SU006-RFID-AUD-ONLY                                       25210000
252200     OR SU006-MANUAL-GENERATED-AUDIT                              25220000
252300         MOVE SU006-AUDIT-CNTL-NBR   TO DK-AUDIT-CNTL-NBR         25230000
252400     ELSE                                                         25240000
252500         MOVE SU006-RFID-AUDIT-CNTL-NBR                           25250000
252600                                     TO DK-AUDIT-CNTL-NBR         25260000
252700     END-IF.                                                      25270000
252800                                                                  25280044
252900     MOVE SU006-SHIP-UNIT-NBR        TO DK-SHIP-UNIT-NBR.         25290036
253000                                                                  25300000
253100*    IF THE ERROR FLAG WAS SET TO "Y", DOUBLE CHECK THE EXCEPTION 25310000
253200*    TABLES.  IF THERE ARE NO EXCEPTIONS, THAT MEANS THE FLAG WAS 25320000
253300*    SET DUE TO AN OVER/SHORT CHECK AT CLOSE TIME, AND SHOULD BE  25330000
253400*    RESET TO 'N' FOR THE REOPEN OF THE CARTON                    25340000
253410                                                                  25341044
253500     IF SU006-AUD-ERR                                             25350000
253600         PERFORM 3110-CHECK-EXCEPTION-TABLES                      25360000
253700     END-IF.                                                      25370000
253800                                                                  25380000
253900*    GET THE NUMBER OF MINUTES THE CARTON WAS CLOSED...           25390000
253910                                                                  25391044
254000     PERFORM 3000-GET-CLOSED-MINUTES.                             25400000
254100                                                                  25410000
254200*    UPDATE THE HOST VARIABLES WITH THE NEW REOPENED VALUES...    25420000
254210                                                                  25421044
254300     ADD PV-TOTAL-CLOSED-MINUTES TO SUATRN-UNT-CLO-MNIT-QTY.      25430000
254400     MOVE '9999-09-09-09.09.09.999999'                            25440000
254500                                 TO SUATRN-UNT-AUD-STP-TMST.      25450000
254600     SET SU006-SHIP-UNIT-INPROCESS TO TRUE.                       25460000
254700     MOVE SU006-SHIP-UNIT-STATUS TO SUATRN-UNT-AUD-STAT-CDE.      25470000
254800     MOVE SU006-AUD-ERR-IND      TO SUATRN-UNT-AUD-ERR-IND.       25480000
254900                                                                  25490000
255000*    UPDATE INFORMATION                                           25500000
255100     EXEC SQL                                                     25510000
255200         UPDATE TSUATRN                                           25520000
255300            SET  UNT_AUD_STP_TMST  = :SUATRN-UNT-AUD-STP-TMST     25530000
255400               , UNT_CLO_MNIT_QTY  = :SUATRN-UNT-CLO-MNIT-QTY     25540000
255500               , UNT_AUD_STAT_CDE  = :SUATRN-UNT-AUD-STAT-CDE     25550000
255600               , UNT_AUD_ERR_IND   = :SUATRN-UNT-AUD-ERR-IND      25560000
255700          WHERE  AUD_CNTL_NBR = :DK-AUDIT-CNTL-NBR                25570000
255800            AND  SHIPT_UNT_ID = :DK-SHIP-UNIT-NBR                 25580000
255900     END-EXEC.                                                    25590000
256000                                                                  25600000
256100     EVALUATE TRUE                                                25610000
256200         WHEN SQLCODE = ZERO                                      25620000
256300             CONTINUE                                             25630000
256400                                                                  25640000
256500         WHEN SQLWARN0 NOT = SPACES                               25650000
256600         WHEN SQLCODE < ZERO                                      25660000
256700         WHEN SQLCODE > ZERO                                      25670000
256800             MOVE '3100-REOPEN-SHIP-UNIT'                         25680000
256900                                   TO DP013-PARAGRAPH             25690000
257000             MOVE 'UPDATE OF TSUATRN TABLE'                       25700000
257100                                   TO DP013-MESSAGE-TEXT (1)      25710000
257200             MOVE DK-AUDIT-CNTL-NBR                               25720000
257300                                   TO DK-AUDIT-CNTL-NBR-X         25730000
257400             MOVE DK-AUDIT-CNTL-NBR-X                             25740000
257500                                   TO DP013-MESSAGE-TEXT (2)      25750000
257600             MOVE SU006-SHIP-UNIT-NBR-X                           25760000
257700                                   TO DP013-MESSAGE-TEXT (3)      25770000
257800             MOVE SQLCA            TO DP013-SQLCA                 25780000
257900             MOVE 'TSUATRN'        TO DP013-DB2-TABLE-NAME (1)    25790000
258000             SET DP013-DB2-ABEND   TO TRUE                        25800000
258200             SET SU006-SHIP-UNIT-COMPLETE TO TRUE                 25820000
258300             PERFORM 9999-WRITE-CICS-LOG-MSG                      25830000
258400             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               25840000
258500             PERFORM 8100-SEND-DATA-ONLY                          25850000
258600             PERFORM 8200-RETURN-TRANID                           25860000
258700     END-EVALUATE.                                                25870000
258800                                                                  25880000
258900******************************************************************25890000
259000*  3110-CHECK-EXCEPTION-TABLES.                                  *25900000
259100*  CHECK THE EXCEPTION TABLES TO DETERMINE IF THERE ARE ANY      *25910000
259200*  EXCEPTIONS FOR THIS SHIPPING UNIT                             *25920000
259300******************************************************************25930000
259400 3110-CHECK-EXCEPTION-TABLES.                                     25940000
259500                                                                  25950000
259600*    IF THIS IS THE FIRST AUDIT PROCESSED IT SHOULD BE A QC AUDIT 25960000
259700*    AND WE WANT TO PROCESS USING THE QC AUDIT NUMBER.  IF THIS IS25970000
259800*    AN RFID ONLY AUDIT, THEN THE RFID AUDIT NUMBER WILL BE       25980000
259900*    CONTAINED IN THIS FIELD AND WE WANT TO USE IT.  IF NEITHER,  25990000
260000*    THEN IT'S A COMBINED AUDIT AND THE RFID AUDIT SHOULD PROCESS 26000000
260100*    SECOND IN THIS SCENARIO.                                     26010000
260110                                                                  26011044
260200     IF PS-PRCS-FIRST-AUDIT                                       26020000
260300     OR SU006-RFID-AUD-ONLY                                       26030000
260400     OR SU006-MANUAL-GENERATED-AUDIT                              26040000
260500         MOVE SU006-AUDIT-CNTL-NBR   TO DK-AUDIT-CNTL-NBR         26050000
260600     ELSE                                                         26060000
260700         MOVE SU006-RFID-AUDIT-CNTL-NBR                           26070000
260800                                     TO DK-AUDIT-CNTL-NBR         26080000
260900     END-IF.                                                      26090000
261000                                                                  26100044
261100     MOVE SU006-SHIP-UNIT-NBR        TO DK-SHIP-UNIT-NBR.         26110000
261200                                                                  26120000
261300*    FIRST CHECK THE ITEM EXCEPTIONS (TSUEXCP)                    26130000
261400     EXEC SQL                                                     26140000
261500         SELECT AUD_CNTL_NBR                                      26150000
261600           INTO :SUEXCP-AUD-CNTL-NBR                              26160000
261700           FROM TSUEXCP                                           26170000
261800          WHERE AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             26180000
261900            AND SHIPT_UNT_ID     = :DK-SHIP-UNIT-NBR              26190000
262000     END-EXEC.                                                    26200000
262100                                                                  26210000
262200     EVALUATE TRUE                                                26220000
262300         WHEN SQLCODE = ZERO                                      26230000
262400         WHEN SQLCODE = -811                                      26240000
262500         WHEN SQLCODE = +100                                      26250000
262600             CONTINUE                                             26260000
262700                                                                  26270000
262800         WHEN SQLWARN0 NOT = SPACES                               26280000
262900         WHEN SQLCODE < ZERO                                      26290000
263000         WHEN SQLCODE > ZERO                                      26300000
263100             MOVE '3110-CHECK-EXCEPTION-TABLES.'                  26310000
263200                                   TO DP013-PARAGRAPH             26320000
263300             MOVE 'SELECT OF TSUEXCP TABLE'                       26330000
263400                                   TO DP013-MESSAGE-TEXT (1)      26340000
263500             MOVE DK-AUDIT-CNTL-NBR                               26350000
263600                                   TO DK-AUDIT-CNTL-NBR-X         26360000
263700             MOVE DK-AUDIT-CNTL-NBR-X                             26370000
263800                                   TO DP013-MESSAGE-TEXT (2)      26380000
263900             MOVE SU006-SHIP-UNIT-NBR-X                           26390000
264000                                   TO DP013-MESSAGE-TEXT (3)      26400000
264100             MOVE SQLCA            TO DP013-SQLCA                 26410000
264200             MOVE 'TSUEXCP'        TO DP013-DB2-TABLE-NAME (1)    26420000
264300             SET DP013-DB2-ABEND   TO TRUE                        26430000
264400             SET DP013-NO-ROLLBACK TO TRUE                        26440000
264500             PERFORM 9999-WRITE-CICS-LOG-MSG                      26450000
264600             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               26460000
264700             PERFORM 8100-SEND-DATA-ONLY                          26470000
264800             PERFORM 8200-RETURN-TRANID                           26480000
264900     END-EVALUATE.                                                26490000
265000                                                                  26500000
265100*    IF NO ITEM EXCEPTIONS, CHECK THE CARTON EXCEPTIONS           26510000
265200     IF SQLCODE = +100                                            26520000
265300         EXEC SQL                                                 26530000
265400             SELECT AUD_CNTL_NBR                                  26540000
265500               INTO :CTEXCP-AUD-CNTL-NBR                          26550000
265600               FROM TCTEXCP                                       26560000
265700              WHERE AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR         26570000
265800                AND SHIPT_UNT_ID     = :DK-SHIP-UNIT-NBR          26580000
265900         END-EXEC                                                 26590000
266000                                                                  26600000
266100         EVALUATE TRUE                                            26610000
266200             WHEN SQLCODE = ZERO                                  26620000
266300             WHEN SQLCODE = -811                                  26630000
266400             WHEN SQLCODE = +100                                  26640000
266500                 CONTINUE                                         26650000
266600                                                                  26660000
266700             WHEN SQLWARN0 NOT = SPACES                           26670000
266800             WHEN SQLCODE < ZERO                                  26680000
266900             WHEN SQLCODE > ZERO                                  26690000
267000                 MOVE '3110-CHECK-EXCEPTION-TABLES.'              26700000
267100                                       TO DP013-PARAGRAPH         26710000
267200                 MOVE 'SELECT OF TCTEXCP TABLE'                   26720000
267300                                       TO DP013-MESSAGE-TEXT (1)  26730000
267400                 MOVE DK-AUDIT-CNTL-NBR                           26740000
267500                                       TO DK-AUDIT-CNTL-NBR-X     26750000
267600                 MOVE DK-AUDIT-CNTL-NBR-X                         26760000
267700                                       TO DP013-MESSAGE-TEXT (2)  26770000
267800                 MOVE SU006-SHIP-UNIT-NBR-X                       26780000
267900                                       TO DP013-MESSAGE-TEXT (3)  26790000
268000                 MOVE SQLCA            TO DP013-SQLCA             26800000
268100                 MOVE 'TCTEXCP'        TO DP013-DB2-TABLE-NAME (1)26810000
268200                 SET DP013-DB2-ABEND   TO TRUE                    26820000
268300                 SET DP013-NO-ROLLBACK TO TRUE                    26830000
268400                 PERFORM 9999-WRITE-CICS-LOG-MSG                  26840000
268500                 MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO           26850000
268600                 PERFORM 8100-SEND-DATA-ONLY                      26860000
268700                 PERFORM 8200-RETURN-TRANID                       26870000
268800         END-EVALUATE                                             26880000
268900     END-IF.                                                      26890000
269000                                                                  26900000
269100*    IF THERE WERE NO EXCEPTIONS, SET THE FLAG ACCORDINGLY        26910000
269200     IF SQLCODE = +100                                            26920000
269300         SET SU006-NO-AUD-ERR        TO TRUE                      26930000
269400     ELSE                                                         26940000
269500         SET SU006-AUD-ERR           TO TRUE                      26950000
269600     END-IF.                                                      26960000
269700                                                                  26970000
269800******************************************************************26980000
269900*  3200-CONTINUE-SHIP-UNIT                                       *26990000
270000*  THE SHIPPING UNIT HAS BEEN POSTPONED, AND THE USER WANTS TO   *27000000
270100*  CONTINUE AUDITING:                                            *27010000
270200*           1) UPDATE THE POSTPONED MINUTES..CALC MINUTES FROM   *27020000
270300*              STOP DATE/TIME TO CURRENT DATE/TIME               *27030000
270400*           2) UPDATE THE STOP DATE/TIME TO INITIAL VALUES       *27040000
270500*           3) UPDATE THE STATUS TO INPROCESS                    *27050000
270600******************************************************************27060000
270700 3200-CONTINUE-SHIP-UNIT.                                         27070000
270800                                                                  27080000
270900*    IF THIS IS THE FIRST AUDIT PROCESSED IT SHOULD BE A QC AUDIT 27090000
271000*    AND WE WANT TO PROCESS USING THE QC AUDIT NUMBER.  IF THIS IS27100000
271100*    AN RFID ONLY AUDIT, THEN THE RFID AUDIT NUMBER WILL BE       27110000
271200*    CONTAINED IN THIS FIELD AND WE WANT TO USE IT.  IF NEITHER,  27120000
271300*    THEN IT'S A COMBINED AUDIT AND THE RFID AUDIT SHOULD PROCESS 27130000
271400*    SECOND IN THIS SCENARIO.                                     27140000
271410                                                                  27141044
271500     IF PS-PRCS-FIRST-AUDIT                                       27150000
271600     OR SU006-RFID-AUD-ONLY                                       27160000
271700     OR SU006-MANUAL-GENERATED-AUDIT                              27170000
271800         MOVE SU006-AUDIT-CNTL-NBR   TO DK-AUDIT-CNTL-NBR         27180000
271900     ELSE                                                         27190000
272000         MOVE SU006-RFID-AUDIT-CNTL-NBR                           27200000
272100                                     TO DK-AUDIT-CNTL-NBR         27210000
272200     END-IF.                                                      27220000
272300                                                                  27230044
272400     MOVE SU006-SHIP-UNIT-NBR        TO DK-SHIP-UNIT-NBR.         27240000
272500                                                                  27250000
272600*    GET THE NUMBER OF MINUTES THE CARTON WAS CLOSED...           27260000
272700     PERFORM 3000-GET-CLOSED-MINUTES.                             27270000
272800                                                                  27280000
272900*    UPDATE THE HOST VARIABLES WITH THE NEW CONTINUED VALUES...   27290000
273000     ADD PV-TOTAL-CLOSED-MINUTES TO SUATRN-UNT-PSPND-MNIT-QTY.    27300000
273100     MOVE '9999-09-09-09.09.09.999999'                            27310000
273200                                 TO SUATRN-UNT-AUD-STP-TMST.      27320000
273300     SET SU006-SHIP-UNIT-INPROCESS TO TRUE.                       27330000
273400     MOVE SU006-SHIP-UNIT-STATUS TO SUATRN-UNT-AUD-STAT-CDE.      27340000
273500                                                                  27350000
273600*    UPDATE INFORMATION                                           27360000
273700     EXEC SQL                                                     27370000
273800         UPDATE TSUATRN                                           27380000
273900            SET  UNT_AUD_STP_TMST    = :SUATRN-UNT-AUD-STP-TMST   27390000
274000               , UNT_PSPND_MNIT_QTY  = :SUATRN-UNT-PSPND-MNIT-QTY 27400000
274100               , UNT_AUD_STAT_CDE    = :SUATRN-UNT-AUD-STAT-CDE   27410000
274200          WHERE  AUD_CNTL_NBR   = :DK-AUDIT-CNTL-NBR              27420000
274300            AND  SHIPT_UNT_ID   = :DK-SHIP-UNIT-NBR               27430000
274400     END-EXEC.                                                    27440000
274500                                                                  27450000
274600     EVALUATE TRUE                                                27460000
274700         WHEN SQLCODE = ZERO                                      27470000
274800             CONTINUE                                             27480000
274900                                                                  27490000
275000         WHEN SQLWARN0 NOT = SPACES                               27500000
275100         WHEN SQLCODE < ZERO                                      27510000
275200         WHEN SQLCODE > ZERO                                      27520000
275300             MOVE '3200-CONTINUE-SHIP-UNIT'                       27530000
275400                                   TO DP013-PARAGRAPH             27540000
275500             MOVE 'UPDATE OF TSUATRN TABLE'                       27550000
275600                                   TO DP013-MESSAGE-TEXT (1)      27560000
275700             MOVE DK-AUDIT-CNTL-NBR                               27570000
275800                                   TO DK-AUDIT-CNTL-NBR-X         27580000
275900             MOVE DK-AUDIT-CNTL-NBR-X                             27590000
276000                                   TO DP013-MESSAGE-TEXT (2)      27600000
276100             MOVE SU006-SHIP-UNIT-NBR-X                           27610000
276200                                   TO DP013-MESSAGE-TEXT (3)      27620000
276300             MOVE SQLCA            TO DP013-SQLCA                 27630000
276400             MOVE 'TSUATRN'        TO DP013-DB2-TABLE-NAME (1)    27640000
276500             SET DP013-DB2-ABEND   TO TRUE                        27650000
276600             SET DP013-NO-ROLLBACK TO TRUE                        27660000
276700             SET SU006-SHIP-UNIT-POSTPONE TO TRUE                 27670000
276800             PERFORM 9999-WRITE-CICS-LOG-MSG                      27680000
276900             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               27690000
277000             PERFORM 8100-SEND-DATA-ONLY                          27700000
277100             PERFORM 8200-RETURN-TRANID                           27710000
277200     END-EVALUATE.                                                27720000
277300                                                                  27730000
277400******************************************************************27740000
277500* 3250-LINK-COMMON-CARTON-CLOSE                                  *27750000
277600*     WHEN APPLICABLE FILL IN COPYBOOK SUWS091                   *27760000
277700*                     LINK TO SUKCS769                           *27770000
277800*                     CHECK RETURN FOR ERRORS UPON RETURN        *27780000
277900******************************************************************27790000
278000 3250-LINK-COMMON-CARTON-CLOSE.                                   27800000
278100                                                                  27810000
278200     INITIALIZE CCC-REQUEST-COMMUNICATION-AREA.                   27820000
278300*    IF THIS IS THE FIRST AUDIT PROCESSED IT SHOULD BE A QC AUDIT 27830000
278400*    AND WE WANT TO PROCESS USING THE QC AUDIT NUMBER.  IF THIS IS27840000
278500*    AN RFID ONLY AUDIT, THEN THE RFID AUDIT NUMBER WILL BE       27850000
278600*    CONTAINED IN THIS FIELD AND WE WANT TO USE IT.  IF NEITHER,  27860000
278700*    THEN IT'S A COMBINED AUDIT AND THE RFID AUDIT SHOULD PROCESS 27870000
278800*    SECOND IN THIS SCENARIO.                                     27880000
278810                                                                  27881044
278900     IF PS-PRCS-FIRST-AUDIT                                       27890000
279000     OR SU006-RFID-AUD-ONLY                                       27900000
279100     OR SU006-MANUAL-GENERATED-AUDIT                              27910000
279200         MOVE SU006-AUDIT-CNTL-NBR                                27920000
279300                                  TO SU091-AUD-CNTL-NBR           27930000
279400     ELSE                                                         27940000
279500         MOVE SU006-RFID-AUDIT-CNTL-NBR                           27950000
279600                                  TO SU091-AUD-CNTL-NBR           27960000
279700     END-IF.                                                      27970000
279800                                                                  27980000
279900     MOVE '00'                    TO SU091-RET-CODE.              27990000
280000     MOVE PC-CURRENT-PROGRAM-NAME TO SU091-CALLING-PGM.           28000000
280100     MOVE SU006-OPER-UNT-ID       TO SU091-OPER-UNT-ID.           28010000
280200     MOVE SU006-SHIP-UNIT-NBR     TO SU091-SHIPT-UNT-ID.          28020000
280300                                                                  28030044
280400     MOVE SUT00015-AUD-STAT-CDE   TO SU091-AUD-STAT-CDE.          28040000
280500                                                                  28050000
280600     IF ( SU006-SYSTEM-GENERATED-AUDIT )                          28060000
280700         SET SU091-PROMPTED-AUDIT TO TRUE                         28070000
280800     ELSE                                                         28080000
280900         IF ( SU006-MANUAL-GENERATED-AUDIT )                      28090000
281000             SET SU091-MANUAL-AUDIT TO TRUE                       28100000
281100         END-IF                                                   28110000
281200     END-IF.                                                      28120000
281300                                                                  28130000
281400     MOVE SU006-USERID            TO SU091-ASSOC-ID.              28140000
281500                                                                  28150000
281600     EXEC CICS LINK                                               28160000
281700               PROGRAM  (PC-COMMON-CARTON-CLOSE-PGM)              28170000
281800               COMMAREA (CCC-REQUEST-COMMUNICATION-AREA)          28180000
281900               LENGTH   (LENGTH OF CCC-REQUEST-COMMUNICATION-AREA)28190000
282000               RESP     (PV-CICS-RESPONSE)                        28200000
282100     END-EXEC.                                                    28210000
282200                                                                  28220000
282300     EVALUATE TRUE                                                28230000
282400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 28240000
282500             CONTINUE                                             28250000
282600                                                                  28260000
282700         WHEN OTHER                                               28270000
282800             MOVE '3250-LINK-COMMON-CARTON-CLOSE'                 28280000
282900                                    TO DP013-PARAGRAPH            28290000
283000             MOVE 'BAD LINK TO PGM SUKCS769'                      28300000
283100                                    TO DP013-MESSAGE-TEXT (1)     28310000
283200             SET DP013-CICS-ABEND   TO TRUE                       28320000
283300             SET DP013-NO-ROLLBACK  TO TRUE                       28330000
283400             PERFORM 9999-WRITE-CICS-LOG-MSG                      28340000
283500     END-EVALUATE.                                                28350000
283600                                                                  28360000
283700     IF ( SU091-SUCCESS )                                         28370000
283800         CONTINUE                                                 28380000
283900     ELSE                                                         28390000
284000         EVALUATE TRUE                                            28400000
284100            WHEN SU091-PARAMETER-ERROR                            28410000
284200                MOVE PC-CCC-PARM-ERR-MSG    TO AMSGLNO            28420000
284300                                                                  28430000
284400            WHEN SU091-DB2-ERROR                                  28440000
284500                MOVE PC-CCC-DB2-ERR-MSG     TO AMSGLNO            28450000
284600                                                                  28460000
284700            WHEN SU091-MQ-ERROR                                   28470000
284800                MOVE PC-CCC-MQ-ERR-MSG      TO AMSGLNO            28480000
284900                                                                  28490000
285000            WHEN SU091-OTHER-ERROR                                28500000
285100                MOVE PC-CCC-OTHR-ERR-MSG    TO AMSGLNO            28510000
285200         END-EVALUATE                                             28520000
285300     END-IF.                                                      28530000
285400                                                                  28540000
285500******************************************************************28550000
285600*  3300-CLOSE-SHIP-UNIT                                          *28560000
285700*  THE USER WANTS TO CLOSE A SHIPPING UNIT:                      *28570000
285800*           1) UPDATE THE STOP DATE/TIME TO CURRENT VALUES       *28580000
285900*           2) UPDATE THE STATUS TO COMPLETE                     *28590000
286000******************************************************************28600000
286100 3300-CLOSE-SHIP-UNIT.                                            28610000
286200                                                                  28620000
286300*    IF THIS IS THE FIRST AUDIT PROCESSED IT SHOULD BE A QC AUDIT 28630000
286400*    AND WE WANT TO PROCESS USING THE QC AUDIT NUMBER.  IF THIS IS28640000
286500*    AN RFID ONLY AUDIT, THEN THE RFID AUDIT NUMBER WILL BE       28650000
286600*    CONTAINED IN THIS FIELD AND WE WANT TO USE IT.  IF NEITHER,  28660000
286700*    THEN IT'S A COMBINED AUDIT AND THE RFID AUDIT SHOULD PROCESS 28670000
286800*    SECOND IN THIS SCENARIO.                                     28680000
286810                                                                  28681044
286900     IF PS-PRCS-FIRST-AUDIT                                       28690000
287000     OR SU006-RFID-AUD-ONLY                                       28700000
287100     OR SU006-MANUAL-GENERATED-AUDIT                              28710000
287200         MOVE SU006-AUDIT-CNTL-NBR   TO DK-AUDIT-CNTL-NBR         28720000
287300     ELSE                                                         28730000
287400         MOVE SU006-RFID-AUDIT-CNTL-NBR                           28740000
287500                                     TO DK-AUDIT-CNTL-NBR         28750000
287600     END-IF.                                                      28760000
287700                                                                  28770044
287800     MOVE SU006-SHIP-UNIT-NBR        TO DK-SHIP-UNIT-NBR.         28780000
287810                                                                  28781044
287900** IF THIS IS THE SECOND PART OF A COMBO AUDIT, THEN,             28790000
288000** SU006-AUD-ERR-IND MAY HAVE BEEN SET TO 'Y' DURING PROCESSING   28800000
288100** OF THE QC AUDIT, SO, WE NEED TO CHECK CA-OVER-SHORT TO SEE IF  28810000
288200** AN ERROR WAS FOUND IN RF AUDIT NOT LEFTOVER FROM QC AUDIT.     28820000
288210                                                                  28821044
288300     IF PS-PRCS-SEC-AUDIT                                         28830000
288400       IF CA-OVER-SHORT-FALSE                                     28840000
288500         MOVE PC-N                     TO SUATRN-UNT-AUD-ERR-IND  28850000
288600       ELSE                                                       28860000
288700         MOVE PC-Y                     TO SUATRN-UNT-AUD-ERR-IND  28870000
288800       END-IF                                                     28880000
288900     ELSE                                                         28890000
289000       MOVE SU006-AUD-ERR-IND        TO SUATRN-UNT-AUD-ERR-IND    28900000
289100     END-IF.                                                      28910000
289200                                                                  28920000
289300     IF  SU006-SHIP-UNIT-COMPLETE                                 28930000
289400       AND PS-PRCS-FIRST-AUDIT                                    28940000
289500         IF  SU006-INSTREAM-AUDIT                                 28950000
289600             IF  SU006-DC-NOT-INTERFACED                          28960000
289700                 CONTINUE                                         28970000
289800             ELSE                                                 28980000
289900                 PERFORM 3310-CALL-DLKUP001                       28990000
290300                 IF  DL001-ASGMT-CLOSED-RETURN                    29030000
290400                     PERFORM 3370-CHECK-DLX-INTERFACE             29040000
290500                     SET SU006-DLX-CHECK-DONE TO TRUE             29050000
290600                     PERFORM 3310-CALL-DLKUP001                   29060000
290700                 END-IF                                           29070000
291100             END-IF                                               29110000
291200         ELSE                                                     29120000
291300             IF  SU006-DLX-CHECK-DONE                             29130000
291400                 IF  SU006-DC-NOT-INTERFACED                      29140000
291500                     CONTINUE                                     29150000
291600                 ELSE                                             29160000
291700                     PERFORM 3310-CALL-DLKUP001                   29170000
292100                     IF  DL001-ASGMT-CLOSED-RETURN                29210000
292200                         PERFORM 3370-CHECK-DLX-INTERFACE         29220000
292300                         SET SU006-DLX-CHECK-DONE TO TRUE         29230000
292400                         PERFORM 3310-CALL-DLKUP001               29240000
292500                     END-IF                                       29250000
292900                 END-IF                                           29290000
293000             ELSE                                                 29300000
293100                 PERFORM 3370-CHECK-DLX-INTERFACE                 29310000
293200                 SET SU006-DLX-CHECK-DONE TO TRUE                 29320000
293300                 IF  SU006-DC-NOT-INTERFACED                      29330000
293400                     CONTINUE                                     29340000
293500                 ELSE                                             29350000
293600                     PERFORM 3310-CALL-DLKUP001                   29360000
294000                     IF  DL001-ASGMT-CLOSED-RETURN                29400000
294100                         PERFORM 3370-CHECK-DLX-INTERFACE         29410000
294200                         SET SU006-DLX-CHECK-DONE TO TRUE         29420000
294300                         PERFORM 3310-CALL-DLKUP001               29430000
294400                     END-IF                                       29440000
294800                 END-IF                                           29480000
294900             END-IF                                               29490000
295000         END-IF                                                   29500000
295100     ELSE                                                         29510000
295200         CONTINUE                                                 29520000
295300     END-IF.                                                      29530000
295400                                                                  29540000
295500*    UPDATE HOST VARIABLES WITH THE NEW CLOSED VALUES             29550000
295600     MOVE SU006-SHIP-UNIT-STATUS TO SUATRN-UNT-AUD-STAT-CDE.      29560000
295700                                                                  29570000
295800*    UPDATE INFORMATION                                           29580000
295900     EXEC SQL                                                     29590000
296000         UPDATE TSUATRN                                           29600000
296100            SET  UNT_AUD_STP_TMST    = CURRENT TIMESTAMP          29610000
296200               , UNT_AUD_STAT_CDE    = :SUATRN-UNT-AUD-STAT-CDE   29620000
296300               , UNT_AUD_ERR_IND     = :SUATRN-UNT-AUD-ERR-IND    29630000
296400         WHERE                                                    29640000
296500                AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             29650000
296600           AND  SHIPT_UNT_ID     = :DK-SHIP-UNIT-NBR              29660000
296700     END-EXEC.                                                    29670000
296800                                                                  29680000
296900     EVALUATE TRUE                                                29690000
297000         WHEN SQLCODE = ZERO                                      29700000
297100             CONTINUE                                             29710000
297200                                                                  29720000
297300         WHEN SQLWARN0 NOT = SPACES                               29730000
297400         WHEN SQLCODE < ZERO                                      29740000
297500         WHEN SQLCODE > ZERO                                      29750000
297600             MOVE '3300-CLOSE-SHIP-UNIT'                          29760000
297700                                   TO DP013-PARAGRAPH             29770000
297800             MOVE 'SELECT OF TSUATRN TABLE'                       29780000
297900                                   TO DP013-MESSAGE-TEXT (1)      29790000
298000             MOVE DK-AUDIT-CNTL-NBR                               29800000
298100                                   TO DK-AUDIT-CNTL-NBR-X         29810000
298200             MOVE DK-AUDIT-CNTL-NBR-X                             29820000
298300                                   TO DP013-MESSAGE-TEXT (2)      29830000
298400             MOVE SU006-SHIP-UNIT-NBR-X                           29840000
298500                                   TO DP013-MESSAGE-TEXT (3)      29850000
298600             MOVE SQLCA            TO DP013-SQLCA                 29860000
298700             MOVE 'TSUATRN'        TO DP013-DB2-TABLE-NAME (1)    29870000
298800             SET DP013-DB2-ABEND   TO TRUE                        29880000
299000             MOVE PV-SAVE-SHIP-UNIT-STATUS                        29900000
299100                                   TO SU006-SHIP-UNIT-STATUS      29910000
299200             PERFORM 9999-WRITE-CICS-LOG-MSG                      29920000
299300             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               29930000
299400             PERFORM 8100-SEND-DATA-ONLY                          29940000
299500             PERFORM 8200-RETURN-TRANID                           29950000
299600     END-EVALUATE.                                                29960000
299700                                                                  29970000
299800******************************************************************29980000
299900 3310-CALL-DLKUP001.                                              29990000
300000                                                                  30000000
300100     INITIALIZE DL001-ASGMT-COMMAREA.                             30010000
300200                                                                  30020000
300300     SET DL001-BY-ASGMT-KEY       TO TRUE.                        30030000
300400     SET DL001-COMMIT-UPDATE      TO TRUE.                        30040000
300500     SET DL001-FIND-NEXT-ASGMT    TO TRUE.                        30050000
300600                                                                  30060000
300700     MOVE SU006-ASGMT-STRT-DTE    TO DL001-KEY-START-DTE.         30070000
300800     MOVE SU006-ASGMT-NBR-TXT     TO DL001-KEY-NBR-TXT.           30080000
300900     MOVE SU006-ASGMT-NBR-SEQ-NBR TO DL001-KEY-NBR-SEQ-NBR.       30090000
301000                                                                  30100000
301100     MOVE 1                       TO DL001-NBR-OF-NBRS-NEED-QTY.  30110000
301200     MOVE PC-CURRENT-PROGRAM-NAME TO DL001-ORIG-CALLING-PGM-NM.   30120000
301300                                                                  30130000
301400     CALL DL001-USER-PGM USING DFHEIBLK                           30140000
301500                               DL001-COMMAREA                     30150000
301600                               DL001-ASGMT-COMMAREA.              30160000
301700                                                                  30170000
301800     IF DL001-SUCCESSFUL                                          30180000
301900*       **********************************************************30190000
302000*       *  ASSIGNMENT SENT IN HAS BEEN CLOSED, DLKUP001 HAS SENT *30200000
302100*       *  BACK CURRENT OPEN ASSIGNMENT.                         *30210000
302200*       *                                                        *30220000
302300*       **********************************************************30230000
302400        IF DL001-ASGMT-NEXT-USED                                  30240000
302500           MOVE DL001-NXT-START-DTE   TO SU006-ASGMT-STRT-DTE     30250000
302600           MOVE DL001-NXT-NBR-TXT     TO SU006-ASGMT-NBR-TXT      30260000
302700           MOVE DL001-NXT-NBR-SEQ-NBR TO SU006-ASGMT-NBR-SEQ-NBR  30270000
303000        END-IF                                                    30300000
303100                                                                  30310000
303200        PERFORM 3330-CALL-XLKUP033                                30320000
303300     ELSE                                                         30330000
303400        STRING PC-CURRENT-PROGRAM-NAME                            30340000
303500               ' - ERROR FROM DLKUP001 - '                        30350000
303600               DL001-RETURN-CODE                                  30360000
303700               ' - START DATE -  '                                30370000
303800               DL001-KEY-START-DTE                                30380000
303900               PV-BLANKS                                          30390000
304000               DELIMITED BY SIZE                                  30400000
304100               INTO PV-CICS-MSG-AREA2                             30410000
304200        PERFORM 999A-WRITE-CSSL-MSG                               30420000
304300                                                                  30430000
304400        STRING 'DL001-KEY-NBR-TXT -------> '                      30440000
304500               DL001-KEY-NBR-TXT                                  30450000
304600               PV-BLANKS                                          30460000
304700               DELIMITED BY SIZE                                  30470000
304800               INTO PV-CICS-MSG-AREA2                             30480000
304900        PERFORM 999A-WRITE-CSSL-MSG                               30490000
305000                                                                  30500000
305100        SET  DP013-OTHER-ABEND TO TRUE                            30510000
305200        SET  DP013-NO-ROLLBACK TO TRUE                            30520000
305300        MOVE '3310-CALL-DLKUP001'      TO DP013-PARAGRAPH         30530000
305400     END-IF.                                                      30540000
305500                                                                  30550000
305600******************************************************************30560000
305700 3330-CALL-XLKUP033.                                              30570000
305800                                                                  30580000
305900     INITIALIZE XL072-EAI-EXPORT-COMMAREA.                        30590000
306000                                                                  30600000
306100     SET XL072-SU-APP-ID          TO TRUE.                        30610000
306200                                                                  30620000
306300     MOVE PC-CARTON               TO XL072-EVNT-OBJ-TXT.          30630000
306400     MOVE PC-AUDIT                TO XL072-EVNT-OBJ-ACTN-TXT.     30640000
306500     MOVE SU006-USERID            TO XL072-CRE-BY-USR-ID.         30650000
306600     MOVE PC-CURRENT-PROGRAM-NAME TO XL072-CRE-PGM-NM.            30660000
306700     MOVE DK-SHIP-UNIT-NBR        TO XL072-EVNT-KY-1-NBR.         30670000
306800                                                                  30680000
306900     PERFORM 3700-SELECT-AUDIT.                                   30690000
307000                                                                  30700000
307100     IF PS-SYSTEM-AUDIT-FOUND                                     30710000
307200        MOVE SUT00015-INBND-TRIP-ID  TO XL072-EVNT-KY-2-NBR       30720000
307300     END-IF.                                                      30730000
307400                                                                  30740000
307500     MOVE DK-AUDIT-CNTL-NBR       TO XL072-EVNT-KY-3-NBR.         30750000
307600     SET XL072-DO-NOT-COMMIT-UPDATE TO TRUE.                      30760000
307700     MOVE PC-CURRENT-PROGRAM-NAME TO XL072-ORIG-CALLING-PGM-NM.   30770000
307800                                                                  30780000
307900     SET XL072-SUWS050-COPYBOOK   TO TRUE.                        30790000
308000                                                                  30800000
308100     INITIALIZE SU050-DTL-TXT-AREA.                               30810000
308200     SET SU050-CRTN-AUDIT         TO TRUE.                        30820000
308300     MOVE SU006-ASGMT-STRT-DTE    TO SU050-AD-ASGMT-STRT-DTE.     30830000
308400     MOVE SU006-ASGMT-NBR-TXT     TO SU050-AD-ASGMT-NBR-TXT.      30840000
308500     MOVE SU006-ASGMT-NBR-SEQ-NBR TO SU050-AD-ASGMT-NBR-SEQ-NBR.  30850000
308600     MOVE DL001-SEQ-START-NBR     TO SU050-AD-ASGMT-SEQ-DTL-NBR.  30860000
308700     MOVE SU006-DOOR-ID           TO SU050-AD-DOOR-NBR.           30870000
308800                                                                  30880000
308900     PERFORM 3340-SELECT-TSULBXF.                                 30890000
309000                                                                  30900000
309100     PERFORM 3360-SELECT-TSUAUPC.                                 30910000
309200                                                                  30920000
309300     MOVE SU050-DTL-TXT-AREA      TO XL072-DTL-TXT.               30930000
309400                                                                  30940000
309500     CALL XL072-USER-PGM USING DFHEIBLK                           30950000
309600                               XL072-COMMAREA                     30960000
309700                               XL072-EAI-EXPORT-COMMAREA.         30970000
309800                                                                  30980000
309900     IF XL072-SUCCESSFUL                                          30990000
310000        CONTINUE                                                  31000000
310100     ELSE                                                         31010000
310200        STRING PC-CURRENT-PROGRAM-NAME                            31020000
310300               ' - ERROR FROM XLKUP033 - '                        31030000
310400               XL072-RETURN-CODE                                  31040000
310500               ' - OBJECT TXT - '                                 31050000
310600               XL072-EVNT-OBJ-TXT                                 31060000
310700               ' - CRE USR - '                                    31070000
310800               XL072-CRE-BY-USR-ID                                31080000
310900               PV-BLANKS                                          31090000
311000               DELIMITED BY SIZE                                  31100000
311100               INTO PV-CICS-MSG-AREA2                             31110000
311200        PERFORM 999A-WRITE-CSSL-MSG                               31120000
311300                                                                  31130000
311400        STRING 'OBJECT ACTN TXT ---> '                            31140000
311500               XL072-EVNT-OBJ-ACTN-TXT                            31150000
311600               ' CRE PGM - '                                      31160000
311700               XL072-CRE-PGM-NM                                   31170000
311800               PV-BLANKS                                          31180000
311900               DELIMITED BY SIZE                                  31190000
312000               INTO PV-CICS-MSG-AREA2                             31200000
312100        PERFORM 999A-WRITE-CSSL-MSG                               31210000
312200                                                                  31220000
312300        SET  DP013-OTHER-ABEND TO TRUE                            31230000
312400        SET  DP013-NO-ROLLBACK TO TRUE                            31240000
312500        MOVE '3330-CALL-XLKUP033' TO DP013-PARAGRAPH              31250000
312600     END-IF.                                                      31260000
312700                                                                  31270000
312800******************************************************************31280000
312900 3340-SELECT-TSULBXF.                                             31290000
313000                                                                  31300000
313100     EXEC SQL                                                     31310000
313200         SELECT  SHIPT_UNT_ID                                     31320000
313300                ,CART_LBL_TYP_CDE                                 31330000
313400                ,DEST_OPER_UNT_ID                                 31340000
313500           INTO :SULBXF-SHIPT-UNT-ID                              31350000
313600               ,:SULBXF-CART-LBL-TYP-CDE                          31360000
313700               ,:SULBXF-DEST-OPER-UNT-ID                          31370000
313800           FROM TSULBXF                                           31380000
313900          WHERE SHIPT_UNT_ID = :DK-SHIP-UNIT-NBR                  31390000
314000            AND STAT_CDE     = :PC-A                              31400000
314100     END-EXEC.                                                    31410000
314200                                                                  31420000
314300     EVALUATE TRUE                                                31430000
314400         WHEN SQLCODE = ZERO OR                                   31440000
314500              SQLCODE = -811                                      31450000
314600              EVALUATE TRUE                                       31460000
314700                  WHEN SULBXF-CART-LBL-TYP-CDE = 'P'              31470000
314800                       SET SU050-AD-CRTN-TO-P2L TO TRUE           31480000
314900                       MOVE 0 TO SU050-AD-CRTN-DEST-LOC-NBR       31490000
315000                                                                  31500000
315100                  WHEN OTHER                                      31510000
315200                       SET SU050-AD-CRTN-TO-LOC TO TRUE           31520000
315300                       MOVE SULBXF-DEST-OPER-UNT-ID TO            31530000
315400                                   SU050-AD-CRTN-DEST-LOC-NBR     31540000
315500                                                                  31550000
315600              END-EVALUATE                                        31560000
315700                                                                  31570000
315800         WHEN SQLCODE = +100                                      31580000
315900              SET SU050-AD-CRTN-TO-NONE TO TRUE                   31590000
316000              MOVE 0 TO SU050-AD-CRTN-DEST-LOC-NBR                31600000
316100                                                                  31610000
316200         WHEN SQLWARN0 NOT = SPACES                               31620000
316300         WHEN SQLCODE < ZERO                                      31630000
316400         WHEN SQLCODE > ZERO                                      31640000
316500             MOVE '3340-SELECT-TSULBXF'                           31650000
316600                                   TO DP013-PARAGRAPH             31660000
316700             MOVE 'SELECT OF TSULBXF TABLE'                       31670000
316800                                   TO DP013-MESSAGE-TEXT (1)      31680000
316900             MOVE SQLCA            TO DP013-SQLCA                 31690000
317000             MOVE 'TSULBXF'        TO DP013-DB2-TABLE-NAME (1)    31700000
317100             SET DP013-DB2-ABEND   TO TRUE                        31710000
317200             PERFORM 9999-WRITE-CICS-LOG-MSG                      31720000
317300             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               31730000
317400             PERFORM 8100-SEND-DATA-ONLY                          31740000
317500             PERFORM 8200-RETURN-TRANID                           31750000
317600     END-EVALUATE.                                                31760000
317700                                                                  31770000
317800******************************************************************31780000
317900 3360-SELECT-TSUAUPC.                                             31790000
318000                                                                  31800000
318100     EXEC SQL                                                     31810000
318200          SELECT SUM(SCND_UNT_QTY)                                31820000
318300            INTO :PV-TOTAL-SCND-UNT-QTY                           31830000
318400            FROM TSUAUPC                                          31840000
318500           WHERE AUD_CNTL_NBR = :DK-AUDIT-CNTL-NBR                31850000
318600             AND SHIPT_UNT_ID = :DK-SHIP-UNIT-NBR                 31860000
318700             AND SCN_TYP_CDE  IN ('S', 'P', 'O')                  31870000
318800     END-EXEC.                                                    31880000
318900                                                                  31890000
319000     EVALUATE TRUE                                                31900000
319100         WHEN SQLCODE = ZERO                                      31910000
319200              MOVE PV-TOTAL-SCND-UNT-QTY TO SU050-AD-AUDIT-QTY    31920000
319300                                                                  31930000
319400         WHEN SQLCODE = +100                                      31940000
319500         WHEN SQLCODE = -305                                      31950000
319600              MOVE 0 TO SU050-AD-AUDIT-QTY                        31960000
319700                                                                  31970000
319800         WHEN SQLWARN0 NOT = SPACES                               31980000
319900         WHEN SQLCODE < ZERO                                      31990000
320000         WHEN SQLCODE > ZERO                                      32000000
320100             MOVE '3360-SELECT-TSUAUPC'                           32010000
320200                                   TO DP013-PARAGRAPH             32020000
320300             MOVE 'SELECT OF TSUAUPC TABLE'                       32030000
320400                                   TO DP013-MESSAGE-TEXT (1)      32040000
320500             MOVE SQLCA            TO DP013-SQLCA                 32050000
320600             MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME (1)    32060000
320700             SET DP013-DB2-ABEND   TO TRUE                        32070000
320800             PERFORM 9999-WRITE-CICS-LOG-MSG                      32080000
320900             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               32090000
321000             PERFORM 8100-SEND-DATA-ONLY                          32100000
321100             PERFORM 8200-RETURN-TRANID                           32110000
321200     END-EVALUATE.                                                32120000
321300                                                                  32130000
321400******************************************************************32140000
321500*  3370-CHECK-DLX-INTERFACE                                      *32150000
321600*  WE HAVE GOTTEN TO THE PARAGRAPCH BECAUSE THE ASSOCIATE IS     *32160000
321700*  DOING AN AUDIT THAT IS NOT INSTREAM AND THE PROGRAM NEEDS     *32170000
321800*  TO DETERMINE IF IT NEEDS TO INTERFACE DATA TO THE EAI         *32180000
321900*  BUSINESS EVENT TABLES FOR THE CLOSE OF THE CARTON AUDIT.      *32190000
322000*                                                                *32200000
322100*  THE FIRST CHECK TO BE DONE WILL BE TO CHECK THE PARM TABLE    *32210000
322200*  TO DETERMINE IF THE DC IS INTERFACING TO DLX LABOR.           *32220000
322300*                                                                *32230000
322400*  IF IT'S INTERFACING TO DLX LABOR, THE PROGRAM WILL THEN GO    *32240000
322500*  TO THE 3380-CHECK-FOR-ASSIGNMENT PARAGRAPH TO DETERMINE IF    *32250000
322600*  THE ASSOCIATE IS ALREADY ON AN ASSIGNMENT AND IF THAT         *32260000
322700*  ASSIGNMENT CAN BE USED FOR THE INTERFACE OF THE CARTON AUDIT  *32270000
322800*  DATA (DEPENDING ON THE WORK TYPE ASSOCIATED TO THE            *32280000
322900*  ASSIGNMENT).                                                  *32290000
323000******************************************************************32300000
323100 3370-CHECK-DLX-INTERFACE.                                        32310000
323200                                                                  32320000
323300     SET PS-DLX-NOT-LIVE-INTERFACE TO TRUE.                       32330000
323400     PERFORM 3375-CHECK-DLX-IND.                                  32340000
323500                                                                  32350000
323600     IF  PS-DLX-LIVE-INTERFACE                                    32360000
323700         PERFORM 3380-CHECK-FOR-ASSIGNMENT                        32370000
323800         IF  PS-CALLED-MODULE-NOT-OK                              32380000
323900             CONTINUE                                             32390000
324000         ELSE                                                     32400000
324100             IF  DL003-ASGMT-NOT-FOUND                            32410000
324200                 SET PS-CALLED-MODULE-NOT-OK TO TRUE              32420000
324300                 PERFORM 3390-CALL-DLKCS410                       32430000
324400                 IF  PS-CALLED-MODULE-NOT-OK                      32440000
324500                     SET DP013-LINK-RETURN                        32450000
324600                         DP013-CICS-ABEND                         32460000
324700                         DP013-ROLLBACK TO TRUE                   32470000
324800                     PERFORM DP014-0000-PROCESS-ABEND             32480000
324900                     MOVE PV-SAVE-SHIP-UNIT-STATUS                32490000
325000                                      TO SU006-SHIP-UNIT-STATUS   32500000
325100                     MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO       32510000
325200                     PERFORM 8100-SEND-DATA-ONLY                  32520000
325300                     PERFORM 8200-RETURN-TRANID                   32530000
325400                 ELSE                                             32540000
325500                     MOVE DL016-ESO-ASGMT-START-DTE TO            32550000
325600                          SU006-ASGMT-STRT-DTE                    32560000
325700                     MOVE DL016-ESO-ASGMT-NBR-TXT TO              32570000
325800                          SU006-ASGMT-NBR-TXT                     32580000
325900                     MOVE DL016-ESO-ASGMT-NBR-SEQ-NBR TO          32590000
326000                          SU006-ASGMT-NBR-SEQ-NBR                 32600000
326100                 END-IF                                           32610000
326200             ELSE                                                 32620000
326300                 IF  SU006-RECV-PRCS-AREA                         32630000
326400                     MOVE DL003-ASGMT-START-DTE TO                32640000
326500                          SU006-ASGMT-STRT-DTE                    32650000
326600                     MOVE DL003-ASGMT-NBR-TXT TO                  32660000
326700                          SU006-ASGMT-NBR-TXT                     32670000
326800                     MOVE DL003-ASGMT-NBR-SEQ-NBR TO              32680000
326900                          SU006-ASGMT-NBR-SEQ-NBR                 32690000
327000                 ELSE                                             32700000
327100                     MOVE DL003-ASGMT-WK-AREA-DESC TO             32710000
327200                          DL011-FLAT-FQA-WRK-AREA                 32720000
327300                     IF  DL011-FQ-WRK-AREA-1-3 = 'FQA'            32730000
327400                         MOVE DL003-ASGMT-START-DTE TO            32740000
327500                              SU006-ASGMT-STRT-DTE                32750000
327600                         MOVE DL003-ASGMT-NBR-TXT TO              32760000
327700                              SU006-ASGMT-NBR-TXT                 32770000
327800                         MOVE DL003-ASGMT-NBR-SEQ-NBR TO          32780000
327900                              SU006-ASGMT-NBR-SEQ-NBR             32790000
328000                     ELSE                                         32800000
328100                         SET PS-CALLED-MODULE-NOT-OK TO TRUE      32810000
328200                         PERFORM 3390-CALL-DLKCS410               32820000
328300                         IF  PS-CALLED-MODULE-NOT-OK              32830000
328400                             SET DP013-LINK-RETURN                32840000
328500                                 DP013-CICS-ABEND                 32850000
328600                                 DP013-ROLLBACK TO TRUE           32860000
328700                             PERFORM DP014-0000-PROCESS-ABEND     32870000
328800                             MOVE PV-SAVE-SHIP-UNIT-STATUS TO     32880000
328900                                  SU006-SHIP-UNIT-STATUS          32890000
329000                             MOVE PM-DB2-FATAL-ERROR-MSG TO       32900000
329100                                  AMSGLNO                         32910000
329200                             PERFORM 8100-SEND-DATA-ONLY          32920000
329300                             PERFORM 8200-RETURN-TRANID           32930000
329400                         ELSE                                     32940000
329500                             MOVE DL016-ESO-ASGMT-START-DTE TO    32950000
329600                                  SU006-ASGMT-STRT-DTE            32960000
329700                             MOVE DL016-ESO-ASGMT-NBR-TXT TO      32970000
329800                                  SU006-ASGMT-NBR-TXT             32980000
329900                             MOVE DL016-ESO-ASGMT-NBR-SEQ-NBR TO  32990000
330000                                  SU006-ASGMT-NBR-SEQ-NBR         33000000
330100                         END-IF                                   33010000
330200                     END-IF                                       33020000
330300                 END-IF                                           33030000
330400             END-IF                                               33040000
330500         END-IF                                                   33050000
330600     END-IF.                                                      33060000
330700                                                                  33070000
330800******************************************************************33080000
330900 3375-CHECK-DLX-IND.                                              33090000
331000                                                                  33100000
331100     MOVE SU006-OPER-UNT-ID        TO DK-LOC-ID.                  33110000
331200                                                                  33120000
331300     EXEC SQL                                                     33130000
331400          SELECT  FUNC_TXT                                        33140000
331500            INTO :KRPRPM-FUNC-TXT                                 33150000
331600            FROM  TKRPRPM                                         33160000
331700           WHERE  LOC_ID            = :DK-LOC-ID                  33170000
331800             AND  INTFC_SYS_CDE     = 'DLX'                       33180000
331900             AND  SYS_PRC_FUNC_CDE  = 'DLLBIN'                    33190000
332000     END-EXEC.                                                    33200000
332100                                                                  33210000
332200     EVALUATE SQLCODE                                             33220000
332300         WHEN ZERO                                                33230000
332400              IF  KRPRPM-FUNC-TXT  = 'Y'                          33240000
332500                  SET PS-DLX-LIVE-INTERFACE TO TRUE               33250000
332600              END-IF                                              33260000
332700         WHEN OTHER                                               33270000
332800              MOVE '3375-CHECK-DLX-IND'                           33280000
332900                               TO DP013-PARAGRAPH                 33290000
333000              MOVE 'DLX INTERFACE INDICATOR'                      33300000
333100                               TO DP013-MESSAGE-TEXT (1)          33310000
333200              MOVE SQLCA       TO DP013-SQLCA                     33320000
333300              SET DP013-DB2-ABEND                                 33330000
333400                               TO TRUE                            33340000
333500              PERFORM DP014-0000-PROCESS-ABEND                    33350000
333600     END-EVALUATE.                                                33360000
333700                                                                  33370000
333800******************************************************************33380000
333900 3380-CHECK-FOR-ASSIGNMENT.                                       33390000
334000                                                                  33400000
334100     SET PS-CALLED-MODULE-NOT-OK TO TRUE.                         33410000
334200     PERFORM 3385-CALL-DLKUT001.                                  33420000
334300                                                                  33430000
334400     IF  PS-CALLED-MODULE-NOT-OK                                  33440000
334500         SET DP013-LINK-RETURN                                    33450000
334600             DP013-CICS-ABEND                                     33460000
334700             DP013-ROLLBACK TO TRUE                               33470000
334800         PERFORM DP014-0000-PROCESS-ABEND                         33480000
334900         MOVE PV-SAVE-SHIP-UNIT-STATUS                            33490000
335000                          TO SU006-SHIP-UNIT-STATUS               33500000
335100         MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO                   33510000
335200         PERFORM 8100-SEND-DATA-ONLY                              33520000
335300         PERFORM 8200-RETURN-TRANID                               33530000
335400     END-IF.                                                      33540000
335500                                                                  33550000
335600******************************************************************33560000
335700 3385-CALL-DLKUT001.                                              33570000
335800                                                                  33580000
335900     INITIALIZE DL003-ASGMT-COMMAREA.                             33590000
336000     SET DL003-BY-USER-KEY    TO  TRUE.                           33600000
336100     MOVE SU006-USERID        TO DL003-KEY-USER-ID.               33610000
336200     MOVE PC-CURRENT-PROGRAM-NAME                                 33620000
336300                              TO DL003-ORIG-CALLING-PGM-NM.       33630000
336400                                                                  33640000
336500     CALL DL003-USER-PGM USING DFHEIBLK                           33650000
336600                               DL003-COMMAREA                     33660000
336700                               DL003-ASGMT-COMMAREA.              33670000
336800                                                                  33680000
336900     EVALUATE TRUE                                                33690000
337000         WHEN DL003-SUCCESSFUL                                    33700000
337100             EVALUATE TRUE                                        33710000
337200                 WHEN DL003-ASGMT-FOUND                           33720000
337300                 WHEN DL003-ASGMT-NOT-FOUND                       33730000
337400                      SET PS-CALLED-MODULE-OK TO TRUE             33740000
337500                                                                  33750000
337600                 WHEN DL003-ASGMT-MULT-FOUND                      33760000
337700                      SET PS-CALLED-MODULE-NOT-OK TO TRUE         33770000
337800                      MOVE SU006-OPER-UNT-ID TO PV-DISPLAY-OPER   33780000
337900                      MOVE DL003-ASGMT-FOUND-QTY TO               33790000
338000                           PV-DISPLAY-NUMBER                      33800000
338100                      INITIALIZE PV-CICS-MSG-AREA2                33810000
338200                      STRING ' SUKRF515-3385- '                   33820000
338300                              PV-DISPLAY-OPER   '-'               33830000
338400                             ' AUDIT NUMBER IS - '                33840000
338500                             SU006-AUDIT-CNTL-NBR                 33850000
338600                              ' MULTIPLE ASSIGNMENTS FOR - '      33860000
338700                              SU006-USERID                        33870000
338800                              ' FOUND - '                         33880000
338900                              PV-DISPLAY-NUMBER                   33890000
339000                              ' ASSIGNMENTS'                      33900000
339100                                                DELIMITED BY SIZE 33910000
339200                                           INTO PV-CICS-MSG-AREA2 33920000
339300                      PERFORM 999A-WRITE-CSSL-MSG                 33930000
339400             END-EVALUATE                                         33940000
339500                                                                  33950000
339600         WHEN DL003-SQL-CONTENTION                                33960000
339700              SET PS-CALLED-MODULE-NOT-OK TO TRUE                 33970000
339800              MOVE DL003-ASGMT-SQLCODE TO                         33980000
339900                   PV-DISPLAY-SQLCODE                             33990000
340000              MOVE SU006-OPER-UNT-ID TO PV-DISPLAY-OPER           34000000
340100              INITIALIZE PV-CICS-MSG-AREA2                        34010000
340200              STRING ' SUKRF515-3385- '                           34020000
340300                      PV-DISPLAY-OPER   '-'                       34030000
340400                     ' AUDIT NUMBER IS - '                        34040000
340500                     SU006-AUDIT-CNTL-NBR                         34050000
340600                      ' DLKUT001 SQL CONTENTION FOR USER ID-'     34060000
340700                      SU006-USERID                                34070000
340800                      ' SQLCODE=' PV-DISPLAY-SQLCODE              34080000
340900                                        DELIMITED BY SIZE         34090000
341000                                   INTO PV-CICS-MSG-AREA2         34100000
341100              PERFORM 999A-WRITE-CSSL-MSG                         34110000
341200                                                                  34120000
341300               INITIALIZE PV-CICS-MSG-AREA2                       34130000
341400               STRING ' SUKRF515-' DL003-USER-PGM                 34140000
341500                      ' -- ' DL003-SQL-ERROR-PARA                 34150000
341600                      ' -- ' DL003-CALL-MOD-FAIL-NM               34160000
341700                      ' -- ' DL003-CALL-MOD-FAIL-ERR-CDE          34170000
341800                                                DELIMITED BY SIZE 34180000
341900                                           INTO PV-CICS-MSG-AREA2 34190000
342000              PERFORM 999A-WRITE-CSSL-MSG                         34200000
342100                                                                  34210000
342200         WHEN DL003-SQL-ERROR                                     34220000
342300              SET PS-CALLED-MODULE-NOT-OK TO TRUE                 34230000
342400              MOVE DL003-ASGMT-SQLCODE TO                         34240000
342500                   PV-DISPLAY-SQLCODE                             34250000
342600              MOVE SU006-OPER-UNT-ID TO PV-DISPLAY-OPER           34260000
342700              INITIALIZE PV-CICS-MSG-AREA2                        34270000
342800              STRING ' SUKRF515-3385- '                           34280000
342900                      PV-DISPLAY-OPER   '-'                       34290000
343000                     ' AUDIT NUMBER IS - '                        34300000
343100                     SU006-AUDIT-CNTL-NBR                         34310000
343200                      ' DLKUT001 SQL ERROR FOR USER ID-'          34320000
343300                      SU006-USERID                                34330000
343400                      ' SQLCODE=' PV-DISPLAY-SQLCODE              34340000
343500                                        DELIMITED BY SIZE         34350000
343600                                   INTO PV-CICS-MSG-AREA2         34360000
343700              PERFORM 999A-WRITE-CSSL-MSG                         34370000
343800                                                                  34380000
343900               INITIALIZE PV-CICS-MSG-AREA2                       34390000
344000               STRING ' SUKRF515-' DL003-USER-PGM                 34400000
344100                      ' -- ' DL003-SQL-ERROR-PARA                 34410000
344200                      ' -- ' DL003-CALL-MOD-FAIL-NM               34420000
344300                      ' -- ' DL003-CALL-MOD-FAIL-ERR-CDE          34430000
344400                                                DELIMITED BY SIZE 34440000
344500                                           INTO PV-CICS-MSG-AREA2 34450000
344600              PERFORM 999A-WRITE-CSSL-MSG                         34460000
344700                                                                  34470000
344800         WHEN DL003-CALLED-MODULE-FAILURE                         34480000
344900              SET PS-CALLED-MODULE-NOT-OK TO TRUE                 34490000
345000              MOVE DL003-ASGMT-SQLCODE TO                         34500000
345100                   PV-DISPLAY-SQLCODE                             34510000
345200              MOVE SU006-OPER-UNT-ID TO PV-DISPLAY-OPER           34520000
345300              INITIALIZE PV-CICS-MSG-AREA2                        34530000
345400              STRING ' SUKRF515-3385- '                           34540000
345500                      PV-DISPLAY-OPER   '-'                       34550000
345600                     ' AUDIT NUMBER IS - '                        34560000
345700                     SU006-AUDIT-CNTL-NBR                         34570000
345800                      ' DLKUT001 CALLED MODULE FAILURE FOR '      34580000
345900                      'USER ID - '                                34590000
346000                      SU006-USERID                                34600000
346100                      ' SQLCODE=' PV-DISPLAY-SQLCODE              34610000
346200                                        DELIMITED BY SIZE         34620000
346300                                   INTO PV-CICS-MSG-AREA2         34630000
346400              PERFORM 999A-WRITE-CSSL-MSG                         34640000
346500                                                                  34650000
346600               INITIALIZE PV-CICS-MSG-AREA2                       34660000
346700               STRING ' SUKRF515-' DL003-USER-PGM                 34670000
346800                      ' -- ' DL003-SQL-ERROR-PARA                 34680000
346900                      ' -- ' DL003-CALL-MOD-FAIL-NM               34690000
347000                      ' -- ' DL003-CALL-MOD-FAIL-ERR-CDE          34700000
347100                                                DELIMITED BY SIZE 34710000
347200                                           INTO PV-CICS-MSG-AREA2 34720000
347300              PERFORM 999A-WRITE-CSSL-MSG                         34730000
347400                                                                  34740000
347500         WHEN DL003-INVALID-ACCESS                                34750000
347600              SET PS-CALLED-MODULE-NOT-OK TO TRUE                 34760000
347700              MOVE DL003-ASGMT-SQLCODE TO                         34770000
347800                   PV-DISPLAY-SQLCODE                             34780000
347900              MOVE SU006-OPER-UNT-ID TO PV-DISPLAY-OPER           34790000
348000              INITIALIZE PV-CICS-MSG-AREA2                        34800000
348100              STRING ' SUKRF515-3385- '                           34810000
348200                      PV-DISPLAY-OPER   '-'                       34820000
348300                     ' AUDIT NUMBER IS - '                        34830000
348400                     SU006-AUDIT-CNTL-NBR                         34840000
348500                      ' DLKUT001 INVALID ACCESS FAILURE FOR '     34850000
348600                      'USER ID - '                                34860000
348700                      SU006-USERID                                34870000
348800                      ' SQLCODE=' PV-DISPLAY-SQLCODE              34880000
348900                                        DELIMITED BY SIZE         34890000
349000                                   INTO PV-CICS-MSG-AREA2         34900000
349100              PERFORM 999A-WRITE-CSSL-MSG                         34910000
349200                                                                  34920000
349300               INITIALIZE PV-CICS-MSG-AREA2                       34930000
349400               STRING ' SUKRF515-' DL003-USER-PGM                 34940000
349500                      ' -- ' DL003-SQL-ERROR-PARA                 34950000
349600                      ' -- ' DL003-CALL-MOD-FAIL-NM               34960000
349700                      ' -- ' DL003-CALL-MOD-FAIL-ERR-CDE          34970000
349800                                                DELIMITED BY SIZE 34980000
349900                                           INTO PV-CICS-MSG-AREA2 34990000
350000              PERFORM 999A-WRITE-CSSL-MSG                         35000000
350100                                                                  35010000
350200         WHEN OTHER                                               35020000
350300              SET PS-CALLED-MODULE-NOT-OK TO TRUE                 35030000
350400              MOVE DL003-ASGMT-SQLCODE TO                         35040000
350500                   PV-DISPLAY-SQLCODE                             35050000
350600              MOVE SU006-OPER-UNT-ID TO PV-DISPLAY-OPER           35060000
350700              INITIALIZE PV-CICS-MSG-AREA2                        35070000
350800              STRING ' SUKRF515-3385- '                           35080000
350900                      PV-DISPLAY-OPER   '-'                       35090000
351000                     ' AUDIT NUMBER IS - '                        35100000
351100                     SU006-AUDIT-CNTL-NBR                         35110000
351200                      ' DLKUT001 OTHER TYPE FAILURE FOR '         35120000
351300                      'USER ID - '                                35130000
351400                      SU006-USERID                                35140000
351500                      ' SQLCODE=' PV-DISPLAY-SQLCODE              35150000
351600                                        DELIMITED BY SIZE         35160000
351700                                   INTO PV-CICS-MSG-AREA2         35170000
351800              PERFORM 999A-WRITE-CSSL-MSG                         35180000
351900                                                                  35190000
352000               INITIALIZE PV-CICS-MSG-AREA2                       35200000
352100               STRING ' SUKRF515-' DL003-USER-PGM                 35210000
352200                      ' -- ' DL003-SQL-ERROR-PARA                 35220000
352300                      ' -- ' DL003-CALL-MOD-FAIL-NM               35230000
352400                      ' -- ' DL003-CALL-MOD-FAIL-ERR-CDE          35240000
352500                                                DELIMITED BY SIZE 35250000
352600                                           INTO PV-CICS-MSG-AREA2 35260000
352700              PERFORM 999A-WRITE-CSSL-MSG                         35270000
352800                                                                  35280000
352900     END-EVALUATE.                                                35290000
353000                                                                  35300000
353100******************************************************************35310000
353200 3390-CALL-DLKCS410.                                              35320000
353300                                                                  35330000
353400     INITIALIZE DL016-PGM-COMMAREA.                               35340000
353500     SET DL016-ESTABLISH-ASGMT    TO TRUE.                        35350000
353600     SET DL016-SUCCESSFUL         TO TRUE.                        35360000
353700     SET DL016-COMMIT-UPDATE      TO TRUE.                        35370000
353800     MOVE PC-CURRENT-PROGRAM-NAME TO DL016-CALLING-PGM-NM.        35380000
353900     MOVE SPACES                  TO DL011-FLAT-FQA-WRK-AREA.     35390000
354000     MOVE 'FQA'                   TO DL011-FQ-WRK-AREA-1-3.       35400000
354100     MOVE SU006-USERID TO DL016-SIGN-ON-USR-ID                    35410000
354200                          DL016-EAI-CRE-BY-USR-ID                 35420000
354300                          DL011-FQ-WRK-AREA-USER-ID.              35430000
354400     SET DL016-EAI-USR-IS-UNKNOWN TO TRUE.                        35440000
354500     MOVE SU006-OPER-UNT-ID TO DL016-EAI-DC-NBR.                  35450000
354600     IF  SU006-RECV-PRCS-AREA                                     35460000
354700         SET DL011-AN-RECV-WRK-TYP TO TRUE                        35470000
354800         MOVE DL011-KEY-ASGMT-NBR-WRK-TYP TO                      35480000
354900              DL016-ASGMT-NBR-WRK-TYP                             35490000
355000         SET DL011-RECV-WRK-TYP TO TRUE                           35500000
355100         MOVE DL011-KEY-WK-TYP TO DL016-EAI-WK-TYP-DESC           35510000
355200     ELSE                                                         35520000
355300         SET DL011-AN-FLAT-WRK-TYP TO TRUE                        35530000
355400         MOVE DL011-KEY-ASGMT-NBR-WRK-TYP TO                      35540000
355500              DL016-ASGMT-NBR-WRK-TYP                             35550000
355600         SET DL011-FLAT-WRK-TYP TO TRUE                           35560000
355700         MOVE DL011-KEY-WK-TYP TO DL016-EAI-WK-TYP-DESC           35570000
355800     END-IF.                                                      35580000
355900     MOVE DL011-FLAT-FQA-WRK-AREA TO                              35590000
356000          DL016-EAI-WK-AREA-DESC.                                 35600000
356100                                                                  35610000
356200*    CALL DL016-USER-PGM USING DFHEIBLK                           35620000
356300*                              DL016-COMMAREA                     35630000
356400*                              DL016-PGM-COMMAREA.                35640000
356500                                                                  35650000
356600     MOVE LENGTH OF DL016-PGM-COMMAREA                            35660000
356700                                      TO PV-COMMAREA-LENGTH.      35670000
356800                                                                  35680000
356900     EXEC CICS LINK                                               35690000
357000         PROGRAM  (DL016-USER-PGM)                                35700000
357100         COMMAREA (DL016-PGM-COMMAREA)                            35710000
357200         LENGTH   (PV-COMMAREA-LENGTH)                            35720000
357300         RESP     (PV-CICS-RESPONSE)                              35730000
357400     END-EXEC.                                                    35740000
357500                                                                  35750000
357600     IF  PV-CICS-RESPONSE = DFHRESP (NORMAL)                      35760000
357700                                                                  35770000
357800     EVALUATE TRUE                                                35780000
357900         WHEN DL016-SUCCESSFUL                                    35790000
358000              SET PS-CALLED-MODULE-OK TO TRUE                     35800000
358100                                                                  35810000
358200         WHEN DL016-SQL-ERROR                                     35820000
358300              SET PS-CALLED-MODULE-NOT-OK TO TRUE                 35830000
358400              MOVE DL016-ASGMT-SQLCODE TO                         35840000
358500                   PV-DISPLAY-SQLCODE                             35850000
358600              MOVE SU006-OPER-UNT-ID TO PV-DISPLAY-OPER           35860000
358700              INITIALIZE PV-CICS-MSG-AREA2                        35870000
358800              STRING ' SUKRF515-3390- '                           35880000
358900                      PV-DISPLAY-OPER   '-'                       35890000
359000                     ' AUDIT NUMBER IS - '                        35900000
359100                     SU006-AUDIT-CNTL-NBR                         35910000
359200                      ' DLKCS410 SQL ERROR FOR USER ID-'          35920000
359300                      SU006-USERID                                35930000
359400                      ' SQLCODE=' PV-DISPLAY-SQLCODE              35940000
359500                                        DELIMITED BY SIZE         35950000
359600                                   INTO PV-CICS-MSG-AREA2         35960000
359700              PERFORM 999A-WRITE-CSSL-MSG                         35970000
359800                                                                  35980000
359900               INITIALIZE PV-CICS-MSG-AREA2                       35990000
360000               STRING ' SUKRF515-' DL016-USER-PGM                 36000000
360100                      ' -- ' DL016-CALL-MOD-FAIL-SQL-PARA         36010000
360200                      ' -- ' DL016-CALL-MOD-FAIL-NM               36020000
360300                      ' -- ' DL016-CALL-MOD-FAIL-ERR-CDE          36030000
360400                                                DELIMITED BY SIZE 36040000
360500                                           INTO PV-CICS-MSG-AREA2 36050000
360600              PERFORM 999A-WRITE-CSSL-MSG                         36060000
360700                                                                  36070000
360800         WHEN DL016-CALLED-MODULE-FAILURE                         36080000
360900              SET PS-CALLED-MODULE-NOT-OK TO TRUE                 36090000
361000              MOVE DL016-CALL-MOD-FAIL-SQL-CDE TO                 36100000
361100                   PV-DISPLAY-SQLCODE                             36110000
361200              MOVE SU006-OPER-UNT-ID TO PV-DISPLAY-OPER           36120000
361300              INITIALIZE PV-CICS-MSG-AREA2                        36130000
361400              STRING ' SUKRF515-3390- '                           36140000
361500                      PV-DISPLAY-OPER   '-'                       36150000
361600                     ' AUDIT NUMBER IS - '                        36160000
361700                     SU006-AUDIT-CNTL-NBR                         36170000
361800                      ' DLKCS410 CALLED MODULE FAILURE FOR '      36180000
361900                      'USER ID - '                                36190000
362000                      SU006-USERID                                36200000
362100                                        DELIMITED BY SIZE         36210000
362200                                   INTO PV-CICS-MSG-AREA2         36220000
362300              PERFORM 999A-WRITE-CSSL-MSG                         36230000
362400                                                                  36240000
362500               INITIALIZE PV-CICS-MSG-AREA2                       36250000
362600               STRING ' SUKRF515-' DL016-USER-PGM                 36260000
362700                      ' -- ' DL016-CALL-MOD-FAIL-SQL-PARA         36270000
362800                      ' -- ' DL016-CALL-MOD-FAIL-NM               36280000
362900                      ' -- ' DL016-CALL-MOD-FAIL-ERR-CDE          36290000
363000                      ' -- ' PV-DISPLAY-SQLCODE                   36300000
363100                                                DELIMITED BY SIZE 36310000
363200                                           INTO PV-CICS-MSG-AREA2 36320000
363300              PERFORM 999A-WRITE-CSSL-MSG                         36330000
363400                                                                  36340000
363500         WHEN DL016-INVALID-ACCESS                                36350000
363600              SET PS-CALLED-MODULE-NOT-OK TO TRUE                 36360000
363700              MOVE SU006-OPER-UNT-ID TO PV-DISPLAY-OPER           36370000
363800              INITIALIZE PV-CICS-MSG-AREA2                        36380000
363900              STRING ' SUKRF515-3390- '                           36390000
364000                      PV-DISPLAY-OPER   '-'                       36400000
364100                     ' AUDIT NUMBER IS - '                        36410000
364200                     SU006-AUDIT-CNTL-NBR                         36420000
364300                      ' DLKCS410 INVALID ACCESS FAILURE FOR '     36430000
364400                      'USER ID - '                                36440000
364500                      SU006-USERID                                36450000
364600                                        DELIMITED BY SIZE         36460000
364700                                   INTO PV-CICS-MSG-AREA2         36470000
364800              PERFORM 999A-WRITE-CSSL-MSG                         36480000
364900                                                                  36490000
365000               INITIALIZE PV-CICS-MSG-AREA2                       36500000
365100               STRING ' SUKRF515-' DL016-USER-PGM                 36510000
365200                      ' -- ' DL016-CALL-MOD-FAIL-SQL-PARA         36520000
365300                      ' -- ' DL016-CALL-MOD-FAIL-NM               36530000
365400                      ' -- ' DL016-CALL-MOD-FAIL-ERR-CDE          36540000
365500                                                DELIMITED BY SIZE 36550000
365600                                           INTO PV-CICS-MSG-AREA2 36560000
365700              PERFORM 999A-WRITE-CSSL-MSG                         36570000
365800                                                                  36580000
365900         WHEN OTHER                                               36590000
366000              SET PS-CALLED-MODULE-NOT-OK TO TRUE                 36600000
366100              MOVE SU006-OPER-UNT-ID TO PV-DISPLAY-OPER           36610000
366200              INITIALIZE PV-CICS-MSG-AREA2                        36620000
366300              STRING ' SUKRF515-3390- '                           36630000
366400                      PV-DISPLAY-OPER   '-'                       36640000
366500                     ' AUDIT NUMBER IS - '                        36650000
366600                     SU006-AUDIT-CNTL-NBR                         36660000
366700                      ' DLKCS410 OTHER TYPE FAILURE FOR '         36670000
366800                      'USER ID - '                                36680000
366900                      SU006-USERID                                36690000
367000                      ' RETURN CODE - ' DL016-RETURN-CODE         36700000
367100                                        DELIMITED BY SIZE         36710000
367200                                   INTO PV-CICS-MSG-AREA2         36720000
367300              PERFORM 999A-WRITE-CSSL-MSG                         36730000
367400                                                                  36740000
367500               INITIALIZE PV-CICS-MSG-AREA2                       36750000
367600               STRING ' SUKRF515-' DL016-USER-PGM                 36760000
367700                      ' DL016 EAI FIELDS '                        36770000
367800                      ' -- ' DL016-EAI-WK-TYP-DESC                36780000
367900                      ' -- ' DL016-EAI-WK-AREA-DESC               36790000
368000                      ' -- ' PV-DISPLAY-OPER                      36800000
368100                      ' -- ' DL016-EAI-CRE-BY-USR-ID              36810000
368200                      ' -- ' DL016-EAI-USR-TYP-CDE                36820000
368300                                                DELIMITED BY SIZE 36830000
368400                                           INTO PV-CICS-MSG-AREA2 36840000
368500              PERFORM 999A-WRITE-CSSL-MSG                         36850000
368600                                                                  36860000
368700     END-EVALUATE                                                 36870000
368800     ELSE                                                         36880000
368900         MOVE '3390-CALL-DLKCS410'                                36890000
369000                              TO DP013-PARAGRAPH                  36900000
369100         MOVE PV-CICS-RESPONSE                                    36910000
369200                              TO DP013-MESSAGE-TEXT(1)            36920000
369300         SET DP013-LINK-RETURN                                    36930000
369400             DP013-CICS-ABEND                                     36940000
369500             DP013-ROLLBACK TO TRUE                               36950000
369600         PERFORM DP014-0000-PROCESS-ABEND                         36960000
369700         MOVE PV-SAVE-SHIP-UNIT-STATUS                            36970000
369800                              TO SU006-SHIP-UNIT-STATUS           36980000
369900         MOVE PC-POSTPONE-TRY-AGAIN-MSG TO  AMSGLNO               36990000
370000         PERFORM 8100-SEND-DATA-ONLY                              37000000
370100         PERFORM 8200-RETURN-TRANID                               37010000
370200     END-IF.                                                      37020000
370300                                                                  37030000
370400******************************************************************37040000
370500*  3400-RESTART-SHIP-UNIT                                        *37050000
370600*  THE USER WANTS TO RE-START THE AUDIT OF A SHIPPING UNIT:      *37060000
370700*           1) DELETE THE AUDIT CONTENT OF THE SHIPPING UNIT     *37070000
370800*           2) GET THE NUMBER OF MINUTES SINCE IT WAS OPENED     *37080000
370900*              (THIS WILL BE ADDED TO THE RESTART MINUTE QTY)    *37090000
371000*           3) CHECK IF THERE ARE ANY CARTON LEVEL EXCEPTIONS... *37100000
371100*           4) UPDATE THE RESTART MINUTES WITH THE MINUTES CALC. *37110000
371200*              IN STEP #2, THE STAUS CODE TO "IP" AND THE ERROR  *37120000
371300*              CODE TO 'Y' IF CARTON LEVEL ERRORS EXISTS, OR 'N' *37130000
371400*              IF NO CARTON LEVEL ERRORS EXIST.                  *37140000
371500******************************************************************37150000
371600 3400-RESTART-SHIP-UNIT.                                          37160000
371700                                                                  37170000
371800*    IF THIS IS THE FIRST AUDIT PROCESSED IT SHOULD BE A QC AUDIT 37180000
371900*    AND WE WANT TO PROCESS USING THE QC AUDIT NUMBER.  IF THIS IS37190000
372000*    AN RFID ONLY AUDIT, THEN THE RFID AUDIT NUMBER WILL BE       37200000
372100*    CONTAINED IN THIS FIELD AND WE WANT TO USE IT.  IF NEITHER,  37210000
372200*    THEN IT'S A COMBINED AUDIT AND THE RFID AUDIT SHOULD PROCESS 37220000
372300*    SECOND IN THIS SCENARIO.                                     37230000
372310                                                                  37231044
372400     IF PS-PRCS-FIRST-AUDIT                                       37240000
372500     OR SU006-RFID-AUD-ONLY                                       37250000
372600     OR SU006-MANUAL-GENERATED-AUDIT                              37260000
372700         MOVE SU006-AUDIT-CNTL-NBR   TO DK-AUDIT-CNTL-NBR         37270000
372800     ELSE                                                         37280000
372900         MOVE SU006-RFID-AUDIT-CNTL-NBR                           37290000
373000                                     TO DK-AUDIT-CNTL-NBR         37300000
373100     END-IF.                                                      37310000
373200                                                                  37320044
373300     MOVE SU006-SHIP-UNIT-NBR        TO DK-SHIP-UNIT-NBR.         37330000
373400                                                                  37340000
373500*    DELETE OLD SHIP UNIT AUDIT DETAIL                            37350000
373600     PERFORM 3410-DELETE-SHIP-UNIT-DETAIL.                        37360000
373700                                                                  37370000
373800*    GET THE NUMBER OF MINUTES SINCE THE CARTON WAS OPENED...     37380000
373900     PERFORM 3001-GET-OPENED-MINUTES.                             37390000
374000                                                                  37400000
374100*    CHECK IF THERE ARE ANY CARTON LEVEL EXCEPTIONS...            37410000
374200     PERFORM 3430-CHECK-CARTON-EXCEPTIONS.                        37420000
374300                                                                  37430000
374400*    UPDATE HOST VARIABLES WITH RESTART INFORMATION...            37440000
374500*    THE TOTAL MINUTES THE CARTON HAS BEEN OPEN (THE MINUTES      37450000
374600*    FROM THE START TIMESTAMP TO THE CURRENT TIMESTAMP LESS       37460000
374700*    ANY MINUTES THE CARTON WAS CLOSED OR POSTPONED) WILL BE      37470000
374800*    ADDED TO ANY CURRENT RESTART MINUTES (IF IT HAD BEEN         37480000
374900*    PREVIOUSLY RESTARTED).  THE START TIMESTAMP WILL BE UPDATED  37490000
375000*    TO THE CURRENT TIMESTAMP, THE STOP TIMESTAMP WILL BE UPDATED 37500000
375100*    TO "NINES", THE POSTPONED AND CLOSED MINUTE BUCKETS WILL BE  37510000
375200*    INITIALIZED (ANY TIME IN THERE IS TAKEN INTO ACCOUNT IN THE  37520000
375300*    CALCULATION OF THE RESTART MINUTES), THE STATUS IS UPDATED   37530000
375400*    TO INPROCESS, AND THE AUDIT ERROR INDICATOR IS SET TO 'Y'    37540000
375500*    ONLY IF CARTON LEVEL EXCEPTIONS EXIST.                       37550000
375510                                                                  37551044
375600     ADD  PV-TOTAL-OPENED-MINUTES  TO SUATRN-UNT-RSTRT-MNIT-QTY.  37560000
375700     MOVE '9999-09-09-09.09.09.999999'                            37570000
375800                                  TO SUATRN-UNT-AUD-STP-TMST.     37580000
375900     MOVE PV-CURRENT-TIMESTAMP    TO SUATRN-UNT-AUD-STRT-TMST.    37590000
376000     INITIALIZE  SUATRN-UNT-PSPND-MNIT-QTY                        37600000
376100                 SUATRN-UNT-CLO-MNIT-QTY.                         37610000
376200     MOVE SU006-SHIP-UNIT-STATUS TO PV-SAVE-SHIP-UNIT-STATUS.     37620000
376300     SET SU006-SHIP-UNIT-INPROCESS TO TRUE.                       37630000
376400     MOVE SU006-SHIP-UNIT-STATUS  TO SUATRN-UNT-AUD-STAT-CDE.     37640000
376500                                                                  37650000
376600*    IF CARTON LEVEL EXCEPTIONS STILL EXIST, THE ERROR CODE       37660000
376700*    MUST STAY A 'Y'.                                             37670000
376710                                                                  37671044
376800     IF PS-CTN-EXCEPT-EXIST                                       37680000
376900         MOVE 'Y'                 TO SUATRN-UNT-AUD-ERR-IND       37690000
377000     ELSE                                                         37700000
377100         MOVE 'N'                 TO SUATRN-UNT-AUD-ERR-IND       37710000
377200     END-IF.                                                      37720000
377300                                                                  37730000
377400     PERFORM 3415-DELETE-TCTEXCP.                                 37740000
377500                                                                  37750000
377600*    UPDATE INFORMATION                                           37760000
377700     PERFORM 3420-UPDATE-RESTART-INFO.                            37770000
377800                                                                  37780000
377900******************************************************************37790000
378000*  3410-DELETE-SHIP-UNIT-DETAIL.                                 *37800000
378100*  DELETE ALL THE CARTON DETAIL (UPC'S)                          *37810000
378200******************************************************************37820000
378300 3410-DELETE-SHIP-UNIT-DETAIL.                                    37830000
378400                                                                  37840000
378500     EXEC SQL                                                     37850000
378600         DELETE FROM TSUAUPC                                      37860000
378700          WHERE AUD_CNTL_NBR   = :DK-AUDIT-CNTL-NBR               37870000
378800            AND SHIPT_UNT_ID   = :DK-SHIP-UNIT-NBR                37880000
378900     END-EXEC.                                                    37890000
379000                                                                  37900000
379100     EVALUATE TRUE                                                37910000
379200         WHEN SQLCODE = ZERO                                      37920000
379300         WHEN SQLCODE = +100                                      37930000
379400             CONTINUE                                             37940000
379500                                                                  37950000
379600         WHEN SQLWARN0 NOT = SPACES                               37960000
379700         WHEN SQLCODE < ZERO                                      37970000
379800         WHEN SQLCODE > ZERO                                      37980000
379900             MOVE '3410-DELETE-SHIP-UNIT-DETAIL'                  37990000
380000                                   TO DP013-PARAGRAPH             38000000
380100             MOVE 'DELETE OF TSUAUPC TABLE'                       38010000
380200                                   TO DP013-MESSAGE-TEXT (1)      38020000
380300             MOVE DK-AUDIT-CNTL-NBR                               38030000
380400                                   TO DK-AUDIT-CNTL-NBR-X         38040000
380500             MOVE DK-AUDIT-CNTL-NBR-X                             38050000
380600                                   TO DP013-MESSAGE-TEXT (2)      38060000
380700             MOVE SU006-SHIP-UNIT-NBR-X                           38070000
380800                                   TO DP013-MESSAGE-TEXT (3)      38080000
380900             MOVE SQLCA            TO DP013-SQLCA                 38090000
381000             MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME (1)    38100000
381100             SET DP013-DB2-ABEND   TO TRUE                        38110000
381300             PERFORM 9999-WRITE-CICS-LOG-MSG                      38130000
381400             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               38140000
381500             PERFORM 8100-SEND-DATA-ONLY                          38150000
381600             PERFORM 8200-RETURN-TRANID                           38160000
381700     END-EVALUATE.                                                38170000
381800                                                                  38180000
381900******************************************************************38190000
382000*  3415-DELETE-TCTEXCP.                                          *38200000
382100*  DELETE THE CARTON LEVEL EXCEPTIONS FOR PACK ERRORS ONLY       *38210000
382200*  VILN_GP_SEQ_NBR: 36  BAD PACK                                 *38220000
382300*                   37  DEFINED AS I TYPE PREPK BUT IS NOT       *38230000
382400******************************************************************38240000
382500 3415-DELETE-TCTEXCP.                                             38250000
382600                                                                  38260000
382700     EXEC SQL                                                     38270000
382800         DELETE FROM TCTEXCP                                      38280000
382900          WHERE AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             38290000
383000            AND SHIPT_UNT_ID     = :DK-SHIP-UNIT-NBR              38300000
383100            AND VILN_GP_CDE      = 'VA'                           38310000
383200            AND VILN_GP_SEQ_NBR  IN (36,37)                       38320000
383300     END-EXEC.                                                    38330000
383400                                                                  38340000
383500     EVALUATE TRUE                                                38350000
383600         WHEN SQLCODE = ZERO                                      38360000
383700         WHEN SQLCODE = +100                                      38370000
383800             CONTINUE                                             38380000
383900                                                                  38390000
384000         WHEN SQLWARN0 NOT = SPACES                               38400000
384100         WHEN SQLCODE < ZERO                                      38410000
384200         WHEN SQLCODE > ZERO                                      38420000
384300             MOVE '3415-DELETE-TCTEXCP '                          38430000
384400                                   TO DP013-PARAGRAPH             38440000
384500             MOVE 'DELETE OF TCTEXCP TABLE'                       38450000
384600                                   TO DP013-MESSAGE-TEXT (1)      38460000
384700             MOVE DK-AUDIT-CNTL-NBR                               38470000
384800                                   TO DK-AUDIT-CNTL-NBR-X         38480000
384900             MOVE DK-AUDIT-CNTL-NBR-X                             38490000
385000                                   TO DP013-MESSAGE-TEXT (2)      38500000
385100             MOVE SU006-SHIP-UNIT-NBR-X                           38510000
385200                                   TO DP013-MESSAGE-TEXT (3)      38520000
385300             MOVE SQLCA            TO DP013-SQLCA                 38530000
385400             MOVE 'TCTEXCP'        TO DP013-DB2-TABLE-NAME (1)    38540000
385500             SET DP013-DB2-ABEND   TO TRUE                        38550000
385700             PERFORM 9999-WRITE-CICS-LOG-MSG                      38570000
385800             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               38580000
385900             PERFORM 8100-SEND-DATA-ONLY                          38590000
386000             PERFORM 8200-RETURN-TRANID                           38600000
386100     END-EVALUATE.                                                38610000
386200                                                                  38620000
386300******************************************************************38630000
386400*  3420-UPDATE-RESTART-INFO.                                     *38640000
386500*  UPDATE THE SHIPPING UNIT TABLE WITH THE RESTART INFORMATION   *38650000
386600******************************************************************38660000
386700 3420-UPDATE-RESTART-INFO.                                        38670000
386800                                                                  38680000
386900     EXEC SQL                                                     38690000
387000         UPDATE TSUATRN                                           38700000
387100            SET  UNT_AUD_STRT_TMST   = :SUATRN-UNT-AUD-STRT-TMST  38710000
387200               , UNT_AUD_STP_TMST    = :SUATRN-UNT-AUD-STP-TMST   38720000
387300               , UNT_AUD_STAT_CDE    = :SUATRN-UNT-AUD-STAT-CDE   38730000
387400               , UNT_AUD_ERR_IND     = :SUATRN-UNT-AUD-ERR-IND    38740000
387500               , UNT_PSPND_MNIT_QTY  = :SUATRN-UNT-PSPND-MNIT-QTY 38750000
387600               , UNT_CLO_MNIT_QTY    = :SUATRN-UNT-CLO-MNIT-QTY   38760000
387700               , UNT_RSTRT_MNIT_QTY  = :SUATRN-UNT-RSTRT-MNIT-QTY 38770000
387800               , UNT_AUD_USR_ID      = :SU006-USERID              38780000
387900         WHERE                                                    38790000
388000                AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             38800000
388100           AND  SHIPT_UNT_ID     = :DK-SHIP-UNIT-NBR              38810000
388200     END-EXEC.                                                    38820000
388300                                                                  38830000
388400     EVALUATE TRUE                                                38840000
388500         WHEN SQLCODE = ZERO                                      38850000
388600             CONTINUE                                             38860000
388700                                                                  38870000
388800         WHEN SQLWARN0 NOT = SPACES                               38880000
388900         WHEN SQLCODE < ZERO                                      38890000
389000         WHEN SQLCODE > ZERO                                      38900000
389100             MOVE '3420-UPDATE-RESTART-INFO'                      38910000
389200                                   TO DP013-PARAGRAPH             38920000
389300             MOVE 'UPDATE OF TSUATRN TABLE'                       38930000
389400                                   TO DP013-MESSAGE-TEXT (1)      38940000
389500             MOVE DK-AUDIT-CNTL-NBR                               38950000
389600                                   TO DK-AUDIT-CNTL-NBR-X         38960000
389700             MOVE DK-AUDIT-CNTL-NBR-X                             38970000
389800                                   TO DP013-MESSAGE-TEXT (2)      38980000
389900             MOVE SU006-SHIP-UNIT-NBR-X                           38990000
390000                                   TO DP013-MESSAGE-TEXT (3)      39000000
390100             MOVE SQLCA            TO DP013-SQLCA                 39010000
390200             MOVE 'TSUATRN'        TO DP013-DB2-TABLE-NAME (1)    39020000
390300             SET DP013-DB2-ABEND   TO TRUE                        39030000
390500             MOVE PV-SAVE-SHIP-UNIT-STATUS                        39050000
390600                                   TO SU006-SHIP-UNIT-STATUS      39060000
390700             PERFORM 9999-WRITE-CICS-LOG-MSG                      39070000
390800             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               39080000
390900             PERFORM 8100-SEND-DATA-ONLY                          39090000
391000             PERFORM 8200-RETURN-TRANID                           39100000
391100     END-EVALUATE.                                                39110000
391200                                                                  39120000
391300******************************************************************39130000
391400*  3430-CHECK-CARTON-EXCEPTIONS.                                 *39140000
391500*  CHECK IF ANY CARTON LEVEL EXCEPTIONS EXIST                    *39150000
391600******************************************************************39160000
391700 3430-CHECK-CARTON-EXCEPTIONS.                                    39170000
391800                                                                  39180000
391900     EXEC SQL                                                     39190000
392000         SELECT OVRRID_SYS_DAT_TXT                                39200000
392100           INTO :CTEXCP-OVRRID-SYS-DAT-TXT                        39210000
392200           FROM TCTEXCP                                           39220000
392300          WHERE AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             39230000
392400            AND SHIPT_UNT_ID     = :DK-SHIP-UNIT-NBR              39240000
392500            AND  VILN_GP_SEQ_NBR NOT IN (36,37)                   39250000
392600     END-EXEC.                                                    39260000
392700                                                                  39270000
392800     EVALUATE TRUE                                                39280000
392900         WHEN SQLCODE = ZERO                                      39290000
393000         WHEN SQLCODE = -811                                      39300000
393100             SET PS-CTN-EXCEPT-EXIST          TO TRUE             39310000
393200                                                                  39320000
393300         WHEN SQLCODE = +100                                      39330000
393400             SET PS-CTN-EXCEPT-DONT-EXIST     TO TRUE             39340000
393500                                                                  39350000
393600         WHEN SQLWARN0 NOT = SPACES                               39360000
393700         WHEN SQLCODE < ZERO                                      39370000
393800         WHEN SQLCODE > ZERO                                      39380000
393900             MOVE '3430-CHECK-CARTON-EXCEPTIONS'                  39390000
394000                                   TO DP013-PARAGRAPH             39400000
394100             MOVE 'SELECT OF TCTEXCP TABLE'                       39410000
394200                                   TO DP013-MESSAGE-TEXT (1)      39420000
394300             MOVE DK-AUDIT-CNTL-NBR                               39430000
394400                                   TO DK-AUDIT-CNTL-NBR-X         39440000
394500             MOVE DK-AUDIT-CNTL-NBR-X                             39450000
394600                                   TO DP013-MESSAGE-TEXT (2)      39460000
394700             MOVE SU006-SHIP-UNIT-NBR-X                           39470000
394800                                   TO DP013-MESSAGE-TEXT (3)      39480000
394900             MOVE SQLCA            TO DP013-SQLCA                 39490000
395000             MOVE 'TCTEXCP'        TO DP013-DB2-TABLE-NAME (1)    39500000
395100             SET DP013-DB2-ABEND   TO TRUE                        39510000
395300             PERFORM 9999-WRITE-CICS-LOG-MSG                      39530000
395400             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               39540000
395500             PERFORM 8100-SEND-DATA-ONLY                          39550000
395600             PERFORM 8200-RETURN-TRANID                           39560000
395700     END-EVALUATE.                                                39570000
395800                                                                  39580000
395900******************************************************************39590000
396000 3500-DELETE-E-RECORDS.                                           39600000
396100                                                                  39610000
396200*    IF THIS IS THE FIRST AUDIT PROCESSED IT SHOULD BE A QC AUDIT 39620000
396300*    AND WE WANT TO PROCESS USING THE QC AUDIT NUMBER.  IF THIS IS39630000
396400*    AN RFID ONLY AUDIT, THEN THE RFID AUDIT NUMBER WILL BE       39640000
396500*    CONTAINED IN THIS FIELD AND WE WANT TO USE IT.  IF NEITHER,  39650000
396600*    THEN IT'S A COMBINED AUDIT AND THE RFID AUDIT SHOULD PROCESS 39660000
396700*    SECOND IN THIS SCENARIO.                                     39670000
396710                                                                  39671044
396800     IF PS-PRCS-FIRST-AUDIT                                       39680000
396900     OR SU006-RFID-AUD-ONLY                                       39690000
397000     OR SU006-MANUAL-GENERATED-AUDIT                              39700000
397100         MOVE SU006-AUDIT-CNTL-NBR   TO DK-AUDIT-CNTL-NBR         39710000
397200     ELSE                                                         39720000
397300         MOVE SU006-RFID-AUDIT-CNTL-NBR                           39730000
397400                                     TO DK-AUDIT-CNTL-NBR         39740000
397500     END-IF.                                                      39750000
397600                                                                  39760044
397700     MOVE SU006-SHIP-UNIT-NBR        TO DK-SHIP-UNIT-NBR.         39770000
397800                                                                  39780000
397900     PERFORM 3510-DELETE-SHIP-UNIT-E-RECS.                        39790000
398000                                                                  39800000
398100******************************************************************39810000
398200 3510-DELETE-SHIP-UNIT-E-RECS.                                    39820000
398300                                                                  39830000
398400     EXEC SQL                                                     39840000
398500         DELETE FROM TSUAUPC                                      39850000
398600         WHERE                                                    39860000
398700                AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             39870000
398800           AND  SHIPT_UNT_ID     = :DK-SHIP-UNIT-NBR              39880000
398900           AND  SCN_TYP_CDE      = 'E'                            39890000
399000     END-EXEC.                                                    39900000
399100                                                                  39910000
399200     EVALUATE TRUE                                                39920000
399300         WHEN SQLCODE = ZERO                                      39930000
399400         WHEN SQLCODE = +100                                      39940000
399500             CONTINUE                                             39950000
399600                                                                  39960000
399700         WHEN SQLWARN0 NOT = SPACES                               39970000
399800         WHEN SQLCODE < ZERO                                      39980000
399900         WHEN SQLCODE > ZERO                                      39990000
400000             MOVE '3510-DELETE-SHIP-UNIT-E-RECS'                  40000000
400100                                   TO DP013-PARAGRAPH             40010000
400200             MOVE 'DELETE OF TSUAUPC TABLE'                       40020000
400300                                   TO DP013-MESSAGE-TEXT (1)      40030000
400400             MOVE DK-AUDIT-CNTL-NBR                               40040000
400500                                   TO DK-AUDIT-CNTL-NBR-X         40050000
400600             MOVE DK-AUDIT-CNTL-NBR-X                             40060000
400700                                   TO DP013-MESSAGE-TEXT (2)      40070000
400800             MOVE SU006-SHIP-UNIT-NBR-X                           40080000
400900                                   TO DP013-MESSAGE-TEXT (3)      40090000
401000             MOVE SQLCA            TO DP013-SQLCA                 40100000
401100             MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME (1)    40110000
401200             SET DP013-DB2-ABEND   TO TRUE                        40120000
401400             PERFORM 9999-WRITE-CICS-LOG-MSG                      40140000
401500             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               40150000
401600             PERFORM 8100-SEND-DATA-ONLY                          40160000
401700             PERFORM 8200-RETURN-TRANID                           40170000
401800     END-EVALUATE.                                                40180000
401900                                                                  40190000
402000******************************************************************40200000
402100*  3600-SUBMIT-CART-DETAIL.                                      *40210000
402200*  THIS PARAGRAPH WILL SUBMIT THE JCL TO PRODUCE THE CARTON      *40220000
402300*  DETAIL REPORT.                                                *40230000
402400******************************************************************40240000
402500 3600-SUBMIT-CART-DETAIL.                                         40250000
402600                                                                  40260000
402700     EXEC CICS ASSIGN                                             40270000
402800               APPLID(CA-SYSTEM-ID)                               40280000
402900     END-EXEC.                                                    40290000
403000                                                                  40300000
403100*    SET-UP VARIABLES IN THE JOB CARD                             40310000
403200     IF CA-TEST-CICS                                              40320000
403300         MOVE SU006-USERID           TO JL-TEST-JOB-NAME          40330000
403400                                        JL-TEST-NOTIFY            40340000
403500         MOVE 'SUK9151T'             TO JL-PROC-NAME              40350000
403600         MOVE 'CARTON DETAIL'        TO JL-TEST-JOB-DESC          40360000
403700     ELSE                                                         40370000
403800     IF CA-QA-CICS                                                40380000
403900         MOVE SU006-USERID           TO JL-TEST-JOB-NAME          40390000
404000                                        JL-TEST-NOTIFY            40400000
404100         MOVE 'SUK9151Q'             TO JL-PROC-NAME              40410000
404200         MOVE 'CARTON DETAIL'        TO JL-TEST-JOB-DESC          40420000
404300     ELSE                                                         40430000
404400         IF CA-LEARN-CICS                                         40440000
404500             MOVE SU006-USERID       TO JL-TEST-JOB-NAME          40450000
404600                                        JL-TEST-NOTIFY            40460000
404700             MOVE 'SUK9151L'         TO JL-PROC-NAME              40470000
404800             MOVE 'CARTON DETAIL'    TO JL-TEST-JOB-DESC          40480000
404900         ELSE                                                     40490000
405000             MOVE 'SUK915'           TO JL-JOB-NAME               40500000
405100             MOVE 'SUK9151 '         TO JL-PROC-NAME              40510000
405200             MOVE 'CARTON DETAIL'    TO JL-JOB-DESC               40520000
405300         END-IF                                                   40530000
405400     END-IF.                                                      40540000
405500*    SUBMIT JOB QUEUE REQUEST TO THE INTERNAL READER              40550007
405600     PERFORM 9000-SUBMIT-REQUEST-START.                           40560007
405700*                                                                 40570007
405800     MOVE 'S010'                     TO JL-SYSUT1-STEP.           40580007
405900     MOVE SU006-AUDIT-CNTL-NBR       TO JL-SYSUT1-AUD-CNTL-NBR.   40590007
406000                                                                  40600044
406100     MOVE SU006-SYSTEM-MANUAL-AUDIT  TO JL-SYSTEM-MANUAL-AUDIT.   40610007
406200     MOVE SU006-SHIP-UNIT-NBR        TO JL-SYSUT1-SHIP-UNT-NBR.   40620015
406300     MOVE SU006-RFID-QC-AUDIT-IND    TO JL-RFID-QC-AUDIT-IND.     40630007
406400     MOVE SU006-RFID-QC-AUD-CMB-IND  TO JL-RFID-QC-AUD-CMB-IND.   40640007
406500                                                                  40650044
406600     MOVE JL-SYSUT1-AUD-CNTL-LINE    TO JL-SYSUT1-PARM-VALUE.     40660007
406700     PERFORM 9050-SUBMIT-SYMBOLIC-LINE.                           40670007
406800*                                                                 40680007
406900     MOVE 'S090'                     TO JL-SYSUT1-STEP.           40690010
407000     MOVE SU006-PRINTER-DEST         TO JL-SYSUT1-PRINTER         40700007
407100     MOVE CA-PRTR-CNTL-IND           TO JL-SYSUT1-PRTR-IND        40710007
407200     MOVE CA-TRACK-NBR               TO JL-SYSUT1-TRACK-NBR       40720007
407300     MOVE JL-SYSUT1-PRT-LINE         TO JL-SYSUT1-PARM-VALUE.     40730007
407400     PERFORM 9050-SUBMIT-SYMBOLIC-LINE.                           40740007
407500*                                                                 40750007
407600     PERFORM 9099-SUBMIT-REQUEST-STOP.                            40760007
407700                                                                  40770007
407900*    SUBMIT JOB QUEUE REQUEST TO THE INTERNAL READER FOR RFID     40790007
408000*    WHEN COMBINED AUDIT                                          40800007
408010                                                                  40801044
408100     IF SU006-SYSTEM-GENERATED-AUDIT AND                          40810007
408200        SU006-QC-AND-RFID-AUD                                     40820007
408300        PERFORM 9000-SUBMIT-REQUEST-START                         40830007
408400*                                                                 40840007
408500        MOVE 'S010'                     TO JL-SYSUT1-STEP         40850007
408600        MOVE SU006-RFID-AUDIT-CNTL-NBR  TO JL-SYSUT1-AUD-CNTL-NBR 40860007
408700        MOVE SU006-SYSTEM-MANUAL-AUDIT  TO JL-SYSTEM-MANUAL-AUDIT 40870007
408800        MOVE SU006-SHIP-UNIT-NBR  TO JL-SYSUT1-SHIP-UNT-NBR       40880016
408900        SET  JL-RFID-AUDIT              TO TRUE                   40890007
409000        MOVE SU006-RFID-QC-AUD-CMB-IND  TO JL-RFID-QC-AUD-CMB-IND 40900007
409100        MOVE JL-SYSUT1-AUD-CNTL-LINE    TO JL-SYSUT1-PARM-VALUE   40910007
409200        PERFORM 9050-SUBMIT-SYMBOLIC-LINE                         40920007
409300*                                                                 40930007
409400        MOVE 'S090'                     TO JL-SYSUT1-STEP         40940010
409500        MOVE SU006-PRINTER-DEST         TO JL-SYSUT1-PRINTER      40950007
409600        MOVE CA-PRTR-CNTL-IND           TO JL-SYSUT1-PRTR-IND     40960007
409700        MOVE CA-TRACK-NBR               TO JL-SYSUT1-TRACK-NBR    40970007
409800        MOVE JL-SYSUT1-PRT-LINE         TO JL-SYSUT1-PARM-VALUE   40980007
409900        PERFORM 9050-SUBMIT-SYMBOLIC-LINE                         40990007
410000*                                                                 41000007
410100        PERFORM 9099-SUBMIT-REQUEST-STOP                          41010007
410200     END-IF.                                                      41020007
410400                                                                  41040007
410500                                                                  41050007
410600                                                                  41060000
410700******************************************************************41070000
410800 3700-SELECT-AUDIT.                                               41080000
410900                                                                  41090000
411000*    IF THIS IS THE FIRST AUDIT PROCESSED IT SHOULD BE A QC AUDIT 41100000
411100*    AND WE WANT TO PROCESS USING THE QC AUDIT NUMBER.  IF THIS IS41110000
411200*    AN RFID ONLY AUDIT, THEN THE RFID AUDIT NUMBER WILL BE       41120000
411300*    CONTAINED IN THIS FIELD AND WE WANT TO USE IT.  IF NEITHER,  41130000
411400*    THEN IT'S A COMBINED AUDIT AND THE RFID AUDIT SHOULD PROCESS 41140000
411500*    SECOND IN THIS SCENARIO.                                     41150000
411510                                                                  41151044
411600     IF PS-PRCS-FIRST-AUDIT                                       41160000
411700     OR SU006-RFID-AUD-ONLY                                       41170000
411800     OR SU006-MANUAL-GENERATED-AUDIT                              41180000
411900         MOVE SU006-AUDIT-CNTL-NBR   TO DK-AUDIT-CNTL-NBR         41190000
412000     ELSE                                                         41200000
412100         MOVE SU006-RFID-AUDIT-CNTL-NBR                           41210000
412200                                     TO DK-AUDIT-CNTL-NBR         41220000
412300     END-IF.                                                      41230000
412500                                                                  41250000
412600     EXEC SQL                                                     41260000
412700         SELECT                                                   41270000
412800                AUD_CNTL_NBR                                      41280000
412900             ,  INBND_TRIP_ID                                     41290000
413000             ,  CART_QTY                                          41300000
413100             ,  UNT_QTY                                           41310000
413200             ,  AUD_CART_QTY                                      41320000
413300             ,  AUD_UNT_QTY                                       41330000
413400             ,  AUD_STAT_CDE                                      41340000
413500         INTO                                                     41350000
413600                :SUT00015-AUD-CNTL-NBR                            41360000
413700             ,  :SUT00015-INBND-TRIP-ID                           41370000
413800             ,  :SUT00015-CART-QTY                                41380000
413900             ,  :SUT00015-UNT-QTY                                 41390000
414000             ,  :SUT00015-AUD-CART-QTY                            41400000
414100             ,  :SUT00015-AUD-UNT-QTY                             41410000
414200             ,  :SUT00015-AUD-STAT-CDE                            41420000
414300         FROM                                                     41430000
414400                SUT_PO_AUD_REQ                                    41440000
414500         WHERE                                                    41450000
414600                AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             41460000
414700     END-EXEC.                                                    41470000
414800                                                                  41480000
414900     EVALUATE TRUE                                                41490000
415000         WHEN SQLCODE = ZERO                                      41500000
415100             SET PS-SYSTEM-AUDIT-FOUND TO TRUE                    41510000
415200                                                                  41520000
415300         WHEN SQLCODE = +100                                      41530000
415400             SET PS-SYSTEM-AUDIT-NOT-FOUND TO TRUE                41540000
415500                                                                  41550000
415600         WHEN SQLWARN0 NOT = SPACES                               41560000
415700         WHEN SQLCODE < ZERO                                      41570000
415800         WHEN SQLCODE > ZERO                                      41580000
415900             MOVE '3700-SELECT-AUDIT'                             41590000
416000                                   TO DP013-PARAGRAPH             41600000
416100             MOVE 'SELECT OF SUT_PO_AUD_REQ'                      41610000
416200                                   TO DP013-MESSAGE-TEXT (1)      41620000
416300             MOVE DK-AUDIT-CNTL-NBR                               41630000
416400                                   TO DK-AUDIT-CNTL-NBR-X         41640000
416500             MOVE DK-AUDIT-CNTL-NBR-X                             41650000
416600                                   TO DP013-MESSAGE-TEXT (2)      41660000
416700             MOVE SQLCA            TO DP013-SQLCA                 41670000
416800             MOVE 'SUT00015'       TO DP013-DB2-TABLE-NAME (1)    41680000
416900             SET DP013-DB2-ABEND   TO TRUE                        41690000
417100             PERFORM 9999-WRITE-CICS-LOG-MSG                      41710000
417200             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               41720000
417300             PERFORM 8100-SEND-DATA-ONLY                          41730000
417400             PERFORM 8200-RETURN-TRANID                           41740000
417500     END-EVALUATE.                                                41750000
417600                                                                  41760000
417700******************************************************************41770000
417800 3800-UPDATE-SUT-PO-AUD-REQ.                                      41780000
417900                                                                  41790000
418000     EXEC SQL                                                     41800000
418100          UPDATE SUT_PO_AUD_REQ                                   41810000
418200          SET    AUD_CART_QTY   = :SUT00015-AUD-CART-QTY          41820000
418300              ,  AUD_UNT_QTY    = :SUT00015-AUD-UNT-QTY           41830000
418400          WHERE  AUD_CNTL_NBR   = :DK-AUDIT-CNTL-NBR              41840000
418500     END-EXEC.                                                    41850000
418600                                                                  41860000
418700     EVALUATE TRUE                                                41870000
418800         WHEN SQLCODE = ZERO                                      41880000
418900             CONTINUE                                             41890000
419000                                                                  41900000
419100         WHEN SQLWARN0 NOT = SPACES                               41910000
419200         WHEN SQLCODE NOT EQUAL ZERO                              41920000
419300             MOVE '3800-UPDATE-SUT-PO-AUD-REQ'                    41930000
419400                                   TO DP013-PARAGRAPH             41940000
419500             MOVE 'UPDATE OF SUT_PO_AUD_REQ'                      41950000
419600                                   TO DP013-MESSAGE-TEXT (1)      41960000
419700             MOVE DK-AUDIT-CNTL-NBR                               41970000
419800                                   TO DK-AUDIT-CNTL-NBR-X         41980000
419900             MOVE DK-AUDIT-CNTL-NBR-X                             41990000
420000                                   TO DP013-MESSAGE-TEXT (2)      42000000
420100             MOVE SQLCA            TO DP013-SQLCA                 42010000
420200             MOVE 'SUT00015'       TO DP013-DB2-TABLE-NAME (1)    42020000
420300             SET DP013-DB2-ABEND   TO TRUE                        42030000
420500             PERFORM 9999-WRITE-CICS-LOG-MSG                      42050000
420600             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               42060000
420700             PERFORM 8100-SEND-DATA-ONLY                          42070000
420800             PERFORM 8200-RETURN-TRANID                           42080000
420900     END-EVALUATE.                                                42090000
421000                                                                  42100000
421100******************************************************************42110000
421200 3900-CHECK-FOR-ADJUSTMENTS.                                      42120000
421300                                                                  42130000
421400     PERFORM 3920-SELECT-SULBXF.                                  42140000
421500     IF PS-OUTBOUND-CARTON                                        42150000
421600         PERFORM 3990-SELECT-SUQADJ                               42160000
421700     END-IF.                                                      42170000
421800                                                                  42180044
421900     PERFORM 3960-CHECK-CARTON-ADJ-DC.                            42190000
422000     PERFORM 3970-CHECK-4-INNER-PACK.                             42200000
422100     IF SU006-AUD-ERR                                             42210000
422200         IF (CA-OVER-SHORT OR                                     42220000
422300             PS-PRIOR-ADJUSTMENTS) AND                            42230000
422400            SULBXF-CART-LBL-TYP-CDE NOT = 'P' AND                 42240000
422600            PS-OUTBOUND-CARTON AND                                42260000
422700            PS-CARTON-ADJUST-DC AND                               42270000
422800            PS-INNER-PACK-NO AND                                  42280000
422900            NOT SU006-NO-UNIT-ADJ                                 42290000
423000             PERFORM 3980-CARTON-ADJUSTMENTS                      42300000
423100         ELSE                                                     42310000
423200             PERFORM 4100-CHECK-OVER-SHORT                        42320000
423300             IF PS-OVER-SHORT-ERROR AND                           42330000
423400                SULBXF-CART-LBL-TYP-CDE NOT = 'P' AND             42340000
423600                PS-OUTBOUND-CARTON AND                            42360000
423700                PS-CARTON-ADJUST-DC AND                           42370000
423800                PS-INNER-PACK-NO AND                              42380000
423900                NOT SU006-NO-UNIT-ADJ                             42390000
424000                   PERFORM 3980-CARTON-ADJUSTMENTS                42400000
424100             END-IF                                               42410000
424200         END-IF                                                   42420000
424300     ELSE                                                         42430000
424400         PERFORM 4100-CHECK-OVER-SHORT                            42440000
424500         IF (PS-OVER-SHORT-ERROR OR                               42450000
424600             PS-PRIOR-ADJUSTMENTS) AND                            42460000
424700            SULBXF-CART-LBL-TYP-CDE NOT = 'P' AND                 42470000
424900            PS-OUTBOUND-CARTON AND                                42490000
425000            PS-CARTON-ADJUST-DC AND                               42500000
425100            PS-INNER-PACK-NO AND                                  42510000
425200            NOT SU006-NO-UNIT-ADJ                                 42520000
425300               PERFORM 3980-CARTON-ADJUSTMENTS                    42530000
425400         END-IF                                                   42540000
425500     END-IF.                                                      42550000
425600                                                                  42560000
425700******************************************************************42570000
425800 3920-SELECT-SULBXF.                                              42580000
425900                                                                  42590000
426000     MOVE SU006-SHIP-UNIT-NBR   TO DK-SHIP-UNIT-NBR.              42600000
426100                                                                  42610000
426200     EXEC SQL                                                     42620000
426300         SELECT CART_LBL_TYP_CDE                                  42630000
426400            ,   BRCDE_NBR                                         42640000
426500         INTO   :SULBXF-CART-LBL-TYP-CDE                          42650000
426600           ,    :SULBXF-BRCDE-NBR                                 42660000
426700          FROM  TSULBXF                                           42670000
426800          WHERE SHIPT_UNT_ID      = :DK-SHIP-UNIT-NBR             42680000
426900           AND  STAT_CDE          = 'A'                           42690000
427000     END-EXEC.                                                    42700000
427100                                                                  42710000
427200     EVALUATE TRUE                                                42720000
427300         WHEN SQLCODE = ZERO                                      42730000
427400              CONTINUE                                            42740000
427500                                                                  42750000
427600         WHEN SQLCODE = +100                                      42760000
427700              SET PS-NO-OUTBOUND-CARTON TO TRUE                   42770000
427800                                                                  42780000
427900         WHEN SQLWARN0 NOT = SPACES                               42790000
428000         WHEN SQLCODE NOT EQUAL ZERO                              42800000
428100             MOVE '3920-SELECT-SULBXF'  TO DP013-PARAGRAPH        42810000
428200             MOVE 'CHECK VALID CARTON'  TO DP013-MESSAGE-TEXT(1)  42820000
428300             MOVE SU006-SHIP-UNIT-NBR   TO DP013-MESSAGE-TEXT(2)  42830000
428400             MOVE SQLCA                 TO DP013-SQLCA            42840000
428500             MOVE 'TSULBXF'             TO DP013-DB2-TABLE-NAME(1)42850000
428600             SET DP013-DB2-ABEND                                  42860000
428700                 DP013-NO-ROLLBACK       TO TRUE                  42870000
428800             PERFORM 9999-WRITE-CICS-LOG-MSG                      42880000
428900             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               42890000
429000             MOVE -1                     TO ASELECTL              42900000
429100             PERFORM 8100-SEND-DATA-ONLY                          42910000
429200             PERFORM 8200-RETURN-TRANID                           42920000
429300     END-EVALUATE.                                                42930000
429400                                                                  42940000
433100******************************************************************43310000
433200 3960-CHECK-CARTON-ADJ-DC.                                        43320000
433300                                                                  43330000
433400     MOVE SU006-OPER-UNT-ID        TO DK-LOC-ID.                  43340000
433500                                                                  43350000
433600     EXEC SQL                                                     43360000
433700         SELECT FUNC_TXT                                          43370000
433800           INTO :KRPRPM-FUNC-TXT                                  43380000
433900           FROM TKRPRPM                                           43390000
434000          WHERE SYS_PRC_FUNC_CDE  = 'CRTADJ'                      43400000
434100            AND LOC_ID            = :DK-LOC-ID                    43410000
434200            AND INTFC_SYS_CDE     = 'KHL'                         43420000
434300            AND FUNC_PRC_STAT_CDE = 'AC'                          43430000
434400            AND (CURRENT DATE                                     43440000
434500        BETWEEN DATE(FUNC_BEG_TMST) AND                           43450000
434600                DATE(FUNC_END_TMST) )                             43460000
434700     END-EXEC.                                                    43470000
434800                                                                  43480000
434900     EVALUATE SQLCODE                                             43490000
435000         WHEN ZERO                                                43500000
435100             IF KRPRPM-FUNC-TXT = 'Y'                             43510000
435200                 SET PS-CARTON-ADJUST-DC  TO TRUE                 43520000
435300             ELSE                                                 43530000
435400                 SET PS-NOT-CARTON-ADJUST-DC  TO TRUE             43540000
435500             END-IF                                               43550000
435600         WHEN OTHER                                               43560000
435700              MOVE '3960-CHECK-CARTON-ADJ-DC'                     43570000
435800                               TO DP013-PARAGRAPH                 43580000
435900              MOVE 'SELECT CARTON ADJUSTMENT IND'                 43590000
436000                               TO DP013-MESSAGE-TEXT (1)          43600000
436100              MOVE SQLCA       TO DP013-SQLCA                     43610000
436200              SET DP013-DB2-ABEND                                 43620000
436300                               TO TRUE                            43630000
436400              PERFORM DP014-0000-PROCESS-ABEND                    43640000
436500     END-EVALUATE.                                                43650000
436600                                                                  43660000
436700******************************************************************43670000
436800* DO NOT PERFORM ADJUSTMENTS IF THE SSCC IS AN INNER PACK        *43680000
436900* CONVEYABLE.  7/2004  DEANNA BRANTNER                           *43690000
437000******************************************************************43700000
437100 3970-CHECK-4-INNER-PACK.                                         43710000
437200                                                                  43720000
437300     MOVE SU006-SHIP-UNIT-NBR   TO DK-SHIP-UNIT-NBR.              43730000
437400                                                                  43740000
437500     EXEC SQL                                                     43750000
437600         SELECT CART_TYP_CDE                                      43760000
437700         INTO   :SUT00024-CART-TYP-CDE                            43770000
437800          FROM  SUT_OTBND_CART                                    43780000
437900          WHERE ORIG_CART_ID      = :DK-SHIP-UNIT-NBR             43790000
438000           AND  ACTV_IND          = 'Y'                           43800000
438100     END-EXEC.                                                    43810000
438200                                                                  43820000
438300     EVALUATE TRUE                                                43830000
438400         WHEN SQLCODE = ZERO                                      43840000
438500         WHEN SQLCODE = -811                                      43850000
438600             IF SUT00024-CART-TYP-CDE = 'I'                       43860000
438700                 SET PS-INNER-PACK-YES     TO TRUE                43870000
438800             ELSE                                                 43880000
438900                 SET PS-INNER-PACK-NO      TO TRUE                43890000
439000             END-IF                                               43900000
439100                                                                  43910000
439200         WHEN SQLCODE = +100                                      43920000
439300             SET PS-INNER-PACK-NO      TO TRUE                    43930000
439400                                                                  43940000
439500         WHEN SQLWARN0 NOT = SPACES                               43950000
439600         WHEN SQLCODE NOT EQUAL ZERO                              43960000
439700             MOVE '3970-CHECK-4-INNER-PACK' TO DP013-PARAGRAPH    43970000
439800             MOVE 'CHECK 4 INNER PACK'  TO DP013-MESSAGE-TEXT(1)  43980000
439900             MOVE SU006-SHIP-UNIT-NBR   TO DP013-MESSAGE-TEXT(2)  43990000
440000             MOVE SQLCA                 TO DP013-SQLCA            44000000
440100             MOVE 'OTBDCRT'             TO DP013-DB2-TABLE-NAME(1)44010000
440200             SET DP013-DB2-ABEND                                  44020000
440300                 DP013-NO-ROLLBACK       TO TRUE                  44030000
440400             PERFORM 9999-WRITE-CICS-LOG-MSG                      44040000
440500             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               44050000
440600             MOVE -1                     TO ASELECTL              44060000
440700             PERFORM 8100-SEND-DATA-ONLY                          44070000
440800             PERFORM 8200-RETURN-TRANID                           44080000
440900     END-EVALUATE.                                                44090000
441000                                                                  44100000
441100******************************************************************44110000
441200 3980-CARTON-ADJUSTMENTS.                                         44120000
441300                                                                  44130000
441400     INITIALIZE SU034-COMM-AREA.                                  44140000
441500     MOVE SU006-SHIP-UNIT-NBR       TO SU034-SHIPT-UNT-ID.        44150000
441600     MOVE 'AUDITADJ'                TO SU034-PRC-RSN-CDE.         44160000
441700     MOVE SU006-OPER-UNT-ID         TO SU034-OPER-UNT-ID.         44170000
441800     MOVE 'U'                       TO SU034-ADJ-FUNC-CDE.        44180000
441900     MOVE SU006-AUDIT-CNTL-NBR      TO SU034-ADJ-AUDIT-CNTL-NBR.  44190000
442000     MOVE SU006-USERID              TO SU034-USER-ID.             44200000
442100     MOVE PC-CURRENT-PROGRAM-NAME   TO SU034-PROGRAM-NAME.        44210000
442200                                                                  44220000
442300     MOVE LENGTH OF SU034-COMM-AREA TO PV-COMMAREA-LENGTH.        44230000
442400                                                                  44240000
442500     EXEC CICS                                                    44250000
442600         LINK PROGRAM  (PC-SUKUT701)                              44260000
442700              COMMAREA (SU034-COMM-AREA)                          44270000
442800              LENGTH   (PV-COMMAREA-LENGTH)                       44280000
442900              RESP     (PV-CICS-RESPONSE)                         44290000
443000     END-EXEC.                                                    44300000
443100                                                                  44310000
443200     EVALUATE TRUE                                                44320000
443300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 44330000
443400             IF NOT SU034-SUCCESSFUL                              44340000
443500                 MOVE SPACES TO PV-CICS-MSG-AREA2                 44350000
443600                 STRING ' SUKRF515 - CARTON ADJUSTMENT ERROR'     44360000
443700                    DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2      44370000
443800                 PERFORM 999A-WRITE-CSSL-MSG                      44380000
443900                                                                  44390000
444000                 MOVE SPACES TO PV-CICS-MSG-AREA2                 44400000
444100                 STRING 'SHIPT UNIT = ' SU006-SHIP-UNIT-NBR       44410000
444200                    DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2      44420000
444300                 PERFORM 999A-WRITE-CSSL-MSG                      44430000
444400                                                                  44440000
444500                 MOVE SPACES TO PV-CICS-MSG-AREA2                 44450000
444600                 STRING 'AUDIT= ' SU006-AUDIT-CNTL-NBR            44460000
444700                    DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2      44470000
444800                 PERFORM 999A-WRITE-CSSL-MSG                      44480000
444900                                                                  44490000
445000                 MOVE SPACES TO PV-CICS-MSG-AREA2                 44500000
445100                 STRING 'SQLCODE  = ' SU034-SQLCA                 44510000
445200                    DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2      44520000
445300                 PERFORM 999A-WRITE-CSSL-MSG                      44530000
445400                                                                  44540000
445500                 MOVE SPACES TO PV-CICS-MSG-AREA2                 44550000
445600                 STRING 'RETURN MSG = ' SU034-CRA-RET-MSG         44560000
445700                    DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2      44570000
445800                 PERFORM 999A-WRITE-CSSL-MSG                      44580000
445900                                                                  44590000
446000                 MOVE SPACES TO PV-CICS-MSG-AREA2                 44600000
446100                 STRING 'SUCCESS IND= ' SU034-SUCCESS-IND         44610000
446200                    DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2      44620000
446300                 PERFORM 999A-WRITE-CSSL-MSG                      44630000
446400                 SET DP013-LINK-RETURN                            44640000
446500                     DP013-CICS-ABEND  TO TRUE                    44650000
446600                 MOVE PC-POSTPONE-TRY-AGAIN-MSG TO  AMSGLNO       44660000
446700                 SET DP013-ROLLBACK TO TRUE                       44670000
446800                 PERFORM DP014-0000-PROCESS-ABEND                 44680000
446900                 MOVE PV-SAVE-SHIP-UNIT-STATUS                    44690000
447000                                  TO SU006-SHIP-UNIT-STATUS       44700000
447100             END-IF                                               44710000
447200                                                                  44720000
447300             IF SU034-FAILED-ADJ                                  44730000
447400                 MOVE PC-CLOSED-W-FAILED-ADJ-MSG TO AMSGLNO       44740000
447500             END-IF                                               44750000
447600                                                                  44760000
447700         WHEN OTHER                                               44770000
447800             MOVE '3980-CARTON-ADJUSTMENTS'                       44780000
447900                                  TO DP013-PARAGRAPH              44790000
448000             MOVE PV-CICS-RESPONSE                                44800000
448100                                  TO DP013-MESSAGE-TEXT(1)        44810000
448200             SET DP013-LINK-RETURN                                44820000
448300                 DP013-CICS-ABEND                                 44830000
448400                 DP013-ROLLBACK TO TRUE                           44840000
448500             PERFORM DP014-0000-PROCESS-ABEND                     44850000
448600             MOVE PV-SAVE-SHIP-UNIT-STATUS                        44860000
448700                                  TO SU006-SHIP-UNIT-STATUS       44870000
448800             MOVE PC-POSTPONE-TRY-AGAIN-MSG TO  AMSGLNO           44880000
448900     END-EVALUATE.                                                44890000
449000                                                                  44900000
449100******************************************************************44910000
449200  3990-SELECT-SUQADJ.                                             44920000
449300                                                                  44930000
449400     MOVE SULBXF-BRCDE-NBR         TO PV-BRCDE-NBR.               44940000
449500     MOVE PV-BRCDE-NBR-N           TO DK-SUQADJ-SHIPT-UNT-ID.     44950000
449600                                                                  44960000
449700     EXEC SQL                                                     44970000
449800         SELECT COUNT(*)                                          44980000
449900           INTO :PV-SUQADJ-COUNT                                  44990000
450000           FROM TSUQADJ                                           45000000
450100          WHERE SHIPT_UNT_ID      = :DK-SUQADJ-SHIPT-UNT-ID       45010000
450200     END-EXEC.                                                    45020000
450300                                                                  45030000
450400     EVALUATE SQLCODE                                             45040000
450500         WHEN ZERO                                                45050000
450600             IF PV-SUQADJ-COUNT > 0                               45060000
450700                 SET PS-PRIOR-ADJUSTMENTS TO TRUE                 45070000
450800             ELSE                                                 45080000
450900                 SET PS-NO-PRIOR-ADJUSTMENTS TO TRUE              45090000
451000             END-IF                                               45100000
451100                                                                  45110000
451200         WHEN OTHER                                               45120000
451300              MOVE '3990-SELECT-SUQADJ'                           45130000
451400                               TO DP013-PARAGRAPH                 45140000
451500              MOVE 'SELECT CARTON ADJUSTMENT IND'                 45150000
451600                               TO DP013-MESSAGE-TEXT (1)          45160000
451700              MOVE SQLCA       TO DP013-SQLCA                     45170000
451800              MOVE SULBXF-BRCDE-NBR                               45180000
451900                               TO DP013-MESSAGE-TEXT (2)          45190000
452000              SET DP013-DB2-ABEND                                 45200000
452100                               TO TRUE                            45210000
452200              PERFORM DP014-0000-PROCESS-ABEND                    45220000
452300     END-EVALUATE.                                                45230000
452400                                                                  45240000
452500******************************************************************45250000
452600 4000-SELECT-TSUNAUD.                                             45260000
452700                                                                  45270000
452800     EXEC SQL                                                     45280000
452900         SELECT AUD_STAT_CDE                                      45290000
453000         INTO   :SUNAUD-AUD-STAT-CDE                              45300000
453100         FROM   TSUNAUD                                           45310000
453200         WHERE  AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             45320000
453300     END-EXEC.                                                    45330000
453400                                                                  45340000
453500     EVALUATE TRUE                                                45350000
453600         WHEN SQLCODE = ZERO                                      45360000
453700             CONTINUE                                             45370000
453800                                                                  45380000
453900         WHEN SQLWARN0 NOT = SPACES                               45390000
454000         WHEN SQLCODE < ZERO                                      45400000
454100         WHEN SQLCODE > ZERO                                      45410000
454200             MOVE '4000-SELECT-TSUNAUD'                           45420000
454300                                   TO DP013-PARAGRAPH             45430000
454400             MOVE 'SELECT START TIMESTAMP'                        45440000
454500                                   TO DP013-MESSAGE-TEXT (1)      45450000
454600             MOVE DK-AUDIT-CNTL-NBR                               45460000
454700                                   TO DK-AUDIT-CNTL-NBR-X         45470000
454800             MOVE DK-AUDIT-CNTL-NBR-X                             45480000
454900                                   TO DP013-MESSAGE-TEXT (2)      45490000
455000             MOVE SQLCA            TO DP013-SQLCA                 45500000
455100             MOVE 'SUT00015'       TO DP013-DB2-TABLE-NAME (1)    45510000
455200             SET DP013-DB2-ABEND   TO TRUE                        45520000
455300             SET DP013-NO-ROLLBACK TO TRUE                        45530000
455400             PERFORM DP014-0000-PROCESS-ABEND                     45540000
455500     END-EVALUATE.                                                45550000
455600                                                                  45560000
455700******************************************************************45570000
455800* 4100-CHECK-OVER-SHORT                                          *45580000
455900*  COMPARE EACH ITEM ON THE CARTON DATABASE, DO A SELECT OF THE  *45590000
456000* AUDIT DATABASE TO DETERMINE IF THE ITEM WAS ACTUALLY FOUND TO  *45600000
456100* BE IN IT, AND IF SO, HOW MUCH WAS IN IT (OVER/SHORT)           *45610000
456200******************************************************************45620000
456300 4100-CHECK-OVER-SHORT.                                           45630000
456400                                                                  45640000
456500*    IF THIS IS THE FIRST AUDIT PROCESSED IT SHOULD BE A QC AUDIT 45650000
456600*    AND WE WANT TO PROCESS USING THE QC AUDIT NUMBER.  IF THIS IS45660000
456700*    AN RFID ONLY AUDIT, THEN THE RFID AUDIT NUMBER WILL BE       45670000
456800*    CONTAINED IN THIS FIELD AND WE WANT TO USE IT.  IF NEITHER,  45680000
456900*    THEN IT'S A COMBINED AUDIT AND THE RFID AUDIT SHOULD PROCESS 45690000
457000*    SECOND IN THIS SCENARIO.                                     45700000
457010                                                                  45701044
457100     IF PS-PRCS-FIRST-AUDIT                                       45710000
457200     OR SU006-RFID-AUD-ONLY                                       45720000
457300     OR SU006-MANUAL-GENERATED-AUDIT                              45730000
457400         MOVE SU006-AUDIT-CNTL-NBR                                45740000
457500                               TO DK-AUDIT-CNTL-NBR               45750000
457600     ELSE                                                         45760000
457700         MOVE SU006-RFID-AUDIT-CNTL-NBR                           45770000
457800                               TO DK-AUDIT-CNTL-NBR               45780000
457900     END-IF.                                                      45790000
458000                                                                  45800044
458100     MOVE SU006-SHIP-UNIT-NBR  TO DK-SHIP-UNIT-NBR.               45810000
458200                                                                  45820000
458300     PERFORM 4101-OPEN-CARTON-ITEM-CURSOR.                        45830000
458400     PERFORM 4102-FETCH-CARTON-ITEM-CURSOR.                       45840000
458500                                                                  45850000
458600     PERFORM 4104-OPEN-AUDIT-ITEM-CURSOR.                         45860000
458700     PERFORM 4105-FETCH-AUDIT-ITEM-CURSOR.                        45870000
458800                                                                  45880000
458900                                                                  45890000
459000*    BUMP THE TWO ITEM CURSORS TOGETHER.  THE FIRST TIME THERE    45900000
459100*    IS A UPC ON ONE BUT NO THE OTHER, OR IF THE QUANTITIES DO    45910000
459200*    NOT MATCH, THERE IS AN OVERAGE OR A SHORTAGE ERROR.  BUMP    45920000
459300*    THE TWO UNTIL AN ERROR IS MATCH OR UNIT ONE OF THE CURSORS   45930000
459400*    ENDS                                                         45940000
459410                                                                  45941044
459500     PERFORM UNTIL PS-EOC-CARTON-ITEM-CURSOR                      45950000
459600                OR PS-EOC-AUDIT-ITEM-CURSOR                       45960000
459700                OR PS-OVER-SHORT-ERROR                            45970000
459800                                                                  45980000
459900         IF  PV-AUDIT-INTR-UPC   =  PV-EXPECT-INTR-UPC            45990000
460000         AND PV-ITEM-COUNT-AUDIT =  PV-ITEM-COUNT-CARTON          46000000
460100             PERFORM 4102-FETCH-CARTON-ITEM-CURSOR                46010000
460200             PERFORM 4105-FETCH-AUDIT-ITEM-CURSOR                 46020000
460300         ELSE                                                     46030000
460400             SET PS-OVER-SHORT-ERROR TO TRUE                      46040000
460500         END-IF                                                   46050000
460600                                                                  46060000
460700     END-PERFORM.                                                 46070000
460800                                                                  46080000
460900*    IF ONE CURSOR RAN OUT BEFORE THE OTHER, THERE IS AN          46090000
461000*    ERROR                                                        46100000
461010                                                                  46101044
461100     IF (PS-EOC-CARTON-ITEM-CURSOR                                46110000
461200     AND PS-EOC-AUDIT-ITEM-CURSOR)                                46120000
461300      OR PS-OVER-SHORT-ERROR                                      46130000
461400          CONTINUE                                                46140000
461500     ELSE                                                         46150000
461600         SET PS-OVER-SHORT-ERROR   TO TRUE                        46160000
461700     END-IF.                                                      46170000
461800                                                                  46180000
461900*    CLOSE THE CURSORS                                            46190000
462000     PERFORM 4103-CLOSE-CARTON-ITEM-CURSOR.                       46200000
462100     PERFORM 4106-CLOSE-AUDIT-ITEM-CURSOR.                        46210000
462200                                                                  46220000
462300******************************************************************46230000
462400* 4101-OPEN-CARTON-ITEM-CURSOR                                   *46240000
462500*  OPEN THE PO LINE CURSOR                                       *46250000
462600******************************************************************46260000
462700 4101-OPEN-CARTON-ITEM-CURSOR.                                    46270000
462800                                                                  46280000
462900     EXEC SQL                                                     46290000
463000         OPEN CARTON_ITEM_CURSOR                                  46300000
463100     END-EXEC.                                                    46310000
463200                                                                  46320000
463300     EVALUATE TRUE                                                46330000
463400         WHEN SQLCODE = ZERO                                      46340000
463500             SET PS-NOT-EOC-CARTON-ITEM-CURSOR                    46350000
463600                 PS-NO-OVER-SHORT-ERROR       TO TRUE             46360000
463700                                                                  46370000
463800         WHEN SQLWARN0 NOT = SPACES                               46380000
463900         WHEN SQLCODE < ZERO                                      46390000
464000         WHEN SQLCODE > ZERO                                      46400000
464100             MOVE '4101-OPEN-CARTON-ITEM-CUROSR'                  46410000
464200                                   TO DP013-PARAGRAPH             46420000
464300             MOVE 'OPEN CARTON_ITEM_CUSOR'                        46430000
464400                                   TO DP013-MESSAGE-TEXT (1)      46440000
464500             MOVE SU006-SHIP-UNIT-NBR TO DP013-MESSAGE-TEXT (2)   46450000
464600             MOVE SQLCA            TO DP013-SQLCA                 46460000
464700             MOVE 'TSHUUPC'        TO DP013-DB2-TABLE-NAME (1)    46470000
464800             MOVE 'XLT_UPC'        TO DP013-DB2-TABLE-NAME (2)    46480000
464900             SET DP013-DB2-ABEND   TO TRUE                        46490000
465100             PERFORM 9999-WRITE-CICS-LOG-MSG                      46510000
465200             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               46520000
465300             PERFORM 8100-SEND-DATA-ONLY                          46530000
465400             PERFORM 8200-RETURN-TRANID                           46540000
465500     END-EVALUATE.                                                46550000
465600                                                                  46560000
465700******************************************************************46570000
465800* 4102-FETCH-CARTON-ITEM-CURSOR                                  *46580000
465900*  FETCH THE NEXT OCCURANCE OF THE OVER_SHORT_CUSOR              *46590000
466000******************************************************************46600000
466100 4102-FETCH-CARTON-ITEM-CURSOR.                                   46610000
466200                                                                  46620000
466300     EXEC SQL                                                     46630000
466400         FETCH CARTON_ITEM_CURSOR                                 46640000
466500         INTO    :PV-EXPECT-INTR-UPC                              46650000
466600              ,  :PV-EXPECT-HOLD-UPC-NBR                          46660000
466700              ,  :PV-ITEM-COUNT-CARTON                            46670000
466800     END-EXEC.                                                    46680000
466900                                                                  46690000
467000     EVALUATE TRUE                                                46700000
467100         WHEN SQLCODE = ZERO                                      46710000
467200             CONTINUE                                             46720000
467300                                                                  46730000
467400         WHEN SQLCODE = +100                                      46740000
467500             SET PS-EOC-CARTON-ITEM-CURSOR   TO TRUE              46750000
467600                                                                  46760000
467700         WHEN SQLWARN0 NOT = SPACES                               46770000
467800         WHEN SQLCODE < ZERO                                      46780000
467900         WHEN SQLCODE > ZERO                                      46790000
468000             MOVE '4102-FETCH-CARTON-ITEM-CURSOR'                 46800000
468100                                   TO DP013-PARAGRAPH             46810000
468200             MOVE 'FETCH OF PO_LINE_CUROSR'                       46820000
468300                                   TO DP013-MESSAGE-TEXT (1)      46830000
468400             MOVE SU006-SHIP-UNIT-NBR TO DP013-MESSAGE-TEXT (2)   46840000
468500             MOVE SQLCA            TO DP013-SQLCA                 46850000
468600             MOVE 'TSHUUPC'        TO DP013-DB2-TABLE-NAME (1)    46860000
468700             MOVE 'XLT_UPC'        TO DP013-DB2-TABLE-NAME (2)    46870000
468800             SET DP013-DB2-ABEND   TO TRUE                        46880000
469000             PERFORM 9999-WRITE-CICS-LOG-MSG                      46900000
469100             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               46910000
469200             PERFORM 8100-SEND-DATA-ONLY                          46920000
469300             PERFORM 8200-RETURN-TRANID                           46930000
469400     END-EVALUATE.                                                46940000
469500                                                                  46950000
469600******************************************************************46960000
469700* 4103-CLOSE-CARTON-ITEM-CURSOR                                  *46970000
469800*  CLOSE THE PO LINE CURSOR                                      *46980000
469900******************************************************************46990000
470000 4103-CLOSE-CARTON-ITEM-CURSOR.                                   47000000
470100                                                                  47010000
470200     EXEC SQL                                                     47020000
470300         CLOSE CARTON_ITEM_CURSOR                                 47030000
470400     END-EXEC.                                                    47040000
470500                                                                  47050000
470600     EVALUATE TRUE                                                47060000
470700         WHEN SQLCODE = ZERO                                      47070000
470800             CONTINUE                                             47080000
470900                                                                  47090000
471000         WHEN SQLWARN0 NOT = SPACES                               47100000
471100         WHEN SQLCODE < ZERO                                      47110000
471200         WHEN SQLCODE > ZERO                                      47120000
471300             MOVE '4103-CLOSE-CARTON-ITEM-CURSOR'                 47130000
471400                                   TO DP013-PARAGRAPH             47140000
471500             MOVE 'CLOSE OF OVER_SHORT_CUSOR'                     47150000
471600                                   TO DP013-MESSAGE-TEXT (1)      47160000
471700             MOVE SU006-SHIP-UNIT-NBR TO DP013-MESSAGE-TEXT (2)   47170000
471800             MOVE SQLCA            TO DP013-SQLCA                 47180000
471900             MOVE 'TSHUUPC'        TO DP013-DB2-TABLE-NAME (1)    47190000
472000             MOVE 'XLT_UPC'        TO DP013-DB2-TABLE-NAME (2)    47200000
472100             SET DP013-DB2-ABEND   TO TRUE                        47210000
472300             PERFORM 9999-WRITE-CICS-LOG-MSG                      47230000
472400             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               47240000
472500             PERFORM 8100-SEND-DATA-ONLY                          47250000
472600             PERFORM 8200-RETURN-TRANID                           47260000
472700     END-EVALUATE.                                                47270000
472800                                                                  47280000
472900******************************************************************47290000
473000* 4104-OPEN-AUDIT-ITEM-CURSOR                                    *47300000
473100*  OPEN THE PO LINE CURSOR                                       *47310000
473200******************************************************************47320000
473300 4104-OPEN-AUDIT-ITEM-CURSOR.                                     47330000
473400                                                                  47340000
473500     EXEC SQL                                                     47350000
473600         OPEN AUDIT_ITEM_CURSOR                                   47360000
473700     END-EXEC.                                                    47370000
473800                                                                  47380000
473900     EVALUATE TRUE                                                47390000
474000         WHEN SQLCODE = ZERO                                      47400000
474100             SET PS-NOT-EOC-AUDIT-ITEM-CURSOR                     47410000
474200                 PS-NO-OVER-SHORT-ERROR       TO TRUE             47420000
474300                                                                  47430000
474400         WHEN SQLWARN0 NOT = SPACES                               47440000
474500         WHEN SQLCODE < ZERO                                      47450000
474600         WHEN SQLCODE > ZERO                                      47460000
474700             MOVE '4104-OPEN-AUDIT-ITEM-CURSOR'                   47470000
474800                                   TO DP013-PARAGRAPH             47480000
474900             MOVE 'OPEN AUDIT-ITEM-CURSOR'                        47490000
475000                                   TO DP013-MESSAGE-TEXT (1)      47500000
475100             MOVE DK-AUDIT-CNTL-NBR                               47510000
475200                                   TO DK-AUDIT-CNTL-NBR-X         47520000
475300             MOVE DK-AUDIT-CNTL-NBR-X                             47530000
475400                                   TO DP013-MESSAGE-TEXT (2)      47540000
475500             MOVE SU006-SHIP-UNIT-NBR-X                           47550000
475600                                   TO DP013-MESSAGE-TEXT (3)      47560000
475700             MOVE SQLCA            TO DP013-SQLCA                 47570000
475800             MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME (1)    47580000
475900             MOVE 'XLT_UPC'        TO DP013-DB2-TABLE-NAME (2)    47590000
476000             SET DP013-DB2-ABEND   TO TRUE                        47600000
476200             PERFORM 9999-WRITE-CICS-LOG-MSG                      47620000
476300             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               47630000
476400             PERFORM 8100-SEND-DATA-ONLY                          47640000
476500             PERFORM 8200-RETURN-TRANID                           47650000
476600     END-EVALUATE.                                                47660000
476700                                                                  47670000
476800******************************************************************47680000
476900* 4105-FETCH-AUDIT-ITEM-CURSOR                                   *47690000
477000*  FETCH THE NEXT OCCURANCE OF THE OVER_SHORT_CUSOR              *47700000
477100******************************************************************47710000
477200 4105-FETCH-AUDIT-ITEM-CURSOR.                                    47720000
477300                                                                  47730000
477400     EXEC SQL                                                     47740000
477500         FETCH AUDIT_ITEM_CURSOR                                  47750000
477600         INTO  :PV-AUDIT-INTR-UPC                                 47760000
477700              ,:PV-AUDIT-HOLD-UPC-NBR                             47770000
477800              ,:PV-ITEM-COUNT-AUDIT                               47780000
477900     END-EXEC.                                                    47790000
478000                                                                  47800000
478100     EVALUATE TRUE                                                47810000
478200         WHEN SQLCODE = ZERO                                      47820000
478300             CONTINUE                                             47830000
478400                                                                  47840000
478500         WHEN SQLCODE = +100                                      47850000
478600             SET PS-EOC-AUDIT-ITEM-CURSOR    TO TRUE              47860000
478700             MOVE 999999999        TO PV-AUDIT-INTR-UPC           47870000
478800             MOVE 0                TO PV-ITEM-COUNT-AUDIT         47880000
478900                                                                  47890000
479000         WHEN SQLWARN0 NOT = SPACES                               47900000
479100         WHEN SQLCODE < ZERO                                      47910000
479200         WHEN SQLCODE > ZERO                                      47920000
479300             MOVE '4105-FETCH-AUDIT-ITEM-CURSOR'                  47930000
479400                                   TO DP013-PARAGRAPH             47940000
479500             MOVE 'FETCH OF AUDIT_ITEM_CURSOR'                    47950000
479600                                   TO DP013-MESSAGE-TEXT (1)      47960000
479700             MOVE DK-AUDIT-CNTL-NBR                               47970000
479800                                   TO DK-AUDIT-CNTL-NBR-X         47980000
479900             MOVE DK-AUDIT-CNTL-NBR-X                             47990000
480000                                   TO DP013-MESSAGE-TEXT (2)      48000000
480100             MOVE SU006-SHIP-UNIT-NBR-X                           48010000
480200                                   TO DP013-MESSAGE-TEXT (3)      48020000
480300             MOVE SQLCA            TO DP013-SQLCA                 48030000
480400             MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME (1)    48040000
480500             MOVE 'XLT_UPC'        TO DP013-DB2-TABLE-NAME (2)    48050000
480600             SET DP013-DB2-ABEND   TO TRUE                        48060000
480800             PERFORM 9999-WRITE-CICS-LOG-MSG                      48080000
480900             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               48090000
481000             PERFORM 8100-SEND-DATA-ONLY                          48100000
481100             PERFORM 8200-RETURN-TRANID                           48110000
481200     END-EVALUATE.                                                48120000
481300                                                                  48130000
481400******************************************************************48140000
481500* 4106-CLOSE-AUDIT-ITEM-CURSOR                                   *48150000
481600*  CLOSE THE PO LINE CURSOR                                      *48160000
481700******************************************************************48170000
481800 4106-CLOSE-AUDIT-ITEM-CURSOR.                                    48180000
481900                                                                  48190000
482000     EXEC SQL                                                     48200000
482100         CLOSE AUDIT_ITEM_CURSOR                                  48210000
482200     END-EXEC.                                                    48220000
482300                                                                  48230000
482400     EVALUATE TRUE                                                48240000
482500         WHEN SQLCODE = ZERO                                      48250000
482600             CONTINUE                                             48260000
482700                                                                  48270000
482800         WHEN SQLWARN0 NOT = SPACES                               48280000
482900         WHEN SQLCODE < ZERO                                      48290000
483000         WHEN SQLCODE > ZERO                                      48300000
483100             MOVE '4103-CLOSE-AUDIT-ITEM-CURSOR'                  48310000
483200                                   TO DP013-PARAGRAPH             48320000
483300             MOVE 'CLOSE OF AUDIT_ITEM_CURSOR'                    48330000
483400                                   TO DP013-MESSAGE-TEXT (1)      48340000
483500             MOVE DK-AUDIT-CNTL-NBR                               48350000
483600                                   TO DK-AUDIT-CNTL-NBR-X         48360000
483700             MOVE DK-AUDIT-CNTL-NBR-X                             48370000
483800                                   TO DP013-MESSAGE-TEXT (2)      48380000
483900             MOVE SU006-SHIP-UNIT-NBR-X                           48390000
484000                                   TO DP013-MESSAGE-TEXT (3)      48400000
484100             MOVE SQLCA            TO DP013-SQLCA                 48410000
484200             MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME (1)    48420000
484300             MOVE 'XLT_UPC'        TO DP013-DB2-TABLE-NAME (2)    48430000
484400             SET DP013-DB2-ABEND   TO TRUE                        48440000
484600             PERFORM 9999-WRITE-CICS-LOG-MSG                      48460000
484700             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               48470000
484800             PERFORM 8100-SEND-DATA-ONLY                          48480000
484900             PERFORM 8200-RETURN-TRANID                           48490000
485000     END-EVALUATE.                                                48500000
485100                                                                  48510000
485200******************************************************************48520000
485300* 4150-CHECK-OVER-SHORT                                          *48530000
485400*  COMPARE EACH ITEM ON THE CARTON DATABASE, DO A SELECT OF THE  *48540000
485500* AUDIT DATABASE TO DETERMINE IF THE ITEM WAS ACTUALLY FOUND TO  *48550000
485600* BE IN IT, AND IF SO, WHO MUCH WAS IN IT (OVER/SHORT)           *48560000
485700******************************************************************48570000
485800 4150-CHECK-OVER-SHORT.                                           48580000
485900                                                                  48590000
486000*    IF THIS IS THE FIRST AUDIT PROCESSED IT SHOULD BE A QC AUDIT 48600000
486100*    AND WE WANT TO PROCESS USING THE QC AUDIT NUMBER.  IF THIS IS48610000
486200*    AN RFID ONLY AUDIT, THEN THE RFID AUDIT NUMBER WILL BE       48620000
486300*    CONTAINED IN THIS FIELD AND WE WANT TO USE IT.  IF NEITHER,  48630000
486400*    THEN IT'S A COMBINED AUDIT AND THE RFID AUDIT SHOULD PROCESS 48640000
486500*    SECOND IN THIS SCENARIO.                                     48650000
486510                                                                  48651044
486600     IF PS-PRCS-FIRST-AUDIT                                       48660000
486700     OR SU006-RFID-AUD-ONLY                                       48670000
486800     OR SU006-MANUAL-GENERATED-AUDIT                              48680000
486900         MOVE SU006-AUDIT-CNTL-NBR                                48690000
487000                               TO DK-AUDIT-CNTL-NBR               48700000
487100     ELSE                                                         48710000
487200         MOVE SU006-RFID-AUDIT-CNTL-NBR                           48720000
487300                               TO DK-AUDIT-CNTL-NBR               48730000
487400     END-IF.                                                      48740000
487500                                                                  48750044
487600     MOVE SU006-SHIP-UNIT-NBR  TO DK-SHIP-UNIT-NBR.               48760000
487700                                                                  48770000
487800     PERFORM 4101-OPEN-CARTON-ITEM-CURSOR.                        48780000
487900     PERFORM 4102-FETCH-CARTON-ITEM-CURSOR.                       48790000
488000                                                                  48800000
488100     PERFORM 4104-OPEN-AUDIT-ITEM-CURSOR.                         48810000
488200     PERFORM 4105-FETCH-AUDIT-ITEM-CURSOR.                        48820000
488300                                                                  48830000
488400*    BUMP THE TWO ITEM CURSORS TOGETHER.  FOR EVERY ITEM WHERE    48840000
488500*    A UPC IS ON ONE BUT NOT THE OTHER, OR IF THE QUANTITIES DO   48850000
488600*    NOT MATCH, THERE IS AN OVERAGE OR A SHORTAGE ERROR.  CHECK   48860000
488700*    EVERY ITEM AND CREATE AN EXCEPTION FOR EVERY OVERAGE OR      48870000
488800*    SHORTAGE.                                                    48880000
488810                                                                  48881044
488900     PERFORM UNTIL PS-EOC-CARTON-ITEM-CURSOR                      48890000
489000                                                                  48900000
489100         IF  PV-AUDIT-INTR-UPC   =  PV-EXPECT-INTR-UPC            48910000
489200         AND PV-ITEM-COUNT-AUDIT =  PV-ITEM-COUNT-CARTON          48920000
489300             PERFORM 4102-FETCH-CARTON-ITEM-CURSOR                48930000
489400             PERFORM 4105-FETCH-AUDIT-ITEM-CURSOR                 48940000
489500         ELSE                                                     48950000
489600             IF  PV-AUDIT-INTR-UPC   =  PV-EXPECT-INTR-UPC        48960000
489700             AND PV-ITEM-COUNT-AUDIT NOT =  PV-ITEM-COUNT-CARTON  48970000
489800                 IF PV-ITEM-COUNT-CARTON > PV-ITEM-COUNT-AUDIT    48980000
489900                     COMPUTE PV-SCND-UNT-QTY =                    48990000
490000                       PV-ITEM-COUNT-CARTON - PV-ITEM-COUNT-AUDIT 49000000
490100                     MOVE 30           TO SUEXCP-VILN-GP-SEQ-NBR  49010000
490200                 ELSE                                             49020000
490300                     COMPUTE PV-SCND-UNT-QTY =                    49030000
490400                       PV-ITEM-COUNT-AUDIT - PV-ITEM-COUNT-CARTON 49040000
490500                     MOVE 29           TO SUEXCP-VILN-GP-SEQ-NBR  49050000
490600                 END-IF                                           49060000
490700                 PERFORM 4400-DETERMINE-UPC                       49070000
490800                 SET PS-OVER-SHORT-ERROR TO TRUE                  49080000
490900                 PERFORM 4102-FETCH-CARTON-ITEM-CURSOR            49090000
491000                 PERFORM 4105-FETCH-AUDIT-ITEM-CURSOR             49100000
491100             ELSE                                                 49110000
491200             IF  PV-AUDIT-INTR-UPC   >  PV-EXPECT-INTR-UPC OR     49120000
491400                 PS-EOC-AUDIT-ITEM-CURSOR                         49140000
491500                 MOVE 30           TO SUEXCP-VILN-GP-SEQ-NBR      49150000
491600                 MOVE PV-ITEM-COUNT-CARTON  TO PV-SCND-UNT-QTY    49160000
491700                 PERFORM 4400-DETERMINE-UPC                       49170000
491800                 SET PS-OVER-SHORT-ERROR TO TRUE                  49180000
491900                 PERFORM 4102-FETCH-CARTON-ITEM-CURSOR            49190000
492000             ELSE                                                 49200000
492100                 SET PS-OVER-SHORT-ERROR TO TRUE                  49210000
492200                 PERFORM 4105-FETCH-AUDIT-ITEM-CURSOR             49220000
492300             END-IF                                               49230000
492400             END-IF                                               49240000
492500         END-IF                                                   49250000
492600                                                                  49260000
492700     END-PERFORM.                                                 49270000
492800                                                                  49280000
492900*    IF ONE CURSOR RAN OUT BEFORE THE OTHER, THERE IS AN          49290000
493000*    ERROR                                                        49300000
493010                                                                  49301044
493100     IF (PS-EOC-CARTON-ITEM-CURSOR                                49310000
493200     AND PS-EOC-AUDIT-ITEM-CURSOR)                                49320000
493300      OR PS-OVER-SHORT-ERROR                                      49330000
493400          CONTINUE                                                49340000
493500     ELSE                                                         49350000
493600         SET PS-OVER-SHORT-ERROR   TO TRUE                        49360000
493700     END-IF.                                                      49370000
493800                                                                  49380000
493900*    CLOSE THE CURSORS                                            49390000
494000     PERFORM 4103-CLOSE-CARTON-ITEM-CURSOR.                       49400000
494100     PERFORM 4106-CLOSE-AUDIT-ITEM-CURSOR.                        49410000
494200                                                                  49420000
494300******************************************************************49430000
494400* 4180-CHCK-RFID-ONLY-QTYS.                                       49440000
494500*  FOR RFID ONLY AUDITS - REPLACE THE SHIP QTY WITH THE SCAN QTY  49450000
494600*  AND REPLACE THE SCAN QUANTITY WITH THE TAG QTY.                49460000
494700******************************************************************49470000
494800 4180-CHCK-RFID-ONLY-QTYS.                                        49480000
494900                                                                  49490000
495000     MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.              49500000
495100     MOVE SU006-SHIP-UNIT-NBR  TO DK-SHIP-UNIT-NBR.               49510000
495200                                                                  49520000
495300     EXEC SQL                                                     49530000
495400        SELECT SUM(SCND_UNT_QTY)                                  49540000
495500              ,SUM(RFID_TGD_QTY)                                  49550000
495600          INTO :PV-SCN-QTY                                        49560000
495700               :PV-SCN-QTY-NULL                                   49570000
495800              ,:PV-EXP-QTY                                        49580000
495900               :PV-EXP-QTY-NULL                                   49590000
496000          FROM TSUAUPC                                            49600000
496100         WHERE AUD_CNTL_NBR = :DK-AUDIT-CNTL-NBR                  49610000
496200           AND SHIPT_UNT_ID = :DK-SHIP-UNIT-NBR                   49620000
496300          WITH UR                                                 49630000
496400     END-EXEC.                                                    49640000
496500                                                                  49650000
496600     EVALUATE TRUE                                                49660000
496700        WHEN SQLCODE = ZERO                                       49670000
496800             IF PV-EXP-QTY-NULL < 0                               49680000
496900                MOVE ZERO               TO PV-EXP-QTY-SHRT        49690000
497000                MOVE PV-EXP-QTY-SHRT    TO ASCNQTYO               49700000
497100             ELSE                                                 49710000
497200                MOVE PV-EXP-QTY         TO PV-EXP-QTY-SHRT        49720000
497300                MOVE PV-EXP-QTY-SHRT    TO ASCNQTYO               49730000
497400             END-IF                                               49740000
497500             IF PV-SCN-QTY-NULL < 0                               49750000
497600                MOVE ZERO               TO PV-SCN-QTY-SHRT        49760000
497700                MOVE PV-SCN-QTY-SHRT    TO AEXPQTYO               49770000
497800             ELSE                                                 49780000
497900                MOVE PV-SCN-QTY         TO PV-SCN-QTY-SHRT        49790000
498000                MOVE PV-SCN-QTY-SHRT    TO AEXPQTYO               49800000
498100             END-IF                                               49810000
498200                                                                  49820000
498300        WHEN SQLCODE = +100                                       49830000
498400            MOVE ZERO                    TO PV-EXP-QTY-SHRT       49840000
498500            MOVE PV-EXP-QTY-SHRT         TO ASCNQTYO              49850000
498600            MOVE ZERO                    TO PV-SCN-QTY-SHRT       49860000
498700            MOVE PV-SCN-QTY-SHRT         TO AEXPQTYO              49870000
498800                                                                  49880000
498900        WHEN OTHER                                                49890000
499000            MOVE '4180-CHCK-RFID-ONLY-QTYS'                       49900000
499100                                         TO DP013-PARAGRAPH       49910000
499200            MOVE 'SELECT OF TSUAUPC'     TO DP013-MESSAGE-TEXT (1)49920000
499300            MOVE DK-AUDIT-CNTL-NBR       TO DK-AUDIT-CNTL-NBR-X   49930000
499400            MOVE DK-AUDIT-CNTL-NBR-X     TO DP013-MESSAGE-TEXT (2)49940000
499500            MOVE SQLCA                   TO DP013-SQLCA           49950000
499600            MOVE 'TSUAUPC'               TO                       49960000
499700                                         DP013-DB2-TABLE-NAME (1) 49970000
499800            SET DP013-DB2-ABEND          TO TRUE                  49980000
499900            SET DP013-NO-ROLLBACK        TO TRUE                  49990000
500000            PERFORM 9999-WRITE-CICS-LOG-MSG                       50000000
500100            MOVE PM-DB2-FATAL-ERROR-MSG  TO AMSGLNO               50010000
500200            MOVE -1                      TO ASELECTL              50020000
500300            PERFORM 8100-SEND-DATA-ONLY                           50030000
500400            PERFORM 8200-RETURN-TRANID                            50040000
500500     END-EVALUATE.                                                50050000
500600                                                                  50060000
500700******************************************************************50070000
500800* 4190-CHECK-RFID-RTN.                                           *50080000
500900*  COMPARE THE TOTAL UNITS SCANNED TO THE UNITS WITH RFID TAGS   *50090000
501000* AND IF THERE IS ANY DIFFERENCE, AN EXCEPTION IS CREATED.       *50100000
501100* FOR A COMBINED AUDIT THE SCANNED QTY IS STORED ON THE QC ROW   *50110000
501200* IN TSUAUPC AND THE RFID TAGGED QTY IS STORED ON THE RFID ROW.  *50120000
501300******************************************************************50130000
501400 4190-CHECK-RFID-RTN.                                             50140000
501500                                                                  50150000
501600     IF PV-COMP-SCAN-QTY > PV-COMP-TAG-QTY                        50160000
501700     OR PV-COMP-SCAN-QTY < PV-COMP-TAG-QTY                        50170000
501800        MOVE 42                    TO SUEXCP-VILN-GP-SEQ-NBR      50180000
501900        SET PS-OVER-SHORT-ERROR    TO TRUE                        50190000
502100        SET SU006-AUD-ERR          TO TRUE                        50210020
502300     END-IF.                                                      50230000
502400                                                                  50240000
502500     IF PS-OVER-SHORT-ERROR                                       50250000
502600        MOVE PV-COMP-UPC-NBR       TO PV-CARTON-UPC-NBR           50260000
502700        PERFORM 5000-SELECT-TUPC-BY-UPC-NBR                       50270000
502800        MOVE PV-COMP-SCAN-QTY      TO SUAUPC-SCND-UNT-QTY         50280000
502900        MOVE PV-COMP-TAG-QTY       TO SUAUPC-RFID-TGD-QTY         50290000
503000        PERFORM 4200-CREATE-AUDIT-ROW                             50300000
503100        PERFORM 4300-CREATE-EXCEPTION                             50310000
503200        SET PS-NO-OVER-SHORT-ERROR     TO TRUE                    50320012
503300     END-IF.                                                      50330000
503400                                                                  50340000
503500******************************************************************50350000
503600*   4200-CREATE-AUDIT-ROW                                        *50360000
503700* CREATE AN AUDIT ROW FOR THE SCANNED/ENTERED UPC (OR ZEROS IF   *50370000
503800* THERE IS NO UPC ENTERED                                        *50380000
503900******************************************************************50390000
504000 4200-CREATE-AUDIT-ROW.                                           50400000
504100                                                                  50410000
504200*    IF THIS IS THE FIRST AUDIT PROCESSED IT SHOULD BE A QC AUDIT 50420000
504300*    AND WE WANT TO PROCESS USING THE QC AUDIT NUMBER.  IF THIS IS50430000
504400*    AN RFID ONLY AUDIT, THEN THE RFID AUDIT NUMBER WILL BE       50440000
504500*    CONTAINED IN THIS FIELD AND WE WANT TO USE IT.  IF NEITHER,  50450000
504600*    THEN IT'S A COMBINED AUDIT AND THE RFID AUDIT SHOULD PROCESS 50460000
504700*    SECOND IN THIS SCENARIO UNLESS A MANUAL AUDIT                50470000
504710                                                                  50471044
504800     IF PS-PRCS-FIRST-AUDIT                                       50480000
504900     OR SU006-QC-AUD-ONLY                                         50490000
505000     OR SU006-RFID-AUD-ONLY                                       50500000
505100     OR SU006-MANUAL-GENERATED-AUDIT                              50510000
505200         MOVE SU006-AUDIT-CNTL-NBR      TO SUAUPC-AUD-CNTL-NBR    50520000
505300     ELSE                                                         50530000
505400         MOVE SU006-RFID-AUDIT-CNTL-NBR TO SUAUPC-AUD-CNTL-NBR    50540000
505500     END-IF.                                                      50550000
505600                                                                  50560044
505700     MOVE SU006-SHIP-UNIT-NBR           TO SUAUPC-SHIPT-UNT-ID.   50570000
505800     MOVE PV-CARTON-UPC-NBR             TO SUAUPC-UPC-NBR.        50580000
505900     MOVE SU006-USERID                  TO SUAUPC-AUD-USR-ID.     50590000
506300     MOVE 'E'                           TO SUAUPC-SCN-TYP-CDE.    50630000
506400     MOVE SPACES                        TO SUAUPC-UPC-CERTD-IND.  50640000
506500                                                                  50650000
506600     EXEC SQL                                                     50660000
506700         SET :SUAUPC-SCN-TMST = CURRENT TIMESTAMP                 50670000
506800     END-EXEC.                                                    50680000
506900                                                                  50690000
507000     EXEC SQL                                                     50700000
507100         INSERT INTO TSUAUPC                                      50710000
507200             ( AUD_CNTL_NBR                                       50720000
507300              ,SHIPT_UNT_ID                                       50730000
507400              ,UPC_NBR                                            50740000
507500              ,SCN_TMST                                           50750000
507600              ,AUD_USR_ID                                         50760000
507700              ,DEPT_NBR                                           50770000
507800              ,MAJ_CL_NBR                                         50780000
507900              ,SUB_CL_NBR                                         50790000
508000              ,ITM_DESC                                           50800000
508100              ,VND_STYL_DESC                                      50810000
508200              ,UPC_CLOR_DESC                                      50820000
508300              ,UPC_SIZE_DESC                                      50830000
508400              ,UPC_RTL_AMT                                        50840000
508500              ,UPC_CERTD_IND                                      50850000
508600              ,SCND_UNT_QTY                                       50860000
508700              ,SCN_TYP_CDE                                        50870000
508800              ,SKU_NBR                                            50880000
508900              ,RFID_TGD_QTY                                       50890000
509000             )                                                    50900000
509100         VALUES                                                   50910000
509200             (                                                    50920000
509300                :SUAUPC-AUD-CNTL-NBR                              50930000
509400              , :SUAUPC-SHIPT-UNT-ID                              50940000
509500              , :SUAUPC-UPC-NBR                                   50950000
509600              , :SUAUPC-SCN-TMST                                  50960000
509700              , :SUAUPC-AUD-USR-ID                                50970000
509800              , :SUAUPC-DEPT-NBR                                  50980000
509900              , :SUAUPC-MAJ-CL-NBR                                50990000
510000              , :SUAUPC-SUB-CL-NBR                                51000000
510100              , :SUAUPC-ITM-DESC                                  51010000
510200              , :SUAUPC-VND-STYL-DESC                             51020000
510300              , :SUAUPC-UPC-CLOR-DESC                             51030000
510400              , :SUAUPC-UPC-SIZE-DESC                             51040000
510500              , :SUAUPC-UPC-RTL-AMT                               51050000
510600              , :SUAUPC-UPC-CERTD-IND                             51060000
510700              , :SUAUPC-SCND-UNT-QTY                              51070000
510800              , :SUAUPC-SCN-TYP-CDE                               51080000
510900              , :SUAUPC-SKU-NBR                                   51090000
511000              , :SUAUPC-RFID-TGD-QTY                              51100000
511100             )                                                    51110000
511200     END-EXEC.                                                    51120000
511300                                                                  51130000
511400     EVALUATE TRUE                                                51140000
511500         WHEN SQLCODE = ZERO                                      51150000
511600             MOVE SUAUPC-SCN-TMST        TO SU006-SCN-TMST        51160000
511700                                                                  51170000
511800         WHEN SQLCODE = -803                                      51180000
511900             CONTINUE                                             51190000
512000                                                                  51200000
512100         WHEN SQLWARN0 NOT = SPACES                               51210000
512200         WHEN SQLCODE < ZERO                                      51220000
512300         WHEN SQLCODE > ZERO                                      51230000
512400             MOVE '4200-CREATE-AUDIT-ROW'                         51240000
512500                                         TO DP013-PARAGRAPH       51250000
512600             MOVE 'INSERT TSUAUPC'       TO DP013-MESSAGE-TEXT(1) 51260000
512700             MOVE SUAUPC-AUD-CNTL-NBR    TO PV-DISP-AUD-CNTL-NBR  51270000
512800             MOVE SUAUPC-SHIPT-UNT-ID    TO PV-DISP-SHIPT-UNT-ID  51280000
512900             MOVE SUAUPC-UPC-NBR         TO PV-DISP-UPC-NBR       51290000
513000             MOVE SUAUPC-SCN-TMST        TO PV-DISP-SCN-TMST      51300000
513100             MOVE PV-DISPLAY-KEYS        TO DP013-MESSAGE-TEXT(2) 51310000
513200             MOVE SQLCA                  TO DP013-SQLCA           51320000
513300             MOVE 'TSUAUPC'             TO DP013-DB2-TABLE-NAME(1)51330000
513400             SET DP013-DB2-ABEND         TO TRUE                  51340000
513600             PERFORM 9999-WRITE-CICS-LOG-MSG                      51360000
513700             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               51370000
513800             PERFORM 8100-SEND-DATA-ONLY                          51380000
513900             PERFORM 8200-RETURN-TRANID                           51390000
514000     END-EVALUATE.                                                51400000
514100                                                                  51410000
514300******************************************************************51430000
514400*   4220-TAG-SCAN-QUANTITY-RTN.                                  *51440000
514500* FOR RETRIEVE BOTH THE SCAN AND TAG QUANTITIES                  *51450003
514600* FROM TSUAUPC USING THE AUDIT CONTROL NUMBER.                   *51460000
514700******************************************************************51470000
514800 4220-TAG-SCAN-QUANTITY-RTN.                                      51480000
514900                                                                  51490000
515000     MOVE SU006-AUDIT-CNTL-NBR      TO DK-AUDIT-CNTL-NBR.         51500000
515100     MOVE SU006-SHIP-UNIT-NBR       TO DK-SHIP-UNIT-NBR.          51510000
515200     SET PS-NOT-EOC-SCAN-CURSOR     TO TRUE.                      51520000
515300     SET PS-NO-OVER-SHORT-ERROR     TO TRUE.                      51530000
515400                                                                  51540000
515500     PERFORM 4800-OPEN-TAG-SCAN-CURSOR.                           51550000
515600     PERFORM 4830-FETCH-TAG-SCAN-CURSOR.                          51560000
515700                                                                  51570000
515800     PERFORM                                                      51580000
515900        UNTIL PS-EOC-SCAN-CURSOR                                  51590000
516000                                                                  51600000
516100         PERFORM 4190-CHECK-RFID-RTN                              51610000
516200         PERFORM 4830-FETCH-TAG-SCAN-CURSOR                       51620000
516300                                                                  51630000
516400     END-PERFORM.                                                 51640000
516500     PERFORM 4860-CLOSE-TAG-SCAN-CURSOR.                          51650000
516600                                                                  51660000
516700                                                                  51670000
516800******************************************************************51680000
516900*   4240-OTHER-QUANTITY-RTN.                                     *51690000
517000* FOR COMBO AUDITS, RETRIEVE THE SCAN QTY AND TAGGED QTY         *51700000
517100* FROM TSUAUPC USING THE RF AUDIT CONTROL NUMBER.                *51710000
517200******************************************************************51720000
517300 4240-OTHER-QUANTITY-RTN.                                         51730000
517400                                                                  51740000
517500     MOVE SU006-SHIP-UNIT-NBR       TO DK-SHIP-UNIT-NBR.          51750000
517600     MOVE SU006-RFID-AUDIT-CNTL-NBR TO DK-AUDITR-CNTL-NBR.        51760000
517700     SET PS-NOT-EOC-SCAN-CURSOR     TO TRUE.                      51770000
517800     SET PS-NO-OVER-SHORT-ERROR     TO TRUE.                      51780000
517900                                                                  51790000
518000     PERFORM 4800-OPEN-TAG-SCAN-CURSOR.                           51800000
518100     PERFORM 4830-FETCH-TAG-SCAN-CURSOR.                          51810000
518200                                                                  51820000
518300     PERFORM                                                      51830000
518400        UNTIL PS-EOC-SCAN-CURSOR                                  51840000
518500                                                                  51850000
518600         PERFORM 4190-CHECK-RFID-RTN                              51860000
518700         PERFORM 4830-FETCH-TAG-SCAN-CURSOR                       51870000
518800                                                                  51880000
518900     END-PERFORM.                                                 51890000
519000                                                                  51900000
519100     PERFORM 4860-CLOSE-TAG-SCAN-CURSOR.                          51910000
519200                                                                  51920000
519400******************************************************************51940000
519500*   4300-CREATE-EXCEPTION                                        *51950000
519600* CREATE THE APPROPRIATE EXCEPTION..........                     *51960000
519700******************************************************************51970000
519800 4300-CREATE-EXCEPTION.                                           51980000
519900                                                                  51990000
520000*    IF THIS IS THE FIRST AUDIT PROCESSED IT SHOULD BE A QC AUDIT 52000000
520100*    AND WE WANT TO PROCESS USING THE QC AUDIT NUMBER.  IF THIS IS52010000
520200*    AN RFID ONLY AUDIT, THEN THE RFID AUDIT NUMBER WILL BE       52020000
520300*    CONTAINED IN THIS FIELD AND WE WANT TO USE IT.  IF NEITHER,  52030000
520400*    THEN IT'S A COMBINED AUDIT AND THE RFID AUDIT SHOULD PROCESS 52040000
520500*    SECOND IN THIS SCENARIO.                                     52050000
520510                                                                  52051044
520600     IF PS-PRCS-FIRST-AUDIT                                       52060000
520700     OR SU006-RFID-AUD-ONLY                                       52070000
520800     OR SU006-MANUAL-GENERATED-AUDIT                              52080000
520900         MOVE SU006-AUDIT-CNTL-NBR   TO SUEXCP-AUD-CNTL-NBR       52090000
521000     ELSE                                                         52100000
521100         MOVE SU006-RFID-AUDIT-CNTL-NBR                           52110000
521200                                     TO SUEXCP-AUD-CNTL-NBR       52120000
521300     END-IF.                                                      52130000
521400                                                                  52140044
521500     MOVE SU006-SHIP-UNIT-NBR        TO SUEXCP-SHIPT-UNT-ID.      52150000
521600     MOVE SU006-SCN-TMST             TO SUEXCP-SCN-TMST.          52160000
521700     MOVE PV-CARTON-UPC-NBR          TO SUEXCP-UPC-NBR.           52170000
521800     MOVE 'VA'                       TO SUEXCP-VILN-GP-CDE.       52180000
521900     MOVE SPACES                     TO SUEXCP-OVRRID-SYS-DAT-TXT.52190000
522000                                                                  52200000
522100     EXEC SQL                                                     52210000
522200         INSERT  INTO  TSUEXCP                                    52220000
522300                (AUD_CNTL_NBR                                     52230000
522400               , SHIPT_UNT_ID                                     52240000
522500               , UPC_NBR                                          52250000
522600               , SCN_TMST                                         52260000
522700               , VILN_GP_CDE                                      52270000
522800               , VILN_GP_SEQ_NBR                                  52280000
522900               , OVRRID_SYS_DAT_TXT)                              52290000
523000         VALUES                                                   52300000
523100             (                                                    52310000
523200                :SUEXCP-AUD-CNTL-NBR                              52320000
523300              , :SUEXCP-SHIPT-UNT-ID                              52330000
523400              , :SUEXCP-UPC-NBR                                   52340000
523500              , :SUEXCP-SCN-TMST                                  52350000
523600              , :SUEXCP-VILN-GP-CDE                               52360000
523700              , :SUEXCP-VILN-GP-SEQ-NBR                           52370000
523800              , :SUEXCP-OVRRID-SYS-DAT-TXT)                       52380000
523900     END-EXEC.                                                    52390000
524000                                                                  52400000
524100     EVALUATE TRUE                                                52410000
524200         WHEN SQLCODE = ZERO                                      52420000
524300             CONTINUE                                             52430000
524400                                                                  52440000
524500         WHEN SQLWARN0 NOT = SPACES                               52450000
524600         WHEN SQLCODE < ZERO                                      52460000
524700         WHEN SQLCODE > ZERO                                      52470000
524800             MOVE '4300-CREATE-EXCEPTION'                         52480000
524900                                         TO DP013-PARAGRAPH       52490000
525000             MOVE 'INSERT TO TSUEXCP TABLE'                       52500000
525100                                         TO DP013-MESSAGE-TEXT (1)52510000
525200             MOVE SU006-SHIP-UNIT-NBR-X  TO DP013-MESSAGE-TEXT(2) 52520000
525300             MOVE SQLCA                  TO DP013-SQLCA           52530000
525400             MOVE 'TSUEXCP'             TO DP013-DB2-TABLE-NAME(1)52540000
525500             SET DP013-DB2-ABEND         TO TRUE                  52550000
525700             PERFORM 9999-WRITE-CICS-LOG-MSG                      52570000
525800             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               52580000
525900             PERFORM 8100-SEND-DATA-ONLY                          52590000
526000             PERFORM 8200-RETURN-TRANID                           52600000
526100     END-EVALUATE.                                                52610000
526200                                                                  52620000
526300******************************************************************52630000
526400 4400-DETERMINE-UPC.                                              52640000
526500                                                                  52650000
526600     PERFORM 4500-OPEN-CARTON-UPC-CURSOR.                         52660000
526700     PERFORM 4530-FETCH-CARTON-UPC-CURSOR.                        52670000
526800                                                                  52680000
526900     PERFORM 4600-OPEN-AUDIT-UPC-CURSOR.                          52690000
527000     PERFORM 4630-FETCH-AUDIT-UPC-CURSOR.                         52700000
527100                                                                  52710000
527200     PERFORM UNTIL PS-EOC-CARTON-UPC-CURSOR                       52720000
527300                OR PV-SCND-UNT-QTY = 0                            52730000
527400                                                                  52740000
527500         IF PV-AUDIT-UPC-NBR  =  PV-CARTON-UPC-NBR                52750000
527600         AND PV-AUDIT-SHPD-QTY = PV-CARTON-SHPD-QTY               52760000
527700             PERFORM 4530-FETCH-CARTON-UPC-CURSOR                 52770000
527800             PERFORM 4630-FETCH-AUDIT-UPC-CURSOR                  52780000
527900         ELSE                                                     52790000
528000             IF PV-AUDIT-UPC-NBR  =  PV-CARTON-UPC-NBR            52800000
528100             AND PV-CARTON-SHPD-QTY NOT = PV-AUDIT-SHPD-QTY       52810000
528200                 IF SUEXCP-VILN-GP-SEQ-NBR  = 30 AND              52820000
528300                    PV-CARTON-SHPD-QTY > PV-AUDIT-SHPD-QTY        52830000
528400                     COMPUTE SUAUPC-SCND-UNT-QTY =                52840000
528500                        PV-CARTON-SHPD-QTY - PV-AUDIT-SHPD-QTY    52850000
528600                     IF SUAUPC-SCND-UNT-QTY > PV-SCND-UNT-QTY     52860000
528700                         MOVE PV-SCND-UNT-QTY TO                  52870000
528800                                              SUAUPC-SCND-UNT-QTY 52880000
528900                         MOVE 0       TO PV-SCND-UNT-QTY          52890000
529000                     ELSE                                         52900000
529100                         COMPUTE PV-SCND-UNT-QTY =                52910000
529200                             PV-SCND-UNT-QTY - SUAUPC-SCND-UNT-QTY52920000
529300                     END-IF                                       52930000
529400                     PERFORM 5000-SELECT-TUPC-BY-UPC-NBR          52940000
529500                     PERFORM 4200-CREATE-AUDIT-ROW                52950000
529600                     PERFORM 4300-CREATE-EXCEPTION                52960000
529700                 ELSE                                             52970000
529800                 IF SUEXCP-VILN-GP-SEQ-NBR  = 29 AND              52980000
529900                    PV-CARTON-SHPD-QTY < PV-AUDIT-SHPD-QTY        52990000
530000                     COMPUTE SUAUPC-SCND-UNT-QTY =                53000000
530100                        PV-AUDIT-SHPD-QTY - PV-CARTON-SHPD-QTY    53010000
530200                     IF SUAUPC-SCND-UNT-QTY > PV-SCND-UNT-QTY     53020000
530300                         MOVE PV-SCND-UNT-QTY TO                  53030000
530400                                              SUAUPC-SCND-UNT-QTY 53040000
530500                         MOVE 0       TO PV-SCND-UNT-QTY          53050000
530600                     ELSE                                         53060000
530700                         COMPUTE PV-SCND-UNT-QTY =                53070000
530800                             PV-SCND-UNT-QTY - SUAUPC-SCND-UNT-QTY53080000
530900                     END-IF                                       53090000
531000                     PERFORM 5000-SELECT-TUPC-BY-UPC-NBR          53100000
531100                     PERFORM 4200-CREATE-AUDIT-ROW                53110000
531200                     PERFORM 4300-CREATE-EXCEPTION                53120000
531300                 END-IF                                           53130000
531400                 END-IF                                           53140000
531500                 PERFORM 4530-FETCH-CARTON-UPC-CURSOR             53150000
531600                 PERFORM 4630-FETCH-AUDIT-UPC-CURSOR              53160000
531700             ELSE                                                 53170000
531800             IF  PV-AUDIT-UPC-NBR  >  PV-CARTON-UPC-NBR           53180000
531900                 IF PV-CARTON-SHPD-QTY > PV-SCND-UNT-QTY          53190000
532000                     MOVE PV-SCND-UNT-QTY   TO SUAUPC-SCND-UNT-QTY53200000
532100                 ELSE                                             53210000
532200                     MOVE PV-CARTON-SHPD-QTY                      53220000
532300                                            TO SUAUPC-SCND-UNT-QTY53230000
532400                 END-IF                                           53240000
532500                 COMPUTE PV-SCND-UNT-QTY =                        53250000
532600                     PV-SCND-UNT-QTY - SUAUPC-SCND-UNT-QTY        53260000
532700                 PERFORM 5000-SELECT-TUPC-BY-UPC-NBR              53270000
532800                 PERFORM 4200-CREATE-AUDIT-ROW                    53280000
532900                 PERFORM 4300-CREATE-EXCEPTION                    53290000
533000                 PERFORM 4530-FETCH-CARTON-UPC-CURSOR             53300000
533100             ELSE                                                 53310000
533200                 PERFORM 4630-FETCH-AUDIT-UPC-CURSOR              53320000
533300             END-IF                                               53330000
533400             END-IF                                               53340000
533500         END-IF                                                   53350000
533600                                                                  53360000
533700     END-PERFORM.                                                 53370000
533800                                                                  53380000
533900     PERFORM 4560-CLOSE-CARTON-UPC-CURSOR.                        53390000
534000     PERFORM 4660-CLOSE-AUDIT-UPC-CURSOR.                         53400000
534100                                                                  53410000
534200******************************************************************53420000
534300 4500-OPEN-CARTON-UPC-CURSOR.                                     53430000
534400                                                                  53440000
534500     EXEC SQL                                                     53450000
534600         OPEN CARTON_UPC_CURSOR                                   53460000
534700     END-EXEC.                                                    53470000
534800                                                                  53480000
534900     EVALUATE TRUE                                                53490000
535000         WHEN SQLCODE = ZERO                                      53500000
535100             SET PS-NOT-EOC-CARTON-UPC-CURSOR TO TRUE             53510000
535200                                                                  53520000
535300         WHEN SQLWARN0 NOT = SPACES                               53530000
535400         WHEN SQLCODE < ZERO                                      53540000
535500         WHEN SQLCODE > ZERO                                      53550000
535600             MOVE '4500-OPEN-CARTON-UPC-CURSOR'                   53560000
535700                                   TO DP013-PARAGRAPH             53570000
535800             MOVE 'OPEN CARTON_UPC_CURSOR'                        53580000
535900                                   TO DP013-MESSAGE-TEXT (1)      53590000
536000             MOVE SU006-SHIP-UNIT-NBR-X                           53600000
536100                                   TO DP013-MESSAGE-TEXT (2)      53610000
536200             MOVE PV-EXPECT-INTR-UPC                              53620000
536300                                   TO PV-INTR-UPC                 53630000
536400             MOVE PV-INTR-UPC      TO DP013-MESSAGE-TEXT (3)      53640000
536500             MOVE SQLCA            TO DP013-SQLCA                 53650000
536600             MOVE 'TSHUUPC'        TO DP013-DB2-TABLE-NAME (1)    53660000
536700             MOVE 'XLT_UPC'        TO DP013-DB2-TABLE-NAME (2)    53670000
536800             SET DP013-DB2-ABEND   TO TRUE                        53680000
537000             PERFORM 9999-WRITE-CICS-LOG-MSG                      53700000
537100             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               53710000
537200             PERFORM 8100-SEND-DATA-ONLY                          53720000
537300             PERFORM 8200-RETURN-TRANID                           53730000
537400     END-EVALUATE.                                                53740000
537500                                                                  53750000
537600******************************************************************53760000
537700 4530-FETCH-CARTON-UPC-CURSOR.                                    53770000
537800                                                                  53780000
537900     EXEC SQL                                                     53790000
538000         FETCH CARTON_UPC_CURSOR                                  53800000
538100         INTO    :PV-CARTON-UPC-NBR                               53810000
538200              ,  :PV-CARTON-SHPD-QTY                              53820000
538300     END-EXEC.                                                    53830000
538400                                                                  53840000
538500     EVALUATE TRUE                                                53850000
538600         WHEN SQLCODE = ZERO                                      53860000
538700             CONTINUE                                             53870000
538800                                                                  53880000
538900         WHEN SQLCODE = +100                                      53890000
539000             SET PS-EOC-CARTON-UPC-CURSOR   TO TRUE               53900000
539100                                                                  53910000
539200         WHEN SQLWARN0 NOT = SPACES                               53920000
539300         WHEN SQLCODE < ZERO                                      53930000
539400         WHEN SQLCODE > ZERO                                      53940000
539500             MOVE '4530-FETCH-CARTON-UPC-CURSOR'                  53950000
539600                                   TO DP013-PARAGRAPH             53960000
539700             MOVE 'FETCH OF CARTON_UPC_CURSOR'                    53970000
539800                                   TO DP013-MESSAGE-TEXT (1)      53980000
539900             MOVE SU006-SHIP-UNIT-NBR-X                           53990000
540000                                   TO DP013-MESSAGE-TEXT (2)      54000000
540100             MOVE PV-EXPECT-INTR-UPC                              54010000
540200                                   TO PV-INTR-UPC                 54020000
540300             MOVE PV-INTR-UPC      TO DP013-MESSAGE-TEXT (3)      54030000
540400             MOVE SQLCA            TO DP013-SQLCA                 54040000
540500             MOVE 'TSHUUPC'        TO DP013-DB2-TABLE-NAME (1)    54050000
540600             MOVE 'XLT_UPC'        TO DP013-DB2-TABLE-NAME (2)    54060000
540700             SET DP013-DB2-ABEND   TO TRUE                        54070000
540900             PERFORM 9999-WRITE-CICS-LOG-MSG                      54090000
541000             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               54100000
541100             PERFORM 8100-SEND-DATA-ONLY                          54110000
541200             PERFORM 8200-RETURN-TRANID                           54120000
541300     END-EVALUATE.                                                54130000
541400                                                                  54140000
541500******************************************************************54150000
541600 4560-CLOSE-CARTON-UPC-CURSOR.                                    54160000
541700                                                                  54170000
541800     EXEC SQL                                                     54180000
541900         CLOSE CARTON_UPC_CURSOR                                  54190000
542000     END-EXEC.                                                    54200000
542100                                                                  54210000
542200     EVALUATE TRUE                                                54220000
542300         WHEN SQLCODE = ZERO                                      54230000
542400             CONTINUE                                             54240000
542500                                                                  54250000
542600         WHEN SQLWARN0 NOT = SPACES                               54260000
542700         WHEN SQLCODE < ZERO                                      54270000
542800         WHEN SQLCODE > ZERO                                      54280000
542900             MOVE '4560-CLOSE-CARTON-UPC-CURSOR'                  54290000
543000                                   TO DP013-PARAGRAPH             54300000
543100             MOVE 'CLOSE OF CARTON_UPC_CURSOR'                    54310000
543200                                   TO DP013-MESSAGE-TEXT (1)      54320000
543300             MOVE SU006-SHIP-UNIT-NBR-X                           54330000
543400                                   TO DP013-MESSAGE-TEXT (2)      54340000
543500             MOVE PV-EXPECT-INTR-UPC                              54350000
543600                                   TO PV-INTR-UPC                 54360000
543700             MOVE PV-INTR-UPC      TO DP013-MESSAGE-TEXT (3)      54370000
543800             MOVE SQLCA            TO DP013-SQLCA                 54380000
543900             MOVE 'TSHUUPC'        TO DP013-DB2-TABLE-NAME (1)    54390000
544000             MOVE 'XLT_UPC'        TO DP013-DB2-TABLE-NAME (2)    54400000
544100             SET DP013-DB2-ABEND   TO TRUE                        54410000
544300             PERFORM 9999-WRITE-CICS-LOG-MSG                      54430000
544400             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               54440000
544500             PERFORM 8100-SEND-DATA-ONLY                          54450000
544600             PERFORM 8200-RETURN-TRANID                           54460000
544700     END-EVALUATE.                                                54470000
544800                                                                  54480000
544900******************************************************************54490000
545000 4600-OPEN-AUDIT-UPC-CURSOR.                                      54500000
545100                                                                  54510000
545200     EXEC SQL                                                     54520000
545300         OPEN AUDIT_UPC_CURSOR                                    54530000
545400     END-EXEC.                                                    54540000
545500                                                                  54550000
545600     EVALUATE TRUE                                                54560000
545700         WHEN SQLCODE = ZERO                                      54570000
545800             SET PS-NOT-EOC-AUDIT-UPC-CURSOR  TO TRUE             54580000
545900                                                                  54590000
546000         WHEN SQLWARN0 NOT = SPACES                               54600000
546100         WHEN SQLCODE < ZERO                                      54610000
546200         WHEN SQLCODE > ZERO                                      54620000
546300             MOVE '4600-OPEN-AUDIT-UPC-CURSOR'                    54630000
546400                                   TO DP013-PARAGRAPH             54640000
546500             MOVE 'OPEN AUDIT_UPC_CURSOR'                         54650000
546600                                   TO DP013-MESSAGE-TEXT (1)      54660000
546700             MOVE DK-AUDIT-CNTL-NBR                               54670000
546800                                   TO DK-AUDIT-CNTL-NBR-X         54680000
546900             MOVE DK-AUDIT-CNTL-NBR-X                             54690000
547000                                   TO DP013-MESSAGE-TEXT (2)      54700000
547100             MOVE SU006-SHIP-UNIT-NBR-X                           54710000
547200                                   TO DP013-MESSAGE-TEXT (3)      54720000
547300             MOVE SQLCA            TO DP013-SQLCA                 54730000
547400             MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME (1)    54740000
547500             MOVE 'XLT_UPC'        TO DP013-DB2-TABLE-NAME (2)    54750000
547600             SET DP013-DB2-ABEND   TO TRUE                        54760000
547800             PERFORM 9999-WRITE-CICS-LOG-MSG                      54780000
547900             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               54790000
548000             PERFORM 8100-SEND-DATA-ONLY                          54800000
548100             PERFORM 8200-RETURN-TRANID                           54810000
548200     END-EVALUATE.                                                54820000
548300                                                                  54830000
548400******************************************************************54840000
548500 4630-FETCH-AUDIT-UPC-CURSOR.                                     54850000
548600                                                                  54860000
548700     EXEC SQL                                                     54870000
548800         FETCH AUDIT_UPC_CURSOR                                   54880000
548900         INTO    :PV-AUDIT-UPC-NBR                                54890000
549000              ,  :PV-AUDIT-SHPD-QTY                               54900000
549100     END-EXEC.                                                    54910000
549200                                                                  54920000
549300     EVALUATE TRUE                                                54930000
549400         WHEN SQLCODE = ZERO                                      54940000
549500             CONTINUE                                             54950000
549600                                                                  54960000
549700         WHEN SQLCODE = +100                                      54970000
549800             SET PS-EOC-AUDIT-UPC-CURSOR    TO TRUE               54980000
549900             MOVE 999999999999999 TO PV-AUDIT-UPC-NBR             54990000
550000             MOVE 0               TO PV-AUDIT-SHPD-QTY            55000000
550100                                                                  55010000
550200         WHEN SQLWARN0 NOT = SPACES                               55020000
550300         WHEN SQLCODE < ZERO                                      55030000
550400         WHEN SQLCODE > ZERO                                      55040000
550500             MOVE '4630-FETCH-AUDIT-UPC-CURSOR'                   55050000
550600                                   TO DP013-PARAGRAPH             55060000
550700             MOVE 'FETCH OF AUDIT_UPC_CURSOR'                     55070000
550800                                   TO DP013-MESSAGE-TEXT (1)      55080000
550900             MOVE DK-AUDIT-CNTL-NBR                               55090000
551000                                   TO DK-AUDIT-CNTL-NBR-X         55100000
551100             MOVE DK-AUDIT-CNTL-NBR-X                             55110000
551200                                   TO DP013-MESSAGE-TEXT (2)      55120000
551300             MOVE SU006-SHIP-UNIT-NBR-X                           55130000
551400                                   TO DP013-MESSAGE-TEXT (3)      55140000
551500             MOVE SQLCA            TO DP013-SQLCA                 55150000
551600             MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME (1)    55160000
551700             MOVE 'XLT_UPC'        TO DP013-DB2-TABLE-NAME (2)    55170000
551800             SET DP013-DB2-ABEND   TO TRUE                        55180000
552000             PERFORM 9999-WRITE-CICS-LOG-MSG                      55200000
552100             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               55210000
552200             PERFORM 8100-SEND-DATA-ONLY                          55220000
552300             PERFORM 8200-RETURN-TRANID                           55230000
552400     END-EVALUATE.                                                55240000
552500                                                                  55250000
552600******************************************************************55260000
552700 4660-CLOSE-AUDIT-UPC-CURSOR.                                     55270000
552800                                                                  55280000
552900     EXEC SQL                                                     55290000
553000         CLOSE AUDIT_UPC_CURSOR                                   55300000
553100     END-EXEC.                                                    55310000
553200                                                                  55320000
553300     EVALUATE TRUE                                                55330000
553400         WHEN SQLCODE = ZERO                                      55340000
553500             CONTINUE                                             55350000
553600                                                                  55360000
553700         WHEN SQLWARN0 NOT = SPACES                               55370000
553800         WHEN SQLCODE < ZERO                                      55380000
553900         WHEN SQLCODE > ZERO                                      55390000
554000             MOVE '4660-CLOSE-AUDIT-UPC-CURSOR'                   55400000
554100                                   TO DP013-PARAGRAPH             55410000
554200             MOVE 'CLOSE OF AUDIT_UPC_CURSOR'                     55420000
554300                                   TO DP013-MESSAGE-TEXT (1)      55430000
554400             MOVE DK-AUDIT-CNTL-NBR                               55440000
554500                                   TO DK-AUDIT-CNTL-NBR-X         55450000
554600             MOVE DK-AUDIT-CNTL-NBR-X                             55460000
554700                                   TO DP013-MESSAGE-TEXT (2)      55470000
554800             MOVE SU006-SHIP-UNIT-NBR-X                           55480000
554900                                   TO DP013-MESSAGE-TEXT (3)      55490000
555000             MOVE SQLCA            TO DP013-SQLCA                 55500000
555100             MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME (1)    55510000
555200             MOVE 'XLT_UPC'        TO DP013-DB2-TABLE-NAME (2)    55520000
555300             SET DP013-DB2-ABEND   TO TRUE                        55530000
555500             PERFORM 9999-WRITE-CICS-LOG-MSG                      55550000
555600             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               55560000
555700             PERFORM 8100-SEND-DATA-ONLY                          55570000
555800             PERFORM 8200-RETURN-TRANID                           55580000
555900     END-EVALUATE.                                                55590000
556000                                                                  55600000
556100******************************************************************55610000
556200 4700-XCTL-TO-HELP.                                               55620000
556300                                                                  55630000
556400     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH.      55640000
556500     SET  SU006-INITIALIZE-SCREEN     TO TRUE.                    55650000
556600     MOVE CA-COMMAREA                 TO PC192-HOST-SAVE-AREA.    55660000
556700                                                                  55670000
556800     EXEC CICS                                                    55680000
556900         XCTL                                                     55690000
557000             PROGRAM   (PV-TRANSFER-PROGRAM)                      55700000
557100             COMMAREA  (PC192-COMMAREA)                           55710000
557200             LENGTH    (PV-COMMAREA-LENGTH)                       55720000
557300             RESP      (PV-CICS-RESPONSE)                         55730000
557400     END-EXEC.                                                    55740000
557500                                                                  55750000
557600     EVALUATE TRUE                                                55760000
557700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 55770000
557800              CONTINUE                                            55780000
557900                                                                  55790000
558000         WHEN OTHER                                               55800000
558100             MOVE '4700-XCTL-TO-HELP'                             55810000
558200                                     TO DP013-PARAGRAPH           55820000
558300             MOVE 'SUKRF515 - UNABLE TO XCTL TO PROGRAM: '        55830000
558400                                      TO DP013-MESSAGE-TEXT (1)   55840000
558500             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   55850000
558600             SET DP013-CICS-ABEND     TO TRUE                     55860000
558700             SET DP013-ROLLBACK       TO TRUE                     55870000
558800             PERFORM 9999-WRITE-CICS-LOG-MSG                      55880000
558900             MOVE PC-TRANS-UNAVAILABLE-MSG TO AMSGLNO             55890000
559000             SET SU006-PROCESS-SCREEN TO TRUE                     55900000
559100             PERFORM 8000-SEND-MAP                                55910000
559200             PERFORM 8200-RETURN-TRANID                           55920000
559300     END-EVALUATE.                                                55930000
559400                                                                  55940000
559500** 12/11/2013   JIM  BEG                                          55950000
559600******************************************************************55960000
559700 4800-OPEN-TAG-SCAN-CURSOR.                                       55970000
559800                                                                  55980000
559900     EXEC SQL                                                     55990000
560000         OPEN RFTAG_SCAN_CURSOR                                   56000000
560100     END-EXEC.                                                    56010000
560200                                                                  56020000
560300     EVALUATE TRUE                                                56030000
560400         WHEN SQLCODE = ZERO                                      56040000
560500             SET PS-NOT-EOC-SCAN-CURSOR  TO TRUE                  56050000
560600                                                                  56060000
560700         WHEN SQLWARN0 NOT = SPACES                               56070000
560800         WHEN SQLCODE < ZERO                                      56080000
560900         WHEN SQLCODE > ZERO                                      56090000
561000             MOVE '4800-OPEN-TAG-SCAN-CURSOR'                     56100000
561100                                   TO DP013-PARAGRAPH             56110000
561200             MOVE 'OPEN RFTAG_SCAN_CURSOR'                        56120000
561300                                   TO DP013-MESSAGE-TEXT (1)      56130000
561400             MOVE DK-AUDIT-CNTL-NBR                               56140000
561500                                   TO DK-AUDIT-CNTL-NBR-X         56150000
561600             MOVE DK-AUDIT-CNTL-NBR-X                             56160000
561700                                   TO DP013-MESSAGE-TEXT (2)      56170000
561800             MOVE SU006-SHIP-UNIT-NBR-X                           56180000
561900                                   TO DP013-MESSAGE-TEXT (3)      56190000
562000             MOVE SQLCA            TO DP013-SQLCA                 56200000
562100             MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME (1)    56210000
562200             SET DP013-DB2-ABEND   TO TRUE                        56220000
562400             PERFORM 9999-WRITE-CICS-LOG-MSG                      56240000
562500             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               56250000
562600             PERFORM 8100-SEND-DATA-ONLY                          56260000
562700             PERFORM 8200-RETURN-TRANID                           56270000
562800     END-EVALUATE.                                                56280000
562900                                                                  56290000
563000******************************************************************56300000
563100 4820-SELECT-TAG-SUM.                                             56310000
563200                                                                  56320000
563300     EXEC SQL                                                     56330000
563400           SELECT SUM(RFID_TGD_QTY)                               56340000
563500             INTO :PV-COMP-TAG-QTY                                56350000
563600             FROM TSUAUPC                                         56360000
563700            WHERE AUD_CNTL_NBR     = :DK-AUDITR-CNTL-NBR          56370000
563800              AND SHIPT_UNT_ID     = :DK-SHIP-UNIT-NBR            56380000
563900              AND UPC_NBR          = :PV-COMP-UPC-NBR             56390000
564000              AND SCN_TYP_CDE     <> 'E'                          56400003
564100     END-EXEC.                                                    56410000
564200                                                                  56420000
564300     EVALUATE TRUE                                                56430000
564400         WHEN SQLCODE = ZERO                                      56440000
564500             CONTINUE                                             56450000
564600                                                                  56460000
564700         WHEN SQLCODE = +100                                      56470000
564800         WHEN SQLCODE = -305                                      56480000
564900             MOVE ZERO             TO PV-COMP-TAG-QTY             56490000
565000                                                                  56500000
565100         WHEN SQLWARN0 NOT = SPACES                               56510000
565200         WHEN SQLCODE < ZERO                                      56520000
565300         WHEN SQLCODE > ZERO                                      56530000
565400             MOVE '4820-SELECT-TAG-SUM'                           56540000
565500                                   TO DP013-PARAGRAPH             56550000
565600             MOVE 'SELECT TAG SUM' TO DP013-MESSAGE-TEXT (1)      56560000
565700             MOVE DK-AUDITR-CNTL-NBR                              56570000
565800                                   TO DK-AUDIT-CNTL-NBR-X         56580000
565900             MOVE DK-AUDIT-CNTL-NBR-X                             56590000
566000                                   TO DP013-MESSAGE-TEXT (2)      56600000
566100             MOVE SU006-SHIP-UNIT-NBR-X                           56610000
566200                                   TO DP013-MESSAGE-TEXT (3)      56620000
566300             MOVE PV-COMP-UPC-NBR  TO DP013-MESSAGE-TEXT (4)      56630000
566400             MOVE SQLCA            TO DP013-SQLCA                 56640000
566500             MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME (1)    56650000
566600             SET DP013-DB2-ABEND   TO TRUE                        56660000
566800             PERFORM 9999-WRITE-CICS-LOG-MSG                      56680000
566900             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               56690000
567000             PERFORM 8100-SEND-DATA-ONLY                          56700000
567100             PERFORM 8200-RETURN-TRANID                           56710000
567200     END-EVALUATE.                                                56720000
567300                                                                  56730000
567400******************************************************************56740000
567500 4830-FETCH-TAG-SCAN-CURSOR.                                      56750000
567600                                                                  56760000
567700     EXEC SQL                                                     56770000
567800         FETCH RFTAG_SCAN_CURSOR                                  56780000
567900         INTO   :PV-COMP-UPC-NBR                                  56790000
568000               ,:PV-COMP-SCAN-QTY                                 56800000
568100               ,:PV-COMP-TAG-QTY                                  56810000
568200     END-EXEC.                                                    56820000
568300                                                                  56830000
568400     EVALUATE TRUE                                                56840000
568500         WHEN SQLCODE = ZERO                                      56850000
568600             CONTINUE                                             56860000
568700                                                                  56870000
568800         WHEN SQLCODE = +100                                      56880000
568900             SET PS-EOC-SCAN-CURSOR TO TRUE                       56890000
569000                                                                  56900000
569100         WHEN SQLWARN0 NOT = SPACES                               56910000
569200         WHEN SQLCODE < ZERO                                      56920000
569300         WHEN SQLCODE > ZERO                                      56930000
569400             MOVE '4830-FETCH-TAG-SCAN-CURSOR'                    56940000
569500                                   TO DP013-PARAGRAPH             56950000
569600             MOVE 'FETCH OF RFTAG_SCAN_CURSOR'                    56960000
569700                                   TO DP013-MESSAGE-TEXT (1)      56970000
569800             MOVE DK-AUDIT-CNTL-NBR                               56980000
569900                                   TO DK-AUDIT-CNTL-NBR-X         56990000
570000             MOVE DK-AUDIT-CNTL-NBR-X                             57000000
570100                                   TO DP013-MESSAGE-TEXT (2)      57010000
570200             MOVE SU006-SHIP-UNIT-NBR-X                           57020000
570300                                   TO DP013-MESSAGE-TEXT (3)      57030000
570400             MOVE SQLCA            TO DP013-SQLCA                 57040000
570500             MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME (1)    57050000
570600             SET DP013-DB2-ABEND   TO TRUE                        57060000
570800             PERFORM 9999-WRITE-CICS-LOG-MSG                      57080000
570900             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               57090000
571000             PERFORM 8100-SEND-DATA-ONLY                          57100000
571100             PERFORM 8200-RETURN-TRANID                           57110000
571200     END-EVALUATE.                                                57120000
571300                                                                  57130000
571400******************************************************************57140000
571500 4860-CLOSE-TAG-SCAN-CURSOR.                                      57150000
571600                                                                  57160000
571700     EXEC SQL                                                     57170000
571800         CLOSE RFTAG_SCAN_CURSOR                                  57180000
571900     END-EXEC.                                                    57190000
572000                                                                  57200000
572100     EVALUATE TRUE                                                57210000
572200         WHEN SQLCODE = ZERO                                      57220000
572300             CONTINUE                                             57230000
572400                                                                  57240000
572500         WHEN SQLWARN0 NOT = SPACES                               57250000
572600         WHEN SQLCODE < ZERO                                      57260000
572700         WHEN SQLCODE > ZERO                                      57270000
572800             MOVE '4860-CLOSE-TAG-SCAN-CURSOR'                    57280000
572900                                   TO DP013-PARAGRAPH             57290000
573000             MOVE 'CLOSE OF RFTAG_SCAN_CURSOR'                    57300000
573100                                   TO DP013-MESSAGE-TEXT (1)      57310000
573200             MOVE DK-AUDIT-CNTL-NBR                               57320000
573300                                   TO DK-AUDIT-CNTL-NBR-X         57330000
573400             MOVE DK-AUDIT-CNTL-NBR-X                             57340000
573500                                   TO DP013-MESSAGE-TEXT (2)      57350000
573600             MOVE SU006-SHIP-UNIT-NBR-X                           57360000
573700                                   TO DP013-MESSAGE-TEXT (3)      57370000
573800             MOVE SQLCA            TO DP013-SQLCA                 57380000
573900             MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME (1)    57390000
574000             SET DP013-DB2-ABEND   TO TRUE                        57400000
574200             PERFORM 9999-WRITE-CICS-LOG-MSG                      57420000
574300             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               57430000
574400             PERFORM 8100-SEND-DATA-ONLY                          57440000
574500             PERFORM 8200-RETURN-TRANID                           57450000
574600     END-EVALUATE.                                                57460000
574700                                                                  57470000
574800******************************************************************57480000
575000**                                                                57500044
575100******************************************************************57510000
575200 5000-SELECT-TUPC-BY-UPC-NBR.                                     57520000
575300                                                                  57530000
575400     INITIALIZE XL001-ITEM-COMMAREA.                              57540000
575500                                                                  57550000
575600     MOVE PV-CARTON-UPC-NBR     TO XL001-KEY-UPC-NBR.             57560000
575700                                                                  57570000
575800     SET  XL001-BY-UPC-NBR                                        57580000
575900          XL001-SELECT-SKU                                        57590000
576000          XL001-SELECT-SKU-STR                                    57600004
576100          XL001-SELECT-VND-STYL TO TRUE.                          57610000
576200                                                                  57620000
576300     CALL XL001-VSM-PGM USING  DFHEIBLK                           57630000
576400                               XL001-COMMAREA                     57640000
576500                               XL001-ITEM-COMMAREA.               57650000
576600     EVALUATE TRUE                                                57660000
576700         WHEN XL001-SKU-SQLCODE = +0                              57670000
576800             MOVE XL001-CSTM-CLOR-DESC TO SUAUPC-UPC-CLOR-DESC    57680000
576900             MOVE XL001-SKU-NBR       TO SUAUPC-SKU-NBR           57690000
577000             MOVE XL001-SKU-DESC      TO SUAUPC-ITM-DESC          57700000
577100             MOVE XL001-UNT-RTL-AMT   TO SUAUPC-UPC-RTL-AMT       57710000
577200             MOVE XL001-VS-NBR        TO SUAUPC-VND-STYL-DESC     57720000
577300             MOVE XL001-SIZE-DESC     TO SUAUPC-UPC-SIZE-DESC     57730000
577400             MOVE XL001-DEPT-NBR      TO SUAUPC-DEPT-NBR          57740000
577500             MOVE XL001-MAJ-CL-NBR    TO SUAUPC-MAJ-CL-NBR        57750000
577600             MOVE XL001-SUB-CL-NBR    TO SUAUPC-SUB-CL-NBR        57760000
577700             MOVE ZERO                TO SUAUPC-RFID-TGD-QTY      57770000
577800                                                                  57780000
578400         WHEN OTHER                                               57840000
578500             PERFORM 9999-WRITE-CICS-LOG-MSG                      57850000
578600             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               57860000
578700             PERFORM 8100-SEND-DATA-ONLY                          57870000
578800             PERFORM 8200-RETURN-TRANID                           57880000
578900                                                                  57890000
579000     END-EVALUATE.                                                57900000
579100                                                                  57910000
579200******************************************************************57920000
579300*  8000-SEND-MAP                                                 *57930000
579400*  SEND THE REFRESHED MAP IMAGE TO THE SCREEN                    *57940000
579500******************************************************************57950000
579600 8000-SEND-MAP.                                                   57960000
579700                                                                  57970000
579800     EXEC CICS                                                    57980000
579900         SEND                                                     57990000
580000             MAP     ('SU515A')                                   58000000
580100             MAPSET  ('SUKM515')                                  58010000
580200             ERASE                                                58020000
580300             RESP    (PV-CICS-RESPONSE)                           58030000
580400     END-EXEC.                                                    58040000
580500                                                                  58050000
580600     EVALUATE TRUE                                                58060000
580700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 58070000
580800             CONTINUE                                             58080000
580900                                                                  58090000
581000         WHEN OTHER                                               58100000
581100             MOVE '8000-SEND-MAP'   TO DP013-PARAGRAPH            58110000
581200             MOVE 'UNABLE TO SEND MAP'                            58120000
581300                                    TO DP013-MESSAGE-TEXT (1)     58130000
581400             SET DP013-CICS-ABEND   TO TRUE                       58140000
581500             SET DP013-NO-ROLLBACK  TO TRUE                       58150000
581600             PERFORM 9999-WRITE-CICS-LOG-MSG                      58160000
581700     END-EVALUATE.                                                58170000
581800                                                                  58180000
581900******************************************************************58190000
582000 8100-SEND-DATA-ONLY.                                             58200000
582100                                                                  58210000
582200     EXEC CICS                                                    58220000
582300         SEND                                                     58230000
582400             MAP       ('SU515A')                                 58240000
582500             MAPSET    ('SUKM515')                                58250000
582600             CURSOR                                               58260000
582700             DATAONLY                                             58270000
582800             RESP      (PV-CICS-RESPONSE)                         58280000
582900     END-EXEC.                                                    58290000
583000                                                                  58300000
583100     EVALUATE TRUE                                                58310000
583200         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 58320000
583300             CONTINUE                                             58330000
583400                                                                  58340000
583500         WHEN OTHER                                               58350000
583600             MOVE '8100-SEND-DATA-ONLY'                           58360000
583700                                    TO DP013-PARAGRAPH            58370000
583800             MOVE 'UNABLE TO SEND DATA'                           58380000
583900                                    TO DP013-MESSAGE-TEXT (1)     58390000
584000             SET DP013-CICS-ABEND   TO TRUE                       58400000
584200             PERFORM 9999-WRITE-CICS-LOG-MSG                      58420000
584300     END-EVALUATE.                                                58430000
584400                                                                  58440000
584500******************************************************************58450000
584600 8200-RETURN-TRANID.                                              58460000
584700                                                                  58470000
584800     MOVE LENGTH OF CA-COMMAREA  TO PV-COMMAREA-LENGTH.           58480000
584900                                                                  58490000
585000     EXEC CICS                                                    58500000
585100         RETURN                                                   58510000
585200             TRANSID   (PC-CURRENT-TRANID)                        58520000
585300             COMMAREA  (CA-COMMAREA)                              58530000
585400             LENGTH    (PV-COMMAREA-LENGTH)                       58540000
585500             RESP      (PV-CICS-RESPONSE)                         58550000
585600     END-EXEC.                                                    58560000
585700                                                                  58570000
585800     EVALUATE TRUE                                                58580000
585900         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 58590000
586000             CONTINUE                                             58600000
586100                                                                  58610000
586200         WHEN OTHER                                               58620000
586300             MOVE '8200-RETURN-TRANID'                            58630000
586400                                    TO DP013-PARAGRAPH            58640000
586500             MOVE 'UNABLE TO RETURN TO TRANID'                    58650000
586600                                    TO DP013-MESSAGE-TEXT (1)     58660000
586700             SET DP013-CICS-ABEND   TO TRUE                       58670000
586900             PERFORM 9999-WRITE-CICS-LOG-MSG                      58690000
587000     END-EVALUATE.                                                58700000
587100                                                                  58710000
587200******************************************************************58720000
587300* QUEUE UP THE INTERNAL READER, SET-UP AND SEND THE JOB LINE     *58730000
587400* BY LINE UP TO THE SYMBOLIC INFO                                *58740000
587500******************************************************************58750000
587600 9000-SUBMIT-REQUEST-START.                                       58760000
587700                                                                  58770000
587800*    FIRE-UP THE INTERNAL READER                                  58780000
587900     PERFORM 9500-ENQUEUE-INTERNAL-READER.                        58790000
588000                                                                  58800000
588100*    SET-UP JOB DEPENDING ON THE REGION                           58810000
588200     IF CA-PROD-CICS                                              58820000
588300                                                                  58830000
588400          MOVE JL-JOB-LINE-PROD     TO JL-JCL-LINE-1              58840000
588500          MOVE JL-JCL-LINE-1        TO TD-JCL-LINE                58850000
588600          PERFORM 9100-WRITE-TD-LINE                              58860000
588700                                                                  58870000
588800*         JOBPARM LINE                                            58880000
588900          MOVE JL-JCL-LINE-3        TO TD-JCL-LINE                58890000
589000          PERFORM 9100-WRITE-TD-LINE                              58900000
589100                                                                  58910000
589200*         JOBOUT LINE                                             58920000
589300          MOVE SU006-PRINTER-DEST   TO JL-LINE-13-PRINTER         58930000
589400          MOVE JL-JCL-LINE-13       TO TD-JCL-LINE                58940000
589500          PERFORM 9100-WRITE-TD-LINE                              58950000
589600                                                                  58960000
589700*         JOBLIB LINE                                             58970000
589800          MOVE JL-JCL-LINE-4-PROD   TO TD-JCL-LINE                58980000
589900          PERFORM 9100-WRITE-TD-LINE                              58990000
590000     ELSE                                                         59000000
590100          MOVE JL-JOB-LINE-TEST     TO  JL-JCL-LINE-1             59010000
590200          MOVE JL-JCL-LINE-1        TO TD-JCL-LINE                59020000
590300          PERFORM 9100-WRITE-TD-LINE                              59030000
590400                                                                  59040000
590500*         JOBOUT LINE                                             59050000
590600          MOVE SU006-PRINTER-DEST   TO JL-LINE-13-PRINTER         59060000
590700          MOVE JL-JCL-LINE-13       TO TD-JCL-LINE                59070000
590800          PERFORM 9100-WRITE-TD-LINE                              59080000
590900                                                                  59090000
591000*         JOBLIB LINE                                             59100000
591100                                                                  59110044
591200          IF CA-QA-CICS                                           59120000
591300             MOVE JL-JCL-LINE-4-QA  TO TD-JCL-LINE                59130000
591400          ELSE                                                    59140000
591500             IF CA-LEARN-CICS                                     59150000
591600                MOVE JL-JCL-LINE-4-LEARN  TO TD-JCL-LINE          59160000
591700             ELSE                                                 59170000
591800                MOVE JL-JCL-LINE-4-TEST   TO TD-JCL-LINE          59180000
591900             END-IF                                               59190000
592000          END-IF                                                  59200000
592100          PERFORM 9100-WRITE-TD-LINE                              59210000
592200     END-IF.                                                      59220000
592300                                                                  59230000
592400*    EXEC PROC LINE                                               59240000
592500     MOVE JL-JCL-LINE-12 TO TD-JCL-LINE.                          59250000
592600     PERFORM 9100-WRITE-TD-LINE.                                  59260000
592700                                                                  59270000
592800******************************************************************59280000
592900* SEND ONE SYMBOLIC LINE                                         *59290000
593000******************************************************************59300000
593100 9050-SUBMIT-SYMBOLIC-LINE.                                       59310000
593200                                                                  59320000
593300*    SYMBOLIC REF LINE                                            59330000
593400     MOVE JL-SYSUT1-PARM-LINE   TO TD-JCL-LINE.                   59340000
593500     PERFORM 9100-WRITE-TD-LINE.                                  59350000
593600*    INSTREAM DATA LINE                                           59360000
593700     MOVE JL-SYSUT1-PARM-VALUE  TO TD-JCL-LINE.                   59370000
593800     PERFORM 9100-WRITE-TD-LINE.                                  59380000
593900                                                                  59390000
594000******************************************************************59400000
594100* SEND THE END OF PROC LINE, AND TURN OFF THE READER             *59410000
594200******************************************************************59420000
594300 9099-SUBMIT-REQUEST-STOP.                                        59430000
594400                                                                  59440000
595300*    END OF PROC LINE                                             59530000
595400     MOVE JL-JCL-LINE-EOF TO TD-JCL-LINE.                         59540000
595500     PERFORM 9100-WRITE-TD-LINE.                                  59550000
595600                                                                  59560000
595700*    SHUT IT OFF!!!!!                                             59570000
595800     PERFORM 9600-DEQUEUE-INTERNAL-READER.                        59580000
595900                                                                  59590000
596000******************************************************************59600000
596100*  WRITE A JCL LINE TO THE TRANSIENT DATA QUEUE FOR THE INTERNAL *59610000
596200*  READER.  ON ANY ERROR, DEQUEUE THE INTERNAL READER, DELETE    *59620000
596300*  THE TEMPORARY STORAGE QUEUE (TO PREVENT OLD REQUEST           *59630000
596400*  INFORMATION FROM ACCIDENTALLY APPEARING ON A FUTURE REQUEST), *59640000
596500*  FORMAT AND DISPLAY AN ERROR MESSAGE                           *59650000
596600******************************************************************59660000
596700 9100-WRITE-TD-LINE.                                              59670000
596800                                                                  59680000
596900     EXEC CICS                                                    59690000
597000         WRITEQ TD                                                59700000
597100             QUEUE(TD-QUEUE-NAME)                                 59710000
597200             FROM(TD-JCL-LINE)                                    59720000
597300             LENGTH(TD-JCL-LINE-LENGTH)                           59730000
597400             RESP(PV-CICS-RESPONSE)                               59740000
597500     END-EXEC.                                                    59750000
597600                                                                  59760000
597700     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    59770000
597800         SET PS-ABEND-IN-PROGRESS        TO TRUE                  59780000
597900                                                                  59790000
598000         STRING 'WRITE TO TRANSIENT DATA QUEUE '                  59800000
598100                                                DELIMITED BY SIZE 59810000
598200                TD-QUEUE-NAME                   DELIMITED BY SIZE 59820000
598300                ' (INTERNAL READER)'            DELIMITED BY SIZE 59830000
598400             INTO SE-ATTEMPTED-ACTION                             59840000
598500         MOVE PV-CICS-RESPONSE           TO SE-CICS-RESPONSE      59850000
598600                                                                  59860000
598700         MOVE SE-SYSTEM-ERROR-MESSAGE    TO DP013-MESSAGE-TABLE   59870000
598800         MOVE '9100-WRITE-TD-LINE'       TO DP013-PARAGRAPH       59880000
598900         SET DP013-CICS-ABEND            TO TRUE                  59890000
599000         SET DP013-ROLLBACK              TO TRUE                  59900000
599100         PERFORM 9999-WRITE-CICS-LOG-MSG                          59910000
599200         MOVE PM-NO-PRINT-MSG            TO AMSGLNO               59920000
599300         PERFORM 9600-DEQUEUE-INTERNAL-READER                     59930000
599400     END-IF.                                                      59940000
599500                                                                  59950000
599600******************************************************************59960000
599700*  ENQUEUE THE TRANSIENT DATA QUEUE FOR THE INTERNAL READER.     *59970000
599800*  THIS WILL PREVENT INTERLEAVING OF JCL SUBMITTED CONCURRENTLY  *59980000
599900*  BY MULTIPLE USERS.  IF THE QUEUE IS BUSY, THIS PROGRAM WILL   *59990000
600000*  WAIT TO ENQUEUE IT, BY NOT SPECIFICALLY HANDLING THE QBUSY    *60000000
600100*  CONDITION.  IF ANY OTHER ERRORS OCCUR, DELETE THE TEMPORARY   *60010000
600200*  STORAGE QUEUE (TO PREVENT OLD REQUEST INFORMATION FROM        *60020000
600300*  ACCIDENTALLY APPEARING ON A FUTURE REQUEST), FORMAT AND       *60030000
600400*  DISPLAY AN ERROR MESSAGE, AND RETURN TO NATIVE CICS.          *60040000
600500******************************************************************60050000
600600 9500-ENQUEUE-INTERNAL-READER.                                    60060000
600700                                                                  60070000
600800     EXEC CICS                                                    60080000
600900         ENQ                                                      60090000
601000             RESOURCE(TD-QUEUE-NAME)                              60100000
601100             LENGTH(TD-QUEUE-NAME-LENGTH)                         60110000
601200             RESP(PV-CICS-RESPONSE)                               60120000
601300     END-EXEC.                                                    60130000
601400                                                                  60140000
601500     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    60150000
601600         SET PS-ABEND-IN-PROGRESS        TO TRUE                  60160000
601700         STRING 'ENQUEUE '               DELIMITED BY SIZE        60170000
601800                TD-QUEUE-NAME            DELIMITED BY SIZE        60180000
601900                ' (INTERNAL READER)'     DELIMITED BY SIZE        60190000
602000             INTO SE-ATTEMPTED-ACTION                             60200000
602100         MOVE PV-CICS-RESPONSE           TO SE-CICS-RESPONSE      60210000
602200         MOVE SE-SYSTEM-ERROR-MESSAGE    TO DP013-MESSAGE-TABLE   60220000
602300         MOVE '9500-ENQUEUE-INTERNAL-READER'                      60230000
602400                                         TO DP013-PARAGRAPH       60240000
602500         SET DP013-CICS-ABEND            TO TRUE                  60250000
602600         SET DP013-ROLLBACK              TO TRUE                  60260000
602700         PERFORM 9999-WRITE-CICS-LOG-MSG                          60270000
602800         MOVE PM-NO-PRINT-MSG            TO AMSGLNO               60280000
602900     END-IF.                                                      60290000
603000                                                                  60300000
603100     SET PS-INTERNAL-READER-ENQUEUED     TO TRUE.                 60310000
603200                                                                  60320000
603300******************************************************************60330000
603400*  DEQUEUE THE TRANSIENT DATA QUEUE FOR THE INTERNAL READER.     *60340000
603500*  THIS SHOULD BE DONE FOLLOWING A SUCCESSFUL REPORT REQUEST     *60350000
603600*  SUBMISSION, A CANCELLATION OF THE CURRENT REPORT REQUEST, OR  *60360000
603700*  ANY DETECTED ABENDS.  THIS WILL FREE UP THE INTERNAL READER   *60370000
603800*  FOR THE NEXT USER.  IF ANY ERRORS OCCUR, CHECK TO SEE IF      *60380000
603900*  ANY OTHER ABEND SITUATIONS HAVE ALREADY OCCURRED.  IF SO, DO  *60390000
604000*  NOT FORCE THE ABEND FOR THIS ERROR, AND ALLOW PROGRAM CONTROL *60400000
604100*  TO RETURN TO THE POINT WHERE THE FIRST ABEND OCCURRED, AND    *60410000
604200*  DISPLAY THE MESSAGE RELATING TO THAT ABEND.  IF NOT, DELETE   *60420000
604300*  THE TEMPORARY STORAGE QUEUE (TO PREVENT OLD REQUEST           *60430000
604400*  INFORMATION FROM ACCIDENTALLY APPEARING ON A FUTURE REQUEST), *60440000
604500*  FORMAT AND DISPLAY AN ERROR MESSAGE, AND RETURN TO NATIVE     *60450000
604600*  CICS.                                                         *60460000
604700******************************************************************60470000
604800 9600-DEQUEUE-INTERNAL-READER.                                    60480000
604900                                                                  60490000
605000     SET PS-INTERNAL-READER-DEQUEUED     TO TRUE.                 60500000
605100                                                                  60510000
605200     EXEC CICS                                                    60520000
605300         DEQ                                                      60530000
605400             RESOURCE(TD-QUEUE-NAME)                              60540000
605500             LENGTH(TD-QUEUE-NAME-LENGTH)                         60550000
605600             RESP(PV-CICS-RESPONSE)                               60560000
605700     END-EXEC.                                                    60570000
605800                                                                  60580000
605900     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    60590000
606000         IF PS-NO-ABEND-IN-PROGRESS                               60600000
606100             SET PS-ABEND-IN-PROGRESS    TO TRUE                  60610000
606200             STRING 'DEQUEUE '            DELIMITED BY SIZE       60620000
606300                    TD-QUEUE-NAME         DELIMITED BY SIZE       60630000
606400                    ' (INTERNAL READER)'  DELIMITED BY SIZE       60640000
606500                 INTO SE-ATTEMPTED-ACTION                         60650000
606600             MOVE PV-CICS-RESPONSE       TO SE-CICS-RESPONSE      60660000
606700             MOVE SE-SYSTEM-ERROR-MESSAGE                         60670000
606800                                         TO DP013-MESSAGE-TABLE   60680000
606900             MOVE '9600-DEQUEUE-INTERNAL-READER'                  60690000
607000                                         TO DP013-PARAGRAPH       60700000
607100             SET DP013-CICS-ABEND        TO TRUE                  60710000
607200             SET DP013-ROLLBACK          TO TRUE                  60720000
607300             PERFORM 9999-WRITE-CICS-LOG-MSG                      60730000
607400             MOVE PM-NO-PRINT-MSG        TO AMSGLNO               60740000
607500         END-IF                                                   60750000
607600     END-IF.                                                      60760000
607700                                                                  60770000
607800******************************************************************60780000
607900 9999-WRITE-CICS-LOG-MSG.                                         60790000
608000                                                                  60800000
608100     MOVE PC-CURRENT-PROGRAM-NAME    TO DP013-PROGRAM.            60810000
608200     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           60820000
608300     INITIALIZE DP013-SRC-TASK-NUMBER                             60830000
608400                DP013-STACK.                                      60840000
608500     SET DP013-LINK-RETURN           TO TRUE.                     60850000
608600                                                                  60860000
608700     EXEC CICS                                                    60870000
608800         LINK                                                     60880000
608900             PROGRAM   (DP013-NAME)                               60890000
609000             COMMAREA  (DP013-PARAMETERS)                         60900000
609100             LENGTH    (DP013-LENGTH)                             60910000
609200     END-EXEC.                                                    60920000
609300                                                                  60930000
609400******************************************************************60940000
609500 999A-WRITE-CSSL-MSG.                                             60950000
609600                                                                  60960000
609700     MOVE LENGTH OF PV-CICS-MSG-AREA2 TO PV-COMMAREA-LENGTH.      60970000
609800     EXEC CICS                                                    60980000
609900          WRITEQ TD                                               60990000
610000           QUEUE  ('CSSL')                                        61000000
610100            FROM  (PV-CICS-MSG-AREA2)                             61010000
610200          LENGTH  (PV-COMMAREA-LENGTH)                            61020000
610300            RESP  (PV-CICS-RESPONSE)                              61030000
610400     END-EXEC.                                                    61040000
610500                                                                  61050000
610600*----------------------------------------------------------------*61060000
610700*    ABEND PROCESSOR MODULE                                      *61070000
610800*----------------------------------------------------------------*61080000
610900                                                                  61090000
611000     COPY DPPD014.                                                61100000
611100                                                                  61110000
