      *-----------------------*                                         00010000
       IDENTIFICATION DIVISION.                                         00020000
      *-----------------------*                                         00030000
       PROGRAM-ID.    TFKCS436.                                         00040000
       AUTHOR.        JACK KRAMER.                                      00050000
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
       DATE-WRITTEN.  OCTOBER 1996.                                     00070000
       DATE-COMPILED.                                                   00080000
                                                                        00090000
      *---------------------------------------------------------------* 00100000
      *    P436 - TRANSFER LINE DETAIL.                               * 00110000
      *                                                               * 00120000
      *    THIS PROGRAM GENERATES A CHRONOLOGICAL LIST OF BOOKING AND * 00130000
      *    ADJUSTMENT EVENTS FOR A TRANSFER LINE ITEM.  IT ALLOWS     * 00140000
      *    AN EVENT TO BE SELECTED FOR MANUAL ADJUSTMENT, AND         * 00150000
      *    ALLOWS AUTOMATIC REVERSAL OF THE LATEST ADJUSTMENT.        * 00160000
      *                                                               * 00170000
      *---------------------------------------------------------------* 00180000
      *  1/20/2003 - RAY GRAF                                           00181000
      *   PROCESS NONINTELLIGENT SKU.                                   00182000
      ******************************************************************00183000
080204**DATE:08/02/2004 CHANGED BY: RAY GRAF                            00184000
080204**     CHANGE PRINTER DESTINATION TO NEW 8 CHARACTER FORMAT       00185000
      ***************************************************************** 00186000
100404**DATE:10/04/2004 CHANGED BY: RAY GRAF                            00187000
100404**     EXPAND STORE NUMBER. MAKE DOMAIN COMPLIANT.                00188000
      ***************************************************************** 00189000
051705*  DATE 05/17/05 RAY GRAF                                         00189100
051705*  REMOVE PHYSICAL INVENTORY LOGIC                                00189200
051705******************************************************************00189300
SR3403*  DATE 03/14/12 JALAJ KUMAR                                      00189400
SR3403*  AMOUNT FIELD EXPANSION FROM 4 DIGIT TO 5 DIGITS                00189500
SR3403******************************************************************00189600
      * DATE:        09/24/2021                                         00189700
      * WR/IR#:      CHG0261678                                         00189801
      * PROGRAMMER:  GERMAN BANDA                                       00189900
      * DESCRIPTION: CHANGE CALL OF DPKUT100 TO                         00190000
      *              CALL DP010I-NUMERIC-EDIT-ROUTINE                   00190100
      *              MAKING THE CALL DYNAMIC VS STATIC                  00190200
      *----------------------------------------------------------------*00190300
CICS  * CHANGED 11/17/2022    BY JIM HUNTER      WR: CHG0278345         00190402
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00190502
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00190602
CICS  *-----------------------------------------------------------------00190702
       EJECT                                                            00190800
       ENVIRONMENT DIVISION.                                            00190900
                                                                        00191000
       DATA DIVISION.                                                   00192000
                                                                        00200000
       WORKING-STORAGE SECTION.                                         00210000
                                                                        00220000
       01  DK-DB2-KEYS.                                                 00230000
           05  DK-STORE-NBR                   PIC S9(04)  COMP.         00240000
051705*    05  DK-STORE-NBR-9                 PIC S9(04)  VALUE ZEROS   00250000
051705*                                                   COMP.         00260000
           05  DK-XFER-DKEY-ID                PIC S9(09)  COMP.         00270000
           05  DK-XFER-LNE-NBR                PIC S9(04)  COMP.         00280000
           05  DK-PSTG-SEQ-NBR                PIC S9(04)  COMP.         00290000
                                                                        00300000
       01  PC-PROGRAM-CONSTANTS.                                        00310000
           05  PC-099                         PIC  9(03)  VALUE 099.    00320000
           05  PC-100                         PIC  9(03)  VALUE 100.    00330000
           05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00340000
                                                          'TF436A  '.   00350000
           05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00360000
                                                          'TFKM436 '.   00370000
           05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00380000
                                                          'TFKCS436'.   00390000
           05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00400000
           05  PC-SEL-QUEUE-OUT-SEQ           PIC  9(01)  VALUE 2.      00410000
           05  PC-ITEM-INQ-FORMAT             PIC  X(01)  VALUE '1'.    00420000
           05  PC-COMPLETE-CODE               PIC  X(02)  VALUE 'CM'.   00430000
           05  PC-MANUAL-REVERSAL             PIC  X(02)  VALUE 'MR'.   00440000
           05  PC-AUTO-REVERSAL               PIC  X(02)  VALUE 'AR'.   00450000
           05  PC-ITEM-ADD                    PIC  X(02)  VALUE 'IA'.   00460000
           05  PC-ADJUSTMENT                  PIC  X(02)  VALUE 'AD'.   00470000
           05  PC-PRICE-ONLY                  PIC  X(02)  VALUE 'ML'.   00480000
           05  PC-MERCH-LEDGER                PIC  X(02)  VALUE 'ML'.   00490000
           05  PC-FASHION-SALES               PIC  X(02)  VALUE 'FS'.   00500000
           05  PC-RTV                         PIC  X(02)  VALUE 'RV'.   00510000
           05  PC-POSITIVE-RECEIPT            PIC  X(02)  VALUE 'PR'.   00520000
           05  PC-ASSUMPTIVE-RECEIPT          PIC  X(02)  VALUE 'AR'.   00530000
           05  PC-POSITIVE-LITERAL            PIC  X(09)  VALUE         00540000
               '-POSITIVE'.                                             00550000
           05  PC-ASSUMPTIVE-LITERAL          PIC  X(11)  VALUE         00560000
               '-ASSUMPTIVE'.                                           00570000
           05  PC-DISCREP-FORMAT              PIC  X(01)  VALUE '2'.    00580000
           05  PC-HAND-CARRY                  PIC  X(02)  VALUE '05'.   00590000
           05  PC-INIT                        PIC  X(04)  VALUE 'INIT'. 00600000
           05  PC-PUT                         PIC  X(04)  VALUE 'PUT'.  00610000
           05  PC-TERM                        PIC  X(04)  VALUE 'TERM'. 00620000
           05  PC-YES                         PIC  X(01)  VALUE 'Y'.    00630000
           05  PC-TOP-OF-PAGE                 PIC  X(01)  VALUE '1'.    00640000
           05  PC-SINGLE-SPACE                PIC  X(01)  VALUE ' '.    00650000
           05  PC-DOUBLE-SPACE                PIC  X(01)  VALUE '0'.    00660000
           05  PC-MAX-SELECT                  PIC 9(02)  VALUE 8.       00670000
           05  PC-LINE-MAX                    PIC S9(02)  VALUE +60     00680000
                                                          COMP-3.       00690000
           05  PC-RECEIPT-SUB                 PIC S9(04)  VALUE ZERO    00700000
                                                          COMP SYNC.    00710000
           05  PC-RECEIPTS-PER-PANEL          PIC S9(04)  VALUE +3      00720000
                                                          COMP SYNC.    00730000
           05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +7      00740000
                                                          COMP SYNC.    00750000
           05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00760000
                                                          COMP SYNC.    00770000
           05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00780000
                                                          +1000000      00790000
                                                          COMP-3.       00800000
           05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00810000
                                                          COMP SYNC.    00820000
           05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3      00830000
                                                           COMP-3.      00840000
051705*    05  PC-MAX-DATE                 PIC X(10) VALUE '9999-09-09'.00850000
051705*    05  PC-MIN-DATE                 PIC X(10) VALUE '0001-01-01'.00860000
                                                                        00870000
       01  PC-TSYMSG-NUMBERS.                                           00880000
           05  PC-TSYMSG-00005                PIC 9(5)    VALUE 00005.  00890000
           05  PC-TSYMSG-00008                PIC 9(5)    VALUE 00008.  00900000
           05  PC-TSYMSG-00050                PIC 9(5)    VALUE 00050.  00910000
           05  PC-TSYMSG-00057                PIC 9(5)    VALUE 00057.  00920000
           05  PC-TSYMSG-00069                PIC 9(5)    VALUE 00069.  00930000
           05  PC-TSYMSG-00070                PIC 9(5)    VALUE 00070.  00940000
           05  PC-TSYMSG-00098                PIC 9(5)    VALUE 00098.  00950000
           05  PC-TSYMSG-00101                PIC 9(5)    VALUE 00101.  00960000
           05  PC-TSYMSG-00148                PIC 9(5)    VALUE 00148.  00970000
           05  PC-TSYMSG-00279                PIC 9(5)    VALUE 00279.  00980000
           05  PC-TSYMSG-00302                PIC 9(5)    VALUE 00302.  00990000
           05  PC-TSYMSG-00973                PIC 9(5)    VALUE 00973.  01000000
           05  PC-TSYMSG-01403                PIC 9(5)    VALUE 01403.  01010000
           05  PC-TSYMSG-01472                PIC 9(5)    VALUE 01472.  01020000
           05  PC-TSYMSG-01473                PIC 9(5)    VALUE 01473.  01030000
           05  PC-TSYMSG-01474                PIC 9(5)    VALUE 01474.  01040000
           05  PC-TSYMSG-01478                PIC 9(5)    VALUE 01478.  01050000
           05  PC-TSYMSG-01615                PIC 9(5)    VALUE 01615.  01060000
           05  PC-TSYMSG-01659                PIC 9(5)    VALUE 01659.  01070000
                                                                        01080000
       01  PS-PROGRAM-SUBSCRIPTS.                                       01090000
           05  PS-SUB                         PIC S9(04)   VALUE +0     01100000
                                                           COMP SYNC.   01110000
                                                                        01120000
       01  PS-PROGRAM-SWITCHES.                                         01130000
           05  PS-ERROR-SW                    PIC X(01)    VALUE 'Y'.   01140000
               88  PS-NO-ERROR                             VALUE 'Y'.   01150000
               88  PS-ERROR                                VALUE 'N'.   01160000
           05  PS-PRINT-HL8A-SW               PIC X(01)    VALUE 'N'.   01170000
               88  PS-PRINT-HL8A                           VALUE 'Y'.   01180000
           05  PS-PRINT-HL8B-SW               PIC X(01)    VALUE 'N'.   01190000
               88  PS-PRINT-HL8B                           VALUE 'Y'.   01200000
           05  PS-COMMAREA-SW                 PIC X(01)    VALUE 'N'.   01210000
               88  PS-COMMAREA-VALID                       VALUE 'Y'.   01220000
               88  PS-COMMAREA-NOT-VALID                   VALUE 'N'.   01230000
           05  PS-LIST-END-SW                 PIC X(01)    VALUE 'N'.   01240000
               88  PS-LIST-END                             VALUE 'Y'.   01250000
               88  PS-NO-LIST-END                          VALUE 'N'.   01260000
           05  PS-TRANSFER-FOUND-SW     PIC X.                          01270000
               88  PS-TRANSFER-FOUND             VALUE 'Y'.             01280000
               88  PS-TRANSFER-NOT-FOUND         VALUE 'N'.             01290000
           05  PS-TRANSFER-ITEM-FOUND-SW PIC X.                         01300000
               88  PS-TRANSFER-ITEM-FOUND        VALUE 'Y'.             01310000
               88  PS-TRANSFER-ITEM-NOT-FOUND    VALUE 'N'.             01320000
           05  PS-SELECT-LESS-THAN-MAX-SW     PIC X(01).                01330000
               88  PS-SELECT-LESS-THAN-MAX         VALUE 'Y'.           01340000
               88  PS-NO-SELECT-LESS-THAN-MAX      VALUE 'N'.           01350000
           05  PS-SELECT-COMPLETE-SW          PIC X(01).                01360000
               88  PS-SELECT-COMPLETE              VALUE 'Y'.           01370000
               88  PS-NO-SELECT-COMPLETE           VALUE 'N'.           01380000
           05  PS-SELECT-NON-REVERSAL-SW      PIC X(01).                01390000
               88  PS-SELECT-NON-REVERSAL          VALUE 'Y'.           01400000
               88  PS-NO-SELECT-NON-REVERSAL       VALUE 'N'.           01410000
051705*    05  PS-INVENTORY-ERROR-SW     PIC X.                         01420000
051705*        88  PS-INVENTORY-ERROR            VALUE 'Y'.             01430000
051705*        88  PS-NO-INVENTORY-ERROR         VALUE 'N'.             01440000
           EJECT                                                        01450000
       01  PV-PROGRAM-VARIABLES.                                        01460000
           05  PV-LINE-COUNT                  PIC  S9(03)  VALUE +0.    01470000
           05  PV-PAGE-COUNT                  PIC  S9(03)  VALUE +0.    01480000
           05  PV-SUB                         PIC S9(04)  VALUE +0      01490000
                                                          COMP SYNC.    01500000
           05  PV-REMAINDER                   PIC S9(04)   VALUE +0     01510000
                                                           COMP SYNC.   01520000
           05  PV-READ-COUNT                  PIC S9(09)   VALUE +0     01530000
                                                           COMP-3.      01540000
           05  PV-TOP-ITEM                    PIC S9(09)   VALUE +0     01550000
                                                           COMP-3.      01560000
           05  PV-BOTTOM-ITEM                 PIC S9(09)   VALUE +0     01570000
                                                           COMP-3.      01580000
           05  PV-BLOCK-NUMBER                PIC S9(04)   VALUE +0     01590000
                                                           COMP SYNC.   01600000
           05  PV-ITEM                        PIC S9(04)  VALUE +0      01610000
                                                          COMP SYNC.    01620000
           05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01630000
                                                          COMP-3.       01640000
           05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01650000
                                                          COMP SYNC.    01660000
           05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01670000
                                                          COMP-3.       01680000
           05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01690000
                                                          COMP-3.       01700000
           05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01710000
                                                          COMP SYNC.    01720000
           05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01730000
                                                          COMP SYNC.    01740000
           05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01750000
                                                          COMP SYNC.    01760000
           05  PV-CICS-RESP                   PIC S9(04)   VALUE +0     01770000
                                                           COMP SYNC.   01780000
           05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)   VALUE +0     01790000
                                                           COMP SYNC.   01800000
           05  PV-LIST-ITEM-NUMBER            PIC S9(04)   VALUE +0     01810000
                                                           COMP SYNC.   01820000
           05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01830000
                                                          COMP SYNC.    01840000
           05  PV-RETRY-COUNT                 PIC S9(4)    COMP.        01850000
           05  PV-XFER-NBR.                                             01860000
100404*        10  PV-XFER-FROM-STORE         PIC X(03).                01870000
100404         10  PV-XFER-FROM-STORE         PIC X(04).                01880000
               10                             PIC X   VALUE '-'.        01890000
               10  PV-XFER-SEQ-NBR            PIC X(06).                01900000
           05  PV-DPT-CL-SUBCL.                                         01910000
               10  PV-DEPT                    PIC 999.                  01920000
               10  FILLER                     PIC X(01)   VALUE SPACE.  01930000
               10  PV-GROUP-1.                                          01940000
                   15 PV-CLASS-1              PIC 99      VALUE ZEROS.  01950000
                   15 FILLER                  PIC X(01)   VALUE SPACE.  01960000
                   15 PV-SUBCLASS-1           PIC 99      VALUE ZEROS.  01970000
                   15 FILLER                  PIC X(02)   VALUE SPACE.  01980000
               10  PV-GROUP-2 REDEFINES PV-GROUP-1.                     01990000
                   15 PV-CLASS-2              PIC  99.                  01991000
                   15 PV-FILLER-2A            PIC  X(01).               01992000
                   15 PV-SUBCLASS-2           PIC  999.                 01993000
                   15 PV-FILLER-2B            PIC  X(01).               01994000
               10  PV-GROUP-3 REDEFINES PV-GROUP-1.                     01995000
                   15 PV-CLASS-3              PIC  999.                 01996000
                   15 PV-FILLER-3A            PIC  X(01).               01997000
                   15 PV-SUBCLASS-3           PIC  99.                  01998000
                   15 PV-FILLER-3B            PIC  X(01).               01999000
               10  PV-GROUP-4 REDEFINES PV-GROUP-1.                     01999100
                   15 PV-CLASS-4              PIC  999.                 01999200
                   15 PV-FILLER-4A            PIC  X(01).               01999300
                   15 PV-SUBCLASS-4           PIC  999.                 01999400
           05  PV-DATE.                                                 01999500
               10  PV-MONTH                   PIC X(02).                01999600
               10                             PIC X(01)  VALUE '/'.     01999700
               10  PV-DAY                     PIC X(02).                01999800
               10                             PIC X(01)  VALUE '/'.     01999900
               10  PV-YEAR                    PIC X(04).                02000000
           05  PV-UPC                         PIC 99B99999B99999B9.     02010000
           05  FILLER REDEFINES PV-UPC.                                 02020000
               10                             PIC X(02).                02030000
               10  PV-UPC-DASH1               PIC X(01).                02040000
               10                             PIC X(05).                02050000
               10  PV-UPC-DASH2               PIC X(01).                02060000
               10                             PIC X(05).                02070000
               10  PV-UPC-DASH3               PIC X(01).                02080000
               10                             PIC X(01).                02090000
           05  PV-HOLD-UPC-NBR.                                         02100000
               10  PV-KOHLS-UPC-DIGITS        PIC X(06).                02110000
               10  PV-KOHLS-DEPT              PIC 9(03).                02120000
               10  PV-KOHLS-CL.                                         02130000
                   15  PV-KOHLS-CL-1          PIC 9(01).                02140000
                   15  PV-KOHLS-CL-2          PIC 9(01).                02141000
               10  PV-KOHLS-CL-9 REDEFINES PV-KOHLS-CL                  02142000
                                              PIC 9(02).                02143000
               10  PV-KOHLS-DUMMY-SKU         PIC X(03).                02144000
               10  PV-KOHLS-CHECKDIGIT        PIC X(01).                02145000
           05  PV-HOLD-UPC-NBR-9 REDEFINES PV-HOLD-UPC-NBR              02146000
                                              PIC 9(15).                02147000
           05  PV-ABSTIME                      PIC S9(16)  VALUE +0     02148000
                                                           COMP SYNC.   02149000
           05  PV-NULL-IND                     PIC S9(04)  VALUE ZEROS  02150000
                                                           COMP SYNC.   02160000
051705*    05  PV-MAX-FINCL-BK-DTE            PIC  X(10)  VALUE SPACE.  02170000
051705*    05  PV-FR-STR-INV-DTE              PIC  X(10)  VALUE SPACE.  02180000
051705*    05  PV-TO-STR-INV-DTE              PIC  X(10)  VALUE SPACE.  02190000
051705*    05  PV-XFER-INV-CTOFF-DTE          PIC  X(10)  VALUE SPACE.  02200000
051705*    05  PV-LY-INV-CTOFF-DTE            PIC  X(10)  VALUE SPACE.  02210000
051705*    05  PV-MAX-PLND-INV-DTE            PIC  X(10)  VALUE SPACE.  02220000
051705*    05  PV-PHY-INV-PERD-IND            PIC  X(10)  VALUE SPACE.  02230000
051705*    05  PV-CURRENT-DATE                PIC X(10).                02240000
051705*    05  PV-COMPARE-DATE                PIC X(10).                02250000
051705*    05  PV-HOLD-INVENTORY-IND           PIC X(01)   VALUE 'N'.   02260000
051705*        88  PV-HOLD-PHYSICAL-COUNT                  VALUE 'Y'.   02270000
051705*        88  PV-HOLD-FAKE-INVENTORY                  VALUE 'F'.   02280000
051705*        88  PV-HOLD-NO-INVENTORY                    VALUE 'N'.   02290000
051705*    05  PV-FR-INVENTORY-IND             PIC X(01)   VALUE 'N'.   02300000
051705*        88  PV-FR-PHYSICAL-COUNT                    VALUE 'Y'.   02310000
051705*        88  PV-FR-FAKE-INVENTORY                    VALUE 'F'.   02320000
051705*        88  PV-FR-NO-INVENTORY                      VALUE 'N'.   02330000
051705*    05  PV-TO-INVENTORY-IND             PIC X(01)   VALUE 'N'.   02340000
051705*        88  PV-TO-PHYSICAL-COUNT                    VALUE 'Y'.   02350000
051705*        88  PV-TO-FAKE-INVENTORY                    VALUE 'F'.   02360000
051705*        88  PV-TO-NO-INVENTORY                      VALUE 'N'.   02370000
      *--- REPORT LINE DEFINITIONS FOR THE DRS REPORT                   02380000
      *                                                                 02390000
           COPY DPWS132O.                                               02400000
       01  HL2-HEADING-LINE-2.                                          02410000
           05  FILLER                          PIC  X(55)  VALUE SPACE. 02420000
           05  FILLER                          PIC  X(30)  VALUE        02430000
               'TRANSFER LINE DETAIL'.                                  02440000
      *                                                                 02450000
       01  HL3-HEADING-LINE-3.                                          02460000
           05  FILLER                          PIC  X(02)  VALUE SPACE. 02470000
           05  FILLER                          PIC  X(17)  VALUE        02480000
                'TRANSFER NO....:'.                                     02490000
           05  HL3-XFER-NBR.                                            02500000
100404*        10  HL3-XFER-FR-STORE-NBR       PIC X(03).               02510000
100404         10  HL3-XFER-FR-STORE-NBR       PIC X(04).               02520000
               10  HL3-XFER-NBR-DASH           PIC X(01)   VALUE '-'.   02530000
               10  HL3-XFER-SEQ-NBR            PIC X(06).               02540000
           05  FILLER                          PIC  X(53)  VALUE SPACE. 02550000
           05  FILLER                          PIC  X(15)  VALUE        02560000
               'FROM    STORE:'.                                        02570000
100404*    05  HL3-FR-STORE-NBR                PIC  999.                02580000
100404     05  HL3-FR-STORE-NBR                PIC  9(04).              02590000
           05  FILLER                          PIC  X      VALUE SPACE. 02600000
           05  HL3-FR-STORE-NAME               PIC  X(10).              02610000
       01  HL4-HEADING-LINE-4.                                          02620000
           05  FILLER                          PIC  X(83)  VALUE SPACE. 02630000
           05  FILLER                          PIC  X(15)  VALUE        02640000
               'TO      STORE:'.                                        02650000
100404*    05  HL4-TO-STORE-NBR                PIC  999.                02660000
100404     05  HL4-TO-STORE-NBR                PIC  9(04).              02661000
           05  FILLER                          PIC  X      VALUE SPACE. 02662000
           05  HL4-TO-STORE-NAME               PIC  X(10).              02663000
       01  HL5-HEADING-LINE-5.                                          02664000
           05  FILLER                          PIC  X(83)  VALUE SPACE. 02665000
           05  FILLER                          PIC  X(15)  VALUE        02666000
               'RECEIVE STORE:'.                                        02667000
100404*    05  HL5-RC-STORE-NBR                PIC  999.                02668000
100404     05  HL5-RC-STORE-NBR                PIC  9(04).              02669000
           05  FILLER                          PIC  X      VALUE SPACE. 02670000
           05  HL5-RC-STORE-NAME               PIC  X(10).              02680000
       01  HL6-HEADING-LINE-6.                                          02690000
           05  FILLER                          PIC  X(44)  VALUE SPACE. 02700000
           05  FILLER                          PIC  X(15)  VALUE        02710000
             '--TRANSFER--'.                                            02720000
           05  FILLER                          PIC  X(18)  VALUE        02730000
             '--RECEIVED--'.                                            02740000
           05  FILLER                          PIC  X(04)  VALUE        02750000
             'FILE'.                                                    02760000
       01  HL7-HEADING-LINE-7.                                          02770000
           05  FILLER                          PIC  X(09)  VALUE SPACE. 02780000
           05  FILLER                          PIC  X(05)  VALUE 'LN'.  02790000
           05  FILLER                          PIC  X(14)  VALUE        02800000
             'D/M/S     '.                                              02810000
           05  FILLER                          PIC  X(16)  VALUE 'UPC'. 02820000
           05  FILLER                          PIC  X(15)  VALUE        02830000
             'QTY    PRICE'.                                            02840000
           05  FILLER                          PIC  X(17)  VALUE        02850000
             'QTY    PRICE'.                                            02860000
           05  FILLER                          PIC  X(05)  VALUE        02870000
             'PRICE'.                                                   02880000
       01  HL8-HEADING-LINE-8.                                          02890000
           05  FILLER                          PIC  X(08)  VALUE SPACE. 02900000
           05  HL8-LINE                        PIC  ZZ9.                02910000
           05  FILLER                          PIC  X(03)  VALUE SPACE. 02920000
           05  HL8-DPT-CL-SUBCL.                                        02930000
               10  HL8-DEPT                   PIC 999.                  02940000
               10  FILLER                     PIC X(01)   VALUE SPACE.  02950000
               10  HL8-GROUP-1.                                         02960000
                   15 HL8-CLASS-1             PIC 99      VALUE ZEROS.  02970000
                   15 FILLER                  PIC X(01)   VALUE SPACE.  02980000
                   15 HL8-SUBCLASS-1          PIC 99      VALUE ZEROS.  02990000
                   15 FILLER                  PIC X(02)   VALUE SPACE.  02991000
               10  HL8-GROUP-2 REDEFINES HL8-GROUP-1.                   02992000
                   15 HL8-CLASS-2             PIC  99.                  02993000
                   15 HL8-FILLER-2A           PIC  X(01).               02994000
                   15 HL8-SUBCLASS-2          PIC  999.                 02995000
                   15 HL8-FILLER-2B           PIC  X(01).               02996000
               10  HL8-GROUP-3 REDEFINES HL8-GROUP-1.                   02997000
                   15 HL8-CLASS-3             PIC  999.                 02998000
                   15 HL8-FILLER-3A           PIC  X(01).               02999000
                   15 HL8-SUBCLASS-3          PIC  99.                  03000000
                   15 HL8-FILLER-3B           PIC  X(01).               03010000
               10  HL8-GROUP-4 REDEFINES HL8-GROUP-1.                   03020000
                   15 HL8-CLASS-4             PIC  999.                 03030000
                   15 HL8-FILLER-4A           PIC  X(01).               03040000
                   15 HL8-SUBCLASS-4          PIC  999.                 03050000
      ****************************************************************  03051000
           05  FILLER                          PIC  X(02)  VALUE SPACE. 03052000
           05  HL8-UPC                         PIC  99B99999B99999B9.   03053000
           05  FILLER REDEFINES HL8-UPC.                                03054000
               10                              PIC X(02).               03055000
               10  HL8-UPC-DASH-1              PIC X.                   03056000
               10                              PIC X(05).               03057000
               10  HL8-UPC-DASH-2              PIC X.                   03058000
               10                              PIC X(05).               03059000
               10  HL8-UPC-DASH-3              PIC X.                   03060000
               10                              PIC X(01).               03070000
           05  FILLER                          PIC  X(01)  VALUE SPACE. 03080000
           05  HL8-TQTY                        PIC  ZZ9.                03090000
           05  FILLER                          PIC  X(02)  VALUE SPACE. 03100000
SR3403     05  HL8-TPRICE                      PIC  ZZZZZ.99.           03110000
           05  FILLER                          PIC  X(03)  VALUE SPACE. 03120000
           05  HL8-RQTY                        PIC  ZZ9.                03130000
           05  FILLER                          PIC  X(02)  VALUE SPACE. 03140000
SR3403     05  HL8-RPRICE                      PIC  ZZZZZ.99.           03150000
           05  FILLER                          PIC  X(03)  VALUE SPACE. 03160000
SR3403     05  HL8-FPRICE                      PIC  ZZZZZ.99.           03170000
       01  HL8A-HEADING-LINE-8A.                                        03180000
           05  FILLER                          PIC  X(59)  VALUE SPACE. 03190000
           05  HL8A-RQTY                       PIC  ZZ9.                03200000
           05  FILLER                          PIC  X(02)  VALUE SPACE. 03210000
SR3403     05  HL8A-RPRICE                     PIC  ZZZZZ.99.           03220000
       01  HL8B-HEADING-LINE-8B.                                        03230000
           05  FILLER                          PIC  X(59)  VALUE SPACE. 03240000
           05  HL8B-RQTY                       PIC  ZZ9.                03250000
           05  FILLER                          PIC  X(02)  VALUE SPACE. 03260000
SR3403     05  HL8B-RPRICE                     PIC  ZZZZZ.99.           03270000
       01  HL9-HEADING-LINE-9.                                          03280000
           05  FILLER                          PIC  X(06)  VALUE SPACE. 03290000
           05  FILLER                          PIC  X(13)  VALUE 'DATE'.03300000
           05  FILLER                          PIC  X(15)  VALUE        03310000
             'FROM STORE'.                                              03320000
           05  FILLER                          PIC  X(19)  VALUE        03330000
             '    TO STORE'.                                            03340000
           05  FILLER                          PIC  X(07)  VALUE 'QTY'. 03350000
           05  FILLER                          PIC  X(08)  VALUE        03360000
             'PRICE'.                                                   03370000
           05  FILLER                          PIC  X(13)  VALUE        03380000
             'EXT PRICE'.                                               03390000
           05  FILLER                          PIC  X(06)  VALUE        03400000
             'REASON'.                                                  03410000
       01  DL1-DETAIL-LINE-1.                                           03420000
           05  FILLER                          PIC  X(04)  VALUE SPACE. 03430000
           05  DL1-DATE                        PIC  X(10).              03440000
           05  FILLER                          PIC  X(03)  VALUE SPACE. 03450000
100404*    05  DL1-FROM-NBR                    PIC  X(03)  VALUE SPACE. 03460000
100404     05  DL1-FROM-NBR                    PIC  X(04)  VALUE SPACE. 03470000
           05  FILLER                          PIC  X(01)  VALUE SPACE. 03480000
           05  DL1-FROM-NAM                    PIC  X(10)  VALUE SPACE. 03490000
           05  FILLER                          PIC  X(03)  VALUE SPACE. 03500000
100404*    05  DL1-TO-NBR                      PIC  X(03)  VALUE SPACE. 03510000
100404     05  DL1-TO-NBR                      PIC  X(04)  VALUE SPACE. 03520000
           05  FILLER                          PIC  X(01)  VALUE SPACE. 03530000
           05  DL1-TO-NAM                      PIC  X(10)  VALUE SPACE. 03540000
           05  FILLER                          PIC  X(03)  VALUE SPACE. 03550000
           05  DL1-QTY                         PIC  ZZ9.                03560000
           05  FILLER                          PIC  X(02)  VALUE SPACE. 03570000
SR3403     05  DL1-PRICE                       PIC  ZZZZZ.99-.          03580000
           05  FILLER                          PIC  X(02)  VALUE SPACE. 03590000
           05  DL1-EXT-PRICE                   PIC  ZZ,ZZZ.99-.         03600000
           05  FILLER                          PIC  X(03)  VALUE SPACE. 03610000
           05  DL1-REASON                      PIC  X(20).              03620000
       01  BL-BLANK-LINE.                                               03630000
           05  FILLER                          PIC  X(80)  VALUE SPACE. 03640000
       01  AL-ASTERISK-LINE.                                            03650000
           05  FILLER                          PIC  X(114)  VALUE       03660000
                ALL '*'.                                                03670000
       EJECT                                                            03680000
      ******************************************************************03690000
      **  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **03700000
      **  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **03710000
      **  APPLICATION-SPECIFIC COMMAREA.                              **03720000
      ******************************************************************03730000
       01  LQW-LIST-QUEUE-WORK-AREA.                                    03740000
           05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  03750000
           05  LQW-ITEM-ENTRIES               OCCURS 7 TIMES            03760000
                                              INDEXED BY LQW-IDX.       03770000
               10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       03780000
               10  LQW-TEMP-SELECTED-SW       PIC  X(01).               03790000
               10  LQW-SELECTED-SW            PIC  X(01).               03800000
                   88  LQW-SELECT                         VALUE 'S'.    03810000
                   88  LQW-DESELECT                       VALUE ' '.    03820000
               10  LQW-DATE.                                            03830000
                   15  LQW-DTE-YEAR           PIC X(04).                03840000
                   15                         PIC X(01).                03850000
                   15  LQW-DTE-MONTH          PIC X(02).                03860000
                   15                         PIC X(01).                03870000
                   15  LQW-DTE-DAY            PIC X(02).                03880000
100404*        10  LQW-DTL-FR-NBR             PIC 9(03).                03890000
100404         10  LQW-DTL-FR-NBR             PIC 9(04).                03900000
               10  LQW-DTL-FR-NAM-10          PIC X(10).                03910000
               10  LQW-DTL-FR-NAM-5           PIC X(05).                03920000
100404*        10  LQW-DTL-TO-NBR             PIC 9(03).                03930000
100404         10  LQW-DTL-TO-NBR             PIC 9(04).                03940000
               10  LQW-DTL-TO-NAM-10          PIC X(10).                03950000
               10  LQW-DTL-TO-NAM-5           PIC X(05).                03960000
               10  LQW-DTL-FR-QTY             PIC S9(04)     COMP-3.    03970000
               10  LQW-PRICE                  PIC S9(07)V99  COMP-3.    03980000
               10  LQW-FR-EXT-PRICE           PIC S9(07)V99  COMP-3.    03990000
               10  LQW-EXTL-SYS-PRCG-CDE      PIC X(02).                04000000
               10  LQW-REASON-CDE             PIC X(02).                04010000
100404*        10  LQW-REASON                 PIC X(23).                04020000
SR3403         10  LQW-REASON                 PIC X(18).                04030000
               10  LQW-PSTG-SEQ-NBR           PIC S9(04)     COMP-3.    04040000
                                                                        04050000
           EJECT                                                        04060000
                                                                        04070000
      *----------------------------------------------------------------*04080000
      *  RF COPYBOOK TO FORMAT PRINTER DESTINATION                      04081000
      *----------------------------------------------------------------*04082000
080204     COPY RFWS009.                                                04083000
                                                                        04084000
      *---------------------------------------------------------------* 04085000
      *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 04086002
      *---------------------------------------------------------------* 04087000
                                                                        04088000
           COPY DPWS030.                                                04089000
CICS       COPY DPWS930.                                                04089102
       EJECT                                                            04090000
      *---------------------------------------------------------------* 04100000
      *    STANDARD COMMAREA.                                         * 04110000
      *---------------------------------------------------------------* 04120000
                                                                        04130000
           COPY DPWS020.                                                04140000
           05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                04150000
                                                                        04160000
      *---------------------------------------------------------------* 04170000
      *    INTER-APPLICATION COMMAREA.                                * 04180000
      *---------------------------------------------------------------* 04190000
                                                                        04200000
               10  INTER-APPL-COMM-AREA       PIC X(200).               04210000
           COPY TFWS001.                                                04220000
           COPY TFWS003.                                                04230000
      *---------------------------------------------------------------* 04240000
      *    SPECIFIC COMMMAREA FOR DPKCS040.                           * 04250000
      *---------------------------------------------------------------* 04260000
               10  ASC-SPECIFIC-COMMAREA.                               04270000
                   15  ASC-LIST-KEYS.                                   04280000
                       20  ASC-KEY-XFER-DKEY-ID            PIC S9(09)   04290000
                                                           COMP-3.      04300000
                       20  ASC-KEY-XFER-LNE-NBR            PIC S9(04)   04310000
                                                           COMP-3.      04320000
                       20  ASC-KEY-PSTG-SEQ-NBR            PIC S9(04)   04330000
                                                           COMP-3.      04340000
                   15  ASC-MAX-POSTING-SEQ-NBR             PIC S9(04)   04350000
                                                           COMP.        04360000
                   15  ASC-MAX-DATE                        PIC X(10).   04370000
                   15  ASC-CMPLT-DATE                      PIC X(10).   04380000
                   15  ASC-XFER-STATUS                     PIC X(02).   04390000
                   15  ASC-CONTNR-TYP-CDE                  PIC X(02).   04400000
                   15  ASC-XFER-SEQ-NBR                    PIC 9(06).   04410000
100404*            15  ASC-FROM-STORE-NBR                  PIC 9(03).   04420000
100404             15  ASC-FROM-STORE-NBR                  PIC S9(04)   04430000
100404                                                     COMP-3.      04440000
                   15  ASC-FROM-STORE-NAM                  PIC X(10).   04450000
100404*            15  ASC-TO-STORE-NBR                    PIC 9(03).   04460000
100404             15  ASC-TO-STORE-NBR                    PIC S9(04)   04470000
100404                                                     COMP-3.      04480000
                   15  ASC-TO-STORE-NAM                    PIC X(10).   04490000
100404*            15  ASC-RECV-STORE-NBR                  PIC 9(03).   04500000
100404             15  ASC-RECV-STORE-NBR                  PIC S9(04)   04510000
100404                                                     COMP-3.      04511000
                   15  ASC-RECV-STORE-NAM                  PIC X(10).   04512000
                   15  ASC-LINE-NBR                        PIC 9(03).   04513000
                   15  ASC-DP-CL-SUBCL.                                 04514000
                       20  ASC-DEPT                        PIC 9(03).   04515000
                       20  ASC-CLASS                       PIC 9(03).   04516000
                       20  ASC-SUBCLASS                    PIC 9(03).   04517000
                   15  ASC-UPC                             PIC 9(13).   04518000
                   15  ASC-TQTY                            PIC S9(03)   04519000
                                                           COMP-3.      04520000
                   15  ASC-TPRICE                          PIC S9(05)V9904530000
                                                           COMP-3.      04540000
                   15  ASC-RECEIPT-ENTRY OCCURS 3 TIMES.                04550000
                       20  ASC-RQTY                        PIC S9(03)   04560000
                                                           COMP-3.      04570000
                       20  ASC-RPRICE                      PIC S9(05)V9904580000
                                                           COMP-3.      04590000
                   15  ASC-FPRICE                          PIC S9(05)V9904600000
                                                           COMP-3.      04610000
                   15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                04620000
                       20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  04630000
                           88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   04640000
                           88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   04650000
                       20  ASC-ITEM-ARRAY.                              04660000
                                                                        04670000
                           25  ASC-ITEM-ENTRIES OCCURS 7 TIMES.         04680000
                               30  ASC-LIST-ITEM-NUMBER    PIC S9(09)   04690000
                                                           COMP-3.      04700000
                               30  ASC-TEMP-SELECTED-SW    PIC  X(01).  04710000
                                   88  ASC-VALID-SELECT    VALUE ' '    04720000
                                                                 'S'.   04730000
                                   88  ASC-TEMP-NO-SELECT  VALUE ' '.   04740000
                                   88  ASC-TEMP-SELECT     VALUE 'S'.   04750000
                               30  ASC-SELECTED-SW         PIC  X(01).  04760000
                                   88  ASC-NO-SELECT       VALUE ' '.   04770000
                                   88  ASC-SELECT          VALUE 'S'.   04780000
                               30  ASC-DATE.                            04790000
                                   35  ASC-DTE-YEAR        PIC X(04).   04800000
                                   35                      PIC X(01).   04810000
                                   35  ASC-DTE-MONTH       PIC X(02).   04820000
                                   35                      PIC X(01).   04830000
                                   35  ASC-DTE-DAY         PIC X(02).   04840000
100404*                        30  ASC-DTL-FR-NBR          PIC 9(03).   04850000
100404                         30  ASC-DTL-FR-NBR          PIC 9(04).   04860000
                               30  ASC-DTL-FR-NAM-10       PIC X(10).   04870000
                               30  ASC-DTL-FR-NAM-5        PIC X(05).   04880000
100404*                        30  ASC-DTL-TO-NBR          PIC 9(03).   04890000
100404                         30  ASC-DTL-TO-NBR          PIC 9(04).   04900000
                               30  ASC-DTL-TO-NAM-10       PIC X(10).   04910000
                               30  ASC-DTL-TO-NAM-5        PIC X(05).   04920000
                               30  ASC-DTL-FR-QTY          PIC S9(04)   04930000
                                                           COMP-3.      04940000
                               30  ASC-DTL-PRICE           PIC S9(07)V9904950000
                                                           COMP-3.      04960000
                               30  ASC-DTL-FR-EXT          PIC S9(07)V9904970000
                                                           COMP-3.      04980000
                               30  ASC-EXTL-SYS-PRCG-CDE   PIC X(02).   04990000
                               30  ASC-REASON-CDE          PIC X(02).   05000000
100404*                        30  ASC-REASON              PIC X(23).   05010000
SR3403                         30  ASC-REASON              PIC X(18).   05020000
                               30  ASC-PSTG-SEQ-NBR        PIC S9(04)   05030000
                                                           COMP-3.      05040000
                                                                        05050000
                   15  ASC-INSERTED-ENTRY  OCCURS 8 TIMES.              05060000
                       20  ASC-INSERTED-PSTG-SEQ-NBR       PIC S9(04)   05070000
                                                           COMP.        05080000
                   15  ASC-BLK-SUB                         PIC S9(04)   05090000
                                                               COMP     05100000
                                                               SYNC.    05110000
                   15  ASC-ITEM-SUB                        PIC S9(04)   05120000
                                                               COMP     05130000
                                                               SYNC.    05140000
                   15  ASC-RECEIPT-SUB                     PIC S9(04)   05150000
                                                               COMP     05160000
                                                               SYNC.    05170000
                   15  ASC-SEL-SUB                         PIC S9(04)   05180000
                                                               COMP.    05190000
                   15  ASC-SEL-ITEM                        PIC S9(04)   05200000
                                                               COMP.    05210000
                   15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   05220000
                                                               COMP-3.  05230000
                   15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   05240000
                                                               COMP-3.  05250000
                   15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   05260000
                                                               COMP-3.  05270000
                   15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   05280000
                                                               COMP-3.  05290000
                   15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   05300000
                                                               COMP-3.  05310000
                   15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   05320000
                                                               COMP-3.  05330000
                   15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   05340000
                                                               COMP     05350000
                                                               SYNC.    05360000
                   15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   05370000
                                                               COMP-3.  05380000
                   15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   05390000
                                                               COMP-3.  05400000
                   15  ASC-PROCESS-COMMENTS-SW     PIC X(01).           05410000
                       88  ASC-PROCESS-COMMENTS         VALUE 'Y'.      05420000
                       88  ASC-NO-PROCESS-COMMENTS      VALUE ' '.      05430000
                   15  ASC-REVERSE-REQUEST-SW      PIC X(01).           05440000
                       88  ASC-REVERSE-REQUEST          VALUE 'Y'.      05450000
                       88  ASC-NO-REVERSE-REQUEST       VALUE ' '.      05460000
                   15  ASC-PRINT-REQUEST-SW      PIC X(01).             05470000
                       88  ASC-PRINT-DOC-REQUEST        VALUE 'D'.      05480000
                       88  ASC-PRINT-LIST-REQUEST       VALUE 'L'.      05490000
                       88  ASC-NO-PRINT-REQUEST         VALUE 'N'.      05500000
                   15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  05510000
                       88  ASC-ITEMS-LEFT-ON-DB              VALUE 'Y'. 05520000
                       88  ASC-NO-ITEMS-LEFT-ON-DB           VALUE 'N'. 05530000
                   15  ASC-ITEMS-LEFT-INDICATOR-2          PIC  X(01).  05540000
                       88  ASC-ITEMS-LEFT-ON-DB-2            VALUE 'Y'. 05550000
                       88  ASC-NO-ITEMS-LEFT-ON-DB-2         VALUE 'N'. 05560000
                   15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  05570000
                       88  ASC-UPDATE-TSQ                  VALUE 'Y'.   05580000
                       88  ASC-NO-TSQ-UPDATE               VALUE ' '.   05590000
                   15  ASC-USE-SELECTION-QUEUE-IND         PIC  X(01).  05600000
                       88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 05610000
                   15  ASC-LIST-QUEUE-NAME.                             05620000
                       20  ASC-LIST-TERM-ID                PIC  X(04).  05630000
                       20  ASC-LIST-TASK-NUMBER            PIC S9(05)   05640000
                                                               COMP-3.  05650000
                       20  ASC-LIST-SEQ                    PIC  9(01).  05660000
                   15  ASC-SEL-QUEUE-IN-NAME.                           05670000
                       20  ASC-SEL-IN-TERM-ID              PIC  X(04).  05680000
                       20  ASC-SEL-IN-TASK-NUMBER          PIC S9(05)   05690000
                                                                COMP-3. 05700000
                       20  ASC-SEL-IN-SEQ                  PIC  9(01).  05710000
                   15  ASC-SEL-QUEUE-OUT-NAME.                          05720000
                       20  ASC-SEL-OUT-TERM-ID             PIC  X(04).  05730000
                       20  ASC-SEL-OUT-TASK-NUMBER         PIC S9(05)   05740000
                                                                COMP-3. 05750000
                       20  ASC-SEL-OUT-SEQ                 PIC  9(01).  05760000
                   15  ASC-START-ITEM-REQUEST.                          05770000
                       20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  05780000
                                                                        05790000
           EJECT                                                        05800000
      *                                                                 05810000
      *  LAYOUT FOR THE DRS (DYNAMIC REPORT SYSTEM) COMMAREA            05820000
      *                                                                 05830000
           COPY DRRD001O.                                               05840000
                                                                        05850000
      *                                                                 05860000
      *  LAYOUT FOR THE DRS (DYNAMIC REPORT SYSTEM) DETAIL LINES        05870000
      *                                                                 05880000
           COPY DRRD002O.                                               05890000
      *---------------------------------------------------------------* 05900000
      *  RECORD LAYOUT FOR THE TRANSFER SELECTION TEMP STORAGE QUEUE. * 05910000
      *---------------------------------------------------------------* 05920000
      *   TFWS002 - IS THE INPUT TEMP STORAGE LAYOUT WHEN COMING FROM * 05930000
      *             THE TRANSFER DISCREPANCY PROGRAM.                 * 05940000
      *   TFWS004 - IS THE OUTPUT TEMP STORAGE LAYOUT WHEN GOING TO   * 05950000
      *             THE TRANSFER LINE REVERSAL PROGRAM.               * 05960000
      *---------------------------------------------------------------* 05970000
                                                                        05980000
           COPY TFWS002.                                                05990000
                                                                        06000000
           COPY TFWS004.                                                06010000
                                                                        06020000
           EJECT                                                        06030000
      *---------------------------------------------------------------* 06040000
      *    ABEND PROCESSING COPYBOOK.                                 * 06050000
      *---------------------------------------------------------------* 06060000
                                                                        06070000
           COPY DPWS013.                                                06080000
                                                                        06090000
           EJECT                                                        06100000
      *---------------------------------------------------------------* 06110000
      *    ATTRIBUTE SETTINGS COPYBOOK.                               * 06120000
      *---------------------------------------------------------------* 06130000
                                                                        06140000
           COPY DPWS015.                                                06150000
                                                                        06160000
      *---------------------------------------------------------------* 06170000
      *    FUNCTION KEYS COPYBOOK.                                    * 06180000
      *---------------------------------------------------------------* 06190000
                                                                        06200000
           COPY DPWS016.                                                06210000
                                                                        06220000
      *---------------------------------------------------------------* 06230000
      *    NUMERIC EDIT LAYOUT.                                       * 06240000
      *---------------------------------------------------------------* 06250000
                                                                        06260000
           COPY DPWS010I.                                               06270000
                                                                        06280000
      *---------------------------------------------------------------* 06290000
      *    MAP LAYOUT                                                 * 06300000
      *---------------------------------------------------------------* 06310000
                                                                        06320000
           COPY TFKM436.                                                06330000
                                                                        06340000
       01  MR-MAP-REDEFINITION       REDEFINES  TF436AO.                06350000
           05  FILLER                PIC X(12).                         06360000
                                                                        06370000
           05  MR-XFER-NBR-L         PIC S9(04) COMP.                   06380000
           05  MR-XFER-NBR-A         PIC  X(01).                        06390000
           05  MR-XFER-NBR-C         PIC  X(01).                        06400000
           05  MR-XFER-NBR-H         PIC  X(01).                        06410000
100404*    05  MR-XFER-NBR           PIC  X(10).                        06420000
100404     05  MR-XFER-NBR           PIC  X(11).                        06430000
                                                                        06440000
           05  MR-FR-STR-NBR-L       PIC S9(04) COMP.                   06450000
           05  MR-FR-STR-NBR-A       PIC  X(01).                        06460000
           05  MR-FR-STR-NBR-C       PIC  X(01).                        06470000
           05  MR-FR-STR-NBR-H       PIC  X(01).                        06480000
100404*    05  MR-FR-STR-NBR         PIC  X(03).                        06490000
100404     05  MR-FR-STR-NBR         PIC  X(04).                        06500000
                                                                        06510000
           05  MR-FR-STR-NAM-L       PIC S9(04) COMP.                   06520000
           05  MR-FR-STR-NAM-A       PIC  X(01).                        06530000
           05  MR-FR-STR-NAM-C       PIC  X(01).                        06540000
           05  MR-FR-STR-NAM-H       PIC  X(01).                        06550000
           05  MR-FR-STR-NAM         PIC  X(10).                        06560000
                                                                        06570000
           05  MR-TO-STR-NBR-L       PIC S9(04) COMP.                   06580000
           05  MR-TO-STR-NBR-A       PIC  X(01).                        06590000
           05  MR-TO-STR-NBR-C       PIC  X(01).                        06600000
           05  MR-TO-STR-NBR-H       PIC  X(01).                        06610000
100404*    05  MR-TO-STR-NBR         PIC  X(03).                        06620000
100404     05  MR-TO-STR-NBR         PIC  X(04).                        06630000
                                                                        06640000
           05  MR-TO-STR-NAM-L       PIC S9(04) COMP.                   06650000
           05  MR-TO-STR-NAM-A       PIC  X(01).                        06660000
           05  MR-TO-STR-NAM-C       PIC  X(01).                        06670000
           05  MR-TO-STR-NAM-H       PIC  X(01).                        06680000
           05  MR-TO-STR-NAM         PIC  X(10).                        06690000
                                                                        06700000
           05  MR-RC-STR-NBR-L       PIC S9(04) COMP.                   06710000
           05  MR-RC-STR-NBR-A       PIC  X(01).                        06720000
           05  MR-RC-STR-NBR-C       PIC  X(01).                        06730000
           05  MR-RC-STR-NBR-H       PIC  X(01).                        06740000
100404*    05  MR-RC-STR-NBR         PIC  X(03).                        06750000
100404     05  MR-RC-STR-NBR         PIC  X(04).                        06760000
                                                                        06770000
           05  MR-RC-STR-NAM-L       PIC S9(04) COMP.                   06780000
           05  MR-RC-STR-NAM-A       PIC  X(01).                        06790000
           05  MR-RC-STR-NAM-C       PIC  X(01).                        06800000
           05  MR-RC-STR-NAM-H       PIC  X(01).                        06810000
           05  MR-RC-STR-NAM         PIC  X(10).                        06820000
                                                                        06830000
           05  MR-LNE-NBR-L          PIC S9(04) COMP.                   06840000
           05  MR-LNE-NBR-A          PIC  X(01).                        06850000
           05  MR-LNE-NBR-C          PIC  X(01).                        06860000
           05  MR-LNE-NBR-H          PIC  X(01).                        06870000
           05  MR-LNE-NBR            PIC  ZZ9.                          06880000
                                                                        06890000
           05  MR-DPT-CL-SUBCL-L     PIC S9(04) COMP.                   06900000
           05  MR-DPT-CL-SUBCL-A     PIC  X(01).                        06910000
           05  MR-DPT-CL-SUBCL-C     PIC  X(01).                        06920000
           05  MR-DPT-CL-SUBCL-H     PIC  X(01).                        06930000
           05  MR-DPT-CL-SUBCL       PIC  X(11).                        06940000
                                                                        06950000
           05  MR-UPC-L              PIC S9(04) COMP.                   06960000
           05  MR-UPC-A              PIC  X(01).                        06970000
           05  MR-UPC-C              PIC  X(01).                        06980000
           05  MR-UPC-H              PIC  X(01).                        06990000
           05  MR-UPC                PIC  X(16).                        07000000
                                                                        07010000
           05  MR-TQTY-L             PIC S9(04) COMP.                   07020000
           05  MR-TQTY-A             PIC  X(01).                        07030000
           05  MR-TQTY-C             PIC  X(01).                        07040000
           05  MR-TQTY-H             PIC  X(01).                        07050000
           05  MR-TQTY-X.                                               07060000
               10  MR-TQTY           PIC  ZZ9.                          07070000
                                                                        07080000
           05  MR-TPRICE-L           PIC S9(04) COMP.                   07090000
           05  MR-TPRICE-A           PIC  X(01).                        07100000
           05  MR-TPRICE-C           PIC  X(01).                        07110000
           05  MR-TPRICE-H           PIC  X(01).                        07120000
           05  MR-TPRICE-X.                                             07130000
SR3403         10  MR-TPRICE         PIC  ZZZZZ.99.                     07140000
                                                                        07150000
           05  MR-RQTY1-L            PIC S9(04) COMP.                   07160000
           05  MR-RQTY1-A            PIC  X(01).                        07170000
           05  MR-RQTY1-C            PIC  X(01).                        07180000
           05  MR-RQTY1-H            PIC  X(01).                        07190000
           05  MR-RQTY1-X.                                              07200000
               10  MR-RQTY1          PIC  ZZZ.                          07210000
                                                                        07220000
           05  MR-RPRICE1-L          PIC S9(04) COMP.                   07230000
           05  MR-RPRICE1-A          PIC  X(01).                        07240000
           05  MR-RPRICE1-C          PIC  X(01).                        07250000
           05  MR-RPRICE1-H          PIC  X(01).                        07260000
           05  MR-RPRICE1-X.                                            07270000
SR3403         10  MR-RPRICE1        PIC  ZZZZZ.ZZ.                     07280000
                                                                        07290000
           05  MR-FPRICE-L           PIC S9(04) COMP.                   07300000
           05  MR-FPRICE-A           PIC  X(01).                        07310000
           05  MR-FPRICE-C           PIC  X(01).                        07320000
           05  MR-FPRICE-H           PIC  X(01).                        07330000
SR3403     05  MR-FPRICE             PIC  ZZZZZ.99.                     07340000
                                                                        07350000
           05  MR-RQTY2-L            PIC S9(04) COMP.                   07360000
           05  MR-RQTY2-A            PIC  X(01).                        07370000
           05  MR-RQTY2-C            PIC  X(01).                        07380000
           05  MR-RQTY2-H            PIC  X(01).                        07390000
           05  MR-RQTY2-X.                                              07400000
               10  MR-RQTY2          PIC  ZZZ.                          07410000
                                                                        07420000
           05  MR-RPRICE2-L          PIC S9(04) COMP.                   07430000
           05  MR-RPRICE2-A          PIC  X(01).                        07440000
           05  MR-RPRICE2-C          PIC  X(01).                        07450000
           05  MR-RPRICE2-H          PIC  X(01).                        07460000
           05  MR-RPRICE2-X.                                            07470000
SR3403         10  MR-RPRICE2        PIC  ZZZZZ.ZZ.                     07480000
                                                                        07490000
           05  MR-RQTY3-L            PIC S9(04) COMP.                   07500000
           05  MR-RQTY3-A            PIC  X(01).                        07510000
           05  MR-RQTY3-C            PIC  X(01).                        07520000
           05  MR-RQTY3-H            PIC  X(01).                        07530000
           05  MR-RQTY3-X.                                              07540000
               10  MR-RQTY3          PIC  ZZZ.                          07550000
                                                                        07560000
           05  MR-RPRICE3-L          PIC S9(04) COMP.                   07570000
           05  MR-RPRICE3-A          PIC  X(01).                        07580000
           05  MR-RPRICE3-C          PIC  X(01).                        07590000
           05  MR-RPRICE3-H          PIC  X(01).                        07600000
           05  MR-RPRICE3-X.                                            07610000
SR3403         10  MR-RPRICE3        PIC  ZZZZZ.ZZ.                     07620000
      *                                                                 07630000
           05 MR-STARTL                   PIC S9(04) COMP.              07640000
           05 MR-STARTA                   PIC  X(01).                   07650000
           05 MR-STARTC                   PIC  X(01).                   07660000
           05 MR-STARTH                   PIC  X(01).                   07670000
           05 MR-START                    PIC 9(05).                    07680000
      *                                                                 07690000
           05 MR-ENDL                     PIC S9(04) COMP.              07700000
           05 MR-ENDA                     PIC  X(01).                   07710000
           05 MR-ENDC                     PIC  X(01).                   07720000
           05 MR-ENDH                     PIC  X(01).                   07730000
           05 MR-END                      PIC 9(05).                    07740000
      *                                                                 07750000
           05 MR-TOTALL                   PIC S9(04) COMP.              07760000
           05 MR-TOTALA                   PIC  X(01).                   07770000
           05 MR-TOTALC                   PIC  X(01).                   07780000
           05 MR-TOTALH                   PIC  X(01).                   07790000
           05 MR-TOTAL                    PIC 9(05).                    07800000
                                                                        07810000
           05  MR-SCROLL-AREA OCCURS 7 TIMES.                           07820000
               10  MR-SEL-L          PIC S9(04) COMP.                   07830000
               10  MR-SEL-A          PIC  X(01).                        07840000
               10  MR-SEL-C          PIC  X(01).                        07850000
               10  MR-SEL-H          PIC  X(01).                        07860000
               10  MR-SEL            PIC  X(01).                        07870000
      *                                                                 07880000
               10  MR-DATE-L         PIC S9(04) COMP.                   07890000
               10  MR-DATE-A         PIC  X(01).                        07900000
               10  MR-DATE-C         PIC  X(01).                        07910000
               10  MR-DATE-H         PIC  X(01).                        07920000
               10  MR-DATE           PIC  X(10).                        07930000
      *                                                                 07940000
               10  MR-DTL-FR-NBR-L   PIC S9(04) COMP.                   07950000
               10  MR-DTL-FR-NBR-A   PIC  X(01).                        07960000
               10  MR-DTL-FR-NBR-C   PIC  X(01).                        07970000
               10  MR-DTL-FR-NBR-H   PIC  X(01).                        07980000
100404*        10  MR-DTL-FR-NBR     PIC  X(03).                        07990000
100404         10  MR-DTL-FR-NBR     PIC  X(04).                        08000000
      *                                                                 08010000
               10  MR-DTL-FR-NAM-L   PIC S9(04) COMP.                   08020000
               10  MR-DTL-FR-NAM-A   PIC  X(01).                        08030000
               10  MR-DTL-FR-NAM-C   PIC  X(01).                        08040000
               10  MR-DTL-FR-NAM-H   PIC  X(01).                        08050000
               10  MR-DTL-FR-NAM     PIC  X(05).                        08060000
      *                                                                 08070000
               10  MR-DTL-TO-NBR-L   PIC S9(04) COMP.                   08080000
               10  MR-DTL-TO-NBR-A   PIC  X(01).                        08090000
               10  MR-DTL-TO-NBR-C   PIC  X(01).                        08100000
               10  MR-DTL-TO-NBR-H   PIC  X(01).                        08110000
100404*        10  MR-DTL-TO-NBR     PIC  X(03).                        08120000
100404         10  MR-DTL-TO-NBR     PIC  X(04).                        08121000
      *                                                                 08122000
               10  MR-DTL-TO-NAM-L   PIC S9(04) COMP.                   08123000
               10  MR-DTL-TO-NAM-A   PIC  X(01).                        08124000
               10  MR-DTL-TO-NAM-C   PIC  X(01).                        08125000
               10  MR-DTL-TO-NAM-H   PIC  X(01).                        08126000
               10  MR-DTL-TO-NAM     PIC  X(05).                        08127000
      *                                                                 08128000
               10  MR-DTL-FR-QTY-L   PIC S9(04) COMP.                   08129000
               10  MR-DTL-FR-QTY-A   PIC  X(01).                        08130000
               10  MR-DTL-FR-QTY-C   PIC  X(01).                        08140000
               10  MR-DTL-FR-QTY-H   PIC  X(01).                        08150000
               10  MR-DTL-FR-QTY.                                       08160000
                   15  MR-DTL-FR-QTY-N  PIC  ZZ9.                       08170000
      *                                                                 08180000
               10  MR-DTL-FR-PRC-L   PIC S9(04) COMP.                   08190000
               10  MR-DTL-FR-PRC-A   PIC  X(01).                        08200000
               10  MR-DTL-FR-PRC-C   PIC  X(01).                        08210000
               10  MR-DTL-FR-PRC-H   PIC  X(01).                        08220000
               10  MR-DTL-FR-PRC.                                       08230000
SR3403             15  MR-DTL-FR-PRC-N  PIC  ZZZZZ.99.                  08240000
      *                                                                 08250000
               10  MR-DTL-FR-EXT-L   PIC S9(04) COMP.                   08260000
               10  MR-DTL-FR-EXT-A   PIC  X(01).                        08270000
               10  MR-DTL-FR-EXT-C   PIC  X(01).                        08280000
               10  MR-DTL-FR-EXT-H   PIC  X(01).                        08290000
               10  MR-DTL-FR-EXT.                                       08300000
                   15  MR-DTL-FR-EXT-N   PIC  ZZZZZZ.99.                08310000
      *                                                                 08320000
               10  MR-REASON-L       PIC S9(04) COMP.                   08330000
               10  MR-REASON-A       PIC  X(01).                        08340000
               10  MR-REASON-C       PIC  X(01).                        08350000
               10  MR-REASON-H       PIC  X(01).                        08360000
100404*        10  MR-REASON         PIC  X(23).                        08370000
SR3403         10  MR-REASON         PIC  X(18).                        08380000
      *                                                                 08390000
      *                                                                 08400000
       EJECT                                                            08410000
      *---------------------------------------------------------------* 08420000
      *    DB2 AREA FOR TRANSFER TABLE                                * 08430000
      *---------------------------------------------------------------* 08440000
           EXEC SQL                                                     08450000
                INCLUDE TTFMSTR                                         08460000
           END-EXEC.                                                    08470000
      *---------------------------------------------------------------* 08480000
      *    DB2 AREA FOR TRANSFER ITEM TABLE                           * 08490000
      *---------------------------------------------------------------* 08500000
           EXEC SQL                                                     08510000
                INCLUDE TTFITEM                                         08520000
           END-EXEC.                                                    08530000
      *---------------------------------------------------------------* 08540000
      *    DB2 AREA FOR THE TRANSFER ITEM RECEIPT TABLE               * 08550000
      *---------------------------------------------------------------* 08560000
           EXEC SQL                                                     08570000
                INCLUDE TTFITRC                                         08580000
           END-EXEC.                                                    08590000
      *---------------------------------------------------------------* 08600000
      *    DB2 AREA FOR TTFRCPT (TRANSFER RECEIPT TABLE)                08610000
      *---------------------------------------------------------------* 08620000
           EXEC SQL                                                     08630000
                INCLUDE TTFRCPT                                         08640000
           END-EXEC.                                                    08650000
      *---------------------------------------------------------------* 08660000
      *    DB2 AREA FOR THE TRANSFER STATUS TABLE                     * 08670000
      *---------------------------------------------------------------* 08680000
           EXEC SQL                                                     08690000
                INCLUDE TTFSTAT                                         08700000
           END-EXEC.                                                    08710000
      *---------------------------------------------------------------* 08720000
      *    DB2 AREA FOR THE TRANSFER STATUS CODE TABLE                * 08730000
      *---------------------------------------------------------------* 08740000
           EXEC SQL                                                     08750000
                INCLUDE TTFSTCD                                         08760000
           END-EXEC.                                                    08770000
      *---------------------------------------------------------------* 08780000
      *    DB2 AREA FOR TTFAJRS (TRANSFER ADJUSTMENT REASON CODE TABLE) 08790000
      *---------------------------------------------------------------* 08800000
           EXEC SQL                                                     08810000
                INCLUDE TTFAJRS                                         08820000
           END-EXEC.                                                    08830000
      *---------------------------------------------------------------* 08840000
      *    DB2 AREA FOR TTFITPS (TRANSFER ITEM POSTING TABLE)         * 08850000
      *---------------------------------------------------------------* 08860000
           EXEC SQL                                                     08870000
                INCLUDE TTFITPS                                         08880000
           END-EXEC.                                                    08890000
      *---------------------------------------------------------------* 08900000
100404*    DB2 AREA FOR XST_LOC TABLE                                 * 08910000
      *---------------------------------------------------------------* 08920000
           EXEC SQL                                                     08930000
100404          INCLUDE XST00001                                        08940000
           END-EXEC.                                                    08950000
051705*---------------------------------------------------------------* 08960000
051705*    DB2 AREA FOR TRANSFER CONTROL TABLE                        * 08970000
051705*---------------------------------------------------------------* 08980000
051705*    EXEC SQL                                                     08990000
051705*         INCLUDE TTFCNTL                                         09000000
051705*    END-EXEC.                                                    09010000
051705*---------------------------------------------------------------* 09020000
051705*    DB2 AREA FOR INVENTORY PARAMETERS TABLE                    * 09030000
051705*---------------------------------------------------------------* 09040000
051705*    EXEC SQL                                                     09050000
051705*         INCLUDE TINVPAR                                         09060000
051705*    END-EXEC.                                                    09070000
      *---------------------------------------------------------------* 09080000
      *    DB2 AREA FOR SKU CROSS REFERENCE TABLE                     * 09090000
      *---------------------------------------------------------------* 09100000
           EXEC SQL                                                     09110000
                INCLUDE TSKXREF                                         09120000
           END-EXEC.                                                    09130000
      *---------------------------------------------------------------* 09140000
      *    DB2 AREA FOR COMMUNICATIONS                                * 09150000
      *---------------------------------------------------------------* 09160000
           EXEC SQL                                                     09170000
                INCLUDE SQLCA                                           09180000
           END-EXEC.                                                    09190000
                                                                        09200000
      *---------------------------------------------------------------* 09210000
      *    CURSOR TO OBTAIN ITEM POSTINGS.                            * 09220000
      *---------------------------------------------------------------* 09230000
                                                                        09240000
           EXEC SQL                                                     09250000
                DECLARE POSTING-CSR CURSOR                              09260000
                FOR SELECT                                              09270000
                      PSTG_SEQ_NBR                                      09280000
                    , P.ADJ_RSN_CDE                                     09290000
                    , ITM_PSTG_PRPD_TMST                                09300000
                    , FRM_PSTG_STR_NBR                                  09310000
                    , TO_PSTG_STR_NBR                                   09320000
                    , ITM_RTL_PRCE_AMT                                  09330000
                    , ITM_QTY                                           09340000
                    , EXTL_SYS_PRCG_CDE                                 09350000
                    , ADJ_RSN_DESC                                      09360000
                FROM                                                    09370000
                      TTFITPS P                                         09380000
                     ,TTFAJRS A                                         09390000
                WHERE                                                   09400000
                      XFER_DKEY_ID   = :DK-XFER-DKEY-ID     AND         09410000
                      XFER_LNE_NBR   = :DK-XFER-LNE-NBR     AND         09420000
                      A.ADJ_RSN_CDE  = P.ADJ_RSN_CDE                    09430000
                ORDER BY                                                09440000
                      ITM_PSTG_PRPD_TMST                                09450000
                    , PSTG_SEQ_NBR                                      09460000
100404          WITH UR                                                 09470000
           END-EXEC.                                                    09480000
                                                                        09490000
      *---------------------------------------------------------------* 09500000
      *    CURSOR TO RETRIEVE TRANSFER RECEIPT ITEMS                  * 09510000
      *---------------------------------------------------------------* 09520000
                                                                        09530000
           EXEC SQL                                                     09540000
                DECLARE XFER-RECEIPT-CSR CURSOR                         09550000
                FOR SELECT                                              09560000
                      RCVD_XFER_PRIC_AMT                                09570000
                    , RCVD_XFER_QTY                                     09580000
                FROM                                                    09590000
                      TTFITRC I                                         09600000
                     ,TTFSTAT S                                         09610000
                WHERE                                                   09620000
                      I.XFER_DKEY_ID     = :DK-XFER-DKEY-ID        AND  09630000
                      S.XFER_DKEY_ID     = I.XFER_DKEY_ID          AND  09640000
                      S.XFER_STAT_CDE    = :PC-POSITIVE-RECEIPT    AND  09650000
                      S.XFER_STAT_TMST   = I.XFER_RCPT_TMST        AND  09660000
                      RCVD_XFER_PRIC_AMT <> :TFITEM-XFER-PRIC-AMT  AND  09670000
                      XFER_LNE_NBR       = :DK-XFER-LNE-NBR             09680000
                ORDER BY                                                09690000
                      RCVD_XFER_PRIC_AMT                                09700000
100404          WITH UR                                                 09701000
           END-EXEC.                                                    09702000
                                                                        09703000
       EJECT                                                            09704000
       LINKAGE SECTION.                                                 09705000
                                                                        09706000
       01  DFHCOMMAREA.                                                 09707000
           05  FILLER                         OCCURS  1 TO 4072 TIMES   09708000
                                              DEPENDING ON EIBCALEN.    09709000
               10  FILLER                     PIC X.                    09710000
                                                                        09720000
       EJECT                                                            09730000
       PROCEDURE DIVISION.                                              09740000
                                                                        09750000
       0000-MAIN-MODULE.                                                09760000
                                                                        09770000
           INITIALIZE DP030-CICS-API-FIELDS.                            09780000
           MOVE +1                      TO DP030-NUMBER-OF-MAPS.        09790000
           MOVE PC-CURRENT-MAPSET-NAME  TO DP030-MAPSET-NAME.           09800000
           MOVE PC-CURRENT-MAP-NAME     TO DP030-MAP-NAME (1).          09810000
           SET DP030-RECEIVE-APPL-MAP   TO TRUE.                        09820000
           MOVE LENGTH OF TF436AI       TO DP030-MAP-LENGTH (1).        09830000
           MOVE 'PROGRAM ENTRY CALL'    TO DP013-MESSAGE-TEXT (1).      09840000
           PERFORM 0001-CALL-CICS-ARCH-API.                             09850000
                                                                        09860000
           PERFORM 1000-CONTROL-PROCESSING.                             09870000
                                                                        09880000
           MOVE 'PROGRAM EXIT CALL'     TO DP013-MESSAGE-TEXT (1).      09890000
           PERFORM 0001-CALL-CICS-ARCH-API.                             09900000
                                                                        09910000
      *----------------------------------------------------------------*09920000
      *   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *09930000
      *   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *09940000
      *----------------------------------------------------------------*09950000
                                                                        09960000
       0001-CALL-CICS-ARCH-API.                                         09970000
                                                                        09980000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      09990002
                                          DFHCOMMAREA                   10000002
                                          DP030-CICS-API-FIELDS         10010002
                                          DP020-STANDARD-COMMAREA       10020002
                                          TF436AI.                      10030002
                                                                        10040000
           IF  DP030-RC-CALL-SUCCESSFUL                                 10050000
               CONTINUE                                                 10060000
           ELSE                                                         10070000
               SET DP013-NO-ROLLBACK TO TRUE                            10080000
               SET DP013-XCTL-DISPLAY-RESTART TO TRUE                   10090000
               SET DP013-CICS-ABEND TO TRUE                             10100000
               MOVE 'BEFORE 0000-MAIN-MODULE' TO DP013-PARAGRAPH        10110000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O10111002
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      10112002
               MOVE DP030-RETURN-CODE                                   10140000
                                     TO DP013-MESSAGE-TEXT (3)          10150000
               PERFORM DP013-0000-PROCESS-ABEND                         10160000
           END-IF.                                                      10170000
                                                                        10180000
      *----------------------------------------------------------------*10190000
      * PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *10200000
      * COURSE OF ACTION IS FOR THIS TRANSACTION.                      *10210000
      *                                                                *10220000
      * NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *10230000
      *  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *10240000
      *  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *10250000
      *  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *10260000
      *----------------------------------------------------------------*10270000
                                                                        10280000
       1000-CONTROL-PROCESSING.                                         10290000
                                                                        10300000
           EVALUATE TRUE                                                10310000
               WHEN DP020-NEXT-ACT-INITIAL                              10320000
                   INITIALIZE ASC-SPECIFIC-COMMAREA                     10330000
                   MOVE EIBTRMID          TO ASC-LIST-TERM-ID           10340000
                                             ASC-SEL-OUT-TERM-ID        10350000
                   MOVE DP020-SRC-TASK-NUMBER                           10360000
                                          TO ASC-LIST-TASK-NUMBER       10370000
                                             ASC-SEL-OUT-TASK-NUMBER    10380000
                   MOVE PC-LIST-QUEUE-SEQ TO ASC-LIST-SEQ               10390000
                   MOVE PC-SEL-QUEUE-OUT-SEQ TO ASC-SEL-OUT-SEQ         10400000
                   PERFORM 1100-PROCESS-INTER-APPL-COMM                 10410000
      ***-----$TEMPLATE NOTE$-------------------------------------------10420000
      *** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,10430000
      *** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  10440000
      *** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.10450000
      ***---------------------------------------------------------------10460000
                   IF  PS-COMMAREA-NOT-VALID                            10470000
      ***              MOVE PC-TSYMSG-99901                             10480000
      ***                            TO  DP020-MSG-NUMBER               10490000
      ***              SET DP020-MSG-FATAL                              10500000
      ***                            TO  TRUE                           10510000
                       SET DP020-NEXT-ACT-APPL-ERROR                    10520000
                                     TO  TRUE                           10530000
                   ELSE                                                 10540000
                       SET PS-TRANSFER-NOT-FOUND  TO TRUE               10550000
                       PERFORM 4100-GET-TRANSFER                        10560000
                       IF PS-TRANSFER-FOUND                             10570000
                           SET PS-TRANSFER-ITEM-NOT-FOUND  TO TRUE      10580000
                           PERFORM 4200-GET-TRANSFER-ITEM               10590000
                           IF PS-TRANSFER-ITEM-FOUND                    10600000
                               PERFORM 2050-DELETE-LIST-QUEUE           10610000
                               PERFORM 4000-BUILD-INITIAL-PANEL         10620000
                           ELSE                                         10630000
                               MOVE PC-TSYMSG-00148                     10640000
                                     TO DP020-MSG-NUMBER                10650000
                               SET DP020-MSG-FATAL                      10660000
                               DP020-NEXT-ACT-APPL-ERROR  TO TRUE       10670000
                           END-IF                                       10680000
                       ELSE                                             10690000
                           MOVE PC-TSYMSG-00148                         10700000
                                     TO DP020-MSG-NUMBER                10710000
                           SET DP020-MSG-FATAL                          10720000
                           DP020-NEXT-ACT-APPL-ERROR  TO TRUE           10730000
                       END-IF                                           10740000
                   END-IF                                               10750000
                                                                        10760000
               WHEN DP020-NEXT-ACT-READ-MAP                             10770000
                   MOVE ASC-ITEM-AT-TOP-OF-PANEL                        10780000
                                     TO PV-TOP-ITEM                     10790000
                   PERFORM 2000-PROCESS-PANEL                           10800000
                                                                        10810000
               WHEN DP020-NEXT-ACT-RETURN                               10820000
                   SET ASC-NO-REVERSE-REQUEST TO TRUE                   10830000
                   IF ASC-PROCESS-COMMENTS                              10840000
                       SET ASC-NO-PROCESS-COMMENTS  TO TRUE             10850000
                       MOVE ASC-KEY-XFER-DKEY-ID                        10860000
                                         TO  DK-XFER-DKEY-ID            10870000
                       MOVE ASC-KEY-XFER-LNE-NBR                        10880000
                                         TO  DK-XFER-LNE-NBR            10890000
                       PERFORM 2050-DELETE-LIST-QUEUE                   10900000
                       PERFORM 4000-BUILD-INITIAL-PANEL                 10910000
                   ELSE                                                 10920000
                       IF ASC-PRINT-LIST-REQUEST        AND             10930000
                             TF001-PRINT-YES            AND             10940000
                             TF001-PRINTER-DEST NOT = SPACES            10950000
                           PERFORM 6300-PRINT-LIST                      10960000
                           MOVE PC-TSYMSG-00098                         10970000
                                         TO DP020-MSG-NUMBER            10980000
                           SET DP020-MSG-INFORMATIONAL  TO TRUE         10990000
                           SET ASC-NO-PRINT-REQUEST TO TRUE             11000000
                       END-IF                                           11010000
                       MOVE ASC-ITEM-AT-TOP-OF-PANEL                    11020000
                                     TO PV-TOP-ITEM                     11030000
                       MOVE ZERO         TO ASC-ITEM-AT-TOP-OF-PANEL    11040000
                       PERFORM 6000-REFRESH-PANEL-FROM-TEMP             11050000
                       PERFORM 3000-EDIT-DATA-IN-COMMAREA               11060000
                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             11070000
                   END-IF                                               11080000
                                                                        11090000
               WHEN OTHER                                               11100000
                   SET DP013-LOGIC-ABEND TO TRUE                        11110000
                   SET DP013-NO-ROLLBACK TO TRUE                        11120000
                   MOVE '1000-CONTROL-PROCESSING'                       11130000
                                     TO  DP013-PARAGRAPH                11140000
                   MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    11150000
                                     TO  DP013-MESSAGE-TEXT(1)          11160000
                   PERFORM DP013-0000-PROCESS-ABEND                     11170000
           END-EVALUATE.                                                11180000
                                                                        11190000
       EJECT                                                            11200000
      *----------------------------------------------------------------*11210000
      * DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA.      *11220000
      *----------------------------------------------------------------*11230000
                                                                        11240000
       1100-PROCESS-INTER-APPL-COMM.                                    11250000
                                                                        11260000
           SET PS-COMMAREA-VALID     TO TRUE.                           11270000
           MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     11280000
           EVALUATE DP020-INT-APPL-FORMAT-IND                           11290000
               WHEN PC-DISCREP-FORMAT                                   11300000
               WHEN PC-ITEM-INQ-FORMAT                                  11310000
                   SET ASC-USE-SELECTION-QUEUE TO TRUE                  11320000
                   MOVE TF003-NUMBER-OF-TS-ITEMS                        11330000
                                     TO ASC-NUMBER-OF-TS-ITEMS          11340000
                   MOVE TF003-SEL-QUEUE-NAME                            11350000
                                     TO ASC-SEL-QUEUE-IN-NAME           11360000
                   MOVE TF003-XFER-DKEY-ID                              11370000
                                     TO ASC-KEY-XFER-DKEY-ID            11380000
                                        DK-XFER-DKEY-ID                 11390000
                   PERFORM 1120-PREPARE-LIST-ENTRY                      11400000
               WHEN OTHER                                               11410000
                   MOVE PC-TSYMSG-00148                                 11420000
                                     TO DP020-MSG-NUMBER                11430000
                   SET DP020-MSG-FATAL TO TRUE                          11440000
                   SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                11450000
           END-EVALUATE.                                                11460000
                                                                        11470000
      *----------------------------------------------------------------*11480000
      *    GET READY TO START AT THE FIRST ITEM ON THE LIST.           *11490000
      *----------------------------------------------------------------*11500000
                                                                        11510000
       1120-PREPARE-LIST-ENTRY.                                         11520000
                                                                        11530000
           MOVE TF002-MAX-ITEMS TO ASC-SEL-SUB.                         11540000
           MOVE ZERO            TO ASC-SEL-ITEM.                        11550000
           PERFORM 2140-GET-NEXT-LINE.                                  11560000
       EJECT                                                            11570000
      *----------------------------------------------------------------*11580000
      *    RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED *11590000
      *    ON WHAT FUNCTION KEY WAS SELECTED.                          *11600000
      *----------------------------------------------------------------*11610000
                                                                        11620000
       2000-PROCESS-PANEL.                                              11630000
                                                                        11640000
           EVALUATE TRUE                                                11650000
                                                                        11660000
      *---  PRINT LIST  --------------------------------------------*   11670000
               WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              11680000
                   SET ASC-NO-REVERSE-REQUEST TO TRUE                   11690000
                   SET ASC-PRINT-LIST-REQUEST TO TRUE                   11700000
                   INITIALIZE TF001-DRS-DATA                            11710000
080204             MOVE DP020-LOCATION-NBR    TO RFWS009-STORE-NBR      11720000
080204             MOVE RFWS009-STORE-PRINTER-DEST                      11730000
080204                                        TO TF001-PRINTER-DEST     11740000
                                                                        11750000
               WHEN DP020-SRC-AID = DP016-CLEAR                         11760000
                   SET ASC-NO-REVERSE-REQUEST TO TRUE                   11770000
                   MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                11780000
                   PERFORM 3200-RESET-ATTRIBUTES                        11790000
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11800000
                                                                        11810000
               WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    11820000
                   PERFORM 2160-DESELECT-ALL-ITEMS                      11830000
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11840000
                                                                        11850000
               WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    11860000
                   SET ASC-NO-REVERSE-REQUEST TO TRUE                   11870000
                   MOVE ASC-KEY-XFER-DKEY-ID                            11880000
                                     TO  DK-XFER-DKEY-ID                11890000
                   MOVE ASC-KEY-XFER-LNE-NBR                            11900000
                                     TO  DK-XFER-LNE-NBR                11910000
                   SET PS-TRANSFER-NOT-FOUND  TO TRUE                   11920000
                   PERFORM 4100-GET-TRANSFER                            11930000
                   IF PS-TRANSFER-FOUND                                 11940000
                       SET PS-TRANSFER-ITEM-NOT-FOUND  TO TRUE          11950000
                       INITIALIZE ASC-RECEIPT-ENTRY (1)                 11960000
                                  ASC-RECEIPT-ENTRY (2)                 11970000
                                  ASC-RECEIPT-ENTRY (3)                 11980000
                       PERFORM 4200-GET-TRANSFER-ITEM                   11990000
                       IF PS-TRANSFER-ITEM-FOUND                        12000000
                           PERFORM 2050-DELETE-LIST-QUEUE               12010000
                           PERFORM 4000-BUILD-INITIAL-PANEL             12020000
                       ELSE                                             12030000
                           MOVE PC-TSYMSG-00148                         12040000
                                 TO DP020-MSG-NUMBER                    12050000
                           SET DP020-MSG-FATAL                          12060000
                           DP020-NEXT-ACT-APPL-ERROR  TO TRUE           12070000
                       END-IF                                           12080000
                   ELSE                                                 12090000
                       MOVE PC-TSYMSG-00148                             12100000
                                    TO DP020-MSG-NUMBER                 12110000
                       SET DP020-MSG-FATAL                              12120000
                       DP020-NEXT-ACT-APPL-ERROR  TO TRUE               12130000
                   END-IF                                               12140000
                                                                        12150000
               WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             12160000
                   SET ASC-NO-REVERSE-REQUEST TO TRUE                   12170000
                   IF  ASC-USE-SELECTION-QUEUE                          12180000
                       MOVE ASC-KEY-XFER-DKEY-ID  TO DK-XFER-DKEY-ID    12190000
                       PERFORM 2140-GET-NEXT-LINE                       12200000
                       IF PS-LIST-END                                   12210000
                           PERFORM 3200-RESET-ATTRIBUTES                12220000
                           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         12230000
                           SET PS-NO-LIST-END TO TRUE                   12240000
                       ELSE                                             12250000
                           SET PS-TRANSFER-ITEM-NOT-FOUND  TO TRUE      12260000
                           INITIALIZE ASC-RECEIPT-ENTRY (1)             12270000
                                      ASC-RECEIPT-ENTRY (2)             12280000
                                      ASC-RECEIPT-ENTRY (3)             12290000
                           PERFORM 4200-GET-TRANSFER-ITEM               12300000
                           IF PS-TRANSFER-ITEM-FOUND                    12310000
                               PERFORM 2050-DELETE-LIST-QUEUE           12320000
                               PERFORM 3200-RESET-ATTRIBUTES            12330000
                               PERFORM 4000-BUILD-INITIAL-PANEL         12340000
                           ELSE                                         12350000
                               MOVE PC-TSYMSG-00148                     12360000
                                       TO DP020-MSG-NUMBER              12370000
                               SET DP020-MSG-FATAL TO TRUE              12380000
                           END-IF                                       12390000
                       END-IF                                           12400000
                   ELSE                                                 12410000
                       MOVE PC-TSYMSG-00070                             12420000
                                        TO DP020-MSG-NUMBER             12430000
                       SET DP020-MSG-INFORMATIONAL TO TRUE              12440000
                   END-IF                                               12450000
                                                                        12460000
               WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             12470000
                   SET ASC-NO-REVERSE-REQUEST TO TRUE                   12480000
                   IF  ASC-USE-SELECTION-QUEUE                          12490000
                       MOVE ASC-KEY-XFER-DKEY-ID  TO DK-XFER-DKEY-ID    12500000
                       PERFORM 2150-GET-PREV-LINE                       12510000
                       IF PS-LIST-END                                   12520000
                           PERFORM 3200-RESET-ATTRIBUTES                12530000
                           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         12540000
                           SET PS-NO-LIST-END TO TRUE                   12550000
                       ELSE                                             12560000
                           SET PS-TRANSFER-ITEM-NOT-FOUND  TO TRUE      12570000
                           INITIALIZE ASC-RECEIPT-ENTRY (1)             12580000
                                      ASC-RECEIPT-ENTRY (2)             12590000
                                      ASC-RECEIPT-ENTRY (3)             12600000
                           PERFORM 4200-GET-TRANSFER-ITEM               12610000
                           IF PS-TRANSFER-ITEM-FOUND                    12620000
                               PERFORM 2050-DELETE-LIST-QUEUE           12630000
                               PERFORM 3200-RESET-ATTRIBUTES            12640000
                               PERFORM 4000-BUILD-INITIAL-PANEL         12650000
                           ELSE                                         12660000
                               MOVE PC-TSYMSG-00148                     12670000
                                     TO DP020-MSG-NUMBER                12680000
                               SET DP020-MSG-FATAL TO TRUE              12690000
                           END-IF                                       12700000
                       END-IF                                           12710000
                   ELSE                                                 12720000
                       MOVE PC-TSYMSG-00069                             12730000
                                        TO DP020-MSG-NUMBER             12740000
                       SET DP020-MSG-INFORMATIONAL TO TRUE              12750000
                   END-IF                                               12760000
                                                                        12770000
               WHEN OTHER                                               12780000
                   PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 12790000
                   PERFORM 3000-EDIT-DATA-IN-COMMAREA                   12800000
                   IF  PS-NO-ERROR                                      12810000
                       SET DP030-CONTINUE-GO                            12820000
                                       TO TRUE                          12830000
                       PERFORM 2100-CHECK-FUNCTION-KEY                  12840000
                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             12850000
                   ELSE                                                 12860000
                       SET DP030-OVERRIDE-GO                            12870000
                                       TO TRUE                          12880000
                   END-IF                                               12890000
                                                                        12900000
           END-EVALUATE.                                                12910000
       EJECT                                                            12920000
      *----------------------------------------------------------------*12930000
      *    DELETE THE TEMPORARY STORAGE QUEUE.                         *12940000
      *----------------------------------------------------------------*12950000
                                                                        12960000
       2050-DELETE-LIST-QUEUE.                                          12970000
                                                                        12980000
           EXEC CICS                                                    12990000
               DELETEQ TS                                               13000000
                   QUEUE (ASC-LIST-QUEUE-NAME)                          13010000
                   RESP  (PV-CICS-RESP)                                 13020000
           END-EXEC.                                                    13030000
                                                                        13040000
           IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       13050000
              (PV-CICS-RESP = DFHRESP(QIDERR))                          13060000
               CONTINUE                                                 13070000
           ELSE                                                         13080000
               SET DP013-CICS-ABEND TO TRUE                             13090000
               SET DP013-NO-ROLLBACK TO TRUE                            13100000
                                                                        13110000
               MOVE '2050-DELETE-LIST-QUEUE' TO DP013-PARAGRAPH         13120000
               MOVE 'ERROR TRYING TO DELETE DETAIL TEMP STORAGE QUEUE'  13130000
                              TO DP013-MESSAGE-TEXT (1)                 13140000
               PERFORM DP013-0000-PROCESS-ABEND                         13150000
           END-IF.                                                      13160000
                                                                        13170000
           MOVE +0 TO ASC-HIGHEST-BLOCK-WRITTEN.                        13180000
      *----------------------------------------------------------------*13190000
      * ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*13200000
      * NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *13210000
      * CICS ARCHITECTURE API.                                         *13220000
      *----------------------------------------------------------------*13230000
       2100-CHECK-FUNCTION-KEY.                                         13240000
           EVALUATE TRUE                                                13250000
                                                                        13260000
      *----- MANUAL ---------------------------------------------------*13270000
               WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               13280000
                   SET ASC-NO-REVERSE-REQUEST TO TRUE                   13290000
                   IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              13300000
                       IF ASC-NUMBER-OF-SELECTED-ITEMS > 1              13310000
                           MOVE PC-TSYMSG-00973   TO DP020-MSG-NUMBER   13320000
                           SET DP020-MSG-FATAL    TO TRUE               13330000
                           SET DP030-OVERRIDE-GO  TO TRUE               13340000
                       ELSE                                             13350000
                               INITIALIZE TF003-INTER-APPL-COMMAREA     13360000
                               MOVE ASC-NUMBER-OF-SELECTED-ITEMS        13370000
                                      TO TF003-NUMBER-OF-SELECTED-ITEMS 13380000
                               PERFORM 5000-PREPARE-SEL-QUEUE-OUT       13390000
                               SET ASC-PROCESS-COMMENTS    TO TRUE      13400000
                       END-IF                                           13410000
                   ELSE                                                 13420000
                       SET DP030-OVERRIDE-GO                            13430000
                                         TO TRUE                        13440000
                       MOVE PC-TSYMSG-00057                             13450000
                                         TO DP020-MSG-NUMBER            13460000
                       SET DP020-MSG-WARNING                            13470000
                                         TO TRUE                        13480000
                   END-IF                                               13490000
                                                                        13500000
      *----- REVERSE --------------------------------------------------*13510000
               WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)               13520000
                   IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              13530000
                       IF ASC-NUMBER-OF-SELECTED-ITEMS > PC-MAX-SELECT  13540000
                           MOVE PC-TSYMSG-01478   TO DP020-MSG-NUMBER   13550000
                           MOVE PC-MAX-SELECT     TO DP020-MSG-TEXT     13560000
                           SET DP020-MSG-FATAL    TO TRUE               13570000
                           SET DP030-OVERRIDE-GO  TO TRUE               13580000
                       ELSE                                             13590000
                           PERFORM 2300-VALIDATE-SELECTIONS             13600000
                           IF PS-SELECT-COMPLETE                        13610000
                               SET DP030-OVERRIDE-GO                    13620000
                                             TO TRUE                    13630000
                               MOVE PC-TSYMSG-01472                     13640000
                                             TO DP020-MSG-NUMBER        13650000
                               SET DP020-MSG-FATAL                      13660000
                                             TO TRUE                    13670000
                           ELSE                                         13680000
                               IF PS-SELECT-LESS-THAN-MAX               13690000
                                   SET DP030-OVERRIDE-GO                13700000
                                                 TO TRUE                13710000
                                   MOVE PC-TSYMSG-01473                 13720000
                                             TO DP020-MSG-NUMBER        13730000
                                   SET DP020-MSG-FATAL                  13740000
                                             TO TRUE                    13750000
                               ELSE                                     13760000
                                 IF ASC-REVERSE-REQUEST                 13770000
                                     PERFORM 7000-REVERSE               13780000
                                     SET ASC-PROCESS-COMMENTS TO TRUE   13790000
                                 ELSE                                   13800000
051705*                            SET PS-NO-INVENTORY-ERROR  TO TRUE   13810000
051705*                            PERFORM 7300-CHECK-INVENTORY-CUTOFF  13820000
051705*                            IF PS-NO-INVENTORY-ERROR             13830000
                                     SET ASC-REVERSE-REQUEST TO TRUE    13840000
                                     MOVE PC-TSYMSG-01403               13850000
                                                    TO DP020-MSG-NUMBER 13860000
                                     MOVE 'F21-REVERSE'                 13870000
                                                      TO DP020-MSG-TEXT 13880000
                                     SET DP020-MSG-INFORMATIONAL        13890000
                                         DP030-OVERRIDE-GO      TO TRUE 13900000
051705*                            END-IF                               13910000
                                 END-IF                                 13920000
                               END-IF                                   13930000
                           END-IF                                       13940000
                       END-IF                                           13950000
                   ELSE                                                 13960000
                       SET DP030-OVERRIDE-GO                            13970000
                                         TO TRUE                        13980000
                       MOVE PC-TSYMSG-00057                             13990000
                                         TO DP020-MSG-NUMBER            14000000
                       SET DP020-MSG-WARNING                            14010000
                                         TO TRUE                        14020000
                   END-IF                                               14030000
                                                                        14040000
      *----- COMMENT --------------------------------------------------*14050000
               WHEN DP020-FK-LOCAL-FUNC-03(DP020-SRC-AID)               14060000
                   SET ASC-NO-REVERSE-REQUEST TO TRUE                   14070000
                   IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              14080000
                       IF ASC-NUMBER-OF-SELECTED-ITEMS > 1              14090000
                           MOVE PC-TSYMSG-00973   TO DP020-MSG-NUMBER   14100000
                           SET DP020-MSG-FATAL    TO TRUE               14110000
                           SET DP030-OVERRIDE-GO  TO TRUE               14120000
                       ELSE                                             14130000
                           PERFORM 2300-VALIDATE-SELECTIONS             14140000
                           IF PS-SELECT-NON-REVERSAL                    14150000
                               SET DP030-OVERRIDE-GO                    14160000
                                             TO TRUE                    14170000
                               MOVE PC-TSYMSG-01474                     14180000
                                             TO DP020-MSG-NUMBER        14190000
                               SET DP020-MSG-FATAL                      14200000
                                             TO TRUE                    14210000
                           ELSE                                         14220000
                               INITIALIZE TF003-INTER-APPL-COMMAREA     14230000
                               MOVE ASC-NUMBER-OF-SELECTED-ITEMS        14240000
                                      TO TF003-NUMBER-OF-SELECTED-ITEMS 14250000
                               MOVE ASC-KEY-XFER-DKEY-ID                14260000
                                      TO TF003-XFER-DKEY-ID             14270000
                               MOVE ASC-KEY-XFER-LNE-NBR                14280000
                                      TO TF003-XFER-LNE-NBR             14290000
                               MOVE ASC-XFER-SEQ-NBR                    14300000
                                      TO TF003-XFER-SEQ-NBR             14310000
                               MOVE ASC-FROM-STORE-NBR                  14320000
                                      TO TF003-FR-STR-NBR               14330000
                               MOVE ASC-FROM-STORE-NAM                  14340000
                                      TO TF003-FR-STR-NAM               14350000
                               MOVE ASC-TO-STORE-NBR                    14360000
                                      TO TF003-TO-STR-NBR               14370000
                               MOVE ASC-TO-STORE-NAM                    14380000
                                      TO TF003-TO-STR-NAM               14390000
                               MOVE ASC-RECV-STORE-NBR                  14400000
                                      TO TF003-RC-STR-NBR               14410000
                               MOVE ASC-RECV-STORE-NAM                  14420000
                                      TO TF003-RC-STR-NAM               14430000
                              PERFORM 5000-PREPARE-SEL-QUEUE-OUT        14440000
                           END-IF                                       14450000
                       END-IF                                           14460000
                   ELSE                                                 14470000
                       SET DP030-OVERRIDE-GO                            14480000
                                         TO TRUE                        14490000
                       MOVE PC-TSYMSG-00057                             14500000
                                         TO DP020-MSG-NUMBER            14510000
                       SET DP020-MSG-WARNING                            14520000
                                         TO TRUE                        14530000
                   END-IF                                               14540000
                                                                        14550000
               WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  14560000
                   SET ASC-NO-REVERSE-REQUEST TO TRUE                   14570000
                   MOVE +1               TO PV-TOP-ITEM                 14580000
                                                                        14590000
               WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   14600000
                   SET ASC-NO-REVERSE-REQUEST TO TRUE                   14610000
                   PERFORM 2110-BROWSE-BACKWARD                         14620000
                                                                        14630000
               WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   14640000
                   SET ASC-NO-REVERSE-REQUEST TO TRUE                   14650000
                   PERFORM 2120-BROWSE-FORWARD                          14660000
                                                                        14670000
               WHEN DP020-SRC-AID = DP016-ENTER                         14680000
                   SET ASC-NO-REVERSE-REQUEST TO TRUE                   14690000
                   PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   14700000
      *            IF  PS-ERROR                                         14710000
      *                CONTINUE                                         14720000
      *            ELSE                                                 14730000
      *                PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             14740000
      *            END-IF                                               14750000
      *            PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 14760000
                                                                        14770000
               WHEN OTHER                                               14780000
                   SET DP013-NO-ROLLBACK                                14790000
                       DP013-XCTL-DISPLAY-RESTART                       14800000
                       DP013-CICS-ABEND  TO TRUE                        14810000
                   MOVE '2100-CHECK-FUNCTION-KEY'                       14820000
                                         TO DP013-PARAGRAPH             14830000
                   MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      14840000
                                         TO DP013-MESSAGE-TEXT (1)      14850000
                   PERFORM DP013-0000-PROCESS-ABEND                     14860000
           END-EVALUATE.                                                14870000
       EJECT                                                            14880000
      *----------------------------------------------------------------*14890000
      *    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *14900000
      *    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *14910000
      *    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *14920000
      *    MESSAGE.                                                    *14930000
      *----------------------------------------------------------------*14940000
                                                                        14950000
       2110-BROWSE-BACKWARD.                                            14960000
                                                                        14970000
           SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    14980000
               GIVING PV-TOP-ITEM.                                      14990000
                                                                        15000000
           IF  PV-TOP-ITEM < +1                                         15010000
               MOVE +1              TO PV-TOP-ITEM                      15020000
      *        -- TOP OF LIST --                                        15030000
               MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER                 15040000
               SET DP020-MSG-INFORMATIONAL TO TRUE                      15050000
           END-IF.                                                      15060000
                                                                        15070000
       EJECT                                                            15080000
                                                                        15090000
      *----------------------------------------------------------------*15100000
      *    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *15110000
      *    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *15120000
      *    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *15130000
      *----------------------------------------------------------------*15140000
                                                                        15150000
       2120-BROWSE-FORWARD.                                             15160000
                                                                        15170000
           ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              15180000
               GIVING PV-TOP-ITEM.                                      15190000
           IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   15200000
               MOVE ASC-ITEM-AT-TOP-OF-PANEL                            15210000
                                         TO PV-TOP-ITEM                 15220000
      *        -- BOTTOM OF LIST --                                     15230000
               MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            15240000
               SET DP020-MSG-INFORMATIONAL                              15250000
                                         TO TRUE                        15260000
           ELSE                                                         15270000
               COMPUTE PV-BOTTOM-ITEM =                                 15280000
                   PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 15290000
               IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            15300000
      *            -- BOTTOM OF LIST --                                 15310000
                   MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            15320000
                   SET DP020-MSG-INFORMATIONAL                          15330000
                                         TO TRUE                        15340000
               END-IF                                                   15350000
           END-IF.                                                      15360000
       EJECT                                                            15370000
      *----------------------------------------------------------------*15380000
      *    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *15390000
      *    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *15400000
      *    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *15410000
      *    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *15420000
      *    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *15430000
      *    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *15440000
      *----------------------------------------------------------------*15450000
                                                                        15460000
       2130-CHECK-FOR-JUMP-BROWSE.                                      15470000
           SET PS-NO-ERROR               TO TRUE.                       15480000
           IF (ASC-START-ITEM-REQUEST = SPACE)                          15490000
               MOVE ASC-ITEM-AT-TOP-OF-PANEL                            15500000
                                         TO PV-TOP-ITEM                 15510000
           ELSE                                                         15520000
               MOVE ASC-START-ITEM-REQUEST                              15530000
                                         TO DP010I-UNEDITED-FIELD       15540000
               MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       15550000
               MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     15560000
               SET DP010I-NEGATIVE-NOT-ALLOWED                          15570000
                                         TO TRUE                        15580000
               CALL DP010I-NUMERIC-EDIT-ROUTINE                         15591000
                         USING DP010I-NUMERIC-EDIT-AREA                 15592000
                                                                        15600000
               IF  NOT DP010I-ERROR-DETECTED                            15610000
                   MOVE DP010I-NUMERIC-FIELD                            15620000
                                         TO  ASC-START-ITEM-REQUEST-N   15630000
                   IF  ASC-START-ITEM-REQUEST-N > ZERO                  15640000
                       IF  ASC-START-ITEM-REQUEST-N >                   15650000
                                                ASC-NUMBER-OF-ITEMS-READ15660000
                           MOVE SPACE TO ASC-START-ITEM-REQUEST         15670000
                           COMPUTE PV-TOP-ITEM =                        15680000
                                   ASC-NUMBER-OF-ITEMS-READ             15690000
                                   - PC-ITEMS-PER-PANEL + 1             15700000
                           IF  PV-TOP-ITEM < +1                         15710000
                               MOVE +1   TO PV-TOP-ITEM                 15720000
                               MOVE PC-TSYMSG-00070                     15730000
                                         TO DP020-MSG-NUMBER            15740000
                               SET DP020-MSG-INFORMATIONAL              15750000
                                         TO TRUE                        15760000
                           END-IF                                       15770000
                       ELSE                                             15780000
                           MOVE ASC-START-ITEM-REQUEST-N                15790000
                                         TO PV-TOP-ITEM                 15800000
                           MOVE SPACE    TO ASC-START-ITEM-REQUEST      15810000
                           COMPUTE PV-BOTTOM-ITEM =                     15820000
                               PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     15830000
                           IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ15840000
      *                        -- BOTTOM OF LIST --                     15850000
                               MOVE PC-TSYMSG-00070                     15860000
                                         TO DP020-MSG-NUMBER            15870000
                               SET DP020-MSG-INFORMATIONAL              15880000
                                         TO TRUE                        15890000
                           END-IF                                       15900000
                       END-IF                                           15910000
                   ELSE                                                 15920000
      *                --- VALUE OUT OF RANGE ----                      15930000
                       MOVE PC-TSYMSG-00101                             15940000
                                         TO DP020-MSG-NUMBER            15950000
                       MOVE -1           TO MR-STARTL                   15960000
                       SET DP030-SET-CURSOR-APPL-1                      15970000
                                         TO TRUE                        15980000
                       MOVE DP015-REVERSE                               15990000
                                         TO MR-STARTH                   16000000
                       MOVE DP015-RED    TO MR-STARTC                   16010000
                       MOVE DP015-UNP-NUM-BRT-MDT                       16020000
                                         TO MR-STARTA                   16030000
                       SET DP020-MSG-FATAL                              16040000
                                         TO TRUE                        16050000
                       SET PS-ERROR      TO TRUE                        16060000
                   END-IF                                               16070000
                                                                        16080000
               ELSE                                                     16090000
                   MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            16100000
                   MOVE -1               TO MR-STARTL                   16110000
                   SET DP030-SET-CURSOR-APPL-1 TO TRUE                  16120000
                   MOVE DP015-REVERSE    TO MR-STARTH                   16130000
                   MOVE DP015-RED        TO MR-STARTC                   16140000
                   MOVE DP015-UNP-NUM-BRT-MDT                           16150000
                                         TO MR-STARTA                   16160000
                   SET DP020-MSG-FATAL   TO TRUE                        16170000
                   SET PS-ERROR          TO TRUE                        16180000
               END-IF                                                   16190000
           END-IF.                                                      16200000
       EJECT                                                            16210000
      *----------------------------------------------------------------*16220000
      *    GET THE NEXT LINE NBR IF A LIST OF LINE NBRS IS BEING      * 16230000
      *    PROCESSED.                                                  *16240000
      *----------------------------------------------------------------*16250000
                                                                        16260000
       2140-GET-NEXT-LINE.                                              16270000
                                                                        16280000
           ADD +1                       TO ASC-SEL-SUB.                 16290000
           IF  ASC-SEL-SUB > TF002-MAX-ITEMS                            16300000
               ADD +1                   TO ASC-SEL-ITEM                 16310000
               MOVE +1                  TO ASC-SEL-SUB                  16320000
           END-IF.                                                      16330000
           IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                16340000
               PERFORM 9100-READ-SEL-QUEUE-IN                           16350000
               IF  TF002-ITEM (ASC-SEL-SUB) > ZERO                      16360000
                   MOVE TF002-LINE-NBR (ASC-SEL-SUB)                    16370000
                                        TO ASC-KEY-XFER-LNE-NBR         16380000
                                           DK-XFER-LNE-NBR              16390000
                   SET TF002-INQ (ASC-SEL-SUB) TO TRUE                  16400000
                   PERFORM 9200-REWRITE-SEL-QUEUE-IN                    16410000
               ELSE                                                     16420000
                   SUBTRACT +1 FROM ASC-SEL-SUB                         16430000
                   MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             16440000
                   SET DP020-MSG-INFORMATIONAL TO TRUE                  16450000
                   SET PS-LIST-END             TO TRUE                  16460000
               END-IF                                                   16470000
           ELSE                                                         16480000
               SUBTRACT +1 FROM ASC-SEL-ITEM                            16490000
               MOVE TF002-MAX-ITEMS     TO ASC-SEL-SUB                  16500000
               MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             16510000
               SET DP020-MSG-INFORMATIONAL TO TRUE                      16520000
               SET PS-LIST-END             TO TRUE                      16530000
           END-IF.                                                      16540000
                                                                        16550000
      *----------------------------------------------------------------*16560000
      *    GET THE PREVIOUS LINE NBR IF A LIST OF LINE NBRS IS BEING   *16570000
      *    PROCESSED.                                                  *16580000
      *----------------------------------------------------------------*16590000
                                                                        16600000
       2150-GET-PREV-LINE.                                              16610000
                                                                        16620000
           SUBTRACT +1 FROM ASC-SEL-SUB.                                16630000
           IF  ASC-SEL-SUB < +1                                         16640000
               SUBTRACT +1 FROM ASC-SEL-ITEM                            16650000
               MOVE TF002-MAX-ITEMS     TO ASC-SEL-SUB                  16660000
           END-IF.                                                      16670000
                                                                        16680000
           IF  ASC-SEL-ITEM > ZERO                                      16690000
               PERFORM 9100-READ-SEL-QUEUE-IN                           16700000
               MOVE TF002-LINE-NBR (ASC-SEL-SUB)                        16710000
                                        TO ASC-KEY-XFER-LNE-NBR         16720000
                                           DK-XFER-LNE-NBR              16730000
           ELSE                                                         16740000
               MOVE +1                  TO ASC-SEL-ITEM                 16750000
                                           ASC-SEL-SUB                  16760000
               MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             16770000
               SET DP020-MSG-INFORMATIONAL TO TRUE                      16780000
               SET PS-LIST-END             TO TRUE                      16790000
           END-IF.                                                      16800000
       EJECT                                                            16810000
      *----------------------------------------------------------------*16820000
      *    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *16830000
      *    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *16840000
      *----------------------------------------------------------------*16850000
       2160-DESELECT-ALL-ITEMS.                                         16860000
           MOVE +1                       TO ASC-BLK-SUB.                16870000
                                                                        16880000
           PERFORM 2161-CLEAR-SELECTED-INDS                             16890000
               VARYING ASC-ITEM-SUB                                     16900000
               FROM 1 BY 1                                              16910000
               UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16920000
                                                                        16930000
           ADD +1                        TO ASC-BLK-SUB.                16940000
                                                                        16950000
           PERFORM 2161-CLEAR-SELECTED-INDS                             16960000
               VARYING ASC-ITEM-SUB                                     16970000
               FROM 1 BY 1                                              16980000
               UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16990000
                                                                        17000000
           MOVE ASC-LIST-ITEM-NUMBER(1 1)                               17010000
                                         TO PV-LIST-ITEM-NUMBER.        17020000
                                                                        17030000
           COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            17040000
               1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    17050000
                                                                        17060000
           IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     17070000
              (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      17080000
               MOVE +1                   TO ASC-BLK-SUB                 17090000
                                                                        17100000
               PERFORM 5100-WRITE-TEMP-STORAGE                          17110000
                                                                        17120000
               MOVE +1                   TO PV-BLOCK-NUMBER             17130000
                                                                        17140000
               COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         17150000
                   PV-FIRST-BLOCK-IN-ARRAY - 1                          17160000
                                                                        17170000
               PERFORM                                                  17180000
                   UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       17190000
                                                                        17200000
                   PERFORM 4410-READ-TEMP-STORAGE                       17210000
                                                                        17220000
                   PERFORM 2161-CLEAR-SELECTED-INDS                     17230000
                       VARYING ASC-ITEM-SUB FROM 1 BY 1                 17240000
                       UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17250000
                                                                        17260000
                   PERFORM 5100-WRITE-TEMP-STORAGE                      17270000
                                                                        17280000
                   ADD +1                TO PV-BLOCK-NUMBER             17290000
                                                                        17300000
               END-PERFORM                                              17310000
                                                                        17320000
               COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         17330000
                   PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     17340000
                                                                        17350000
               PERFORM                                                  17360000
                   UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       17370000
                         ASC-HIGHEST-BLOCK-WRITTEN                      17380000
                                                                        17390000
                   MOVE PV-NEXT-BLOCK-IN-ARRAY                          17400000
                                         TO PV-BLOCK-NUMBER             17410000
                                                                        17420000
                   PERFORM 4410-READ-TEMP-STORAGE                       17430000
                                                                        17440000
                   PERFORM 2161-CLEAR-SELECTED-INDS                     17450000
                       VARYING ASC-ITEM-SUB                             17460000
                       FROM 1 BY 1                                      17470000
                       UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17480000
                                                                        17490000
                   PERFORM 5100-WRITE-TEMP-STORAGE                      17500000
                                                                        17510000
                   ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      17520000
                                                                        17530000
               END-PERFORM                                              17540000
                                                                        17550000
               MOVE PV-FIRST-BLOCK-IN-ARRAY                             17560000
                                         TO PV-BLOCK-NUMBER             17570000
                                                                        17580000
               PERFORM 4410-READ-TEMP-STORAGE                           17590000
           END-IF.                                                      17600000
                                                                        17610000
                                                                        17620000
           MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 17630000
                                                                        17640000
           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        17650000
                                                                        17660000
       EJECT                                                            17670000
      *----------------------------------------------------------------*17680000
      *    MARK EACH ITEM AS BEING NOT SELECTED.                       *17690000
      *----------------------------------------------------------------*17700000
                                                                        17710000
       2161-CLEAR-SELECTED-INDS.                                        17720000
                                                                        17730000
           IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           17740000
                   NOT EQUAL ZERO                                       17750000
               IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          17760000
                   SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          17770000
                       ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    17780000
                       ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  17790000
                                         TO TRUE                        17800000
               END-IF                                                   17810000
           END-IF.                                                      17820000
                                                                        17830000
       EJECT                                                            17840000
      ******************************************************************17850000
      ** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **17860000
      ** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **17870000
      ******************************************************************17880000
       2200-MOVE-SCREEN-TO-COMMAREA.                                    17890000
                                                                        17900000
           MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             17910000
           MOVE +1                       TO PV-SUB.                     17920000
      *                                                                 17930000
           PERFORM 3100-SET-SUBSCRIPTS.                                 17940000
           IF  MR-STARTL > ZERO                                         17950000
               MOVE MR-START        TO ASC-START-ITEM-REQUEST           17960000
           ELSE                                                         17970000
               IF  MR-STARTA = DP015-ERASE-EOF                          17980000
                   INITIALIZE ASC-START-ITEM-REQUEST                    17990000
               END-IF                                                   18000000
           END-IF.                                                      18010000
           PERFORM 2210-MOVE-LINES-TO-COMMAREA                          18020000
               VARYING PV-SUB                                           18030000
               FROM 1 BY 1                                              18040000
               UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      18050000
      ******************************************************************18060000
      ** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**18070000
      ******************************************************************18080000
       2210-MOVE-LINES-TO-COMMAREA.                                     18090000
           IF  MR-SEL-L (PV-SUB) > ZERO                                 18100000
               SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             18110000
               MOVE MR-SEL (PV-SUB)                                     18120000
                                         TO ASC-TEMP-SELECTED-SW        18130000
                                       (ASC-BLK-SUB, ASC-ITEM-SUB)      18140000
           ELSE                                                         18150000
               IF  MR-SEL-A (PV-SUB) = DP015-ERASE-EOF                  18160000
                       SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     18170000
                       MOVE SPACE        TO ASC-TEMP-SELECTED-SW        18180000
                                       (ASC-BLK-SUB, ASC-ITEM-SUB)      18190000
               END-IF                                                   18200000
           END-IF.                                                      18210000
           ADD +1                        TO ASC-ITEM-SUB.               18220000
           IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        18230000
               ADD +1                    TO ASC-BLK-SUB                 18240000
               MOVE +1                   TO ASC-ITEM-SUB                18250000
           END-IF.                                                      18260000
      *----------------------------------------------------------------*18270000
      * VALIDATE THE SELECTED ITEMS.                                   *18280000
      *----------------------------------------------------------------*18290000
       2300-VALIDATE-SELECTIONS.                                        18300000
                                                                        18310000
           MOVE +1                   TO  ASC-BLK-SUB.                   18320000
           PERFORM 5100-WRITE-TEMP-STORAGE.                             18330000
           ADD +1                    TO  ASC-BLK-SUB.                   18340000
           PERFORM 5100-WRITE-TEMP-STORAGE.                             18350000
                                                                        18360000
           SET PS-NO-SELECT-LESS-THAN-MAX                               18370000
               PS-NO-SELECT-COMPLETE                                    18380000
               PS-NO-SELECT-NON-REVERSAL     TO TRUE.                   18390000
           PERFORM 2310-READ-LIST-QUEUE                                 18400000
                   VARYING PV-ITEM                                      18410000
                   FROM 1 BY 1                                          18420000
                   UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     18430000
      *----------------------------------------------------------------*18440000
      * READ A LIST QUEUE RECORD AND CHECK FOR SELECTED ITEMS.         *18450000
      *----------------------------------------------------------------*18460000
                                                                        18470000
       2310-READ-LIST-QUEUE.                                            18480000
                                                                        18490000
           PERFORM 6112-READ-LIST-QUEUE.                                18500000
                                                                        18510000
           IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       18520000
               PERFORM 2320-CHECK-SELECTIONS                            18530000
                 VARYING LQW-IDX                                        18540000
                   FROM 1 BY 1                                          18550000
                   UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL        18560000
                     OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO      18570000
           END-IF.                                                      18580000
       2320-CHECK-SELECTIONS.                                           18590000
           IF LQW-SELECT (LQW-IDX)                                      18600000
               IF LQW-DATE (LQW-IDX) < ASC-MAX-DATE                     18610000
                   SET PS-SELECT-LESS-THAN-MAX    TO TRUE               18620000
               END-IF                                                   18630000
               IF LQW-REASON-CDE (LQW-IDX) = PC-COMPLETE-CODE           18640000
                   SET PS-SELECT-COMPLETE         TO TRUE               18650000
               END-IF                                                   18660000
               IF LQW-REASON-CDE (LQW-IDX) NOT = PC-MANUAL-REVERSAL AND 18670000
                  LQW-REASON-CDE (LQW-IDX) NOT = PC-AUTO-REVERSAL   AND 18680000
                  LQW-REASON-CDE (LQW-IDX) NOT = PC-ITEM-ADD            18690000
                   SET PS-SELECT-NON-REVERSAL     TO TRUE               18700000
               END-IF                                                   18710000
           END-IF.                                                      18720000
                                                                        18730000
      ******************************************************************18740000
      ** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **18750000
      ** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **18760000
      ******************************************************************18770000
       3000-EDIT-DATA-IN-COMMAREA.                                      18780000
           SET PS-NO-ERROR               TO TRUE.                       18790000
           PERFORM 3200-RESET-ATTRIBUTES.                               18800000
           MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     18810000
      **                                                                18820000
      * CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              18830000
      * EDITTING IS DONE FROM THE BOTTOM UP.                            18840000
      **                                                                18850000
           COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       18860000
               ASC-ITEMS-DISPLAYED - 1.                                 18870000
           PERFORM 3100-SET-SUBSCRIPTS.                                 18880000
           PERFORM 3300-EDIT-SELECTIONS                                 18890000
               VARYING PV-SUB                                           18900000
               FROM PV-SUB BY -1                                        18910000
               UNTIL PV-SUB < +1.                                       18920000
       EJECT                                                            18930000
      *----------------------------------------------------------------*18940000
      *    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *18950000
      *    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*18960000
      *    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *18970000
      *                                                                *18980000
      *    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *18990000
      *    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *19000000
      *    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *19010000
      *    US IN THE 2ND BLOCK OF THE ARRAY.                           *19020000
      *----------------------------------------------------------------*19030000
                                                                        19040000
       3100-SET-SUBSCRIPTS.                                             19050000
                                                                        19060000
           COMPUTE ASC-ITEM-SUB =                                       19070000
               (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        19080000
                                                                        19090000
           IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         19100000
               PERFORM 3150-ADJUST-SUB                                  19110000
                 UNTIL ASC-ITEM-SUB NOT > PC-ITEMS-PER-PANEL            19120000
                                                                        19130000
               MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               19140000
           ELSE                                                         19150000
               MOVE +1                     TO ASC-BLK-SUB               19160000
           END-IF.                                                      19170000
       3150-ADJUST-SUB.                                                 19180000
           SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB.               19190000
      *----------------------------------------------------------------*19200000
      *    RESET ATTRIBUTES.                                           *19210000
      *----------------------------------------------------------------*19220000
                                                                        19230000
       3200-RESET-ATTRIBUTES.                                           19240000
                                                                        19250000
           PERFORM                                                      19260000
               VARYING PV-SUB                                           19270000
               FROM 1 BY 1                                              19280000
               UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        19290000
               MOVE DP015-UNP-ALP-NOR-OFF                               19300000
                                         TO MR-SEL-A (PV-SUB)           19310000
               MOVE DP015-GREEN          TO MR-SEL-C (PV-SUB)           19320000
               MOVE DP015-UNDERLINE      TO MR-SEL-H (PV-SUB)           19330000
           END-PERFORM.                                                 19340000
           SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       19350000
                                                                        19360000
      ******************************************************************19370000
      ** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **19380000
      ** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **19390000
      ** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **19400000
      ** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **19410000
      ******************************************************************19420000
       3300-EDIT-SELECTIONS.                                            19430000
           EVALUATE TRUE                                                19440000
               WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     19450000
                   = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         19460000
                       CONTINUE                                         19470000
               WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         19480000
                   IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        19490000
                       ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   19500000
                       MOVE ASC-TEMP-SELECTED-SW                        19510000
                                            (ASC-BLK-SUB ASC-ITEM-SUB)  19520000
                                      TO ASC-SELECTED-SW                19530000
                                            (ASC-BLK-SUB ASC-ITEM-SUB)  19540000
                   END-IF                                               19550000
               WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     19560000
                       = SPACE                                          19570000
                   IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            19580000
                       SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    19590000
                       MOVE SPACE TO ASC-SELECTED-SW                    19600000
                                            (ASC-BLK-SUB ASC-ITEM-SUB)  19610000
                   END-IF                                               19620000
               WHEN OTHER                                               19630000
                   MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           19640000
                   SET DP020-MSG-FATAL    TO TRUE                       19650000
                   MOVE -1                TO MR-SEL-L (PV-SUB)          19660000
                   SET DP030-SET-CURSOR-APPL-1                          19670000
                                          TO TRUE                       19680000
                   MOVE DP015-RED         TO MR-SEL-C (PV-SUB)          19690000
                   MOVE DP015-REVERSE     TO MR-SEL-H (PV-SUB)          19700000
                   SET PS-ERROR TO TRUE                                 19710000
                   IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            19720000
                       SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     19730000
                       MOVE SPACE         TO ASC-SELECTED-SW            19740000
                                              (ASC-BLK-SUB ASC-ITEM-SUB)19750000
                   END-IF                                               19760000
           END-EVALUATE.                                                19770000
                                                                        19780000
           SUBTRACT +1             FROM PV-ITEM-IN-USE.                 19790000
           SUBTRACT +1 FROM ASC-ITEM-SUB.                               19800000
           IF  ASC-ITEM-SUB < 1                                         19810000
               SUBTRACT +1 FROM ASC-BLK-SUB                             19820000
               MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                19830000
           END-IF.                                                      19840000
       EJECT                                                            19850000
                                                                        19860000
      *----------------------------------------------------------------*19870000
      *    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *19880000
      *    INITIALIZE ALL COUNTERS AND FLAGS.                          *19890000
      *    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *19900000
      *    DISPLAY THE PANEL TO USER.                                  *19910000
      *----------------------------------------------------------------*19920000
                                                                        19930000
       4000-BUILD-INITIAL-PANEL.                                        19940000
                                                                        19950000
           INITIALIZE                  ASC-BLOCK-ENTRIES (1)            19960000
                                       ASC-BLOCK-ENTRIES (2).           19970000
           MOVE +1                 TO  ASC-BLK-SUB.                     19980000
           SET ASC-ITEMS-LEFT-ON-DB                                     19990000
                                   TO  TRUE.                            20000000
                                                                        20010000
           MOVE +0                 TO  ASC-ITEM-SUB                     20020000
                                       ASC-NUMBER-OF-ITEMS-READ         20030000
                                       ASC-NUMBER-OF-SELECTED-ITEMS     20040000
                                       ASC-HIGHEST-BLOCK-WRITTEN        20050000
                                       ASC-ITEM-AT-TOP-OF-PANEL.        20060000
                                                                        20070000
           PERFORM 4010-OPEN-CURSOR.                                    20080000
                                                                        20090000
           PERFORM 4300-READ-ITEMS-FROM-DB.                             20100000
                                                                        20110000
           PERFORM 4020-CLOSE-CURSOR.                                   20120000
                                                                        20130000
           IF  ASC-NUMBER-OF-ITEMS-READ > PC-ITEMS-PER-PANEL            20140000
               MOVE ASC-NUMBER-OF-ITEMS-READ                            20150000
                                     TO  PV-TOP-ITEM                    20160000
           ELSE                                                         20170000
               MOVE +1               TO  PV-TOP-ITEM                    20180000
           END-IF.                                                      20190000
           IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          20200000
               SET DP020-MSG-FATAL   TO  TRUE                           20210000
               MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               20220000
           ELSE                                                         20230000
               PERFORM 4500-GET-MAX-VALUES                              20240000
               SET DP030-SET-CURSOR-APPL-1 TO TRUE                      20250000
           END-IF.                                                      20260000
           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        20270000
       EJECT                                                            20280000
      *----------------------------------------------------------------*20290000
      * OPEN THE CURSOR.                                               *20300000
      *----------------------------------------------------------------*20310000
                                                                        20320000
       4010-OPEN-CURSOR.                                                20330000
                                                                        20340000
           EXEC SQL                                                     20350000
                OPEN POSTING-CSR                                        20360000
           END-EXEC.                                                    20370000
                                                                        20380000
           EVALUATE TRUE                                                20390000
               WHEN SQLCODE = ZERO                                      20400000
                    CONTINUE                                            20410000
               WHEN OTHER                                               20420000
                    MOVE '4010-OPEN-CURSOR'                             20430000
                                 TO  DP013-PARAGRAPH                    20440000
                    MOVE 'OPEN TRANSFER ITEM POSTING CURSOR'            20450000
                                 TO  DP013-MESSAGE-TEXT (1)             20460000
                    MOVE SQLCA   TO  DP013-SQLCA                        20470000
                    SET DP013-DB2-ABEND                                 20480000
                                 TO  TRUE                               20490000
                    PERFORM DP013-0000-PROCESS-ABEND                    20500000
           END-EVALUATE.                                                20510000
                                                                        20520000
       EJECT                                                            20530000
      *----------------------------------------------------------------*20540000
      * CLOSE THE CURSOR.                                              *20550000
      *----------------------------------------------------------------*20560000
                                                                        20570000
       4020-CLOSE-CURSOR.                                               20580000
                                                                        20590000
           EXEC SQL                                                     20600000
               CLOSE POSTING-CSR                                        20610000
           END-EXEC.                                                    20620000
                                                                        20630000
           EVALUATE TRUE                                                20640000
               WHEN SQLCODE = ZERO                                      20650000
                    CONTINUE                                            20660000
               WHEN OTHER                                               20670000
                    MOVE '4020-CLOSE-CURSOR'                            20680000
                                 TO  DP013-PARAGRAPH                    20690000
                    MOVE 'CLOSE TRANSFER ITEM POSTING CURSOR'           20700000
                                 TO  DP013-MESSAGE-TEXT (1)             20710000
                    MOVE SQLCA   TO  DP013-SQLCA                        20720000
                    SET DP013-DB2-ABEND                                 20730000
                                 TO  TRUE                               20740000
                    PERFORM DP013-0000-PROCESS-ABEND                    20750000
           END-EVALUATE.                                                20760000
                                                                        20770000
       EJECT                                                            20780000
      *----------------------------------------------------------------*20790000
      * SELECT DATA FROM THE TRANSFER TABLES                            20800000
      *----------------------------------------------------------------*20810000
       4100-GET-TRANSFER.                                               20820000
           PERFORM                                                      20830000
               WITH TEST AFTER                                          20840000
               VARYING PV-RETRY-COUNT                                   20850000
               FROM 1 BY 1                                              20860000
               UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 20870000
                         OR (SQLCODE = ZERO)                            20880000
                         OR (SQLCODE = +100))                           20890000
      *                                                                 20900000
               EXEC SQL                                                 20910000
                   SELECT M.FR_STR_NBR                                  20920000
                         ,M.XFER_SEQ_NBR                                20930000
                         ,M.CONTNR_TYP_CDE                              20940000
                         ,M.TO_STR_NBR                                  20950000
                         ,S.XFER_STAT_CDE                               20960000
                         ,M.CMPT_XFER_END_TMST                          20970000
                   INTO   :TFMSTR-FR-STR-NBR                            20980000
                         ,:TFMSTR-XFER-SEQ-NBR                          20990000
                         ,:TFMSTR-CONTNR-TYP-CDE                        21000000
                         ,:TFMSTR-TO-STR-NBR                            21010000
                         ,:TFSTAT-XFER-STAT-CDE                         21020000
                         ,:TFMSTR-CMPT-XFER-END-TMST                    21030000
                   FROM   TTFMSTR M                                     21040000
                         ,TTFSTAT S                                     21050000
                         ,TTFSTCD SC                                    21060000
                   WHERE  M.XFER_DKEY_ID   = :DK-XFER-DKEY-ID     AND   21070000
                          S.XFER_DKEY_ID   = M.XFER_DKEY_ID       AND   21080000
                          S.XFER_STAT_CDE  = SC.XFER_STAT_CDE     AND   21090000
                          S.XFER_STAT_TMST =                            21100000
                  (SELECT                                               21110000
                   MAX(S.XFER_STAT_TMST)                                21120000
                   FROM TTFSTAT S                                       21130000
                       ,TTFMSTR M                                       21140000
                   WHERE  M.XFER_DKEY_ID   = :DK-XFER-DKEY-ID     AND   21150000
                          S.XFER_DKEY_ID   = M.XFER_DKEY_ID       AND   21160000
                          S.XFER_STAT_CDE  IN ('PR', 'AR'))             21170000
               END-EXEC                                                 21180000
                                                                        21190000
               EVALUATE TRUE                                            21200000
                   WHEN SQLCODE = ZERO                                  21210000
                      SET PS-TRANSFER-FOUND     TO TRUE                 21220000
                      MOVE TFMSTR-FR-STR-NBR    TO ASC-FROM-STORE-NBR   21230000
                      MOVE TFMSTR-XFER-SEQ-NBR  TO ASC-XFER-SEQ-NBR     21240000
                      MOVE TFMSTR-TO-STR-NBR    TO ASC-TO-STORE-NBR     21250000
                      MOVE TFSTAT-XFER-STAT-CDE TO ASC-XFER-STATUS      21260000
                      MOVE TFMSTR-CONTNR-TYP-CDE                        21270000
                                                TO ASC-CONTNR-TYP-CDE   21280000
                      MOVE TFMSTR-CMPT-XFER-END-TMST                    21290000
                                                 TO ASC-CMPLT-DATE      21300000
                      PERFORM 5500-GET-STORE-NAMES                      21310000
                      PERFORM 6200-READ-TRANSFER-RECEIPT                21320000
                   WHEN SQLCODE = +100                                  21330000
                   WHEN SQLCODE = -904                                  21340000
                   WHEN SQLCODE = -913                                  21350000
                       CONTINUE                                         21360000
                   WHEN OTHER                                           21370000
                       MOVE '4100-GET-TRANSFER'                         21380000
                                         TO DP013-PARAGRAPH             21390000
                       MOVE 'SELECT TRANSFER DATA'                      21400000
                                         TO DP013-MESSAGE-TEXT (1)      21410000
                       MOVE SQLCA        TO DP013-SQLCA                 21420000
                       MOVE 'TTFMSTR'    TO DP013-DB2-TABLE-NAME (1)    21430000
                       SET DP013-DB2-ABEND                              21440000
                           DP013-XCTL-DISPLAY-RESTART                   21450000
                                         TO TRUE                        21460000
                       PERFORM DP013-0000-PROCESS-ABEND                 21470000
               END-EVALUATE                                             21480000
           END-PERFORM.                                                 21490000
      *                                                                 21500000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          21510000
               MOVE '4100-GET-TRANSFER'                                 21520000
                                         TO DP013-PARAGRAPH             21530000
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     21540000
                                         TO DP013-MESSAGE-TEXT (1)      21550000
               MOVE 'TRANSFER DATA'      TO DP013-MESSAGE-TEXT (2)      21560000
               MOVE SQLCA                TO DP013-SQLCA                 21570000
               MOVE 'TTFMSTR'            TO DP013-DB2-TABLE-NAME (1)    21580000
               SET DP013-DB2-ABEND                                      21590000
                   DP013-XCTL-DISPLAY-RESTART                           21600000
                                         TO TRUE                        21610000
               PERFORM DP013-0000-PROCESS-ABEND                         21620000
           END-IF.                                                      21630000
       EJECT                                                            21640000
      *----------------------------------------------------------------*21650000
      * SELECT DATA FROM THE TRANSFER ITEM TABLE.                       21660000
      *----------------------------------------------------------------*21670000
       4200-GET-TRANSFER-ITEM.                                          21680000
           PERFORM                                                      21690000
               WITH TEST AFTER                                          21700000
               VARYING PV-RETRY-COUNT                                   21710000
               FROM 1 BY 1                                              21720000
               UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 21730000
                         OR (SQLCODE = ZERO)                            21740000
                         OR (SQLCODE = +100))                           21750000
               EXEC SQL                                                 21760000
                   SELECT                                               21770000
                       ITM_NBR                                          21780000
                     , KOHLS_UPC_NBR                                    21790000
                     , XFER_PRIC_AMT                                    21800000
                     , XFER_QTY                                         21810000
                     , CPLD_RTL_PRIC_AMT                                21820000
                   INTO                                                 21830000
                       :TFITEM-ITM-NBR                                  21840000
                     , :TFITEM-KOHLS-UPC-NBR                            21850000
                     , :TFITEM-XFER-PRIC-AMT                            21860000
                     , :TFITEM-XFER-QTY                                 21870000
                     , :TFITEM-CPLD-RTL-PRIC-AMT                        21880000
                FROM                                                    21890000
                      TTFITEM A                                         21900000
                WHERE                                                   21910000
                      A.XFER_DKEY_ID    = :DK-XFER-DKEY-ID   AND        21920000
                      A.XFER_LNE_NBR    = :DK-XFER-LNE-NBR              21930000
               END-EXEC                                                 21940000
                                                                        21950000
               EVALUATE TRUE                                            21960000
                   WHEN SQLCODE = ZERO                                  21970000
                      SET PS-TRANSFER-ITEM-FOUND  TO TRUE               21980000
                      MOVE TFITEM-KOHLS-UPC-NBR TO ASC-UPC              21990000
                      MOVE TFITEM-XFER-PRIC-AMT TO ASC-TPRICE           22000000
                      MOVE TFITEM-XFER-QTY      TO ASC-TQTY             22010000
                      MOVE TFITEM-CPLD-RTL-PRIC-AMT                     22020000
                                                TO ASC-FPRICE           22030000
                      PERFORM 4210-SELECT-DEPT-CLASS                    22040000
                                                                        22050000
                   WHEN SQLCODE = +100                                  22060000
                   WHEN SQLCODE = -904                                  22070000
                   WHEN SQLCODE = -913                                  22080000
                       CONTINUE                                         22090000
                   WHEN OTHER                                           22100000
                       MOVE '4200-GET-TRANSFER-ITEM'                    22110000
                                         TO DP013-PARAGRAPH             22120000
                       MOVE 'SELECT TRANSFER ITEM DATA'                 22130000
                                         TO DP013-MESSAGE-TEXT (1)      22140000
                       MOVE SQLCA        TO DP013-SQLCA                 22150000
                       MOVE 'TTFITEM'    TO DP013-DB2-TABLE-NAME (1)    22160000
                       SET DP013-DB2-ABEND                              22170000
                           DP013-XCTL-DISPLAY-RESTART                   22180000
                                         TO TRUE                        22190000
                       PERFORM DP013-0000-PROCESS-ABEND                 22200000
               END-EVALUATE                                             22210000
           END-PERFORM.                                                 22220000
      *                                                                 22230000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          22240000
               MOVE '4200-GET-TRANSFER-ITEM'                            22250000
                                         TO DP013-PARAGRAPH             22260000
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     22270000
                                         TO DP013-MESSAGE-TEXT (1)      22280000
               MOVE 'TRANSFER ITEM DATE' TO DP013-MESSAGE-TEXT (2)      22290000
               MOVE SQLCA                TO DP013-SQLCA                 22300000
               MOVE 'TTFITEM'            TO DP013-DB2-TABLE-NAME (1)    22310000
               SET DP013-DB2-ABEND                                      22320000
                   DP013-XCTL-DISPLAY-RESTART                           22330000
                                         TO TRUE                        22340000
               PERFORM DP013-0000-PROCESS-ABEND                         22350000
           END-IF.                                                      22360000
           IF SQLCODE = ZERO                                            22370000
               PERFORM 5400-READ-ITEM-RECEIPT                           22380000
               MOVE TFITRC-RCVD-XFER-QTY        TO ASC-RQTY (1)         22390000
               MOVE TFITRC-RCVD-XFER-PRIC-AMT   TO ASC-RPRICE (1)       22400000
               SET ASC-ITEMS-LEFT-ON-DB-2       TO TRUE                 22410000
               MOVE +1                  TO ASC-RECEIPT-SUB              22420000
                                                                        22430000
               PERFORM 5600-OPEN-RECEIPT-CURSOR                         22440000
                                                                        22450000
               PERFORM 5700-READ-RECEIPT-ITEMS                          22460000
                                                                        22470000
               PERFORM 5800-CLOSE-RECEIPT-CURSOR                        22480000
           END-IF.                                                      22490000
       EJECT                                                            22500000
                                                                        22510000
       4210-SELECT-DEPT-CLASS.                                          22520000
           EXEC SQL                                                     22530000
               SELECT  DEPT,                                            22540000
                       CLASS,                                           22550000
                       SUBCLASS                                         22560000
                 INTO  :SKXREF-DEPT,                                    22570000
                       :SKXREF-CLASS,                                   22580000
                       :SKXREF-SUBCLASS                                 22590000
                 FROM  TSKXREF                                          22600000
                WHERE  ITM_NBR     =  :TFITEM-ITM-NBR                   22610000
           END-EXEC                                                     22620000
                                                                        22630000
           EVALUATE TRUE                                                22640000
               WHEN SQLCODE = ZERO                                      22650000
                   MOVE SKXREF-DEPT          TO ASC-DEPT                22660000
                   MOVE SKXREF-CLASS         TO ASC-CLASS               22670000
                   MOVE SKXREF-SUBCLASS      TO ASC-SUBCLASS            22680000
               WHEN SQLCODE = +100                                      22690000
      ******* EXTRACT DEPT, CLASS AND SUBCLASS EMBEDDED IN UPC          22700000
                   MOVE TFITEM-KOHLS-UPC-NBR TO PV-HOLD-UPC-NBR-9       22700100
                   MOVE PV-KOHLS-DEPT TO ASC-DEPT                       22700200
                   MOVE PV-KOHLS-CL-9 TO ASC-SUBCLASS                   22700300
                   MOVE ZERO          TO PV-KOHLS-CL-2                  22700400
                   MOVE PV-KOHLS-CL-9 TO ASC-CLASS                      22700500
               WHEN OTHER                                               22700600
                   MOVE '4210-SELECT-DEPT-CLASS'                        22700700
                                       TO DP013-PARAGRAPH               22700800
                   MOVE 'READ A ROW FROM TSKXREF'                       22700900
                                       TO DP013-MESSAGE-TEXT (1)        22701000
                   MOVE SQLCA              TO DP013-SQLCA               22701100
                   MOVE 'TSKXREF'          TO DP013-DB2-TABLE-NAME (1)  22701200
                   SET DP013-DB2-ABEND TO TRUE                          22701300
                   PERFORM DP013-0000-PROCESS-ABEND                     22701400
           END-EVALUATE.                                                22701500
                                                                        22701600
      *----------------------------------------------------------------*22701700
      *    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *22701800
      *    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *22701900
      *    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *22702000
      *    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *22703000
      *    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *22704000
      *                                                                *22705000
      *    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *22706000
      *    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *22707000
      *    UPON INITIALIZATION.                                        *22708000
      *----------------------------------------------------------------*22709000
                                                                        22710000
       4300-READ-ITEMS-FROM-DB.                                         22720000
                                                                        22730000
           PERFORM                                                      22740000
               VARYING PV-READ-COUNT                                    22750000
               FROM 1 BY 1                                              22760000
               UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    22770000
                  OR (ASC-NO-ITEMS-LEFT-ON-DB))                         22780000
                                                                        22790000
               PERFORM 4310-FETCH                                       22800000
                                                                        22810000
               IF  ASC-ITEMS-LEFT-ON-DB                                 22820000
                   PERFORM 4320-GET-SUB                                 22830000
                   MOVE TFITPS-PSTG-SEQ-NBR                             22840000
                                     TO  ASC-PSTG-SEQ-NBR               22850000
                                             (ASC-BLK-SUB ASC-ITEM-SUB) 22860000
                   MOVE TFITPS-ITM-PSTG-PRPD-TMST                       22870000
                                     TO  ASC-DATE                       22880000
                                             (ASC-BLK-SUB ASC-ITEM-SUB) 22890000
                   MOVE TFITPS-FRM-PSTG-STR-NBR                         22900000
                                     TO  DK-STORE-NBR                   22910000
                                         ASC-DTL-FR-NBR                 22920000
                                             (ASC-BLK-SUB ASC-ITEM-SUB) 22930000
100404             PERFORM 5550-READ-XST-LOC                            22940000
100404             MOVE XST00001-LOC-5-ABBR-NM                          22950000
                                     TO  ASC-DTL-FR-NAM-5               22960000
                                             (ASC-BLK-SUB ASC-ITEM-SUB) 22970000
100404             MOVE XST00001-LOC-10-ABBR-NM                         22980000
                                     TO  ASC-DTL-FR-NAM-10              22990000
                                             (ASC-BLK-SUB ASC-ITEM-SUB) 23000000
                   MOVE TFITPS-TO-PSTG-STR-NBR                          23010000
                                     TO  DK-STORE-NBR                   23020000
                                         ASC-DTL-TO-NBR                 23030000
                                             (ASC-BLK-SUB ASC-ITEM-SUB) 23040000
                   PERFORM 5550-READ-XST-LOC                            23050000
100404             MOVE XST00001-LOC-10-ABBR-NM                         23060000
                                     TO  ASC-DTL-TO-NAM-10              23070000
                                             (ASC-BLK-SUB ASC-ITEM-SUB) 23080000
100404             MOVE XST00001-LOC-5-ABBR-NM                          23090000
                                     TO  ASC-DTL-TO-NAM-5               23100000
                                             (ASC-BLK-SUB ASC-ITEM-SUB) 23110000
                   MOVE TFITPS-ITM-RTL-PRCE-AMT                         23120000
                                     TO  ASC-DTL-PRICE                  23130000
                                             (ASC-BLK-SUB ASC-ITEM-SUB) 23140000
                   MOVE TFITPS-ITM-QTY                                  23150000
                                     TO  ASC-DTL-FR-QTY                 23160000
                                             (ASC-BLK-SUB ASC-ITEM-SUB) 23170000
                   MOVE TFITPS-ADJ-RSN-CDE                              23180000
                                     TO  ASC-REASON-CDE                 23190000
                                             (ASC-BLK-SUB ASC-ITEM-SUB) 23200000
                   MOVE TFITPS-EXTL-SYS-PRCG-CDE                        23210000
                                     TO  ASC-EXTL-SYS-PRCG-CDE          23220000
                                             (ASC-BLK-SUB ASC-ITEM-SUB) 23230000
                   EVALUATE TFITPS-ADJ-RSN-CDE                          23240000
                     WHEN PC-COMPLETE-CODE                              23250000
                        IF ASC-XFER-STATUS = PC-ASSUMPTIVE-RECEIPT      23260000
                           STRING TFAJRS-ADJ-RSN-DESC DELIMITED BY '  ' 23270000
                           PC-ASSUMPTIVE-LITERAL      DELIMITED BY SIZE 23280000
                                     INTO ASC-REASON                    23290000
                                             (ASC-BLK-SUB ASC-ITEM-SUB) 23300000
                        ELSE                                            23310000
                           STRING TFAJRS-ADJ-RSN-DESC DELIMITED BY '  ' 23320000
                           PC-POSITIVE-LITERAL        DELIMITED BY SIZE 23330000
                                     INTO ASC-REASON                    23340000
                                             (ASC-BLK-SUB ASC-ITEM-SUB) 23350000
                        END-IF                                          23360000
                     WHEN OTHER                                         23370000
                         MOVE TFAJRS-ADJ-RSN-DESC                       23380000
                                     TO  ASC-REASON                     23390000
                                             (ASC-BLK-SUB ASC-ITEM-SUB) 23400000
                   END-EVALUATE                                         23410000
                   COMPUTE ASC-DTL-FR-EXT (ASC-BLK-SUB ASC-ITEM-SUB) =  23420000
                      (ASC-DTL-PRICE    (ASC-BLK-SUB ASC-ITEM-SUB)   *  23430000
                       ASC-DTL-FR-QTY   (ASC-BLK-SUB ASC-ITEM-SUB))     23440000
               END-IF                                                   23450000
           END-PERFORM.                                                 23460000
                                                                        23470000
           MOVE +1                       TO  ASC-BLK-SUB.               23480000
           PERFORM 5100-WRITE-TEMP-STORAGE.                             23490000
           ADD +1                        TO  ASC-BLK-SUB.               23500000
           PERFORM 5100-WRITE-TEMP-STORAGE.                             23510000
                                                                        23520000
           MOVE 1                        TO  ASC-BLK-SUB                23530000
                                             PV-BLOCK-NUMBER.           23540000
           PERFORM 4410-READ-TEMP-STORAGE.                              23550000
           IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1                 23560000
               MOVE 2                    TO  ASC-BLK-SUB                23570000
                                             PV-BLOCK-NUMBER            23580000
               PERFORM 4410-READ-TEMP-STORAGE                           23590000
           END-IF.                                                      23600000
       EJECT                                                            23610000
      *----------------------------------------------------------------*23620000
      *    FETCH THE POSTING CURSOR.                                   *23630000
      *----------------------------------------------------------------*23640000
                                                                        23650000
       4310-FETCH.                                                      23660000
                                                                        23670000
           PERFORM                                                      23680000
               WITH TEST AFTER                                          23690000
               VARYING PV-RETRY-COUNT                                   23700000
               FROM 1 BY 1                                              23710000
               UNTIL PV-RETRY-COUNT GREATER THAN PC-MAX-RETRIES         23720000
                  OR SQLCODE = 0                                        23730000
                  OR SQLCODE = +100                                     23740000
                                                                        23750000
               EXEC SQL                                                 23760000
                    FETCH POSTING-CSR                                   23770000
                    INTO                                                23780000
                      :TFITPS-PSTG-SEQ-NBR                              23790000
                    , :TFITPS-ADJ-RSN-CDE                               23800000
                    , :TFITPS-ITM-PSTG-PRPD-TMST                        23810000
                    , :TFITPS-FRM-PSTG-STR-NBR                          23820000
                    , :TFITPS-TO-PSTG-STR-NBR                           23830000
                    , :TFITPS-ITM-RTL-PRCE-AMT                          23840000
                    , :TFITPS-ITM-QTY                                   23850000
                    , :TFITPS-EXTL-SYS-PRCG-CDE                         23860000
                    , :TFAJRS-ADJ-RSN-DESC                              23870000
               END-EXEC                                                 23880000
                                                                        23890000
               EVALUATE TRUE                                            23900000
                   WHEN SQLCODE = ZERO                                  23910000
                   WHEN SQLCODE = +100                                  23920000
                   WHEN SQLCODE = -904                                  23930000
                   WHEN SQLCODE = -913                                  23940000
                        CONTINUE                                        23950000
                   WHEN OTHER                                           23960000
                        MOVE '4310-FETCH-CURSOR'                        23970000
                                     TO  DP013-PARAGRAPH                23980000
                        MOVE 'FETCH TRANSFER ITEM POSTING CURSOR'       23990000
                                     TO  DP013-MESSAGE-TEXT (1)         24000000
                        MOVE SQLCA   TO  DP013-SQLCA                    24010000
                        MOVE 'TTFITPS'    TO DP013-DB2-TABLE-NAME (1)   24020000
                        SET DP013-DB2-ABEND                             24030000
                                     TO  TRUE                           24040000
                        PERFORM DP013-0000-PROCESS-ABEND                24050000
               END-EVALUATE                                             24060000
           END-PERFORM.                                                 24070000
                                                                        24080000
           IF  PV-RETRY-COUNT GREATER THAN PC-MAX-RETRIES               24090000
               MOVE '4310-FETCH-CURSOR'                                 24100000
                                     TO  DP013-PARAGRAPH                24110000
               MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             24120000
                                     TO  DP013-MESSAGE-TEXT (1)         24130000
               MOVE SQLCA            TO  DP013-SQLCA                    24140000
               MOVE 'TTFITPS'        TO DP013-DB2-TABLE-NAME (1)        24150000
               SET DP013-DB2-ABEND   TO  TRUE                           24160000
               PERFORM DP013-0000-PROCESS-ABEND                         24170000
           END-IF.                                                      24180000
                                                                        24190000
           IF  SQLCODE EQUAL +100                                       24200000
               SET ASC-NO-ITEMS-LEFT-ON-DB                              24210000
                                     TO  TRUE                           24220000
           END-IF.                                                      24230000
                                                                        24240000
       EJECT                                                            24250000
      *----------------------------------------------------------------*24260000
      *    GET THE CORRECT SUBSCRIPTS FOR PLACING THE POSTING DATA.    *24270000
      *----------------------------------------------------------------*24280000
                                                                        24290000
       4320-GET-SUB.                                                    24300000
                                                                        24310000
           IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                        24320000
               ADD +1            TO  ASC-ITEM-SUB                       24330000
           ELSE                                                         24340000
               ADD +1            TO  ASC-BLK-SUB                        24350000
               MOVE +1           TO  ASC-ITEM-SUB                       24360000
                                                                        24370000
               IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                 24380000
                   MOVE +1       TO  ASC-BLK-SUB                        24390000
                   PERFORM 5100-WRITE-TEMP-STORAGE                      24400000
                   MOVE ASC-BLOCK-ENTRIES                               24410000
                             (PC-MAX-BLOCKS-IN-ARRAY)                   24420000
                   TO   ASC-BLOCK-ENTRIES(ASC-BLK-SUB)                  24430000
                   ADD +1        TO  ASC-BLK-SUB                        24440000
                   INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)           24450000
               END-IF                                                   24460000
           END-IF.                                                      24470000
                                                                        24480000
           ADD +1            TO ASC-NUMBER-OF-ITEMS-READ.               24490000
           MOVE ASC-NUMBER-OF-ITEMS-READ TO ASC-LIST-ITEM-NUMBER        24500000
                                            (ASC-BLK-SUB                24510000
                                             ASC-ITEM-SUB).             24520000
                                                                        24530000
      *----------------------------------------------------------------*24540000
      *    FORMAT THE MAP AND DETERMINE THE CURSOR POSITION.           *24550000
      *----------------------------------------------------------------*24560000
                                                                        24570000
       4400-MOVE-COMMAREA-TO-SCREEN.                                    24580000
                                                                        24590000
           MOVE ASC-FROM-STORE-NBR     TO PV-XFER-FROM-STORE            24600000
                                          MR-FR-STR-NBR.                24610000
           MOVE ASC-XFER-SEQ-NBR       TO PV-XFER-SEQ-NBR.              24620000
           MOVE PV-XFER-NBR            TO MR-XFER-NBR.                  24630000
           MOVE ASC-FROM-STORE-NAM     TO MR-FR-STR-NAM.                24640000
           MOVE ASC-TO-STORE-NBR       TO MR-TO-STR-NBR.                24650000
           MOVE ASC-TO-STORE-NAM       TO MR-TO-STR-NAM.                24660000
           MOVE ASC-RECV-STORE-NBR     TO MR-RC-STR-NBR.                24670000
           MOVE ASC-RECV-STORE-NAM     TO MR-RC-STR-NAM.                24680000
           MOVE ASC-KEY-XFER-LNE-NBR   TO MR-LNE-NBR.                   24690000
           MOVE ASC-DEPT               TO PV-DEPT.                      24700000
           IF ASC-CLASS < PC-100 AND ASC-SUBCLASS < PC-100              24710000
                MOVE ASC-CLASS    TO PV-CLASS-1                         24720000
                MOVE ASC-SUBCLASS TO PV-SUBCLASS-1                      24730000
           ELSE IF                                                      24740000
              ASC-CLASS < PC-100 AND ASC-SUBCLASS > PC-099              24750000
                MOVE ASC-CLASS    TO PV-CLASS-2                         24760000
                MOVE ASC-SUBCLASS TO PV-SUBCLASS-2                      24770000
                MOVE SPACES       TO PV-FILLER-2A                       24780000
                                     PV-FILLER-2B                       24790000
           ELSE IF                                                      24800000
              ASC-CLASS > PC-099 AND ASC-SUBCLASS < PC-100              24810000
                MOVE ASC-CLASS    TO PV-CLASS-3                         24811000
                MOVE ASC-SUBCLASS TO PV-SUBCLASS-3                      24812000
                MOVE SPACES       TO PV-FILLER-3A                       24813000
                                     PV-FILLER-3B                       24814000
           ELSE IF                                                      24815000
              ASC-CLASS > PC-099 AND ASC-SUBCLASS > PC-099              24815100
                MOVE ASC-CLASS    TO PV-CLASS-4                         24815200
                MOVE ASC-SUBCLASS TO PV-SUBCLASS-4                      24815300
                MOVE SPACES       TO PV-FILLER-4A                       24815400
           END-IF                                                       24815500
           END-IF                                                       24815600
           END-IF                                                       24815700
           END-IF                                                       24815800
           MOVE PV-DPT-CL-SUBCL        TO MR-DPT-CL-SUBCL.              24815900
           MOVE ASC-UPC                TO PV-UPC.                       24816000
           MOVE '-'                    TO PV-UPC-DASH1                  24817000
                                          PV-UPC-DASH2                  24818000
                                          PV-UPC-DASH3.                 24819000
           MOVE PV-UPC                 TO MR-UPC.                       24820000
           IF ASC-TQTY > 0                                              24830000
               MOVE ASC-TQTY           TO MR-TQTY                       24840000
               MOVE ASC-TPRICE         TO MR-TPRICE                     24850000
           ELSE                                                         24860000
               MOVE SPACES             TO MR-TQTY-X                     24870000
                                          MR-TPRICE-X                   24880000
           END-IF.                                                      24890000
           IF ASC-RQTY (1) > 0                                          24900000
               MOVE ASC-RQTY (1)       TO MR-RQTY1                      24910000
               MOVE ASC-RPRICE (1)     TO MR-RPRICE1                    24920000
           ELSE                                                         24930000
               MOVE SPACES             TO MR-RQTY1-X                    24940000
                                          MR-RPRICE1-X                  24950000
           END-IF.                                                      24960000
           IF ASC-RQTY (2) > 0                                          24970000
               MOVE ASC-RQTY (2)       TO MR-RQTY2                      24980000
               MOVE ASC-RPRICE (2)     TO MR-RPRICE2                    24990000
           ELSE                                                         25000000
               MOVE SPACES             TO MR-RQTY2-X                    25010000
                                          MR-RPRICE2-X                  25020000
           END-IF.                                                      25030000
           IF ASC-RQTY (3) > 0                                          25040000
               MOVE ASC-RQTY (3)       TO MR-RQTY3                      25050000
               MOVE ASC-RPRICE (3)     TO MR-RPRICE3                    25060000
           ELSE                                                         25070000
               MOVE SPACES             TO MR-RQTY3-X                    25080000
                                          MR-RPRICE3-X                  25090000
           END-IF.                                                      25100000
           MOVE ASC-FPRICE             TO MR-FPRICE.                    25110000
                                                                        25120000
           IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             25130000
               AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          25140000
               OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          25150000
                   MOVE +1    TO ASC-BLK-SUB                            25160000
                   PERFORM 5100-WRITE-TEMP-STORAGE                      25170000
                   ADD +1     TO ASC-BLK-SUB                            25180000
                   PERFORM 5100-WRITE-TEMP-STORAGE                      25190000
                   DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             25200000
                       GIVING PV-BLOCK-NUMBER                           25210000
                       REMAINDER PV-REMAINDER                           25220000
                   IF  PV-REMAINDER > ZERO                              25230000
                       ADD +1 TO PV-BLOCK-NUMBER                        25240000
                   END-IF                                               25250000
                   MOVE +1    TO ASC-BLK-SUB                            25260000
                   PERFORM 4410-READ-TEMP-STORAGE                       25270000
                   ADD +1     TO ASC-BLK-SUB                            25280000
                                 PV-BLOCK-NUMBER                        25290000
                   PERFORM 4410-READ-TEMP-STORAGE                       25300000
           END-IF.                                                      25310000
           MOVE +1                       TO ASC-BLK-SUB.                25320000
           COMPUTE ASC-ITEM-SUB =                                       25330000
               ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              25340000
               + PC-ITEMS-PER-PANEL).                                   25350000
                                                                        25360000
           IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        25370000
               ADD +1   TO ASC-BLK-SUB                                  25380000
               SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            25390000
           END-IF.                                                      25400000
                                                                        25410000
           COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           25420000
               ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                25430000
           PERFORM 4420-FORMAT-LIST-LINES                               25440000
               VARYING PV-SUB                                           25450000
               FROM PC-ITEMS-PER-PANEL BY -1                            25460000
               UNTIL PV-SUB < +1.                                       25470000
                                                                        25480000
           COMPUTE ASC-ITEMS-DISPLAYED =                                25490000
               ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          25500000
           MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    25510000
                                            MR-START.                   25520000
           MOVE ASC-ITEM-AT-BOT-OF-PANEL TO MR-END.                     25530000
           MOVE ASC-NUMBER-OF-ITEMS-READ TO MR-TOTAL.                   25540000
           MOVE -1             TO MR-SEL-L (ASC-ITEMS-DISPLAYED).       25550000
                                                                        25560000
           IF  DP020-MSG-NUMBER-X = SPACE                               25570000
               IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  25580000
      *            --- MORE ITEMS TO DISPLAY ----                       25590000
                   MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            25600000
                   SET DP020-MSG-INFORMATIONAL TO TRUE                  25610000
               END-IF                                                   25620000
           END-IF.                                                      25630000
                                                                        25640000
      *----------------------------------------------------------------*25650000
      *    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *25660000
      *----------------------------------------------------------------*25670000
                                                                        25680000
       4410-READ-TEMP-STORAGE.                                          25690000
                                                                        25700000
           EXEC CICS                                                    25710000
               READQ TS                                                 25720000
                   QUEUE (ASC-LIST-QUEUE-NAME)                          25730000
                   INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               25740000
                   ITEM  (PV-BLOCK-NUMBER)                              25750000
                   RESP  (PV-CICS-RESP)                                 25760000
           END-EXEC.                                                    25770000
                                                                        25780000
           IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       25790000
             OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     25800000
               CONTINUE                                                 25810000
           ELSE                                                         25820000
               SET DP013-CICS-ABEND TO  TRUE                            25830000
               SET DP013-NO-ROLLBACK TO  TRUE                           25840000
               MOVE '4410-READ-TEMP-STORAGE'                            25850000
                                     TO  DP013-PARAGRAPH                25860000
               MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      25870000
                                     TO  DP013-MESSAGE-TEXT(1)          25880000
               PERFORM DP013-0000-PROCESS-ABEND                         25890000
           END-IF.                                                      25900000
                                                                        25910000
           SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             25920000
                                                                        25930000
           IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         25940000
               INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               25950000
           END-IF.                                                      25960000
       EJECT                                                            25970000
      *----------------------------------------------------------------*25980000
      *    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *25990000
      *----------------------------------------------------------------*26000000
                                                                        26010000
       4420-FORMAT-LIST-LINES.                                          26020000
           IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      26030000
               SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                26040000
               MOVE DP015-ASK-DRK-OFF  TO MR-SEL-A (PV-SUB)             26050000
               MOVE DP015-HL-OFF       TO MR-SEL-H (PV-SUB)             26060000
               MOVE SPACE              TO MR-SEL   (PV-SUB)             26070000
                                          MR-DATE   (PV-SUB)            26080000
                                          MR-DTL-FR-NBR (PV-SUB)        26090000
                                          MR-DTL-FR-NAM (PV-SUB)        26100000
                                          MR-DTL-FR-QTY (PV-SUB)        26110000
                                          MR-DTL-FR-PRC (PV-SUB)        26120000
                                          MR-DTL-FR-EXT (PV-SUB)        26130000
                                          MR-REASON     (PV-SUB)        26140000
                                          MR-DTL-TO-NBR (PV-SUB)        26150000
                                          MR-DTL-TO-NAM (PV-SUB)        26160000
           ELSE                                                         26170000
               IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      26180000
                                                         > SPACE        26190000
                   MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 26200000
                                       TO MR-SEL (PV-SUB)               26210000
               ELSE                                                     26220000
                   MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      26230000
                                       TO MR-SEL (PV-SUB)               26240000
               END-IF                                                   26250000
      *                                                                 26260000
               IF  DP030-SET-CURSOR-TRAILER                             26270000
                   IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)26280000
                       > SPACE)                                         26290000
                     OR (PV-SUB = 1))                                   26300000
                      SET DP030-SET-CURSOR-APPL-1 TO TRUE               26310000
                      MOVE -1          TO MR-SEL-L (PV-SUB)             26320000
                   END-IF                                               26330000
               END-IF                                                   26340000
      *                                                                 26350000
               IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           26360000
                   MOVE ASC-DTE-YEAR (ASC-BLK-SUB ASC-ITEM-SUB)         26370000
                                       TO PV-YEAR                       26380000
                   MOVE ASC-DTE-MONTH (ASC-BLK-SUB ASC-ITEM-SUB)        26390000
                                       TO PV-MONTH                      26400000
                   MOVE ASC-DTE-DAY  (ASC-BLK-SUB ASC-ITEM-SUB)         26410000
                                       TO PV-DAY                        26420000
                   MOVE PV-DATE        TO MR-DATE   (PV-SUB)            26430000
      *                                   MR-DATE2  (PV-SUB)            26440000
                   MOVE ASC-DTL-FR-NBR     (ASC-BLK-SUB ASC-ITEM-SUB)   26450000
                                       TO MR-DTL-FR-NBR    (PV-SUB)     26460000
                   MOVE ASC-DTL-FR-NAM-5   (ASC-BLK-SUB ASC-ITEM-SUB)   26470000
                                       TO MR-DTL-FR-NAM    (PV-SUB)     26480000
                   MOVE ASC-DTL-FR-QTY     (ASC-BLK-SUB ASC-ITEM-SUB)   26490000
                                       TO MR-DTL-FR-QTY-N  (PV-SUB)     26500000
                   MOVE ASC-DTL-PRICE      (ASC-BLK-SUB ASC-ITEM-SUB)   26510000
                                       TO MR-DTL-FR-PRC-N  (PV-SUB)     26520000
                   MOVE ASC-DTL-FR-EXT     (ASC-BLK-SUB ASC-ITEM-SUB)   26530000
                                       TO MR-DTL-FR-EXT-N  (PV-SUB)     26540000
                   MOVE ASC-REASON         (ASC-BLK-SUB ASC-ITEM-SUB)   26550000
                                       TO MR-REASON        (PV-SUB)     26560000
                   MOVE ASC-DTL-TO-NBR     (ASC-BLK-SUB ASC-ITEM-SUB)   26570000
                                       TO MR-DTL-TO-NBR    (PV-SUB)     26580000
                   MOVE ASC-DTL-TO-NAM-5   (ASC-BLK-SUB ASC-ITEM-SUB)   26590000
                                       TO MR-DTL-TO-NAM    (PV-SUB)     26600000
               END-IF                                                   26610000
           END-IF.                                                      26620000
           SUBTRACT +1 FROM ASC-ITEM-SUB                                26630000
           IF  ASC-ITEM-SUB < + 1                                       26640000
               MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  26650000
               MOVE +1                 TO ASC-BLK-SUB                   26660000
           END-IF.                                                      26670000
       EJECT                                                            26680000
      *----------------------------------------------------------------*26690000
      *    FETCH THE POSTING CURSOR.                                   *26700000
      *----------------------------------------------------------------*26710000
                                                                        26720000
       4500-GET-MAX-VALUES.                                             26730000
                                                                        26740000
           PERFORM                                                      26750000
               WITH TEST AFTER                                          26760000
               VARYING PV-RETRY-COUNT                                   26770000
               FROM 1 BY 1                                              26780000
               UNTIL PV-RETRY-COUNT GREATER THAN PC-MAX-RETRIES         26790000
                  OR SQLCODE = 0                                        26800000
                                                                        26810000
               EXEC SQL                                                 26820000
                  SELECT                                                26830000
                      MAX(PSTG_SEQ_NBR)                                 26840000
                    , MAX(ITM_PSTG_PRPD_TMST)                           26850000
                  INTO                                                  26860000
                      :TFITPS-PSTG-SEQ-NBR                              26870000
                    , :TFITPS-ITM-PSTG-PRPD-TMST                        26880000
                  FROM                                                  26890000
                      TTFITPS                                           26900000
                  WHERE                                                 26910000
                      XFER_DKEY_ID   = :DK-XFER-DKEY-ID     AND         26920000
                      XFER_LNE_NBR   = :DK-XFER-LNE-NBR                 26930000
               END-EXEC                                                 26940000
                                                                        26950000
               EVALUATE TRUE                                            26960000
                   WHEN SQLCODE = ZERO                                  26970000
                       MOVE TFITPS-PSTG-SEQ-NBR                         26980000
                                     TO  ASC-MAX-POSTING-SEQ-NBR        26990000
                       MOVE TFITPS-ITM-PSTG-PRPD-TMST                   27000000
                                     TO  ASC-MAX-DATE                   27010000
                   WHEN SQLCODE = -904                                  27020000
                   WHEN SQLCODE = -913                                  27030000
                        CONTINUE                                        27040000
                   WHEN OTHER                                           27050000
                        MOVE '4500-GET-MAX-VALUES'                      27060000
                                     TO  DP013-PARAGRAPH                27070000
                        MOVE 'GET MAX SEQ AND TIMESTAMP FROM TTFITPS'   27080000
                                     TO  DP013-MESSAGE-TEXT (1)         27090000
                        MOVE 'TTFITPS'  TO DP013-DB2-TABLE-NAME (1)     27100000
                        MOVE SQLCA   TO  DP013-SQLCA                    27110000
                        SET DP013-DB2-ABEND                             27120000
                                     TO  TRUE                           27130000
                        PERFORM DP013-0000-PROCESS-ABEND                27140000
               END-EVALUATE                                             27150000
           END-PERFORM.                                                 27160000
                                                                        27170000
           IF  PV-RETRY-COUNT GREATER THAN PC-MAX-RETRIES               27180000
               MOVE '4500-GET-MAX-VALUES'                               27190000
                                     TO  DP013-PARAGRAPH                27200000
               MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             27210000
                                     TO  DP013-MESSAGE-TEXT (1)         27220000
               MOVE 'TTFITPS'        TO DP013-DB2-TABLE-NAME (1)        27230000
               MOVE SQLCA            TO  DP013-SQLCA                    27240000
               SET DP013-DB2-ABEND   TO  TRUE                           27250000
               PERFORM DP013-0000-PROCESS-ABEND                         27260000
           END-IF.                                                      27270000
                                                                        27280000
       EJECT                                                            27290000
      *----------------------------------------------------------------*27300000
      * PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *27310000
      * ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *27320000
      * FOR THE SELECTED ITEMS QUEUE.                                  *27330000
      *                                                                *27340000
      * FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *27350000
      * QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *27360000
      * THE ARRAY IS FULL.                                             *27370000
      *----------------------------------------------------------------*27380000
                                                                        27390000
       5000-PREPARE-SEL-QUEUE-OUT.                                      27400000
                                                                        27410000
           MOVE +1                   TO  ASC-BLK-SUB.                   27420000
           PERFORM 5100-WRITE-TEMP-STORAGE.                             27430000
           ADD +1                    TO  ASC-BLK-SUB.                   27440000
           PERFORM 5100-WRITE-TEMP-STORAGE.                             27450000
                                                                        27460000
           MOVE ASC-SEL-QUEUE-OUT-NAME TO  TF003-SEL-QUEUE-NAME.        27470000
           MOVE ASC-KEY-XFER-DKEY-ID   TO  TF003-XFER-DKEY-ID.          27480000
           PERFORM 6010-DELETE-SEL-QUEUE-OUT.                           27490000
                                                                        27500000
           SET ASC-UPDATE-TSQ        TO  TRUE.                          27510000
                                                                        27520000
           SET TF004-IDX             TO  1.                             27530000
           MOVE ZERO                 TO TF003-NUMBER-OF-TS-ITEMS.       27540000
           INITIALIZE TF004-SELECTED-ITEM-ARRAY.                        27550000
                                                                        27560000
           PERFORM 5200-FILL-SEL-QUEUE-OUT-RECORD                       27570000
                   VARYING PV-ITEM                                      27580000
                   FROM 1 BY 1                                          27590000
                   UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     27600000
                                                                        27610000
           IF  TF004-IDX > 1                                            27620000
               PERFORM 5205-WRITE-SEL-QUEUE-OUT                         27630000
               ADD +1                TO TF003-NUMBER-OF-TS-ITEMS        27640000
           END-IF.                                                      27650000
       EJECT                                                            27660000
      *----------------------------------------------------------------*27670000
      *    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *27680000
      *    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *27690000
      *----------------------------------------------------------------*27700000
                                                                        27710000
       5100-WRITE-TEMP-STORAGE.                                         27720000
           MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     27730000
                                         TO PV-LIST-ITEM-NUMBER.        27740000
           COMPUTE PV-BLOCK-NUMBER =                                    27750000
               1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    27760000
                                                                        27770000
           IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             27780000
           OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             27790000
               IF  ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     27800000
                   PERFORM 5105-REWRITE-ASC-LISTQ                       27810000
               END-IF                                                   27820000
           ELSE                                                         27830000
               COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       27840000
               ASC-HIGHEST-BLOCK-WRITTEN + 1                            27850000
               PERFORM 5110-WRITE-ASC-LISTQ                             27860000
               ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   27870000
           END-IF.                                                      27880000
                                                                        27890000
           SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             27900000
      ******************************************************************27910000
      ** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **27920000
      ** SPECIFIC COMMAREA.                                           **27930000
      ******************************************************************27940000
       5105-REWRITE-ASC-LISTQ.                                          27950000
           EXEC CICS                                                    27960000
               WRITEQ TS                                                27970000
                   QUEUE (ASC-LIST-QUEUE-NAME)                          27980000
                   FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               27990000
                   ITEM  (PV-BLOCK-NUMBER)                              28000000
                   REWRITE                                              28010000
                   RESP  (PV-CICS-RESP)                                 28020000
           END-EXEC.                                                    28030000
                                                                        28040000
           IF  PV-CICS-RESP = DFHRESP(NORMAL)                           28050000
               CONTINUE                                                 28060000
           ELSE                                                         28070000
               SET DP013-CICS-ABEND            TO TRUE                  28080000
               SET DP013-NO-ROLLBACK           TO TRUE                  28090000
               MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       28100000
               MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     28110000
                                               TO DP013-MESSAGE-TEXT(1) 28120000
               PERFORM DP013-0000-PROCESS-ABEND                         28130000
           END-IF.                                                      28140000
                                                                        28150000
      ******************************************************************28160000
      ** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **28170000
      ** SPECIFIC COMMAREA.                                           **28180000
      ******************************************************************28190000
       5110-WRITE-ASC-LISTQ.                                            28200000
           EXEC CICS                                                    28210000
               WRITEQ TS                                                28220000
                   QUEUE (ASC-LIST-QUEUE-NAME)                          28230000
                   FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               28240000
                   ITEM  (PV-BLOCK-NUMBER)                              28250000
                   RESP  (PV-CICS-RESP)                                 28260000
           END-EXEC.                                                    28270000
           IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      28280000
               SET DP013-CICS-ABEND      TO TRUE                        28290000
               SET DP013-NO-ROLLBACK     TO TRUE                        28300000
               MOVE '5110-WRITE-ASC-LISTQ'                              28310000
                                         TO DP013-PARAGRAPH             28320000
               MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           28330000
                                         TO DP013-MESSAGE-TEXT(1)       28340000
               PERFORM DP013-0000-PROCESS-ABEND                         28350000
           END-IF.                                                      28360000
       EJECT                                                            28370000
      *----------------------------------------------------------------*28380000
      * READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *28390000
      * TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *28400000
      *----------------------------------------------------------------*28410000
                                                                        28420000
       5200-FILL-SEL-QUEUE-OUT-RECORD.                                  28430000
                                                                        28440000
           PERFORM 6112-READ-LIST-QUEUE.                                28450000
                                                                        28460000
           IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       28470000
               PERFORM                                                  28480000
               VARYING LQW-IDX                                          28490000
               FROM 1 BY 1                                              28500000
               UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            28510000
                 OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          28520000
                                                                        28530000
                   IF  LQW-SELECT (LQW-IDX)                             28540000
                       MOVE ASC-KEY-XFER-DKEY-ID                        28550000
                                      TO TF004-XFER-DKEY-ID             28560000
                       MOVE ASC-KEY-XFER-LNE-NBR                        28570000
                                      TO TF004-XFER-LINE-NBR            28580000
                       MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              28590000
                                         TO TF004-ITEM (TF004-IDX)      28600000
                       MOVE LQW-PSTG-SEQ-NBR  (LQW-IDX)                 28610000
                                         TO TF004-POSTING-SEQ-NBR       28620000
                                              (TF004-IDX)               28630000
                       MOVE SPACE        TO TF004-ACTION-SW (TF004-IDX) 28640000
                       SET TF004-IDX UP BY 1                            28650000
                       IF  TF004-IDX > TF004-MAX-ITEMS                  28660000
                           PERFORM 5205-WRITE-SEL-QUEUE-OUT             28670000
                           ADD +1        TO TF003-NUMBER-OF-TS-ITEMS    28680000
                           INITIALIZE TF004-SELECTED-ITEM-ARRAY         28690000
                           SET TF004-IDX TO  1                          28700000
                       END-IF                                           28710000
                   END-IF                                               28720000
               END-PERFORM                                              28730000
           END-IF.                                                      28740000
                                                                        28750000
      *----------------------------------------------------------------*28760000
      *    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *28770000
      *----------------------------------------------------------------*28780000
                                                                        28790000
       5205-WRITE-SEL-QUEUE-OUT.                                        28800000
                                                                        28810000
           MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            28820000
                                         TO TF004-SELECTED-ITEMS.       28830000
                                                                        28840000
           EXEC CICS                                                    28850000
                WRITEQ TS                                               28860000
                    QUEUE (ASC-SEL-QUEUE-OUT-NAME)                      28870000
                    FROM  (TF004-TRANSFER-SEL-REC)                      28880000
                    ITEM  (PV-SEL-QUEUE-ITEM)                           28890000
                    RESP  (PV-CICS-RESP)                                28900000
           END-EXEC.                                                    28910000
                                                                        28920000
           IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28930000
               CONTINUE                                                 28940000
           ELSE                                                         28950000
               SET DP013-CICS-ABEND      TO TRUE                        28960000
               SET DP013-NO-ROLLBACK     TO TRUE                        28970000
               MOVE '5205-WRITE-SEL-QUEUE-OUT'                          28980000
                                         TO DP013-PARAGRAPH             28990000
               MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          29000000
                                         TO DP013-MESSAGE-TEXT(1)       29010000
               PERFORM DP013-0000-PROCESS-ABEND                         29020000
           END-IF.                                                      29030000
       EJECT                                                            29040000
      *----------------------------------------------------------------*29050000
      *  GET THE TOTAL RECIEVED QTY & PRICE.                           *29060000
      *----------------------------------------------------------------*29070000
       5400-READ-ITEM-RECEIPT.                                          29080000
           PERFORM WITH TEST AFTER                                      29090000
               VARYING PV-RETRY-COUNT FROM 1 BY 1                       29100000
                 UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                  29110000
                    OR SQLCODE = ZERO                                   29120000
                    OR SQLCODE = +100                                   29130000
               EXEC SQL                                                 29140000
                   SELECT  RCVD_XFER_PRIC_AMT                           29150000
                         , RCVD_XFER_QTY                                29160000
                       INTO :TFITRC-RCVD-XFER-PRIC-AMT                  29170000
                           ,:TFITRC-RCVD-XFER-QTY                       29180000
                       FROM TTFITRC I                                   29190000
                           ,TTFSTAT S                                   29200000
                   WHERE                                                29210000
                      I.XFER_DKEY_ID     = :DK-XFER-DKEY-ID        AND  29220000
                      S.XFER_DKEY_ID     = I.XFER_DKEY_ID          AND  29230000
                      S.XFER_STAT_CDE    = :PC-POSITIVE-RECEIPT    AND  29240000
                      S.XFER_STAT_TMST   = I.XFER_RCPT_TMST        AND  29250000
                      RCVD_XFER_PRIC_AMT = :TFITEM-XFER-PRIC-AMT   AND  29260000
                      XFER_LNE_NBR       = :DK-XFER-LNE-NBR             29270000
               END-EXEC                                                 29280000
               EVALUATE TRUE                                            29290000
                   WHEN SQLCODE = ZERO                                  29300000
                   WHEN SQLCODE = +100                                  29310000
                   WHEN SQLCODE = -904                                  29320000
                   WHEN SQLCODE = -913                                  29330000
                       CONTINUE                                         29340000
                   WHEN OTHER                                           29350000
                       MOVE '5400-READ-ITEM-RECEIPT'                    29360000
                                         TO DP013-PARAGRAPH             29370000
                       MOVE 'READ DATA FROM TTFITRC'                    29380000
                                         TO DP013-MESSAGE-TEXT (1)      29390000
                       MOVE SQLCA        TO DP013-SQLCA                 29400000
                       MOVE 'TTFITRC'    TO DP013-DB2-TABLE-NAME (1)    29410000
                       SET DP013-DB2-ABEND                              29420000
                           DP013-XCTL-DISPLAY-RESTART                   29430000
                                         TO TRUE                        29440000
                       PERFORM DP013-0000-PROCESS-ABEND                 29450000
               END-EVALUATE                                             29460000
           END-PERFORM.                                                 29470000
      *                                                                 29480000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          29490000
               MOVE '5400-READ-ITEM-RECEIPT'                            29500000
                                         TO DP013-PARAGRAPH             29510000
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     29520000
                                         TO DP013-MESSAGE-TEXT (1)      29530000
               MOVE 'DATA FROM TTFITRC'  TO DP013-MESSAGE-TEXT (2)      29540000
               MOVE SQLCA                TO DP013-SQLCA                 29550000
               MOVE 'TTFITRC'            TO DP013-DB2-TABLE-NAME (1)    29560000
               SET DP013-DB2-ABEND                                      29570000
                   DP013-XCTL-DISPLAY-RESTART                           29580000
                                         TO TRUE                        29590000
               PERFORM DP013-0000-PROCESS-ABEND                         29600000
           END-IF.                                                      29610000
           IF SQLCODE = +100                                            29620000
               MOVE ZEROES               TO TFITRC-RCVD-XFER-QTY        29630000
                                            TFITRC-RCVD-XFER-PRIC-AMT   29640000
           END-IF.                                                      29650000
       EJECT                                                            29660000
      *----------------------------------------------------------------*29670000
      *  GET THE FROM AND TO STORE NAMES FOR DISPLAY.                  *29680000
      *----------------------------------------------------------------*29690000
       5500-GET-STORE-NAMES.                                            29700000
           MOVE ASC-FROM-STORE-NBR       TO DK-STORE-NBR.               29710000
100404     PERFORM 5550-READ-XST-LOC.                                   29720000
100404     MOVE XST00001-LOC-10-ABBR-NM  TO ASC-FROM-STORE-NAM.         29730000
           MOVE ASC-TO-STORE-NBR         TO DK-STORE-NBR.               29740000
100404     PERFORM 5550-READ-XST-LOC.                                   29750000
100404     MOVE XST00001-LOC-10-ABBR-NM  TO ASC-TO-STORE-NAM.           29760000
       EJECT                                                            29770000
      *----------------------------------------------------------------*29780000
      *  GET THE 10 CHARACTER ABBREVIATED STORE NAME.                  *29790000
      *----------------------------------------------------------------*29800000
100404 5550-READ-XST-LOC.                                               29810000
           PERFORM WITH TEST AFTER                                      29820000
               VARYING PV-RETRY-COUNT                                   29830000
               FROM 1 BY 1                                              29840000
               UNTIL (PV-RETRY-COUNT > PC-MAX-RETRIES)                  29850000
                    OR SQLCODE = ZERO                                   29860000
                    OR SQLCODE = +100                                   29870000
               EXEC SQL                                                 29880000
100404             SELECT LOC_10_ABBR_NM                                29890000
100404                   ,LOC_5_ABBR_NM                                 29900000
100404                   ,LOC_TYP_CDE                                   29910000
100404                 INTO :XST00001-LOC-10-ABBR-NM                    29920000
100404                   ,  :XST00001-LOC-5-ABBR-NM                     29930000
100404                   ,  :XST00001-LOC-TYP-CDE                       29940000
100404                 FROM XST_LOC                                     29950000
100404                 WHERE (LOC_NBR  = :DK-STORE-NBR)                 29960000
               END-EXEC                                                 29970000
               EVALUATE TRUE                                            29980000
                   WHEN SQLCODE = ZERO                                  29990000
                       CONTINUE                                         30000000
                   WHEN SQLCODE = -904                                  30010000
                   WHEN SQLCODE = -913                                  30020000
                   WHEN SQLCODE = +100                                  30030000
100404                 MOVE 'INVALID'     TO XST00001-LOC-10-ABBR-NM    30040000
                   WHEN OTHER                                           30050000
100404                 MOVE '5550-READ-XST-LOC'                         30060000
                                         TO DP013-PARAGRAPH             30070000
100404                 MOVE 'SELECT A ROW FROM XST_LOC'                 30080000
                                         TO DP013-MESSAGE-TEXT (1)      30090000
                       MOVE SQLCA        TO DP013-SQLCA                 30100000
100404                 MOVE 'XST_LOC'    TO DP013-DB2-TABLE-NAME (1)    30110000
                       SET DP013-DB2-ABEND                              30120000
                           DP013-XCTL-DISPLAY-RESTART                   30130000
                                         TO TRUE                        30140000
                       PERFORM DP013-0000-PROCESS-ABEND                 30150000
               END-EVALUATE                                             30160000
           END-PERFORM.                                                 30170000
                                                                        30180000
      *                                                                 30190000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          30200000
100404         MOVE '5550-READ-XST-LOC'                                 30210000
                                         TO DP013-PARAGRAPH             30220000
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     30230000
                                         TO DP013-MESSAGE-TEXT (1)      30240000
100404         MOVE 'A ROW FROM XST_LOC' TO DP013-MESSAGE-TEXT (2)      30250000
               MOVE SQLCA                TO DP013-SQLCA                 30260000
100404         MOVE 'XST_LOC'            TO DP013-DB2-TABLE-NAME (1)    30270000
               SET DP013-DB2-ABEND                                      30280000
                   DP013-XCTL-DISPLAY-RESTART                           30290000
                                         TO TRUE                        30300000
               PERFORM DP013-0000-PROCESS-ABEND                         30310000
           END-IF.                                                      30320000
       EJECT                                                            30330000
      *----------------------------------------------------------------*30340000
      * OPEN THE TRANSFER RECEIPT CURSOR.                              *30350000
      *----------------------------------------------------------------*30360000
                                                                        30370000
       5600-OPEN-RECEIPT-CURSOR.                                        30380000
           PERFORM                                                      30390000
               WITH TEST AFTER                                          30400000
               VARYING PV-RETRY-COUNT                                   30410000
               FROM 1 BY 1                                              30420000
               UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 30430000
                         OR (SQLCODE = ZERO))                           30440000
                   EXEC SQL                                             30450000
                        OPEN XFER-RECEIPT-CSR                           30460000
                   END-EXEC                                             30470000
                                                                        30480000
               EVALUATE TRUE                                            30490000
                   WHEN SQLCODE = ZERO                                  30500000
                   WHEN SQLCODE = -904                                  30510000
                   WHEN SQLCODE = -913                                  30520000
                       CONTINUE                                         30530000
                   WHEN OTHER                                           30540000
                       MOVE '5600-OPEN-RECEIPT-CURSOR'                  30550000
                                         TO DP013-PARAGRAPH             30560000
                       MOVE 'OPEN TRANSFER ITEM RECEIPT CURSOR - '      30570000
                                         TO DP013-MESSAGE-TEXT (1)      30580000
                       MOVE SQLCA        TO DP013-SQLCA                 30590000
                       MOVE 'TTFITRC '   TO DP013-DB2-TABLE-NAME (1)    30600000
                       SET DP013-DB2-ABEND                              30610000
                           DP013-XCTL-DISPLAY-RESTART TO TRUE           30620000
                       PERFORM DP013-0000-PROCESS-ABEND                 30630000
               END-EVALUATE                                             30640000
           END-PERFORM.                                                 30650000
      *                                                                 30660000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          30670000
               MOVE '5600-OPEN-RECEIPT-CURSOR'                          30680000
                                         TO DP013-PARAGRAPH             30690000
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   30700000
                                         TO DP013-MESSAGE-TEXT (1)      30710000
               MOVE SQLCA                TO DP013-SQLCA                 30720000
               MOVE 'TTFITRC '           TO DP013-DB2-TABLE-NAME (1)    30730000
               SET DP013-DB2-ABEND                                      30740000
                   DP013-XCTL-DISPLAY-RESTART                           30750000
                                         TO TRUE                        30760000
               PERFORM DP013-0000-PROCESS-ABEND                         30770000
           END-IF.                                                      30780000
                                                                        30790000
       EJECT                                                            30800000
      *----------------------------------------------------------------*30810000
      *    READ THE ITEMS FROM THE TRANSFER RECEIPT DATABASE WHERE     *30820000
      *    THE RECEIPT PRICE IS NOT EQUAL TO THE TRANSFER PRICE AND    *30830000
      *    CONTINUE BUILDING THE BLOCKS IN THE ARRAY.                  *30840000
      *----------------------------------------------------------------*30850000
                                                                        30860000
       5700-READ-RECEIPT-ITEMS.                                         30870000
                                                                        30880000
           PERFORM                                                      30890000
               VARYING PV-READ-COUNT                                    30900000
               FROM 1 BY 1                                              30910000
               UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    30920000
                  OR (ASC-NO-ITEMS-LEFT-ON-DB-2))                       30930000
                                                                        30940000
               PERFORM 5750-FETCH-RECEIPT-CURSOR                        30950000
                                                                        30960000
               IF  ASC-ITEMS-LEFT-ON-DB-2                               30970000
                   ADD +1                  TO ASC-RECEIPT-SUB           30980000
                   IF  ASC-RECEIPT-SUB > PC-RECEIPTS-PER-PANEL          30990000
                       SET ASC-NO-ITEMS-LEFT-ON-DB-2     TO TRUE        31000000
                   ELSE                                                 31010000
                       MOVE TFITRC-RCVD-XFER-QTY             TO         31020000
                           ASC-RQTY          (ASC-RECEIPT-SUB)          31030000
                       MOVE TFITRC-RCVD-XFER-PRIC-AMT        TO         31040000
                           ASC-RPRICE        (ASC-RECEIPT-SUB)          31050000
                   END-IF                                               31060000
               END-IF                                                   31070000
           END-PERFORM.                                                 31080000
      *----------------------------------------------------------------*31090000
      *    FETCH THE TRANSFER RECEIPT CURSOR.                          *31100000
      *----------------------------------------------------------------*31110000
                                                                        31120000
       5750-FETCH-RECEIPT-CURSOR.                                       31130000
                                                                        31140000
           EXEC SQL                                                     31150000
               FETCH XFER-RECEIPT-CSR                                   31160000
               INTO   :TFITRC-RCVD-XFER-PRIC-AMT                        31170000
                    , :TFITRC-RCVD-XFER-QTY                             31180000
           END-EXEC                                                     31190000
                                                                        31200000
           EVALUATE TRUE                                                31210000
               WHEN SQLCODE = ZERO                                      31220000
                    CONTINUE                                            31230000
               WHEN SQLCODE = +100                                      31240000
                    SET ASC-NO-ITEMS-LEFT-ON-DB-2                       31250000
                                         TO TRUE                        31260000
               WHEN OTHER                                               31270000
                    MOVE '5750-FETCH-RECEIPT-CURSOR'                    31280000
                                     TO DP013-PARAGRAPH                 31290000
                    MOVE 'FETCH TRANSFER ITEM CURSOR'                   31300000
                                     TO DP013-MESSAGE-TEXT (1)          31310000
                    MOVE 'TTFITEM '  TO DP013-DB2-TABLE-NAME (1)        31320000
                    MOVE SQLCA       TO DP013-SQLCA                     31330000
                    SET DP013-DB2-ABEND                                 31340000
                                     TO TRUE                            31350000
                    PERFORM DP013-0000-PROCESS-ABEND                    31360000
           END-EVALUATE.                                                31370000
                                                                        31380000
       EJECT                                                            31390000
      *----------------------------------------------------------------*31400000
      * CLOSE THE TRANSFER RECEIPT CURSOR.                             *31410000
      *----------------------------------------------------------------*31420000
                                                                        31430000
       5800-CLOSE-RECEIPT-CURSOR.                                       31440000
           EXEC SQL                                                     31450000
               CLOSE XFER-RECEIPT-CSR                                   31460000
           END-EXEC                                                     31470000
      *                                                                 31480000
           EVALUATE TRUE                                                31490000
               WHEN SQLCODE = ZERO                                      31500000
                   CONTINUE                                             31510000
               WHEN OTHER                                               31520000
                   MOVE '5800-CLOSE-RECEIPT-CURSOR'                     31530000
                                     TO DP013-PARAGRAPH                 31540000
                   MOVE 'CLOSE TRANSFER RECEIPT CURSOR '                31550000
                                     TO DP013-MESSAGE-TEXT (1)          31560000
                   MOVE SQLCA        TO DP013-SQLCA                     31570000
                   MOVE 'TTFITRC '   TO DP013-DB2-TABLE-NAME (1)        31580000
                   SET DP013-DB2-ABEND                                  31590000
                       DP013-XCTL-DISPLAY-RESTART TO TRUE               31600000
                   PERFORM DP013-0000-PROCESS-ABEND                     31610000
           END-EVALUATE.                                                31620000
                                                                        31630000
       EJECT                                                            31640000
      ******************************************************************31650000
      ** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **31660000
      ** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **31670000
      ** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **31680000
      ** THE USER.                                                    **31690000
      ******************************************************************31700000
       6000-REFRESH-PANEL-FROM-TEMP.                                    31710000
           IF  ASC-UPDATE-TSQ                                           31720000
               SET ASC-NO-TSQ-UPDATE TO TRUE                            31730000
               MOVE ZERO                 TO PV-SAVE-ITEM                31740000
                                            PV-SEL-QUEUE-ITEM           31750000
               MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        31760000
                                         TO PV-HOLD-SELECTED-ITEMS      31770000
               MOVE +1                   TO PV-ITEMS-PROCESSED          31780000
               PERFORM 6100-UPDATE-TSQ                                  31790000
                   UNTIL PV-ITEMS-PROCESSED >                           31800000
                                           PV-HOLD-SELECTED-ITEMS       31810000
               PERFORM 6010-DELETE-SEL-QUEUE-OUT                        31820000
               INITIALIZE ASC-BLOCK-ENTRIES (1)                         31830000
                          ASC-BLOCK-ENTRIES (2)                         31840000
           END-IF.                                                      31850000
                                                                        31860000
      *----------------------------------------------------------------*31870000
      *    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *31880000
      *----------------------------------------------------------------*31890000
       6010-DELETE-SEL-QUEUE-OUT.                                       31900000
                                                                        31910000
           EXEC CICS                                                    31920000
               DELETEQ TS                                               31930000
                   QUEUE (ASC-SEL-QUEUE-OUT-NAME)                       31940000
                   RESP  (PV-CICS-RESP)                                 31950000
           END-EXEC.                                                    31960000
      *                                                                 31970000
           IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      31980000
              (PV-CICS-RESP = DFHRESP(QIDERR)))                         31990000
               CONTINUE                                                 32000000
           ELSE                                                         32010000
               SET DP013-CICS-ABEND TO TRUE                             32020000
               SET DP013-NO-ROLLBACK TO TRUE                            32030000
               MOVE '6010-DELETE-SEL-QUEUE-OUT'                         32040000
                              TO DP013-PARAGRAPH                        32050000
               MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         32060000
                              TO DP013-MESSAGE-TEXT (1)                 32070000
               PERFORM DP013-0000-PROCESS-ABEND                         32080000
           END-IF.                                                      32090000
                                                                        32100000
      *----------------------------------------------------------------*32110000
      *    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *32120000
      *    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *32130000
      *    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *32140000
      *    THE TEMP QUEUE.                                             *32150000
      *----------------------------------------------------------------*32160000
                                                                        32170000
       6100-UPDATE-TSQ.                                                 32180000
                                                                        32190000
           ADD 1                     TO  PV-SEL-QUEUE-ITEM.             32200000
           PERFORM 6105-READ-SEL-QUEUE-OUT.                             32210000
           PERFORM                                                      32220000
               VARYING TF004-IDX                                        32230000
               FROM 1 BY 1                                              32240000
               UNTIL ((PV-ITEMS-PROCESSED >                             32250000
                                    PV-HOLD-SELECTED-ITEMS)             32260000
               OR (TF004-IDX GREATER THAN TF004-MAX-ITEMS))             32270000
               IF  TF004-ACTION-SW (TF004-IDX) > SPACE                  32280000
                   PERFORM 6110-PROCESS-ITEMS                           32290000
               END-IF                                                   32300000
               ADD +1                TO PV-ITEMS-PROCESSED              32310000
           END-PERFORM.                                                 32320000
           PERFORM 6111-WRITE-LIST-QUEUE.                               32330000
      *----------------------------------------------------------------*32340000
      *    READ THE LIST QUEUE RECORD.                                 *32350000
      *----------------------------------------------------------------*32360000
                                                                        32370000
       6105-READ-SEL-QUEUE-OUT.                                         32380000
                                                                        32390000
           EXEC CICS                                                    32400000
                READQ TS                                                32410000
                    QUEUE (ASC-SEL-QUEUE-OUT-NAME)                      32420000
                    INTO  (TF004-TRANSFER-SEL-REC)                      32430000
                    ITEM  (PV-SEL-QUEUE-ITEM)                           32440000
                    RESP  (PV-CICS-RESP)                                32450000
           END-EXEC.                                                    32460000
      *                                                                 32470000
           IF  PV-CICS-RESP = DFHRESP (NORMAL)                          32480000
               CONTINUE                                                 32490000
           ELSE                                                         32500000
               SET DP013-CICS-ABEND      TO  TRUE                       32510000
               SET DP013-NO-ROLLBACK     TO  TRUE                       32520000
               MOVE '6105-READ-SEL-QUEUE-OUT'                           32530000
                                         TO  DP013-PARAGRAPH            32540000
               MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           32550000
                                         TO  DP013-MESSAGE-TEXT(1)      32560000
               PERFORM DP013-0000-PROCESS-ABEND                         32570000
           END-IF.                                                      32580000
       EJECT                                                            32590000
      *----------------------------------------------------------------*32600000
      *    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*32610000
      *    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*32620000
      *    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *32630000
      *----------------------------------------------------------------*32640000
                                                                        32650000
       6110-PROCESS-ITEMS.                                              32660000
                                                                        32670000
           COMPUTE PV-ITEM = 1 + ((TF004-ITEM (TF004-IDX) - 1)          32680000
                           / PC-ITEMS-PER-PANEL).                       32690000
                                                                        32700000
           IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           32710000
               IF  PV-SAVE-ITEM NOT EQUAL ZERO                          32720000
                   PERFORM 6111-WRITE-LIST-QUEUE                        32730000
               END-IF                                                   32740000
               MOVE PV-ITEM          TO PV-SAVE-ITEM                    32750000
                                                                        32760000
               PERFORM 6112-READ-LIST-QUEUE                             32770000
               IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               32780000
                   CONTINUE                                             32790000
               END-IF                                                   32800000
           END-IF.                                                      32810000
                                                                        32820000
           COMPUTE PV-SUB = (TF004-ITEM (TF004-IDX)                     32830000
                          - LQW-LIST-ITEM-NUMBER (1)) + 1.              32840000
           SET LQW-DESELECT (PV-SUB) TO    TRUE                         32850000
           MOVE LQW-SELECTED-SW (PV-SUB)                                32860000
                                     TO LQW-TEMP-SELECTED-SW (PV-SUB).  32870000
           SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                32880000
                                                                        32890000
      *----------------------------------------------------------------*32900000
      *    WRITE THE TS QUEUE RECORD JUST UPDATED IN 6110-             *32910000
      *----------------------------------------------------------------*32920000
                                                                        32930000
       6111-WRITE-LIST-QUEUE.                                           32940000
                                                                        32950000
           EXEC CICS                                                    32960000
               WRITEQ TS                                                32970000
                   QUEUE (ASC-LIST-QUEUE-NAME)                          32980000
                   FROM  (LQW-LIST-QUEUE-WORK-AREA)                     32990000
                   ITEM  (PV-SAVE-ITEM)                                 33000000
                   REWRITE                                              33010000
                   RESP  (PV-CICS-RESP)                                 33020000
           END-EXEC.                                                    33030000
      *                                                                 33040000
           IF  PV-CICS-RESP = DFHRESP (NORMAL)                          33050000
               CONTINUE                                                 33060000
           ELSE                                                         33070000
               SET DP013-CICS-ABEND  TO  TRUE                           33080000
               SET DP013-NO-ROLLBACK TO  TRUE                           33090000
               MOVE '6111-WRITE-LIST-QUEUE'                             33100000
                                     TO  DP013-PARAGRAPH                33110000
               MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  33120000
                                     TO  DP013-MESSAGE-TEXT(1)          33130000
               PERFORM DP013-0000-PROCESS-ABEND                         33140000
           END-IF.                                                      33150000
                                                                        33160000
       EJECT                                                            33170000
      *----------------------------------------------------------------*33180000
      *    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*33190000
      *----------------------------------------------------------------*33200000
                                                                        33210000
       6112-READ-LIST-QUEUE.                                            33220000
                                                                        33230000
           EXEC CICS                                                    33240000
               READQ TS                                                 33250000
                   QUEUE (ASC-LIST-QUEUE-NAME)                          33260000
                   INTO  (LQW-LIST-QUEUE-WORK-AREA)                     33270000
                   ITEM  (PV-ITEM)                                      33280000
                   RESP  (PV-CICS-RESP)                                 33290000
           END-EXEC.                                                    33300000
      *                                                                 33310000
           IF  PV-CICS-RESP = DFHRESP (NORMAL)                          33320000
               CONTINUE                                                 33330000
           ELSE                                                         33340000
               SET DP013-CICS-ABEND        TO TRUE                      33350000
               SET DP013-NO-ROLLBACK       TO TRUE                      33360000
               MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           33370000
               MOVE 'ATTEMPTING TO READ LIST QUEUE'                     33380000
                                           TO DP013-MESSAGE-TEXT(1)     33390000
               PERFORM DP013-0000-PROCESS-ABEND                         33400000
           END-IF.                                                      33410000
                                                                        33420000
       EJECT                                                            33430000
      *----------------------------------------------------------------*33440000
      *  READ THE TRANSFER RECEIPT TABLE FOR THE RECEIVED STORE NUMBER.*33450000
      *----------------------------------------------------------------*33460000
       6200-READ-TRANSFER-RECEIPT.                                      33470000
           PERFORM WITH TEST AFTER                                      33480000
               VARYING PV-RETRY-COUNT FROM 1 BY 1                       33490000
                 UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                  33500000
                    OR SQLCODE = ZERO                                   33510000
                    OR SQLCODE = +100                                   33520000
               EXEC SQL                                                 33530000
                   SELECT  R.STR_NBR                                    33540000
100404                   , S.LOC_10_ABBR_NM                             33550000
                      INTO :TFRCPT-STR-NBR                              33560000
100404                   , :XST00001-LOC-10-ABBR-NM                     33570000
                      FROM TTFRCPT R                                    33580000
100404                   , XST_LOC S                                    33590000
                         , TTFSTAT ST                                   33600000
                      WHERE ST.XFER_STAT_CDE = :PC-POSITIVE-RECEIPT AND 33610000
                            ST.XFER_STAT_TMST = R.RCV_XFER_BEG_TMST AND 33620000
                            R.XFER_DKEY_ID   = :DK-XFER-DKEY-ID     AND 33630000
                            ST.XFER_DKEY_ID  = :DK-XFER-DKEY-ID     AND 33640000
100404                      S.LOC_NBR        = R.STR_NBR                33650000
               END-EXEC                                                 33660000
               EVALUATE TRUE                                            33670000
                   WHEN SQLCODE = ZERO                                  33680000
                       MOVE TFRCPT-STR-NBR                              33690000
                                          TO ASC-RECV-STORE-NBR         33700000
100404                 MOVE XST00001-LOC-10-ABBR-NM                     33710000
                                          TO ASC-RECV-STORE-NAM         33720000
                   WHEN SQLCODE = -904                                  33730000
                   WHEN SQLCODE = -913                                  33740000
                   WHEN SQLCODE = +100                                  33750000
                       CONTINUE                                         33760000
                   WHEN OTHER                                           33770000
                       MOVE '6200-READ-TRANSFER-RECEIPT'                33780000
                                         TO DP013-PARAGRAPH             33790000
                       MOVE 'SELECT DATA FROM TTFRCPT'                  33800000
                                         TO DP013-MESSAGE-TEXT (1)      33810000
                       MOVE SQLCA        TO DP013-SQLCA                 33820000
                       MOVE 'TTFRCPT'    TO DP013-DB2-TABLE-NAME (1)    33830000
100404                 MOVE 'XST_LOC'    TO DP013-DB2-TABLE-NAME (2)    33840000
                       MOVE 'TTFSTAT'    TO DP013-DB2-TABLE-NAME (3)    33850000
                       SET DP013-DB2-ABEND                              33860000
                           DP013-XCTL-DISPLAY-RESTART                   33870000
                                         TO TRUE                        33880000
                       PERFORM DP013-0000-PROCESS-ABEND                 33890000
               END-EVALUATE                                             33900000
           END-PERFORM.                                                 33910000
      *                                                                 33920000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          33930000
               MOVE '6200-READ-TRANSFER-RECEIPT'                        33940000
                                         TO DP013-PARAGRAPH             33950000
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     33960000
                                         TO DP013-MESSAGE-TEXT (1)      33970000
               MOVE 'DATA FROM TTFRCPT'  TO DP013-MESSAGE-TEXT (2)      33980000
               MOVE SQLCA                TO DP013-SQLCA                 33990000
               MOVE 'TTFRCPT'            TO DP013-DB2-TABLE-NAME (1)    34000000
100404         MOVE 'XST_LOC'            TO DP013-DB2-TABLE-NAME (2)    34010000
               MOVE 'TTFSTAT'            TO DP013-DB2-TABLE-NAME (3)    34020000
               SET DP013-DB2-ABEND                                      34030000
                   DP013-XCTL-DISPLAY-RESTART                           34040000
                                         TO TRUE                        34050000
               PERFORM DP013-0000-PROCESS-ABEND                         34060000
           END-IF.                                                      34070000
       EJECT                                                            34080000
      *----------------------------------------------------------------*34090000
      * PRODUCE THE LIST REPORT USING THE DRS FACILITY.                *34100000
      *----------------------------------------------------------------*34110000
       6300-PRINT-LIST.                                                 34120000
                                                                        34130000
           PERFORM 6310-INITIALIZE.                                     34140000
           MOVE PC-PUT                 TO DRS01-DRRB-FUNC.              34150000
           PERFORM 6320-READ-LIST-QUEUE                                 34160000
                   VARYING PV-ITEM                                      34170000
                   FROM 1 BY 1                                          34180000
                   UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     34190000
                                                                        34200000
           MOVE PC-TERM                TO DRS01-DRRB-FUNC.              34210000
           PERFORM 8000-LINK-TO-DRS.                                    34220000
                                                                        34230000
      *----------------------------------------------------------------*34240000
      * INITIALIZE VARIABLES FOR DRS PRINTING.                         *34250000
      *----------------------------------------------------------------*34260000
       6310-INITIALIZE.                                                 34270000
           PERFORM 8100-FORMAT-TIME.                                    34280000
                                                                        34290000
           IF TF001-PRINTER-DEST = 'XXXX'                               34300000
               MOVE 'R'                TO DRS02-DRIB-CLASS              34310000
               MOVE 'N'                TO DRS02-DRIB-HOLD               34320000
               MOVE 'LOCAL'            TO DRS02-DRIB-DEST               34330000
           ELSE                                                         34340000
               MOVE 'A'                TO DRS02-DRIB-CLASS              34350000
               MOVE 'N'                TO DRS02-DRIB-HOLD               34360000
               MOVE TF001-PRINTER-DEST TO DRS02-DRIB-DEST               34370000
           END-IF.                                                      34380000
                                                                        34390000
           MOVE PC-INIT                TO DRS01-DRRB-FUNC.              34400000
           MOVE DRS02-DRIB-HEADER      TO DRS01-COMM-DRIB-HDR.          34410000
           MOVE DRS02-DRIB-ATTRIB      TO DRS01-COMM-DRIB-AT1.          34420000
                                                                        34430000
           PERFORM 8000-LINK-TO-DRS.                                    34440000
                                                                        34450000
           MOVE PC-CURRENT-PROGRAM-NAME TO DP132O-PROGRAM-NAME.         34460000
           MOVE 1                       TO DP132O-REPORT-NUMBER.        34470000
           MOVE ASC-XFER-SEQ-NBR        TO HL3-XFER-SEQ-NBR.            34480000
           MOVE ASC-FROM-STORE-NBR      TO HL3-FR-STORE-NBR             34490000
                                           HL3-XFER-FR-STORE-NBR.       34500000
           MOVE ASC-FROM-STORE-NAM      TO HL3-FR-STORE-NAME.           34510000
           MOVE ASC-TO-STORE-NBR        TO HL4-TO-STORE-NBR.            34520000
           MOVE ASC-TO-STORE-NAM        TO HL4-TO-STORE-NAME.           34530000
           MOVE ASC-RECV-STORE-NBR      TO HL5-RC-STORE-NBR.            34540000
           MOVE ASC-RECV-STORE-NAM      TO HL5-RC-STORE-NAME.           34550000
           MOVE ASC-KEY-XFER-LNE-NBR    TO HL8-LINE.                    34560000
           MOVE ASC-DEPT                TO HL8-DEPT.                    34570000
           IF ASC-CLASS < PC-100 AND ASC-SUBCLASS < PC-100              34580000
                MOVE ASC-CLASS    TO HL8-CLASS-1                        34590000
                MOVE ASC-SUBCLASS TO HL8-SUBCLASS-1                     34600000
           ELSE IF                                                      34610000
              ASC-CLASS < PC-100 AND ASC-SUBCLASS > PC-099              34620000
                MOVE ASC-CLASS    TO HL8-CLASS-2                        34630000
                MOVE ASC-SUBCLASS TO HL8-SUBCLASS-2                     34640000
                MOVE SPACES       TO HL8-FILLER-2A                      34650000
                                     HL8-FILLER-2B                      34660000
           ELSE IF                                                      34670000
              ASC-CLASS > PC-099 AND ASC-SUBCLASS < PC-100              34680000
                MOVE ASC-CLASS    TO HL8-CLASS-3                        34690000
                MOVE ASC-SUBCLASS TO HL8-SUBCLASS-3                     34700000
                MOVE SPACES       TO HL8-FILLER-3A                      34710000
                                     HL8-FILLER-3B                      34720000
           ELSE IF                                                      34730000
              ASC-CLASS > PC-099 AND ASC-SUBCLASS > PC-099              34740000
                MOVE ASC-CLASS    TO HL8-CLASS-4                        34750000
                MOVE ASC-SUBCLASS TO HL8-SUBCLASS-4                     34760000
                MOVE SPACES       TO HL8-FILLER-4A                      34770000
           END-IF                                                       34780000
           END-IF                                                       34781000
           END-IF                                                       34781100
           END-IF                                                       34781200
           MOVE ASC-UPC                 TO HL8-UPC.                     34781300
           MOVE '-'                     TO HL8-UPC-DASH-1               34781400
                                           HL8-UPC-DASH-2               34781500
                                           HL8-UPC-DASH-3.              34781600
           IF ASC-TQTY > ZERO                                           34781700
               MOVE ASC-TQTY            TO HL8-TQTY                     34781800
               MOVE ASC-TPRICE          TO HL8-TPRICE                   34781900
           END-IF.                                                      34782000
           IF ASC-RQTY (1) > ZERO                                       34783000
               MOVE ASC-RQTY (1)        TO HL8-RQTY                     34784000
               MOVE ASC-RPRICE (1)      TO HL8-RPRICE                   34785000
           END-IF.                                                      34786000
           MOVE ASC-FPRICE              TO HL8-FPRICE.                  34787000
           IF ASC-RQTY (2) > ZERO                                       34788000
               MOVE ASC-RQTY (2)        TO HL8A-RQTY                    34789000
               MOVE ASC-RPRICE (2)      TO HL8A-RPRICE                  34790000
               SET PS-PRINT-HL8A        TO TRUE                         34800000
           END-IF.                                                      34810000
           IF ASC-RQTY (3) > ZERO                                       34820000
               MOVE ASC-RQTY (3)        TO HL8B-RQTY                    34830000
               MOVE ASC-RPRICE (3)      TO HL8B-RPRICE                  34840000
               SET PS-PRINT-HL8B        TO TRUE                         34850000
           END-IF.                                                      34860000
           MOVE 99                      TO PV-LINE-COUNT.               34870000
           MOVE 0                       TO PV-PAGE-COUNT.               34880000
      *----------------------------------------------------------------*34890000
      * READ A LIST QUEUE RECORD AND GENERATE THE DRS REPORT DETAIL    *34900000
      * LINE FOR ALL ENTRIES IN THE BLOCK.                             *34910000
      *----------------------------------------------------------------*34920000
                                                                        34930000
       6320-READ-LIST-QUEUE.                                            34940000
                                                                        34950000
           PERFORM 6112-READ-LIST-QUEUE.                                34960000
                                                                        34970000
           IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       34980000
               PERFORM 6330-PRINT-REPORT                                34990000
                 VARYING LQW-IDX                                        35000000
                   FROM 1 BY 1                                          35010000
                   UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL        35020000
                     OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO      35030000
           END-IF.                                                      35040000
       EJECT                                                            35050000
      *----------------------------------------------------------------*35060000
      * MOVE THE APPROPRIATE FIELDS (DEPENDING ON THE TRANSFER TYPE)   *35070000
      * TO THE DETAIL LINE AND PRINT.                                  *35080000
      *----------------------------------------------------------------*35090000
       6330-PRINT-REPORT.                                               35100000
           IF PV-LINE-COUNT > PC-LINE-MAX                               35110000
               PERFORM 8200-PRINT-HEADINGS                              35120000
           END-IF.                                                      35130000
           MOVE LQW-DTE-YEAR      (LQW-IDX) TO PV-YEAR.                 35140000
           MOVE LQW-DTE-MONTH     (LQW-IDX) TO PV-MONTH.                35150000
           MOVE LQW-DTE-DAY       (LQW-IDX) TO PV-DAY.                  35160000
           MOVE PV-DATE                     TO DL1-DATE.                35170000
           MOVE LQW-DTL-FR-NBR    (LQW-IDX) TO DL1-FROM-NBR.            35180000
           MOVE LQW-DTL-FR-NAM-10 (LQW-IDX) TO DL1-FROM-NAM.            35190000
           MOVE LQW-DTL-TO-NBR    (LQW-IDX) TO DL1-TO-NBR.              35200000
           MOVE LQW-DTL-TO-NAM-10 (LQW-IDX) TO DL1-TO-NAM.              35210000
           MOVE LQW-DTL-FR-QTY    (LQW-IDX) TO DL1-QTY.                 35220000
           MOVE LQW-PRICE         (LQW-IDX) TO DL1-PRICE.               35230000
           MOVE LQW-FR-EXT-PRICE  (LQW-IDX) TO DL1-EXT-PRICE.           35240000
           MOVE LQW-REASON        (LQW-IDX) TO DL1-REASON.              35250000
           MOVE PC-SINGLE-SPACE             TO DRS01-COMM-CTL.          35260000
           MOVE DL1-DETAIL-LINE-1           TO DRS01-COMM-DATA.         35270000
           PERFORM 8000-LINK-TO-DRS.                                    35280000
           ADD 1                       TO PV-LINE-COUNT.                35290000
      *----------------------------------------------------------------*35300000
      *  CREATE A REVERSE POSTING ENTRY FOR SELECTED ITEMS, THEN       *35310000
      *  SET UP THE INTER APPLICATION COMMAREA FOR THE REVERSAL        *35320000
      *  COMMENTS UPDATE PROGRAM.                                      *35330000
      *----------------------------------------------------------------*35340000
       7000-REVERSE.                                                    35350000
                                                                        35360000
           MOVE ZERO                       TO PV-SEL-QUEUE-ITEM.        35370000
           PERFORM 7100-READ-LIST-QUEUE                                 35380000
                   VARYING PV-ITEM                                      35390000
                   FROM 1 BY 1                                          35400000
                   UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     35410000
           INITIALIZE TF003-INTER-APPL-COMMAREA                         35420000
           MOVE ASC-KEY-XFER-DKEY-ID  TO TF003-XFER-DKEY-ID.            35430000
           MOVE ASC-KEY-XFER-LNE-NBR  TO TF003-XFER-LNE-NBR.            35440000
           MOVE ASC-XFER-SEQ-NBR      TO TF003-XFER-SEQ-NBR.            35450000
           MOVE ASC-FROM-STORE-NBR    TO TF003-FR-STR-NBR.              35460000
           MOVE ASC-FROM-STORE-NAM    TO TF003-FR-STR-NAM.              35470000
           MOVE ASC-TO-STORE-NBR      TO TF003-TO-STR-NBR.              35480000
           MOVE ASC-TO-STORE-NAM      TO TF003-TO-STR-NAM.              35490000
           MOVE ASC-RECV-STORE-NBR    TO TF003-RC-STR-NBR.              35500000
           MOVE ASC-RECV-STORE-NAM    TO TF003-RC-STR-NAM.              35510000
           MOVE PV-SEL-QUEUE-ITEM     TO TF003-NBR-OF-POSTING-LINES.    35520000
           PERFORM                                                      35530000
             VARYING PV-ITEM                                            35540000
               FROM 1 BY 1                                              35550000
               UNTIL PV-ITEM > PV-SEL-QUEUE-ITEM                        35560000
               MOVE ASC-INSERTED-PSTG-SEQ-NBR (PV-ITEM)                 35570000
                                      TO TF003-PSTG-SEQ-NBR (PV-ITEM)   35580000
           END-PERFORM.                                                 35590000
      *----------------------------------------------------------------*35600000
      * READ A LIST QUEUE RECORD AND CHECK FOR SELECTED ITEMS.         *35610000
      *----------------------------------------------------------------*35620000
                                                                        35630000
       7100-READ-LIST-QUEUE.                                            35640000
                                                                        35650000
           PERFORM 6112-READ-LIST-QUEUE.                                35660000
                                                                        35670000
           IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       35680000
               PERFORM                                                  35690000
                 VARYING LQW-IDX                                        35700000
                   FROM 1 BY 1                                          35710000
                   UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL        35720000
                     OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO      35730000
                 IF LQW-SELECT (LQW-IDX)                                35740000
                     PERFORM 7200-INSERT-REVERSE-ENTRY                  35750000
                 END-IF                                                 35760000
               END-PERFORM                                              35770000
           END-IF.                                                      35780000
      *----------------------------------------------------------------*35790000
      * INSERT RETAIL ITEMS.                                           *35800000
      *----------------------------------------------------------------*35810000
       7200-INSERT-REVERSE-ENTRY.                                       35820000
           INITIALIZE DCLTTFITPS.                                       35830000
           MOVE ASC-KEY-XFER-DKEY-ID       TO TFITPS-XFER-DKEY-ID.      35840000
           MOVE ASC-KEY-XFER-LNE-NBR       TO TFITPS-XFER-LNE-NBR.      35850000
           ADD +1                          TO ASC-MAX-POSTING-SEQ-NBR   35860000
                                              PV-SEL-QUEUE-ITEM.        35870000
           MOVE ASC-MAX-POSTING-SEQ-NBR    TO TFITPS-PSTG-SEQ-NBR       35880000
                                              ASC-INSERTED-PSTG-SEQ-NBR 35890000
                                              (PV-SEL-QUEUE-ITEM).      35900000
           MOVE PC-AUTO-REVERSAL           TO TFITPS-ADJ-RSN-CDE.       35910000
           MOVE LQW-DTL-TO-NBR (LQW-IDX)   TO TFITPS-FRM-PSTG-STR-NBR.  35920000
           MOVE LQW-DTL-FR-NBR (LQW-IDX)   TO TFITPS-TO-PSTG-STR-NBR.   35930000
           MOVE LQW-PRICE      (LQW-IDX)   TO TFITPS-ITM-RTL-PRCE-AMT.  35940000
           MOVE LQW-DTL-FR-QTY (LQW-IDX)   TO TFITPS-ITM-QTY.           35950000
           MOVE DP020-USERID               TO TFITPS-ADJ-BY-USR-ID.     35960000
           IF LQW-EXTL-SYS-PRCG-CDE (LQW-IDX) = PC-FASHION-SALES        35970000
               MOVE PC-FASHION-SALES       TO TFITPS-EXTL-SYS-PRCG-CDE  35980000
           ELSE                                                         35990000
               MOVE LQW-DTL-TO-NBR (LQW-IDX)   TO DK-STORE-NBR          36000000
100404         PERFORM 5550-READ-XST-LOC                                36010000
100404         IF XST00001-LOC-TYP-CDE = PC-RTV                         36020000
                   MOVE PC-FASHION-SALES   TO TFITPS-EXTL-SYS-PRCG-CDE  36030000
               ELSE                                                     36040000
                   MOVE PC-MERCH-LEDGER    TO TFITPS-EXTL-SYS-PRCG-CDE  36050000
               END-IF                                                   36060000
           END-IF.                                                      36070000
           PERFORM WITH TEST AFTER                                      36080000
               VARYING PV-RETRY-COUNT FROM 1 BY 1                       36090000
               UNTIL SQLCODE = 0 OR                                     36100000
                     PV-RETRY-COUNT > PC-MAX-RETRIES                    36110000
                                                                        36120000
               EXEC SQL                                                 36130000
                    INSERT                                              36140000
                      INTO TTFITPS                                      36150000
                          (XFER_DKEY_ID                                 36160000
                         , XFER_LNE_NBR                                 36170000
                         , PSTG_SEQ_NBR                                 36180000
                         , ADJ_RSN_CDE                                  36190000
                         , ITM_PSTG_PRPD_TMST                           36200000
                         , FRM_PSTG_STR_NBR                             36210000
                         , TO_PSTG_STR_NBR                              36220000
                         , ITM_RTL_PRCE_AMT                             36230000
                         , ITM_QTY                                      36240000
                         , EXTL_SYS_PRCG_CDE                            36250000
                         , ADJ_BY_USR_ID)                               36260000
                    VALUES                                              36270000
                          (:TFITPS-XFER-DKEY-ID                         36280000
                         , :TFITPS-XFER-LNE-NBR                         36290000
                         , :TFITPS-PSTG-SEQ-NBR                         36300000
                         , :TFITPS-ADJ-RSN-CDE                          36310000
                         ,  CURRENT TIMESTAMP                           36320000
                         , :TFITPS-FRM-PSTG-STR-NBR                     36330000
                         , :TFITPS-TO-PSTG-STR-NBR                      36340000
                         , :TFITPS-ITM-RTL-PRCE-AMT                     36350000
                         , :TFITPS-ITM-QTY                              36360000
                         , :TFITPS-EXTL-SYS-PRCG-CDE                    36370000
                         , :TFITPS-ADJ-BY-USR-ID)                       36380000
               END-EXEC                                                 36390000
                                                                        36400000
               EVALUATE TRUE                                            36410000
                   WHEN SQLCODE = 0                                     36420000
                   WHEN SQLCODE = -904                                  36430000
                   WHEN SQLCODE = -913                                  36440000
                        CONTINUE                                        36450000
                   WHEN OTHER                                           36460000
                        MOVE '7200-INSERT-REVERSE-ENTRY'                36470000
                                          TO DP013-PARAGRAPH            36480000
                        MOVE 'INSERT A ROW INTO THE TTFITPS TABLE'      36490000
                                          TO DP013-MESSAGE-TEXT(1)      36500000
                        MOVE SQLCA        TO DP013-SQLCA                36510000
                        MOVE 'TTFITPS'    TO DP013-DB2-TABLE-NAME (1)   36520000
                        SET DP013-DB2-ABEND                             36530000
                            DP013-XCTL-DISPLAY-RESTART TO TRUE          36540000
                        PERFORM DP013-0000-PROCESS-ABEND                36550000
               END-EVALUATE                                             36560000
           END-PERFORM.                                                 36570000
                                                                        36580000
           IF PV-RETRY-COUNT > PC-MAX-RETRIES AND                       36590000
              SQLCODE NOT = 0                                           36600000
               MOVE '7200-INSERT-REVERSE-ENTRY' TO DP013-PARAGRAPH      36610000
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO INSERT'     36620000
                                          TO DP013-MESSAGE-TEXT (1)     36630000
               MOVE 'A TRANSFER POSTING'  TO DP013-MESSAGE-TEXT (2)     36640000
               MOVE SQLCA                 TO DP013-SQLCA                36650000
               MOVE 'TTFITPS'             TO DP013-DB2-TABLE-NAME (1)   36660000
               SET DP013-DB2-ABEND                                      36670000
                   DP013-XCTL-DISPLAY-RESTART                           36680000
                                          TO TRUE                       36690000
               PERFORM DP013-0000-PROCESS-ABEND                         36700000
           END-IF.                                                      36710000
       EJECT                                                            36720000
051705*----------------------------------------------------------------*36730000
051705*  CHECK IF PHYSICAL INVENTORY IS ACTIVE.                         36740000
051705*----------------------------------------------------------------*36750000
051705*7300-CHECK-INVENTORY-CUTOFF.                                     36760000
051705*    EXEC SQL                                                     36770000
051705*        SET  :PV-CURRENT-DATE       =  CURRENT DATE              36780000
051705*    END-EXEC.                                                    36790000
051705*                                                                 36800000
051705*    EVALUATE TRUE                                                36810000
051705*        WHEN SQLWARN0 NOT = SPACES                               36820000
051705*        WHEN SQLCODE < ZERO                                      36830000
051705*        WHEN SQLCODE > ZERO                                      36840000
051705*            MOVE '7300-CHECK-INVENTORY-CUTOFF'                   36850000
051705*                                      TO DP013-PARAGRAPH         36860000
051705*            MOVE 'SELECT THE CURRENT DATE'                       36870000
051705*                                      TO DP013-MESSAGE-TEXT (1)  36880000
051705*            MOVE SQLCA                TO DP013-SQLCA             36890000
051705*            SET DP013-DB2-ABEND                                  36900000
051705*                DP013-NO-ROLLBACK     TO TRUE                    36910000
051705*            PERFORM DP013-0000-PROCESS-ABEND                     36920000
051705*    END-EVALUATE.                                                36930000
051705*    PERFORM 7400-READ-CONTROL-TABLE.                             36940000
051705*    MOVE ASC-FROM-STORE-NBR TO DK-STORE-NBR-9.                   36950000
051705*    PERFORM 7800-GET-STORE-XFER-CTOFF-DTE.                       36960000
051705*    MOVE INVPAR-XFER-INV-CTOFF-DTE TO PV-LY-INV-CTOFF-DTE.       36970000
051705*    MOVE ASC-TO-STORE-NBR          TO DK-STORE-NBR-9.            36980000
051705*    PERFORM 7800-GET-STORE-XFER-CTOFF-DTE.                       36990000
051705*    IF INVPAR-XFER-INV-CTOFF-DTE > PV-LY-INV-CTOFF-DTE           37000000
051705*        MOVE INVPAR-XFER-INV-CTOFF-DTE                           37010000
051705*                                   TO PV-LY-INV-CTOFF-DTE        37020000
051705*    END-IF.                                                      37030000
051705*    IF ASC-CMPLT-DATE <= PV-LY-INV-CTOFF-DTE                     37040000
051705*        SET DP020-MSG-FATAL                                      37050000
051705*            PS-INVENTORY-ERROR                                   37060000
051705*            DP030-OVERRIDE-GO      TO TRUE                       37070000
051705* -- CANNOT PROCESS BEFORE INVENTORY TRANSFER - CALL INV CONTROL  37080000
051705*        MOVE PC-TSYMSG-01615   TO DP020-MSG-NUMBER               37090000
051705*    ELSE                                                         37100000
051705*        IF PV-PHY-INV-PERD-IND = PC-YES                          37110000
051705*            PERFORM 7310-READ-LIST-QUEUE                         37120000
051705*                VARYING PV-ITEM                                  37130000
051705*                FROM 1 BY 1                                      37140000
051705*                UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN  37150000
051705*                  OR  PS-INVENTORY-ERROR                         37160000
051705*        END-IF                                                   37170000
051705*    END-IF.                                                      37180000
051705*----------------------------------------------------------------*37190000
051705* READ A LIST QUEUE RECORD AND CHECK FOR SELECTED ITEMS.         *37200000
051705*----------------------------------------------------------------*37210000
051705*7310-READ-LIST-QUEUE.                                            37220000
051705*                                                                 37230000
051705*    PERFORM 6112-READ-LIST-QUEUE.                                37240000
051705*                                                                 37250000
051705*    IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       37260000
051705*        PERFORM                                                  37270000
051705*          VARYING LQW-IDX                                        37280000
051705*            FROM 1 BY 1                                          37290000
051705*            UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL        37300000
051705*              OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO      37310000
051705*              OR  PS-INVENTORY-ERROR                             37320000
051705*          IF LQW-SELECT (LQW-IDX)                                37330000
051705*              PERFORM 7320-CHECK-PLANNED-DATES                   37340000
051705*          END-IF                                                 37350000
051705*        END-PERFORM                                              37360000
051705*    END-IF.                                                      37370000
051705*----------------------------------------------------------------*37380000
051705* READ A LIST QUEUE RECORD AND CHECK FOR SELECTED ITEMS.         *37390000
051705*----------------------------------------------------------------*37400000
051705*7320-CHECK-PLANNED-DATES.                                        37410000
051705*    MOVE LQW-DTL-FR-NBR (LQW-IDX)     TO DK-STORE-NBR-9.         37420000
051705*    PERFORM 7500-GET-STR-PLND-INV-DTE.                           37430000
051705*    MOVE INVPAR-PLND-INV-DTE   TO PV-FR-STR-INV-DTE.             37440000
051705*    MOVE PV-HOLD-INVENTORY-IND TO PV-FR-INVENTORY-IND.           37450000
051705*    MOVE LQW-DTL-TO-NBR (LQW-IDX)     TO DK-STORE-NBR-9.         37460000
051705*    PERFORM 7500-GET-STR-PLND-INV-DTE.                           37470000
051705*    MOVE INVPAR-PLND-INV-DTE   TO PV-TO-STR-INV-DTE.             37480000
051705*    MOVE PV-HOLD-INVENTORY-IND TO PV-TO-INVENTORY-IND.           37490000
051705*    IF PV-FR-NO-INVENTORY  AND                                   37500000
051705*       PV-TO-NO-INVENTORY                                        37510000
051705*        CONTINUE                                                 37520000
051705*    ELSE                                                         37530000
051705*        IF PV-FR-NO-INVENTORY                                    37540000
051705*            MOVE PV-TO-STR-INV-DTE   TO PV-FR-STR-INV-DTE        37550000
051705*        ELSE                                                     37560000
051705*            IF PV-TO-NO-INVENTORY                                37570000
051705*                MOVE PV-FR-STR-INV-DTE                           37580000
051705*                                     TO PV-TO-STR-INV-DTE        37590000
051705*            END-IF                                               37600000
051705*        END-IF                                                   37610000
051705*        IF ASC-CONTNR-TYP-CDE = PC-HAND-CARRY                    37620000
051705*            MOVE PV-FR-STR-INV-DTE      TO PV-COMPARE-DATE       37630000
051705*        ELSE                                                     37640000
051705*            MOVE PV-XFER-INV-CTOFF-DTE  TO PV-COMPARE-DATE       37650000
051705*        END-IF                                                   37660000
051705*        IF ASC-CMPLT-DATE <= PV-COMPARE-DATE                     37670000
051705*            IF PV-CURRENT-DATE > PV-MAX-FINCL-BK-DTE             37680000
051705*                SET DP020-MSG-FATAL                              37690000
051705*                    PS-INVENTORY-ERROR                           37700000
051705*                    DP030-OVERRIDE-GO      TO TRUE               37710000
051705* -- CANNOT PROCESS BEFORE INVENTORY TRANSFER - CALL INV CONTROL  37720000
051705*                MOVE PC-TSYMSG-01615   TO DP020-MSG-NUMBER       37730000
051705*            END-IF                                               37740000
051705*        ELSE                                                     37750000
051705*            EVALUATE TRUE                                        37760000
051705*                WHEN PV-CURRENT-DATE > PV-MAX-PLND-INV-DTE       37770000
051705*                WHEN PV-FR-STR-INV-DTE <  PV-CURRENT-DATE   AND  37780000
051705*                     PV-TO-STR-INV-DTE <  PV-CURRENT-DATE        37790000
051705*                    CONTINUE                                     37800000
051705*                WHEN OTHER                                       37810000
051705*                    SET DP020-MSG-FATAL                          37820000
051705*                        PS-INVENTORY-ERROR                       37830000
051705*                        DP030-OVERRIDE-GO      TO TRUE           37840000
051705* -- WAIT 'TIL BOTH STORES FINISH PHYSICAL INVENTORY              37850000
051705*                    MOVE PC-TSYMSG-01659    TO DP020-MSG-NUMBER  37860000
051705*            END-EVALUATE                                         37870000
051705*        END-IF                                                   37880000
051705*    END-IF.                                                      37890000
051705*EJECT                                                            37900000
051705*----------------------------------------------------------------*37910000
051705*    GET THE PHYSICAL INVENTORY PERIOD INDICATOR FROM TTFCNTL    *37920000
051705*----------------------------------------------------------------*37930000
051705*7400-READ-CONTROL-TABLE.                                         37940000
051705*    PERFORM                                                      37950000
051705*        WITH TEST AFTER                                          37960000
051705*        VARYING PV-RETRY-COUNT                                   37970000
051705*        FROM 1 BY 1                                              37980000
051705*        UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 37990000
051705*            OR (SQLCODE = +0))                                   38000000
051705*        EXEC SQL                                                 38010000
051705*            SELECT PHY_INV_PERD_IND                              38020000
051705*                  ,XFER_INV_CTOFF_DTE                            38030000
051705*                  ,MAX_PLND_INV_DTE                              38040000
051705*                  ,MAX_FINCL_BK_DTE                              38050000
051705*             INTO :TFCNTL-PHY-INV-PERD-IND                       38060000
051705*                 ,:TFCNTL-XFER-INV-CTOFF-DTE                     38070000
051705*                 ,:TFCNTL-MAX-PLND-INV-DTE                       38080000
051705*                 ,:TFCNTL-MAX-FINCL-BK-DTE                       38090000
051705*             FROM TTFCNTL                                        38100000
051705*        END-EXEC                                                 38110000
051705*        EVALUATE TRUE                                            38120000
051705*            WHEN SQLCODE = ZERO                                  38130000
051705*                  MOVE TFCNTL-PHY-INV-PERD-IND                   38140000
051705*                                    TO PV-PHY-INV-PERD-IND       38150000
051705*                  MOVE TFCNTL-XFER-INV-CTOFF-DTE                 38160000
051705*                                    TO PV-XFER-INV-CTOFF-DTE     38170000
051705*                  MOVE TFCNTL-MAX-PLND-INV-DTE                   38180000
051705*                                    TO PV-MAX-PLND-INV-DTE       38190000
051705*                  MOVE TFCNTL-MAX-FINCL-BK-DTE                   38200000
051705*                                    TO PV-MAX-FINCL-BK-DTE       38210000
051705*            WHEN SQLCODE = -904                                  38220000
051705*            WHEN SQLCODE = -913                                  38230000
051705*                CONTINUE                                         38240000
051705*            WHEN OTHER                                           38250000
051705*                MOVE '7400-READ-CONTROL-TABLE'                   38260000
051705*                                  TO DP013-PARAGRAPH             38270000
051705*                MOVE 'GET THE PHYSICAL INV. PERIOD INDICATOR'    38280000
051705*                                      TO DP013-MESSAGE-TEXT (1)  38290000
051705*                MOVE SQLCA            TO DP013-SQLCA             38300000
051705*                MOVE 'TTFCNTL'        TO DP013-DB2-TABLE-NAME (1)38310000
051705*                SET DP013-DB2-ABEND                              38320000
051705*                DP013-XCTL-DISPLAY-RESTART                       38330000
051705*                                     TO TRUE                     38340000
051705*                PERFORM DP013-0000-PROCESS-ABEND                 38350000
051705*        END-EVALUATE                                             38360000
051705*    END-PERFORM.                                                 38370000
051705*                                                                 38380000
051705*    IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          38390000
051705*                MOVE '7400-READ-CONTROL-TABLE'                   38400000
051705*                                  TO DP013-PARAGRAPH             38410000
051705*                MOVE 'MAX RETRIES EXCEEDED READING '             38420000
051705*                                      TO DP013-MESSAGE-TEXT (1)  38430000
051705*                MOVE SQLCA            TO DP013-SQLCA             38440000
051705*                MOVE 'TTFCNTL'        TO DP013-DB2-TABLE-NAME (1)38450000
051705*                SET DP013-DB2-ABEND                              38460000
051705*                DP013-XCTL-DISPLAY-RESTART                       38470000
051705*                                     TO TRUE                     38480000
051705*                PERFORM DP013-0000-PROCESS-ABEND                 38490000
051705*    END-IF.                                                      38500000
051705*EJECT                                                            38510000
051705*----------------------------------------------------------------*38520000
051705*    GET THE MAX PLANNED INVENTORY DATE FOR THIS STORE           *38530000
051705*----------------------------------------------------------------*38540000
051705*7500-GET-STR-PLND-INV-DTE.                                       38550000
051705*    PERFORM                                                      38560000
051705*        WITH TEST AFTER                                          38570000
051705*        VARYING PV-RETRY-COUNT                                   38580000
051705*        FROM 1 BY 1                                              38590000
051705*        UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 38600000
051705*            OR (SQLCODE = +0)                                    38610000
051705*            OR (SQLCODE = +100))                                 38620000
051705*        EXEC SQL                                                 38630000
051705*            SELECT A.PLND_INV_DTE                                38640000
051705*                  ,A.ACTL_FIN_BK_DTE                             38650000
051705*                  ,A.SCHD_PHY_CNT_IND                            38660000
051705*             INTO :INVPAR-PLND-INV-DTE                           38670000
051705*                 ,:INVPAR-ACTL-FIN-BK-DTE                        38680000
051705*                 ,:INVPAR-SCHD-PHY-CNT-IND                       38690000
051705*             FROM TINVPAR A                                      38700000
051705*            WHERE  A.LOC_NBR      = :DK-STORE-NBR-9          AND 38710000
051705*                   A.PLND_INV_DTE < :PC-MAX-DATE                 38720000
051705*              AND  A.PLND_INV_DTE =                              38730000
051705*                   (SELECT MAX(PLND_INV_DTE)                     38740000
051705*                     FROM TINVPAR B                              38750000
051705*                    WHERE  B.LOC_NBR    = :DK-STORE-NBR-9    AND 38760000
051705*                           B.ACTL_FIN_BK_DTE = :PC-MAX-DATE  AND 38770000
051705*                           PLND_INV_DTE < :PC-MAX-DATE)          38780000
051705*        END-EXEC                                                 38790000
051705*        EVALUATE TRUE                                            38800000
051705*            WHEN SQLCODE = ZERO                                  38810000
051705*                IF INVPAR-SCHD-PHY-CNT-IND = PC-YES              38820000
051705*                    SET PV-HOLD-PHYSICAL-COUNT TO TRUE           38830000
051705*                ELSE                                             38840000
051705*                    IF INVPAR-ACTL-FIN-BK-DTE = PC-MAX-DATE      38850000
051705*                        SET PV-HOLD-FAKE-INVENTORY   TO TRUE     38860000
051705*                    ELSE                                         38870000
051705*                        SET PV-HOLD-NO-INVENTORY   TO TRUE       38880000
051705*                    END-IF                                       38890000
051705*                END-IF                                           38900000
051705*            WHEN SQLCODE = +100                                  38910000
051705*                MOVE PV-CURRENT-DATE TO INVPAR-PLND-INV-DTE      38920000
051705*                SET PV-HOLD-NO-INVENTORY   TO TRUE               38930000
051705*            WHEN SQLCODE = -904                                  38940000
051705*            WHEN SQLCODE = -913                                  38950000
051705*                CONTINUE                                         38960000
051705*            WHEN OTHER                                           38970000
051705*                MOVE '7500-GET-STR-PLND-INV-DTE'                 38980000
051705*                                  TO DP013-PARAGRAPH             38990000
051705*                MOVE 'GET THE PLANNED INVENTORY DATE FOR STORE:' 39000000
051705*                                      TO DP013-MESSAGE-TEXT (1)  39010000
051705*                MOVE DK-STORE-NBR-9                              39020000
051705*                                      TO DP013-MESSAGE-TEXT (2)  39030000
051705*                MOVE SQLCA            TO DP013-SQLCA             39040000
051705*                MOVE 'TINVPAR'        TO DP013-DB2-TABLE-NAME (1)39050000
051705*                SET DP013-DB2-ABEND                              39060000
051705*                DP013-XCTL-DISPLAY-RESTART                       39070000
051705*                                     TO TRUE                     39080000
051705*                PERFORM DP013-0000-PROCESS-ABEND                 39090000
051705*        END-EVALUATE                                             39100000
051705*    END-PERFORM.                                                 39110000
051705*                                                                 39120000
051705*    IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          39130000
051705*                MOVE '7500-GET-STR-PLND-INV-DTE'                 39140000
051705*                                  TO DP013-PARAGRAPH             39150000
051705*                MOVE 'MAX RETRIES EXCEEDED READING FOR STORE:'   39160000
051705*                                      TO DP013-MESSAGE-TEXT (1)  39170000
051705*                MOVE DK-STORE-NBR-9                              39180000
051705*                                      TO DP013-MESSAGE-TEXT (2)  39190000
051705*                MOVE SQLCA            TO DP013-SQLCA             39200000
051705*                MOVE 'TINVPAR'        TO DP013-DB2-TABLE-NAME (1)39210000
051705*                SET DP013-DB2-ABEND                              39220000
051705*                DP013-XCTL-DISPLAY-RESTART                       39230000
051705*                                     TO TRUE                     39240000
051705*                PERFORM DP013-0000-PROCESS-ABEND                 39250000
051705*    END-IF.                                                      39260000
051705*----------------------------------------------------------------*39270000
051705*    GET THE MAX XFER INVENTORY CUTOFF DATE FOR THIS STORE       *39280000
051705*----------------------------------------------------------------*39290000
051705*7800-GET-STORE-XFER-CTOFF-DTE.                                   39300000
051705*    PERFORM                                                      39310000
051705*        WITH TEST AFTER                                          39320000
051705*        VARYING PV-RETRY-COUNT                                   39330000
051705*        FROM 1 BY 1                                              39340000
051705*        UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 39350000
051705*            OR (SQLCODE = +0)                                    39360000
051705*            OR (SQLCODE = +100))                                 39370000
051705*        EXEC SQL                                                 39380000
051705*            SELECT MAX(XFER_INV_CTOFF_DTE)                       39390000
051705*                INTO :INVPAR-XFER-INV-CTOFF-DTE                  39400000
051705*                     :PV-NULL-IND                                39410000
051705*                FROM TINVPAR                                     39420000
051705*                WHERE  LOC_NBR    = :DK-STORE-NBR-9              39430000
051705*        END-EXEC                                                 39440000
051705*        EVALUATE TRUE                                            39450000
051705*            WHEN SQLCODE = ZERO                                  39460000
051705*            WHEN SQLCODE = -904                                  39470000
051705*            WHEN SQLCODE = -913                                  39480000
051705*                CONTINUE                                         39490000
051705*            WHEN SQLCODE = +100                                  39500000
051705*                MOVE PC-MIN-DATE   TO INVPAR-XFER-INV-CTOFF-DTE  39510000
051705*            WHEN OTHER                                           39520000
051705*                MOVE '7800-GET-STORE-XFER-CTOFF-DTE'             39530000
051705*                                  TO DP013-PARAGRAPH             39540000
051705*                MOVE 'GET THE TRANSFER CUTOFF DATE FOR STORE:'   39550000
051705*                                      TO DP013-MESSAGE-TEXT (1)  39560000
051705*                MOVE DK-STORE-NBR-9                              39570000
051705*                                      TO DP013-MESSAGE-TEXT (2)  39580000
051705*                MOVE SQLCA            TO DP013-SQLCA             39590000
051705*                MOVE 'TINVPAR'        TO DP013-DB2-TABLE-NAME (1)39600000
051705*                SET DP013-DB2-ABEND                              39610000
051705*                DP013-XCTL-DISPLAY-RESTART                       39620000
051705*                                     TO TRUE                     39630000
051705*                PERFORM DP013-0000-PROCESS-ABEND                 39640000
051705*        END-EVALUATE                                             39650000
051705*    END-PERFORM.                                                 39660000
051705*                                                                 39670000
051705*    IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          39680000
051705*                MOVE '7800-GET-STORE-XFER-CTOFF-DTE'             39690000
051705*                                  TO DP013-PARAGRAPH             39700000
051705*                MOVE 'MAX RETRIES EXCEEDED READING FOR STORE:'   39710000
051705*                                      TO DP013-MESSAGE-TEXT (1)  39720000
051705*                MOVE DK-STORE-NBR-9                              39730000
051705*                                      TO DP013-MESSAGE-TEXT (2)  39740000
051705*                MOVE SQLCA            TO DP013-SQLCA             39750000
051705*                MOVE 'TINVPAR'        TO DP013-DB2-TABLE-NAME (1)39760000
051705*                SET DP013-DB2-ABEND                              39770000
051705*                DP013-XCTL-DISPLAY-RESTART                       39780000
051705*                                     TO TRUE                     39790000
051705*                PERFORM DP013-0000-PROCESS-ABEND                 39800000
051705*    END-IF.                                                      39810000
051705*    IF PV-NULL-IND < 0                                           39820000
051705*        MOVE PC-MIN-DATE             TO INVPAR-XFER-INV-CTOFF-DTE39830000
051705*    END-IF.                                                      39840000
      *----------------------------------------------------------------*39850000
      * THIS MODULE EXECUTES A LINK TO DRS (DYNAMIC REPORT SYSTEM).     39860000
      *----------------------------------------------------------------*39870000
       8000-LINK-TO-DRS.                                                39880000
                                                                        39890000
           EXEC CICS                                                    39900000
               LINK                                                     39910000
                   PROGRAM   ('DRS1INTC')                               39920000
                   COMMAREA  (DRS01-COMMAREA)                           39930000
           END-EXEC.                                                    39940000
                                                                        39950000
      *----------------------------------------------------------------*39960000
      * FORMAT THE REPORT HEADING DATE AND TIME FIELDS.                 39970000
      *----------------------------------------------------------------*39980000
       8100-FORMAT-TIME.                                                39990000
                                                                        40000000
           EXEC CICS                                                    40010000
               ASKTIME ABSTIME (PV-ABSTIME)                             40020000
           END-EXEC.                                                    40030000
                                                                        40040000
           EXEC CICS                                                    40050000
               FORMATTIME ABSTIME  (PV-ABSTIME)                         40060000
                          MMDDYY   (DP132O-RUN-DATE)                    40070000
                          DATESEP  ('/')                                40080000
                          TIME     (DP132O-RUN-TIME)                    40090000
                          TIMESEP  (':')                                40100000
           END-EXEC.                                                    40110000
                                                                        40120000
       EJECT                                                            40130000
      *----------------------------------------------------------------*40140000
      *  PRINT THE REPORT HEADING LINES.                                40150000
      *----------------------------------------------------------------*40160000
       8200-PRINT-HEADINGS.                                             40170000
           ADD 1                       TO PV-PAGE-COUNT.                40180000
           MOVE 10                     TO PV-LINE-COUNT.                40190000
                                                                        40200000
           MOVE PV-PAGE-COUNT          TO DP132O-PAGE-NUMBER.           40210000
           MOVE DP132O-STANDRD-HEADER-132-COLS                          40220000
                                       TO DRS01-COMM-DATA.              40230000
           MOVE PC-TOP-OF-PAGE         TO DRS01-COMM-CTL.               40240000
           PERFORM 8000-LINK-TO-DRS.                                    40250000
                                                                        40260000
           MOVE HL2-HEADING-LINE-2     TO DRS01-COMM-DATA.              40270000
           MOVE PC-SINGLE-SPACE        TO DRS01-COMM-CTL.               40280000
           PERFORM 8000-LINK-TO-DRS.                                    40290000
                                                                        40300000
           MOVE HL3-HEADING-LINE-3     TO DRS01-COMM-DATA.              40310000
           MOVE PC-SINGLE-SPACE        TO DRS01-COMM-CTL.               40320000
           PERFORM 8000-LINK-TO-DRS.                                    40330000
                                                                        40340000
           MOVE HL4-HEADING-LINE-4     TO DRS01-COMM-DATA.              40350000
           MOVE PC-SINGLE-SPACE        TO DRS01-COMM-CTL.               40360000
           PERFORM 8000-LINK-TO-DRS.                                    40370000
                                                                        40380000
           MOVE HL5-HEADING-LINE-5     TO DRS01-COMM-DATA.              40390000
           MOVE PC-SINGLE-SPACE        TO DRS01-COMM-CTL.               40400000
           PERFORM 8000-LINK-TO-DRS.                                    40410000
                                                                        40420000
           MOVE AL-ASTERISK-LINE       TO DRS01-COMM-DATA.              40430000
           MOVE PC-SINGLE-SPACE        TO DRS01-COMM-CTL.               40440000
           PERFORM 8000-LINK-TO-DRS.                                    40450000
                                                                        40460000
           MOVE HL6-HEADING-LINE-6     TO DRS01-COMM-DATA.              40470000
           MOVE PC-SINGLE-SPACE        TO DRS01-COMM-CTL.               40480000
           PERFORM 8000-LINK-TO-DRS.                                    40490000
                                                                        40500000
           MOVE HL7-HEADING-LINE-7     TO DRS01-COMM-DATA.              40510000
           MOVE PC-SINGLE-SPACE        TO DRS01-COMM-CTL.               40520000
           PERFORM 8000-LINK-TO-DRS.                                    40530000
                                                                        40540000
           MOVE HL8-HEADING-LINE-8     TO DRS01-COMM-DATA.              40550000
           MOVE PC-SINGLE-SPACE        TO DRS01-COMM-CTL.               40560000
           PERFORM 8000-LINK-TO-DRS.                                    40570000
                                                                        40580000
           IF PS-PRINT-HL8A                                             40590000
               MOVE HL8A-HEADING-LINE-8A TO DRS01-COMM-DATA             40600000
               MOVE PC-SINGLE-SPACE    TO DRS01-COMM-CTL                40610000
               PERFORM 8000-LINK-TO-DRS                                 40620000
               ADD 1                   TO PV-LINE-COUNT                 40630000
           END-IF.                                                      40640000
                                                                        40650000
           IF PS-PRINT-HL8B                                             40660000
               MOVE HL8B-HEADING-LINE-8B TO DRS01-COMM-DATA             40670000
               MOVE PC-SINGLE-SPACE    TO DRS01-COMM-CTL                40680000
               PERFORM 8000-LINK-TO-DRS                                 40690000
               ADD 1                   TO PV-LINE-COUNT                 40700000
           END-IF.                                                      40710000
                                                                        40720000
           MOVE AL-ASTERISK-LINE       TO DRS01-COMM-DATA.              40730000
           MOVE PC-SINGLE-SPACE        TO DRS01-COMM-CTL.               40740000
           PERFORM 8000-LINK-TO-DRS.                                    40750000
                                                                        40760000
           MOVE HL9-HEADING-LINE-9     TO DRS01-COMM-DATA.              40770000
           MOVE PC-SINGLE-SPACE        TO DRS01-COMM-CTL.               40780000
           PERFORM 8000-LINK-TO-DRS.                                    40790000
                                                                        40800000
           MOVE BL-BLANK-LINE          TO DRS01-COMM-DATA.              40810000
           MOVE PC-SINGLE-SPACE        TO DRS01-COMM-CTL.               40820000
           PERFORM 8000-LINK-TO-DRS.                                    40830000
                                                                        40840000
       EJECT                                                            40850000
      *----------------------------------------------------------------*40860000
      * READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *40870000
      *----------------------------------------------------------------*40880000
                                                                        40890000
       9100-READ-SEL-QUEUE-IN.                                          40900000
           EXEC CICS                                                    40910000
               READQ TS                                                 40920000
                   QUEUE (ASC-SEL-QUEUE-IN-NAME)                        40930000
                   INTO  (TF002-TRANSFER-SEL-REC)                       40940000
                   ITEM  (ASC-SEL-ITEM)                                 40950000
                   RESP  (PV-CICS-RESP)                                 40960000
           END-EXEC.                                                    40970000
                                                                        40980000
           IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       40990000
               CONTINUE                                                 41000000
           ELSE                                                         41010000
               SET DP013-LOGIC-ABEND                                    41020000
                   DP013-NO-ROLLBACK     TO TRUE                        41030000
               MOVE '9100-READ-SEL-QUEUE-IN'                            41040000
                                         TO DP013-PARAGRAPH             41050000
               MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   41060000
                                         TO DP013-MESSAGE-TEXT (1)      41070000
               PERFORM DP013-0000-PROCESS-ABEND                         41080000
           END-IF.                                                      41090000
      *----------------------------------------------------------------*41100000
      * UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *41110000
      *----------------------------------------------------------------*41120000
       9200-REWRITE-SEL-QUEUE-IN.                                       41130000
           EXEC CICS                                                    41140000
                WRITEQ TS                                               41150000
                    QUEUE  (ASC-SEL-QUEUE-IN-NAME)                      41160000
                    FROM   (TF002-TRANSFER-SEL-REC)                     41170000
                    ITEM   (ASC-SEL-ITEM)                               41180000
                    RESP   (PV-CICS-RESP)                               41190000
                    REWRITE                                             41200000
           END-EXEC.                                                    41210000
                                                                        41220000
           IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   41230000
               SET DP013-CICS-ABEND                                     41240000
                   DP013-NO-ROLLBACK     TO TRUE                        41250000
               MOVE '9200-REWRITE-SEL-QUEUE-IN'                         41260000
                                         TO DP013-PARAGRAPH             41270000
               MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   41280000
                                         TO DP013-MESSAGE-TEXT (1)      41290000
               PERFORM DP013-0000-PROCESS-ABEND                         41300000
           END-IF.                                                      41310000
                                                                        41320000
       EJECT                                                            41330000
      *----------------------------------------------------------------*41340000
      *    ABEND PROCESSOR MODULE                                      *41350000
      *----------------------------------------------------------------*41360000
                                                                        41370000
           COPY DPPD013.                                                41380000
