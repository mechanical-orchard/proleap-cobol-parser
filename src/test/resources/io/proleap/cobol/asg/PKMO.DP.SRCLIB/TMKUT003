000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             TMKUT003.                                00050000
000600 AUTHOR.                 TAMARA KOLTUN.                           00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            9-10-96.                                 00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100*----------------------------------------------------------------*00110000
001200* THIS PROGRAM ATTACHES THE RESPONSIBILITY HIERARCHY TO EACH     *00120000
001300* TROUBLE RECORD IN THE TROUBLE EXTRACT FILE BASED ON THE DPT    *00130000
001310* NUMBER.                                                        *00131000
001320*----------------------------------------------------------------*00132000
001330                                                                  00133000
001340******************************************************************00134000
001350 ENVIRONMENT DIVISION.                                            00135000
001360******************************************************************00136000
001370                                                                  00137000
001380 CONFIGURATION SECTION.                                           00138000
001390                                                                  00139000
001400 SOURCE-COMPUTER.        IBM-3090.                                00140000
001500 OBJECT-COMPUTER.        IBM-3090.                                00150000
001600                                                                  00160000
001700 INPUT-OUTPUT SECTION.                                            00170000
001800                                                                  00180000
001900 FILE-CONTROL.                                                    00190000
002000                                                                  00200000
002100      SELECT EXTRACT-TRBL-FILE-IN   ASSIGN TO INP01.              00210000
002110      SELECT EXTRACT-TRBL-FILE-OUT  ASSIGN TO OUT01.              00210000
002200                                                                  00220000
002300******************************************************************00230000
002400 DATA DIVISION.                                                   00240000
002500******************************************************************00250000
002600                                                                  00260000
002700 FILE SECTION.                                                    00270000
002800 FD  EXTRACT-TRBL-FILE-IN                                               00
002900     LABEL RECORDS ARE STANDARD                                   00290000
003000     BLOCK CONTAINS 0 RECORDS                                     00300000
003100     RECORDING MODE IS F                                          00310000
003200     RECORD CONTAINS 400 CHARACTERS                               00320000
003300     DATA RECORD IS TE-TRBL-EXTRACT-IN-RECORD.                          00
003400                                                                  00340000
003500 01  TE-TRBL-EXTRACT-IN-RECORD       PIC X(400).                  00350000
003501                                                                          
003502                                                                          
003510 FD  EXTRACT-TRBL-FILE-OUT                                              00
003520     LABEL RECORDS ARE STANDARD                                   00290000
003530     BLOCK CONTAINS 0 RECORDS                                     00300000
003540     RECORDING MODE IS F                                          00310000
003550     RECORD CONTAINS 400 CHARACTERS                               00320000
003560     DATA RECORD IS TE-TRBL-OUT-EXTRACT-RECORD.                         00
003570                                                                  00340000
003580 01  TE-TRBL-EXTRACT-OUT-RECORD      PIC X(400).                  00350000
003600*------------------------------------------------------*          00360000
003700 WORKING-STORAGE SECTION.                                         00370000
003800*------------------------------------------------------*          00380000
003900 01 PC-PROGRAM-CONSTANTS.                                         00390000
004000    05 PC-PROGRAM-NAME               PIC X(08) VALUE 'TMKUT003'.  00400000
004100    05  PC-DPT                       PIC X(03)     VALUE 'DPT'.   00410000
004200    05  PC-DMA                       PIC X(03)     VALUE 'DMA'.   00420000
004300    05  PC-ANM                       PIC X(03)     VALUE 'ANM'.   00430000
004400    05  PC-ANL                       PIC X(03)     VALUE 'ANL'.   00440000
004500    05  PC-OPERCO-CDE                PIC X(02)     VALUE '03'.    00450000
004510    05  PC-NOT-FOUND                 PIC X(15)     VALUE          00451003
004520                                            '** NOT FOUND **'.    00452003
004600 01 PC-PROGRAM-VARIABLES.                                         00460000
004700    05 PV-PARA-NAME                  PIC X(30)     VALUE SPACE.   00470000
004800    05 PV-ABEND-CODE                 PIC 9(04)     VALUE 0.       00480000
004900    05 PV-ABEND-PARA-NAME            PIC X(30)     VALUE SPACE.   00490000
005000    05 PV-DB2-OPERATION-MSG-1        PIC X(40)     VALUE SPACE.   00500000
005100    05 PV-DB2-TABLE-NAME             PIC X(12)     VALUE SPACE.   00510000
005200    05 PV-SQLCODE                    PIC Z(8)9-.                  00520000
005300    05 PV-PARAGRAPH-NAME             PIC X(30)     VALUE SPACE.   00530000
005400    05 PV-START-EXTRACT              PIC X(10)     VALUE SPACE.   00540000
005500    05 PV-END-EXTRACT                PIC X(10)     VALUE SPACE.   00550000
005510    05 PV-START-CHECK-DATE.                                               
005520       10 PV-START-CHECK-DATE-YYYY   PIC X(04)     VALUE SPACE.           
005530       10 PV-START-CHECK-DATE-MM     PIC X(02)     VALUE SPACE.           
005540       10 PV-START-CHECK-DATE-DD     PIC X(02)     VALUE SPACE.           
005550    05 PV-END-CHECK-DATE.                                                 
005560       10 PV-END-CHECK-DATE-YYYY     PIC X(04)     VALUE SPACE.           
005570       10 PV-END-CHECK-DATE-MM       PIC X(02)     VALUE SPACE.           
005580       10 PV-END-CHECK-DATE-DD       PIC X(02)     VALUE SPACE.           
005600    05 PV-DPT-NAME-SAVE              PIC X(25)     VALUE SPACE.   00560000
005700    05 PV-GMM-SAVE                   PIC X(02)     VALUE SPACE.   00570000
005800    05 PV-GMM-NAME-SAVE              PIC X(30)     VALUE SPACE.   00580000
005900    05 PV-DMM-SAVE                   PIC X(02)     VALUE SPACE.   00590000
006000    05 PV-DMM-NAME-SAVE              PIC X(30)     VALUE SPACE.   00600000
006100    05 PV-BYR-SAVE                   PIC X(03)     VALUE SPACE.   00610000
006200    05 PV-BYR-NAME-SAVE              PIC X(30)     VALUE SPACE.   00620000
006300    05 PV-ANALYST-MNG-NBR            PIC S9(7)     VALUE 0 COMP-3.00630000
006400    05 PV-ANALYST-MNG-NME-SAVE       PIC X(30)     VALUE SPACE.   00640000
006500    05 PV-ANALYST-NBR                PIC S9(7)     VALUE 0 COMP-3.00650000
006600    05 PV-ANALYST-NME-SAVE           PIC X(30)     VALUE SPACE.   00660000
006700    05 PV-FIRST-NAME.                                             00670000
006800       10 PV-FIRST-NAME-BYTE  OCCURS 12 TIMES INDEXED BY INX1     00680000
006900                                     PIC X(01).                   00690000
007000    05 PV-LAST-NAME.                                              00700000
007100       10 PV-LAST-NAME-BYTE   OCCURS 18 TIMES INDEXED BY INX2     00710000
007200                                     PIC X(01).                   00720000
007300    05 PV-NAME.                                                   00730000
007400       10 PV-NAME-BYTE        OCCURS 30 TIMES INDEXED BY INX3     00740000
007500                                     PIC X(01).                   00750000
007510    05 PV-CURR-PO-RCVR-KEY.                                               
007520       10 PV-CURR-PO-NBR             PIC S9(9)     COMP                   
007530                                                   VALUE ZEROS.           
007540       10 PV-CURR-REC-SEQ-NBR        PIC S9(9)     COMP                   
007550                                                   VALUE ZEROS.           
007560    05 PV-PREV-PO-RCVR-KEY.                                               
007570       10 PV-PREV-PO-NBR             PIC S9(9)     COMP                   
007580                                                   VALUE ZEROS.           
007590       10 PV-PREV-REC-SEQ-NBR        PIC S9(9)     COMP                   
007591                                                   VALUE ZEROS.           
007592                                                                          
007600 01 DK-DB-KEYS.                                                   00760000
007700    05 DK-DPT-NBR                    PIC X(03)     VALUE SPACE.   00770000
007800 01 PS-PROGRAM-SWITCHES.                                          00780000
007900    05 PS-END-OF-TABLE-SW            PIC X(01)     VALUE SPACE.   00790000
008000       88 PS-EOT                     VALUE 'Y'.                   00800000
008100    05 PS-FIRST-READ-SW              PIC X(01)     VALUE 'F'.     00810000
008101       88 PS-FIRST-READ              VALUE 'F'.                   00810100
008102       88 PS-NOT-FIRST-READ          VALUE ' '.                   00810200
008103    05 PS-END-OF-FILE-SW             PIC X(01)     VALUE SPACE.   00810300
008104       88 PS-EOF                     VALUE 'Y'.                   00810400
008105       88 PS-NOT-EOF                 VALUE 'N'.                   00810500
008106    05 PS-DPT-FOUND-SW               PIC X(01)     VALUE SPACE.   00810600
008107       88 PS-DPT-FOUND               VALUE 'Y'.                   00810700
008108       88 PS-DPT-NOT-FOUND           VALUE 'N'.                   00810800
008109                                                                          
008110 01 WS-HOLD-FIELDS.                                               00780000
008111    05  WS-HOLD-HEADER-RECORD        PIC X(400).                        00
008112                                                                          
008113 01 WS-CACL-FIELDS.                                               00780000
008114    05  WS-RECORDS-READ-QTY          PIC S9(7)     COMP-3               00
008115                                                   VALUE ZEROS.           
008116    05  WS-RECORDS-WRITE-QTY         PIC S9(7)     COMP-3               00
008117                                                   VALUE ZEROS.           
008118    05  WS-RCVR-TROUBLE-QTY          PIC S9(9)     COMP-3               00
008119                                                   VALUE ZEROS.           
008120     COPY TMRD001.                                                00810900
008121                                                                  00811000
008122*** DB2 MESSAGE AREAS ****                                        00812000
008130     COPY DPWS004.                                                00813000
008140*                                                                 00814000
008150     EXEC SQL                                                     00815000
008160          INCLUDE SQLCA                                           00816000
008170     END-EXEC.                                                    00817000
008180                                                                  00818000
008190     EXEC SQL                                                     00819000
008200          INCLUDE TMDSEAR                                         00820000
008300     END-EXEC.                                                    00830000
008400                                                                  00840000
008500     EXEC SQL                                                     00850000
008600          INCLUDE TRSPBAR                                         00860000
008700     END-EXEC.                                                    00870000
008800                                                                  00880000
008900     EXEC SQL                                                     00890000
009000          DECLARE TRSPBAR-CRS  CURSOR FOR                         00900000
009100                SELECT                                            00910000
009200                      B.WORKER_NBR                                00920000
009300                     ,B.WORKER_STRT_DTE                           00930000
009400                     ,B.WORKER_FIR_NAME                           00940000
009500                     ,B.WORKER_LAST_NAME                          00950000
009600                FROM TMDSEAR A                                    00960000
009700                    ,TRSPBAR B                                    00970000
009800                WHERE  A.OPERCO_NBR  = :PC-OPERCO-CDE             00980000
009900                   AND A.MDSELV_CDE  = :PC-DPT                    00990000
010000                   AND A.DEPT_NBR    = :TM001-DEPT-NBR            01000000
010100                   AND B.MDSEAR_DKEY = A.MDSEAR_DKEY              01010000
010200                   AND B.RSPLVL_CDE  = :PC-ANL                    01020000
010300                   AND   WORKER_STRT_DTE  <= :PV-END-EXTRACT      01030000
010400                   AND   WORKER_END_DTE    > :PV-END-EXTRACT      01040000
010500                ORDER BY WORKER_STRT_DTE DESC                     01050000
010600     END-EXEC.                                                    01060000
010700                                                                  01070000
010800********************************************************          01080000
010900 PROCEDURE DIVISION.                                              01090000
011000********************************************************          01100000
011100 0000-MAIN.                                                       01110000
011200     PERFORM 1000-INITIALIZATION         THRU 1000-EXIT.          01120000
011210                                                                          
011300     PERFORM 2000-PROCESS-INPUT-FILE     THRU 2000-EXIT           01130000
011400                            UNTIL PS-EOF.                         01140000
011401                                                                          
011410     PERFORM 3000-WRITE-HEADER-RECORD.                                    
011411                                                                          
011420     CLOSE EXTRACT-TRBL-FILE-IN                                         00
011430           EXTRACT-TRBL-FILE-OUT.                                         
011440                                                                          
011450     DISPLAY 'NUMBER OF RECORDS READ IS:     '                            
011451         WS-RECORDS-READ-QTY.                                             
011460     DISPLAY 'NUMBER OF RECORDS WRITTEN IS:  '                            
011470         WS-RECORDS-WRITE-QTY.                                            
011600 0000-EXIT.  STOP RUN.                                            01160000
011700                                                                  01170000
011800 1000-INITIALIZATION.                                             01180000
011900      OPEN INPUT  EXTRACT-TRBL-FILE-IN                                  00
011910           OUTPUT EXTRACT-TRBL-FILE-OUT.                                  
011920                                                                          
012000**** READING THE HEADER RECORD.                                   01200000
012100      READ EXTRACT-TRBL-FILE-IN  INTO                             01210000
012200                                  TM001-TROUBLE-EXT-RECORD              00
012300          AT END                                                  01230000
012400             SET PS-EOF TO TRUE                                   01240000
012500          NOT AT END                                              01250000
012510             ADD  +1                    TO WS-RECORDS-READ-QTY            
012600             MOVE TM001-RUN-BEGIN-DATE  TO PV-START-EXTRACT       01260000
012700             MOVE TM001-RUN-END-DATE    TO PV-END-EXTRACT         01270000
012701             MOVE TM001-BEGIN-YYYY      TO                                
012702                  PV-START-CHECK-DATE-YYYY                                
012703             MOVE TM001-BEGIN-MM        TO                                
012704                  PV-START-CHECK-DATE-MM                                  
012705             MOVE TM001-BEGIN-DD        TO                                
012706                  PV-START-CHECK-DATE-DD                                  
012707             MOVE TM001-END-YYYY      TO                                  
012708                  PV-END-CHECK-DATE-YYYY                                  
012709             MOVE TM001-END-MM        TO                                  
012710                  PV-END-CHECK-DATE-MM                                    
012711             MOVE TM001-END-DD        TO                                  
012712                  PV-END-CHECK-DATE-DD                                    
012713             MOVE TM001-TROUBLE-EXT-RECORD TO                             
012720                  WS-HOLD-HEADER-RECORD                                   
012800      END-READ.                                                   01280000
012900                                                                  01290000
013000 1000-EXIT.  EXIT.                                                01300000
013100                                                                  01310000
013200 2000-PROCESS-INPUT-FILE.                                         01320000
013300      INITIALIZE TM001-TROUBLE-EXT-RECORD.                        01330000
013310      READ EXTRACT-TRBL-FILE-IN  INTO                             01210000
013311                                  TM001-TROUBLE-EXT-RECORD              00
013600         AT END                                                   01360000
013700            SET PS-EOF TO TRUE                                    01370000
013800         NOT AT END                                               01380000
013810           ADD  +1                    TO WS-RECORDS-READ-QTY              
013900           PERFORM 2100-UPDATE-INPUT-FILE THRU 2100-EXIT          01390000
014000      END-READ.                                                   01400000
014100 2000-EXIT. EXIT.                                                 01410000
014200                                                                  01420000
014300 2100-UPDATE-INPUT-FILE.                                          01430000
014400      IF TM001-DEPT-NBR IS NOT = DK-DPT-NBR                       01440000
014500         MOVE TM001-DEPT-NBR              TO DK-DPT-NBR           01450000
014600         PERFORM 2110-GET-TMDSEAR-ROW     THRU 2110-EXIT          01460000
014700         EVALUATE TRUE                                            01470000
014800             WHEN PS-DPT-FOUND                                    01480000
014900                MOVE MDSEAR-GMA-NBR  TO TM001-GMM-NBR             01490000
015000                                        PV-GMM-SAVE               01500000
015100                MOVE MDSEAR-DMA-NBR  TO TM001-DMM-NBR             01510000
015200                                        PV-DMM-SAVE               01520000
015300                MOVE MDSEAR-BYR-NBR  TO TM001-BYR-NBR             01530000
015400                                        PV-BYR-SAVE               01540000
015500                MOVE MDSEAR-DESC     TO TM001-DEPT-DESC           01550000
015600                                        PV-DPT-NAME-SAVE          01560000
015700                PERFORM 2120-GET-ANALYST-MGR-NBR                  01570000
015800                                         THRU 2120-EXIT           01580000
015900                PERFORM 2130-GET-ANALYST-NBR                      01590000
016000                                         THRU 2130-EXIT           01600000
016100                PERFORM 2140-GET-GMM-NAME                         01610000
016200                                         THRU 2140-EXIT           01620000
016300                PERFORM 2150-GET-DMM-NAME                         01630000
016400                                         THRU 2150-EXIT           01640000
016500                PERFORM 2160-GET-BYR-NAME                         01650000
016600                                         THRU 2160-EXIT           01660000
016700             WHEN PS-DPT-NOT-FOUND                                01670000
016800                MOVE ZEROS           TO TM001-GMM-NBR             01680000
016900                                        PV-GMM-SAVE               01690000
016910                MOVE PC-NOT-FOUND    TO TM001-GMM-NAME                    
016920                                        PV-GMM-NAME-SAVE                  
017000                MOVE ZEROS           TO TM001-DMM-NBR             01700000
017100                                        PV-DMM-SAVE               01710000
017110                MOVE PC-NOT-FOUND    TO TM001-DMM-NAME                    
017120                                        PV-DMM-NAME-SAVE                  
017200                MOVE ZEROS           TO TM001-BYR-NBR             01720000
017300                                        PV-BYR-SAVE               01730000
017400                MOVE PC-NOT-FOUND    TO TM001-BYR-NAME                    
017500                                        PV-BYR-NAME-SAVE                  
019201                MOVE PC-NOT-FOUND    TO TM001-DEPT-DESC           01740005
019202                                        PV-DPT-NAME-SAVE          01750000
019203                MOVE ZEROS           TO TM001-ANALYST-MGR-NBR     01751004
019204                                        PV-ANALYST-MNG-NBR        01752004
019205                MOVE PC-NOT-FOUND    TO TM001-ANALYST-MGR-NAME    01753004
019206                                        PV-ANALYST-MNG-NME-SAVE   01754004
019207                MOVE ZEROS           TO TM001-ANALYST-NBR         01755004
019208                                        PV-ANALYST-NBR            01756004
019209                MOVE PC-NOT-FOUND    TO TM001-ANALYST-NAME        01757004
019210                                        PV-ANALYST-NME-SAVE       01758004
019211           END-EVALUATE                                           01760000
019212      ELSE                                                        01770000
019213         MOVE PV-GMM-SAVE          TO   TM001-GMM-NBR             01780000
019214         MOVE PV-DMM-SAVE          TO   TM001-DMM-NBR             01790000
019215         MOVE PV-BYR-SAVE          TO   TM001-BYR-NBR             01800000
019216         MOVE PV-DPT-NAME-SAVE     TO   TM001-DEPT-DESC           01810000
019217         MOVE PV-ANALYST-MNG-NBR   TO   TM001-ANALYST-MGR-NBR     01820000
019218         MOVE PV-ANALYST-NBR       TO   TM001-ANALYST-NBR         01830000
019219         MOVE PV-ANALYST-MNG-NME-SAVE                             01840000
019220                                   TO   TM001-ANALYST-MGR-NAME    01850000
019221         MOVE PV-ANALYST-NME-SAVE                                 01860000
019222                                   TO   TM001-ANALYST-NAME        01870000
019223         MOVE PV-GMM-NAME-SAVE                                    01880000
019224                                   TO   TM001-GMM-NAME            01890000
019225         MOVE PV-DMM-NAME-SAVE                                    01900000
019226                                   TO   TM001-DMM-NAME            01910000
019227         MOVE PV-BYR-NAME-SAVE                                    01920000
019300                                   TO   TM001-BYR-NAME            01930000
019400      END-IF.                                                     01940000
019500                                                                  01950000
020300      WRITE TE-TRBL-EXTRACT-OUT-RECORD  FROM                      02030000
020400                                  TM001-TROUBLE-EXT-RECORD.             00
020401      ADD  +1                    TO WS-RECORDS-WRITE-QTY.                 
020402      PERFORM 2200-CHECK-FOR-TROUBLE.                                     
020410                                                                          
020500 2100-EXIT.  EXIT.                                                02050000
020600                                                                  02060000
020700 2110-GET-TMDSEAR-ROW.                                            02070000
020800      EXEC SQL                                                    02080000
020900                SELECT                                            02090000
021000                      GMA_NBR                                     02100000
021100                     ,DMA_NBR                                     02110000
021200                     ,BYR_NBR                                     02120000
021300                     ,DEPT_NBR                                    02130000
021400                     ,MDSEAR_DESC                                 02140000
021500                 INTO  :MDSEAR-GMA-NBR                            02150000
021600                      ,:MDSEAR-DMA-NBR                            02160000
021700                      ,:MDSEAR-BYR-NBR                            02170000
021800                      ,:MDSEAR-DEPT-NBR                           02180000
021900                      ,:MDSEAR-DESC                               02190000
022000                FROM TMDSEAR                                      02200000
022100                WHERE   DEPT_NBR    = :DK-DPT-NBR                 02210000
022200                   AND  OPERCO_NBR  = :PC-OPERCO-CDE              02220000
022300                   AND  MDSELV_CDE  = :PC-DPT                     02230000
022400                   AND  (STRT_DTE   < :PV-END-EXTRACT OR          02240000
022500                         STRT_DTE   = :PV-END-EXTRACT)            02250000
022600                   AND   END_DTE    > :PV-END-EXTRACT             02260000
022700       END-EXEC.                                                  02270000
022710                                                                  02271000
022720       EVALUATE TRUE                                              02272000
022730            WHEN SQLCODE = ZERO                                   02273000
022740                SET PS-DPT-FOUND             TO TRUE              02274000
022750            WHEN SQLCODE = +100                                   02275000
022760                SET  PS-DPT-NOT-FOUND        TO TRUE              02276000
022770            WHEN OTHER                                            02277000
022780               MOVE '2110-GET-TMDSEAR-ROW  ' TO PV-ABEND-PARA-NAME02278000
022790                MOVE 'SELECT TMDSEAR ROW'                         02279000
022800                                         TO PV-DB2-OPERATION-MSG-102280000
022801                MOVE 'TMDSEAR'           TO PV-DB2-TABLE-NAME     02280100
022802                PERFORM 9998-SQL-ABEND   THRU 9998-EXIT           02280200
022803        END-EVALUATE.                                             02280300
022804                                                                  02280400
022805 2110-EXIT.  EXIT.                                                02280500
022806                                                                  02280600
022807 2120-GET-ANALYST-MGR-NBR.                                        02280700
022808      EXEC SQL                                                    02280800
022809                SELECT                                            02280900
022810                      B.WORKER_NBR                                02281000
022820                     ,B.WORKER_FIR_NAME                           02282000
022830                     ,B.WORKER_LAST_NAME                          02283000
022831                 INTO :RSPBAR-WORKER-NBR                          02283100
022832                     ,:RSPBAR-WORKER-FIR-NAME                     02283200
022833                     ,:RSPBAR-WORKER-LAST-NAME                    02283300
022834                FROM TMDSEAR A                                    02283400
022835                    ,TRSPBAR B                                    02283500
022836                WHERE  A.OPERCO_NBR  = :PC-OPERCO-CDE             02283600
022837                   AND A.MDSELV_CDE  = :PC-DMA                    02283700
022838                   AND A.DMA_NBR     = :TM001-DMM-NBR             02283800
022839                   AND B.MDSEAR_DKEY = A.MDSEAR_DKEY              02283900
022840                   AND B.RSPLVL_CDE  = :PC-ANM                    02284000
022850                   AND   WORKER_STRT_DTE  <= :PV-END-EXTRACT      02285000
022851                   AND   WORKER_END_DTE    > :PV-END-EXTRACT      02285100
022852       END-EXEC.                                                  02285200
022853                                                                  02285300
022854       EVALUATE TRUE                                              02285400
022855            WHEN SQLCODE = ZERO                                   02285500
022856            WHEN SQLCODE = -811                                   02285500
022857                MOVE RSPBAR-WORKER-NBR  TO TM001-ANALYST-MGR-NBR  02285600
022858                                           PV-ANALYST-MNG-NBR     02285700
022859                PERFORM 8888-STRING-RSPBAR-NAME THRU 8888-EXIT    02285800
022860                MOVE PV-NAME            TO TM001-ANALYST-MGR-NAME 02285900
022861                                           PV-ANALYST-MNG-NME-SAVE02286000
022862            WHEN SQLCODE = +100                                   02286100
022863                MOVE 0                  TO TM001-ANALYST-MGR-NBR  02286200
022864                                           PV-ANALYST-MNG-NBR     02286300
022865                MOVE PC-NOT-FOUND       TO TM001-ANALYST-MGR-NAME 02286401
022866                                           PV-ANALYST-MNG-NME-SAVE02286500
022867            WHEN OTHER                                            02286600
022868               MOVE '2120-GET-ANALYST-MGR-NBR'                    02286700
022869                                         TO PV-ABEND-PARA-NAME    02286800
022870                MOVE 'SELECT TRSPBAR ROW'                         02286900
022871                                         TO PV-DB2-OPERATION-MSG-102287000
022872                MOVE 'TRSPBAR'           TO PV-DB2-TABLE-NAME     02287100
022873                PERFORM 9998-SQL-ABEND   THRU 9998-EXIT           02287200
022874        END-EVALUATE.                                             02287300
022875                                                                  02287400
022876 2120-EXIT.   EXIT.                                               02287500
022877                                                                  02287600
022878 2130-GET-ANALYST-NBR.                                            02287700
022879      PERFORM 2131-OPEN-TRSPBAR-CRD  THRU 2131-EXIT               02287800
022880                                                                  02287900
022881      EXEC SQL                                                    02288000
022890                FETCH                                             02289000
022900                      TRSPBAR-CRS                                 02290000
022910                 INTO :RSPBAR-WORKER-NBR                          02291000
022920                     ,:RSPBAR-WORKER-STRT-DTE                     02292000
022921                     ,:RSPBAR-WORKER-FIR-NAME                     02292100
022922                     ,:RSPBAR-WORKER-LAST-NAME                    02292200
022923       END-EXEC.                                                  02292300
022924                                                                  02292400
022925       EVALUATE TRUE                                              02292500
022926            WHEN SQLCODE = ZERO                                   02292600
022927                MOVE RSPBAR-WORKER-NBR  TO TM001-ANALYST-NBR      02292700
022928                                           PV-ANALYST-NBR         02292800
022929                PERFORM 8888-STRING-RSPBAR-NAME THRU 8888-EXIT    02292900
022930                MOVE PV-NAME            TO TM001-ANALYST-NAME     02293000
022931                                           PV-ANALYST-NME-SAVE    02293100
022932            WHEN SQLCODE = +100                                   02293200
022933                MOVE 0                  TO TM001-ANALYST-NBR      02293300
022934                                           PV-ANALYST-NBR         02293400
022935                MOVE PC-NOT-FOUND       TO TM001-ANALYST-NAME     02293501
022936                                           PV-ANALYST-NME-SAVE    02293600
022937            WHEN OTHER                                            02293700
022938               MOVE '2130-GET-ANALYST-NBR'                        02293800
022939                                         TO PV-ABEND-PARA-NAME    02293900
022940                MOVE 'FETCH TRSPBAR ROW'                          02294000
022941                                         TO PV-DB2-OPERATION-MSG-102294100
022942                MOVE 'TRSPBAR'           TO PV-DB2-TABLE-NAME     02294200
022943                PERFORM 9998-SQL-ABEND   THRU 9998-EXIT           02294300
022944        END-EVALUATE.                                             02294400
022945                                                                  02294500
022946        PERFORM 2135-CLOSE-TRSPBAR-CRS   THRU 2135-EXIT.          02294600
022947 2130-EXIT.   EXIT.                                               02294700
022948                                                                  02294800
022949 2131-OPEN-TRSPBAR-CRD.                                           02294900
022950        EXEC SQL                                                  02295000
022960             OPEN TRSPBAR-CRS                                     02296000
022970        END-EXEC.                                                 02297000
022980                                                                  02298000
022990        EVALUATE TRUE                                             02299000
023000           WHEN SQLCODE = ZERO                                    02300000
023100                CONTINUE                                          02310000
023101           WHEN OTHER                                             02310100
023102                MOVE '2131-OPEN-TRSPBAR-CRD'                      02310200
023103                                        TO PV-ABEND-PARA-NAME     02310300
023104                MOVE 'OPEN CURSOR'       TO PV-DB2-OPERATION-MSG-102310400
023105                MOVE 'TRSPBAR'           TO PV-DB2-TABLE-NAME     02310500
023106                PERFORM 9998-SQL-ABEND   THRU 9998-EXIT           02310600
023107        END-EVALUATE.                                             02310700
023108 2131-EXIT.   EXIT.                                               02310800
023109                                                                  02310900
023110 2135-CLOSE-TRSPBAR-CRS.                                          02311000
023120        EXEC SQL                                                  02312000
023130            CLOSE TRSPBAR-CRS                                     02313000
023140        END-EXEC.                                                 02314000
023150 2135-EXIT.   EXIT.                                               02315000
023160                                                                  02316000
023170 2140-GET-GMM-NAME.                                               02317000
023180      EXEC SQL                                                    02318000
023190           SELECT B.WORKER_FIR_NAME                               02319000
023200                , B.WORKER_LAST_NAME                              02320000
023300             INTO :RSPBAR-WORKER-FIR-NAME                         02330000
023400                , :RSPBAR-WORKER-LAST-NAME                        02340000
023500             FROM TMDSEAR A                                       02350000
023600                 ,TRSPBAR B                                       02360000
023700            WHERE A.OPERCO_NBR       = '03'                       02370000
023701              AND A.MDSELV_CDE       = 'GMA'                      02370100
023702              AND A.GMA_NBR          = :TM001-GMM-NBR             02370200
023703              AND A.STRT_DTE        <= :PV-END-EXTRACT            02370300
023704              AND A.END_DTE          > :PV-END-EXTRACT            02370400
023705              AND A.MDSEAR_DKEY      = B.MDSEAR_DKEY              02370500
023706              AND B.RSPLVL_CDE       = 'GMM'                      02370600
023707              AND   WORKER_STRT_DTE  <= :PV-END-EXTRACT           02370700
023708              AND   WORKER_END_DTE    > :PV-END-EXTRACT           02370800
023709      END-EXEC.                                                   02370900
023710       EVALUATE TRUE                                              02371000
023720            WHEN SQLCODE = ZERO                                   02372000
023730                PERFORM 8888-STRING-RSPBAR-NAME THRU 8888-EXIT    02373000
023740                MOVE PV-NAME            TO TM001-GMM-NAME         02374000
023750                                           PV-GMM-NAME-SAVE       02375000
023760            WHEN SQLCODE = +100                                   02376000
023770                MOVE SPACE              TO TM001-GMM-NAME         02377001
023780                                           PV-GMM-NAME-SAVE       02378000
023790            WHEN OTHER                                            02379000
023800               MOVE '2140-GET-GMM-NAME'                           02380000
023801                                         TO PV-ABEND-PARA-NAME    02380100
023802                MOVE 'SELECT TRSPBAR ROW'                         02380200
023803                                         TO PV-DB2-OPERATION-MSG-102380300
023804                MOVE 'TRSPBAR'           TO PV-DB2-TABLE-NAME     02380400
023805                PERFORM 9998-SQL-ABEND   THRU 9998-EXIT           02380500
023806        END-EVALUATE.                                             02380600
023807 2140-EXIT.   EXIT.                                               02380700
023808                                                                  02380800
023809 2150-GET-DMM-NAME.                                               02380900
023810      EXEC SQL                                                    02381000
023811           SELECT B.WORKER_FIR_NAME                               02381100
023812                , B.WORKER_LAST_NAME                              02381200
023813             INTO :RSPBAR-WORKER-FIR-NAME                         02381300
023814                , :RSPBAR-WORKER-LAST-NAME                        02381400
023815             FROM TMDSEAR A                                       02381500
023816                 ,TRSPBAR B                                       02381600
023817            WHERE A.OPERCO_NBR       = '03'                       02381700
023818              AND A.MDSELV_CDE       = 'DMA'                      02381800
023819              AND A.DMA_NBR          = :TM001-DMM-NBR             02381900
023820              AND A.STRT_DTE        <= :PV-END-EXTRACT            02382000
023821              AND A.END_DTE          > :PV-END-EXTRACT            02382100
023822              AND A.MDSEAR_DKEY      = B.MDSEAR_DKEY              02382200
023823              AND B.RSPLVL_CDE       = 'DMM'                      02382300
023824              AND   WORKER_STRT_DTE  <= :PV-END-EXTRACT           02382400
023825              AND   WORKER_END_DTE    > :PV-END-EXTRACT           02382500
023826      END-EXEC.                                                   02382600
023827      EVALUATE TRUE                                               02382700
023828            WHEN SQLCODE = ZERO                                   02382800
023829                PERFORM 8888-STRING-RSPBAR-NAME THRU 8888-EXIT    02382900
023830                MOVE PV-NAME            TO TM001-DMM-NAME         02383000
023831                                           PV-DMM-NAME-SAVE       02383100
023832            WHEN SQLCODE = +100                                   02383200
023833                MOVE SPACE              TO TM001-DMM-NAME         02383300
023834                                           PV-DMM-NAME-SAVE       02383400
023835            WHEN OTHER                                            02383500
023836               MOVE '2150-GET-DMM-NAME'                           02383600
023837                                         TO PV-ABEND-PARA-NAME    02383700
023838                MOVE 'SELECT TRSPBAR ROW'                         02383800
023839                                         TO PV-DB2-OPERATION-MSG-102383900
023840                MOVE 'TRSPBAR'           TO PV-DB2-TABLE-NAME     02384000
023841                PERFORM 9998-SQL-ABEND   THRU 9998-EXIT           02384100
023842       END-EVALUATE.                                              02384200
023843 2150-EXIT.   EXIT.                                               02384300
023844                                                                  02384400
023845 2160-GET-BYR-NAME.                                               02384500
023846      EXEC SQL                                                    02384600
023847           SELECT B.WORKER_FIR_NAME                               02384700
023848                , B.WORKER_LAST_NAME                              02384800
023849             INTO :RSPBAR-WORKER-FIR-NAME                         02384900
023850                , :RSPBAR-WORKER-LAST-NAME                        02385000
023851             FROM TMDSEAR A                                       02385100
023852                 ,TRSPBAR B                                       02385200
023853            WHERE A.OPERCO_NBR       = '03'                       02385300
023854              AND A.MDSELV_CDE       = 'DPT'                      02385400
023855              AND A.DEPT_NBR         = :MDSEAR-DEPT-NBR           02385500
023856              AND A.STRT_DTE        <= :PV-END-EXTRACT            02385600
023857              AND A.END_DTE         >= :PV-END-EXTRACT            02385700
023858              AND A.MDSEAR_DKEY      = B.MDSEAR_DKEY              02385800
023859              AND B.RSPLVL_CDE       = 'BYR'                      02385900
023860              AND   WORKER_STRT_DTE  <= :PV-END-EXTRACT           02386000
023861              AND   WORKER_END_DTE    > :PV-END-EXTRACT           02386100
023862      END-EXEC.                                                   02386200
023863      EVALUATE TRUE                                               02386300
023864           WHEN SQLCODE = ZERO                                    02386400
023865               PERFORM 8888-STRING-RSPBAR-NAME THRU 8888-EXIT     02386500
023866               MOVE PV-NAME            TO TM001-BYR-NAME          02386600
023867                                          PV-BYR-NAME-SAVE        02386700
023868           WHEN SQLCODE = +100                                    02386800
023869               MOVE SPACE              TO TM001-BYR-NAME          02386900
023870                                          PV-BYR-NAME-SAVE        02387000
023871           WHEN OTHER                                             02387100
023872              MOVE '2160-GET-BYR-NAME'                            02387200
023873                                        TO PV-ABEND-PARA-NAME     02387300
023874               MOVE 'SELECT TRSPBAR ROW'                          02387400
023875                                        TO PV-DB2-OPERATION-MSG-1 02387500
023876               MOVE 'TRSPBAR'           TO PV-DB2-TABLE-NAME      02387600
023877               PERFORM 9998-SQL-ABEND   THRU 9998-EXIT            02387700
023878       END-EVALUATE.                                              02387800
023879 2160-EXIT.   EXIT.                                               02387900
023880                                                                  02388000
023881 2200-CHECK-FOR-TROUBLE.                                                  
023882                                                                          
023888     IF  TM001-TRBL-RSN-TROUBLE                                           
023890         IF  TM001-NOTIF-DATE <= PV-END-CHECK-DATE                        
023891         AND TM001-NOTIF-DATE >= PV-START-CHECK-DATE                      
023901             MOVE TM001-PO-NBR    TO PV-CURR-PO-NBR                       
023902             MOVE TM001-REC-SEQ-NBR                                       
023903                                  TO PV-CURR-REC-SEQ-NBR                  
023904             IF  PV-CURR-PO-RCVR-KEY = PV-PREV-PO-RCVR-KEY                
023906                 NEXT SENTENCE                                            
023907             ELSE                                                         
023909                 MOVE PV-CURR-PO-RCVR-KEY TO                              
023910                      PV-PREV-PO-RCVR-KEY                                 
023911                 ADD  +1 TO WS-RCVR-TROUBLE-QTY                           
023912         ELSE                                                             
023914             NEXT SENTENCE                                                
023915     ELSE                                                                 
023917         NEXT SENTENCE.                                                   
023918                                                                          
023921 3000-WRITE-HEADER-RECORD.                                                
023922                                                                          
023923     MOVE WS-HOLD-HEADER-RECORD TO TM001-TROUBLE-EXT-RECORD.              
023924                                                                          
023925     MOVE WS-RCVR-TROUBLE-QTY   TO TM001-RCVRS-TRBL-QTY.                  
023926                                                                          
023927      WRITE TE-TRBL-EXTRACT-OUT-RECORD  FROM                            00
023928                                  TM001-TROUBLE-EXT-RECORD.             00
023929      ADD  +1                    TO WS-RECORDS-WRITE-QTY.                 
023930                                                                          
023931                                                                          
023932 8888-STRING-RSPBAR-NAME.                                         02389000
023933     MOVE RSPBAR-WORKER-FIR-NAME  TO PV-FIRST-NAME                02389100
023934     MOVE RSPBAR-WORKER-LAST-NAME TO PV-LAST-NAME                 02389200
023935                                                                  02389300
023936     INITIALIZE PV-NAME.                                          02389400
023937     SET INX3 TO 1.                                               02389500
023938                                                                  02389600
023939     PERFORM VARYING INX1 FROM 1 BY 1                             02389700
023940                 UNTIL INX1 > 12                                  02389800
023941           IF  PV-FIRST-NAME-BYTE (INX1) = SPACE                  02389900
023942               SET INX3 UP BY 1                                   02390000
023943               SET INX1   TO 12                                   02391000
023944           ELSE                                                   02392000
023945               MOVE PV-FIRST-NAME-BYTE (INX1)  TO                 02393000
023946                    PV-NAME-BYTE (INX3)                           02394000
023950               SET INX3 UP BY 1                                   02395000
023960           END-IF                                                 02396000
023970     END-PERFORM.                                                 02397000
023980                                                                  02398000
023990      PERFORM VARYING INX2 FROM 1 BY 1                            02399000
023991                  UNTIL INX2 > 18                                 02399100
023992            IF  PV-LAST-NAME-BYTE (INX2) = SPACE                  02399200
023993                SET INX2   TO 18                                  02399300
023994            ELSE                                                  02399400
023995                MOVE PV-LAST-NAME-BYTE (INX2)  TO                 02399500
023996                     PV-NAME-BYTE (INX3)                          02399600
023997                SET INX3 UP BY 1                                  02399700
023998            END-IF                                                02399800
023999      END-PERFORM.                                                02399900
024000                                                                  02400000
024010 8888-EXIT.   EXIT.                                               02401000
024020                                                                  02402000
024030 9998-SQL-ABEND.                                                  02403000
024040     MOVE SQLCODE     TO PV-SQLCODE.                              02404000
024050     DISPLAY '** ABEND           ** = SQLABEND'.                  02405000
024060     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          02406000
024070     DISPLAY '** PARAGRAPH       ** = ' PV-ABEND-PARA-NAME.       02407000
024080     DISPLAY '** TABLE AFFECTED  ** = ' PV-DB2-TABLE-NAME.        02408000
024090     DISPLAY '** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.   02409000
024100     DISPLAY '** SQLCODE         ** = ' PV-SQLCODE.               02410000
024200     COPY DPPD004.                                                02420000
024300     MOVE +4013                  TO PV-ABEND-CODE.                02430000
024400     CALL 'ILBOABN0'   USING PV-ABEND-CODE.                       02440000
024500 9998-EXIT.  EXIT.                                                02450000
024600                                                                  02460000
