000100*-----------------------*                                         00010099
000200 IDENTIFICATION DIVISION.                                         00020099
000300*-----------------------*                                         00030099
000400 PROGRAM-ID.    RVKCS107.                                         00040099
000500 AUTHOR.        AL PETERS.                                        00050099
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060099
000700 DATE-WRITTEN.  FEBRUARY 2004.                                    00070099
000800 DATE-COMPILED.                                                   00080099
000900*----------------------------------------------------------------*00090099
001000*    T107 - RTV AUTHORIZATION INQUIRY SCREEN                     *00100099
001100*                                                                *00110099
001200*    THIS PROGRAM ALLOWS THE USER TO INQUIRE ON SHIPPING         *00120099
001300*    INFORMATION FOR RTV AND DEBIT/DISPOSE LISTINGS AND THEN     *00130099
001400*    SHIP A LISTING                                              *00140099
001500*----------------------------------------------------------------*00150099
001600*  CHANGED 11/07/2022    BY JIM HUNTER      WR: CHG0277924        00160099
001700*                                                                 00170099
001800*  ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL       00180099
001900*  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.      00190099
002000*-----------------------------------------------------------------00200099
002100                                                                  00210099
002200 ENVIRONMENT DIVISION.                                            00220099
002300                                                                  00230099
002400 DATA DIVISION.                                                   00240099
002500                                                                  00250099
002600 WORKING-STORAGE SECTION.                                         00260099
002700                                                                  00270099
002800 01  DK-DB2-KEYS.                                                 00280099
002900     05  DK-DFCT-ORD-ID           PIC S9(12)V VALUE +0 COMP-3.    00290099
003000     05  DK-DFCT-SHIPT-ID         PIC S9(09)  VALUE +0 COMP.      00300099
003100     05  DK-ENT-ID                PIC S9(09)  VALUE +0 COMP.      00310099
003200     05  DK-DEPT-NBR              PIC  X(03)  VALUE SPACES.       00320099
003300                                                                  00330099
003400*                                                                 00340099
003500 01  PC-PROGRAM-CONSTANTS.                                        00350099
003600     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'RVKCS107'.  00360099
003700     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'RV107A  '.  00370099
003800     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'RVKM107 '.  00380099
003900     05  PC-RAND-PGM              PIC  X(08)  VALUE  'DPKUT902'.  00390099
004000     05  PC-APPL-MAP              PIC S9(04)  VALUE  +1 COMP.     00400099
004100     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3 COMP.     00410099
004200                                                                  00420099
004300     05  PC-TSYMSG-NUMBERS.                                       00430099
004400***********   00007 REQUIRED ENTRY                                00440099
004500         10  PC-TSYMSG-00007      PIC  9(05)  VALUE  00007.       00450099
004600***********   00008 MUST BE NUMERIC                               00460099
004700         10  PC-TSYMSG-00008      PIC  9(05)  VALUE  00008.       00470099
004800***********   00009 INVALID DATE                                  00480099
004900         10  PC-TSYMSG-00009      PIC  9(05)  VALUE  00009.       00490099
005000***********   00045 INVALID FUNCTION KEY                          00500099
005100         10  PC-TSYMSG-00045      PIC  9(05)  VALUE  00045.       00510099
005200***********   00059 UPDATE(S) SUCCESSFUL                          00520099
005300         10  PC-TSYMSG-00059      PIC  9(05)  VALUE  00059.       00530099
005400***********   00148 DATA DOES NOT EXIST                           00540099
005500         10  PC-TSYMSG-00148      PIC  9(05)  VALUE  00148.       00550099
005600***********   00342 MUST BE NUMERIC AND > 0                       00560099
005700         10  PC-TSYMSG-00342      PIC  9(05)  VALUE  00342.       00570099
005800***********   01912 PERCENT FIELD CANNOT BE GREATER THAN 100      00580099
005900         10  PC-TSYMSG-01912      PIC  9(05)  VALUE  01912.       00590099
006000***********   02609 INVALID SCAC CODE                             00600099
006100         10  PC-TSYMSG-02609      PIC  9(05)  VALUE  02609.       00610099
006200***********   03155 RETURN AUTHORIZATION REQUIRED FROM VENDOR     00620099
006300         10  PC-TSYMSG-03155      PIC  9(05)  VALUE  03155.       00630099
006400***********   03156 SHIPPING CHARGES NOT ALLOWED IF PAYMENT       00640099
006500***********         TYPE = C-COLLECT                              00650099
006600         10  PC-TSYMSG-03156      PIC  9(05)  VALUE  03156.       00660099
006700***********   03157 ONLY ONE IS ALLOWED, A DEDUCTION OR DISCOUNT  00670099
006800***********         % OR DISCOUNT AMOUNT                          00680099
006900         10  PC-TSYMSG-03157      PIC  9(05)  VALUE  03157.       00690099
007000***********   03158 CANNOT SHIP LISTING, NOT ALL SHIPPING         00700099
007100***********         INFORMATION IS PRESENT                        00710099
007200         10  PC-TSYMSG-03158      PIC  9(05)  VALUE  03158.       00720099
007300***********   03160 UPDATE NOT SUCCESSFUL, TRY AGAIN. IF          00730099
007400***********         ERROR CONTINUES, CALL HELPDESK                00740099
007500         10  PC-TSYMSG-03160      PIC  9(05)  VALUE  03160.       00750099
007600***********   03195 MORE THAN ONE VENDOR AGREEMENT ON FILE,       00760099
007700***********         RETURN AUTHORIZATION REQUIRED                 00770099
007800         10  PC-TSYMSG-03195      PIC  9(05)  VALUE  03195.       00780099
007900***********   03196 LISTING HAS BEEN SHIPPED, MUST UNSHIP         00790099
008000***********         BEFORE CHANGING LISTING TO D&D                00800099
008100         10  PC-TSYMSG-03196      PIC  9(05)  VALUE  03196.       00810099
008200***********   03197 PRESS F2 TO CONFIRM CHANGING RTV LISTING      00820099
008300***********         TO A D&D LISTING                              00830099
008400         10  PC-TSYMSG-03197      PIC  9(05)  VALUE  03197.       00840099
008500***********   03198 PRESS F2 TO CONFIRM UNSHIPPING A              00850099
008600***********         SHIPPED LISTING                               00860099
008700         10  PC-TSYMSG-03198      PIC  9(05)  VALUE  03198.       00870099
008800***********   03202 LISTING HAS ALREADY BEEN SHIPPED, PRESS       00880099
008900***********        F15 TO UPDATE                                  00890099
009000         10  PC-TSYMSG-03202      PIC  9(05)  VALUE  03202.       00900099
009100***********   03215 UPDATE INVALID, SHIPMENT NOT CREATED,         00910099
009200***********        PRESS F22 TO SHIP LISTING                      00920099
009300         10  PC-TSYMSG-03215      PIC  9(05)  VALUE  03215.       00930099
009400*                                                                 00940099
009500 01  PS-PROGRAM-SWITCHES.                                         00950099
009600     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         00960099
009700         88  PS-ERROR                         VALUE  'Y'.         00970099
009800         88  PS-NO-ERROR                      VALUE  'N'.         00980099
009900     05  PS-COMMAREA-SW           PIC  X(01)  VALUE  'N'.         00990099
010000         88  PS-COMMAREA-VALID                VALUE  'Y'.         01000099
010100         88  PS-COMMAREA-INVALID              VALUE  'N'.         01010099
010200     05  PS-DATA-FOUND-SW        PIC  X(01)   VALUE  'Y'.         01020099
010300         88  PS-DATA-FOUND                    VALUE  'Y'.         01030099
010400         88  PS-DATA-NOT-FOUND                VALUE  'N'.         01040099
010500     05  PS-VALID-SCAC-SW        PIC  X(01)   VALUE  'Y'.         01050099
010600         88  PS-VALID-SCAC                    VALUE  'Y'.         01060099
010700         88  PS-INVALID-SCAC                  VALUE  'N'.         01070099
010800     05  PS-CHK-DTE-SW           PIC  X(01)   VALUE  ' '.         01080099
010900         88  PS-CHK-AUTH-DTE                  VALUE  'A'.         01090099
011000         88  PS-CHK-SHIP-DTE                  VALUE  'S'.         01100099
011100     05  PS-UPDATE-OK-SW         PIC  X(01)   VALUE  'Y'.         01110099
011200         88  PS-UPDATE-OK                     VALUE  'Y'.         01120099
011300         88  PS-UPDATE-NOT-OK                 VALUE  'N'.         01130099
011400     05  PS-SHIPT-ID-SW          PIC  X(01)   VALUE  'N'.         01140099
011500         88  PS-SHIPT-ID-FOUND                VALUE  'Y'.         01150099
011600         88  PS-SHIPT-ID-NOT-FOUND            VALUE  'N'.         01160099
011700******* WHO PAID INBOUND-FREIGHT?                                 01170099
011800     05  PS-PAID-IN-FRGT-SW      PIC  X(01)   VALUE  ' '.         01180099
011900         88  PS-KOHLS-PAID                    VALUE  'K'.         01190099
012000         88  PS-VENDOR-PAID                   VALUE  'V'.         01200099
012100*                                                                 01210099
012200 01  PV-PROGRAM-VARIABLES.                                        01220099
012300     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            01230099
012400                                              COMP SYNC.          01240099
012500     05  PV-DB2-OPER-UNT-ID       PIC S9(04)  VALUE +0            01250099
012600                                              COMP SYNC.          01260099
012700     05  PV-PRT-LIST-TRANID       PIC  X(04)  VALUE SPACES.       01270099
012800     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            01280099
012900                                              COMP SYNC.          01290099
013000     05  PV-COMMAREA-LENGTH       PIC S9(04)  VALUE +0            01300099
013100                                              COMP SYNC.          01310099
013200     05  PV-HOLD-TYP-CDE          PIC  X(01)  VALUE SPACE.        01320099
013300         88  PV-HOLD-RTV                      VALUE 'R'.          01330099
013400         88  PV-HOLD-DND                      VALUE 'D'.          01340099
013500     05  PV-CURRENT-TMST          PIC  X(26)  VALUE SPACES.       01350099
013600     05  PV-CUR-TMST.                                             01360099
013700         10  PV-CURRENT-DT        PIC  X(10)  VALUE SPACE.        01370099
013800         10  FILLER               PIC  X(01)  VALUE SPACE.        01380099
013900         10  PV-CURRENT-TIME      PIC  X(15)  VALUE SPACE.        01390099
014000     05  PV-CURRENT-DATE.                                         01400099
014100         10  PV-CURRENT-DT-CCYY   PIC  X(04)  VALUE SPACE.        01410099
014200         10  FILLER               PIC  X(01)  VALUE '-'.          01420099
014300         10  PV-CURRENT-DT-MM     PIC  X(02)  VALUE SPACE.        01430099
014400         10  FILLER               PIC  X(01)  VALUE '-'.          01440099
014500         10  PV-CURRENT-DT-DD     PIC  X(02)  VALUE SPACE.        01450099
014600     05  PV-CURRENT-DATE-USA.                                     01460099
014700         10  PV-CUR-USA-DT-MM     PIC  X(02)  VALUE SPACE.        01470099
014800         10  FILLER               PIC  X(01)  VALUE '/'.          01480099
014900         10  PV-CUR-USA-DT-DD     PIC  X(02)  VALUE SPACE.        01490099
015000         10  FILLER               PIC  X(01)  VALUE '/'.          01500099
015100         10  PV-CUR-USA-DT-CCYY   PIC  X(04)  VALUE SPACE.        01510099
015200     05  PV-CLOSE-DATE            PIC  X(10)  VALUE SPACES.       01520099
015300     05  PV-SHIPT-ID              PIC S9(09)  COMP.               01530099
015400     05  PV-NBR-SLASHES           PIC  9(02)  VALUE ZEROS.        01540099
015500     05  PV-NBR-AGRMTS            PIC  9(01)  VALUE ZEROS.        01550099
015600     05  PV-LISTING-COUNT         PIC S9(09)  VALUE ZEROS COMP.   01560099
015700*                                                                 01570099
015800*** NULL INDICATORS                                               01580099
015900 01  NI-NULL-INDICATORS.                                          01590099
016000     05  NI-SHIPT-ID              PIC S9(04)  VALUE +0            01600099
016100                                              COMP SYNC.          01610099
016200     05  NI-AUTH-ID               PIC S9(04)  VALUE +0            01620099
016300                                              COMP SYNC.          01630099
016400     05  NI-AUTH-DTE              PIC S9(04)  VALUE +0            01640099
016500                                              COMP SYNC.          01650099
016600     05  NI-CART-QTY              PIC S9(04)  VALUE +0            01660099
016700                                              COMP SYNC.          01670099
016800     05  NI-SPEC-INSTR            PIC S9(04)  VALUE +0            01680099
016900                                              COMP SYNC.          01690099
017000     05  NI-INBND-FRGT            PIC S9(04)  VALUE +0            01700099
017100                                              COMP SYNC.          01710099
017200     05  NI-OUTBND-FRGT           PIC S9(04)  VALUE +0            01720099
017300                                              COMP SYNC.          01730099
017400     05  NI-DEDUCT                PIC S9(04)  VALUE +0            01740099
017500                                              COMP SYNC.          01750099
017600     05  NI-WEIGHT                PIC S9(04)  VALUE +0            01760099
017700                                              COMP SYNC.          01770099
017800     05  NI-DISC-PCT              PIC S9(04)  VALUE +0            01780099
017900                                              COMP SYNC.          01790099
018000     05  NI-DISC-AMT              PIC S9(04)  VALUE +0            01800099
018100                                              COMP SYNC.          01810099
018200     05  NI-RET-RSN               PIC S9(04)  VALUE +0            01820099
018300                                              COMP SYNC.          01830099
018400     05  NI-PAYT-TYP              PIC S9(04)  VALUE +0            01840099
018500                                              COMP SYNC.          01850099
018600     05  NI-VND-AUTH-ID           PIC S9(04)  VALUE +0            01860099
018700                                              COMP SYNC.          01870099
018800     05  NI-CARR-TRKG-ID          PIC S9(04)  VALUE +0            01880099
018900                                              COMP SYNC.          01890099
019000*----------------------------------------------------------------*01900099
019100*    MAP LAYOUT                                                  *01910099
019200*----------------------------------------------------------------*01920099
019300     COPY RVKM107.                                                01930099
019400                                                                  01940099
019500*----------------------------------------------------------------*01950099
019600*    ATTRIBUTE SETTINGS COPYBOOK.                                *01960099
019700*----------------------------------------------------------------*01970099
019800     COPY DPWS015.                                                01980099
019900                                                                  01990099
020000*----------------------------------------------------------------*02000099
020100*    FUNCTION KEYS COPYBOOK                                      *02010099
020200*----------------------------------------------------------------*02020099
020300     COPY DPWS016.                                                02030099
020400                                                                  02040099
020500*----------------------------------------------------------------*02050099
020600*    COPYBOOK FOR RANDOM NUMBER GENERATOR                        *02060099
020700*----------------------------------------------------------------*02070099
020800     COPY DPWS902.                                                02080099
020900                                                                  02090099
021000******************************************************************02100099
021100*  COPYBOOK FOR THE CALENDAR ROUTINE                             *02110099
021200******************************************************************02120099
021300     COPY DPWS500.                                                02130099
021400                                                                  02140099
021500**--------------------------------------------------------------**02150099
021600** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **02160099
021700** SUB-ROUTINE (DPKUT100).                                      **02170099
021800**--------------------------------------------------------------**02180099
021900     COPY DPWS010I.                                               02190099
022000                                                                  02200099
022100**--------------------------------------------------------------**02210099
022200** THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS ARCHITECTURE*02220099
022300** APPLICATION PROGRAMMING INTERFACE MODULE.                    **02230099
022400**--------------------------------------------------------------**02240099
022500     COPY DPWS030.                                                02250099
022600     COPY DPWS930.                                                02260099
022700                                                                  02270099
022800**--------------------------------------------------------------**02280099
022900*    STANDARD COMMAREA.                                           02290099
023000**--------------------------------------------------------------**02300099
023100     COPY DPWS020.                                                02310099
023200     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02320099
023300                                                                  02330099
023400***************************************************************** 02340099
023500*    INTER-APPLICATION COMMAREA.                                  02350099
023600*         RVWS100 - COMMAREA COMING FROM RVKCS104 (HEADER UPDATE) 02360099
023700*         RVWS008 - COMMAREA COMING FROM RVKCS108 (SHIPMENT INFO) 02370099
023800***************************************************************** 02380099
023900         10  INTER-APPL-COMM-AREA PIC X(200).                     02390099
024000     COPY RVWS100.                                                02400099
024100                                                                  02410099
024200     COPY RVWS008.                                                02420099
024300                                                                  02430099
024400***************************************************************** 02440099
024500*    SPECIFIC COMMMAREA FOR RVKCS107.                             02450099
024600***************************************************************** 02460099
024700         10  ASC-SPECIFIC-COMMAREA.                               02470099
024800             15  ASC-CONFIRM-SW            PIC  X(01).            02480099
024900                 88 ASC-CONFIRM            VALUE 'Y'.             02490099
025000                 88 ASC-NO-CONFIRM         VALUE 'N'.             02500099
025100             15  ASC-CHG-STATUS-SW         PIC  X(01).            02510099
025200                 88 ASC-RTV-TO-DND         VALUE 'R'.             02520099
025300                 88 ASC-DND-TO-RTV         VALUE 'D'.             02530099
025400                 88 ASC-SHIP-TO-DND        VALUE 'S'.             02540099
025500                 88 ASC-SHIP-TO-RTV        VALUE 'T'.             02550099
025600*-------------- ASC-SHIP-TO-UNSHIP  ONLY USED FOR F21 UNSHIP      02560099
025700                 88 ASC-SHIP-TO-UNSHIP     VALUE 'U'.             02570099
025800             15  ASC-RETURN-FROM-SW        PIC  X(01).            02580099
025900                 88 ASC-RETURN-FROM-SHIPT  VALUE '1'.             02590099
026000                 88 ASC-VNTERMS            VALUE '2'.             02600099
026100             15  ASC-CURRENT-DATE-USA      PIC  X(10).            02610099
026200             15  ASC-DFCT-ORD-ID           PIC S9(12) COMP-3.     02620099
026300             15  ASC-DFCT-SHIPT-ID         PIC S9(09) COMP.       02630099
026400             15  ASC-LIST-TYPE             PIC  X(08).            02640099
026500             15  ASC-TYPE-CDE              PIC  X(01).            02650099
026600                 88 ASC-VALID-TYP-CDE      VALUE 'D', 'R'.        02660099
026700                 88 ASC-DND-TYP            VALUE 'D'.             02670099
026800                 88 ASC-RTV-TYP            VALUE 'R'.             02680099
026900             15  ASC-TYPE-CDE-OLD          PIC  X(01).            02690099
027000             15  ASC-LOCATION              PIC  X(15).            02700099
027100             15  ASC-VENDOR-NAME           PIC  X(25).            02710099
027200             15  ASC-ENT-ID                PIC S9(09) COMP.       02720099
027300             15  ASC-DEPT-NBR              PIC  X(03).            02730099
027400             15  ASC-INHOUSE-NBR           PIC S9(03)V COMP-3.    02740099
027500             15  ASC-STATUS                PIC  X(08).            02750099
027600             15  ASC-STAT-CDE              PIC  X(01).            02760099
027700                 88 ASC-VALID-STAT         VALUE                  02770099
027800                                         'C', 'D', 'S', 'A'.      02780099
027900                 88 ASC-DND-STAT-D         VALUE 'D'.             02790099
028000                 88 ASC-DND-STAT-S         VALUE 'S'.             02800099
028100                 88 ASC-DND-STAT-A         VALUE 'A'.             02810099
028200                 88 ASC-RTV-STAT-C         VALUE 'C'.             02820099
028300                 88 ASC-RTV-STAT-S         VALUE 'S'.             02830099
028400                 88 ASC-RTV-STAT-A         VALUE 'A'.             02840099
028500             15  ASC-STAT-CDE-OLD          PIC  X(01).            02850099
028600             15  ASC-TK-NBR                PIC  X(08).            02860099
028700             15  ASC-AUTH-ID               PIC  X(10).            02870099
028800             15  ASC-AUTH-DTE              PIC  X(10).            02880099
028900             15  ASC-SHIP-DTE              PIC  X(10).            02890099
029000             15  ASC-SHIPPED-BY            PIC  X(40).            02900099
029100             15  ASC-SHIP-ID               PIC  9(09).            02910099
029200             15  ASC-SCAC                  PIC  X(04).            02920099
029300             15  ASC-TRAILER-NBR           PIC  X(12).            02930099
029400             15  ASC-TRACKING-NBR          PIC  X(25).            02940099
029500             15  ASC-CART-QTY              PIC  9(10).            02950099
029600             15  ASC-CART-QTY-X            PIC  X(10).            02960099
029700             15  ASC-DFCT-WT-QTY           PIC  9(08).            02970099
029800             15  ASC-DFCT-WT-QTY-X         PIC  X(08).            02980099
029900             15  ASC-RET-RSN               PIC  X(01).            02990099
030000             15  ASC-PAYT-TYPE             PIC  X(01).            03000099
030100             15  ASC-TOTAL-COST            PIC  9(06)V99.         03010099
030200             15  ASC-TOTAL-COST-X          PIC  X(10).            03020099
030300             15  ASC-TOTAL-RETAIL          PIC  9(06)V99.         03030099
030400             15  ASC-TOTAL-RETAIL-X        PIC  X(10).            03040099
030500             15  ASC-OUTBND-CHRGS          PIC  9(06)V99.         03050099
030600             15  ASC-OUTBND-CHRGS-X        PIC  X(10).            03060099
030700             15  ASC-INBND-CHRGS           PIC  9(06)V99.         03070099
030800             15  ASC-INBND-CHRGS-X         PIC  X(10).            03080099
030900             15  ASC-DED-CHRG-AMT          PIC  9(06)V99.         03090099
031000             15  ASC-DED-CHRG-AMT-X        PIC  X(10).            03100099
031100             15  ASC-DISC-PCT              PIC  9(03)V99.         03110099
031200             15  ASC-DISC-PCT-X            PIC  X(10).            03120099
031300             15  ASC-DISC-AMT-X.                                  03130099
031400                 20  ASC-DISC-AMT          PIC  9(06)V99.         03140099
031500             15  ASC-GRAND-TOTAL           PIC  9(06)V99.         03150099
031600             15  ASC-GRAND-TOTAL-X         PIC  X(10).            03160099
031700             15  ASC-SPEC-INSTRUCTIONS.                           03170099
031800                 20 ASC-SPEC-INSTR-LINE-1  PIC  X(35).            03180099
031900                 20 ASC-SPEC-INSTR-LINE-2  PIC  X(65).            03190099
032000             15  ASC-BUYER                 PIC  X(15).            03200099
032100                                                                  03210099
032200*----------------------------------------------------------------*03220099
032300*    ABEND PROCESSING COPYBOOK.                                  *03230099
032400*----------------------------------------------------------------*03240099
032500     COPY DPWS013.                                                03250099
032600                                                                  03260099
032700                                                                  03270099
032800***  DB2 AREA FOR TDFCTOR TABLE                                   03280099
032900                                                                  03290099
033000     EXEC SQL                                                     03300099
033100          INCLUDE TDFCTOR                                         03310099
033200     END-EXEC.                                                    03320099
033300                                                                  03330099
033400***  DB2 AREA FOR TDFMEIT TABLE                                   03340099
033500                                                                  03350099
033600     EXEC SQL                                                     03360099
033700          INCLUDE TDFMEIT                                         03370099
033800     END-EXEC.                                                    03380099
033900                                                                  03390099
034000***  DB2 AREA FOR RVT_DFCT_SHIPT  TABLE                           03400099
034100                                                                  03410099
034200     EXEC SQL                                                     03420099
034300          INCLUDE RVT00000                                        03430099
034400     END-EXEC.                                                    03440099
034500                                                                  03450099
034600***  DB2 AREA FOR RVT_SHIPT_STAT TABLE                            03460099
034700                                                                  03470099
034800     EXEC SQL                                                     03480099
034900          INCLUDE RVT00001                                        03490099
035000     END-EXEC.                                                    03500099
035100                                                                  03510099
035200***  DB2 AREA FOR RVT_DFCT_STAT TABLE                             03520099
035300                                                                  03530099
035400     EXEC SQL                                                     03540099
035500          INCLUDE RVT00003                                        03550099
035600     END-EXEC.                                                    03560099
035700                                                                  03570099
035800***  DB2 AREA FOR VENDOR AGREEMENT TABLE                          03580099
035900                                                                  03590099
036000     EXEC SQL                                                     03600099
036100          INCLUDE TVNDAGR                                         03610099
036200     END-EXEC.                                                    03620099
036300                                                                  03630099
036400***  DB2 AREA FOR ENTITY NAME TABLE                               03640099
036500                                                                  03650099
036600     EXEC SQL                                                     03660099
036700          INCLUDE TENTNME                                         03670099
036800     END-EXEC.                                                    03680099
036900                                                                  03690099
037000***  DB2 AREA FOR EXTERNAL ENTITY TABLE                           03700099
037100                                                                  03710099
037200     EXEC SQL                                                     03720099
037300          INCLUDE TEXTENT                                         03730099
037400     END-EXEC.                                                    03740099
037500                                                                  03750099
037600***  DB2 AREA FOR FREIGHT TERMS TABLE                             03760099
037700                                                                  03770099
037800     EXEC SQL                                                     03780099
037900          INCLUDE TFRGTRM                                         03790099
038000     END-EXEC.                                                    03800099
038100                                                                  03810099
038200***  DB2 AREA FOR VENDOR DEPARTMENT TABLE                         03820099
038300                                                                  03830099
038400     EXEC SQL                                                     03840099
038500          INCLUDE TVNDDPT                                         03850099
038600     END-EXEC.                                                    03860099
038700                                                                  03870099
038800***  DB2 AREA FOR XLT_USR TABLE                                   03880099
038900                                                                  03890099
039000     EXEC SQL                                                     03900099
039100          INCLUDE XLT00024                                        03910099
039200     END-EXEC.                                                    03920099
039300                                                                  03930099
039400*    DB2 AREA FOR COMMUNICATIONS                                  03940099
039500                                                                  03950099
039600     EXEC SQL                                                     03960099
039700          INCLUDE SQLCA                                           03970099
039800     END-EXEC.                                                    03980099
039900                                                                  03990099
040000 LINKAGE SECTION.                                                 04000099
040100                                                                  04010099
040200 01  DFHCOMMAREA.                                                 04020099
040300     05  FILLER                         OCCURS  1 TO 4072 TIMES   04030099
040400                                        DEPENDING ON EIBCALEN.    04040099
040500         10  FILLER                     PIC X.                    04050099
040600                                                                  04060099
040700                                                                  04070099
040800 PROCEDURE DIVISION.                                              04080099
040900***************************************************************** 04090099
041000** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 04100099
041100** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 04110099
041200** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 04120099
041300**                                                             ** 04130099
041400** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 04140099
041500** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 04150099
041600***************************************************************** 04160099
041700 0000-MAIN-MODULE.                                                04170099
041800     INITIALIZE DP030-CICS-API-FIELDS.                            04180099
041900     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04190099
042000     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04200099
042100     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04210099
042200     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04220099
042300     MOVE LENGTH OF RV107AI        TO DP030-MAP-LENGTH (1).       04230099
042400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04240099
042500     PERFORM 0001-CALL-CICS-ARCH-API.                             04250099
042600*                                                                 04260099
042700     PERFORM 1000-CONTROL-PROCESSING                              04270099
042800*                                                                 04280099
042900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04290099
043000     PERFORM 0001-CALL-CICS-ARCH-API.                             04300099
043100                                                                  04310099
043200 0001-CALL-CICS-ARCH-API.                                         04320099
043300     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04330099
043400                                    DFHCOMMAREA                   04340099
043500                                    DP030-CICS-API-FIELDS         04350099
043600                                    DP020-STANDARD-COMMAREA       04360099
043700                                    RV107AI.                      04370099
043800*                                                                 04380099
043900     IF  DP030-RC-CALL-SUCCESSFUL                                 04390099
044000         CONTINUE                                                 04400099
044100     ELSE                                                         04410099
044200         SET DP013-NO-ROLLBACK                                    04420099
044300             DP013-XCTL-DISPLAY-RESTART                           04430099
044400             DP013-CICS-ABEND      TO TRUE                        04440099
044500         MOVE 'BEFORE 0000-MAIN-MODULE'                           04450099
044600                                   TO DP013-PARAGRAPH             04460099
044700         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04470099
044800-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04480099
044900         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04490099
045000         PERFORM DP013-0000-PROCESS-ABEND                         04500099
045100     END-IF.                                                      04510099
045200                                                                  04520099
045300*----------------------------------------------------------------*04530099
045400*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *04540099
045500*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *04550099
045600*----------------------------------------------------------------*04560099
045700 1000-CONTROL-PROCESSING.                                         04570099
045800     EVALUATE TRUE                                                04580099
045900         WHEN DP020-NEXT-ACT-INITIAL                              04590099
046000              INITIALIZE ASC-SPECIFIC-COMMAREA                    04600099
046100              PERFORM 1100-PROCESS-INTER-APPL-COMM                04610099
046200              PERFORM 4000-BUILD-INITIAL-PANEL                    04620099
046300*             IF SQLCODE = +100                                   04630099
046400*                 SET DP020-NEXT-ACT-APPL-ERROR TO TRUE           04640099
046500*                 MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER        04650099
046600*                 SET DP020-MSG-INFORMATIONAL TO TRUE             04660099
046700*             END-IF                                              04670099
046800                                                                  04680099
046900         WHEN DP020-NEXT-ACT-READ-MAP                             04690099
047000             PERFORM 2000-PROCESS-PANEL                           04700099
047100                                                                  04710099
047200         WHEN DP020-NEXT-ACT-RETURN                               04720099
047300             MOVE DP020-INT-APPL-FORMAT-IND TO ASC-RETURN-FROM-SW 04730099
047400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04740099
047500                                                                  04750099
047600         WHEN OTHER                                               04760099
047700             SET DP013-LOGIC-ABEND TO TRUE                        04770099
047800             SET DP013-NO-ROLLBACK TO TRUE                        04780099
047900             MOVE '1000-CONTROL-PROCESSING'                       04790099
048000                                   TO DP013-PARAGRAPH             04800099
048100             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   04810099
048200                                   TO DP013-MESSAGE-TEXT(1)       04820099
048300             MOVE DP020-NEXT-APPL-ACTIVITY                        04830099
048400                                   TO DP013-MESSAGE-TEXT(2)       04840099
048500             PERFORM DP013-0000-PROCESS-ABEND                     04850099
048600     END-EVALUATE.                                                04860099
048700                                                                  04870099
048800*----------------------------------------------------------------*04880099
048900* GET THE NECESSARY FIELDS FROM THE  INTER-APPL COMMAREA         *04890099
049000*----------------------------------------------------------------*04900099
049100 1100-PROCESS-INTER-APPL-COMM.                                    04910099
049200     EXEC SQL                                                     04920099
049300         SET :PV-CURRENT-TMST = CURRENT_TIMESTAMP                 04930099
049400     END-EXEC.                                                    04940099
049500     MOVE PV-CURRENT-TMST         TO PV-CUR-TMST.                 04950099
049600     MOVE PV-CURRENT-DT           TO PV-CURRENT-DATE.             04960099
049700     MOVE PV-CURRENT-DT-CCYY      TO PV-CUR-USA-DT-CCYY.          04970099
049800     MOVE PV-CURRENT-DT-MM        TO PV-CUR-USA-DT-MM.            04980099
049900     MOVE PV-CURRENT-DT-DD        TO PV-CUR-USA-DT-DD.            04990099
050000     MOVE PV-CURRENT-DATE-USA     TO ASC-CURRENT-DATE-USA.        05000099
050100     MOVE RV100-RA-NUMBER         TO ASC-DFCT-ORD-ID.             05010099
050200     EVALUATE RV100-TYPE-CDE                                      05020099
050300         WHEN 'R'                                                 05030099
050400             MOVE 'RTV     '      TO ASC-LIST-TYPE                05040099
050500         WHEN 'D'                                                 05050099
050600             MOVE 'D & D   '      TO ASC-LIST-TYPE                05060099
050700     END-EVALUATE.                                                05070099
050800     MOVE RV100-TYPE-CDE          TO ASC-TYPE-CDE                 05080099
050900                                     ASC-TYPE-CDE-OLD.            05090099
051000     MOVE RV100-LOCATION          TO ASC-LOCATION.                05100099
051100     MOVE RV100-VENDOR-NAME       TO ASC-VENDOR-NAME.             05110099
051200     MOVE RV100-DEPT-NUMBER       TO ASC-DEPT-NBR                 05120099
051300                                     DK-DEPT-NBR.                 05130099
051400     MOVE RV100-ENT-ID            TO ASC-ENT-ID                   05140099
051500                                     DK-ENT-ID.                   05150099
051600     MOVE RV100-TOTAL-RETAIL      TO ASC-TOTAL-RETAIL.            05160099
051700     MOVE RV100-TOTAL-COST        TO ASC-TOTAL-COST.              05170099
051800                                                                  05180099
051900     EVALUATE RV100-STATUS-CDE                                    05190099
052000         WHEN 'N'                                                 05200099
052100             MOVE 'NEW     '      TO ASC-STATUS                   05210099
052200         WHEN 'O'                                                 05220099
052300             MOVE 'OPEN    '      TO ASC-STATUS                   05230099
052400         WHEN 'C'                                                 05240099
052500             MOVE 'CLOSED  '      TO ASC-STATUS                   05250099
052600         WHEN 'P'                                                 05260099
052700             MOVE 'PENDING '      TO ASC-STATUS                   05270099
052800         WHEN 'S'                                                 05280099
052900             MOVE 'SHIPPED '      TO ASC-STATUS                   05290099
053000         WHEN 'A'                                                 05300099
053100             MOVE 'APPROVED'      TO ASC-STATUS                   05310099
053200         WHEN 'D'                                                 05320099
053300             MOVE 'D & D   '      TO ASC-STATUS                   05330099
053400     END-EVALUATE.                                                05340099
053500     MOVE RV100-STATUS-CDE        TO ASC-STAT-CDE                 05350099
053600                                     ASC-STAT-CDE-OLD.            05360099
053700                                                                  05370099
053800*----------------------------------------------------------------*05380099
053900* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *05390099
054000* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *05400099
054100* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *05410099
054200* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *05420099
054300* FUNCTION KEYS CAN GET THIS FAR.                                *05430099
054400*----------------------------------------------------------------*05440099
054500 2000-PROCESS-PANEL.                                              05450099
054600     EVALUATE TRUE                                                05460099
054700         WHEN DP020-SRC-AID = DP016-CLEAR                         05470099
054800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05480099
054900         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     05490099
055000             SET DP030-DONT-ERASE                                 05500099
055100                 DP030-SEND-DATAONLY (PC-APPL-MAP) TO TRUE        05510099
055200             PERFORM 4000-BUILD-INITIAL-PANEL                     05520099
055300         WHEN OTHER                                               05530099
055400             IF  PS-NO-ERROR                                      05540099
055500                 SET DP030-CONTINUE-GO TO TRUE                    05550099
055600                 PERFORM 2100-CHECK-FUNCTION-KEY                  05560099
055700             ELSE                                                 05570099
055800                 SET DP030-OVERRIDE-GO TO TRUE                    05580099
055900             END-IF                                               05590099
056000     END-EVALUATE.                                                05600099
056100                                                                  05610099
056200*----------------------------------------------------------------*05620099
056300* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *05630099
056400* FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED   *05640099
056500* FROM THE CICS ARCHITECTURE API.                                *05650099
056600*----------------------------------------------------------------*05660099
056700 2100-CHECK-FUNCTION-KEY.                                         05670099
056800     EVALUATE TRUE                                                05680099
056900* - ENTER KEY                                                     05690099
057000         WHEN DP020-SRC-AID = DP016-ENTER                         05700099
057100             SET DP030-CONTINUE-GO TO TRUE                        05710099
057200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05720099
057300                                                                  05730099
057400***************************************************************   05740099
057500                                                                  05750099
057600******   F24  PRINT ROUTINE HERE   ****************               05760099
057700                                                                  05770099
057800                                                                  05780099
057900         WHEN OTHER                                               05790099
058000             SET DP013-NO-ROLLBACK                                05800099
058100                 DP013-XCTL-DISPLAY-RESTART                       05810099
058200                 DP013-CICS-ABEND  TO TRUE                        05820099
058300             MOVE '2100-CHECK-FUNCTION-KEY'                       05830099
058400                                   TO DP013-PARAGRAPH             05840099
058500             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05850099
058600                                   TO DP013-MESSAGE-TEXT (1)      05860099
058700             PERFORM DP013-0000-PROCESS-ABEND                     05870099
058800     END-EVALUATE.                                                05880099
058900                                                                  05890099
059000*----------------------------------------------------------------*05900099
059100*  GET THE NAME OF WHO IS SHIPPING THE LISTING                   *05910099
059200*   - READS THE USERNAME OF THE PERSON WHO SHIPPED THE ORDER      05920099
059300*     FROM THE RVT_DFCT_STAT AND XLT_USR TABLES                   05930099
059400*                                                                 05940099
059500*----------------------------------------------------------------*05950099
059600 3900-GET-USER-NAME.                                              05960099
059700     INITIALIZE DCLXLT00024.                                      05970099
059800     PERFORM WITH TEST AFTER                                      05980099
059900         VARYING PV-RETRY-COUNTER                                 05990099
060000         FROM 1 BY 1                                              06000099
060100         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 06010099
060200                 OR SQLCODE = 0                                   06020099
060300                 OR SQLCODE = +100)                               06030099
060400                                                                  06040099
060500         EXEC SQL                                                 06050099
060600             SELECT  B.USR_LAST_NM                                06060099
060700                    ,B.USR_FRST_NM                                06070099
060800               INTO  :XLT00024-USR-LAST-NM                        06080099
060900                    ,:XLT00024-USR-FRST-NM                        06090099
061000               FROM  RVT_DFCT_STAT A                              06100099
061100                    ,XLT_USR       B                              06110099
061200              WHERE A.DFCT_ORD_ID     = :DK-DFCT-ORD-ID           06120099
061300                AND A.CHGD_TMST =                                 06130099
061400                   (SELECT MAX(C.CHGD_TMST)                       06140099
061500                      FROM RVT_DFCT_STAT C                        06150099
061600                     WHERE C.DFCT_ORD_ID = A.DFCT_ORD_ID          06160099
061700                       AND C.DFCT_ORD_STAT_CDE = 'S')             06170099
061800                AND B.USR_ID         = A.USR_ID                   06180099
061900         END-EXEC                                                 06190099
062000                                                                  06200099
062100         EVALUATE TRUE                                            06210099
062200             WHEN SQLCODE = ZERO                                  06220099
062300                 SET PS-DATA-FOUND   TO TRUE                      06230099
062400                 STRING XLT00024-USR-FRST-NM DELIMITED BY '  '    06240099
062500                        ' '                  DELIMITED BY SIZE    06250099
062600                        XLT00024-USR-LAST-NM DELIMITED BY SIZE    06260099
062700                   INTO ASC-SHIPPED-BY                            06270099
062800             WHEN SQLCODE = +100                                  06280099
062900                 SET PS-DATA-NOT-FOUND TO TRUE                    06290099
063000                 MOVE SPACE          TO ASC-SHIPPED-BY            06300099
063100             WHEN SQLCODE = -904                                  06310099
063200             WHEN SQLCODE = -913                                  06320099
063300                 SET PS-DATA-NOT-FOUND TO TRUE                    06330099
063400             WHEN SQLWARN0 NOT = SPACES                           06340099
063500             WHEN SQLCODE NOT EQUAL ZERO                          06350099
063600                 MOVE '3900-GET-USER-NAME' TO DP013-PARAGRAPH     06360099
063700                 MOVE 'GET USER NAME'     TO DP013-MESSAGE-TEXT(1)06370099
063800                 MOVE SQLCA             TO DP013-SQLCA            06380099
063900                 MOVE 'XLT_USR'         TO DP013-DB2-TABLE-NAME(1)06390099
064000                 SET DP013-DB2-ABEND                              06400099
064100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           06410099
064200                 PERFORM DP013-0000-PROCESS-ABEND                 06420099
064300         END-EVALUATE                                             06430099
064400     END-PERFORM.                                                 06440099
064500                                                                  06450099
064600     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         06460099
064700         MOVE '3900-GET-USER-NAME'   TO DP013-PARAGRAPH           06470099
064800         MOVE 'GET USER NAME'        TO DP013-MESSAGE-TEXT(1)     06480099
064900         MOVE 'MAX RETRIES EXCEEDED' TO DP013-MESSAGE-TEXT(2)     06490099
065000         MOVE SQLCA                  TO DP013-SQLCA               06500099
065100         MOVE 'TUSER'                TO DP013-DB2-TABLE-NAME(1)   06510099
065200         SET DP013-DB2-ABEND                                      06520099
065300             DP013-XCTL-DISPLAY-RESTART TO TRUE                   06530099
065400         PERFORM DP013-0000-PROCESS-ABEND                         06540099
065500     END-IF.                                                      06550099
065600                                                                  06560099
065700*----------------------------------------------------------------*06570099
065800*    BUILD THE INITIAL PANEL FOR FIRST TIME DISPLAY              *06580099
065900*----------------------------------------------------------------*06590099
066000 4000-BUILD-INITIAL-PANEL.                                        06600099
066100     SET DP030-SET-CURSOR-APPL-1   TO TRUE                        06610099
066200     MOVE ASC-DFCT-ORD-ID              TO DK-DFCT-ORD-ID.         06620099
066300                                                                  06630099
066400     PERFORM 4100-GET-DATA.                                       06640099
066500     IF PS-DATA-FOUND                                             06650099
066600         IF NI-SHIPT-ID    < ZERO                                 06660099
066700             SET PS-SHIPT-ID-NOT-FOUND TO TRUE                    06670099
066800             MOVE SPACES TO RVT00001-CRE-TMST                     06680099
066900             MOVE SPACES TO RVT00001-SHIPT-STAT-CDE               06690099
067000             MOVE SPACES TO RVT00001-USR-ID                       06700099
067100             MOVE SPACES TO RVT00000-TRLR-ID                      06710099
067200             MOVE SPACES TO RVT00000-SCAC-CDE                     06720099
067300         ELSE                                                     06730099
067400             MOVE DFCTOR-DFCT-SHIPT-ID TO DK-DFCT-SHIPT-ID        06740099
067500             PERFORM 4200-GET-SHIP-INFO                           06750099
067600         END-IF                                                   06760099
067700         IF PS-DATA-FOUND                                         06770099
067800             IF DK-DFCT-SHIPT-ID > ZERO                           06780099
067900                 PERFORM 3900-GET-USER-NAME                       06790099
068000             END-IF                                               06800099
068100             PERFORM 4300-MOVE-DB-DATA-TO-COMMAREA                06810099
068200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06820099
068300         END-IF                                                   06830099
068400     END-IF.                                                      06840099
068500                                                                  06850099
068600*----------------------------------------------------------------*06860099
068700* SELECT A ROW FROM TDFCTOR AND ACCOMPANYING STATUS TABLE        *06870099
068800*----------------------------------------------------------------*06880099
068900 4100-GET-DATA.                                                   06890099
069000     PERFORM                                                      06900099
069100         WITH TEST AFTER                                          06910099
069200         VARYING PV-RETRY-COUNTER                                 06920099
069300         FROM 1 BY 1                                              06930099
069400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06940099
069500                   OR (SQLCODE = ZERO)                            06950099
069600                   OR (SQLCODE = +100))                           06960099
069700*                                                                 06970099
069800         EXEC SQL                                                 06980099
069900             SELECT DFCT_SHIPT_ID                                 06990099
070000                  , DFCT_UID_NBR                                  07000099
070100                  , LOC_ID                                        07010099
070200                  , DFCT_ORD_ID_CDE                               07020099
070300                  , DFCT.DFCT_ORD_STAT_CDE                        07030099
070400                  , VND_AUTH_ID                                   07040099
070500                  , CHAR(DATE(VND_AUTH_DTE),USA)                  07050099
070600                  , RET_RSN_CDE                                   07060099
070700                  , PAYT_TYP_CDE                                  07070099
070800                  , CART_QTY                                      07080099
070900                  , SPC_INSTR_TXT                                 07090099
071000                  , INBD_RET_FRGT_AMT                             07100099
071100                  , OTBND_RET_FRGT_AMT                            07110099
071200                  , DED_CHRG_AMT                                  07120099
071300                  , DFCT_WT_QTY                                   07130099
071400                  , DISC_PCT                                      07140099
071500                  , DISC_AMT                                      07150099
071600                  , CARR_TRKG_ID                                  07160099
071700                  , USR_ID                                        07170099
071800               INTO :DFCTOR-DFCT-SHIPT-ID:NI-SHIPT-ID             07180099
071900                  , :DFCTOR-DFCT-UID-NBR                          07190099
072000                  , :DFCTOR-LOC-ID                                07200099
072100                  , :DFCTOR-DFCT-ORD-ID-CDE                       07210099
072200                  , :DFCTOR-DFCT-ORD-STAT-CDE                     07220099
072300                  , :DFCTOR-VND-AUTH-ID:NI-AUTH-ID                07230099
072400                  , :DFCTOR-VND-AUTH-DTE:NI-AUTH-DTE              07240099
072500                  , :DFCTOR-RET-RSN-CDE:NI-RET-RSN                07250099
072600                  , :DFCTOR-PAYT-TYP-CDE:NI-PAYT-TYP              07260099
072700                  , :DFCTOR-CART-QTY:NI-CART-QTY                  07270099
072800                  , :DFCTOR-SPC-INSTR-TXT:NI-SPEC-INSTR           07280099
072900                  , :DFCTOR-INBD-RET-FRGT-AMT:NI-INBND-FRGT       07290099
073000                  , :DFCTOR-OTBND-RET-FRGT-AMT:NI-OUTBND-FRGT     07300099
073100                  , :DFCTOR-DED-CHRG-AMT:NI-DEDUCT                07310099
073200                  , :DFCTOR-DFCT-WT-QTY:NI-WEIGHT                 07320099
073300                  , :DFCTOR-DISC-PCT:NI-DISC-PCT                  07330099
073400                  , :DFCTOR-DISC-AMT:NI-DISC-AMT                  07340099
073500                  , :DFCTOR-CARR-TRKG-ID:NI-CARR-TRKG-ID          07350099
073600                  , :RVT00003-USR-ID                              07360099
073700             FROM   TDFCTOR  DFCT                                 07370099
073800                  , RVT_DFCT_STAT  DSTAT                          07380099
073900             WHERE  DFCT.DFCT_ORD_ID       = :DK-DFCT-ORD-ID      07390099
074000               AND  DFCT.DFCT_ORD_ID       = DSTAT.DFCT_ORD_ID    07400099
074100               AND  DFCT.DFCT_ORD_STAT_CDE =                      07410099
074200                                           DSTAT.DFCT_ORD_STAT_CDE07420099
074300               AND  DSTAT.CHGD_TMST        =                      07430099
074400                        (SELECT MAX(CHGD_TMST)                    07440099
074500                           FROM RVT_DFCT_STAT Z                   07450099
074600                          WHERE Z.DFCT_ORD_ID = DFCT.DFCT_ORD_ID) 07460099
074700         END-EXEC                                                 07470099
074800                                                                  07480099
074900         EVALUATE TRUE                                            07490099
075000             WHEN SQLCODE = ZERO                                  07500099
075100                 SET PS-DATA-FOUND TO TRUE                        07510099
075200             WHEN SQLCODE = +100                                  07520099
075300                 SET PS-DATA-NOT-FOUND TO TRUE                    07530099
075400             WHEN SQLCODE = -904                                  07540099
075500             WHEN SQLCODE = -913                                  07550099
075600                 CONTINUE                                         07560099
075700             WHEN SQLWARN0 NOT = SPACES                           07570099
075800             WHEN SQLCODE < ZERO                                  07580099
075900             WHEN SQLCODE > ZERO                                  07590099
076000                 MOVE '4100-GET-DATA' TO DP013-PARAGRAPH          07600099
076100                 MOVE 'SELECT LISTING NUMBER'                     07610099
076200                                      TO DP013-MESSAGE-TEXT (1)   07620099
076300                 MOVE DK-DFCT-ORD-ID  TO DP013-MESSAGE-TEXT (2)   07630099
076400                 MOVE SQLCA           TO DP013-SQLCA              07640099
076500                 MOVE 'TDFCTOR'       TO DP013-DB2-TABLE-NAME (1) 07650099
076600                 MOVE 'RVT_DFCT_STAT' TO DP013-DB2-TABLE-NAME (2) 07660099
076700                 SET DP013-DB2-ABEND                              07670099
076800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           07680099
076900                 PERFORM DP013-0000-PROCESS-ABEND                 07690099
077000         END-EVALUATE                                             07700099
077100     END-PERFORM.                                                 07710099
077200*                                                                 07720099
077300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        07730099
077400         MOVE '4100-GET-DATA'                                     07740099
077500                                   TO DP013-PARAGRAPH             07750099
077600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     07760099
077700                                   TO DP013-MESSAGE-TEXT (1)      07770099
077800         MOVE 'LIST NUMBER'        TO DP013-MESSAGE-TEXT (2)      07780099
077900         MOVE DK-DFCT-ORD-ID       TO DP013-MESSAGE-TEXT (3)      07790099
078000         MOVE SQLCA                TO DP013-SQLCA                 07800099
078100         MOVE 'TDFCTOR'            TO DP013-DB2-TABLE-NAME (1)    07810099
078200         MOVE 'RVT_DFCT_STAT'      TO DP013-DB2-TABLE-NAME (2)    07820099
078300         SET DP013-DB2-ABEND                                      07830099
078400             DP013-XCTL-DISPLAY-RESTART TO TRUE                   07840099
078500         PERFORM DP013-0000-PROCESS-ABEND                         07850099
078600     END-IF.                                                      07860099
078700                                                                  07870099
078800*----------------------------------------------------------------*07880099
078900* SELECT DATA FROM THE RTV SHIPPING TABLES                       *07890099
079000*----------------------------------------------------------------*07900099
079100 4200-GET-SHIP-INFO.                                              07910099
079200     PERFORM                                                      07920099
079300         WITH TEST AFTER                                          07930099
079400         VARYING PV-RETRY-COUNTER                                 07940099
079500         FROM 1 BY 1                                              07950099
079600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07960099
079700                   OR (SQLCODE = ZERO)                            07970099
079800                   OR (SQLCODE = +100))                           07980099
079900*                                                                 07990099
080000         EXEC SQL                                                 08000099
080100             SELECT COALESCE(CHAR(ACTL_SHIPT_DTE,USA), '      ')  08010099
080200                  , SHIPT_STAT_CDE                                08020099
080300                  , USR_ID                                        08030099
080400                  , TRLR_ID                                       08040099
080500                  , SCAC_CDE                                      08050099
080600               INTO :RVT00000-ACTL-SHIPT-DTE                      08060099
080700                  , :RVT00001-SHIPT-STAT-CDE                      08070099
080800                  , :RVT00001-USR-ID                              08080099
080900                  , :RVT00000-TRLR-ID                             08090099
081000                  , :RVT00000-SCAC-CDE                            08100099
081100             FROM   RVT_DFCT_SHIPT SHIPT                          08110099
081200                  , RVT_SHIPT_STAT STAT                           08120099
081300             WHERE  SHIPT.DFCT_SHIPT_ID  = :DK-DFCT-SHIPT-ID      08130099
081400               AND  SHIPT.DFCT_SHIPT_ID  = STAT.DFCT_SHIPT_ID     08140099
081500               AND  STAT.SHIPT_STAT_CDE = 'S'                     08150099
081600               AND  SHIPT.ACTL_SHIPT_DTE =                        08160099
081700                        (SELECT MAX(ACTL_SHIPT_DTE)               08170099
081800                           FROM RVT_DFCT_SHIPT Z                  08180099
081900                          WHERE Z.DFCT_SHIPT_ID  =                08190099
082000                                            SHIPT.DFCT_SHIPT_ID)  08200099
082100         END-EXEC                                                 08210099
082200                                                                  08220099
082300         EVALUATE TRUE                                            08230099
082400             WHEN SQLCODE = ZERO                                  08240099
082500                 SET PS-DATA-FOUND                                08250099
082600                     PS-SHIPT-ID-FOUND TO TRUE                    08260099
082700             WHEN SQLCODE = -904                                  08270099
082800             WHEN SQLCODE = -913                                  08280099
082900                 CONTINUE                                         08290099
083000             WHEN SQLCODE = +100                                  08300099
083100                 SET PS-DATA-NOT-FOUND                            08310099
083200                     PS-SHIPT-ID-NOT-FOUND TO TRUE                08320099
083300                 MOVE SPACES TO RVT00001-CRE-TMST                 08330099
083400                 MOVE SPACES TO RVT00001-SHIPT-STAT-CDE           08340099
083500                 MOVE SPACES TO RVT00001-USR-ID                   08350099
083600                 MOVE SPACES TO RVT00000-TRLR-ID                  08360099
083700                 MOVE SPACES TO RVT00000-SCAC-CDE                 08370099
083800             WHEN SQLWARN0 NOT = SPACES                           08380099
083900             WHEN SQLCODE < ZERO                                  08390099
084000             WHEN SQLCODE > ZERO                                  08400099
084100                 MOVE '4200-GET-SHIP-INFO' TO DP013-PARAGRAPH     08410099
084200                 MOVE 'SELECT DFCT_SHIPT_ID'                      08420099
084300                                       TO DP013-MESSAGE-TEXT (1)  08430099
084400                 MOVE DK-DFCT-SHIPT-ID TO DP013-MESSAGE-TEXT (2)  08440099
084500                 MOVE SQLCA            TO DP013-SQLCA             08450099
084600                 MOVE 'RVT_DFCT_SHIPT' TO DP013-DB2-TABLE-NAME (1)08460099
084700                 MOVE 'RVT_SHIPT_STAT' TO DP013-DB2-TABLE-NAME (2)08470099
084800                 SET DP013-DB2-ABEND                              08480099
084900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           08490099
085000                 PERFORM DP013-0000-PROCESS-ABEND                 08500099
085100         END-EVALUATE                                             08510099
085200     END-PERFORM.                                                 08520099
085300*                                                                 08530099
085400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08540099
085500         MOVE '4200-GET-SHIP-INFO'                                08550099
085600                                   TO DP013-PARAGRAPH             08560099
085700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     08570099
085800                                   TO DP013-MESSAGE-TEXT (1)      08580099
085900         MOVE 'SHIPPING INFO '     TO DP013-MESSAGE-TEXT (2)      08590099
086000         MOVE DK-DFCT-SHIPT-ID     TO DP013-MESSAGE-TEXT (3)      08600099
086100         MOVE SQLCA                TO DP013-SQLCA                 08610099
086200         MOVE 'RVT_DFCT_SHIPT'     TO DP013-DB2-TABLE-NAME (1)    08620099
086300         MOVE 'RVT_SHIPT_STAT'     TO DP013-DB2-TABLE-NAME (2)    08630099
086400         SET DP013-DB2-ABEND                                      08640099
086500             DP013-XCTL-DISPLAY-RESTART TO TRUE                   08650099
086600         PERFORM DP013-0000-PROCESS-ABEND                         08660099
086700     END-IF.                                                      08670099
086800                                                                  08680099
086900*----------------------------------------------------------------*08690099
087000*   MOVE DB2 DATA TO THE COMMAREA                                *08700099
087100*----------------------------------------------------------------*08710099
087200 4300-MOVE-DB-DATA-TO-COMMAREA.                                   08720099
087300                                                                  08730099
087400     MOVE DFCTOR-LOC-ID                  TO ASC-LOCATION.         08740099
087500     MOVE RVT00003-USR-ID                TO ASC-TK-NBR.           08750099
087600     MOVE DFCTOR-VND-AUTH-ID             TO ASC-AUTH-ID.          08760099
087700     MOVE DFCTOR-VND-AUTH-DTE            TO ASC-AUTH-DTE.         08770099
087800     MOVE DFCTOR-RET-RSN-CDE             TO ASC-RET-RSN.          08780099
087900     MOVE DFCTOR-PAYT-TYP-CDE            TO ASC-PAYT-TYPE.        08790099
088000                                                                  08800099
088100     IF NI-SHIPT-ID    < +0                                       08810099
088200          MOVE ZERO                      TO ASC-SHIP-ID           08820099
088300      ELSE                                                        08830099
088400          MOVE DFCTOR-DFCT-SHIPT-ID      TO ASC-SHIP-ID           08840099
088500     END-IF.                                                      08850099
088600                                                                  08860099
088700     IF NI-CART-QTY    < +0                                       08870099
088800          MOVE ZERO                      TO ASC-CART-QTY          08880099
088900      ELSE                                                        08890099
089000          MOVE DFCTOR-CART-QTY           TO ASC-CART-QTY          08900099
089100     END-IF.                                                      08910099
089200                                                                  08920099
089300     IF NI-SPEC-INSTR    < +0                                     08930099
089400          MOVE SPACES                    TO ASC-SPEC-INSTRUCTIONS 08940099
089500      ELSE                                                        08950099
089600          MOVE DFCTOR-SPC-INSTR-TXT      TO ASC-SPEC-INSTRUCTIONS 08960099
089700     END-IF.                                                      08970099
089800                                                                  08980099
089900     IF NI-CARR-TRKG-ID  < +0                                     08990099
090000          MOVE SPACES                    TO ASC-TRACKING-NBR      09000099
090100      ELSE                                                        09010099
090200          MOVE DFCTOR-CARR-TRKG-ID       TO ASC-TRACKING-NBR      09020099
090300     END-IF.                                                      09030099
090400                                                                  09040099
090500     IF NI-INBND-FRGT    < +0                                     09050099
090600          MOVE ZERO                      TO ASC-INBND-CHRGS       09060099
090700      ELSE                                                        09070099
090800          MOVE DFCTOR-INBD-RET-FRGT-AMT  TO ASC-INBND-CHRGS       09080099
090900     END-IF.                                                      09090099
091000                                                                  09100099
091100     IF NI-OUTBND-FRGT    < +0                                    09110099
091200          MOVE ZERO                      TO ASC-OUTBND-CHRGS      09120099
091300      ELSE                                                        09130099
091400          MOVE DFCTOR-OTBND-RET-FRGT-AMT TO ASC-OUTBND-CHRGS      09140099
091500     END-IF.                                                      09150099
091600                                                                  09160099
091700     IF NI-DEDUCT         < +0                                    09170099
091800          MOVE ZERO                      TO ASC-DED-CHRG-AMT      09180099
091900      ELSE                                                        09190099
092000          MOVE DFCTOR-DED-CHRG-AMT       TO ASC-DED-CHRG-AMT      09200099
092100     END-IF.                                                      09210099
092200                                                                  09220099
092300     IF NI-WEIGHT         < +0                                    09230099
092400          MOVE ZERO                      TO ASC-DFCT-WT-QTY       09240099
092500      ELSE                                                        09250099
092600          MOVE DFCTOR-DFCT-WT-QTY        TO ASC-DFCT-WT-QTY       09260099
092700     END-IF.                                                      09270099
092800                                                                  09280099
092900     IF NI-DISC-PCT       < +0                                    09290099
093000          MOVE ZERO                      TO ASC-DISC-PCT          09300099
093100      ELSE                                                        09310099
093200          MOVE DFCTOR-DISC-PCT           TO ASC-DISC-PCT          09320099
093300     END-IF.                                                      09330099
093400                                                                  09340099
093500     IF NI-DISC-AMT       < +0                                    09350099
093600          MOVE ZERO                      TO ASC-DISC-AMT          09360099
093700      ELSE                                                        09370099
093800          MOVE DFCTOR-DISC-AMT           TO ASC-DISC-AMT          09380099
093900     END-IF.                                                      09390099
094000                                                                  09400099
094100*    CALCULATE THE GRAND TOTAL COST                               09410099
094200     COMPUTE ASC-GRAND-TOTAL =                                    09420099
094300         ASC-TOTAL-COST + ASC-OUTBND-CHRGS +                      09430099
094400         ASC-INBND-CHRGS - ASC-DED-CHRG-AMT - ASC-DISC-AMT.       09440099
094500                                                                  09450099
094600*    ACTUAL SHIP DATE                                             09460099
094700     MOVE RVT00000-ACTL-SHIPT-DTE        TO ASC-SHIP-DTE          09470099
094800                                                                  09480099
094900*    MOVE RVT00001-USR-ID                TO ASC-TK-NBR.           09490099
095000     MOVE RVT00000-TRLR-ID               TO ASC-TRAILER-NBR.      09500099
095100     MOVE RVT00000-SCAC-CDE              TO ASC-SCAC.             09510099
095200                                                                  09520099
095300*----------------------------------------------------------------*09530099
095400*   MOVE COMMAREA TO THE THE SCREEN                              *09540099
095500*----------------------------------------------------------------*09550099
095600 4400-MOVE-COMMAREA-TO-SCREEN.                                    09560099
095700     MOVE ASC-DFCT-ORD-ID          TO ARANBRO.                    09570099
095800     MOVE ASC-LIST-TYPE            TO ATYPEO.                     09580099
095900     MOVE ASC-LOCATION             TO ALOCO.                      09590099
096000     MOVE ASC-VENDOR-NAME          TO AVNDRO.                     09600099
096100     MOVE ASC-STATUS               TO ASTATO.                     09610099
096200     MOVE ASC-TK-NBR               TO ATKNBRO.                    09620099
096300     MOVE ASC-AUTH-ID              TO AAUTHIDO.                   09630099
096400     MOVE ASC-AUTH-DTE             TO AAUTHDTO.                   09640099
096500     MOVE ASC-SHIP-DTE             TO ASHPDTEO.                   09650099
096600     MOVE ASC-SHIPPED-BY           TO ASHPDBYO.                   09660099
096700     MOVE ASC-SHIP-ID              TO ASHIPMTO.                   09670099
096800     MOVE ASC-SCAC                 TO ASCACO.                     09680099
096900     MOVE ASC-TRAILER-NBR          TO ATRAILRO.                   09690099
097000     MOVE ASC-TRACKING-NBR         TO ATRKNBRO.                   09700099
097100     MOVE ASC-CART-QTY             TO ACARTONO.                   09710099
097200     MOVE ASC-DFCT-WT-QTY          TO AWEIGHTO.                   09720099
097300     MOVE ASC-RET-RSN              TO ARETRSNO.                   09730099
097400     MOVE ASC-PAYT-TYPE            TO APAYTYPO.                   09740099
097500     MOVE ASC-TOTAL-COST           TO ATCOSTO.                    09750099
097600     MOVE ASC-TOTAL-RETAIL         TO ATRETLO.                    09760099
097700     MOVE ASC-OUTBND-CHRGS         TO AOUTCHGO.                   09770099
097800     MOVE ASC-INBND-CHRGS          TO AINCHGO.                    09780099
097900     MOVE ASC-DED-CHRG-AMT         TO ADEDUCTO.                   09790099
098000     MOVE ASC-DISC-PCT             TO ADSCPCTO.                   09800099
098100     MOVE ASC-DISC-AMT             TO ADISCNTO.                   09810099
098200     MOVE ASC-GRAND-TOTAL          TO AGTOTALO.                   09820099
098300     MOVE ASC-SPEC-INSTR-LINE-1    TO AINST1O.                    09830099
098400     MOVE ASC-SPEC-INSTR-LINE-2    TO AINST2O.                    09840099
098500                                                                  09850099
098600     MOVE -1                       TO AAUTHIDL.                   09860099
098700                                                                  09870099
098800*----------------------------------------------------------------*09880099
098900*    ABEND PROCESSOR MODULE                                      *09890099
099000*----------------------------------------------------------------*09900099
099100     COPY DPPD013.                                                09910099
