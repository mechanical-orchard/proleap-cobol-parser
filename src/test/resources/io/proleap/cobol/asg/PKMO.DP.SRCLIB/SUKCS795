000100*-----------------------*                                         00010084
000200 IDENTIFICATION DIVISION.                                         00020002
000210*-----------------------*                                         00021002
000220 PROGRAM-ID.    SUKCS795.                                         00022002
000230 AUTHOR.        OMAN.                                             00023002
000240 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00024002
000250 DATE-WRITTEN.  OCTOBER 2008.                                     00025002
000260 DATE-COMPILED.                                                   00026002
000270                                                                  00027002
000280*---------------------------------------------------------------* 00028002
000290*    S795 - PRINT AND APPLY STATION LIST                        * 00029002
000300*---------------------------------------------------------------* 00030002
263968* CHANGED 11/15/2021    BY JIM HUNTER      WR: CHG0263968         00032099
263968* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00033099
263968* MAKING THE CALL DYNAMIC VS STATIC.                              00034099
001130*                                                                 00034199
001110* CHANGED 01/09/2023    BY JEAN KURK       WR: CHG0278099         00034299
001120* CHANGE CALL OF DPKCS030 TO BE DYNAMIC                           00034399
263968*---------------------------------------------------------------* 00035099
000400 ENVIRONMENT DIVISION.                                            00040002
000500 DATA DIVISION.                                                   00050002
000600                                                                  00060002
000700 WORKING-STORAGE SECTION.                                         00070002
000800                                                                  00080002
000900 01  DK-DB2-KEYS.                                                 00090002
001000     05  DK-OPER-UNT-ID            PIC S9(04) COMP VALUE +0.      00100002
001010     05  DK-ACM-LBL-STA-NBR        PIC S9(09) COMP VALUE +0.      00101059
001100     05  DK-TYPE-CODE              PIC X(02)       VALUE SPACES.  00110002
001200     05  DK-DOOR-ID                PIC X(04)      VALUE SPACES.   00120002
001300     05  DK-STOR-ASGNMNT           PIC X(05)      VALUE SPACES.   00130002
001400     05  DK-STORE-ASSIGN REDEFINES DK-STOR-ASGNMNT.               00140002
001500         10  DK-STORE-ASSIGN-N     PIC 9(04).                     00150002
001600         10  FILLER                PIC X(01).                     00160002
001700                                                                  00170060
001800 01  PC-PROGRAM-CONSTANTS.                                        00180060
001900     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE 'SUK795  '.  00190060
002000     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE 'SUKM795 '.  00200060
002100     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE 'SUKCS795'.  00210060
002200     05  PC-APPL-MAP               PIC S9(04)  VALUE  +1          00220060
002300                                                     COMP.        00230060
002400     05  PC-DOOR-ID-MAX            PIC  S9(03) VALUE +2           00240073
002401                                               COMP-3.            00240173
002410     05  PC-LIST-QUEUE-SEQ         PIC  9(01)  VALUE 1.           00241073
002500     05  PC-SEL-QUEUE-SEQ          PIC  9(01)  VALUE 2.           00250060
002600     05  PC-CRIT-SPEC-FORMAT       PIC  X(01)  VALUE '1'.         00260060
002700     05  PC-DETAIL-SCREEN          PIC  X(01)  VALUE '2'.         00270060
002800     05  PC-ITEMS-PER-PANEL        PIC S9(04)  VALUE +12          00280060
002900                                               COMP SYNC.         00290060
003000     05  PC-MAX-BLOCKS-IN-ARRAY    PIC S9(04)  VALUE +2           00300060
003100                                               COMP SYNC.         00310060
003200     05  PC-MAX-ITEMS              PIC S9(09)  VALUE +1000000     00320060
003300                                               COMP-3.            00330060
003400     05  PC-MSG-NUMBER-LENGTH      PIC S9(04)  VALUE +5           00340060
003500                                               COMP SYNC.         00350060
003600     05  PC-MAX-RETRIES            PIC S9(03)  VALUE 3            00360060
003700                                               COMP-3.            00370060
003800     05  PC-INQ                    PIC  X(03)  VALUE 'INQ'.       00380060
003900     05  PC-ADD                    PIC  X(03)  VALUE 'ADD'.       00390060
004000     05  PC-UPD                    PIC  X(03)  VALUE 'UPD'.       00400002
004100     05  PC-DEL                    PIC  X(03)  VALUE 'DEL'.       00410002
004200     05  PC-ERR                    PIC  X(03)  VALUE 'ERR'.       00420002
004201     05  PC-DOOR                   PIC  X(04)  VALUE 'DOOR'.      00420102
004202     05  PC-STORE                  PIC  X(05)  VALUE 'STORE'.     00420260
004203     05  PC-01                     PIC  X(02)  VALUE '01'.        00420360
004204     05  PC-A                      PIC  X(01)  VALUE 'A'.         00420460
004205     05  PC-D                      PIC  X(01)  VALUE 'D'.         00420560
004206     05  PC-S                      PIC  X(01)  VALUE 'S'.         00420660
004207     05  PC-U                      PIC  X(01)  VALUE 'U'.         00420760
004208     05  PC-MULTI                  PIC  X(05)  VALUE 'MULTI'.     00420860
004209     05  PC-DEFAULT-TIMESTAMP     PIC  X(26)                      00420960
004210                          VALUE  '9999-09-09-09.09.09.999999'.    00421060
004220                                                                  00422060
004230*----------------------------------------------------------------*00423060
004240*  SYSTEM MESSAGES                                               *00424060
004250*----------------------------------------------------------------*00425060
004260*   00005 = INVALID VALUE                                        *00426060
004270*   00008 = MUST BE NUMERIC                                      *00427060
004280*   00050 - NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED  *00428060
004290*   00051 - NO END OF RANGE HAS BEEN SPECIFIED                   *00429060
004300*   00052 - END OF RANGE PRECEDES START OF RANGE                 *00430060
004400*   00053 - NO START OF RANGE HAS BEEN SPECIFIED                 *00440060
004500*   00054 - ONLY ONE START OF RANGE INDICATOR MAY BE SPECIFIED   *00450060
004600*   00055 - ONLY ONE END OF RANGE INDICATOR MAY BE SPECIFIED     *00460060
004700*   00057 - A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION       *00470060
004800*   00069 - TOP OF LIST                                          *00480060
004900*   00070 - BOTTOM OF LIST                                       *00490060
005000*   00101 - VALUE MUST BE > ZERO AND  < 1,000,000                *00500060
005100*   00279 - MORE ITEMS TO DISPLAY                                *00510060
005200*   02571 - UNABLE TO UPD - CURRENT OPER UNT AND OPER UNIT ID ENTE00520060
005300*   02575 - STORE ASSIGNMNT FUNCTION ONLY VALID FOR DOOR TYPES SHI00530060
005400*----------------------------------------------------------------*00540060
005500     05  PC-TSYMSG-NUMBERS.                                       00550060
005600         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00560060
005700         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00570060
005800         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00580060
005900         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00590060
006000         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00600060
006100         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00610060
006200         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00620060
006300         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00630060
006400         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00640060
006500         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00650060
006600         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00660060
006700         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00670060
006800         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00680060
006900         10  PC-TSYMSG-02571            PIC  9(05)  VALUE 02571.  00690060
007000         10  PC-TSYMSG-02575            PIC  9(05)  VALUE 02575.  00700060
007100*                                                                 00710060
007200 01  PS-PROGRAM-SWITCHES.                                         00720060
007300     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00730060
007400         88  PS-NO-ERROR                            VALUE 'Y'.    00740060
007500         88  PS-ERROR                               VALUE 'N'.    00750060
007600     05  PS-BLOCK-ERROR-SW              PIC  X(01)  VALUE 'Y'.    00760060
007700         88  PS-NO-BLOCK-ERROR                      VALUE 'Y'.    00770060
007800         88  PS-BLOCK-ERROR                         VALUE 'N'.    00780060
007900     05  PS-CONFIRM-PROCESSING-IND      PIC  X(01)  VALUE  'N'.   00790060
008000         88  PS-CONFIRM-PROCESSING                  VALUE  'Y'.   00800060
008100         88  PS-NOT-CONFIRM-PROCESSING              VALUE  'N'.   00810060
008200     05  PS-SOFT-ABORT-ERROR-SW         PIC  X(01)  VALUE 'N'.    00820060
008300         88  PS-SOFT-ABORT-ERROR                    VALUE 'Y'.    00830060
008400         88  PS-NO-SOFT-ABORT-ERROR                 VALUE 'N'.    00840060
008500     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00850060
008600         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00860060
008700         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00870060
008800     05  PS-LIST-END-SW                 PIC  X(01)  VALUE 'N'.    00880060
008900         88  PS-LIST-END                            VALUE 'Y'.    00890060
009000         88  PS-NO-LIST-END                         VALUE 'N'.    00900060
014602     05  PS-IS-PASGND-FOUND         PIC  X(01)  VALUE 'N'.        00901094
014603         88  PS-DC-PASGND-FOUND                 VALUE 'Y'.        00902094
014604         88  PS-DC-PASGND-NOT-FOUND             VALUE 'N'.        00903094
009100/                                                                 00910072
009200 01  PV-PROGRAM-VARIABLES.                                        00920060
009300     05  PV-MASK01                  PIC  9(09)           VALUE  0.00930093
009301     05  PV-MASK02                  PIC  9(09)           VALUE  0.00930193
009310     05  PV-CICS-RESP               PIC S9(08) COMP SYNC VALUE +0.00931093
009400     05  PV-COMMAREA-LENGTH         PIC S9(04) COMP SYNC VALUE +0.00940072
009500     05  PV-SUB                     PIC S9(04) COMP SYNC VALUE +0.00950072
009700     05  PV-REMAINDER               PIC S9(04) COMP SYNC VALUE +0.00970072
009880     05  PV-BLOCK-NUMBER            PIC S9(04) COMP SYNC VALUE +0.00988072
009893     05  PV-ITEM                    PIC S9(04) COMP SYNC VALUE +0.00989372
009895     05  PV-SEL-QUEUE-ITEM          PIC S9(04) COMP SYNC VALUE +0.00989572
009897     05  PV-SAVE-ITEM               PIC S9(04) COMP SYNC VALUE +0.00989772
009899     05  PV-HIGHEST-BLOCK-WRITTEN   PIC S9(04) COMP SYNC VALUE +0.00989972
009910     05  PV-LIST-ITEM-NUMBER        PIC S9(04) COMP SYNC VALUE +0.00991072
009930     05  PV-FIRST-BLOCK-IN-ARRAY    PIC S9(04) COMP SYNC VALUE +0.00993072
009950     05  PV-NEXT-BLOCK-IN-ARRAY     PIC S9(04) COMP SYNC VALUE +0.00995072
009960     05  PV-PREV-BLOCK-IN-ARRAY     PIC S9(04) COMP SYNC VALUE +0.00996072
009980     05  PV-FIRST-BLOCK-IN-RANGE    PIC S9(04) COMP SYNC VALUE +0.00998072
009991     05  PV-LAST-BLOCK-IN-RANGE     PIC S9(04) COMP SYNC VALUE +0.00999172
009993     05  PV-START-OF-SELECTED-RANGE PIC S9(04) COMP SYNC VALUE +0.00999372
009995     05  PV-END-OF-SELECTED-RANGE   PIC S9(04) COMP SYNC VALUE +0.00999572
009997     05  PV-RETRY-COUNTER           PIC S9(04) COMP SYNC VALUE +0.00999772
009998     05  PV-TEMP-BLOCK-NUMBER       PIC S9(09) COMP-3    VALUE +0.00999872
010000     05  PV-READ-COUNT              PIC S9(09) COMP-3    VALUE +0.01000072
010100     05  PV-ITEMS-PROCESSED         PIC S9(09) COMP-3    VALUE +0.01010072
010300     05  PV-HOLD-SELECTED-ITEMS     PIC S9(09) COMP-3    VALUE +0.01030072
010500     05  PV-ITEM-IN-USE             PIC S9(09) COMP-3    VALUE +0.01050072
010700     05  PV-TOP-ITEM                PIC S9(09) COMP-3    VALUE +0.01070072
010900     05  PV-BOTTOM-ITEM             PIC S9(09) COMP-3    VALUE +0.01090072
011000     05  PV-DOOR-ID-CNT             PIC S9(09) COMP-3    VALUE +0.01100073
014300     05  PV-SOFT-ABORT-MSG.                                       01430060
014400         10  FILLER            PIC X(12) VALUE ' SUKCS795 - '.    01440060
014500         10  FILLER            PIC X(09) VALUE 'SQLCODE: '.       01450060
014600         10  PV-SOFT-SQLCODE   PIC ZZZZZZZZ9-.                    01460060
014700         10  FILLER            PIC X(12) VALUE ' PARAGRAPH: '.    01470060
014800         10  PV-SOFT-PARAGRAPH PIC X(30).                         01480060
015100     05  PV-CICS-MSG-AREA                PIC  X(80)  VALUE SPACE. 01510060
015200     05  PV-CICS-MSG-AREA2               PIC  X(100) VALUE SPACE. 01520060
015300     05  PV-CICS-MSG-HOLD.                                        01530060
015400         10  FILLER                      PIC  X(01)  VALUE SPACE. 01540060
015500         10  PV-CICS-MSG-DATA            PIC  X(79)  VALUE SPACE. 01550060
015600     05  PV-CICS-MSG-HOLD2.                                       01560060
015700         10  FILLER                      PIC  X(01)  VALUE SPACE. 01570060
015800         10  PV-CICS-MSG-DATA2           PIC  X(99)  VALUE SPACE. 01580060
015900                                                                  01590060
016000     05  PV-ORIGINAL-BLOCK               PIC S9(04)  VALUE +0     01600060
016100                                                     COMP SYNC.   01610060
016200     05  PV-DOOR-CAPABLE          PIC S9(04)  VALUE 0 COMP.       01620060
016210     05  PV-TRAILERS-ASSIGNED     PIC S9(04)  VALUE 0 COMP.       01621060
016211     05  PV-ASSIGN-TMST           PIC  X(26)  VALUE SPACES.       01621160
016212     05  PV-ITEMS-HOLD            PIC S9(03)  COMP-3.             01621260
016213     05  PV-ITEMS-DIFF            PIC S9(03)  COMP-3.             01621360
016214     05  PV-CASE-NBR              PIC  X(10).                     01621460
016215     05  PV-CURSOR                PIC  X(10)  VALUE SPACE.        01621560
016216         88  PS-DOOR-CSR                      VALUE 'DOOR'.       01621660
016217         88  PS-TRAILER-CSR                   VALUE 'TRAILER'.    01621760
016219     05  PV-DOOR-TK-FIELD.                                        01621973
016220         10  PV-DOOR-1                  PIC X(04) VALUE SPACES.   01622074
016221         10  FILLER                     PIC X(01) VALUE SPACES.   01622173
016222         10  PV-TKID-1                  PIC X(07) VALUE SPACES.   01622274
016223         10  FILLER                     PIC X(01) VALUE SPACES.   01622373
016224         10  PV-DOOR-2                  PIC X(04) VALUE SPACES.   01622474
016225         10  FILLER                     PIC X(01) VALUE SPACES.   01622573
016226         10  PV-TKID-2                  PIC X(07) VALUE SPACES.   01622674
           05  PV-FUNC-QTY                     PIC  9(09)  VALUE ZEROES.01622794
           05  PV-FUNC-QTY-R REDEFINES PV-FUNC-QTY.                     01622894
               10  FILLER                      PIC  9(08).              01622994
               10  PV-FUNC-QTYX                PIC  X(01).              01623094
016227                                                                  01623173
016228******************************************************************01623273
016229**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01623373
016230**  THIS MUST BE THE EXACT SAME FORMAT AS BLOCK IN THE          **01623460
016240**  APPLICATION-SPECIFIC COMMAREA.                              **01624060
016250******************************************************************01625060
016260 01  LQW-LIST-QUEUE-WORK-AREA.                                    01626060
016270     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01627060
016280     05  LQW-ITEM-ENTRIES               OCCURS 12 TIMES           01628060
016290                                        INDEXED BY LQW-IDX.       01629060
016300         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01630060
016400         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01640060
016500         10  LQW-SELECTED-SW            PIC  X(01).               01650060
016600             88  LQW-SELECT                         VALUE 'S'.    01660060
016700             88  LQW-DESELECT                       VALUE ' '.    01670060
016800         10  LQW-ACTION                 PIC  X(03).               01680060
016900             88  LQW-ADD                            VALUE 'ADD'.  01690060
017000             88  LQW-INQ                            VALUE 'INQ'.  01700060
017100             88  LQW-UPD                            VALUE 'UPD'.  01710060
017200             88  LQW-ERR                            VALUE 'ERR'.  01720060
017300         10  LQW-PNA                    PIC  9(04).               01730060
017400         10  LQW-DOOR-CAPABLE           PIC  9(04).               01740060
017500         10  LQW-TRAILERS-ASSIGNED      PIC  9(04).               01750060
017600         10  LQW-ASSIGN-TMST            PIC  X(26).               01760060
017610         10  LQW-DOOR-TK-FIELD          PIC  X(25).               01761088
017700                                                                  01770060
017800*---------------------------------------------------------------* 01780060
017900* SELECTION QUEUE LAYOUT                                        * 01790060
018000*---------------------------------------------------------------* 01800060
018100     COPY SUWS088.                                                01810060
018200                                                                  01820060
018300*---------------------------------------------------------------* 01830060
018400*    MAP LAYOUT                                                 * 01840060
018500*---------------------------------------------------------------* 01850060
018600     COPY SUKM795.                                                01860060
018700*                                                                 01870060
018800 01  MR-OCCURS-LAYOUT                   REDEFINES  SUK795O.       01880060
018910     05  FILLER                         PIC X(111).               01891086
019000     05  MR-SCROLL-AREA                 OCCURS 12 TIMES.          01900060
019100         10  MR-SELECTL                 PIC S9(04) COMP.          01910060
019200         10  MR-SELECTA                 PIC  X(01).               01920060
019300         10  MR-SELECTC                 PIC  X(01).               01930060
019400         10  MR-SELECTH                 PIC  X(01).               01940060
019500         10  MR-SELECTI                 PIC  X(01).               01950060
019600                                                                  01960060
019700         10  MR-ACTIONL                 PIC S9(04) COMP.          01970060
019800         10  MR-ACTIONA                 PIC  X(01).               01980060
019900         10  MR-ACTIONC                 PIC  X(01).               01990060
020000         10  MR-ACTIONH                 PIC  X(01).               02000060
020100         10  MR-ACTION                  PIC  X(03).               02010060
020200                                                                  02020060
020300         10  MR-PNAL                   PIC S9(04) COMP.           02030060
020400         10  MR-PNAA                   PIC  X(01).                02040060
020500         10  MR-PNAC                   PIC  X(01).                02050060
020600         10  MR-PNAH                   PIC  X(01).                02060060
020700         10  MR-PNA                    PIC  Z(04).                02070060
020800                                                                  02080060
020900         10  MR-DOOR-CAPABLEL          PIC S9(04) COMP.           02090060
021000         10  MR-DOOR-CAPABLEA          PIC  X(01).                02100060
021100         10  MR-DOOR-CAPABLEC          PIC  X(01).                02110060
021200         10  MR-DOOR-CAPABLEH          PIC  X(01).                02120060
021300         10  MR-DOOR-CAPABLE           PIC  Z(04).                02130060
021400                                                                  02140060
021500         10  MR-TRAILERS-ASSIGNEDL     PIC S9(04) COMP.           02150060
021600         10  MR-TRAILERS-ASSIGNEDA     PIC  X(01).                02160060
021700         10  MR-TRAILERS-ASSIGNEDC     PIC  X(01).                02170060
021800         10  MR-TRAILERS-ASSIGNEDH     PIC  X(01).                02180060
021900         10  MR-TRAILERS-ASSIGNED      PIC  Z(04).                02190060
022000                                                                  02200060
022100         10  MR-ASSIGN-DATEL           PIC S9(04) COMP.           02210060
022200         10  MR-ASSIGN-DATEA           PIC  X(01).                02220060
022300         10  MR-ASSIGN-DATEC           PIC  X(01).                02230060
022400         10  MR-ASSIGN-DATEH           PIC  X(01).                02240060
022500         10  MR-ASSIGN-DATE            PIC  X(08).                02250060
022600                                                                  02260060
022700         10  MR-ASSIGN-TIMEL           PIC S9(04) COMP.           02270060
022800         10  MR-ASSIGN-TIMEA           PIC  X(01).                02280060
022900         10  MR-ASSIGN-TIMEC           PIC  X(01).                02290060
023000         10  MR-ASSIGN-TIMEH           PIC  X(01).                02300060
023100         10  MR-ASSIGN-TIME            PIC  X(08).                02310060
023200                                                                  02320060
023210         10  MR-DOORID-01L             PIC S9(04) COMP.           02321066
023220         10  MR-DOORID-01A             PIC  X(01).                02322066
023230         10  MR-DOORID-01C             PIC  X(01).                02323066
023240         10  MR-DOORID-01H             PIC  X(01).                02324066
023250         10  MR-DOORID-01              PIC  X(04).                02325066
023260                                                                  02326066
023270         10  MR-TKID-01L               PIC S9(04) COMP.           02327066
023280         10  MR-TKID-01A               PIC  X(01).                02328066
023290         10  MR-TKID-01C               PIC  X(01).                02329066
023291         10  MR-TKID-01H               PIC  X(01).                02329166
023292         10  MR-TKID-01                PIC  X(07).                02329266
023293                                                                  02329366
023294         10  MR-DOORID-02L             PIC S9(04) COMP.           02329466
023295         10  MR-DOORID-02A             PIC  X(01).                02329566
023296         10  MR-DOORID-02C             PIC  X(01).                02329666
023297         10  MR-DOORID-02H             PIC  X(01).                02329766
023298         10  MR-DOORID-02              PIC  X(04).                02329866
023299                                                                  02329966
023300         10  MR-TKID-02L               PIC S9(04) COMP.           02330066
023301         10  MR-TKID-02A               PIC  X(01).                02330166
023302         10  MR-TKID-02C               PIC  X(01).                02330266
023303         10  MR-TKID-02H               PIC  X(01).                02330366
023304         10  MR-TKID-02                PIC  X(07).                02330466
023305                                                                  02330566
023310     05  FILLER                         PIC  X(12).               02331067
023400                                                                  02340060
023500*----------------------------------------------------------------*02350060
023600*  SENDING/RECEIVING AREA FOR THE                                 02360060
023700*  PRINTER VALIDATION ROUTING (DPKCS060)                          02370060
023800*----------------------------------------------------------------*02380060
023900     COPY DPWS072.                                                02390060
024000                                                                  02400060
024100*---------------------------------------------------------------* 02410060
024200*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02420060
024300*---------------------------------------------------------------* 02430060
024400     COPY DPWS015.                                                02440060
024500                                                                  02450060
024600*---------------------------------------------------------------* 02460060
024700*    FUNCTION KEYS COPYBOOK.                                    * 02470060
024710*---------------------------------------------------------------* 02471060
024720     COPY DPWS016.                                                02472060
024730                                                                  02473060
024740*---------------------------------------------------------------* 02474060
024750*    NUMERIC EDIT LAYOUT.                                       * 02475060
024760*---------------------------------------------------------------* 02476060
024770     COPY DPWS010I.                                               02477060
024780                                                                  02478060
024790*---------------------------------------------------------------* 02479060
024800*    PARAMETERS FOR CALLING CICS ARCHITECTURE API               * 02480099
024900*---------------------------------------------------------------* 02490060
025000     COPY DPWS030.                                                02500060
025000     COPY DPWS930.                                                02501099
025100                                                                  02510060
025200*---------------------------------------------------------------* 02520060
025300*    STANDARD COMMAREA.                                         * 02530060
025400*---------------------------------------------------------------* 02540060
025500     COPY DPWS020.                                                02550060
025600     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02560060
025700                                                                  02570060
025800*---------------------------------------------------------------* 02580060
025900* INTER-APPLICATION COMMAREA.                                   * 02590060
026000*   SUWS087 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 02600060
026100*             SPEC SCREEN.                                      * 02610060
026200*   SUWS089 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 02620060
026300*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 02630060
026400*---------------------------------------------------------------* 02640060
026500         10  INTER-APPL-COMM-AREA       PIC X(200).               02650060
026600     COPY SUWS087.                                                02660060
026700     COPY SUWS089.                                                02670060
026800                                                                  02680060
026900*---------------------------------------------------------------* 02690060
027000*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02700060
027100*---------------------------------------------------------------* 02710060
027200         10  ASC-SPECIFIC-COMMAREA.                               02720060
027300             15  ASC-FUNCTION                 PIC  X(01).         02730060
027400             15  ASC-OPER-UNT-ID              PIC  9(04).         02740060
027500             15  ASC-FCLTY-NAME               PIC  X(25).         02750060
027600             15  ASC-ASSIGN-FROM-DATE         PIC  X(10).         02760060
027700             15  ASC-ASSIGN-TO-DATE           PIC  X(10).         02770060
027800             15  ASC-BLK-SUB                  PIC S9(04) COMP     02780060
027900                                                         SYNC.    02790060
028000             15  ASC-ITEM-SUB                 PIC S9(04) COMP     02800060
028100                                                         SYNC.    02810060
028200             15  ASC-NUMBER-OF-ITEMS-READ     PIC S9(09) COMP-3.  02820060
028300             15  ASC-NUMBER-OF-SELECTED-ITEMS PIC S9(09) COMP-3.  02830060
028400             15  ASC-ITEMS-DISPLAYED          PIC S9(03) COMP-3.  02840060
028500             15  ASC-ITEM-AT-TOP-OF-PANEL     PIC S9(09) COMP-3.  02850060
028600             15  ASC-ITEM-AT-BOT-OF-PANEL     PIC S9(09) COMP-3.  02860060
028700             15  ASC-HIGHEST-BLOCK-WRITTEN    PIC S9(04) COMP     02870060
028800                                                         SYNC.    02880060
028900             15  ASC-START-OF-SELECTED-RANGE  PIC S9(09) COMP-3.  02890060
029000             15  ASC-END-OF-SELECTED-RANGE    PIC S9(09) COMP-3.  02900060
029100             15  ASC-XCNTL-TO-RESEND-SW       PIC  X(01).         02910060
029200                 88  ASC-XCNTL-TO-RESEND           VALUE 'Y'.     02920060
029300                 88  ASC-XCNTL-TO-RESEND-NO        VALUE 'N'.     02930060
029400             15  ASC-ITEMS-LEFT-INDICATOR     PIC  X(01).         02940060
029500                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     02950060
029600                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     02960060
029700             15  ASC-TEMP-QUEUE-UPDATE-SW     PIC  X(01).         02970060
029800                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     02980060
029900                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     02990060
030000             15  ASC-LIST-QUEUE-NAME.                             03000060
030100                 20  ASC-LIST-TERM-ID         PIC  X(04).         03010060
030200                 20  ASC-LIST-TASK-NUMBER     PIC S9(05) COMP-3.  03020060
030300                 20  ASC-LIST-SEQ             PIC  9(01).         03030060
030400                                                                  03040060
030500             15  ASC-START-ITEM-REQUEST.                          03050060
030600                 20  ASC-START-ITEM-REQUEST-N PIC  9(05).         03060060
030700                                                                  03070060
030800             15  ASC-SEL-SUB                  PIC S9(4) COMP.     03080060
030900             15  ASC-SEL-ITEM                 PIC S9(4) COMP.     03090060
031000             15  ASC-CURSOR-SW                PIC  X(02).         03100060
031100                 88  ASC-NO-CURSOR                   VALUE 'Z '.  03110060
031200                 88  ASC-DOOR-TYPE-CSR               VALUE 'A '.  03120060
031300             15  ASC-STORE-SW                 PIC  X(01).         03130060
031400                 88  ASC-LIST-BY-STORE               VALUE 'S'.   03140060
031500                 88  ASC-LIST-BY-DOOR                VALUE 'D'.   03150060
031600                                                                  03160060
031700             15  ASC-USE-SELECTION-QUEUE-IND  PIC  X(1).          03170060
031800                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 03180060
031900             15  ASC-SEL-QUEUE-NAME.                              03190060
032000                 20  ASC-SEL-TERM-ID          PIC  X(04).         03200060
032100                 20  ASC-SEL-TASK-NUMBER      PIC S9(05) COMP-3.  03210060
032200                 20  ASC-SEL-SEQ              PIC  9(01).         03220060
032300                                                                  03230060
032400             15  ASC-NUMBER-OF-TS-ITEMS       PIC S9(09) COMP-3.  03240060
032500                                                                  03250060
032600*-----------------------------------------------------------------03260060
032700             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03270060
032800                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03280060
032900                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03290060
033000                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03300060
033100                                                                  03310060
033200                 20  ASC-ITEM-ARRAY.                              03320060
033300                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.        03330060
033400                         30  ASC-LIST-ITEM-NUMBER                 03340060
033500                                                     PIC S9(09)   03350060
033600                                                     COMP-3.      03360060
033700                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03370060
033800                             88  ASC-VALID-SELECT    VALUE ' '    03380060
033900                                                           'S'    03390060
034000                                                           'B'    03400060
034100                                                           'E'.   03410060
034200                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03420060
034300                             88  ASC-TEMP-SELECT     VALUE 'S'.   03430060
034400                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03440060
034500                             88  ASC-TEMP-END        VALUE 'E'.   03450060
034600                         30  ASC-SELECTED-SW         PIC  X(01).  03460060
034700                             88  ASC-NO-SELECT       VALUE ' '.   03470060
034800                             88  ASC-SELECT          VALUE 'S'.   03480060
034900                             88  ASC-BEGIN           VALUE 'B'.   03490060
035000                             88  ASC-END             VALUE 'E'.   03500060
035100                         30  ASC-ACTION              PIC  X(03).  03510060
035200                         30  ASC-PNA-STA-NBR         PIC  9(04).  03520060
035300                         30  ASC-DOOR-CAPABLE        PIC  9(04).  03530060
035400                         30  ASC-TRAILERS-ASSIGNED   PIC  9(04).  03540060
035500                         30  ASC-ASSIGN-TMST         PIC  X(26).  03550060
035510                         30  ASC-DOOR-TK-FIELD       PIC  X(25).  03551088
035600                                                                  03560060
035700*---------------------------------------------------------------* 03570060
035800*    ABEND PROCESSING COPYBOOK.                                 * 03580060
035900*---------------------------------------------------------------* 03590060
036000     COPY DPWS013.                                                03600060
036100                                                                  03610060
036200*----------------------------------------------------------------*03620060
036300*    DB2 TABLE FOR PRINT AND APPLY STATION                        03630060
036400*----------------------------------------------------------------*03640060
036500     EXEC SQL                                                     03650060
036600          INCLUDE SUT00107                                        03660060
036700     END-EXEC.                                                    03670060
036800                                                                  03680060
036900*---------------------------------------------------------------* 03690060
037000*    DB2 TABLE FOR PRINT AND APPLY STATION DOOR                   03700060
037100*---------------------------------------------------------------* 03710060
037200     EXEC SQL                                                     03720060
037300          INCLUDE SUT00109                                        03730060
037400     END-EXEC.                                                    03740060
037500/                                                                 03750075
037600*---------------------------------------------------------------* 03760060
037700*    DB2 TABLE FOR PRINT AND APPLY STATION DOOR TRIP ASSIGNMENT   03770060
037800*---------------------------------------------------------------* 03780060
037900     EXEC SQL                                                     03790060
038000          INCLUDE SUT00110                                        03800060
038100     END-EXEC.                                                    03810060
038101/                                                                 03810175
038110*---------------------------------------------------------------* 03811075
038120*    DB2 TABLE FOR PRINT AND APPLY STATION WORKER ASSIGNMENT      03812075
038130*---------------------------------------------------------------* 03813075
038140     EXEC SQL                                                     03814075
038150          INCLUDE SUT00111                                        03815075
038160     END-EXEC.                                                    03816075
                                                                        03816195
      *CLP 04-07-17                                                     03817095
051100*----------------------------------------------------------------*03818095
051200*    DB2 TABLE FOR PARM TABLE                                     03819095
051300*----------------------------------------------------------------*03819195
040470*  PARM TABLE                                                     03819295
040480     EXEC SQL                                                     03819395
040490          INCLUDE TKRPRPM                                         03819495
040500     END-EXEC.                                                    03819595
038200/                                                                 03820075
038300*---------------------------------------------------------------* 03830060
038400*    DOOR CAPABLE CURSOR - HOW MANY DOORS CAN A PRINT AND         03840060
038500*         APPLY STATION HANDLE                                    03850060
038600*---------------------------------------------------------------* 03860060
038700     EXEC SQL                                                     03870060
038800        DECLARE DOOR-CAPABLE-CSR CURSOR FOR                       03880060
038900          SELECT COUNT(*)                                         03890060
039000                ,S107.OPER_UNT_ID                                 03900060
039100                ,S107.ACM_LBL_STA_NBR                             03910060
039200                                                                  03920060
039300           FROM  SUT_PNA_STA       S107                           03930060
039400              ,  SUT_PNA_STA_DOOR  S109                           03940060
039500          WHERE  S107.OPER_UNT_ID     = :DK-OPER-UNT-ID           03950060
039600            AND  S107.OPER_UNT_ID     = S109.OPER_UNT_ID          03960060
039700            AND  S107.ACM_LBL_STA_NBR = S109.ACM_LBL_STA_NBR      03970060
039800       GROUP BY  S107.OPER_UNT_ID                                 03980060
039900                ,S107.ACM_LBL_STA_NBR                             03990060
040000                                                                  04000060
040100     END-EXEC.                                                    04010060
042070                                                                  04207017
042071*---------------------------------------------------------------* 04207117
042072*    TRAILERS CURRENTLY ASSIGNED CURSOR                           04207217
042074*---------------------------------------------------------------* 04207417
042075     EXEC SQL                                                     04207517
042076        DECLARE TRAILERS-ASSIGNED-CSR CURSOR FOR                  04207619
042077          SELECT COUNT(*)                                         04207717
042078                ,S107.OPER_UNT_ID                                 04207817
042079                ,S107.ACM_LBL_STA_NBR                             04207917
042080                                                                  04208017
042081           FROM  SUT_PNA_STA        S107                          04208117
042082              ,  SUT_PNA_TRIP_ASGMT S110                          04208217
042083          WHERE  S107.OPER_UNT_ID     = :DK-OPER-UNT-ID           04208328
042084            AND  S107.ACM_LBL_STA_NBR = :DK-ACM-LBL-STA-NBR       04208428
042085            AND  S110.ASGD_END_TMST   = :PC-DEFAULT-TIMESTAMP     04208528
042086            AND  S107.OPER_UNT_ID     = S110.OPER_UNT_ID          04208628
042087            AND  S107.ACM_LBL_STA_NBR = S110.ACM_LBL_STA_NBR      04208728
042088       GROUP BY  S107.OPER_UNT_ID                                 04208817
042089                ,S107.ACM_LBL_STA_NBR                             04208917
042090                                                                  04209017
042091     END-EXEC.                                                    04209117
042092/                                                                 04209267
042093*---------------------------------------------------------------* 04209367
042094* DOORS ASSIGNED CURSOR                                           04209467
042095*---------------------------------------------------------------* 04209567
042096     EXEC SQL                                                     04209667
042097        DECLARE DOOR-ID-CSR CURSOR FOR                            04209773
042098          SELECT DOOR_ID                                          04209867
042099            FROM SUT_PNA_STA_DOOR                                 04209968
042101            WHERE OPER_UNT_ID      = :DK-OPER-UNT-ID              04210171
042102             AND  ACM_LBL_STA_NBR  = :DK-ACM-LBL-STA-NBR          04210267
042111                                                                  04211167
042112     END-EXEC.                                                    04211267
042113/                                                                 04211367
042114*---------------------------------------------------------------* 04211417
042120*    DB2 AREA FOR COMMUNICATIONS                                * 04212002
042200*---------------------------------------------------------------* 04220002
042300     EXEC SQL                                                     04230002
042400          INCLUDE SQLCA                                           04240002
042500     END-EXEC.                                                    04250002
042600                                                                  04260002
042700***************************************************************** 04270002
042800 LINKAGE SECTION.                                                 04280002
042900                                                                  04290002
043000 01  DFHCOMMAREA.                                                 04300002
043100     05  FILLER                         OCCURS  1 TO 4072 TIMES   04310002
043200                                        DEPENDING ON EIBCALEN.    04320002
043210         10  FILLER                     PIC X.                    04321002
043220                                                                  04322002
043230                                                                  04323002
043240 PROCEDURE DIVISION.                                              04324002
043250******************************************************************04325002
043260**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **04326002
043270**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **04327002
043280**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **04328002
043290******************************************************************04329002
043300 0000-MAIN-MODULE.                                                04330002
043400     INITIALIZE DP030-CICS-API-FIELDS.                            04340002
043500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04350002
043600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04360002
043700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04370002
043800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04380002
043900     MOVE LENGTH OF SUK795I        TO DP030-MAP-LENGTH (1).       04390002
044000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04400002
044100     PERFORM 0001-CALL-CICS-ARCH-API.                             04410002
044200*                                                                 04420002
044300     PERFORM 1000-CONTROL-PROCESSING                              04430002
044400*                                                                 04440002
044500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04450002
044600     PERFORM 0001-CALL-CICS-ARCH-API.                             04460002
044700                                                                  04470002
044800******************************************************************04480002
044900**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **04490002
045000**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **04500002
045100******************************************************************04510002
045200 0001-CALL-CICS-ARCH-API.                                         04520002
045300*    CALL 'DPKCS030' USING DFHEIBLK                               04530099
045300     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04531099
045400                           DFHCOMMAREA                            04540002
045500                           DP030-CICS-API-FIELDS                  04550002
045600                           DP020-STANDARD-COMMAREA                04560002
045700                           SUK795I.                               04570002
045800*                                                                 04580002
045900     IF  DP030-RC-CALL-SUCCESSFUL                                 04590002
046000         CONTINUE                                                 04600002
046100     ELSE                                                         04610002
046200         SET DP013-NO-ROLLBACK                                    04620002
046300             DP013-XCTL-DISPLAY-RESTART                           04630002
046400             DP013-CICS-ABEND      TO TRUE                        04640002
046500         MOVE '0001-CALL-CICS-ARCH-API'                           04650002
046600                                   TO DP013-PARAGRAPH             04660002
046700*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX04670099
046800*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      04680099
046700         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04681099
046800-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04682099
046900         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04690002
047000         PERFORM DP013-0000-PROCESS-ABEND                         04700002
047100     END-IF.                                                      04710002
047200                                                                  04720002
047300*----------------------------------------------------------------*04730002
047400* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *04740002
047500* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04750002
047600*                                                                *04760002
047700* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *04770002
047800*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *04780002
047900*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *04790002
048000*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *04800002
048100*----------------------------------------------------------------*04810002
048200 1000-CONTROL-PROCESSING.                                         04820002
048300     EVALUATE TRUE                                                04830002
048400         WHEN DP020-NEXT-ACT-INITIAL                              04840002
048500             INITIALIZE ASC-SPECIFIC-COMMAREA                     04850002
048600             MOVE EIBTRMID    TO ASC-LIST-TERM-ID                 04860002
048700                                 ASC-SEL-TERM-ID                  04870002
048800             MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER   04880002
048900                                           ASC-SEL-TASK-NUMBER    04890002
049000             MOVE PC-LIST-QUEUE-SEQ TO ASC-LIST-SEQ               04900002
049100             MOVE PC-SEL-QUEUE-SEQ  TO ASC-SEL-SEQ                04910002
049200             PERFORM 1100-PROCESS-INTER-APPL-COMM                 04920002
049300             MOVE ASC-PNA-STA-NBR (1 1)  TO  DK-DOOR-ID           04930032
049400             MOVE ASC-DOOR-CAPABLE (1 1) TO DK-TYPE-CODE          04940003
049500             PERFORM 4000-BUILD-INITIAL-PANEL                     04950019
049600                                                                  04960002
049700         WHEN DP020-NEXT-ACT-READ-MAP                             04970002
049800             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         04980002
049900             PERFORM 2000-PROCESS-PANEL                           04990002
050000                                                                  05000002
050100         WHEN DP020-NEXT-ACT-RETURN                               05010002
050200             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         05020002
050300             MOVE ZERO  TO ASC-ITEM-AT-TOP-OF-PANEL               05030002
050400             MOVE SPACES               TO  DK-DOOR-ID             05040002
050500             MOVE SPACES               TO  DK-TYPE-CODE           05050002
050600             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 05060002
050700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05070002
050800                                                                  05080002
050900         WHEN OTHER                                               05090002
051000             SET DP013-LOGIC-ABEND TO TRUE                        05100002
051100             SET DP013-NO-ROLLBACK TO TRUE                        05110002
051200             MOVE '1000-CONTROL-PROCESSING' TO DP013-PARAGRAPH    05120002
051300             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05130002
051310                                   TO DP013-MESSAGE-TEXT(1)       05131002
051320             PERFORM DP013-0000-PROCESS-ABEND                     05132002
051330     END-EVALUATE.                                                05133002
051340                                                                  05134002
051350*----------------------------------------------------------------*05135002
051360* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *05136002
051370* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *05137002
051380*----------------------------------------------------------------*05138002
051390 1100-PROCESS-INTER-APPL-COMM.                                    05139002
051400                                                                  05140002
051500     SET PS-COMMAREA-VALID         TO TRUE.                       05150002
051600     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     05160002
051700                                                                  05170002
051800     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          05180002
051900         MOVE SU087-OPER-UNT-ID        TO ASC-OPER-UNT-ID         05190002
052000         MOVE SU087-FCLTY-NME          TO ASC-FCLTY-NAME          05200002
052112         MOVE SU087-ASSIGN-FROM-DATE   TO ASC-ASSIGN-FROM-DATE    05211259
052120         MOVE SU087-ASSIGN-TO-DATE     TO ASC-ASSIGN-TO-DATE      05212058
052200     ELSE                                                         05220002
052300         MOVE SU087-OPER-UNT-ID        TO ASC-OPER-UNT-ID         05230002
052400     END-IF.                                                      05240002
052500                                                                  05250002
052600*----------------------------------------------------------------*05260002
052700* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *05270002
052800* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *05280002
052900* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *05290002
053000* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *05300002
053100* FUNCTION KEYS CAN GET THIS FAR.                                *05310002
053200*----------------------------------------------------------------*05320002
053300 2000-PROCESS-PANEL.                                              05330002
053400     EVALUATE TRUE                                                05340002
053500         WHEN DP020-SRC-AID = DP016-CLEAR                         05350002
053600             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                05360002
053700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05370002
053800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05380002
053900                                                                  05390002
054000         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05400002
054100             PERFORM 2050-DELETE-LIST-QUEUE                       05410002
054200             EVALUATE TRUE                                        05420002
054300                WHEN ASC-DOOR-TYPE-CSR                            05430002
054400                     MOVE SPACES              TO DK-TYPE-CODE     05440002
054500                                                 DK-DOOR-ID       05450002
054600             END-EVALUATE                                         05460002
054700             PERFORM 4000-BUILD-INITIAL-PANEL                     05470002
054800                                                                  05480002
054900         WHEN DP020-FK-DESELECT (DP020-SRC-AID)                   05490002
055000             PERFORM 2140-DESELECT-ALL-ITEMS                      05500002
055100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05510002
055200                                                                  05520002
055300         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  05530002
055400             PERFORM 2150-SELECT-ALL-ITEMS                        05540002
055500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05550002
055600                                                                  05560002
055700         WHEN OTHER                                               05570002
055800             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05580002
055900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05590002
056000             IF  PS-NO-ERROR                                      05600002
056100                 SET DP030-CONTINUE-GO TO TRUE                    05610002
056200                 PERFORM 2100-CHECK-FUNCTION-KEY                  05620002
056300             ELSE                                                 05630002
056400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05640002
056500                 SET DP030-OVERRIDE-GO TO TRUE                    05650002
056600             END-IF                                               05660002
056700     END-EVALUATE.                                                05670002
056800                                                                  05680002
056900*----------------------------------------------------------------*05690002
057000*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *05700002
057100*----------------------------------------------------------------*05710002
057200 2050-DELETE-LIST-QUEUE.                                          05720002
057300                                                                  05730002
057400     EXEC CICS                                                    05740002
057500         DELETEQ TS                                               05750002
057600             QUEUE (ASC-LIST-QUEUE-NAME)                          05760002
057700             RESP  (PV-CICS-RESP)                                 05770002
057800     END-EXEC.                                                    05780002
057900                                                                  05790002
058000     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       05800002
058100        (PV-CICS-RESP = DFHRESP(QIDERR))                          05810002
058200         CONTINUE                                                 05820002
058300     ELSE                                                         05830002
058400         SET DP013-CICS-ABEND      TO TRUE                        05840002
058500         SET DP013-NO-ROLLBACK     TO TRUE                        05850002
058600                                                                  05860002
058700         MOVE '2050-DELETE-LIST-QUEUE' TO DP013-PARAGRAPH         05870002
058800         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    05880002
058900                                   TO DP013-MESSAGE-TEXT (1)      05890002
059000         PERFORM DP013-0000-PROCESS-ABEND                         05900002
059100     END-IF.                                                      05910002
059200                                                                  05920002
059300     MOVE +0  TO ASC-HIGHEST-BLOCK-WRITTEN.                       05930002
059400                                                                  05940002
059500*----------------------------------------------------------------*05950002
059600* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*05960002
059700* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *05970002
059800* CICS ARCHITECTURE API.                                         *05980002
059900*----------------------------------------------------------------*05990002
060000 2100-CHECK-FUNCTION-KEY.                                         06000002
060100                                                                  06010002
060200     EVALUATE TRUE                                                06020002
060300                                                                  06030002
060400* F23 -  INQ/UPD (LOCAL-FUNC-01) SUKCS796 - DETAIL                06040031
060500*                PRINT AND APPLY ASSIGN / LOGIN                   06050002
060600         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              06060002
060700             MOVE DP020-LOCATION-NBR TO DK-OPER-UNT-ID            06070002
060800*            IF ASC-OPER-UNT-ID = DK-OPER-UNT-ID                  06080064
060900                 IF ASC-NUMBER-OF-SELECTED-ITEMS > 0              06090002
061000                     SET ASC-USE-SELECTION-QUEUE TO TRUE          06100002
061100                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            06110002
061200                                TO SU089-NUMBER-OF-SELECTED-ITEMS 06120002
061300                     MOVE ASC-NUMBER-OF-TS-ITEMS                  06130002
061400                                      TO SU089-NUMBER-OF-TS-ITEMS 06140002
061500                     MOVE ASC-SEL-QUEUE-NAME                      06150002
061600                                         TO  SU089-SEL-QUEUE-NAME 06160002
061700                     MOVE DP020-LOCATION-NBR TO DK-OPER-UNT-ID    06170002
061800                     MOVE ASC-OPER-UNT-ID  TO SU089-OPER-UNT-ID   06180002
061810                     MOVE ASC-FCLTY-NAME   TO SU089-FCLTY-NME     06181047
061900                     MOVE 1                TO SU089-FCLTY-ID      06190055
062001                     MOVE ASC-ASSIGN-FROM-DATE TO                 06200156
062010                                          SU089-ASSIGN-FROM-DATE  06201055
062020                     MOVE ASC-ASSIGN-TO-DATE TO                   06202055
062030                                          SU089-ASSIGN-TO-DATE    06203055
062100                     PERFORM 5000-PREPARE-SEL-QUEUE               06210002
062200                 ELSE                                             06220002
062300                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         06230002
062400                     SET DP030-OVERRIDE-GO TO TRUE                06240002
062500                     MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER    06250002
062600                     SET DP020-MSG-FATAL   TO TRUE                06260002
062700                 END-IF                                           06270002
062800*            ELSE                                                 06280064
062900*                PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06290064
063000*                SET DP030-OVERRIDE-GO TO TRUE                    06300064
063100*                MOVE PC-TSYMSG-02571  TO DP020-MSG-NUMBER        06310064
063200*                SET PS-ERROR                                     06320064
063300*                    DP020-MSG-FATAL   TO TRUE                    06330064
063400*            END-IF                                               06340064
063500                                                                  06350002
063600* F17 -  INQUIRY / UPDATE (LOCAL-FUNC-02)                         06360002
063700         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              06370002
063800               MOVE SPACE TO ASC-FUNCTION                         06380002
063900               PERFORM 2110-PREPARE-INTER-APPL-COMM               06390002
064000                                                                  06400002
064100* F22 -  UNASSIGN (LOCAL-FUNC-03)                                 06410002
064200         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              06420002
064300             PERFORM 2050-DELETE-LIST-QUEUE                       06430002
064500             PERFORM 4000-BUILD-INITIAL-PANEL                     06450002
064600                                                                  06460002
064700* F6 - FIRST PAGE                                                 06470002
064800         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  06480002
064900             MOVE +1               TO PV-TOP-ITEM                 06490002
065000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06500002
065100                                                                  06510002
065200* F7 - PREVIOUS PAGE                                              06520002
065300         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   06530002
065400             PERFORM 2110-BROWSE-BACKWARD                         06540002
065500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06550002
065600                                                                  06560002
065700* F8 - NEXT PAGE                                                  06570002
065800         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   06580002
065900             PERFORM 2120-BROWSE-FORWARD                          06590002
066000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06600002
066100                                                                  06610002
066200* ENTER KEY                                                       06620002
066300         WHEN DP020-SRC-AID = DP016-ENTER                         06630002
066400             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   06640002
066500             IF  PS-ERROR                                         06650002
066600                 CONTINUE                                         06660002
066700             ELSE                                                 06670002
066800                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06680002
066900             END-IF                                               06690002
067000                                                                  06700002
067100         WHEN OTHER                                               06710002
067200             SET DP013-NO-ROLLBACK                                06720002
067300                 DP013-XCTL-DISPLAY-RESTART                       06730002
067400                 DP013-CICS-ABEND  TO TRUE                        06740002
067500             MOVE '2100-CHECK-FUNCTION-KEY' TO DP013-PARAGRAPH    06750002
067600             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      06760002
067700                                   TO DP013-MESSAGE-TEXT (1)      06770002
067800             PERFORM DP013-0000-PROCESS-ABEND                     06780002
067900     END-EVALUATE.                                                06790002
068000                                                                  06800002
068100******************************************************************06810002
068200** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **06820002
068300** INTER-APPLICATION COMMAREA.                                  **06830002
068400******************************************************************06840002
068500 2110-PREPARE-INTER-APPL-COMM.                                    06850002
068600                                                                  06860002
068700     INITIALIZE SU087-INTER-APPL-COMMAREA.                        06870002
068800                                                                  06880002
068900     MOVE DP020-LOCATION-NBR       TO DK-OPER-UNT-ID.             06890002
069000     MOVE ASC-OPER-UNT-ID          TO SU087-OPER-UNT-ID.          06900002
069100     MOVE ASC-FCLTY-NAME           TO SU087-FCLTY-NME.            06910002
069200                                                                  06920002
069300*----------------------------------------------------------------*06930002
069310*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *06931002
069320*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *06932002
069330*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *06933002
069340*    MESSAGE.                                                    *06934002
069350*----------------------------------------------------------------*06935002
069360 2110-BROWSE-BACKWARD.                                            06936002
069370     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    06937002
069380         GIVING PV-TOP-ITEM.                                      06938002
069390*                                                                 06939002
069400     IF  ((PV-TOP-ITEM < +1)                                      06940002
069500       OR (PV-TOP-ITEM = +1))                                     06950002
069600         MOVE +1                   TO PV-TOP-ITEM                 06960002
069700*        -- TOP OF LIST --                                        06970002
069800         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            06980002
069900         SET DP020-MSG-INFORMATIONAL TO TRUE                      06990002
070000     END-IF.                                                      07000002
070100                                                                  07010002
070200*----------------------------------------------------------------*07020002
070300*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *07030002
070400*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *07040002
070500*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *07050002
070600*----------------------------------------------------------------*07060002
070700 2120-BROWSE-FORWARD.                                             07070002
070800     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07080002
070900         GIVING PV-TOP-ITEM.                                      07090002
071000     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07100002
071100         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             07110002
071200*        -- BOTTOM OF LIST --                                     07120002
071300         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07130002
071400         SET DP020-MSG-INFORMATIONAL TO TRUE                      07140002
071500     ELSE                                                         07150002
071600         COMPUTE PV-BOTTOM-ITEM =                                 07160002
071700             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07170002
071800         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07180002
071900*            -- BOTTOM OF LIST --                                 07190002
072000             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07200002
072100             SET DP020-MSG-INFORMATIONAL TO TRUE                  07210002
072200         END-IF                                                   07220002
072300     END-IF.                                                      07230002
072400                                                                  07240002
072500*----------------------------------------------------------------*07250002
072600*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *07260002
072700*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *07270002
072800*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *07280002
072900*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *07290002
073000*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *07300002
073100*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *07310002
073200*----------------------------------------------------------------*07320002
073300 2130-CHECK-FOR-JUMP-BROWSE.                                      07330002
073400     SET PS-NO-ERROR               TO TRUE.                       07340002
073500     IF (ASC-START-ITEM-REQUEST = SPACE)                          07350002
073600         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             07360002
073700     ELSE                                                         07370002
073800         MOVE ASC-START-ITEM-REQUEST TO DP010I-UNEDITED-FIELD     07380002
073900         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       07390002
074000         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     07400002
074100         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  07410002
263968         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07421099
263968              USING DP010I-NUMERIC-EDIT-AREA                      07422099
074300                                                                  07430002
074400         IF  NOT DP010I-ERROR-DETECTED                            07440002
074500             MOVE DP010I-NUMERIC-FIELD TO ASC-START-ITEM-REQUEST-N07450002
074600             IF  ASC-START-ITEM-REQUEST-N > ZERO                  07460002
074700                 IF  ASC-START-ITEM-REQUEST-N >                   07470002
074800                                          ASC-NUMBER-OF-ITEMS-READ07480002
074900                     MOVE SPACE TO ASC-START-ITEM-REQUEST         07490002
075000                     COMPUTE PV-TOP-ITEM =                        07500002
075100                             ASC-NUMBER-OF-ITEMS-READ             07510002
075200                             - PC-ITEMS-PER-PANEL + 1             07520002
075300                     IF  PV-TOP-ITEM < +1                         07530002
075400                         MOVE +1   TO PV-TOP-ITEM                 07540002
075500                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 07550002
075600                         SET DP020-MSG-INFORMATIONAL TO TRUE      07560002
075700                     END-IF                                       07570002
075800                 ELSE                                             07580002
075900                     MOVE ASC-START-ITEM-REQUEST-N                07590002
076000                                   TO PV-TOP-ITEM                 07600002
076100                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      07610002
076200                     COMPUTE PV-BOTTOM-ITEM =                     07620002
076300                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     07630002
076400                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ07640002
076500*                        -- BOTTOM OF LIST --                     07650002
076600                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 07660002
076700                         SET DP020-MSG-INFORMATIONAL TO TRUE      07670002
076800                     END-IF                                       07680002
076900                 END-IF                                           07690002
077000             ELSE                                                 07700002
077100*                --- VALUE OUT OF RANGE ----                      07710002
077200                 MOVE PC-TSYMSG-00101 TO DP020-MSG-NUMBER         07720002
077300                 MOVE -1              TO ASTRTITL                 07730002
077400                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              07740002
077500                 MOVE DP015-REVERSE   TO ASTRTITH                 07750002
077600                 MOVE DP015-RED       TO ASTRTITC                 07760002
077700                 MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA           07770002
077800                 SET DP020-MSG-FATAL  TO TRUE                     07780002
077900                 SET PS-ERROR         TO TRUE                     07790002
078000             END-IF                                               07800002
078100         ELSE                                                     07810002
078200             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07820002
078300             MOVE -1               TO ASTRTITL                    07830002
078400             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07840002
078500             MOVE DP015-REVERSE    TO ASTRTITH                    07850002
078600             MOVE DP015-RED        TO ASTRTITC                    07860002
078700             MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA               07870002
078800             SET DP020-MSG-FATAL   TO TRUE                        07880002
078900             SET PS-ERROR          TO TRUE                        07890002
079000         END-IF                                                   07900002
079100     END-IF.                                                      07910002
079200                                                                  07920002
079300*----------------------------------------------------------------*07930002
079400*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *07940002
079500*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *07950002
079600*----------------------------------------------------------------*07960002
079700 2140-DESELECT-ALL-ITEMS.                                         07970002
079800     MOVE +1                       TO ASC-BLK-SUB.                07980002
079900                                                                  07990002
080000     PERFORM 2141-CLEAR-SELECTED-INDS                             08000002
080100         VARYING ASC-ITEM-SUB                                     08010002
080200         FROM 1 BY 1                                              08020002
080300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08030002
080400                                                                  08040002
080500     ADD +1                        TO ASC-BLK-SUB.                08050002
080600                                                                  08060002
080700     PERFORM 2141-CLEAR-SELECTED-INDS                             08070002
080800         VARYING ASC-ITEM-SUB                                     08080002
080900         FROM 1 BY 1                                              08090002
081000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08100002
081100                                                                  08110002
081200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               08120002
081300                                   TO PV-LIST-ITEM-NUMBER.        08130002
081400                                                                  08140002
081500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            08150002
081600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    08160002
081700                                                                  08170002
081800     IF  PV-FIRST-BLOCK-IN-ARRAY  = +1                            08180002
081900         MOVE +1                   TO ASC-BLK-SUB                 08190002
082000                                                                  08200002
082100         PERFORM 5100-WRITE-TEMP-STORAGE                          08210002
082200         MOVE +2                   TO ASC-BLK-SUB                 08220002
082300         PERFORM 5100-WRITE-TEMP-STORAGE                          08230002
082400         MOVE +1                   TO ASC-BLK-SUB                 08240002
082500         MOVE +1                   TO PV-BLOCK-NUMBER             08250002
082600     END-IF.                                                      08260002
082700                                                                  08270002
082800     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     08280002
082900        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      08290002
083000         MOVE +1                   TO ASC-BLK-SUB                 08300002
083100                                                                  08310002
083200         PERFORM 5100-WRITE-TEMP-STORAGE                          08320002
083300         MOVE +2  TO ASC-BLK-SUB                                  08330002
083400         PERFORM 5100-WRITE-TEMP-STORAGE                          08340002
083500         MOVE +1  TO ASC-BLK-SUB                                  08350002
083600         MOVE +1  TO PV-BLOCK-NUMBER                              08360002
083700                                                                  08370002
083800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         08380002
083900             PV-FIRST-BLOCK-IN-ARRAY - 1                          08390002
084000                                                                  08400002
084100         PERFORM                                                  08410002
084200             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       08420002
084300                                                                  08430002
084400             PERFORM 4410-READ-TEMP-STORAGE                       08440002
084500                                                                  08450002
084600             PERFORM 2141-CLEAR-SELECTED-INDS                     08460002
084700                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 08470002
084800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08480002
084900                                                                  08490002
085000             PERFORM 5100-WRITE-TEMP-STORAGE                      08500002
085100                                                                  08510002
085200             ADD +1                TO PV-BLOCK-NUMBER             08520002
085300                                                                  08530002
085400         END-PERFORM                                              08540002
085500                                                                  08550002
085600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         08560002
085700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     08570002
085800                                                                  08580002
085900         PERFORM                                                  08590002
086000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       08600002
086100                   ASC-HIGHEST-BLOCK-WRITTEN                      08610002
086200                                                                  08620002
086300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          08630002
086400                                   TO PV-BLOCK-NUMBER             08640002
086500                                                                  08650002
086600             PERFORM 4410-READ-TEMP-STORAGE                       08660002
086700                                                                  08670002
086800             PERFORM 2141-CLEAR-SELECTED-INDS                     08680002
086900                 VARYING ASC-ITEM-SUB                             08690002
087000                 FROM 1 BY 1                                      08700002
087100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08710002
087200                                                                  08720002
087300             PERFORM 5100-WRITE-TEMP-STORAGE                      08730002
087400                                                                  08740002
087500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      08750002
087600                                                                  08760002
087700         END-PERFORM                                              08770002
087800                                                                  08780002
087900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             08790002
088000                                   TO PV-BLOCK-NUMBER             08800002
088100                                                                  08810002
088200         PERFORM 4410-READ-TEMP-STORAGE                           08820002
088300     END-IF.                                                      08830002
088400                                                                  08840002
088500     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 08850002
088600     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.08860002
088700     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  08870002
088800                                                                  08880002
088900     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        08890002
089000                                                                  08900002
089100*----------------------------------------------------------------*08910002
089200*    MARK EACH ITEM AS BEING NOT SELECTED.                       *08920002
089300*----------------------------------------------------------------*08930002
089400 2141-CLEAR-SELECTED-INDS.                                        08940002
089500     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           08950002
089600             NOT EQUAL ZERO                                       08960002
089700         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          08970002
089800             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          08980002
089900                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    08990002
090000                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE          09000002
090100         END-IF                                                   09010002
090200     END-IF.                                                      09020002
090300                                                                  09030002
090400*----------------------------------------------------------------*09040002
090500*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTION SWITCH *09050002
090600*  FOR ALL ITEMS.                                                *09060002
090700*----------------------------------------------------------------*09070002
090800 2150-SELECT-ALL-ITEMS.                                           09080002
090900     MOVE +1                       TO ASC-BLK-SUB.                09090002
091000                                                                  09100002
091100     PERFORM 2151-SET-SELECTED-INDS                               09110002
091200         VARYING ASC-ITEM-SUB                                     09120002
091300         FROM 1 BY 1                                              09130002
091400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09140002
091500                                                                  09150002
091600     ADD +1                        TO ASC-BLK-SUB.                09160002
091700                                                                  09170002
091800     PERFORM 2151-SET-SELECTED-INDS                               09180002
091900         VARYING ASC-ITEM-SUB                                     09190002
092000         FROM 1 BY 1                                              09200002
092100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09210002
092200                                                                  09220002
092300     MOVE ASC-LIST-ITEM-NUMBER(1 1)  TO PV-LIST-ITEM-NUMBER.      09230002
092400                                                                  09240002
092500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09250002
092600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09260002
092700                                                                  09270002
092800     IF  PV-FIRST-BLOCK-IN-ARRAY  = +1                            09280002
092900         MOVE +1                   TO ASC-BLK-SUB                 09290002
093000                                                                  09300002
093100         PERFORM 5100-WRITE-TEMP-STORAGE                          09310002
093200         MOVE +2                   TO ASC-BLK-SUB                 09320002
093300         PERFORM 5100-WRITE-TEMP-STORAGE                          09330002
093400         MOVE +1                   TO ASC-BLK-SUB                 09340002
093500         MOVE +1                   TO PV-BLOCK-NUMBER             09350002
093600     END-IF.                                                      09360002
093700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09370002
093800        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    09380002
093900         MOVE +1                   TO ASC-BLK-SUB                 09390002
094000                                                                  09400002
094100         PERFORM 5100-WRITE-TEMP-STORAGE                          09410002
094200                                                                  09420002
094300         MOVE +1                   TO PV-BLOCK-NUMBER             09430002
094400                                                                  09440002
094500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09450002
094600             PV-FIRST-BLOCK-IN-ARRAY - 1                          09460002
094700                                                                  09470002
094800         PERFORM                                                  09480002
094900             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09490002
095000                                                                  09500002
095100             PERFORM 4410-READ-TEMP-STORAGE                       09510002
095200                                                                  09520002
095300             PERFORM 2151-SET-SELECTED-INDS                       09530002
095400                 VARYING ASC-ITEM-SUB                             09540002
095500                 FROM 1 BY 1                                      09550002
095600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09560002
095700                                                                  09570002
095800             PERFORM 5100-WRITE-TEMP-STORAGE                      09580002
095900                                                                  09590002
096000             ADD +1                TO PV-BLOCK-NUMBER             09600002
096100                                                                  09610002
096200         END-PERFORM                                              09620002
096300                                                                  09630002
096400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         09640002
096500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     09650002
096600                                                                  09660002
096700         PERFORM                                                  09670002
096800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       09680002
096900                   ASC-HIGHEST-BLOCK-WRITTEN                      09690002
097000                                                                  09700002
097100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          09710002
097200                                   TO PV-BLOCK-NUMBER             09720002
097300                                                                  09730002
097400             PERFORM 4410-READ-TEMP-STORAGE                       09740002
097500                                                                  09750002
097600             PERFORM 2151-SET-SELECTED-INDS                       09760002
097700                 VARYING ASC-ITEM-SUB                             09770002
097800                 FROM 1 BY 1                                      09780002
097900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09790002
098000                                                                  09800002
098100             PERFORM 5100-WRITE-TEMP-STORAGE                      09810002
098200                                                                  09820002
098300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      09830002
098400                                                                  09840002
098500         END-PERFORM                                              09850002
098600                                                                  09860002
098700         MOVE PV-FIRST-BLOCK-IN-ARRAY  TO PV-BLOCK-NUMBER         09870002
098800                                                                  09880002
098900         PERFORM 4410-READ-TEMP-STORAGE                           09890002
099000     END-IF.                                                      09900002
099100                                                                  09910002
099200     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             09920002
099300                       ASC-NUMBER-OF-SELECTED-ITEMS.              09930002
099400                                                                  09940002
099500     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09950002
099600                                                                  09960002
099700*----------------------------------------------------------------*09970002
099800*    MARK EACH ITEM AS BEING SELECTED.                           *09980002
099900*----------------------------------------------------------------*09990002
100000 2151-SET-SELECTED-INDS.                                          10000002
100100     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           10010002
100200             NOT EQUAL ZERO                                       10020002
100300         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10030002
100400             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10040002
100500                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        10050002
100600                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10060002
100700                               TO  TRUE                           10070002
100800         END-IF                                                   10080002
100900     END-IF.                                                      10090002
101000                                                                  10100002
101100******************************************************************10110002
101200** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **10120002
101300** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **10130002
101400******************************************************************10140002
101500 2200-MOVE-SCREEN-TO-COMMAREA.                                    10150002
101600                                                                  10160002
101700     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             10170002
101800     MOVE +1                       TO PV-SUB.                     10180002
101900*                                                                 10190002
102000     PERFORM 3100-SET-SUBSCRIPTS.                                 10200002
102100                                                                  10210002
102200     IF  ASTRTITL > ZERO                                          10220002
102300         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          10230002
102400     ELSE                                                         10240002
102500         IF  ASTRTITF = DP015-ERASE-EOF                           10250002
102600             INITIALIZE ASC-START-ITEM-REQUEST                    10260002
102700         END-IF                                                   10270002
102800     END-IF.                                                      10280002
102900                                                                  10290002
103000     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          10300002
103100         VARYING PV-SUB FROM 1 BY 1                               10310002
103200         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      10320002
103300                                                                  10330002
103400******************************************************************10340002
103500** MOVE THE ENTERABLE FIELDS OF EACH LIST LINE INTO THE COMMAREA**10350002
103600******************************************************************10360002
103700 2210-MOVE-LINES-TO-COMMAREA.                                     10370002
103800     IF  MR-SELECTL (PV-SUB) > ZERO                               10380002
103900         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             10390002
104000         MOVE MR-SELECTI (PV-SUB)  TO ASC-TEMP-SELECTED-SW        10400002
104100                                      (ASC-BLK-SUB, ASC-ITEM-SUB) 10410002
104200     ELSE                                                         10420002
104300         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                10430002
104400                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     10440002
104500                 MOVE SPACE  TO ASC-TEMP-SELECTED-SW              10450002
104600                                      (ASC-BLK-SUB, ASC-ITEM-SUB) 10460002
104700         END-IF                                                   10470002
104800     END-IF.                                                      10480002
104900                                                                  10490002
105000     ADD +1                        TO ASC-ITEM-SUB.               10500002
105010     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        10501065
105020         IF  ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     10502065
105030             COMPUTE PV-BLOCK-NUMBER  =                           10503065
105040                1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /         10504065
105050                    PC-ITEMS-PER-PANEL                            10505065
105060             PERFORM 5105-REWRITE-ASC-LISTQ                       10506065
105070         END-IF                                                   10507065
105080         ADD +1                    TO ASC-BLK-SUB                 10508065
105090         MOVE +1                   TO ASC-ITEM-SUB                10509065
105091     ELSE                                                         10509165
105092     IF  PV-SUB = ASC-ITEMS-DISPLAYED                             10509265
105093         IF  ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     10509365
105094             COMPUTE PV-BLOCK-NUMBER  =                           10509465
105095                1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /         10509565
105096                    PC-ITEMS-PER-PANEL                            10509665
105097             PERFORM 5105-REWRITE-ASC-LISTQ                       10509765
105098         END-IF                                                   10509865
105099     END-IF.                                                      10509965
105500                                                                  10550002
105600******************************************************************10560002
105700** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **10570002
105800** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **10580002
105900******************************************************************10590002
106000 3000-EDIT-DATA-IN-COMMAREA.                                      10600002
106100     PERFORM 3200-RESET-ATTRIBUTES.                               10610002
106200     SET PS-NO-ERROR               TO TRUE.                       10620002
106300     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     10630002
106400                                                                  10640002
106500* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              10650002
106600* EDITTING IS DONE FROM THE BOTTOM UP.                            10660002
106700**                                                                10670002
106800     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       10680002
106900         ASC-ITEMS-DISPLAYED - 1.                                 10690002
107000     PERFORM 3100-SET-SUBSCRIPTS.                                 10700002
107100                                                                  10710002
107200      IF  PS-NO-ERROR                                             10720002
107300          PERFORM 3005-EDIT-COMMAREA-BLOCKS                       10730002
107400      END-IF.                                                     10740002
107500                                                                  10750002
107600     IF  PS-NO-ERROR                                              10760002
107700         PERFORM 3400-CHECK-RANGE-SEQUENCE                        10770002
107800     END-IF.                                                      10780002
107900                                                                  10790002
108000     IF  ((PS-NO-ERROR)                                           10800002
108100       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   10810002
108200       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    10820002
108300             PERFORM 3500-MARK-RANGE-AS-SELECTED                  10830002
108400     END-IF.                                                      10840002
108500                                                                  10850002
108600*----------------------------------------------------------------*10860002
108700* 3005-EDIT-COMMAREA-BLOCKS                                      *10870002
108800*----------------------------------------------------------------*10880002
108900 3005-EDIT-COMMAREA-BLOCKS.                                       10890002
109000     MOVE +1                       TO PV-BLOCK-NUMBER.            10900002
109100     MOVE +1                       TO ASC-BLK-SUB.                10910002
109200     MOVE PC-ITEMS-PER-PANEL       TO ASC-ITEM-SUB.               10920002
109300                                                                  10930002
109400     COMPUTE PV-BLOCK-NUMBER  =                                   10940002
109500             1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /            10950002
109600             PC-ITEMS-PER-PANEL.                                  10960002
109700                                                                  10970002
109800     MOVE  PV-BLOCK-NUMBER         TO PV-ORIGINAL-BLOCK.          10980002
109900                                                                  10990002
110000     PERFORM                                                      11000002
110100        UNTIL PV-BLOCK-NUMBER > ASC-HIGHEST-BLOCK-WRITTEN         11010002
110200           OR PS-ERROR                                            11020002
110300           OR PS-BLOCK-ERROR                                      11030002
110400                                                                  11040002
110500              COMPUTE PV-ITEMS-HOLD  =                            11050002
110600                      ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +       11060002
110700                      PC-ITEMS-PER-PANEL - 1                      11070002
110800                                                                  11080002
110900               IF  PV-ITEMS-HOLD  >  ASC-NUMBER-OF-ITEMS-READ     11090002
111000                   SUBTRACT  ASC-NUMBER-OF-ITEMS-READ             11100002
111100                       FROM  PV-ITEMS-HOLD                        11110002
111200                     GIVING  PV-ITEMS-DIFF                        11120002
111300                   SUBTRACT  PV-ITEMS-DIFF                        11130002
111400                       FROM  PC-ITEMS-PER-PANEL                   11140002
111500                     GIVING  PV-ITEMS-HOLD                        11150002
111600                       MOVE  PV-ITEMS-HOLD TO PV-SUB              11160002
111700                                              ASC-ITEM-SUB        11170002
111800                                              ASC-ITEMS-DISPLAYED 11180002
111900               ELSE                                               11190002
112000                   MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB            11200002
112100                   MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB      11210002
112200               END-IF                                             11220002
112300                                                                  11230002
112400               PERFORM 3300-EDIT-SELECTIONS                       11240002
112500                       VARYING PV-SUB                             11250002
112600                          FROM PV-SUB BY -1                       11260002
112700                          UNTIL PV-SUB < +1                       11270002
112800                                                                  11280002
112900               MOVE +1               TO ASC-BLK-SUB               11290002
113000                                                                  11300002
113100               PERFORM 5105-REWRITE-ASC-LISTQ                     11310002
113200                                                                  11320002
113300               MOVE +1                TO ASC-BLK-SUB              11330002
113400                                                                  11340002
113500               IF  PS-BLOCK-ERROR                                 11350002
113600                   SET  PS-ERROR     TO TRUE                      11360002
113700                   MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)      11370002
113800                                     TO PV-TOP-ITEM               11380002
113900               ELSE                                               11390002
114000                   ADD  +1           TO PV-BLOCK-NUMBER           11400002
114100                   IF  PV-BLOCK-NUMBER >                          11410002
114200                       ASC-HIGHEST-BLOCK-WRITTEN                  11420002
114300                       MOVE +2       TO ASC-BLK-SUB               11430002
114400                       PERFORM 4410-READ-TEMP-STORAGE             11440002
114500                       MOVE +1       TO ASC-BLK-SUB               11450002
114600                   ELSE                                           11460002
114700                       PERFORM 4410-READ-TEMP-STORAGE             11470002
114800                       ADD  +1        TO PV-BLOCK-NUMBER          11480002
114900                       MOVE +2        TO ASC-BLK-SUB              11490002
115000                       PERFORM 4410-READ-TEMP-STORAGE             11500002
115100                       SUBTRACT +1  FROM PV-BLOCK-NUMBER          11510002
115200                       MOVE +1        TO ASC-BLK-SUB              11520002
115300               END-IF                                             11530002
115400           END-IF                                                 11540002
115500     END-PERFORM.                                                 11550002
115600                                                                  11560002
115700     IF  (PV-ORIGINAL-BLOCK  = +1   AND                           11570002
115800          ASC-LIST-ITEM-NUMBER (1 1) = 1)  OR                     11580002
115900         PS-ERROR                   OR                            11590002
116000         PS-BLOCK-ERROR                                           11600002
116100             CONTINUE                                             11610002
116200     ELSE                                                         11620002
116300         MOVE +1                 TO PV-BLOCK-NUMBER               11630002
116400         MOVE +1                 TO ASC-BLK-SUB                   11640002
116500         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  11650002
116600         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEMS-DISPLAYED           11660002
116700         PERFORM 4410-READ-TEMP-STORAGE                           11670002
116800                                                                  11680002
116900         PERFORM                                                  11690002
117000            UNTIL PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK             11700002
117100               OR PS-ERROR                                        11710002
117200               OR PS-BLOCK-ERROR                                  11720002
117300                                                                  11730002
117400                  COMPUTE PV-ITEMS-HOLD  =                        11740002
117500                          ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +   11750002
117600                          PC-ITEMS-PER-PANEL - 1                  11760002
117700                                                                  11770002
117800                  IF  PV-ITEMS-HOLD > ASC-NUMBER-OF-ITEMS-READ    11780002
117900                      SUBTRACT  ASC-NUMBER-OF-ITEMS-READ          11790002
118000                          FROM  PV-ITEMS-HOLD                     11800002
118100                        GIVING  PV-ITEMS-DIFF                     11810002
118200                      SUBTRACT  PV-ITEMS-DIFF                     11820002
118300                          FROM  PC-ITEMS-PER-PANEL                11830002
118400                        GIVING  PV-ITEMS-HOLD                     11840002
118500                          MOVE  PV-ITEMS-HOLD TO PV-SUB           11850002
118600                                                 ASC-ITEM-SUB     11860002
118700                                              ASC-ITEMS-DISPLAYED 11870002
118800                  ELSE                                            11880002
118900                      MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB         11890002
119000                      MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB   11900002
119100                  END-IF                                          11910002
119200                                                                  11920002
119300                  PERFORM 3300-EDIT-SELECTIONS                    11930002
119400                          VARYING PV-SUB                          11940002
119500                             FROM PV-SUB BY -1                    11950002
119600                            UNTIL PV-SUB < +1                     11960002
119700                                                                  11970002
119800                  MOVE +1               TO ASC-BLK-SUB            11980002
119900                                                                  11990002
120000                  PERFORM 5105-REWRITE-ASC-LISTQ                  12000002
120100                                                                  12010002
120200                  MOVE +1                TO ASC-BLK-SUB           12020002
120300                                                                  12030002
120400                  IF  PS-BLOCK-ERROR                              12040002
120500                      SET  PS-ERROR     TO TRUE                   12050002
120600                      MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)   12060002
120700                                        TO PV-TOP-ITEM            12070002
120800                  ELSE                                            12080002
120900                      ADD  +1            TO PV-BLOCK-NUMBER       12090002
121000                      IF  PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK     12100002
121100                          MOVE +2        TO ASC-BLK-SUB           12110002
121200                          PERFORM 4410-READ-TEMP-STORAGE          12120002
121300                          MOVE +1        TO ASC-BLK-SUB           12130002
121400                      ELSE                                        12140002
121500                          PERFORM 4410-READ-TEMP-STORAGE          12150002
121600                          ADD  +1        TO PV-BLOCK-NUMBER       12160002
121700                          MOVE +2        TO ASC-BLK-SUB           12170002
121800                          PERFORM 4410-READ-TEMP-STORAGE          12180002
121900                          SUBTRACT +1  FROM PV-BLOCK-NUMBER       12190002
122000                          MOVE +1        TO ASC-BLK-SUB           12200002
122100                      END-IF                                      12210002
122200                  END-IF                                          12220002
122300     END-PERFORM.                                                 12230002
122400     MOVE +0 TO PV-ITEMS-HOLD.                                    12240002
122500                                                                  12250002
122600*----------------------------------------------------------------*12260002
122700*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *12270002
122800*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*12280002
122900*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *12290002
123000*                                                                *12300002
123100*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *12310002
123200*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *12320002
123300*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *12330002
123400*    US IN THE 2ND BLOCK OF THE ARRAY.                           *12340002
123500*----------------------------------------------------------------*12350002
123600 3100-SET-SUBSCRIPTS.                                             12360002
123700     COMPUTE ASC-ITEM-SUB =                                       12370002
123800         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        12380002
123900                                                                  12390002
124000     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         12400002
124100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            12410002
124200         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               12420002
124300     ELSE                                                         12430002
124400         MOVE +1                     TO ASC-BLK-SUB               12440002
124500     END-IF.                                                      12450002
124600                                                                  12460002
124700******************************************************************12470002
124800** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **12480002
124900******************************************************************12490002
125000 3200-RESET-ATTRIBUTES.                                           12500002
125100     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   12510002
125200     MOVE DP015-GREEN              TO ASTRTITC.                   12520002
125300     MOVE DP015-UNDERLINE          TO ASTRTITH.                   12530002
125400                                                                  12540002
125500     PERFORM                                                      12550002
125600         VARYING PV-SUB                                           12560002
125700         FROM 1 BY 1                                              12570002
125800         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        12580002
125900         MOVE DP015-UNP-ALP-NOR-OFF TO MR-SELECTA (PV-SUB)        12590002
126000         MOVE DP015-GREEN           TO MR-SELECTC (PV-SUB)        12600002
126100         MOVE DP015-UNDERLINE       TO MR-SELECTH (PV-SUB)        12610002
126200                                                                  12620002
126519     END-PERFORM.                                                 12651902
126520                                                                  12652002
126530******************************************************************12653002
126540** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **12654002
126550** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **12655002
126560** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **12656002
126570** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **12657002
126580******************************************************************12658002
126590 3300-EDIT-SELECTIONS.                                            12659002
126600     EVALUATE TRUE                                                12660002
126700         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     12670002
126800             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         12680002
126900                 CONTINUE                                         12690002
127000         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         12700002
127100             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        12710002
127200                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   12720002
127300                 MOVE ASC-TEMP-SELECTED-SW                        12730002
127400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12740002
127500                                TO ASC-SELECTED-SW                12750002
127600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12760002
127700             END-IF                                               12770002
127800         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     12780002
127900                 = SPACE                                          12790002
128000             EVALUATE TRUE                                        12800002
128100                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       12810002
128200                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS12820002
128300                     MOVE SPACE TO ASC-SELECTED-SW                12830002
128400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12840002
128500                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        12850002
128600                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    12860002
128700                     MOVE SPACE TO ASC-SELECTED-SW                12870002
128800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12880002
128900                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          12890002
129000                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      12900002
129100                     MOVE SPACE TO ASC-SELECTED-SW                12910002
129200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12920002
129300             END-EVALUATE                                         12930002
129400         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           12940002
129500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12950002
129600                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    12960002
129700             END-IF                                               12970002
129800             PERFORM 3310-EDIT-RANGE                              12980002
129900         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             12990002
130000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13000002
130100                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    13010002
130200             END-IF                                               13020002
130300             PERFORM 3310-EDIT-RANGE                              13030002
130400         WHEN OTHER                                               13040002
130500             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           13050002
130600             SET DP020-MSG-FATAL    TO TRUE                       13060002
130700             MOVE -1                TO ASTRTITL                   13070002
130800             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  13080002
130900*            MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        13090002
131000*            MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        13100002
131100             SET PS-ERROR TO TRUE                                 13110002
131200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13120002
131300                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     13130002
131400                 MOVE SPACE         TO ASC-SELECTED-SW            13140002
131500                                        (ASC-BLK-SUB ASC-ITEM-SUB)13150002
131600             END-IF                                               13160002
131700     END-EVALUATE.                                                13170002
131800                                                                  13180002
131900     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 13190002
132000     SUBTRACT +1 FROM ASC-ITEM-SUB.                               13200002
132100     IF  ASC-ITEM-SUB < 1                                         13210002
132200         SUBTRACT +1 FROM ASC-BLK-SUB                             13220002
132300         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                13230002
132400     END-IF.                                                      13240002
132500                                                                  13250002
132600******************************************************************13260002
132700** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **13270002
132800** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **13280002
132900** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**13290002
133000** THE ENDING.                                                  **13300002
133100******************************************************************13310002
133200 3310-EDIT-RANGE.                                                 13320002
133300     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                13330002
133400         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   13340002
133500             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)13350002
133600                                   TO ASC-SELECTED-SW             13360002
133700                                        (ASC-BLK-SUB ASC-ITEM-SUB)13370002
133800             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 13380002
133900         ELSE                                                     13390002
134000             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     13400002
134100                 CONTINUE                                         13410002
134200             ELSE                                                 13420002
134300*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        13430002
134400                 MOVE PC-TSYMSG-00054                             13440002
134500                                   TO DP020-MSG-NUMBER            13450002
134600                 SET DP020-MSG-FATAL                              13460002
134700                                   TO TRUE                        13470002
134800                 MOVE -1           TO ASTRTITL                    13480002
134900                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              13490002
135000                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         13500002
135100                 MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)      13510002
135200                 SET PS-ERROR      TO TRUE                        13520002
135300             END-IF                                               13530002
135400         END-IF                                                   13540002
135500     ELSE                                                         13550002
135600         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     13560002
135700             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 13570002
135800                                   TO ASC-SELECTED-SW             13580002
135900                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13590002
136000             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   13600002
136100         ELSE                                                     13610002
136200             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       13620002
136300                 CONTINUE                                         13630002
136400             ELSE                                                 13640002
136500*                -- ONLY ONE END-OF-RANGE ALLOWED --              13650002
136600                 MOVE PC-TSYMSG-00055                             13660002
136700                                   TO DP020-MSG-NUMBER            13670002
136800                 SET DP020-MSG-FATAL                              13680002
136900                                   TO TRUE                        13690002
137000                 MOVE -1           TO ASTRTITL                    13700002
137100                 SET DP030-SET-CURSOR-APPL-1                      13710002
137200                                   TO TRUE                        13720002
137300                 SET PS-ERROR      TO TRUE                        13730002
137400             END-IF                                               13740002
137500         END-IF                                                   13750002
137600     END-IF.                                                      13760002
137700*                                                                 13770002
137800******************************************************************13780002
137900** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **13790002
138000** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **13800002
138100******************************************************************13810002
138200 3400-CHECK-RANGE-SEQUENCE.                                       13820002
138300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       13830002
138400       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      13840002
138500       AND  ASC-START-OF-SELECTED-RANGE >                         13850002
138600                                         ASC-END-OF-SELECTED-RANGE13860002
138700*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                13870002
138800         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 13880002
138900         SET DP020-MSG-FATAL TO TRUE                              13890002
139000         SET PS-ERROR TO TRUE                                     13900002
139100         PERFORM 3410-POSITION-AT-ERROR                           13910002
139200     END-IF.                                                      13920002
139300                                                                  13930002
139400******************************************************************13940002
139500** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **13950002
139600** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **13960002
139700** SHOULD BE POSITIONED ON A RANGE ERROR.                       **13970002
139800******************************************************************13980002
139900 3410-POSITION-AT-ERROR.                                          13990002
140000     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       14000002
140100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 14010002
140200                    - PV-TOP-ITEM + 1.                            14020002
140300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14030002
140400         CONTINUE                                                 14040002
140500     ELSE                                                         14050002
140600         MOVE -1                   TO MR-SELECTL (PV-SUB)         14060002
140700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14070002
140800         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14080002
140900     END-IF.                                                      14090002
141000                                                                  14100002
141100     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   14110002
141200                    - PV-TOP-ITEM + 1.                            14120002
141300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14130002
141400         CONTINUE                                                 14140002
141500     ELSE                                                         14150002
141600         MOVE -1                   TO MR-SELECTL (PV-SUB)         14160002
141700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14170002
141800         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14180002
141900     END-IF.                                                      14190002
142000                                                                  14200002
142100*----------------------------------------------------------------*14210002
142200*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *14220002
142300*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *14230002
142400*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *14240002
142500*----------------------------------------------------------------*14250002
142600 3500-MARK-RANGE-AS-SELECTED.                                     14260002
142700     MOVE +1                       TO  ASC-BLK-SUB.               14270002
142800     PERFORM 3510-MARK-SELECTED-INDS                              14280002
142900         VARYING ASC-ITEM-SUB                                     14290002
143000         FROM 1 BY 1                                              14300002
143100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14310002
143200                                                                  14320002
143300     ADD +1                        TO ASC-BLK-SUB.                14330002
143400     PERFORM 3510-MARK-SELECTED-INDS                              14340002
143500         VARYING ASC-ITEM-SUB                                     14350002
143600         FROM 1 BY 1                                              14360002
143700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14370002
143800                                                                  14380002
143900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               14390002
144000                                   TO  PV-LIST-ITEM-NUMBER.       14400002
144100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            14410002
144200         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         14420002
144300               PC-ITEMS-PER-PANEL).                               14430002
144400                                                                  14440002
144500     MOVE ASC-START-OF-SELECTED-RANGE                             14450002
144600                                   TO PV-START-OF-SELECTED-RANGE. 14460002
144700     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            14470002
144800         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  14480002
144900               PC-ITEMS-PER-PANEL).                               14490002
145000                                                                  14500002
145100     MOVE ASC-END-OF-SELECTED-RANGE                               14510002
145200                                   TO  PV-END-OF-SELECTED-RANGE.  14520002
145300     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             14530002
145400         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    14540002
145500               PC-ITEMS-PER-PANEL).                               14550002
145600     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             14560002
145700         PV-FIRST-BLOCK-IN-ARRAY + 1.                             14570002
145800                                                                  14580002
145900     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    14590002
146000        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        14600002
146100         MOVE +1                   TO ASC-BLK-SUB                 14610002
146200         PERFORM 5100-WRITE-TEMP-STORAGE                          14620002
146300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         14630002
146400             PV-FIRST-BLOCK-IN-ARRAY - 1                          14640002
146500                                                                  14650002
146600         PERFORM                                                  14660002
146700             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      14670002
146800                   PV-PREV-BLOCK-IN-ARRAY                         14680002
146900             MOVE PV-FIRST-BLOCK-IN-RANGE                         14690002
147000                                   TO PV-BLOCK-NUMBER             14700002
147100             PERFORM 4410-READ-TEMP-STORAGE                       14710002
147200             PERFORM 3510-MARK-SELECTED-INDS                      14720002
147300                 VARYING ASC-ITEM-SUB                             14730002
147400                 FROM 1 BY 1                                      14740002
147500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14750002
147600             PERFORM 5100-WRITE-TEMP-STORAGE                      14760002
147700             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     14770002
147800         END-PERFORM                                              14780002
147900                                                                  14790002
148000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         14800002
148100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     14810002
148200         PERFORM                                                  14820002
148300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       14830002
148400                   PV-LAST-BLOCK-IN-RANGE                         14840002
148500             MOVE PV-NEXT-BLOCK-IN-ARRAY                          14850002
148600                                   TO PV-BLOCK-NUMBER             14860002
148700             PERFORM 4410-READ-TEMP-STORAGE                       14870002
148800             PERFORM 3510-MARK-SELECTED-INDS                      14880002
148900                 VARYING ASC-ITEM-SUB                             14890002
149000                 FROM 1 BY 1                                      14900002
149100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14910002
149200             PERFORM 5100-WRITE-TEMP-STORAGE                      14920002
149300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      14930002
149400         END-PERFORM                                              14940002
149500                                                                  14950002
149600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             14960002
149700                                   TO PV-BLOCK-NUMBER             14970002
149800         PERFORM 4410-READ-TEMP-STORAGE                           14980002
149900     END-IF.                                                      14990002
150000                                                                  15000002
150100     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 15010002
150200                                      ASC-END-OF-SELECTED-RANGE.  15020002
150300                                                                  15030002
150400*----------------------------------------------------------------*15040002
150500* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *15050002
150600*----------------------------------------------------------------*15060002
150700 3510-MARK-SELECTED-INDS.                                         15070002
150800     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         15080002
150900                                ASC-ITEM-SUB) >                   15090002
151000         ASC-START-OF-SELECTED-RANGE)                             15100002
151100     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         15110002
151200                                ASC-ITEM-SUB) =                   15120002
151300         ASC-START-OF-SELECTED-RANGE)                             15130002
151400                                                                  15140002
151500         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     15150002
151600                                    ASC-ITEM-SUB) <               15160002
151700             ASC-END-OF-SELECTED-RANGE)                           15170002
151800         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     15180002
151900                                    ASC-ITEM-SUB) =               15190002
152000             ASC-END-OF-SELECTED-RANGE)                           15200002
152100                                                                  15210002
152200             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15220002
152300                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   15230002
152400                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   15240002
152500                               TO TRUE                            15250002
152600                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              15260002
152700                               TO TRUE                            15270002
152800                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    15280002
152900             END-IF                                               15290002
153000         END-IF                                                   15300002
153100     END-IF.                                                      15310002
153200                                                                  15320002
153300*----------------------------------------------------------------*15330002
153400*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *15340002
153500*    INITIALIZE ALL COUNTERS AND FLAGS.                          *15350002
153600*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *15360002
153700*    DISPLAY THE PANEL TO USER.                                  *15370002
153800*----------------------------------------------------------------*15380002
153900 4000-BUILD-INITIAL-PANEL.                                        15390002
154000     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            15400002
154100                                 ASC-BLOCK-ENTRIES (2).           15410002
154200     MOVE +1                   TO ASC-BLK-SUB.                    15420002
154300     SET ASC-ITEMS-LEFT-ON-DB  TO TRUE.                           15430002
154400                                                                  15440002
154500     MOVE +0                 TO ASC-ITEM-SUB                      15450002
154600                                ASC-NUMBER-OF-ITEMS-READ          15460002
154700                                ASC-NUMBER-OF-SELECTED-ITEMS      15470002
154800                                ASC-HIGHEST-BLOCK-WRITTEN         15480002
154900                                ASC-START-OF-SELECTED-RANGE       15490002
155000                                ASC-END-OF-SELECTED-RANGE         15500002
155100                                ASC-ITEM-AT-TOP-OF-PANEL.         15510002
155200                                                                  15520002
      *CLP 04-06-17                                                     15520199
           PERFORM 5300-GET-DC-AVAIL-DOORS.                             15520299
155210     SET PS-DOOR-CSR TO TRUE.                                     15521021
155300     PERFORM 4100-PREPARE-CURSOR.                                 15530019
155400     PERFORM 4120-OPEN-CURSOR.                                    15540019
155500     PERFORM 4300-READ-ITEMS-FROM-DB.                             15550016
155600     PERFORM 4140-CLOSE-CURSOR.                                   15560019
155700                                                                  15570034
157244     MOVE +1                   TO  PV-TOP-ITEM.                   15724402
157245     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          15724502
157246         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    15724602
157247         SET DP020-MSG-FATAL   TO  TRUE                           15724702
157248         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               15724802
157249     ELSE                                                         15724902
157250         MOVE -1               TO MR-SELECTL (1)                  15725002
157260         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      15726002
157270         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     15727002
157280     END-IF.                                                      15728002
157290/                                                                 15729073
157300*----------------------------------------------------------------*15730002
157400* OPEN THE CURSOR.                                               *15740002
157500*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *15750002
157600*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *15760002
157700*   ASSOCIATE.                                                   *15770002
157800*----------------------------------------------------------------*15780002
157900 4120-OPEN-CURSOR.                                                15790019
158000     PERFORM                                                      15800002
158100         WITH TEST AFTER                                          15810002
158200         VARYING PV-RETRY-COUNTER                                 15820002
158300         FROM 1 BY 1                                              15830002
158400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15840002
158500                   OR (SQLCODE = ZERO))                           15850002
158600                                                                  15860002
158610         EVALUATE TRUE                                            15861022
158620             WHEN PS-DOOR-CSR                                     15862019
158700                  MOVE 'CURSOR:  DOOR-CAPABLE-CSR '               15870018
158800                                        TO DP013-MESSAGE-TEXT (2) 15880002
158900                  EXEC SQL                                        15890018
159000                       OPEN DOOR-CAPABLE-CSR                      15900018
159100                  END-EXEC                                        15910018
159200                                                                  15920002
159201             WHEN PS-TRAILER-CSR                                  15920119
159202                  MOVE 'CURSOR:  TRAILER-CSR '                    15920218
159203                                        TO DP013-MESSAGE-TEXT (2) 15920318
159204                  EXEC SQL                                        15920418
159205                       OPEN TRAILERS-ASSIGNED-CSR                 15920518
159206                  END-EXEC                                        15920618
159207                                                                  15920718
159208         END-EVALUATE                                             15920818
159210                                                                  15921018
159300         EVALUATE TRUE                                            15930002
159400             WHEN SQLCODE = ZERO                                  15940002
159500             WHEN SQLCODE = -904                                  15950002
159600             WHEN SQLCODE = -913                                  15960002
159700                 CONTINUE                                         15970002
159800             WHEN SQLWARN0 NOT = SPACES                           15980002
159900             WHEN SQLCODE < ZERO                                  15990002
160000             WHEN SQLCODE > ZERO                                  16000002
160100                 MOVE '4120-OPEN-CURSOR' TO DP013-PARAGRAPH       16010019
160200                 MOVE 'UNABLE TO OPEN A CURSOR -'                 16020002
160300                                   TO DP013-MESSAGE-TEXT (1)      16030002
160400                 MOVE SQLCA        TO DP013-SQLCA                 16040002
160500                 MOVE PV-CURSOR    TO DP013-DB2-TABLE-NAME (1)    16050018
160600                 SET DP013-DB2-ABEND                              16060002
160700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           16070002
160800                 PERFORM DP013-0000-PROCESS-ABEND                 16080002
160900         END-EVALUATE                                             16090002
161000     END-PERFORM.                                                 16100002
161100                                                                  16110002
161200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        16120002
161300         MOVE '4120-OPEN-CURSOR'   TO DP013-PARAGRAPH             16130019
161400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   16140002
161500                                   TO DP013-MESSAGE-TEXT (1)      16150002
161600         MOVE SQLCA                TO DP013-SQLCA                 16160002
161700         MOVE PV-CURSOR            TO DP013-DB2-TABLE-NAME (1)    16170018
161800         SET DP013-DB2-ABEND                                      16180002
161900             DP013-XCTL-DISPLAY-RESTART TO TRUE                   16190002
162000         PERFORM DP013-0000-PROCESS-ABEND                         16200002
162100     END-IF.                                                      16210002
162200                                                                  16220002
162300*----------------------------------------------------------------*16230002
162400* CLOSE THE CURSOR                                               *16240002
162500*----------------------------------------------------------------*16250002
162600 4140-CLOSE-CURSOR.                                               16260019
162700                                                                  16270002
162720     EVALUATE TRUE                                                16272023
162730         WHEN PS-DOOR-CSR                                         16273019
162760              EXEC SQL                                            16276018
162770                  CLOSE DOOR-CAPABLE-CSR                          16277018
162780              END-EXEC                                            16278018
162790                                                                  16279018
162791         WHEN PS-TRAILER-CSR                                      16279119
162794              EXEC SQL                                            16279418
162795                  CLOSE TRAILERS-ASSIGNED-CSR                     16279518
162796              END-EXEC                                            16279618
162797                                                                  16279718
162798     END-EVALUATE                                                 16279818
163100                                                                  16310002
163200     EVALUATE TRUE                                                16320002
163300         WHEN SQLCODE = ZERO                                      16330002
163400             CONTINUE                                             16340002
163500         WHEN SQLWARN0 NOT = SPACES                               16350002
163600         WHEN SQLCODE < ZERO                                      16360002
163700         WHEN SQLCODE > ZERO                                      16370002
163800             MOVE '4140-CLOSE-CURSOR' TO DP013-PARAGRAPH          16380019
163900             MOVE 'UNABLE TO CLOSE CURSOR '                       16390002
164000                               TO DP013-MESSAGE-TEXT (1)          16400002
164100             MOVE SQLCA        TO DP013-SQLCA                     16410002
164200             MOVE PV-CURSOR           TO                          16420018
164210                                  DP013-DB2-TABLE-NAME (1)        16421010
164300             SET DP013-DB2-ABEND                                  16430002
164400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               16440002
164500             PERFORM DP013-0000-PROCESS-ABEND                     16450002
164600     END-EVALUATE.                                                16460002
164800                                                                  16480002
164900*----------------------------------------------------------------*16490002
165000*    SET UP THE HOST VARIABLES.                                  *16500002
165100*----------------------------------------------------------------*16510002
165200 4100-PREPARE-CURSOR.                                             16520019
165300                                                                  16530002
165400     MOVE ASC-OPER-UNT-ID      TO  DK-OPER-UNT-ID.                16540002
165500/                                                                 16550073
165800*----------------------------------------------------------------*16580002
165900*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *16590002
166000*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *16600002
166100*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *16610002
166200*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *16620002
166300*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *16630002
166400*                                                                *16640002
166500*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *16650002
166600*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *16660002
166700*    UPON INITIALIZATION.                                        *16670002
166800*----------------------------------------------------------------*16680002
166900 4300-READ-ITEMS-FROM-DB.                                         16690002
167000     PERFORM                                                      16700002
167100         VARYING PV-READ-COUNT                                    16710002
167200         FROM 1 BY 1                                              16720002
167300         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    16730002
167400            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         16740002
167500                                                                  16750002
167600         PERFORM 4310-FETCH                                       16760002
167700                                                                  16770002
167800         IF  ASC-ITEMS-LEFT-ON-DB                                 16780002
167900             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                16790002
168000                 ADD +1            TO ASC-ITEM-SUB                16800002
168100             ELSE                                                 16810002
168200                 ADD +1            TO ASC-BLK-SUB                 16820002
168300                 MOVE +1           TO ASC-ITEM-SUB                16830002
168400                                                                  16840002
168500                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         16850002
168600                     MOVE +1       TO ASC-BLK-SUB                 16860002
168700                     SET ASC-BLOCK-MODIFIED (1) TO TRUE           16870002
168800                     PERFORM 5100-WRITE-TEMP-STORAGE              16880002
168900                     MOVE ASC-BLOCK-ENTRIES                       16890002
169000                               (PC-MAX-BLOCKS-IN-ARRAY)           16900002
169100                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 16910002
169200                     ADD +1        TO ASC-BLK-SUB                 16920002
169300                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   16930002
169400                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      16940002
169500                                   TO TRUE                        16950002
169600                 END-IF                                           16960002
169700             END-IF                                               16970002
169800             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    16980002
169900             MOVE ASC-NUMBER-OF-ITEMS-READ                        16990002
170000                                   TO ASC-LIST-ITEM-NUMBER        17000002
170100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17010002
170200             MOVE SUT00109-ACM-LBL-STA-NBR  TO  ASC-PNA-STA-NBR   17020032
171400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17140002
                   IF PS-DC-PASGND-FOUND                                17142094
                       MOVE PV-FUNC-QTYX    TO  ASC-DOOR-CAPABLE        17143094
171600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17144094
                   ELSE                                                 17145094
171500                 MOVE PV-DOOR-CAPABLE     TO  ASC-DOOR-CAPABLE    17150094
171600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17160002
                   END-IF                                               17161094
171700             MOVE PV-TRAILERS-ASSIGNED TO  ASC-TRAILERS-ASSIGNED  17170035
171800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17180035
171900             MOVE PV-ASSIGN-TMST       TO  ASC-ASSIGN-TMST        17190052
172000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17200045
172010             PERFORM 4360-OPEN-CURSOR                             17201074
172011             INITIALIZE PV-DOOR-TK-FIELD                          17201174
172012             PERFORM 4370-FETCH-DOOR-TK-ID                        17201274
172013                    VARYING PV-DOOR-ID-CNT FROM 1 BY 1            17201374
172014                    UNTIL   PV-DOOR-ID-CNT > PC-DOOR-ID-MAX       17201476
172020             PERFORM 4380-CLOSE-CURSOR                            17202074
172100             MOVE PV-DOOR-TK-FIELD     TO  ASC-DOOR-TK-FIELD      17210088
172200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17220088
173100                                                                  17310002
173200         END-IF                                                   17320002
173300     END-PERFORM.                                                 17330002
173400                                                                  17340002
173500     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          17350002
173600         MOVE +1               TO ASC-BLK-SUB                     17360002
173700         PERFORM 5100-WRITE-TEMP-STORAGE                          17370002
173800         ADD +1                TO ASC-BLK-SUB                     17380002
173900         PERFORM 5100-WRITE-TEMP-STORAGE                          17390002
174000                                                                  17400002
174100         MOVE 1                TO ASC-BLK-SUB                     17410002
174200                                  PV-BLOCK-NUMBER                 17420002
174300         PERFORM 4410-READ-TEMP-STORAGE                           17430002
174400         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             17440002
174500             MOVE 2            TO ASC-BLK-SUB                     17450002
174600                                  PV-BLOCK-NUMBER                 17460002
174700             PERFORM 4410-READ-TEMP-STORAGE                       17470002
174800         END-IF                                                   17480002
174900     END-IF.                                                      17490002
175000/                                                                 17500073
175100*----------------------------------------------------------------*17510002
175200*    FETCH THE CURSOR                                             17520002
175300*----------------------------------------------------------------*17530002
175400 4310-FETCH.                                                      17540002
175500                                                                  17550002
175530     EXEC SQL                                                     17553034
175541         FETCH DOOR-CAPABLE-CSR                                   17554134
175542          INTO :PV-DOOR-CAPABLE                                   17554235
175543              ,:SUT00109-OPER-UNT-ID                              17554334
175544              ,:SUT00109-ACM-LBL-STA-NBR                          17554434
175550     END-EXEC.                                                    17555034
176600                                                                  17660002
176700     EVALUATE TRUE                                                17670002
176800         WHEN SQLCODE = ZERO                                      17680002
176810              PERFORM 4330-SELECT-TRAILERS                        17681034
177000         WHEN SQLCODE = +100                                      17700002
177010              SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                 17701039
177200         WHEN SQLWARN0 NOT = SPACE                                17720002
177300         WHEN SQLCODE NOT = ZERO                                  17730002
177400              MOVE '4310-FETCH-CURSOR' TO DP013-PARAGRAPH         17740002
177500              STRING 'COULD NOT FETCH CURSOR - '                  17750018
177510                      PV-CURSOR DELIMITED BY SIZE                 17751020
177600                      INTO DP013-MESSAGE-TEXT (1)                 17760018
177700              MOVE SQLCA       TO DP013-SQLCA                     17770002
177800              SET DP013-DB2-ABEND TO TRUE                         17780002
177900              PERFORM DP013-0000-PROCESS-ABEND                    17790002
178000     END-EVALUATE.                                                17800002
178500/                                                                 17850073
178700*----------------------------------------------------------------*17870034
178800*    COUNT TRAILERS ASSIGNED                                      17880034
178900*----------------------------------------------------------------*17890034
179000 4330-SELECT-TRAILERS.                                            17900034
179100                                                                  17910034
179102     MOVE SUT00109-ACM-LBL-STA-NBR  TO  DK-ACM-LBL-STA-NBR.       17910238
179103                                                                  17910338
179110     EXEC SQL                                                     17911034
179200         SELECT  COUNT(*)                                         17920034
179300                ,S107.OPER_UNT_ID                                 17930034
179400                ,S107.ACM_LBL_STA_NBR                             17940034
179410           INTO  :PV-TRAILERS-ASSIGNED                            17941035
179420                ,:SUT00109-OPER-UNT-ID                            17942034
179430                ,:SUT00109-ACM-LBL-STA-NBR                        17943034
179500                                                                  17950034
179600           FROM  SUT_PNA_STA        S107                          17960034
179700                ,SUT_PNA_TRIP_ASGMT S110                          17970034
179710                                                                  17971034
179800           WHERE  S107.OPER_UNT_ID     = :DK-OPER-UNT-ID          17980034
179900             AND  S107.ACM_LBL_STA_NBR = :DK-ACM-LBL-STA-NBR      17990034
180000             AND  S110.ASGD_END_TMST   = :PC-DEFAULT-TIMESTAMP    18000034
180100             AND  S107.OPER_UNT_ID     = S110.OPER_UNT_ID         18010034
180110             AND  S107.ACM_LBL_STA_NBR = S110.ACM_LBL_STA_NBR     18011034
180120        GROUP BY  S107.OPER_UNT_ID                                18012034
180130                 ,S107.ACM_LBL_STA_NBR                            18013034
180700     END-EXEC.                                                    18070034
181000                                                                  18100034
181100     EVALUATE TRUE                                                18110034
181200         WHEN SQLCODE = ZERO                                      18120034
181210              PERFORM 4350-SELECT-ASSIGNMENT                      18121045
181400         WHEN SQLCODE = +100                                      18140034
181500              MOVE ZEROES TO PV-TRAILERS-ASSIGNED                 18150048
181510              MOVE SPACES TO PV-ASSIGN-TMST                       18151052
181600         WHEN SQLWARN0 NOT = SPACE                                18160034
181700         WHEN SQLCODE NOT = ZERO                                  18170034
181710              MOVE DK-OPER-UNT-ID     TO PV-MASK01                18171093
181720              MOVE DK-ACM-LBL-STA-NBR TO PV-MASK02                18172093
181800              MOVE '4330-SELECT-TRAILERS'                         18180091
181810                                       TO DP013-PARAGRAPH         18181091
181900              STRING 'INVALID SELECT '                            18190091
181910                     'OPER ID = '                                 18191092
181911                      PV-MASK01 DELIMITED BY SIZE                 18191193
181920                     'LBL STA = '                                 18192092
181930                      PV-MASK02 DELIMITED BY SIZE                 18193093
182100                      INTO DP013-MESSAGE-TEXT (1)                 18210034
182200              MOVE SQLCA       TO DP013-SQLCA                     18220034
182300              SET DP013-DB2-ABEND TO TRUE                         18230034
182400              PERFORM DP013-0000-PROCESS-ABEND                    18240034
182500     END-EVALUATE.                                                18250034
182600/                                                                 18260073
182700*----------------------------------------------------------------*18270045
182800*    SELECT FIRST ASSIGNED DATE                                   18280045
182900*----------------------------------------------------------------*18290045
182910 4350-SELECT-ASSIGNMENT.                                          18291045
182920                                                                  18292045
182950     EXEC SQL                                                     18295045
182960         SELECT                                                   18296045
182970                 S107.OPER_UNT_ID                                 18297045
182980                ,S107.ACM_LBL_STA_NBR                             18298045
182981                ,S110.ASGD_STRT_TMST                              18298145
182990           INTO                                                   18299045
182991                 :SUT00109-OPER-UNT-ID                            18299145
182992                ,:SUT00109-ACM-LBL-STA-NBR                        18299245
182993                ,:SUT00110-ASGD-STRT-TMST                         18299346
182994                                                                  18299445
182995           FROM  SUT_PNA_STA        S107                          18299545
182996                ,SUT_PNA_TRIP_ASGMT S110                          18299645
182997                                                                  18299745
182998           WHERE  S107.OPER_UNT_ID     = :DK-OPER-UNT-ID          18299845
182999             AND  S107.ACM_LBL_STA_NBR = :DK-ACM-LBL-STA-NBR      18299945
183009             AND  S110.ASGD_STRT_TMST =                           18300990
183010               ( SELECT MIN(S110.ASGD_STRT_TMST)                  18301090
183011                FROM SUT_PNA_TRIP_ASGMT S110                      18301190
183012                WHERE S107.OPER_UNT_ID     = S110.OPER_UNT_ID     18301290
183013                AND   S107.ACM_LBL_STA_NBR = S110.ACM_LBL_STA_NBR 18301390
183014                AND   S110.ASGD_END_TMST   = :PC-DEFAULT-TIMESTAMP18301490
183015               )                                                  18301590
183022        GROUP BY  S107.OPER_UNT_ID                                18302245
183030                 ,S107.ACM_LBL_STA_NBR                            18303045
183031                 ,S110.ASGD_STRT_TMST                             18303190
183040     END-EXEC.                                                    18304045
183050                                                                  18305045
183060     EVALUATE TRUE                                                18306045
183070         WHEN SQLCODE = ZERO                                      18307045
183071         WHEN SQLCODE = -811                                      18307145
183073              MOVE SUT00110-ASGD-STRT-TMST TO                     18307352
183074                                     PV-ASSIGN-TMST               18307452
183080                                                                  18308054
183090         WHEN SQLCODE = +100                                      18309045
183091              MOVE SPACES TO PV-ASSIGN-TMST                       18309152
183093                                                                  18309354
183094         WHEN SQLWARN0 NOT = SPACE                                18309452
183095         WHEN SQLCODE NOT = ZERO                                  18309552
183096              MOVE DK-OPER-UNT-ID     TO PV-MASK01                18309693
183097              MOVE DK-ACM-LBL-STA-NBR TO PV-MASK02                18309793
183098              MOVE '4350-SELECT-ASSIGNMENT'                       18309891
183099                                       TO DP013-PARAGRAPH         18309991
183100              STRING 'INVALID SELECT '                            18310091
183101                     'OPER ID = '                                 18310193
183102                      PV-MASK01 DELIMITED BY SIZE                 18310293
183103                     'LBL STA = '                                 18310393
183104                      PV-MASK02 DELIMITED BY SIZE                 18310493
183109                      INTO DP013-MESSAGE-TEXT (1)                 18310991
183110              MOVE SQLCA       TO DP013-SQLCA                     18311052
183111              SET DP013-DB2-ABEND TO TRUE                         18311152
183112              PERFORM DP013-0000-PROCESS-ABEND                    18311252
183120     END-EVALUATE.                                                18312045
183200/                                                                 18320073
183300******************************************************************18330073
183400* 4360-OPEN-CURSOR.                                              *18340073
183500*  OPEN DOOR-ID CURSOR                                           *18350073
183710******************************************************************18371073
183900 4360-OPEN-CURSOR.                                                18390073
183910                                                                  18391073
183920     EXEC SQL                                                     18392073
183930          OPEN DOOR-ID-CSR                                        18393079
183940     END-EXEC.                                                    18394073
186300                                                                  18630073
186400     EVALUATE TRUE                                                18640073
186410        WHEN SQLCODE = ZERO                                       18641073
186440            CONTINUE                                              18644073
186450        WHEN SQLWARN0 NOT = SPACES                                18645073
186460        WHEN SQLCODE < ZERO                                       18646073
186470        WHEN SQLCODE > ZERO                                       18647073
186480            MOVE '4360-OPEN-CURSOR' TO DP013-PARAGRAPH            18648073
186490            MOVE 'UNABLE TO OPEN A CURSOR -'                      18649073
186491                               TO DP013-MESSAGE-TEXT (1)          18649173
186492            MOVE SQLCA         TO DP013-SQLCA                     18649273
186493            MOVE 'DOOR-ID-CSR' TO DP013-DB2-TABLE-NAME (1)        18649373
186494            SET DP013-DB2-ABEND                                   18649473
186495                DP013-XCTL-DISPLAY-RESTART TO TRUE                18649573
186496            PERFORM DP013-0000-PROCESS-ABEND                      18649673
186497     END-EVALUATE.                                                18649773
186499/                                                                 18649973
186500******************************************************************18650073
186501* 4370-FETCH-DOOR-TK-ID                                          *18650173
186503******************************************************************18650373
186504 4370-FETCH-DOOR-TK-ID.                                           18650473
186505                                                                  18650573
186506     EXEC SQL                                                     18650674
186507         FETCH DOOR-ID-CSR                                        18650774
186508          INTO :SUT00109-DOOR-ID                                  18650874
186511     END-EXEC.                                                    18651174
186512                                                                  18651274
186513     EVALUATE TRUE                                                18651374
186514         WHEN SQLCODE = ZERO                                      18651474
186515             IF ( PV-DOOR-ID-CNT = 1 )                            18651574
186516                 MOVE SUT00109-DOOR-ID TO PV-DOOR-1               18651674
186517             ELSE                                                 18651774
186518                 MOVE SUT00109-DOOR-ID TO PV-DOOR-2               18651874
186519             END-IF                                               18651974
186520             PERFORM 4375-SELECT-TK-ID                            18652074
186521         WHEN SQLCODE = +100                                      18652174
186522             CONTINUE                                             18652274
186523         WHEN SQLWARN0 NOT = SPACE                                18652374
186524         WHEN SQLCODE NOT = ZERO                                  18652474
186525             MOVE '4370-FETCH-DOOR-TK-ID'                         18652574
186526                              TO DP013-PARAGRAPH                  18652674
186527             MOVE 'COULD NOT FETCH CURSOR - '                     18652776
186528                              TO DP013-MESSAGE-TEXT (1)           18652874
186529             MOVE SQLCA       TO DP013-SQLCA                      18652974
186530             SET DP013-DB2-ABEND TO TRUE                          18653074
186531             PERFORM DP013-0000-PROCESS-ABEND                     18653174
186532     END-EVALUATE.                                                18653274
186533/                                                                 18653374
186534******************************************************************18653474
186535* 4375-SELECT-TK-ID                                              *18653574
186536******************************************************************18653674
186537 4375-SELECT-TK-ID.                                               18653774
186538                                                                  18653874
186539     EXEC SQL                                                     18653974
186540         SELECT WRKR_USR_ID                                       18654074
186544           INTO :SUT00111-WRKR-USR-ID                             18654474
186549           FROM SUT_PNA_STA_WRKR                                  18654974
186552           WHERE  OPER_UNT_ID     = :DK-OPER-UNT-ID               18655274
186553             AND  ACM_LBL_STA_NBR = :DK-ACM-LBL-STA-NBR           18655374
186554             AND  DOOR_ID         = :SUT00109-DOOR-ID             18655474
186555             AND  WRKR_END_TMST   = :PC-DEFAULT-TIMESTAMP         18655578
186560     END-EXEC.                                                    18656074
186561                                                                  18656174
186562     EVALUATE TRUE                                                18656274
186563         WHEN SQLCODE = ZERO                                      18656374
186564         WHEN SQLCODE = -811                                      18656480
186565             IF ( PV-DOOR-ID-CNT = 1 )                            18656580
186566                 MOVE SUT00111-WRKR-USR-ID TO PV-TKID-1           18656680
186567             ELSE                                                 18656780
186568                 MOVE SUT00111-WRKR-USR-ID TO PV-TKID-2           18656881
186570             END-IF                                               18657080
186571         WHEN SQLCODE = +100                                      18657180
186572             CONTINUE                                             18657280
186573         WHEN SQLWARN0 NOT = SPACE                                18657380
186574         WHEN SQLCODE NOT = ZERO                                  18657480
186575             MOVE '4375-SELECT-TK-ID'                             18657580
186576                              TO DP013-PARAGRAPH                  18657680
186577             MOVE 'COULD NOT SELECT - '                           18657780
186578                              TO DP013-MESSAGE-TEXT (1)           18657880
186579             MOVE SQLCA       TO DP013-SQLCA                      18657980
186580             SET DP013-DB2-ABEND TO TRUE                          18658080
186581             PERFORM DP013-0000-PROCESS-ABEND                     18658180
186587     END-EVALUATE.                                                18658774
186588/                                                                 18658874
186589******************************************************************18658974
186590* 4380-CLOSE-CURSOR                                              *18659074
186591*  CLOSE DOOR-ID CURSOR                                          *18659174
186592******************************************************************18659274
186593 4380-CLOSE-CURSOR.                                               18659374
186594                                                                  18659474
186595     EXEC SQL                                                     18659574
186596          CLOSE DOOR-ID-CSR                                       18659674
186597     END-EXEC.                                                    18659774
186598                                                                  18659874
186599     EVALUATE TRUE                                                18659974
186600         WHEN SQLCODE = ZERO                                      18660074
186601             CONTINUE                                             18660174
186602         WHEN SQLWARN0 NOT = SPACES                               18660274
186603         WHEN SQLCODE < ZERO                                      18660374
186604         WHEN SQLCODE > ZERO                                      18660474
186605             MOVE '4380-CLOSE-CURSOR' TO DP013-PARAGRAPH          18660574
186606             MOVE 'UNABLE TO CLOSE CURSOR '                       18660674
186607                               TO DP013-MESSAGE-TEXT (1)          18660774
186608             MOVE SQLCA        TO DP013-SQLCA                     18660874
186609             MOVE 'DOOR-ID-CSR' TO DP013-DB2-TABLE-NAME (1)       18660974
186610             SET DP013-DB2-ABEND                                  18661074
186611                 DP013-XCTL-DISPLAY-RESTART TO TRUE               18661174
186612             PERFORM DP013-0000-PROCESS-ABEND                     18661274
186613     END-EVALUATE.                                                18661374
186614/                                                                 18661474
186615*----------------------------------------------------------------*18661502
186620* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *18662002
186700*----------------------------------------------------------------*18670002
186800 4400-MOVE-COMMAREA-TO-SCREEN.                                    18680002
186900     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             18690002
187000         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          18700002
187100         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          18710002
187200             MOVE +1    TO ASC-BLK-SUB                            18720002
187300             PERFORM 5100-WRITE-TEMP-STORAGE                      18730002
187400             ADD +1     TO ASC-BLK-SUB                            18740002
187500             PERFORM 5100-WRITE-TEMP-STORAGE                      18750002
187600             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             18760002
187700                 GIVING PV-BLOCK-NUMBER                           18770002
187800                 REMAINDER PV-REMAINDER                           18780002
187900             IF  PV-REMAINDER > ZERO                              18790002
188000                 ADD +1 TO PV-BLOCK-NUMBER                        18800002
188100             END-IF                                               18810002
188200             MOVE +1    TO ASC-BLK-SUB                            18820002
188300             PERFORM 4410-READ-TEMP-STORAGE                       18830002
188400             ADD +1     TO ASC-BLK-SUB                            18840002
188500                           PV-BLOCK-NUMBER                        18850002
188600             PERFORM 4410-READ-TEMP-STORAGE                       18860002
188700     END-IF.                                                      18870002
188800     MOVE +1            TO ASC-BLK-SUB.                           18880002
188900     COMPUTE ASC-ITEM-SUB =                                       18890002
189000         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              18900002
189100         + PC-ITEMS-PER-PANEL).                                   18910002
189200*                                                                 18920002
189300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        18930002
189400         ADD +1         TO ASC-BLK-SUB                            18940002
189500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            18950002
189600     END-IF.                                                      18960002
189700*                                                                 18970002
189800     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           18980002
189900         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                18990002
190000     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        19000002
190100     PERFORM 4420-FORMAT-LIST-LINES                               19010002
190200         VARYING PV-SUB                                           19020002
190300         FROM PC-ITEMS-PER-PANEL BY -1                            19030002
190400         UNTIL PV-SUB < +1.                                       19040002
190500*                                                                 19050002
190600     COMPUTE ASC-ITEMS-DISPLAYED =                                19060002
190700         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          19070002
190800     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    19080002
190900                                      ASTRTITO.                   19090002
191000     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    19100002
191100     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    19110002
191200     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            19120002
191300                                   TO ASELITO.                    19130002
191400     MOVE ASC-OPER-UNT-ID          TO AOPRUNTO.                   19140002
191500     MOVE ASC-FCLTY-NAME           TO AOPRNMEO.                   19150002
191510     MOVE ASC-FCLTY-NAME           TO AOPRNMEO.                   19151064
191511     STRING ASC-ASSIGN-FROM-DATE (6:5) '-'                        19151164
191512            ASC-ASSIGN-FROM-DATE (1:4)                            19151264
191513            DELIMITED BY SIZE                                     19151364
191514            INTO ABEGDTEO.                                        19151464
191515     STRING ASC-ASSIGN-TO-DATE (6:5) '-'                          19151564
191516            ASC-ASSIGN-TO-DATE (1:4)                              19151664
191517            DELIMITED BY SIZE                                     19151764
191518            INTO AENDDTEO.                                        19151864
191600                                                                  19160002
191700     IF  DP020-MSG-NUMBER-X = SPACE                               19170002
191800         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  19180002
191900*            --- MORE ITEMS TO DISPLAY ----                       19190002
192000             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            19200002
192100             SET DP020-MSG-INFORMATIONAL TO TRUE                  19210002
192200         END-IF                                                   19220002
192300     END-IF.                                                      19230002
192400                                                                  19240002
192500*----------------------------------------------------------------*19250002
192600*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *19260002
192700*----------------------------------------------------------------*19270002
192800 4410-READ-TEMP-STORAGE.                                          19280002
192900     EXEC CICS                                                    19290002
193000         READQ TS                                                 19300002
193100             QUEUE (ASC-LIST-QUEUE-NAME)                          19310002
193200             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19320002
193300             ITEM  (PV-BLOCK-NUMBER)                              19330002
193400             RESP  (PV-CICS-RESP)                                 19340002
193500     END-EXEC.                                                    19350002
193600                                                                  19360002
193700     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       19370002
193800       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     19380002
193900         CONTINUE                                                 19390002
194000     ELSE                                                         19400002
194100         SET DP013-CICS-ABEND     TO TRUE                         19410002
194200         SET DP013-NO-ROLLBACK    TO TRUE                         19420002
194300         MOVE '4410-READ-TEMP-STORAGE' TO DP013-PARAGRAPH         19430002
194400         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      19440002
194500                                  TO DP013-MESSAGE-TEXT(1)        19450002
194600         PERFORM DP013-0000-PROCESS-ABEND                         19460002
194700     END-IF.                                                      19470002
194800                                                                  19480002
194900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             19490002
195000*                                                                 19500002
195100     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         19510002
195200         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               19520002
195300     END-IF.                                                      19530002
195400                                                                  19540002
195500*----------------------------------------------------------------*19550002
195600*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *19560002
195700*----------------------------------------------------------------*19570002
195800 4420-FORMAT-LIST-LINES.                                          19580002
195900     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      19590002
196000         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                19600002
196100         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           19610002
196200         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           19620002
196300         MOVE SPACES             TO MR-SELECTI      (PV-SUB)      19630030
196400                                    MR-ACTION       (PV-SUB)      19640002
196410                                    MR-ASSIGN-DATE  (PV-SUB)      19641005
196420                                    MR-ASSIGN-TIME  (PV-SUB)      19642005
196430                                    MR-DOORID-01    (PV-SUB)      19643082
196440                                    MR-TKID-01      (PV-SUB)      19644082
196450                                    MR-DOORID-02    (PV-SUB)      19645082
196460                                    MR-TKID-02      (PV-SUB)      19646082
196500         MOVE 0                  TO MR-PNA          (PV-SUB)      19650030
196600                                    MR-DOOR-CAPABLE (PV-SUB)      19660003
196700                                    MR-TRAILERS-ASSIGNED (PV-SUB) 19670003
197400     ELSE                                                         19740002
197500         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      19750002
197600                                                   > SPACE        19760002
197700             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 19770002
197800                                          TO MR-SELECTI (PV-SUB)  19780002
197900         ELSE                                                     19790002
198000             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      19800002
198100                                           TO MR-SELECTI (PV-SUB) 19810002
198200         END-IF                                                   19820002
198300                                                                  19830002
198400         IF  DP030-SET-CURSOR-TRAILER                             19840002
198500             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)19850002
198600                 > SPACE)                                         19860002
198700               OR (PV-SUB = 1))                                   19870002
198800                SET DP030-SET-CURSOR-APPL-1 TO TRUE               19880002
198900                MOVE -1          TO MR-SELECTL (PV-SUB)           19890002
199000             END-IF                                               19900002
199100         END-IF                                                   19910002
199200*>>>>>>>>                                                         19920002
199300         MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)               19930002
199400                                            TO MR-ACTION (PV-SUB) 19940002
199500         MOVE ASC-PNA-STA-NBR  (ASC-BLK-SUB ASC-ITEM-SUB)         19950032
199600                                          TO MR-PNA      (PV-SUB) 19960003
199700         MOVE ASC-DOOR-CAPABLE (ASC-BLK-SUB ASC-ITEM-SUB)         19970003
199800                                   TO MR-DOOR-CAPABLE (PV-SUB)    19980003
199900         MOVE ASC-TRAILERS-ASSIGNED (ASC-BLK-SUB ASC-ITEM-SUB)    19990003
200000                                 TO MR-TRAILERS-ASSIGNED (PV-SUB) 20000003
200500         STRING ASC-ASSIGN-TMST (ASC-BLK-SUB ASC-ITEM-SUB) (6:6)  20050052
200510                ASC-ASSIGN-TMST (ASC-BLK-SUB ASC-ITEM-SUB) (3:2)  20051052
200600                DELIMITED BY SIZE INTO MR-ASSIGN-DATE (PV-SUB)    20060052
200700         MOVE ASC-ASSIGN-TMST (ASC-BLK-SUB ASC-ITEM-SUB) (12:8)   20070052
200800                                    TO MR-ASSIGN-TIME (PV-SUB)    20080002
200900         MOVE ASC-DOOR-TK-FIELD (ASC-BLK-SUB ASC-ITEM-SUB) (01:4) 20090088
201000                                    TO MR-DOORID-01 (PV-SUB)      20100088
201100         MOVE ASC-DOOR-TK-FIELD (ASC-BLK-SUB ASC-ITEM-SUB) (06:7) 20110088
201200                                    TO MR-TKID-01 (PV-SUB)        20120088
201210         MOVE ASC-DOOR-TK-FIELD (ASC-BLK-SUB ASC-ITEM-SUB) (14:4) 20121088
201220                                    TO MR-DOORID-02 (PV-SUB)      20122088
201230         MOVE ASC-DOOR-TK-FIELD (ASC-BLK-SUB ASC-ITEM-SUB) (19:7) 20123088
201240                                    TO MR-TKID-02 (PV-SUB)        20124088
201300     END-IF.                                                      20130002
201400     SUBTRACT +1 FROM ASC-ITEM-SUB                                20140002
201500     IF  ASC-ITEM-SUB < + 1                                       20150002
201600         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  20160002
201700         MOVE +1                 TO ASC-BLK-SUB                   20170002
201800     END-IF.                                                      20180002
201900                                                                  20190002
202000******************************************************************20200002
202100** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **20210002
202200** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **20220002
202300** ISSUE A WARNING.                                             **20230002
202400******************************************************************20240002
202500 4430-CHECK-FOR-BEGIN-AND-END.                                    20250002
202600     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       20260002
202700         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     20270002
202800*            -- NO END-OF-RANGE SPECFIED ---                      20280002
202900             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            20290002
203000             SET DP020-MSG-WARNING TO TRUE                        20300002
203100             PERFORM 4431-POSITION-AT-WARNING                     20310002
203200         END-IF                                                   20320002
203300     ELSE                                                         20330002
203400         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     20340002
203500*            -- NO BEGINNING-OF-RANGE SPECFIED ---                20350002
203600             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            20360002
203700             SET DP020-MSG-WARNING TO TRUE                        20370002
203800             PERFORM 4431-POSITION-AT-WARNING                     20380002
203900         END-IF                                                   20390002
204000     END-IF.                                                      20400002
204100                                                                  20410002
204200******************************************************************20420002
204300** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **20430002
204400** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **20440002
204500** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **20450002
204600** POSITION THE CURSOR THERE.                                   **20460002
204700******************************************************************20470002
204800 4431-POSITION-AT-WARNING.                                        20480002
204900     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 20490002
205000                    - PV-TOP-ITEM + 1.                            20500002
205100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      20510002
205200         CONTINUE                                                 20520002
205300     ELSE                                                         20530002
205400         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      20540002
205500         MOVE -1                     TO MR-SELECTL (PV-SUB)       20550002
205600         MOVE DP015-REVERSE          TO MR-SELECTH (PV-SUB)       20560002
205700         MOVE DP015-YELLOW           TO MR-SELECTC (PV-SUB)       20570002
205800     END-IF.                                                      20580002
205900                                                                  20590002
206000     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   20600002
206100                    - PV-TOP-ITEM + 1.                            20610002
206200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      20620002
206300         CONTINUE                                                 20630002
206400     ELSE                                                         20640002
206500         SET DP030-SET-CURSOR-APPL-1                              20650002
206600                                   TO TRUE                        20660002
206700         MOVE -1                   TO MR-SELECTL (PV-SUB)         20670002
206800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         20680002
206900         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         20690002
207000     END-IF.                                                      20700002
207100                                                                  20710002
207200*----------------------------------------------------------------*20720002
207300* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *20730002
207400* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *20740002
207500* FOR THE SELECTED ITEMS QUEUE.                                  *20750002
207600*                                                                *20760002
207700* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *20770002
207800* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *20780002
207900* THE ARRAY IS FULL.                                             *20790002
208000*----------------------------------------------------------------*20800002
208100 5000-PREPARE-SEL-QUEUE.                                          20810002
208200     MOVE +1                   TO  ASC-BLK-SUB.                   20820002
208300     PERFORM 5100-WRITE-TEMP-STORAGE.                             20830002
208400     ADD +1                    TO  ASC-BLK-SUB.                   20840002
208500     PERFORM 5100-WRITE-TEMP-STORAGE.                             20850002
208600                                                                  20860002
208700     MOVE ASC-SEL-QUEUE-NAME   TO  SU089-SEL-QUEUE-NAME.          20870002
208800     PERFORM 6010-DELETE-SEL-QUEUE.                               20880002
208900                                                                  20890002
209000     SET ASC-UPDATE-TSQ        TO  TRUE.                          20900002
209100                                                                  20910002
209200     SET SU088-IDX             TO  1.                             20920002
209300     MOVE ZERO                 TO SU089-NUMBER-OF-TS-ITEMS.       20930002
209400     INITIALIZE SU088-SELECTED-ITEM-ARRAY.                        20940002
209500                                                                  20950002
209600     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           20960002
209700             VARYING PV-ITEM                                      20970002
209800             FROM 1 BY 1                                          20980002
209900             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     20990002
210000                                                                  21000002
210100     IF  SU088-IDX > 1                                            21010002
210200         PERFORM 5205-WRITE-SEL-QUEUE                             21020002
210300         ADD +1                TO SU089-NUMBER-OF-TS-ITEMS        21030002
210400     END-IF.                                                      21040002
210500                                                                  21050002
210600*----------------------------------------------------------------*21060002
210700*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *21070002
210800*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *21080002
210900*----------------------------------------------------------------*21090002
211000 5100-WRITE-TEMP-STORAGE.                                         21100002
211100     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     21110002
211200                                   TO PV-LIST-ITEM-NUMBER.        21120002
211300     COMPUTE PV-BLOCK-NUMBER =                                    21130002
211400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    21140002
211500                                                                  21150002
211600     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             21160002
211700     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             21170002
211800         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      21180002
211900             PERFORM 5105-REWRITE-ASC-LISTQ                       21190002
212000         END-IF                                                   21200002
212100     ELSE                                                         21210002
212200         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       21220002
212300         ASC-HIGHEST-BLOCK-WRITTEN + 1                            21230002
212400         PERFORM 5110-WRITE-ASC-LISTQ                             21240002
212500         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   21250002
212600     END-IF.                                                      21260002
212700                                                                  21270002
212800     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             21280002
212900                                                                  21290002
213000******************************************************************21300002
213100** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **21310002
213200** SPECIFIC COMMAREA.                                           **21320002
213300******************************************************************21330002
213400 5105-REWRITE-ASC-LISTQ.                                          21340002
213500     EXEC CICS                                                    21350002
213600         WRITEQ TS                                                21360002
213700             QUEUE (ASC-LIST-QUEUE-NAME)                          21370002
213800             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               21380002
213900             ITEM  (PV-BLOCK-NUMBER)                              21390002
214000             REWRITE                                              21400002
214100             RESP  (PV-CICS-RESP)                                 21410002
214200     END-EXEC.                                                    21420002
214300                                                                  21430002
214400     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           21440002
214500         CONTINUE                                                 21450002
214600     ELSE                                                         21460002
214700         SET DP013-CICS-ABEND            TO TRUE                  21470002
214800         SET DP013-NO-ROLLBACK           TO TRUE                  21480002
214900         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       21490002
215000         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     21500002
215100                                         TO DP013-MESSAGE-TEXT(1) 21510002
215200         PERFORM DP013-0000-PROCESS-ABEND                         21520002
215300     END-IF.                                                      21530002
215400                                                                  21540002
215500******************************************************************21550002
215600** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **21560002
215700** SPECIFIC COMMAREA.                                           **21570002
215800******************************************************************21580002
215900 5110-WRITE-ASC-LISTQ.                                            21590002
216000     EXEC CICS                                                    21600002
216100         WRITEQ TS                                                21610002
216200             QUEUE (ASC-LIST-QUEUE-NAME)                          21620002
216300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               21630002
216400             ITEM  (PV-BLOCK-NUMBER)                              21640002
216500             RESP  (PV-CICS-RESP)                                 21650002
216600     END-EXEC.                                                    21660002
216700     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      21670002
216800         SET DP013-CICS-ABEND      TO TRUE                        21680002
216900         SET DP013-NO-ROLLBACK     TO TRUE                        21690002
217000         MOVE '5110-WRITE-ASC-LISTQ'                              21700002
217100                                   TO DP013-PARAGRAPH             21710002
217200         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           21720002
217300                                   TO DP013-MESSAGE-TEXT(1)       21730002
217400         PERFORM DP013-0000-PROCESS-ABEND                         21740002
217500     END-IF.                                                      21750002
217600                                                                  21760002
217700*----------------------------------------------------------------*21770002
217800* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *21780002
217900* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *21790002
218000*----------------------------------------------------------------*21800002
218100 5200-FILL-SEL-QUEUE-RECORD.                                      21810002
218200     PERFORM 6112-READ-LIST-QUEUE.                                21820002
218300                                                                  21830002
218400     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       21840002
218500         PERFORM VARYING LQW-IDX                                  21850002
218600         FROM 1 BY 1                                              21860002
218700         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            21870002
218800           OR  LQW-LIST-ITEM-NUMBER(LQW-IDX) = ZERO               21880002
218900                                                                  21890002
219000           IF LQW-SELECT (LQW-IDX)                                21900002
219100                 MOVE LQW-LIST-ITEM-NUMBER(LQW-IDX) TO            21910002
219200                                            SU088-ITEM (SU088-IDX)21920002
219300                 MOVE LQW-ACTION (LQW-IDX)                        21930002
219400                                   TO SU088-ACTION-SW (SU088-IDX) 21940002
219500                 MOVE LQW-PNA    (LQW-IDX)                        21950005
219600                                 TO SU088-PNA-STA-NBR (SU088-IDX) 21960005
219700                                                                  21970054
219710                 MOVE LQW-ASSIGN-TMST (LQW-IDX)                   21971053
219800                            TO SU088-ASSIGN-TMST      (SU088-IDX) 21980053
220300                                                                  22030002
220400                 SET SU088-IDX UP BY 1                            22040002
220500                 IF  SU088-IDX > SU088-MAX-ITEMS                  22050002
220600                     PERFORM 5205-WRITE-SEL-QUEUE                 22060002
220700                     ADD +1        TO SU089-NUMBER-OF-TS-ITEMS    22070002
220800                     INITIALIZE SU088-SELECTED-ITEM-ARRAY         22080002
220900                     SET SU088-IDX TO  1                          22090002
221000                 END-IF                                           22100002
221100           END-IF                                                 22110002
221200         END-PERFORM                                              22120002
221300     END-IF.                                                      22130002
221400                                                                  22140002
221500*----------------------------------------------------------------*22150002
221600*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *22160002
221700*----------------------------------------------------------------*22170002
221800 5205-WRITE-SEL-QUEUE.                                            22180002
221900     MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO SU088-SELECTED-ITEMS.   22190002
222000                                                                  22200002
222100     EXEC CICS                                                    22210002
222200          WRITEQ TS                                               22220002
222300              QUEUE (ASC-SEL-QUEUE-NAME)                          22230002
222400              FROM  (SU088-SELECT-RECORD)                         22240002
222500              ITEM  (PV-SEL-QUEUE-ITEM)                           22250002
222600              RESP  (PV-CICS-RESP)                                22260002
222700     END-EXEC.                                                    22270002
222800                                                                  22280002
222900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22290002
223000         CONTINUE                                                 22300002
223100     ELSE                                                         22310002
223200         SET DP013-CICS-ABEND      TO TRUE                        22320002
223300         SET DP013-NO-ROLLBACK     TO TRUE                        22330002
223400         MOVE '5205-WRITE-SEL-QUEUE'                              22340002
223500                                   TO DP013-PARAGRAPH             22350002
223600         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          22360002
223700                                   TO DP013-MESSAGE-TEXT(1)       22370002
223800         PERFORM DP013-0000-PROCESS-ABEND                         22380002
223900     END-IF.                                                      22390002
224000                                                                  22400002
      *CLP 04-06-17                                                     22401094
      ****************************************************************  22401199
      * ONLY WHEN THE SWITCH IS SET TO 'Y' WILL THIS OVERRIDE        *  22401299
      * EXISTING DOOR CAPABLE (ON SCREEN)                            *  22401399
      ****************************************************************  22401499
091901 5300-GET-DC-AVAIL-DOORS.                                         22402099
091902     SET PS-DC-PASGND-NOT-FOUND  TO TRUE.                         22403094
091920     MOVE ASC-OPER-UNT-ID    TO  KRPRPM-LOC-ID.                   22404094
091930                                                                  22405094
091940     EXEC SQL                                                     22406094
091950          SELECT  SYS_PRC_FUNC_CDE                                22407094
                       ,FUNC_QTY                                        22407197
091960            INTO :KRPRPM-SYS-PRC-FUNC-CDE                         22408094
091960                ,:KRPRPM-FUNC-QTY                                 22408197
091970            FROM  TKRPRPM                                         22409094
091980           WHERE  LOC_ID            = :KRPRPM-LOC-ID              22409194
091990             AND  INTFC_SYS_CDE     = 'KHL'                       22409294
091991             AND  SYS_PRC_FUNC_CDE  = 'PASGND'                    22409394
091992             AND  FUNC_TXT          = 'Y'                         22409494
091993            WITH UR                                               22409694
091994     END-EXEC.                                                    22409794
091995                                                                  22409894
091996     EVALUATE TRUE                                                22409994
091997       WHEN SQLCODE = +0                                          22410094
091998           SET  PS-DC-PASGND-FOUND       TO TRUE                  22410194
                 MOVE KRPRPM-FUNC-QTY          TO PV-FUNC-QTY           22410294
092001       WHEN SQLCODE = +100                                        22410394
092002           SET  PS-DC-PASGND-NOT-FOUND   TO TRUE                  22410494
261900       WHEN SQLWARN0 NOT = SPACES                                 22410594
262000       WHEN SQLCODE < +0                                          22410694
262100       WHEN SQLCODE > +0                                          22410794
266900           MOVE '4395-GET-DC-PNA-DOORS   ' TO DP013-PARAGRAPH     22410894
267000           MOVE 'TROUBLE RETRIEVING PARM'                         22410994
267100                                    TO DP013-MESSAGE-TEXT (1)     22411094
267200           MOVE SQLCA        TO DP013-SQLCA                       22411194
267300           MOVE 'TKRPRPM '   TO DP013-DB2-TABLE-NAME (1)          22411294
267400           SET DP013-DB2-ABEND                                    22411394
267500               DP013-XCTL-DISPLAY-RESTART TO TRUE                 22411494
267600           PERFORM DP013-0000-PROCESS-ABEND                       22411594
092019     END-EVALUATE.                                                22411694
                                                                        22411794
224100******************************************************************22412002
224200** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **22420002
224300** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **22430002
224400** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **22440002
224500** THE USER.                                                    **22450002
224600******************************************************************22460002
224700 6000-REFRESH-PANEL-FROM-TEMP.                                    22470002
224800     IF  ASC-UPDATE-TSQ                                           22480002
224900         SET ASC-NO-TSQ-UPDATE TO TRUE                            22490002
225000         MOVE ZERO                 TO PV-SAVE-ITEM                22500002
225100                                      PV-SEL-QUEUE-ITEM           22510002
225200         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        22520002
225300                                   TO PV-HOLD-SELECTED-ITEMS      22530002
225400         MOVE +1                   TO PV-ITEMS-PROCESSED          22540002
225500         PERFORM 6100-UPDATE-TSQ                                  22550002
225600             UNTIL PV-ITEMS-PROCESSED >                           22560002
225700                                     PV-HOLD-SELECTED-ITEMS       22570002
225800         INITIALIZE ASC-BLOCK-ENTRIES (1)                         22580002
225900                    ASC-BLOCK-ENTRIES (2)                         22590002
226000     END-IF.                                                      22600002
226100                                                                  22610002
226200*----------------------------------------------------------------*22620002
226300*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *22630002
226400*----------------------------------------------------------------*22640002
226500 6010-DELETE-SEL-QUEUE.                                           22650002
226600                                                                  22660002
226700     EXEC CICS                                                    22670002
226800         DELETEQ TS                                               22680002
226900             QUEUE (ASC-SEL-QUEUE-NAME)                           22690002
227000             RESP  (PV-CICS-RESP)                                 22700002
227100     END-EXEC.                                                    22710002
227200*                                                                 22720002
227300     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      22730002
227400        (PV-CICS-RESP = DFHRESP(QIDERR)))                         22740002
227500         CONTINUE                                                 22750002
227600     ELSE                                                         22760002
227700         SET DP013-CICS-ABEND TO TRUE                             22770002
227800         SET DP013-NO-ROLLBACK TO TRUE                            22780002
227900         MOVE '6010-DELETE-SEL-QUEUE' TO DP013-PARAGRAPH          22790002
228000         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         22800002
228100                                        TO DP013-MESSAGE-TEXT (1) 22810002
228200         PERFORM DP013-0000-PROCESS-ABEND                         22820002
228300     END-IF.                                                      22830002
228400                                                                  22840002
228500*----------------------------------------------------------------*22850002
228600*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *22860002
228700*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *22870002
228800*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *22880002
228900*    THE TEMP QUEUE.                                             *22890002
229000*----------------------------------------------------------------*22900002
229100 6100-UPDATE-TSQ.                                                 22910002
229200                                                                  22920002
229300     ADD 1    TO  PV-SEL-QUEUE-ITEM.                              22930002
229400     PERFORM 6105-READ-SEL-QUEUE.                                 22940002
229500     PERFORM                                                      22950002
229600         VARYING SU088-IDX FROM 1 BY 1                            22960002
229700         UNTIL ((PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS)     22970002
229800         OR (SU088-IDX GREATER THAN SU088-MAX-ITEMS))             22980002
229900         IF  SU088-ACTION-SW (SU088-IDX) > SPACE                  22990002
230000             PERFORM 6110-PROCESS-ITEMS                           23000002
230100         END-IF                                                   23010002
230200         ADD +1                TO PV-ITEMS-PROCESSED              23020002
230300     END-PERFORM.                                                 23030002
230400     PERFORM 6111-WRITE-LIST-QUEUE.                               23040002
230500                                                                  23050002
230600*----------------------------------------------------------------*23060002
230700*    READ THE LIST QUEUE RECORD.                                 *23070002
230800*----------------------------------------------------------------*23080002
230900 6105-READ-SEL-QUEUE.                                             23090002
231000                                                                  23100002
231100     EXEC CICS                                                    23110002
231200          READQ TS                                                23120002
231300              QUEUE (ASC-SEL-QUEUE-NAME)                          23130002
231400              INTO  (SU088-SELECT-RECORD)                         23140002
231500              ITEM  (PV-SEL-QUEUE-ITEM)                           23150002
231600              RESP  (PV-CICS-RESP)                                23160002
231700     END-EXEC.                                                    23170002
231800*                                                                 23180002
231900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23190002
232000         CONTINUE                                                 23200002
232100     ELSE                                                         23210002
232200         SET DP013-CICS-ABEND      TO  TRUE                       23220002
232300         SET DP013-NO-ROLLBACK     TO  TRUE                       23230002
232400         MOVE '6105-READ-SEL-QUEUE'                               23240002
232500                                   TO  DP013-PARAGRAPH            23250002
232600         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           23260002
232700                                   TO  DP013-MESSAGE-TEXT(1)      23270002
232800         PERFORM DP013-0000-PROCESS-ABEND                         23280002
232900     END-IF.                                                      23290002
233000                                                                  23300002
233100*----------------------------------------------------------------*23310002
233200*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*23320002
233300*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*23330002
233400*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *23340002
233500*----------------------------------------------------------------*23350002
233600 6110-PROCESS-ITEMS.                                              23360002
233700                                                                  23370002
233800     COMPUTE PV-ITEM = 1 + ((SU088-ITEM (SU088-IDX) - 1)          23380002
233900                     / PC-ITEMS-PER-PANEL).                       23390002
234000                                                                  23400002
234100     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           23410002
234200         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          23420002
234300             PERFORM 6111-WRITE-LIST-QUEUE                        23430002
234400         END-IF                                                   23440002
234500         MOVE PV-ITEM          TO PV-SAVE-ITEM                    23450002
234600                                                                  23460002
234700         PERFORM 6112-READ-LIST-QUEUE                             23470002
234800         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               23480002
234900             CONTINUE                                             23490002
235000         END-IF                                                   23500002
235100     END-IF.                                                      23510002
235200                                                                  23520002
235300     COMPUTE PV-SUB = (SU088-ITEM (SU088-IDX)                     23530002
235400                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              23540002
235500     SET LQW-DESELECT (PV-SUB) TO    TRUE                         23550002
235600     MOVE LQW-SELECTED-SW (PV-SUB)                                23560002
235700                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  23570002
235800     EVALUATE TRUE                                                23580002
235900         WHEN SU088-INQ (SU088-IDX)                               23590002
236000              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             23600002
236100                                                                  23610002
236200         WHEN SU088-UPD (SU088-IDX)                               23620002
236300              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             23630002
236400              MOVE SU088-PNA-STA-NBR (SU088-IDX)                  23640005
236500                               TO LQW-PNA (PV-SUB)                23650006
237200                                                                  23720002
237300         WHEN SU088-DEL (SU088-IDX)                               23730002
237400              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             23740002
237500                                                                  23750002
237600         WHEN SU088-ERR (SU088-IDX)                               23760002
237700              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             23770002
237800                                                                  23780002
237900         WHEN OTHER                                               23790002
238000              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             23800002
238100                                                                  23810002
238200     END-EVALUATE.                                                23820002
238300                                                                  23830002
238400     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                23840002
238500                                                                  23850002
238600*----------------------------------------------------------------*23860002
238700*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *23870002
238800*----------------------------------------------------------------*23880002
238900 6111-WRITE-LIST-QUEUE.                                           23890002
239000                                                                  23900002
239100     EXEC CICS                                                    23910002
239200         WRITEQ TS                                                23920002
239300             QUEUE (ASC-LIST-QUEUE-NAME)                          23930002
239400             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     23940002
239500             ITEM  (PV-SAVE-ITEM)                                 23950002
239600             REWRITE                                              23960002
239700             RESP  (PV-CICS-RESP)                                 23970002
239800     END-EXEC.                                                    23980002
239900*                                                                 23990002
240000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24000002
240100         CONTINUE                                                 24010002
240200     ELSE                                                         24020002
240300         SET DP013-CICS-ABEND  TO  TRUE                           24030002
240400         SET DP013-NO-ROLLBACK TO  TRUE                           24040002
240500         MOVE '6111-WRITE-LIST-QUEUE' TO  DP013-PARAGRAPH         24050002
240600         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  24060002
240700                               TO  DP013-MESSAGE-TEXT(1)          24070002
240800         PERFORM DP013-0000-PROCESS-ABEND                         24080002
240900     END-IF.                                                      24090002
241000                                                                  24100002
241100*----------------------------------------------------------------*24110002
241200*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*24120002
241300*----------------------------------------------------------------*24130002
241400 6112-READ-LIST-QUEUE.                                            24140002
241500     EXEC CICS                                                    24150002
241600         READQ TS                                                 24160002
241700             QUEUE (ASC-LIST-QUEUE-NAME)                          24170002
241800             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     24180002
241900             ITEM  (PV-ITEM)                                      24190002
242000             RESP  (PV-CICS-RESP)                                 24200002
242100     END-EXEC.                                                    24210002
242200*                                                                 24220002
242300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24230002
242400         CONTINUE                                                 24240002
242500     ELSE                                                         24250002
242600         SET DP013-CICS-ABEND        TO TRUE                      24260002
242700         SET DP013-NO-ROLLBACK       TO TRUE                      24270002
242800         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           24280002
242900         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    24290002
243000                                     TO DP013-MESSAGE-TEXT(1)     24300002
243100         PERFORM DP013-0000-PROCESS-ABEND                         24310002
243200     END-IF.                                                      24320002
243300                                                                  24330002
243400*----------------------------------------------------------------*24340002
243500*    ABEND PROCESSOR MODULE                                      *24350002
243600*----------------------------------------------------------------*24360002
243700     COPY DPPD013.                                                24370002
