000110 IDENTIFICATION DIVISION.                                         00010002
000200 PROGRAM-ID.         WSKUT009.                                    00020002
000300 AUTHOR.             RENGIN SIRVANCI.                             00030002
000400 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00040002
000500 DATE-WRITTEN.       MARCH 2007.                                  00050002
000600                                                                  00060002
000700****************************************************************  00070002
000800*                                                                 00080002
000810* I M P O R T A N T --- WHEN COMPILING THIS PROGRAM THE MQ SERIES 00081002
000900* SWITCH ON THE 2ND COMPILE SCREEN NEEDS TO BE SET TO 'Y'.        00082002
001000* THIS PROGRAM USES MQSERIES.                                     00083002
001001*                                                                 00084002
001010******************************************************************00085002
001020* MM/DD/YYYY WHO & WHAT                                           00086002
001030* ---------- -----------------------------------------------------00087002
001040* 05/14/2010 FRANK WALA (FJW)                                     00088002
001050* # CHANGE PGM TO USE THE WSV_LOC_XREF TABLE TO OBTAIN THE STORE  00089002
001060*   NUMBER USING THE INPUT DC NUMBER AS KEY.                      00090002
001070* # REMOVED THE HARD-CODED '873' STATEMENT.                       00100002
001071* # ADDED MISSING DEBUG DISPLAYS FOR (2100, 3210 & 8999).         00101002
001074* # MOVED THE STORE LOOKUP LOGIC EARLIER IN THE PROGRAM SO THAT   00102002
001075*   EROORS WILL HAVE STORE NUMBER ON THEM.                        00103002
001080******************************************************************00104002
001200* THIS PROGRAM IS THE RC/SU SYSTEM TRANSACTION ADAPTER (TRAILER   00105002
001300* UPDATE) THAT WILL PROCESS MQ MESSAGES FROM WMOS (PIX TRANSACT-  00106002
001400* IONS IN XML FORMAT). IT WILL WRITE THEM TO 1 OF 3 QUEUES OR TO  00107002
001500* AN ERROR QUEUE.                                                 00108002
001510******************************************************************00109002
001700* TRIGGERED TASK:                                                 00110002
001800* -------------                                                   00120002
001900* THIS PROGRAM RUNS AS A STARTED TASK.  THE TASK STARTS WHEN      00130002
002000* CICS IS BROUGHT UP IN THE MORNING.  IT WILL RUN CONTINUOUSLY    00140002
002100* UNTIL IT ENCOUNTERS THE "END RUN OF PROGRAM" MESSAGE THAT       00150002
002200* WILL BE SENT TO THE ITEM QUEUE FROM A SEPARATE PROGRAM USING    00160002
002300* AN MQPUT1 CALL.                                                 00170002
002400*                                                                 00180002
002500* A TRANSACTION-TYPE OF 999 WILL SHUT DOWN THE ITEM PROCESS.      00190002
002600*                                                                 00200002
002700* GENERAL PROCESSING:                                             00210002
002800* -------------------                                             00220002
002900* 1) INITIALIZE VARIABLES, SET SWITCHES, OPEN TRAILER UPD QUEUE.  00230002
003000* 2) GET MQ MESSAGES COMING IN XML FORMAT, PIX 606-03, 611-04, OR 00240002
003100*    603-01.                                                      00250002
003200* 3) BREAK THE MESSAGE DOWN INTO ITS COMPONENTS, WRITE TO ONE OF  00260002
003300*    THE THREE QUEUES(NON-XML FORMAT) OR TO AN ERROR QUEUE.       00270002
003400* 4) ALL 3 QUEUES WILL HAVE THE MESSAGES IN THE SAME FORMAT,      00280002
003500*    WS014-RECEIPT-PIX-RECORD FORMAT(WSRD014).                    00290002
003600* 5) IF AN ERROR IS FOUND ON A MESSAGE COMING IN, THE ENTIRE      00300002
003700*    MESSAGE WILL BE PUT ON THE ERROR QUEUE, WSRD027 FORMAT.      00310002
003800*                                                                 00320002
003900* ERROR PROCESSING:                                               00330002
004000* -----------------                                               00340002
004100* THIS PROGRAM IS CODED TO TRAP 4 TYPES OF ERRORS WHICH ARE:      00350002
004200* 1) REC NOT FOUND                                                00360002
004300* 2) DUP INSERT                                                   00370002
004400* 3) SQL ERROR                                                    00380002
004500* 4) INVALID REC                                                  00390002
004600                                                                  00400002
004700****************************************************************  00410002
004800 ENVIRONMENT DIVISION.                                            00420002
004900****************************************************************  00430002
005000 CONFIGURATION SECTION.                                           00440002
005100 SOURCE-COMPUTER.        IBM-3090.                                00450002
005200 OBJECT-COMPUTER.        IBM-3090.                                00460002
005300 INPUT-OUTPUT SECTION.                                            00470002
005400                                                                  00480002
005500 FILE-CONTROL.                                                    00490002
005600****************************************************************  00500002
005700 DATA DIVISION.                                                   00510002
005800****************************************************************  00520002
005900 FILE SECTION.                                                    00530002
006000                                                                  00540002
006100 WORKING-STORAGE SECTION.                                         00550002
006200******************************************************************00560002
006300  01  PV-ABEND-CODE                   PIC S9(04) VALUE ZERO       00570002
006400                                                 COMP SYNC.       00580002
006410  01  PV-DISPLAY-PRIORITY             PIC  Z(09)-.                00590002
006420******************************************************************00600002
006430**** PROGRAM CONSTANTS                                            00610002
006440******************************************************************00620002
006450 01  PC-PROGRAM-CONSTANTS.                                        00630002
006460     05  PC-PGM-NAME             PIC X(08) VALUE 'WSKUT009'.      00640002
006470     05  PC-MAX-RETRIES              PIC S9(3) VALUE +5 COMP-3.   00641002
006480     05  PC-READY                    PIC X(06) VALUE 'READY '.    00642002
006490     05  PC-ERROR                    PIC X(06) VALUE 'ERROR '.    00643002
006500     05  PC-MQPUT-RETRY-COUNTER      PIC 9(3)  VALUE ZERO.        00644002
006600     05  PC-RESPONSE-QNAME           PIC X(30) VALUE SPACES.      00645002
006700     05  PC-WAIT-15-SECS             PIC S9(9) VALUE 15000.       00646002
006800     05  PC-WAIT-6-SECS              PIC S9(9) VALUE 6000.        00647002
006900     05  PC-SML-CRTN-PREFIX          PIC X(04) VALUE '0041'.      00648002
006910* JAK 10/2009 ADD 1 LINE                                          00649002
006920     05  PC-SML-CRTN-PREFX2          PIC X(04) VALUE '0042'.      00650002
006930     05  PC-DELAY-INTERVAL.                                       00660002
006940         10  FILLER                  PIC X(2)  VALUE SPACES.      00670002
006950         10  PC-DELAY-TIME           PIC 9(8)  VALUE 3000.        00680002
006960                                                                  00690002
006970******************************************************************00691002
006980**** PROGRAM VARIABLES                                            00692002
006990******************************************************************00693002
007000 01  PV-PROGRAM-VARIABLES.                                        00694002
007100     05  PV-START                 PIC 9(3)        VALUE ZERO.     00695002
007200     05  PV-END                   PIC 9(3)        VALUE ZERO.     00696002
007300     05  PV-LEN                   PIC 9(3)        VALUE ZERO.     00697002
007400     05  PV-CURRENT-ELEMENT       PIC X(30)       VALUE SPACES.   00698002
007500     05  PV-CURRENT-ATTRIBUTE     PIC X(30)       VALUE SPACES.   00699002
007600     05  PV-PRC-CNTL-TMST         PIC X(26)       VALUE SPACES.   00700002
007700     05  PV-TRANSACTION-TYPE      PIC X(3)        VALUE SPACES.   00710002
007800     05  PV-TRANSACTION-CODE      PIC X(3)        VALUE SPACES.   00720002
007900     05  PV-ASN-ORGN-TYPE         PIC X(20)  JUST RIGHT.          00730002
008000     05  PV-ASN-ORGN-TYPE-1       PIC X(1)        VALUE SPACES.   00740002
008100     05  PV-ADJ-TYPE              PIC X(1)        VALUE SPACES.   00750002
008200     05  PV-ADJ-QTY-CONVERT       PIC X(13)  JUST RIGHT.          00760002
008300     05  PV-ADJ-QTY-NUM      REDEFINES PV-ADJ-QTY-CONVERT         00770002
008400                                  PIC 9(07).9(05).                00780002
008500     05  PV-ADJ-QTY-CONVRTD       PIC 9(08)V9(05)  VALUE  0.      00790002
008600     05  PV-ADJ-QTY-9        REDEFINES PV-ADJ-QTY-CONVRTD.        00800002
008700         10  PV-ADJ-QTY-SIG       PIC 9(08).                      00810002
008800         10  PV-ADJ-QTY-DEC       PIC 9(05).                      00820002
008900*FJW 05/14/2010 BEGIN                                             00830002
009300     05  PV-DC-NUMBER             PIC X(04)  JUST RIGHT.          00840002
009400     05  PV-DC-NUMBER-NUMERIC     REDEFINES                       00850002
009500         PV-DC-NUMBER             PIC 9(04).                      00860002
009510     05  PV-DC-NBR-LOOKUP-COMP    PIC S9(09) COMP VALUE ZEROS.    00870002
009530     05  PV-STORE-NUMBER-X        PIC X(04)  JUST RIGHT.          00880002
009540     05  PV-STORE-NUMBER-NUMERIC  REDEFINES                       00890002
009550         PV-STORE-NUMBER-X        PIC 9(04).                      00900002
009551     05  PV-WMOS-LOC-NBR-TEXT     PIC X(50)       VALUE SPACES.   00910002
009552*FJW 05/14/2010 END                                               00920002
009600     05  PV-CASE-NUMBER           PIC X(50)       VALUE SPACES.   00930002
009700     05  PV-CASE-NBR-CH               PIC X(20).                  00940002
009800     05  PV-CASE-NBR-PIC              REDEFINES PV-CASE-NBR-CH.   00950002
009900         10  PV-CASE-NBR              PIC 9(20).                  00960002
010000     05  PV-SKU-NUMBER            PIC X(08)       VALUE SPACES.   00970002
010100     05  PV-SKU-NUMBER-NUMERIC REDEFINES PV-SKU-NUMBER            00980002
010200                                  PIC 9(08).                      00990002
010300     05  PV-USER-ID               PIC X(15)       VALUE SPACES.   01000002
010400     05  PV-SEAL                  PIC X(20).                      01010002
010500     05  PV-PO-NUMBER             PIC X(20)  JUST RIGHT.          01020002
010600     05  PV-PO-NUM           REDEFINES PV-PO-NUMBER.              01030002
010700         10  FILLER               PIC X(12).                      01040002
010800         10  PV-PO-NUMERIC        PIC Z9(7).                      01050002
010900     05  PV-DC-ORD-NUMBER         PIC X(20)  JUST RIGHT.          01060002
011000     05  PV-DC-ORD-NUM       REDEFINES PV-DC-ORD-NUMBER.          01070002
011100         10  FILLER               PIC X(16).                      01080002
011200         10  PV-DC-ORD-NUMERIC    PIC Z9(3).                      01090002
011300     05  PV-PO-LINE-NUMBER        PIC X(20)  JUST RIGHT.          01100002
011400     05  PV-PO-LINE-NUM      REDEFINES PV-PO-LINE-NUMBER.         01110002
011500         10  FILLER               PIC X(16).                      01120002
011600         10  PV-PO-LINE-NUMERIC   PIC 9(04).                      01130002
011700     05  PV-VEHICLE               PIC X(20)  JUST RIGHT.          01140002
011800     05  PV-SCAC                  PIC X(20)  JUST RIGHT.          01150002
011900     05  PV-DOOR-ID               PIC X(20)  JUST RIGHT.          01160002
012000     05  PV-WMOS-DATE-CREATED     PIC X(19).                      01170002
012100     05  PV-WMOS-DATE  REDEFINES PV-WMOS-DATE-CREATED.            01180002
012200         10  PV-WMOS-DATE-YYYY    PIC 9(04).                      01190002
012300         10  PV-HYPHEN-1          PIC X(01).                      01200002
012400         10  PV-WMOS-DATE-MM      PIC 9(02).                      01210002
012500         10  PV-HYPHEN-2          PIC X(01).                      01220002
012600         10  PV-WMOS-DATE-DD      PIC 9(02).                      01230002
012700         10  PV-LETTER-T          PIC X(01).                      01240002
012800         10  PV-WMOS-DATE-HH      PIC 9(02).                      01250002
012900         10  PV-COLON-1           PIC X(01).                      01260002
013000         10  PV-WMOS-DATE-MN      PIC 9(02).                      01270002
013100         10  PV-COLON-2           PIC X(01).                      01280002
013200         10  PV-WMOS-DATE-SS      PIC 9(02).                      01290002
013300     05  PV-TRANS-DATE.                                           01300002
013400         10  PV-TRANS-DATE-YYYY   PIC 9(04).                      01310002
013500         10  PV-TRANS-HYPHEN-1    PIC X(01).                      01320002
013600         10  PV-TRANS-DATE-MM     PIC 9(02).                      01330002
013700         10  PV-TRANS-HYPHEN-2    PIC X(01).                      01340002
013800         10  PV-TRANS-DATE-DD     PIC 9(02).                      01350002
013900         10  PV-TRANS-HYPHEN-3    PIC X(01).                      01360002
014000         10  PV-TRANS-DATE-HH     PIC 9(02).                      01370002
014100         10  PV-TRANS-DOT-1       PIC X(01).                      01380002
014200         10  PV-TRANS-DATE-MN     PIC 9(02).                      01390002
014300         10  PV-TRANS-DOT-2       PIC X(01).                      01400002
014400         10  PV-TRANS-DATE-SS     PIC 9(02).                      01410002
014500         10  PV-TRANS-DOT-3       PIC X(01).                      01420002
014600         10  PV-TRANS-DATE-NS     PIC 9(06).                      01430002
014700     05  PV-RETRY-COUNTER         PIC S9(04) VALUE +0 COMP SYNC.  01440002
014800     05  PV-HOLD-COMPLETION-CODE  PIC S9(9) BINARY.               01450002
014900     05  PV-HOLD-REASON           PIC S9(9) BINARY.               01460002
015000                                                                  01470002
015100     05  PV-PARAGRAPH             PIC  X(30) VALUE SPACE.         01480002
015200     05  PV-DISP-NBR              PIC ZZZ,ZZZ,ZZ9.                01490002
015300     05  PV-DISP-SQL              PIC S9(04).                     01500002
015400     05  PV-TIMESTAMP             PIC X(26).                      01510002
015500     05  PV-TRAN-CDE              PIC  X(03) VALUE SPACE.         01520002
015600                                                                  01530002
015700                                                                  01540002
015800 01  PV-DESC                     PIC X(120)     VALUE SPACES.     01550002
015900 01  PV-DISPLAY                  PIC X(120)     VALUE SPACES.     01560002
016000******************************************************************01570002
016100**** PROGRAM ACCUMULATORS                                         01580002
016200******************************************************************01590002
016300 01  PA-PROGRAM-ACCUMULATORS.                                     01600002
016400     05  PA-TOTAL-MQ-PIX-MSGS-READ PIC  S9(09)  VALUE +0 COMP-3.  01610002
016500     05  PA-999-STOP-PROC-MESSAGES PIC  S9(09)  VALUE +0 COMP-3.  01620002
016600     05  PA-TOTAL-MQ-RC-MSGS-SENT  PIC  S9(09)  VALUE +0 COMP-3.  01630002
016700     05  PA-TOTAL-MQ-SU-MSGS-SENT  PIC  S9(09)  VALUE +0 COMP-3.  01640002
016800     05  PA-TOTAL-MQ-INTRAN-MSGS-SENT                             01650002
016900                                   PIC  S9(09)  VALUE +0 COMP-3.  01660002
017000     05  PA-TOTAL-MQ-ERROR-MSGS-SENT                              01670002
017100                                   PIC  S9(09)  VALUE +0 COMP-3.  01680002
017200     05  PA-DEBUG-MESSAGES          PIC  S9(09)  VALUE +0 COMP-3. 01690002
017300     05  PA-TOTAL-DB2-ROLLBACKS     PIC  S9(09)  VALUE +0 COMP-3. 01700002
017400     05  PA-TOTAL-MQ-PUTAWY-COMMITS PIC  S9(09)  VALUE +0 COMP-3. 01710002
017500******************************************************************01711002
017600**** PROGRAM VARIABLES FOR QUEUE MANAGER AND QUEUE NAMES.         01712002
017610******************************************************************01713002
017620 01  PV-Q-MANAGER-VARIABLES.                                      01714002
017630     05  PV-QMGR-NAME-PIX             PIC X(48).                  01715002
017640     05  PV-QUE-NAME-PIX              PIC X(48).                  01716002
017650     05  PV-HANDLE-PIX           PIC S9(9) BINARY VALUE 0.        01717002
017660     05  PV-QMGR-NAME-RC              PIC X(48).                  01718002
017670     05  PV-QUE-NAME-RC               PIC X(48).                  01719002
017680     05  PV-HANDLE-RC            PIC S9(9) BINARY VALUE 0.        01720002
017690     05  PV-QMGR-NAME-SU              PIC X(48).                  01730002
017700     05  PV-QUE-NAME-SU               PIC X(48).                  01740002
017800     05  PV-HANDLE-SU            PIC S9(9) BINARY VALUE 0.        01750002
017900     05  PV-QMGR-NAME-INTRANSIT       PIC X(48).                  01760002
018000     05  PV-QUE-NAME-INTRANSIT        PIC X(48).                  01761002
018100     05  PV-HANDLE-INTRANSIT     PIC S9(9) BINARY VALUE 0.        01762002
018200     05  PV-QMGR-NAME-ERROR           PIC X(48).                  01763002
018300     05  PV-QUE-NAME-ERROR            PIC X(48).                  01764002
018400     05  PV-HANDLE-ERROR         PIC S9(9) BINARY VALUE 0.        01765002
018500******************************************************************01766002
018600**** PROGRAM VARIABLES FOR MQ SERIES                              01767002
018700******************************************************************01768002
018800 01  PV-MQ-PROGRAM-VARIABLES.                                     01769002
018900     05  PV-QM-NAME              PIC X(48).                       01770002
019000     05  PV-HCONN                PIC S9(9) BINARY VALUE 0.        01780002
019100     05  PV-OPEN-OPTIONS         PIC S9(9) BINARY.                01790002
019200     05  PV-COMPLETION-CODE      PIC S9(9) BINARY.                01800002
019300     05  PV-REASON               PIC S9(9) BINARY.                01810002
019400     05  PV-ERROR-MESSAGE        PIC X(48) VALUE SPACES.          01820002
019500     05  PV-CON-REASON           PIC S9(9) BINARY.                01830002
019600     05  PV-MSGBUFFER            PIC X(32432) VALUE SPACES.       01840002
019700     05  PV-RCMSGBUFFER          PIC X(203) VALUE SPACES.         01850002
019800     05  PV-SUMSGBUFFER          PIC X(203) VALUE SPACES.         01860002
019900     05  PV-INTMSGBUFFER         PIC X(203) VALUE SPACES.         01870002
020000     05  PV-ERRMSGBUFFER         PIC X(1055) VALUE SPACES.        01880002
020100     05  PV-MSG-LENGTH           PIC S9(9) BINARY.                01890002
020200     05  PV-DATA-LENGTH          PIC S9(9) BINARY.                01900002
020300     05  PV-ACTION               PIC X(60)        VALUE SPACES.   01910002
020400                                                                  01920002
020500*PV-MSG IS THE INPUT MESSAGE                                      01930002
020600 01  PV-MSG                         PIC X(32432).                 01940002
020700                                                                  01950002
020800 01  PC-MQCONN                   PIC X(8)  VALUE 'CSQBCONN'.      01960002
020900 01  PC-MQOPEN                   PIC X(8)  VALUE 'CSQBOPEN'.      01970002
021000 01  PC-MQINQ                    PIC X(8)  VALUE 'CSQBINQ'.       01980002
021100 01  PC-MQGET                    PIC X(8)  VALUE 'CSQBGET'.       01990002
021200 01  PC-MQPUT                    PIC X(8)  VALUE 'CSQBPUT'.       02000002
021300*01  PC-MQCMIT                   PIC X(8)  VALUE 'SRRCMIT '.      02010002
021400 01  PC-MQCMIT                   PIC X(8)  VALUE 'CSQBCOMM'.      02020002
021500 01  PC-MQCLOSE                  PIC X(8)  VALUE 'CSQBCLOS'.      02030002
021600 01  PC-MQCOMM                   PIC X(8)  VALUE 'CSQBCOMM'.      02040002
021700 01  PC-MQDISC                   PIC X(8)  VALUE 'CSQBDISC'.      02050002
021800 01  PC-MQBACK                   PIC X(8)  VALUE 'CSQBBACK'.      02060002
021900                                                                  02070002
022000* API CONTROL BLOCKS                                              02080002
022100 01  MQM-OBJECT-DESCRIPTOR.                                       02090002
022200     COPY CMQODV.                                                 02100002
022300 01  MQM-MESSAGE-DESCRIPTOR.                                      02110002
022400     COPY CMQMDV.                                                 02120002
022500 01  MQM-PUT-MESSAGE-OPTIONS.                                     02130002
022600     COPY CMQPMOV.                                                02140002
022700 01  MQM-GET-MESSAGE-OPTIONS.                                     02150002
022800     COPY CMQGMOV.                                                02160002
022900                                                                  02170002
023000* MQV CONTAINS CONSTANTS (FOR FILLING IN THE CONTROL BLOCKS)      02180002
023100* AND RETURN CODES (FOR TESTING THE RESULT OF A CALL)             02190002
023200 01  MQM-CONSTANTS.                                               02200002
023300     COPY CMQV.                                                   02210002
023400                                                                  02220002
023500 01  PL-PROGRAM-LOG-VARIABLES.                                    02230002
023600     05  PL-LOG-SUB       PIC  9(02)  VALUE ZERO.                 02240002
023700     05  PL-LOG-LINES-TABLE.                                      02250002
023800         10  FILLER       PIC  X(11)  VALUE ' WSKUT009: '.        02260002
023900                                                                  02270002
024000 01  PS-PROGRAM-SWITCHES.                                         02280002
024100     05  PS-END-OF-PIX-SW               PIC X(01)  VALUE 'N'.     02290002
024200         88  PS-END-OF-PIX-YES                     VALUE 'Y'.     02300002
024300         88  PS-END-OF-PIX-NO                      VALUE 'N'.     02310002
024400     05  PS-ERROR-REC-WRITTEN-SW        PIC X(01)  VALUE 'N'.     02320002
024500         88  PS-ERROR-REC-WRITTEN-YES              VALUE 'Y'.     02330002
024600         88  PS-ERROR-REC-WRITTEN-NO               VALUE 'N'.     02340002
024700     05  PS-TIME-TO-END-PROGRAM-SW      PIC  X(01) VALUE 'N'.     02350002
024800         88  PS-TIME-TO-END-PROGRAM-YES            VALUE 'Y'.     02360002
024900         88  PS-TIME-TO-END-PROGRAM-NO             VALUE 'N'.     02370002
025000     05  PS-DISPLAY-SW                  PIC X(01)  VALUE 'N'.     02380002
025100         88  PS-DISPLAY-YES                        VALUE 'Y'.     02390002
025200         88  PS-DISPLAY-NO                         VALUE 'N'.     02400002
025300         88  PS-DISPLAY-PENDING                    VALUE 'P'.     02410002
025400     05  PS-SKIP-PROCESS-SW             PIC X(01)  VALUE 'N'.     02420002
025500         88  PS-SKIP-PROCESS-YES                   VALUE 'Y'.     02430002
025600         88  PS-SKIP-PROCESS-NO                    VALUE 'N'.     02440002
025700     05  PS-CASE-TO-SHPMT-CHCK-SW       PIC X(01)  VALUE 'N'.     02450002
025800         88  PS-CASE-TO-SHPMT-CHCK-YES             VALUE 'Y'.     02460002
025810         88  PS-CASE-TO-SHPMT-CHCK-NO              VALUE 'N'.     02470002
025820                                                                  02480002
025830 01  XML-LENGTH                  PIC 9(5).                        02490002
025840                                                                  02500002
025850***************************************************************** 02510002
025860* MQ SERIES COMPLETION CODES.                                     02520002
025870***************************************************************** 02530002
025880     COPY ISWS002.                                                02540002
025890                                                                  02550002
025900***************************************************************** 02560002
026000* XMAL CODE DESCRIPTIONS, AND DISPLAYING FORMATTED XML MESSAGES   02570002
026100***************************************************************** 02580002
026200     COPY ISWS007.                                                02581002
026300     COPY ISWS008.                                                02582002
026400     COPY ISWS009.                                                02583002
026500                                                                  02584002
026600***************************************************************** 02585002
026700* OUTPUT MESSAGE COPYBOOK - FOR ALL THREE QUEUES.                 02586002
026800***************************************************************** 02587002
026900     COPY WSRD014.                                                02588002
027000                                                                  02589002
027100***************************************************************** 02590002
027200* OUTPUT ERROR MESSAGE COPYBOOK - FOR ERROR QUEUE.                02600002
027300***************************************************************** 02610002
027400     COPY WSRD027.                                                02620002
027500                                                                  02630002
027600******************************************************************02640002
027700*  COMMUNICATIONS AREA FOR DB2                                    02650002
027800******************************************************************02660002
027900     EXEC SQL                                                     02670002
028000          INCLUDE SQLCA                                           02680002
028100     END-EXEC.                                                    02690002
028200                                                                  02700002
028300******************************************************************02710002
028400*  DB2 VIEW DECLARATION - PIX ROUTING                             02720002
028500*        (WSV_PIX_RTN)     WSV00002                               02730002
028600******************************************************************02740002
028700     EXEC SQL                                                     02750002
028800         INCLUDE WSV00002                                         02760002
028900     END-EXEC.                                                    02770002
029000                                                                  02780002
029100******************************************************************02790002
029200*  DB2 VIEW DECLARATION - PROVIDER QUEUE VIEW (PUT/WRITE)         02800002
029300*        (WSV_PRVDR_QUE) WSV00005                                 02810002
029400******************************************************************02820002
029500     EXEC SQL                                                     02830002
029600         INCLUDE WSV00005                                         02840002
029700     END-EXEC.                                                    02850002
029800                                                                  02860002
029900******************************************************************02870002
030000*  DB2 VIEW DECLARATION - CONSUMER QUEUE VIEW (GET/READ)          02880002
030100*        (WSV_CNSMR_QUE) WSV00006                                 02890002
030200******************************************************************02900002
030300     EXEC SQL                                                     02910002
030400         INCLUDE WSV00006                                         02920002
030500     END-EXEC.                                                    02930002
030600                                                                  02940002
030610******************************************************************02950002
030620*  DB2 VIEW DECLARATION - OUTBOUND CARTON TABLE                   02960002
030630*        (SUT_OTBND_CART) SUT_OTBND_CART                          02970002
030640******************************************************************02980002
030650     EXEC SQL                                                     02990002
030660         INCLUDE SUT00024                                         03000002
030670     END-EXEC.                                                    03010002
030680                                                                  03020002
030681*FJW 05/14/2010 BEGIN                                             03030002
030682***************************************************************** 03040002
030684*  DB2 DECLARATION FOR TABLE - WSV_LOC_XREF                       03050002
030685***************************************************************** 03060002
030687     EXEC SQL                                                     03061002
030688         INCLUDE WSV00000                                         03062002
030689     END-EXEC.                                                    03063002
030695*FJW 05/14/2010 END                                               03064002
030696                                                                  03065002
030697***************************************************************** 03066002
030700 PROCEDURE DIVISION.                                              03067002
030800***************************************************************** 03068002
030900                                                                  03069002
031000 0000-MAIN-MODULE.                                                03069102
031001                                                                  03069202
031100     IF PS-DISPLAY-YES                                            03069302
031200        DISPLAY 'EFC2 WSKUT009 - 0000-MAIN-MODULE.'               03069402
031300     END-IF.                                                      03069502
031310                                                                  03069602
031400******************************************************************03069702
031500**  MAIN PROCESSING.                                              03069802
031600******************************************************************03069902
031700     DISPLAY '**********************************'.                03070002
031800     DISPLAY '* START OF WSKUT009               '.                03080002
031900     DISPLAY '**********************************'.                03090002
032000                                                                  03100002
032100     PERFORM 1000-INITIALIZATION.                                 03110002
032200     PERFORM 1200-MQSERIES-CONNECT.                               03120002
032300     PERFORM 1300-MQSERIES-OPEN-PIX.                              03130002
032400     PERFORM 1310-MQSERIES-OPEN-RC.                               03140002
032500     PERFORM 1320-MQSERIES-OPEN-SU.                               03150002
032600     PERFORM 1330-MQSERIES-OPEN-INTRANSIT.                        03160002
032700     PERFORM 1340-MQSERIES-OPEN-ERROR.                            03170002
032800     PERFORM 1400-GET-MQ-MESSAGE.                                 03180002
032900     PERFORM 2000-PROCESS-XML                                     03190002
033000           UNTIL PV-REASON = MQRC-NO-MSG-AVAILABLE                03200002
033100              OR PS-TIME-TO-END-PROGRAM-YES.                      03210002
033200                                                                  03220002
033300     PERFORM 4000-MQ-CLEANUP.                                     03230002
033400     PERFORM 9300-WRAPUP.                                         03240002
033500                                                                  03250002
033600     GOBACK.                                                      03260002
033700                                                                  03270002
033800***************************************************************** 03280002
033900* INITIALIZATION                                                  03290002
034000*     OPENS FILES                                                 03300002
034100*     INITIALIZES VARIABLES                                       03310002
034200*     CALLS A PROCESS TO GET THE CONTROL TIMESTAMP.               03320002
034300*     GETS MQ QUEUE & QUEUE MANAGER INFORMATION FOR THE 3 QUEUES. 03330002
034400***************************************************************** 03340002
034500 1000-INITIALIZATION.                                             03350002
034810     IF PS-DISPLAY-YES                                            03360002
034820        DISPLAY 'WSKUT009 - 1000-INITIALIZATION.'                 03370002
034830     END-IF.                                                      03380002
034900                                                                  03390002
035000     INITIALIZE   PA-TOTAL-MQ-PIX-MSGS-READ                       03400002
035100                  PA-TOTAL-MQ-RC-MSGS-SENT                        03410002
035200                  PA-TOTAL-MQ-SU-MSGS-SENT                        03420002
035300                  PA-TOTAL-MQ-INTRAN-MSGS-SENT                    03430002
035400                  PA-TOTAL-MQ-ERROR-MSGS-SENT                     03440002
035500                  PV-PRC-CNTL-TMST                                03450002
035600                  WS014-RECEIPT-PIX-RECORD                        03460002
035700                  DCLWSV00002                                     03470002
035800                  DCLWSV00005                                     03480002
035900                  DCLWSV00006.                                    03490002
036000                                                                  03500002
036100     SET PS-TIME-TO-END-PROGRAM-NO TO TRUE                        03510002
036200                                                                  03520002
036300* CREATE A PROCESS CONTROL TMST                                   03530002
036400     PERFORM 1050-GEN-PRC-CNTL-TMST.                              03540002
036500                                                                  03550002
036600     PERFORM 1100-GET-MQ-INFO-PIX.                                03560002
036700     PERFORM 1130-GET-MQ-INFO-RC.                                 03570002
036800     PERFORM 1140-GET-MQ-INFO-SU.                                 03580002
036900     PERFORM 1150-GET-MQ-INFO-INTRANSIT.                          03590002
037000     PERFORM 1160-GET-MQ-INFO-ERROR.                              03600002
037100                                                                  03610002
037200******************************************************************03620002
037300* CREATE THE PROCESS CONTROL TMST BY GETTING THE DB2 CURRENT TMST*03630002
037400******************************************************************03640002
037500 1050-GEN-PRC-CNTL-TMST.                                          03650002
037600     IF PS-DISPLAY-YES                                            03660002
037700        DISPLAY 'WSKUT009 - 1050-GEN-PRC-CNTL-TMST.'              03670002
037800     END-IF.                                                      03680002
037900                                                                  03690002
038000         EXEC SQL                                                 03700002
038100             SET :PV-PRC-CNTL-TMST = CURRENT TIMESTAMP            03710002
038200         END-EXEC                                                 03720002
038300                                                                  03730002
038400         EVALUATE TRUE                                            03740002
038500             WHEN SQLCODE = ZERO                                  03750002
038600                 CONTINUE                                         03760002
038700                                                                  03770002
038800             WHEN SQLWARN0 NOT EQUAL SPACE                        03780002
038900             WHEN SQLCODE NOT EQUAL ZERO                          03790002
039000                 DISPLAY '**************************************' 03800002
039100                 DISPLAY '** ABEND                              ' 03810002
039200                 DISPLAY '** PROGRAM = WSKUT009                 ' 03820002
039300                 DISPLAY '** PARAGRAPH = 1050-GEN-PRC-CNTL-TMST ' 03830002
039400                 DISPLAY '** SET CURRENT TIMESTAMP              ' 03840002
039500                 DISPLAY '** CURRENT TMST   = ' PV-PRC-CNTL-TMST  03850002
039600                 DISPLAY '**************************************' 03860002
039700                 MOVE +4018         TO PV-ABEND-CODE              03870002
039800                 MOVE '1050-GEN-PRC-CNTL-TMST' TO PV-PARAGRAPH    03880002
039900*                (CROAK)                                          03890002
039910                 PERFORM 9500-ABEND                               03900002
039920         END-EVALUATE.                                            03910002
039930                                                                  03920002
039940******************************************************************03930002
039950* GETS MQ INFO FROM WSV_CNSMR_QUE (GET/READ) - PIX TRANSACTIONS.  03940002
039960******************************************************************03950002
039970 1100-GET-MQ-INFO-PIX.                                            03960002
039980     IF PS-DISPLAY-YES                                            03970002
039990        DISPLAY 'WSKUT009 - 1100-GET-MQ-INFO-PIX.'                03980002
040000     END-IF.                                                      03990002
040100                                                                  03991002
040200     INITIALIZE WSV00006-QUE-MGR-TEXT.                            03992002
040300     INITIALIZE WSV00006-QUE-NM-TEXT.                             03993002
040400                                                                  03994002
040500     PERFORM WITH TEST AFTER                                      03995002
040600             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 03996002
040700             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         03997002
040800                     SQLCODE = ZERO                               03998002
040900                                                                  03999002
041000       EXEC SQL                                                   04000002
041100        SELECT QUE_MGR,                                           04010002
041200               QUE_NM                                             04020002
041300         INTO :WSV00006-QUE-MGR                                   04030002
041400             ,:WSV00006-QUE-NM                                    04040002
041500         FROM WSV_CNSMR_QUE                                       04050002
041600        WHERE APPL_FUNC_DESC  = 'PIXQUEUE'                        04060002
041700          AND INTGRTN_TYP_CDE = 'PIXTRLRUPD'                      04070002
041800       END-EXEC                                                   04080002
041900                                                                  04090002
042000       IF PS-DISPLAY-YES                                          04100002
042100          DISPLAY ' PIX QMGR:' WSV00006-QUE-MGR-TEXT              04110002
042200          DISPLAY ' PIX QUE :' WSV00006-QUE-NM-TEXT               04120002
042300          DISPLAY ' SQL CDE :' SQLCODE                            04130002
042400       END-IF                                                     04140002
042500                                                                  04150002
042600       EVALUATE TRUE                                              04160002
042700           WHEN SQLCODE = 0                                       04170002
042800             INITIALIZE PV-QMGR-NAME-PIX                          04180002
042900             MOVE WSV00006-QUE-MGR-TEXT TO                        04190002
043000                PV-QMGR-NAME-PIX                                  04200002
043100             INITIALIZE PV-QUE-NAME-PIX                           04210002
043200             MOVE WSV00006-QUE-NM-TEXT TO                         04220002
043300                PV-QUE-NAME-PIX                                   04230002
043400                                                                  04240002
043500           WHEN OTHER                                             04250002
043600             DISPLAY PC-PGM-NAME                                  04260002
043700                ' - Q OR QMGR ERROR IN PIXQUEUE/PIXTRLRUPD'       04270002
043800             MOVE 'Q OR QMGR ERROR IN PIXQUEUE/PIXTRLRUPD' TO     04280002
043900                PV-ERROR-MESSAGE                                  04290002
044000*        (CROAK)                                                  04300002
044100             PERFORM 9001-MQSERIES-ERROR                          04310002
044200       END-EVALUATE                                               04320002
044300     END-PERFORM.                                                 04330002
044400                                                                  04340002
044500******************************************************************04350002
044600* GETS MQ INFO FROM WSV_PRVDR_QUE (PUT/WRITE) - RC TRANSACTIONS.  04360002
044700******************************************************************04370002
044800 1130-GET-MQ-INFO-RC.                                             04380002
044900     IF PS-DISPLAY-YES                                            04390002
045000        DISPLAY 'WSKUT009 - 1130-GET-MQ-INFO-RC.'                 04400002
045100     END-IF.                                                      04410002
045200                                                                  04420002
045300     INITIALIZE WSV00005-LCL-QUE-MGR-TEXT.                        04430002
045400     INITIALIZE WSV00005-QUE-NM-TEXT.                             04440002
045500                                                                  04450002
045600     PERFORM WITH TEST AFTER                                      04460002
045700             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 04470002
045800             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         04480002
045900                     SQLCODE = ZERO                               04490002
046000                                                                  04500002
046100       EXEC SQL                                                   04510002
046200        SELECT LCL_QUE_MGR,                                       04520002
046300               QUE_NM                                             04530002
046400         INTO :WSV00005-LCL-QUE-MGR                               04540002
046500             ,:WSV00005-QUE-NM                                    04550002
046600         FROM WSV_PRVDR_QUE                                       04560002
046700        WHERE APPL_FUNC_DESC  = 'PIXLEGACYQ'                      04570002
046800          AND INTGRTN_TYP_CDE = 'PIXRC     '                      04580002
046900       END-EXEC                                                   04590002
047000                                                                  04600002
047100       IF PS-DISPLAY-YES                                          04610002
047200          DISPLAY ' RC  QMGR:' WSV00005-LCL-QUE-MGR-TEXT          04620002
047300          DISPLAY ' RC  QUE :' WSV00005-QUE-NM-TEXT               04630002
047400          DISPLAY ' SQL CDE :' SQLCODE                            04640002
047500       END-IF                                                     04650002
047600                                                                  04660002
047700       EVALUATE TRUE                                              04670002
047800           WHEN SQLCODE = 0                                       04680002
047900             INITIALIZE PV-QMGR-NAME-RC                           04690002
048000             MOVE WSV00005-LCL-QUE-MGR-TEXT TO                    04700002
048100                  PV-QMGR-NAME-RC                                 04710002
048200             INITIALIZE PV-QUE-NAME-RC                            04720002
048300             MOVE WSV00005-QUE-NM-TEXT TO                         04730002
048400                  PV-QUE-NAME-RC                                  04740002
048500                                                                  04750002
048600           WHEN OTHER                                             04760002
048700             DISPLAY PC-PGM-NAME                                  04770002
048800                ' - Q OR QMGR ERROR IN PIXLEGACYQ/PIXRC'          04780002
048900             MOVE 'Q OR QMGR ERROR IN PIXLEGACYQ/PIXRC'           04790002
049000                TO PV-ERROR-MESSAGE                               04800002
049100*        (CROAK)                                                  04810002
049200             PERFORM 9001-MQSERIES-ERROR                          04820002
049300       END-EVALUATE                                               04830002
049400     END-PERFORM.                                                 04840002
049500                                                                  04850002
049600******************************************************************04860002
049700* GETS MQ INFO FROM WSV_PRVDR_QUE (PUT/WRITE) - SU TRANSACTIONS.  04870002
049800******************************************************************04880002
049900 1140-GET-MQ-INFO-SU.                                             04890002
050000     IF PS-DISPLAY-YES                                            04900002
050100        DISPLAY 'WSKUT009 - 1140-GET-MQ-INFO-SU.'                 04910002
050200     END-IF.                                                      04920002
050300                                                                  04930002
050400     INITIALIZE WSV00005-LCL-QUE-MGR-TEXT.                        04940002
050500     INITIALIZE WSV00005-QUE-NM-TEXT.                             04950002
050600                                                                  04960002
050700     PERFORM WITH TEST AFTER                                      04970002
050800             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 04980002
050900             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         04990002
051000                     SQLCODE = ZERO                               05000002
051100                                                                  05010002
051200       EXEC SQL                                                   05020002
051300        SELECT LCL_QUE_MGR,                                       05030002
051400               QUE_NM                                             05040002
051500         INTO :WSV00005-LCL-QUE-MGR                               05050002
051600             ,:WSV00005-QUE-NM                                    05060002
051700         FROM WSV_PRVDR_QUE                                       05070002
051800        WHERE APPL_FUNC_DESC  = 'PIXLEGACYQ'                      05080002
051900          AND INTGRTN_TYP_CDE = 'PIXSU     '                      05090002
052000       END-EXEC                                                   05100002
052100                                                                  05110002
052200       IF PS-DISPLAY-YES                                          05120002
052300          DISPLAY ' SU  QMGR:' WSV00005-LCL-QUE-MGR-TEXT          05130002
052400          DISPLAY ' SU  QUE :' WSV00005-QUE-NM-TEXT               05140002
052500          DISPLAY ' SQL CDE :' SQLCODE                            05150002
052600       END-IF                                                     05160002
052610                                                                  05170002
052620       EVALUATE TRUE                                              05180002
052630           WHEN SQLCODE = 0                                       05190002
052640             INITIALIZE PV-QMGR-NAME-SU                           05200002
052650             MOVE WSV00005-LCL-QUE-MGR-TEXT TO                    05210002
052660                  PV-QMGR-NAME-SU                                 05220002
052670             INITIALIZE PV-QUE-NAME-SU                            05230002
052680             MOVE WSV00005-QUE-NM-TEXT TO                         05240002
052690                  PV-QUE-NAME-SU                                  05250002
052700                                                                  05260002
052800           WHEN OTHER                                             05261002
052900             DISPLAY PC-PGM-NAME                                  05262002
053000                ' - Q OR QMGR ERROR IN PIXLEGACYQ/PIXSU'          05263002
053100             MOVE 'Q OR QMGR ERROR IN PIXLEGACYQ/PIXSU'           05264002
053200                TO PV-ERROR-MESSAGE                               05265002
053300*        (CROAK)                                                  05266002
053400             PERFORM 9001-MQSERIES-ERROR                          05267002
053500       END-EVALUATE                                               05268002
053600     END-PERFORM.                                                 05269002
053700                                                                  05270002
053800******************************************************************05280002
053900* GETS MQ INFO FROM WSV_PRVDR_QUE (PUT/WRITE) - INTRANSIT TRANS.  05290002
054000******************************************************************05300002
054100 1150-GET-MQ-INFO-INTRANSIT.                                      05310002
054200     IF PS-DISPLAY-YES                                            05320002
054300        DISPLAY 'WSKUT009 - 1150-GET-MQ-INFO-INTRANSIT.'          05330002
054400     END-IF.                                                      05340002
054500                                                                  05350002
054600     INITIALIZE WSV00005-LCL-QUE-MGR-TEXT.                        05360002
054700     INITIALIZE WSV00005-QUE-NM-TEXT.                             05370002
054800                                                                  05380002
054900     PERFORM WITH TEST AFTER                                      05390002
055000             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 05400002
055100             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         05410002
055200                     SQLCODE = ZERO                               05420002
055300                                                                  05430002
055400       EXEC SQL                                                   05440002
055500        SELECT LCL_QUE_MGR,                                       05450002
055600               QUE_NM                                             05460002
055700         INTO :WSV00005-LCL-QUE-MGR                               05470002
055800             ,:WSV00005-QUE-NM                                    05480002
055900         FROM WSV_PRVDR_QUE                                       05490002
056000        WHERE APPL_FUNC_DESC  = 'PIXLEGACYQ'                      05500002
056100          AND INTGRTN_TYP_CDE = 'PIXINTRNST'                      05510002
056200       END-EXEC                                                   05520002
056300                                                                  05530002
056400       IF PS-DISPLAY-YES                                          05540002
056500          DISPLAY ' INTRNST QMGR:' WSV00005-LCL-QUE-MGR-TEXT      05550002
056600          DISPLAY ' INTRNST QUE :' WSV00005-QUE-NM-TEXT           05560002
056700          DISPLAY ' SQL CDE :' SQLCODE                            05570002
056800       END-IF                                                     05580002
056900                                                                  05590002
057000       EVALUATE TRUE                                              05600002
057100           WHEN SQLCODE = 0                                       05610002
057200             INITIALIZE PV-QMGR-NAME-INTRANSIT                    05620002
057300             MOVE WSV00005-LCL-QUE-MGR-TEXT TO                    05630002
057400                  PV-QMGR-NAME-INTRANSIT                          05640002
057500             INITIALIZE PV-QUE-NAME-INTRANSIT                     05650002
057600             MOVE WSV00005-QUE-NM-TEXT TO                         05660002
057700                  PV-QUE-NAME-INTRANSIT                           05670002
057800                                                                  05680002
057900           WHEN OTHER                                             05690002
058000             DISPLAY PC-PGM-NAME                                  05700002
058100                ' - Q OR QMGR ERROR IN PIXLEGACYQ/PIXINTRNST'     05710002
058200             MOVE 'Q OR QMGR ERROR IN PIXLEGACYQ/PIXINTRNST'      05720002
058300                TO PV-ERROR-MESSAGE                               05730002
058400*        (CROAK)                                                  05740002
058500             PERFORM 9001-MQSERIES-ERROR                          05750002
058600       END-EVALUATE                                               05760002
058700     END-PERFORM.                                                 05770002
058800                                                                  05780002
058900******************************************************************05790002
059000* GETS MQ INFO FROM WSV_PRVDR_QUE (PUT/WRITE) - ERROR QUEUE       05800002
059100******************************************************************05810002
059200 1160-GET-MQ-INFO-ERROR.                                          05820002
059300     IF PS-DISPLAY-YES                                            05830002
059400        DISPLAY 'WSKUT009 - 1160-GET-MQ-INFO-ERROR.'              05840002
059500     END-IF.                                                      05850002
059600                                                                  05860002
059700     INITIALIZE WSV00005-LCL-QUE-MGR-TEXT.                        05870002
059800     INITIALIZE WSV00005-QUE-NM-TEXT.                             05880002
059900                                                                  05890002
060000     PERFORM WITH TEST AFTER                                      05900002
060100             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 05910002
060200             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         05920002
060300                     SQLCODE = ZERO                               05930002
060400                                                                  05940002
060500       EXEC SQL                                                   05950002
060600        SELECT LCL_QUE_MGR,                                       05960002
060700               QUE_NM                                             05970002
060800         INTO :WSV00005-LCL-QUE-MGR                               05980002
060900             ,:WSV00005-QUE-NM                                    05990002
061000         FROM WSV_PRVDR_QUE                                       06000002
061100        WHERE APPL_FUNC_DESC  = 'PIXLEGACYQ'                      06010002
061200          AND INTGRTN_TYP_CDE = 'PIXFRWDERR'                      06020002
061300       END-EXEC                                                   06030002
061400                                                                  06040002
061500       IF PS-DISPLAY-YES                                          06050002
061600          DISPLAY ' ERROR QMGR:' WSV00005-LCL-QUE-MGR-TEXT        06060002
061700          DISPLAY ' ERROR QUE :' WSV00005-QUE-NM-TEXT             06070002
061800          DISPLAY ' SQL CDE :' SQLCODE                            06080002
061900       END-IF                                                     06090002
062000                                                                  06100002
062100       EVALUATE TRUE                                              06110002
062200           WHEN SQLCODE = 0                                       06120002
062300              INITIALIZE PV-QMGR-NAME-ERROR                       06130002
062400              MOVE WSV00005-LCL-QUE-MGR-TEXT TO                   06140002
062500                 PV-QMGR-NAME-ERROR                               06150002
062600              INITIALIZE PV-QUE-NAME-ERROR                        06160002
062700              MOVE WSV00005-QUE-NM-TEXT TO                        06170002
062800                 PV-QUE-NAME-ERROR                                06180002
062900                                                                  06190002
063000           WHEN OTHER                                             06200002
063100             DISPLAY PC-PGM-NAME                                  06210002
063200                ' - Q OR QMGR ERROR IN PIXLEGACYQ/PIXFRWDERR'     06220002
063300             MOVE 'Q OR QMGR ERROR IN PIXLEGACYQ/PIXFRWDERR' TO   06230002
063400                PV-ERROR-MESSAGE                                  06240002
063500*        (CROAK)                                                  06250002
063600             PERFORM 9001-MQSERIES-ERROR                          06260002
063700       END-EVALUATE                                               06270002
063800     END-PERFORM.                                                 06280002
063900                                                                  06290002
064000******************************************************************06300002
064100* CONNECT TO PIX QUEUE MANAGER.                                   06310002
064200******************************************************************06320002
064300 1200-MQSERIES-CONNECT.                                           06330002
064400     IF PS-DISPLAY-YES                                            06340002
064500        DISPLAY 'WSKUT009 - 1200-MQSERIES-CONNECT.'               06350002
064600     END-IF.                                                      06360002
064700                                                                  06370002
064800     CALL PC-MQCONN USING PV-QMGR-NAME-PIX                        06380002
064900                          PV-HCONN                                06390002
065000                          PV-COMPLETION-CODE                      06400002
065100                          PV-REASON.                              06410002
065200                                                                  06420002
065300*    IF CONNECTION FAILED THEN DISPLAY ERROR MESSAGE              06430002
065400*    AND EXIT                                                     06440002
065500                                                                  06450002
065600     MOVE PV-REASON TO PV-CON-REASON.                             06460002
065700     IF PV-COMPLETION-CODE = MQCC-OK THEN                         06470002
065800         CONTINUE                                                 06480002
065900     ELSE                                                         06490002
066000         STRING 'CONNECT - ' PV-QMGR-NAME-PIX                     06500002
066100           DELIMITED BY SIZE INTO PV-ACTION                       06510002
066200*        (CROAK)                                                  06520002
066300         PERFORM 9001-MQSERIES-ERROR.                             06530002
066400                                                                  06540002
066500***************************************************************** 06550002
066600*** OPEN THE ITEM QUEUE FOR GETS (300 PIX TRANSACTIONS).          06560002
066700***************************************************************** 06570002
066800 1300-MQSERIES-OPEN-PIX.                                          06580002
066900     IF PS-DISPLAY-YES                                            06590002
067000        DISPLAY 'WSKUT009 - 1300-MQSERIES-OPEN-PIX.'              06600002
067100     END-IF.                                                      06610002
067200                                                                  06620002
067300     MOVE '1300-MQSERIES-OPEN-PIX'     TO PV-PARAGRAPH.           06630002
067400                                                                  06640002
067500     COMPUTE PV-OPEN-OPTIONS        = MQOO-INPUT-SHARED           06650002
067600                                    + MQOO-OUTPUT                 06660002
067700                                    + MQOO-SET-IDENTITY-CONTEXT   06670002
067800                                    + MQOO-FAIL-IF-QUIESCING.     06680002
067900     MOVE MQOT-Q                   TO MQOD-OBJECTTYPE.            06690002
068000     MOVE PV-QMGR-NAME-PIX         TO MQOD-OBJECTQMGRNAME.        06700002
068100     MOVE PV-QUE-NAME-PIX          TO MQOD-OBJECTNAME.            06710002
068200                                                                  06720002
068300     IF PS-DISPLAY-YES                                            06730002
068400        DISPLAY "  MQOD-OBJECTQMGRNAME = " MQOD-OBJECTQMGRNAME    06740002
068500        DISPLAY "  MQOD-OBJECTNAME = " MQOD-OBJECTNAME            06750002
068600     END-IF.                                                      06760002
068610                                                                  06770002
068620     CALL PC-MQOPEN USING PV-HCONN                                06780002
068630                          MQM-OBJECT-DESCRIPTOR                   06790002
068640                          PV-OPEN-OPTIONS                         06800002
068650                          PV-HANDLE-PIX                           06810002
068660                          PV-COMPLETION-CODE                      06820002
068670                          PV-REASON.                              06830002
068680                                                                  06840002
068690*    IF OPEN FAILED THEN DISPLAY ERROR MESSAGE AND EXIT.          06850002
068700                                                                  06860002
068800     IF PV-COMPLETION-CODE = MQCC-OK THEN                         06861002
068900         CONTINUE                                                 06862002
069000     ELSE                                                         06863002
069100         STRING 'OPEN - ' PV-QUE-NAME-PIX                         06864002
069200           DELIMITED BY SIZE INTO PV-ACTION                       06865002
069300*        (CROAK)                                                  06866002
069400         PERFORM 9001-MQSERIES-ERROR.                             06867002
069500                                                                  06868002
069600***************************************************************** 06869002
069700*** OPEN THE OUTPUT QUEUE FOR PUTS (RC TRANSACTIONS).             06870002
069800***************************************************************** 06880002
069900 1310-MQSERIES-OPEN-RC.                                           06890002
070000     IF PS-DISPLAY-YES                                            06900002
070100        DISPLAY 'WSKUT009 - 1310-MQSERIES-OPEN-RC.'               06910002
070200     END-IF.                                                      06920002
070300                                                                  06930002
070400     COMPUTE PV-OPEN-OPTIONS        = MQOO-OUTPUT                 06940002
070500                                    + MQOO-SET-IDENTITY-CONTEXT   06950002
070600                                    + MQOO-FAIL-IF-QUIESCING.     06960002
070700     MOVE MQOT-Q                   TO MQOD-OBJECTTYPE.            06970002
070800     MOVE PV-QMGR-NAME-RC          TO MQOD-OBJECTQMGRNAME.        06980002
070900     MOVE PV-QUE-NAME-RC           TO MQOD-OBJECTNAME.            06990002
071000                                                                  07000002
071100     IF PS-DISPLAY-YES                                            07010002
071200        DISPLAY "  MQOD-OBJECTQMGRNAME = " MQOD-OBJECTQMGRNAME    07020002
071300        DISPLAY "  MQOD-OBJECTNAME = " MQOD-OBJECTNAME            07030002
071400     END-IF.                                                      07040002
071500                                                                  07050002
071600     CALL PC-MQOPEN USING PV-HCONN                                07060002
071700                          MQM-OBJECT-DESCRIPTOR                   07070002
071800                          PV-OPEN-OPTIONS                         07080002
071900                          PV-HANDLE-RC                            07090002
072000                          PV-COMPLETION-CODE                      07100002
072100                          PV-REASON.                              07110002
072200                                                                  07120002
072300*    IF OPEN FAILED THEN DISPLAY ERROR MESSAGE AND EXIT.          07130002
072400                                                                  07140002
072500     IF PV-COMPLETION-CODE = MQCC-OK THEN                         07150002
072600         CONTINUE                                                 07160002
072700     ELSE                                                         07170002
072800         STRING 'OPEN - ' PV-QUE-NAME-RC                          07180002
072900           DELIMITED BY SIZE INTO PV-ACTION                       07190002
073000*        (CROAK)                                                  07200002
073100         PERFORM 9001-MQSERIES-ERROR.                             07210002
073200                                                                  07220002
073300***************************************************************** 07230002
073400*** OPEN THE OUTPUT QUEUE FOR PUTS (SU TRANSACTIONS).             07240002
073500***************************************************************** 07250002
073600 1320-MQSERIES-OPEN-SU.                                           07260002
073700     IF PS-DISPLAY-YES                                            07270002
073800        DISPLAY 'WSKUT009 - 1320-MQSERIES-OPEN-SU.'               07280002
073810     END-IF.                                                      07290002
073820                                                                  07300002
073830     COMPUTE PV-OPEN-OPTIONS        = MQOO-OUTPUT                 07310002
073840                                    + MQOO-SET-IDENTITY-CONTEXT   07320002
073850                                    + MQOO-FAIL-IF-QUIESCING.     07330002
073860     MOVE MQOT-Q                   TO MQOD-OBJECTTYPE.            07340002
073870     MOVE PV-QMGR-NAME-SU          TO MQOD-OBJECTQMGRNAME.        07350002
073880     MOVE PV-QUE-NAME-SU           TO MQOD-OBJECTNAME.            07360002
073890                                                                  07370002
073900     IF PS-DISPLAY-YES                                            07380002
074000        DISPLAY "  MQOD-OBJECTQMGRNAME = " MQOD-OBJECTQMGRNAME    07381002
074100        DISPLAY "  MQOD-OBJECTNAME = " MQOD-OBJECTNAME            07382002
074200     END-IF.                                                      07383002
074300                                                                  07384002
074400     CALL PC-MQOPEN USING PV-HCONN                                07385002
074500                          MQM-OBJECT-DESCRIPTOR                   07386002
074600                          PV-OPEN-OPTIONS                         07387002
074700                          PV-HANDLE-SU                            07388002
074800                          PV-COMPLETION-CODE                      07389002
074900                          PV-REASON.                              07390002
075000                                                                  07400002
075100*    IF OPEN FAILED THEN DISPLAY ERROR MESSAGE AND EXIT.          07410002
075200                                                                  07420002
075300     IF PV-COMPLETION-CODE = MQCC-OK THEN                         07430002
075400         CONTINUE                                                 07440002
075500     ELSE                                                         07450002
075600         STRING 'OPEN - ' PV-QUE-NAME-SU                          07460002
075700           DELIMITED BY SIZE INTO PV-ACTION                       07470002
075800*        (CROAK)                                                  07480002
075900         PERFORM 9001-MQSERIES-ERROR.                             07490002
076000                                                                  07500002
076100***************************************************************** 07510002
076200*** OPEN THE OUTPUT QUEUE FOR PUTS (INTRANSIT TRANSACTIONS).      07520002
076300***************************************************************** 07530002
076400 1330-MQSERIES-OPEN-INTRANSIT.                                    07540002
076500     IF PS-DISPLAY-YES                                            07550002
076600        DISPLAY 'WSKUT009 - 1330-MQSERIES-OPEN-INTRNST'           07560002
076700     END-IF.                                                      07570002
076800                                                                  07580002
076900     COMPUTE PV-OPEN-OPTIONS        = MQOO-OUTPUT                 07590002
077000                                    + MQOO-SET-IDENTITY-CONTEXT   07600002
077100                                    + MQOO-FAIL-IF-QUIESCING.     07610002
077200     MOVE MQOT-Q                   TO MQOD-OBJECTTYPE.            07620002
077300     MOVE PV-QMGR-NAME-INTRANSIT   TO MQOD-OBJECTQMGRNAME.        07630002
077400     MOVE PV-QUE-NAME-INTRANSIT    TO MQOD-OBJECTNAME.            07640002
077500                                                                  07650002
077600     IF PS-DISPLAY-YES                                            07660002
077700        DISPLAY "  MQOD-OBJECTQMGRNAME = " MQOD-OBJECTQMGRNAME    07670002
077800        DISPLAY "  MQOD-OBJECTNAME = " MQOD-OBJECTNAME            07680002
077900     END-IF.                                                      07690002
077910                                                                  07700002
077920     CALL PC-MQOPEN USING PV-HCONN                                07710002
077930                          MQM-OBJECT-DESCRIPTOR                   07720002
077940                          PV-OPEN-OPTIONS                         07730002
077950                          PV-HANDLE-INTRANSIT                     07740002
077960                          PV-COMPLETION-CODE                      07750002
077970                          PV-REASON.                              07760002
077980                                                                  07770002
077990*    IF OPEN FAILED THEN DISPLAY ERROR MESSAGE AND EXIT.          07780002
078000                                                                  07790002
078100     IF PV-COMPLETION-CODE = MQCC-OK THEN                         07791002
078200         CONTINUE                                                 07792002
078300     ELSE                                                         07793002
078400         STRING 'OPEN - ' PV-QUE-NAME-INTRANSIT                   07794002
078500           DELIMITED BY SIZE INTO PV-ACTION                       07795002
078600*        (CROAK)                                                  07796002
078700         PERFORM 9001-MQSERIES-ERROR.                             07797002
078800                                                                  07798002
078900***************************************************************** 07799002
079000*** OPEN THE ITEM QUEUE FOR PUTS (ERROR TRANSACTIONS).            07800002
079100***************************************************************** 07810002
079200 1340-MQSERIES-OPEN-ERROR.                                        07820002
079300     IF PS-DISPLAY-YES                                            07830002
079400        DISPLAY 'WSKUT009 - 1340-MQSERIES-OPEN-ERROR.'            07840002
079500     END-IF.                                                      07850002
079600                                                                  07860002
079700     COMPUTE PV-OPEN-OPTIONS        = MQOO-OUTPUT                 07870002
079800                                    + MQOO-SET-IDENTITY-CONTEXT   07880002
079900                                    + MQOO-FAIL-IF-QUIESCING.     07890002
080000     MOVE MQOT-Q                   TO MQOD-OBJECTTYPE.            07900002
080100     MOVE PV-QMGR-NAME-ERROR       TO MQOD-OBJECTQMGRNAME.        07910002
080200     MOVE PV-QUE-NAME-ERROR        TO MQOD-OBJECTNAME.            07920002
080300                                                                  07930002
080400     IF PS-DISPLAY-YES                                            07940002
080500        DISPLAY "  MQOD-OBJECTQMGRNAME = " MQOD-OBJECTQMGRNAME    07950002
080600        DISPLAY "  MQOD-OBJECTNAME = " MQOD-OBJECTNAME            07960002
080700     END-IF.                                                      07970002
080800                                                                  07980002
080900     CALL PC-MQOPEN USING PV-HCONN                                07990002
081000                          MQM-OBJECT-DESCRIPTOR                   08000002
081100                          PV-OPEN-OPTIONS                         08010002
081200                          PV-HANDLE-ERROR                         08020002
081300                          PV-COMPLETION-CODE                      08030002
081400                          PV-REASON.                              08040002
081500                                                                  08050002
081600*    IF OPEN FAILED THEN DISPLAY ERROR MESSAGE AND EXIT.          08060002
081700                                                                  08070002
081800     IF PV-COMPLETION-CODE = MQCC-OK THEN                         08080002
081900         CONTINUE                                                 08090002
082000     ELSE                                                         08100002
082100         STRING 'OPEN - ' PV-QUE-NAME-ERROR                       08110002
082200           DELIMITED BY SIZE INTO PV-ACTION                       08120002
082300*        (CROAK)                                                  08130002
082400         PERFORM 9001-MQSERIES-ERROR                              08140002
082500     END-IF.                                                      08150002
082600                                                                  08160002
082700****************************************************************  08170002
082800** GET THE FIRST MESSAGE (PIX TRANSACTION) FROM THE QUEUE.        08180002
082900****************************************************************  08190002
083000 1400-GET-MQ-MESSAGE.                                             08200002
083100     IF PS-DISPLAY-YES                                            08210002
083200        DISPLAY 'WSKUT009 - 1400-GET-MQ-MESSAGE.'                 08220002
083300     END-IF.                                                      08230002
083310                                                                  08240002
083320     INITIALIZE PV-MSGBUFFER                                      08250002
083330                PV-MSG.                                           08260002
083340                                                                  08270002
083350     SET PS-SKIP-PROCESS-NO           TO TRUE                     08280002
083360                                                                  08290002
083370*MSG ID IS NOT POPULATED IN THIS PGM.                             08300002
083380     MOVE MQMI-NONE TO MQMD-MSGID.                                08310002
083390                                                                  08320002
083400*** THE UNLIMITED WAIT INTERVAL MEANS THAT PROCESSING WILL        08330002
083500*** CONTINUE UNTIL A END-OF-RUN MESSAGE APPEARS ON THE Q.         08331002
083600     MOVE MQWI-UNLIMITED       TO MQGMO-WAITINTERVAL.             08332002
083700                                                                  08333002
083800*MSGS ARE UNQUALIFIED IN THIS PGM.                                08334002
083900     MOVE MQCI-NONE         TO MQMD-CORRELID.                     08335002
084000                                                                  08336002
084100*FORMAT TRANSLATES THE DATA ACROSS PLATFORMS, 32432 IS THE        08337002
084200*MAX LENGTH FOR MSGS IN THE PGM.                                  08338002
084300     MOVE MQFMT-STRING         TO MQMD-FORMAT.                    08339002
084400     MOVE +32432               TO PV-MSG-LENGTH.                  08340002
084500                                                                  08350002
084600     COMPUTE MQGMO-OPTIONS  =  MQGMO-SYNCPOINT +                  08360002
084700                               MQGMO-CONVERT   +                  08370002
084800                               MQGMO-ACCEPT-TRUNCATED-MSG +       08380002
084900                               MQGMO-WAIT.                        08390002
085000                                                                  08400002
085100     CALL PC-MQGET USING PV-HCONN                                 08410002
085200                         PV-HANDLE-PIX                            08420002
085300                         MQM-MESSAGE-DESCRIPTOR                   08430002
085400                         MQM-GET-MESSAGE-OPTIONS                  08440002
085500                         PV-MSG-LENGTH                            08450002
085600                         PV-MSGBUFFER(1:32432)                    08460002
085700                         PV-DATA-LENGTH                           08470002
085800                         PV-COMPLETION-CODE                       08480002
085900                         PV-REASON.                               08490002
086000                                                                  08500002
086100*IF GET FAILED THEN DISPLAY ERROR MESSAGE                         08510002
086200*AND BREAK OUT OF LOOP                                            08520002
086300     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        08530002
086400         IF ((PV-REASON NOT = MQRC-NO-MSG-AVAILABLE)              08540002
086500          AND (PV-REASON NOT = MQRC-TRUNCATED-MSG-ACCEPTED))      08550002
086600            IF PS-DISPLAY-YES                                     08560002
086700               DISPLAY 'PV-MSGBUFF1:' PV-MSGBUFFER                08570002
086800               DISPLAY 'PV-MSGLNGT1:' PV-MSG-LENGTH               08580002
086900               DISPLAY 'PV-DATLNGT1:' PV-DATA-LENGTH              08590002
087000               DISPLAY 'PV-COMPLCD1:' PV-COMPLETION-CODE          08600002
087100               DISPLAY 'PV-REASON1 :' PV-REASON                   08610002
087200            END-IF                                                08620002
087300            MOVE 'MQGET ERROR'          TO PV-ERROR-MESSAGE       08630002
087400            MOVE '1400-GET-MQ-MSG'      TO PV-PARAGRAPH           08640002
087500            MOVE PV-COMPLETION-CODE     TO IS-COMPLETION          08650002
087600            MOVE PV-REASON              TO IS-REASON-TEXT         08660002
087700            STRING 'GET - ' PV-QMGR-NAME-PIX                      08670002
087800            DELIMITED BY SIZE INTO PV-ACTION                      08680002
087900*        (CROAK)                                                  08690002
088000            PERFORM 9001-MQSERIES-ERROR                           08700002
088100         ELSE                                                     08710002
088200*THIS MEANS A MSG WAS TRUNCATED                                   08720002
088300            IF PV-COMPLETION-CODE = +1                            08730002
088400             AND PV-REASON = MQRC-TRUNCATED-MSG-ACCEPTED          08740002
088500               IF PS-DISPLAY-YES                                  08750002
088600                  DISPLAY 'PV-MSGBUFF2:' PV-MSGBUFFER             08760002
088700                  DISPLAY 'PV-MSGLNGT2:' PV-MSG-LENGTH            08770002
088800                  DISPLAY 'PV-DATLNGT2:' PV-DATA-LENGTH           08780002
088900                  DISPLAY 'PV-COMPLCD2:' PV-COMPLETION-CODE       08790002
089000                  DISPLAY 'PV-REASON2 :' PV-REASON                08800002
089100               END-IF                                             08810002
089110               MOVE PV-COMPLETION-CODE     TO IS-COMPLETION       08820002
089120               MOVE PV-REASON              TO IS-REASON-TEXT      08830002
089130               ADD +1          TO PA-TOTAL-MQ-PIX-MSGS-READ       08840002
089140               STRING 'GET - ' PV-QMGR-NAME-PIX 'MSG TRUNCATED'   08850002
089150               DELIMITED BY SIZE INTO PV-ACTION                   08860002
089160*        (CROAK)                                                  08870002
089170               PERFORM 9001-MQSERIES-ERROR                        08880002
089180            ELSE                                                  08890002
089190               IF (PV-REASON = MQRC-NO-MSG-AVAILABLE)             08900002
089200                  SET PS-END-OF-PIX-YES TO TRUE                   08910002
089300                  IF PS-DISPLAY-YES                               08911002
089400                     DISPLAY 'END OF MES:' PS-END-OF-PIX-SW       08912002
089500                  END-IF                                          08913002
089600               END-IF                                             08914002
089700            END-IF                                                08915002
089800         END-IF                                                   08916002
089900     ELSE                                                         08917002
090000         MOVE PV-MSGBUFFER  TO PV-MSG                             08918002
090100         ADD +1             TO PA-TOTAL-MQ-PIX-MSGS-READ          08919002
090200         IF PS-DISPLAY-YES                                        08920002
090300            DISPLAY 'PV-MSGBUFF3:' PV-MSGBUFFER                   08930002
090400            DISPLAY 'PV-MSGLNGT3:' PV-MSG-LENGTH                  08940002
090500            DISPLAY 'PV-DATLNGT3:' PV-DATA-LENGTH                 08950002
090600            DISPLAY 'PV-COMPLCD3:' PV-COMPLETION-CODE             08960002
090700            DISPLAY 'PV-REASON3 :' PV-REASON                      08970002
090800         END-IF                                                   08980002
090900     END-IF.                                                      08990002
091000                                                                  09000002
091100***                                                               09010002
091200     MOVE MQMD-PRIORITY             TO PV-DISPLAY-PRIORITY.       09020002
091300     IF PS-DISPLAY-YES                                            09030002
091400        DISPLAY ' MQGET MQMD-PRIORITY: '  PV-DISPLAY-PRIORITY     09040002
091500     END-IF.                                                      09050002
091600***                                                               09060002
091700****************************************************************  09070002
091800** PROCESS THE XML.                                               09080002
091900****************************************************************  09090002
092000 2000-PROCESS-XML.                                                09100002
092100     IF PS-DISPLAY-YES                                            09110002
092200        DISPLAY 'WSKUT009 - 2000-PROCESS-XML.'                    09120002
092300     END-IF.                                                      09130002
092400                                                                  09140002
092500     XML PARSE PV-MSG                                             09150002
092600         PROCESSING PROCEDURE                                     09160002
092700             2100-HANDLE-XML                                      09170002
092800         ON EXCEPTION                                             09180002
092900             PERFORM 3000-XML-ERROR                               09190002
093000         NOT ON EXCEPTION                                         09200002
093100             PERFORM 3100-XML-SUCCESS                             09210002
093200     END-XML.                                                     09220002
093300                                                                  09230002
093400*    THERE ARE NO DB2 UPDATE/INSERTS/DELETES DONE HERE            09240002
093500*    SO THERE'S NO NEED TO DO A DB2 COMMIT                        09250002
093600                                                                  09260002
093700     PERFORM 8500-MQ-COMMIT.                                      09270002
093800                                                                  09280002
093810     SET PS-ERROR-REC-WRITTEN-NO  TO TRUE.                        09290002
093820     IF PS-TIME-TO-END-PROGRAM-YES                                09300002
093830         CONTINUE                                                 09310002
093840     ELSE                                                         09320002
093850         PERFORM 1400-GET-MQ-MESSAGE                              09330002
093860     END-IF.                                                      09340002
093870                                                                  09350002
093880******************************************************************09360002
093890* PROCESS PIX MESSAGES TO MOVE FIELDS TO THE OUTPUT MESSAGE FILE. 09370002
093900* DC NUMBER IS SAVED AS A VARIABLE NAME FOR FUTURE USE.           09380002
094000******************************************************************09381002
094100*A TRANSACTION TYPE OF "999" WILL END PROCESS                     09382002
094200*AND SHUT DOWN THIS STARTED TASK.                                 09383002
094300******************************************************************09384002
094400 2100-HANDLE-XML.                                                 09385002
094401                                                                  09386002
094410*FJW 05/14/2010 BEGIN                                             09387002
094420     IF PS-DISPLAY-YES                                            09388002
094430        DISPLAY 'WSKUT009 - 2100-HANDLE-XML.'                     09389002
094440     END-IF.                                                      09390002
094450*FJW 05/14/2010 END                                               09400002
094500                                                                  09410002
094600     COMPUTE XML-LENGTH = FUNCTION LENGTH(XML-TEXT).              09420002
094750                                                                  09430002
094800     EVALUATE XML-EVENT                                           09440002
094900                                                                  09441002
095000       WHEN 'START-OF-ELEMENT'                                    09442002
095100         MOVE XML-TEXT(1:XML-LENGTH) TO PV-CURRENT-ELEMENT        09443002
095200                                                                  09444002
095300       WHEN 'END-OF-ELEMENT'                                      09445002
095400                                                                  09446002
095500         EVALUATE XML-TEXT(1:XML-LENGTH)                          09447002
095600           WHEN 'PIXBridge'                                       09448002
095700                 PERFORM 3200-WRITE-RECS-LOGIC                    09449002
095800           WHEN 'TransactionType'                                 09450002
095900              IF PS-TIME-TO-END-PROGRAM-YES                       09460002
096000                 PERFORM 4000-MQ-CLEANUP                          09470002
096100                 PERFORM 9300-WRAPUP                              09480002
096200              END-IF                                              09490002
096300           WHEN OTHER                                             09500002
096400                 CONTINUE                                         09510002
096500         END-EVALUATE                                             09520002
096600                                                                  09530002
096700       WHEN 'ATTRIBUTE-NAME'                                      09540002
096800         MOVE XML-TEXT(1:XML-LENGTH) TO PV-CURRENT-ATTRIBUTE      09550002
096900                                                                  09560002
097000       WHEN 'ATTRIBUTE-CHARACTERS'                                09570002
097100       WHEN 'ATTRIBUTE-CHARACTER'                                 09580002
097200       WHEN 'CONTENT-CHARACTERS'                                  09590002
097300       WHEN 'CONTENT-CHARACTER'                                   09600002
097400         EVALUATE PV-CURRENT-ELEMENT                              09610002
097500           WHEN 'TransactionType'                                 09620002
097600             MOVE XML-TEXT(1:XML-LENGTH) TO PV-TRANSACTION-TYPE   09630002
097700             IF PV-TRANSACTION-TYPE     = '999'                   09640002
097800                SET PS-DISPLAY-PENDING         TO TRUE            09650002
097900*               SET PS-TIME-TO-END-PROGRAM-YES TO TRUE            09660002
098000*               MOVE -1 TO XML-CODE                               09670002
098100*               ADD +1 TO PA-999-STOP-PROC-MESSAGES               09680002
098200*               SUBTRACT 1 FROM PA-TOTAL-MQ-PIX-MSGS-READ         09690002
098300             END-IF                                               09700002
098400                                                                  09710002
098500           WHEN 'TransactionCode'                                 09720002
098600             MOVE XML-TEXT(1:XML-LENGTH) TO PV-TRANSACTION-CODE   09730002
098700                                            PV-TRAN-CDE           09740002
098800                                                                  09750002
098900*     WHEN A DEBUG CONTROL MESSAGE IS READ WE DO NOT WANT         09760002
099000*     TO DO ANY OF THE NORMAL PROCESSING.  IT SHOULD JUST SET     09770002
099100*     THE DISPLAY SWITCH AND LEAVE TO GET THE NEXT MESSAGE.       09780002
099200                                                                  09790002
099300         IF PS-DISPLAY-PENDING                                    09800002
099400             EVALUATE TRUE                                        09810002
099500                 WHEN PV-TRAN-CDE = 'Y'                           09820002
099600                     SET PS-DISPLAY-YES                           09830002
099700                         PS-SKIP-PROCESS-YES TO TRUE              09840002
099800                     MOVE -1 TO XML-CODE                          09850002
099900                     DISPLAY '***  DEBUG DISPLAYS TURNED ON  ***' 09860002
100000                     ADD 1           TO PA-DEBUG-MESSAGES         09870002
100100                 WHEN PV-TRAN-CDE = 'N'                           09880002
100200                     DISPLAY '***  DEBUG DISPLAYS TURNED OFF  ***'09890002
100300                     MOVE -1 TO XML-CODE                          09900002
100400                     SET PS-DISPLAY-NO                            09910002
100500                         PS-SKIP-PROCESS-YES TO TRUE              09920002
100600                     ADD 1           TO PA-DEBUG-MESSAGES         09930002
100700                 WHEN OTHER                                       09940002
100800                     DISPLAY                                      09950002
100900                          '***  END PROGRAM MSG DETECTED  ***'    09960002
101000                     SET PS-TIME-TO-END-PROGRAM-YES               09970002
101100                         PS-SKIP-PROCESS-YES TO TRUE              09980002
101200                     MOVE -1 TO XML-CODE                          09990002
101300                     ADD +1 TO PA-999-STOP-PROC-MESSAGES          10000002
101400                     SUBTRACT 1 FROM PA-TOTAL-MQ-PIX-MSGS-READ    10010002
101500             END-EVALUATE                                         10020002
101600                                                                  10030002
101700         ELSE                                                     10040002
101701             PERFORM 6500-VALIDATE-PIX-ROUTING                    10050002
101702         END-IF                                                   10060002
101703                                                                  10070002
101704** SINCE 6500- HAS CHECKED FOR INVALID CODES, NO NEED TO CHECK    10080002
101705** FOR INVALID CODES HERE.  WE CAN MAKE DIRECT ASSIGNMENTS.       10090002
101706                                                                  10100002
101718             IF PV-TRANSACTION-TYPE = '606' AND                   10110002
101719                      PV-TRANSACTION-CODE = '03'                  10120002
101720                MOVE 'CR' TO WS014-RCVNG-TRANS-TYPE               10130002
101721             END-IF                                               10140002
101722             IF PV-TRANSACTION-TYPE = '603' AND                   10150002
101723                      PV-TRANSACTION-CODE = '01'                  10160002
101724                MOVE 'VS' TO WS014-RCVNG-TRANS-TYPE               10170002
101725             END-IF                                               10171002
101726             IF PV-TRANSACTION-TYPE = '611' AND                   10172002
101727                      PV-TRANSACTION-CODE = '04'                  10172102
101728                MOVE 'CI' TO WS014-RCVNG-TRANS-TYPE               10172202
101729             END-IF                                               10172302
101730             IF PV-TRANSACTION-TYPE = '300'                       10172402
101731                MOVE 'CA' TO WS014-RCVNG-TRANS-TYPE               10172502
101732                MOVE 'P'  TO PV-ASN-ORGN-TYPE-1                   10172602
101733             END-IF                                               10172702
101734           WHEN 'DCNumber'                                        10172802
101735             MOVE XML-TEXT(1:XML-LENGTH) TO PV-DC-NUMBER          10172902
101736             MOVE PV-DC-NUMBER-NUMERIC   TO WS014-DC-LOCATION     10173002
101737*FJW 05/14/2010 BEGIN                                             10173102
101738             MOVE PV-DC-NUMBER-NUMERIC                            10173202
101739               TO PV-DC-NBR-LOOKUP-COMP                           10173302
101741             PERFORM 2150-LOOKUP-STORE-NUMBER                     10173402
101744*FJW 05/14/2010 END                                               10173502
101745           WHEN 'CaseNumber'                                      10173602
101746             MOVE XML-TEXT(1:XML-LENGTH) TO PV-CASE-NUMBER        10173702
101747             MOVE PV-CASE-NUMBER(1:20)   TO WS014-CASE-NUMBER     10173802
101748           WHEN 'StyleSuffix'                                     10173902
101749             MOVE XML-TEXT(1:XML-LENGTH) TO PV-SKU-NUMBER         10174002
101750             MOVE PV-SKU-NUMBER-NUMERIC  TO WS014-SKU-NUMBER      10174102
101751           WHEN 'InvAdjustmentQty'                                10174202
101760             MOVE XML-TEXT(1:XML-LENGTH) TO PV-ADJ-QTY-CONVERT    10174302
101770             MOVE PV-ADJ-QTY-NUM TO PV-ADJ-QTY-CONVRTD            10174402
101780             ADD PV-ADJ-QTY-SIG  TO WS014-SKU-QTY                 10174502
101790           WHEN 'InvAdjustmentType'                               10174602
101800             MOVE XML-TEXT(1:XML-LENGTH) TO WS014-SKU-ADJ-IND     10174702
101900           WHEN 'As400UserID'                                     10174802
102000             MOVE XML-TEXT(1:XML-LENGTH) TO PV-USER-ID            10174902
102100             MOVE PV-USER-ID(1:8) to WS014-CRE-USER-ID            10175002
102200           WHEN 'Reference1'                                      10176002
102300             MOVE XML-TEXT(1:XML-LENGTH) TO WS014-ORIG-SHIPMT-NBR 10177002
102400           WHEN 'Reference2'                                      10178002
102500             MOVE XML-TEXT(1:XML-LENGTH) TO WS014-RCVD-SHPMT-NBR  10179002
102600           WHEN 'Reference3'                                      10180002
102700             IF WS014-CASE-ADJUSTMT                               10190002
102710                CONTINUE                                          10200002
102720             ELSE                                                 10210002
102730                MOVE XML-TEXT(1:XML-LENGTH) TO PV-ASN-ORGN-TYPE   10220002
102740                MOVE PV-ASN-ORGN-TYPE(20:1) TO PV-ASN-ORGN-TYPE-1 10230002
102750             END-IF                                               10240002
102760* NOTE:  tran 606-03 will actually get sent to both the           10250002
102770*        intransit q and the receiving q - see paragraph 5000-    10260002
102780                                                                  10270002
102790*gb 7/18/07beg                                                    10271002
102800* Added check- if a Findlay SML is scanned on against             10272002
102900* a vendor shpmt, route to intransit queue.  If a vendr           10273002
103000* case is scanned against a findlay shpmt, route to the error q   10274002
103100* gb 7/18/07end                                                   10275002
103110                                                                  10276002
103120             EVALUATE PV-ASN-ORGN-TYPE-1                          10277002
103130                WHEN 'P'                                          10278002
103140                   IF PC-SML-CRTN-PREFIX = WS014-CASE-NUMBER(1:4) 10279002
103150* JAK 10/2009 ADD 1 LINE                                          10280002
103160                   OR PC-SML-CRTN-PREFX2 = WS014-CASE-NUMBER(1:4) 10290002
103170                      IF PV-TRANSACTION-TYPE = '606'              10300002
103180                         MOVE 'I' TO WS014-TRANS-TYPE-CODE        10310002
103190                      ELSE                                        10311002
103200                         MOVE 'S' TO WS014-TRANS-TYPE-CODE        10312002
103300                      END-IF                                      10313002
103310                   ELSE                                           10314002
103320                      MOVE 'R' TO WS014-TRANS-TYPE-CODE           10315002
103330                   END-IF                                         10316002
103340                WHEN 'M'                                          10317002
103350                   IF PC-SML-CRTN-PREFIX = WS014-CASE-NUMBER(1:4) 10318002
103360* JAK 10/2009 ADD 1 LINE                                          10319002
103370                   OR PC-SML-CRTN-PREFX2 = WS014-CASE-NUMBER(1:4) 10320002
103380                      IF PV-TRANSACTION-TYPE = '606'              10330002
103390                         MOVE 'I' TO WS014-TRANS-TYPE-CODE        10331002
103400                      ELSE                                        10332002
103500                         MOVE 'S' TO WS014-TRANS-TYPE-CODE        10333002
103600                      END-IF                                      10334002
103700                   ELSE                                           10335002
103800                      MOVE WS014-CASE-NUMBER TO PV-CASE-NBR-CH    10336002
103900                      MOVE PV-CASE-NBR                            10337002
104000                                   TO SUT00024-ORIG-CART-ID       10338002
104100                      PERFORM 6600-VALIDATE-CASE-SHIPMT           10339002
104110                      IF PS-CASE-TO-SHPMT-CHCK-YES                10340002
104111                         IF PV-TRANSACTION-TYPE = '606'           10350002
104112                            MOVE 'I' TO WS014-TRANS-TYPE-CODE     10360002
104113                         ELSE                                     10370002
104114                            MOVE 'S' TO WS014-TRANS-TYPE-CODE     10380002
104115                         END-IF                                   10390002
104116                      END-IF                                      10400002
104117                   END-IF                                         10410002
104118                WHEN OTHER                                        10411002
104119                   SET WS027-INVALID-REC TO TRUE                  10411102
104120                   PERFORM 8999-ERROR-PROCESSING-XML              10411202
104130             END-EVALUATE                                         10411302
104140           WHEN 'Reference4'                                      10411402
104150             IF  PV-TRANSACTION-TYPE = '611' AND                  10411502
104160                 PV-TRANSACTION-CODE = '04'                       10411602
104170                 MOVE XML-TEXT(1:XML-LENGTH) TO PV-SEAL           10411702
104180                 MOVE PV-SEAL             TO WS014-SEAL           10411802
104190             ELSE                                                 10411902
104200                 MOVE XML-TEXT(1:XML-LENGTH) TO PV-PO-NUMBER      10412002
104300                 MOVE PV-PO-NUMERIC       TO WS014-PO-NUMBER      10413002
104400             END-IF                                               10414002
104500           WHEN 'Reference5'                                      10415002
104600             IF  PV-TRANSACTION-TYPE = '611' AND                  10416002
104700                 PV-TRANSACTION-CODE = '04'                       10417002
104800                 MOVE ZERO TO WS014-REC-SEQ-NUMBER                10418002
104900             ELSE                                                 10419002
105000                 MOVE XML-TEXT(1:XML-LENGTH)                      10420002
105100                                         TO PV-DC-ORD-NUMBER      10430002
105200                 MOVE PV-DC-ORD-NUMERIC                           10440002
105300                                        TO WS014-REC-SEQ-NUMBER   10450002
105400                                           WS014-REC-SEQ-NUMBER   10460002
105500             END-IF                                               10470002
105600* jak 05/2007 - po line number can be in field 6 or 10, so        10480002
105700*               first check to see if it is loaded                10490002
105800           WHEN 'Reference6'                                      10500002
105900             IF  PV-TRANSACTION-TYPE = '611' AND                  10510002
106000                 PV-TRANSACTION-CODE = '04'                       10520002
106100                 MOVE ZERO TO WS014-PO-LINE-NUMBER                10530002
106200             ELSE                                                 10540002
106300                 IF XML-TEXT(1:XML-LENGTH) NOT = SPACES           10550002
106400                    MOVE XML-TEXT(1:XML-LENGTH)                   10560002
106500                                         TO PV-PO-LINE-NUMBER     10570002
106600                    MOVE PV-PO-LINE-NUMERIC                       10580002
106700                                       TO WS014-PO-LINE-NUMBER    10590002
106800                 END-IF                                           10600002
106900             END-IF                                               10610002
107000           WHEN 'Reference7'                                      10620002
107100             IF XML-TEXT(1:XML-LENGTH) = SPACES                   10630002
107200                MOVE SPACES TO WS014-VEHICLE                      10640002
107300             ELSE                                                 10650002
107400                MOVE XML-TEXT(1:XML-LENGTH) TO PV-VEHICLE         10660002
107500                MOVE PV-VEHICLE(11:10)      TO WS014-VEHICLE      10670002
107600             END-IF                                               10680002
107700           WHEN 'Reference8'                                      10690002
107800             IF XML-TEXT(1:XML-LENGTH) = SPACES                   10700002
107900                MOVE SPACES TO WS014-SCAC                         10710002
108000             ELSE                                                 10720002
108100                MOVE XML-TEXT(1:XML-LENGTH) TO PV-SCAC            10730002
108200                MOVE PV-SCAC(17:04)      TO WS014-SCAC            10740002
108300             END-IF                                               10750002
108400           WHEN 'Reference9'                                      10760002
108500             IF XML-TEXT(1:XML-LENGTH) = SPACES                   10770002
108600                MOVE SPACES TO WS014-DOOR-ID                      10780002
108700             ELSE                                                 10790002
108800                MOVE XML-TEXT(1:XML-LENGTH) TO PV-DOOR-ID         10800002
108900                MOVE PV-DOOR-ID(17:04)   TO WS014-DOOR-ID         10810002
109000             END-IF                                               10820002
109100* jak 05/2007 - po line number can be in field 6 or 10, so        10830002
109200*               first check to see if it is loaded                10840002
109300           WHEN 'Reference10'                                     10850002
109400             IF  PV-TRANSACTION-TYPE = '611' AND                  10860002
109500                 PV-TRANSACTION-CODE = '04'                       10870002
109600                 MOVE ZERO TO WS014-PO-LINE-NUMBER                10880002
109700             ELSE                                                 10890002
109800                 IF XML-TEXT(1:XML-LENGTH) NOT = SPACES           10900002
109900                    MOVE XML-TEXT(1:XML-LENGTH)                   10910002
110000                                         TO PV-PO-LINE-NUMBER     10920002
110100                    MOVE PV-PO-LINE-NUMERIC                       10930002
110200                                       TO WS014-PO-LINE-NUMBER    10940002
110300                 END-IF                                           10950002
110400             END-IF                                               10960002
110500           WHEN 'DateCreated'                                     10970002
110600             MOVE XML-TEXT(1:XML-LENGTH) TO                       10980002
110700                                   PV-WMOS-DATE-CREATED           10990002
110800             MOVE PV-WMOS-DATE-YYYY TO PV-TRANS-DATE-YYYY         11000002
110900             MOVE PV-HYPHEN-1       TO PV-TRANS-HYPHEN-1          11010002
111000             MOVE PV-WMOS-DATE-MM   TO PV-TRANS-DATE-MM           11020002
111100             MOVE PV-HYPHEN-2       TO PV-TRANS-HYPHEN-2          11030002
111200             MOVE PV-WMOS-DATE-DD   TO PV-TRANS-DATE-DD           11040002
111300             MOVE PV-HYPHEN-2       TO PV-TRANS-HYPHEN-3          11050002
111400             MOVE PV-WMOS-DATE-HH   TO PV-TRANS-DATE-HH           11060002
111500             MOVE '.'               TO PV-TRANS-DOT-1             11070002
111600             MOVE PV-WMOS-DATE-MN   TO PV-TRANS-DATE-MN           11080002
111700             MOVE '.'               TO PV-TRANS-DOT-2             11090002
111800             MOVE PV-WMOS-DATE-SS   TO PV-TRANS-DATE-SS           11100002
111900             MOVE '.'               TO PV-TRANS-DOT-3             11110002
112000             MOVE ZERO              TO PV-TRANS-DATE-NS           11120002
112100             MOVE PV-TRANS-DATE     TO WS014-CRE-TMST             11130002
112200           WHEN OTHER                                             11140002
112300             CONTINUE                                             11150002
112400         END-EVALUATE                                             11160002
112500                                                                  11170002
112600       WHEN 'EXCEPTION'                                           11180002
112700         DISPLAY 'Exception Caught at ' XML-TEXT(1:XML-LENGTH)    11190002
112800                                                                  11200002
112900     END-EVALUATE.                                                11210002
113000                                                                  11220002
113010*FJW 05/14/2010 BEGIN                                             11230002
113020 2150-LOOKUP-STORE-NUMBER.                                        11240002
113030                                                                  11250002
113040     IF PS-DISPLAY-YES                                            11260002
113050        DISPLAY 'WSKUT009 - 2150-LOOKUP-STORE-NUMBER.'            11270002
113060     END-IF.                                                      11280002
113070                                                                  11290002
113080     EXEC SQL                                                     11300002
113090          SELECT WMOS_LOC_NBR                                     11301002
113091            INTO :PV-WMOS-LOC-NBR-TEXT                            11302002
113092            FROM WSV_LOC_XREF                                     11303002
113093           WHERE KOHLS_LOC_NBR = :PV-DC-NBR-LOOKUP-COMP           11304002
113094     END-EXEC.                                                    11305002
113095                                                                  11306002
113096     EVALUATE TRUE                                                11307002
113097         WHEN SQLCODE = ZERO                                      11308002
113098              MOVE PV-WMOS-LOC-NBR-TEXT(1:3)                      11309002
113099                TO PV-STORE-NUMBER-X                              11309102
113100              INSPECT PV-STORE-NUMBER-X                           11309202
113101                      REPLACING LEADING SPACES BY ZEROS           11309302
113102              MOVE PV-STORE-NUMBER-NUMERIC                        11309402
113103                TO WS014-STORE-NUMBER                             11309502
113104                                                                  11309602
113105         WHEN SQLCODE = +100                                      11309702
113106              MOVE ZERO                                           11309802
113107                TO WS014-STORE-NUMBER                             11309902
113108                                                                  11310002
113109              INITIALIZE WS027-RECEIPT-PIX-ERROR-REC              11310102
113110              MOVE 'A'                                            11310202
113111                TO WS027-ERROR-TYPE-CDE                           11310302
113112              MOVE PC-PGM-NAME                                    11310402
113113                TO WS027-ERROR-PGM-NAME                           11310502
113114              MOVE 'WSRD014'                                      11310602
113115                TO WS027-ERROR-COPYBOOK                           11310702
113116              MOVE '2150-'                                        11310802
113117                TO WS027-ERROR-PARA-NBR                           11310902
113118              MOVE 'KOHLS_LOC_NBR NOT FOUND'                      11311002
113119                TO WS027-ERROR-DESC-TXT                           11311102
113120              MOVE SQLCODE                                        11311202
113121                TO WS027-SQLCODE                                  11311302
113122              MOVE 'PIX TRANS TYPE '                              11311402
113123                TO WS027-FORMAT-RECORD(1:15)                      11311502
113124              MOVE PV-TRANSACTION-TYPE(1:3)                       11311602
113125                TO WS027-FORMAT-RECORD(16:3)                      11311702
113126              MOVE 'PIX TRANS CODE:'                              11311802
113127                TO WS027-FORMAT-RECORD(20:15)                     11311902
113128              MOVE PV-TRANSACTION-CODE(1:3)                       11312002
113129                TO WS027-FORMAT-RECORD(36:3)                      11312102
113130              MOVE WS014-RECEIPT-PIX-RECORD                       11312202
113131                TO WS027-FORMAT-RECORD(40:203)                    11312302
113132              PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                11312402
113133              SET  PS-ERROR-REC-WRITTEN-YES TO TRUE               11312502
113134                                                                  11312602
113135         WHEN OTHER                                               11312702
113136              MOVE ZERO                                           11312802
113137                TO WS014-STORE-NUMBER                             11312902
113138                                                                  11313002
113139              INITIALIZE WS027-RECEIPT-PIX-ERROR-REC              11313102
113140              MOVE 'C'                                            11313202
113141                TO WS027-ERROR-TYPE-CDE                           11313302
113142              MOVE PC-PGM-NAME                                    11313402
113143                TO WS027-ERROR-PGM-NAME                           11313502
113144              MOVE 'WSRD014'                                      11313602
113145                TO WS027-ERROR-COPYBOOK                           11313702
113146              MOVE '2150-'                                        11313802
113147                TO WS027-ERROR-PARA-NBR                           11313902
113148              MOVE 'INVALID SQLCODE RETURNED'                     11314002
113149                TO WS027-ERROR-DESC-TXT                           11314102
113150              MOVE SQLCODE                                        11314202
113151                TO WS027-SQLCODE                                  11314302
113152              MOVE 'PIX TRANS TYPE '                              11314402
113153                TO WS027-FORMAT-RECORD(1:15)                      11314502
113154              MOVE PV-TRANSACTION-TYPE(1:3)                       11314602
113155                TO WS027-FORMAT-RECORD(17:3)                      11314702
113156              MOVE 'PIX TRANS CODE:'                              11314802
113157                TO WS027-FORMAT-RECORD(21:15)                     11314902
113158              MOVE PV-TRANSACTION-CODE(1:3)                       11315002
113159                TO WS027-FORMAT-RECORD(37:3)                      11315102
113160              MOVE WS014-RECEIPT-PIX-RECORD                       11315202
113161                TO WS027-FORMAT-RECORD(41:203)                    11315302
113162              PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                11315402
113163              SET  PS-ERROR-REC-WRITTEN-YES TO TRUE               11315502
113164                                                                  11315602
113165     END-EVALUATE.                                                11315702
113166*FJW 05/14/2010 END                                               11315802
113167                                                                  11315902
113170 3000-XML-ERROR.                                                  11316002
113200     IF PS-DISPLAY-YES                                            11316102
113300        DISPLAY 'WSKUT009 - 3000-XML-ERROR.'                      11316202
113400     END-IF.                                                      11316302
113500                                                                  11316402
113600     IF XML-CODE NOT = -1                                         11316502
113700        PERFORM 9000-EXPLAIN-XML-RESPONSE                         11316602
113800        PERFORM  VARYING XML-LINE-IDX FROM 1 BY 1                 11316702
113900                UNTIL XML-LINE-IDX > XML-RESPONSE-LINES           11316802
114000            DISPLAY XML-MSG(XML-LINE-IDX)                         11316902
114100        END-PERFORM                                               11317002
114200        MOVE +4018         TO PV-ABEND-CODE                       11318002
114300        MOVE '3000-XML-ERROR' TO PV-PARAGRAPH                     11319002
114400*       (CROAK)                                                   11320002
114500        PERFORM 9500-ABEND                                        11330002
114600     END-IF.                                                      11340002
114700                                                                  11350002
114800 3100-XML-SUCCESS.                                                11360002
114900     IF PS-DISPLAY-YES                                            11370002
115000        DISPLAY 'WSKUT009 - 3100-XML-SUCCESS.'                    11380002
115100     END-IF.                                                      11390002
115200                                                                  11400002
115300***************************************************************** 11410002
115400* IF AN ERROR RECORD IS WRITTEN FOR THIS CASE, SKIP WRITING OUT   11420002
115500* TO THE QUEUES.                                                  11430002
115600***************************************************************** 11440002
115700 3200-WRITE-RECS-LOGIC.                                           11450002
115800     IF PS-DISPLAY-YES                                            11460002
115900        DISPLAY 'WSKUT009 - 3200-WRITE-RECS-LOGIC.'               11470002
116000     END-IF.                                                      11480002
116100                                                                  11490002
116200     IF WS027-CASE-SHPMT-ERR                                      11500002
116300        MOVE WS014-RECEIPT-PIX-RECORD TO                          11510002
116400                                WS027-FORMAT-RECORD(40:203)       11520002
116500        PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                      11530002
116600        SET PS-ERROR-REC-WRITTEN-YES TO TRUE                      11540002
116700     END-IF.                                                      11550002
116800                                                                  11560002
116900     IF PS-ERROR-REC-WRITTEN-YES                                  11570002
117000        CONTINUE                                                  11580002
117100     ELSE                                                         11590002
117200        PERFORM 5000-DECIDE-MQ-MESG-OUT                           11600002
117300* JAK 05/2007 - FOR TRANS 606-03, WRITE A MESSAGE TO BOTH THE     11610002
117400*               INTRANSIT QUEUE AND THE RECEIVING QUEUE           11620002
117500     PERFORM 7000-INITIALIZE-AFTER-PUT                            11630002
117600     END-IF.                                                      11640002
117700                                                                  11650002
117870***************************************************************** 11660002
117900* MQ SERIES WRAP-UP.                                              11670002
118000***************************************************************** 11680002
118100 4000-MQ-CLEANUP.                                                 11690002
118200     IF PS-DISPLAY-YES                                            11700002
118300        DISPLAY 'WSKUT009 - 4000-MQ-CLEANUP.'                     11710002
118400     END-IF.                                                      11720002
118500                                                                  11730002
118600     PERFORM 4100-MQ-CLOSE-PIX-QUEUE.                             11740002
118700     PERFORM 4150-MQ-CLOSE-RC-QUEUE.                              11750002
118800     PERFORM 4200-MQ-CLOSE-SU-QUEUE.                              11760002
118900     PERFORM 4250-MQ-CLOSE-INTRANSIT-QUEUE.                       11770002
119000     PERFORM 4300-MQ-CLOSE-ERROR-QUEUE.                           11780002
119100     PERFORM 4500-MQ-DISCONNECT.                                  11790002
119200                                                                  11800002
119300***************************************************************** 11810002
119400* MQ SERIES CLOSE QUEUE FOR THE PIX TRANSACTIONS.                 11820002
119500***************************************************************** 11830002
119600 4100-MQ-CLOSE-PIX-QUEUE.                                         11840002
119700     IF PS-DISPLAY-YES                                            11850002
119800        DISPLAY 'WSKUT009 - 4100-MQ-CLOSE-PIX-QUEUE.'             11860002
119900     END-IF.                                                      11870002
120000                                                                  11880002
120100     MOVE '4100-MQ-CLOSE-PIX-QUEUE' TO PV-PARAGRAPH.              11890002
120200                                                                  11900002
120300     MOVE PV-QUE-NAME-PIX           TO MQOD-OBJECTNAME.           11910002
120400     MOVE PV-QMGR-NAME-PIX          TO MQOD-OBJECTQMGRNAME.       11920002
120500                                                                  11930002
120600     CALL PC-MQCLOSE USING PV-HCONN                               11940002
120700                           PV-HANDLE-PIX                          11950002
120800                           MQCO-NONE                              11960002
120900                           PV-COMPLETION-CODE                     11970002
121000                           PV-REASON.                             11980002
121100                                                                  11990002
121200*    IF MQ CLOSE FAILED THEN DISPLAY ERROR MESSAGE                12000002
121300*    AND EXIT                                                     12010002
121400                                                                  12020002
121500     IF PV-COMPLETION-CODE = MQCC-OK THEN                         12030002
121600         CONTINUE                                                 12040002
121700     ELSE                                                         12050002
121800         STRING 'CLOSE - ' PV-QUE-NAME-ERROR                      12060002
121900           DELIMITED BY SIZE INTO PV-ACTION                       12070002
122000*        (CROAK)                                                  12080002
122100         PERFORM 9001-MQSERIES-ERROR                              12090002
122200     END-IF.                                                      12100002
122300                                                                  12110002
122400***************************************************************** 12120002
122500* MQ SERIES CLOSE QUEUE FOR THE RC TRANSACTIONS.                  12130002
122600***************************************************************** 12140002
122700 4150-MQ-CLOSE-RC-QUEUE.                                          12150002
122800     IF PS-DISPLAY-YES                                            12160002
122900        DISPLAY 'WSKUT009 - 4150-MQ-CLOSE-RC-QUEUE.'              12170002
123000     END-IF.                                                      12180002
123100                                                                  12190002
123200     MOVE '4150-MQ-CLOSE-RC-QUEUE' TO PV-PARAGRAPH.               12200002
123300                                                                  12210002
123400     MOVE PV-QUE-NAME-RC            TO MQOD-OBJECTNAME.           12220002
123500     MOVE PV-QMGR-NAME-RC           TO MQOD-OBJECTQMGRNAME.       12230002
123600                                                                  12240002
123700     CALL PC-MQCLOSE USING PV-HCONN                               12250002
123800                           PV-HANDLE-RC                           12260002
123900                           MQCO-NONE                              12270002
124000                           PV-COMPLETION-CODE                     12280002
124100                           PV-REASON.                             12290002
124200                                                                  12300002
124300*    IF MQ CLOSE FAILED THEN DISPLAY ERROR MESSAGE                12310002
124400*    AND EXIT                                                     12320002
124500                                                                  12330002
124600     IF PV-COMPLETION-CODE = MQCC-OK THEN                         12340002
124700         CONTINUE                                                 12350002
124800     ELSE                                                         12360002
124900         STRING 'CLOSE - ' PV-QUE-NAME-ERROR                      12370002
125000           DELIMITED BY SIZE INTO PV-ACTION                       12380002
125100*        (CROAK)                                                  12390002
125200         PERFORM 9001-MQSERIES-ERROR                              12400002
125300     END-IF.                                                      12410002
125400                                                                  12420002
125500***************************************************************** 12430002
125600* MQ SERIES CLOSE QUEUE FOR THE SU TRANSACTIONS.                  12440002
125700***************************************************************** 12450002
125800 4200-MQ-CLOSE-SU-QUEUE.                                          12460002
125900     IF PS-DISPLAY-YES                                            12470002
126000        DISPLAY 'WSKUT009 - 4200-MQ-CLOSE-SU-QUEUE.'              12480002
126100     END-IF.                                                      12490002
126200                                                                  12500002
126300     MOVE '4200-MQ-CLOSE-SU-QUEUE' TO PV-PARAGRAPH.               12510002
126400                                                                  12520002
126500     MOVE PV-QUE-NAME-SU            TO MQOD-OBJECTNAME.           12530002
126600     MOVE PV-QMGR-NAME-SU           TO MQOD-OBJECTQMGRNAME.       12540002
126700                                                                  12550002
126800     CALL PC-MQCLOSE USING PV-HCONN                               12560002
126900                           PV-HANDLE-SU                           12570002
127000                           MQCO-NONE                              12580002
127100                           PV-COMPLETION-CODE                     12590002
127200                           PV-REASON.                             12600002
127300                                                                  12610002
127400*    IF MQ CLOSE FAILED THEN DISPLAY ERROR MESSAGE                12620002
127500*    AND EXIT                                                     12630002
127600                                                                  12640002
127700     IF PV-COMPLETION-CODE = MQCC-OK THEN                         12650002
127800         CONTINUE                                                 12660002
127900     ELSE                                                         12670002
128000         STRING 'CLOSE - ' PV-QUE-NAME-ERROR                      12680002
128100           DELIMITED BY SIZE INTO PV-ACTION                       12690002
128200*        (CROAK)                                                  12700002
128300         PERFORM 9001-MQSERIES-ERROR                              12710002
128400     END-IF.                                                      12720002
128500                                                                  12730002
128600***************************************************************** 12740002
128700* MQ SERIES CLOSE QUEUE FOR THE INTRANSIT TRANSACTIONS.           12750002
128800***************************************************************** 12760002
128900 4250-MQ-CLOSE-INTRANSIT-QUEUE.                                   12770002
129000     IF PS-DISPLAY-YES                                            12780002
129100        DISPLAY 'WSKUT009 - 4250-MQ-CLOSE-INTRNSIT-QUE'           12790002
129200     END-IF.                                                      12800002
129300                                                                  12810002
129400     MOVE '4250-MQ-CLOSE-INTRANSIT-QUEUE' TO PV-PARAGRAPH.        12820002
129500                                                                  12830002
129600     MOVE PV-QUE-NAME-INTRANSIT     TO MQOD-OBJECTNAME.           12840002
129700     MOVE PV-QMGR-NAME-INTRANSIT    TO MQOD-OBJECTQMGRNAME.       12850002
129800                                                                  12860002
129900     CALL PC-MQCLOSE USING PV-HCONN                               12870002
130000                           PV-HANDLE-INTRANSIT                    12880002
130100                           MQCO-NONE                              12890002
130200                           PV-COMPLETION-CODE                     12900002
130300                           PV-REASON.                             12910002
130400                                                                  12920002
130500*    IF MQ CLOSE FAILED THEN DISPLAY ERROR MESSAGE                12930002
130600*    AND EXIT                                                     12940002
130700                                                                  12950002
130800     IF PV-COMPLETION-CODE = MQCC-OK THEN                         12960002
130900         CONTINUE                                                 12970002
131000     ELSE                                                         12980002
131100         STRING 'CLOSE - ' PV-QUE-NAME-ERROR                      12990002
131200           DELIMITED BY SIZE INTO PV-ACTION                       13000002
131300*        (CROAK)                                                  13010002
131400         PERFORM 9001-MQSERIES-ERROR                              13020002
131500     END-IF.                                                      13030002
131600                                                                  13040002
131700***************************************************************** 13050002
131800* MQ SERIES CLOSE QUEUE FOR THE ERROR MESSAGE FILE.               13060002
131900***************************************************************** 13070002
132000 4300-MQ-CLOSE-ERROR-QUEUE.                                       13080002
132100     IF PS-DISPLAY-YES                                            13090002
132200        DISPLAY 'WSKUT009 - 4300-MQ-CLOSE-ERROR-QUEUE.'           13100002
132300     END-IF.                                                      13110002
132400                                                                  13120002
132500     MOVE '4300-MQ-CLOSE-ERROR-QUEUE' TO PV-PARAGRAPH.            13130002
132600                                                                  13140002
132700     MOVE PV-QUE-NAME-ERROR         TO MQOD-OBJECTNAME.           13150002
132800     MOVE PV-QMGR-NAME-ERROR        TO MQOD-OBJECTQMGRNAME.       13160002
132900                                                                  13170002
133000     CALL PC-MQCLOSE USING PV-HCONN                               13180002
133100                           PV-HANDLE-ERROR                        13190002
133200                           MQCO-NONE                              13200002
133300                           PV-COMPLETION-CODE                     13210002
133400                           PV-REASON.                             13220002
133500                                                                  13230002
133600*    IF MQ CLOSE FAILED THEN DISPLAY ERROR MESSAGE                13240002
133700*    AND EXIT                                                     13250002
133800                                                                  13260002
133900     IF PV-COMPLETION-CODE = MQCC-OK THEN                         13270002
134000         CONTINUE                                                 13280002
134100     ELSE                                                         13290002
134200         STRING 'CLOSE - ' PV-QUE-NAME-ERROR                      13300002
134300           DELIMITED BY SIZE INTO PV-ACTION                       13310002
134400*        (CROAK)                                                  13320002
134500         PERFORM 9001-MQSERIES-ERROR                              13330002
134600     END-IF.                                                      13340002
134700                                                                  13350002
134800***************************************************************** 13360002
134900* DISCONNECT FROM QUEUE MANAGER.                                  13370002
135000***************************************************************** 13380002
135100 4500-MQ-DISCONNECT.                                              13390002
135200     IF PS-DISPLAY-YES                                            13400002
135300        DISPLAY 'WSKUT009 - 4500-MQ-DISCONNECT.'                  13410002
135400     END-IF.                                                      13420002
135500                                                                  13430002
135600     MOVE '4500-MQ-DISCONNECT'    TO PV-PARAGRAPH.                13440002
135700                                                                  13450002
135800     IF PV-CON-REASON NOT = MQRC-ALREADY-CONNECTED                13460002
135900         CALL PC-MQDISC USING PV-HCONN                            13470002
136000                              PV-COMPLETION-CODE                  13480002
136100                              PV-REASON                           13490002
136200                                                                  13500002
136300*    IF MQ DISCONNECT FAILED THEN DISPLAY ERROR MESSAGE           13510002
136400*    AND EXIT                                                     13520002
136500                                                                  13530002
136600     IF PV-COMPLETION-CODE = MQCC-OK THEN                         13540002
136700         CONTINUE                                                 13550002
136800     ELSE                                                         13560002
136900         STRING 'DISCONNECT - ' PV-QMGR-NAME-PIX                  13570002
137000           DELIMITED BY SIZE INTO PV-ACTION                       13580002
137100*        (CROAK)                                                  13590002
137200         PERFORM 9001-MQSERIES-ERROR                              13600002
137300     END-IF.                                                      13610002
137400                                                                  13620002
137500***************************************************************** 13630002
137600* WRITE ONE OF THE OUTGOING RC/SU/INTRANSIT MQ MESSAGES.          13640002
137700* MOST OF THE FIELDS ON THE WSRD014 RECORD ARE POPULATED IN       13650002
137800* PARSING THE XML.                                                13660002
137900* THE PO-LINE-NUMBER IS POPULATED FROM REFERENCE6.                13670002
138000* ALSO SET THE MQ OPTIONS AND MSG LENGTH HERE SINCE THEY ARE      13680002
138100* ALL THE SAME FOR THE 3 QUEUES.                                  13690002
138200***************************************************************** 13700002
138300 5000-DECIDE-MQ-MESG-OUT.                                         13710002
138400     IF PS-DISPLAY-YES                                            13720002
138500        DISPLAY 'WSKUT009 - 5000-WRITE-MQ-RC-MESG-OUT.'           13730002
138600     END-IF.                                                      13740002
138700                                                                  13750002
138710*FJW BEGIN 05/14/2010                                             13760002
138800***  MOVE '873' TO WS014-STORE-NUMBER.                            13770002
138810*FJW END   05/14/2010                                             13780002
138900                                                                  13790002
139000*SET OPTIONS FOR MQ MESSAGES OUT HERE SINCE THEY ARE ALL THE      13800002
139100*SAME FORMAT.                                                     13810002
139200     MOVE MQFMT-STRING     TO MQMD-FORMAT.                        13820002
139300     MOVE MQPER-PERSISTENT TO MQMD-PERSISTENCE.                   13830002
139400     COMPUTE MQPMO-OPTIONS  =  MQPMO-SYNCPOINT +                  13840002
139500                               MQPMO-SET-IDENTITY-CONTEXT.        13850002
139600                                                                  13860002
139700*THE MSG LENGTH FOR ALL MQ TRANSACTIONS OUT IS +203.              13870002
139800     MOVE +203 TO PV-MSG-LENGTH.                                  13880002
139900                                                                  13890002
140000     IF WS014-RTE-TO-RCVNG                                        13900002
140100        PERFORM 5100-PUT-MQ-RC-MESG-ON-QUEUE                      13910002
140200     ELSE                                                         13920002
140300        IF WS014-RTE-TO-OTBND-SHIP                                13930002
140400           PERFORM 5200-PUT-MQ-SU-MESG-ON-QUEUE                   13940002
140500        ELSE                                                      13950002
140600           IF WS014-RTE-TO-INTRANSIT                              13960002
140700              PERFORM 5300-PUT-MQ-INTRANSIT-ON-QUEUE              13970002
140800           ELSE                                                   13980002
140900              PERFORM 5400-FILL-ERROR-QUE-FIELDS                  13990002
141000           END-IF                                                 14000002
141100        END-IF                                                    14010002
141200     END-IF.                                                      14020002
141300                                                                  14030002
141499***************************************************************** 14040002
141500* PUT THE OUTGOING RC MQ MESSAGE ON QUEUE.                        14050002
141600* IF THE TRANSACTION IS A CASE RECEIPT (606-03 FROM VENDOR),      14060002
141700* WRITE OUT AN INTRANSIT QUEUE MESSAGE AS WELL AS THE RC MESSAGE. 14070002
141800***************************************************************** 14080002
141900 5100-PUT-MQ-RC-MESG-ON-QUEUE.                                    14090002
142000     IF PS-DISPLAY-YES                                            14100002
142100        DISPLAY 'WSKUT009 - 5100-PUT-MQ-RC-MESG-ON-QUEUE'         14110002
142110        DISPLAY 'WS014 REC:' WS014-RECEIPT-PIX-RECORD             14120002
142120     END-IF.                                                      14130002
142130                                                                  14140002
142140     MOVE WS014-RECEIPT-PIX-RECORD TO PV-RCMSGBUFFER.             14150002
142150                                                                  14160002
142160***                                                               14170002
142170     MOVE MQMD-PRIORITY             TO PV-DISPLAY-PRIORITY.       14180002
142180     IF PS-DISPLAY-YES                                            14190002
142190        DISPLAY ' MQPUT MQMD-PRIORITY: '  PV-DISPLAY-PRIORITY     14200002
142200     END-IF.                                                      14210002
142300***                                                               14211002
142400                                                                  14212002
142500*PUT MSG.                                                         14213002
142600     CALL PC-MQPUT USING PV-HCONN                                 14214002
142700                         PV-HANDLE-RC                             14215002
142800                         MQM-MESSAGE-DESCRIPTOR                   14216002
142900                         MQM-PUT-MESSAGE-OPTIONS                  14217002
143000                         PV-MSG-LENGTH                            14218002
143100                         PV-RCMSGBUFFER(1:203)                    14219002
143200                         PV-COMPLETION-CODE                       14220002
143300                         PV-REASON.                               14230002
143400                                                                  14240002
143500*IF PUT FAILED THEN DISPLAY ERROR MESSAGE                         14250002
143600*AND BREAK OUT OF LOOP                                            14260002
143700     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        14270002
143800         IF PS-DISPLAY-YES                                        14280002
143900            DISPLAY 'MQ MESSAGE = ', PV-RCMSGBUFFER               14290002
144000         END-IF                                                   14300002
144100         MOVE '5100-PUT-MQ-MESG-ON-QUEUE' TO PV-PARAGRAPH         14310002
144110         MOVE 'MQPUT FAILED'          TO PV-ERROR-MESSAGE         14320002
144120         MOVE PV-COMPLETION-CODE      TO PV-HOLD-COMPLETION-CODE  14330002
144130         MOVE PV-REASON               TO PV-HOLD-REASON           14340002
144140*        (CROAK)                                                  14350002
144150         PERFORM 9001-MQSERIES-ERROR                              14360002
144160     ELSE                                                         14370002
144170         ADD 1 TO PA-TOTAL-MQ-RC-MSGS-SENT                        14380002
144180** RS - IF THE TRANSACTION IS A CASE RECEIPT (606-03 FROM VENDOR),14390002
144190* WRITE OUT AN INTRANSIT QUEUE MESSAGE AS WELL AS THE RC MESSAGE. 14400002
144200         IF WS014-CASE-RECEIPT                                    14410002
144300            PERFORM 5300-PUT-MQ-INTRANSIT-ON-QUEUE                14411002
144400         END-IF                                                   14412002
144500     END-IF.                                                      14413002
144600**   PERFORM 7000-INITIALIZE-AFTER-PUT.                           14414002
144700                                                                  14415002
144800***************************************************************** 14416002
144900* PUT THE OUTGOING SU MQ MESSAGE ON QUEUE.                        14417002
145000***************************************************************** 14418002
145100 5200-PUT-MQ-SU-MESG-ON-QUEUE.                                    14419002
145200     IF PS-DISPLAY-YES                                            14420002
145300        DISPLAY 'WSKUT009 - 5200-PUT-MQ-SU-MESG-ON-QUEUE'         14430002
145400        DISPLAY 'WS014 REC:' WS014-RECEIPT-PIX-RECORD             14440002
145500     END-IF.                                                      14450002
145600                                                                  14460002
145700     MOVE WS014-RECEIPT-PIX-RECORD TO PV-SUMSGBUFFER.             14470002
145800                                                                  14480002
145900*PUT MSG.                                                         14490002
146000     CALL PC-MQPUT USING PV-HCONN                                 14500002
146100                         PV-HANDLE-SU                             14510002
146200                         MQM-MESSAGE-DESCRIPTOR                   14520002
146300                         MQM-PUT-MESSAGE-OPTIONS                  14530002
146400                         PV-MSG-LENGTH                            14540002
146500                         PV-SUMSGBUFFER(1:203)                    14550002
146600                         PV-COMPLETION-CODE                       14560002
146700                         PV-REASON.                               14570002
146800                                                                  14580002
146900*IF PUT FAILED THEN DISPLAY ERROR MESSAGE                         14590002
147000*AND BREAK OUT OF LOOP                                            14600002
147100     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        14610002
147200         IF PS-DISPLAY-YES                                        14620002
147300            DISPLAY 'MQ MESSAGE = ', PV-SUMSGBUFFER               14630002
147400         END-IF                                                   14640002
147500         MOVE '5200-PUT-MQ-MESG-ON-QUEUE' TO PV-PARAGRAPH         14650002
147600         MOVE 'MQPUT FAILED'          TO PV-ERROR-MESSAGE         14660002
147700         MOVE PV-COMPLETION-CODE      TO PV-HOLD-COMPLETION-CODE  14670002
147800         MOVE PV-REASON               TO PV-HOLD-REASON           14680002
147900*        (CROAK)                                                  14690002
148000         PERFORM 9001-MQSERIES-ERROR                              14700002
148100     ELSE                                                         14710002
148200         ADD 1 TO PA-TOTAL-MQ-SU-MSGS-SENT                        14720002
148300     END-IF.                                                      14730002
148400**   PERFORM 7000-INITIALIZE-AFTER-PUT.                           14740002
148500                                                                  14750002
148600***************************************************************** 14760002
148700* PUT THE OUTGOING RC MQ MESSAGE ON QUEUE.                        14770002
148800***************************************************************** 14780002
148900 5300-PUT-MQ-INTRANSIT-ON-QUEUE.                                  14790002
149000     IF PS-DISPLAY-YES                                            14800002
149100        DISPLAY 'WSKUT009 - 5300-PUT-MQ-INTRANSIT-ON-QUEUE'       14810002
149200        DISPLAY 'WS014 REC:' WS014-RECEIPT-PIX-RECORD             14820002
149300     END-IF.                                                      14830002
149400                                                                  14840002
149500     MOVE WS014-RECEIPT-PIX-RECORD TO PV-INTMSGBUFFER.            14850002
149600                                                                  14860002
149700*PUT MSG.                                                         14870002
149800     CALL PC-MQPUT USING PV-HCONN                                 14880002
149900                         PV-HANDLE-INTRANSIT                      14890002
150000                         MQM-MESSAGE-DESCRIPTOR                   14900002
150100                         MQM-PUT-MESSAGE-OPTIONS                  14910002
150200                         PV-MSG-LENGTH                            14920002
150300                         PV-INTMSGBUFFER(1:203)                   14930002
150400                         PV-COMPLETION-CODE                       14940002
150500                         PV-REASON.                               14950002
150600                                                                  14960002
150700*IF PUT FAILED THEN DISPLAY ERROR MESSAGE                         14970002
150800*AND BREAK OUT OF LOOP                                            14980002
150900     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        14990002
151000         IF PS-DISPLAY-YES                                        15000002
151100            DISPLAY 'MQ MESSAGE = ', PV-INTMSGBUFFER              15010002
151200         END-IF                                                   15020002
151300         MOVE '5300-PUT-MQ-MESG-ON-QUEUE' TO PV-PARAGRAPH         15030002
151310         MOVE 'MQPUT FAILED'          TO PV-ERROR-MESSAGE         15040002
151320         MOVE PV-COMPLETION-CODE      TO PV-HOLD-COMPLETION-CODE  15050002
151330         MOVE PV-REASON               TO PV-HOLD-REASON           15060002
151340*        (CROAK)                                                  15070002
151350         PERFORM 9001-MQSERIES-ERROR                              15080002
151360     ELSE                                                         15090002
151370         ADD 1 TO PA-TOTAL-MQ-INTRAN-MSGS-SENT                    15100002
151380     END-IF.                                                      15110002
151390**   PERFORM 7000-INITIALIZE-AFTER-PUT.                           15120002
151400                                                                  15130002
151500***************************************************************** 15131002
151600* FILL IN FIELDS TO WRITE TO ERROR QUEUE IF WS014-TRANS-TYPE-CODE 15132002
151700* IS NOT R, S, OR I.  THEN CALL THE PUT ERROR QUEUE PROCESS.      15133002
151800***************************************************************** 15134002
151900 5400-FILL-ERROR-QUE-FIELDS.                                      15135002
152000     IF PS-DISPLAY-YES                                            15136002
152100        DISPLAY 'WSKUT009 - 5400-FILL-ERROR QUE FIELDS.'          15137002
152200     END-IF.                                                      15138002
152300                                                                  15139002
152400     INITIALIZE WS027-RECEIPT-PIX-ERROR-REC.                      15140002
152500     MOVE 'A'             TO WS027-ERROR-TYPE-CDE.                15150002
152600     MOVE PC-PGM-NAME     TO WS027-ERROR-PGM-NAME.                15160002
152700     MOVE 'WSRD014'       TO WS027-ERROR-COPYBOOK.                15170002
152800     MOVE '5400-'         TO WS027-ERROR-PARA-NBR.                15180002
152900     MOVE 'WRONG TRANS TYPE CDE' TO WS027-ERROR-DESC-TXT.         15190002
153000     MOVE SQLCODE         TO WS027-SQLCODE.                       15200002
153100     MOVE 'WS014 TRANS TYPE CODE:' TO WS027-FORMAT-RECORD(1:22).  15210002
153200     MOVE WS014-TRANS-TYPE-CODE TO                                15220002
153300                             WS027-FORMAT-RECORD(24:1).           15230002
153400     MOVE WS014-RECEIPT-PIX-RECORD TO                             15240002
153500                                WS027-FORMAT-RECORD(26:203).      15250002
153600     PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT.                        15260002
153700     SET PS-ERROR-REC-WRITTEN-YES TO TRUE.                        15270002
153800                                                                  15280002
153900***************************************************************** 15290002
154000* CALL VIEW WSV_PIX_RTE TO GET THE ROUTING CODE TO MAKE SURE THE  15300002
154100* PIX IS ONE THAT IS EXPECTED BY THE PROGRAM.  THE EFFECTIVE      15310002
154200* BEGINNING AND END DATES ARE PART OF THE SQL SO THAT WE ONLY     15320002
154300* PICK UP ACTIVE PIX TRANSACTION TYPES AND CODES.                 15330002
154400***************************************************************** 15340002
154500 6500-VALIDATE-PIX-ROUTING.                                       15350002
154600     IF PS-DISPLAY-YES                                            15360002
154700        DISPLAY 'WSKUT009 - 6500-SELECT-PIX-ROUTING.'             15370002
154800     END-IF.                                                      15380002
154900                                                                  15390002
155000     EXEC SQL                                                     15400002
155100         SELECT INTGRTN_TYP_DESC                                  15410002
155200           INTO :WSV00002-INTGRTN-TYP-DESC                        15420002
155300           FROM WSV_PIX_RTE                                       15430002
155400      WHERE INTGRTN_TYP_CDE = 'PIXRTELGCY'                        15440002
155500         AND PIX_TYP        = :PV-TRANSACTION-TYPE                15450002
155600         AND PIX_CDE        = :PV-TRANSACTION-CODE                15460002
155700         AND ACTV_IND       = 'Y'                                 15470002
155800         AND (CURRENT DATE                                        15480002
155900             BETWEEN DATE(EFF_BEG_DTE) AND                        15490002
156000                     DATE(EFF_END_DTE))                           15500002
156100     END-EXEC                                                     15510002
156200                                                                  15520002
156300     EVALUATE TRUE                                                15530002
156400       WHEN SQLCODE = -811                                        15540002
156500       WHEN SQLCODE = ZERO                                        15550002
156600           CONTINUE                                               15560002
156700       WHEN SQLCODE = +100                                        15570002
156800           INITIALIZE WS027-RECEIPT-PIX-ERROR-REC                 15580002
156900           MOVE 'A'             TO WS027-ERROR-TYPE-CDE           15590002
157000           MOVE PC-PGM-NAME TO WS027-ERROR-PGM-NAME               15600002
157100           MOVE 'WSRD014' TO WS027-ERROR-COPYBOOK                 15610002
157200           MOVE '6500-'         TO WS027-ERROR-PARA-NBR           15620002
157300           MOVE 'WRONG PIX TRANS TYPE/CODE'                       15630002
157400                                TO WS027-ERROR-DESC-TXT           15640002
157500           MOVE SQLCODE         TO WS027-SQLCODE                  15650002
157600           MOVE 'PIX TRANS TYPE ' TO WS027-FORMAT-RECORD(1:15)    15660002
157700           MOVE PV-TRANSACTION-TYPE(1:3) TO                       15670002
157800                                WS027-FORMAT-RECORD(16:3)         15680002
157900           MOVE 'PIX TRANS CODE:' TO WS027-FORMAT-RECORD(20:15)   15690002
158000           MOVE PV-TRANSACTION-CODE(1:3) TO                       15700002
158100                                WS027-FORMAT-RECORD(36:3)         15710002
158200           MOVE WS014-RECEIPT-PIX-RECORD TO                       15720002
158300                                WS027-FORMAT-RECORD(40:203)       15730002
158400           PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                   15740002
158500           SET PS-ERROR-REC-WRITTEN-YES TO TRUE                   15750002
158600       WHEN OTHER                                                 15760002
158700           INITIALIZE WS027-RECEIPT-PIX-ERROR-REC                 15770002
158800           MOVE 'C'             TO WS027-ERROR-TYPE-CDE           15780002
158900           MOVE PC-PGM-NAME TO WS027-ERROR-PGM-NAME               15790002
159000           MOVE 'WSRD014' TO WS027-ERROR-COPYBOOK                 15800002
159100           MOVE '6500-'         TO WS027-ERROR-PARA-NBR           15810002
159200           MOVE 'INVALID PIX TRNS TYPE/CDE'                       15820002
159300                                   TO WS027-ERROR-DESC-TXT        15830002
159400           MOVE SQLCODE         TO WS027-SQLCODE                  15840002
159500           MOVE 'PIX TRANS TYPE:' TO WS027-FORMAT-RECORD(1:15)    15850002
159600           MOVE PV-TRANSACTION-TYPE(1:3) TO                       15860002
159700                                WS027-FORMAT-RECORD(17:3)         15870002
159800           MOVE 'PIX TRANS CODE:' TO WS027-FORMAT-RECORD(21:15)   15880002
159900           MOVE PV-TRANSACTION-CODE(1:3) TO                       15890002
160000                                WS027-FORMAT-RECORD(37:3)         15900002
160100           MOVE WS014-RECEIPT-PIX-RECORD TO                       15910002
160200                                WS027-FORMAT-RECORD(41:203)       15920002
160300           PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                   15930002
160400           SET PS-ERROR-REC-WRITTEN-YES TO TRUE                   15940002
160500     END-EVALUATE.                                                15950002
160600                                                                  15960002
160700***************************************************************** 15970002
160800* WHEN CASE DOES NOT FOLLOW THE SML FORMAT 00410000000000000000   15980002
160810* CHECK TO SEE IF THE CASE WAS MANIFESTED, BUT THE ASSOCIATE      15990002
160820* SCANNED THE VENDOR BARCODE                                      16000002
160830***************************************************************** 16010002
160840 6600-VALIDATE-CASE-SHIPMT.                                       16020002
160850     IF PS-DISPLAY-YES                                            16030002
160860        DISPLAY 'WSKUT009 - 6600-VALIDATE-CASE-SHIPMT '           16040002
160870     END-IF.                                                      16050002
160880                                                                  16060002
160890     SET PS-CASE-TO-SHPMT-CHCK-NO TO TRUE                         16070002
160891                                                                  16080002
160892     EXEC SQL                                                     16081002
160893          SELECT DISTINCT                                         16082002
160894                 A.SHIPT_UNT_ID                                   16083002
160895          INTO   :SUT00024-SHIPT-UNT-ID                           16084002
160896          FROM   SUT_OTBND_CART A                                 16085002
160897          WHERE  A.ORIG_CART_ID = :SUT00024-ORIG-CART-ID          16086002
160898          AND    A.ACTV_IND     = 'Y'                             16087002
160899     END-EXEC.                                                    16088002
160900                                                                  16089002
160910     EVALUATE TRUE                                                16089102
160911       WHEN SQLCODE = -811                                        16089202
160912       WHEN SQLCODE = ZERO                                        16089302
160913           SET PS-CASE-TO-SHPMT-CHCK-YES TO TRUE                  16089402
160914       WHEN SQLCODE = +100                                        16089502
160915           INITIALIZE WS027-RECEIPT-PIX-ERROR-REC                 16089602
160916           MOVE 'E'             TO WS027-ERROR-TYPE-CDE           16089702
160917           MOVE PC-PGM-NAME TO WS027-ERROR-PGM-NAME               16089802
160918           MOVE 'WSRD014' TO WS027-ERROR-COPYBOOK                 16089902
160919           MOVE '6600-'         TO WS027-ERROR-PARA-NBR           16090002
160920           MOVE 'CASE NOT FOUND ON FINDLAY SHPMT '                16091002
160930                                TO WS027-ERROR-DESC-TXT           16091102
160940           MOVE SQLCODE         TO PV-DISP-SQL                    16091202
160950           MOVE PV-DISP-SQL     TO WS027-SQLCODE                  16091302
160951           MOVE 'PIX TRANS TYPE ' TO WS027-FORMAT-RECORD(1:15)    16091402
160952           MOVE PV-TRANSACTION-TYPE(1:3) TO                       16091502
160953                                WS027-FORMAT-RECORD(16:3)         16091602
160954           MOVE 'PIX TRANS CODE:' TO WS027-FORMAT-RECORD(20:15)   16091702
160955           MOVE PV-TRANSACTION-CODE(1:3) TO                       16091802
160956                                WS027-FORMAT-RECORD(36:3)         16091902
160957*          MOVE WS014-RECEIPT-PIX-RECORD TO                       16092002
160958*                               WS027-FORMAT-RECORD(40:203)       16093002
160959*          PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                   16094002
160960*          SET PS-ERROR-REC-WRITTEN-YES TO TRUE                   16095002
160966       WHEN OTHER                                                 16095102
160967           INITIALIZE WS027-RECEIPT-PIX-ERROR-REC                 16095202
160968           MOVE 'C'             TO WS027-ERROR-TYPE-CDE           16095302
160969           MOVE PC-PGM-NAME TO WS027-ERROR-PGM-NAME               16095402
160970           MOVE 'WSRD014' TO WS027-ERROR-COPYBOOK                 16095502
160971           MOVE '6600-'         TO WS027-ERROR-PARA-NBR           16095602
160972           MOVE 'INVALID PIX TRNS TYPE/CDE'                       16095702
160973                                   TO WS027-ERROR-DESC-TXT        16095802
160974           MOVE SQLCODE         TO WS027-SQLCODE                  16095902
160975           MOVE 'PIX TRANS TYPE:' TO WS027-FORMAT-RECORD(1:15)    16096002
160976           MOVE PV-TRANSACTION-TYPE(1:3) TO                       16096102
160977                                WS027-FORMAT-RECORD(17:3)         16096202
160978           MOVE 'PIX TRANS CODE:' TO WS027-FORMAT-RECORD(21:15)   16096302
160979           MOVE PV-TRANSACTION-CODE(1:3) TO                       16096402
160980                                WS027-FORMAT-RECORD(37:3)         16096502
160981           MOVE WS014-RECEIPT-PIX-RECORD TO                       16096602
160982                                WS027-FORMAT-RECORD(41:203)       16096702
160983           PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                   16096802
160984           SET PS-ERROR-REC-WRITTEN-YES TO TRUE                   16096902
160985     END-EVALUATE.                                                16097002
160986                                                                  16097102
160987***************************************************************** 16097202
160988* INITIALIZE FIELDS AFTER MQ PUTS.                                16097302
160989***************************************************************** 16097402
160990 7000-INITIALIZE-AFTER-PUT.                                       16097502
160991     IF PS-DISPLAY-YES                                            16097602
160992        DISPLAY 'WSKUT009 - 7000-INITIALIZE-AFTER-PUT.'           16097702
160993     END-IF.                                                      16097802
160994                                                                  16097902
160995     INITIALIZE WS014-RECEIPT-PIX-RECORD                          16098002
161000                WS027-RECEIPT-PIX-ERROR-REC                       16098102
161100                PV-SKU-NUMBER                                     16098202
161200                PV-USER-ID                                        16098302
161300                PV-PO-NUMBER                                      16098402
161400                PV-PO-LINE-NUMBER                                 16098502
161500                PV-DC-ORD-NUMBER                                  16098602
161600                PV-WMOS-DATE-CREATED                              16098702
161700                PV-TRANS-DATE                                     16098802
161800                PV-ADJ-QTY-CONVERT                                16098902
161900                PV-ADJ-QTY-CONVRTD                                16099002
162000                PV-CASE-NUMBER                                    16100002
162100                PV-ADJ-TYPE.                                      16110002
162200                                                                  16120002
162300***************************************************************** 16130002
162400* WRITE OUTGOING ERROR MQ MESSAGE.                                16140002
162500***************************************************************** 16150002
162600 8000-WRITE-MQ-ERROR-MESG-OUT.                                    16160002
162700     IF PS-DISPLAY-YES                                            16170002
162800        DISPLAY 'WSKUT009 - 8000-WRITE-MQ-ERROR-MESG-OUT.'        16180002
162900     END-IF.                                                      16190002
163000                                                                  16200002
163100     PERFORM 8100-PUT-MQ-ERROR-MESG-ON-QUE.                       16210002
163200     PERFORM 7000-INITIALIZE-AFTER-PUT.                           16220002
163300                                                                  16230002
163400***************************************************************** 16240002
163500* PUT ERROR MQ MESSAGE ON QUEUE.                                  16250002
163600***************************************************************** 16260002
163700 8100-PUT-MQ-ERROR-MESG-ON-QUE.                                   16270002
163710     IF PS-DISPLAY-YES                                            16280002
163720        DISPLAY 'WSKUT009 - 8100-PUT-MQ-ERROR-MESG-ON-QUE.'       16290002
163730     END-IF.                                                      16300002
163740                                                                  16310002
163750     MOVE MQFMT-STRING     TO MQMD-FORMAT.                        16320002
163760     MOVE MQPER-PERSISTENT TO MQMD-PERSISTENCE.                   16330002
163770     COMPUTE MQPMO-OPTIONS  =  MQPMO-SYNCPOINT +                  16340002
163780                               MQPMO-SET-IDENTITY-CONTEXT.        16350002
163790                                                                  16360002
163800     MOVE +1055 TO PV-MSG-LENGTH.                                 16370002
163900     MOVE WS027-RECEIPT-PIX-ERROR-REC TO PV-ERRMSGBUFFER.         16371002
164000*    IF PS-DISPLAY-YES                                            16372002
164100        DISPLAY 'PV-ERRMSGBUFFER:' PV-ERRMSGBUFFER                16373002
164200*    END-IF.                                                      16374002
164300                                                                  16375002
164400     CALL PC-MQPUT USING PV-HCONN                                 16376002
164500                         PV-HANDLE-ERROR                          16377002
164600                         MQM-MESSAGE-DESCRIPTOR                   16378002
164700                         MQM-PUT-MESSAGE-OPTIONS                  16379002
164800                         PV-MSG-LENGTH                            16380002
164900                         PV-ERRMSGBUFFER(1:PV-MSG-LENGTH)         16390002
165000                         PV-COMPLETION-CODE                       16400002
165100                         PV-REASON.                               16410002
165200                                                                  16420002
165300*IF PUT FAILED THEN DISPLAY ERROR MESSAGE                         16430002
165400*AND BREAK OUT OF LOOP                                            16440002
165500     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        16450002
165600         IF PS-DISPLAY-YES                                        16460002
165700            DISPLAY 'MQ MESSAGE = ', PV-ERRMSGBUFFER              16470002
165800         END-IF                                                   16480002
165900         MOVE '8100-PUT-MQ-MESG-ON-QUEUE' TO PV-PARAGRAPH         16490002
166000         MOVE 'MQPUT FAILED'          TO PV-ERROR-MESSAGE         16500002
166100*        (CROAK)                                                  16510002
166200         PERFORM 9001-MQSERIES-ERROR                              16520002
166300     ELSE                                                         16530002
166400         ADD 1 TO PA-TOTAL-MQ-ERROR-MSGS-SENT                     16540002
166500     END-IF.                                                      16550002
166600                                                                  16560002
166700***************************************************************** 16570002
166800* DO AN MQ COMMIT (ALSO COMMITS DB2)                              16580002
166900***************************************************************** 16590002
167000 8500-MQ-COMMIT.                                                  16600002
167100     IF PS-DISPLAY-YES                                            16610002
167200         EXEC SQL                                                 16620002
167300             SET :PV-TIMESTAMP = CURRENT TIMESTAMP                16630002
167400         END-EXEC                                                 16640002
167500        DISPLAY '8500-MQ-COMMIT. ' PV-TIMESTAMP                   16650002
167600     END-IF.                                                      16660002
167700                                                                  16670002
167800     CALL PC-MQCMIT USING  PV-HCONN                               16680002
167900                          PV-COMPLETION-CODE                      16690002
168000                          PV-REASON.                              16700002
168100                                                                  16710002
168200     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        16720002
168300        MOVE '8500-COMMIT-MQ'   TO PV-PARAGRAPH                   16730002
168400        MOVE 'MQCMIT ERROR'     TO PV-ERROR-MESSAGE               16740002
168500        MOVE PV-COMPLETION-CODE TO PV-HOLD-COMPLETION-CODE        16750002
168600        MOVE PV-REASON          TO PV-HOLD-REASON                 16760002
168700        MOVE PV-HOLD-COMPLETION-CODE TO PV-COMPLETION-CODE        16770002
168800        MOVE PV-HOLD-REASON     TO PV-REASON                      16780002
168900*        CROAK                                                    16790002
169000        PERFORM 9001-MQSERIES-ERROR                               16800002
169100     ELSE                                                         16810002
169200        ADD 1 TO PA-TOTAL-MQ-PUTAWY-COMMITS                       16820002
169300     END-IF.                                                      16830002
169400                                                                  16840002
169500 8999-ERROR-PROCESSING-XML.                                       16850002
169501                                                                  16860002
169510*FJW 05/14/2010 BEGIN                                             16870002
169520     IF PS-DISPLAY-YES                                            16880002
169530        DISPLAY 'WSKUT009 - 8999-ERROR-PROCESSING-XML.'           16890002
169540     END-IF.                                                      16900002
169550*FJW 05/14/2010 END                                               16910002
169560                                                                  16920002
169600     INITIALIZE WS027-RECEIPT-PIX-ERROR-REC                       16930002
169610     MOVE 'D'   TO WS027-ERROR-TYPE-CDE                           16940002
169700     MOVE PC-PGM-NAME TO WS027-ERROR-PGM-NAME                     16950002
169800     MOVE 'WSRD014' TO WS027-ERROR-COPYBOOK                       16951002
169900     MOVE '2100-'        TO WS027-ERROR-PARA-NBR                  16952002
170000     MOVE 'INVALID ASN ORG TYPE'                                  16953002
170100                         TO WS027-ERROR-DESC-TXT                  16954002
170110     MOVE SQLCODE        TO WS027-SQLCODE                         16955002
170111     MOVE 'ASN ORG TYPE: ' TO                                     16956002
170112                         WS027-FORMAT-RECORD(1:14)                16957002
170113     MOVE PV-ASN-ORGN-TYPE-1(1:1) TO                              16958002
170114                         WS027-FORMAT-RECORD(15:1)                16959002
170115     MOVE ' TRANS TYPE: ' TO                                      16960002
170116                         WS027-FORMAT-RECORD(16:13)               16970002
170117     MOVE PV-TRANSACTION-TYPE(1:3) TO                             16980002
170118                         WS027-FORMAT-RECORD(30:3)                16990002
170119     MOVE WS014-RECEIPT-PIX-RECORD TO                             17000002
170120                         WS027-FORMAT-RECORD(34:203)              17010002
170121     PERFORM 8000-WRITE-MQ-ERROR-MESG-OUT                         17011002
170122     SET PS-ERROR-REC-WRITTEN-YES TO TRUE.                        17011102
170123***************************************************************** 17011202
170124* WRAP-UP AND DISPLAY SUMMARY TOTALS.                             17011302
170125***************************************************************** 17011402
170126 9300-WRAPUP.                                                     17011502
170127     IF PS-DISPLAY-YES                                            17011602
170128        DISPLAY 'WSKUT009 - 9300-WRAPUP.'                         17011702
170129     END-IF.                                                      17011802
170130                                                                  17011902
170131     DISPLAY '************************************************'.  17012002
170132     DISPLAY '     * WSKUT009 SUMMARY STATISTICS *            '   17012102
170133     DISPLAY '   PROCESS TRAILER PIXES                        '   17012202
170134                                                                  17012302
170135     MOVE PA-TOTAL-MQ-PIX-MSGS-READ TO PV-DISP-NBR                17012402
170136     DISPLAY ' TOTAL MQ PIX MESSAGES READ           :'            17012502
170137                        PV-DISP-NBR                               17012602
170138                                                                  17012702
170139     MOVE PA-TOTAL-MQ-PUTAWY-COMMITS TO PV-DISP-NBR               17012802
170140     DISPLAY ' TOTAL MQ COMMITS DONE                :'            17012902
170141                        PV-DISP-NBR                               17013002
170142                                                                  17013102
170143     MOVE PA-999-STOP-PROC-MESSAGES TO PV-DISP-NBR                17013202
170144     DISPLAY ' 999 STOP PROCESSING MESSAGES READ    :'            17013302
170145                        PV-DISP-NBR                               17013402
170146                                                                  17013502
170147     MOVE PA-TOTAL-MQ-RC-MSGS-SENT  TO PV-DISP-NBR                17013602
170148     DISPLAY ' TOTAL MQ RC TRANSACTION MESSAGES SENT:'            17013702
170149                        PV-DISP-NBR                               17013802
170150                                                                  17013902
170151     MOVE PA-TOTAL-MQ-SU-MSGS-SENT  TO PV-DISP-NBR                17014002
170152     DISPLAY ' TOTAL MQ SU TRANSACTION MESSAGES SENT:'            17014102
170153                        PV-DISP-NBR                               17014202
170154                                                                  17014302
170155     MOVE PA-TOTAL-MQ-INTRAN-MSGS-SENT TO PV-DISP-NBR             17014402
170156     DISPLAY ' TOTAL MQ INTRANSIT TRAN MESSAGES SENT:'            17014502
170157                           PV-DISP-NBR                            17014602
170158                                                                  17014702
170163     MOVE PA-TOTAL-MQ-ERROR-MSGS-SENT  TO PV-DISP-NBR             17014802
170164     DISPLAY ' TOTAL MQ ERROR MESSAGES SENT         :'            17014902
170165                        PV-DISP-NBR                               17015002
170166                                                                  17016002
170168     MOVE PA-DEBUG-MESSAGES            TO PV-DISP-NBR             17016102
170169     DISPLAY ' TOTAL DEBUG CONTROL MESSAGES         :'            17016202
170170                        PV-DISP-NBR                               17016302
170171                                                                  17016402
170172     DISPLAY ' '                                                  17016502
170173     DISPLAY '************************************************'.  17016602
170174                                                                  17016702
170175 9500-ABEND.                                                      17016802
170180     DISPLAY 'WSKUT009 - 9500-ABEND.                   '.         17016902
170181                                                                  17017002
170182     DISPLAY '** ABEND        **'.                                17017102
170183     DISPLAY '** PROGRAM      ** = ' PC-PGM-NAME.                 17017202
170184     DISPLAY '** PARAGRAPH    ** = ' PV-PARAGRAPH.                17017302
170185                                                                  17017402
170186     CALL 'ILBOABN0'  USING PV-ABEND-CODE.                        17017502
170187                                                                  17017602
170188                                                                  17017702
170189     COPY ISPD002.                                                17017802
170190     COPY ISPD007.                                                17017902
170200     COPY ISPD008.                                                17018002
170300     COPY ISPD009.                                                17019002
