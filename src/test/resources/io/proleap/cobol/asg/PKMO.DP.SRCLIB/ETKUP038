00001  ID  DIVISION.                                                    06/23/95
00002  PROGRAM-ID.         ETKUP038.                                    ETKUP038
00003  AUTHOR.             STEVE FLUNKER.                                  LV004
00004  INSTALLATION.       KOHLS DEPARTMENT STORES.                     ETKUP038
00005  DATE-WRITTEN.       JUN 1995.                                    ETKUP038
00006  DATE-COMPILED.                                                   ETKUP038
00007                                                                   ETKUP038
00008 ******************************************************************ETKUP038
00009 *  ETKUP038 - INVOICE/UPC RECYCLE UTILITY                         ETKUP038
00010 *  WORK REQUEST #  - 3044                                         ETKUP038
00011 ******************************************************************ETKUP038
00012 *  THIS PROGRAM WILL VALIDATE INCOMING INVOICES                   ETKUP038
************************************************************************        
JF0403*  DATE  05/01/2003                                                       
JF0403*  CHANGE MADE:                                                           
JF0403*   UPDATED PROGRAM SO IT IS COMPLIANT WITH NI-SKU OBJECTIVES.            
JF0403*  MADE BY: JON FIEDLER             WR# : 22777                           
************************************************************************        
JF0703*  DATE  07/18/2003                                                       
JF0703*  CHANGE MADE:                                                           
JF0703*   MADE CHANGES TO SUPPORT THE PROCESSING OF COMPOUND PACK               
JF0703*   INVOICES. THE PROGRAM IS UPDATED TO PROCESS THE NEW RECORD            
JF0703*   TYPES 08 AND 09. ALSO AP NO LONGER REQUIRES THE ET ONHOLD             
JF0703*   PROCESS TO PERFORM VERIFICATION ON THE UPC NUMBER. THIS               
JF0703*   LOGIC WAS COMMENTED OUT AS A RESULT.                                  
JF0703*  MADE BY: JON FIEDLER             WR# : 24764                           
************************************************************************        
C94517*  CHANGED 11/06/2014    BY COGNIZANT       WR: CHG0094517                
C94517*                                                                         
C94517* EXTENDED PO# FROM 7 TO 8 DIGITS WHERE NEEDED.                           
************************************************************************        
022015*  CHANGED 02/06/2015    BY JIM ARENDT      WR: CHG0104132                
022015*                                                                         
022015* COMMENTED OUT LEADING ZEROS IN WS-CNVRTD-PO-NBR. ALSO, ADDED            
022015* DISPLAY OF PROGRAM TOTAL COUNTS.                                        
************************************************************************        
00014 *                                                                 ETKUP038
00015  ENVIRONMENT DIVISION.                                            ETKUP038
00016 *                                                                 ETKUP038
00017  CONFIGURATION SECTION.                                           ETKUP038
00018 *                                                                 ETKUP038
00019  SOURCE-COMPUTER.        IBM-3090.                                ETKUP038
00020  OBJECT-COMPUTER.        IBM-3090.                                ETKUP038
00021 *                                                                 ETKUP038
00022  INPUT-OUTPUT SECTION.                                            ETKUP038
00023  FILE-CONTROL.                                                    ETKUP038
00024      SELECT INV-INPUT-FILE                                        ETKUP038
00025          ASSIGN TO INP01.                                         ETKUP038
00026                                                                   ETKUP038
00027      SELECT INV-STATUS-FILE                                       ETKUP038
00028          ASSIGN TO OUT01.                                         ETKUP038
00029                                                                   ETKUP038
00030  DATA DIVISION.                                                   ETKUP038
00031  FILE SECTION.                                                    ETKUP038
00032                                                                   ETKUP038
00033  FD  INV-INPUT-FILE                                               ETKUP038
00034      LABEL RECORDS ARE STANDARD                                   ETKUP038
00035      RECORDING MODE IS F                                          ETKUP038
00036      BLOCK CONTAINS 0 RECORDS                                     ETKUP038
00037      RECORD CONTAINS 384 CHARACTERS                               ETKUP038
00038      DATA RECORD IS INV-INPUT-RECORD.                             ETKUP038
00039                                                                   ETKUP038
00040  01  INV-INPUT-RECORD.                                            ETKUP038
00041      05 INV-INPUT-DBKEY.                                          ETKUP038
00042          10 INV-INPUT-TP-DKEY           PIC S9(09) COMP.          ETKUP038
00043          10 INV-INPUT-TP-DKEY-TMST      PIC  X(26).               ETKUP038
00044          10 INV-INPUT-TRN-SET-SEQ-NBR   PIC S9(09) COMP.          ETKUP038
00045      COPY APRD050.                                                ETKUP038
00046                                                                   ETKUP038
00047  FD  INV-STATUS-FILE                                              ETKUP038
00048      LABEL RECORDS ARE STANDARD                                   ETKUP038
00049      RECORDING MODE IS F                                          ETKUP038
00050      BLOCK CONTAINS 0 RECORDS                                     ETKUP038
00051      RECORD CONTAINS 385 CHARACTERS                               ETKUP038
00052      DATA RECORD IS INV-INPUT-RECORD.                             ETKUP038
00053                                                                   ETKUP038
00054  01  INV-STATUS-RECORD.                                           ETKUP038
00055      05  INV-STATUS-DBKEY.                                        ETKUP038
00056          10  INV-STATUS-TP-DKEY          PIC S9(09) COMP.         ETKUP038
00057          10  INV-STATUS-TP-DKEY-TMST     PIC  X(26).              ETKUP038
00058          10  INV-STATUS-TRN-SET-SEQ-NBR  PIC S9(09) COMP.         ETKUP038
00059      05  INV-STATUS-INVKEY               PIC X(50).               ETKUP038
00060      05  INV-STATUS-DATA                 PIC X(300).              ETKUP038
00061      05  INV-STATUS-UPD-DB-FLAG          PIC X.                   ETKUP038
00062          88  UPDATE-DB-RECORD                 VALUE 'Y'.          ETKUP038
00063          88  NO-DB-ACTION                     VALUE 'N'.          ETKUP038
00064                                                                   ETKUP038
00065  WORKING-STORAGE SECTION.                                         ETKUP038
00066 *                                                                 ETKUP038
00067  01  WS-WORKING-STORAGE.                                          ETKUP038
00068      05  WS-NOSKU.                                                ETKUP038
00069          10  FILLER                 PIC X(05) VALUE 'NOSKU'.      ETKUP038
00070          10  WS-NOSKU-CNT           PIC 9(03) VALUE ZERO.         ETKUP038
00071                                                                   ETKUP038
00072      05  WS-DBKEY-SAVE-AREA         PIC X(50)  VALUE SPACES.      ETKUP038
00073      05  WS-INVKEY-SAVE-AREA        PIC X(50)  VALUE SPACES.      ETKUP038
00074      05  WS-DATA-SAVE-AREA          PIC X(300) VALUE SPACES.      ETKUP038
00075      05  WS-DBKEY-AREA              PIC X(34)  VALUE SPACES.      ETKUP038
00076      05  WS-INVKEY-RECORD.                                        ETKUP038
      *CLP CHANGED PO TO 09 TO MATCH APRD050 KEY                                
C94517         10  WS-PO-NBR              PIC 9(09) VALUE ZERO.         ETKUP038
00078          10  WS-INVOICE-NBR         PIC X(22) VALUE ZERO.         ETKUP038
00079          10  WS-RECORD-TYPE         PIC X(02) VALUE SPACES.       ETKUP038
00080          10  WS-FILLER              PIC X(01) VALUE SPACE.        ETKUP038
00081          10  WS-SEQ-NBR             PIC X(05) VALUE SPACES.       ETKUP038
00082          10  WS-FILLER              PIC X(11) VALUE SPACE.        ETKUP038
      *CLP CHANGED FILLER TO 11 ON 12/12                                        
00083      05  WS-DATA-AREA               PIC X(300) VALUE SPACES.      ETKUP038
00084      05  WS-PURCHS-PO-NBR           PIC S9(9) COMP.               ETKUP038
00085      05  WS-HELD-PO-NBR             PIC X(30) VALUE SPACES.       ETKUP038
00086      05  WS-CNVRTD-PO-NBR.                                        ETKUP038
022015*        10  FILLER                 PIC X(2)  VALUE '00'.         ETKUP038
C94517         10  WS-PO-NBR-CONVERT      PIC X(9)  VALUE SPACES.       ETKUP038
C94517         10  FILLER                 PIC X(21) VALUE SPACES.       ETKUP038
C94517     05  WS-TEMP-PO                 PIC 9(08) VALUE ZERO.         ETKUP038
00090      05  WS-UNUPCS-UPC              PIC S9(15)V COMP-3.           ETKUP038
00091      05  WS-TP-ID-QUAL              PIC X(02) VALUE SPACES.       ETKUP038
00092      05  WS-TP-ID                   PIC X(15) VALUE SPACES.       ETKUP038
00093      05  WS-ITEM-NBR                PIC S9(15) COMP-3.            ETKUP038
JF0403     05  WS-SKU                     PIC X(08) VALUE SPACES.               
00094 *                                                                 ETKUP038
00095  01  PV-PROGRAM-VARIABLES.                                        ETKUP038
00096      05  PV-PARAGRAPH-NAME       PIC  X(30)   VALUE SPACES.       ETKUP038
00097      05  PV-DB2-OPER-ATTEMPTED   PIC  X(30)   VALUE SPACES.       ETKUP038
00098      05  PV-SQL-SUB              PIC S9(03)   VALUE +0            ETKUP038
00099                                               COMP.               ETKUP038
00100 *                                                                 ETKUP038
00101  01  PC-PROGRAM-CONSTANTS.                                        ETKUP038
00102      05  PC-MAX-RETRIES          PIC S9(03)   VALUE +03           ETKUP038
00103                                               COMP.               ETKUP038
00104 *                                                                 ETKUP038
00105  01  PS-PROGRAM-SWITCHES.                                         ETKUP038
00106      05  PS-END-OF-FILE             PIC X     VALUE 'N'.          ETKUP038
00107          88  PS-EOF                           VALUE 'Y'.          ETKUP038
00108      05  PS-FIRST-HEADER            PIC X     VALUE 'Y'.          ETKUP038
00109          88  FIRST-HEADER                     VALUE 'Y'.          ETKUP038
00110          88  PAST-FIRST-HEADER                VALUE 'N'.          ETKUP038
00111      05  PS-REC-HAS-NOT-CHANGED     PIC X     VALUE 'N'.          ETKUP038
00112          88  REC-HAS-NOT-CHANGED              VALUE 'N'.          ETKUP038
00113          88  REC-HAS-CHANGED                  VALUE 'Y'.          ETKUP038
00114      05  PS-PO-STATUS-CHANGED       PIC X     VALUE 'N'.          ETKUP038
00115          88  PO-STATUS-HAS-NOT-CHANGED        VALUE 'N'.          ETKUP038
00116          88  PO-STATUS-HAS-CHANGED            VALUE 'Y'.          ETKUP038
00117      05  PS-ONE-DEPARTMENT          PIC X     VALUE 'Y'.          ETKUP038
00118          88  ONE-DEPT                         VALUE 'Y'.          ETKUP038
00119          88  MULTIPLE-DEPTS                   VALUE 'N'.          ETKUP038
00120      05  PS-ALL-GOOD-UPCS           PIC X     VALUE 'Y'.          ETKUP038
00121          88  ALL-GOOD-UPCS                    VALUE 'Y'.          ETKUP038
00122          88  NOT-ALL-GOOD-UPCS                VALUE 'N'.          ETKUP038
00123      05  PS-ALL-UPCS-ON-PO          PIC X     VALUE 'Y'.          ETKUP038
00124          88  ALL-UPCS-ON-PO                   VALUE 'Y'.          ETKUP038
00125          88  ALL-UPCS-NOT-ON-PO               VALUE 'N'.          ETKUP038
00126      05  PS-UPC-EXISTS              PIC X     VALUE 'Y'.          ETKUP038
00127          88  UPC-EXISTS                       VALUE 'Y'.          ETKUP038
00128          88  NO-UPC-EXISTS                    VALUE 'N'.          ETKUP038
00129      05  PS-PO-FOUND                PIC X     VALUE 'Y'.          ETKUP038
00130          88  PO-FOUND                         VALUE 'Y'.          ETKUP038
00131          88  PO-NOT-FOUND                     VALUE 'N'.          ETKUP038
022015                                                                          
022015 01  PA-PROGRAM-ACCUMULATORS.                                             
022015     05  PA-ROWS-READ               PIC 9(07)   VALUE ZEROES.             
022015     05  PA-ROWS-WROTE              PIC 9(07)   VALUE ZEROES.             
022015     05  PA-TFGTRHL-NOT-FOUND       PIC 9(07)   VALUE ZEROES.     ETKUP038
022015     05  PA-TPURCHS-NOT-FOUND       PIC 9(07)   VALUE ZEROES.     ETKUP038
022015     05  PA-EDIT-FIELD              PIC ZZZZZZ9.                  ETKUP038
00132 *                                                                 ETKUP038
00133 ******************************************************************ETKUP038
00134 *  SQL ABEND WORKING STORAGE                                      ETKUP038
00135 ******************************************************************ETKUP038
00136      COPY DPWS004.                                                ETKUP038
00137      EJECT                                                        ETKUP038
00138 *                                                                 ETKUP038
00139 ***************************************************************** ETKUP038
00140 *****  DB2 FUNCTIONAL GROUP ON HOLD TABLE DCLGEN                  ETKUP038
00141 ***************************************************************** ETKUP038
00142 *                                                                 ETKUP038
00143      EXEC SQL                                                     ETKUP038
00144          INCLUDE TFGTRHL                                          ETKUP038
00145      END-EXEC.                                                    ETKUP038
00146 *                                                                 ETKUP038
JF0403*****************************************************************    CL**5
JF0403*****  DB2 SKU CROSS REFERENCE TABLE DCLGEN                          CL**5
JF0403*****************************************************************    CL**5
JF0403                                                                     CL**5
JF0403     EXEC SQL                                                        CL**5
JF0403         INCLUDE TSKXREF                                             CL**5
JF0403     END-EXEC.                                                       CL**5
JF0403*                                                                 ETKUP036
00155 ***************************************************************** ETKUP038
00156 *****  DB2 PO TABLE DCLGEN                                        ETKUP038
00157 ***************************************************************** ETKUP038
00158 *                                                                 ETKUP038
00159      EXEC SQL                                                     ETKUP038
00160          INCLUDE TPURCHS                                          ETKUP038
00161      END-EXEC.                                                    ETKUP038
00162 *                                                                 ETKUP038
00163 ***************************************************************** ETKUP038
00164 *****  DB2 PURITM TABLE DCLGEN                                    ETKUP038
00165 ***************************************************************** ETKUP038
00166 *                                                                 ETKUP038
00167      EXEC SQL                                                     ETKUP038
00168          INCLUDE TPURITM                                          ETKUP038
00169      END-EXEC.                                                    ETKUP038
00170 *                                                                 ETKUP038
00171 ***************************************************************** ETKUP038
00172 *****  DB2 UPC / SKU TABLE DCLGEN                                 ETKUP038
00173 ***************************************************************** ETKUP038
00174 *                                                                 ETKUP038
00175      EXEC SQL                                                     ETKUP038
00176          INCLUDE TUPCSKU                                          ETKUP038
00177      END-EXEC.                                                    ETKUP038
00178 *                                                                 ETKUP038
00179 ***************************************************************** ETKUP038
00180 *****  DB2 EDI UPC LOOKUP TABLE DCLGEN                            ETKUP038
00181 ***************************************************************** ETKUP038
00182 *                                                                 ETKUP038
00183      EXEC SQL                                                     ETKUP038
00184          INCLUDE TUNUPCS                                          ETKUP038
00185      END-EXEC.                                                    ETKUP038
00186 *                                                                 ETKUP038
00187 ***************************************************************** ETKUP038
00188 *****  DB2 EDI NETWORK / VENDOR TABLE DCLGEN                      ETKUP038
00189 ***************************************************************** ETKUP038
00190 *                                                                 ETKUP038
00191      EXEC SQL                                                     ETKUP038
00192          INCLUDE TNETVND                                          ETKUP038
00193      END-EXEC.                                                    ETKUP038
00194 *                                                                 ETKUP038
00195 ***************************************************************** ETKUP038
00196 *****  DB2 EDI TRADING PARTNER TABLE DCLGEN                       ETKUP038
00197 ***************************************************************** ETKUP038
00198 *                                                                 ETKUP038
00199      EXEC SQL                                                     ETKUP038
00200          INCLUDE TTRDPRT                                          ETKUP038
00201      END-EXEC.                                                    ETKUP038
00202 *                                                                 ETKUP038
00203 ***************************************************************** ETKUP038
00204 * DB2 COMMUNICATIONS AREA                                         ETKUP038
00205 ***************************************************************** ETKUP038
00206                                                                   ETKUP038
00207      EXEC SQL                                                     ETKUP038
00208          INCLUDE SQLCA                                            ETKUP038
00209      END-EXEC.                                                    ETKUP038
00210 *                                                                 ETKUP038
00211      COPY SQLCA2.                                                 ETKUP038
00212                                                                   ETKUP038
00213  01  ABEND-CODE               PIC S9(04)  VALUE ZERO              ETKUP038
00214                                           COMP SYNC.              ETKUP038
00215      EJECT                                                        ETKUP038
00216  LINKAGE SECTION.                                                 ETKUP038
00217 *                                                                 ETKUP038
00218  PROCEDURE DIVISION.                                              ETKUP038
00219 *                                                                 ETKUP038
00220 ******************************************************************ETKUP038
00221 * MAIN-LINE LOGIC.                                                ETKUP038
00222 ******************************************************************ETKUP038
00223  A100-MAIN-MODULE.                                                ETKUP038
00224 *                                                                 ETKUP038
00225      OPEN INPUT  INV-INPUT-FILE.                                  ETKUP038
00226      OPEN OUTPUT INV-STATUS-FILE.                                 ETKUP038
00227 *                                                                 ETKUP038
00228      PERFORM Z100-READ-INPUT-FILE.                                ETKUP038
00229 *                                                                 ETKUP038
00230      SET FIRST-HEADER TO TRUE.                                    ETKUP038
00231 *                                                                 ETKUP038
00232      PERFORM B100-PROCESS-INV-FILE                                ETKUP038
00233              UNTIL PS-EOF.                                        ETKUP038
00234 *                                                                 ETKUP038
JF0703*    PERFORM B200-WRAPUP-INV-FILE.                                ETKUP038
00236 *                                                                 ETKUP038
022015     DISPLAY ' '.                                                         
022015     DISPLAY '    PROGRAM ETKUP038 TOTALS'.                               
022015     MOVE PA-ROWS-READ                TO PA-EDIT-FIELD.           ETKUP038
022015     DISPLAY 'NUMBER OF ROWS READ.................: '                     
022015                                         PA-EDIT-FIELD.                   
022015                                                                          
022015     MOVE PA-ROWS-WROTE               TO PA-EDIT-FIELD.           ETKUP038
022015     DISPLAY 'NUMBER OF ROWS WRITTEN..............: '                     
022015                                         PA-EDIT-FIELD.                   
022015                                                                          
022015     MOVE PA-TPURCHS-NOT-FOUND        TO PA-EDIT-FIELD.           ETKUP038
022015     DISPLAY 'NUMBER OF ROWS NOT FOUND ON TPURCHS.: '                     
022015                                         PA-EDIT-FIELD.           ETKUP038
022015                                                                          
022015     MOVE PA-TFGTRHL-NOT-FOUND        TO PA-EDIT-FIELD.           ETKUP038
022015     DISPLAY 'NUMBER OF ROWS NOT FOUND ON TFGTRHL.: '                     
022015                                         PA-EDIT-FIELD.           ETKUP038
00237 *                                                                 ETKUP038
00238      CLOSE INV-INPUT-FILE                                         ETKUP038
00239            INV-STATUS-FILE.                                       ETKUP038
00240      STOP RUN.                                                    ETKUP038
00241 *                                                                 ETKUP038
00242 ******************************************************************ETKUP038
00243 *  PROCESS ALL INV RECORDS FROM INPUT FILE.                       ETKUP038
00244 ******************************************************************ETKUP038
00245  B100-PROCESS-INV-FILE.                                           ETKUP038
00246 *                                                                 ETKUP038
00247       IF AP050-INV-INTRCHG                                        ETKUP038
00248 *                                                                 ETKUP038
00249 * MOVE NEW HEADER TO SAVE AREA                                    ETKUP038
00250          MOVE INV-INPUT-DBKEY  TO WS-DBKEY-SAVE-AREA              ETKUP038
00251          MOVE AP050-KEY        TO WS-INVKEY-SAVE-AREA             ETKUP038
00252          MOVE AP050-DATA-AREA  TO WS-DATA-SAVE-AREA               ETKUP038
00253 *                                                                 ETKUP038
JF0703*        IF FIRST-HEADER                                          ETKUP038
JF0703*           SET PAST-FIRST-HEADER TO TRUE                         ETKUP038
JF0703*        ELSE                                                     ETKUP038
JF0703*                                                                 ETKUP038
JF0703* MOVE OLD HEADER TO APRD HEADER TO WRAP UP THAT INVOICE          ETKUP038
JF0703*                                                                 ETKUP038
JF0703*           MOVE WS-DBKEY-AREA    TO INV-INPUT-DBKEY              ETKUP038
JF0703*           MOVE WS-INVKEY-RECORD TO AP050-KEY                    ETKUP038
JF0703*           MOVE WS-DATA-AREA     TO AP050-DATA-AREA              ETKUP038
JF0703*                                                                 ETKUP038
JF0703*           IF ALL-GOOD-UPCS                                      ETKUP038
JF0703*              IF AP050-BAD-UPCS                                  ETKUP038
JF0703*                 SET AP050-GOOD-UPCS TO TRUE                     ETKUP038
JF0703*                 SET REC-HAS-CHANGED TO TRUE                     ETKUP038
JF0703*              END-IF                                             ETKUP038
JF0703*           END-IF                                                ETKUP038
JF0703*                                                                 ETKUP038
JF0703*           IF ALL-UPCS-ON-PO                                     ETKUP038
JF0703*              IF AP050-UPCS-NO-MATCH                             ETKUP038
JF0703*                 SET AP050-UPCS-MATCH TO TRUE                    ETKUP038
JF0703*                 SET REC-HAS-CHANGED TO TRUE                     ETKUP038
JF0703*              END-IF                                             ETKUP038
JF0703*           END-IF                                                ETKUP038
JF0703*                                                                 ETKUP038
JF0703*           IF PO-FOUND       AND                                 ETKUP038
JF0703*              ALL-GOOD-UPCS  AND                                 ETKUP038
JF0703*              ALL-UPCS-ON-PO                                     ETKUP038
JF0703*              SET AP050-NEW-INV-GOOD TO TRUE                     ETKUP038
JF0703*              SET REC-HAS-CHANGED TO TRUE                        ETKUP038
JF0703*           END-IF                                                ETKUP038
JF0703*                                                                 ETKUP038
JF0703*           IF REC-HAS-CHANGED OR PO-STATUS-HAS-CHANGED           ETKUP038
JF0703*              SET UPDATE-DB-RECORD TO TRUE                       ETKUP038
JF0703*           ELSE                                                  ETKUP038
JF0703*              SET NO-DB-ACTION TO TRUE                           ETKUP038
JF0703*           END-IF                                                ETKUP038
JF0703*                                                                 ETKUP038
JF0703*           MOVE AP050-EDI-SEQ-NBR TO WS-SEQ-NBR                  ETKUP038
JF0703*           MOVE INV-INPUT-DBKEY   TO INV-STATUS-DBKEY            ETKUP038
JF0703*           MOVE AP050-KEY         TO INV-STATUS-INVKEY           ETKUP038
JF0703*           MOVE AP050-DATA-AREA   TO INV-STATUS-DATA             ETKUP038
JF0703*           PERFORM Z200-WRITE-OUTPUT-FILE                        ETKUP038
JF0703*        END-IF                                                   ETKUP038
00297                                                                   ETKUP038
00298 * MOVE NEW SAVED HEADER BACK INTO AP050                           ETKUP038
00299          MOVE WS-DBKEY-SAVE-AREA  TO INV-INPUT-DBKEY              ETKUP038
00300          MOVE WS-INVKEY-SAVE-AREA TO AP050-KEY                    ETKUP038
00301          MOVE WS-DATA-SAVE-AREA   TO AP050-DATA-AREA              ETKUP038
00302                                                                   ETKUP038
00303          SET ALL-GOOD-UPCS     TO TRUE                            ETKUP038
00304          SET ALL-UPCS-ON-PO    TO TRUE                            ETKUP038
00305          SET PO-FOUND          TO TRUE                            ETKUP038
00306 *                                                                 ETKUP038
00307          IF AP050-PO-NOT-FOUND OR                                 ETKUP038
00308             AP050-PO-ON-HOLD                                      ETKUP038
00309 *                                                                 ETKUP038
00310             MOVE AP050-KOHLS-PO-NBR TO WS-PURCHS-PO-NBR           ETKUP038
00311             PERFORM C100-VERIFY-PO-NBR                            ETKUP038
00312             IF SQLCODE = +000                                     ETKUP038
00313                MOVE PURCHS-STATUS-CDE TO AP050-PO-STATUS          ETKUP038
00314                MOVE PURCHS-DEPT-NBR   TO AP050-DEPT-NBR-ON-PO     ETKUP038
00315                SET PO-STATUS-HAS-CHANGED TO TRUE                  ETKUP038
00316             ELSE                                                  ETKUP038
00317                IF SQLCODE = +100                                  ETKUP038
022015                  ADD 1  TO PA-TPURCHS-NOT-FOUND                  ETKUP038
00318                   SET PO-NOT-FOUND TO TRUE                        ETKUP038
C94517                  MOVE AP050-KOHLS-PO-NBR TO WS-PO-NBR-CONVERT    ETKUP038
00321                   MOVE WS-CNVRTD-PO-NBR                           ETKUP038
00322                                   TO WS-HELD-PO-NBR               ETKUP038
00323                   PERFORM C150-VERIFY-PO-NBR-NOT-HELD             ETKUP038
00324                   IF SQLCODE = +000 OR -811                       ETKUP038
00325                      IF AP050-PO-NOT-FOUND                        ETKUP038
00326                         SET AP050-PO-ON-HOLD TO TRUE              ETKUP038
00327                         SET PO-STATUS-HAS-CHANGED TO TRUE         ETKUP038
00328                      END-IF                                       ETKUP038
00329                   ELSE                                            ETKUP038
00330                      IF SQLCODE = +100                            ETKUP038
022015                        ADD 1  TO PA-TFGTRHL-NOT-FOUND            ETKUP038
00331                         IF AP050-PO-ON-HOLD                       ETKUP038
00332                            SET AP050-PO-NOT-FOUND TO TRUE         ETKUP038
00333                            SET PO-STATUS-HAS-CHANGED TO TRUE      ETKUP038
022015                        ELSE                                         CL**5
022015                           DISPLAY ' PO ' WS-PO-NBR-CONVERT          CL**5
022015                                ' NOT FOUND AND NOT ON HOLD'         CL**5
00334                         END-IF                                    ETKUP038
00335                      END-IF                                       ETKUP038
00336                   END-IF                                          ETKUP038
00337                END-IF                                             ETKUP038
00338             END-IF                                                ETKUP038
00339          END-IF                                                   ETKUP038
00340 *                                                                 ETKUP038
00341          MOVE AP050-KOHLS-PO-NBR    TO WS-PO-NBR                  ETKUP038
00342          MOVE AP050-VENDOR-INVOICE-NBR                            ETKUP038
00343               TO WS-INVOICE-NBR                                   ETKUP038
00344          MOVE AP050-RECORD-TYPE-IND TO WS-RECORD-TYPE             ETKUP038
00345          MOVE AP050-EDI-SEQ-NBR     TO WS-SEQ-NBR                 ETKUP038
00346          MOVE AP050-DATA-AREA       TO WS-DATA-AREA               ETKUP038
00347          MOVE INV-INPUT-DBKEY       TO WS-DBKEY-AREA              ETKUP038
JF0703         PERFORM B200-WRAPUP-INV-FILE                                     
00348 *                                                                 ETKUP038
00349       END-IF.                                                     ETKUP038
00350 *                                                                 ETKUP038
JF0703*     IF AP050-INV-DETAILS                                        ETKUP038
JF0703*        SET NO-UPC-EXISTS TO TRUE                                ETKUP038
JF0703*        SET PO-STATUS-HAS-NOT-CHANGED TO TRUE                    ETKUP038
JF0703*                                                                 ETKUP038
JF0703*        IF AP050-UPC                                             ETKUP038
JF0703*           SET UPC-EXISTS TO TRUE                                ETKUP038
JF0703*           IF AP050-KOHLS-SKU = '        '                       ETKUP038
JF0703*              MOVE AP050-UPC-CODE TO WS-UNUPCS-UPC               ETKUP038
JF0703*              PERFORM C300-VERIFY-UPC-SKU                        ETKUP038
JF0703*           END-IF                                                ETKUP038
JF0703*        ELSE                                                     ETKUP038
JF0703*           IF AP050-EAN                                          ETKUP038
JF0703*              IF AP050-KOHLS-SKU = '        '                    ETKUP038
JF0703*                 SET UPC-EXISTS TO TRUE                          ETKUP038
JF0703*                 MOVE AP050-EAN-UPC TO WS-UNUPCS-UPC             ETKUP038
JF0703*                 PERFORM C400-VERIFY-EAN-SKU                     ETKUP038
JF0703*              END-IF                                             ETKUP038
JF0703*           END-IF                                                ETKUP038
JF0703*        END-IF                                                   ETKUP038
JF0703*                                                                 ETKUP038
JF0703*        IF UPC-EXISTS                                            ETKUP038
JF0703*           IF AP050-KOHLS-SKU = '        '                       ETKUP038
JF0703*              IF SQLCODE = +000                                  ETKUP038
JF0703*                 MOVE SKXREF-SKU TO WS-SKU                          CL*23
JF0703*                 MOVE WS-SKU TO AP050-KOHLS-SKU                     CL*23
JF0703*                 MOVE TUPCSKU-ITEM-NBR TO AP050-ITEM-NBR         ETKUP038
JF0703*                 SET REC-HAS-CHANGED TO TRUE                     ETKUP038
JF0703*                                                                 ETKUP038
JF0703*                 IF PO-FOUND AND AP050-NO-LINE-MATCH                CL**3
JF0703*                    MOVE AP050-KOHLS-PO-NBR TO WS-PURCHS-PO-NBR  ETKUP038
JF0703*                    PERFORM C200-VERIFY-UPC-MATCHES              ETKUP038
JF0703*                    IF SQLCODE = +000 OR -811                    ETKUP038
JF0703*                       SET AP050-LINE-MATCH TO TRUE              ETKUP038
JF0703*                       SET REC-HAS-CHANGED  TO TRUE              ETKUP038
JF0703*                    ELSE                                         ETKUP038
JF0703*                       IF SQLCODE = +100                         ETKUP038
JF0703*                          SET ALL-UPCS-NOT-ON-PO  TO TRUE        ETKUP038
JF0703*                       END-IF                                    ETKUP038
JF0703*                    END-IF                                       ETKUP038
JF0703*                 ELSE                                            ETKUP038
JF0703*                    IF PO-NOT-FOUND OR AP050-NO-LINE-MATCH          CL**3
JF0703*                       SET AP050-NO-LINE-MATCH TO TRUE           ETKUP038
JF0703*                       SET ALL-UPCS-NOT-ON-PO  TO TRUE           ETKUP038
JF0703*                    END-IF                                       ETKUP038
JF0703*                 END-IF                                          ETKUP038
JF0703*              ELSE                                               ETKUP038
JF0703*                IF SQLCODE = +100                                ETKUP038
JF0703*                   SET NOT-ALL-GOOD-UPCS TO TRUE                 ETKUP038
JF0703*                   SET AP050-NO-LINE-MATCH TO TRUE               ETKUP038
JF0703*                END-IF                                           ETKUP038
JF0703*              END-IF                                             ETKUP038
JF0703*           ELSE                                                     CL**4
JF0703*              IF PO-FOUND AND AP050-NO-LINE-MATCH                   CL**3
JF0703*                 MOVE AP050-KOHLS-PO-NBR TO WS-PURCHS-PO-NBR     ETKUP038
JF0703*                 MOVE AP050-ITEM-NBR     TO WS-ITEM-NBR          ETKUP038
JF0703*                 PERFORM C250-VERIFY-UPC-INV                     ETKUP038
JF0703*                 IF SQLCODE = +000 OR -811                       ETKUP038
JF0703*                    SET AP050-LINE-MATCH TO TRUE                 ETKUP038
JF0703*                    SET REC-HAS-CHANGED  TO TRUE                 ETKUP038
JF0703*                 ELSE                                            ETKUP038
JF0703*                    IF SQLCODE = +100                            ETKUP038
JF0703*                       SET ALL-UPCS-NOT-ON-PO  TO TRUE           ETKUP038
JF0703*                    END-IF                                       ETKUP038
JF0703*                 END-IF                                          ETKUP038
JF0703*              ELSE                                               ETKUP038
JF0703*                 IF PO-NOT-FOUND                                 ETKUP038
JF0703*                    SET AP050-NO-LINE-MATCH TO TRUE              ETKUP038
JF0703*                    SET ALL-UPCS-NOT-ON-PO  TO TRUE              ETKUP038
JF0703*                 END-IF                                          ETKUP038
JF0703*              END-IF                                             ETKUP038
JF0703*           END-IF                                                ETKUP038
JF0703*        END-IF                                                   ETKUP038
JF0703*                                                                 ETKUP038
JF0703*        IF REC-HAS-CHANGED                                       ETKUP038
JF0703*           SET UPDATE-DB-RECORD TO TRUE                          ETKUP038
JF0703*        ELSE                                                     ETKUP038
JF0703*           SET NO-DB-ACTION     TO TRUE                          ETKUP038
JF0703*        END-IF                                                   ETKUP038
JF0703*                                                                 ETKUP038
JF0703*        MOVE AP050-EDI-SEQ-NBR TO WS-SEQ-NBR                     ETKUP038
JF0703*        MOVE INV-INPUT-DBKEY   TO INV-STATUS-DBKEY               ETKUP038
JF0703*        MOVE AP050-KEY         TO INV-STATUS-INVKEY              ETKUP038
JF0703*        MOVE AP050-DATA-AREA   TO INV-STATUS-DATA                ETKUP038
JF0703*        PERFORM Z200-WRITE-OUTPUT-FILE                           ETKUP038
JF0703*     END-IF.                                                     ETKUP038
00435 *                                                                 ETKUP038
00436       IF AP050-INV-INVOICE-DATA  OR                               ETKUP038
JF0703         AP050-INV-DETAILS       OR                                       
JF0703         AP050-INV-PACK-ITEMS    OR                                       
JF0703         AP050-INV-PKITEM-DESC   OR                                       
00437          AP050-INV-REMIT-TO      OR                               ETKUP038
00438          AP050-INV-TERMS         OR                               ETKUP038
00439          AP050-INV-ALLW-CHGS     OR                               ETKUP038
00440          AP050-INV-SUMMARY                                        ETKUP038
00441                                                                   ETKUP038
00442          SET NO-DB-ACTION       TO TRUE                           ETKUP038
00443          MOVE AP050-EDI-SEQ-NBR TO WS-SEQ-NBR                     ETKUP038
00444          MOVE INV-INPUT-DBKEY   TO INV-STATUS-DBKEY               ETKUP038
00445          MOVE AP050-KEY         TO INV-STATUS-INVKEY              ETKUP038
00446          MOVE AP050-DATA-AREA   TO INV-STATUS-DATA                ETKUP038
00447          PERFORM Z200-WRITE-OUTPUT-FILE                           ETKUP038
00448       END-IF.                                                     ETKUP038
00449 *                                                                 ETKUP038
00450       PERFORM Z100-READ-INPUT-FILE.                               ETKUP038
00451 *                                                                 ETKUP038
00452 ******************************************************************ETKUP038
00453 *  PROCESS ALL INV RECORDS FROM INPUT FILE.                       ETKUP038
00454 ******************************************************************ETKUP038
00455  B200-WRAPUP-INV-FILE.                                            ETKUP038
00456 *                                                                 ETKUP038
00457 * MOVE OLD HEADER TO APRD HEADER TO WRAP UP THAT INVOICE          ETKUP038
00458 *                                                                 ETKUP038
00459        MOVE WS-DBKEY-AREA TO INV-INPUT-DBKEY.                     ETKUP038
00460        MOVE WS-INVKEY-RECORD TO AP050-KEY.                        ETKUP038
00461        MOVE WS-DATA-AREA  TO AP050-DATA-AREA.                     ETKUP038
00462                                                                   ETKUP038
00463        IF ALL-GOOD-UPCS                                           ETKUP038
00464           IF AP050-BAD-UPCS                                       ETKUP038
00465              SET AP050-GOOD-UPCS TO TRUE                          ETKUP038
00466              SET REC-HAS-CHANGED TO TRUE                          ETKUP038
00467           END-IF                                                  ETKUP038
00468        END-IF.                                                    ETKUP038
00469 *                                                                 ETKUP038
00470        IF ALL-UPCS-ON-PO                                          ETKUP038
00471           IF AP050-UPCS-NO-MATCH                                  ETKUP038
00472              SET AP050-UPCS-MATCH TO TRUE                         ETKUP038
00473              SET REC-HAS-CHANGED TO TRUE                          ETKUP038
00474           END-IF                                                  ETKUP038
00475        END-IF.                                                    ETKUP038
00476 *                                                                 ETKUP038
00477        IF PO-FOUND       AND                                      ETKUP038
00478           ALL-GOOD-UPCS  AND                                      ETKUP038
00479           ALL-UPCS-ON-PO                                          ETKUP038
00480           SET AP050-NEW-INV-GOOD TO TRUE                          ETKUP038
00481           SET REC-HAS-CHANGED TO TRUE                             ETKUP038
00482        END-IF.                                                    ETKUP038
00483 *                                                                 ETKUP038
00484        IF REC-HAS-CHANGED OR PO-STATUS-HAS-CHANGED                ETKUP038
00485           SET UPDATE-DB-RECORD TO TRUE                            ETKUP038
00486        ELSE                                                       ETKUP038
00487           SET NO-DB-ACTION TO TRUE                                ETKUP038
00488        END-IF.                                                    ETKUP038
00489 *                                                                 ETKUP038
00490        MOVE AP050-EDI-SEQ-NBR TO WS-SEQ-NBR.                      ETKUP038
00491        MOVE INV-INPUT-DBKEY   TO INV-STATUS-DBKEY.                ETKUP038
00492        MOVE AP050-KEY         TO INV-STATUS-INVKEY.               ETKUP038
00493        MOVE AP050-DATA-AREA   TO INV-STATUS-DATA.                 ETKUP038
00494        PERFORM Z200-WRITE-OUTPUT-FILE.                            ETKUP038
JF0703*                                                                         
JF0703       SET REC-HAS-NOT-CHANGED TO TRUE.                                   
JF0703       SET PO-STATUS-HAS-NOT-CHANGED TO TRUE.                             
00495 *                                                                 ETKUP038
00496 ******************************************************************ETKUP038
00497 *  VERIFY THAT THE PO IS VALID                                    ETKUP038
00498 ******************************************************************ETKUP038
00499  C100-VERIFY-PO-NBR.                                              ETKUP038
00500 *                                                                 ETKUP038
00501      PERFORM                                                      ETKUP038
00502          WITH TEST AFTER                                          ETKUP038
00503          VARYING PV-SQL-SUB                                       ETKUP038
00504          FROM 1 BY 1                                              ETKUP038
00505          UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       ETKUP038
00506                    OR SQLCODE = 0                                 ETKUP038
00507                    OR SQLCODE = +100                              ETKUP038
00508                    OR SQLCODE = -811)                             ETKUP038
00509 *                                                                 ETKUP038
00510          EXEC SQL                                                 ETKUP038
00511              SELECT A.PO_NBR,                                     ETKUP038
00512                     A.STATUS_CDE,                                 ETKUP038
00513                     A.DEPT_NBR                                    ETKUP038
00514              INTO :PURCHS-PO-NBR,                                 ETKUP038
00515                   :PURCHS-STATUS-CDE,                             ETKUP038
00516                   :PURCHS-DEPT-NBR                                ETKUP038
00517              FROM TPURCHS A                                       ETKUP038
00518              WHERE A.PO_NBR = :WS-PURCHS-PO-NBR AND               ETKUP038
00519                    A.VER_STATUS_CDE = 'A'                         ETKUP038
00520          END-EXEC                                                 ETKUP038
00521 *                                                                 ETKUP038
00522          EVALUATE TRUE                                            ETKUP038
00523              WHEN SQLCODE = -904                                  ETKUP038
00524              WHEN SQLCODE = -911                                  ETKUP038
00525              WHEN SQLCODE = -811                                  ETKUP038
00526              WHEN SQLCODE = 100                                   ETKUP038
00527              WHEN SQLCODE = 0                                     ETKUP038
00528                  CONTINUE                                         ETKUP038
00529              WHEN SQLWARN NOT = SPACES                            ETKUP038
00530              WHEN SQLCODE NOT = ZERO                              ETKUP038
00531                  MOVE 'C100-VERIFY-PO-NBR'                        ETKUP038
00532                                TO  PV-PARAGRAPH-NAME              ETKUP038
00533                  MOVE 'VERIFY PO NUMBER'                          ETKUP038
00534                                TO  PV-DB2-OPER-ATTEMPTED          ETKUP038
00535                  PERFORM Z900-SQL-ABEND                           ETKUP038
00536          END-EVALUATE                                             ETKUP038
00537      END-PERFORM.                                                 ETKUP038
00538 *                                                                 ETKUP038
00539      IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        ETKUP038
00540          MOVE 'C100-VERIFY-PO-NBR'                                ETKUP038
00541                                TO  PV-PARAGRAPH-NAME              ETKUP038
00542          MOVE 'VERIFY RETRIES EXCEEDED'                           ETKUP038
00543                                TO  PV-DB2-OPER-ATTEMPTED          ETKUP038
00544          PERFORM Z900-SQL-ABEND                                   ETKUP038
00545      END-IF.                                                      ETKUP038
00546 *                                                                 ETKUP038
00547 ******************************************************************ETKUP038
00548 *  VERIFY THAT THE PO IS NOT ON HOLD                              ETKUP038
00549 ******************************************************************ETKUP038
00550  C150-VERIFY-PO-NBR-NOT-HELD.                                     ETKUP038
00551 *                                                                 ETKUP038
00552      PERFORM                                                      ETKUP038
00553          WITH TEST AFTER                                          ETKUP038
00554          VARYING PV-SQL-SUB                                       ETKUP038
00555          FROM 1 BY 1                                              ETKUP038
00556          UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       ETKUP038
00557                    OR SQLCODE = 0                                 ETKUP038
00558                    OR SQLCODE = +100                              ETKUP038
00559                    OR SQLCODE = -811)                             ETKUP038
00560 *                                                                 ETKUP038
00561          EXEC SQL                                                 ETKUP038
00562              SELECT A.TRN_DTL_TXT                                 ETKUP038
00563              INTO :FGTRHL-TRN-DTL-TXT                             ETKUP038
00564              FROM TFGTRHL A                                       ETKUP038
00565              WHERE A.TRN_DTL_TXT = :WS-HELD-PO-NBR AND            ETKUP038
00566                    A.TRN_SET_CDE = '855'                          ETKUP038
00567          END-EXEC                                                 ETKUP038
00568 *                                                                 ETKUP038
00569          EVALUATE TRUE                                            ETKUP038
00570              WHEN SQLCODE = -904                                  ETKUP038
00571              WHEN SQLCODE = -911                                  ETKUP038
00572              WHEN SQLCODE = -811                                  ETKUP038
00573              WHEN SQLCODE = 100                                   ETKUP038
00574              WHEN SQLCODE = 0                                     ETKUP038
00575                  CONTINUE                                         ETKUP038
00576              WHEN SQLWARN NOT = SPACES                            ETKUP038
00577              WHEN SQLCODE NOT = ZERO                              ETKUP038
00578                  MOVE 'C150-VERIFY-PO-NBR-NOT-HELD'               ETKUP038
00579                                TO  PV-PARAGRAPH-NAME              ETKUP038
00580                  MOVE 'VERIFY PO NUMBER'                          ETKUP038
00581                                TO  PV-DB2-OPER-ATTEMPTED          ETKUP038
00582                  PERFORM Z900-SQL-ABEND                           ETKUP038
00583          END-EVALUATE                                             ETKUP038
00584      END-PERFORM.                                                 ETKUP038
00585 *                                                                 ETKUP038
00586      IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        ETKUP038
00587          MOVE 'C150-VERIFY-PO-NBR-NOT-HELD'                       ETKUP038
00588                                TO  PV-PARAGRAPH-NAME              ETKUP038
00589          MOVE 'VERIFY RETRIES EXCEEDED'                           ETKUP038
00590                                TO  PV-DB2-OPER-ATTEMPTED          ETKUP038
00591          PERFORM Z900-SQL-ABEND                                   ETKUP038
00592      END-IF.                                                      ETKUP038
00593 *                                                                 ETKUP038
JF0703******************************************************************ETKUP038
JF0703*  VERIFY THAT THE UPC HAS A MATCH ON THE PO                      ETKUP038
JF0703******************************************************************ETKUP038
JF0703*C200-VERIFY-UPC-MATCHES.                                         ETKUP038
JF0703*                                                                 ETKUP038
JF0703*    PERFORM                                                      ETKUP038
JF0703*        WITH TEST AFTER                                          ETKUP038
JF0703*        VARYING PV-SQL-SUB                                       ETKUP038
JF0703*        FROM 1 BY 1                                              ETKUP038
JF0703*        UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       ETKUP038
JF0703*                  OR SQLCODE = 0                                 ETKUP038
JF0703*                  OR SQLCODE = +100                              ETKUP038
JF0703*                  OR SQLCODE = -811)                             ETKUP038
JF0703*                                                                 ETKUP038
JF0703*        EXEC SQL                                                 ETKUP038
JF0703*            SELECT A.PO_NBR                                      ETKUP038
JF0703*            INTO :PURITM-PO-NBR                                  ETKUP038
JF0703*            FROM TPURITM A                                       ETKUP038
JF0703*            WHERE A.PO_NBR      = :WS-PURCHS-PO-NBR AND          ETKUP038
JF0703*                  A.VER_STATUS_CDE = 'A' AND                     ETKUP038
JF0703*                  A.ITM_NBR = :TUPCSKU-ITEM-NBR                  ETKUP038
JF0703*        END-EXEC                                                 ETKUP038
JF0703*                                                                 ETKUP038
JF0703*        EVALUATE TRUE                                            ETKUP038
JF0703*            WHEN SQLCODE = -904                                  ETKUP038
JF0703*            WHEN SQLCODE = -911                                  ETKUP038
JF0703*            WHEN SQLCODE = -811                                  ETKUP038
JF0703*            WHEN SQLCODE = 100                                   ETKUP038
JF0703*            WHEN SQLCODE = 0                                     ETKUP038
JF0703*                CONTINUE                                         ETKUP038
JF0703*            WHEN SQLWARN NOT = SPACES                            ETKUP038
JF0703*            WHEN SQLCODE NOT = ZERO                              ETKUP038
JF0703*                MOVE 'C200-VERIFY-UPC-MATCHES'                   ETKUP038
JF0703*                              TO  PV-PARAGRAPH-NAME              ETKUP038
JF0703*                MOVE 'VERIFY UPC MATCHES'                        ETKUP038
JF0703*                              TO  PV-DB2-OPER-ATTEMPTED          ETKUP038
JF0703*                PERFORM Z900-SQL-ABEND                           ETKUP038
JF0703*        END-EVALUATE                                             ETKUP038
JF0703*    END-PERFORM.                                                 ETKUP038
JF0703*                                                                 ETKUP038
JF0703*    IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        ETKUP038
JF0703*        MOVE 'C200-VERIFY-UPC-MATCHES'                           ETKUP038
JF0703*                              TO  PV-PARAGRAPH-NAME              ETKUP038
JF0703*        MOVE 'VERIFY RETRIES EXCEEDED'                           ETKUP038
JF0703*                              TO  PV-DB2-OPER-ATTEMPTED          ETKUP038
JF0703*        PERFORM Z900-SQL-ABEND                                   ETKUP038
JF0703*    END-IF.                                                      ETKUP038
JF0703*                                                                 ETKUP038
JF0703******************************************************************ETKUP038
JF0703*  VERIFY THAT THE UPC HAS A MATCH ON THE PO                      ETKUP038
JF0703******************************************************************ETKUP038
JF0703*C250-VERIFY-UPC-INV.                                             ETKUP038
JF0703*                                                                 ETKUP038
JF0703*    PERFORM                                                      ETKUP038
JF0703*        WITH TEST AFTER                                          ETKUP038
JF0703*        VARYING PV-SQL-SUB                                       ETKUP038
JF0703*        FROM 1 BY 1                                              ETKUP038
JF0703*        UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       ETKUP038
JF0703*                  OR SQLCODE = 0                                 ETKUP038
JF0703*                  OR SQLCODE = +100                              ETKUP038
JF0703*                  OR SQLCODE = -811)                             ETKUP038
JF0703*                                                                 ETKUP038
JF0703*        EXEC SQL                                                 ETKUP038
JF0703*            SELECT A.PO_NBR                                      ETKUP038
JF0703*            INTO :PURITM-PO-NBR                                  ETKUP038
JF0703*            FROM TPURITM A                                       ETKUP038
JF0703*            WHERE A.PO_NBR      = :WS-PURCHS-PO-NBR AND          ETKUP038
JF0703*                  A.VER_STATUS_CDE = 'A' AND                     ETKUP038
JF0703*                  A.ITM_NBR = :WS-ITEM-NBR                       ETKUP038
JF0703*        END-EXEC                                                 ETKUP038
JF0703*                                                                 ETKUP038
JF0703*        EVALUATE TRUE                                            ETKUP038
JF0703*            WHEN SQLCODE = -904                                  ETKUP038
JF0703*            WHEN SQLCODE = -911                                  ETKUP038
JF0703*            WHEN SQLCODE = -811                                  ETKUP038
JF0703*            WHEN SQLCODE = 100                                   ETKUP038
JF0703*            WHEN SQLCODE = 0                                     ETKUP038
JF0703*                CONTINUE                                         ETKUP038
JF0703*            WHEN SQLWARN NOT = SPACES                            ETKUP038
JF0703*            WHEN SQLCODE NOT = ZERO                              ETKUP038
JF0703*                MOVE 'C250-VERIFY-UPC-INV'                       ETKUP038
JF0703*                              TO  PV-PARAGRAPH-NAME              ETKUP038
JF0703*                MOVE 'VERIFY UPC MATCHES'                        ETKUP038
JF0703*                              TO  PV-DB2-OPER-ATTEMPTED          ETKUP038
JF0703*                PERFORM Z900-SQL-ABEND                           ETKUP038
JF0703*        END-EVALUATE                                             ETKUP038
JF0703*    END-PERFORM.                                                 ETKUP038
JF0703*                                                                 ETKUP038
JF0703*    IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        ETKUP038
JF0703*        MOVE 'C250-VERIFY-UPC-INV'                               ETKUP038
JF0703*                              TO  PV-PARAGRAPH-NAME              ETKUP038
JF0703*        MOVE 'VERIFY RETRIES EXCEEDED'                           ETKUP038
JF0703*                              TO  PV-DB2-OPER-ATTEMPTED          ETKUP038
JF0703*        PERFORM Z900-SQL-ABEND                                   ETKUP038
JF0703*    END-IF.                                                      ETKUP038
JF0703*                                                                 ETKUP038
JF0703******************************************************************ETKUP038
JF0703*  VERIFY THAT THE UPC AND SKU ARE ON THE APPROPRIATE TABLES      ETKUP038
JF0703******************************************************************ETKUP038
JF0703*C300-VERIFY-UPC-SKU.                                             ETKUP038
JF0703*                                                                 ETKUP038
JF0703*    PERFORM                                                      ETKUP038
JF0703*        WITH TEST AFTER                                          ETKUP038
JF0703*        VARYING PV-SQL-SUB                                       ETKUP038
JF0703*        FROM 1 BY 1                                              ETKUP038
JF0703*        UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       ETKUP038
JF0703*                  OR SQLCODE = 0                                 ETKUP038
JF0703*                  OR SQLCODE = +100)                             ETKUP038
JF0703*                                                                 ETKUP038
JF0703*        EXEC SQL                                                 ETKUP036
JF0703*            SELECT SKU                                           ETKUP036
JF0703*                 , B.ITEM_NBR                                    ETKUP036
JF0703*            INTO :SKXREF-SKU                                     ETKUP036
JF0703*               , :TUPCSKU-ITEM-NBR                               ETKUP036
JF0703*            FROM TSKXREF A                                       ETKUP036
JF0703*               , TUPCSKU B                                               
JF0703*            WHERE B.UPC_NBR  = :WS-UNUPCS-UPC                       CL*12
JF0703*              AND A.ITM_NBR = B.ITEM_NBR                         ETKUP036
JF0703*        END-EXEC                                                 ETKUP036
JF0703*                                                                 ETKUP038
JF0703*        EVALUATE TRUE                                            ETKUP038
JF0703*            WHEN SQLCODE = -904                                  ETKUP038
JF0703*            WHEN SQLCODE = -911                                  ETKUP038
JF0703*            WHEN SQLCODE = 100                                   ETKUP038
JF0703*            WHEN SQLCODE = 0                                     ETKUP038
JF0703*                CONTINUE                                         ETKUP038
JF0703*            WHEN SQLWARN NOT = SPACES                            ETKUP038
JF0703*            WHEN SQLCODE NOT = ZERO                              ETKUP038
JF0703*                MOVE 'C300-VERIFY-UPC-SKU'                       ETKUP038
JF0703*                              TO  PV-PARAGRAPH-NAME              ETKUP038
JF0703*                MOVE 'VERIFY UPCS AND SKUS'                      ETKUP038
JF0703*                              TO  PV-DB2-OPER-ATTEMPTED          ETKUP038
JF0703*                PERFORM Z900-SQL-ABEND                           ETKUP038
JF0703*        END-EVALUATE                                             ETKUP038
JF0703*    END-PERFORM.                                                 ETKUP038
JF0703*                                                                 ETKUP038
JF0703*    IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        ETKUP038
JF0703*        MOVE 'C300-VERIFY-UPC-SKU'                               ETKUP038
JF0703*                              TO  PV-PARAGRAPH-NAME              ETKUP038
JF0703*        MOVE 'VERIFY RETRIES EXCEEDED'                           ETKUP038
JF0703*                              TO  PV-DB2-OPER-ATTEMPTED          ETKUP038
JF0703*        PERFORM Z900-SQL-ABEND                                   ETKUP038
JF0703*    END-IF.                                                      ETKUP038
JF0703*                                                                 ETKUP038
JF0703******************************************************************ETKUP038
JF0703*  VERIFY THAT THE EAN AND SKU ARE ON THE APPROPRIATE TABLES      ETKUP038
JF0703******************************************************************ETKUP038
JF0703*C400-VERIFY-EAN-SKU.                                             ETKUP038
JF0703*                                                                 ETKUP038
JF0703*    PERFORM                                                      ETKUP038
JF0703*        WITH TEST AFTER                                          ETKUP038
JF0703*        VARYING PV-SQL-SUB                                       ETKUP038
JF0703*        FROM 1 BY 1                                              ETKUP038
JF0703*        UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       ETKUP038
JF0703*                  OR SQLCODE = 0                                 ETKUP038
JF0703*                  OR SQLCODE = +100)                             ETKUP038
JF0703*                                                                 ETKUP038
JF0703*        EXEC SQL                                                 ETKUP036
JF0703*            SELECT SKU                                           ETKUP036
JF0703*                 , B.ITEM_NBR                                    ETKUP036
JF0703*            INTO :SKXREF-SKU                                     ETKUP036
JF0703*               , :TUPCSKU-ITEM-NBR                               ETKUP036
JF0703*            FROM TSKXREF A                                       ETKUP036
JF0703*               , TUPCSKU B                                               
JF0703*            WHERE B.UPC_NBR  = :WS-UNUPCS-UPC                       CL*12
JF0703*              AND A.ITM_NBR = B.ITEM_NBR                         ETKUP036
JF0703*        END-EXEC                                                 ETKUP036
JF0703*                                                                 ETKUP038
JF0703*        EVALUATE TRUE                                            ETKUP038
JF0703*            WHEN SQLCODE = -904                                  ETKUP038
JF0703*            WHEN SQLCODE = -911                                  ETKUP038
JF0703*            WHEN SQLCODE = 100                                   ETKUP038
JF0703*            WHEN SQLCODE = 0                                     ETKUP038
JF0703*                CONTINUE                                         ETKUP038
JF0703*            WHEN SQLWARN NOT = SPACES                            ETKUP038
JF0703*            WHEN SQLCODE NOT = ZERO                              ETKUP038
JF0703*                MOVE 'C400-VERIFY-EAN-SKU'                       ETKUP038
JF0703*                              TO  PV-PARAGRAPH-NAME              ETKUP038
JF0703*                MOVE 'VERIFY EAN AND SKUS'                       ETKUP038
JF0703*                              TO  PV-DB2-OPER-ATTEMPTED          ETKUP038
JF0703*                PERFORM Z900-SQL-ABEND                           ETKUP038
JF0703*        END-EVALUATE                                             ETKUP038
JF0703*    END-PERFORM.                                                 ETKUP038
JF0703*                                                                 ETKUP038
JF0703*    IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        ETKUP038
JF0703*        MOVE 'C400-VERIFY-EAN-SKU'                               ETKUP038
JF0703*                              TO  PV-PARAGRAPH-NAME              ETKUP038
JF0703*        MOVE 'VERIFY RETRIES EXCEEDED'                           ETKUP038
JF0703*                              TO  PV-DB2-OPER-ATTEMPTED          ETKUP038
JF0703*        PERFORM Z900-SQL-ABEND                                   ETKUP038
JF0703*    END-IF.                                                      ETKUP038
JF0703*                                                                 ETKUP038
JF0703******************************************************************ETKUP038
JF0703*  VERIFY THAT THE UPC IS ON THE UPC TABLE                        ETKUP038
JF0703******************************************************************ETKUP038
JF0703*C500-VERIFY-UPC-ONLY.                                            ETKUP038
JF0703*                                                                 ETKUP038
JF0703*    PERFORM                                                      ETKUP038
JF0703*        WITH TEST AFTER                                          ETKUP038
JF0703*        VARYING PV-SQL-SUB                                       ETKUP038
JF0703*        FROM 1 BY 1                                              ETKUP038
JF0703*        UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       ETKUP038
JF0703*                  OR SQLCODE = 0                                 ETKUP038
JF0703*                  OR SQLCODE = +100)                             ETKUP038
JF0703*                                                                 ETKUP038
JF0703*        EXEC SQL                                                 ETKUP038
JF0703*            SELECT A.UPC_CDE                                     ETKUP038
JF0703*            INTO :UNUPCS-UPC-CDE                                 ETKUP038
JF0703*            FROM TUNUPCS A                                       ETKUP038
JF0703*            WHERE A.UPC_CDE  = :WS-UNUPCS-UPC                    ETKUP038
JF0703*        END-EXEC                                                 ETKUP038
JF0703*                                                                 ETKUP038
JF0703*        EVALUATE TRUE                                            ETKUP038
JF0703*            WHEN SQLCODE = -904                                  ETKUP038
JF0703*            WHEN SQLCODE = -911                                  ETKUP038
JF0703*            WHEN SQLCODE = 100                                   ETKUP038
JF0703*            WHEN SQLCODE = 0                                     ETKUP038
JF0703*                CONTINUE                                         ETKUP038
JF0703*            WHEN SQLWARN NOT = SPACES                            ETKUP038
JF0703*            WHEN SQLCODE NOT = ZERO                              ETKUP038
JF0703*                MOVE 'C500-VERIFY-UPC-ONLY'                      ETKUP038
JF0703*                              TO  PV-PARAGRAPH-NAME              ETKUP038
JF0703*                MOVE 'VERIFY UPC ON TUNUPCS'                     ETKUP038
JF0703*                              TO  PV-DB2-OPER-ATTEMPTED          ETKUP038
JF0703*                PERFORM Z900-SQL-ABEND                           ETKUP038
JF0703*        END-EVALUATE                                             ETKUP038
JF0703*    END-PERFORM.                                                 ETKUP038
JF0703*                                                                 ETKUP038
JF0703*    IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        ETKUP038
JF0703*        MOVE 'C500-VERIFY-UPC-ONLY'                              ETKUP038
JF0703*                              TO  PV-PARAGRAPH-NAME              ETKUP038
JF0703*        MOVE 'VERIFY RETRIES EXCEEDED'                           ETKUP038
JF0703*                              TO  PV-DB2-OPER-ATTEMPTED          ETKUP038
JF0703*        PERFORM Z900-SQL-ABEND                                   ETKUP038
JF0703*    END-IF.                                                      ETKUP038
JF0703*                                                                 ETKUP038
JF0703******************************************************************ETKUP038
JF0703*  FIND WHICH NETWORK THE UPC SHOULD BE LOOKED UP ON              ETKUP038
JF0703******************************************************************ETKUP038
JF0703*C600-FIND-WHICH-NETWORK.                                         ETKUP038
JF0703*                                                                 ETKUP038
JF0703*    PERFORM                                                      ETKUP038
JF0703*        WITH TEST AFTER                                          ETKUP038
JF0703*        VARYING PV-SQL-SUB                                       ETKUP038
JF0703*        FROM 1 BY 1                                              ETKUP038
JF0703*        UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       ETKUP038
JF0703*                  OR SQLCODE = 0                                 ETKUP038
JF0703*                  OR SQLCODE = +100                              ETKUP038
JF0703*                  OR SQLCODE = -811)                             ETKUP038
JF0703*                                                                 ETKUP038
JF0703*        EXEC SQL                                                 ETKUP038
JF0703*            SELECT A.NETWK_ID                                    ETKUP038
JF0703*            INTO :NETVND-NETWK-ID                                ETKUP038
JF0703*            FROM TNETVND A,                                      ETKUP038
JF0703*                 TTRDPRT B                                       ETKUP038
JF0703*            WHERE B.VEND_INCHG_ID_DESC = :WS-TP-ID-QUAL AND      ETKUP038
JF0703*                  B.VEND_INCHG_ID      = :WS-TP-ID      AND      ETKUP038
JF0703*                  A.ENT_ID             = B.ENT_ID       AND      ETKUP038
JF0703*                  A.PREF_NETWK_SW_IND   = 'Y'                    ETKUP038
JF0703*        END-EXEC                                                 ETKUP038
JF0703*                                                                 ETKUP038
JF0703*        EVALUATE TRUE                                            ETKUP038
JF0703*            WHEN SQLCODE = -904                                  ETKUP038
JF0703*            WHEN SQLCODE = -911                                  ETKUP038
JF0703*            WHEN SQLCODE = -811                                  ETKUP038
JF0703*            WHEN SQLCODE = 100                                   ETKUP038
JF0703*            WHEN SQLCODE = 0                                     ETKUP038
JF0703*                CONTINUE                                         ETKUP038
JF0703*            WHEN SQLWARN NOT = SPACES                            ETKUP038
JF0703*            WHEN SQLCODE NOT = ZERO                              ETKUP038
JF0703*                MOVE 'C600-FIND-WHICH-NETWORK'                   ETKUP038
JF0703*                              TO  PV-PARAGRAPH-NAME              ETKUP038
JF0703*                MOVE 'FIND WHICH NETWORK FOR UPC'                ETKUP038
JF0703*                              TO  PV-DB2-OPER-ATTEMPTED          ETKUP038
JF0703*                PERFORM Z900-SQL-ABEND                           ETKUP038
JF0703*        END-EVALUATE                                             ETKUP038
JF0703*    END-PERFORM.                                                 ETKUP038
JF0703*                                                                 ETKUP038
JF0703*    IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        ETKUP038
JF0703*        MOVE 'C600-FIND-WHICH-NETWORK'                           ETKUP038
JF0703*                              TO  PV-PARAGRAPH-NAME              ETKUP038
JF0703*        MOVE 'VERIFY RETRIES EXCEEDED'                           ETKUP038
JF0703*                              TO  PV-DB2-OPER-ATTEMPTED          ETKUP038
JF0703*        PERFORM Z900-SQL-ABEND                                   ETKUP038
JF0703*    END-IF.                                                      ETKUP038
JF0703*                                                                 ETKUP038
00886 ******************************************************************ETKUP038
00887 * Z100-READ-INPUT-FILE                                            ETKUP038
00888 ******************************************************************ETKUP038
00889  Z100-READ-INPUT-FILE.                                            ETKUP038
00890 *                                                                 ETKUP038
00891      READ INV-INPUT-FILE                                          ETKUP038
00892             AT END SET PS-EOF TO TRUE.                            ETKUP038
                                                                                
022015     IF PS-EOF                                                            
022015        CONTINUE                                                          
022015     ELSE                                                                 
022015        ADD 1  TO PA-ROWS-READ                                            
022015     END-IF.                                                              
00893 *                                                                 ETKUP038
00894 ******************************************************************ETKUP038
00895 * Z200-WRITE-OUTPUT-FILE                                          ETKUP038
00896 ******************************************************************ETKUP038
00897  Z200-WRITE-OUTPUT-FILE.                                          ETKUP038
00898 *                                                                 ETKUP038
00899      WRITE INV-STATUS-RECORD.                                     ETKUP038
                                                                                
022015     ADD 1  TO PA-ROWS-WROTE.                                             
00900 *                                                                 ETKUP038
00901 ******************************************************************ETKUP038
00902 *  STANDARD DB2 ERROR ABEND ROUTINE                               ETKUP038
00903 *  THIS ROUTINE FORCES AN ABEND DUE TO A DB2 PROBLEM.             ETKUP038
00904 ******************************************************************ETKUP038
00905  Z900-SQL-ABEND.                                                  ETKUP038
00906                                                                   ETKUP038
00907      MOVE +4013                 TO ABEND-CODE.                    ETKUP038
00908      DISPLAY '**  ABEND     **'.                                  ETKUP038
00909      DISPLAY '**  PROGRAM   **  =  ETKUP036'.                     ETKUP038
00910      DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            ETKUP038
00911      DISPLAY '**  OPERATION **  = ' PV-DB2-OPER-ATTEMPTED.        ETKUP038
00912                                                                   ETKUP038
00913 *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         ETKUP038
00914 *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        ETKUP038
00915                                                                   ETKUP038
00916      COPY DPPD004.                                                ETKUP038
00917                                                                   ETKUP038
00918      CALL 'ILBOABN0'  USING ABEND-CODE.                           ETKUP038
