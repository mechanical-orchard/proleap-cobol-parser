000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.    ARKRP035.                                         00050000
000600 AUTHOR.        CHERI PARMLEY.                                    00060000
000700 INSTALLATION.  KOHLS.                                            00070000
000800 DATE-WRITTEN   NOVEMBER, 2016.                                   00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*  THIS PROGRAM WILL REPORT ALL THE ASSOCIATES THAT WERE ON       00120000
001200*  WORKDAY WITH A LIFETIME DISCOUNT BUT WERE NOT FOUND ON THE     00120100
001200*  ART_EMP_DISC TABLE.                                            00121000
001300******************************************************************00130000
001600******************************************************************00131000
001700*  CHANGE LOG                                                     00132000
001800*  DATE       CHANGED BY    DESC                                  00133000
001900*  ---------- ------------- --------------------------------------00134000
002000*  11-02-2016 CHERI PARMLEY INITIAL IMPLEMENTATION                00135000
00015 *                                                                 00136000
001500******************************************************************00150000
001600 ENVIRONMENT DIVISION.                                            00160000
001700******************************************************************00170000
001800                                                                  00180000
001900 CONFIGURATION SECTION.                                           00190000
002000                                                                  00200000
002100 SOURCE-COMPUTER.        IBM-3090.                                00210000
002200 OBJECT-COMPUTER.        IBM-3090.                                00220000
002300                                                                  00230000
002400 INPUT-OUTPUT SECTION.                                            00240000
002500                                                                  00250000
002600 FILE-CONTROL.                                                    00260000
002700                                                                  00270000
002800     SELECT LIFETIME-EXTRACT                                      00280001
002900         ASSIGN TO INP01.                                         00290000
003000                                                                  00300000
003100     SELECT LIFETIME-REPORT                                       00310001
003200         ASSIGN TO RPT01.                                         00320000
003300                                                                  00330000
003400******************************************************************00340000
003500 DATA DIVISION.                                                   00350000
003600******************************************************************00360000
003700                                                                  00370000
003800 FILE SECTION.                                                    00380000
003900                                                                  00390000
004000 FD  LIFETIME-EXTRACT                                             00400001
004100     RECORDING MODE IS F                                          00410000
004200     LABEL RECORDS ARE STANDARD                                   00420000
004300     BLOCK CONTAINS 0 RECORDS.                                    00430000
004400                                                                  00440000
004500 01  LIFETIME-EXTRACT-RECORD   PIC  X(200).                       00450013
004600                                                                  00460000
004700                                                                  00470000
004800 FD  LIFETIME-REPORT                                              00480001
004900     RECORDING MODE IS F                                          00490000
005000     LABEL RECORDS ARE STANDARD                                   00500000
005100     BLOCK CONTAINS 0 RECORDS.                                    00510000
005200                                                                  00520000
005300 01  LIFETIME-REPORT-RECORD    PIC  X(132).                       00530001
005400*                                                                 00540000
005500*                                                                 00550000
005600******************************************************************00560000
005700 WORKING-STORAGE SECTION.                                         00570000
005800******************************************************************00580000
005900*                                                                 00590000
006000******************************************************************00600000
006100***  WORKDAY LIFETIMERS NOT FOUND DATA                            00610001
006200***  EXTRACT FILE.                                                00620000
006300******************************************************************00630000
006400     COPY ARRD100.                                                00640001
006500*                                                                 00650000
006600*                                                                 00660000
006700******************************************************************00673000
006800***  STANDARD REPORT HEADER FOR 132 COLUMN REPORT                 00680000
006900******************************************************************00690000
007000     COPY DPWS132O.                                               00700000
007100*                                                                 00710000
007200*                                                                 00720000
007300 01  HL1-HEADING-LINE-1.                                          00730000
007400     05  FILLER                      PIC  X(43)      VALUE SPACE. 00740012
007500     05  FILLER                      PIC  X(48)      VALUE        00750001
007600         'WORKDAY LIFETIME DISCOUNT NOT FOUND ERROR REPORT'.      00760001
007700     05  FILLER                      PIC  X(38)      VALUE SPACE. 00770000
007800*                                                                 00780000
007900 01  DH1-DETAIL-HEADING-LINE-1.                                   00790000
008000     05  FILLER                      PIC  X(01)      VALUE SPACE. 00800000
008000     05  FILLER                      PIC  X(07)      VALUE        00800200
008000         ' EMP   '.                                               00800306
008000     05  FILLER                      PIC  X(47)      VALUE        00801000
008100         '       SSN    EMP   EMP                        '.       00810006
008200     05  FILLER                      PIC  X(35)      VALUE        00820000
008300         'EMP  DISC        TERM   LOC     LIF'.                   00830011
008400     05  FILLER                      PIC  X(36)      VALUE        00840000
008500         'E                                   '.                  00850008
008800*                                                                 00880000
008900 01  DH2-DETAIL-HEADING-LINE-2.                                   00890000
           05  FILLER                      PIC  X(01)      VALUE SPACE. 00891005
009000     05  FILLER                      PIC  X(47)      VALUE        00900000
009100         ' ID           NBR    ST    NAME                '.       00910006
009200     05  FILLER                      PIC  X(20)      VALUE        00920000
009300         '       ST   DTE     '.                                  00930006
009400     05  FILLER                      PIC  X(48)      VALUE        00940000
009500         '    DTE    NBR     ACTV                         '.      00950012
009800*                                                                 00980000
010000 01  DL-DASH-LINE.                                                00980109
010100     05  FILLER                      PIC  X(01)    VALUE SPACE.   00980209
010700     05  FILLER                      PIC  X(10)    VALUE ALL '_'. 00980310
010600     05  FILLER                      PIC  X(01)    VALUE SPACES.  00980409
010700     05  FILLER                      PIC  X(09)    VALUE ALL '_'. 00980509
010800     05  FILLER                      PIC  X(01)    VALUE SPACES.  00980609
010900     05  FILLER                      PIC  X(01)    VALUE ALL '_'. 00980709
011000     05  FILLER                      PIC  X(01)    VALUE SPACES.  00980809
011100     05  FILLER                      PIC  X(30)    VALUE ALL '_'. 00980909
011000     05  FILLER                      PIC  X(01)    VALUE SPACES.  00981009
011100     05  FILLER                      PIC  X(01)    VALUE ALL '_'. 00981109
011000     05  FILLER                      PIC  X(01)    VALUE SPACES.  00981209
011100     05  FILLER                      PIC  X(10)    VALUE ALL '_'. 00981309
011000     05  FILLER                      PIC  X(01)    VALUE SPACES.  00981409
011100     05  FILLER                      PIC  X(10)    VALUE ALL '_'. 00981509
011000     05  FILLER                      PIC  X(01)    VALUE SPACES.  00981609
011100     05  FILLER                      PIC  X(04)    VALUE ALL '_'. 00981709
011000     05  FILLER                      PIC  X(04)    VALUE SPACES.  00981811
011100     05  FILLER                      PIC  X(04)    VALUE ALL '_'. 00981911
009900*                                                                 00991000
010000 01  DL-DETAIL-LINE.                                              01000000
010100     05  FILLER                      PIC  X(01)      VALUE SPACE. 01010000
010700     05  DL-EMP-ID                   PIC  X(10)      VALUE SPACES.01020002
010600     05  FILLER                      PIC  X(01)      VALUE SPACES.01060000
010700     05  DL-SSN-NBR                  PIC  X(09)      VALUE SPACES.01070002
010800     05  FILLER                      PIC  X(01)      VALUE SPACES.01080000
010900     05  DL-EMP-STAT-CDE             PIC  X(01)      VALUE ZEROES.01090002
011000     05  FILLER                      PIC  X(01)      VALUE SPACES.01100000
011100     05  DL-EMP-NM                   PIC  X(30)      VALUE SPACES.01110002
011000     05  FILLER                      PIC  X(01)      VALUE SPACES.01111000
011100     05  DL-EMP-TYP-CDE              PIC  X(01)      VALUE SPACES.01112102
011000     05  FILLER                      PIC  X(01)      VALUE SPACES.01113000
011100     05  DL-DISC-DTE                 PIC  X(10)      VALUE SPACES.01114002
011000     05  FILLER                      PIC  X(01)      VALUE SPACES.01115000
011100     05  DL-TERM-DTE                 PIC  X(10)      VALUE SPACES.01115102
011000     05  FILLER                      PIC  X(01)      VALUE SPACES.01115200
011100     05  DL-LOC-NBR                  PIC  X(04)      VALUE SPACES.01115302
011000     05  FILLER                      PIC  X(05)      VALUE SPACES.01115407
011100     05  DL-LIFETIME-ACTV            PIC  X(01)      VALUE SPACES.01116002
012100*                                                                 01210000
012200*                                                                 01220000
012300 01  ER-END-OF-REPORT-LINE.                                       01230000
012400     05  FILLER                      PIC  X(54)      VALUE SPACE. 01240000
012500     05  FILLER                      PIC  X(25)      VALUE        01250000
012600         '***** END OF REPORT *****'.                             01260000
012700     05  FILLER                      PIC  X(53)      VALUE SPACE. 01270000
012800*                                                                 01280000
012900*                                                                 01290000
013000 01  PS-PROGRAM-SWITCHES.                                         01300000
013100     05  PS-EOF--EXTRACT-SW PIC  X(01)    VALUE SPACE.            01310000
013200         88  PS-EOF-EXTRACT              VALUE 'Y'.               01320000
013300     05  PS-PRINT-BLANK-LINE-SW      PIC  X(01)    VALUE SPACE.   01330000
013400         88  PS-PRINT-BLANK-LINE                   VALUE 'Y'.     01340000
013500         88  PS-DONT-PRINT-BLANK-LINE              VALUE 'N'.     01350000
013900*                                                                 01390000
014000*                                                                 01400000
014100 01 PC-PROGRAM-CONSTANTS.                                         01410000
014200     05  PC-PAGE-SIZE-066            PIC S9(04)    VALUE +066     01420000
014300                                                   COMP SYNC.     01430000
014400     05  PC-HEADING-SIZE             PIC S9(04)    VALUE +010     01440000
014500                                                   COMP SYNC.     01450000
014600     05  PC-MAX-RETRIES              PIC S9(04)    VALUE +3       01460000
014700                                                   COMP SYNC.     01470000
014800     05  PC-MAX-TABLE-ENTRIES        PIC S9(04)    VALUE +20      01480000
014900                                                   COMP SYNC.     01490000
015000     05  PC-CURRENT-OPERATING-COMPANY                             01500000
015100                                     PIC  X(02)    VALUE '03'.    01510000
015200     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          01520000
015300         'ARKRP035'.                                              01530000
015400     05  PC-DASH                     PIC  X(01)    VALUE '-'.     01540000
015500     05  PC-SLASH                    PIC  X(01)    VALUE '/'.     01550000
015600     05  PC-COLON                    PIC  X(01)    VALUE ':'.     01560000
015700     05  PC-SPACE                    PIC  X(01)    VALUE ' '.     01570000
015700     05  PC-IR                       PIC  X(02)    VALUE 'IR'.    01571000
           05 PC-SUCCESSFUL-SQLCODE          PIC S9(9)  VALUE ZEROES    01572017
                                                       COMP.            01573017
           05 PC-PROGRAM-NAME               PIC X(8)   VALUE 'ARKRP035'.01574017
           05 PC-X                          PIC X(5)   VALUE 'XXXXX'.   01575034
015800*                                                                 01580000
015900*                                                                 01590000
016000 01  PV-PROGRAM-VARIABLES.                                        01600000
016100     05  PV-LINES-USED               PIC S9(04)    VALUE ZERO     01610000
016200                                                   COMP SYNC.     01620000
016500     05  PV-BLANK-LINE               PIC  X(132)   VALUE SPACES.  01650000
016600*                                                                 01660000
016700     05  PV-PAGE-COUNT               PIC  9(05)    VALUE ZERO.    01670000
016800     05  PV-PAGE-COUNT-RDF  REDEFINES  PV-PAGE-COUNT.             01680000
016900         10  FILLER                  PIC  X(04).                  01690000
017000         10  PV-PAGE-NUMBER          PIC  9(01).                  01700000
017100             88  PV-PAGE-NUMBER-EVEN               VALUES 0, 2, 4 01710000
017200                                                          6, 8.   01720000
017300             88  PV-PAGE-NUMBER-ODD                VALUES 1, 3, 5 01730000
017400                                                          7, 9.   01740000
022100     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     01740100
022200                                                   COMP SYNC.     01740200
022300     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  01740300
                                                                        01740400
           05  PV-REPORT-DATE.                                          01740500
               10  PV-REPORT-MM                PIC 9(02).               01740600
               10  FILLER                      PIC X(01) VALUE '/'.     01740700
               10  PV-REPORT-DD                PIC 9(02).               01740800
               10  FILLER                      PIC X(01) VALUE '/'.     01740900
               10  PV-REPORT-CCYY              PIC 9(04).               01741000
               10  FILLER                      PIC X(01) VALUE SPACE.   01741100
               10  PV-REPORT-HH                PIC 9(02).               01741200
               10  FILLER                      PIC X(01) VALUE ':'.     01741300
               10  PV-REPORT-MN                PIC 9(02).               01741400
P10237     05 PV-SSN-NUMBER                PIC X(09)  VALUE SPACES.     01741515
P10237     05 PV-INPUT-LEN                 PIC 9(09)  VALUE ZEROES.     01741615
P10237     05 PV-INPUT-TEXT                  PIC X(88)  VALUE SPACES.   01741719
P10237     05 PV-OUTPUT-TEXT                 PIC X(66)  VALUE SPACES.   01741819
P10237     05 PV-ACCT-NBR-TOKEN            PIC S9(10)V COMP-3.          01741915
P10237     05 PV-SSN-NBR-TOKEN             PIC S9(09)V COMP-3.          01742015
P10237     05 PV-CURR-TMST                 PIC X(26) VALUE SPACES.      01742116
           05 PV-PARAGRAPH-NAME              PIC X(30)  VALUE SPACES.   01742217
           05 PV-DB2-TABLE-NAME              PIC X(30)  VALUE SPACES.   01742317
           05 PV-OPERATION-MSG               PIC X(30)  VALUE SPACES.   01742418
P10237     05 PV-DISP-NAME                   PIC X(88)  VALUE SPACES.   01742519
P10237     05 PV-DISP-EMP-NM                 PIC X(12)  VALUE SPACES.   01742619
P10237     05 PV-B64-LEN                     PIC 9(09)  VALUE ZEROES.   01742720
           05  PV-SSN-NBR                    PIC 9(09).                 01742833
           05  PV-SSN-NBRX REDEFINES PV-SSN-NBR.                        01742933
               10  PV-SSN-NBR5               PIC X(05).                 01743033
               10  PV-SSN-NBR4               PIC X(04).                 01743133
                                                                        01743200
007200 01  ABEND-CODE                          PIC S9(04) VALUE +0      01743315
007300                                                     COMP SYNC.   01743415
010800******************************************************************01743514
010900* DB2 MESSAGE AREA                                                01743614
011000******************************************************************01743714
011100     COPY SQLCA2.                                                 01743814
011200                                                                  01743914
011300******************************************************************01744014
011400*                     SQL DECLARATIONS                            01744114
011500******************************************************************01745014
011700******************************************************************01747014
011800*  STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                01748014
011900******************************************************************01749014
012000                                                                  01750014
012100     EXEC SQL                                                     01760014
012200         INCLUDE SQLCA                                            01770014
012300     END-EXEC.                                                    01780014
                                                                        01790014
P10237*---------------------------------------------------------------* 01791015
P10237*    ABEND PROCESSING COPYBOOK.                                 * 01792015
P10237*---------------------------------------------------------------* 01793015
P10237                                                                  01794015
P10237     COPY DPWS004.                                                01795015
P10237                                                                  01796015
P10237                                                                  01797015
P10237*---------------------------------------------------------------* 01800014
P10237* LAYOUT FOR THE PARAMETERS NEEDED TO INVOKE PROTEGRITY MODULE  * 01810014
P10237*---------------------------------------------------------------* 01820014
P10237     COPY PTYCCSIP.                                               01830014
P10237                                                                  01840014
P10237*---------------------------------------------------------------* 01850014
P10237* LAYOUT FOR THE WORKING VARIABLES TO INVOKE PROTEGRITY MODULE  * 01860014
P10237*---------------------------------------------------------------* 01870014
P10237     COPY DPWS031.                                                01880014
P10237                                                                  01890014
P10237******************************************************************01891020
P10237*  VARIABLES TO CONVERT FROM BASE64 TO BINARY & VICE VERSA        01892020
P10237******************************************************************01893020
P10237     COPY DPWS022.                                                01894020
P10237*                                                                 01895020
P10237******************************************************************01896020
P10237* LAYOUT FOR THE WORKING VARIABLES TO INVOKE DPKUT052 MODULE      01897020
P10237******************************************************************01898020
P10237     COPY DPWS053.                                                01899020
P10237                                                                  01899120
013200                                                                  01900014
019900 01  SD-SYSTEM-DATE.                                              01990000
020000     05  SD-SYSTEM-DATE-YY           PIC  9(02)      VALUE ZERO.  02000000
020100     05  SD-SYSTEM-DATE-MM           PIC  9(02)      VALUE ZERO.  02010000
020200     05  SD-SYSTEM-DATE-DD           PIC  9(02)      VALUE ZERO.  02020000
020300*                                                                 02030000
020400*                                                                 02040000
020500 01  ST-SYSTEM-TIME.                                              02050000
020600     05  ST-SYSTEM-HOUR              PIC  9(02)      VALUE ZERO.  02060000
020700     05  ST-SYSTEM-MINUTE            PIC  9(02)      VALUE ZERO.  02070000
020800     05  FILLER                      PIC  9(04)      VALUE ZERO.  02080000
020900*                                                                 02090000
021000*                                                                 02100000
021100******************************************************************02110000
021200 PROCEDURE DIVISION.                                              02120000
021300******************************************************************02130000
021400                                                                  02140000
021500 0000-PROGRAM-MAINLINE.                                           02150000
021600******************************************************************02160000
021700* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     02170000
021800*      PROGRAM.                                                   02180000
021900******************************************************************02190000
022000     PERFORM 1000-INITIALIZE.                                     02200000
022100                                                                  02210000
022200     PERFORM 7000-READ-EXTRACT-FILE.                              02220000
022300                                                                  02230000
022400     PERFORM 2000-BUILD-RPT-DATA                                  02240000
022500       UNTIL PS-EOF-EXTRACT                                       02250000
022600                                                                  02260000
022700     PERFORM 9000-EOJ-ROUTINE.                                    02270000
022800     STOP RUN.                                                    02280000
023000*                                                                 02300000
023100*                                                                 02310000
023200 1000-INITIALIZE.                                                 02320000
023300******************************************************************02330000
023400*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    02340000
023500*    -- OPEN FILES                                                02350000
023600*    -- SET UP AND PRINT REPORT HEADINGS                          02360000
023700******************************************************************02370000
023800     OPEN INPUT  LIFETIME-EXTRACT                                 02380002
023900          OUTPUT LIFETIME-REPORT.                                 02390002
024000*                                                                 02400000
024100     ACCEPT SD-SYSTEM-DATE FROM DATE.                             02410000
024200     ACCEPT ST-SYSTEM-TIME FROM TIME.                             02420000
024300     MOVE SD-SYSTEM-DATE-YY      TO DP132O-RUN-YEAR.              02430000
024400     MOVE SD-SYSTEM-DATE-MM      TO DP132O-RUN-MONTH.             02440000
024500     MOVE SD-SYSTEM-DATE-DD      TO DP132O-RUN-DAY.               02450000
024600     MOVE ST-SYSTEM-HOUR         TO DP132O-RUN-HOUR.              02460000
024700     MOVE ST-SYSTEM-MINUTE       TO DP132O-RUN-MINUTE.            02470000
024800     MOVE PC-CURRENT-PROGRAM-NAME                                 02480000
024900                                 TO DP132O-PROGRAM-NAME.          02490000
025000     MOVE 1                      TO DP132O-REPORT-NUMBER.         02500000
025100     PERFORM 8000-WRITE-PAGE-HEADINGS.                            02510000
025200*                                                                 02540000
025600 2000-BUILD-RPT-DATA.                                             02560000
025700******************************************************************02570000
025800*  BUILD THE LINES FOR THE REPORT.                                02580000
025900******************************************************************02590000
026000     MOVE SPACES                     TO DL-DETAIL-LINE.           02600000
026200                                                                  02620000
026300     IF PV-LINES-USED > PC-PAGE-SIZE-066                          02630000
026400        PERFORM 8000-WRITE-PAGE-HEADINGS                          02640000
026500     END-IF.                                                      02650000
026600                                                                  02660000
028600     MOVE AR100-EMP-ID               TO DL-EMP-ID.                02860003
           PERFORM 5000-DETOKEN-SSN.                                    02860116
028600     MOVE PV-SSN-NBR-TOKEN           TO PV-SSN-NBR.               02861033
           MOVE PC-X                       TO PV-SSN-NBR5.              02861133
028600     MOVE PV-SSN-NBR                 TO DL-SSN-NBR.               02861233
028700     MOVE AR100-EMP-STAT-CDE         TO DL-EMP-STAT-CDE.          02870003
P10237     PERFORM 8300-BASE64-BINARY                                   02871019
P10237     PERFORM 8400-CALL-PROTEG-DECRYPT                             02872019
P10237     PERFORM 8500-ASCII-EBCDIC                                    02873019
028800     MOVE DP053-OUTPUT-FIELD         TO DL-EMP-NM.                02880022
028910*                                                                 02891000
           MOVE AR100-EMP-TYP-CDE          TO DL-EMP-TYP-CDE.           02893003
           IF AR100-DISC-DTE = SPACES                                   02893125
               MOVE SPACE                  TO DL-DISC-DTE               02893225
           ELSE                                                         02893325
               MOVE AR100-DISC-DTE(1:4)    TO DL-DISC-DTE(7:4)          02893725
               MOVE '-'                    TO DL-DISC-DTE(3:1)          02893826
                                              DL-DISC-DTE(6:1)          02893926
               MOVE AR100-DISC-DTE(6:2)    TO DL-DISC-DTE(1:2)          02894025
               MOVE AR100-DISC-DTE(9:2)    TO DL-DISC-DTE(4:2)          02894125
           END-IF.                                                      02894225
                                                                        02894325
           IF AR100-TERM-DTE = SPACES                                   02894525
               MOVE SPACE                  TO DL-TERM-DTE               02894625
           ELSE                                                         02894725
               MOVE AR100-TERM-DTE(1:4)    TO DL-TERM-DTE(7:4)          02894825
               MOVE '-'                    TO DL-TERM-DTE(3:1)          02894926
                                              DL-TERM-DTE(6:1)          02895026
               MOVE AR100-TERM-DTE(6:2)    TO DL-TERM-DTE(1:2)          02895125
               MOVE AR100-TERM-DTE(9:2)    TO DL-TERM-DTE(4:2)          02895225
           END-IF.                                                      02895325
           MOVE AR100-LOC-NBR              TO DL-LOC-NBR.               02895425
           MOVE AR100-LIFETIME-DISC-ACTV   TO DL-LIFETIME-ACTV.         02896003
029000                                                                  02904000
029100     PERFORM 8100-WRITE-DETAIL.                                   02910000
029200                                                                  02920000
029300     PERFORM 7000-READ-EXTRACT-FILE.                              02930000
029400*                                                                 02940000
029700*                                                                 02970000
      ***************************************************************** 02970116
       3000-ACCEPT-CURR-TMST.                                           02970216
      ***************************************************************** 02970316
                                                                        02970416
           EXEC SQL                                                     02970516
               SET :PV-CURR-TMST = CURRENT TIMESTAMP                    02970616
           END-EXEC                                                     02970716
                                                                        02970816
           IF SQLCODE NOT = PC-SUCCESSFUL-SQLCODE OR                    02970916
               SQLWARN0 = 'W'                                           02971016
               MOVE '9000-ACCEPT-CURR-TMST'                             02971116
                                       TO PV-PARAGRAPH-NAME             02971216
               MOVE ' '                TO PV-DB2-TABLE-NAME             02971316
               MOVE 'GET TMST'         TO PV-OPERATION-MSG              02971416
               PERFORM Z999-ABEND                                       02971516
           END-IF.                                                      02971616
                                                                        02971716
P10237******************************************************************02971814
P10237* CALLS THE PROTEGRITY MODULE TO DETOKENIZE THE SSN FIELD.       *02972014
P10237******************************************************************02973014
P10237 5000-DETOKEN-SSN.                                                02974014
P10237                                                                  02975014
P10237     INITIALIZE CSI-PARAMETERS                                    02976014
P10237                DP031-PROTEG-PGM-PARAMETERS                       02977014
P10237                PV-SSN-NUMBER.                                    02978014
P10237                                                                  02979014
P10237     MOVE AR100-SSN-NBR             TO PV-SSN-NUMBER.             02979114
P10237                                                                  02979214
P10237     SET CSI-DECRYPT-FUNCTION        TO TRUE.                     02979314
P10237     SET DP031-SSN                   TO TRUE.                     02979414
P10237     MOVE 'SSN-NUMBER'               TO DP031-FIELD               02979514
P10237     MOVE PV-SSN-NUMBER              TO DP031-CIPHER-TEXT.        02979614
P10237     MOVE 9                          TO DP031-INPUT-LEN.          02979714
P10237                                                                  02979814
P10237     PERFORM DP031-0000-PROTG-TOKEN-DETOKEN.                      02979914
P10237                                                                  02980014
      **** DISPLAY 'IT CAME OUT OF THE PERFORM DP031 ' CSI-RETURN-CODE. 02980135
                                                                        02980214
P10237     IF CSI-RETURN-CODE NOT = ZERO                                02980314
P10237        DISPLAY 'SSN NBR          : ' PV-SSN-NUMBER               02980414
P10237        PERFORM DP031-9999-ABEND                                  02980514
P10237     ELSE                                                         02980614
P10237        MOVE DP031-CLEAR-TEXT(1:9)  TO PV-SSN-NBR-TOKEN           02980714
P10237     END-IF.                                                      02980814
P10237                                                                  02980914
      **** DISPLAY PV-SSN-NBR-TOKEN.                                    02981035
P10237                                                                  02981114
029800 7000-READ-EXTRACT-FILE.                                          02982000
029900******************************************************************02990000
030000*  READ THE EXTRACT FILE                                         *03000000
030100******************************************************************03010000
030200     READ LIFETIME-EXTRACT                                        03020003
030300       INTO AR100-WD-EMPLOYEE-REC                                 03030003
030400         AT END                                                   03040000
030500           SET PS-EOF-EXTRACT TO TRUE.                            03050000
                                                                        03087100
030800 8000-WRITE-PAGE-HEADINGS.                                        03088000
030900***************************************************************** 03090000
031000*  PRINT THE HEADINGS ON EACH PAGE.                             * 03100000
031100***************************************************************** 03110000
031200     ADD 1                         TO PV-PAGE-COUNT.              03120000
031300     MOVE PV-PAGE-COUNT            TO DP132O-PAGE-NUMBER.         03130000
031400*                                                                 03140000
031500     MOVE PC-HEADING-SIZE          TO PV-LINES-USED.              03150000
031600     SET PS-DONT-PRINT-BLANK-LINE TO TRUE.                        03160000
031800*                                                                 03180000
031900     WRITE LIFETIME-REPORT-RECORD                                 03190003
032000       FROM DP132O-STANDRD-HEADER-132-COLS                        03200000
032100         AFTER ADVANCING PAGE.                                    03210000
032200*                                                                 03220000
032300     INITIALIZE DP132O-LASER-NEW-PAGE-INDICATR.                   03230000
032400     WRITE LIFETIME-REPORT-RECORD                                 03240003
032500       FROM HL1-HEADING-LINE-1                                    03250000
032600         AFTER ADVANCING 1 LINE.                                  03260000
032700*                                                                 03270000
032800     WRITE LIFETIME-REPORT-RECORD                                 03280003
032900       FROM DH1-DETAIL-HEADING-LINE-1                             03290000
033000         AFTER ADVANCING 2 LINES.                                 03300000
033100*                                                                 03310000
033200     WRITE LIFETIME-REPORT-RECORD                                 03320003
033300       FROM DH2-DETAIL-HEADING-LINE-2                             03330000
033400         AFTER ADVANCING 1 LINE.                                  03340000
033000                                                                  03340100
033200     WRITE LIFETIME-REPORT-RECORD                                 03341003
033300       FROM DL-DASH-LINE                                          03342000
033400         AFTER ADVANCING 1 LINE.                                  03343000
033500*                                                                 03350000
033600*                                                                 03360000
034000 8100-WRITE-DETAIL.                                               03400000
034100******************************************************************03410000
034200*                                                                 03420000
034300******************************************************************03430000
034400     IF PS-PRINT-BLANK-LINE                                       03440000
034500        WRITE LIFETIME-REPORT-RECORD                              03450003
034600            FROM PV-BLANK-LINE                                    03460000
034700                AFTER ADVANCING 1 LINE                            03470000
034800        ADD 1 TO PV-LINES-USED                                    03480000
034900        SET PS-DONT-PRINT-BLANK-LINE TO TRUE                      03490000
035000     END-IF.                                                      03500000
035100                                                                  03510000
035200     WRITE LIFETIME-REPORT-RECORD                                 03520003
035300         FROM DL-DETAIL-LINE                                      03530000
035400             AFTER ADVANCING 1 LINE.                              03540000
035500                                                                  03550000
035600     ADD 1 TO PV-LINES-USED.                                      03560000
035700                                                                  03570000
036000*                                                                 03600000
P10237******************************************************************03601019
P10237* CONVERSION OF BASE64 TO BINARY.                                 03602019
P10237* RETURNED EMPLOYEE NAME WILL BE IN BINARY FORMAT.                03603019
P10237******************************************************************03604019
P10237 8300-BASE64-BINARY.                                              03605019
P10237                                                                  03606019
P10237     INITIALIZE PV-INPUT-TEXT                                     03607019
P10237                PV-B64-LEN                                        03608019
P10237                PV-OUTPUT-TEXT                                    03609019
P10237                DP022-PARMS.                                      03609119
P10237                                                                  03609219
P10237     MOVE AR100-EMP-NM            TO PV-INPUT-TEXT                03609320
P10237                                             PV-DISP-NAME         03609419
P10237     MOVE 'ASSOC ENT NM'          TO PV-DISP-EMP-NM               03609519
P10237     INSPECT PV-INPUT-TEXT TALLYING PV-B64-LEN                    03609619
P10237             FOR CHARACTERS BEFORE INITIAL SPACE.                 03609719
P10237     MOVE PV-B64-LEN                TO DP022-INLEN.               03609819
P10237     MOVE 66                        TO DP022-OUTLEN-IN.           03609919
P10237     CALL DP022-MGCXR2B  USING DP022-PARMS,                       03610019
P10237                               PV-INPUT-TEXT,                     03610119
P10237                               PV-OUTPUT-TEXT.                    03610219
P10237     IF RETURN-CODE NOT EQUAL 0                                   03610319
P10237       MOVE 'ERROR WHILE CONVERTING BASE64 TO BINARY'             03610419
P10237                                    TO PV-OPERATION-MSG           03610519
P10237       MOVE '8300-BASE64-BINARY'    TO PV-PARAGRAPH-NAME          03610619
P10237       DISPLAY 'ABEND IN THE FOLLOWING RECORD'                    03610719
P10237       DISPLAY 'RETURN CODE       : ' RETURN-CODE                 03610819
P10237       DISPLAY 'ENCRYPTED ' PV-DISP-EMP-NM  ' : ' PV-DISP-NAME    03610919
P10237       DISPLAY 'INPUT NAME LENGTH : ' PV-B64-LEN                  03611019
P10237       MOVE +4008                   TO ABEND-CODE                 03611119
P10237       PERFORM Z999-ABEND                                         03611221
P10237     END-IF.                                                      03611319
P10237                                                                  03611419
P10237******************************************************************03611519
P10237* PROTEGRITY CALL TO DECRYPT                                      03611619
P10237* RETURNED EMPLOYEE NAME WILL BE IN ASCII FORMAT.                 03611719
P10237******************************************************************03611819
P10237 8400-CALL-PROTEG-DECRYPT.                                        03611919
P10237                                                                  03612019
P10237     INITIALIZE CSI-PARAMETERS                                    03612119
P10237                DP031-PROTEG-PGM-PARAMETERS.                      03612219
P10237     SET CSI-DECRYPT-FUNCTION       TO TRUE.                      03612319
P10237     SET DP031-CUST-INFO            TO TRUE.                      03612419
P10237     MOVE PV-DISP-EMP-NM            TO DP031-FIELD.               03612519
P10237     MOVE PV-OUTPUT-TEXT            TO DP031-CIPHER-TEXT.         03612619
P10237     MOVE 50                        TO CSI-CLEAR-TEXT-LENGTH.     03612719
P10237     MOVE DP022-OUTLEN-OUT          TO CSI-CIPHER-TEXT-LENGTH.    03612819
P10237     PERFORM DP031-1000-PROTG-ENCRYP-DECRYP.                      03612919
P10237     IF CSI-RETURN-CODE NOT = ZERO                                03613019
P10237        DISPLAY 'ENCRYPTED ' PV-DISP-EMP-NM  ' : ' PV-DISP-NAME   03613119
P10237        DISPLAY 'INPUT NAME LENGTH : ' PV-B64-LEN                 03613219
P10237        PERFORM DP031-9999-ABEND                                  03613319
P10237     END-IF.                                                      03613419
P10237                                                                  03613519
P10237******************************************************************03613619
P10237* ASCII TO EBCDIC CONVERSION.                                     03613719
P10237* RETURNED EMPLOYEE NAME WILL BE IN EBCDIC FORMAT.                03613819
P10237******************************************************************03613919
P10237 8500-ASCII-EBCDIC.                                               03614019
P10237                                                                  03614119
P10237     INITIALIZE DP053-EBCDIC-ASCII-PARMS.                         03614219
P10237                                                                  03614319
P10237     SET  DP053-CT-ASCII-TO-EBCDIC TO TRUE.                       03614419
P10237     MOVE DP031-CLEAR-TEXT         TO DP053-INPUT-FIELD.          03614519
P10237     MOVE CSI-CLEAR-TEXT-LENGTH    TO DP053-FIELD-LENGTH.         03614619
P10237                                                                  03614719
P10237     CALL DP053-EBCDIC-ASCII-ROUTINE  USING DP053-CONVERSION-TYPE 03614819
P10237                                            DP053-FIELD-LENGTH    03614919
P10237                                            DP053-INPUT-FIELD     03615019
P10237                                            DP053-OUTPUT-FIELD    03615119
P10237                                            DP053-RETURN-CODE.    03615219
P10237                                                                  03615319
P10237     IF DP053-RC-SUCCESSFUL                                       03615419
P10237        DISPLAY 'NAME = ' DP053-OUTPUT-FIELD                      03615519
P10237     ELSE                                                         03615619
P10237        MOVE 'ERROR WHILE CONVERTING ASCII TO EBCDIC'             03615719
P10237                                     TO PV-OPERATION-MSG          03615819
P10237        MOVE '8500-ASCII-EBCDIC'     TO PV-PARAGRAPH-NAME         03615919
P10237        DISPLAY 'ABEND IN THE FOLLOWING RECORD'                   03616019
P10237        DISPLAY 'RETURN CODE       :  '  DP053-RETURN-CODE        03616119
P10237        DISPLAY 'ENCRYPTED ' PV-DISP-EMP-NM  ' : ' PV-DISP-NAME   03616219
P10237        DISPLAY 'INPUT NAME LENGTH :  '  PV-B64-LEN               03616319
P10237        MOVE 4008                    TO ABEND-CODE                03616419
P10237        PERFORM Z999-ABEND                                        03616521
P10237     END-IF.                                                      03616619
036100 9000-EOJ-ROUTINE.                                                03617000
036200******************************************************************03620000
036300*  PRINT END OF REPORT MESSAGE, CLOSE THE OUTPUT FILE,            03630000
036500******************************************************************03650000
036600     ADD 2 TO PV-LINES-USED.                                      03660000
036700                                                                  03670000
036800     IF PV-LINES-USED > PC-PAGE-SIZE-066                          03680000
036900        PERFORM 8000-WRITE-PAGE-HEADINGS                          03690000
037000     END-IF.                                                      03700000
037100                                                                  03710000
037200     WRITE LIFETIME-REPORT-RECORD                                 03720003
037300         FROM ER-END-OF-REPORT-LINE                               03730000
037400             AFTER ADVANCING 2 LINES.                             03740000
037500                                                                  03750000
037600     CLOSE LIFETIME-EXTRACT                                       03760003
037700           LIFETIME-REPORT.                                       03770003
037800*                                                                 03780000
P10237******************************************************************03790014
P10237*  COPY MEMBER DPPD031 CONTAINS STATEMENTS NEEDED TO INVOKE       03800014
P10237*  PROTEGRITY MODULE FOR PROTECTION/UNPROTECTION                  03810014
P10237******************************************************************03820014
P10237        COPY DPPD031.                                             03830014
P10237                                                                  03840014
              COPY DPPD004.                                             03850014
                                                                        03851017
      ******************************************************************03860017
      * Z999 - ABEND ROUTINE                                            03870017
      ******************************************************************03880017
       Z999-ABEND.                                                      03890017
                                                                        03900017
               DISPLAY '** ABEND           ** = SQLABEND'               03910017
               DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME       03920017
               DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME     03930017
               DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG      03940017
           CALL 'ILBOABN0' USING ABEND-CODE.                            03950017
