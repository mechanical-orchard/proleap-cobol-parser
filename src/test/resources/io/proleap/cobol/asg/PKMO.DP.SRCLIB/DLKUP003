000100 IDENTIFICATION DIVISION.                                         00010007
000200 PROGRAM-ID.    DLKUP003.                                         00020007
000300 AUTHOR.        PAUL OMAN.                                        00030007
000400                                                                  00040007
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050007
000600 DATE-WRITTEN.  DECEMBER 2003.                                    00060007
000700 DATE-COMPILED.                                                   00070007
000800                                                                  00080007
000900 ENVIRONMENT DIVISION.                                            00090007
001000 CONFIGURATION SECTION.                                           00100007
001100 SOURCE-COMPUTER. IBM-3090.                                       00110007
001200 OBJECT-COMPUTER. IBM-3090.                                       00120007
001300                                                                  00130007
001400****************************************************************  00140007
001500*                                                                 00150007
001600*    NOTE: THERE IS A BATCH VERSION OF THIS PROGRAM CALLED        00160007
001700*          DLKUT026.  ANY CHANGES MADE TO THIS PROGRAM            00170007
001800*          SHOULD ALSO BE MADE IN THE BATCH VERSION.              00180007
001900*                                                                 00190007
002000*    THERE ARE CURRENTLY EIGHT DIFFERENT PROCESSES THAT CAN    *  00200007
002100*    OCCUR IN THIS PROGRAM.  THEY ALL DEAL WITH THE ASSIGN-    *  00210007
002200*    MENTS (DLT00004) AND ASSOCIATES (DLT00003) LINKED WITH    *  00220007
002300*    THOSE ASSIGNMENTS.                                        *  00230007
002400*                                                              *  00240007
002500*       TWO OF THEM WILL CREATE A NEW ASSIGNMENT FROM THE      *  00250007
002600*           INPUT PASSED IN.  ONE OF THE TWO WILL ALSO ADD     *  00260007
002700*           AN ASSOCIATE TO THE NEW ASSIGNMENT.                *  00270007
002800*                                                              *  00280007
002900*       ONE WILL JUST END THE ASSIGNMENT PASSED IN, NOTHING    *  00290007
003000*           ELSE.                                              *  00300007
003100*                                                              *  00310007
003200*       THE OTHER FOUR WILL ALL COPY THE EXISTING ASSIGNMENT,  *  00320007
003300*           WITH TWO OF THEM ALSO ENDING THE ASSIGNMENT SENT   *  00330007
003400*           IN.  TWO WILL ALSO COMBINE THE COPYING OF THE      *  00340007
003500*           RELATED ASSOCIATES WITH THE NEW ASSIGNMENT.        *  00350007
003600*                                                              *  00360007
003700*    ONLY USED BY CICS PROGRAMS.                               *  00370007
003800*                                                              *  00380007
003900*  COPYBOOKS:                                                  *  00390007
004000*     DLWS007 - USED WHEN CALLING THIS PROGRAM                 *  00400007
004100*     DLWS001 - USED WHEN CALLING DLKUP001                     *  00410007
004200*     DLWS011 - USED TO FORMAT KEY FIELDS                      *  00420007
004300*     DLWS017 - USED WHEN CALLING DLKUT006                     *  00430007
004400*     XLWS072 - USED WHEN CALLING XLKUP033 WHICH WRITES        *  00440007
004500*               INFORMATION TO THE EAI EXPORT TABLES.          *  00450007
004600*                                                              *  00460007
004700*  DB2 ACCESS:                                                 *  00470007
004800*     DLT_TEM_ASGMT (DLT00003) TABLE                           *  00480007
004900*                FETCHES                                       *  00490007
005000*                INSERTS                                       *  00500007
005100*                UPDATES                                       *  00510007
005200*                                                              *  00520007
005300*     DLT_ASGMT (DLT00004) TABLE                               *  00530007
005400*                INSERTS                                       *  00540007
005500*                SELECTS                                       *  00550007
005600*                UPDATES                                       *  00560007
005700*                                                              *  00570007
005800****************************************************************  00580007
005900                                                                  00590007
006000 DATA DIVISION.                                                   00600007
006100 WORKING-STORAGE SECTION.                                         00610007
006200                                                                  00620007
006300 01  PV-DISPLAY-FIELDS.                                           00630007
006400     05  PV-DISPLAY-FIELD         PIC 9(09)  VALUE ZEROS.         00640007
006500     05  PV-DISPLAY-NUMBER        PIC 9(09)  VALUE ZEROS.         00650007
006600     05  PV-CICS-MSG-AREA2        PIC X(100) VALUE SPACE.         00660007
006700                                                                  00670007
006800 01  PV-CHARACTER-FIELDS.                                         00680007
006900     05  PV-CURRENT-DATE          PIC X(10)  VALUE SPACES.        00690007
007000     05  PV-CURRENT-TIMESTAMP     PIC X(26)  VALUE SPACES.        00700007
007100     05  PV-TIMESTAMP             PIC X(26)  VALUE SPACES.        00710007
007200     05  PV-ASGMT-STRT-DTE        PIC X(10)  VALUE SPACES.        00720007
007300     05  PV-CURRENT-TIME          PIC X(08)  VALUE SPACES.        00730007
007400     05  PV-ASGMT-NBR-WRK-TYP-SAV PIC X(06)  VALUE SPACES.        00740007
007500     05  PV-ASGMT-NBR-TXT         PIC X(10)  VALUE SPACES.        00750007
007600     05  FILLER REDEFINES PV-ASGMT-NBR-TXT.                       00760007
007700         10  PV-ASGMT-NBR-DC          PIC 9(04).                  00770007
007800         10  PV-ASGMT-NBR-WRK-TYP     PIC X(06).                  00780007
007900             88  PV-RECV-WRK-TYP          VALUE 'RECV  '.         00790007
008000             88  PV-RECV1-WRK-TYP         VALUE 'RECV1 '.         00800007
008100             88  PV-FLAT-WRK-TYP          VALUE 'FLAT  '.         00810007
008200             88  PV-SHIP-WRK-TYP          VALUE 'SHIP  '.         00820007
008300             88  PV-P2L-WRK-TYP           VALUE 'P2L   '.         00830007
008400             88  PV-P2L1-WRK-TYP          VALUE 'P2L1  '.         00840007
008500             88  PV-RLABL-WRK-TYP         VALUE 'RLABL '.         00850007
008600     05  PV-ASGMT-NBR-SEQ-NBR-DISP    PIC 9(4).                   00860007
008700     05  PV-BUILD-TIMESTAMP.                                      00870007
008800         10  PV-BUILD-TIMESTAMP-DTE                               00880007
008900                                  PIC X(10)  VALUE SPACES.        00890007
009000         10  FILLER               PIC X(16)  VALUE                00900007
009100             '-01.01.01.000001'.                                  00910007
009200                                                                  00920007
009300 01  PV-COMP-FIELDS.                                              00930007
009400     05  PV-RETRY-COUNTER         PIC S9(04) VALUE 0 COMP.        00940007
009500     05  PV-ASGMT-NBR-SEQ-NBR     PIC S9(09) VALUE 0 COMP.        00950007
009600     05  PV-KOHLS-USR-ID-NULL-IND PIC S9(04) VALUE 0 COMP.        00960007
009700     05  PV-TMP-USR-ID-NULL-IND   PIC S9(04) VALUE 0 COMP.        00970007
009800     05  PV-SET-SEQ-NBR           PIC S9(09) VALUE 0 COMP.        00980007
009900     05  PV-ASSOCIATE-COUNT       PIC S9(09) VALUE 0 COMP.        00990007
010000     05  PV-DOOR-COUNT            PIC S9(09) VALUE 0 COMP.        01000007
010100     05  PV-DIVERT-COUNT          PIC S9(09) VALUE 0 COMP.        01010007
010200     05  PV-SD-WRK-AREA-DOOR-GROUP PIC S9(4) VALUE 0 COMP.        01020007
010300     05  PV-COMMAREA-LENGTH       PIC S9(04) VALUE 0 COMP.        01030007
010400     05  PV-CICS-RESPONSE         PIC S9(08) VALUE 0 COMP.        01040007
010500                                                                  01050007
010600 01  PS-SWITCHES.                                                 01060007
010700     05  PS-ASSIGNMENT-SW             PIC X(01)  VALUE 'N'.       01070007
010800         88  PS-ASSIGNMENT-FOUND                 VALUE 'Y'.       01080007
010900         88  PS-ASSIGNMENT-NOT-FOUND             VALUE 'N'.       01090007
011000     05  PS-ASSOCIATE-UPDATE-SW       PIC X(01)  VALUE 'N'.       01100007
011100         88  PS-ASSOCIATE-UPDATED                VALUE 'Y'.       01110007
011200         88  PS-ASSOCIATE-NOT-UPDATED            VALUE 'N'.       01120007
011300     05  PS-ASSIGNMENT-UPDATE-SW      PIC X(01)  VALUE 'N'.       01130007
011400         88  PS-ASSIGNMENT-UPDATED               VALUE 'Y'.       01140007
011500         88  PS-ASSIGNMENT-NOT-UPDATED           VALUE 'N'.       01150007
011600     05  PS-END-OF-CURSOR-SW          PIC X(01)  VALUE 'N'.       01160007
011700         88  PS-END-OF-CURSOR                    VALUE 'Y'.       01170007
011800         88  PS-NOT-END-OF-CURSOR                VALUE 'N'.       01180007
011900     05  PS-DLPLDU-ROW-SW             PIC X(01)  VALUE 'N'.       01190007
012000         88  PS-DLPLDU-ROW-FOUND                 VALUE 'Y'.       01200007
012100         88  PS-DLPLDU-ROW-NOT-FOUND             VALUE 'N'.       01210007
012200     05  PS-TEAM-ROW-SW               PIC X(01)  VALUE 'N'.       01220007
012300         88  PS-TEAM-ROW-FOUND                   VALUE 'Y'.       01230007
012400         88  PS-TEAM-ROW-NOT-FOUND               VALUE 'N'.       01240007
012500                                                                  01250007
012600 01  PC-CONSTANTS.                                                01260007
012700     05  PC-MAX-RETRIES           PIC S9(04) VALUE +3 COMP.       01270007
012800     05  PC-A                     PIC X      VALUE 'A'.           01280007
012900     05  PC-N                     PIC X      VALUE 'N'.           01290007
013000     05  PC-AC                    PIC X(02)  VALUE 'AC'.          01300007
013100     05  PC-DLX                   PIC X(03)  VALUE 'DLX'.         01310007
013200     05  PC-DLPLDU                PIC X(06)  VALUE 'DLPLDU'.      01320007
013300     05  PC-RLABL                 PIC X(05)  VALUE 'RLABL'.       01330007
013400     05  PC-ISTOP                 PIC X(05)  VALUE 'ISTOP'.       01340007
013500     05  PC-DLKUP003              PIC X(08)  VALUE 'DLKUP003'.    01350007
013600     05  PC-INDIRECT-LABOR        PIC X(40)  VALUE                01360007
013700         'INDIRECT LABOR                          '.              01370007
013800     05  PC-ASSIGNMENT-CLOSE      PIC X(40)  VALUE                01380007
013900         'ASSIGNMENT CLOSE                        '.              01390007
014000     05  PC-DC-LABOR              PIC X(40)  VALUE                01400007
014100         'DC LABOR                                '.              01410007
014200     05  PC-ASTERISK-LINE         PIC X(40)  VALUE ALL '*'.       01420007
014300     05  PC-FIVE-BLANKS           PIC X(05)  VALUE '     '.       01430007
014400     05  PC-TEN-BLANKS            PIC X(10)  VALUE SPACES.        01440007
014500                                                                  01450007
014600****************************************************************  01460007
014700*    DLT00003 - DLT_TEM_ASGMT                                  *  01470007
014800*    DLT00004 - DLT_ASGMT                                      *  01480007
014900*                                                              *  01490007
015000****************************************************************  01500007
015100                                                                  01510007
015200     EXEC SQL                                                     01520007
015300         INCLUDE DLT00000                                         01530007
015400     END-EXEC.                                                    01540007
015500                                                                  01550007
015600     EXEC SQL                                                     01560007
015700         INCLUDE DLT00001                                         01570007
015800     END-EXEC.                                                    01580007
015900                                                                  01590007
016000     EXEC SQL                                                     01600007
016100         INCLUDE DLT00003                                         01610007
016200     END-EXEC.                                                    01620007
016300                                                                  01630007
016400     EXEC SQL                                                     01640007
016500         INCLUDE DLT00004                                         01650007
016600     END-EXEC.                                                    01660007
016700                                                                  01670007
016800     EXEC SQL                                                     01680007
016900         INCLUDE DLT00009                                         01690007
017000     END-EXEC.                                                    01700007
017100                                                                  01710007
017200     EXEC SQL                                                     01720007
017300         INCLUDE TKRPRPM                                          01730007
017400     END-EXEC.                                                    01740007
017500                                                                  01750007
017600     EXEC SQL                                                     01760007
017700         INCLUDE TSUCRDV                                          01770007
017800     END-EXEC.                                                    01780007
017900                                                                  01790007
018000     EXEC SQL                                                     01800007
018100          INCLUDE SQLCA                                           01810007
018200     END-EXEC.                                                    01820007
018300                                                                  01830007
018400****************************************************************  01840007
018500*    COPYBOOK FOR XLKUP033 - WRITE DATA TO EAI EXPORT TABLES   *  01850007
018600****************************************************************  01860007
018700                                                                  01870007
018800     COPY XLWS072.                                                01880007
018900                                                                  01890007
019000     COPY DLWS001.                                                01900007
019100                                                                  01910007
019200     COPY DLWS011.                                                01920007
019300                                                                  01930007
019400     COPY DLWS017.                                                01940007
019500                                                                  01950007
019600     EXEC SQL                                                     01960007
019700        DECLARE ASSOCIATE-CURSOR CURSOR FOR                       01970007
019800         SELECT                                                   01980007
019900                TEM.ASGMT_STRT_DTE                                01990007
020000               ,TEM.ASGMT_NBR_TXT                                 02000007
020100               ,TEM.KOHLS_USR_ID                                  02010007
020200               ,TEM.TMP_USR_ID                                    02020007
020300               ,TEM.JN_TMST                                       02030007
020400               ,TEM.CRE_BY_USR_ID                                 02040007
020500                                                                  02050007
020600          FROM  DLT_TEM_ASGMT   TEM                               02060007
020700                                                                  02070007
020800         WHERE  TEM.ASGMT_STRT_DTE    = :PV-BUILD-TIMESTAMP-DTE   02080007
020900           AND  TEM.ASGMT_NBR_TXT     = :PV-ASGMT-NBR-TXT         02090007
021000           AND  TEM.ASGMT_NBR_SEQ_NBR =                           02100007
021100                              :PV-ASGMT-NBR-SEQ-NBR               02110007
021200           AND  TEM.LVE_RSN_CDE       = 'T'                       02120007
021210           AND TEM.TEM_ASGMT_SEQ_NBR  IN                          02121009
021220               (SELECT MAX(B.TEM_ASGMT_SEQ_NBR)                   02122009
021230                  FROM DLT_TEM_ASGMT B                            02123008
021240                 WHERE TEM.ASGMT_STRT_DTE    = B.ASGMT_STRT_DTE   02124008
021250                   AND TEM.ASGMT_NBR_TXT     = B.ASGMT_NBR_TXT    02125008
021260                   AND TEM.ASGMT_NBR_SEQ_NBR                      02126008
021261                                  = B.ASGMT_NBR_SEQ_NBR           02126108
021270                   AND ((TEM.KOHLS_USR_ID = B.KOHLS_USR_ID AND    02127008
021280                         B.TMP_USR_ID IS NULL                     02128008
021290                        )                                         02129008
021291                         OR                                       02129108
021292                        (TEM.TMP_USR_ID = B.TMP_USR_ID AND        02129208
021293                         B.KOHLS_USR_ID IS NULL                   02129308
021294                        )                                         02129408
021295                       )                                          02129508
021296               )                                                  02129608
021300     END-EXEC.                                                    02130008
021400                                                                  02140008
021500 LINKAGE SECTION.                                                 02150008
021600     COPY DLWS007.                                                02160008
021700                                                                  02170008
021800                                                                  02180008
021900 PROCEDURE DIVISION USING DL007-ASGMT-COMMAREA.                   02190008
022000                                                                  02200008
022100     SET DL007-SUCCESSFUL  TO TRUE.                               02210008
022200                                                                  02220008
022300     EVALUATE TRUE                                                02230008
022400         WHEN DL007-VALID-PROCESS-CODE                            02240008
022500              PERFORM 1000-VALIDATE-INPUT-FIELDS                  02250008
022600                                                                  02260008
022700         WHEN OTHER                                               02270008
022800              SET DL007-INVALID-ACCESS TO TRUE                    02280008
022900                                                                  02290008
023000     END-EVALUATE.                                                02300008
023100                                                                  02310008
023200     MOVE SQLCA                       TO DL007-SQLCA.             02320008
023300     MOVE SQLCODE                     TO DL007-ASGMT-SQLCODE.     02330008
023400                                                                  02340008
023500     GOBACK.                                                      02350008
023600                                                                  02360008
023700                                                                  02370008
023800****************************************************************  02380008
023900*    VALIDATE THAT ALL INPUT FIELDS ARE PRESENT.               *  02390008
024000*        THIS VARIES DEPENDING ON THE TYPE OF PROCESSING CODE  *  02400008
024100*        THAT IS BEING REQUESTED.                              *  02410008
024200*                                                              *  02420008
024300*        STOP PROCESSING AND RETURN IF THERE ARE ANY ERRORS.   *  02430008
024400*                                                              *  02440008
024500****************************************************************  02450008
024600                                                                  02460008
024700 1000-VALIDATE-INPUT-FIELDS.                                      02470008
024800                                                                  02480008
024900     EVALUATE TRUE                                                02490008
025000         WHEN DL007-CREATE-NEW-ASGMT OR                           02500008
025100              DL007-CREATE-NEW-ASGMT-WTEAM                        02510008
025200              EVALUATE TRUE                                       02520008
025300                  WHEN DL007-NA-FLD-START-DTE = SPACES            02530008
025400                       SET DL007-MISSING-NEW-FIELDS TO TRUE       02540008
025500                                                                  02550008
025600                  WHEN DL007-NA-FLD-NO-NBR-TXT                    02560008
025700                       SET DL007-MISSING-NEW-FIELDS TO TRUE       02570008
025800                                                                  02580008
025900                  WHEN DL007-NA-FLD-NO-CRE-USR                    02590008
026000                       SET DL007-MISSING-NEW-FIELDS TO TRUE       02600008
026100                                                                  02610008
026200                  WHEN DL007-NA-FLD-NO-CRE-PGM                    02620008
026300                       SET DL007-MISSING-NEW-FIELDS TO TRUE       02630008
026400                                                                  02640008
026500                  WHEN DL007-NA-FLD-NO-WK-TYP                     02650008
026600                       SET DL007-MISSING-NEW-FIELDS TO TRUE       02660008
026700                                                                  02670008
026800                  WHEN DL007-NA-FLD-NO-WK-AREA                    02680008
026900                       SET DL007-MISSING-NEW-FIELDS TO TRUE       02690008
027000                                                                  02700008
027100                  WHEN DL007-NA-FLD-NO-DC-NBR                     02710008
027200                       SET DL007-MISSING-NEW-FIELDS TO TRUE       02720008
027300                                                                  02730008
027400                  WHEN DL007-NA-FLD-START-TM = SPACES             02740008
027500                       SET DL007-MISSING-NEW-FIELDS TO TRUE       02750008
027600                                                                  02760008
027700                  WHEN OTHER                                      02770008
027800                       IF DL007-USR-IS-KOHLS OR                   02780008
027900                          DL007-USR-IS-TMP                        02790008
028000                          CONTINUE                                02800008
028100                       ELSE                                       02810008
028200                          SET DL007-MISSING-NEW-FIELDS TO TRUE    02820008
028300                       END-IF                                     02830008
028400                                                                  02840008
028500              END-EVALUATE                                        02850008
028600                                                                  02860008
028700         WHEN DL007-COPY-FROM-ASGMT OR                            02870008
028800              DL007-COPY-FROM-ASGMT-WTEAM                         02880008
028900              IF DL007-ECA-KEY-START-DTE = SPACES                 02890008
029000                 SET DL007-MISSING-COPY-FIELDS TO TRUE            02900008
029100              END-IF                                              02910008
029200                                                                  02920008
029300              IF DL007-NO-KEY-NBR-TXT                             02930008
029400                 SET DL007-MISSING-COPY-FIELDS TO TRUE            02940008
029500              END-IF                                              02950008
029600                                                                  02960008
029700              IF DL007-NO-KEY-NBR-SEQ-NBR                         02970008
029800                 SET DL007-MISSING-COPY-FIELDS TO TRUE            02980008
029900              END-IF                                              02990008
030000                                                                  03000008
030100              IF DL007-NO-STOP-PGM-NM                             03010008
030200                 SET DL007-MISSING-COPY-FIELDS TO TRUE            03020008
030300              END-IF                                              03030008
030400                                                                  03040008
030500              IF DL007-NO-STOP-RSN-CDE                            03050008
030600                 SET DL007-MISSING-COPY-FIELDS TO TRUE            03060008
030700              END-IF                                              03070008
030800                                                                  03080008
030900     END-EVALUATE.                                                03090008
031000                                                                  03100008
031100     IF DL007-SUCCESSFUL                                          03110008
031200        IF DL007-COMMIT-UPDATE OR                                 03120008
031300           DL007-DO-NOT-COMMIT-UPDATE                             03130008
031400           PERFORM 9400-GET-TIMESTAMP                             03140008
031500           PERFORM 2000-PROCESS-ASSIGNMENTS                       03150008
031600        ELSE                                                      03160008
031700           SET DL007-COMMIT-CODE-INVALID TO TRUE                  03170008
031800        END-IF                                                    03180008
031900                                                                  03190008
032000     END-IF.                                                      03200008
032100                                                                  03210008
032200****************************************************************  03220008
032300*    ENDING OF THE ASSIGNMENT NEEDS TO HAPPEN FIRST.           *  03230008
032400*        THIS ONLY APPLIES TO DL007-END-ASGMT,                 *  03240008
032500*                             DL007-END-COPY-ASGMT,            *  03250008
032600*                             DL007-END-COPY-ASGMT-WTEAM.      *  03260008
032700*                                                              *  03270008
032800*    THE COMMIT LOGIC IS AT THE END OF THIS PARAGRAPH FOR      *  03280008
032900*        ALL OF THE DIFFERENT PROCESS CODES.                   *  03290008
033000*                                                              *  03300008
033100****************************************************************  03310008
033200                                                                  03320008
033300 2000-PROCESS-ASSIGNMENTS.                                        03330008
033400                                                                  03340008
033500     EVALUATE TRUE                                                03350008
033600         WHEN DL007-END-ASGMT                                     03360008
033700*             **************************************************  03370008
033800*             *  END ASSIGNMENT AND RETURN TO CALLING PROGRAM. *  03380008
033900*             *                                                *  03390008
034000*             **************************************************  03400008
034100              MOVE DL007-ECA-KEY-START-DTE TO PV-ASGMT-STRT-DTE   03410008
034200              MOVE DL007-ECA-KEY-NBR-TXT   TO PV-ASGMT-NBR-TXT    03420008
034300              MOVE DL007-ECA-KEY-NBR-SEQ-NBR TO                   03430008
034400                                 PV-ASGMT-NBR-SEQ-NBR             03440008
034500                                                                  03450008
034600              PERFORM 3000-SELECT-ASSIGNMENT                      03460008
034700                                                                  03470008
034800              IF DL007-SUCCESSFUL                                 03480008
034900                 PERFORM 2200-END-ASSIGNMENT                      03490008
035000              END-IF                                              03500008
035100                                                                  03510008
035200              IF DL007-SUCCESSFUL                                 03520008
035300                 IF DL007-END-COPY-ASGMT-WTEAM                    03530008
035400                    PERFORM 2400-COPY-ASSIGNMENT                  03540008
035500                 END-IF                                           03550008
035600              END-IF                                              03560008
035700                                                                  03570008
035800         WHEN DL007-CREATE-NEW-ASGMT                              03580008
035900*             **************************************************  03590008
036000*             *  ONLY CREATES A NEW ASSIGNMENT (DLT00004) FROM *  03600008
036100*             *  THE INPUT FIELDS.                             *  03610008
036200*             *                                                *  03620008
036300*             **************************************************  03630008
036400              MOVE DL007-NA-FLD-START-DTE TO PV-ASGMT-STRT-DTE    03640008
036500              MOVE DL007-NA-FLD-NBR-TXT   TO PV-ASGMT-NBR-TXT     03650008
036600                                                                  03660008
036700                                                                  03670008
036800              PERFORM 5000-INSERT-ASSIGNMENT                      03680008
036900                                                                  03690008
037000         WHEN DL007-CREATE-NEW-ASGMT-WTEAM                        03700008
037100*             **************************************************  03710008
037200*             *  CREATES A NEW ASSIGNMENT (DLT00004) FROM THE  *  03720008
037300*             *  INPUT FIELDS. THEN CREATES AN ASSOCIATE       *  03730008
037400*             *  (DLT00003) CONNECTED TO THE ASSIGNMENT. INPUT *  03740008
037500*             *  IS ALSO TAKEN FROM THE INPUT FIELDS.          *  03750008
037600*             **************************************************  03760008
037700              MOVE DL007-NA-FLD-START-DTE TO PV-ASGMT-STRT-DTE    03770008
037800              MOVE DL007-NA-FLD-NBR-TXT   TO PV-ASGMT-NBR-TXT     03780008
037900                                                                  03790008
038000              PERFORM 5000-INSERT-ASSIGNMENT                      03800008
038100                                                                  03810008
038200              IF DL007-SUCCESSFUL                                 03820008
038300                 PERFORM 5400-INSERT-ASSOCIATE                    03830008
038400                 PERFORM 5500-INSERT-RDPR-USR                     03840008
038500              END-IF                                              03850008
038600                                                                  03860008
038700         WHEN DL007-COPY-FROM-ASGMT OR                            03870008
038800              DL007-END-COPY-ASGMT                                03880008
038900*             **************************************************  03890008
039000*             *  COPIES DLT_ASGMT (DLT00004) ROW TO NEW        *  03900008
039100*             *      ASSIGNMENT.                               *  03910008
039200*             *                                                *  03920008
039300*             **************************************************  03930008
039400              MOVE DL007-ECA-KEY-START-DTE TO PV-ASGMT-STRT-DTE   03940008
039500              MOVE DL007-ECA-KEY-NBR-TXT   TO PV-ASGMT-NBR-TXT    03950008
039600              MOVE DL007-ECA-KEY-NBR-SEQ-NBR TO                   03960008
039700                                 PV-ASGMT-NBR-SEQ-NBR             03970008
039800                                                                  03980008
039900              PERFORM 3000-SELECT-ASSIGNMENT                      03990008
040000                                                                  04000008
040100              IF DL007-SUCCESSFUL                                 04010008
040200                 IF DL007-END-COPY-ASGMT                          04020008
040300                    PERFORM 2200-END-ASSIGNMENT                   04030008
040400                 END-IF                                           04040008
040500                                                                  04050008
040600                 IF DL007-SUCCESSFUL                              04060008
040700                    PERFORM 5000-INSERT-ASSIGNMENT                04070008
040800                 END-IF                                           04080008
040900              END-IF                                              04090008
041000                                                                  04100008
041100         WHEN DL007-COPY-FROM-ASGMT-WTEAM OR                      04110008
041200              DL007-END-COPY-ASGMT-WTEAM                          04120008
041300*             **************************************************  04130008
041400*             *  COPIES DLT_ASGMT (DLT00004) ROW TO NEW        *  04140008
041500*             *      ASSIGNMENT. THEN COPIES THE RELATED       *  04150008
041600*             *      DLT_TEM_ASGMT (DLT00003) ROWS ALSO.       *  04160008
041700*             *                                                *  04170008
041800*             **************************************************  04180008
041900              MOVE DL007-ECA-KEY-START-DTE TO PV-ASGMT-STRT-DTE   04190008
042000              MOVE DL007-ECA-KEY-NBR-TXT   TO PV-ASGMT-NBR-TXT    04200008
042100              MOVE DL007-ECA-KEY-NBR-SEQ-NBR TO                   04210008
042200                                 PV-ASGMT-NBR-SEQ-NBR             04220008
042300                                                                  04230008
042400              PERFORM 3000-SELECT-ASSIGNMENT                      04240008
042500                                                                  04250008
042600              IF DL007-SUCCESSFUL                                 04260008
042700                 IF DL007-END-COPY-ASGMT-WTEAM                    04270008
042800                    PERFORM 2200-END-ASSIGNMENT                   04280008
042900                 END-IF                                           04290008
043000                                                                  04300008
043100                 MOVE PV-ASGMT-NBR-WRK-TYP TO                     04310008
043200                         PV-ASGMT-NBR-WRK-TYP-SAV                 04320008
043300                 IF PV-RECV-WRK-TYP OR                            04330008
043400                    PV-RECV1-WRK-TYP                              04340008
043500                    PERFORM 8500-COUNT-ASSOCIATES                 04350008
043600                    IF PV-ASSOCIATE-COUNT > 1                     04360008
043700                        SET PV-RECV-WRK-TYP TO TRUE               04370008
043800                    ELSE                                          04380008
043900                        SET PV-RECV1-WRK-TYP TO TRUE              04390008
044000                    END-IF                                        04400008
044100                 END-IF                                           04410008
044200                 IF PV-P2L-WRK-TYP OR                             04420008
044300                    PV-P2L1-WRK-TYP                               04430008
044400                    PERFORM 8500-COUNT-ASSOCIATES                 04440008
044500                    IF PV-ASSOCIATE-COUNT > 1                     04450008
044600                        SET PV-P2L-WRK-TYP TO TRUE                04460008
044700                    ELSE                                          04470008
044800                        SET PV-P2L1-WRK-TYP TO TRUE               04480008
044900                    END-IF                                        04490008
045000                 END-IF                                           04500008
045100                                                                  04510008
045200                 IF DL007-SUCCESSFUL                              04520008
045300                    PERFORM 5000-INSERT-ASSIGNMENT                04530008
045400                 END-IF                                           04540008
045500                                                                  04550008
045600                 IF DL007-SUCCESSFUL                              04560008
045700                    MOVE PV-ASGMT-NBR-WRK-TYP-SAV TO              04570008
045800                         PV-ASGMT-NBR-WRK-TYP                     04580008
045900                    PERFORM 4000-COPY-ASSOCIATES                  04590008
046000                 END-IF                                           04600008
046100              END-IF                                              04610008
046200                                                                  04620008
046300     END-EVALUATE.                                                04630008
046400                                                                  04640008
046500*    ***********************************************************  04650008
046600*    *  FILL IN THE OUTPUT FIELDS AFTER A SUCCESSFUL EXECUTION *  04660008
046700*    *  OF THE FUNCTION SELECTED.                              *  04670008
046800*    *                                                         *  04680008
046900*    ***********************************************************  04690008
047000     IF DL007-SUCCESSFUL                                          04700008
047100        IF DL007-END-ASGMT                                        04710008
047200           CONTINUE                                               04720008
047300        ELSE                                                      04730008
047400           MOVE PV-ASGMT-STRT-DTE TO                              04740008
047500                           DL007-NEW-START-DTE                    04750008
047600           MOVE PV-ASGMT-NBR-TXT   TO                             04760008
047700                           DL007-NEW-NBR-TXT                      04770008
047800           MOVE PV-SET-SEQ-NBR TO                                 04780008
047900                           DL007-NEW-ASGMT-NBR-SEQ-NBR            04790008
048000           MOVE PV-CURRENT-TIMESTAMP TO                           04800008
048100                           DL007-ASGMT-END-TMST                   04810008
048200        END-IF                                                    04820008
048300                                                                  04830008
048400        IF DL007-COMMIT-UPDATE                                    04840008
048500           PERFORM 9000-SYNCPOINT                                 04850008
048600        END-IF                                                    04860008
048700     END-IF.                                                      04870008
048800                                                                  04880008
048900                                                                  04890008
049000****************************************************************  04900008
049100*    PARAGRAPH HAS SEVERAL LOGIC PIECES.                       *  04910008
049200*    1 - CHECKS TO SEE IF AN ISTOP BUSINESS EVENT NEEDS TO BE  *  04920008
049300*        PUT OUT.                                              *  04930008
049400*    2 - IF THIS IS A SHIPPING ASSIGNMENT AND THERE WASN'T ANY *  04940008
049500*        ACTIVITY AGAINST IT (DLT00004-LAST-USD-SEQ-NBR = 0),  *  04950008
049600*        CHECK TO SEE IF THERE ARE ANY DIVERTED CARTONS        *  04960008
049700*        (PV-DIVERT-COUNT > 0).                                *  04970008
049800*                                                              *  04980008
049900*        IF THERE ARE, WE NEED TO PUT OUT DOOR SUMMARY AND     *  04990008
050000*        ASSIGNMENT CLOSE BUSINESS EVENTS.                     *  05000008
050100*                                                              *  05010008
050200****************************************************************  05020008
050300                                                                  05030008
050400 2200-END-ASSIGNMENT.                                             05040008
050500                                                                  05050008
050600     IF DLT00004-WK-TYP-DESC = PC-RLABL                           05060008
050700        PERFORM 7000-SELECT-TEAM-ASSIGNMENT                       05070008
050800                                                                  05080008
050900        IF PS-TEAM-ROW-FOUND                                      05090008
051000           PERFORM 7200-SELECT-DLPLDU                             05100008
051100           IF PS-DLPLDU-ROW-FOUND                                 05110008
051200              PERFORM 7600-FORMAT-XLWS072-ISTOP                   05120008
051300           END-IF                                                 05130008
051400        END-IF                                                    05140008
051500     END-IF.                                                      05150008
051600                                                                  05160008
051700     MOVE 0 TO PV-DIVERT-COUNT.                                   05170008
051800                                                                  05180008
051900     IF DL007-SUCCESSFUL                                          05190008
052000        IF DLT00004-WK-TYP-DESC = 'SHIP'                          05200008
052100            PERFORM 3400-COUNT-DIVERTS                            05210008
052200        END-IF                                                    05220008
052300        IF DLT00004-LAST-USD-SEQ-NBR = 0  AND                     05230008
052400           DLT00004-WK-TYP-DESC = 'SHIP'  AND                     05240008
052500           DL007-END-ASGMT                                        05250008
052600****************************************************************  05260008
052700**   THE FOLLOWING LOGIC IS SPECIAL IN THAT IT CHANGES THE     *  05270008
052800**       PROCESS FOR AN ASSIGNMENT ONLY IF IT'S A SHIPPING     *  05280008
052900**       ASSIGNMENT, THE LAST-USD-SEQ-NBR IS 0 AND IT HAS      *  05290008
053000**       DIVERTED CARTONS.  THIS IS DONE SO THAT THE ASSIGN-   *  05300008
053100**       MENT AND ITS TEAM MEMBERS ARE COPIED AND THE DOOR     *  05310008
053200**       SUMMARY AND ASSIGNMENT CLOSE BUSINESS EVENTS ARE      *  05320008
053300**       PUT OUT IN THIS SPECIAL CASE.                         *  05330008
053400**                                                             *  05340008
053500****************************************************************  05350008
053600           IF PV-DIVERT-COUNT  > 0                                05360008
053700              SET DL007-END-COPY-ASGMT-WTEAM TO TRUE              05370008
053800              SET DL007-LOG-TO-EAI-EXPORT TO TRUE                 05380008
053900           END-IF                                                 05390008
054000        END-IF                                                    05400008
054100                                                                  05410008
054200        IF DL007-LOG-TO-EAI-EXPORT                                05420008
054300           MOVE PV-ASGMT-STRT-DTE TO                              05430008
054400                PV-BUILD-TIMESTAMP-DTE                            05440008
054500****************************************************************  05450008
054600**         ONLY PUT OUT AN ASSIGNMENT CLOSE BUSINESS EVENT IF  *  05460008
054700**         THERE HAS BEEN ACTIVITY AGAINST THIS ASSIGNMENT     *  05470008
054800**          (DLT00004-LAST-USD-SEQ-NBR > 0)                    *  05480008
054900**     OR  IF THE ASSIGNMENT HAS DIVERTED CARTONS              *  05490008
055000**  (PV-DIVERT-COUNT > 0 AND DLT00004-LAST-USD-SEQ-NBR = 0     *  05500008
055100**                                                             *  05510008
055200**     ALWAYS PUT OUT DOOR SUMMARY AND ASSIGNMENT CLOSE        *  05520008
055300**     BUSINESS EVENTS IF DLT00004-LAST-USD-SEQ-NBR > 0,       *  05530008
055400**     (THERE WAS ACTIVITY AGAINST THE ASSIGNMENT).            *  05540008
055500****************************************************************  05550008
055600           IF DL007-SUCCESSFUL                                    05560008
055700              IF DLT00004-LAST-USD-SEQ-NBR = 0                    05570008
055800                 IF PV-DIVERT-COUNT  > 0                          05580008
055900                    PERFORM 7400-FORMAT-XLWS072-CLOSE             05590008
056000                 END-IF                                           05600008
056100              ELSE                                                05610008
056200                 PERFORM 7400-FORMAT-XLWS072-CLOSE                05620008
056300              END-IF                                              05630008
056400           END-IF                                                 05640008
056500        END-IF                                                    05650008
056600     END-IF.                                                      05660008
056700                                                                  05670008
056800     IF DL007-SUCCESSFUL                                          05680008
056900        PERFORM 6000-UPDATE-ASSOCIATE                             05690008
057000     END-IF.                                                      05700008
057100                                                                  05710008
057200     IF DL007-SUCCESSFUL                                          05720008
057300        PERFORM 6200-UPDATE-ASSIGNMENT                            05730008
057400     END-IF.                                                      05740008
057500                                                                  05750008
057600                                                                  05760008
057700****************************************************************  05770008
057800*                                                              *  05780008
057900*                                                              *  05790008
058000****************************************************************  05800008
058100                                                                  05810008
058200 2400-COPY-ASSIGNMENT.                                            05820008
058300                                                                  05830008
058400     IF DL007-SUCCESSFUL                                          05840008
058500        PERFORM 5000-INSERT-ASSIGNMENT                            05850008
058600     END-IF.                                                      05860008
058700                                                                  05870008
058800     IF DL007-SUCCESSFUL                                          05880008
058900        PERFORM 4000-COPY-ASSOCIATES                              05890008
059000     END-IF.                                                      05900008
059100                                                                  05910008
059200                                                                  05920008
059300****************************************************************  05930008
059400*                                                              *  05940008
059500*                                                              *  05950008
059600****************************************************************  05960008
059700                                                                  05970008
059800 3000-SELECT-ASSIGNMENT.                                          05980008
059900                                                                  05990008
060000     PERFORM                                                      06000008
060100         WITH TEST AFTER                                          06010008
060200         VARYING PV-RETRY-COUNTER                                 06020008
060300         FROM 1 BY 1                                              06030008
060400         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  06040008
060500            OR SQLCODE = ZERO                                     06050008
060600            OR SQLCODE = +100                                     06060008
060700                                                                  06070008
060800         EXEC SQL                                                 06080008
060900             SELECT                                               06090008
061000                    ASGMT_STRT_TM                                 06100008
061100                   ,WK_TYP_DESC                                   06110008
061200                   ,WK_AREA_DESC                                  06120008
061300                   ,DC_NBR                                        06130008
061400                   ,CRE_BY_USR_ID                                 06140008
061500                   ,CRE_BY_PGM_NM                                 06150008
061600                   ,LAST_USD_SEQ_NBR                              06160008
061700              INTO                                                06170008
061800                    :DLT00004-ASGMT-STRT-TM                       06180008
061900                   ,:DLT00004-WK-TYP-DESC                         06190008
062000                   ,:DLT00004-WK-AREA-DESC                        06200008
062100                   ,:DLT00004-DC-NBR                              06210008
062200                   ,:DLT00004-CRE-BY-USR-ID                       06220008
062300                   ,:DLT00004-CRE-BY-PGM-NM                       06230008
062400                   ,:DLT00004-LAST-USD-SEQ-NBR                    06240008
062500              FROM  DLT_ASGMT                                     06250008
062600             WHERE  ASGMT_STRT_DTE    = :PV-ASGMT-STRT-DTE        06260008
062700               AND  ASGMT_NBR_SEQ_NBR = :PV-ASGMT-NBR-SEQ-NBR     06270008
062800               AND  ASGMT_NBR_TXT     = :PV-ASGMT-NBR-TXT         06280008
062900               AND  ASGMT_STP_RSN_CDE = :PC-N                     06290008
063000         END-EXEC                                                 06300008
063100                                                                  06310008
063200         EVALUATE TRUE                                            06320008
063300             WHEN SQLCODE = ZERO                                  06330008
063400                  SET PS-ASSIGNMENT-FOUND TO TRUE                 06340008
063500                                                                  06350008
063600             WHEN SQLCODE = -904                                  06360008
063700             WHEN SQLCODE = -913                                  06370008
063800             WHEN SQLCODE = -911                                  06380008
063900                  CONTINUE                                        06390008
064000                                                                  06400008
064100             WHEN SQLCODE = +100                                  06410008
064200                  SET PS-ASSIGNMENT-NOT-FOUND TO TRUE             06420008
064300                  SET DL007-ASGMT-NOT-OPEN    TO TRUE             06430008
064400                                                                  06440008
064500             WHEN SQLWARN0 NOT = SPACES                           06450008
064600             WHEN SQLCODE NOT = ZERO                              06460008
064700                  MOVE +4             TO PV-RETRY-COUNTER         06470008
064800         END-EVALUATE                                             06480008
064900     END-PERFORM.                                                 06490008
065000                                                                  06500008
065100     IF SQLCODE = ZERO OR                                         06510008
065200        SQLCODE = +100                                            06520008
065300        CONTINUE                                                  06530008
065400     ELSE                                                         06540008
065500        IF PV-RETRY-COUNTER > PC-MAX-RETRIES                      06550008
065600           SET DL007-SQL-ERROR TO TRUE                            06560008
065700           MOVE '3000-'        TO DL007-SQL-ERROR-PARA            06570008
065800        END-IF                                                    06580008
065900     END-IF.                                                      06590008
066000                                                                  06600008
066100                                                                  06610008
066200****************************************************************  06620008
066300*    COUNTS THE NUMBER OF DIVERTED CARTONS.                    *  06630008
066400*                                                              *  06640008
066500*    SHOULD ONLY BE DONE FOR SHIPPING EVENTS.                  *  06650008
066600****************************************************************  06660008
066700                                                                  06670008
066800 3400-COUNT-DIVERTS.                                              06680008
066900                                                                  06690008
067000     STRING PV-ASGMT-STRT-DTE                                     06700008
067100            '-'                                                   06710008
067200            DLT00004-ASGMT-STRT-TM                                06720008
067300            '.000000'                                             06730008
067400            DELIMITED BY SIZE                                     06740008
067500            INTO PV-TIMESTAMP.                                    06750008
067600     MOVE DLT00004-WK-AREA-DESC  TO DL011-SHIP-DOORGRP-WRK-AREA.  06760008
067700     MOVE DL011-SD-WRK-AREA-DOOR-GROUP TO                         06770008
067800                                 PV-SD-WRK-AREA-DOOR-GROUP.       06780008
067900                                                                  06790008
068000     MOVE 0 TO PV-DIVERT-COUNT.                                   06800008
068100                                                                  06810008
068200     EXEC SQL                                                     06820008
068300             SELECT  DRVT.OPER_UNT_ID                             06830008
068400              INTO   :SUCRDV-OPER-UNT-ID                          06840008
068500                                                                  06850008
068600          FROM  DLT_DOOR_GP      GP                               06860008
068700               ,DLT_DOOR_GP_TMPL TMPL                             06870008
068800               ,TSUCRDV          DRVT                             06880008
068900                                                                  06890008
069000         WHERE  GP.DOOR_GP_NBR       = :PV-SD-WRK-AREA-DOOR-GROUP 06900008
069100           AND  TMPL.DOOR_GP_TMPL_ID = GP.DOOR_GP_TMPL_ID         06910008
069200           AND  TMPL.DC_NBR          = :DLT00004-DC-NBR           06920008
069300           AND  TMPL.ACTV_IND        = 'Y'                        06930008
069400           AND  DRVT.DOOR_ID         = GP.DOOR_ID                 06940008
069500           AND  DRVT.ACTV_CDE        = 'A'                        06950008
069600           AND  DRVT.OPER_UNT_ID     = TMPL.DC_NBR                06960008
069700           AND  DRVT.DIVERT_TMST     > :PV-TIMESTAMP              06970008
069800                                                                  06980008
069900     END-EXEC.                                                    06990008
070000                                                                  07000008
070100     EVALUATE TRUE                                                07010008
070200         WHEN SQLCODE = ZERO OR -811                              07020008
070300              MOVE 1 TO PV-DIVERT-COUNT                           07030008
070400                                                                  07040008
070500         WHEN SQLCODE = +100                                      07050008
070600              CONTINUE                                            07060008
070700                                                                  07070008
070800         WHEN OTHER                                               07080008
070900              SET DL007-SQL-ERROR TO TRUE                         07090008
071000              MOVE SQLCODE        TO DL007-ASGMT-SQLCODE          07100008
071100              MOVE '3400-'        TO DL007-SQL-ERROR-PARA         07110008
071200              MOVE SQLCA          TO DL007-SQLCA                  07120008
071300                                                                  07130008
071400     END-EVALUATE.                                                07140008
071500                                                                  07150008
071600****************************************************************  07160008
071700*    USED BY COPY-FROM-ASGMT-WTEAM AND                         *  07170008
071800*            END-COPY-ASGMT-WTEAM                              *  07180008
071900*                                                              *  07190008
072000*    COPIES ALL RELATED ASSOCIATES FROM ONE ASSIGNMENT TO      *  07200008
072100*        A SECOND ASSIGMENT.                                   *  07210008
072200****************************************************************  07220008
072300                                                                  07230008
072400 4000-COPY-ASSOCIATES.                                            07240008
072500                                                                  07250008
072600     SET PS-NOT-END-OF-CURSOR TO TRUE.                            07260008
072700     PERFORM 4200-OPEN-ASSOCIATE-CURSOR.                          07270008
072800     PERFORM 4400-FETCH-ASSOCIATE.                                07280008
072900                                                                  07290008
073000     PERFORM UNTIL (PS-END-OF-CURSOR)                             07300008
073100         IF PV-RECV-WRK-TYP OR                                    07310008
073200            PV-RECV1-WRK-TYP                                      07320008
073300             IF PV-ASSOCIATE-COUNT > 1                            07330008
073400                 SET PV-RECV-WRK-TYP TO TRUE                      07340008
073500                 MOVE PV-ASGMT-NBR-TXT TO DLT00003-ASGMT-NBR-TXT  07350008
073600             ELSE                                                 07360008
073700                 SET PV-RECV1-WRK-TYP TO TRUE                     07370008
073800                 MOVE PV-ASGMT-NBR-TXT TO DLT00003-ASGMT-NBR-TXT  07380008
073900             END-IF                                               07390008
074000         END-IF                                                   07400008
074100         IF PV-P2L-WRK-TYP OR                                     07410008
074200            PV-P2L1-WRK-TYP                                       07420008
074300             IF PV-ASSOCIATE-COUNT > 1                            07430008
074400                 SET PV-P2L-WRK-TYP TO TRUE                       07440008
074500                 MOVE PV-ASGMT-NBR-TXT TO DLT00003-ASGMT-NBR-TXT  07450008
074600             ELSE                                                 07460008
074700                 SET PV-P2L1-WRK-TYP TO TRUE                      07470008
074800                 MOVE PV-ASGMT-NBR-TXT TO DLT00003-ASGMT-NBR-TXT  07480008
074900             END-IF                                               07490008
075000         END-IF                                                   07500008
075100                                                                  07510008
075200         PERFORM 5400-INSERT-ASSOCIATE                            07520008
075300         PERFORM 5500-INSERT-RDPR-USR                             07530008
075400                                                                  07540008
075500         IF PV-RECV-WRK-TYP  OR                                   07550008
075600            PV-RECV1-WRK-TYP OR                                   07560008
075700            PV-P2L-WRK-TYP   OR                                   07570008
075800            PV-P2L1-WRK-TYP                                       07580008
075900             MOVE PV-ASGMT-NBR-WRK-TYP-SAV TO                     07590008
076000                            PV-ASGMT-NBR-WRK-TYP                  07600008
076100         END-IF                                                   07610008
076200                                                                  07620008
076300         PERFORM 4400-FETCH-ASSOCIATE                             07630008
076400                                                                  07640008
076500     END-PERFORM.                                                 07650008
076600                                                                  07660008
076700     PERFORM 4600-CLOSE-ASSOCIATE-CURSOR.                         07670008
076800                                                                  07680008
076900****************************************************************  07690008
077000*    OPEN THE ASSOCIATE CURSOR                                 *  07700008
077100*                                                              *  07710008
077200****************************************************************  07720008
077300                                                                  07730008
077400 4200-OPEN-ASSOCIATE-CURSOR.                                      07740008
077500                                                                  07750008
077600     PERFORM                                                      07760008
077700         WITH TEST AFTER                                          07770008
077800         VARYING PV-RETRY-COUNTER                                 07780008
077900         FROM 1 BY 1                                              07790008
078000         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  07800008
078100            OR SQLCODE = ZERO                                     07810008
078200            OR SQLCODE = +100                                     07820008
078300                                                                  07830008
078400         EXEC SQL                                                 07840008
078500              OPEN  ASSOCIATE-CURSOR                              07850008
078600         END-EXEC                                                 07860008
078700                                                                  07870008
078800         EVALUATE TRUE                                            07880008
078900             WHEN SQLCODE = ZERO                                  07890008
079000                  CONTINUE                                        07900008
079100                                                                  07910008
079200             WHEN SQLCODE = -904                                  07920008
079300             WHEN SQLCODE = -913                                  07930008
079400             WHEN SQLCODE = -911                                  07940008
079500                                                                  07950008
079600             WHEN SQLCODE = +100                                  07960008
079700                  CONTINUE                                        07970008
079800                                                                  07980008
079900             WHEN SQLWARN0 NOT = SPACES                           07990008
080000             WHEN SQLCODE NOT = ZERO                              08000008
080100                  MOVE +4             TO PV-RETRY-COUNTER         08010008
080200         END-EVALUATE                                             08020008
080300     END-PERFORM.                                                 08030008
080400                                                                  08040008
080500     IF SQLCODE = ZERO OR                                         08050008
080600        SQLCODE = +100                                            08060008
080700        CONTINUE                                                  08070008
080800     ELSE                                                         08080008
080900        IF PV-RETRY-COUNTER > PC-MAX-RETRIES                      08090008
081000           SET DL007-SQL-ERROR TO TRUE                            08100008
081100           MOVE '4200-'        TO DL007-SQL-ERROR-PARA            08110008
081200        END-IF                                                    08120008
081300     END-IF.                                                      08130008
081400                                                                  08140008
081500****************************************************************  08150008
081600*    READ THE ASSOCIATES RELATED TO THE ASSIGNMENT.            *  08160008
081700*                                                              *  08170008
081800****************************************************************  08180008
081900                                                                  08190008
082000 4400-FETCH-ASSOCIATE.                                            08200008
082100                                                                  08210008
082200     PERFORM                                                      08220008
082300         WITH TEST AFTER                                          08230008
082400         VARYING PV-RETRY-COUNTER                                 08240008
082500         FROM 1 BY 1                                              08250008
082600         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  08260008
082700            OR SQLCODE = ZERO                                     08270008
082800            OR SQLCODE = +100                                     08280008
082900                                                                  08290008
083000         EXEC SQL                                                 08300008
083100             FETCH  ASSOCIATE-CURSOR                              08310008
083200                                                                  08320008
083300              INTO  :DLT00003-ASGMT-STRT-DTE                      08330008
083400                   ,:DLT00003-ASGMT-NBR-TXT                       08340008
083500                   ,:DLT00003-KOHLS-USR-ID                        08350008
083600                              :PV-KOHLS-USR-ID-NULL-IND           08360008
083700                   ,:DLT00003-TMP-USR-ID                          08370008
083800                              :PV-TMP-USR-ID-NULL-IND             08380008
083900                   ,:DLT00003-JN-TMST                             08390008
084000                   ,:DLT00003-CRE-BY-USR-ID                       08400008
084100                                                                  08410008
084200         END-EXEC                                                 08420008
084300                                                                  08430008
084400         EVALUATE TRUE                                            08440008
084500             WHEN SQLCODE = ZERO                                  08450008
084600                  CONTINUE                                        08460008
084700                                                                  08470008
084800             WHEN SQLCODE = -904                                  08480008
084900             WHEN SQLCODE = -911                                  08490008
085000             WHEN SQLCODE = -913                                  08500008
085100                  CONTINUE                                        08510008
085200                                                                  08520008
085300             WHEN SQLCODE = +100                                  08530008
085400                  SET PS-END-OF-CURSOR TO TRUE                    08540008
085500                                                                  08550008
085600             WHEN SQLWARN0 NOT = SPACES                           08560008
085700             WHEN SQLCODE NOT = ZERO                              08570008
085800                  MOVE +4             TO PV-RETRY-COUNTER         08580008
085900         END-EVALUATE                                             08590008
086000     END-PERFORM.                                                 08600008
086100                                                                  08610008
086200     IF SQLCODE = ZERO OR                                         08620008
086300        SQLCODE = +100                                            08630008
086400        CONTINUE                                                  08640008
086500     ELSE                                                         08650008
086600        IF PV-RETRY-COUNTER > PC-MAX-RETRIES                      08660008
086700           MOVE '4400-'        TO DL007-SQL-ERROR-PARA            08670008
086800           SET DL007-SQL-ERROR      TO TRUE                       08680008
086900        END-IF                                                    08690008
087000     END-IF.                                                      08700008
087100                                                                  08710008
087200****************************************************************  08720008
087300*                                                              *  08730008
087400*                                                              *  08740008
087500****************************************************************  08750008
087600                                                                  08760008
087700 4600-CLOSE-ASSOCIATE-CURSOR.                                     08770008
087800                                                                  08780008
087900     PERFORM                                                      08790008
088000         WITH TEST AFTER                                          08800008
088100         VARYING PV-RETRY-COUNTER                                 08810008
088200         FROM 1 BY 1                                              08820008
088300         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  08830008
088400            OR SQLCODE = ZERO                                     08840008
088500            OR SQLCODE = +100                                     08850008
088600                                                                  08860008
088700         EXEC SQL                                                 08870008
088800              CLOSE ASSOCIATE-CURSOR                              08880008
088900         END-EXEC                                                 08890008
089000                                                                  08900008
089100         EVALUATE TRUE                                            08910008
089200             WHEN SQLCODE = ZERO                                  08920008
089300                  CONTINUE                                        08930008
089400                                                                  08940008
089500             WHEN SQLCODE = -904                                  08950008
089600             WHEN SQLCODE = -913                                  08960008
089700             WHEN SQLCODE = -911                                  08970008
089800                                                                  08980008
089900             WHEN SQLCODE = +100                                  08990008
090000                  CONTINUE                                        09000008
090100                                                                  09010008
090200             WHEN SQLWARN0 NOT = SPACES                           09020008
090300             WHEN SQLCODE NOT = ZERO                              09030008
090400                  MOVE +4             TO PV-RETRY-COUNTER         09040008
090500         END-EVALUATE                                             09050008
090600     END-PERFORM.                                                 09060008
090700                                                                  09070008
090800     IF SQLCODE = ZERO OR                                         09080008
090900        SQLCODE = +100                                            09090008
091000        CONTINUE                                                  09100008
091100     ELSE                                                         09110008
091200        IF PV-RETRY-COUNTER > PC-MAX-RETRIES                      09120008
091300           SET DL007-SQL-ERROR TO TRUE                            09130008
091400           MOVE '4600-'        TO DL007-SQL-ERROR-PARA            09140008
091500        END-IF                                                    09150008
091600     END-IF.                                                      09160008
091700                                                                  09170008
091800****************************************************************  09180008
091900*    INSERTS EITHER USING INPUT FROM COMMAREA OR               *  09190008
092000*        BY COPYING FROM ANOTHER ASSIGNMENT.                   *  09200008
092100*                                                              *  09210008
092200****************************************************************  09220008
092300                                                                  09230008
092400 5000-INSERT-ASSIGNMENT.                                          09240008
092500                                                                  09250008
092600     IF  DL007-COPY-FROM-ASGMT                                    09260008
092700     OR  DL007-END-COPY-ASGMT                                     09270008
092800     OR  DL007-COPY-FROM-ASGMT-WTEAM                              09280008
092900     OR  DL007-END-COPY-ASGMT-WTEAM                               09290008
093000         CONTINUE                                                 09300008
093100     ELSE                                                         09310008
093200         MOVE DL007-NA-FLD-WK-TYP-DESC    TO                      09320008
093300              DLT00004-WK-TYP-DESC                                09330008
093400         MOVE DL007-NA-FLD-CRE-BY-USR-ID  TO                      09340008
093500              DLT00004-CRE-BY-USR-ID                              09350008
093600         MOVE DL007-NA-FLD-CRE-PGM-NM     TO                      09360008
093700              DLT00004-CRE-BY-PGM-NM                              09370008
093800         MOVE DL007-NA-FLD-WK-AREA-DESC   TO                      09380008
093900              DLT00004-WK-AREA-DESC                               09390008
094000         MOVE DL007-NA-FLD-DC-NBR         TO                      09400008
094100              DLT00004-DC-NBR                                     09410008
094200     END-IF.                                                      09420008
094300                                                                  09430008
094400     PERFORM                                                      09440008
094500         WITH TEST AFTER                                          09450008
094600         VARYING PV-RETRY-COUNTER                                 09460008
094700         FROM 1 BY 1                                              09470008
094800         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  09480008
094900            OR SQLCODE = ZERO                                     09490008
095000         MOVE PV-ASGMT-STRT-DTE TO PV-BUILD-TIMESTAMP-DTE         09500008
095100         MOVE PV-CURRENT-DATE TO PV-ASGMT-STRT-DTE                09510008
095200         IF DL007-CREATE-NEW-ASGMT OR                             09520008
095300            DL007-CREATE-NEW-ASGMT-WTEAM                          09530008
095400            EXEC SQL                                              09540008
095500                INSERT INTO DLT_ASGMT                             09550008
095600                      (ASGMT_STRT_DTE                             09560008
095700                      ,ASGMT_NBR_TXT                              09570008
095800                      ,ASGMT_STRT_TM                              09580008
095900                      ,WK_TYP_DESC                                09590008
096000                      ,WK_AREA_DESC                               09600008
096100                      ,DC_NBR                                     09610008
096200                      ,CRE_BY_USR_ID                              09620008
096300                      ,CRE_BY_PGM_NM                              09630008
096400                      ,ASGMT_STP_TMST                             09640008
096500                      ,ASGMT_STP_RSN_CDE                          09650008
096600                      ,STP_BY_PGM_NM                              09660008
096700                      ,LAST_USD_SEQ_NBR)                          09670008
096800                                                                  09680008
096900               VALUES (:PV-CURRENT-DATE                           09690008
097000                      ,:PV-ASGMT-NBR-TXT                          09700008
097100                      ,:PV-CURRENT-TIME                           09710008
097200                      ,:DLT00004-WK-TYP-DESC                      09720008
097300                      ,:DLT00004-WK-AREA-DESC                     09730008
097400                      ,:DLT00004-DC-NBR                           09740008
097500                      ,:DLT00004-CRE-BY-USR-ID                    09750008
097600                      ,:DLT00004-CRE-BY-PGM-NM                    09760008
097700                      ,NULL                                       09770008
097800                      ,:PC-N                                      09780008
097900                      ,NULL                                       09790008
098000                      ,0)                                         09800008
098100            END-EXEC                                              09810008
098200         ELSE                                                     09820008
098300            EXEC SQL                                              09830008
098400                INSERT INTO DLT_ASGMT                             09840008
098500                      (ASGMT_STRT_DTE                             09850008
098600                      ,ASGMT_NBR_TXT                              09860008
098700                      ,ASGMT_STRT_TM                              09870008
098800                      ,WK_TYP_DESC                                09880008
098900                      ,WK_AREA_DESC                               09890008
099000                      ,DC_NBR                                     09900008
099100                      ,CRE_BY_USR_ID                              09910008
099200                      ,CRE_BY_PGM_NM                              09920008
099300                      ,ASGMT_STP_TMST                             09930008
099400                      ,ASGMT_STP_RSN_CDE                          09940008
099500                      ,STP_BY_PGM_NM                              09950008
099600                      ,LAST_USD_SEQ_NBR)                          09960008
099700                                                                  09970008
099800               VALUES (:PV-CURRENT-DATE                           09980008
099900                      ,:PV-ASGMT-NBR-TXT                          09990008
100000                      ,:PV-CURRENT-TIME                           10000008
100100                      ,:DLT00004-WK-TYP-DESC                      10010008
100200                      ,:DLT00004-WK-AREA-DESC                     10020008
100300                      ,:DLT00004-DC-NBR                           10030008
100400                      ,:DLT00004-CRE-BY-USR-ID                    10040008
100500                      ,:DLT00004-CRE-BY-PGM-NM                    10050008
100600                      ,NULL                                       10060008
100700                      ,:PC-N                                      10070008
100800                      ,NULL                                       10080008
100900                      ,0)                                         10090008
101000            END-EXEC                                              10100008
101100         END-IF                                                   10110008
101200                                                                  10120008
101300         EVALUATE TRUE                                            10130008
101400             WHEN SQLCODE = ZERO                                  10140008
101500                  CONTINUE                                        10150008
101600                                                                  10160008
101700             WHEN SQLCODE = -904                                  10170008
101800             WHEN SQLCODE = -913                                  10180008
101900             WHEN SQLCODE = -911                                  10190008
102000                 CONTINUE                                         10200008
102100             WHEN SQLWARN0 NOT = SPACES                           10210008
102200             WHEN SQLCODE NOT = ZERO                              10220008
102300                  MOVE +4             TO PV-RETRY-COUNTER         10230008
102400                                                                  10240008
102500         END-EVALUATE                                             10250008
102600     END-PERFORM.                                                 10260008
102700                                                                  10270008
102800     IF SQLCODE = 0                                               10280008
102900     OR SQLCODE = -803                                            10290008
103000        EXEC SQL SET :PV-SET-SEQ-NBR =                            10300008
103100                      IDENTITY_VAL_LOCAL ()                       10310008
103200        END-EXEC                                                  10320008
103300                                                                  10330008
103400        IF SQLCODE = 0                                            10340008
103500        OR SQLCODE = -803                                         10350008
103600           CONTINUE                                               10360008
103700        ELSE                                                      10370008
103800           SET DL007-SQL-ERROR      TO TRUE                       10380008
103900           MOVE '5000-' TO DL007-SQL-ERROR-PARA                   10390008
104000        END-IF                                                    10400008
104100     ELSE                                                         10410008
104200        IF PV-RETRY-COUNTER > PC-MAX-RETRIES                      10420008
104300           SET DL007-SQL-ERROR      TO TRUE                       10430008
104400           MOVE '5000-' TO DL007-SQL-ERROR-PARA                   10440008
104500        END-IF                                                    10450008
104600     END-IF.                                                      10460008
104700                                                                  10470008
104800****************************************************************  10480008
104900*    CREATES USING INPUT FROM COMMAREA FOR CREATE OR           *  10490008
105000*        BY COPYING ASSOCIATES FROM ANOTHER ASSIGNMENT.        *  10500008
105100*                                                              *  10510008
105200*    NOTE: TEM_ASGMT_SEQ_NBR IS NOT INCLUDED IN THE INSERT     *  10520008
105300*          AS IT'S ASSIGNED BY DB2.                            *  10530008
105400****************************************************************  10540008
105500                                                                  10550008
105600 5400-INSERT-ASSOCIATE.                                           10560008
105700                                                                  10570008
105800     PERFORM                                                      10580008
105900         WITH TEST AFTER                                          10590008
106000         VARYING PV-RETRY-COUNTER                                 10600008
106100         FROM 1 BY 1                                              10610008
106200         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  10620008
106300            OR SQLCODE = ZERO                                     10630008
106400                                                                  10640008
106500         IF DL007-CREATE-NEW-ASGMT-WTEAM                          10650008
106600            IF DL007-USR-IS-KOHLS                                 10660008
106700               EXEC SQL                                           10670008
106800                   INSERT INTO DLT_TEM_ASGMT                      10680008
106900                         (ASGMT_STRT_DTE                          10690008
107000                         ,ASGMT_NBR_TXT                           10700008
107100                         ,ASGMT_NBR_SEQ_NBR                       10710008
107200                         ,KOHLS_USR_ID                            10720008
107300                         ,TMP_USR_ID                              10730008
107400                         ,JN_TMST                                 10740008
107500                         ,CRE_BY_USR_ID                           10750008
107600                         ,LVE_TMST                                10760008
107700                         ,LVE_RSN_CDE                             10770008
107800                         ,LVE_BY_PGM_NM)                          10780008
107900                                                                  10790008
108000                  VALUES (:PV-ASGMT-STRT-DTE                      10800008
108100                         ,:PV-ASGMT-NBR-TXT                       10810008
108200                         ,:PV-SET-SEQ-NBR                         10820008
108300                         ,:DL007-NA-FLD-CRE-BY-USR-ID             10830008
108400                         ,NULL                                    10840008
108500                         ,:PV-CURRENT-TIMESTAMP                   10850008
108600                         ,:DL007-NA-FLD-CRE-BY-USR-ID             10860008
108700                         ,NULL                                    10870008
108800                         ,:PC-N                                   10880008
108900                         ,NULL)                                   10890008
109000               END-EXEC                                           10900008
109100            ELSE                                                  10910008
109200               EXEC SQL                                           10920008
109300                   INSERT INTO DLT_TEM_ASGMT                      10930008
109400                         (ASGMT_STRT_DTE                          10940008
109500                         ,ASGMT_NBR_TXT                           10950008
109600                         ,ASGMT_NBR_SEQ_NBR                       10960008
109700                         ,KOHLS_USR_ID                            10970008
109800                         ,TMP_USR_ID                              10980008
109900                         ,JN_TMST                                 10990008
110000                         ,CRE_BY_USR_ID                           11000008
110100                         ,LVE_TMST                                11010008
110200                         ,LVE_RSN_CDE                             11020008
110300                         ,LVE_BY_PGM_NM)                          11030008
110400                                                                  11040008
110500                  VALUES (:PV-ASGMT-STRT-DTE                      11050008
110600                         ,:PV-ASGMT-NBR-TXT                       11060008
110700                         ,:PV-SET-SEQ-NBR                         11070008
110800                         ,NULL                                    11080008
110900                         ,:DL007-NA-FLD-CRE-BY-USR-ID             11090008
111000                         ,:PV-CURRENT-TIMESTAMP                   11100008
111100                         ,:DL007-NA-FLD-CRE-BY-USR-ID             11110008
111200                         ,NULL                                    11120008
111300                         ,:PC-N                                   11130008
111400                         ,NULL)                                   11140008
111500               END-EXEC                                           11150008
111600            END-IF                                                11160008
111700                                                                  11170008
111800         ELSE                                                     11180008
111900            IF PV-KOHLS-USR-ID-NULL-IND = -1                      11190008
112000                EXEC SQL                                          11200008
112100                    INSERT INTO DLT_TEM_ASGMT                     11210008
112200                          (ASGMT_STRT_DTE                         11220008
112300                          ,ASGMT_NBR_TXT                          11230008
112400                          ,ASGMT_NBR_SEQ_NBR                      11240008
112500                          ,KOHLS_USR_ID                           11250008
112600                          ,TMP_USR_ID                             11260008
112700                          ,JN_TMST                                11270008
112800                          ,CRE_BY_USR_ID                          11280008
112900                          ,LVE_TMST                               11290008
113000                          ,LVE_RSN_CDE                            11300008
113100                          ,LVE_BY_PGM_NM)                         11310008
113200                                                                  11320008
113300                   VALUES (:PV-CURRENT-DATE                       11330008
113400                          ,:DLT00003-ASGMT-NBR-TXT                11340008
113500                          ,:PV-SET-SEQ-NBR                        11350008
113600                          ,NULL                                   11360008
113700                          ,:DLT00003-TMP-USR-ID                   11370008
113800                          ,:PV-CURRENT-TIMESTAMP                  11380008
113900                          ,:DLT00003-CRE-BY-USR-ID                11390008
114000                          ,NULL                                   11400008
114100                          ,:PC-N                                  11410008
114200                          ,NULL)                                  11420008
114300                END-EXEC                                          11430008
114400                                                                  11440008
114500            ELSE                                                  11450008
114600                EXEC SQL                                          11460008
114700                    INSERT INTO DLT_TEM_ASGMT                     11470008
114800                          (ASGMT_STRT_DTE                         11480008
114900                          ,ASGMT_NBR_TXT                          11490008
115000                          ,ASGMT_NBR_SEQ_NBR                      11500008
115100                          ,KOHLS_USR_ID                           11510008
115200                          ,TMP_USR_ID                             11520008
115300                          ,JN_TMST                                11530008
115400                          ,CRE_BY_USR_ID                          11540008
115500                          ,LVE_TMST                               11550008
115600                          ,LVE_RSN_CDE                            11560008
115700                          ,LVE_BY_PGM_NM)                         11570008
115800                                                                  11580008
115900                   VALUES (:PV-CURRENT-DATE                       11590008
116000                          ,:DLT00003-ASGMT-NBR-TXT                11600008
116100                          ,:PV-SET-SEQ-NBR                        11610008
116200                          ,:DLT00003-KOHLS-USR-ID                 11620008
116300                          ,NULL                                   11630008
116400                          ,:PV-CURRENT-TIMESTAMP                  11640008
116500                          ,:DLT00003-CRE-BY-USR-ID                11650008
116600                          ,NULL                                   11660008
116700                          ,:PC-N                                  11670008
116800                          ,NULL)                                  11680008
116900                END-EXEC                                          11690008
117000                                                                  11700008
117100             END-IF                                               11710008
117200         END-IF                                                   11720008
117300                                                                  11730008
117400         EVALUATE TRUE                                            11740008
117500             WHEN SQLCODE = ZERO                                  11750008
117600             WHEN SQLCODE = -904                                  11760008
117700             WHEN SQLCODE = -913                                  11770008
117800             WHEN SQLCODE = -911                                  11780008
117900                 CONTINUE                                         11790008
118000             WHEN SQLWARN0 NOT = SPACES                           11800008
118100             WHEN SQLCODE NOT = ZERO                              11810008
118200                  MOVE +4             TO PV-RETRY-COUNTER         11820008
118300         END-EVALUATE                                             11830008
118400     END-PERFORM.                                                 11840008
118500                                                                  11850008
118600     IF SQLCODE = 0                                               11860008
118700        CONTINUE                                                  11870008
118800     ELSE                                                         11880008
118900        IF PV-RETRY-COUNTER > PC-MAX-RETRIES                      11890008
119000           SET DL007-SQL-ERROR      TO TRUE                       11900008
119100           MOVE '5400-' TO DL007-SQL-ERROR-PARA                   11910008
119200        END-IF                                                    11920008
119300     END-IF.                                                      11930008
119400                                                                  11940008
119500 5500-INSERT-RDPR-USR.                                            11950008
119600                                                                  11960008
119700     PERFORM                                                      11970008
119800         WITH TEST AFTER                                          11980008
119900         VARYING PV-RETRY-COUNTER                                 11990008
120000         FROM 1 BY 1                                              12000008
120100         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  12010008
120200            OR SQLCODE = ZERO OR SQLCODE = -803                   12020008
120300                                                                  12030008
120400         IF DL007-CREATE-NEW-ASGMT-WTEAM                          12040008
120500            IF DL007-USR-IS-KOHLS                                 12050008
120600                EXEC SQL                                          12060008
120700                   INSERT INTO DLT_RDPR_USR_LSTG                  12070008
120800                      (USR_ID                                     12080008
120900                      ,LOC_NBR                                    12090008
121000                      ,TMP_USR_ID                                 12100008
121100                      ,CRE_TMST)                                  12110008
121200                                                                  12120008
121300                   VALUES (:DL007-NA-FLD-CRE-BY-USR-ID            12130008
121400                          ,:DLT00004-DC-NBR                       12140008
121500                          ,NULL                                   12150008
121600                          ,:PV-CURRENT-TIMESTAMP)                 12160008
121700                END-EXEC                                          12170008
121800            ELSE                                                  12180008
121900                EXEC SQL                                          12190008
122000                   INSERT INTO DLT_RDPR_USR_LSTG                  12200008
122100                      (USR_ID                                     12210008
122200                      ,LOC_NBR                                    12220008
122300                      ,TMP_USR_ID                                 12230008
122400                      ,CRE_TMST)                                  12240008
122500                                                                  12250008
122600                   VALUES (NULL                                   12260008
122700                          ,:DLT00004-DC-NBR                       12270008
122800                          ,:DL007-NA-FLD-CRE-BY-USR-ID            12280008
122900                          ,:PV-CURRENT-TIMESTAMP)                 12290008
123000                END-EXEC                                          12300008
123100            END-IF                                                12310008
123200                                                                  12320008
123300         ELSE                                                     12330008
123400            IF PV-KOHLS-USR-ID-NULL-IND = -1                      12340008
123500                EXEC SQL                                          12350008
123600                   INSERT INTO DLT_RDPR_USR_LSTG                  12360008
123700                      (USR_ID                                     12370008
123800                      ,LOC_NBR                                    12380008
123900                      ,TMP_USR_ID                                 12390008
124000                      ,CRE_TMST)                                  12400008
124100                                                                  12410008
124200                   VALUES (NULL                                   12420008
124300                          ,:DLT00004-DC-NBR                       12430008
124400                          ,:DLT00003-TMP-USR-ID                   12440008
124500                          ,:PV-CURRENT-TIMESTAMP)                 12450008
124600                END-EXEC                                          12460008
124700                                                                  12470008
124800            ELSE                                                  12480008
124900                EXEC SQL                                          12490008
125000                   INSERT INTO DLT_RDPR_USR_LSTG                  12500008
125100                      (USR_ID                                     12510008
125200                      ,LOC_NBR                                    12520008
125300                      ,TMP_USR_ID                                 12530008
125400                      ,CRE_TMST)                                  12540008
125500                                                                  12550008
125600                   VALUES (:DLT00003-KOHLS-USR-ID                 12560008
125700                          ,:DLT00004-DC-NBR                       12570008
125800                          ,NULL                                   12580008
125900                          ,:PV-CURRENT-TIMESTAMP)                 12590008
126000                END-EXEC                                          12600008
126100             END-IF                                               12610008
126200         END-IF                                                   12620008
126300                                                                  12630008
126400         EVALUATE TRUE                                            12640008
126500             WHEN SQLCODE = ZERO                                  12650008
126600             WHEN SQLCODE = -803                                  12660008
126700             WHEN SQLCODE = -904                                  12670008
126800             WHEN SQLCODE = -913                                  12680008
126900             WHEN SQLCODE = -911                                  12690008
127000                 CONTINUE                                         12700008
127100             WHEN SQLWARN0 NOT = SPACES                           12710008
127200             WHEN SQLCODE NOT = ZERO                              12720008
127300                  MOVE +4             TO PV-RETRY-COUNTER         12730008
127400         END-EVALUATE                                             12740008
127500     END-PERFORM.                                                 12750008
127600                                                                  12760008
127700     IF SQLCODE = 0 OR -803                                       12770008
127800        CONTINUE                                                  12780008
127900     ELSE                                                         12790008
128000        IF PV-RETRY-COUNTER > PC-MAX-RETRIES                      12800008
128100           SET DL007-SQL-ERROR      TO TRUE                       12810008
128200           MOVE '5500-' TO DL007-SQL-ERROR-PARA                   12820008
128300        END-IF                                                    12830008
128400     END-IF.                                                      12840008
128500                                                                  12850008
128600****************************************************************  12860008
128700*    ENDS THE ASSOCIATES ASSIGNMENT TO A TASK.                 *  12870008
128800*                                                              *  12880008
128900****************************************************************  12890008
129000                                                                  12900008
129100 6000-UPDATE-ASSOCIATE.                                           12910008
129200                                                                  12920008
129300     PERFORM                                                      12930008
129400         WITH TEST AFTER                                          12940008
129500         VARYING PV-RETRY-COUNTER                                 12950008
129600         FROM 1 BY 1                                              12960008
129700         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  12970008
129800            OR SQLCODE = ZERO                                     12980008
129900            OR SQLCODE = +100                                     12990008
130000                                                                  13000008
130100         EXEC SQL                                                 13010008
130200             UPDATE DLT_TEM_ASGMT                                 13020008
130300                SET LVE_TMST      = :PV-CURRENT-TIMESTAMP         13030008
130400                   ,LVE_RSN_CDE   = :DL007-ECA-STOP-RSN-CDE       13040008
130500                   ,LVE_BY_PGM_NM = :DL007-ECA-STOP-PGM-NM        13050008
130600                                                                  13060008
130700             WHERE  ASGMT_STRT_DTE    = :PV-ASGMT-STRT-DTE        13070008
130800               AND  ASGMT_NBR_TXT     = :PV-ASGMT-NBR-TXT         13080008
130900               AND  ASGMT_NBR_SEQ_NBR = :PV-ASGMT-NBR-SEQ-NBR     13090008
131000               AND  LVE_RSN_CDE       = :PC-N                     13100008
131100         END-EXEC                                                 13110008
131200                                                                  13120008
131300         EVALUATE TRUE                                            13130008
131400             WHEN SQLCODE = ZERO                                  13140008
131500                  SET PS-ASSOCIATE-UPDATED TO TRUE                13150008
131600                                                                  13160008
131700             WHEN SQLCODE = +100                                  13170008
131800                  SET PS-ASSOCIATE-NOT-UPDATED TO TRUE            13180008
131900                                                                  13190008
132000             WHEN SQLCODE = -904                                  13200008
132100             WHEN SQLCODE = -913                                  13210008
132200             WHEN SQLCODE = -911                                  13220008
132300                  CONTINUE                                        13230008
132400                                                                  13240008
132500             WHEN SQLWARN0 NOT = SPACES                           13250008
132600             WHEN SQLCODE NOT = ZERO                              13260008
132700                  MOVE +4             TO PV-RETRY-COUNTER         13270008
132800         END-EVALUATE                                             13280008
132900     END-PERFORM.                                                 13290008
133000                                                                  13300008
133100                                                                  13310008
133200     IF SQLCODE = 0 OR                                            13320008
133300        SQLCODE = +100                                            13330008
133400        CONTINUE                                                  13340008
133500     ELSE                                                         13350008
133600        IF PV-RETRY-COUNTER > PC-MAX-RETRIES                      13360008
133700           SET DL007-SQL-ERROR      TO TRUE                       13370008
133800           MOVE '6000-' TO DL007-SQL-ERROR-PARA                   13380008
133900        END-IF                                                    13390008
134000     END-IF.                                                      13400008
134100                                                                  13410008
134200****************************************************************  13420008
134300*    ENDS THE ASSIGNMENT.                                      *  13430008
134400*                                                              *  13440008
134500****************************************************************  13450008
134600                                                                  13460008
134700 6200-UPDATE-ASSIGNMENT.                                          13470008
134800                                                                  13480008
134900     PERFORM                                                      13490008
135000         WITH TEST AFTER                                          13500008
135100         VARYING PV-RETRY-COUNTER                                 13510008
135200         FROM 1 BY 1                                              13520008
135300         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  13530008
135400            OR SQLCODE = ZERO                                     13540008
135500            OR SQLCODE = +100                                     13550008
135600                                                                  13560008
135700         EXEC SQL                                                 13570008
135800             UPDATE DLT_ASGMT                                     13580008
135900                SET ASGMT_STP_TMST    = :PV-CURRENT-TIMESTAMP     13590008
136000                   ,ASGMT_STP_RSN_CDE = :DL007-ECA-STOP-RSN-CDE   13600008
136100                   ,STP_BY_PGM_NM     = :DL007-ECA-STOP-PGM-NM    13610008
136200                                                                  13620008
136300             WHERE  ASGMT_STRT_DTE    = :PV-ASGMT-STRT-DTE        13630008
136400               AND  ASGMT_NBR_TXT     = :PV-ASGMT-NBR-TXT         13640008
136500               AND  ASGMT_NBR_SEQ_NBR = :PV-ASGMT-NBR-SEQ-NBR     13650008
136600               AND  ASGMT_STP_RSN_CDE = :PC-N                     13660008
136700         END-EXEC                                                 13670008
136800                                                                  13680008
136900         EVALUATE TRUE                                            13690008
137000             WHEN SQLCODE = ZERO                                  13700008
137100                  SET PS-ASSIGNMENT-UPDATED TO TRUE               13710008
137200                                                                  13720008
137300             WHEN SQLCODE = +100                                  13730008
137400                  SET PS-ASSIGNMENT-NOT-UPDATED TO TRUE           13740008
137500                                                                  13750008
137600             WHEN SQLCODE = -904                                  13760008
137700             WHEN SQLCODE = -913                                  13770008
137800             WHEN SQLCODE = -911                                  13780008
137900                  CONTINUE                                        13790008
138000                                                                  13800008
138100             WHEN SQLWARN0 NOT = SPACES                           13810008
138200             WHEN SQLCODE NOT = ZERO                              13820008
138300                  MOVE +4             TO PV-RETRY-COUNTER         13830008
138400         END-EVALUATE                                             13840008
138500     END-PERFORM.                                                 13850008
138600                                                                  13860008
138700     IF SQLCODE = 0 OR                                            13870008
138800        SQLCODE = +100                                            13880008
138900        CONTINUE                                                  13890008
139000     ELSE                                                         13900008
139100        IF PV-RETRY-COUNTER > PC-MAX-RETRIES                      13910008
139200           SET DL007-SQL-ERROR      TO TRUE                       13920008
139300           MOVE '6200-' TO DL007-SQL-ERROR-PARA                   13930008
139400        END-IF                                                    13940008
139500     END-IF.                                                      13950008
139600                                                                  13960008
139700****************************************************************  13970008
139800*    IF CLOSING AN ASSIGNMENT AND THE WRK-TYPE = 'RLABL', THEN *  13980008
139900*    WE NEED TO TAKE THE TEMP USERID FROM THE DLT_TEM_ASGMT    *  13990008
140000*    TABLE AND THE DC NUMBER FROM THE DLT_ASGMT TABLE TO       *  14000008
140100*    READ THE TKRPRPM TABLE.                                   *  14010008
140200*                                                              *  14020008
140300****************************************************************  14030008
140400                                                                  14040008
140500 7000-SELECT-TEAM-ASSIGNMENT.                                     14050008
140600                                                                  14060008
140700     EXEC SQL                                                     14070008
140800       SELECT   TMP_USR_ID                                        14080008
140900               ,(JN_TMST + 1 SECOND)                              14090008
141000                                                                  14100008
141100         INTO   :DLT00003-TMP-USR-ID                              14110008
141200               ,:DLT00003-JN-TMST                                 14120008
141300                                                                  14130008
141400         FROM   DLT_TEM_ASGMT                                     14140008
141500                                                                  14150008
141600        WHERE   ASGMT_STRT_DTE    = :PV-ASGMT-STRT-DTE            14160008
141700          AND   ASGMT_NBR_TXT     = :PV-ASGMT-NBR-TXT             14170008
141800          AND   ASGMT_NBR_SEQ_NBR = :PV-ASGMT-NBR-SEQ-NBR         14180008
141900          AND   LVE_RSN_CDE       = :PC-N                         14190008
142000     END-EXEC.                                                    14200008
142100                                                                  14210008
142200     EVALUATE TRUE                                                14220008
142300         WHEN SQLCODE = ZERO                                      14230008
142400              SET PS-TEAM-ROW-FOUND TO TRUE                       14240008
142500                                                                  14250008
142600         WHEN SQLCODE = +100                                      14260008
142700              SET PS-TEAM-ROW-NOT-FOUND TO TRUE                   14270008
142800                                                                  14280008
142900         WHEN SQLWARN0 NOT = SPACES                               14290008
143000         WHEN SQLCODE NOT = ZERO                                  14300008
143100              SET DL007-SQL-ERROR      TO TRUE                    14310008
143200              MOVE '7000-' TO DL007-SQL-ERROR-PARA                14320008
143300                                                                  14330008
143400     END-EVALUATE.                                                14340008
143500                                                                  14350008
143600                                                                  14360008
143700****************************************************************  14370008
143800*    IF A ROW IS FOUND ON THE TKRPRPM TABLE FOR THE TEMPORARY  *  14380008
143900*    USERID AND DC, THEN WE WILL NEED TO CALL XLKUP033 TO      *  14390008
144000*    WRITE OUT AN ISTOP IN-INDIRECT BUSINESS EVENT.            *  14400008
144100*                                                              *  14410008
144200****************************************************************  14420008
144300                                                                  14430008
144400 7200-SELECT-DLPLDU.                                              14440008
144500                                                                  14450008
144600     EXEC SQL                                                     14460008
144700         SELECT   FUNC_TXT                                        14470008
144800          INTO   :KRPRPM-FUNC-TXT                                 14480008
144900                                                                  14490008
145000          FROM   TKRPRPM                                          14500008
145100                                                                  14510008
145200         WHERE   LOC_ID            = :DLT00004-DC-NBR             14520008
145300           AND   INTFC_SYS_CDE     = :PC-DLX                      14530008
145400           AND   FUNC_PRC_STAT_CDE = :PC-AC                       14540008
145500           AND   SYS_PRC_FUNC_CDE  = :PC-DLPLDU                   14550008
145600           AND   FUNC_TXT          = :DLT00003-TMP-USR-ID         14560008
145700     END-EXEC.                                                    14570008
145800                                                                  14580008
145900     EVALUATE TRUE                                                14590008
146000         WHEN SQLCODE = ZERO                                      14600008
146100              SET PS-DLPLDU-ROW-FOUND TO TRUE                     14610008
146200                                                                  14620008
146300         WHEN SQLCODE = +100                                      14630008
146400              SET PS-DLPLDU-ROW-NOT-FOUND TO TRUE                 14640008
146500                                                                  14650008
146600         WHEN SQLWARN0 NOT = SPACES                               14660008
146700         WHEN SQLCODE NOT = ZERO                                  14670008
146800              SET DL007-SQL-ERROR      TO TRUE                    14680008
146900              MOVE '7200-' TO DL007-SQL-ERROR-PARA                14690008
147000                                                                  14700008
147100     END-EVALUATE.                                                14710008
147200                                                                  14720008
147300****************************************************************  14730008
147400*    IF CLOSING AN ASSIGNMENT AND THE DL007-LOG-TO-EAI-EXPORT  *  14740008
147500*    SWITCH IS ON, WE CALL XLKUP033 TO WRITE THE APPROPRIATE   *  14750008
147600*    INFORMATION TO EITHER THE PCT00011 OR SUT00037 TABLES.    *  14760008
147700*                                                              *  14770008
147800****************************************************************  14780008
147900                                                                  14790008
148000 7400-FORMAT-XLWS072-CLOSE.                                       14800008
148100                                                                  14810008
148200     EVALUATE TRUE                                                14820008
148300         WHEN DLT00004-WK-TYP-DESC = 'SHIP'                       14830008
148400              MOVE DLT00004-WK-AREA-DESC  TO                      14840008
148500                                    DL011-SHIP-DOORGRP-WRK-AREA   14850008
148600              MOVE DL011-SD-WRK-AREA-DOOR-GROUP TO                14860008
148700                                    DL017-DOOR-GP-NBR             14870008
148800              MOVE DLT00004-DC-NBR     TO DL017-DC-NBR            14880008
148900                                                                  14890008
149000              PERFORM 8400-COUNT-DOORS                            14900008
149100              IF DL007-SUCCESSFUL                                 14910008
149200                 PERFORM 8600-CALL-DLKUP001                       14920008
149300              END-IF                                              14930008
149400              IF DL007-SUCCESSFUL                                 14940008
149500                 PERFORM 8000-CALL-DLKUT006                       14950008
149600              END-IF                                              14960008
149700                                                                  14970008
149800         WHEN OTHER                                               14980008
149900              CONTINUE                                            14990008
150000                                                                  15000008
150100     END-EVALUATE.                                                15010008
150200                                                                  15020008
150300     INITIALIZE XL072-EAI-EXPORT-COMMAREA.                        15030008
150400                                                                  15040008
150500     EVALUATE TRUE                                                15050008
150600         WHEN DLT00004-WK-TYP-DESC = 'P2L'                        15060008
150700         WHEN DLT00004-WK-TYP-DESC = 'RLABL'                      15070008
150800         WHEN DLT00004-WK-TYP-DESC = 'MASTCON'                    15080008
150900              SET XL072-PC-APP-ID TO TRUE                         15090008
151000                                                                  15100008
151100         WHEN OTHER                                               15110008
151200              SET XL072-SU-APP-ID TO TRUE                         15120008
151300                                                                  15130008
151400     END-EVALUATE.                                                15140008
151500                                                                  15150008
151600     MOVE PC-DC-LABOR         TO XL072-EVNT-OBJ-TXT.              15160008
151700     MOVE PC-ASSIGNMENT-CLOSE TO XL072-EVNT-OBJ-ACTN-TXT.         15170008
151800     MOVE DL007-ORIG-CALLING-PGM-NM TO XL072-CRE-BY-USR-ID.       15180008
151900     MOVE PC-DLKUP003               TO XL072-CRE-PGM-NM.          15190008
152000                                                                  15200008
152100     SET XL072-DO-NOT-COMMIT-UPDATE TO TRUE.                      15210008
152200     SET XL072-COPYBOOK-NOT-USED    TO TRUE.                      15220008
152300                                                                  15230008
152400     MOVE PV-ASGMT-NBR-SEQ-NBR TO XL072-EVNT-KY-1-NBR.            15240008
152500     MOVE PV-ASGMT-NBR-TXT     TO XL072-EVNT-KY-1-TXT.            15250008
152600     MOVE PV-BUILD-TIMESTAMP   TO XL072-EVNT-KY-1-TMST.           15260008
152700     MOVE DLT00004-DC-NBR      TO XL072-EVNT-KY-2-NBR.            15270008
152800                                                                  15280008
152900     PERFORM 7800-CALL-XLKUP033.                                  15290008
153000                                                                  15300008
153100****************************************************************  15310008
153200*                                                              *  15320008
153300*                                                              *  15330008
153400****************************************************************  15340008
153500                                                                  15350008
153600 7600-FORMAT-XLWS072-ISTOP.                                       15360008
153700                                                                  15370008
153800     INITIALIZE XL072-EAI-EXPORT-COMMAREA.                        15380008
153900                                                                  15390008
154000     SET XL072-PC-APP-ID          TO TRUE.                        15400008
154100                                                                  15410008
154200     MOVE PC-DC-LABOR             TO XL072-EVNT-OBJ-TXT.          15420008
154300     MOVE PC-INDIRECT-LABOR       TO XL072-EVNT-OBJ-ACTN-TXT.     15430008
154400     MOVE DLT00003-TMP-USR-ID     TO XL072-CRE-BY-USR-ID.         15440008
154500     MOVE PC-DLKUP003             TO XL072-CRE-PGM-NM.            15450008
154600     MOVE DLT00004-DC-NBR         TO XL072-EVNT-KY-1-NBR.         15460008
154700     MOVE PC-ISTOP                TO XL072-EVNT-KY-1-TXT.         15470008
154800     MOVE DLT00003-JN-TMST        TO XL072-EVNT-KY-1-TMST.        15480008
154900                                                                  15490008
155000     SET XL072-COMMIT-UPDATE      TO TRUE.                        15500008
155100     MOVE PC-DLKUP003             TO XL072-ORIG-CALLING-PGM-NM.   15510008
155200                                                                  15520008
155300     SET XL072-COPYBOOK-NOT-USED TO TRUE.                         15530008
155400                                                                  15540008
155500     PERFORM 7800-CALL-XLKUP033.                                  15550008
155600                                                                  15560008
155700                                                                  15570008
155800****************************************************************  15580008
155900*    IF CLOSING AN ASSIGNMENT AND THE DL007-LOG-TO-EAI-EXPORT  *  15590008
156000*    SWITCH IS ON, WE CALL XLKUP033 TO WRITE THE APPROPRIATE   *  15600008
156100*    INFORMATION TO EITHER THE PCT00011 OR SUT00037 TABLES.    *  15610008
156200*                                                              *  15620008
156300****************************************************************  15630008
156400                                                                  15640008
156500 7800-CALL-XLKUP033.                                              15650008
156600                                                                  15660008
156700     CALL XL072-USER-PGM USING DFHEIBLK                           15670008
156800                               XL072-COMMAREA                     15680008
156900                               XL072-EAI-EXPORT-COMMAREA.         15690008
157000                                                                  15700008
157100     IF XL072-SUCCESSFUL                                          15710008
157200        CONTINUE                                                  15720008
157300     ELSE                                                         15730008
157400        SET DL007-CALLED-MODULE-FAILURE TO TRUE                   15740008
157500        MOVE XL072-USER-PGM        TO DL007-CALL-MOD-FAIL-NM      15750008
157600        MOVE XL072-RETURN-CODE     TO DL007-CALL-MOD-FAIL-ERR-CDE 15760008
157700        MOVE XL072-RETURN-SQLCODES TO DL007-RETURN-SQLCODES       15770008
157800     END-IF.                                                      15780008
157900                                                                  15790008
158000******************************************************************15800008
158100*    THIS WILL ONLY BE USED WHEN CLOSING A SHIPPING ASSIGNMENT.  *15810008
158200*        IT CALLS DLKUT006 TO GENERATE A "SHIPPING DOOR SUMMARY" *15820008
158300*        BUSINESS EVENT FOR EVERY DOOR WITHIN THE DOOR GROUP     *15830008
158400*        TEMPLATE ID.                                            *15840008
158500******************************************************************15850008
158600                                                                  15860008
158700 8000-CALL-DLKUT006.                                              15870008
158800                                                                  15880008
158900     INITIALIZE DL017-ASGMT-COMMAREA.                             15890008
159000     SET  DL017-BY-DOOR-GROUP-ID TO TRUE.                         15900008
159100                                                                  15910008
159200     MOVE DL007-ECA-KEY-START-DTE   TO DL017-ASGMT-START-DTE.     15920008
159300     MOVE DL007-ECA-KEY-NBR-TXT     TO DL017-ASGMT-NBR-TXT.       15930008
159400     MOVE DL007-ECA-KEY-NBR-SEQ-NBR TO DL017-ASGMT-NBR-SEQ-NBR.   15940008
159500                                                                  15950008
159600     MOVE DLT00004-WK-AREA-DESC  TO DL011-SHIP-DOORGRP-WRK-AREA.  15960008
159700     MOVE DL011-SD-WRK-AREA-DOOR-GROUP TO DL017-DOOR-GP-NBR.      15970008
159800     MOVE DLT00004-DC-NBR        TO DL017-DC-NBR.                 15980008
159900                                                                  15990008
160000**   TRIP IS NOW DETERMINED IN DLKUT006.                          16000008
160100                                                                  16010008
160200     STRING DL007-ECA-KEY-START-DTE                               16020008
160300            '-'                                                   16030008
160400            DLT00004-ASGMT-STRT-TM                                16040008
160500            '.000000'                                             16050008
160600            DELIMITED BY SIZE                                     16060008
160700            INTO DL017-ASGMT-STRT-TMST.                           16070008
160800                                                                  16080008
160900     MOVE PV-CURRENT-TIMESTAMP TO DL017-ASGMT-STOP-TMST.          16090008
161000                                                                  16100008
161100     MOVE DL001-SEQ-START-NBR  TO DL017-BEGIN-DETAIL-SEQ-NBR.     16110008
161200     MOVE PV-DOOR-COUNT        TO DL017-NBR-DOORS.                16120008
161300     MOVE DL007-ORIG-CALLING-PGM-NM TO DL017-USR-ID.              16130008
161400                                                                  16140008
161500     CALL DL017-USER-PGM USING DFHEIBLK                           16150008
161600                               DL017-COMMAREA                     16160008
161700                               DL017-ASGMT-COMMAREA.              16170008
161800                                                                  16180008
161900     IF DL017-SUCCESSFUL                                          16190008
162000        CONTINUE                                                  16200008
162100     ELSE                                                         16210008
162200        SET  DL007-CALLED-MODULE-FAILURE TO TRUE                  16220008
162300        MOVE DL017-USER-PGM        TO DL007-CALL-MOD-FAIL-NM      16230008
162400        MOVE DL017-RETURN-CODE     TO DL007-CALL-MOD-FAIL-ERR-CDE 16240008
162500        MOVE DL017-RETURN-SQLCODES TO DL007-RETURN-SQLCODES       16250008
162600     END-IF.                                                      16260008
162700                                                                  16270008
162800****************************************************************  16280008
162900*                                                              *  16290008
163000*                                                              *  16300008
163100****************************************************************  16310008
163200                                                                  16320008
163300 8400-COUNT-DOORS.                                                16330008
163400                                                                  16340008
163500     MOVE 0 TO PV-DOOR-COUNT.                                     16350008
163600                                                                  16360008
163700     EXEC SQL                                                     16370008
163800           SELECT COUNT(*)                                        16380008
163900                                                                  16390008
164000             INTO :PV-DOOR-COUNT                                  16400008
164100                                                                  16410008
164200             FROM DLT_DOOR_GP       GP                            16420008
164300                 ,DLT_DOOR_GP_TMPL  TMPL                          16430008
164400            WHERE GP.DOOR_GP_NBR     = :DL017-DOOR-GP-NBR         16440008
164500              AND TMPL.DC_NBR        = :DL017-DC-NBR              16450008
164600              AND TMPL.ACTV_IND      = 'Y'                        16460008
164700              AND GP.DOOR_GP_TMPL_ID = TMPL.DOOR_GP_TMPL_ID       16470008
164800                                                                  16480008
164900     END-EXEC.                                                    16490008
165000                                                                  16500008
165100     EVALUATE TRUE                                                16510008
165200         WHEN SQLCODE = ZERO                                      16520008
165300              CONTINUE                                            16530008
165400                                                                  16540008
165500         WHEN SQLCODE = +100                                      16550008
165600              CONTINUE                                            16560008
165700                                                                  16570008
165800         WHEN SQLCODE = -904                                      16580008
165900         WHEN SQLCODE = -913                                      16590008
166000         WHEN SQLCODE = -911                                      16600008
166100                                                                  16610008
166200         WHEN SQLWARN0 NOT = SPACES                               16620008
166300         WHEN SQLCODE NOT = ZERO                                  16630008
166400              SET DL007-SQL-ERROR TO TRUE                         16640008
166500              MOVE SQLCODE        TO DL007-ASGMT-SQLCODE          16650008
166600              MOVE '8400-'        TO DL007-SQL-ERROR-PARA         16660008
166700              MOVE SQLCA          TO DL007-SQLCA                  16670008
166800     END-EVALUATE.                                                16680008
166900****************************************************************  16690008
167000*                                                              *  16700008
167100*                                                              *  16710008
167200****************************************************************  16720008
167300 8500-COUNT-ASSOCIATES.                                           16730008
167400                                                                  16740008
167500     MOVE 0 TO PV-ASSOCIATE-COUNT.                                16750008
167600                                                                  16760008
167700     EXEC SQL                                                     16770008
167800         SELECT COUNT(*)                                          16780008
167900          INTO :PV-ASSOCIATE-COUNT                                16790008
168000                                                                  16800008
168100          FROM  DLT_TEM_ASGMT                                     16810008
168200                                                                  16820008
168300         WHERE  ASGMT_STRT_DTE    = :PV-BUILD-TIMESTAMP-DTE       16830008
168400           AND  ASGMT_NBR_TXT     = :PV-ASGMT-NBR-TXT             16840008
168500           AND  ASGMT_NBR_SEQ_NBR =                               16850008
168600                              :PV-ASGMT-NBR-SEQ-NBR               16860008
168700           AND  LVE_RSN_CDE       = 'T'                           16870008
168800     END-EXEC.                                                    16880008
168900                                                                  16890008
169000     EVALUATE TRUE                                                16900008
169100         WHEN SQLCODE = ZERO                                      16910008
169200              CONTINUE                                            16920008
169300                                                                  16930008
169400         WHEN SQLCODE = +100                                      16940008
169500              CONTINUE                                            16950008
169600                                                                  16960008
169700         WHEN SQLCODE = -904                                      16970008
169800         WHEN SQLCODE = -913                                      16980008
169900         WHEN SQLCODE = -911                                      16990008
170000                                                                  17000008
170100         WHEN SQLWARN0 NOT = SPACES                               17010008
170200         WHEN SQLCODE NOT = ZERO                                  17020008
170300              SET DL007-SQL-ERROR TO TRUE                         17030008
170400              MOVE SQLCODE        TO DL007-ASGMT-SQLCODE          17040008
170500              MOVE '8500-'        TO DL007-SQL-ERROR-PARA         17050008
170600              MOVE SQLCA          TO DL007-SQLCA                  17060008
170700     END-EVALUATE.                                                17070008
170800                                                                  17080008
170900                                                                  17090008
171000******************************************************************17100008
171100*    RESERVE THE SAME NUMBER OF SEQUENCE NUMBERS THAT THERE ARE  *17110008
171200*       NUMBER OF DOORS (PV-DOOR-COUNT).                         *17120008
171300*                                                                *17130008
171400******************************************************************17140008
171500                                                                  17150008
171600 8600-CALL-DLKUP001.                                              17160008
171700                                                                  17170008
171800     INITIALIZE DL001-ASGMT-COMMAREA.                             17180008
171900                                                                  17190008
172000     SET DL001-BY-ASGMT-KEY         TO TRUE.                      17200008
172100     SET DL001-COMMIT-UPDATE        TO TRUE.                      17210008
172200     SET DL001-FIND-NEXT-ASGMT      TO TRUE.                      17220008
172300                                                                  17230008
172400     MOVE PV-ASGMT-STRT-DTE    TO DL001-KEY-START-DTE.            17240008
172500     MOVE PV-ASGMT-NBR-TXT     TO DL001-KEY-NBR-TXT.              17250008
172600     MOVE PV-ASGMT-NBR-SEQ-NBR TO DL001-KEY-NBR-SEQ-NBR.          17260008
172700                                                                  17270008
172800     MOVE PV-DOOR-COUNT TO DL001-NBR-OF-NBRS-NEED-QTY.            17280008
172900     MOVE PC-DLKUP003   TO DL001-ORIG-CALLING-PGM-NM.             17290008
173000                                                                  17300008
173100     CALL DL001-USER-PGM USING DFHEIBLK                           17310008
173200                               DL001-COMMAREA                     17320008
173300                               DL001-ASGMT-COMMAREA.              17330008
173400                                                                  17340008
173500     IF DL001-SUCCESSFUL                                          17350008
173600*       **********************************************************17360008
173700*       *  ASSIGNMENT SENT IN HAS BEEN CLOSED, DLKUP001 HAS SENT *17370008
173800*       *  BACK CURRENT OPEN ASSIGNMENT.                         *17380008
173900*       *                                                        *17390008
174000*       **********************************************************17400008
174100        IF DL001-ASGMT-NEXT-USED                                  17410008
174200           MOVE DL001-NXT-START-DTE TO  DL017-ASGMT-START-DTE     17420008
174300           MOVE DL001-NXT-NBR-TXT   TO  DL017-ASGMT-NBR-TXT       17430008
174400           MOVE DL001-NXT-NBR-SEQ-NBR TO                          17440008
174500                              DL017-ASGMT-NBR-SEQ-NBR             17450008
174600**??    ELSE                                                      17460008
174700**??       MOVE DL001-SEQ-START-NBR TO                            17470008
174800**??                          DL017-ASGMT-NBR-SEQ-NBR             17480008
174900        END-IF                                                    17490008
175000                                                                  17500008
175100     ELSE                                                         17510008
175200        SET DL007-CALLED-MODULE-FAILURE TO TRUE                   17520008
175300        MOVE DL001-CALL-MOD-FAIL-NM TO                            17530008
175400                            DL007-CALL-MOD-FAIL-NM                17540008
175500        MOVE DL001-CALL-MOD-FAIL-ERR-CDE TO                       17550008
175600                            DL007-CALL-MOD-FAIL-ERR-CDE           17560008
175700                                                                  17570008
175800     END-IF.                                                      17580008
175900                                                                  17590008
176000******************************************************************17600008
176100*                                                                *17610008
176200******************************************************************17620008
176300 9000-SYNCPOINT.                                                  17630008
176400                                                                  17640008
176500     EXEC CICS                                                    17650008
176600          SYNCPOINT                                               17660008
176700     END-EXEC.                                                    17670008
176800                                                                  17680008
176900****************************************************************  17690008
177000*                                                              *  17700008
177100*                                                              *  17710008
177200****************************************************************  17720008
177300                                                                  17730008
177400 9400-GET-TIMESTAMP.                                              17740008
177500                                                                  17750008
177600     EXEC SQL                                                     17760008
177700          SET  :PV-CURRENT-TIMESTAMP   =  CURRENT_TIMESTAMP       17770008
177800              ,:PV-CURRENT-TIME        =  CURRENT_TIME            17780008
177900              ,:PV-CURRENT-DATE        =  CURRENT_DATE            17790008
178000     END-EXEC.                                                    17800008
