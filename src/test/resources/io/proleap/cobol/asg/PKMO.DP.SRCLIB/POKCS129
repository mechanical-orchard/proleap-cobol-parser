000100*-----------------------*                                         00010099
000200 IDENTIFICATION DIVISION.                                         00020099
000300*-----------------------*                                         00030099
000400 PROGRAM-ID.    POKCS129.                                         00040099
000500 AUTHOR.        GEORGE HERIDES.                                   00050099
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060099
000700 DATE-WRITTEN.  04-06-06.                                         00070099
000800 DATE-COMPILED.                                                   00080099
000900                                                                  00090099
001000*---------------------------------------------------------------* 00100099
001100*    W129 - PO LINE - DC SUMMARY 2                              * 00110099
001200*                                                               * 00120099
001300*    DISPLAYS A SUMMARY OF PO LINES AND THEIR ASSOCIATED        * 00130099
001400*    ORDER AND RECEIPT QUANTITIES BY DC.                        * 00140099
001500*                                                               * 00150099
001600*---------------------------------------------------------------* 00160099
001601***************************************************************** 00160199
C98147*CHANGE LOG:                                                      00160299
C98147* DATE  21/11/2014                                              * 00160399
C98147*       CHANGE MADE: PO EXTENDED DIGIT CHANGES.                 * 00160499
C98147*       EXTENDED PO# FROM 7 TO 8 IN MAP POKCS129.               * 00160599
C98147*      MADE BY: COGNIZANT              WR/IR: CHG0098147        * 00160699
001604***************************************************************** 00160899
076319* DATE  10/27/2021                                                00160999
076320*            - CHANGE CALL OF 'DPKUT100' TO                     * 00161099
076321*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00161199
076322*              MAKING THE CALL DYNAMIC VS STATIC                * 00161299
076323*     MADE BY: GERMAN BANDA            WR/IR #: CHG0263126        00161399
076312*                                                               * 00161499
076318*---------------------------------------------------------------* 00161599
CICS  *  CHANGED 11/16/2022    BY BARB SCHULTZ    WR: CHG0278485        00161699
CICS  *                                                               * 00161799
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00161899
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00161999
076318*---------------------------------------------------------------* 00162299
001605                                                                  00162399
001606 EJECT                                                            00162499
001607 ENVIRONMENT DIVISION.                                            00162599
001608                                                                  00162699
001609 DATA DIVISION.                                                   00162799
001610                                                                  00162899
001620 WORKING-STORAGE SECTION.                                         00162999
001621                                                                  00163099
001622 01  DK-DB2-KEYS.                                                 00163199
001623     15  DK-PO-NUMBER                   PIC S9(09)  VALUE ZERO    00163299
001624                                                    COMP.         00163399
001625     05  DK-PO-LNE-NBR                  PIC S9(9)   COMP VALUE +0.00163499
001626                                                                  00163599
001627     05  DK-LAST-DC                     PIC S9(4)   COMP VALUE +0.00163699
001628                                                                  00163799
001629 01  PC-PROGRAM-CONSTANTS.                                        00163899
001630     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00163999
001640                                                    'PO129A  '.   00164099
001650     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00165099
001660                                                    'POKM129 '.   00166099
001670     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00167099
001680                                                    'POKCS129'.   00168099
001690     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00169099
001700     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00170099
001800     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00180099
001900     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +07     00190099
002000                                                    COMP SYNC.    00200099
002100     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00210099
002200                                                    COMP SYNC.    00220099
002300     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00230099
002400                                                    +1000000      00240099
002500                                                    COMP-3.       00250099
002600     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00260099
002700                                                    COMP SYNC.    00270099
002800     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00280099
002900                                                    COMP-3.       00290099
003000     05  PC-PCT                         PIC  X(01)  VALUE '%'.    00300099
003100     05  PC-DCX                         PIC S9(04)  COMP.         00310099
003200     05  PC-HEADA                       PIC X(17) VALUE           00320099
003300        '   QTY   QTY  PCT'.                                      00330099
003400                                                                  00340099
003500                                                                  00350099
003600     05  PC-DC1-HEAD                    PIC X(59).                00360099
003700     05  FILLER REDEFINES PC-DC1-HEAD.                            00370099
003800         10  PC-DC1-HEADA               PIC X(17).                00380099
003900         10  FILLER                     PIC X(02).                00390099
004000         10  PC-DC1-HEADB               PIC X(5).                 00400099
004100         10  FILLER                     PIC X(02).                00410099
004200         10  PC-DC1-HEADC               PIC X(5).                 00420099
004300         10  FILLER                     PIC X(02).                00430099
004400         10  PC-DC1-HEADD               PIC X(5).                 00440099
004500         10  FILLER                     PIC X(02).                00450099
004600         10  PC-DC1-HEADE               PIC X(5).                 00460099
004700         10  FILLER                     PIC X(02).                00470099
004800         10  PC-DC1-HEADF               PIC X(5).                 00480099
004900         10  FILLER                     PIC X(02).                00490099
005000         10  PC-DC1-HEADG               PIC X(5).                 00500099
005100                                                                  00510099
005110     05  PC-HEADB                       PIC X(17) VALUE           00511099
005120        '   ORD   REC  REC'.                                      00512099
005121     05  PC-HEAD-DC1                    PIC X(14) VALUE           00512199
005122        '    ORD   RECV'.                                         00512299
005123     05  PC-HEAD-DC2                    PIC X(14) VALUE           00512399
005124        '    ORD   RECV'.                                         00512499
005125     05  PC-HEAD-DC3                    PIC X(14) VALUE           00512599
005126        '    ORD   RECV'.                                         00512699
005127                                                                  00512799
005128     05  PC-DC1-HEAD2                   PIC X(59).                00512899
005129     05  FILLER REDEFINES PC-DC1-HEAD2.                           00512999
005130         10  PC-HEAD-NAMEB                  PIC X(17).            00513099
005140         10  PC-HEAD-DC10                   PIC X(14).            00514099
005141         10  PC-HEAD-DC20                   PIC X(14).            00514199
005142         10  PC-HEAD-DC30                   PIC X(14).            00514299
005143                                                                  00514399
005144     05  PC-QTY-HEAD                   PIC X(50)   VALUE          00514499
005145       '                                  QTY    QTY   PCT'.      00514599
005146     05  PC-QTY-HEAD2                  PIC X(50)   VALUE          00514699
005147       '     DESCRIPTION           STS    ORD    REC   REC'.      00514799
005148*                                                                 00514899
005149     05  PC-TSYMSG-NUMBERS.                                       00514999
005150         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00515099
005151         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00515199
005152         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00515299
005153         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00515399
005154         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00515499
005155         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00515599
005156         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00515699
005157         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00515799
005158         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00515899
005159         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00515999
005160         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00516099
005170         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00517099
005180         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00518099
005190         10  PC-TSYMSG-00994            PIC  9(05)  VALUE 00994.  00519099
005200         10  PC-TSYMSG-00227            PIC  9(05)  VALUE 00227.  00520099
005300         10  PC-TSYMSG-00228            PIC  9(05)  VALUE 00228.  00530099
005400         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00540099
005500         10  PC-TSYMSG-03487            PIC  9(05)  VALUE 03487.  00550099
005600*                                                                 00560099
005700 01  PS-PROGRAM-SWITCHES.                                         00570099
005800     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00580099
005900         88  PS-NO-ERROR                            VALUE 'Y'.    00590099
006000         88  PS-ERROR                               VALUE 'N'.    00600099
006100     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00610099
006200         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00620099
006300         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00630099
006400     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    00640099
006500         88  PS-DONE                                VALUE 'Y'.    00650099
006600         88  PS-NOT-DONE                            VALUE 'N'.    00660099
006700     05  PS-END-OF-DC-SW                PIC  X(01)  VALUE 'N'.    00670099
006800         88  PS-END-OF-DC                           VALUE 'Y'.    00680099
006900         88  PS-NOT-END-OF-DC                       VALUE 'N'.    00690099
007000     05  PS-TABLE-OVERFLOW-SW           PIC  X(01)  VALUE 'N'.    00700099
007100         88  PS-TABLE-OVERFLOW                      VALUE 'Y'.    00710099
007200         88  PS-NOT-TABLE-OVERFLOW                  VALUE 'N'.    00720099
007300*                                                                 00730099
007400 01  PV-PROGRAM-VARIABLES.                                        00740099
007500                                                                  00750099
007600     05  PV-DC-COUNT                    PIC S9(09)  VALUE +0      00760099
007700                                                    COMP-3.       00770099
007800     05  PV-DC-REC-DATE                 PIC X(10).                00780099
007900     05  PV-ALLOC-DATE                  PIC X(10).                00790099
007901                                                                  00790199
007902     05  PV-DISP-PO                     PIC Z(9).                 00790299
007910                                                                  00791099
007920    05  PV-NORMAL-TOTALS.                                         00792099
007930        10  FILLER                         PIC X(31).             00793099
007940        10  PV-TOT-ORD                     PIC ZZZZZ9.            00794099
007950        10  FILLER                         PIC X(01).             00795099
007960        10  PV-TOT-REC                     PIC ZZZZZ9.            00796099
007970        10  FILLER                         PIC X(03).             00797099
007980        10  PV-TOTRECPCT-X.                                       00798099
007990           15 PV-TREC-PCT                  PIC  ZZ9.              00799099
008000           15 PV-TREC-PCT-SIGN             PIC  X(01).            00800099
008001        10  FILLER                         PIC X(08).             00800199
008002                                                                  00800299
008003    05  PV-DC-TOTALS.                                             00800399
008004        10  PV-TOT-ORD2                    PIC ZZZZZ9.            00800499
008005        10  PV-TOT-REC2                    PIC ZZZZZ9.            00800599
008006        10  FILLER                         PIC X(02).             00800699
008007        10  PV-TOTRECPCT2-X.                                      00800799
008008           15 PV-TREC-PCT2                 PIC  ZZ9.              00800899
008009           15 PV-TREC-PCT-SIGN2            PIC  X(01).            00800999
008010        10  PV-TOT-DC1-ORD                 PIC ZZZZZZ.            00801099
008011        10  FILLER                         PIC X(01).             00801199
008012        10  PV-TOT-DC1-REC                 PIC ZZZZZZ.            00801299
008013        10  FILLER                         PIC X(01).             00801399
008014        10  PV-TOT-DC2-ORD                 PIC ZZZZZZ.            00801499
008015        10  FILLER                         PIC X(01).             00801599
008016        10  PV-TOT-DC2-REC                 PIC ZZZZZZ.            00801699
008017        10  FILLER                         PIC X(01).             00801799
008018        10  PV-TOT-DC3-ORD                 PIC ZZZZZZ.            00801899
008019        10  FILLER                         PIC X(01).             00801999
008020        10  PV-TOT-DC3-REC                 PIC ZZZZZZ.            00802099
008021                                                                  00802199
008022    05  PV-NORMAL-LINE.                                           00802299
008023     10  FILLER                         PIC  X(02).               00802399
008024     10  PV-DESC                        PIC  X(22).               00802499
008025     10  FILLER                         PIC  X(03).               00802599
008026                                                                  00802699
008027     10  PV-STATUS                      PIC  X(02).               00802799
008028     10  FILLER                         PIC  X(02).               00802899
008029                                                                  00802999
008030     10  PV-QTY-X.                                                00803099
008031         20 PV-QTY                      PIC  ZZZZZZ.              00803199
008032     10  FILLER                         PIC  X(01).               00803299
008033                                                                  00803399
008034     10  PV-REC-QTY-X.                                            00803499
008035         20 PV-REC-QTY                  PIC  ZZZZZZ.              00803599
008036     10  FILLER                         PIC  X(03).               00803699
008037                                                                  00803799
008038     10  PV-RECPCT-X.                                             00803899
008039         20 PV-REC-PCT                  PIC  ZZZ.                 00803999
008040         20 PV-REC-PCT-SIGN             PIC  X(01).               00804099
008041                                                                  00804199
008042 05  PV-DC1-LINE.                                                 00804299
008043     10  PV-QTY-DC-X.                                             00804399
008044         15 PV-QTY-DC                   PIC  ZZZZZZ.              00804499
008045                                                                  00804599
008046     10  PV-REC-QTY-DC-X.                                         00804699
008047         15 PV-REC-QTY-DC               PIC  ZZZZZZ.              00804799
008048     10  FILLER                         PIC  X(02).               00804899
008049                                                                  00804999
008050     10  PV-RECPCT-DC-X.                                          00805099
008051         15 PV-REC-PCT-DC               PIC  ZZZ.                 00805199
008052         15 PV-REC-PCT-SIGN-DC          PIC  X(01).               00805299
008053                                                                  00805399
008054     10  PV-DC1-X.                                                00805499
008055         15 PV-DC1                      PIC ZZZZZZ.               00805599
008056     10  FILLER                         PIC  X(01).               00805699
008057     10  PV-REC-DC1-X.                                            00805799
008058         15  PV-REC-DC1                 PIC ZZZZZZ.               00805899
008059     10  FILLER                         PIC  X(01).               00805999
008060     10  PV-DC2-X.                                                00806099
008061         15  PV-DC2                     PIC ZZZZZZ.               00806199
008062     10  FILLER                         PIC  X(01).               00806299
008063     10  PV-REC-DC2-X.                                            00806399
008064         15  PV-REC-DC2                 PIC ZZZZZZ.               00806499
008065     10  FILLER                         PIC  X(01).               00806599
008066     10  PV-DC3-X.                                                00806699
008067         15  PV-DC3                     PIC ZZZZZZ.               00806799
008068     10  FILLER                         PIC  X(01).               00806899
008069     10  PV-REC-DC3-X.                                            00806999
008070         15  PV-REC-DC3                 PIC ZZZZZZ.               00807099
008071     10  PV-STATUS-DC                    PIC  X(02).              00807199
008072                                                                  00807299
008073                                                                  00807399
008074     05  PV-HIT-SW                      PIC X(01)   VALUE 'N'.    00807499
008075     05  PV-SUB                         PIC S9(04)  VALUE +0      00807599
008076                                                    COMP SYNC.    00807699
008077     05  PV-DETERMINE-CNT               PIC S9(04)  VALUE +0      00807799
008078                                                    COMP SYNC.    00807899
008079     05  PV-DETERMINE-CNT1              PIC S9(04)  VALUE +0      00807999
008080                                                    COMP SYNC.    00808099
008081     05  PV-DETERMINE-CNTA              PIC S9(04)  VALUE +0      00808199
008082                                                    COMP SYNC.    00808299
008083     05  PV-DETERMINE-CNTB              PIC S9(04)  VALUE +0      00808399
008084                                                    COMP SYNC.    00808499
008085     05  PV-TEST-CNT                    PIC S9(04)  VALUE +0      00808599
008086                                                    COMP SYNC.    00808699
008087     05  PV-DETERMINE-ITEM              PIC S9(04)  VALUE +0      00808799
008088                                                    COMP SYNC.    00808899
008089     05  PV-DETERMINE-ITEM1             PIC S9(04)  VALUE +0      00808999
008090                                                    COMP SYNC.    00809099
008091     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00809199
008092                                                    COMP SYNC.    00809299
008093     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00809399
008094                                                    COMP-3.       00809499
008095     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      00809599
008096                                                    COMP-3.       00809699
008097     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      00809799
008098                                                    COMP-3.       00809899
008099     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      00809999
008100                                                    COMP-3.       00810099
008200     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      00820099
008300                                                    COMP-3.       00830099
008400     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      00840099
008500                                                    COMP-3.       00850099
008600     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      00860099
008700                                                    COMP-3.       00870099
008800     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      00880099
008900                                                    COMP SYNC.    00890099
009000     05  PV-BLOCK-NUMBER-1              PIC S9(04)  VALUE +0      00900099
009100                                                    COMP SYNC.    00910099
009200     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      00920099
009300                                                    COMP SYNC.    00930099
009400     05  PV-ITEM                        PIC S9(04)  VALUE +0      00940099
009500                                                    COMP SYNC.    00950099
009600     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      00960099
009700                                                    COMP SYNC.    00970099
009800     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      00980099
009900                                                    COMP SYNC.    00990099
010000     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01000099
010100                                                    COMP SYNC.    01010099
010200     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01020099
010300                                                    COMP SYNC.    01030099
010400     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01040099
010500                                                    COMP SYNC.    01050099
010600     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01060099
010700                                                    COMP SYNC.    01070099
010800     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01080099
010900                                                    COMP SYNC.    01090099
011000     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01100099
011100                                                    COMP SYNC.    01110099
011200     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01120099
011300                                                    COMP SYNC.    01130099
011400     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01140099
011500                                                    COMP SYNC.    01150099
011600     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01160099
011700                                                    COMP SYNC.    01170099
011800     05  PV-DB2-COUNT                   PIC S9(09)  VALUE +0      01180099
011900                                                    COMP-3.       01190099
012000     05  PV-DC-SPLIT-QTY                PIC S9(09)  VALUE +0      01200099
012100                                                    COMP.         01210099
012200     05  PV-DC-REC-QTY                  PIC S9(09)  VALUE +0      01220099
012300                                                    COMP.         01230099
012400     05  PV-DC-ORD-QTY                  PIC S9(09)  VALUE +0      01240099
012500                                                    COMP.         01250099
012600     05  PV-TOT-REC-QTY                 PIC S9(09)  VALUE +0      01260099
012700                                                    COMP.         01270099
012800     05  PV-QTY-NULL                    PIC S9(04)  VALUE +0      01280099
012900                                                    COMP.         01290099
013000     05  PV-TOT-REC-PCT                 PIC  S9(03)V99            01300099
013100                                                   COMP-3.        01310099
013200     05  PV-END-QTY-ORD                 PIC 9(06)  VALUE ZERO.    01320099
013300     05  PV-END-QTY-REC                 PIC 9(06)  VALUE ZERO.    01330099
013400     05  PV-NULL-INDICATORS.                                      01340099
013500         10 PV-MAJ-CL-NBR-IND           PIC S9(04) VALUE +0       01350099
013600                                                   COMP.          01360099
013700         10 PV-SUB-CL-NBR-IND           PIC S9(04) VALUE +0       01370099
013800                                                   COMP.          01380099
013900         10 PV-SKU-NBR-IND              PIC S9(04) VALUE +0       01390099
014000                                                   COMP.          01400099
014100         10 PV-SKU-DESC-IND             PIC S9(04) VALUE +0       01410099
014110                                                   COMP.          01411099
014120     05  PV-TEMP-SKU.                                             01412099
014130         10 PV-TEMP-SKU-DEPT            PIC 9(03)  VALUE 0.       01413099
014140         10 PV-TEMP-SKU-CLASS           PIC 9(02)  VALUE 0.       01414099
014150         10 PV-TEMP-SKU-SEQ             PIC 9(03)  VALUE 0.       01415099
014160     05  PV-SKU-NBR REDEFINES PV-TEMP-SKU                         01416099
014170                                        PIC 9(08).                01417099
014180     05  PV-MAJ-CL.                                               01418099
014190         10 PV-MAJ-CL-1                 PIC 9      VALUE 0.       01419099
014191         10 FILLER                      PIC 9      VALUE 0.       01419199
014192     05  PV-MAJ-CLASS REDEFINES PV-MAJ-CL                         01419299
014193                                        PIC 9(02).                01419399
014194******************************************************************01419499
014195**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01419599
014196**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01419699
014197**  APPLICATION-SPECIFIC COMMAREA.                              **01419799
014198******************************************************************01419899
014199 01  LQW-LIST-QUEUE-WORK-AREA.                                    01419999
014200     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01420099
014300     05  LQW-ITEM-ENTRIES               OCCURS 10 TIMES           01430099
014400                                        INDEXED BY LQW-IDX.       01440099
014500         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01450099
014600         10  LQW-LINE                   PIC  9(03).               01460099
014700         10  LQW-MCL                    PIC  9(02).               01470099
014800         10  LQW-SCL                    PIC  9(02).               01480099
014900         10  LQW-SKU                    PIC  9(08).               01490099
015000         10  LQW-DESC                   PIC  X(20).               01500099
015100         10  LQW-QTY                    PIC  9(06).               01510099
015200         10  LQW-STATUS                 PIC  X(02).               01520099
015300         10  LQW-REC-QTY                PIC  9(06).               01530099
015400         10  LQW-REC-PCT                PIC  S9(3)V99 COMP-3.     01540099
015500         10  LQW-DC                     PIC  9(06).               01550099
015600         10  LQW-REC-DC                 PIC  9(06).               01560099
015700                                                                  01570099
015800     EJECT                                                        01580099
015900                                                                  01590099
016000*---------------------------------------------------------------* 01600099
016100*  RECORD LAYOUT FOR THE MESSAGE SELECTION TEMP STORAGE QUEUE.  * 01610099
016200*---------------------------------------------------------------* 01620099
016300                                                                  01630099
016310     COPY DPWS057.                                                01631099
016320                                                                  01632099
016330     EJECT                                                        01633099
016340*---------------------------------------------------------------* 01634099
016350*    MAP LAYOUT                                                 * 01635099
016360*---------------------------------------------------------------* 01636099
016370                                                                  01637099
016380     COPY POKM129.                                                01638099
016390*                                                                 01639099
016400 01  MR-OCCURS-LAYOUT                   REDEFINES  PO129AO.       01640099
C98147     05  FILLER                         PIC X(104).               01650099
016600                                                                  01660099
016700     05  MR-HEAD1L             PIC S9(04) COMP.                   01670099
016800     05  MR-HEAD1A             PIC  X(01).                        01680099
016900     05  MR-HEAD1C             PIC  X(01).                        01690099
017000     05  MR-HEAD1H             PIC  X(01).                        01700099
017100     05  MR-HEAD1              PIC  X(59).                        01710099
017200                                                                  01720099
017300     05  MR-HEAD2L             PIC S9(04) COMP.                   01730099
017301     05  MR-HEAD2A             PIC  X(01).                        01730199
017302     05  MR-HEAD2C             PIC  X(01).                        01730299
017303     05  MR-HEAD2H             PIC  X(01).                        01730399
017304     05  MR-HEAD2              PIC  X(59).                        01730499
017305                                                                  01730599
017306     05  MR-SCROLL-AREA                 OCCURS 10 TIMES.          01730699
017307                                                                  01730799
017308         10  MR-LINEL                   PIC S9(04) COMP.          01730899
017309         10  MR-LINEA                   PIC  X(01).               01730999
017310         10  MR-LINEC                   PIC  X(01).               01731099
017311         10  MR-LINEH                   PIC  X(01).               01731199
017312         10  MR-LINE-X.                                           01731299
017313             15 MR-LINE                 PIC ZZZ.                  01731399
017314                                                                  01731499
017315         10  MR-MCLL                    PIC S9(04) COMP.          01731599
017316         10  MR-MCLA                    PIC  X(01).               01731699
017317         10  MR-MCLC                    PIC  X(01).               01731799
017318         10  MR-MCLH                    PIC  X(01).               01731899
017319         10  MR-MCL                     PIC  X(02).               01731999
017320                                                                  01732099
017330         10  MR-SCLL                    PIC S9(04) COMP.          01733099
017340         10  MR-SCLA                    PIC  X(01).               01734099
017350         10  MR-SCLC                    PIC  X(01).               01735099
017360         10  MR-SCLH                    PIC  X(01).               01736099
017370         10  MR-SCL                     PIC  X(02).               01737099
017380*                                                                 01738099
017390         10  MR-SKU-NBRL                PIC S9(04) COMP.          01739099
017400         10  MR-SKU-NBRA                PIC  X(01).               01740099
017500         10  MR-SKU-NBRC                PIC  X(01).               01750099
017600         10  MR-SKU-NBRH                PIC  X(01).               01760099
017700         10  MR-SKU-NBR                 PIC  X(08).               01770099
017800                                                                  01780099
017900         10  MR-LINE-AREAL              PIC S9(04) COMP.          01790099
018000         10  MR-LINE-AREAA              PIC  X(01).               01800099
018100         10  MR-LINE-AREAC              PIC  X(01).               01810099
018200         10  MR-LINE-AREAH              PIC  X(01).               01820099
018300         10  MR-LINE-AREA               PIC  X(59).               01830099
018400                                                                  01840099
018500     05  MR-TOTAL-LINEL             PIC S9(04) COMP.              01850099
018600     05  MR-TOTAL-LINEA             PIC  X(01).                   01860099
018700     05  MR-TOTAL-LINEC             PIC  X(01).                   01870099
018800     05  MR-TOTAL-LINEH             PIC  X(01).                   01880099
018900     05  MR-TOTAL-LINE              PIC  X(59).                   01890099
019000                                                                  01900099
019100     EJECT                                                        01910099
019200*---------------------------------------------------------------* 01920099
019300*    ATTRIBUTE SETTINGS COPYBOOK.                               * 01930099
019400*---------------------------------------------------------------* 01940099
019500                                                                  01950099
019600     COPY DPWS015.                                                01960099
019700                                                                  01970099
019800*---------------------------------------------------------------* 01980099
019900*    FUNCTION KEYS COPYBOOK.                                    * 01990099
020000*---------------------------------------------------------------* 02000099
020100                                                                  02010099
020200     COPY DPWS016.                                                02020099
020300                                                                  02030099
020400*---------------------------------------------------------------* 02040099
020500*    NUMERIC EDIT LAYOUT.                                       * 02050099
020600*---------------------------------------------------------------* 02060099
020700                                                                  02070099
020800     COPY DPWS010I.                                               02080099
020900 EJECT                                                            02090099
021000*---------------------------------------------------------------* 02100099
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02110099
021200*---------------------------------------------------------------* 02120099
021300                                                                  02130099
021400     COPY DPWS030.                                                02140099
CICS       COPY DPWS930.                                                02141099
021500 EJECT                                                            02150099
021600*---------------------------------------------------------------* 02160099
021700*    STANDARD COMMAREA.                                         * 02170099
021800*---------------------------------------------------------------* 02180099
021900                                                                  02190099
022000     COPY DPWS020.                                                02200099
022100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02210099
022200                                                                  02220099
022300*---------------------------------------------------------------* 02230099
022400* INTER-APPLICATION COMMAREA.                                   * 02240099
022500*---------------------------------------------------------------* 02250099
022600                                                                  02260099
022700         10  INTER-APPL-COMM-AREA       PIC X(200).               02270099
022800     COPY POWS011.                                                02280099
022900*---------------------------------------------------------------* 02290099
023000*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02300099
023100*---------------------------------------------------------------* 02310099
023200         10  ASC-SPECIFIC-COMMAREA.                               02320099
023300             15  ASC-LIST-KEYS.                                   02330099
023400                 20  ASC-KEY-PO-NUMBER               PIC S9(09)   02340099
023500                                                     COMP.        02350099
023600                 20  ASC-KEY-DEPT                    PIC X(03).   02360099
023700                 20  ASC-KEY-VENDOR                  PIC X(30).   02370099
023800                 20  ASC-TOT-ORD                     PIC S9(09)   02380099
023900                                                         COMP-3.  02390099
024000                 20  ASC-TOT-REC                     PIC S9(09)   02400099
024100                                                         COMP-3.  02410099
024200                 20  ASC-TOT-PCT                     PIC X(4).    02420099
024300                 20  FILLER REDEFINES ASC-TOT-PCT.                02430099
024400                     25  ASC-TOT-PCT-N               PIC  9(03).  02440099
024500                     25  ASC-TOT-PCT-SIGN            PIC  X(01).  02450099
024600                                                                  02460099
024700             15  ASC-DC-ORD OCCURS 10 TIMES.                      02470099
024800                 20  ASC-TOT-DC-ORD          PIC S9(09) COMP-3.   02480099
024900             15  ASC-DC-REC OCCURS 10 TIMES.                      02490099
025000                 20  ASC-TOT-DC-REC          PIC S9(09) COMP-3.   02500099
025100                                                                  02510099
025200* IF NUMBER OF DC'S INCREASES JUST CHANGE CODE THAT RUNS WHEN     02520099
025300*   PF24 IS HIT.                                                  02530099
025400            15  ASC-DC-TABLE OCCURS 10 TIMES.                     02540099
025500                20 ASC-DC-NBR                    PIC S9(4)        02550099
025600                                                 COMP SYNC.       02560099
025700                20 ASC-DC-NAME                   PIC X(5).        02570099
025800                                                                  02580099
025900             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02590099
026000                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  02600099
026100                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   02610099
026200                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   02620099
026300                                                                  02630099
026400                 20  ASC-ITEM-ARRAY.                              02640099
026500                     25  ASC-ITEM-ENTRIES OCCURS 07 TIMES.        02650099
026600                         30  ASC-LIST-ITEM-NUMBER                 02660099
026700                                          PIC S9(09) COMP-3.      02670099
026800                         30  ASC-LINE                PIC  9(03).  02680099
026900                         30  ASC-MCL                 PIC  9(02).  02690099
027000                         30  ASC-SCL                 PIC  9(02).  02700099
027100                         30  ASC-SKU                 PIC  9(08).  02710099
027200                         30  ASC-DESC                PIC  X(20).  02720099
027300                         30  ASC-QTY                 PIC  9(06).  02730099
027400                         30  ASC-STATUS              PIC  X(02).  02740099
027500                         30  ASC-REC-QTY             PIC  9(06).  02750099
027600                         30  ASC-REC-PCT             PIC S9(03)V9902760099
027700                                                         COMP-3.  02770099
027800                     30 ASC-DC-ARRAY.                             02780099
027900                         35  ASC-DC-QTY OCCURS 10 TIMES.          02790099
028000                           40  ASC-DC                  PIC  9(06).02800099
028100                           40  ASC-REC-DC              PIC  9(06).02810099
028200                                                                  02820099
028300             15  ASC-BLK-SUB                         PIC S9(04)   02830099
028400                                                          COMP    02840099
028500                                                          SYNC.   02850099
028600             15  ASC-ITEM-SUB                        PIC S9(04)   02860099
028700                                                          COMP    02870099
028800                                                          SYNC.   02880099
028900             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   02890099
029000                                                          COMP-3. 02900099
029100             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   02910099
029200                                                          COMP-3. 02920099
029300             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   02930099
029400                                                          COMP    02940099
029500                                                          SYNC.   02950099
029600             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   02960099
029700                                                          COMP-3. 02970099
029800             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   02980099
029900                                                          COMP-3. 02990099
030000             15  ASC-DC-END-SW                       PIC  X(01).  03000099
030100                 88  ASC-DC-END                      VALUE 'Y'.   03010099
030200                 88  ASC-NOT-DC-END                  VALUE 'N'.   03020099
030300             15  ASC-DISPLAY-SW                      PIC X(01).   03030099
030400                 88  ASC-DISPLAY-QTY                 VALUE 'Q'.   03040099
030500                 88  ASC-DISPLAY-DC                  VALUE 'F'.   03050099
030600             15  ASC-NEXT-DC-SW                      PIC X(01).   03060099
030700                 88  ASC-MORE-DC                     VALUE 'Q'.   03070099
030800                 88  ASC-NO-MORE-DC                  VALUE 'F'.   03080099
030900             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03090099
031000                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03100099
031100                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03110099
031200             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03120099
031300                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03130099
031400                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03140099
031500             15  ASC-LIST-QUEUE-NAME.                             03150099
031600                 20  ASC-LIST-TERM-ID                PIC  X(04).  03160099
031700                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03170099
031800                                                          COMP-3. 03180099
031900                 20  ASC-LIST-SEQ                    PIC  9(01).  03190099
032000             15  ASC-SEL-QUEUE-NAME.                              03200099
032100                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03210099
032200                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03220099
032300                                                          COMP-3. 03230099
032400                 20  ASC-SEL-SEQ                     PIC  9(01).  03240099
032500                 20  ASC-DC-COUNTER        PIC S9(09) COMP.       03250099
032600                 20  ASC-DC-COUNTER-DC     PIC S9(04) COMP.       03260099
032700                                                                  03270099
032800             15  ASC-START-ITEM-REQUEST.                          03280099
032900                 20  ASC-START-ITEM-REQUEST-N        PIC  9(07).  03290099
033000         10  FILLER                                  PIC  X(96).  03300099
033100                                                                  03310099
033200     EJECT                                                        03320099
033300*---------------------------------------------------------------* 03330099
033400*    ABEND PROCESSING COPYBOOK.                                 * 03340099
033500*---------------------------------------------------------------* 03350099
033600                                                                  03360099
033700     COPY DPWS013.                                                03370099
033800                                                                  03380099
033900 EJECT                                                            03390099
034000*---------------------------------------------------------------* 03400099
034100*    DB2 AREA FOR TPURCHS                                       * 03410099
034200*---------------------------------------------------------------* 03420099
034300     EXEC SQL                                                     03430099
034400          INCLUDE TPURCHS                                         03440099
034500     END-EXEC.                                                    03450099
034600*---------------------------------------------------------------* 03460099
034700*    DB2 AREA FOR TPURITM                                       * 03470099
034800*---------------------------------------------------------------* 03480099
034900     EXEC SQL                                                     03490099
035000          INCLUDE TPURITM                                         03500099
035100     END-EXEC.                                                    03510099
035200*---------------------------------------------------------------* 03520099
035300*    DB2 AREA FOR TALLPLN                                       * 03530099
035400*---------------------------------------------------------------* 03540099
035500     EXEC SQL                                                     03550099
035600          INCLUDE TALLPLN                                         03560099
035700     END-EXEC.                                                    03570099
035800*---------------------------------------------------------------* 03580099
035900*    DB2 AREA FOR TENTNME                                       * 03590099
036000*---------------------------------------------------------------* 03600099
036100     EXEC SQL                                                     03610099
036200          INCLUDE TENTNME                                         03620099
036300     END-EXEC.                                                    03630099
036400*---------------------------------------------------------------* 03640099
036500*    DB2 AREA FOR TRECITM                                       * 03650099
036600*---------------------------------------------------------------* 03660099
036700     EXEC SQL                                                     03670099
036800          INCLUDE TRECITM                                         03680099
036900     END-EXEC.                                                    03690099
037000*---------------------------------------------------------------* 03700099
037100*    DB2 AREA FOR TRECDIS                                       * 03710099
037200*---------------------------------------------------------------* 03720099
037300     EXEC SQL                                                     03730099
037400          INCLUDE TRECDIS                                         03740099
037500     END-EXEC.                                                    03750099
037600*---------------------------------------------------------------* 03760099
037700*    DB2 AREA FOR LOCATION                                      * 03770099
037800*---------------------------------------------------------------* 03780099
037900     EXEC SQL                                                     03790099
038000          INCLUDE XMT00001                                        03800099
038100     END-EXEC.                                                    03810099
038200                                                                  03820099
038300*---------------------------------------------------------------* 03830099
038400*    DB2 AREA FOR DC LOCATION ASSIGNMENT                        * 03840099
038500*---------------------------------------------------------------* 03850099
038600     EXEC SQL                                                     03860099
038700          INCLUDE XMT00002                                        03870099
038800     END-EXEC.                                                    03880099
038900*---------------------------------------------------------------* 03890099
039000*    DB2 AREA FOR TPLNSHP                                       * 03900099
039100*---------------------------------------------------------------* 03910099
039200     EXEC SQL                                                     03920099
039300          INCLUDE TPLNSHP                                         03930099
039400     END-EXEC.                                                    03940099
039500*---------------------------------------------------------------* 03950099
039600*    DB2 AREA FOR XLT_SKU TABLE                                   03960099
039700*---------------------------------------------------------------* 03970099
039800                                                                  03980099
039900     EXEC SQL                                                     03990099
040000         INCLUDE XLT00003                                         04000099
040100     END-EXEC.                                                    04010099
040200*---------------------------------------------------------------* 04020099
040300*    DB2 AREA FOR XLT_VND_STYL TABLE                              04030099
040400*---------------------------------------------------------------* 04040099
040500                                                                  04050099
040510     EXEC SQL                                                     04051099
040520         INCLUDE XLT00004                                         04052099
040530     END-EXEC.                                                    04053099
040540*---------------------------------------------------------------* 04054099
040550*    DB2 AREA FOR TUPCPLS                                         04055099
040560*---------------------------------------------------------------* 04056099
040570                                                                  04057099
040580     EXEC SQL                                                     04058099
040590         INCLUDE TUPCPLS                                          04059099
040591     END-EXEC.                                                    04059199
040592*---------------------------------------------------------------* 04059299
040593*    DB2 AREA FOR TWEBITM                                         04059399
040594*---------------------------------------------------------------* 04059499
040595                                                                  04059599
040596     EXEC SQL                                                     04059699
040597         INCLUDE TWEBITM                                          04059799
040598     END-EXEC.                                                    04059899
040599*---------------------------------------------------------------* 04059999
040600*    DB2 AREA FOR COMMUNICATIONS                                * 04060099
040601*---------------------------------------------------------------* 04060199
040602     EXEC SQL                                                     04060299
040603          INCLUDE SQLCA                                           04060399
040604     END-EXEC.                                                    04060499
040605*---------------------------------------------------------------* 04060599
040606*    TPURITM CURSOR                                             * 04060699
040607*---------------------------------------------------------------* 04060799
040608                                                                  04060899
040609     EXEC SQL                                                     04060999
040610          DECLARE LINE-CSR1  CURSOR                               04061099
040620          FOR SELECT                                              04062099
040630                A.PO_NBR,                                         04063099
040640                A.TOT_UNT_QTY,                                    04064099
040650                A.STATUS_CDE,                                     04065099
040660                B.STATUS_CDE,                                     04066099
040670                B.APP_PO_LNE_NBR,                                 04067099
040680                B.PO_LNE_NBR,                                     04068099
040690                D.MAJ_CL_NBR,                                     04069099
040700                D.SUB_CL_NBR,                                     04070099
040800                C.SKU_NBR,                                        04080099
040900                C.SKU_DESC,                                       04090099
041000                B.CL_NBR,                                         04100099
041100                B.SKU_SEQ_NBR,                                    04110099
041200                B.SKU_DESC,                                       04120099
041300                B.UNT_QTY                                         04130099
041400          FROM                                                    04140099
041500                TPURCHS A,                                        04150099
041600                TPURITM B                                         04160099
041700          LEFT OUTER JOIN                                         04170099
041800                XLT_SKU C                                         04180099
041900          ON    B.ITM_NBR = C.ITM_NBR                             04190099
042000          LEFT OUTER JOIN                                         04200099
042100                XLT_VND_STYL D                                    04210099
042200          ON    C.STYL_ID = D.STYL_ID                             04220099
042300          WHERE                                                   04230099
042400                 A.PO_NBR         = :PURCHS-PO-NBR                04240099
042500            AND  A.VER_STATUS_CDE = 'A'                           04250099
042600            AND  A.PO_NBR         = B.PO_NBR                      04260099
042700            AND  B.VER_STATUS_CDE = A.VER_STATUS_CDE              04270099
042800          ORDER BY                                                04280099
042900                5, 6                                              04290099
043000     END-EXEC.                                                    04300099
043100                                                                  04310099
043200*---------------------------------------------------------------* 04320099
043300*    DC CURSOR                                                  * 04330099
043400*---------------------------------------------------------------* 04340099
043500     EXEC SQL                                                     04350099
043600          DECLARE DC-CSR CURSOR FOR                               04360099
043700          SELECT XL.LOC_NBR,                                      04370099
043800                 XL.LOC_5_ABBR_NM                                 04380099
043900            FROM XMT_LOC XL                                       04390099
044000           WHERE LOC_TYP_CDE = 'DC'                               04400099
044100             AND CLO_DTE > CURRENT DATE                           04410099
044200             AND XL.LOC_NBR > :DK-LAST-DC                         04420099
044300             AND XL.LOC_NBR =                                     04430099
044400                (SELECT DC_NBR                                    04440099
044500                   FROM XMT_DC_LOC_ASGMT DLA1                     04450099
044600                  WHERE DLA1.LOC_NBR = XL.LOC_NBR                 04460099
044700                    AND DLA1.PO_STRT_DTE =                        04470099
044800                       (SELECT MAX(PO_STRT_DTE)                   04480099
044900                          FROM XMT_DC_LOC_ASGMT DLA2              04490099
045000                         WHERE DLA2.PO_STRT_DTE <= :PV-DC-REC-DATE04500099
045100                           AND DLA1.LOC_NBR = DLA2.LOC_NBR))      04510099
045200                  ORDER BY XL.LOC_NBR                             04520099
045300     END-EXEC.                                                    04530099
045400                                                                  04540099
045500 EJECT                                                            04550099
045600 LINKAGE SECTION.                                                 04560099
045610                                                                  04561099
045620 01  DFHCOMMAREA.                                                 04562099
045630     05  FILLER                         OCCURS  1 TO 4072 TIMES   04563099
045640                                        DEPENDING ON EIBCALEN.    04564099
045641         10  FILLER                     PIC X.                    04564199
045642                                                                  04564299
045643 EJECT                                                            04564399
045644 PROCEDURE DIVISION.                                              04564499
045645******************************************************************04564599
045646**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **04564699
045647**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **04564799
045648**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **04564899
045649******************************************************************04564999
045650 0000-MAIN-MODULE.                                                04565099
045660     INITIALIZE DP030-CICS-API-FIELDS.                            04566099
045670     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04567099
045680     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04568099
045690     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04569099
045700     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04570099
045800     MOVE LENGTH OF PO129AI        TO DP030-MAP-LENGTH (1).       04580099
045900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04590099
046000     PERFORM 0001-CALL-CICS-ARCH-API.                             04600099
046100     MOVE 'POKCS129' TO PO011-LAST-PROGRAM.                       04610099
046200*                                                                 04620099
046300     PERFORM 1000-CONTROL-PROCESSING                              04630099
046400*                                                                 04640099
046500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04650099
046600     PERFORM 0001-CALL-CICS-ARCH-API.                             04660099
046700                                                                  04670099
046800******************************************************************04680099
046900**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **04690099
047000**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **04700099
047100******************************************************************04710099
047200 0001-CALL-CICS-ARCH-API.                                         04720099
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04730099
047400                                    DFHCOMMAREA                   04740099
047500                                    DP030-CICS-API-FIELDS         04750099
047600                                    DP020-STANDARD-COMMAREA       04760099
047700                                    PO129AI.                      04770099
047800*                                                                 04780099
047900     IF  DP030-RC-CALL-SUCCESSFUL                                 04790099
048000         CONTINUE                                                 04800099
048100     ELSE                                                         04810099
048200         SET DP013-NO-ROLLBACK                                    04820099
048300             DP013-XCTL-DISPLAY-RESTART                           04830099
048400             DP013-CICS-ABEND      TO TRUE                        04840099
048500         MOVE '0001-CALL-CICS-ARCH-API'                           04850099
048600                                   TO DP013-PARAGRAPH             04860099
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04870099
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04880099
048900         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04890099
049000         PERFORM DP013-0000-PROCESS-ABEND                         04900099
049100     END-IF.                                                      04910099
049200*----------------------------------------------------------------*04920099
049300* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *04930099
049400* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04940099
049500*                                                                *04950099
049600* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *04960099
049700*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *04970099
049800*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *04980099
049900*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *04990099
050000*----------------------------------------------------------------*05000099
050100                                                                  05010099
050200 1000-CONTROL-PROCESSING.                                         05020099
050300                                                                  05030099
050400     EVALUATE TRUE                                                05040099
050500         WHEN DP020-NEXT-ACT-INITIAL                              05050099
050600             INITIALIZE ASC-SPECIFIC-COMMAREA                     05060099
050700             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05070099
050800                                      ASC-SEL-TERM-ID             05080099
050900             MOVE DP020-SRC-TASK-NUMBER                           05090099
051000                                   TO ASC-LIST-TASK-NUMBER        05100099
051100                                      ASC-SEL-TASK-NUMBER         05110099
051200             MOVE PC-LIST-QUEUE-SEQ                               05120099
051300                                   TO ASC-LIST-SEQ                05130099
051400             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 05140099
051500             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05150099
051600***-----$TEMPLATE NOTE$-------------------------------------------05160099
051700*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,05170099
051800*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  05180099
051900*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.05190099
052000***---------------------------------------------------------------05200099
052100             IF  PS-COMMAREA-NOT-VALID                            05210099
052200***              MOVE PC-TSYMSG-99901                             05220099
052300***                                TO DP020-MSG-NUMBER            05230099
052400***              SET DP020-MSG-FATAL                              05240099
052500***                                TO TRUE                        05250099
052600                 SET DP020-NEXT-ACT-APPL-ERROR                    05260099
052700                                   TO TRUE                        05270099
052800             ELSE                                                 05280099
052900                 PERFORM 1200-LOAD-DC-TABLE                       05290099
053000                 PERFORM 4000-BUILD-INITIAL-PANEL                 05300099
053100                 PERFORM 3200-RESET-ATTRIBUTES                    05310099
053200                 PERFORM 2200-MOVE-SCREEN-TO-COMMAREA             05320099
053300                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               05330099
053400             END-IF                                               05340099
053500                                                                  05350099
053600         WHEN DP020-NEXT-ACT-RETURN                               05360099
053610             MOVE ZEROS TO PO011-LAST-PO-LNE-NBR                  05361099
053620             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05362099
053630                                   TO PV-TOP-ITEM                 05363099
053640             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05364099
053650             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05365099
053660             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05366099
053670                                                                  05367099
053680         WHEN DP020-NEXT-ACT-READ-MAP                             05368099
053690             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05369099
053700                                   TO PV-TOP-ITEM                 05370099
053800             PERFORM 2000-PROCESS-PANEL                           05380099
053900                                                                  05390099
054000         WHEN OTHER                                               05400099
054100             SET DP013-LOGIC-ABEND TO TRUE                        05410099
054200             SET DP013-NO-ROLLBACK TO TRUE                        05420099
054300             MOVE '1000-CONTROL-PROCESSING'                       05430099
054400                                   TO DP013-PARAGRAPH             05440099
054500             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05450099
054600                                   TO DP013-MESSAGE-TEXT(1)       05460099
054700             PERFORM DP013-0000-PROCESS-ABEND                     05470099
054800     END-EVALUATE.                                                05480099
054900                                                                  05490099
055000 EJECT                                                            05500099
055100*----------------------------------------------------------------*05510099
055200* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *05520099
055300* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *05530099
055400*----------------------------------------------------------------*05540099
055500                                                                  05550099
055600 1100-PROCESS-INTER-APPL-COMM.                                    05560099
055700                                                                  05570099
055800     SET PS-COMMAREA-VALID         TO TRUE.                       05580099
055900     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     05590099
056000     MOVE PO011-PO-NBR             TO ASC-KEY-PO-NUMBER           05600099
056100                                      DK-PO-NUMBER.               05610099
056200     IF PO011-PO-NBR = 0                                          05620099
056300         SET PS-COMMAREA-NOT-VALID TO TRUE                        05630099
056400     END-IF.                                                      05640099
056500 EJECT                                                            05650099
056600                                                                  05660099
056700*----------------------------------------------------------------*05670099
056800* LOADS A DC TABLE WITH ALL OF THE VALID DC NAMES.               *05680099
056900*----------------------------------------------------------------*05690099
057000 1200-LOAD-DC-TABLE.                                              05700099
057100                                                                  05710099
057200     SET PS-NOT-END-OF-DC TO TRUE.                                05720099
057300     SET PS-NOT-TABLE-OVERFLOW TO TRUE.                           05730099
057400                                                                  05740099
057500     PERFORM 1210-GET-DONT-SHIP-BEF-DTE.                          05750099
057600                                                                  05760099
057700     IF PLNSHP-DONT-SHIP-BEF-DTE > PV-ALLOC-DATE                  05770099
057800         MOVE PLNSHP-DONT-SHIP-BEF-DTE TO PV-DC-REC-DATE          05780099
057900     ELSE                                                         05790099
058000         MOVE PV-ALLOC-DATE TO PV-DC-REC-DATE                     05800099
058100     END-IF.                                                      05810099
058110                                                                  05811099
058111     MOVE PO011-LAST-DC-LOC-NBR TO DK-LAST-DC.                    05811199
058112                                                                  05811299
058113     MOVE ZEROS TO ASC-DC-COUNTER-DC.                             05811399
058114                                                                  05811499
058115     PERFORM 4010-OPEN-DC-CSR.                                    05811599
058116     PERFORM 4015-PROCESS-DC-CSR.                                 05811699
058117     PERFORM 4020-CLOSE-DC-CSR.                                   05811799
058118                                                                  05811899
058119*    IF PS-TABLE-OVERFLOW                                         05811999
058120*        SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    05812099
058121*        SET DP020-MSG-FATAL TO TRUE                              05812199
058122*        MOVE PC-TSYMSG-00994 TO DP020-MSG-NUMBER                 05812299
058123*    END-IF.                                                      05812399
058124                                                                  05812499
058125*    IF PV-DC-COUNT = ZEROS                                       05812599
058126     IF ASC-DC-COUNTER-DC = ZEROS                                 05812699
058127         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    05812799
058128         SET DP020-MSG-WARNING TO TRUE                            05812899
058129         MOVE PC-TSYMSG-03487 TO DP020-MSG-NUMBER                 05812999
058130     END-IF.                                                      05813099
058140 EJECT                                                            05814099
058150*----------------------------------------------------------------*05815099
058151* RETRIEVE DO NOT SHIP BEFORE DATE TO USE IN VALIDATING A DC     *05815199
058152*----------------------------------------------------------------*05815299
058153 1210-GET-DONT-SHIP-BEF-DTE.                                      05815399
058154                                                                  05815499
058155     PERFORM                                                      05815599
058156         WITH TEST AFTER                                          05815699
058157         VARYING PV-RETRY-COUNTER                                 05815799
058158         FROM 1 BY 1                                              05815899
058159         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05815999
058160             OR (SQLCODE = ZERO))                                 05816099
058161                                                                  05816199
058162             EXEC SQL                                             05816299
058163                 SELECT DONT_SHIP_BEF_DTE,                        05816399
058164                        CURRENT DATE                              05816499
058165                 INTO :PLNSHP-DONT-SHIP-BEF-DTE,                  05816599
058166                      :PV-ALLOC-DATE                              05816699
058167                 FROM TPLNSHP                                     05816799
058168                 WHERE PO_NBR = :ASC-KEY-PO-NUMBER                05816899
058169                   AND VER_STATUS_CDE = 'A'                       05816999
058170             END-EXEC                                             05817099
058171                                                                  05817199
058172         EVALUATE TRUE                                            05817299
058173             WHEN SQLCODE = ZERO                                  05817399
058174             WHEN SQLCODE = -904                                  05817499
058175             WHEN SQLCODE = -913                                  05817599
058176                 CONTINUE                                         05817699
058177             WHEN SQLWARN0 NOT = SPACES                           05817799
058178             WHEN SQLCODE < ZERO                                  05817899
058179             WHEN SQLCODE > ZERO                                  05817999
058180                 MOVE '1210-GET-DONT-SHIP-BEF-DTE'                05818099
058181                                   TO DP013-PARAGRAPH             05818199
058182                 MOVE ASC-KEY-PO-NUMBER   TO  PV-DISP-PO          05818299
058183                 STRING 'SQL ERROR SELECTING PO:'                 05818399
058184                         PV-DISP-PO  DELIMITED BY SIZE            05818499
058185                                 INTO DP013-MESSAGE-TEXT (1)      05818599
058186                 MOVE SQLCA        TO DP013-SQLCA                 05818699
058187                 MOVE 'TPLNSHP '   TO DP013-DB2-TABLE-NAME (1)    05818799
058188                 SET DP013-DB2-ABEND                              05818899
058189                     DP013-XCTL-DISPLAY-RESTART TO TRUE           05818999
058190                 PERFORM DP013-0000-PROCESS-ABEND                 05819099
058191         END-EVALUATE                                             05819199
058192     END-PERFORM.                                                 05819299
058193*                                                                 05819399
058194     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        05819499
058195         MOVE '1210-GET-DONT-SHIP-BEF-DTE'                        05819599
058196                                   TO DP013-PARAGRAPH             05819699
058197         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  05819799
058198                                   TO DP013-MESSAGE-TEXT (1)      05819899
058199         MOVE SQLCA                TO DP013-SQLCA                 05819999
058200         MOVE 'TPLNSHP '           TO DP013-DB2-TABLE-NAME (1)    05820099
058201         SET DP013-DB2-ABEND                                      05820199
058202             DP013-XCTL-DISPLAY-RESTART                           05820299
058203                                   TO TRUE                        05820399
058204         PERFORM DP013-0000-PROCESS-ABEND                         05820499
058205     END-IF.                                                      05820599
058206                                                                  05820699
058207 EJECT                                                            05820799
058208*----------------------------------------------------------------*05820899
058209* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *05820999
058210* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *05821099
058211* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *05821199
058212* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *05821299
058213* FUNCTION KEYS CAN GET THIS FAR.                                *05821399
058214*----------------------------------------------------------------*05821499
058215                                                                  05821599
058216 2000-PROCESS-PANEL.                                              05821699
058217     EVALUATE TRUE                                                05821799
058218         WHEN DP020-SRC-AID = DP016-CLEAR                         05821899
058219             SET ASC-DISPLAY-QTY TO TRUE                          05821999
058220             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05822099
058221             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05822199
058222             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05822299
058230             PERFORM 3200-RESET-ATTRIBUTES                        05823099
058240                                                                  05824099
058250         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05825099
058260             SET ASC-DISPLAY-QTY TO TRUE                          05826099
058270             MOVE ASC-KEY-PO-NUMBER                               05827099
058280                                   TO DK-PO-NUMBER                05828099
058290             PERFORM 2050-DELETE-LIST-QUEUE                       05829099
058300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05830099
058400             PERFORM 4000-BUILD-INITIAL-PANEL                     05840099
058500             PERFORM 3200-RESET-ATTRIBUTES                        05850099
058600                                                                  05860099
058700         WHEN OTHER                                               05870099
058800             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05880099
058900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05890099
059000             IF  PS-NO-ERROR                                      05900099
059100                 SET DP030-CONTINUE-GO                            05910099
059200                                 TO TRUE                          05920099
059300                 PERFORM 2100-CHECK-FUNCTION-KEY                  05930099
059400             ELSE                                                 05940099
059500                 SET DP030-OVERRIDE-GO                            05950099
059600                                 TO TRUE                          05960099
059700             END-IF                                               05970099
059800     END-EVALUATE.                                                05980099
059900 EJECT                                                            05990099
060000*----------------------------------------------------------------*06000099
060100*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06010099
060200*----------------------------------------------------------------*06020099
060300 2050-DELETE-LIST-QUEUE.                                          06030099
060400                                                                  06040099
060500     EXEC CICS                                                    06050099
060600         DELETEQ TS                                               06060099
060700             QUEUE (ASC-LIST-QUEUE-NAME)                          06070099
060800             RESP  (PV-CICS-RESP)                                 06080099
060900     END-EXEC.                                                    06090099
061000                                                                  06100099
061100     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       06110099
061200        (PV-CICS-RESP = DFHRESP(QIDERR))                          06120099
061300         CONTINUE                                                 06130099
061400     ELSE                                                         06140099
061500         SET DP013-CICS-ABEND      TO TRUE                        06150099
061600         SET DP013-NO-ROLLBACK     TO TRUE                        06160099
061700                                                                  06170099
061800         MOVE '2050-DELETE-LIST-QUEUE'                            06180099
061900                                   TO DP013-PARAGRAPH             06190099
062000         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    06200099
062100                                   TO DP013-MESSAGE-TEXT (1)      06210099
062200         PERFORM DP013-0000-PROCESS-ABEND                         06220099
062300     END-IF.                                                      06230099
062400                                                                  06240099
062500     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  06250099
062600 EJECT                                                            06260099
062700*----------------------------------------------------------------*06270099
062800* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*06280099
062900* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *06290099
063000* CICS ARCHITECTURE API.                                         *06300099
063100*----------------------------------------------------------------*06310099
063200 2100-CHECK-FUNCTION-KEY.                                         06320099
063300     EVALUATE TRUE                                                06330099
063400                                                                  06340099
063500         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  06350099
063600             MOVE +1               TO PV-TOP-ITEM                 06360099
063700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06370099
063800             PERFORM 3200-RESET-ATTRIBUTES                        06380099
063900                                                                  06390099
064000         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   06400099
064100             PERFORM 2110-BROWSE-BACKWARD                         06410099
064200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06420099
064300             PERFORM 3200-RESET-ATTRIBUTES                        06430099
064400                                                                  06440099
064500         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   06450099
064600             PERFORM 2120-BROWSE-FORWARD                          06460099
064700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06470099
064800             PERFORM 3200-RESET-ATTRIBUTES                        06480099
064900                                                                  06490099
065000         WHEN DP020-SRC-AID = DP016-ENTER                         06500099
065100             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   06510099
065200             IF  PS-ERROR                                         06520099
065300                 CONTINUE                                         06530099
065400             ELSE                                                 06540099
065500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06550099
065600                 PERFORM 3200-RESET-ATTRIBUTES                    06560099
065700             END-IF                                               06570099
065701*                                                                 06570199
065702*** DMH 5/07/14 - WR8608                                          06570299
065703*** NEED ADDITIONAL SCREEN FOR MORE DC DISPLAYS                   06570399
065704*** F22 ADDED TO NAVIGATE TO POKCS130                             06570499
065705*                                                                 06570599
065710* PF22 WAS HIT (DCDETL3 - TRANSFER TO POKCS130)                   06571099
065720         WHEN DP020-FK-LOCAL-FUNC-03(DP020-SRC-AID)               06572099
065730           MOVE ASC-DC-NBR (9) TO PO011-LAST-DC-LOC-NBR           06573099
065740           MOVE PO011-PO-LNE-NBR TO PO011-LAST-PO-LNE-NBR         06574099
065750           MOVE ASC-BLK-SUB TO PO011-BLK-SUB                      06575099
065760           MOVE +7           TO PO011-ITEM-SUB                    06576099
065770           MOVE ASC-HIGHEST-BLOCK-WRITTEN                         06577099
065780             TO PO011-BLOCK-NUMBER                                06578099
065790                                                                  06579099
065800* PF23 WAS HIT (SCROLL LEFT)                                      06580099
065900         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               06590099
066000           SUBTRACT +3 FROM ASC-DC-COUNTER                        06600099
066100           IF ASC-DC-COUNTER < 1                                  06610099
066200               MOVE PC-TSYMSG-00227 TO DP020-MSG-NUMBER           06620099
066300               SET DP020-MSG-INFORMATIONAL TO TRUE                06630099
066400               SET ASC-DISPLAY-QTY TO TRUE                        06640099
066500             IF ASC-DC-COUNTER < -2                               06650099
066600               ADD +3 TO ASC-DC-COUNTER                           06660099
066700             END-IF                                               06670099
066800           END-IF                                                 06680099
066900           MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM           06690099
066910           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   06691099
066911           PERFORM 3200-RESET-ATTRIBUTES                          06691199
066912                                                                  06691299
066913* PF24 WAS HIT (SCROLL RIGHT)                                     06691399
066914* IF TENTH DC IS ADDED JUST INCREASE 7 TO 10 IN THIS PARAGRAPH    06691499
066915         WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)               06691599
066916         IF ASC-MORE-DC                                           06691699
066917           ADD +3 TO ASC-DC-COUNTER                               06691799
066918                                                                  06691899
066919           IF ASC-DC-COUNTER > 7                                  06691999
066920              SUBTRACT +3 FROM ASC-DC-COUNTER                     06692099
066930           END-IF                                                 06693099
066940                                                                  06694099
066950           IF ASC-DC-COUNTER = 7  AND ASC-DC-COUNTER-DC < 7       06695099
066951              SUBTRACT +3 FROM ASC-DC-COUNTER                     06695199
066952              MOVE PC-TSYMSG-00228 TO DP020-MSG-NUMBER            06695299
066953              SET DP020-MSG-INFORMATIONAL TO TRUE                 06695399
066954            ELSE                                                  06695499
066955              IF ASC-DC-COUNTER = 7                               06695599
066956                MOVE PC-TSYMSG-00228 TO DP020-MSG-NUMBER          06695699
066957                SET DP020-MSG-INFORMATIONAL TO TRUE               06695799
066958              END-IF                                              06695899
066959           END-IF                                                 06695999
066960                                                                  06696099
066961           SET ASC-DISPLAY-DC TO TRUE                             06696199
066962         ELSE                                                     06696299
066963              MOVE PC-TSYMSG-00228 TO DP020-MSG-NUMBER            06696399
066964              SET DP020-MSG-INFORMATIONAL TO TRUE                 06696499
066965         END-IF                                                   06696599
066966           MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM           06696699
066967           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   06696799
066968           PERFORM 3200-RESET-ATTRIBUTES                          06696899
066969                                                                  06696999
066970         WHEN OTHER                                               06697099
066971             SET DP013-NO-ROLLBACK                                06697199
066972                 DP013-XCTL-DISPLAY-RESTART                       06697299
066973                 DP013-CICS-ABEND  TO TRUE                        06697399
066974             MOVE '2100-CHECK-FUNCTION-KEY'                       06697499
066975                                   TO DP013-PARAGRAPH             06697599
066976             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      06697699
066977                                   TO DP013-MESSAGE-TEXT (1)      06697799
066978             PERFORM DP013-0000-PROCESS-ABEND                     06697899
066979     END-EVALUATE.                                                06697999
066980*                                                                 06698099
066990*----------------------------------------------------------------*06699099
067000*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *06700099
067100*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *06710099
067200*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *06720099
067300*    MESSAGE.                                                    *06730099
067400*----------------------------------------------------------------*06740099
067500                                                                  06750099
067600 2110-BROWSE-BACKWARD.                                            06760099
067700     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    06770099
067800         GIVING PV-TOP-ITEM.                                      06780099
067900*                                                                 06790099
068000     IF  ((PV-TOP-ITEM < +1)                                      06800099
068100       OR (PV-TOP-ITEM = +1))                                     06810099
068200         MOVE +1                   TO PV-TOP-ITEM                 06820099
068300*        -- TOP OF LIST --                                        06830099
068400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            06840099
068500         SET DP020-MSG-INFORMATIONAL TO TRUE                      06850099
068600     END-IF.                                                      06860099
068700                                                                  06870099
068800 EJECT                                                            06880099
068900*----------------------------------------------------------------*06890099
069000*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *06900099
069100*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *06910099
069200*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *06920099
069300*----------------------------------------------------------------*06930099
069400                                                                  06940099
069500 2120-BROWSE-FORWARD.                                             06950099
069600                                                                  06960099
069700     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              06970099
069800         GIVING PV-TOP-ITEM.                                      06980099
069900     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   06990099
070000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07000099
070100                                   TO PV-TOP-ITEM                 07010099
070200*        -- BOTTOM OF LIST --                                     07020099
070300         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07030099
070400         SET DP020-MSG-INFORMATIONAL                              07040099
070500                                   TO TRUE                        07050099
070600     ELSE                                                         07060099
070700         COMPUTE PV-BOTTOM-ITEM =                                 07070099
070800             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07080099
070900         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07090099
071000*            -- BOTTOM OF LIST --                                 07100099
071100             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07110099
071200             SET DP020-MSG-INFORMATIONAL                          07120099
071300                                   TO TRUE                        07130099
071400         END-IF                                                   07140099
071500     END-IF.                                                      07150099
071600 EJECT                                                            07160099
071700*----------------------------------------------------------------*07170099
071800*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *07180099
071900*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *07190099
072000*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *07200099
072100*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *07210099
072200*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *07220099
072300*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *07230099
072400*----------------------------------------------------------------*07240099
072500                                                                  07250099
072600 2130-CHECK-FOR-JUMP-BROWSE.                                      07260099
072700     SET PS-NO-ERROR               TO TRUE.                       07270099
072800     IF (ASC-START-ITEM-REQUEST = SPACE)                          07280099
072900         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07290099
073000                                   TO PV-TOP-ITEM                 07300099
073100     ELSE                                                         07310099
073200         MOVE ASC-START-ITEM-REQUEST                              07320099
073300                                   TO DP010I-UNEDITED-FIELD       07330099
073400         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       07340099
073500         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     07350099
073600         SET DP010I-NEGATIVE-NOT-ALLOWED                          07360099
073700                                   TO TRUE                        07370099
264220         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07381099
264230                         USING DP010I-NUMERIC-EDIT-AREA           07382099
073900                                                                  07390099
074000         IF  NOT DP010I-ERROR-DETECTED                            07400099
074100             MOVE DP010I-NUMERIC-FIELD                            07410099
074200                                   TO  ASC-START-ITEM-REQUEST-N   07420099
074300             IF  ASC-START-ITEM-REQUEST-N > ZERO                  07430099
074400                 IF  ASC-START-ITEM-REQUEST-N >                   07440099
074500                                          ASC-NUMBER-OF-ITEMS-READ07450099
074600                     MOVE SPACE TO ASC-START-ITEM-REQUEST         07460099
074700                     COMPUTE PV-TOP-ITEM =                        07470099
074800                             ASC-NUMBER-OF-ITEMS-READ             07480099
074900                             - PC-ITEMS-PER-PANEL + 1             07490099
075000                     IF  PV-TOP-ITEM < +1                         07500099
075100                         MOVE +1   TO PV-TOP-ITEM                 07510099
075200                         MOVE PC-TSYMSG-00070                     07520099
075300                                   TO DP020-MSG-NUMBER            07530099
075400                         SET DP020-MSG-INFORMATIONAL              07540099
075500                                   TO TRUE                        07550099
075600                     END-IF                                       07560099
075700                 ELSE                                             07570099
075800                     MOVE ASC-START-ITEM-REQUEST-N                07580099
075900                                   TO PV-TOP-ITEM                 07590099
076000                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      07600099
076100                     COMPUTE PV-BOTTOM-ITEM =                     07610099
076200                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     07620099
076300                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ07630099
076400*                        -- BOTTOM OF LIST --                     07640099
076500                         MOVE PC-TSYMSG-00070                     07650099
076600                                   TO DP020-MSG-NUMBER            07660099
076700                         SET DP020-MSG-INFORMATIONAL              07670099
076800                                   TO TRUE                        07680099
076900                     END-IF                                       07690099
077000                 END-IF                                           07700099
077100             ELSE                                                 07710099
077200*                --- VALUE OUT OF RANGE ----                      07720099
077300                 MOVE PC-TSYMSG-00101                             07730099
077400                                   TO DP020-MSG-NUMBER            07740099
077500                 MOVE -1           TO ASTRTITL                    07750099
077600                 SET DP030-SET-CURSOR-APPL-1                      07760099
077700                                   TO TRUE                        07770099
077800                 MOVE DP015-REVERSE                               07780099
077900                                   TO ASTRTITH                    07790099
078000                 MOVE DP015-RED    TO ASTRTITC                    07800099
078100                 MOVE DP015-UNP-NUM-BRT-MDT                       07810099
078200                                   TO ASTRTITA                    07820099
078300                 SET DP020-MSG-FATAL                              07830099
078400                                   TO TRUE                        07840099
078500                 SET PS-ERROR      TO TRUE                        07850099
078600             END-IF                                               07860099
078700                                                                  07870099
078800         ELSE                                                     07880099
078900             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07890099
079000             MOVE -1               TO ASTRTITL                    07900099
079100             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07910099
079200             MOVE DP015-REVERSE    TO ASTRTITH                    07920099
079300             MOVE DP015-RED        TO ASTRTITC                    07930099
079400             MOVE DP015-UNP-NUM-BRT-MDT                           07940099
079500                                   TO ASTRTITA                    07950099
079600             SET DP020-MSG-FATAL   TO TRUE                        07960099
079700             SET PS-ERROR          TO TRUE                        07970099
079800         END-IF                                                   07980099
079900     END-IF.                                                      07990099
080000 EJECT                                                            08000099
080100******************************************************************08010099
080200** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **08020099
080300** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **08030099
080400******************************************************************08040099
080500 2200-MOVE-SCREEN-TO-COMMAREA.                                    08050099
080600                                                                  08060099
080700     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             08070099
080800     MOVE +1                       TO PV-SUB.                     08080099
080900*                                                                 08090099
081000     PERFORM 3100-SET-SUBSCRIPTS.                                 08100099
081100     IF  ASTRTITL > ZERO                                          08110099
081200         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          08120099
081300     ELSE                                                         08130099
081400         IF  ASTRTITF = DP015-ERASE-EOF                           08140099
081500             INITIALIZE ASC-START-ITEM-REQUEST                    08150099
081600         END-IF                                                   08160099
081700     END-IF.                                                      08170099
081800*    PERFORM 2210-MOVE-LINES-TO-COMMAREA                          08180099
081900*        VARYING PV-SUB                                           08190099
082000*        FROM 1 BY 1                                              08200099
082100*        UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      08210099
082200*                                                                 08220099
082300*2210-MOVE-LINES-TO-COMMAREA.                                     08230099
082400*    IF  MR-SELECTL (PV-SUB) > ZERO                               08240099
082500*        SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             08250099
082600*        MOVE MR-SELECTI (PV-SUB)                                 08260099
082700*                                  TO ASC-TEMP-SELECTED-SW        08270099
082800*                                (ASC-BLK-SUB, ASC-ITEM-SUB)      08280099
082900*    ELSE                                                         08290099
083000*        IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                08300099
083100*                SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     08310099
083200*                MOVE SPACE        TO ASC-TEMP-SELECTED-SW        08320099
083300*                                (ASC-BLK-SUB, ASC-ITEM-SUB)      08330099
083400*        END-IF                                                   08340099
083500*    END-IF.                                                      08350099
083600*    ADD +1                        TO ASC-ITEM-SUB.               08360099
083700*    IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        08370099
083800*        ADD +1                    TO ASC-BLK-SUB                 08380099
083900*        MOVE +1                   TO ASC-ITEM-SUB                08390099
084000*    END-IF.                                                      08400099
084100*                                                                 08410099
084200*----------------------------------------------------------------*08420099
084300*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *08430099
084400*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *08440099
084500*----------------------------------------------------------------*08450099
084600 3000-EDIT-DATA-IN-COMMAREA.                                      08460099
084700                                                                  08470099
084800     SET PS-NO-ERROR               TO TRUE.                       08480099
084900                                                                  08490099
085000     PERFORM 3200-RESET-ATTRIBUTES.                               08500099
085100                                                                  08510099
085200     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     08520099
085300**                                                                08530099
085400* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              08540099
085401* EDITTING IS DONE FROM THE BOTTOM UP.                            08540199
085402**                                                                08540299
085403     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       08540399
085404         ASC-ITEMS-DISPLAYED - 1.                                 08540499
085405                                                                  08540599
085406     PERFORM 3100-SET-SUBSCRIPTS.                                 08540699
085407                                                                  08540799
085408                                                                  08540899
085409 3100-SET-SUBSCRIPTS.                                             08540999
085410                                                                  08541099
085411     COMPUTE ASC-ITEM-SUB =                                       08541199
085412                (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER (1 1)) + 1.08541299
085413                                                                  08541399
085414     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         08541499
085415         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            08541599
085416         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               08541699
085417     ELSE                                                         08541799
085418         MOVE +1 TO ASC-BLK-SUB.                                  08541899
085419                                                                  08541999
085420*----------------------------------------------------------------*08542099
085430*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *08543099
085440*----------------------------------------------------------------*08544099
085450                                                                  08545099
085460 3200-RESET-ATTRIBUTES.                                           08546099
085470                                                                  08547099
085480     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   08548099
085490     MOVE DP015-GREEN              TO ASTRTITC.                   08549099
085500     MOVE DP015-UNDERLINE          TO ASTRTITH.                   08550099
085600     MOVE -1                       TO ASTRTITL.                   08560099
085700     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       08570099
085800                                                                  08580099
085900*----------------------------------------------------------------*08590099
086000*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *08600099
086100*    INITIALIZE ALL COUNTERS AND FLAGS.                          *08610099
086200*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *08620099
086300*    DISPLAY THE PANEL TO USER.                                  *08630099
086400*----------------------------------------------------------------*08640099
086410                                                                  08641099
086420 4000-BUILD-INITIAL-PANEL.                                        08642099
086430                                                                  08643099
086440     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            08644099
086450                                 ASC-BLOCK-ENTRIES (2).           08645099
086460     MOVE +1                 TO ASC-BLK-SUB.                      08646099
086470* THIS IS TO ENSURE THAT WE START WITH DC-COUNTER = 1 WHEN        08647099
086480* DISPLAYING DC SCREENS.                                          08648099
086490     MOVE -2 TO ASC-DC-COUNTER.                                   08649099
086500     SET ASC-ITEMS-LEFT-ON-DB                                     08650099
086600                             TO TRUE.                             08660099
086700*    SET ASC-DISPLAY-QTY TO TRUE.                                 08670099
086800                                                                  08680099
086900     MOVE +0                 TO ASC-ITEM-SUB                      08690099
087000                                ASC-NUMBER-OF-ITEMS-READ          08700099
087100                                ASC-HIGHEST-BLOCK-WRITTEN         08710099
087200                                ASC-ITEM-AT-TOP-OF-PANEL.         08720099
087300                                                                  08730099
087400     PERFORM 4005-GET-HEADER-FIELDS.                              08740099
087500                                                                  08750099
087600     PERFORM 4010-OPEN-CURSOR.                                    08760099
087700                                                                  08770099
087800     PERFORM 4300-READ-ITEMS-FROM-DB.                             08780099
087900                                                                  08790099
088000     PERFORM 4020-CLOSE-CURSOR.                                   08800099
088100                                                                  08810099
088200     PERFORM 4050-GET-PO-TOTALS.                                  08820099
088300                                                                  08830099
088400     MOVE +1                   TO  PV-TOP-ITEM.                   08840099
088500     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          08850099
088600         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    08860099
088700         SET DP020-MSG-FATAL   TO  TRUE                           08870099
088800         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               08880099
088900     ELSE                                                         08890099
089000         SET DP030-SET-CURSOR-APPL-1                              08900099
089100                               TO TRUE                            08910099
089200         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     08920099
089300     END-IF.                                                      08930099
089400 EJECT                                                            08940099
089500*----------------------------------------------------------------*08950099
089600* OPEN THE DC CURSOR                                             *08960099
089700*----------------------------------------------------------------*08970099
089800 4010-OPEN-DC-CSR.                                                08980099
089900                                                                  08990099
090000     PERFORM                                                      09000099
090100         WITH TEST AFTER                                          09010099
090200         VARYING PV-RETRY-COUNTER                                 09020099
090300         FROM 1 BY 1                                              09030099
090400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09040099
090500                   OR (SQLCODE = ZERO))                           09050099
090600                                                                  09060099
090700                 EXEC SQL                                         09070099
090800                      OPEN DC-CSR                                 09080099
090900                 END-EXEC                                         09090099
091000                                                                  09100099
091100         EVALUATE TRUE                                            09110099
091110             WHEN SQLCODE = ZERO                                  09111099
091111             WHEN SQLCODE = -904                                  09111199
091112             WHEN SQLCODE = -913                                  09111299
091113                 CONTINUE                                         09111399
091114             WHEN SQLWARN0 NOT = SPACES                           09111499
091115             WHEN SQLCODE < ZERO                                  09111599
091116             WHEN SQLCODE > ZERO                                  09111699
091117                 MOVE '4010-OPEN-DC-CURSOR'                       09111799
091118                                   TO DP013-PARAGRAPH             09111899
091119                 MOVE 'OPEN DC CURSOR - '                         09111999
091120                                   TO DP013-MESSAGE-TEXT (1)      09112099
091121                 MOVE SQLCA        TO DP013-SQLCA                 09112199
091122                 MOVE 'XMT_LOC '   TO DP013-DB2-TABLE-NAME (1)    09112299
091123                 SET DP013-DB2-ABEND                              09112399
091124                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09112499
091125                 PERFORM DP013-0000-PROCESS-ABEND                 09112599
091126         END-EVALUATE                                             09112699
091127     END-PERFORM.                                                 09112799
091128                                                                  09112899
091129     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09112999
091130         MOVE '4010-OPEN-DC-CSR'   TO DP013-PARAGRAPH             09113099
091131         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   09113199
091132                                   TO DP013-MESSAGE-TEXT (1)      09113299
091133         MOVE SQLCA                TO DP013-SQLCA                 09113399
091134         MOVE 'XMT_LOC '           TO DP013-DB2-TABLE-NAME (1)    09113499
091135         SET DP013-DB2-ABEND                                      09113599
091136             DP013-XCTL-DISPLAY-RESTART                           09113699
091137                                   TO TRUE                        09113799
091138         PERFORM DP013-0000-PROCESS-ABEND                         09113899
091139     END-IF.                                                      09113999
091140                                                                  09114099
091141                                                                  09114199
091142*----------------------------------------------------------------*09114299
091143* PROCESS THE DC CURSOR                                          *09114399
091144*----------------------------------------------------------------*09114499
091145                                                                  09114599
091146 4015-PROCESS-DC-CSR.                                             09114699
091147                                                                  09114799
091148     PERFORM VARYING PV-DC-COUNT                                  09114899
091149        FROM 1 BY 1                                               09114999
091150       UNTIL PS-END-OF-DC OR PS-TABLE-OVERFLOW                    09115099
091151                                                                  09115199
091152           PERFORM 4016-FETCH-DC-CSR                              09115299
091153           IF PS-END-OF-DC                                        09115399
091154               CONTINUE                                           09115499
091155           ELSE                                                   09115599
091156* IF WE HAVE MORE THAN 10 DIST CENTERS, BUMP THE NUMBER UP FROM   09115699
091157* 10 TO THE NUMBER OF OCCURS IN THE ASC-DC-TABLE.                 09115799
091158               IF PV-DC-COUNT > 10                                09115899
091159                   SET PS-TABLE-OVERFLOW TO TRUE                  09115999
091160               ELSE                                               09116099
091161                   ADD +1 TO ASC-DC-COUNTER-DC                    09116199
091162                   MOVE XMT00001-LOC-NBR                          09116299
091163                     TO ASC-DC-NBR (PV-DC-COUNT)                  09116399
091164                   MOVE XMT00001-LOC-5-ABBR-NM                    09116499
091165                     TO ASC-DC-NAME (PV-DC-COUNT)                 09116599
091166               END-IF                                             09116699
091167           END-IF                                                 09116799
091168     END-PERFORM.                                                 09116899
091169           IF ASC-DC-COUNTER-DC > 3                               09116999
091170            SET ASC-MORE-DC TO TRUE                               09117099
091171           ELSE                                                   09117199
091172            SET ASC-NO-MORE-DC TO TRUE                            09117299
091173           END-IF.                                                09117399
091174                                                                  09117499
091175*----------------------------------------------------------------*09117599
091176*    FETCH THE DC CURSOR                                         *09117699
091177*----------------------------------------------------------------*09117799
091178                                                                  09117899
091179 4016-FETCH-DC-CSR.                                               09117999
091180                                                                  09118099
091181     EXEC SQL                                                     09118199
091182          FETCH DC-CSR                                            09118299
091183          INTO  :XMT00001-LOC-NBR,                                09118399
091184                :XMT00001-LOC-5-ABBR-NM                           09118499
091185     END-EXEC.                                                    09118599
091186                                                                  09118699
091187     EVALUATE TRUE                                                09118799
091188         WHEN SQLCODE = ZERO                                      09118899
091189              CONTINUE                                            09118999
091190         WHEN SQLCODE = +100                                      09119099
091191              SET PS-END-OF-DC TO TRUE                            09119199
091192         WHEN SQLWARN0 NOT = SPACE                                09119299
091193         WHEN SQLCODE NOT = ZERO                                  09119399
091194              MOVE '4016-FETCH-DC-CSR'                            09119499
091195                                   TO DP013-PARAGRAPH             09119599
091196              MOVE 'FETCH DC CURSOR'                              09119699
091197                                   TO DP013-MESSAGE-TEXT (1)      09119799
091198              MOVE SQLCA           TO DP013-SQLCA                 09119899
091199              SET DP013-DB2-ABEND                                 09119999
091200                                   TO TRUE                        09120099
091201              PERFORM DP013-0000-PROCESS-ABEND                    09120199
091202     END-EVALUATE.                                                09120299
091203                                                                  09120399
091204*----------------------------------------------------------------*09120499
091205* CLOSE THE DC CURSOR                                            *09120599
091206*----------------------------------------------------------------*09120699
091207 4020-CLOSE-DC-CSR.                                               09120799
091208                                                                  09120899
091209     EXEC SQL                                                     09120999
091210         CLOSE DC-CSR                                             09121099
091211     END-EXEC.                                                    09121199
091212                                                                  09121299
091213     EVALUATE TRUE                                                09121399
091214         WHEN SQLCODE = ZERO                                      09121499
091215             CONTINUE                                             09121599
091216         WHEN SQLWARN0 NOT = SPACES                               09121699
091217         WHEN SQLCODE < ZERO                                      09121799
091218         WHEN SQLCODE > ZERO                                      09121899
091219             MOVE '4020-CLOSE-DC-CSR'                             09121999
091220                                   TO DP013-PARAGRAPH             09122099
091221             MOVE 'CLOSE DC CURSOR '                              09122199
091222                                   TO DP013-MESSAGE-TEXT (1)      09122299
091223             MOVE SQLCA            TO DP013-SQLCA                 09122399
091224             MOVE 'XMT_LOC '       TO DP013-DB2-TABLE-NAME (1)    09122499
091225             SET DP013-DB2-ABEND                                  09122599
091226                 DP013-XCTL-DISPLAY-RESTART TO TRUE               09122699
091227             PERFORM DP013-0000-PROCESS-ABEND                     09122799
091228     END-EVALUATE.                                                09122899
091229                                                                  09122999
091230*----------------------------------------------------------------*09123099
091231* FORMAT THE HEADER FIELDS ON THE SCREEN.                        *09123199
091232*----------------------------------------------------------------*09123299
091233 4005-GET-HEADER-FIELDS.                                          09123399
091234     PERFORM                                                      09123499
091235         WITH TEST AFTER                                          09123599
091236         VARYING PV-RETRY-COUNTER                                 09123699
091237         FROM 1 BY 1                                              09123799
091238         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09123899
091239                   OR (SQLCODE = ZERO))                           09123999
091240         EXEC SQL                                                 09124099
091250             SELECT A.DEPT_NBR,                                   09125099
091260                    B.ENT_NAME_DESC                               09126099
091270               INTO :PURCHS-DEPT-NBR,                             09127099
091280                    :ENTNME-ENT-NAME-DESC                         09128099
091290               FROM TPURCHS A,                                    09129099
091300                    TENTNME B                                     09130099
091400              WHERE                                               09140099
091500                    A.PO_NBR = :DK-PO-NUMBER                      09150099
091600                AND A.VER_STATUS_CDE = 'A'                        09160099
091700                AND (A.ENT_ID = B.ENT_ID                          09170099
091800                AND  B.TYPE_CDE = '01')                           09180099
091900         END-EXEC                                                 09190099
092000                                                                  09200099
092100         EVALUATE TRUE                                            09210099
092200             WHEN SQLCODE = ZERO                                  09220099
092300                 MOVE PURCHS-DEPT-NBR      TO ASC-KEY-DEPT        09230099
092400                 MOVE ENTNME-ENT-NAME-DESC TO ASC-KEY-VENDOR      09240099
092500             WHEN SQLCODE = -904                                  09250099
092600             WHEN SQLCODE = -913                                  09260099
092700                 CONTINUE                                         09270099
092800             WHEN SQLWARN0 NOT = SPACES                           09280099
092900             WHEN SQLCODE < ZERO                                  09290099
093000             WHEN SQLCODE > ZERO                                  09300099
093100                 MOVE '4005-GET-HEADER'                           09310099
093200                                   TO DP013-PARAGRAPH             09320099
093300                 MOVE 'RETRIEVING HDR FIELDS'                     09330099
093400                                   TO DP013-MESSAGE-TEXT (1)      09340099
093500                 MOVE SQLCA        TO DP013-SQLCA                 09350099
093600                 MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)    09360099
093700                 SET DP013-DB2-ABEND                              09370099
093800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09380099
093900                 PERFORM DP013-0000-PROCESS-ABEND                 09390099
094000         END-EVALUATE                                             09400099
094100     END-PERFORM.                                                 09410099
094200*                                                                 09420099
094300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09430099
094400         MOVE '4005-GET-HEADER-FIELDS' TO DP013-PARAGRAPH         09440099
094500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   09450099
094600                                   TO DP013-MESSAGE-TEXT (1)      09460099
094700         MOVE SQLCA                TO DP013-SQLCA                 09470099
094800         MOVE 'TPURCHS '           TO DP013-DB2-TABLE-NAME (1)    09480099
094900         MOVE 'TENTNME '           TO DP013-DB2-TABLE-NAME (2)    09490099
095000         SET DP013-DB2-ABEND                                      09500099
095100             DP013-XCTL-DISPLAY-RESTART                           09510099
095200                                   TO TRUE                        09520099
095300         PERFORM DP013-0000-PROCESS-ABEND                         09530099
095400     END-IF.                                                      09540099
095500                                                                  09550099
095600*----------------------------------------------------------------*09560099
095700* OPEN THE TMESSAGE CURSOR.                                      *09570099
095800*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *09580099
095900*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *09590099
096000*   USER.                                                        *09600099
096100*----------------------------------------------------------------*09610099
096200                                                                  09620099
096300 4010-OPEN-CURSOR.                                                09630099
096310     MOVE DK-PO-NUMBER  TO  PURCHS-PO-NBR                         09631099
096320     PERFORM                                                      09632099
096330         WITH TEST AFTER                                          09633099
096340         VARYING PV-RETRY-COUNTER                                 09634099
096350         FROM 1 BY 1                                              09635099
096360         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09636099
096370                   OR (SQLCODE = ZERO))                           09637099
096380                 MOVE 'CURSOR:  LINE-CURSOR1'                     09638099
096390                                   TO DP013-MESSAGE-TEXT (2)      09639099
096400         EXEC SQL                                                 09640099
096500              OPEN LINE-CSR1                                      09650099
096600         END-EXEC                                                 09660099
096700                                                                  09670099
096800         EVALUATE TRUE                                            09680099
096900             WHEN SQLCODE = ZERO                                  09690099
097000             WHEN SQLCODE = -904                                  09700099
097100             WHEN SQLCODE = -913                                  09710099
097200                 CONTINUE                                         09720099
097300             WHEN SQLWARN0 NOT = SPACES                           09730099
097400             WHEN SQLCODE < ZERO                                  09740099
097500             WHEN SQLCODE > ZERO                                  09750099
097600                 MOVE '4010-OPEN-CURSOR'                          09760099
097700                                   TO DP013-PARAGRAPH             09770099
097800                 MOVE 'OPEN LINE CURSOR - '                       09780099
097900                                   TO DP013-MESSAGE-TEXT (1)      09790099
098000                 MOVE SQLCA        TO DP013-SQLCA                 09800099
098100                 MOVE 'TPURITM '   TO DP013-DB2-TABLE-NAME (1)    09810099
098200                 SET DP013-DB2-ABEND                              09820099
098300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09830099
098400                 PERFORM DP013-0000-PROCESS-ABEND                 09840099
098500         END-EVALUATE                                             09850099
098600     END-PERFORM.                                                 09860099
098700*                                                                 09870099
098800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09880099
098900         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             09890099
099000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   09900099
099100                                   TO DP013-MESSAGE-TEXT (1)      09910099
099200         MOVE SQLCA                TO DP013-SQLCA                 09920099
099300         MOVE 'TPURITM '           TO DP013-DB2-TABLE-NAME (1)    09930099
099400         SET DP013-DB2-ABEND                                      09940099
099500             DP013-XCTL-DISPLAY-RESTART                           09950099
099600                                   TO TRUE                        09960099
099700         PERFORM DP013-0000-PROCESS-ABEND                         09970099
099800     END-IF.                                                      09980099
099900                                                                  09990099
100000 EJECT                                                            10000099
100100*----------------------------------------------------------------*10010099
100200* CLOSE THE LINE CURSOR.                                         *10020099
100300*----------------------------------------------------------------*10030099
100400 4020-CLOSE-CURSOR.                                               10040099
100500     EXEC SQL                                                     10050099
100600          CLOSE LINE-CSR1                                         10060099
100700     END-EXEC                                                     10070099
100800                                                                  10080099
100900*                                                                 10090099
101000     EVALUATE TRUE                                                10100099
101100         WHEN SQLCODE = ZERO                                      10110099
101200             CONTINUE                                             10120099
101300         WHEN SQLWARN0 NOT = SPACES                               10130099
101400         WHEN SQLCODE < ZERO                                      10140099
101500         WHEN SQLCODE > ZERO                                      10150099
101600             MOVE '4020-CLOSE-CURSOR'                             10160099
101700                               TO DP013-PARAGRAPH                 10170099
101800             MOVE 'CLOSE LINE CURSOR '                            10180099
101900                               TO DP013-MESSAGE-TEXT (1)          10190099
102000             MOVE SQLCA        TO DP013-SQLCA                     10200099
102100             MOVE 'TPURITM '   TO DP013-DB2-TABLE-NAME (1)        10210099
102200             SET DP013-DB2-ABEND                                  10220099
102300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               10230099
102400             PERFORM DP013-0000-PROCESS-ABEND                     10240099
102500     END-EVALUATE.                                                10250099
102600                                                                  10260099
102700*----------------------------------------------------------------*10270099
102800* GET THE PO TOTALS.                                             *10280099
102900*----------------------------------------------------------------*10290099
103000 4050-GET-PO-TOTALS.                                              10300099
103100                                                                  10310099
103200     MOVE PURCHS-TOT-UNT-QTY     TO ASC-TOT-ORD.                  10320099
103300     MOVE PV-END-QTY-REC         TO ASC-TOT-REC.                  10330099
103400                                                                  10340099
103500     IF ASC-TOT-REC = 0 OR ASC-TOT-ORD = 0                        10350099
103600         MOVE ZEROES TO ASC-TOT-PCT-N                             10360099
103700         MOVE SPACES TO ASC-TOT-PCT-SIGN                          10370099
103800     ELSE                                                         10380099
103900         COMPUTE PV-TOT-REC-PCT                                   10390099
104000         ROUNDED =                                                10400099
104100                 (ASC-TOT-REC / ASC-TOT-ORD)                      10410099
104200         COMPUTE PV-TOT-REC-PCT =                                 10420099
104300                 PV-TOT-REC-PCT * 100                             10430099
104400         MOVE PC-PCT         TO ASC-TOT-PCT-SIGN                  10440099
104500         IF PV-TOT-REC-PCT = ZERO AND ASC-TOT-REC > ZERO          10450099
104600             MOVE 1 TO ASC-TOT-PCT-N                              10460099
104700         ELSE                                                     10470099
104800             MOVE PV-TOT-REC-PCT TO ASC-TOT-PCT-N                 10480099
104900         END-IF                                                   10490099
105000     END-IF.                                                      10500099
105100                                                                  10510099
105200     SET ASC-NOT-DC-END TO TRUE.                                  10520099
105300     PERFORM VARYING PV-DC-COUNT                                  10530099
105400       FROM 1 BY 1                                                10540099
105500        UNTIL ASC-DC-END                                          10550099
105600                                                                  10560099
105700     MOVE ASC-DC-NBR(PV-DC-COUNT) TO PC-DCX                       10570099
105800     PERFORM 4060-GET-PO-DC-ORD                                   10580099
105801     MOVE PV-DC-ORD-QTY        TO ASC-TOT-DC-ORD(PV-DC-COUNT)     10580199
105802                                                                  10580299
105803     MOVE ASC-DC-NBR(PV-DC-COUNT) TO PC-DCX                       10580399
105804     PERFORM 4065-GET-PO-DC-REC                                   10580499
105805     MOVE PV-DC-REC-QTY        TO ASC-TOT-DC-REC(PV-DC-COUNT)     10580599
105806                                                                  10580699
105807     IF ASC-DC-NBR(PV-DC-COUNT) = 0                               10580799
105808        SET ASC-DC-END TO TRUE                                    10580899
105809     END-IF                                                       10580999
105810                                                                  10581099
105820     IF PV-DC-COUNT > 9                                           10582099
105830        SET ASC-DC-END TO TRUE                                    10583099
105840     END-IF                                                       10584099
105850     END-PERFORM.                                                 10585099
105860                                                                  10586099
105870*----------------------------------------------------------------*10587099
105880* RETRIEVE THE ORDER QUANTITY FOR A DC.                          *10588099
105890*----------------------------------------------------------------*10589099
105900 4060-GET-PO-DC-ORD.                                              10590099
106000                                                                  10600099
106100     MOVE +0                       TO PV-DC-ORD-QTY.              10610099
106101                                                                  10610199
106102     PERFORM                                                      10610299
106103         WITH TEST AFTER                                          10610399
106104         VARYING PV-RETRY-COUNTER                                 10610499
106105         FROM 1 BY 1                                              10610599
106106         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               10610699
106107                   OR (SQLCODE = ZERO)                            10610799
106108                   OR (SQLCODE = 100))                            10610899
106109         EXEC SQL                                                 10610999
106110             SELECT SUM(CURR_SPLIT_QTY)                           10611099
106120               INTO :PV-DC-ORD-QTY:PV-QTY-NULL                    10612099
106130               FROM TPURITM A,                                    10613099
106140                    TALLPLN B                                     10614099
106150              WHERE                                               10615099
106160                    A.PO_NBR         = :DK-PO-NUMBER              10616099
106170                AND A.VER_STATUS_CDE = 'A'                        10617099
106180                AND A.STATUS_CDE NOT IN ('CA')                    10618099
106190                AND A.PO_NBR         = B.PO_NBR                   10619099
106200                AND A.PO_LNE_NBR     = B.PO_LNE_NBR               10620099
106300                AND B.DEST_NBR       = :PC-DCX                    10630099
106400         END-EXEC                                                 10640099
106500                                                                  10650099
106600         EVALUATE TRUE                                            10660099
106700             WHEN SQLCODE = ZERO                                  10670099
106800                 CONTINUE                                         10680099
106900             WHEN SQLCODE = +100                                  10690099
107000                 CONTINUE                                         10700099
107100             WHEN SQLCODE = -904                                  10710099
107200             WHEN SQLCODE = -913                                  10720099
107300                 CONTINUE                                         10730099
107400             WHEN SQLWARN0 NOT = SPACES                           10740099
107500             WHEN SQLCODE < ZERO                                  10750099
107600             WHEN SQLCODE > ZERO                                  10760099
107700                 MOVE '4060-GET-PO-DC-ORD'                        10770099
107800                                   TO DP013-PARAGRAPH             10780099
107900                 MOVE 'RETRIEVING DC ORDER QTY'                   10790099
108000                                   TO DP013-MESSAGE-TEXT (1)      10800099
108100                 MOVE SQLCA        TO DP013-SQLCA                 10810099
108200                 MOVE 'TPURITM '   TO DP013-DB2-TABLE-NAME (1)    10820099
108300                 MOVE 'TALLPLN '   TO DP013-DB2-TABLE-NAME (2)    10830099
108400                 SET DP013-DB2-ABEND                              10840099
108500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           10850099
108600                 PERFORM DP013-0000-PROCESS-ABEND                 10860099
108700         END-EVALUATE                                             10870099
108800     END-PERFORM.                                                 10880099
108900*                                                                 10890099
109000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        10900099
109100         MOVE '4060-GET-PO-DC-ORD' TO DP013-PARAGRAPH             10910099
109200         MOVE 'MAXIMUM RETRIES EXCEEDED'                          10920099
109300                                   TO DP013-MESSAGE-TEXT (1)      10930099
109400         MOVE SQLCA                TO DP013-SQLCA                 10940099
109500         MOVE 'TPURITM '           TO DP013-DB2-TABLE-NAME (1)    10950099
109600         MOVE 'TALLPLN '           TO DP013-DB2-TABLE-NAME (2)    10960099
109700         SET DP013-DB2-ABEND                                      10970099
109800             DP013-XCTL-DISPLAY-RESTART                           10980099
109900                                   TO TRUE                        10990099
110000         PERFORM DP013-0000-PROCESS-ABEND                         11000099
110100     END-IF.                                                      11010099
110200                                                                  11020099
110300                                                                  11030099
110400 EJECT                                                            11040099
110500*----------------------------------------------------------------*11050099
110600* RETRIEVE THE RECEIVED QUANTITY FOR A DC.                       *11060099
110700*----------------------------------------------------------------*11070099
110800 4065-GET-PO-DC-REC.                                              11080099
110900                                                                  11090099
111000     MOVE +0                       TO PV-DC-REC-QTY.              11100099
111100                                                                  11110099
111200     PERFORM                                                      11120099
111300         WITH TEST AFTER                                          11130099
111400         VARYING PV-RETRY-COUNTER                                 11140099
111500         FROM 1 BY 1                                              11150099
111600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11160099
111700                   OR (SQLCODE = ZERO)                            11170099
111800                   OR (SQLCODE = 100))                            11180099
111900         EXEC SQL                                                 11190099
112000             SELECT SUM(AP_VERIFY_ITM_QTY)                        11200099
112100               INTO :PV-DC-REC-QTY:PV-QTY-NULL                    11210099
112200               FROM TRECITM A,                                    11220099
112300                    TRECDIS B                                     11230099
112400              WHERE                                               11240099
112500                    A.ORD_NBR        = :DK-PO-NUMBER              11250099
112600                AND A.VER_STATUS_CDE = 'A'                        11260099
112700                AND A.OPER_UNT_ID    = :PC-DCX                    11270099
112800                AND A.STATUS_CDE     = 'VE'                       11280099
112900                AND A.ORD_NBR        = B.ORD_NBR                  11290099
113000                AND A.ORD_LNE_NBR    = B.ORD_LNE_NBR              11300099
113100                AND A.REC_SEQ_NBR    = B.REC_SEQ_NBR              11310099
113200                AND A.OPER_UNT_ID    = B.OPER_UNT_ID              11320099
113300                AND A.FCLTY_ID       = B.FCLTY_ID                 11330099
113400                AND B.VER_STATUS_CDE = 'A'                        11340099
113500         END-EXEC                                                 11350099
113600                                                                  11360099
113700         EVALUATE TRUE                                            11370099
113800             WHEN SQLCODE = ZERO                                  11380099
113900                 CONTINUE                                         11390099
114000             WHEN SQLCODE = +100                                  11400099
114100                 CONTINUE                                         11410099
114200             WHEN SQLCODE = -904                                  11420099
114300             WHEN SQLCODE = -913                                  11430099
114400                 CONTINUE                                         11440099
114500             WHEN SQLWARN0 NOT = SPACES                           11450099
114600             WHEN SQLCODE < ZERO                                  11460099
114700             WHEN SQLCODE > ZERO                                  11470099
114800                 MOVE '4065-GET-PO-DC-REC'                        11480099
114900                                   TO DP013-PARAGRAPH             11490099
115000                 MOVE 'RETRIEVING RECEIVED QTY'                   11500099
115100                                   TO DP013-MESSAGE-TEXT (1)      11510099
115200                 MOVE SQLCA        TO DP013-SQLCA                 11520099
115300                 MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (1)    11530099
115400                 MOVE 'TRECDIS '   TO DP013-DB2-TABLE-NAME (2)    11540099
115500                 SET DP013-DB2-ABEND                              11550099
115600                     DP013-XCTL-DISPLAY-RESTART TO TRUE           11560099
115700                 PERFORM DP013-0000-PROCESS-ABEND                 11570099
115800         END-EVALUATE                                             11580099
115900     END-PERFORM.                                                 11590099
116000*                                                                 11600099
116100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11610099
116200         MOVE '4065-GET-PO-DC-REC'  TO DP013-PARAGRAPH            11620099
116300         MOVE 'MAXIMUM RETRIES EXCEEDED'                          11630099
116400                                   TO DP013-MESSAGE-TEXT (1)      11640099
116500         MOVE SQLCA                TO DP013-SQLCA                 11650099
116600         MOVE 'TRECITM '           TO DP013-DB2-TABLE-NAME (1)    11660099
116700         MOVE 'TRECDIS '           TO DP013-DB2-TABLE-NAME (2)    11670099
116800         SET DP013-DB2-ABEND                                      11680099
116900             DP013-XCTL-DISPLAY-RESTART                           11690099
117000                                   TO TRUE                        11700099
117100         PERFORM DP013-0000-PROCESS-ABEND                         11710099
117200     END-IF.                                                      11720099
117300*----------------------------------------------------------------*11730099
117400*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *11740099
117500*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *11750099
117600*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *11760099
117700*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *11770099
117800*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *11780099
117900*                                                                *11790099
118000*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *11800099
118100*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *11810099
118200*    UPON INITIALIZATION.                                        *11820099
118300*----------------------------------------------------------------*11830099
118400                                                                  11840099
118500 4300-READ-ITEMS-FROM-DB.                                         11850099
118600                                                                  11860099
118700     PERFORM                                                      11870099
118800         VARYING PV-READ-COUNT                                    11880099
118900         FROM 1 BY 1                                              11890099
119000         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    11900099
119100            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         11910099
119200                                                                  11920099
119300         PERFORM 4310-FETCH                                       11930099
119400                                                                  11940099
119500         IF  ASC-ITEMS-LEFT-ON-DB                                 11950099
119600             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                11960099
119700                 ADD +1            TO ASC-ITEM-SUB                11970099
119800             ELSE                                                 11980099
119900                 ADD +1            TO ASC-BLK-SUB                 11990099
120000                 MOVE +1           TO ASC-ITEM-SUB                12000099
120100                                                                  12010099
120200                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         12020099
120300                     MOVE +1       TO ASC-BLK-SUB                 12030099
120400                     SET ASC-BLOCK-MODIFIED (1)                   12040099
120500                                   TO TRUE                        12050099
120600                     PERFORM 5100-WRITE-TEMP-STORAGE              12060099
120700                     MOVE ASC-BLOCK-ENTRIES                       12070099
120800                               (PC-MAX-BLOCKS-IN-ARRAY)           12080099
120900                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 12090099
121000                     ADD +1        TO ASC-BLK-SUB                 12100099
121100                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   12110099
121200                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      12120099
121300                                   TO TRUE                        12130099
121400                 END-IF                                           12140099
121500             END-IF                                               12150099
121600             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    12160099
121700             MOVE ASC-NUMBER-OF-ITEMS-READ TO                     12170099
121800                   ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)12180099
121900             IF PURCHS-STATUS-CDE = 'FE' OR 'WK' OR 'PA' OR 'RJ'  12190099
122000                 MOVE PURITM-PO-LNE-NBR                           12200099
122100                                   TO ASC-LINE                    12210099
122200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12220099
122300             ELSE                                                 12230099
122400                 MOVE PURITM-APP-PO-LNE-NBR                       12240099
122500                                   TO ASC-LINE                    12250099
122600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12260099
122700             END-IF                                               12270099
122800             IF PV-SKU-NBR-IND = +0                               12280099
122900               MOVE XLT00004-MAJ-CL-NBR TO ASC-MCL                12290099
123000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 12300099
123100               MOVE XLT00004-SUB-CL-NBR TO ASC-SCL                12310099
123200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 12320099
123300               MOVE XLT00003-SKU-NBR    TO ASC-SKU                12330099
123400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 12340099
123500               MOVE XLT00003-SKU-DESC   TO ASC-DESC               12350099
123600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 12360099
123700             ELSE                                                 12370099
123800               MOVE ASC-KEY-DEPT        TO PV-TEMP-SKU-DEPT       12380099
123900               MOVE PURITM-CL-NBR       TO ASC-SCL                12390099
124000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 12400099
124100                                           PV-TEMP-SKU-CLASS      12410099
124200               MOVE PURITM-SKU-SEQ-NBR  TO PV-TEMP-SKU-SEQ        12420099
124300               MOVE PURITM-CL-NBR (1:1) TO PV-MAJ-CL-1            12430099
124400               MOVE PV-MAJ-CLASS        TO ASC-MCL                12440099
124410                                       (ASC-BLK-SUB ASC-ITEM-SUB) 12441099
124420               MOVE PV-SKU-NBR          TO ASC-SKU                12442099
124430                                       (ASC-BLK-SUB ASC-ITEM-SUB) 12443099
124440               MOVE PURITM-SKU-DESC     TO ASC-DESC               12444099
124450                                       (ASC-BLK-SUB ASC-ITEM-SUB) 12445099
124460             END-IF                                               12446099
124470             MOVE PURITM-UNT-QTY                                  12447099
124480                               TO ASC-QTY                         12448099
124490                                       (ASC-BLK-SUB ASC-ITEM-SUB) 12449099
124500     SET ASC-NOT-DC-END TO TRUE                                   12450099
124600     PERFORM VARYING PV-DC-COUNT                                  12460099
124700       FROM 1 BY 1                                                12470099
124800        UNTIL ASC-DC-END                                          12480099
124900                                                                  12490099
125000     MOVE ASC-DC-NBR(PV-DC-COUNT) TO PC-DCX                       12500099
125100     PERFORM 4320-GET-DC-SPLIT                                    12510099
125200     MOVE PV-DC-SPLIT-QTY TO                                      12520099
125300                  ASC-DC(ASC-BLK-SUB ASC-ITEM-SUB PV-DC-COUNT)    12530099
125400                                                                  12540099
125500     MOVE ASC-DC-NBR(PV-DC-COUNT) TO PC-DCX                       12550099
125600     PERFORM 4330-GET-DC-REC                                      12560099
125700     MOVE PV-DC-REC-QTY TO                                        12570099
125800                  ASC-REC-DC(ASC-BLK-SUB ASC-ITEM-SUB PV-DC-COUNT)12580099
125900     IF ASC-DC-NBR(PV-DC-COUNT) = 0                               12590099
126000* NO MORE DCS, GET OUT OF LOOP.                                   12600099
126100        SET ASC-DC-END TO TRUE                                    12610099
126200     END-IF                                                       12620099
126300                                                                  12630099
126400     IF PV-DC-COUNT >  9                                          12640099
126500        SET ASC-DC-END TO TRUE                                    12650099
126600     END-IF                                                       12660099
126700     END-PERFORM                                                  12670099
126800                                                                  12680099
126900             MOVE PURITM-STATUS-CDE      TO                       12690099
127000                      ASC-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)       12700099
127100             PERFORM 4360-GET-TOT-REC                             12710099
127200             MOVE PV-TOT-REC-QTY                                  12720099
127300                               TO ASC-REC-QTY                     12730099
127400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 12740099
127500             ADD PV-TOT-REC-QTY TO PV-END-QTY-REC                 12750099
127600                    GIVING PV-END-QTY-REC                         12760099
127700         IF ASC-QTY (ASC-BLK-SUB ASC-ITEM-SUB) = ZEROS            12770099
127800           MOVE ZEROS TO ASC-REC-PCT (ASC-BLK-SUB ASC-ITEM-SUB)   12780099
127900         ELSE                                                     12790099
128000           COMPUTE ASC-REC-PCT (ASC-BLK-SUB ASC-ITEM-SUB)         12800099
128100                    ROUNDED =                                     12810099
128200               (ASC-REC-QTY (ASC-BLK-SUB ASC-ITEM-SUB) /          12820099
128300               ASC-QTY    (ASC-BLK-SUB ASC-ITEM-SUB))             12830099
128400           COMPUTE ASC-REC-PCT (ASC-BLK-SUB ASC-ITEM-SUB) =       12840099
128500               ASC-REC-PCT (ASC-BLK-SUB ASC-ITEM-SUB) * 100       12850099
128600            IF ASC-REC-PCT (ASC-BLK-SUB ASC-ITEM-SUB) = 0         12860099
128700           AND ASC-REC-QTY (ASC-BLK-SUB ASC-ITEM-SUB) > 0         12870099
128800              MOVE 1 TO ASC-REC-PCT                               12880099
128900                           (ASC-BLK-SUB ASC-ITEM-SUB)             12890099
129000            END-IF                                                12900099
129100         END-IF                                                   12910099
129200      END-IF                                                      12920099
129300     END-PERFORM.                                                 12930099
129400                                                                  12940099
129500     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          12950099
129600         MOVE +1               TO ASC-BLK-SUB                     12960099
129700         PERFORM 5100-WRITE-TEMP-STORAGE                          12970099
129800         ADD +1                TO ASC-BLK-SUB                     12980099
129900         PERFORM 5100-WRITE-TEMP-STORAGE                          12990099
130000                                                                  13000099
130100         MOVE 1                TO ASC-BLK-SUB                     13010099
130200                                  PV-BLOCK-NUMBER                 13020099
130300         PERFORM 4410-READ-TEMP-STORAGE                           13030099
130400         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             13040099
130500             MOVE 2            TO ASC-BLK-SUB                     13050099
130600                                  PV-BLOCK-NUMBER                 13060099
130700             PERFORM 4410-READ-TEMP-STORAGE                       13070099
130800         END-IF                                                   13080099
130900     END-IF.                                                      13090099
131000 EJECT                                                            13100099
131100*----------------------------------------------------------------*13110099
131200*    FETCH THE MESSAGE CURSOR.                                   *13120099
131300*----------------------------------------------------------------*13130099
131400                                                                  13140099
131500 4310-FETCH.                                                      13150099
131600                                                                  13160099
131700     EXEC SQL                                                     13170099
131800          FETCH LINE-CSR1                                         13180099
131900                INTO  :PURCHS-PO-NBR                              13190099
132000                    , :PURCHS-TOT-UNT-QTY                         13200099
132100                    , :PURCHS-STATUS-CDE                          13210099
132200                    , :PURITM-STATUS-CDE                          13220099
132300                    , :PURITM-APP-PO-LNE-NBR                      13230099
132400                    , :PURITM-PO-LNE-NBR                          13240099
132500                    , :XLT00004-MAJ-CL-NBR:PV-MAJ-CL-NBR-IND      13250099
132600                    , :XLT00004-SUB-CL-NBR:PV-SUB-CL-NBR-IND      13260099
132700                    , :XLT00003-SKU-NBR:PV-SKU-NBR-IND            13270099
132800                    , :XLT00003-SKU-DESC:PV-SKU-DESC-IND          13280099
132900                    , :PURITM-CL-NBR                              13290099
133000                    , :PURITM-SKU-SEQ-NBR                         13300099
133100                    , :PURITM-SKU-DESC                            13310099
133200                    , :PURITM-UNT-QTY                             13320099
133300     END-EXEC.                                                    13330099
133400                                                                  13340099
133500     EVALUATE TRUE                                                13350099
133600         WHEN SQLCODE = ZERO                                      13360099
133700         WHEN SQLCODE = +100                                      13370099
133800              CONTINUE                                            13380099
133900         WHEN SQLWARN0 NOT = SPACE                                13390099
134000         WHEN SQLCODE NOT = ZERO                                  13400099
134100              MOVE '4310-FETCH-CURSOR'                            13410099
134200                               TO DP013-PARAGRAPH                 13420099
134300              MOVE 'FETCH LINE CURSOR'                            13430099
134400                               TO DP013-MESSAGE-TEXT (1)          13440099
134500              MOVE SQLCA       TO DP013-SQLCA                     13450099
134600              SET DP013-DB2-ABEND                                 13460099
134700                               TO TRUE                            13470099
134800              PERFORM DP013-0000-PROCESS-ABEND                    13480099
134900     END-EVALUATE.                                                13490099
135000                                                                  13500099
135100     IF  SQLCODE EQUAL +100                                       13510099
135200         SET ASC-NO-ITEMS-LEFT-ON-DB                              13520099
135300                                   TO TRUE                        13530099
135400     END-IF.                                                      13540099
135500                                                                  13550099
135600 EJECT                                                            13560099
135700*----------------------------------------------------------------*13570099
135800* RETRIEVE THE ORDER QUANTITY FOR A DC. (LINE)                   *13580099
135900*----------------------------------------------------------------*13590099
136000 4320-GET-DC-SPLIT.                                               13600099
136100                                                                  13610099
136200     PERFORM                                                      13620099
136300         WITH TEST AFTER                                          13630099
136400         VARYING PV-RETRY-COUNTER                                 13640099
136500         FROM 1 BY 1                                              13650099
136600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13660099
136700                   OR (SQLCODE = ZERO)                            13670099
136800                   OR (SQLCODE = 100))                            13680099
136900         EXEC SQL                                                 13690099
137000             SELECT CURR_SPLIT_QTY                                13700099
137100               INTO :PV-DC-SPLIT-QTY                              13710099
137200               FROM TALLPLN                                       13720099
137300              WHERE                                               13730099
137400                    PO_NBR     = :DK-PO-NUMBER                    13740099
137500                AND PO_LNE_NBR = :PURITM-PO-LNE-NBR               13750099
137600                AND DEST_NBR   = :PC-DCX                          13760099
137700         END-EXEC                                                 13770099
137800                                                                  13780099
137900         EVALUATE TRUE                                            13790099
138000             WHEN SQLCODE = ZERO                                  13800099
138100                 CONTINUE                                         13810099
138200             WHEN SQLCODE = +100                                  13820099
138300                 MOVE +0         TO PV-DC-SPLIT-QTY               13830099
138400             WHEN SQLCODE = -904                                  13840099
138500             WHEN SQLCODE = -913                                  13850099
138600                 CONTINUE                                         13860099
138700             WHEN SQLWARN0 NOT = SPACES                           13870099
138800             WHEN SQLCODE < ZERO                                  13880099
138900             WHEN SQLCODE > ZERO                                  13890099
139000                 MOVE '4320-GET-DC-SPLIT'                         13900099
139100                                   TO DP013-PARAGRAPH             13910099
139200                 MOVE 'RETRIEVING TALLPLN'                        13920099
139300                                   TO DP013-MESSAGE-TEXT (1)      13930099
139400                 MOVE SQLCA        TO DP013-SQLCA                 13940099
139500                 MOVE 'TALLPLN '   TO DP013-DB2-TABLE-NAME (1)    13950099
139600                 SET DP013-DB2-ABEND                              13960099
139700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           13970099
139800                 PERFORM DP013-0000-PROCESS-ABEND                 13980099
139900         END-EVALUATE                                             13990099
140000     END-PERFORM.                                                 14000099
140100*                                                                 14010099
140200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        14020099
140300         MOVE '4320-GET-DC-SPLIT' TO DP013-PARAGRAPH              14030099
140400         MOVE 'MAXIMUM RETRIES EXCEEDED'                          14040099
140500                                   TO DP013-MESSAGE-TEXT (1)      14050099
140600         MOVE SQLCA                TO DP013-SQLCA                 14060099
140700         MOVE 'TALLPLN '           TO DP013-DB2-TABLE-NAME (1)    14070099
140800         SET DP013-DB2-ABEND                                      14080099
140900             DP013-XCTL-DISPLAY-RESTART                           14090099
141000                                   TO TRUE                        14100099
141100         PERFORM DP013-0000-PROCESS-ABEND                         14110099
141200     END-IF.                                                      14120099
141300*----------------------------------------------------------------*14130099
141400* RETRIEVE THE RECEIVED QUANTITY FOR A DC.(LINE)                 *14140099
141500*----------------------------------------------------------------*14150099
141600 4330-GET-DC-REC.                                                 14160099
141700                                                                  14170099
141800     MOVE +0                       TO PV-DC-REC-QTY.              14180099
141900                                                                  14190099
142000     PERFORM                                                      14200099
142100         WITH TEST AFTER                                          14210099
142200         VARYING PV-RETRY-COUNTER                                 14220099
142300         FROM 1 BY 1                                              14230099
142400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14240099
142500                   OR (SQLCODE = ZERO)                            14250099
142600                   OR (SQLCODE = 100))                            14260099
142700         EXEC SQL                                                 14270099
142800             SELECT SUM(AP_VERIFY_ITM_QTY)                        14280099
142900               INTO :PV-DC-REC-QTY:PV-QTY-NULL                    14290099
143000               FROM TRECITM A,                                    14300099
143100                    TRECDIS B                                     14310099
143200              WHERE                                               14320099
143300                    A.ORD_NBR        = :DK-PO-NUMBER              14330099
143400                AND A.ORD_LNE_NBR    = :PURITM-APP-PO-LNE-NBR     14340099
143500                AND A.VER_STATUS_CDE = 'A'                        14350099
143600                AND A.OPER_UNT_ID    = :PC-DCX                    14360099
143700                AND A.STATUS_CDE     = 'VE'                       14370099
143800                AND A.ORD_NBR        = B.ORD_NBR                  14380099
143900                AND A.ORD_LNE_NBR    = B.ORD_LNE_NBR              14390099
144000                AND A.REC_SEQ_NBR    = B.REC_SEQ_NBR              14400099
144100                AND A.OPER_UNT_ID    = B.OPER_UNT_ID              14410099
144200                AND A.FCLTY_ID       = B.FCLTY_ID                 14420099
144300                AND B.VER_STATUS_CDE = 'A'                        14430099
144400         END-EXEC                                                 14440099
144500                                                                  14450099
144600         EVALUATE TRUE                                            14460099
144700             WHEN SQLCODE = ZERO                                  14470099
144800                 CONTINUE                                         14480099
144900             WHEN SQLCODE = +100                                  14490099
145000                 CONTINUE                                         14500099
145100             WHEN SQLCODE = -904                                  14510099
145200             WHEN SQLCODE = -913                                  14520099
145300                 CONTINUE                                         14530099
145400             WHEN SQLWARN0 NOT = SPACES                           14540099
145500             WHEN SQLCODE < ZERO                                  14550099
145600             WHEN SQLCODE > ZERO                                  14560099
145700                 MOVE '4330-GET-DC-REC'                           14570099
145800                                   TO DP013-PARAGRAPH             14580099
145900                 MOVE 'RETRIEVING RECEIVED QTY'                   14590099
146000                                   TO DP013-MESSAGE-TEXT (1)      14600099
146100                 MOVE SQLCA        TO DP013-SQLCA                 14610099
146200                 MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (1)    14620099
146300                 MOVE 'TRECDIS '   TO DP013-DB2-TABLE-NAME (2)    14630099
146400                 SET DP013-DB2-ABEND                              14640099
146500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           14650099
146600                 PERFORM DP013-0000-PROCESS-ABEND                 14660099
146700         END-EVALUATE                                             14670099
146800     END-PERFORM.                                                 14680099
146900*                                                                 14690099
147000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        14700099
147100         MOVE '4330-GET-DC-REC' TO DP013-PARAGRAPH                14710099
147200         MOVE 'MAXIMUM RETRIES EXCEEDED'                          14720099
147300                                   TO DP013-MESSAGE-TEXT (1)      14730099
147400         MOVE SQLCA                TO DP013-SQLCA                 14740099
147500         MOVE 'TRECITM '           TO DP013-DB2-TABLE-NAME (1)    14750099
147600         MOVE 'TRECDIS '           TO DP013-DB2-TABLE-NAME (2)    14760099
147700         SET DP013-DB2-ABEND                                      14770099
147800             DP013-XCTL-DISPLAY-RESTART                           14780099
147900                                   TO TRUE                        14790099
148000         PERFORM DP013-0000-PROCESS-ABEND                         14800099
148100     END-IF.                                                      14810099
148200*----------------------------------------------------------------*14820099
148300* RETRIEVE THE TOTAL RECEIVED QUANTITY. (LINE)                   *14830099
148400*----------------------------------------------------------------*14840099
148500 4360-GET-TOT-REC.                                                14850099
148600                                                                  14860099
148700     MOVE +0                     TO PV-TOT-REC-QTY.               14870099
148800                                                                  14880099
148900     PERFORM                                                      14890099
149000         WITH TEST AFTER                                          14900099
149100         VARYING PV-RETRY-COUNTER                                 14910099
149200         FROM 1 BY 1                                              14920099
149300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14930099
149400                   OR (SQLCODE = ZERO)                            14940099
149500                   OR (SQLCODE = 100))                            14950099
149600         EXEC SQL                                                 14960099
149700             SELECT SUM(AP_VERIFY_ITM_QTY)                        14970099
149800               INTO :PV-TOT-REC-QTY:PV-QTY-NULL                   14980099
149900               FROM TRECITM A,                                    14990099
150000                    TRECDIS B                                     15000099
150100              WHERE                                               15010099
150200                    A.ORD_NBR        = :DK-PO-NUMBER              15020099
150300                AND A.ORD_LNE_NBR    = :PURITM-APP-PO-LNE-NBR     15030099
150400                AND A.VER_STATUS_CDE = 'A'                        15040099
150500                AND A.STATUS_CDE     = 'VE'                       15050099
150600                AND A.ORD_NBR        = B.ORD_NBR                  15060099
150700                AND A.ORD_LNE_NBR    = B.ORD_LNE_NBR              15070099
150800                AND A.REC_SEQ_NBR    = B.REC_SEQ_NBR              15080099
150900                AND A.OPER_UNT_ID    = B.OPER_UNT_ID              15090099
151000                AND A.FCLTY_ID       = B.FCLTY_ID                 15100099
151100                AND B.VER_STATUS_CDE = 'A'                        15110099
151200         END-EXEC                                                 15120099
151300                                                                  15130099
151400         EVALUATE TRUE                                            15140099
151500             WHEN SQLCODE = ZERO                                  15150099
151600                 CONTINUE                                         15160099
151700             WHEN SQLCODE = +100                                  15170099
151800                 MOVE +0         TO PV-TOT-REC-QTY                15180099
151900             WHEN SQLCODE = -904                                  15190099
152000             WHEN SQLCODE = -913                                  15200099
152100                 CONTINUE                                         15210099
152200             WHEN SQLWARN0 NOT = SPACES                           15220099
152300             WHEN SQLCODE < ZERO                                  15230099
152400             WHEN SQLCODE > ZERO                                  15240099
152500                 MOVE '4360-GET-TOT-REC'                          15250099
152600                                   TO DP013-PARAGRAPH             15260099
152700                 MOVE 'RETRIEVING RECEIVED QTY'                   15270099
152800                                   TO DP013-MESSAGE-TEXT (1)      15280099
152900                 MOVE SQLCA        TO DP013-SQLCA                 15290099
153000                 MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (1)    15300099
153100                 MOVE 'TRECDIS '   TO DP013-DB2-TABLE-NAME (2)    15310099
153200                 SET DP013-DB2-ABEND                              15320099
153300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15330099
153400                 PERFORM DP013-0000-PROCESS-ABEND                 15340099
153500         END-EVALUATE                                             15350099
153600     END-PERFORM.                                                 15360099
153700*                                                                 15370099
153800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15380099
153900         MOVE '4360-GET-TOT-REC'   TO DP013-PARAGRAPH             15390099
154000         MOVE 'MAXIMUM RETRIES EXCEEDED'                          15400099
154100                                   TO DP013-MESSAGE-TEXT (1)      15410099
154200         MOVE SQLCA                TO DP013-SQLCA                 15420099
154300         MOVE 'TRECITM '           TO DP013-DB2-TABLE-NAME (1)    15430099
154400         MOVE 'TRECDIS '           TO DP013-DB2-TABLE-NAME (2)    15440099
154500         SET DP013-DB2-ABEND                                      15450099
154600             DP013-XCTL-DISPLAY-RESTART                           15460099
154700                                   TO TRUE                        15470099
154800         PERFORM DP013-0000-PROCESS-ABEND                         15480099
154900     END-IF.                                                      15490099
155000*----------------------------------------------------------------*15500099
155100* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *15510099
155200*----------------------------------------------------------------*15520099
155300                                                                  15530099
155400 4400-MOVE-COMMAREA-TO-SCREEN.                                    15540099
155500                                                                  15550099
155600     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             15560099
155700         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          15570099
155800         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          15580099
155900             MOVE +1    TO ASC-BLK-SUB                            15590099
156000             PERFORM 5100-WRITE-TEMP-STORAGE                      15600099
156100             ADD +1     TO ASC-BLK-SUB                            15610099
156200             PERFORM 5100-WRITE-TEMP-STORAGE                      15620099
156300             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             15630099
156400                 GIVING PV-BLOCK-NUMBER                           15640099
156500                 REMAINDER PV-REMAINDER                           15650099
156600             IF  PV-REMAINDER > ZERO                              15660099
156700                 ADD +1 TO PV-BLOCK-NUMBER                        15670099
156800             END-IF                                               15680099
156900             MOVE +1    TO ASC-BLK-SUB                            15690099
157000             PERFORM 4410-READ-TEMP-STORAGE                       15700099
157100             ADD +1     TO ASC-BLK-SUB                            15710099
157200                           PV-BLOCK-NUMBER                        15720099
157300             PERFORM 4410-READ-TEMP-STORAGE                       15730099
157400     END-IF.                                                      15740099
157500     MOVE +1            TO ASC-BLK-SUB.                           15750099
157600     COMPUTE ASC-ITEM-SUB =                                       15760099
157700         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              15770099
157800         + PC-ITEMS-PER-PANEL).                                   15780099
157900*                                                                 15790099
158000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        15800099
158100         ADD +1         TO ASC-BLK-SUB                            15810099
158200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            15820099
158300     END-IF.                                                      15830099
158400*                                                                 15840099
158500     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           15850099
158600         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                15860099
158700     MOVE SPACE TO PV-NORMAL-LINE PV-DC1-LINE PV-NORMAL-TOTALS    15870099
158800                                              PV-DC-TOTALS.       15880099
158810     IF PO011-LAST-PO-LNE-NBR = ZEROS                             15881099
158820         CONTINUE                                                 15882099
158830     ELSE                                                         15883099
158831         MOVE PO011-PO-LNE-NBR TO PV-TOP-ITEM                     15883199
158832         MOVE ZEROS TO ASC-ITEM-AT-BOT-OF-PANEL                   15883299
158833     END-IF.                                                      15883399
158834                                                                  15883499
158835     PERFORM 4420-FORMAT-LIST-LINES                               15883599
158836         VARYING PV-SUB                                           15883699
158837         FROM PC-ITEMS-PER-PANEL BY -1                            15883799
158838         UNTIL PV-SUB < +1.                                       15883899
158839*                                                                 15883999
158840     COMPUTE ASC-ITEMS-DISPLAYED =                                15884099
158850         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          15885099
158860     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    15886099
158870                                      ASTRTITO.                   15887099
158880     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    15888099
158890     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    15889099
158900*                                                                 15890099
159000*    IF ASC-DISPLAY-QTY                                           15900099
159100*         MOVE PC-QTY-HEAD       TO MR-HEAD1                      15910099
159200*         MOVE PC-QTY-HEAD2      TO MR-HEAD2                      15920099
159300*         MOVE ASC-TOT-ORD       TO PV-TOT-ORD                    15930099
159400*         MOVE ASC-TOT-REC       TO PV-TOT-REC                    15940099
159500*         MOVE ASC-TOT-PCT-N     TO PV-TREC-PCT                   15950099
159600*         MOVE ASC-TOT-PCT-SIGN  TO PV-TREC-PCT-SIGN              15960099
159700*         MOVE PV-NORMAL-TOTALS  TO MR-TOTAL-LINE                 15970099
159800*     ELSE                                                        15980099
159900*      IF ASC-DISPLAY-DC                                          15990099
160000         IF ASC-DC-COUNTER < +1                                   16000099
160100             MOVE +1 TO ASC-DC-COUNTER                            16010099
160200         END-IF                                                   16020099
160300         MOVE ASC-TOT-ORD       TO PV-TOT-ORD2                    16030099
160400         MOVE ASC-TOT-REC       TO PV-TOT-REC2                    16040099
160500         MOVE ASC-TOT-PCT-N     TO PV-TREC-PCT2                   16050099
160600         MOVE ASC-TOT-PCT-SIGN   TO PV-TREC-PCT-SIGN2             16060099
160700         MOVE ASC-TOT-DC-ORD(ASC-DC-COUNTER) TO PV-TOT-DC1-ORD    16070099
160800         MOVE ASC-TOT-DC-REC(ASC-DC-COUNTER) TO PV-TOT-DC1-REC    16080099
160900         MOVE ASC-TOT-DC-ORD(ASC-DC-COUNTER + 1) TO PV-TOT-DC2-ORD16090099
161000         MOVE ASC-TOT-DC-REC(ASC-DC-COUNTER + 1) TO PV-TOT-DC2-REC16100099
161100         MOVE ASC-TOT-DC-ORD(ASC-DC-COUNTER + 2) TO PV-TOT-DC3-ORD16110099
161200         MOVE ASC-TOT-DC-REC(ASC-DC-COUNTER + 2) TO PV-TOT-DC3-REC16120099
161300         MOVE PV-DC-TOTALS TO MR-TOTAL-LINE                       16130099
161400         MOVE PC-HEADA          TO PC-DC1-HEADA                   16140099
161500         MOVE ASC-DC-NAME(ASC-DC-COUNTER) TO PC-DC1-HEADB         16150099
161600         MOVE ASC-DC-NAME(ASC-DC-COUNTER) TO PC-DC1-HEADC         16160099
161700         MOVE ASC-DC-NAME(ASC-DC-COUNTER + 1) TO PC-DC1-HEADD     16170099
161800         MOVE ASC-DC-NAME(ASC-DC-COUNTER + 1) TO PC-DC1-HEADE     16180099
161900         MOVE ASC-DC-NAME(ASC-DC-COUNTER + 2) TO PC-DC1-HEADF     16190099
162000         MOVE ASC-DC-NAME(ASC-DC-COUNTER + 2) TO PC-DC1-HEADG     16200099
162100         MOVE PC-DC1-HEAD       TO MR-HEAD1                       16210099
162200         MOVE PC-HEADB          TO PC-HEAD-NAMEB                  16220099
162300          IF ASC-DC-NAME(ASC-DC-COUNTER) = SPACES                 16230099
162400            MOVE SPACES TO PC-HEAD-DC10                           16240099
162500          ELSE                                                    16250099
162600            MOVE PC-HEAD-DC1 TO PC-HEAD-DC10                      16260099
162700          END-IF                                                  16270099
162800          IF ASC-DC-NAME(ASC-DC-COUNTER + 1) = SPACES             16280099
162900            MOVE SPACES TO PC-HEAD-DC20                           16290099
163000          ELSE                                                    16300099
163100            MOVE PC-HEAD-DC2 TO PC-HEAD-DC20                      16310099
163200          END-IF                                                  16320099
163300          IF ASC-DC-NAME(ASC-DC-COUNTER + 2) = SPACES             16330099
163400            MOVE SPACES TO PC-HEAD-DC30                           16340099
163500          ELSE                                                    16350099
163600            MOVE PC-HEAD-DC3 TO PC-HEAD-DC30                      16360099
163700          END-IF                                                  16370099
163800          MOVE PC-DC1-HEAD2      TO MR-HEAD2                      16380099
163900*      END-IF.                                                    16390099
164000                                                                  16400099
164100     IF  DP020-MSG-NUMBER-X = SPACE                               16410099
164200         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  16420099
164300*            --- MORE ITEMS TO DISPLAY ----                       16430099
164400             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            16440099
164500             SET DP020-MSG-INFORMATIONAL TO TRUE                  16450099
164600         END-IF                                                   16460099
164700     END-IF.                                                      16470099
164800                                                                  16480099
164900     MOVE ASC-KEY-PO-NUMBER        TO APONUMO.                    16490099
165000     MOVE ASC-KEY-DEPT             TO ADEPTO.                     16500099
165100     MOVE ASC-KEY-VENDOR           TO AVENDNMO.                   16510099
165200                                                                  16520099
165300*----------------------------------------------------------------*16530099
165400*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *16540099
165500*----------------------------------------------------------------*16550099
165600                                                                  16560099
165700 4410-READ-TEMP-STORAGE.                                          16570099
165800                                                                  16580099
165900     EXEC CICS                                                    16590099
166000         READQ TS                                                 16600099
166100             QUEUE (ASC-LIST-QUEUE-NAME)                          16610099
166200             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               16620099
166300             ITEM  (PV-BLOCK-NUMBER)                              16630099
166400             RESP  (PV-CICS-RESP)                                 16640099
166500     END-EXEC.                                                    16650099
166600                                                                  16660099
166700     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       16670099
166800       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     16680099
166900         CONTINUE                                                 16690099
167000     ELSE                                                         16700099
167100         SET DP013-CICS-ABEND     TO TRUE                         16710099
167200         SET DP013-NO-ROLLBACK    TO TRUE                         16720099
167300         MOVE '4410-READ-TEMP-STORAGE'                            16730099
167400                                  TO DP013-PARAGRAPH              16740099
167500         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      16750099
167600                                  TO DP013-MESSAGE-TEXT(1)        16760099
167700         PERFORM DP013-0000-PROCESS-ABEND                         16770099
167800     END-IF.                                                      16780099
167900                                                                  16790099
168000     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             16800099
168100*                                                                 16810099
168200     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         16820099
168300         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               16830099
168400     END-IF.                                                      16840099
168500 EJECT                                                            16850099
168600*----------------------------------------------------------------*16860099
168700*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *16870099
168800*----------------------------------------------------------------*16880099
168900                                                                  16890099
169000 4420-FORMAT-LIST-LINES.                                          16900099
169100                                                                  16910099
169200         IF  PO011-LAST-PO-LNE-NBR = ZEROS                        16920099
169300             CONTINUE                                             16930099
169400         ELSE                                                     16940099
169500             IF PO011-BLOCK-NUMBER    = 1                         16950099
169600                CONTINUE                                          16960099
169700             ELSE                                                 16970099
169800                 MOVE ZEROS TO PV-DETERMINE-CNT                   16980099
169900                 MOVE ZEROS TO PV-TEST-CNT                        16990099
169901                 MOVE ZEROS TO PV-BLOCK-NUMBER                    16990199
169902                 PERFORM 4421-GET-TEMP-STORAGE                    16990299
169903                 UNTIL PV-TEST-CNT > +999                         16990399
169904                     IF PO011-BLK-SUB = +2                        16990499
169905                         DIVIDE PV-BLOCK-NUMBER BY 2              16990599
169906                         GIVING PV-BLOCK-NUMBER-1                 16990699
169907                         REMAINDER PV-REMAINDER                   16990799
169908                         IF  PV-REMAINDER > ZERO                  16990899
169909                             ADD 1 TO PV-BLOCK-NUMBER             16990999
169910                             MOVE +2 TO ASC-BLK-SUB               16991099
169920                             PERFORM 4410-READ-TEMP-STORAGE       16992099
169930                         ELSE                                     16993099
169940                             IF PV-DETERMINE-CNT = +1             16994099
169950                                 MOVE ASC-BLOCK-ENTRIES (1)       16995099
169951                                   TO ASC-BLOCK-ENTRIES (2)       16995199
169952                                 SUBTRACT 1 FROM PV-BLOCK-NUMBER  16995299
169953                                 MOVE +1 TO ASC-BLK-SUB           16995399
169954                                 PERFORM 4410-READ-TEMP-STORAGE   16995499
169955                             ELSE                                 16995599
169956                                 ADD 1 TO PV-BLOCK-NUMBER         16995699
169957                                 MOVE +2 TO ASC-BLK-SUB           16995799
169958                                 PERFORM 4410-READ-TEMP-STORAGE   16995899
169959                             END-IF                               16995999
169960                         END-IF                                   16996099
169961                     ELSE                                         16996199
169962                         IF PV-BLOCK-NUMBER = PO011-BLOCK-NUMBER  16996299
169963                             CONTINUE                             16996399
169964                         ELSE                                     16996499
169965                             ADD 1 TO PV-BLOCK-NUMBER             16996599
169966                             MOVE +2 TO ASC-BLK-SUB               16996699
169967                             PERFORM 4410-READ-TEMP-STORAGE       16996799
169968                         END-IF                                   16996899
169969                     END-IF                                       16996999
169970             END-IF                                               16997099
169971         END-IF                                                   16997199
169972                                                                  16997299
169973     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      16997399
169974         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                16997499
169975         MOVE SPACE              TO MR-LINE-X (PV-SUB)            16997599
169976                                    MR-MCL    (PV-SUB)            16997699
169977                                    MR-SCL    (PV-SUB)            16997799
169978                                    MR-SKU-NBR (PV-SUB)           16997899
169979                                    MR-LINE-AREA (PV-SUB)         16997999
169980                                    MR-TOTAL-LINE                 16998099
169990     ELSE                                                         16999099
170000*                                                                 17000099
170100         IF  DP030-SET-CURSOR-TRAILER                             17010099
170200             IF (PV-SUB = 1)                                      17020099
170300                SET DP030-SET-CURSOR-APPL-1 TO TRUE               17030099
170400             END-IF                                               17040099
170500         END-IF                                                   17050099
170600*                                                                 17060099
170700                                                                  17070099
170800         IF  PO011-LAST-PO-LNE-NBR = ZEROS                        17080099
170900             CONTINUE                                             17090099
171000         ELSE                                                     17100099
171100                 MOVE ZEROS TO PV-DETERMINE-CNTA                  17110099
171200                 MOVE ZEROS TO PV-DETERMINE-CNTB                  17120099
171300                 MOVE 'N' TO PV-HIT-SW                            17130099
171400                 PERFORM WITH TEST AFTER                          17140099
171410                 VARYING PV-TEST-CNT FROM 1 BY 1                  17141099
171420                 UNTIL PV-TEST-CNT > 6                            17142099
171430                 IF ASC-LINE (1 PV-TEST-CNT) = PO011-PO-LNE-NBR   17143099
171431                      MOVE 'Y' TO PV-HIT-SW                       17143199
171432                 END-IF                                           17143299
171433                 IF PV-HIT-SW = 'Y'                               17143399
171434                 AND ASC-LINE (1 PV-TEST-CNT) > +0                17143499
171435                     ADD 1 TO PV-DETERMINE-CNTA                   17143599
171436                      MOVE ASC-LINE (1 PV-TEST-CNT)               17143699
171437                        TO PV-DETERMINE-CNTB                      17143799
171438                 END-IF                                           17143899
171439                 END-PERFORM                                      17143999
171440                 IF PV-DETERMINE-CNTA > 6                         17144099
171441                     CONTINUE                                     17144199
171442                 ELSE                                             17144299
171443                 PERFORM WITH TEST AFTER                          17144399
171444                 VARYING PV-TEST-CNT FROM 1 BY 1                  17144499
171445                 UNTIL PV-TEST-CNT > 6                            17144599
171446                    OR PV-DETERMINE-CNTA = 7                      17144699
171447                 IF ASC-LINE (2, PV-TEST-CNT) = PO011-PO-LNE-NBR  17144799
171448                 AND PV-HIT-SW = 'N'                              17144899
171449                      MOVE 'Y' TO PV-HIT-SW                       17144999
171450                      MOVE PO011-PO-LNE-NBR TO PV-DETERMINE-CNTB  17145099
171451                      ADD 1 TO PV-DETERMINE-CNTA                  17145199
171452                 END-IF                                           17145299
171453                 IF PV-HIT-SW = 'Y'                               17145399
171454                 AND ASC-LINE (2 PV-TEST-CNT) > +0                17145499
171455                 AND ASC-LINE (2 PV-TEST-CNT) > PV-DETERMINE-CNTB 17145599
171456                     ADD 1 TO PV-DETERMINE-CNTA                   17145699
171457                 END-IF                                           17145799
171458                 END-PERFORM                                      17145899
171459                 END-IF                                           17145999
171460         END-IF                                                   17146099
171461                                                                  17146199
171462         IF  PO011-LAST-PO-LNE-NBR = ZEROS                        17146299
171463             CONTINUE                                             17146399
171464         ELSE                                                     17146499
171465             MOVE PO011-BLK-SUB TO ASC-BLK-SUB                    17146599
171466             MOVE PO011-ITEM-SUB TO ASC-ITEM-SUB                  17146699
171467             IF PO011-BLK-SUB > +1                                17146799
171468                 MOVE ZEROS TO PV-DETERMINE-CNT1                  17146899
171469                 PERFORM WITH TEST AFTER                          17146999
171470                 VARYING PV-TEST-CNT FROM 1 BY 1                  17147099
171471                 UNTIL PV-TEST-CNT > 7                            17147199
171472                 IF ASC-LINE (PO011-BLK-SUB PV-TEST-CNT)          17147299
171473                     = ZEROS                                      17147399
171474                     ADD 1 TO PV-DETERMINE-CNT1                   17147499
171475                 END-IF                                           17147599
171476                 END-PERFORM                                      17147699
171477                 IF PV-DETERMINE-CNT1 = ZEROS                     17147799
171478                     CONTINUE                                     17147899
171479                 ELSE                                             17147999
171480                     IF PV-BLOCK-NUMBER = PV-HIGHEST-BLOCK-WRITTEN17148099
171481                         COMPUTE PV-DETERMINE-ITEM1 =             17148199
171482                                 PV-DETERMINE-ITEM -              17148299
171483                                 PV-DETERMINE-CNT                 17148399
171484                         END-COMPUTE                              17148499
171485                         IF PV-DETERMINE-ITEM1 = ZEROS            17148599
171486                            MOVE 6 TO PV-SUB                      17148699
171487                         END-IF                                   17148799
171488                         IF PV-DETERMINE-ITEM1 = +1               17148899
171489                            MOVE 5 TO PV-SUB                      17148999
171490                         END-IF                                   17149099
171491                         IF PV-DETERMINE-ITEM1 = +2               17149199
171492                            MOVE 4 TO PV-SUB                      17149299
171493                         END-IF                                   17149399
171494                         IF PV-DETERMINE-ITEM1 = +3               17149499
171495                            MOVE 3 TO PV-SUB                      17149599
171496                         END-IF                                   17149699
171497                         IF PV-DETERMINE-ITEM1 = +4               17149799
171498                            MOVE 2 TO PV-SUB                      17149899
171499                         END-IF                                   17149999
171500                         IF PV-DETERMINE-ITEM1 = +5               17150099
171501                            MOVE 1 TO PV-SUB                      17150199
171502                         END-IF                                   17150299
171503                     ELSE                                         17150399
171504                         IF PV-BLOCK-NUMBER >                     17150499
171505                            PV-HIGHEST-BLOCK-WRITTEN              17150599
171506                         MOVE PV-DETERMINE-CNT TO PV-SUB          17150699
171507                         ELSE                                     17150799
171508*                        SUBTRACT PV-DETERMINE-CNT FROM PV-SUB    17150899
171509                         IF PV-DETERMINE-CNT = ZEROS              17150999
171510                            MOVE 6 TO PV-SUB                      17151099
171511                         END-IF                                   17151199
171512                         IF PV-DETERMINE-CNT = +1                 17151299
171513                            MOVE 5 TO PV-SUB                      17151399
171514                         END-IF                                   17151499
171515                         IF PV-DETERMINE-CNT = +2                 17151599
171516                            MOVE 4 TO PV-SUB                      17151699
171517                         END-IF                                   17151799
171518                         IF PV-DETERMINE-CNT = +3                 17151899
171519                            MOVE 3 TO PV-SUB                      17151999
171520                         END-IF                                   17152099
171521                         IF PV-DETERMINE-CNT = +4                 17152199
171522                            MOVE 2 TO PV-SUB                      17152299
171523                         END-IF                                   17152399
171524                         IF PV-DETERMINE-CNT = +5                 17152499
171525                            MOVE 1 TO PV-SUB                      17152599
171526                         END-IF                                   17152699
171527                         END-IF                                   17152799
171528                     END-IF                                       17152899
171529                 END-IF                                           17152999
171530             ELSE                                                 17153099
171531                 IF PO011-BLOCK-NUMBER = PV-BLOCK-NUMBER          17153199
171532                     MOVE ZEROS TO PV-DETERMINE-CNT               17153299
171533                     PERFORM WITH TEST AFTER                      17153399
171534                     VARYING PV-TEST-CNT FROM 7 BY -1             17153499
171535                     UNTIL PV-TEST-CNT < +1                       17153599
171536                     IF ASC-LINE (PO011-BLK-SUB PV-TEST-CNT)      17153699
171537                         = PO011-PO-LNE-NBR                       17153799
171538                         MOVE +0 TO PV-TEST-CNT                   17153899
171539                         ADD 1 TO PV-DETERMINE-CNT                17153999
171540                     ELSE                                         17154099
171541                         ADD 1 TO PV-DETERMINE-CNT                17154199
171542                     END-IF                                       17154299
171543                     END-PERFORM                                  17154399
171544                     IF PV-DETERMINE-CNT = ZEROS                  17154499
171545                         CONTINUE                                 17154599
171546                     ELSE                                         17154699
171547                         MOVE PV-DETERMINE-CNT TO PV-SUB          17154799
171548                         MOVE +7 TO PV-DETERMINE-ITEM             17154899
171549                     END-IF                                       17154999
171550                 ELSE                                             17155099
171551                     CONTINUE                                     17155199
171552                 END-IF                                           17155299
171553             END-IF                                               17155399
171554             IF PV-DETERMINE-ITEM > ZEROS                         17155499
171555                 MOVE PV-DETERMINE-ITEM TO ASC-ITEM-SUB           17155599
171556             END-IF                                               17155699
171557             MOVE ZEROS TO PO011-LAST-PO-LNE-NBR                  17155799
171558             MOVE PV-DETERMINE-CNTA TO PV-SUB                     17155899
171559         END-IF                                                   17155999
171560                                                                  17156099
171561         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           17156199
171562             IF ASC-LINE(ASC-BLK-SUB ASC-ITEM-SUB) = ZEROS        17156299
171563*                CONTINUE                                         17156399
171564*                IF ASC-BLK-SUB = 2                               17156499
171565                     ADD 1 TO PV-SUB                              17156599
171566*                END-IF                                           17156699
171567             ELSE                                                 17156799
171568                 MOVE ASC-LINE   (ASC-BLK-SUB ASC-ITEM-SUB)       17156899
171569                                     TO MR-LINE (PV-SUB)          17156999
171570                                        DK-PO-LNE-NBR             17157099
171580                 MOVE ASC-MCL    (ASC-BLK-SUB ASC-ITEM-SUB)       17158099
171590                                     TO MR-MCL (PV-SUB)           17159099
171600                 MOVE ASC-SCL    (ASC-BLK-SUB ASC-ITEM-SUB)       17160099
171700                                     TO MR-SCL (PV-SUB)           17170099
171800                 MOVE ASC-SKU    (ASC-BLK-SUB ASC-ITEM-SUB)       17180099
171900                                     TO MR-SKU-NBR (PV-SUB)       17190099
172000                 IF ASC-ITEM-AT-BOT-OF-PANEL = ZEROS              17200099
172100                     MOVE ASC-LINE (ASC-BLK-SUB ASC-ITEM-SUB)     17210099
172200                       TO ASC-ITEM-AT-BOT-OF-PANEL                17220099
172300                 END-IF                                           17230099
172400             END-IF                                               17240099
172500*        END-IF                                                   17250099
172600         PERFORM 4450-CHECK-TWEBITM                               17260099
172700                                                                  17270099
172800         IF PV-DB2-COUNT > 0                                      17280099
172810            MOVE DP015-RED  TO MR-MCLC (PV-SUB)                   17281099
172820                               MR-SCLC (PV-SUB)                   17282099
172830                               MR-SKU-NBRC (PV-SUB)               17283099
172840         ELSE                                                     17284099
172850            MOVE DP015-BLUE TO MR-MCLC  (PV-SUB)                  17285099
172860                               MR-SCLC  (PV-SUB)                  17286099
172870                               MR-SKU-NBRC (PV-SUB)               17287099
172880         END-IF                                                   17288099
172890         END-IF                                                   17289099
172891         IF ASC-LINE(ASC-BLK-SUB ASC-ITEM-SUB) = ZEROS            17289199
172892             CONTINUE                                             17289299
172893         ELSE                                                     17289399
172894             PERFORM 4428-MOVE-DC1                                17289499
172895         END-IF.                                                  17289599
172896*        IF ASC-DISPLAY-QTY                                       17289699
172897*           PERFORM 4425-MOVE-QTY                                 17289799
172898*        ELSE                                                     17289899
172899*        IF ASC-DISPLAY-DC                                        17289999
172900*           PERFORM 4428-MOVE-DC1                                 17290099
173000*        END-IF.                                                  17300099
173100                                                                  17310099
173200     SUBTRACT +1 FROM ASC-ITEM-SUB                                17320099
173300     IF  ASC-ITEM-SUB < + 1                                       17330099
173400         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  17340099
173500         MOVE +1                 TO ASC-BLK-SUB                   17350099
173600     END-IF.                                                      17360099
173700                                                                  17370099
173800 4421-GET-TEMP-STORAGE.                                           17380099
173900                                                                  17390099
174000     ADD +1 TO PV-TEST-CNT.                                       17400099
174100                                                                  17410099
174110     MOVE +1               TO ASC-BLK-SUB                         17411099
174120     ADD +1                TO PV-BLOCK-NUMBER                     17412099
174130     PERFORM 4410-READ-TEMP-STORAGE                               17413099
174140     IF ASC-LINE (1 1) = PO011-PO-LNE-NBR                         17414099
174150                         MOVE 1000 TO PV-TEST-CNT                 17415099
174160                         MOVE +1 TO PV-DETERMINE-CNT              17416099
174170                         MOVE +0 TO PV-DETERMINE-ITEM             17417099
174180                     END-IF                                       17418099
174190                     IF ASC-LINE (1 2) = PO011-PO-LNE-NBR         17419099
174191                         MOVE 1000 TO PV-TEST-CNT                 17419199
174192                         MOVE +2 TO PV-DETERMINE-CNT              17419299
174193                         MOVE +1 TO PV-DETERMINE-ITEM             17419399
174194                     END-IF                                       17419499
174195                     IF ASC-LINE (1 3) = PO011-PO-LNE-NBR         17419599
174196                         MOVE 1000 TO PV-TEST-CNT                 17419699
174197                         MOVE +2 TO PV-DETERMINE-CNT              17419799
174198                         MOVE +2 TO PV-DETERMINE-ITEM             17419899
174199                     END-IF                                       17419999
174200                     IF ASC-LINE (1 4) = PO011-PO-LNE-NBR         17420099
174201                         MOVE 1000 TO PV-TEST-CNT                 17420199
174202                         MOVE +2 TO PV-DETERMINE-CNT              17420299
174203                         MOVE +3 TO PV-DETERMINE-ITEM             17420399
174204                     END-IF                                       17420499
174205                     IF ASC-LINE (1 5) = PO011-PO-LNE-NBR         17420599
174206                         MOVE 1000 TO PV-TEST-CNT                 17420699
174207                         MOVE +2 TO PV-DETERMINE-CNT              17420799
174208                         MOVE +4 TO PV-DETERMINE-ITEM             17420899
174209                     END-IF                                       17420999
174210                     IF ASC-LINE (1 6) = PO011-PO-LNE-NBR         17421099
174211                         MOVE 1000 TO PV-TEST-CNT                 17421199
174212                         MOVE +2 TO PV-DETERMINE-CNT              17421299
174213                         MOVE +5 TO PV-DETERMINE-ITEM             17421399
174214                     END-IF                                       17421499
174215                     IF ASC-LINE (1 7) = PO011-PO-LNE-NBR         17421599
174216                         MOVE 1000 TO PV-TEST-CNT                 17421699
174217                         MOVE +2 TO PV-DETERMINE-CNT              17421799
174218                         MOVE +6 TO PV-DETERMINE-ITEM             17421899
174219                     END-IF.                                      17421999
174220                                                                  17422099
174230 4425-MOVE-QTY.                                                   17423099
174240      MOVE ASC-DESC   (ASC-BLK-SUB ASC-ITEM-SUB)                  17424099
174250                                 TO PV-DESC.                      17425099
174260      MOVE ASC-QTY    (ASC-BLK-SUB ASC-ITEM-SUB)                  17426099
174270                                 TO PV-QTY.                       17427099
174280      MOVE ASC-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)                  17428099
174290                                 TO PV-STATUS.                    17429099
174300      MOVE ASC-REC-QTY (ASC-BLK-SUB ASC-ITEM-SUB)                 17430099
174400                                 TO PV-REC-QTY.                   17440099
174500      MOVE ASC-REC-PCT (ASC-BLK-SUB ASC-ITEM-SUB)                 17450099
174600                                 TO PV-REC-PCT.                   17460099
174700      IF ASC-REC-PCT (ASC-BLK-SUB ASC-ITEM-SUB) = 0               17470099
174800            MOVE SPACES TO PV-REC-PCT-SIGN                        17480099
174900         ELSE                                                     17490099
175000            MOVE PC-PCT TO PV-REC-PCT-SIGN                        17500099
175100      END-IF.                                                     17510099
175200      MOVE PV-NORMAL-LINE TO MR-LINE-AREA(PV-SUB).                17520099
175300                                                                  17530099
175400 4428-MOVE-DC1.                                                   17540099
175500      MOVE ASC-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)                  17550099
175600                                 TO PV-STATUS-DC.                 17560099
175700      MOVE ASC-QTY (ASC-BLK-SUB ASC-ITEM-SUB)                     17570099
175800                                 TO PV-QTY-DC.                    17580099
175900      MOVE ASC-REC-QTY (ASC-BLK-SUB ASC-ITEM-SUB)                 17590099
176000                                 TO PV-REC-QTY-DC.                17600099
176100      MOVE ASC-REC-PCT (ASC-BLK-SUB ASC-ITEM-SUB)                 17610099
176200                                 TO PV-REC-PCT-DC.                17620099
176300      IF ASC-REC-PCT (ASC-BLK-SUB ASC-ITEM-SUB) = 0               17630099
176400            MOVE SPACES TO PV-REC-PCT-SIGN-DC                     17640099
176500         ELSE                                                     17650099
176600            MOVE PC-PCT TO PV-REC-PCT-SIGN-DC                     17660099
176700      END-IF.                                                     17670099
176800     IF ASC-DC-COUNTER < +1                                       17680099
176900         MOVE +1 TO ASC-DC-COUNTER                                17690099
177000     END-IF                                                       17700099
177100*    IF ASC-DC-COUNTER < +1                                       17710099
177200*        CONTINUE                                                 17720099
177300*    ELSE                                                         17730099
177400     MOVE ASC-DC    (ASC-BLK-SUB ASC-ITEM-SUB ASC-DC-COUNTER)     17740099
177500                                 TO PV-DC1                        17750099
177600     MOVE ASC-REC-DC (ASC-BLK-SUB ASC-ITEM-SUB ASC-DC-COUNTER)    17760099
177700                                 TO PV-REC-DC1                    17770099
177800     MOVE ASC-DC (ASC-BLK-SUB ASC-ITEM-SUB ASC-DC-COUNTER + 1)    17780099
177900                                 TO PV-DC2                        17790099
178000     MOVE ASC-REC-DC (ASC-BLK-SUB ASC-ITEM-SUB ASC-DC-COUNTER + 1)17800099
178100                                 TO PV-REC-DC2                    17810099
178200     MOVE ASC-DC (ASC-BLK-SUB ASC-ITEM-SUB ASC-DC-COUNTER + 2)    17820099
178300                                 TO PV-DC3                        17830099
178400     MOVE ASC-REC-DC (ASC-BLK-SUB ASC-ITEM-SUB ASC-DC-COUNTER + 2)17840099
178500                                 TO PV-REC-DC3                    17850099
178510*    END-IF                                                       17851099
178520     MOVE PV-DC1-LINE TO MR-LINE-AREA(PV-SUB).                    17852099
178530                                                                  17853099
178540*----------------------------------------------------------------*17854099
178550* DETERMINE IF LINE ITEM IS ON TWEBITM TABLE                     *17855099
178560* NOTE : TWEBITM AND TUPCPLS TABLES ARE NOT REPLACED BY LOGISTICS*17856099
178570*        DOMAIN TABLES BECAUSE OF PERFORMANCE ISSUES.            *17857099
178580*----------------------------------------------------------------*17858099
178590 4450-CHECK-TWEBITM.                                              17859099
178600     INITIALIZE PURCHS-PO-NBR                                     17860099
178700                PURITM-PO-LNE-NBR.                                17870099
178710     MOVE ASC-KEY-PO-NUMBER TO PURCHS-PO-NBR.                     17871099
178720     MOVE DK-PO-LNE-NBR     TO PURITM-PO-LNE-NBR.                 17872099
178721     PERFORM                                                      17872199
178722         WITH TEST AFTER                                          17872299
178723         VARYING PV-RETRY-COUNTER                                 17872399
178724         FROM 1 BY 1                                              17872499
178725         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17872599
178726             OR (SQLCODE = +0) OR (SQLCODE = +100))               17872699
178727         EXEC SQL                                                 17872799
178728              SELECT COUNT(*)                                     17872899
178729               INTO :PV-DB2-COUNT                                 17872999
178730               FROM TWEBITM A                                     17873099
178740                   ,TUPCPLS C                                     17874099
178750                   ,TPURITM E                                     17875099
178760                   ,TPURCHS F                                     17876099
178770             WHERE F.PO_NBR = :PURCHS-PO-NBR                      17877099
178780               AND F.PO_NBR = E.PO_NBR                            17878099
178790               AND F.VER_STATUS_CDE = 'A'                         17879099
178800               AND E.VER_STATUS_CDE = 'A'                         17880099
178810               AND E.PO_LNE_NBR = :PURITM-PO-LNE-NBR              17881099
178820               AND E.ITM_NBR = C.ITM_NBR                          17882099
178821               AND C.OPERCO_NBR = '03'                            17882199
178822               AND C.STR_NBR = 0                                  17882299
178823               AND ((C.EFF_BEG_TMST <= CURRENT TIMESTAMP AND      17882399
178824                     C.EFF_END_TMST IS NULL) OR                   17882499
178825                    (C.EFF_BEG_TMST <= CURRENT TIMESTAMP AND      17882599
178826                     C.EFF_END_TMST > CURRENT TIMESTAMP))         17882699
178827               AND   C.UPC_ID = A.INTR_UPC_ID                     17882799
178828               AND  (A.EFF_BEG_TMST <= CURRENT TIMESTAMP          17882899
178829                       AND A.EFF_END_TMST IS NULL)                17882999
178830         END-EXEC                                                 17883099
178831         EVALUATE TRUE                                            17883199
178832             WHEN SQLCODE = +0                                    17883299
178833             WHEN SQLCODE = +100                                  17883399
178834             WHEN SQLCODE = -904                                  17883499
178835             WHEN SQLCODE = -913                                  17883599
178836                  CONTINUE                                        17883699
178837             WHEN SQLWARN0 NOT = SPACES                           17883799
178838             WHEN SQLCODE < +0                                    17883899
178839             WHEN SQLCODE > +0                                    17883999
178840                  MOVE '4450-CHECK-TWEBITM'                       17884099
178841                                  TO DP013-PARAGRAPH              17884199
178842                  MOVE 'UNSUCCESSFUL SELECT COUNT(*)'             17884299
178843                                  TO DP013-MESSAGE-TEXT (1)       17884399
178844                  MOVE SQLCA      TO DP013-SQLCA                  17884499
178845                  MOVE 'TWEBITM ' TO DP013-DB2-TABLE-NAME (1)     17884599
178846                  MOVE 'TUPCPLS ' TO DP013-DB2-TABLE-NAME (2)     17884699
178847                  MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (3)     17884799
178848                  MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (4)     17884899
178849                  SET DP013-DB2-ABEND                             17884999
178850                  DP013-XCTL-DISPLAY-RESTART                      17885099
178851                                  TO TRUE                         17885199
178852                  PERFORM DP013-0000-PROCESS-ABEND                17885299
178853         END-EVALUATE                                             17885399
178854     END-PERFORM.                                                 17885499
178855                                                                  17885599
178856     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        17885699
178857         MOVE '4450-CHECK-TWEBITM' TO DP013-PARAGRAPH             17885799
178858         MOVE 'MAX RETRIES EXCEEDED FOR SELECT OF TWEBITM'        17885899
178859                                   TO DP013-MESSAGE-TEXT (1)      17885999
178860         MOVE SQLCA               TO DP013-SQLCA                  17886099
178861         MOVE 'TWEBITM '       TO DP013-DB2-TABLE-NAME (1)        17886199
178862         MOVE 'TUPCPLS '       TO DP013-DB2-TABLE-NAME (2)        17886299
178863         MOVE 'TPURITM '       TO DP013-DB2-TABLE-NAME (3)        17886399
178864         MOVE 'TPURCHS '       TO DP013-DB2-TABLE-NAME (4)        17886499
178865         SET DP013-DB2-ABEND                                      17886599
178866             DP013-XCTL-DISPLAY-RESTART                           17886699
178867                                  TO TRUE                         17886799
178868         PERFORM DP013-0000-PROCESS-ABEND                         17886899
178869     END-IF.                                                      17886999
178870                                                                  17887099
178871                                                                  17887199
178872 5100-WRITE-TEMP-STORAGE.                                         17887299
178873                                                                  17887399
178874     MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1) TO                 17887499
178875                                              PV-LIST-ITEM-NUMBER.17887599
178876     COMPUTE PV-BLOCK-NUMBER = 1 +                                17887699
178877                 ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).17887799
178878                                                                  17887899
178879     IF PV-BLOCK-NUMBER NOT > ASC-HIGHEST-BLOCK-WRITTEN           17887999
178880        IF ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                       17888099
178881                                                                  17888199
178882            PERFORM 5105-REWRITE-ASC-LISTQ                        17888299
178883                                                                  17888399
178884        END-IF                                                    17888499
178885     ELSE                                                         17888599
178886         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       17888699
178887                                     ASC-HIGHEST-BLOCK-WRITTEN + 117888799
178888         PERFORM 5110-WRITE-ASC-LISTQ                             17888899
178889                                                                  17888999
178890         ADD +1 TO ASC-HIGHEST-BLOCK-WRITTEN                      17889099
178900     END-IF.                                                      17890099
179000                                                                  17900099
179100     SET ASC-BLOCK-NOT-MODIFIED (ASC-BLK-SUB) TO TRUE.            17910099
179200                                                                  17920099
179300 5105-REWRITE-ASC-LISTQ.                                          17930099
179400                                                                  17940099
179500     EXEC CICS WRITEQ TS QUEUE   (ASC-LIST-QUEUE-NAME)            17950099
179600                         FROM    (ASC-BLOCK-ENTRIES(ASC-BLK-SUB)) 17960099
179700                         ITEM    (PV-BLOCK-NUMBER)                17970099
179800                         REWRITE                                  17980099
179900                         RESP    (PV-CICS-RESP)                   17990099
180000                         END-EXEC.                                18000099
180100                                                                  18010099
180200     IF PV-CICS-RESP NOT = DFHRESP (NORMAL)                       18020099
180300         SET DP013-CICS-ABEND                                     18030099
180400             DP013-NO-ROLLBACK TO TRUE                            18040099
180500         MOVE '5105-REWRITE-ASC-LISTQ' TO DP013-PARAGRAPH         18050099
180600         MOVE 'UNSUCCESSFUL LIST ITEMS TEMP STORAGE QUEUE REWRITE'18060099
180700                                         TO DP013-MESSAGE-TEXT (1)18070099
180800         PERFORM DP013-0000-PROCESS-ABEND.                        18080099
180900                                                                  18090099
181000 5110-WRITE-ASC-LISTQ.                                            18100099
181100                                                                  18110099
181200     EXEC CICS WRITEQ TS QUEUE (ASC-LIST-QUEUE-NAME)              18120099
181300                         FROM  (ASC-BLOCK-ENTRIES (ASC-BLK-SUB))  18130099
181400                         ITEM  (PV-BLOCK-NUMBER)                  18140099
181500                         RESP  (PV-CICS-RESP)                     18150099
181600                         END-EXEC.                                18160099
181700                                                                  18170099
181800     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      18180099
181900         SET DP013-CICS-ABEND                                     18190099
182000             DP013-NO-ROLLBACK TO TRUE                            18200099
182100         MOVE '5110-WRITE-ASC-LISTQ' TO DP013-PARAGRAPH           18210099
182200         MOVE 'UNSUCCESSFUL LIST ITEMS TEMP STORAGE QUEUE WRITE'  18220099
182300                                         TO DP013-MESSAGE-TEXT (1)18230099
182400         PERFORM DP013-0000-PROCESS-ABEND.                        18240099
182500                                                                  18250099
182600 EJECT                                                            18260099
182700*----------------------------------------------------------------*18270099
182800*    ABEND PROCESSOR MODULE                                      *18280099
182900*----------------------------------------------------------------*18290099
183000                                                                  18300099
183100     COPY DPPD013.                                                18310099
