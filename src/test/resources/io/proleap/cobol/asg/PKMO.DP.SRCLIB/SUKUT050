000100 IDENTIFICATION DIVISION.                                         00010000
000200                                                                  00020000
000300 TITLE 'TRAILER AUDIT EXTRACT'.                                   00030000
000400 PROGRAM-ID.             SUKUT050.                                00040000
000500 AUTHOR.                 LYNN MCADAMS.                            00050000
000600 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00060000
000700 DATE-WRITTEN            AUGUST, 2001.                            00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*----------------------------------------------------------------*00100000
001100************** CARTONS THAT ARE ACTUALLY ON THE TRAILER **********00110000
001200*                                                                *00120000
001300* THIS PROGRAM WILL CREATE AN EXTRACT FILE USED FOR REPORTING    *00130000
001400* OF AUDITED CARTON DATA.                                        *00140000
001500*                                                                *00150000
001600* THE DATA WILL BE EXTRACTED FROM THE AUDIT CARTON DATABASES     *00160000
001700* USING THE AUDIT CONTROL NUMBER THAT WAS ENTERED ON THE RF      *00170000
001800* TRAILER AUDIT SCREEN (PCKRF892).                               *00180000
001900*                                                                *00190000
002000* THE CONTROL CARD IS READ AS INPUT TO THIS PROGRAM USING THE    *00200000
002100* AUDIT CONTROL NUMBER AND THE USER ID OF THE PERSON WHO CREATED *00210000
002200* THE AUDIT.                                                     *00220000
002300*                                                                *00230000
002400* THE OUTPUT EXTRACT FILE (LAYOUT SURD019) WILL CONTAIN ALL      *00240000
002500* CARTONS AUDITED ON THE TRAILER FOR THE AUDIT CONTROL NUMBER    *00250000
002600* SPECIFIED.                                                     *00260000
002700*----------------------------------------------------------------*00270000
002800                                                                  00280000
002900 ENVIRONMENT DIVISION.                                            00290000
003000                                                                  00300000
003100                                                                  00310000
003200 CONFIGURATION SECTION.                                           00320000
003300                                                                  00330000
003400 SOURCE-COMPUTER.        IBM-3090.                                00340000
003500 OBJECT-COMPUTER.        IBM-3090.                                00350000
003600                                                                  00360000
003700 INPUT-OUTPUT SECTION.                                            00370000
003800                                                                  00380000
003900 FILE-CONTROL.                                                    00390000
004000                                                                  00400000
004100*INPUT                                                            00410000
004200     SELECT CARDIN-TRLR-AUDIT-NBR-FILE                            00420000
004300         ASSIGN TO CARDIN.                                        00430000
004400                                                                  00440000
004500*SURD019                                                          00450000
004600     SELECT SU-CARTON-EXTRACT-FILE                                00460000
004700         ASSIGN TO OUT01.                                         00470000
004800*                                                                 00480000
004900*                                                                 00490000
005000 DATA DIVISION.                                                   00500000
005100                                                                  00510000
005200 FILE SECTION.                                                    00520000
005300                                                                  00530000
005400 FD  CARDIN-TRLR-AUDIT-NBR-FILE                                   00540000
005500     LABEL RECORDS ARE STANDARD                                   00550000
005600     RECORDING MODE IS F                                          00560000
005700     BLOCK CONTAINS 0 RECORDS                                     00570000
005800     RECORD CONTAINS 80 CHARACTERS.                               00580000
005900 01  CC-RECORD                       PIC X(80).                   00590000
006000                                                                  00600000
006100 FD  SU-CARTON-EXTRACT-FILE                                       00610000
006200     RECORDING MODE IS F                                          00620000
006300     BLOCK CONTAINS 0  RECORDS.                                   00630000
006400 01  SU-CARTON-EXTRACT-RECORD        PIC  X(300).                 00640000
006500*                                                                 00650000
006600*                                                                 00660000
006700 WORKING-STORAGE SECTION.                                         00670000
006800                                                                  00680000
006900 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00690000
007000                                                   COMP SYNC.     00700000
007100 01  PROGRAM-SWITCHES.                                            00710000
007200     05  PS-EOF-CARDIN-SW               PIC X(01)   VALUE 'N'.    00720000
007300         88  PS-EOF-CARDIN-FILE                     VALUE 'Y'.    00730000
007400         88  PS-NOT-EOF-CARDIN-FILE                 VALUE 'N'.    00740000
007500     05  PS-AUD-ERROR-SW                PIC  X(01)  VALUE 'N'.    00750000
007600         88  PS-AUD-ERRORS                          VALUE 'Y'.    00760000
007700         88  PS-NO-AUD-ERRORS                       VALUE 'N'.    00770000
007800     05  PS-EOF-AUD-CRTN-CSR-SW         PIC X(01)   VALUE 'N'.    00780000
007900         88  PS-EOF-AUD-CRTN-CSR                    VALUE 'Y'.    00790000
008000         88  PS-NOT-EOF-AUD-CRTN-CSR                VALUE 'N'.    00800000
008010     05  PS-DUP-ERROR-SCAN-SW           PIC  X(01)  VALUE 'N'.    00801000
008020         88  PS-DUP-ERROR-ORIG-SCAN                 VALUE 'Y'.    00802000
008030         88  PS-DUP-ERROR-DUP-SCAN                  VALUE 'N'.    00803000
008040                                                                  00804000
008050 01  PC-CONSTANTS.                                                00805000
008060     05  PC-1                PIC S9(03) VALUE +1 COMP-3.          00806000
008070     05  PC-18               PIC S9(04) VALUE 18 COMP SYNC.       00807000
008080     05  PC-A                PIC  X(01) VALUE 'A'.                00808000
008090     05  PC-Y                PIC  X(01) VALUE 'Y'.                00809000
008100     05  PC-N                PIC  X(01) VALUE 'N'.                00810000
008200     05  PC-S                PIC  X(09) VALUE 'SAME     '.        00820000
008300     05  PC-D                PIC  X(09) VALUE 'DIFFERENT'.        00830000
008400     05  PC-C                PIC  X(09) VALUE ' CONVEYOR'.        00840000
008500     05  PC-100              PIC  X(06) VALUE '100%  '.           00850000
008600     05  PC-SPOT             PIC  X(06) VALUE 'SPOT  '.           00860000
008700     05  PC-REWORK           PIC  X(06) VALUE 'REWORK'.           00870000
008800     05  PC-CR               PIC  X(16) VALUE 'AUDIT CREATE    '. 00880000
008900     05  PC-IP               PIC  X(16) VALUE 'AUDIT IN PROCESS'. 00890000
009000     05  PC-CM               PIC  X(16) VALUE 'AUDIT COMPLETE  '. 00900000
009100     05  PC-PP               PIC  X(16) VALUE 'AUDIT POSTPONE  '. 00910000
009200                                                                  00920000
009300     05  PC-CURRENT-PROGRAM-NAME PIC  X(08)  VALUE 'SUKUT050'.    00930000
009400     05  PC-LOCATION-MODULE      PIC  X(08)  VALUE  'XLKUT071'.   00940000
009500     05  PC-MAX-RETRIES          PIC S9(04)  COMP SYNC VALUE +2.  00950000
009600     05  PC-DEFAULT-TMST         PIC  X(26)                       00960000
009700                              VALUE '9999-99-99-99.99.99.9999'.   00970000
009800                                                                  00980000
009900 01  PV-MISC-FIELDS.                                              00990000
010000     05  PV-RETRY-COUNT          PIC S9(4)     COMP SYNC VALUE +0.01000000
010100                                                                  01010000
010200     05  PV-HOLD-PO-NBR              PIC S9(09)    COMP.          01020000
010300     05  PV-HOLD-REC-SEQ-NBR         PIC S9(09)    COMP.          01030000
010400     05  PV-LINE-SUB                 PIC S9(03)    VALUE ZERO     01040000
010500                                                   COMP-3.        01050000
010600     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     01060000
010700                                                   COMP SYNC.     01070000
010800     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  01080000
010900     05  PV-CARTON-ID-DISPLAY        PIC  X(30)    VALUE SPACES.  01090000
011000     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  01100000
011100     05  PV-AUD-CARTON-CNT           PIC S9(05)    VALUE ZEROS    01110000
011200                                                   COMP.          01120000
011300     05  PV-AUD-CRTN-ERR-CNT         PIC S9(05)    VALUE ZEROS    01130000
011400                                                   COMP.          01140000
011500     05  PV-AUD-CRTN-ERR-PERC        PIC S9(05)    VALUE ZEROS    01150000
011600                                                   COMP.          01160000
011700     05  PV-MFST-CARTON-CNT          PIC S9(05)    VALUE ZEROS    01170000
011800                                                   COMP.          01180000
011900     05  PV-MFST-CRTN-ERR-CNT        PIC S9(05)    VALUE ZEROS    01190000
012000                                                   COMP.          01200000
012100     05  PV-MFST-CRTN-ERR-PERC       PIC S9(05)    VALUE ZEROS    01210000
012200                                                   COMP.          01220000
012300     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  01230000
012400     05  PV-DISPLAY-SQLCODE          PIC -9(05)    VALUE ZEROES.  01240000
012500     05  PV-DISPLAY-COUNT            PIC  ZZZ,ZZZ,ZZ9.            01250000
012600     05  PV-SQL-RETURN-CD            PIC  999-.                   01260000
012700     05  PV-DB2-TABLE-NAME           PIC  X(08)    VALUE SPACES.  01270000
012800     05  PV-DB2-OPERATION-MESSAGE-1  PIC  X(79)    VALUE SPACES.  01280000
012900     05  PV-DB2-OPERATION-MESSAGE-2  PIC  X(79)    VALUE SPACES.  01290000
013000     05  PV-DB2-OPERATION-MESSAGE-3  PIC  X(79)    VALUE SPACES.  01300000
013100     05  PV-DB2-OPERATION-MESSAGE-4  PIC  X(79)    VALUE SPACES.  01310000
013110     05  PV-DISPLAY-SHIPT-UNT-ID     PIC  9(18)    VALUE ZERO.    01311002
013120     05  PV-DISPLAY-AUDIT-NBR        PIC  9(10)    VALUE ZERO.    01312002
013200                                                                  01320000
013300     05  PV-AUDIT-NBR-X              PIC  X(09).                  01330000
013400     05  PV-AUDIT-NBR REDEFINES PV-AUDIT-NBR-X                    01340000
013500                                     PIC  9(09).                  01350000
013600     05  PV-SKU-COUNT                    PIC S9(09)  VALUE +0     01360000
013700                                                     COMP-3.      01370000
013800     05  PV-EXCEPT-CNT                   PIC S9(09)  VALUE +0     01380000
013900                                                     COMP-3.      01390000
014000     05  PV-PICK-CNT                     PIC S9(09)  VALUE +0     01400000
014100                                                     COMP-3.      01410000
014200     05  PV-START-TMST                   PIC X(26)                01420000
014300                          VALUE '9999-09-09-09.09.09.9999'.       01430000
014400     05  PV-END-TMST                     PIC X(26)                01440000
014500                          VALUE '9999-09-09-09.09.09.9999'.       01450000
014600                                                                  01460000
014700     05  PV-CARTON-BREAKDOWN             PIC X(20).               01470000
014800     05  PV-CTN-R REDEFINES PV-CARTON-BREAKDOWN.                  01480000
014900         10  PV-CTN-00                   PIC X(02).               01490000
015000         10  PV-CTN-4100                 PIC X(04).               01500000
015100         10  PV-CTN-DEST                 PIC X(03).               01510000
015200         10  PV-CTN-LAST-11              PIC X(11).               01520000
015300                                                                  01530000
015400     05  PV-DEST-OPER-UNT-ID-X       PIC  X(04).                  01540000
015500     05  PV-DEST-OPER-UNT-ID REDEFINES PV-DEST-OPER-UNT-ID-X      01550000
015600                                     PIC  9(04).                  01560000
015700                                                                  01570000
015800     05  PV-WRITE-EXCEPTION-COUNT    PIC  S9(9)     VALUE ZERO    01580000
015900                                                    COMP-3.       01590000
016000                                                                  01600000
016100 EJECT                                                            01610000
016200                                                                  01620000
016300 01  DK-DB-KEYS.                                                  01630000
016400     05  DK-AUD-CNTL-NBR             PIC  S9(09) COMP.            01640000
016500     05  DK-SHIPT-UNT-ID             PIC  S9(18)V COMP-3.         01650000
016600     05  DK-OPER-UNT-ID              PIC  S9(4) COMP.             01660000
016700     05  DK-ORIG-OTBND-TRIP-ID       PIC  S9(09) COMP.            01670000
016800     05  DK-DEST-OTBND-TRIP-ID       PIC  S9(09) COMP.            01680000
016900     05  DK-SCN-TMST                 PIC   X(26).                 01690000
017000                                                                  01700000
017100 01  DN-DB2-NULL-INDICATORS.                                      01710000
017200     05  DN-ORIG-TRIP-ID             PIC S9(04) COMP VALUE +0.    01720000
017300     05  DN-DEST-TRIP-ID             PIC S9(04) COMP VALUE +0.    01730000
017400                                                                  01740000
017500 01  CC-CARDIN.                                                   01750000
017600     05  CC-AUD-CNTL-NBR             PIC  9(09).                  01760000
017700     05  FILLER                      PIC  X(01).                  01770000
017800     05  CC-USER-ID                  PIC  X(08).                  01780000
017900     05  FILLER                      PIC  X(62).                  01790000
018000                                                                  01800000
018100***************************************************************** 01810000
018200*   XLWS071 - IS THE LAYOUT THAT IS USED TO PASS INFO TO THE    * 01820000
018300*             LOCATION MODULE (XLKUT071)                        * 01830000
018400***************************************************************** 01840000
018500     COPY XLWS071.                                                01850000
018600                                                                  01860000
018700*  RECORD DESCRIPTION                                             01870000
018800 01  INCLUDE-SURD019.                                             01880000
018900     COPY SURD019.                                                01890000
019000                                                                  01900000
019100*  DB2 FORMATTED MESSAGE AREA                                     01910000
019200     COPY DPWS004.                                                01920000
019300                                                                  01930000
019400*  NUMERIC EDIT ROUTINE COMMAREA                                  01940000
019500     COPY DPWS010I.                                               01950000
019600                                                                  01960000
019700**DB2 TABLES                                                      01970000
019800* SU-INBOUND PACKLIST VENDOR SHIPMENT UNIT TABLE                  01980000
019900* SUT_OTBND_VND                                                   01990000
020000     EXEC SQL                                                     02000000
020100          INCLUDE SUT00026                                        02010000
020200     END-EXEC.                                                    02020000
020300                                                                  02030000
020400* AUDIT HEADER TABLE                                              02040000
020500     EXEC SQL                                                     02050000
020600          INCLUDE TSUNAUD                                         02060000
020700     END-EXEC.                                                    02070000
020800                                                                  02080000
020900* OUTBOUND TRAILER TRIP TABLE                                     02090000
021000     EXEC SQL                                                     02100000
021100          INCLUDE TSUOBTR                                         02110000
021200     END-EXEC.                                                    02120000
021300                                                                  02130000
021400* OUTBOUND TRAILER TRIP STATUS TABLE                              02140000
021500     EXEC SQL                                                     02150000
021600          INCLUDE TSUOBTS                                         02160000
021700     END-EXEC.                                                    02170000
021800                                                                  02180000
021900* AUDIT TRAILER CARTON DETAIL TABLE                               02190000
022000* SUT_AUD_TRLR_CART                                               02200000
022100     EXEC SQL                                                     02210000
022200          INCLUDE SUT00000                                        02220000
022300     END-EXEC.                                                    02230000
022400                                                                  02240000
022500* AUDIT TRAILER EXCEPTIONS TABLE                                  02250000
022600* SUT_AUD_TRLR_EXC                                                02260000
022700     EXEC SQL                                                     02270000
022800          INCLUDE SUT00002                                        02280000
022900     END-EXEC.                                                    02290000
023000                                                                  02300000
023100* AUDIT TRAILER TRIP TABLE                                        02310000
023200* SUT_AUD_TRLR_TRIP                                               02320000
023300     EXEC SQL                                                     02330000
023400          INCLUDE SUT00004                                        02340000
023500     END-EXEC.                                                    02350000
023600                                                                  02360000
023700* SHIPPING UNIT LOCATION TABLE                                    02370000
023800     EXEC SQL                                                     02380000
023900          INCLUDE TSHUNLO                                         02390000
024000     END-EXEC.                                                    02400000
024100                                                                  02410000
024200*  DB2 COMMUNICATION AREA                                         02420000
024300     EXEC SQL                                                     02430000
024400         INCLUDE SQLCA                                            02440000
024500     END-EXEC.                                                    02450000
024600                                                                  02460000
024700*  DB2 COMMUNICATION AREA2                                        02470000
024800     COPY SQLCA2.                                                 02480000
024900 EJECT                                                            02490000
025000*                                                                 02500000
025100*                                                                 02510000
025200     EXEC SQL                                                     02520000
025300          DECLARE AUD-CRTN-CSR CURSOR FOR                         02530000
025400           SELECT A.SHIPT_UNT_ID                                  02540000
025500                , A.SCN_TMST                                      02550000
025600                , A.AUD_USR_ID                                    02560000
025610                , B.ERR_CDE                                       02561000
025700             FROM SUT_AUD_TRLR_CART A                             02570000
025710                , SUT_AUD_TRLR_EXC  B                             02571000
025800            WHERE A.AUD_CNTL_NBR = :DK-AUD-CNTL-NBR               02580000
025810              AND B.AUD_CNTL_NBR = A.AUD_CNTL_NBR                 02581000
025820              AND B.SHIPT_UNT_ID = A.SHIPT_UNT_ID                 02582000
025830              AND B.SCN_TMST     = A.SCN_TMST                     02583000
025900           WITH UR                                                02590000
026000     END-EXEC.                                                    02600000
026100                                                                  02610000
026200                                                                  02620000
026300 PROCEDURE DIVISION.                                              02630000
026400                                                                  02640000
026500*THIS IS THE MAIN DRIVER FOR THE PROGRAM.                         02650000
026600 0000-MAINLINE-PROCESSING.                                        02660000
026700                                                                  02670000
026710     DISPLAY '******************************'.                    02671000
026720     DISPLAY '*                            *'.                    02672000
026730     DISPLAY '* SUKUT050 - BEGIN           *'.                    02673000
026740     DISPLAY '*                            *'.                    02674000
026750     DISPLAY '******************************'.                    02675000
026760                                                                  02676000
026770     PERFORM 1000-INITIALIZATION.                                 02677000
026780                                                                  02678000
026790     IF PS-NOT-EOF-CARDIN-FILE                                    02679000
026800         PERFORM 2000-PROCESS-CARTONS                             02680000
026900     END-IF.                                                      02690000
027000                                                                  02700000
027100     PERFORM 9000-EOJ-ROUTINE.                                    02710000
027200                                                                  02720000
027300     MOVE PV-WRITE-EXCEPTION-COUNT TO PV-DISPLAY-COUNT.           02730000
027400     DISPLAY 'SURD019 EXCEPTION RECORDS WRITTEN:  '               02740000
027500             PV-DISPLAY-COUNT.                                    02750000
027510                                                                  02751000
027520     GOBACK.                                                      02752000
027530                                                                  02753000
027540*PERFORM THE INITIAL PROCESSING FOR THE PROGRAM.                  02754000
027550 1000-INITIALIZATION.                                             02755000
027560                                                                  02756000
027570     OPEN INPUT  CARDIN-TRLR-AUDIT-NBR-FILE                       02757000
027580          OUTPUT SU-CARTON-EXTRACT-FILE.                          02758000
027590                                                                  02759000
027600     INITIALIZE SU019-EXTRACT-RECORD.                             02760000
027700                                                                  02770000
027800     PERFORM 7000-READ-CARDIN-FILE.                               02780000
027900                                                                  02790000
028000     IF PS-EOF-CARDIN-FILE                                        02800000
028100         DISPLAY '** SUKUT050 ABEND **'                           02810000
028200         DISPLAY '** CARDIN (TRLR AUDIT NBR) FILE IS EMPTY **'    02820000
028300         MOVE +4019                  TO PV-ABEND-CODE             02830000
028400         CALL 'ILBOABN0' USING PV-ABEND-CODE                      02840000
028500     END-IF.                                                      02850000
028600                                                                  02860000
028700 2000-PROCESS-CARTONS.                                            02870000
028800     PERFORM 2050-GET-OPER-UNT-ID                                 02880000
028900     PERFORM 2100-GET-FCLTY-DESC                                  02890000
029000     PERFORM 5100-GET-OTBND-TRIP                                  02900000
029100     PERFORM 2200-GET-ORIG-TRAILER-NBR                            02910000
029200                                                                  02920000
029300*FIRST FETCH                                                      02930000
029400     PERFORM 3100-OPEN-AUD-CRTN-CSR                               02940000
029500     PERFORM 3110-FETCH-AUD-CRTN-CSR                              02950000
029600                                                                  02960000
029700     IF PS-EOF-AUD-CRTN-CSR                                       02970000
029800        CONTINUE                                                  02980000
029900     ELSE                                                         02990000
030000*NEXT FETCH                                                       03000000
030100        PERFORM 3110-FETCH-AUD-CRTN-CSR                           03010000
030200           UNTIL PS-EOF-AUD-CRTN-CSR                              03020000
030300     END-IF                                                       03030000
030400                                                                  03040000
030500     PERFORM 3130-CLOSE-AUD-CRTN-CSR.                             03050000
030600                                                                  03060000
030700*GET OPER-UNT-ID BASED ON AUDIT CONTROL NUMBER                    03070000
030800 2050-GET-OPER-UNT-ID.                                            03080000
030900     EXEC SQL                                                     03090000
031000         SELECT OPER_UNT_ID                                       03100000
031100         INTO  :SUNAUD-OPER-UNT-ID                                03110000
031200         FROM   TSUNAUD                                           03120000
031300        WHERE   AUD_CNTL_NBR   = :DK-AUD-CNTL-NBR                 03130000
031400        WITH UR                                                   03140000
031500     END-EXEC                                                     03150000
031600                                                                  03160000
031700     EVALUATE TRUE                                                03170000
031800         WHEN SQLCODE = 0                                         03180000
031900         WHEN SQLCODE = +100                                      03190000
032000         WHEN SQLCODE = -904                                      03200000
032100         WHEN SQLCODE = -911                                      03210000
032200             MOVE SUNAUD-OPER-UNT-ID TO DK-OPER-UNT-ID            03220000
032300         WHEN OTHER                                               03230000
032400             MOVE '2050-GET-OPER-UNT-ID'                          03240000
032500                                    TO PV-PARAGRAPH-NAME          03250000
032600             MOVE 'SELECT FROM TSUNAUD'                           03260000
032700                              TO PV-DB2-OPERATION-ATTEMPTED       03270000
032800             PERFORM 9100-SQL-ABEND                               03280000
032900     END-EVALUATE.                                                03290000
033000                                                                  03300000
033100*THIS PARAGRAPH WILL SELECT THE FACLITY DESC                      03310000
033200 2100-GET-FCLTY-DESC.                                             03320000
033300                                                                  03330000
033400     INITIALIZE XL071-COMMAREA-REC.                               03340000
033500     MOVE DK-OPER-UNT-ID          TO  XL071-LOCATION-NUMBER.      03350000
033600                                                                  03360000
033700     CALL PC-LOCATION-MODULE  USING XL071-COMMAREA-REC.           03370000
033800                                                                  03380000
033900     EVALUATE TRUE                                                03390000
034000         WHEN XL071-NO-ERRORS                                     03400000
034100         WHEN XL071-DC-ASGMT-NOT-FND                              03410000
034200              CONTINUE                                            03420000
034300                                                                  03430000
034400         WHEN OTHER                                               03440000
034500              MOVE 'SUKUT050-2100- CALL XLKUT071  '               03450000
034600                               TO  PV-PARAGRAPH-NAME              03460000
034700              STRING XL071-RETURN-CODE ' - '                      03470000
034800                     XL071-SQLCODE ' - '                          03480000
034900                     XL071-DB2-TABLE DELIMITED BY SIZE            03490000
035000                             INTO  PV-DB2-OPERATION-ATTEMPTED     03500000
035100              MOVE XL071-SQLCA TO SQLCA                           03510000
035200              PERFORM 9100-SQL-ABEND                              03520000
035300     END-EVALUATE.                                                03530000
035400                                                                  03540000
035500*GET TRAILER SERIAL NUMBER BASED ON OUTBND TRIP ID                03550000
035600 2200-GET-ORIG-TRAILER-NBR.                                       03560000
035700         EXEC SQL                                                 03570000
035800             SELECT TRLR_SRL_NBR                                  03580000
035900                  , DOOR_TYP_CDE                                  03590000
036000                  , ORGN_OPER_UNT_ID                              03600000
036100                  , DEST_OPER_UNT_ID                              03610000
036200             INTO  :SUOBTR-TRLR-SRL-NBR                           03620000
036300                  ,:SUOBTR-DOOR-TYP-CDE                           03630000
036400                  ,:SUOBTR-ORGN-OPER-UNT-ID                       03640000
036500                  ,:SUOBTR-DEST-OPER-UNT-ID                       03650000
036600             FROM   TSUOBTR                                       03660000
036700             WHERE  OTBND_TRIP_ID    = :DK-ORIG-OTBND-TRIP-ID     03670000
036800             WITH UR                                              03680000
036900         END-EXEC                                                 03690000
037000                                                                  03700000
037100         EVALUATE TRUE                                            03710000
037200             WHEN SQLCODE = 0                                     03720000
037300             WHEN SQLCODE = +100                                  03730000
037400             WHEN SQLCODE = -904                                  03740000
037500             WHEN SQLCODE = -911                                  03750000
037600                 MOVE SUOBTR-TRLR-SRL-NBR TO                      03760000
037700                      SU019-ORIG-TRLR-SER-NBR                     03770000
037800             WHEN OTHER                                           03780000
037900                 MOVE '2200-GET-ORIG-TRAILER-NBR'                 03790000
038000                                        TO PV-PARAGRAPH-NAME      03800000
038100                 MOVE 'SELECT FROM TSUOBTR'                       03810000
038200                                  TO PV-DB2-OPERATION-ATTEMPTED   03820000
038300                 PERFORM 9100-SQL-ABEND                           03830000
038400         END-EVALUATE.                                            03840000
038500                                                                  03850000
038600*OPEN CURSOR TO SELECT AUDITED CARTONS                            03860000
038700 3100-OPEN-AUD-CRTN-CSR.                                          03870000
038800     EXEC SQL                                                     03880000
038900         OPEN AUD-CRTN-CSR                                        03890000
039000     END-EXEC.                                                    03900000
039100                                                                  03910000
039200     EVALUATE TRUE                                                03920000
039300         WHEN SQLCODE = ZEROS                                     03930000
039400              SET PS-NOT-EOF-AUD-CRTN-CSR TO TRUE                 03940000
039500         WHEN SQLCODE = -904                                      03950000
039600         WHEN SQLCODE = -911                                      03960000
039700         WHEN SQLCODE = -913                                      03970000
039800              MOVE '3100-OPEN-AUD-CRTN-CSR   '                    03980000
039900                                 TO PV-ABEND-PARAGRAPH            03990000
040000              MOVE SQLCODE       TO PV-DISPLAY-SQLCODE            04000000
040100                                    PV-SQL-RETURN-CD              04010000
040200              MOVE 'OPEN CURSOR' TO PV-DB2-OPERATION-MESSAGE-1    04020000
040300              PERFORM 9100-SQL-ABEND                              04030000
040400                                                                  04040000
040500         WHEN OTHER                                               04050000
040600              MOVE '3100-OPEN-AUD-CRTN-CSR   '                    04060000
040700                                 TO PV-ABEND-PARAGRAPH            04070000
040800              MOVE SQLCODE       TO PV-DISPLAY-SQLCODE            04080000
040900                                    PV-SQL-RETURN-CD              04090000
041000              MOVE 'OPEN CURSOR' TO PV-DB2-OPERATION-MESSAGE-1    04100000
041100              PERFORM 9100-SQL-ABEND                              04110000
041200     END-EVALUATE.                                                04120000
041300                                                                  04130000
041400*GET CARTONS THAT HAVE BEEN AUDITED                               04140000
041500 3110-FETCH-AUD-CRTN-CSR.                                         04150000
041600     EXEC SQL                                                     04160000
041700      FETCH AUD-CRTN-CSR                                          04170000
041800         INTO :SUT00000-SHIPT-UNT-ID                              04180000
041900            , :SUT00000-SCN-TMST                                  04190000
042000            , :SUT00000-AUD-USR-ID                                04200000
042010            , :SUT00002-ERR-CDE                                   04201001
042100     END-EXEC                                                     04210000
042200                                                                  04220000
042300     EVALUATE TRUE                                                04230000
042400         WHEN SQLCODE = 0                                         04240000
042500         WHEN SQLCODE = -904                                      04250000
042600         WHEN SQLCODE = -911                                      04260000
042700             MOVE SUT00000-SHIPT-UNT-ID TO DK-SHIPT-UNT-ID        04270003
043200             PERFORM 3500-WRITE-CARTONS                           04320000
043400         WHEN SQLCODE = +100                                      04340000
043500             SET PS-EOF-AUD-CRTN-CSR TO TRUE                      04350000
043600         WHEN OTHER                                               04360000
043700             MOVE '3110-FETCH-AUD-CRTN-CSR'                       04370000
043800                                    TO PV-ABEND-PARAGRAPH         04380000
043900             MOVE 'SELECT FROM SUT_AUD_TRLR_CART'                 04390000
044000                                TO PV-DB2-OPERATION-ATTEMPTED     04400000
044100             MOVE SQLCODE       TO PV-DISPLAY-SQLCODE             04410000
044200                                   PV-SQL-RETURN-CD               04420000
044300             MOVE 'SUT_AUD_TRLR_CART' TO PV-DB2-TABLE-NAME        04430000
044400             PERFORM 9100-SQL-ABEND                               04440000
044500     END-EVALUATE.                                                04450000
044600                                                                  04460000
046220*CLOSE CURSOR                                                     04622000
046230 3130-CLOSE-AUD-CRTN-CSR.                                         04623000
046240     EXEC SQL                                                     04624000
046250         CLOSE AUD-CRTN-CSR                                       04625000
046260     END-EXEC.                                                    04626000
046270                                                                  04627000
046280     EVALUATE TRUE                                                04628000
046290         WHEN SQLCODE = ZEROS                                     04629000
046300              CONTINUE                                            04630000
046400                                                                  04640000
046500         WHEN SQLCODE = -904                                      04650000
046600         WHEN SQLCODE = -911                                      04660000
046700         WHEN SQLCODE = -913                                      04670000
046800              MOVE '3130-CLOSE-AUD-CRTN-CSR   '                   04680000
046900                                 TO PV-ABEND-PARAGRAPH            04690000
047000              MOVE SQLCODE       TO PV-DISPLAY-SQLCODE            04700000
047100                                    PV-SQL-RETURN-CD              04710000
047200              PERFORM 9100-SQL-ABEND                              04720000
047300         WHEN OTHER                                               04730000
047400              MOVE '3130-CLOSE-AUD-CRTN-CSR   '                   04740000
047500                                 TO PV-ABEND-PARAGRAPH            04750000
047600              MOVE SQLCODE       TO PV-DISPLAY-SQLCODE            04760000
047700                                    PV-SQL-RETURN-CD              04770000
047800              PERFORM 9100-SQL-ABEND                              04780000
047900     END-EVALUATE.                                                04790000
048000                                                                  04800000
048100 3500-WRITE-CARTONS.                                              04810000
048200     MOVE SUNAUD-OPER-UNT-ID          TO SU019-OPER-UNT-ID        04820000
048300     MOVE SUOBTR-ORGN-OPER-UNT-ID     TO SU019-FCLTY-ID           04830000
048400     MOVE XL071-LOC-NM                TO SU019-FCLTY-NME          04840000
048500     MOVE SUT00000-SHIPT-UNT-ID       TO SU019-SHIPT-UNT-ID       04850000
048600     MOVE CC-AUD-CNTL-NBR             TO SU019-AUD-CNTL-NBR       04860000
048700     MOVE SUNAUD-AUD-STRT-TMST        TO SU019-AUD-STRT-TMST      04870000
048800     MOVE SUNAUD-AUD-STP-TMST         TO SU019-AUD-STP-TMST       04880000
048900     MOVE SUT00000-SCN-TMST           TO SU019-SCN-TMST           04890000
049000     MOVE SUT00000-AUD-USR-ID         TO SU019-AUD-USR-ID         04900000
049100                                                                  04910000
049200     IF SUNAUD-AUD-TYP-CDE = '01'                                 04920000
049300        MOVE PC-100                   TO SU019-AUD-TYP-CDE        04930000
049400     END-IF                                                       04940000
049500     IF SUNAUD-AUD-TYP-CDE = '02'                                 04950000
049600        MOVE PC-SPOT                  TO SU019-AUD-TYP-CDE        04960000
049700     END-IF                                                       04970000
049800     IF SUNAUD-AUD-TYP-CDE = '03'                                 04980000
049900        MOVE PC-REWORK                TO SU019-AUD-TYP-CDE        04990000
050000     END-IF                                                       05000000
050100                                                                  05010000
050200     IF SUNAUD-AUD-STAT-CDE = 'CR'                                05020000
050300        MOVE PC-CR                    TO SU019-AUD-STAT-CDE       05030000
050400     END-IF                                                       05040000
050500                                                                  05050000
050600     IF SUNAUD-AUD-STAT-CDE = 'IP'                                05060000
050700        MOVE PC-IP                    TO SU019-AUD-STAT-CDE       05070000
050800     END-IF                                                       05080000
050900                                                                  05090000
051000     IF SUNAUD-AUD-STAT-CDE = 'CM'                                05100000
051100        MOVE PC-CM                    TO SU019-AUD-STAT-CDE       05110000
051200     END-IF                                                       05120000
051300                                                                  05130000
051400     IF SUNAUD-AUD-STAT-CDE = 'PP'                                05140000
051500        MOVE PC-PP                    TO SU019-AUD-STAT-CDE       05150000
051600     END-IF                                                       05160000
051700                                                                  05170000
051800     IF SUNAUD-DEST-TYP-CDE = 'S'                                 05180000
051900        MOVE SUOBTR-TRLR-SRL-NBR      TO SU019-ORIG-TRLR-SER-NBR  05190000
052000        MOVE ZEROES                   TO SU019-DEST-TRLR-SER-NBR  05200000
052100        MOVE PC-S                     TO SU019-DEST-TYP-CDE       05210000
052200        MOVE SUT00004-ORIG-OTBND-TRIP-ID                          05220000
052300                                      TO SU019-ORIG-TRIP-ID       05230000
052400        MOVE ZEROES                   TO SU019-DEST-TRIP-ID       05240000
052500     END-IF                                                       05250000
052600                                                                  05260000
052700     IF SUNAUD-DEST-TYP-CDE = 'D'                                 05270000
052800        PERFORM 2200-GET-ORIG-TRAILER-NBR                         05280000
052900        MOVE SUOBTR-TRLR-SRL-NBR      TO SU019-ORIG-TRLR-SER-NBR  05290000
053000        PERFORM 3600-GET-DEST-TRAILER-NBR                         05300000
053100        MOVE SUOBTR-TRLR-SRL-NBR      TO SU019-DEST-TRLR-SER-NBR  05310000
053200        MOVE PC-D                     TO SU019-DEST-TYP-CDE       05320000
053300        MOVE SUT00004-ORIG-OTBND-TRIP-ID                          05330000
053400                                      TO SU019-ORIG-TRIP-ID       05340000
053500        MOVE SUT00004-DEST-OTBND-TRIP-ID                          05350000
053600                                      TO SU019-DEST-TRIP-ID       05360000
053700     END-IF                                                       05370000
053800                                                                  05380000
053900     IF SUNAUD-DEST-TYP-CDE = 'C'                                 05390000
054000        MOVE SUOBTR-TRLR-SRL-NBR      TO SU019-ORIG-TRLR-SER-NBR  05400000
054100        MOVE ZEROES                   TO SU019-DEST-TRLR-SER-NBR  05410000
054200        MOVE PC-C                     TO SU019-DEST-TYP-CDE       05420000
054300        MOVE SUT00004-ORIG-OTBND-TRIP-ID                          05430000
054400                                      TO SU019-ORIG-TRIP-ID       05440000
054500        MOVE ZEROES                   TO SU019-DEST-TRIP-ID       05450000
054600     END-IF                                                       05460000
054700                                                                  05470000
054800     MOVE SUOBTR-DEST-OPER-UNT-ID     TO SU019-DEST-OPER-UNT-ID   05480000
054900     MOVE SUNAUD-AUD-USR-ID           TO SU019-AUD-INITIATED-BY   05490000
055000                                                                  05500000
055100     IF SUT00002-ERR-CDE = 'A'                                    05510000
055200        MOVE PC-Y TO SU019-CRTN-NOT-MFST-TO-TRLR                  05520000
055300     END-IF                                                       05530000
055400                                                                  05540000
055500     IF SUT00002-ERR-CDE = 'B'                                    05550000
055600        MOVE PC-Y TO SU019-CRTN-NOT-FOUND                         05560000
055700     END-IF                                                       05570000
055800                                                                  05580000
055900     IF SUT00002-ERR-CDE = 'C'                                    05590000
056000        MOVE PC-Y TO SU019-CRTN-CONTENT-UNKNOWN                   05600000
056100     END-IF                                                       05610000
056200                                                                  05620000
056300     IF SUT00002-ERR-CDE = 'D'                                    05630000
056400        MOVE PC-Y TO SU019-CRTN-INACTIVE                          05640000
056500     END-IF                                                       05650000
056600                                                                  05660000
056700     IF SUT00002-ERR-CDE = 'E'                                    05670000
056800        MOVE PC-Y TO SU019-MISLOADED-CRTN                         05680000
056900     END-IF                                                       05690000
057000                                                                  05700000
057100     IF SUT00002-ERR-CDE = 'F'                                    05710000
057200        SET PS-DUP-ERROR-DUP-SCAN TO TRUE                         05720000
057300        MOVE SUT00000-SCN-TMST TO DK-SCN-TMST                     05730000
057400        PERFORM 5000-GET-PRIOR-DUPLICATE-DATA                     05740000
057500        MOVE PC-Y TO SU019-DUPLICATE-SCAN                         05750000
057600     END-IF                                                       05760000
057700                                                                  05770000
057800     IF SUT00002-ERR-CDE = 'G'                                    05780000
057900        MOVE PC-Y TO SU019-CRE-NON-MFST-DC                        05790000
058000     END-IF                                                       05800000
058100                                                                  05810000
058200     IF  PS-DUP-ERROR-ORIG-SCAN                                   05820000
058300         SET PS-DUP-ERROR-DUP-SCAN TO TRUE                        05830000
058400     ELSE                                                         05840000
058500         PERFORM 8000-WRITE-EXTRACT-RECORD                        05850000
058600     END-IF.                                                      05860000
058700                                                                  05870000
058800     INITIALIZE SU019-EXTRACT-RECORD.                             05880000
058900                                                                  05890000
059000 3600-GET-DEST-TRAILER-NBR.                                       05900000
059100     EXEC SQL                                                     05910000
059200        SELECT TRLR_SRL_NBR                                       05920000
059300         INTO  :SUOBTR-TRLR-SRL-NBR                               05930000
059400          FROM TSUOBTR                                            05940000
059500         WHERE OTBND_TRIP_ID = :DK-DEST-OTBND-TRIP-ID             05950000
059600        WITH UR                                                   05960000
059700     END-EXEC                                                     05970000
059800                                                                  05980000
059900     EVALUATE TRUE                                                05990000
060000         WHEN SQLCODE = 0                                         06000000
060100         WHEN SQLCODE = -904                                      06010000
060200         WHEN SQLCODE = -911                                      06020000
060300             CONTINUE                                             06030000
060400         WHEN SQLCODE = +100                                      06040000
060500             CONTINUE                                             06050000
060600         WHEN OTHER                                               06060000
060700             MOVE '3600-GET-DEST-TRAILER-NBR'                     06070000
060800                                    TO PV-PARAGRAPH-NAME          06080000
060900             MOVE 'SELECT FROM TSUOBTR'                           06090000
061000                                TO PV-DB2-OPERATION-ATTEMPTED     06100000
061100             PERFORM 9100-SQL-ABEND                               06110000
061200     END-EVALUATE.                                                06120000
061300                                                                  06130000
061400*GET THE PRIOR SCAN DATA FOR THE AUDIT/CARTON                     06140000
061500 5000-GET-PRIOR-DUPLICATE-DATA.                                   06150000
061600     EXEC SQL                                                     06160000
061700         SELECT A.SCN_TMST                                        06170000
061800              , A.AUD_USR_ID                                      06180000
061900         INTO  :SU019-DUP-PREV-SCN-TMST                           06190000
062000              ,:SU019-DUP-PREV-AUD-USR-ID                         06200000
062100           FROM SUT_AUD_TRLR_CART A                               06210000
062200         WHERE A.AUD_CNTL_NBR = :DK-AUD-CNTL-NBR                  06220000
062300           AND A.SHIPT_UNT_ID = :DK-SHIPT-UNT-ID                  06230000
062400           AND A.SCN_TMST =                                       06240000
062500               (SELECT MAX(B.SCN_TMST)                            06250000
062600                  FROM SUT_AUD_TRLR_CART B                        06260000
062700                 WHERE B.SHIPT_UNT_ID = A.SHIPT_UNT_ID            06270000
062800                   AND B.AUD_CNTL_NBR = A.AUD_CNTL_NBR            06280000
062900                   AND B.SCN_TMST     < :DK-SCN-TMST)             06290000
063000         WITH UR                                                  06300000
063100     END-EXEC                                                     06310000
063200                                                                  06320000
063300     EVALUATE TRUE                                                06330000
063400         WHEN SQLCODE = 0                                         06340000
063500         WHEN SQLCODE = -904                                      06350000
063600         WHEN SQLCODE = -911                                      06360000
063700             CONTINUE                                             06370000
063800         WHEN SQLCODE = +100                                      06380000
063900             SET PS-DUP-ERROR-ORIG-SCAN TO TRUE                   06390000
064000         WHEN OTHER                                               06400000
064010             MOVE DK-AUD-CNTL-NBR TO PV-DISPLAY-AUDIT-NBR         06401002
064020             MOVE DK-SHIPT-UNT-ID TO PV-DISPLAY-SHIPT-UNT-ID      06402002
064030             DISPLAY 'AUDIT NUMBER:   '                           06403002
064031                     PV-DISPLAY-AUDIT-NBR                         06403102
064040             DISPLAY 'SHIPT UNT ID:   '                           06404002
064041                     PV-DISPLAY-SHIPT-UNT-ID                      06404102
064050             DISPLAY 'SCAN TIMESTAMP: '                           06405002
064060                     DK-SCN-TMST                                  06406002
064100             MOVE '5000-GET-PRIOR-DUPLICATE-DATA'                 06410000
064200                                    TO PV-PARAGRAPH-NAME          06420000
064300             MOVE 'SELECT FROM SUT_AUD_TRLR_CART'                 06430000
064400                              TO PV-DB2-OPERATION-ATTEMPTED       06440000
064500             PERFORM 9100-SQL-ABEND                               06450000
064600     END-EVALUATE.                                                06460000
064700                                                                  06470000
064800*GET OUTBOUND TRIP ID BASED ON AUDIT CONTROL NUMBER               06480000
064900 5100-GET-OTBND-TRIP.                                             06490000
065000     EXEC SQL                                                     06500000
065100         SELECT A.OPER_UNT_ID                                     06510000
065200              , A.FCLTY_ID                                        06520000
065300              , A.AUD_TYP_CDE                                     06530000
065400              , A.AUD_STAT_CDE                                    06540000
065500              , A.AUD_STRT_TMST                                   06550000
065600              , A.AUD_STP_TMST                                    06560000
065700              , A.DEST_TYP_CDE                                    06570000
065800              , A.AUD_USR_ID                                      06580000
065900              , B.ORIG_OTBND_TRIP_ID                              06590000
066000              , B.DEST_OTBND_TRIP_ID                              06600000
066100         INTO  :SUNAUD-OPER-UNT-ID                                06610000
066200              ,:SUNAUD-FCLTY-ID                                   06620000
066300              ,:SUNAUD-AUD-TYP-CDE                                06630000
066400              ,:SUNAUD-AUD-STAT-CDE                               06640000
066500              ,:SUNAUD-AUD-STRT-TMST                              06650000
066600              ,:SUNAUD-AUD-STP-TMST                               06660000
066700              ,:SUNAUD-DEST-TYP-CDE                               06670000
066800              ,:SUNAUD-AUD-USR-ID                                 06680000
066900              ,:SUT00004-ORIG-OTBND-TRIP-ID :DN-ORIG-TRIP-ID      06690000
067000              ,:SUT00004-DEST-OTBND-TRIP-ID :DN-DEST-TRIP-ID      06700000
067100         FROM   TSUNAUD A                                         06710000
067200              , SUT_AUD_TRLR_TRIP B                               06720000
067300         WHERE  A.AUD_CNTL_NBR   = B.AUD_CNTL_NBR                 06730000
067400           AND  B.AUD_CNTL_NBR   = :DK-AUD-CNTL-NBR               06740000
067500         WITH UR                                                  06750000
067600     END-EXEC                                                     06760000
067700                                                                  06770000
067800     EVALUATE TRUE                                                06780000
067900         WHEN SQLCODE = 0                                         06790000
068000         WHEN SQLCODE = +100                                      06800000
068100         WHEN SQLCODE = -904                                      06810000
068200         WHEN SQLCODE = -911                                      06820000
068300             IF DN-ORIG-TRIP-ID = -1                              06830000
068400                MOVE ZEROS   TO SUT00004-ORIG-OTBND-TRIP-ID       06840000
068500             END-IF                                               06850000
068600             IF DN-DEST-TRIP-ID = -1                              06860000
068700                MOVE ZEROS   TO SUT00004-DEST-OTBND-TRIP-ID       06870000
068800             END-IF                                               06880000
068900                                                                  06890000
069000             MOVE SUT00004-ORIG-OTBND-TRIP-ID TO                  06900000
069100                                    DK-ORIG-OTBND-TRIP-ID         06910000
069200             MOVE SUT00004-DEST-OTBND-TRIP-ID TO                  06920000
069300                                    DK-DEST-OTBND-TRIP-ID         06930000
069400         WHEN OTHER                                               06940000
069500             MOVE '5100-GET-OTBND-TRIP'                           06950000
069600                                    TO PV-PARAGRAPH-NAME          06960000
069700             MOVE 'SELECT FROM SUT_AUD_TRLR_TRIP'                 06970000
069800                              TO PV-DB2-OPERATION-ATTEMPTED       06980000
069900             PERFORM 9100-SQL-ABEND                               06990000
070000     END-EVALUATE.                                                07000000
070100                                                                  07010000
070200 7000-READ-CARDIN-FILE.                                           07020000
070300     READ CARDIN-TRLR-AUDIT-NBR-FILE INTO CC-CARDIN               07030000
070400        AT END                                                    07040000
070500           SET PS-EOF-CARDIN-FILE TO TRUE.                        07050000
070600                                                                  07060000
070700     IF PS-EOF-CARDIN-FILE                                        07070000
070800         CONTINUE                                                 07080000
070900     ELSE                                                         07090000
071000         DISPLAY 'TRLR AUDIT NBR IS : ' CC-AUD-CNTL-NBR           07100000
071100         PERFORM 7100-VALIDATE-CONTROL-CARD                       07110000
071200     END-IF.                                                      07120000
071300                                                                  07130000
071400*NUMERIC EDIT OF AUDIT CONTROL NUMBER                             07140000
071500 7100-VALIDATE-CONTROL-CARD.                                      07150000
071600                                                                  07160000
071700     MOVE CC-AUD-CNTL-NBR            TO DP010I-UNEDITED-FIELD.    07170000
071800     MOVE +9                         TO DP010I-MAXIMUM-DIGITS.    07180000
071900     MOVE 0                          TO DP010I-MAXIMUM-DECIMALS.  07190000
072000     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     07200000
072100     CALL DP010I-NUMERIC-EDIT-ROUTINE                             07210000
072200         USING DP010I-NUMERIC-EDIT-AREA.                          07220000
072300                                                                  07230000
072400     IF DP010I-NO-ERROR-DETECTED                                  07240000
072500         MOVE DP010I-NUMERIC-FIELD  TO DK-AUD-CNTL-NBR            07250000
072600                                       SU019-AUD-CNTL-NBR         07260000
072700     ELSE                                                         07270000
072800         DISPLAY '** SUKUT050 ABEND **'                           07280000
072900         DISPLAY '** AUDIT NUMBER IS NOT NUMERIC **'              07290000
073000         MOVE +4019                  TO PV-ABEND-CODE             07300000
073100         CALL 'ILBOABN0' USING PV-ABEND-CODE                      07310000
073200     END-IF.                                                      07320000
073300                                                                  07330000
073400 8000-WRITE-EXTRACT-RECORD.                                       07340000
073500     WRITE SU-CARTON-EXTRACT-RECORD                               07350000
073600       FROM SU019-EXTRACT-RECORD.                                 07360000
073700                                                                  07370000
073800     ADD +1 TO PV-WRITE-EXCEPTION-COUNT.                          07380000
073900                                                                  07390000
074000 9000-EOJ-ROUTINE.                                                07400000
074100                                                                  07410000
074200     CLOSE CARDIN-TRLR-AUDIT-NBR-FILE                             07420000
074300           SU-CARTON-EXTRACT-FILE.                                07430000
074400                                                                  07440000
074500 9100-SQL-ABEND.                                                  07450000
074600******************************************************************07460000
074700*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    07470000
074800*  ERROR OR WARNING CODE OCCURS.                                  07480000
074900******************************************************************07490000
075000     DISPLAY '9100-SQL-ABEND'.                                    07500000
075100     DISPLAY '** ABEND     **'.                                   07510000
075200     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        07520000
075300     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              07530000
075400     DISPLAY '** CARTON ID ** = ' PV-CARTON-ID-DISPLAY.           07540000
075500     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     07550000
075600                                                                  07560000
075700* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    07570000
075800* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         07580000
075900* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     07590000
076000* FORMAT.                                                         07600000
076100                                                                  07610000
076200     COPY DPPD004.                                                07620000
076300                                                                  07630000
076400     MOVE +4013                  TO ABEND-CODE.                   07640000
076500     CALL 'ILBOABN0' USING ABEND-CODE.                            07650000
