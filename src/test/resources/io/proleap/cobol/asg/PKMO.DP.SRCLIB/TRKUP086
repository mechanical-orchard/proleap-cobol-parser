000200 IDENTIFICATION DIVISION.                                         00020000
000220                                                                  00022051
000400 PROGRAM-ID.   TRKUP086.                                          00040099
000500 AUTHOR.       TKMA497.                                           00050099
000600 INSTALLATION. KOHLS DEPARTMENT STORES.                           00060000
000700 DATE-WRITTEN. NOVEMBER 2011.                                     00070099
000800 DATE-COMPILED.                                                   00080000
000810                                                                  00081051
000900* --------------------------------------------------------------  00090075
000900* FOR TRAILER-CSR-1:                                              00091099
001000* UPDATE TVEHICL STATUS TO 'ET' (END OF TRIP) AND CURRENT TRIP    00100099
001000* TO NULL WHERE CURRENT TVEHICL STATUS IS NOT 'ET' (END OF TRIP)  00100199
001000* AND TTRIPST STATUS IS 'DE' DELETED.                             00101099
000900*                                                                 00102099
000900* FOR TRAILER-CSR-2:                                              00102199
001000* UPDATE TVEHICL STATUS TO 'ET' (END OF TRIP) AND CURRENT TRIP    00103099
001000* TO NULL WHERE TVEHICL CURRENT TRIP ID DOES NOT EXIST ON         00104099
001000* AND TVHTRIP                                                     00105099
001710* --------------------------------------------------------------  00171075
001720                                                                  00172074
002000 ENVIRONMENT DIVISION.                                            00200000
002200 CONFIGURATION SECTION.                                           00220000
002300                                                                  00230000
002400 SOURCE-COMPUTER.        IBM-3090.                                00240000
002500 OBJECT-COMPUTER.        IBM-3090.                                00250000
002600                                                                  00260000
002700 INPUT-OUTPUT SECTION.                                            00270000
002710                                                                  00271051
002800 FILE-CONTROL.                                                    00280000
003300                                                                  00330074
004800 DATA DIVISION.                                                   00480000
004820                                                                  00482051
005000 FILE SECTION.                                                    00500000
005810                                                                  00581051
010000 WORKING-STORAGE SECTION.                                         01000000
010207                                                                  01020751
010230 01  PC-PROGRAM-CONSTANTS.                                        01023000
010300     05  PC-CURRENT-PROGRAM-NAME PIC  X(08) VALUE 'TRKUP086'.     01030099
010400     05  PC-MAX-RETRIES          PIC S9(03) VALUE +5 COMP-3.      01040053
010900                                                                  01090000
011000 01  PS-PROGRAM-SWITCHES.                                         01100000
011010                                                                  01101051
011100     05  PS-END-OF-TRAILER-CSR-1-SW     PIC X(01) VALUE 'N'.      01110099
011200         88  PS-END-OF-TRAILER-CSR-1-YES          VALUE 'Y'.      01120099
011300         88  PS-END-OF-TRAILER-CSR-1-NO           VALUE 'N'.      01130099
011100     05  PS-END-OF-TRAILER-CSR-2-SW     PIC X(01) VALUE 'N'.      01130199
011200         88  PS-END-OF-TRAILER-CSR-2-YES          VALUE 'Y'.      01130299
011300         88  PS-END-OF-TRAILER-CSR-2-NO           VALUE 'N'.      01130399
011310                                                                  01131051
016300 01  DATA-KEYS.                                                   01630099
016400     05  DK-CNTL-DATE.                                            01640056
016401         10  DK-CNTL-DATE-MO     PIC  9(02).                      01640158
016420         10  FILLER              PIC  X(01).                      01642056
016440         10  DK-CNTL-DATE-DY     PIC  9(02).                      01644058
016441         10  FILLER              PIC  X(01).                      01644156
016450         10  DK-CNTL-DATE-CCYY   PIC  9(04).                      01645056
016600                                                                  01660013
018600 01  PV-ABEND-FIELDS.                                             01860000
018700     05  PV-ABEND-CODE           PIC S9(04) VALUE +0 COMP.        01870053
018900     05  PV-ABEND-PROGRAM        PIC  X(08) VALUE 'TRKUP086'.     01890099
019000     05  PV-ABEND-PARAGRAPH      PIC  X(25) VALUE SPACES.         01900053
019100     05  PV-ABEND-MESSAGE        PIC  X(50) VALUE SPACES.         01910056
019200     05  PV-ABEND-OPERATION      PIC  X(20) VALUE SPACES.         01920056
019500     05  PV-DB2-OPER-MSG-1       PIC  X(79) VALUE SPACES.         01950061
019600     05  PV-DB2-OPER-MSG-2       PIC  X(79) VALUE SPACES.         01960061
019700                                                                  01970000
019720 01  PV-INPUT-TMST.                                               01972058
019740     05  PV-CNTL-TMST-CCYY       PIC  9(04).                      01974058
019760     05  FILLER                  PIC  X(01) VALUE '-'.            01976058
019770     05  PV-CNTL-TMST-MO         PIC  9(02).                      01977058
019780     05  FILLER                  PIC  X(01) VALUE '-'.            01978058
019790     05  PV-CNTL-TMST-DY         PIC  9(02).                      01979058
019791     05  FILLER                  PIC  X(01) VALUE '-'.            01979158
019793     05  PV-CNTL-TMST-HH         PIC  X(02) VALUE '00'.           01979394
019794     05  FILLER                  PIC  X(01) VALUE '.'.            01979458
019795     05  PV-CNTL-TMST-MM         PIC  X(02) VALUE '00'.           01979594
019796     05  FILLER                  PIC  X(01) VALUE '.'.            01979658
019797     05  PV-CNTL-TMST-SS         PIC  X(02) VALUE '00'.           01979794
019798     05  FILLER                  PIC  X(01) VALUE '.'.            01979858
019799     05  PV-CNTL-TMST-LAST6      PIC  X(06) VALUE '000000'.       01979994
019801                                                                  01980158
019802 01  PV-INPUT-CNTL-TMST          REDEFINES                        01980258
019803     PV-INPUT-TMST               PIC  X(26).                      01980358
019804                                                                  01980483
019805 01  WS-CURRENT-TMST             PIC  X(26).                      01980583
019810                                                                  01981058
019900 01  PV-PROGRAM-VARIABLES.                                        01990056
020000     05  PV-DISPLAY-TRLR-1-INP   PIC  ZZZ,ZZZ,ZZ9.                02000099
031410     05  PV-DISPLAY-TRLR-1-UPD   PIC  ZZZ,ZZZ,ZZ9.                03141099
020000     05  PV-DISPLAY-TRLR-2-INP   PIC  ZZZ,ZZZ,ZZ9.                03142099
020000     05  PV-DISPLAY-TRLR-2-UPD   PIC  ZZZ,ZZZ,ZZ9.                03143099
031500     05  PV-DISPLAY-COMMITS      PIC  ZZZ,ZZZ,ZZ9.                03150053
031510     05  PV-DISPLAY-SQLCODE      PIC  -------999.                 03151053
031510     05  PV-DISPLAY-CURR-TRIP    PIC  9(09).                      03152099
031510     05  PV-DISPLAY-TRLR-2       PIC  9(09).                      03153099
031510     05  PV-DISPLAY-OPER-UNT     PIC  9(04).                      03154099
031510     05  PV-DISPLAY-FCLTY-ID     PIC  9(04).                      03155099
031600     05  PV-RETRY-COUNTER        PIC S9(04) VALUE +0  COMP.       03160099
031700     05  PV-SQLCODE              PIC S9(09).                      03170053
031720     05  PV-COMMIT-LIMIT         PIC S9(03) VALUE +10 COMP-3.     03172099
031800                                                                  03180000
035100 01  PA-PROGRAM-ACCUMULATORS.                                     03510000
035200     05  PA-TRLR-1-FETCH-COUNT   PIC S9(09) VALUE +0 COMP-3.      03520099
035310     05  PA-TRLR-1-UPDATE-COUNT  PIC S9(09) VALUE +0 COMP-3.      03531099
035200     05  PA-TRLR-2-FETCH-COUNT   PIC S9(09) VALUE +0 COMP-3.      03532099
035310     05  PA-TRLR-2-UPDATE-COUNT  PIC S9(09) VALUE +0 COMP-3.      03533099
035410     05  PA-TOT-COMMIT-COUNT     PIC S9(07) VALUE +0 COMP-3.      03541099
035411     05  PA-COMMIT-COUNT         PIC S9(07) VALUE +1 COMP-3.      03541199
035413                                                                  03541360
035440* -------------------------------------------------------------- *03544051
035600*    WORK AREA FOR SQL ERROR ROUTINE 'DSNTIAR'.                   03560051
035610* -------------------------------------------------------------- *03561051
035620                                                                  03562051
035800     COPY DPWS004.                                                03580022
036100                                                                  03610000
036200* --------------------------------------------------------------  03620075
078000*    COMMUNICATIONS AREA FOR DB2                                  07800051
078010* --------------------------------------------------------------  07801075
078020                                                                  07802051
078200     EXEC SQL                                                     07820000
078300          INCLUDE SQLCA                                           07830000
078400     END-EXEC.                                                    07840000
078600                                                                  07860051
042800*----------------------------------------------------------------*07861099
042900*    DB2 TABLE FOR PARAMETERS                                     07862099
043000*----------------------------------------------------------------*07863099
043100     EXEC SQL                                                     07864099
043200          INCLUDE TKRPRPM                                         07865099
043300     END-EXEC.                                                    07866099
024900*                                                                 07867099
078700* --------------------------------------------------------------  07870075
079500*    DB2 TABLE DECLARATION - TR VEHICLE                           07950099
079610* --------------------------------------------------------------  07961075
079800     EXEC SQL                                                     07980000
079900          INCLUDE TVEHICL                                         07990099
080000     END-EXEC.                                                    08000000
080010                                                                  08001099
080020* --------------------------------------------------------------  08002099
080030*    DB2 TABLE DECLARATION - TR TRIP STATUS                       08003099
080050* --------------------------------------------------------------  08005099
080070     EXEC SQL                                                     08007099
080080          INCLUDE TTRIPST                                         08008099
080090     END-EXEC.                                                    08009099
080100                                                                  08010000
080020* --------------------------------------------------------------  08020099
080030*    DB2 TABLE DECLARATION - TR TRIP                              08030099
080050* --------------------------------------------------------------  08040099
080070     EXEC SQL                                                     08050099
080080          INCLUDE TVHTRIP                                         08060099
080090     END-EXEC.                                                    08070099
080100                                                                  08080099
081000* --------------------------------------------------------------  08100075
089900*    LOOK FOR TRAILERS WHERE TVEHICL STATUS IN ENROUTE AND        08990099
089900*    TTRIPST STATUS IS DELETED                                    08990199
089910* --------------------------------------------------------------  08991075
090100     EXEC SQL                                                     09010000
                DECLARE TRAILER-CSR-1 CURSOR WITH HOLD FOR              09020099
                SELECT A.OWNER_SCAC_ID, A.VEH_NBR                       09020199
                     , A.CURR_STATUS_CDE                                09020299
                     , A.CURR_TRIP_ID                                   09020399
                     , B.TRIP_ID, B.TRIP_STATUS_CDE, B.STATUS_DTE       09020599
                     , B.STATUS_TME, B.STATUS_UID, B.OPER_UNT_ID        09020699
                     , B.FCLTY_ID, B.FCLTY_AREA_ID, B.CRE_TMST          09020799
                FROM TVEHICL A                                          09020899
                   , TTRIPST B                                          09021099
                WHERE A.CURR_TRIP_ID  =  B.TRIP_ID                      09021199
                  AND B.STATUS_DTE IN                                   09021299
                      (SELECT MAX(C.STATUS_DTE)                         09021399
                         FROM TTRIPST C                                 09021499
                        WHERE B.TRIP_ID  = C.TRIP_ID)                   09021599
                  AND B.STATUS_TME IN                                   09021699
                      (SELECT MAX(D.STATUS_TME)                         09021799
                         FROM TTRIPST D                                 09021899
                        WHERE B.TRIP_ID  =  D.TRIP_ID                   09021999
                          AND D.STATUS_DTE  IN                          09022099
                             (SELECT MAX (E.STATUS_DTE)                 09022199
                                FROM TTRIPST E                          09022299
                               WHERE B.TRIP_ID  =  E.TRIP_ID)           09022399
                      )                                                 09022499
                  AND ((A.CURR_STATUS_CDE  <>  B.TRIP_STATUS_CDE)  OR   09022699
                       (A.CURR_TRIP_ID     <>  B.TRIP_ID)               09022799
                      )                                                 09022899
                  AND  B.TRIP_STATUS_CDE   = 'DE'                       09023099
                  WITH UR                                               09024099
091800     END-EXEC.                                                    09180000
095000                                                                  09500051
090100     EXEC SQL                                                     09501099
               DECLARE TRAILER-CSR-2 CURSOR WITH HOLD FOR               09502099
               SELECT A.OWNER_SCAC_ID, A.VEH_NBR, A.CRT_SRC_CDE         09510099
                    , A.CURR_STATUS_CDE, A.CURR_TRIP_ID                 09520099
                    , A.CURR_STATUS_DTE, A.CURR_STATUS_TME              09530099
                    , A.CURR_OPER_UNT_ID                                09540099
               FROM TVEHICL A                                           09550099
               WHERE A.CURR_TRIP_ID  NOT IN                             09560099
                     (SELECT B.CURR_TRIP_ID                             09570099
                        FROM TVEHICL B                                  09580099
                           , TVHTRIP C                                  09590099
                       WHERE B.CURR_TRIP_ID  =  C.TRIP_ID)              09600099
                AND A.CURR_STATUS_DTE <= CURRENT DATE -                 09610099
                                         :KRPRPM-FUNC-QTY DAYS          09611099
               ORDER BY A.CURR_STATUS_DTE, A.CURR_STATUS_TME            09620099
               WITH UR                                                  09630099
091800     END-EXEC.                                                    09631099
                                                                        09640099
098900 PROCEDURE DIVISION.                                              09890000
098920                                                                  09892051
099100 0001-PROGRAM-MAINLINE.                                           09910053
099410                                                                  09941051
099500     PERFORM 1000-INITIALIZE.                                     09950099
100010                                                                  10001051
100100     PERFORM 2000-PROCESS-TRAILERS.                               10010099
100200                                                                  10020000
100300     PERFORM 9000-EOJ-ROUTINE.                                    10030000
100800                                                                  10080000
100900     DISPLAY '****  END OF TRKUP086  ****'.                       10090099
101000                                                                  10100000
101100     STOP RUN.                                                    10110000
101200                                                                  10120000
101300* ------------------------------------------------------ *        10130054
101420                                                                  10142051
101600 1000-INITIALIZE.                                                 10160099
                                                                        10181399
025500     EXEC SQL                                                     10181499
                SELECT FUNC_QTY                                         10181599
                  INTO :KRPRPM-FUNC-QTY                                 10181699
026600            FROM TKRPRPM                                          10181799
026800           WHERE LOC_ID           = 90                            10181899
                   AND INTFC_SYS_CDE    = 'KHL'                         10181999
                   AND SYS_PRC_FUNC_CDE = 'TRDAY1'                      10182099
014161         WITH UR                                                  10182199
           END-EXEC                                                     10182299
112800     EVALUATE TRUE                                                10182399
112900         WHEN SQLCODE = ZERO                                      10182499
                    CONTINUE                                            10182599
113100         WHEN OTHER                                               10182699
                    DISPLAY 'SYS_PRC_FUNC_CDE = TRDAY1'                 10182799
113200              MOVE '1000-INITIALIZE' TO PV-ABEND-PARAGRAPH        10182899
213123              MOVE 'UPDATE TVEHICL'  TO PV-ABEND-OPERATION        10183299
213125              PERFORM 9900-DB2-ABEND                              10183399
113600     END-EVALUATE.                                                10183599
176920                                                                  17692051
177100 2000-PROCESS-TRAILERS.                                           17710099
177101                                                                  17710167
178400     DISPLAY '**   PROCESSING FIRST CURSOR'                       17710299
                                                                        17710399
177400     PERFORM 3100-OPEN-TRAILER-CSR-1.                             17740099
177620                                                                  17762051
177700     PERFORM 3200-FETCH-TRAILER-CSR-1.                            17770099
177920                                                                  17792051
178000     IF PS-END-OF-TRAILER-CSR-1-NO                                17800099
180400         PERFORM 3000-PROCESS-TRAILERS-1                          17804099
179300            UNTIL PS-END-OF-TRAILER-CSR-1-YES                     17804199
               PERFORM 8000-COMMIT                                      17804299
           ELSE                                                         17807099
178100         DISPLAY ' '                                              17810099
178200         DISPLAY '**************************************'         17820099
178300         DISPLAY '**     NO TRAILERS TO UPDATE'                   17830099
178400         DISPLAY '**     ON TVEHICL - FIRST CURSOR'               17840099
178500         DISPLAY '**************************************'         17850099
178600         DISPLAY ' '                                              17860099
178900     END-IF.                                                      17890000
179120                                                                  17912051
181800     PERFORM 3300-CLOSE-TRAILER-CSR-1.                            18180099
182050                                                                  18205051
178400     DISPLAY '**   PROCESSING SECOND CURSOR'                      18205199
                                                                        18205299
177400     PERFORM 4100-OPEN-TRAILER-CSR-2.                             18206099
177620                                                                  18207099
177700     PERFORM 4200-FETCH-TRAILER-CSR-2.                            18208099
177920                                                                  18209099
178000     IF PS-END-OF-TRAILER-CSR-2-NO                                18210099
180400         PERFORM 4000-PROCESS-TRAILERS-2                          18220099
M79300            UNTIL PS-END-OF-TRAILER-CSR-2-YES                     18230099
               PERFORM 8000-COMMIT                                      18240099
           ELSE                                                         18250099
178100         DISPLAY ' '                                              18260099
178200         DISPLAY '**************************************'         18270099
178300         DISPLAY '**     NO TRAILERS TO UPDATE '                  18280099
178400         DISPLAY '**     ON TVEHICL - SECOND CURSOR '             18290099
178500         DISPLAY '**************************************'         18300099
178600         DISPLAY ' '                                              18310099
178900     END-IF.                                                      18320099
179120                                                                  18330099
181800     PERFORM 4300-CLOSE-TRAILER-CSR-2.                            18340099
                                                                        19831099
213128******************************************************************19832099
                                                                        19833099
180400 3000-PROCESS-TRAILERS-1.                                         19840099
                                                                        19840199
213078     PERFORM 5000-UPDATE-TVEHICL.                                 19840299
213093     IF SQLCODE = +0                                              19840399
213098         ADD 1 TO PA-TRLR-1-UPDATE-COUNT                          19840599
213098     END-IF.                                                      19840699
                                                                        19840799
181200     PERFORM 3200-FETCH-TRAILER-CSR-1.                            19840899
                                                                        19840999
213128******************************************************************19841099
198410                                                                  19841199
182100 3100-OPEN-TRAILER-CSR-1.                                         19842099
182200                                                                  19843099
182300     EXEC SQL                                                     19844099
182400         OPEN TRAILER-CSR-1                                       19845099
182500     END-EXEC.                                                    19846099
182600                                                                  19847099
182700     EVALUATE TRUE                                                19848099
182710                                                                  19849099
182800       WHEN SQLCODE = +0                                          19850099
182900           SET PS-END-OF-TRAILER-CSR-1-NO TO TRUE                 19860099
183000                                                                  19870099
183100       WHEN OTHER                                                 19880099
183300           MOVE '3100-OPEN-TRAILER-CSR-1' TO PV-ABEND-PARAGRAPH   19890099
183400           MOVE 'OPEN TRAILER-CSR-1'    TO PV-ABEND-OPERATION     19900099
183500           PERFORM 9900-DB2-ABEND                                 19910099
183510                                                                  19920099
183600     END-EVALUATE.                                                19930099
183710                                                                  19940099
183900 3200-FETCH-TRAILER-CSR-1.                                        19950099
184020                                                                  19960099
184100     EXEC SQL                                                     19970099
184200         FETCH TRAILER-CSR-1                                      19980099
184300          INTO :VEHICL-OWNER-SCAC-ID                              19990099
184300             , :VEHICL-VEH-NBR                                    20000099
184400             , :VEHICL-CURR-STATUS-CDE                            20010099
184500             , :VEHICL-CURR-TRIP-ID                               20020099
184510             , :TRIPST-TRIP-ID                                    20030099
184510             , :TRIPST-TRIP-STATUS-CDE                            20040099
184510             , :TRIPST-STATUS-DTE                                 20050099
184520             , :TRIPST-STATUS-TME                                 20060099
184520             , :TRIPST-STATUS-UID                                 20070099
184520             , :TRIPST-OPER-UNT-ID                                20080099
184530             , :TRIPST-FCLTY-ID                                   20090099
184530             , :TRIPST-FCLTY-AREA-ID                              20100099
184530             , :TRIPST-CRE-TMST                                   20110099
184600     END-EXEC.                                                    20120099
184700                                                                  20130099
184800     EVALUATE TRUE                                                20140099
184810                                                                  20150099
184900       WHEN SQLCODE = +0                                          20160099
185000          ADD 1 TO PA-TRLR-1-FETCH-COUNT                          20170099
                MOVE VEHICL-CURR-TRIP-ID TO PV-DISPLAY-CURR-TRIP        20180099
                MOVE TRIPST-TRIP-ID      TO PV-DISPLAY-TRLR-2           20190099
                MOVE TRIPST-OPER-UNT-ID  TO PV-DISPLAY-OPER-UNT         20200099
                MOVE TRIPST-FCLTY-ID     TO PV-DISPLAY-FCLTY-ID         20210099
                DISPLAY '*** ' VEHICL-OWNER-SCAC-ID ' '                 20220099
                               VEHICL-VEH-NBR ' '                       20230099
                               VEHICL-CURR-STATUS-CDE ' '               20240099
                               PV-DISPLAY-CURR-TRIP ' '                 20250099
                               PV-DISPLAY-TRLR-2 ' '                    20260099
                               TRIPST-TRIP-STATUS-CDE ' '               20270099
                               TRIPST-STATUS-DTE ' '                    20280099
                               TRIPST-STATUS-TME ' '                    20290099
                               TRIPST-STATUS-UID ' '                    20300099
                               PV-DISPLAY-OPER-UNT ' '                  20310099
                               PV-DISPLAY-FCLTY-ID ' '                  20320099
                               TRIPST-FCLTY-AREA-ID ' '                 20330099
                               TRIPST-CRE-TMST                          20340099
186000       WHEN SQLCODE = +100                                        20350099
186100           SET PS-END-OF-TRAILER-CSR-1-YES TO TRUE                20360099
186300       WHEN OTHER                                                 20370099
186500           MOVE '3200-FETCH-TRAILER-CSR-1' TO PV-ABEND-PARAGRAPH  20380099
186600           MOVE 'FETCH TRAILER-CSR-1'    TO PV-ABEND-OPERATION    20390099
186700           PERFORM 9900-DB2-ABEND                                 20400099
186710                                                                  20410099
186800     END-EVALUATE.                                                20420099
187800                                                                  20430099
196800 3300-CLOSE-TRAILER-CSR-1.                                        20440099
196900                                                                  20450099
197000     EXEC SQL                                                     20460099
197100         CLOSE TRAILER-CSR-1                                      20470099
197200     END-EXEC.                                                    20480099
197300                                                                  20490099
197400     EVALUATE TRUE                                                20500099
197500       WHEN SQLCODE = +0                                          20510099
197600           CONTINUE                                               20520099
197800       WHEN OTHER                                                 20530099
198000           MOVE '3300-CLOSE-TRAILER-CSR-1' TO PV-ABEND-PARAGRAPH  20540099
198100           MOVE 'CLOSE TRAILER-CSR-1'    TO PV-ABEND-OPERATION    20550099
198200           PERFORM 9900-DB2-ABEND                                 20560099
198210                                                                  20570099
198300     END-EVALUATE.                                                20580099
198410                                                                  20581099
180400 4000-PROCESS-TRAILERS-2.                                         20581199
                                                                        20581299
213078     PERFORM 5000-UPDATE-TVEHICL.                                 20581399
213093     IF SQLCODE = +0                                              20581499
213098         ADD 1 TO PA-TRLR-2-UPDATE-COUNT                          20581599
213098     END-IF.                                                      20581699
                                                                        20581799
181200     PERFORM 4200-FETCH-TRAILER-CSR-2.                            20581899
                                                                        20581999
182100 4100-OPEN-TRAILER-CSR-2.                                         20582099
182200                                                                  20583099
182300     EXEC SQL                                                     20584099
182400         OPEN TRAILER-CSR-2                                       20585099
182500     END-EXEC.                                                    20586099
182600                                                                  20587099
182700     EVALUATE TRUE                                                20588099
182710                                                                  20589099
182800       WHEN SQLCODE = +0                                          20589199
182900           SET PS-END-OF-TRAILER-CSR-2-NO TO TRUE                 20589299
183000                                                                  20589399
183100       WHEN OTHER                                                 20589499
183300           MOVE '4100-OPEN-TRAILER-CSR-2' TO PV-ABEND-PARAGRAPH   20589599
183400           MOVE 'OPEN TRAILER-CSR-2' TO PV-ABEND-OPERATION        20589699
183500           PERFORM 9900-DB2-ABEND                                 20589799
183510                                                                  20589899
183600     END-EVALUATE.                                                20589999
183710                                                                  20590099
183900 4200-FETCH-TRAILER-CSR-2.                                        20591099
184020                                                                  20592099
184100     EXEC SQL                                                     20593099
184200         FETCH TRAILER-CSR-2                                      20594099
184300          INTO :VEHICL-OWNER-SCAC-ID                              20595099
184300             , :VEHICL-VEH-NBR                                    20596099
184400             , :VEHICL-CRT-SRC-CDE                                20597099
184400             , :VEHICL-CURR-STATUS-CDE                            20597199
184500             , :VEHICL-CURR-TRIP-ID                               20598099
184400             , :VEHICL-CURR-STATUS-DTE                            20598199
184400             , :VEHICL-CURR-STATUS-TME                            20598299
184400             , :VEHICL-CURR-OPER-UNT-ID                           20598399
184600     END-EXEC.                                                    20599999
                                                                        20600099
184800     EVALUATE TRUE                                                20610099
184810                                                                  20620099
184900       WHEN SQLCODE = +0                                          20630099
185000          ADD 1 TO PA-TRLR-2-FETCH-COUNT                          20640099
                MOVE VEHICL-CURR-TRIP-ID     TO PV-DISPLAY-CURR-TRIP    20650099
                MOVE VEHICL-CURR-OPER-UNT-ID TO PV-DISPLAY-OPER-UNT     20670099
                DISPLAY '*** ' VEHICL-OWNER-SCAC-ID ' '                 20690099
                               VEHICL-VEH-NBR ' '                       20700099
                               VEHICL-CRT-SRC-CDE ' '                   20710099
                               VEHICL-CURR-STATUS-CDE ' '               20711099
                               PV-DISPLAY-CURR-TRIP ' '                 20720099
                               VEHICL-CURR-STATUS-DTE ' '               20750099
                               VEHICL-CURR-STATUS-TME ' '               20760099
                               PV-DISPLAY-OPER-UNT                      20780099
186000       WHEN SQLCODE = +100                                        20820099
186100           SET PS-END-OF-TRAILER-CSR-2-YES TO TRUE                20830099
186300       WHEN OTHER                                                 20840099
186500           MOVE '4200-FETCH-TRAILER-CSR-2' TO PV-ABEND-PARAGRAPH  20850099
186600           MOVE 'FETCH TRAILER-CSR-2' TO PV-ABEND-OPERATION       20860099
186700           PERFORM 9900-DB2-ABEND                                 20870099
186710                                                                  20880099
186800     END-EVALUATE.                                                20890099
187800                                                                  20900099
196800 4300-CLOSE-TRAILER-CSR-2.                                        20910099
196900                                                                  20920099
197000     EXEC SQL                                                     20930099
197100         CLOSE TRAILER-CSR-2                                      20940099
197200     END-EXEC.                                                    20950099
197300                                                                  20960099
197400     EVALUATE TRUE                                                20970099
197500       WHEN SQLCODE = +0                                          20980099
197600           CONTINUE                                               20990099
197800       WHEN OTHER                                                 21000099
198000           MOVE '4300-CLOSE-TRAILER-CSR-2' TO PV-ABEND-PARAGRAPH  21010099
198100           MOVE 'CLOSE TRAILER-CSR-2' TO PV-ABEND-OPERATION       21020099
198200           PERFORM 9900-DB2-ABEND                                 21030099
198210                                                                  21040099
198300     END-EVALUATE.                                                21050099
                                                                        21060099
213078 5000-UPDATE-TVEHICL.                                             21307899
213079                                                                  21307951
213080     INITIALIZE PV-RETRY-COUNTER.                                 21308051
213081                                                                  21308151
213082     PERFORM WITH TEST AFTER                                      21308251
213083       UNTIL SQLCODE = +0 OR +100                                 21308352
213084         OR PV-RETRY-COUNTER > PC-MAX-RETRIES                     21308451
213085                                                                  21308551
213086         EXEC SQL                                                 21308699
213087            UPDATE TVEHICL                                        21308799
                     SET CURR_STATUS_CDE = 'ET'                         21308899
                        ,CURR_TRIP_ID    = NULL                         21308999
213088            WHERE OWNER_SCAC_ID = :VEHICL-OWNER-SCAC-ID           21309099
213088              AND VEH_NBR       = :VEHICL-VEH-NBR                 21309199
213088              AND CURR_TRIP_ID  = :VEHICL-CURR-TRIP-ID            21309299
213089         END-EXEC                                                 21309499
213090                                                                  21309599
213091         EVALUATE TRUE                                            21309699
213093            WHEN SQLCODE = +0                                     21309799
213096                ADD 1 TO  PA-COMMIT-COUNT                         21309899
213099                IF PA-COMMIT-COUNT > PV-COMMIT-LIMIT              21310099
213100                    PERFORM 8000-COMMIT                           21310199
213101                    MOVE +1 TO PA-COMMIT-COUNT                    21310299
213102                END-IF                                            21310399
213109            WHEN SQLCODE = -911  OR  -913                         21310951
213110                ADD +1 TO PV-RETRY-COUNTER                        21311051
213111            WHEN OTHER                                            21311151
213112                MOVE '5000-UPDATE-TVEHICL' TO PV-ABEND-PARAGRAPH  21311499
213113                MOVE 'UPDATE TVEHICL     ' TO PV-ABEND-OPERATION  21311599
213115                PERFORM 9900-DB2-ABEND                            21311651
213116                                                                  21311751
213117         END-EVALUATE                                             21311851
213118                                                                  21311951
213119     END-PERFORM.                                                 21312051
213120                                                                  21312151
213121     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         21312251
213122         MOVE '5000-UPDATE-TVEHICL' TO PV-ABEND-PARAGRAPH         21312599
213123         MOVE 'UPDATE TVEHICL     ' TO PV-ABEND-OPERATION         21312699
213125         PERFORM 9900-DB2-ABEND                                   21312851
213126     END-IF.                                                      21312951
213127                                                                  21313051
213128******************************************************************21313199
198600 8000-COMMIT.                                                     21313299
198700                                                                  21313399
198800     EXEC SQL                                                     21314099
198900         COMMIT                                                   21315099
199000     END-EXEC.                                                    21316099
199100                                                                  21317099
199200     EVALUATE TRUE                                                21318099
199300       WHEN SQLCODE = +0                                          21319099
199310           ADD +1 TO PA-TOT-COMMIT-COUNT                          21320099
199600       WHEN OTHER                                                 21340099
199700           MOVE '8000-COMMIT'    TO PV-ABEND-PARAGRAPH            21350099
199800           MOVE 'COMMIT TVEHICL' TO PV-ABEND-OPERATION            21360099
199900           PERFORM 9900-DB2-ABEND                                 21361099
200000     END-EVALUATE.                                                21362099
213700                                                                  21370051
692800* -------------------------------------------------------------- *69280051
692900*    9000-EOJ-ROUTINE                                             69290051
692910* -------------------------------------------------------------- *69291051
693010                                                                  69301051
693100 9000-EOJ-ROUTINE.                                                69310000
693201                                                                  69320140
694210* ---------------------------------------- *                      69421051
694300*    DISPLAY PROGRAM EXECUTION TOTALS.                            69430051
694301* ---------------------------------------- *                      69430151
694310                                                                  69431051
694311     MOVE PA-TRLR-1-FETCH-COUNT TO PV-DISPLAY-TRLR-1-INP.         69431199
694313     MOVE PA-TRLR-1-UPDATE-COUNT TO PV-DISPLAY-TRLR-1-UPD.        69431399
694311     MOVE PA-TRLR-2-FETCH-COUNT TO PV-DISPLAY-TRLR-2-INP.         69431499
694313     MOVE PA-TRLR-2-UPDATE-COUNT TO PV-DISPLAY-TRLR-2-UPD.        69431599
694314                                                                  69431671
694319     MOVE PA-TOT-COMMIT-COUNT  TO PV-DISPLAY-COMMITS.             69431999
694320                                                                  69432051
694640     DISPLAY '* ---------------------------------------'.         69464080
694640     DISPLAY '* FIRST CURSOR: '                                   69465099
694700     DISPLAY '* TOTAL TRAILERS FETCHED: ' PV-DISPLAY-TRLR-1-INP   69470099
694800     DISPLAY '* TOTAL TRAILERS UPDATED: ' PV-DISPLAY-TRLR-1-UPD   69480099
694640     DISPLAY '* ---------------------------------------'.         69481099
694640     DISPLAY '* SECOND CURSOR: '                                  69490099
694700     DISPLAY '* TOTAL TRAILERS FETCHED: ' PV-DISPLAY-TRLR-2-INP   69491099
694800     DISPLAY '* TOTAL TRAILERS UPDATED: ' PV-DISPLAY-TRLR-2-UPD   69491199
694913     DISPLAY '* ---------------------------------------'.         69491380
695312     DISPLAY '* TOTAL COMMITS TAKEN   : ' PV-DISPLAY-COMMITS      69531299
695313     DISPLAY '**---------------------------------------'.         69531380
695314     DISPLAY '                                         '.         69531480
695600                                                                  69560056
695700* -------------------------------------------------------------- *69570056
695800*    CALL THE ABEND PROCESSOR IN THE EVENT THAT A GENERAL        *69580056
695900*    ABEND OCCURS.                                               *69590056
696000* -------------------------------------------------------------- *69600056
696100                                                                  69610056
696200 9800-GENERAL-ABEND.                                              69620056
696300                                                                  69630056
696400     DISPLAY PV-ABEND-PROGRAM '**********************'.           69640056
696500     DISPLAY PV-ABEND-PROGRAM ' 9800-GENERAL-ABEND   '.           69650056
696600     DISPLAY PV-ABEND-PROGRAM '** ABEND            **'.           69660056
696700     DISPLAY PV-ABEND-PROGRAM ' ' PV-ABEND-PARAGRAPH.             69670056
696800     DISPLAY PV-ABEND-PROGRAM ' ' PV-ABEND-MESSAGE.               69680056
696810     DISPLAY PV-ABEND-PROGRAM '**********************'.           69681056
696820                                                                  69682058
696830     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         69683058
696900                                                                  69690000
697000                                                                  69700051
701900* -------------------------------------------------------------- *70190052
702000*    9900-DB2-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE   70200051
702100*    EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.              70210051
702110* -------------------------------------------------------------- *70211052
702210                                                                  70221051
702300 9900-DB2-ABEND.                                                  70230000
702400                                                                  70240000
702500     MOVE SQLCODE    TO PV-SQLCODE.                               70250000
702600     MOVE PV-SQLCODE TO PV-DISPLAY-SQLCODE.                       70260000
702610                                                                  70261051
702700     DISPLAY '***------------------------------------***'.        70270058
702701     DISPLAY '***             DB2 ERROR              ***'.        70270158
702710     DISPLAY '***                                    ***'.        70271058
702800     DISPLAY '*** SQLCODE   = ' PV-DISPLAY-SQLCODE.               70280000
702900     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 70290000
703000     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               70300000
703100     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               70310000
703200*    DISPLAY '*** MESSAGE   = ' PV-DB2-OPER-MSG-1.                70320099
703300*    DISPLAY '***           = ' PV-DB2-OPER-MSG-2.                70330099
703610                                                                  70361051
703620* -------------------------------------------------------------- *70362052
703800*    THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION        70380052
703900*    STATEMENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND        70390052
704000*    MODULE 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A    70400052
704100*    READABLE FORMAT.                                             70410052
704110* -------------------------------------------------------------- *70411052
704210                                                                  70421051
704300     COPY DPPD004.                                                70430021
704400                                                                  70440000
704500     IF SQLCODE NOT = -911                                        70450000
704600         EXEC SQL                                                 70460000
704700             ROLLBACK                                             70470000
704800         END-EXEC                                                 70480000
704900     END-IF.                                                      70490000
705000                                                                  70500000
706200     MOVE +4013 TO PV-ABEND-CODE.                                 70620051
706210                                                                  70621051
706300     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         70630000
