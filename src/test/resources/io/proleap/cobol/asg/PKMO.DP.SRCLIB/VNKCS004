000100*-----------------------*                                         08/24/95
000200 IDENTIFICATION DIVISION.                                         VNKCS004
000300*-----------------------*                                            LV035
000400 PROGRAM-ID.    VNKCS004.                                         VNKCS004
000500 AUTHOR.        TIM SMITH.                                        VNKCS004
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          VNKCS004
000700 DATE-WRITTEN.  06-15-93.                                         VNKCS004
000800*---------------------------------------------------------------* VNKCS004
000900*    V004 - VENDOR DEPARTMENT LIST PROGRAM.                     * VNKCS004
001000*                                                               * VNKCS004
001100*    THIS PROGRAM GENERATES A LIST OF INHOUSE VENDORS FOR A     * VNKCS004
001200*    SPECIFIC VENDOR. THE APPROPRIATE PROGRAM IS INVOKED WHEN   * VNKCS004
001300*    THE OPERATOR SELECTS ONE OR MORE ITEMS AND PRESSES A       * VNKCS004
001400*    FUNCTION KEY.                                              * VNKCS004
001500*                                                               * VNKCS004
001501*---------------------------------------------------------------* VNKCS004
001510* CHANGE LOG:                                                   *         
001520* 09/01/2021 GERMAN BANDA                    WR/IR #: CHG0261091          
001530*            - CHANGE CALL OF DPKUT100 TO                       *         
001540*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 *         
001550*              MAKING THE CALL DYNAMIC VS STATIC                *         
001560*                                                               *         
001520* 01/05/2023 JEAN KURK                       WR/IR #: CHG0277999*         
001530*            - CHANGE CALL OF DPKCS030 TO DYNAMIC               *         
001600*---------------------------------------------------------------* VNKCS004
001700 ENVIRONMENT DIVISION.                                            VNKCS004
001800 DATA DIVISION.                                                   VNKCS004
001900                                                                  VNKCS004
002000 WORKING-STORAGE SECTION.                                         VNKCS004
002100                                                                  VNKCS004
002200 01  DK-DB2-KEYS.                                                 VNKCS004
002300     15  DK-ENT-ID                      PIC S9(09)  COMP.         VNKCS004
002400     15  DK-DUNS-NUMBER                 PIC  X(09)  VALUE SPACES. VNKCS004
002500     15  DK-VENDOR-NAME                 PIC  X(30)  VALUE SPACES. VNKCS004
002600     15  DK-FTC-NUMBER                  PIC S9(09)  COMP.         VNKCS004
002700     15  DK-FTC-TYPE                    PIC  X(01)  VALUE SPACES. VNKCS004
002800                                                                  VNKCS004
002900 01  PC-PROGRAM-CONSTANTS.                                        VNKCS004
003000     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         VNKCS004
003100                                                    'VN004A  '.   VNKCS004
003200     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         VNKCS004
003300                                                    'VNKM004 '.   VNKCS004
003400     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         VNKCS004
003500                                                    'VNKCS004'.   VNKCS004
003600     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      VNKCS004
003700     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      VNKCS004
003800     05  PC-INTER-APPL-CODES.                                     VNKCS004
003900         10 PC-INTER-APPL-CRIT-SPEC     PIC  X(01)  VALUE '1'.    VNKCS004
004000         10 PC-INTER-APPL-LIST          PIC  X(01)  VALUE '2'.    VNKCS004
004100     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +14     VNKCS004
004200                                                    COMP SYNC.    VNKCS004
004300     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      VNKCS004
004400                                                    COMP SYNC.    VNKCS004
004500     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         VNKCS004
004600                                                    +1000000      VNKCS004
004700                                                    COMP-3.       VNKCS004
004800     05  PC-ITM-NUMBER-LENGTH           PIC S9(04)  VALUE +7      VNKCS004
004900                                                    COMP SYNC.    VNKCS004
005000     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       VNKCS004
005100                                                    COMP-3.       VNKCS004
005200     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  VNKCS004
005300     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  VNKCS004
005400     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  VNKCS004
005500     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  VNKCS004
005600     05  PC-ACTIVE                      PIC  X(01)  VALUE 'A'.       CL*21
005700     05  PC-INACTIVE                    PIC  X(01)  VALUE 'I'.       CL*21
005800                                                                  VNKCS004
005900     05  PC-TSYMSG-NUMBERS.                                       VNKCS004
006000         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  VNKCS004
006100         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  VNKCS004
006200         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  VNKCS004
006300         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  VNKCS004
006400         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  VNKCS004
006500         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  VNKCS004
006600         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  VNKCS004
006700         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  VNKCS004
006800         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  VNKCS004
006900         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  VNKCS004
007000         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  VNKCS004
007100         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  VNKCS004
007200         10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.  VNKCS004
007300         10  PC-TSYMSG-00159            PIC  9(05)  VALUE 00159.  VNKCS004
007400         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  VNKCS004
007500         10  PC-TSYMSG-00398            PIC  9(05)  VALUE 00398.  VNKCS004
007600         10  PC-TSYMSG-00487            PIC  9(05)  VALUE 00487.  VNKCS004
007700         10  PC-TSYMSG-00499            PIC  9(05)  VALUE 00499.  VNKCS004
007800         10  PC-TSYMSG-00500            PIC  9(05)  VALUE 00500.  VNKCS004
007900         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  VNKCS004
008000                                                                  VNKCS004
008100 01  PS-PROGRAM-SWITCHES.                                         VNKCS004
008200     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    VNKCS004
008300         88  PS-NO-ERROR                            VALUE 'Y'.    VNKCS004
008400         88  PS-ERROR                               VALUE 'N'.    VNKCS004
008500     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    VNKCS004
008600         88  PS-COMMAREA-VALID                      VALUE 'Y'.    VNKCS004
008700         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    VNKCS004
008800                                                                  VNKCS004
008900 01  PV-PROGRAM-VARIABLES.                                        VNKCS004
009000     05  PV-SUB                         PIC S9(04)  VALUE +0      VNKCS004
009100                                                    COMP SYNC.    VNKCS004
009200     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      VNKCS004
009300                                                    COMP SYNC.    VNKCS004
009400     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      VNKCS004
009500                                                    COMP-3.       VNKCS004
009600     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      VNKCS004
009700                                                    COMP-3.       VNKCS004
009800     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      VNKCS004
009900                                                    COMP-3.       VNKCS004
010000     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      VNKCS004
010100                                                    COMP-3.       VNKCS004
010200     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      VNKCS004
010300                                                    COMP-3.       VNKCS004
010400     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      VNKCS004
010500                                                    COMP-3.       VNKCS004
010600     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      VNKCS004
010700                                                    COMP-3.       VNKCS004
010800     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      VNKCS004
010900                                                    COMP SYNC.    VNKCS004
011000     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      VNKCS004
011100                                                    COMP SYNC.    VNKCS004
011200     05  PV-ITEM                        PIC S9(04)  VALUE +0      VNKCS004
011300                                                    COMP SYNC.    VNKCS004
011400     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      VNKCS004
011500                                                    COMP SYNC.    VNKCS004
011600     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      VNKCS004
011700                                                    COMP SYNC.    VNKCS004
011800     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      VNKCS004
011900                                                    COMP SYNC.    VNKCS004
012000     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      VNKCS004
012100                                                    COMP SYNC.    VNKCS004
012200     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      VNKCS004
012300                                                    COMP SYNC.    VNKCS004
012400     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      VNKCS004
012500                                                    COMP SYNC.    VNKCS004
012600     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      VNKCS004
012700                                                    COMP SYNC.    VNKCS004
012800     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      VNKCS004
012900                                                    COMP SYNC.    VNKCS004
013000     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      VNKCS004
013100                                                    COMP SYNC.    VNKCS004
013200     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      VNKCS004
013300                                                    COMP SYNC.    VNKCS004
013400     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      VNKCS004
013500                                                    COMP SYNC.    VNKCS004
013600     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      VNKCS004
013700                                                    COMP SYNC.    VNKCS004
013800     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      VNKCS004
013900                                                    COMP SYNC.    VNKCS004
014000     05  PV-DEPT-DESC                   PIC X(25)   VALUE SPACES. VNKCS004
014100     05  PV-INHOUSE-NBR                 PIC S9(03)  VALUE +0      VNKCS004
014200                                                    COMP-3.       VNKCS004
014300     05  PV-EDIT-PAYT-TERM-ID           PIC ZZ9.                  VNKCS004
014400     05  PV-STAT1                       PIC X(01)   VALUE 'A'.       CL*21
014500     05  PV-STAT2                       PIC X(01)   VALUE 'I'.       CL*21
014600******************************************************************VNKCS004
014700**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **VNKCS004
014800**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **VNKCS004
014900**  APPLICATION-SPECIFIC COMMAREA.                              **VNKCS004
015000******************************************************************VNKCS004
015100 01  LQW-LIST-QUEUE-WORK-AREA.                                    VNKCS004
015200     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  VNKCS004
015300     05  LQW-ITEM-ENTRIES               OCCURS 14 TIMES           VNKCS004
015400                                        INDEXED BY LQW-IDX.       VNKCS004
015500         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       VNKCS004
015600         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               VNKCS004
015700         10  LQW-SELECTED-SW            PIC  X(01).               VNKCS004
015800             88  LQW-SELECT                         VALUE 'S'.    VNKCS004
015900             88  LQW-DESELECT                       VALUE ' '.    VNKCS004
016000         10  LQW-ACTION                 PIC  X(03).               VNKCS004
016100         10  LQW-VEND-TYPE              PIC  X(01).               VNKCS004
016200         10  LQW-DEPT-NUMBER            PIC  X(03).               VNKCS004
016300         10  LQW-DEPT-NAME              PIC  X(25).               VNKCS004
016400         10  LQW-INHOUSE-NUMBER         PIC  9(03).               VNKCS004
016500         10  LQW-PAYMENT-TERMS          PIC  X(20).               VNKCS004
016600         10  LQW-PRETKT-IND             PIC  X(01).               VNKCS004
016700         10  LQW-STATUS-IND             PIC  X(01).                  CL*32
016800                                                                  VNKCS004
016900*---------------------------------------------------------------* VNKCS004
017000*  RECORD LAYOUT FOR THE VENDOR  SELECTION TEMP STORAGE QUEUE.  * VNKCS004
017100*---------------------------------------------------------------* VNKCS004
017200     COPY VNWS003.                                                VNKCS004
017300                                                                  VNKCS004
017400*---------------------------------------------------------------* VNKCS004
017500*    MAP LAYOUT                                                 * VNKCS004
017600*---------------------------------------------------------------* VNKCS004
017700     COPY VNKM004.                                                VNKCS004
017800                                                                  VNKCS004
017900 01  MR-OCCURS-LAYOUT                   REDEFINES  VN004AO.       VNKCS004
018000     05  FILLER                         PIC X(83).                VNKCS004
018100     05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          VNKCS004
018200         10  MR-SELECTL                 PIC S9(04) COMP.          VNKCS004
018300         10  MR-SELECTA                 PIC  X(01).               VNKCS004
018400         10  MR-SELECTC                 PIC  X(01).               VNKCS004
018500         10  MR-SELECTH                 PIC  X(01).               VNKCS004
018600         10  MR-SELECTI                 PIC  X(01).               VNKCS004
018700                                                                  VNKCS004
018800         10  MR-ACTIONL                 PIC S9(04) COMP.          VNKCS004
018900         10  MR-ACTIONA                 PIC  X(01).               VNKCS004
019000         10  MR-ACTIONC                 PIC  X(01).               VNKCS004
019100         10  MR-ACTIONH                 PIC  X(01).               VNKCS004
019200         10  MR-ACTION                  PIC  X(03).               VNKCS004
019300                                                                  VNKCS004
019400         10  MR-VEND-TYPEL              PIC S9(04) COMP.          VNKCS004
019500         10  MR-VEND-TYPEA              PIC  X(01).               VNKCS004
019600         10  MR-VEND-TYPEC              PIC  X(01).               VNKCS004
019700         10  MR-VEND-TYPEH              PIC  X(01).               VNKCS004
019800         10  MR-VEND-TYPE               PIC  X(01).               VNKCS004
019900                                                                  VNKCS004
020000         10  MR-DEPT-NUMBERL            PIC S9(04) COMP.          VNKCS004
020100         10  MR-DEPT-NUMBERA            PIC  X(01).               VNKCS004
020200         10  MR-DEPT-NUMBERC            PIC  X(01).               VNKCS004
020300         10  MR-DEPT-NUMBERH            PIC  X(01).               VNKCS004
020400         10  MR-DEPT-NUMBER-X.                                    VNKCS004
020500             15  MR-DEPT-NUMBER         PIC  X(03).               VNKCS004
020600                                                                  VNKCS004
020700         10  MR-DEPT-NAMEL              PIC S9(04) COMP.          VNKCS004
020800         10  MR-DEPT-NAMEA              PIC  X(01).               VNKCS004
020900         10  MR-DEPT-NAMEC              PIC  X(01).               VNKCS004
021000         10  MR-DEPT-NAMEH              PIC  X(01).               VNKCS004
021100         10  MR-DEPT-NAME               PIC  X(25).               VNKCS004
021200                                                                  VNKCS004
021300         10  MR-INHOUSE-NUMBERL         PIC S9(04) COMP.          VNKCS004
021400         10  MR-INHOUSE-NUMBERA         PIC  X(01).               VNKCS004
021500         10  MR-INHOUSE-NUMBERC         PIC  X(01).               VNKCS004
021600         10  MR-IMHOUSE-NUMBERH         PIC  X(01).               VNKCS004
021700         10  MR-INHOUSE-NUMBER          PIC  ZZZ.                 VNKCS004
021800                                                                  VNKCS004
021900         10  MR-PAYMENT-TERMSL          PIC S9(04) COMP.          VNKCS004
022000         10  MR-PAYMENT-TERMSA          PIC  X(01).               VNKCS004
022100         10  MR-PAYMENT-TERMSC          PIC  X(01).               VNKCS004
022200         10  MR-PAYMENT-TERMSH          PIC  X(01).               VNKCS004
022300         10  MR-PAYMENT-TERMS           PIC  X(20).               VNKCS004
022400                                                                  VNKCS004
022500         10  MR-PRETKT-INDL             PIC S9(04) COMP.          VNKCS004
022600         10  MR-PRETKT-INDA             PIC  X(01).               VNKCS004
022700         10  MR-PRETKT-INDC             PIC  X(01).               VNKCS004
022800         10  MR-PRETKT-INDH             PIC  X(01).               VNKCS004
022900         10  MR-PRETKT-IND              PIC  X(01).               VNKCS004
023000                                                                     CL*34
023100         10  MR-STATUS-INDL             PIC S9(04) COMP.             CL*32
023200         10  MR-STATUS-INDA             PIC  X(01).                  CL*32
023300         10  MR-STATUS-INDC             PIC  X(01).                  CL*32
023400         10  MR-STATUS-INDH             PIC  X(01).                  CL*32
023500         10  MR-STATUS-IND              PIC  X(01).                  CL*32
023600*---------------------------------------------------------------* VNKCS004
023700*    ATTRIBUTE SETTINGS COPYBOOK.                               * VNKCS004
023800*---------------------------------------------------------------* VNKCS004
023900     COPY DPWS015.                                                VNKCS004
024000                                                                  VNKCS004
024100*---------------------------------------------------------------* VNKCS004
024200*    FUNCTION KEYS COPYBOOK.                                    * VNKCS004
024300*---------------------------------------------------------------* VNKCS004
024400     COPY DPWS016.                                                VNKCS004
024500                                                                  VNKCS004
024600*---------------------------------------------------------------* VNKCS004
024700*    NUMERIC EDIT LAYOUT.                                       * VNKCS004
024800*---------------------------------------------------------------* VNKCS004
024900     COPY DPWS010I.                                               VNKCS004
025000                                                                  VNKCS004
025100*---------------------------------------------------------------* VNKCS004
025200*    PARAMETERS FOR CALLING CICS ARCHITECTURE API               * VNKCS004
025300*---------------------------------------------------------------* VNKCS004
025400     COPY DPWS030.                                                VNKCS004
025400     COPY DPWS930.                                                VNKCS004
025500                                                                  VNKCS004
025600*---------------------------------------------------------------* VNKCS004
025700*    STANDARD COMMAREA.                                         * VNKCS004
025800*---------------------------------------------------------------* VNKCS004
025900     COPY DPWS020.                                                VNKCS004
026000     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                VNKCS004
026100*---------------------------------------------------------------* VNKCS004
026200* INTER-APPLICATION COMMAREA.                                   * VNKCS004
026300*   VNWS001 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * VNKCS004
026400*             SPEC SCREEN.                                      * VNKCS004
026500*   VNWS002 - IS THE INPUT LAYOUT FOR THE LIST PROGRAM AND THE  * VNKCS004
026600*             OUTPUT LAYOUT FOR A LOCAL-GO FUNCTION.            * VNKCS004
026700*---------------------------------------------------------------* VNKCS004
026800         10  INTER-APPL-COMM-AREA       PIC X(200).               VNKCS004
026900     COPY VNWS001.                                                VNKCS004
027000     COPY VNWS002.                                                VNKCS004
027100         10  ASC-SPECIFIC-COMMAREA.                               VNKCS004
027200             15  ASC-LIST-KEYS.                                   VNKCS004
027300                 20  ASC-KEY-ENT-ID                  PIC S9(09)   VNKCS004
027400                                                     COMP.        VNKCS004
027500                 20  ASC-VENDOR-NAME                 PIC  X(30).  VNKCS004
027600             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                VNKCS004
027700                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  VNKCS004
027800                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   VNKCS004
027900                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   VNKCS004
028000                                                                  VNKCS004
028100                 20  ASC-ITEM-ARRAY.                              VNKCS004
028200                     25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        VNKCS004
028300                         30  ASC-LIST-ITEM-NUMBER                 VNKCS004
028400                                                     PIC S9(09)   VNKCS004
028500                                                     COMP-3.      VNKCS004
028600                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  VNKCS004
028700                             88  ASC-VALID-SELECT    VALUE ' '    VNKCS004
028800                                                           'S'    VNKCS004
028900                                                           'B'    VNKCS004
029000                                                           'E'.   VNKCS004
029100                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   VNKCS004
029200                             88  ASC-TEMP-SELECT     VALUE 'S'.   VNKCS004
029300                             88  ASC-TEMP-BEGIN      VALUE 'B'.   VNKCS004
029400                             88  ASC-TEMP-END        VALUE 'E'.   VNKCS004
029500                         30  ASC-SELECTED-SW         PIC  X(01).  VNKCS004
029600                             88  ASC-NO-SELECT       VALUE ' '.   VNKCS004
029700                             88  ASC-SELECT          VALUE 'S'.   VNKCS004
029800                             88  ASC-BEGIN           VALUE 'B'.   VNKCS004
029900                             88  ASC-END             VALUE 'E'.   VNKCS004
030000                         30  ASC-ACTION              PIC  X(03).  VNKCS004
030100                         30  ASC-VENDOR-TYPE         PIC  X(01).  VNKCS004
030200                         30  ASC-DEPT-NUMBER         PIC  X(03).  VNKCS004
030300                         30  ASC-DEPT-NAME           PIC  X(25).  VNKCS004
030400                         30  ASC-INHOUSE-NUMBER      PIC  9(03).  VNKCS004
030500                         30  ASC-PAYMENT-TERMS       PIC  X(20).  VNKCS004
030600                         30  ASC-PRETKT-IND          PIC  X(01).  VNKCS004
030700                         30  ASC-STATUS-IND          PIC  X(01).     CL*22
030800                                                                  VNKCS004
030900             15  ASC-BLK-SUB                         PIC S9(04)   VNKCS004
031000                                                          COMP    VNKCS004
031100                                                          SYNC.   VNKCS004
031200             15  ASC-ITEM-SUB                        PIC S9(04)   VNKCS004
031300                                                          COMP    VNKCS004
031400                                                          SYNC.   VNKCS004
031500             15  ASC-SEL-SUB                         PIC S9(04)   VNKCS004
031600                                                          COMP.   VNKCS004
031700             15  ASC-SEL-ITEM                        PIC S9(04)   VNKCS004
031800                                                          COMP.   VNKCS004
031900             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   VNKCS004
032000                                                          COMP-3. VNKCS004
032100             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   VNKCS004
032200                                                          COMP-3. VNKCS004
032300             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   VNKCS004
032400                                                          COMP-3. VNKCS004
032500             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   VNKCS004
032600                                                          COMP-3. VNKCS004
032700             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   VNKCS004
032800                                                          COMP-3. VNKCS004
032900             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   VNKCS004
033000                                                          COMP-3. VNKCS004
033100             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   VNKCS004
033200                                                          COMP    VNKCS004
033300                                                          SYNC.   VNKCS004
033400             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   VNKCS004
033500                                                          COMP-3. VNKCS004
033600             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   VNKCS004
033700                                                          COMP-3. VNKCS004
033800             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  VNKCS004
033900                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   VNKCS004
034000                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   VNKCS004
034100             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  VNKCS004
034200                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   VNKCS004
034300                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   VNKCS004
034400             15  ASC-LIST-QUEUE-NAME.                             VNKCS004
034500                 20  ASC-LIST-TERM-ID                PIC  X(04).  VNKCS004
034600                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   VNKCS004
034700                                                          COMP-3. VNKCS004
034800                 20  ASC-LIST-SEQ                    PIC  9(01).  VNKCS004
034900             15  ASC-SEL-QUEUE-NAME-IN               PIC  X(08).  VNKCS004
035000             15  ASC-SEL-QUEUE-NAME-OUT.                          VNKCS004
035100                 20  ASC-SEL-TERM-ID-OUT             PIC  X(04).  VNKCS004
035200                 20  ASC-SEL-TASK-NUMBER-OUT         PIC S9(05)   VNKCS004
035300                                                          COMP-3. VNKCS004
035400                 20  ASC-SEL-SEQ-OUT                 PIC  9(01).  VNKCS004
035500                                                                  VNKCS004
035600             15  ASC-START-ITEM-REQUEST.                          VNKCS004
035700                 20  ASC-START-ITEM-REQUEST-N        PIC  9(07).  VNKCS004
035800             15  ASC-USE-SELECTION-QUEUE-IND         PIC  X(01).  VNKCS004
035900                 88  ASC-USE-SELECTION-QUEUE         VALUE 'Y'.   VNKCS004
036000             15  ASC-PAYT-TERM-ID-DESC               PIC  X(28).  VNKCS004
036100                                                                  VNKCS004
036200*---------------------------------------------------------------* VNKCS004
036300*    ABEND PROCESSING COPYBOOK.                                 * VNKCS004
036400*---------------------------------------------------------------* VNKCS004
036500     COPY DPWS013.                                                VNKCS004
036600                                                                  VNKCS004
036700     COPY POWS020.                                                VNKCS004
036800                                                                  VNKCS004
036900*---------------------------------------------------------------* VNKCS004
037000*    DB2 AREA FOR TVNDDPT                                       * VNKCS004
037100*---------------------------------------------------------------* VNKCS004
037200     EXEC SQL                                                     VNKCS004
037300          INCLUDE TVNDDPT                                         VNKCS004
037400     END-EXEC.                                                    VNKCS004
037500                                                                  VNKCS004
037600*---------------------------------------------------------------* VNKCS004
037700*    DB2 AREA FOR TPAYTRM                                       * VNKCS004
037800*---------------------------------------------------------------* VNKCS004
037900     EXEC SQL                                                     VNKCS004
038000          INCLUDE TPAYTRM                                         VNKCS004
038100     END-EXEC.                                                    VNKCS004
038200                                                                  VNKCS004
038300*---------------------------------------------------------------* VNKCS004
038400*    DB2 AREA FOR TVNDAGR                                       * VNKCS004
038500*---------------------------------------------------------------* VNKCS004
038600     EXEC SQL                                                     VNKCS004
038700          INCLUDE TVNDAGR                                         VNKCS004
038800     END-EXEC.                                                    VNKCS004
038900                                                                  VNKCS004
039000*---------------------------------------------------------------* VNKCS004
039100*    DB2 AREA FOR TENTNME                                       * VNKCS004
039200*---------------------------------------------------------------* VNKCS004
039300     EXEC SQL                                                     VNKCS004
039400          INCLUDE TENTNME                                         VNKCS004
039500     END-EXEC.                                                    VNKCS004
039600                                                                  VNKCS004
039700*---------------------------------------------------------------* VNKCS004
039800*    DB2 AREA FOR TMDSEAR                                       * VNKCS004
039900*---------------------------------------------------------------* VNKCS004
040000     EXEC SQL                                                     VNKCS004
040100          INCLUDE TMDSEAR                                         VNKCS004
040200     END-EXEC.                                                    VNKCS004
040300                                                                  VNKCS004
040400*---------------------------------------------------------------* VNKCS004
040500*    DB2 AREA FOR TEXTENT                                       * VNKCS004
040600*---------------------------------------------------------------* VNKCS004
040700     EXEC SQL                                                     VNKCS004
040800          INCLUDE TEXTENT                                         VNKCS004
040900     END-EXEC.                                                    VNKCS004
041000                                                                  VNKCS004
041100*---------------------------------------------------------------* VNKCS004
041200*    DB2 AREA FOR TORGUNT                                       * VNKCS004
041300*---------------------------------------------------------------* VNKCS004
041400     EXEC SQL                                                     VNKCS004
041500          INCLUDE TORGUNT                                         VNKCS004
041600     END-EXEC.                                                    VNKCS004
041700                                                                  VNKCS004
041800*---------------------------------------------------------------* VNKCS004
041900*    DB2 AREA FOR COMMUNICATIONS                                * VNKCS004
042000*---------------------------------------------------------------* VNKCS004
042100     EXEC SQL                                                     VNKCS004
042200          INCLUDE SQLCA                                           VNKCS004
042300     END-EXEC.                                                    VNKCS004
042400                                                                  VNKCS004
042500*---------------------------------------------------------------* VNKCS004
042600*   CURSOR TO SELECT DEPARTMENT/INHOUSE/NAME FOR MDSE VENDOR      VNKCS004
042700*---------------------------------------------------------------* VNKCS004
042800                                                                     CL*34
042900     EXEC SQL                                                     VNKCS004
043000             DECLARE MDSE-VENDOR-CSR CURSOR FOR                   VNKCS004
043100              SELECT A.DEPT_NBR                                   VNKCS004
043200                    ,A.INHOUSE_NBR                                VNKCS004
043300                    ,A.VEND_TYP_IND                               VNKCS004
043400                    ,A.VND_DEPT_STAT_CD                              CL*22
043500                    ,B.MDSEAR_DESC                                VNKCS004
043600                FROM TVNDDPT A                                    VNKCS004
043700                    ,TMDSEAR B                                    VNKCS004
043800               WHERE A.ENT_ID      = :DK-ENT-ID                   VNKCS004
043900                 AND A.VND_DEPT_STAT_CD IN (:PV-STAT1, :PV-STAT2)    CL*22
044000                 AND B.DEPT_NBR    = A.DEPT_NBR                   VNKCS004
044100                 AND B.OPERCO_NBR  = '03'                         VNKCS004
044200                 AND B.MDSELV_CDE  = 'DPT'                        VNKCS004
044300                 AND B.STRT_DTE   <= CURRENT DATE                 VNKCS004
044400                 AND B.END_DTE    >= CURRENT DATE                 VNKCS004
044500            ORDER BY A.DEPT_NBR                                   VNKCS004
044600     END-EXEC.                                                    VNKCS004
044700                                                                  VNKCS004
044800*---------------------------------------------------------------* VNKCS004
044900*   CURSOR TO SELECT DEPARTMENT/NAME FOR EXPENSE VENDOR           VNKCS004
045000*---------------------------------------------------------------* VNKCS004
045100                                                                     CL*34
045200     EXEC SQL                                                     VNKCS004
045300             DECLARE EXP-VENDOR-CSR CURSOR FOR                    VNKCS004
045400              SELECT A.DEPT_NBR                                   VNKCS004
045500                    ,A.VEND_TYP_IND                               VNKCS004
045600                    ,A.VND_DEPT_STAT_CD                              CL*23
045700                    ,B.ORGUNT_NAME                                VNKCS004
045800                FROM TVNDDPT A                                    VNKCS004
045900                    ,TORGUNT B                                    VNKCS004
046000               WHERE A.ENT_ID           = :DK-ENT-ID              VNKCS004
046100                 AND A.VND_DEPT_STAT_CD IN (:PV-STAT1, :PV-STAT2)    CL*23
046200                 AND B.ORGUNT_NICK_NAME = A.DEPT_NBR              VNKCS004
046300                 AND B.ORGUNT_TYP_CDE   = '01'                    VNKCS004
046400            ORDER BY A.DEPT_NBR                                   VNKCS004
046500     END-EXEC.                                                    VNKCS004
046600                                                                  VNKCS004
046700 LINKAGE SECTION.                                                 VNKCS004
046800                                                                  VNKCS004
046900 01  DFHCOMMAREA.                                                 VNKCS004
047000     05  FILLER  OCCURS 1 TO 4072 TIMES                           VNKCS004
047100                 DEPENDING ON EIBCALEN.                           VNKCS004
047200         10  FILLER  PIC X.                                       VNKCS004
047300                                                                  VNKCS004
047400 PROCEDURE DIVISION.                                              VNKCS004
047500******************************************************************VNKCS004
047600**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **VNKCS004
047700**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **VNKCS004
047800**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **VNKCS004
047900******************************************************************VNKCS004
048000 0000-MAIN-MODULE.                                                VNKCS004
048100                                                                  VNKCS004
048200     INITIALIZE DP030-CICS-API-FIELDS.                            VNKCS004
048300     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       VNKCS004
048400     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          VNKCS004
048500     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         VNKCS004
048600     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       VNKCS004
048700     MOVE LENGTH OF VN004AI        TO DP030-MAP-LENGTH (1).       VNKCS004
048800     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     VNKCS004
048900     PERFORM 0001-CALL-CICS-ARCH-API.                             VNKCS004
049000                                                                  VNKCS004
049100     PERFORM 1000-CONTROL-PROCESSING                              VNKCS004
049200                                                                  VNKCS004
049300     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     VNKCS004
049400     PERFORM 0001-CALL-CICS-ARCH-API.                             VNKCS004
049500                                                                  VNKCS004
049600******************************************************************VNKCS004
049700**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **VNKCS004
049800**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **VNKCS004
049900******************************************************************VNKCS004
050000 0001-CALL-CICS-ARCH-API.                                         VNKCS004
050100                                                                  VNKCS004
050200*    CALL 'DPKCS030' USING DFHEIBLK                               VNKCS004
050200     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      VNKCS004
050300                           DFHCOMMAREA                            VNKCS004
050400                           DP030-CICS-API-FIELDS                  VNKCS004
050500                           DP020-STANDARD-COMMAREA                VNKCS004
050600                           VN004AI.                               VNKCS004
050700                                                                  VNKCS004
050800     IF  DP030-RC-CALL-SUCCESSFUL                                 VNKCS004
050900         CONTINUE                                                 VNKCS004
051000     ELSE                                                         VNKCS004
051100         SET DP013-NO-ROLLBACK                                    VNKCS004
051200             DP013-XCTL-DISPLAY-RESTART                           VNKCS004
051300             DP013-CICS-ABEND      TO TRUE                        VNKCS004
051400         MOVE '0001-CALL-CICS-ARCH-API'                           VNKCS004
051500                                   TO DP013-PARAGRAPH             VNKCS004
051600*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEXVNKCS004
051700*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      VNKCS004
051600         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE OVNKCS004
051700-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      VNKCS004
051800         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      VNKCS004
051900         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS004
052000     END-IF.                                                      VNKCS004
052100                                                                  VNKCS004
052200*----------------------------------------------------------------*VNKCS004
052300* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *VNKCS004
052400* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *VNKCS004
052500*                                                                *VNKCS004
052600* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *VNKCS004
052700*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *VNKCS004
052800*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *VNKCS004
052900*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *VNKCS004
053000*----------------------------------------------------------------*VNKCS004
053100 1000-CONTROL-PROCESSING.                                         VNKCS004
053200                                                                  VNKCS004
053300     EVALUATE TRUE                                                VNKCS004
053400         WHEN DP020-NEXT-ACT-INITIAL                              VNKCS004
053500             INITIALIZE ASC-SPECIFIC-COMMAREA                     VNKCS004
053600             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            VNKCS004
053700                                      ASC-SEL-TERM-ID-OUT         VNKCS004
053800             MOVE DP020-SRC-TASK-NUMBER                           VNKCS004
053900                                   TO ASC-LIST-TASK-NUMBER        VNKCS004
054000                                      ASC-SEL-TASK-NUMBER-OUT     VNKCS004
054100             MOVE PC-LIST-QUEUE-SEQ                               VNKCS004
054200                                   TO ASC-LIST-SEQ                VNKCS004
054300             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ-OUT             VNKCS004
054400             PERFORM 1100-PROCESS-INTER-APPL-COMM                 VNKCS004
054500             IF  PS-COMMAREA-NOT-VALID                            VNKCS004
054600                 SET DP020-MSG-FATAL                              VNKCS004
054700                     DP020-NEXT-ACT-APPL-ERROR                    VNKCS004
054800                                   TO TRUE                        VNKCS004
054900             ELSE                                                 VNKCS004
055000                 PERFORM 4000-BUILD-INITIAL-PANEL                 VNKCS004
055100             END-IF                                               VNKCS004
055200                                                                  VNKCS004
055300         WHEN DP020-NEXT-ACT-READ-MAP                             VNKCS004
055400             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        VNKCS004
055500                                   TO PV-TOP-ITEM                 VNKCS004
055600             PERFORM 2000-PROCESS-PANEL                           VNKCS004
055700                                                                  VNKCS004
055800         WHEN DP020-NEXT-ACT-RETURN                               VNKCS004
055900             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        VNKCS004
056000                                   TO PV-TOP-ITEM                 VNKCS004
056100             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    VNKCS004
056200             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 VNKCS004
056300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   VNKCS004
056400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 VNKCS004
056500                                                                  VNKCS004
056600         WHEN OTHER                                               VNKCS004
056700             SET DP013-LOGIC-ABEND TO TRUE                        VNKCS004
056800             SET DP013-NO-ROLLBACK TO TRUE                        VNKCS004
056900             MOVE '1000-CONTROL-PROCESSING'                       VNKCS004
057000                                   TO DP013-PARAGRAPH             VNKCS004
057100             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    VNKCS004
057200                                   TO DP013-MESSAGE-TEXT(1)       VNKCS004
057300             PERFORM DP013-0000-PROCESS-ABEND                     VNKCS004
057400     END-EVALUATE.                                                VNKCS004
057500                                                                  VNKCS004
057600*----------------------------------------------------------------*VNKCS004
057700* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *VNKCS004
057800* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *VNKCS004
057900*----------------------------------------------------------------*VNKCS004
058000 1100-PROCESS-INTER-APPL-COMM.                                    VNKCS004
058100                                                                  VNKCS004
058200     MOVE SPACE TO ASC-START-ITEM-REQUEST.                        VNKCS004
058300     EVALUATE DP020-INT-APPL-FORMAT-IND                           VNKCS004
058400         WHEN PC-INTER-APPL-CRIT-SPEC                             VNKCS004
058500              IF VN001-DUNS-NUMBER > SPACES                               
058600                  MOVE VN001-DUNS-NUMBER                                  
058700                           TO DK-DUNS-NUMBER                              
058800                  PERFORM 1110-SELECT-ENTERPRISE                          
058900              ELSE                                                        
059000                  IF VN001-VENDOR-NAME > SPACES                           
059100                      MOVE VN001-VENDOR-NAME                              
059200                           TO DK-VENDOR-NAME                              
059300                      PERFORM 1115-SELECT-ENTERPRISE-NAME                 
059400                  ELSE                                                    
059500                      MOVE PC-TSYMSG-00487                                
059600                           TO DP020-MSG-NUMBER                            
059700                     SET PS-COMMAREA-NOT-VALID                            
059800                           TO TRUE                                        
059900                  END-IF                                                  
060000              END-IF                                                      
060100         WHEN PC-INTER-APPL-LIST                                  VNKCS004
060200              SET PS-COMMAREA-VALID                               VNKCS004
060300                  ASC-USE-SELECTION-QUEUE                         VNKCS004
060400                                   TO TRUE                        VNKCS004
060500              MOVE VN002-NUMBER-OF-SELECTED-ITEMS                 VNKCS004
060600                                   TO ASC-NUMBER-OF-SELECTED-ITEMSVNKCS004
060700              MOVE VN002-NUMBER-OF-TS-ITEMS                       VNKCS004
060800                                   TO ASC-NUMBER-OF-TS-ITEMS      VNKCS004
060900              MOVE VN002-SEL-QUEUE-NAME                           VNKCS004
061000                                   TO ASC-SEL-QUEUE-NAME-IN       VNKCS004
061100              PERFORM 1120-PREPARE-LIST-ENTRY                     VNKCS004
061200                                                                  VNKCS004
061300         WHEN OTHER                                               VNKCS004
061400                 MOVE PC-TSYMSG-00148                             VNKCS004
061500                                   TO DP020-MSG-NUMBER            VNKCS004
061600                 SET DP020-MSG-FATAL                              VNKCS004
061700                     DP020-NEXT-ACT-APPL-ERROR                    VNKCS004
061800                                   TO TRUE                        VNKCS004
061900     END-EVALUATE.                                                VNKCS004
062000*----------------------------------------------------------------*VNKCS004
062100* SELECT A ROW FROM THE DB2 EXTERNAL ENTERPRISE TABLE USING THE  *VNKCS004
062200* DUNS NUMBER PASSED FROM THE VENDOR CRITERIA SPECIFICATION      *VNKCS004
062300*----------------------------------------------------------------*VNKCS004
062400 1110-SELECT-ENTERPRISE.                                          VNKCS004
062500                                                                  VNKCS004
062600     PERFORM                                                      VNKCS004
062700         WITH TEST AFTER                                          VNKCS004
062800         VARYING PV-RETRY-COUNTER                                 VNKCS004
062900         FROM 1 BY 1                                              VNKCS004
063000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               VNKCS004
063100                   OR (SQLCODE = ZERO)                            VNKCS004
063200                   OR (SQLCODE = +100))                           VNKCS004
063300                                                                  VNKCS004
063400         EXEC SQL                                                 VNKCS004
063500             SELECT ENT_ID                                        VNKCS004
063600             INTO   :EXTENT-ENT-ID                                VNKCS004
063700             FROM   TEXTENT                                       VNKCS004
063800             WHERE  DUN_NBR = :DK-DUNS-NUMBER                     VNKCS004
063900         END-EXEC                                                 VNKCS004
064000                                                                  VNKCS004
064100         EVALUATE TRUE                                            VNKCS004
064200             WHEN SQLCODE = ZERO                                  VNKCS004
064300             WHEN SQLCODE = +100                                  VNKCS004
064400             WHEN SQLCODE = -904                                  VNKCS004
064500             WHEN SQLCODE = -913                                  VNKCS004
064600                 CONTINUE                                         VNKCS004
064700             WHEN SQLWARN0 NOT = SPACES                           VNKCS004
064800             WHEN SQLCODE < ZERO                                  VNKCS004
064900             WHEN SQLCODE > ZERO                                  VNKCS004
065000                 MOVE '1100-SELECT-ENTERPIRSE'                    VNKCS004
065100                                   TO DP013-PARAGRAPH             VNKCS004
065200                 MOVE 'SELECT ENTERPRISE'                         VNKCS004
065300                                   TO DP013-MESSAGE-TEXT (1)      VNKCS004
065400                 MOVE SQLCA        TO DP013-SQLCA                 VNKCS004
065500                 MOVE 'TEXTENT'    TO DP013-SQLCA                 VNKCS004
065600                 SET DP013-DB2-ABEND                              VNKCS004
065700                     DP013-XCTL-DISPLAY-RESTART                   VNKCS004
065800                                   TO TRUE                        VNKCS004
065900                 PERFORM DP013-0000-PROCESS-ABEND                 VNKCS004
066000         END-EVALUATE                                             VNKCS004
066100     END-PERFORM.                                                 VNKCS004
066200                                                                  VNKCS004
066300     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         VNKCS004
066400         MOVE '1110-SELECT-ENTERPRISE'                            VNKCS004
066500                                   TO DP013-PARAGRAPH             VNKCS004
066600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     VNKCS004
066700                                   TO DP013-MESSAGE-TEXT (1)      VNKCS004
066800         MOVE 'ENTERPRISE'         TO DP013-MESSAGE-TEXT (2)      VNKCS004
066900         MOVE SQLCA                TO DP013-SQLCA                 VNKCS004
067000         MOVE 'TEXTENT'            TO DP013-DB2-TABLE-NAME (1)    VNKCS004
067100         SET DP013-DB2-ABEND                                      VNKCS004
067200             DP013-XCTL-DISPLAY-RESTART                           VNKCS004
067300                                   TO TRUE                        VNKCS004
067400         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS004
067500     END-IF.                                                      VNKCS004
067600                                                                  VNKCS004
067700     IF SQLCODE = ZERO                                            VNKCS004
067800          SET PS-COMMAREA-VALID                                   VNKCS004
067900                                   TO TRUE                        VNKCS004
068000          MOVE EXTENT-ENT-ID       TO ASC-KEY-ENT-ID              VNKCS004
068100                                      DK-ENT-ID                   VNKCS004
068200     ELSE                                                         VNKCS004
068300          MOVE PC-TSYMSG-00159     TO DP020-MSG-NUMBER            VNKCS004
068400          SET PS-COMMAREA-NOT-VALID                               VNKCS004
068500                                   TO TRUE                        VNKCS004
068600     END-IF.                                                      VNKCS004
068700                                                                  VNKCS004
068800 1115-SELECT-ENTERPRISE-NAME.                                     VNKCS004
068900                                                                  VNKCS004
069000     PERFORM                                                      VNKCS004
069100         WITH TEST AFTER                                          VNKCS004
069200         VARYING PV-RETRY-COUNTER                                 VNKCS004
069300         FROM 1 BY 1                                              VNKCS004
069400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               VNKCS004
069500                   OR (SQLCODE = ZERO)                            VNKCS004
069600                   OR (SQLCODE = +100))                           VNKCS004
069700                                                                  VNKCS004
069800         EXEC SQL                                                 VNKCS004
069900             SELECT ENT_ID                                        VNKCS004
070000             INTO   :ENTNME-ENT-ID                                VNKCS004
070100             FROM   TENTNME                                       VNKCS004
070200             WHERE  ENT_NAME_DESC = :DK-VENDOR-NAME               VNKCS004
070300         END-EXEC                                                 VNKCS004
070400                                                                  VNKCS004
070500         EVALUATE TRUE                                            VNKCS004
070600             WHEN SQLCODE = ZERO                                  VNKCS004
070700             WHEN SQLCODE = +100                                  VNKCS004
070800             WHEN SQLCODE = -904                                  VNKCS004
070900             WHEN SQLCODE = -913                                  VNKCS004
071000                 CONTINUE                                         VNKCS004
071100             WHEN SQLWARN0 NOT = SPACES                           VNKCS004
071200             WHEN SQLCODE < ZERO                                  VNKCS004
071300             WHEN SQLCODE > ZERO                                  VNKCS004
071400                 MOVE '1115-SELECT-ENTERPRISE-NAME'                  CL**8
071500                                   TO DP013-PARAGRAPH             VNKCS004
071600                 MOVE 'SELECT ENTERPRISE NAME'                    VNKCS004
071700                                   TO DP013-MESSAGE-TEXT (1)      VNKCS004
071800                 MOVE SQLCA        TO DP013-SQLCA                 VNKCS004
071900                 MOVE 'TENTNME'    TO DP013-SQLCA                 VNKCS004
072000                 SET DP013-DB2-ABEND                              VNKCS004
072100                     DP013-XCTL-DISPLAY-RESTART                   VNKCS004
072200                                   TO TRUE                        VNKCS004
072300                 PERFORM DP013-0000-PROCESS-ABEND                 VNKCS004
072400         END-EVALUATE                                             VNKCS004
072500     END-PERFORM.                                                 VNKCS004
072600                                                                  VNKCS004
072700     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         VNKCS004
072800         MOVE '1115-SELECT-ENTERPRISE-NAME'                       VNKCS004
072900                                   TO DP013-PARAGRAPH             VNKCS004
073000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     VNKCS004
073100                                   TO DP013-MESSAGE-TEXT (1)      VNKCS004
073200         MOVE 'ENTERPRISE NAME'    TO DP013-MESSAGE-TEXT (2)      VNKCS004
073300         MOVE SQLCA                TO DP013-SQLCA                 VNKCS004
073400         MOVE 'TENTNME'            TO DP013-DB2-TABLE-NAME (1)    VNKCS004
073500         SET DP013-DB2-ABEND                                      VNKCS004
073600             DP013-XCTL-DISPLAY-RESTART                           VNKCS004
073700                                   TO TRUE                        VNKCS004
073800         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS004
073900     END-IF.                                                      VNKCS004
074000                                                                  VNKCS004
074100     IF SQLCODE = ZERO                                            VNKCS004
074200          SET PS-COMMAREA-VALID                                   VNKCS004
074300                                   TO TRUE                        VNKCS004
074400          MOVE ENTNME-ENT-ID       TO ASC-KEY-ENT-ID              VNKCS004
074500                                      DK-ENT-ID                   VNKCS004
074600     ELSE                                                         VNKCS004
074700          MOVE PC-TSYMSG-00398     TO DP020-MSG-NUMBER            VNKCS004
074800          SET PS-COMMAREA-NOT-VALID                               VNKCS004
074900                                   TO TRUE                        VNKCS004
075000     END-IF.                                                      VNKCS004
075100                                                                  VNKCS004
075200*----------------------------------------------------------------*VNKCS004
075300*  ENTRY IS FROM A LIST. GET THE KEYS FROM THE TEMP STORAGE      *VNKCS004
075400*  QUEUE PASSED FROM THE LIST.                                   *VNKCS004
075500*                                                                *VNKCS004
075600*----------------------------------------------------------------*VNKCS004
075700 1120-PREPARE-LIST-ENTRY.                                         VNKCS004
075800                                                                  VNKCS004
075900      MOVE VN003-MAX-ITEMS TO ASC-SEL-SUB.                        VNKCS004
076000      MOVE ZERO            TO ASC-SEL-ITEM.                       VNKCS004
076100                                                                  VNKCS004
076200      PERFORM 2300-GET-NEXT-MESSAGE.                              VNKCS004
076300                                                                  VNKCS004
076400*----------------------------------------------------------------*VNKCS004
076500* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *VNKCS004
076600* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *VNKCS004
076700* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *VNKCS004
076800* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *VNKCS004
076900* FUNCTION KEYS CAN GET THIS FAR.                                *VNKCS004
077000*----------------------------------------------------------------*VNKCS004
077100 2000-PROCESS-PANEL.                                              VNKCS004
077200                                                                  VNKCS004
077300     EVALUATE TRUE                                                VNKCS004
077400         WHEN DP020-SRC-AID = DP016-CLEAR                         VNKCS004
077500             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    VNKCS004
077600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   VNKCS004
077700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 VNKCS004
077800                                                                  VNKCS004
077900         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    VNKCS004
078000             MOVE ASC-KEY-ENT-ID                                  VNKCS004
078100                                   TO DK-ENT-ID                   VNKCS004
078200             PERFORM 2050-DELETE-LIST-QUEUE                       VNKCS004
078300             PERFORM 4000-BUILD-INITIAL-PANEL                     VNKCS004
078400                                                                  VNKCS004
078500         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    VNKCS004
078600             PERFORM 2140-DESELECT-ALL-ITEMS                      VNKCS004
078700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 VNKCS004
078800                                                                  VNKCS004
078900         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  VNKCS004
079000             PERFORM 2150-SELECT-ALL-ITEMS                        VNKCS004
079100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 VNKCS004
079200                                                                  VNKCS004
079300         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             VNKCS004
079400             IF ASC-USE-SELECTION-QUEUE                           VNKCS004
079500                 PERFORM 6200-DEL-LIST-QUEUE                      VNKCS004
079600                 PERFORM 2300-GET-NEXT-MESSAGE                    VNKCS004
079700                 PERFORM 4000-BUILD-INITIAL-PANEL                 VNKCS004
079800                 PERFORM 3200-RESET-ATTRIBUTES                    VNKCS004
079900             ELSE                                                 VNKCS004
080000*                --- BOTTOM OF LIST ---                           VNKCS004
080100                 MOVE PC-TSYMSG-00070                             VNKCS004
080200                                   TO DP020-MSG-NUMBER            VNKCS004
080300                 SET DP020-MSG-INFORMATIONAL                      VNKCS004
080400                                   TO TRUE                        VNKCS004
080500             END-IF                                               VNKCS004
080600                                                                  VNKCS004
080700         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             VNKCS004
080800             IF ASC-USE-SELECTION-QUEUE                           VNKCS004
080900                 PERFORM 6200-DEL-LIST-QUEUE                      VNKCS004
081000                 PERFORM 2310-GET-PREV-MESSAGE                    VNKCS004
081100                 PERFORM 4000-BUILD-INITIAL-PANEL                 VNKCS004
081200                 PERFORM 3200-RESET-ATTRIBUTES                    VNKCS004
081300             ELSE                                                 VNKCS004
081400*                --- TOP OF LIST ---                              VNKCS004
081500                 MOVE PC-TSYMSG-00069                             VNKCS004
081600                                   TO DP020-MSG-NUMBER            VNKCS004
081700                 SET DP020-MSG-INFORMATIONAL                      VNKCS004
081800                                   TO TRUE                        VNKCS004
081900             END-IF                                               VNKCS004
082000                                                                     CL*34
082100         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)                  CL*29
082200             PERFORM 2050-DELETE-LIST-QUEUE                          CL*29
082300             PERFORM 4000-BUILD-INITIAL-PANEL                        CL*29
082400                                                                     CL*29
082500         WHEN OTHER                                               VNKCS004
082600             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 VNKCS004
082700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   VNKCS004
082800             IF  PS-NO-ERROR                                      VNKCS004
082900                 SET DP030-CONTINUE-GO                            VNKCS004
083000                                   TO TRUE                        VNKCS004
083100                 PERFORM 2100-CHECK-FUNCTION-KEY                  VNKCS004
083200             ELSE                                                 VNKCS004
083300                 SET DP030-OVERRIDE-GO                            VNKCS004
083400                                 TO TRUE                          VNKCS004
083500             END-IF                                               VNKCS004
083600     END-EVALUATE.                                                VNKCS004
083700                                                                  VNKCS004
083800*----------------------------------------------------------------*VNKCS004
083900*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *VNKCS004
084000*----------------------------------------------------------------*VNKCS004
084100 2050-DELETE-LIST-QUEUE.                                          VNKCS004
084200                                                                  VNKCS004
084300     EXEC CICS                                                    VNKCS004
084400         DELETEQ TS                                               VNKCS004
084500             QUEUE (ASC-LIST-QUEUE-NAME)                          VNKCS004
084600             RESP  (PV-CICS-RESP)                                 VNKCS004
084700     END-EXEC.                                                    VNKCS004
084800                                                                  VNKCS004
084900     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       VNKCS004
085000        (PV-CICS-RESP = DFHRESP(QIDERR))                          VNKCS004
085100         CONTINUE                                                 VNKCS004
085200     ELSE                                                         VNKCS004
085300         SET DP013-CICS-ABEND      TO TRUE                        VNKCS004
085400         SET DP013-NO-ROLLBACK     TO TRUE                        VNKCS004
085500                                                                  VNKCS004
085600         MOVE '2050-DELETE-LIST-QUEUE'                            VNKCS004
085700                                   TO DP013-PARAGRAPH             VNKCS004
085800         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    VNKCS004
085900                                   TO DP013-MESSAGE-TEXT (1)      VNKCS004
086000         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS004
086100     END-IF.                                                      VNKCS004
086200                                                                  VNKCS004
086300     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  VNKCS004
086400                                                                  VNKCS004
086500*----------------------------------------------------------------*VNKCS004
086600* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*VNKCS004
086700* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *VNKCS004
086800* CICS ARCHITECTURE API.                                         *VNKCS004
086900*----------------------------------------------------------------*VNKCS004
087000 2100-CHECK-FUNCTION-KEY.                                         VNKCS004
087100                                                                  VNKCS004
087200     EVALUATE TRUE                                                VNKCS004
087300         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  VNKCS004
087400             INITIALIZE VN002-INTER-APPL-COMMAREA                 VNKCS004
087500             MOVE ASC-NUMBER-OF-SELECTED-ITEMS                    VNKCS004
087600                            TO VN002-NUMBER-OF-SELECTED-ITEMS     VNKCS004
087700             MOVE ASC-KEY-ENT-ID                                  VNKCS004
087800                            TO VN002-ENT-ID                       VNKCS004
087900             PERFORM 5000-PREPARE-SEL-QUEUE                       VNKCS004
088000                                                                  VNKCS004
088100         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  VNKCS004
088200             MOVE +1               TO PV-TOP-ITEM                 VNKCS004
088300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 VNKCS004
088400             PERFORM 3200-RESET-ATTRIBUTES                        VNKCS004
088500                                                                  VNKCS004
088600         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   VNKCS004
088700             PERFORM 2110-BROWSE-BACKWARD                         VNKCS004
088800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 VNKCS004
088900             PERFORM 3200-RESET-ATTRIBUTES                        VNKCS004
089000                                                                  VNKCS004
089100         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   VNKCS004
089200             PERFORM 2120-BROWSE-FORWARD                          VNKCS004
089300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 VNKCS004
089400             PERFORM 3200-RESET-ATTRIBUTES                        VNKCS004
089500                                                                  VNKCS004
089600         WHEN DP020-SRC-AID = DP016-ENTER                         VNKCS004
089700             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   VNKCS004
089800             IF  PS-ERROR                                         VNKCS004
089900                 CONTINUE                                         VNKCS004
090000             ELSE                                                 VNKCS004
090100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             VNKCS004
090200             END-IF                                               VNKCS004
090300                                                                  VNKCS004
090400         WHEN OTHER                                               VNKCS004
090500             SET DP013-NO-ROLLBACK                                VNKCS004
090600                 DP013-XCTL-DISPLAY-RESTART                       VNKCS004
090700                 DP013-CICS-ABEND  TO TRUE                        VNKCS004
090800             MOVE '2100-CHECK-FUNCTION-KEY'                       VNKCS004
090900                                   TO DP013-PARAGRAPH             VNKCS004
091000             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      VNKCS004
091100                                   TO DP013-MESSAGE-TEXT (1)      VNKCS004
091200             PERFORM DP013-0000-PROCESS-ABEND                     VNKCS004
091300     END-EVALUATE.                                                VNKCS004
091400                                                                  VNKCS004
091500*----------------------------------------------------------------*VNKCS004
091600*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *VNKCS004
091700*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *VNKCS004
091800*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *VNKCS004
091900*    MESSAGE.                                                    *VNKCS004
092000*----------------------------------------------------------------*VNKCS004
092100 2110-BROWSE-BACKWARD.                                            VNKCS004
092200                                                                  VNKCS004
092300     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    VNKCS004
092400         GIVING PV-TOP-ITEM.                                      VNKCS004
092500                                                                  VNKCS004
092600     IF  ((PV-TOP-ITEM < +1)                                      VNKCS004
092700       OR (PV-TOP-ITEM = +1))                                     VNKCS004
092800         MOVE +1                   TO PV-TOP-ITEM                 VNKCS004
092900*        -- TOP OF LIST --                                        VNKCS004
093000         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            VNKCS004
093100         SET DP020-MSG-INFORMATIONAL TO TRUE                      VNKCS004
093200     END-IF.                                                      VNKCS004
093300                                                                  VNKCS004
093400*----------------------------------------------------------------*VNKCS004
093500*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *VNKCS004
093600*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *VNKCS004
093700*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *VNKCS004
093800*----------------------------------------------------------------*VNKCS004
093900 2120-BROWSE-FORWARD.                                             VNKCS004
094000                                                                  VNKCS004
094100     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              VNKCS004
094200         GIVING PV-TOP-ITEM.                                      VNKCS004
094300     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   VNKCS004
094400         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            VNKCS004
094500                                   TO PV-TOP-ITEM                 VNKCS004
094600*        -- BOTTOM OF LIST --                                     VNKCS004
094700         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            VNKCS004
094800         SET DP020-MSG-INFORMATIONAL                              VNKCS004
094900                                   TO TRUE                        VNKCS004
095000     ELSE                                                         VNKCS004
095100         COMPUTE PV-BOTTOM-ITEM =                                 VNKCS004
095200             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 VNKCS004
095300         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            VNKCS004
095400*            -- BOTTOM OF LIST --                                 VNKCS004
095500             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            VNKCS004
095600             SET DP020-MSG-INFORMATIONAL                          VNKCS004
095700                                   TO TRUE                        VNKCS004
095800         END-IF                                                   VNKCS004
095900     END-IF.                                                      VNKCS004
096000                                                                  VNKCS004
096100*----------------------------------------------------------------*VNKCS004
096200*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *VNKCS004
096300*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *VNKCS004
096400*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *VNKCS004
096500*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *VNKCS004
096600*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *VNKCS004
096700*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *VNKCS004
096800*----------------------------------------------------------------*VNKCS004
096900 2130-CHECK-FOR-JUMP-BROWSE.                                      VNKCS004
097000                                                                  VNKCS004
097100     SET PS-NO-ERROR               TO TRUE.                       VNKCS004
097200     IF (ASC-START-ITEM-REQUEST = SPACE)                          VNKCS004
097300         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            VNKCS004
097400                                   TO PV-TOP-ITEM                 VNKCS004
097500     ELSE                                                         VNKCS004
097600         MOVE ASC-START-ITEM-REQUEST                              VNKCS004
097700                                   TO DP010I-UNEDITED-FIELD       VNKCS004
097800         MOVE PC-ITM-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       VNKCS004
097900         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     VNKCS004
098000         SET DP010I-NEGATIVE-NOT-ALLOWED                          VNKCS004
098100                                   TO TRUE                        VNKCS004
098210         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
098220                         USING DP010I-NUMERIC-EDIT-AREA                   
098300                                                                  VNKCS004
098400         IF  NOT DP010I-ERROR-DETECTED                            VNKCS004
098500             MOVE DP010I-NUMERIC-FIELD                            VNKCS004
098600                                   TO  ASC-START-ITEM-REQUEST-N   VNKCS004
098700             IF  ASC-START-ITEM-REQUEST-N > ZERO                  VNKCS004
098800                 IF  ASC-START-ITEM-REQUEST-N >                   VNKCS004
098900                                          ASC-NUMBER-OF-ITEMS-READVNKCS004
099000                     MOVE SPACE TO ASC-START-ITEM-REQUEST         VNKCS004
099100                     COMPUTE PV-TOP-ITEM =                        VNKCS004
099200                             ASC-NUMBER-OF-ITEMS-READ             VNKCS004
099300                             - PC-ITEMS-PER-PANEL + 1             VNKCS004
099400                     IF  PV-TOP-ITEM < +1                         VNKCS004
099500                         MOVE +1   TO PV-TOP-ITEM                 VNKCS004
099600                         MOVE PC-TSYMSG-00070                     VNKCS004
099700                                   TO DP020-MSG-NUMBER            VNKCS004
099800                         SET DP020-MSG-INFORMATIONAL              VNKCS004
099900                                   TO TRUE                        VNKCS004
100000                     END-IF                                       VNKCS004
100100                 ELSE                                             VNKCS004
100200                     MOVE ASC-START-ITEM-REQUEST-N                VNKCS004
100300                                   TO PV-TOP-ITEM                 VNKCS004
100400                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      VNKCS004
100500                     COMPUTE PV-BOTTOM-ITEM =                     VNKCS004
100600                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     VNKCS004
100700                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READVNKCS004
100800*                        -- BOTTOM OF LIST --                     VNKCS004
100900                         MOVE PC-TSYMSG-00070                     VNKCS004
101000                                   TO DP020-MSG-NUMBER            VNKCS004
101100                         SET DP020-MSG-INFORMATIONAL              VNKCS004
101200                                   TO TRUE                        VNKCS004
101300                     END-IF                                       VNKCS004
101400                 END-IF                                           VNKCS004
101500             ELSE                                                 VNKCS004
101600*                --- VALUE OUT OF RANGE ----                      VNKCS004
101700                 MOVE PC-TSYMSG-00101                             VNKCS004
101800                                   TO DP020-MSG-NUMBER            VNKCS004
101900                 MOVE -1           TO ASTRTITL                    VNKCS004
102000                 SET DP030-SET-CURSOR-APPL-1                      VNKCS004
102100                                   TO TRUE                        VNKCS004
102200                 MOVE DP015-REVERSE                               VNKCS004
102300                                   TO ASTRTITH                    VNKCS004
102400                 MOVE DP015-RED    TO ASTRTITC                    VNKCS004
102500                 MOVE DP015-UNP-NUM-BRT-MDT                       VNKCS004
102600                                   TO ASTRTITA                    VNKCS004
102700                 SET DP020-MSG-FATAL                              VNKCS004
102800                                   TO TRUE                        VNKCS004
102900                 SET PS-ERROR      TO TRUE                        VNKCS004
103000             END-IF                                               VNKCS004
103100                                                                  VNKCS004
103200         ELSE                                                     VNKCS004
103300             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            VNKCS004
103400             MOVE -1               TO ASTRTITL                    VNKCS004
103500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  VNKCS004
103600             MOVE DP015-REVERSE    TO ASTRTITH                    VNKCS004
103700             MOVE DP015-RED        TO ASTRTITC                    VNKCS004
103800             MOVE DP015-UNP-NUM-BRT-MDT                           VNKCS004
103900                                   TO ASTRTITA                    VNKCS004
104000             SET DP020-MSG-FATAL   TO TRUE                        VNKCS004
104100             SET PS-ERROR          TO TRUE                        VNKCS004
104200         END-IF                                                   VNKCS004
104300     END-IF.                                                      VNKCS004
104400                                                                  VNKCS004
104500*----------------------------------------------------------------*VNKCS004
104600*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *VNKCS004
104700*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *VNKCS004
104800*----------------------------------------------------------------*VNKCS004
104900 2140-DESELECT-ALL-ITEMS.                                         VNKCS004
105000                                                                  VNKCS004
105100     MOVE +1                       TO ASC-BLK-SUB.                VNKCS004
105200                                                                  VNKCS004
105300     PERFORM 2141-CLEAR-SELECTED-INDS                             VNKCS004
105400         VARYING ASC-ITEM-SUB                                     VNKCS004
105500         FROM 1 BY 1                                              VNKCS004
105600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 VNKCS004
105700                                                                  VNKCS004
105800     ADD +1                        TO ASC-BLK-SUB.                VNKCS004
105900                                                                  VNKCS004
106000     PERFORM 2141-CLEAR-SELECTED-INDS                             VNKCS004
106100         VARYING ASC-ITEM-SUB                                     VNKCS004
106200         FROM 1 BY 1                                              VNKCS004
106300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 VNKCS004
106400                                                                  VNKCS004
106500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               VNKCS004
106600                                   TO PV-LIST-ITEM-NUMBER.        VNKCS004
106700                                                                  VNKCS004
106800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            VNKCS004
106900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    VNKCS004
107000                                                                  VNKCS004
107100     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     VNKCS004
107200        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      VNKCS004
107300         MOVE +1                   TO ASC-BLK-SUB                 VNKCS004
107400                                                                  VNKCS004
107500         PERFORM 5100-WRITE-TEMP-STORAGE                          VNKCS004
107600                                                                  VNKCS004
107700         MOVE +1                   TO PV-BLOCK-NUMBER             VNKCS004
107800                                                                  VNKCS004
107900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         VNKCS004
108000             PV-FIRST-BLOCK-IN-ARRAY - 1                          VNKCS004
108100                                                                  VNKCS004
108200         PERFORM                                                  VNKCS004
108300             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       VNKCS004
108400                                                                  VNKCS004
108500             PERFORM 4410-READ-TEMP-STORAGE                       VNKCS004
108600                                                                  VNKCS004
108700             PERFORM 2141-CLEAR-SELECTED-INDS                     VNKCS004
108800                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 VNKCS004
108900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          VNKCS004
109000                                                                  VNKCS004
109100             PERFORM 5100-WRITE-TEMP-STORAGE                      VNKCS004
109200                                                                  VNKCS004
109300             ADD +1                TO PV-BLOCK-NUMBER             VNKCS004
109400                                                                  VNKCS004
109500         END-PERFORM                                              VNKCS004
109600                                                                  VNKCS004
109700         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         VNKCS004
109800             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     VNKCS004
109900                                                                  VNKCS004
110000         PERFORM                                                  VNKCS004
110100             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       VNKCS004
110200                   ASC-HIGHEST-BLOCK-WRITTEN                      VNKCS004
110300                                                                  VNKCS004
110400             MOVE PV-NEXT-BLOCK-IN-ARRAY                          VNKCS004
110500                                   TO PV-BLOCK-NUMBER             VNKCS004
110600                                                                  VNKCS004
110700             PERFORM 4410-READ-TEMP-STORAGE                       VNKCS004
110800                                                                  VNKCS004
110900             PERFORM 2141-CLEAR-SELECTED-INDS                     VNKCS004
111000                 VARYING ASC-ITEM-SUB                             VNKCS004
111100                 FROM 1 BY 1                                      VNKCS004
111200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          VNKCS004
111300                                                                  VNKCS004
111400             PERFORM 5100-WRITE-TEMP-STORAGE                      VNKCS004
111500                                                                  VNKCS004
111600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      VNKCS004
111700                                                                  VNKCS004
111800         END-PERFORM                                              VNKCS004
111900                                                                  VNKCS004
112000         MOVE PV-FIRST-BLOCK-IN-ARRAY                             VNKCS004
112100                                   TO PV-BLOCK-NUMBER             VNKCS004
112200                                                                  VNKCS004
112300         PERFORM 4410-READ-TEMP-STORAGE                           VNKCS004
112400     END-IF.                                                      VNKCS004
112500                                                                  VNKCS004
112600     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMSVNKCS004
112700     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.VNKCS004
112800     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  VNKCS004
112900                                                                  VNKCS004
113000     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        VNKCS004
113100                                                                  VNKCS004
113200*----------------------------------------------------------------*VNKCS004
113300*    MARK EACH ITEM AS BEING NOT SELECTED.                       *VNKCS004
113400*----------------------------------------------------------------*VNKCS004
113500 2141-CLEAR-SELECTED-INDS.                                        VNKCS004
113600                                                                  VNKCS004
113700     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           VNKCS004
113800             NOT EQUAL ZERO                                       VNKCS004
113900         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          VNKCS004
114000             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          VNKCS004
114100                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    VNKCS004
114200                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  VNKCS004
114300                                   TO TRUE                        VNKCS004
114400         END-IF                                                   VNKCS004
114500     END-IF.                                                      VNKCS004
114600                                                                  VNKCS004
114700*----------------------------------------------------------------*VNKCS004
114800*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *VNKCS004
114900*  FOR ALL ITEMS.                                                *VNKCS004
115000*----------------------------------------------------------------*VNKCS004
115100 2150-SELECT-ALL-ITEMS.                                           VNKCS004
115200                                                                  VNKCS004
115300     MOVE +1                       TO ASC-BLK-SUB.                VNKCS004
115400                                                                  VNKCS004
115500     PERFORM 2151-SET-SELECTED-INDS                               VNKCS004
115600         VARYING ASC-ITEM-SUB                                     VNKCS004
115700         FROM 1 BY 1                                              VNKCS004
115800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 VNKCS004
115900                                                                  VNKCS004
116000     ADD +1                        TO ASC-BLK-SUB.                VNKCS004
116100                                                                  VNKCS004
116200     PERFORM 2151-SET-SELECTED-INDS                               VNKCS004
116300         VARYING ASC-ITEM-SUB                                     VNKCS004
116400         FROM 1 BY 1                                              VNKCS004
116500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 VNKCS004
116600                                                                  VNKCS004
116700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               VNKCS004
116800                                   TO PV-LIST-ITEM-NUMBER.        VNKCS004
116900                                                                  VNKCS004
117000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            VNKCS004
117100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    VNKCS004
117200                                                                  VNKCS004
117300     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     VNKCS004
117400        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    VNKCS004
117500         MOVE +1                   TO ASC-BLK-SUB                 VNKCS004
117600                                                                  VNKCS004
117700         PERFORM 5100-WRITE-TEMP-STORAGE                          VNKCS004
117800                                                                  VNKCS004
117900         MOVE +1                   TO PV-BLOCK-NUMBER             VNKCS004
118000                                                                  VNKCS004
118100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         VNKCS004
118200             PV-FIRST-BLOCK-IN-ARRAY - 1                          VNKCS004
118300                                                                  VNKCS004
118400         PERFORM                                                  VNKCS004
118500             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       VNKCS004
118600                                                                  VNKCS004
118700             PERFORM 4410-READ-TEMP-STORAGE                       VNKCS004
118800                                                                  VNKCS004
118900             PERFORM 2151-SET-SELECTED-INDS                       VNKCS004
119000                 VARYING ASC-ITEM-SUB                             VNKCS004
119100                 FROM 1 BY 1                                      VNKCS004
119200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          VNKCS004
119300                                                                  VNKCS004
119400             PERFORM 5100-WRITE-TEMP-STORAGE                      VNKCS004
119500                                                                  VNKCS004
119600             ADD +1                TO PV-BLOCK-NUMBER             VNKCS004
119700                                                                  VNKCS004
119800         END-PERFORM                                              VNKCS004
119900                                                                  VNKCS004
120000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         VNKCS004
120100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     VNKCS004
120200                                                                  VNKCS004
120300         PERFORM                                                  VNKCS004
120400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       VNKCS004
120500                   ASC-HIGHEST-BLOCK-WRITTEN                      VNKCS004
120600                                                                  VNKCS004
120700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          VNKCS004
120800                                   TO PV-BLOCK-NUMBER             VNKCS004
120900                                                                  VNKCS004
121000             PERFORM 4410-READ-TEMP-STORAGE                       VNKCS004
121100                                                                  VNKCS004
121200             PERFORM 2151-SET-SELECTED-INDS                       VNKCS004
121300                 VARYING ASC-ITEM-SUB                             VNKCS004
121400                 FROM 1 BY 1                                      VNKCS004
121500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          VNKCS004
121600                                                                  VNKCS004
121700             PERFORM 5100-WRITE-TEMP-STORAGE                      VNKCS004
121800                                                                  VNKCS004
121900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      VNKCS004
122000                                                                  VNKCS004
122100         END-PERFORM                                              VNKCS004
122200                                                                  VNKCS004
122300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             VNKCS004
122400                                   TO PV-BLOCK-NUMBER             VNKCS004
122500                                                                  VNKCS004
122600         PERFORM 4410-READ-TEMP-STORAGE                           VNKCS004
122700     END-IF.                                                      VNKCS004
122800                                                                  VNKCS004
122900                                                                  VNKCS004
123000     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             VNKCS004
123100                       ASC-NUMBER-OF-SELECTED-ITEMS.              VNKCS004
123200                                                                  VNKCS004
123300     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        VNKCS004
123400                                                                  VNKCS004
123500*----------------------------------------------------------------*VNKCS004
123600*    MARK EACH ITEM AS BEING SELECTED.                           *VNKCS004
123700*----------------------------------------------------------------*VNKCS004
123800 2151-SET-SELECTED-INDS.                                          VNKCS004
123900                                                                  VNKCS004
124000     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           VNKCS004
124100             NOT EQUAL ZERO                                       VNKCS004
124200         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             VNKCS004
124300             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             VNKCS004
124400                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        VNKCS004
124500                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  VNKCS004
124600                               TO  TRUE                           VNKCS004
124700         END-IF                                                   VNKCS004
124800     END-IF.                                                      VNKCS004
124900                                                                  VNKCS004
125000******************************************************************VNKCS004
125100** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **VNKCS004
125200** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **VNKCS004
125300******************************************************************VNKCS004
125400 2200-MOVE-SCREEN-TO-COMMAREA.                                    VNKCS004
125500                                                                  VNKCS004
125600     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             VNKCS004
125700     MOVE +1                       TO PV-SUB.                     VNKCS004
125800                                                                  VNKCS004
125900     PERFORM 3100-SET-SUBSCRIPTS.                                 VNKCS004
126000     IF  ASTRTITL > ZERO                                          VNKCS004
126100         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          VNKCS004
126200     ELSE                                                         VNKCS004
126300         IF  ASTRTITF = DP015-ERASE-EOF                           VNKCS004
126400             INITIALIZE ASC-START-ITEM-REQUEST                    VNKCS004
126500         END-IF                                                   VNKCS004
126600     END-IF.                                                      VNKCS004
126700     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          VNKCS004
126800         VARYING PV-SUB                                           VNKCS004
126900         FROM 1 BY 1                                              VNKCS004
127000         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      VNKCS004
127100                                                                  VNKCS004
127200******************************************************************VNKCS004
127300** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**VNKCS004
127400******************************************************************VNKCS004
127500 2210-MOVE-LINES-TO-COMMAREA.                                     VNKCS004
127600                                                                  VNKCS004
127700     IF  MR-SELECTL (PV-SUB) > ZERO                               VNKCS004
127800         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             VNKCS004
127900         MOVE MR-SELECTI (PV-SUB)                                 VNKCS004
128000                                   TO ASC-TEMP-SELECTED-SW        VNKCS004
128100                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      VNKCS004
128200     ELSE                                                         VNKCS004
128300         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                VNKCS004
128400                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     VNKCS004
128500                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        VNKCS004
128600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      VNKCS004
128700         END-IF                                                   VNKCS004
128800     END-IF.                                                      VNKCS004
128900     ADD +1                        TO ASC-ITEM-SUB.               VNKCS004
129000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        VNKCS004
129100         ADD +1                    TO ASC-BLK-SUB                 VNKCS004
129200         MOVE +1                   TO ASC-ITEM-SUB                VNKCS004
129300     END-IF.                                                      VNKCS004
129400                                                                  VNKCS004
129500******************************************************************VNKCS004
129600* GET THE KEYS OF THE NEXT SELECTED OBJECT FROM THE              *VNKCS004
129700* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *VNKCS004
129800******************************************************************VNKCS004
129900 2300-GET-NEXT-MESSAGE.                                           VNKCS004
130000                                                                  VNKCS004
130100     ADD +1                        TO ASC-SEL-SUB.                VNKCS004
130200     IF ASC-SEL-SUB > VN003-MAX-ITEMS                             VNKCS004
130300         ADD +1                    TO ASC-SEL-ITEM                VNKCS004
130400         MOVE +1                   TO ASC-SEL-SUB                 VNKCS004
130500     END-IF.                                                      VNKCS004
130600     IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                 VNKCS004
130700         PERFORM 9100-READ-SEL-QUEUE                              VNKCS004
130800         IF VN003-ITEM (ASC-SEL-SUB) > ZERO                       VNKCS004
130900             MOVE VN003-ENT-ID (ASC-SEL-SUB)                      VNKCS004
131000                                   TO ASC-KEY-ENT-ID              VNKCS004
131100             SET VN003-INQ (ASC-SEL-SUB)                          VNKCS004
131200                                   TO TRUE                        VNKCS004
131300             PERFORM 9200-REWRITE-LIST-QUEUE                      VNKCS004
131400         ELSE                                                     VNKCS004
131500             SUBTRACT +1 FROM ASC-SEL-SUB                         VNKCS004
131600*            --- BOTTOM OF LIST ---                               VNKCS004
131700             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            VNKCS004
131800             SET DP020-MSG-INFORMATIONAL                          VNKCS004
131900                                   TO TRUE                        VNKCS004
132000         END-IF                                                   VNKCS004
132100     ELSE                                                         VNKCS004
132200         SUBTRACT +1 FROM ASC-SEL-ITEM                            VNKCS004
132300         MOVE VN003-MAX-ITEMS      TO ASC-SEL-SUB                 VNKCS004
132400         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            VNKCS004
132500         SET DP020-MSG-INFORMATIONAL                              VNKCS004
132600                                   TO TRUE                        VNKCS004
132700     END-IF.                                                      VNKCS004
132800                                                                  VNKCS004
132900******************************************************************VNKCS004
133000* GET THE KEYS OF THE PREVIOUS SELECTED OBJECT FROM THE          *VNKCS004
133100* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *VNKCS004
133200******************************************************************VNKCS004
133300 2310-GET-PREV-MESSAGE.                                           VNKCS004
133400                                                                  VNKCS004
133500     SUBTRACT +1 FROM ASC-SEL-SUB.                                VNKCS004
133600     IF ASC-SEL-SUB < +1                                          VNKCS004
133700         SUBTRACT +1 FROM ASC-SEL-ITEM                            VNKCS004
133800         MOVE VN003-MAX-ITEMS      TO ASC-SEL-SUB                 VNKCS004
133900     END-IF.                                                      VNKCS004
134000                                                                  VNKCS004
134100     IF ASC-SEL-ITEM > ZERO                                       VNKCS004
134200         PERFORM 9100-READ-SEL-QUEUE                              VNKCS004
134300         MOVE VN003-ENT-ID (ASC-SEL-SUB)                          VNKCS004
134400                                   TO ASC-KEY-ENT-ID              VNKCS004
134500     ELSE                                                         VNKCS004
134600         MOVE +1                   TO ASC-SEL-ITEM                VNKCS004
134700                                      ASC-SEL-SUB                 VNKCS004
134800*        --- TOP OF LIST ---                                      VNKCS004
134900         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            VNKCS004
135000         SET DP020-MSG-INFORMATIONAL                              VNKCS004
135100                                   TO TRUE                        VNKCS004
135200     END-IF.                                                      VNKCS004
135300                                                                  VNKCS004
135400******************************************************************VNKCS004
135500** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **VNKCS004
135600** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **VNKCS004
135700******************************************************************VNKCS004
135800 3000-EDIT-DATA-IN-COMMAREA.                                      VNKCS004
135900                                                                  VNKCS004
136000     SET PS-NO-ERROR               TO TRUE.                       VNKCS004
136100     PERFORM 3200-RESET-ATTRIBUTES.                               VNKCS004
136200     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     VNKCS004
136300**                                                                VNKCS004
136400* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              VNKCS004
136500* EDITTING IS DONE FROM THE BOTTOM UP.                            VNKCS004
136600**                                                                VNKCS004
136700     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       VNKCS004
136800         ASC-ITEMS-DISPLAYED - 1.                                 VNKCS004
136900     PERFORM 3100-SET-SUBSCRIPTS.                                 VNKCS004
137000     PERFORM 3300-EDIT-SELECTIONS                                 VNKCS004
137100         VARYING PV-SUB                                           VNKCS004
137200         FROM PV-SUB BY -1                                        VNKCS004
137300         UNTIL PV-SUB < +1                                        VNKCS004
137400                                                                  VNKCS004
137500     IF  PS-NO-ERROR                                              VNKCS004
137600         PERFORM 3400-CHECK-RANGE-SEQUENCE                        VNKCS004
137700     END-IF.                                                      VNKCS004
137800                                                                  VNKCS004
137900     IF  ((PS-NO-ERROR)                                           VNKCS004
138000       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   VNKCS004
138100       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    VNKCS004
138200             PERFORM 3500-MARK-RANGE-AS-SELECTED                  VNKCS004
138300     END-IF.                                                      VNKCS004
138400                                                                  VNKCS004
138500*----------------------------------------------------------------*VNKCS004
138600*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *VNKCS004
138700*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*VNKCS004
138800*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *VNKCS004
138900*                                                                *VNKCS004
139000*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *VNKCS004
139100*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *VNKCS004
139200*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *VNKCS004
139300*    US IN THE 2ND BLOCK OF THE ARRAY.                           *VNKCS004
139400*----------------------------------------------------------------*VNKCS004
139500 3100-SET-SUBSCRIPTS.                                             VNKCS004
139600                                                                  VNKCS004
139700     COMPUTE ASC-ITEM-SUB =                                       VNKCS004
139800         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        VNKCS004
139900                                                                  VNKCS004
140000     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         VNKCS004
140100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            VNKCS004
140200                                                                  VNKCS004
140300         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               VNKCS004
140400     ELSE                                                         VNKCS004
140500         MOVE +1                     TO ASC-BLK-SUB               VNKCS004
140600     END-IF.                                                      VNKCS004
140700                                                                  VNKCS004
140800******************************************************************VNKCS004
140900** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **VNKCS004
141000******************************************************************VNKCS004
141100 3200-RESET-ATTRIBUTES.                                           VNKCS004
141200                                                                  VNKCS004
141300     MOVE DP015-UNP-NUM-NOR-OFF TO ASTRTITA.                      VNKCS004
141400     MOVE DP015-GREEN           TO ASTRTITC.                      VNKCS004
141500     MOVE DP015-UNDERLINE       TO ASTRTITH.                      VNKCS004
141600                                                                  VNKCS004
141700     IF DP020-NEXT-ACT-RETURN OR                                  VNKCS004
141800        DP020-NEXT-ACT-READ-MAP                                   VNKCS004
141900         PERFORM VARYING PV-SUB  FROM 1 BY 1                      VNKCS004
142000                 UNTIL   PV-SUB > ASC-ITEMS-DISPLAYED             VNKCS004
142100                  MOVE DP015-UNP-ALP-NOR-OFF                      VNKCS004
142200                                       TO MR-SELECTA (PV-SUB)     VNKCS004
142300                  MOVE DP015-GREEN     TO MR-SELECTC (PV-SUB)     VNKCS004
142400                  MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)     VNKCS004
142500         END-PERFORM                                              VNKCS004
142600     ELSE                                                         VNKCS004
142700         PERFORM VARYING PV-SUB  FROM 1 BY 1                      VNKCS004
142800                 UNTIL   PV-SUB > PC-ITEMS-PER-PANEL              VNKCS004
142900                  MOVE DP015-UNP-ALP-NOR-OFF                      VNKCS004
143000                                       TO MR-SELECTA (PV-SUB)     VNKCS004
143100                  MOVE DP015-GREEN     TO MR-SELECTC (PV-SUB)     VNKCS004
143200                  MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)     VNKCS004
143300         END-PERFORM.                                             VNKCS004
143400                                                                  VNKCS004
143500******************************************************************VNKCS004
143600** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **VNKCS004
143700** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **VNKCS004
143800** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **VNKCS004
143900** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **VNKCS004
144000******************************************************************VNKCS004
144100 3300-EDIT-SELECTIONS.                                            VNKCS004
144200                                                                  VNKCS004
144300     EVALUATE TRUE                                                VNKCS004
144400         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     VNKCS004
144500             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         VNKCS004
144600                 CONTINUE                                         VNKCS004
144700         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         VNKCS004
144800             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        VNKCS004
144900                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   VNKCS004
145000                 MOVE ASC-TEMP-SELECTED-SW                        VNKCS004
145100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  VNKCS004
145200                                TO ASC-SELECTED-SW                VNKCS004
145300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  VNKCS004
145400             END-IF                                               VNKCS004
145500         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     VNKCS004
145600                 = SPACE                                          VNKCS004
145700             EVALUATE TRUE                                        VNKCS004
145800                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       VNKCS004
145900                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMSVNKCS004
146000                     MOVE SPACE TO ASC-SELECTED-SW                VNKCS004
146100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  VNKCS004
146200                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        VNKCS004
146300                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    VNKCS004
146400                     MOVE SPACE TO ASC-SELECTED-SW                VNKCS004
146500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  VNKCS004
146600                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          VNKCS004
146700                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      VNKCS004
146800                     MOVE SPACE TO ASC-SELECTED-SW                VNKCS004
146900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  VNKCS004
147000             END-EVALUATE                                         VNKCS004
147100         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           VNKCS004
147200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            VNKCS004
147300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    VNKCS004
147400             END-IF                                               VNKCS004
147500             PERFORM 3310-EDIT-RANGE                              VNKCS004
147600         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             VNKCS004
147700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            VNKCS004
147800                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    VNKCS004
147900             END-IF                                               VNKCS004
148000             PERFORM 3310-EDIT-RANGE                              VNKCS004
148100         WHEN OTHER                                               VNKCS004
148200             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           VNKCS004
148300             SET DP020-MSG-FATAL    TO TRUE                       VNKCS004
148400             MOVE -1                TO MR-SELECTL (PV-SUB)        VNKCS004
148500             SET DP030-SET-CURSOR-APPL-1                          VNKCS004
148600                                    TO TRUE                       VNKCS004
148700             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        VNKCS004
148800             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        VNKCS004
148900             SET PS-ERROR TO TRUE                                 VNKCS004
149000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            VNKCS004
149100                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     VNKCS004
149200                 MOVE SPACE         TO ASC-SELECTED-SW            VNKCS004
149300                                        (ASC-BLK-SUB ASC-ITEM-SUB)VNKCS004
149400             END-IF                                               VNKCS004
149500     END-EVALUATE.                                                VNKCS004
149600                                                                  VNKCS004
149700     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 VNKCS004
149800     SUBTRACT +1 FROM ASC-ITEM-SUB.                               VNKCS004
149900     IF  ASC-ITEM-SUB < 1                                         VNKCS004
150000         SUBTRACT +1 FROM ASC-BLK-SUB                             VNKCS004
150100         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                VNKCS004
150200     END-IF.                                                      VNKCS004
150300                                                                  VNKCS004
150400******************************************************************VNKCS004
150500** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **VNKCS004
150600** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **VNKCS004
150700** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**VNKCS004
150800** THE ENDING.                                                  **VNKCS004
150900******************************************************************VNKCS004
151000 3310-EDIT-RANGE.                                                 VNKCS004
151100                                                                  VNKCS004
151200     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                VNKCS004
151300         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   VNKCS004
151400             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)VNKCS004
151500                                   TO ASC-SELECTED-SW             VNKCS004
151600                                        (ASC-BLK-SUB ASC-ITEM-SUB)VNKCS004
151700             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE VNKCS004
151800         ELSE                                                     VNKCS004
151900             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     VNKCS004
152000                 CONTINUE                                         VNKCS004
152100             ELSE                                                 VNKCS004
152200*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        VNKCS004
152300                 MOVE PC-TSYMSG-00054                             VNKCS004
152400                                   TO DP020-MSG-NUMBER            VNKCS004
152500                 SET DP020-MSG-FATAL                              VNKCS004
152600                                   TO TRUE                        VNKCS004
152700                 MOVE -1           TO MR-SELECTL (PV-SUB)         VNKCS004
152800                 SET DP030-SET-CURSOR-APPL-1                      VNKCS004
152900                                   TO TRUE                        VNKCS004
153000                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         VNKCS004
153100                 MOVE DP015-UNDERLINE                             VNKCS004
153200                                   TO MR-SELECTH (PV-SUB)         VNKCS004
153300                 SET PS-ERROR      TO TRUE                        VNKCS004
153400             END-IF                                               VNKCS004
153500         END-IF                                                   VNKCS004
153600     ELSE                                                         VNKCS004
153700         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     VNKCS004
153800             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) VNKCS004
153900                                   TO ASC-SELECTED-SW             VNKCS004
154000                                     (ASC-BLK-SUB ASC-ITEM-SUB)   VNKCS004
154100             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   VNKCS004
154200         ELSE                                                     VNKCS004
154300             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       VNKCS004
154400                 CONTINUE                                         VNKCS004
154500             ELSE                                                 VNKCS004
154600*                -- ONLY ONE END-OF-RANGE ALLOWED --              VNKCS004
154700                 MOVE PC-TSYMSG-00055                             VNKCS004
154800                                   TO DP020-MSG-NUMBER            VNKCS004
154900                 SET DP020-MSG-FATAL                              VNKCS004
155000                                   TO TRUE                        VNKCS004
155100                 MOVE -1           TO MR-SELECTL (PV-SUB)         VNKCS004
155200                 SET DP030-SET-CURSOR-APPL-1                      VNKCS004
155300                                   TO TRUE                        VNKCS004
155400                 SET PS-ERROR      TO TRUE                        VNKCS004
155500             END-IF                                               VNKCS004
155600         END-IF                                                   VNKCS004
155700     END-IF.                                                      VNKCS004
155800                                                                  VNKCS004
155900******************************************************************VNKCS004
156000** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **VNKCS004
156100** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **VNKCS004
156200******************************************************************VNKCS004
156300 3400-CHECK-RANGE-SEQUENCE.                                       VNKCS004
156400                                                                  VNKCS004
156500     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       VNKCS004
156600       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      VNKCS004
156700       AND  ASC-START-OF-SELECTED-RANGE >                         VNKCS004
156800                                         ASC-END-OF-SELECTED-RANGEVNKCS004
156900*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                VNKCS004
157000         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 VNKCS004
157100         SET DP020-MSG-FATAL TO TRUE                              VNKCS004
157200         SET PS-ERROR TO TRUE                                     VNKCS004
157300         PERFORM 3410-POSITION-AT-ERROR                           VNKCS004
157400     END-IF.                                                      VNKCS004
157500                                                                  VNKCS004
157600******************************************************************VNKCS004
157700** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **VNKCS004
157800** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **VNKCS004
157900** SHOULD BE POSITIONED ON A RANGE ERROR.                       **VNKCS004
158000******************************************************************VNKCS004
158100 3410-POSITION-AT-ERROR.                                          VNKCS004
158200                                                                  VNKCS004
158300     SET DP030-SET-CURSOR-APPL-1                                  VNKCS004
158400                                   TO TRUE.                       VNKCS004
158500     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 VNKCS004
158600                    - PV-TOP-ITEM + 1.                            VNKCS004
158700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      VNKCS004
158800         CONTINUE                                                 VNKCS004
158900     ELSE                                                         VNKCS004
159000         MOVE -1                   TO MR-SELECTL (PV-SUB)         VNKCS004
159100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         VNKCS004
159200         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         VNKCS004
159300     END-IF.                                                      VNKCS004
159400                                                                  VNKCS004
159500     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   VNKCS004
159600                    - PV-TOP-ITEM + 1.                            VNKCS004
159700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      VNKCS004
159800         CONTINUE                                                 VNKCS004
159900     ELSE                                                         VNKCS004
160000         MOVE -1                   TO MR-SELECTL (PV-SUB)         VNKCS004
160100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         VNKCS004
160200         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         VNKCS004
160300     END-IF.                                                      VNKCS004
160400                                                                  VNKCS004
160500*----------------------------------------------------------------*VNKCS004
160600*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *VNKCS004
160700*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *VNKCS004
160800*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *VNKCS004
160900*----------------------------------------------------------------*VNKCS004
161000 3500-MARK-RANGE-AS-SELECTED.                                     VNKCS004
161100                                                                  VNKCS004
161200     MOVE +1                       TO  ASC-BLK-SUB.               VNKCS004
161300     PERFORM 3510-MARK-SELECTED-INDS                              VNKCS004
161400         VARYING ASC-ITEM-SUB                                     VNKCS004
161500         FROM 1 BY 1                                              VNKCS004
161600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 VNKCS004
161700                                                                  VNKCS004
161800     ADD +1                        TO ASC-BLK-SUB.                VNKCS004
161900     PERFORM 3510-MARK-SELECTED-INDS                              VNKCS004
162000         VARYING ASC-ITEM-SUB                                     VNKCS004
162100         FROM 1 BY 1                                              VNKCS004
162200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 VNKCS004
162300                                                                  VNKCS004
162400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               VNKCS004
162500                                   TO  PV-LIST-ITEM-NUMBER.       VNKCS004
162600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            VNKCS004
162700         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         VNKCS004
162800               PC-ITEMS-PER-PANEL).                               VNKCS004
162900                                                                  VNKCS004
163000     MOVE ASC-START-OF-SELECTED-RANGE                             VNKCS004
163100                                   TO PV-START-OF-SELECTED-RANGE. VNKCS004
163200     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            VNKCS004
163300         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  VNKCS004
163400               PC-ITEMS-PER-PANEL).                               VNKCS004
163500                                                                  VNKCS004
163600     MOVE ASC-END-OF-SELECTED-RANGE                               VNKCS004
163700                                   TO  PV-END-OF-SELECTED-RANGE.  VNKCS004
163800     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             VNKCS004
163900         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    VNKCS004
164000               PC-ITEMS-PER-PANEL).                               VNKCS004
164100     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             VNKCS004
164200         PV-FIRST-BLOCK-IN-ARRAY + 1.                             VNKCS004
164300                                                                  VNKCS004
164400     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    VNKCS004
164500        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        VNKCS004
164600         MOVE +1                   TO ASC-BLK-SUB                 VNKCS004
164700         PERFORM 5100-WRITE-TEMP-STORAGE                          VNKCS004
164800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         VNKCS004
164900             PV-FIRST-BLOCK-IN-ARRAY - 1                          VNKCS004
165000                                                                  VNKCS004
165100         PERFORM                                                  VNKCS004
165200             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      VNKCS004
165300                   PV-PREV-BLOCK-IN-ARRAY                         VNKCS004
165400             MOVE PV-FIRST-BLOCK-IN-RANGE                         VNKCS004
165500                                   TO PV-BLOCK-NUMBER             VNKCS004
165600             PERFORM 4410-READ-TEMP-STORAGE                       VNKCS004
165700             PERFORM 3510-MARK-SELECTED-INDS                      VNKCS004
165800                 VARYING ASC-ITEM-SUB                             VNKCS004
165900                 FROM 1 BY 1                                      VNKCS004
166000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          VNKCS004
166100             PERFORM 5100-WRITE-TEMP-STORAGE                      VNKCS004
166200             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     VNKCS004
166300         END-PERFORM                                              VNKCS004
166400                                                                  VNKCS004
166500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         VNKCS004
166600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     VNKCS004
166700         PERFORM                                                  VNKCS004
166800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       VNKCS004
166900                   PV-LAST-BLOCK-IN-RANGE                         VNKCS004
167000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          VNKCS004
167100                                   TO PV-BLOCK-NUMBER             VNKCS004
167200             PERFORM 4410-READ-TEMP-STORAGE                       VNKCS004
167300             PERFORM 3510-MARK-SELECTED-INDS                      VNKCS004
167400                 VARYING ASC-ITEM-SUB                             VNKCS004
167500                 FROM 1 BY 1                                      VNKCS004
167600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          VNKCS004
167700             PERFORM 5100-WRITE-TEMP-STORAGE                      VNKCS004
167800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      VNKCS004
167900         END-PERFORM                                              VNKCS004
168000                                                                  VNKCS004
168100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             VNKCS004
168200                                   TO PV-BLOCK-NUMBER             VNKCS004
168300         PERFORM 4410-READ-TEMP-STORAGE                           VNKCS004
168400     END-IF.                                                      VNKCS004
168500                                                                  VNKCS004
168600     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE VNKCS004
168700                                      ASC-END-OF-SELECTED-RANGE.  VNKCS004
168800                                                                  VNKCS004
168900*----------------------------------------------------------------*VNKCS004
169000* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *VNKCS004
169100*----------------------------------------------------------------*VNKCS004
169200 3510-MARK-SELECTED-INDS.                                         VNKCS004
169300                                                                  VNKCS004
169400     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         VNKCS004
169500                                ASC-ITEM-SUB) >                   VNKCS004
169600         ASC-START-OF-SELECTED-RANGE)                             VNKCS004
169700     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         VNKCS004
169800                                ASC-ITEM-SUB) =                   VNKCS004
169900         ASC-START-OF-SELECTED-RANGE)                             VNKCS004
170000                                                                  VNKCS004
170100         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     VNKCS004
170200                                    ASC-ITEM-SUB) <               VNKCS004
170300             ASC-END-OF-SELECTED-RANGE)                           VNKCS004
170400         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     VNKCS004
170500                                    ASC-ITEM-SUB) =               VNKCS004
170600             ASC-END-OF-SELECTED-RANGE)                           VNKCS004
170700                                                                  VNKCS004
170800             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          VNKCS004
170900                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   VNKCS004
171000                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   VNKCS004
171100                               TO TRUE                            VNKCS004
171200                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              VNKCS004
171300                               TO TRUE                            VNKCS004
171400                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    VNKCS004
171500             END-IF                                               VNKCS004
171600         END-IF                                                   VNKCS004
171700     END-IF.                                                      VNKCS004
171800                                                                  VNKCS004
171900*----------------------------------------------------------------*VNKCS004
172000*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *VNKCS004
172100*    INITIALIZE ALL COUNTERS AND FLAGS.                          *VNKCS004
172200*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *VNKCS004
172300*    DISPLAY THE PANEL TO USER.                                  *VNKCS004
172400*----------------------------------------------------------------*VNKCS004
172500 4000-BUILD-INITIAL-PANEL.                                        VNKCS004
172600                                                                  VNKCS004
172700     INITIALIZE ASC-BLOCK-ENTRIES (1)                             VNKCS004
172800                ASC-BLOCK-ENTRIES (2).                            VNKCS004
172900     MOVE +1 TO ASC-BLK-SUB.                                      VNKCS004
173000     SET ASC-ITEMS-LEFT-ON-DB TO TRUE.                            VNKCS004
173100     MOVE ZERO TO ASC-ITEM-SUB                                    VNKCS004
173200                  ASC-NUMBER-OF-ITEMS-READ                        VNKCS004
173300                  ASC-NUMBER-OF-SELECTED-ITEMS                    VNKCS004
173400                  ASC-HIGHEST-BLOCK-WRITTEN                       VNKCS004
173500                  ASC-START-OF-SELECTED-RANGE                     VNKCS004
173600                  ASC-END-OF-SELECTED-RANGE                       VNKCS004
173700                  ASC-ITEM-AT-TOP-OF-PANEL.                       VNKCS004
173800     MOVE ASC-KEY-ENT-ID TO DK-ENT-ID.                            VNKCS004
173900                                                                     CL*34
174000     EVALUATE TRUE                                                   CL*23
174100         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)                  CL*23
174200              MOVE PC-ACTIVE   TO PV-STAT1                           CL*30
174300              MOVE PC-ACTIVE   TO PV-STAT2                           CL*30
174400         WHEN OTHER                                                  CL*23
174500              MOVE PC-ACTIVE   TO PV-STAT1                           CL*30
174600              MOVE PC-INACTIVE TO PV-STAT2                           CL*23
174700     END-EVALUATE.                                                   CL*23
174800                                                                     CL*23
174900     IF VN001-VENDOR-TYPE = 'M' OR 'E'                            VNKCS004
175000         PERFORM 4010-OPEN-CURSOR                                 VNKCS004
175100                                                                  VNKCS004
175200         PERFORM 4300-READ-ITEMS-FROM-DB                          VNKCS004
175300                                                                  VNKCS004
175400         PERFORM 4020-CLOSE-CURSOR                                VNKCS004
175500                                                                  VNKCS004
175600         MOVE +1 TO PV-TOP-ITEM                                   VNKCS004
175700     ELSE                                                         VNKCS004
175800         MOVE ZERO TO ASC-NUMBER-OF-ITEMS-READ                    VNKCS004
175900     END-IF.                                                      VNKCS004
176000                                                                  VNKCS004
176100     IF ASC-NUMBER-OF-ITEMS-READ = ZERO                           VNKCS004
176200         SET DP030-SET-CURSOR-TRAILER TO TRUE                     VNKCS004
176300     ELSE                                                         VNKCS004
176400         MOVE -1 TO MR-SELECTL (1)                                VNKCS004
176500         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      VNKCS004
176600     END-IF.                                                      VNKCS004
176700                                                                  VNKCS004
176800     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        VNKCS004
176900                                                                  VNKCS004
177000     PERFORM 4500-GET-VENDOR-NAME.                                VNKCS004
177100                                                                  VNKCS004
177200 4010-OPEN-CURSOR.                                                VNKCS004
177300                                                                  VNKCS004
177400     PERFORM                                                      VNKCS004
177500         WITH TEST AFTER                                          VNKCS004
177600         VARYING PV-RETRY-COUNTER                                 VNKCS004
177700         FROM 1 BY 1                                              VNKCS004
177800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               VNKCS004
177900                   OR (SQLCODE = ZERO))                           VNKCS004
178000                                                                  VNKCS004
178100         IF VN001-VENDOR-TYPE = 'M'                               VNKCS004
178200             EXEC SQL                                             VNKCS004
178300                 OPEN MDSE-VENDOR-CSR                             VNKCS004
178400             END-EXEC                                             VNKCS004
178500         ELSE                                                     VNKCS004
178600             IF VN001-VENDOR-TYPE = 'E'                           VNKCS004
178700                 EXEC SQL                                         VNKCS004
178800                     OPEN EXP-VENDOR-CSR                          VNKCS004
178900                 END-EXEC                                         VNKCS004
179000             END-IF                                               VNKCS004
179100         END-IF                                                   VNKCS004
179200                                                                  VNKCS004
179300         EVALUATE TRUE                                            VNKCS004
179400             WHEN SQLCODE = ZERO                                  VNKCS004
179500             WHEN SQLCODE = -904                                  VNKCS004
179600             WHEN SQLCODE = -913                                  VNKCS004
179700                 CONTINUE                                         VNKCS004
179800                                                                  VNKCS004
179900             WHEN SQLWARN0 NOT = SPACES                           VNKCS004
180000             WHEN SQLCODE < ZERO                                  VNKCS004
180100             WHEN SQLCODE > ZERO                                  VNKCS004
180200                 MOVE '4010-OPEN-CURSOR'                          VNKCS004
180300                                   TO DP013-PARAGRAPH             VNKCS004
180400                 MOVE 'OPEN VENDOR DEPARTMENT CURSOR - '          VNKCS004
180500                                   TO DP013-MESSAGE-TEXT (1)      VNKCS004
180600                 MOVE SQLCA        TO DP013-SQLCA                 VNKCS004
180700                 MOVE 'TVNDDPT '   TO DP013-DB2-TABLE-NAME (1)    VNKCS004
180800                 SET DP013-DB2-ABEND                              VNKCS004
180900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           VNKCS004
181000                 PERFORM DP013-0000-PROCESS-ABEND                 VNKCS004
181100         END-EVALUATE                                             VNKCS004
181200     END-PERFORM.                                                 VNKCS004
181300                                                                  VNKCS004
181400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        VNKCS004
181500         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             VNKCS004
181600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   VNKCS004
181700                                   TO DP013-MESSAGE-TEXT (1)      VNKCS004
181800         MOVE SQLCA                TO DP013-SQLCA                 VNKCS004
181900         MOVE 'TVNDDPT '           TO DP013-DB2-TABLE-NAME (1)    VNKCS004
182000         SET DP013-DB2-ABEND                                      VNKCS004
182100             DP013-XCTL-DISPLAY-RESTART                           VNKCS004
182200                                   TO TRUE                        VNKCS004
182300         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS004
182400     END-IF.                                                      VNKCS004
182500                                                                  VNKCS004
182600 4020-CLOSE-CURSOR.                                               VNKCS004
182700                                                                  VNKCS004
182800     IF VN001-VENDOR-TYPE = 'M'                                   VNKCS004
182900         EXEC SQL                                                 VNKCS004
183000             CLOSE MDSE-VENDOR-CSR                                VNKCS004
183100         END-EXEC                                                 VNKCS004
183200     ELSE                                                         VNKCS004
183300         IF VN001-VENDOR-TYPE = 'E'                               VNKCS004
183400             EXEC SQL                                             VNKCS004
183500                 CLOSE EXP-VENDOR-CSR                             VNKCS004
183600             END-EXEC                                             VNKCS004
183700         END-IF                                                   VNKCS004
183800     END-IF                                                       VNKCS004
183900                                                                  VNKCS004
184000     EVALUATE TRUE                                                VNKCS004
184100         WHEN SQLCODE = ZERO                                      VNKCS004
184200             CONTINUE                                             VNKCS004
184300                                                                  VNKCS004
184400         WHEN SQLWARN0 NOT = SPACES                               VNKCS004
184500         WHEN SQLCODE < ZERO                                      VNKCS004
184600         WHEN SQLCODE > ZERO                                      VNKCS004
184700             MOVE '4020-CLOSE-CURSOR'                             VNKCS004
184800                               TO DP013-PARAGRAPH                 VNKCS004
184900             MOVE 'CLOSE VENDOR DEPARTMENT CURSOR '               VNKCS004
185000                               TO DP013-MESSAGE-TEXT (1)          VNKCS004
185100             MOVE SQLCA        TO DP013-SQLCA                     VNKCS004
185200             MOVE 'TVNDDPT '   TO DP013-DB2-TABLE-NAME (1)        VNKCS004
185300             SET DP013-DB2-ABEND                                  VNKCS004
185400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               VNKCS004
185500             PERFORM DP013-0000-PROCESS-ABEND                     VNKCS004
185600     END-EVALUATE.                                                VNKCS004
185700                                                                  VNKCS004
185800 4100-PREPARE-CURSOR.                                             VNKCS004
185900                                                                  VNKCS004
186000*----------------------------------------------------------------*VNKCS004
186100*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *VNKCS004
186200*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *VNKCS004
186300*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *VNKCS004
186400*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *VNKCS004
186500*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *VNKCS004
186600*----------------------------------------------------------------*VNKCS004
186700                                                                     CL*34
186800 4300-READ-ITEMS-FROM-DB.                                         VNKCS004
186900                                                                  VNKCS004
187000     PERFORM                                                      VNKCS004
187100         VARYING PV-READ-COUNT                                    VNKCS004
187200         FROM 1 BY 1                                              VNKCS004
187300         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    VNKCS004
187400            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         VNKCS004
187500                                                                  VNKCS004
187600         PERFORM 4310-FETCH                                       VNKCS004
187700                                                                  VNKCS004
187800         IF  ASC-ITEMS-LEFT-ON-DB                                 VNKCS004
187900             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                VNKCS004
188000                 ADD +1            TO ASC-ITEM-SUB                VNKCS004
188100             ELSE                                                 VNKCS004
188200                 ADD +1            TO ASC-BLK-SUB                 VNKCS004
188300                 MOVE +1           TO ASC-ITEM-SUB                VNKCS004
188400                                                                  VNKCS004
188500                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         VNKCS004
188600                     MOVE +1       TO ASC-BLK-SUB                 VNKCS004
188700                     SET ASC-BLOCK-MODIFIED (1)                   VNKCS004
188800                                   TO TRUE                        VNKCS004
188900                     PERFORM 5100-WRITE-TEMP-STORAGE              VNKCS004
189000                     MOVE ASC-BLOCK-ENTRIES                       VNKCS004
189100                               (PC-MAX-BLOCKS-IN-ARRAY)           VNKCS004
189200                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) VNKCS004
189300                     ADD +1        TO ASC-BLK-SUB                 VNKCS004
189400                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   VNKCS004
189500                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      VNKCS004
189600                                   TO TRUE                        VNKCS004
189700                 END-IF                                           VNKCS004
189800             END-IF                                               VNKCS004
189900             ADD +1                   TO ASC-NUMBER-OF-ITEMS-READ VNKCS004
190000             MOVE ASC-NUMBER-OF-ITEMS-READ                        VNKCS004
190100                                      TO ASC-LIST-ITEM-NUMBER     VNKCS004
190200                                        (ASC-BLK-SUB ASC-ITEM-SUB)VNKCS004
190300             MOVE VNDDPT-VEND-TYP-IND        TO ASC-VENDOR-TYPE      CL*24
190400                                        (ASC-BLK-SUB ASC-ITEM-SUB)VNKCS004
190500             MOVE VNDDPT-DEPT-NBR            TO ASC-DEPT-NUMBER      CL*24
190600                                        (ASC-BLK-SUB ASC-ITEM-SUB)VNKCS004
190700             MOVE VNDDPT-VND-DEPT-STAT-CD    TO ASC-STATUS-IND       CL*24
190800                                        (ASC-BLK-SUB ASC-ITEM-SUB)   CL*24
190900             MOVE PV-DEPT-DESC               TO ASC-DEPT-NAME        CL*24
191000                                        (ASC-BLK-SUB ASC-ITEM-SUB)VNKCS004
191100             MOVE PV-INHOUSE-NBR             TO ASC-INHOUSE-NUMBER   CL*24
191200                                        (ASC-BLK-SUB ASC-ITEM-SUB)VNKCS004
191300             PERFORM 4320-GET-PAYMENT-TERMS                       VNKCS004
191400                                                                  VNKCS004
191500             PERFORM 4340-GET-PRETICKET-IND                       VNKCS004
191600         END-IF                                                   VNKCS004
191700     END-PERFORM.                                                 VNKCS004
191800                                                                  VNKCS004
191900     IF ASC-NUMBER-OF-ITEMS-READ > ZERO                           VNKCS004
192000         MOVE +1 TO ASC-BLK-SUB                                   VNKCS004
192100                                                                  VNKCS004
192200         PERFORM 5100-WRITE-TEMP-STORAGE                          VNKCS004
192300                                                                  VNKCS004
192400         ADD  +1 TO ASC-BLK-SUB                                   VNKCS004
192500                                                                  VNKCS004
192600         PERFORM 5100-WRITE-TEMP-STORAGE                          VNKCS004
192700                                                                  VNKCS004
192800         MOVE 1 TO ASC-BLK-SUB                                    VNKCS004
192900                   PV-BLOCK-NUMBER                                VNKCS004
193000                                                                  VNKCS004
193100         PERFORM 4410-READ-TEMP-STORAGE                           VNKCS004
193200                                                                  VNKCS004
193300         IF ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1              VNKCS004
193400             MOVE 2 TO ASC-BLK-SUB                                VNKCS004
193500                       PV-BLOCK-NUMBER                            VNKCS004
193600                                                                  VNKCS004
193700             PERFORM 4410-READ-TEMP-STORAGE                       VNKCS004
193800         END-IF                                                   VNKCS004
193900     END-IF.                                                      VNKCS004
194000*----------------------------------------------------------------*   CL**4
194100*----------------------------------------------------------------*   CL**4
194200                                                                     CL*34
194300 4310-FETCH.                                                         CL*24
194400                                                                  VNKCS004
194500     IF VN001-VENDOR-TYPE = 'M'                                   VNKCS004
194600         EXEC SQL                                                 VNKCS004
194700                 FETCH MDSE-VENDOR-CSR                            VNKCS004
194800                  INTO :VNDDPT-DEPT-NBR                           VNKCS004
194900                      ,:PV-INHOUSE-NBR                            VNKCS004
195000                      ,:VNDDPT-VEND-TYP-IND                          CL*24
195100                      ,:VNDDPT-VND-DEPT-STAT-CD                      CL*24
195200                      ,:PV-DEPT-DESC                              VNKCS004
195300         END-EXEC                                                 VNKCS004
195400     ELSE                                                         VNKCS004
195500         IF VN001-VENDOR-TYPE = 'E'                               VNKCS004
195600             MOVE ZERO TO PV-INHOUSE-NBR                          VNKCS004
195700             EXEC SQL                                             VNKCS004
195800                     FETCH EXP-VENDOR-CSR                         VNKCS004
195900                      INTO :VNDDPT-DEPT-NBR                       VNKCS004
196000                          ,:VNDDPT-VEND-TYP-IND                   VNKCS004
196100                          ,:VNDDPT-VND-DEPT-STAT-CD                  CL*25
196200                          ,:PV-DEPT-DESC                          VNKCS004
196300             END-EXEC                                             VNKCS004
196400         END-IF                                                   VNKCS004
196500     END-IF                                                       VNKCS004
196600                                                                  VNKCS004
196700     EVALUATE TRUE                                                VNKCS004
196800         WHEN SQLCODE = ZERO                                      VNKCS004
196900         WHEN SQLCODE = +100                                      VNKCS004
197000              CONTINUE                                            VNKCS004
197100                                                                  VNKCS004
197200         WHEN SQLWARN0 NOT = SPACE                                VNKCS004
197300         WHEN SQLCODE NOT = ZERO                                  VNKCS004
197400              MOVE '4310-FETCH-CURSOR'                            VNKCS004
197500                               TO DP013-PARAGRAPH                 VNKCS004
197600              MOVE 'FETCH VENDOR DEPARTMENT CURSOR'               VNKCS004
197700                               TO DP013-MESSAGE-TEXT (1)          VNKCS004
197800              MOVE SQLCA       TO DP013-SQLCA                     VNKCS004
197900              SET DP013-DB2-ABEND                                 VNKCS004
198000                               TO TRUE                            VNKCS004
198100              PERFORM DP013-0000-PROCESS-ABEND                    VNKCS004
198200     END-EVALUATE.                                                VNKCS004
198300                                                                  VNKCS004
198400     IF SQLCODE = +100                                            VNKCS004
198500         SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE.                     VNKCS004
198600                                                                  VNKCS004
198700 4320-GET-PAYMENT-TERMS.                                          VNKCS004
198800                                                                  VNKCS004
198900     PERFORM                                                      VNKCS004
199000         WITH TEST AFTER                                          VNKCS004
199100         VARYING PV-RETRY-COUNTER                                 VNKCS004
199200         FROM 1 BY 1                                              VNKCS004
199300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               VNKCS004
199400             OR (SQLCODE = +0)                                    VNKCS004
199500             OR (SQLCODE = +100))                                 VNKCS004
199600                                                                  VNKCS004
199700         EXEC SQL                                                 VNKCS004
199800               SELECT B.PAY_TERM_ID                               VNKCS004
199900                     ,B.DISCOUNT_DAYS_QTY                         VNKCS004
200000                     ,B.DISCOUNT_PCT                              VNKCS004
200100                     ,B.DUE_DAY_QTY                               VNKCS004
200200                     ,B.DUE_DAY_FR_DTE_TXT                        VNKCS004
200300                     ,B.OTHER_TXT                                 VNKCS004
200400                INTO :PAYTRM-PAY-TERM-ID                          VNKCS004
200500                    ,:PAYTRM-DISCOUNT-DAYS-QTY                    VNKCS004
200600                    ,:PAYTRM-DISCOUNT-PCT                         VNKCS004
200700                    ,:PAYTRM-DUE-DAY-QTY                          VNKCS004
200800                    ,:PAYTRM-DUE-DAY-FR-DTE-TXT                   VNKCS004
200900                    ,:PAYTRM-OTHER-TXT                            VNKCS004
201000                FROM TVNDAGR A                                    VNKCS004
201100                    ,TPAYTRM B                                    VNKCS004
201200               WHERE A.ENT_ID           = :DK-ENT-ID              VNKCS004
201300                 AND A.DEPT_NBR         = :VNDDPT-DEPT-NBR        VNKCS004
201400                 AND A.AGRMT_TYP_ID     = '2'                     VNKCS004
201500                 AND A.EFFECTIVE_DATE  <= CURRENT DATE            VNKCS004
201600                 AND A.EXPIRATION_DATE >  CURRENT DATE            VNKCS004
201700                 AND A.PAYT_TERM_ID     = B.PAY_TERM_ID           VNKCS004
201800         END-EXEC                                                 VNKCS004
201900                                                                  VNKCS004
202000         EVALUATE TRUE                                            VNKCS004
202100             WHEN SQLCODE = +0                                    VNKCS004
202200                                                                  VNKCS004
202300                  MOVE SPACES TO ASC-PAYT-TERM-ID-DESC            VNKCS004
202400                                                                  VNKCS004
202500                  MOVE PAYTRM-PAY-TERM-ID TO PV-EDIT-PAYT-TERM-ID VNKCS004
202600                                                                  VNKCS004
202700                  PERFORM 4322-FORMAT-TERMS                       VNKCS004
202800                                                                  VNKCS004
202900                  MOVE ASC-PAYT-TERM-ID-DESC TO ASC-PAYMENT-TERMS VNKCS004
203000                                        (ASC-BLK-SUB ASC-ITEM-SUB)VNKCS004
203100                                                                  VNKCS004
203200             WHEN SQLCODE = +100                                  VNKCS004
203300                  MOVE SPACES TO ASC-PAYMENT-TERMS                VNKCS004
203400                                        (ASC-BLK-SUB ASC-ITEM-SUB)VNKCS004
203500                                                                  VNKCS004
203600             WHEN SQLCODE = -904                                  VNKCS004
203700             WHEN SQLCODE = -913                                  VNKCS004
203800                  CONTINUE                                        VNKCS004
203900                                                                  VNKCS004
204000             WHEN SQLWARN0 NOT = SPACES                           VNKCS004
204100             WHEN SQLCODE < +0                                    VNKCS004
204200             WHEN SQLCODE > +0                                    VNKCS004
204300                  MOVE '4320-GET-PAYMENT-TERMS'                   VNKCS004
204400                                  TO DP013-PARAGRAPH              VNKCS004
204500                  MOVE 'UNSUCCESSFUL SELECT PAYMENT TERMS'        VNKCS004
204600                                  TO DP013-MESSAGE-TEXT (1)       VNKCS004
204700                  MOVE SQLCA      TO DP013-SQLCA                  VNKCS004
204800                  MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)     VNKCS004
204900                  MOVE 'TPAYTRM ' TO DP013-DB2-TABLE-NAME (2)     VNKCS004
205000                  SET DP013-DB2-ABEND                             VNKCS004
205100                      DP013-XCTL-DISPLAY-RESTART                  VNKCS004
205200                                  TO TRUE                         VNKCS004
205300                  PERFORM DP013-0000-PROCESS-ABEND                VNKCS004
205400         END-EVALUATE                                             VNKCS004
205500     END-PERFORM.                                                 VNKCS004
205600                                                                  VNKCS004
205700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        VNKCS004
205800         MOVE '4320-GET-PAYMENT-TERMS'                            VNKCS004
205900                                  TO DP013-PARAGRAPH              VNKCS004
206000         MOVE 'MAX RETRIES EXCEEDED ON SELECT PAYMENT TERMS'      VNKCS004
206100                                  TO DP013-MESSAGE-TEXT (1)       VNKCS004
206200         MOVE SQLCA               TO DP013-SQLCA                  VNKCS004
206300         MOVE 'TVNDAGR '          TO DP013-DB2-TABLE-NAME (1)     VNKCS004
206400         MOVE 'TPAYTRM '          TO DP013-DB2-TABLE-NAME (2)     VNKCS004
206500         SET DP013-DB2-ABEND                                      VNKCS004
206600             DP013-XCTL-DISPLAY-RESTART                           VNKCS004
206700                                  TO TRUE                         VNKCS004
206800         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS004
206900     END-IF.                                                      VNKCS004
207000                                                                  VNKCS004
207100 4322-FORMAT-TERMS.                                               VNKCS004
207200                                                                  VNKCS004
207300     COPY POPD001.                                                VNKCS004
207400                                                                  VNKCS004
207500 4340-GET-PRETICKET-IND.                                          VNKCS004
207600                                                                  VNKCS004
207700     MOVE DK-ENT-ID          TO VNDAGR-ENT-ID.                    VNKCS004
207800     MOVE VNDDPT-DEPT-NBR    TO VNDAGR-DEPT-NBR.                  VNKCS004
207900     MOVE '4'                TO VNDAGR-AGRMT-TYP-ID.              VNKCS004
208000     MOVE +1                 TO VNDAGR-TYP-CDE.                   VNKCS004
208100                                                                  VNKCS004
208200     PERFORM WITH TEST AFTER                                      VNKCS004
208300             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 VNKCS004
208400             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         VNKCS004
208500                     SQLCODE = ZERO                               VNKCS004
208600                                                                  VNKCS004
208700             EXEC SQL                                             VNKCS004
208800                  SELECT COUNT(*)                                 VNKCS004
208900                    INTO :PV-READ-COUNT                           VNKCS004
209000                    FROM TVNDAGR                                  VNKCS004
209100                   WHERE ENT_ID          = :VNDAGR-ENT-ID         VNKCS004
209200                     AND DEPT_NBR        = :VNDAGR-DEPT-NBR       VNKCS004
209300                     AND AGRMT_TYP_ID    = :VNDAGR-AGRMT-TYP-ID   VNKCS004
209400                     AND TYP_CDE         = :VNDAGR-TYP-CDE        VNKCS004
209500                     AND EFFECTIVE_DATE  <= CURRENT DATE          VNKCS004
209600                     AND EXPIRATION_DATE >  CURRENT DATE          VNKCS004
209700                     AND SEQ_NBR         =                        VNKCS004
209800                 (SELECT MAX(SEQ_NBR)                             VNKCS004
209900                    FROM TVNDAGR                                  VNKCS004
210000                   WHERE ENT_ID          = :VNDAGR-ENT-ID         VNKCS004
210100                     AND DEPT_NBR        = :VNDAGR-DEPT-NBR       VNKCS004
210200                     AND AGRMT_TYP_ID    = :VNDAGR-AGRMT-TYP-ID   VNKCS004
210300                     AND TYP_CDE         = :VNDAGR-TYP-CDE)       VNKCS004
210400             END-EXEC                                             VNKCS004
210500                                                                  VNKCS004
210600             EVALUATE TRUE                                        VNKCS004
210700                 WHEN SQLCODE = ZERO                              VNKCS004
210800                 WHEN SQLCODE = -904                              VNKCS004
210900                 WHEN SQLCODE = -913                              VNKCS004
211000                      CONTINUE                                    VNKCS004
211100                                                                  VNKCS004
211200                 WHEN OTHER                                       VNKCS004
211300                      MOVE '4340-GET-PRETICKET-IND'               VNKCS004
211400                                      TO DP013-PARAGRAPH          VNKCS004
211500                      MOVE 'UNSUCCESSFUL SELECT PRETKT INDICATOR' VNKCS004
211600                                      TO DP013-MESSAGE-TEXT (1)   VNKCS004
211700                      MOVE SQLCA      TO DP013-SQLCA              VNKCS004
211800                      MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1) VNKCS004
211900                      SET DP013-DB2-ABEND                         VNKCS004
212000                          DP013-XCTL-DISPLAY-RESTART              VNKCS004
212100                                      TO TRUE                     VNKCS004
212200                      PERFORM DP013-0000-PROCESS-ABEND            VNKCS004
212300             END-EVALUATE                                         VNKCS004
212400         END-PERFORM.                                             VNKCS004
212500                                                                  VNKCS004
212600         IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                    VNKCS004
212700             MOVE '4340-GET-PRETICKET-IND'                        VNKCS004
212800                                      TO DP013-PARAGRAPH          VNKCS004
212900             MOVE 'MAX RETRIES EXCEED ON SELECT PRETKT INDICATOR' VNKCS004
213000                                      TO DP013-MESSAGE-TEXT (1)   VNKCS004
213100             MOVE SQLCA               TO DP013-SQLCA              VNKCS004
213200             MOVE 'TVNDAGR '          TO DP013-DB2-TABLE-NAME (1) VNKCS004
213300             SET DP013-DB2-ABEND                                  VNKCS004
213400                 DP013-XCTL-DISPLAY-RESTART                       VNKCS004
213500                                      TO TRUE                     VNKCS004
213600             PERFORM DP013-0000-PROCESS-ABEND                     VNKCS004
213700         END-IF.                                                  VNKCS004
213800                                                                  VNKCS004
213900     IF SQLCODE = ZERO                                            VNKCS004
214000        IF PV-READ-COUNT > ZERO                                   VNKCS004
214100            MOVE 'Y' TO ASC-PRETKT-IND                            VNKCS004
214200                                    (ASC-BLK-SUB ASC-ITEM-SUB)    VNKCS004
214300        ELSE                                                      VNKCS004
214400            MOVE 'N' TO ASC-PRETKT-IND                            VNKCS004
214500                                    (ASC-BLK-SUB ASC-ITEM-SUB)    VNKCS004
214600        END-IF                                                    VNKCS004
214700     ELSE                                                         VNKCS004
214800         IF SQLCODE = -305                                        VNKCS004
214900            MOVE 'N' TO ASC-PRETKT-IND                            VNKCS004
215000                                    (ASC-BLK-SUB ASC-ITEM-SUB)    VNKCS004
215100         END-IF                                                   VNKCS004
215200     END-IF.                                                      VNKCS004
215300                                                                  VNKCS004
215400*----------------------------------------------------------------*VNKCS004
215500* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *VNKCS004
215600*----------------------------------------------------------------*VNKCS004
215700 4400-MOVE-COMMAREA-TO-SCREEN.                                    VNKCS004
215800                                                                  VNKCS004
215900     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             VNKCS004
216000         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          VNKCS004
216100         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          VNKCS004
216200             MOVE +1    TO ASC-BLK-SUB                            VNKCS004
216300             PERFORM 5100-WRITE-TEMP-STORAGE                      VNKCS004
216400             ADD +1     TO ASC-BLK-SUB                            VNKCS004
216500             PERFORM 5100-WRITE-TEMP-STORAGE                      VNKCS004
216600             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             VNKCS004
216700                 GIVING PV-BLOCK-NUMBER                           VNKCS004
216800                 REMAINDER PV-REMAINDER                           VNKCS004
216900             IF  PV-REMAINDER > ZERO                              VNKCS004
217000                 ADD +1 TO PV-BLOCK-NUMBER                        VNKCS004
217100             END-IF                                               VNKCS004
217200             MOVE +1    TO ASC-BLK-SUB                            VNKCS004
217300             PERFORM 4410-READ-TEMP-STORAGE                       VNKCS004
217400             ADD +1     TO ASC-BLK-SUB                            VNKCS004
217500                           PV-BLOCK-NUMBER                        VNKCS004
217600             PERFORM 4410-READ-TEMP-STORAGE                       VNKCS004
217700     END-IF.                                                      VNKCS004
217800     MOVE +1            TO ASC-BLK-SUB.                           VNKCS004
217900     COMPUTE ASC-ITEM-SUB =                                       VNKCS004
218000         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              VNKCS004
218100         + PC-ITEMS-PER-PANEL).                                   VNKCS004
218200                                                                  VNKCS004
218300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        VNKCS004
218400         ADD +1         TO ASC-BLK-SUB                            VNKCS004
218500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            VNKCS004
218600     END-IF.                                                      VNKCS004
218700                                                                  VNKCS004
218800     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           VNKCS004
218900         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                VNKCS004
219000     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        VNKCS004
219100     PERFORM 4420-FORMAT-LIST-LINES                               VNKCS004
219200         VARYING PV-SUB                                           VNKCS004
219300         FROM PC-ITEMS-PER-PANEL BY -1                            VNKCS004
219400         UNTIL PV-SUB < +1.                                       VNKCS004
219500                                                                  VNKCS004
219600     COMPUTE ASC-ITEMS-DISPLAYED =                                VNKCS004
219700         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          VNKCS004
219800     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    VNKCS004
219900                                      ASTRTITO.                   VNKCS004
220000     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    VNKCS004
220100     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    VNKCS004
220200     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            VNKCS004
220300                                   TO ASELITO.                    VNKCS004
220400     MOVE ASC-VENDOR-NAME          TO AVENDO.                     VNKCS004
220500                                                                  VNKCS004
220600     IF  DP020-MSG-NUMBER-X = SPACE                               VNKCS004
220700         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  VNKCS004
220800*            --- MORE ITEMS TO DISPLAY ----                       VNKCS004
220900             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            VNKCS004
221000             SET DP020-MSG-INFORMATIONAL TO TRUE                  VNKCS004
221100         END-IF                                                   VNKCS004
221200     END-IF.                                                      VNKCS004
221300                                                                  VNKCS004
221400*----------------------------------------------------------------*VNKCS004
221500*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *VNKCS004
221600*----------------------------------------------------------------*VNKCS004
221700 4410-READ-TEMP-STORAGE.                                          VNKCS004
221800                                                                  VNKCS004
221900     EXEC CICS                                                    VNKCS004
222000         READQ TS                                                 VNKCS004
222100             QUEUE (ASC-LIST-QUEUE-NAME)                          VNKCS004
222200             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               VNKCS004
222300             ITEM  (PV-BLOCK-NUMBER)                              VNKCS004
222400             RESP  (PV-CICS-RESP)                                 VNKCS004
222500     END-EXEC.                                                    VNKCS004
222600                                                                  VNKCS004
222700     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       VNKCS004
222800       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     VNKCS004
222900         CONTINUE                                                 VNKCS004
223000     ELSE                                                         VNKCS004
223100         SET DP013-CICS-ABEND     TO TRUE                         VNKCS004
223200         SET DP013-NO-ROLLBACK    TO TRUE                         VNKCS004
223300         MOVE '4410-READ-TEMP-STORAGE'                            VNKCS004
223400                                  TO DP013-PARAGRAPH              VNKCS004
223500         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      VNKCS004
223600                                  TO DP013-MESSAGE-TEXT(1)        VNKCS004
223700         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS004
223800     END-IF.                                                      VNKCS004
223900                                                                  VNKCS004
224000     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             VNKCS004
224100                                                                  VNKCS004
224200     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         VNKCS004
224300         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               VNKCS004
224400     END-IF.                                                      VNKCS004
224500                                                                  VNKCS004
224600*----------------------------------------------------------------*VNKCS004
224700*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *VNKCS004
224800*----------------------------------------------------------------*VNKCS004
224900 4420-FORMAT-LIST-LINES.                                          VNKCS004
225000                                                                  VNKCS004
225100     IF ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ       VNKCS004
225200         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                VNKCS004
225300         MOVE DP015-ASK-DRK-OFF TO MR-SELECTA        (PV-SUB)     VNKCS004
225400         MOVE SPACES            TO MR-SELECTI        (PV-SUB)     VNKCS004
225500                                   MR-ACTION         (PV-SUB)     VNKCS004
225600                                   MR-VEND-TYPE      (PV-SUB)     VNKCS004
225700                                   MR-DEPT-NUMBER-X  (PV-SUB)     VNKCS004
225800                                   MR-DEPT-NAME      (PV-SUB)     VNKCS004
225900                                   MR-PAYMENT-TERMS  (PV-SUB)     VNKCS004
226000                                   MR-PRETKT-IND     (PV-SUB)     VNKCS004
226100                                   MR-STATUS-IND     (PV-SUB)        CL*26
226200         MOVE ZERO              TO MR-INHOUSE-NUMBER (PV-SUB)     VNKCS004
226300     ELSE                                                         VNKCS004
226400         IF ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)       VNKCS004
226500                                                           > SPACEVNKCS004
226600             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) VNKCS004
226700                                            TO MR-SELECTI (PV-SUB)VNKCS004
226800         ELSE                                                     VNKCS004
226900             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      VNKCS004
227000                                            TO MR-SELECTI (PV-SUB)VNKCS004
227100         END-IF                                                   VNKCS004
227200                                                                  VNKCS004
227300         IF  DP030-SET-CURSOR-TRAILER                             VNKCS004
227400             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)VNKCS004
227500                 > SPACE)                                         VNKCS004
227600               OR (PV-SUB = 1))                                   VNKCS004
227700                SET DP030-SET-CURSOR-APPL-1 TO TRUE               VNKCS004
227800                MOVE -1          TO MR-SELECTL (PV-SUB)           VNKCS004
227900             END-IF                                               VNKCS004
228000         END-IF                                                   VNKCS004
228100                                                                  VNKCS004
228200         IF PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL            VNKCS004
228300             MOVE ASC-ACTION         (ASC-BLK-SUB ASC-ITEM-SUB) TOVNKCS004
228400                                     MR-ACTION         (PV-SUB)   VNKCS004
228500             IF ASC-VENDOR-TYPE (ASC-BLK-SUB ASC-ITEM-SUB) = SPACEVNKCS004
228600                 MOVE 'M' TO MR-VEND-TYPE (PV-SUB)                VNKCS004
228700             ELSE                                                 VNKCS004
228800                MOVE ASC-VENDOR-TYPE (ASC-BLK-SUB ASC-ITEM-SUB) TOVNKCS004
228900                                     MR-VEND-TYPE      (PV-SUB)   VNKCS004
229000             END-IF                                               VNKCS004
229100             MOVE ASC-DEPT-NUMBER    (ASC-BLK-SUB ASC-ITEM-SUB) TOVNKCS004
229200                                     MR-DEPT-NUMBER    (PV-SUB)   VNKCS004
229300             MOVE ASC-DEPT-NAME      (ASC-BLK-SUB ASC-ITEM-SUB) TOVNKCS004
229400                                     MR-DEPT-NAME      (PV-SUB)   VNKCS004
229500             MOVE ASC-INHOUSE-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB) TOVNKCS004
229600                                     MR-INHOUSE-NUMBER (PV-SUB)   VNKCS004
229700             MOVE ASC-PAYMENT-TERMS  (ASC-BLK-SUB ASC-ITEM-SUB) TOVNKCS004
229800                                     MR-PAYMENT-TERMS  (PV-SUB)   VNKCS004
229900             MOVE ASC-PRETKT-IND     (ASC-BLK-SUB ASC-ITEM-SUB) TOVNKCS004
230000                                     MR-PRETKT-IND     (PV-SUB)   VNKCS004
230100             MOVE ASC-STATUS-IND     (ASC-BLK-SUB ASC-ITEM-SUB) TO   CL*27
230200                                     MR-STATUS-IND     (PV-SUB)      CL*27
230300         END-IF                                                   VNKCS004
230400     END-IF.                                                      VNKCS004
230500                                                                  VNKCS004
230600     SUBTRACT +1 FROM ASC-ITEM-SUB                                VNKCS004
230700                                                                  VNKCS004
230800     IF ASC-ITEM-SUB < + 1                                        VNKCS004
230900         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  VNKCS004
231000         MOVE +1                 TO ASC-BLK-SUB                   VNKCS004
231100     END-IF.                                                      VNKCS004
231200                                                                  VNKCS004
231300******************************************************************VNKCS004
231400** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **VNKCS004
231500** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **VNKCS004
231600** ISSUE A WARNING.                                             **VNKCS004
231700******************************************************************VNKCS004
231800 4430-CHECK-FOR-BEGIN-AND-END.                                    VNKCS004
231900                                                                  VNKCS004
232000     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       VNKCS004
232100         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     VNKCS004
232200*            -- NO END-OF-RANGE SPECFIED ---                      VNKCS004
232300             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            VNKCS004
232400             SET DP020-MSG-WARNING TO TRUE                        VNKCS004
232500             PERFORM 4431-POSITION-AT-WARNING                     VNKCS004
232600         END-IF                                                   VNKCS004
232700     ELSE                                                         VNKCS004
232800         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     VNKCS004
232900*            -- NO BEGINNING-OF-RANGE SPECFIED ---                VNKCS004
233000             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            VNKCS004
233100             SET DP020-MSG-WARNING TO TRUE                        VNKCS004
233200             PERFORM 4431-POSITION-AT-WARNING                     VNKCS004
233300         END-IF                                                   VNKCS004
233400     END-IF.                                                      VNKCS004
233500                                                                  VNKCS004
233600******************************************************************VNKCS004
233700** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **VNKCS004
233800** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **VNKCS004
233900** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **VNKCS004
234000** POSITION THE CURSOR THERE.                                   **VNKCS004
234100******************************************************************VNKCS004
234200 4431-POSITION-AT-WARNING.                                        VNKCS004
234300                                                                  VNKCS004
234400     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 VNKCS004
234500                    - PV-TOP-ITEM + 1.                            VNKCS004
234600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      VNKCS004
234700         CONTINUE                                                 VNKCS004
234800     ELSE                                                         VNKCS004
234900         SET DP030-SET-CURSOR-APPL-1                              VNKCS004
235000                                   TO TRUE                        VNKCS004
235100         MOVE -1                   TO MR-SELECTL (PV-SUB)         VNKCS004
235200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         VNKCS004
235300         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         VNKCS004
235400     END-IF.                                                      VNKCS004
235500                                                                  VNKCS004
235600     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   VNKCS004
235700                    - PV-TOP-ITEM + 1.                            VNKCS004
235800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      VNKCS004
235900         CONTINUE                                                 VNKCS004
236000     ELSE                                                         VNKCS004
236100         SET DP030-SET-CURSOR-APPL-1                              VNKCS004
236200                                   TO TRUE                        VNKCS004
236300         MOVE -1                   TO MR-SELECTL (PV-SUB)         VNKCS004
236400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         VNKCS004
236500         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         VNKCS004
236600     END-IF.                                                      VNKCS004
236700                                                                  VNKCS004
236800 4500-GET-VENDOR-NAME.                                            VNKCS004
236900                                                                  VNKCS004
237000                                                                  VNKCS004
237100     PERFORM                                                      VNKCS004
237200         WITH TEST AFTER                                          VNKCS004
237300         VARYING PV-RETRY-COUNTER                                 VNKCS004
237400         FROM 1 BY 1                                              VNKCS004
237500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               VNKCS004
237600                   OR (SQLCODE = ZERO)                            VNKCS004
237700                   OR (SQLCODE = +100))                           VNKCS004
237800                                                                  VNKCS004
237900         EXEC SQL                                                 VNKCS004
238000                 SELECT ENT_NAME_DESC                             VNKCS004
238100                   INTO :ENTNME-ENT-NAME-DESC                     VNKCS004
238200                   FROM TENTNME                                   VNKCS004
238300                  WHERE ENT_ID   = :DK-ENT-ID                     VNKCS004
238400                    AND TYPE_CDE = '01'                           VNKCS004
238500         END-EXEC                                                 VNKCS004
238600                                                                  VNKCS004
238700         EVALUATE TRUE                                            VNKCS004
238800             WHEN SQLCODE = ZERO                                  VNKCS004
238900             WHEN SQLCODE = +100                                  VNKCS004
239000             WHEN SQLCODE = -904                                  VNKCS004
239100             WHEN SQLCODE = -913                                  VNKCS004
239200                 CONTINUE                                         VNKCS004
239300             WHEN SQLWARN0 NOT = SPACES                           VNKCS004
239400             WHEN SQLCODE < ZERO                                  VNKCS004
239500             WHEN SQLCODE > ZERO                                  VNKCS004
239600                 MOVE '4500-SELECT-ENT-NAME'                      VNKCS004
239700                                   TO DP013-PARAGRAPH             VNKCS004
239800                 MOVE 'SELECT ENTERPRISE NAME'                    VNKCS004
239900                                   TO DP013-MESSAGE-TEXT (1)      VNKCS004
240000                 MOVE SQLCA        TO DP013-SQLCA                 VNKCS004
240100                 MOVE 'TENTNME'    TO DP013-SQLCA                 VNKCS004
240200                 SET DP013-DB2-ABEND                              VNKCS004
240300                     DP013-XCTL-DISPLAY-RESTART                   VNKCS004
240400                                   TO TRUE                        VNKCS004
240500                 PERFORM DP013-0000-PROCESS-ABEND                 VNKCS004
240600         END-EVALUATE                                             VNKCS004
240700     END-PERFORM.                                                 VNKCS004
240800                                                                  VNKCS004
240900     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         VNKCS004
241000         MOVE '4500-SELECT-ENT-NAME'                              VNKCS004
241100                                   TO DP013-PARAGRAPH             VNKCS004
241200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     VNKCS004
241300                                   TO DP013-MESSAGE-TEXT (1)      VNKCS004
241400         MOVE 'SHORT MESSAGE'      TO DP013-MESSAGE-TEXT (2)      VNKCS004
241500         MOVE SQLCA                TO DP013-SQLCA                 VNKCS004
241600         MOVE 'TENTNME'            TO DP013-DB2-TABLE-NAME (1)    VNKCS004
241700         SET DP013-DB2-ABEND                                      VNKCS004
241800             DP013-XCTL-DISPLAY-RESTART                           VNKCS004
241900                                   TO TRUE                        VNKCS004
242000         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS004
242100     END-IF.                                                      VNKCS004
242200                                                                  VNKCS004
242300     IF SQLCODE = ZERO                                            VNKCS004
242400         MOVE ENTNME-ENT-NAME-DESC TO AVENDO                      VNKCS004
242500                                      ASC-VENDOR-NAME             VNKCS004
242600     ELSE                                                         VNKCS004
242700         IF SQLCODE = +100                                        VNKCS004
242800             MOVE 'VENDOR NOT FOUND' TO AVENDO                    VNKCS004
242900                                        ASC-VENDOR-NAME           VNKCS004
243000         END-IF                                                   VNKCS004
243100     END-IF.                                                      VNKCS004
243200                                                                  VNKCS004
243300*----------------------------------------------------------------*VNKCS004
243400* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *VNKCS004
243500* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *VNKCS004
243600* FOR THE SELECTED ITEMS QUEUE.                                  *VNKCS004
243700*                                                                *VNKCS004
243800* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *VNKCS004
243900* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *VNKCS004
244000* THE ARRAY IS FULL.                                             *VNKCS004
244100*----------------------------------------------------------------*VNKCS004
244200 5000-PREPARE-SEL-QUEUE.                                          VNKCS004
244300                                                                  VNKCS004
244400     MOVE +1                   TO  ASC-BLK-SUB.                   VNKCS004
244500     PERFORM 5100-WRITE-TEMP-STORAGE.                             VNKCS004
244600     ADD +1                    TO  ASC-BLK-SUB.                   VNKCS004
244700     PERFORM 5100-WRITE-TEMP-STORAGE.                             VNKCS004
244800                                                                  VNKCS004
244900     MOVE ASC-SEL-QUEUE-NAME-OUT                                  VNKCS004
245000                               TO  VN002-SEL-QUEUE-NAME.          VNKCS004
245100     PERFORM 6010-DELETE-SEL-QUEUE.                               VNKCS004
245200                                                                  VNKCS004
245300                                                                  VNKCS004
245400     SET VN003-IDX             TO  1.                             VNKCS004
245500     MOVE ZERO                 TO VN002-NUMBER-OF-TS-ITEMS.       VNKCS004
245600     INITIALIZE VN003-SELECTED-ITEM-ARRAY.                        VNKCS004
245700                                                                  VNKCS004
245800     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           VNKCS004
245900             VARYING PV-ITEM                                      VNKCS004
246000             FROM 1 BY 1                                          VNKCS004
246100             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     VNKCS004
246200                                                                  VNKCS004
246300     IF  VN003-IDX > 1                                            VNKCS004
246400         PERFORM 5205-WRITE-SEL-QUEUE                             VNKCS004
246500         ADD +1                TO VN002-NUMBER-OF-TS-ITEMS        VNKCS004
246600     END-IF.                                                      VNKCS004
246700                                                                  VNKCS004
246800*----------------------------------------------------------------*VNKCS004
246900*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *VNKCS004
247000*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *VNKCS004
247100*----------------------------------------------------------------*VNKCS004
247200 5100-WRITE-TEMP-STORAGE.                                         VNKCS004
247300                                                                  VNKCS004
247400     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     VNKCS004
247500                                   TO PV-LIST-ITEM-NUMBER.        VNKCS004
247600     COMPUTE PV-BLOCK-NUMBER =                                    VNKCS004
247700         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    VNKCS004
247800                                                                  VNKCS004
247900     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             VNKCS004
248000     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             VNKCS004
248100         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      VNKCS004
248200             PERFORM 5105-REWRITE-ASC-LISTQ                       VNKCS004
248300         END-IF                                                   VNKCS004
248400     ELSE                                                         VNKCS004
248500         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       VNKCS004
248600         ASC-HIGHEST-BLOCK-WRITTEN + 1                            VNKCS004
248700         PERFORM 5110-WRITE-ASC-LISTQ                             VNKCS004
248800         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   VNKCS004
248900     END-IF.                                                      VNKCS004
249000                                                                  VNKCS004
249100     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             VNKCS004
249200                                                                  VNKCS004
249300******************************************************************VNKCS004
249400** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **VNKCS004
249500** SPECIFIC COMMAREA.                                           **VNKCS004
249600******************************************************************VNKCS004
249700 5105-REWRITE-ASC-LISTQ.                                          VNKCS004
249800                                                                  VNKCS004
249900     EXEC CICS                                                    VNKCS004
250000         WRITEQ TS                                                VNKCS004
250100             QUEUE (ASC-LIST-QUEUE-NAME)                          VNKCS004
250200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               VNKCS004
250300             ITEM  (PV-BLOCK-NUMBER)                              VNKCS004
250400             REWRITE                                              VNKCS004
250500             RESP  (PV-CICS-RESP)                                 VNKCS004
250600     END-EXEC.                                                    VNKCS004
250700                                                                  VNKCS004
250800     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           VNKCS004
250900         CONTINUE                                                 VNKCS004
251000     ELSE                                                         VNKCS004
251100         SET DP013-CICS-ABEND            TO TRUE                  VNKCS004
251200         SET DP013-NO-ROLLBACK           TO TRUE                  VNKCS004
251300         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       VNKCS004
251400         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     VNKCS004
251500                                         TO DP013-MESSAGE-TEXT(1) VNKCS004
251600         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS004
251700     END-IF.                                                      VNKCS004
251800                                                                  VNKCS004
251900******************************************************************VNKCS004
252000** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **VNKCS004
252100** SPECIFIC COMMAREA.                                           **VNKCS004
252200******************************************************************VNKCS004
252300 5110-WRITE-ASC-LISTQ.                                            VNKCS004
252400                                                                  VNKCS004
252500     EXEC CICS                                                    VNKCS004
252600         WRITEQ TS                                                VNKCS004
252700             QUEUE (ASC-LIST-QUEUE-NAME)                          VNKCS004
252800             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               VNKCS004
252900             ITEM  (PV-BLOCK-NUMBER)                              VNKCS004
253000             RESP  (PV-CICS-RESP)                                 VNKCS004
253100     END-EXEC.                                                    VNKCS004
253200     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      VNKCS004
253300         SET DP013-CICS-ABEND      TO TRUE                        VNKCS004
253400         SET DP013-NO-ROLLBACK     TO TRUE                        VNKCS004
253500         MOVE '5110-WRITE-ASC-LISTQ'                              VNKCS004
253600                                   TO DP013-PARAGRAPH             VNKCS004
253700         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           VNKCS004
253800                                   TO DP013-MESSAGE-TEXT(1)       VNKCS004
253900         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS004
254000     END-IF.                                                      VNKCS004
254100                                                                  VNKCS004
254200*----------------------------------------------------------------*VNKCS004
254300* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *VNKCS004
254400* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *VNKCS004
254500*----------------------------------------------------------------*VNKCS004
254600 5200-FILL-SEL-QUEUE-RECORD.                                      VNKCS004
254700                                                                  VNKCS004
254800     PERFORM 6112-READ-LIST-QUEUE.                                VNKCS004
254900                                                                  VNKCS004
255000     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       VNKCS004
255100         PERFORM                                                  VNKCS004
255200         VARYING LQW-IDX                                          VNKCS004
255300         FROM 1 BY 1                                              VNKCS004
255400         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            VNKCS004
255500           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          VNKCS004
255600                                                                  VNKCS004
255700             IF  LQW-SELECT (LQW-IDX)                             VNKCS004
255800                 SET ASC-UPDATE-TSQ                               VNKCS004
255900                                   TO TRUE                        VNKCS004
256000                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              VNKCS004
256100                                   TO VN003-ITEM (VN003-IDX)      VNKCS004
256200                 MOVE LQW-DEPT-NUMBER (LQW-IDX)                   VNKCS004
256300                                   TO VN003-DEPARTMENT            VNKCS004
256400                                        (VN003-IDX)               VNKCS004
256500                 MOVE LQW-VEND-TYPE   (LQW-IDX)                   VNKCS004
256600                                   TO VN003-VEND-TYPE             VNKCS004
256700                                        (VN003-IDX)               VNKCS004
256800                 MOVE ASC-KEY-ENT-ID                              VNKCS004
256900                                   TO VN003-ENT-ID (VN003-IDX)    VNKCS004
257000                 MOVE SPACE        TO VN003-ACTION-SW (VN003-IDX) VNKCS004
257100                 SET VN003-IDX UP BY 1                            VNKCS004
257200                 IF  VN003-IDX > VN003-MAX-ITEMS                  VNKCS004
257300                     PERFORM 5205-WRITE-SEL-QUEUE                 VNKCS004
257400                     ADD +1        TO VN002-NUMBER-OF-TS-ITEMS    VNKCS004
257500                     INITIALIZE VN003-SELECTED-ITEM-ARRAY         VNKCS004
257600                     SET VN003-IDX TO  1                          VNKCS004
257700                 END-IF                                           VNKCS004
257800             END-IF                                               VNKCS004
257900         END-PERFORM                                              VNKCS004
258000     END-IF.                                                      VNKCS004
258100                                                                  VNKCS004
258200*----------------------------------------------------------------*VNKCS004
258300*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *VNKCS004
258400*----------------------------------------------------------------*VNKCS004
258500 5205-WRITE-SEL-QUEUE.                                            VNKCS004
258600                                                                  VNKCS004
258700     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            VNKCS004
258800                                   TO VN003-SELECTED-ITEMS.       VNKCS004
258900                                                                  VNKCS004
259000     EXEC CICS                                                    VNKCS004
259100          WRITEQ TS                                               VNKCS004
259200              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      VNKCS004
259300              FROM  (VN003-VENDOR-SEL-REC)                        VNKCS004
259400              ITEM  (PV-SEL-QUEUE-ITEM)                           VNKCS004
259500              RESP  (PV-CICS-RESP)                                VNKCS004
259600     END-EXEC.                                                    VNKCS004
259700                                                                  VNKCS004
259800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          VNKCS004
259900         CONTINUE                                                 VNKCS004
260000     ELSE                                                         VNKCS004
260100         SET DP013-CICS-ABEND      TO TRUE                        VNKCS004
260200         SET DP013-NO-ROLLBACK     TO TRUE                        VNKCS004
260300         MOVE '5205-WRITE-SEL-QUEUE'                              VNKCS004
260400                                   TO DP013-PARAGRAPH             VNKCS004
260500         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          VNKCS004
260600                                   TO DP013-MESSAGE-TEXT(1)       VNKCS004
260700         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS004
260800     END-IF.                                                      VNKCS004
260900 EJECT                                                            VNKCS004
261000******************************************************************VNKCS004
261100** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **VNKCS004
261200** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **VNKCS004
261300** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **VNKCS004
261400** THE USER.                                                    **VNKCS004
261500******************************************************************VNKCS004
261600 6000-REFRESH-PANEL-FROM-TEMP.                                    VNKCS004
261700                                                                  VNKCS004
261800     IF  ASC-UPDATE-TSQ                                           VNKCS004
261900         SET ASC-NO-TSQ-UPDATE TO TRUE                            VNKCS004
262000         MOVE ZERO                 TO PV-SAVE-ITEM                VNKCS004
262100                                      PV-SEL-QUEUE-ITEM           VNKCS004
262200         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        VNKCS004
262300                                   TO PV-HOLD-SELECTED-ITEMS      VNKCS004
262400         PERFORM 6100-UPDATE-TSQ                                  VNKCS004
262500             UNTIL PV-ITEMS-PROCESSED >                           VNKCS004
262600                                     ASC-NUMBER-OF-SELECTED-ITEMS VNKCS004
262700         PERFORM 6010-DELETE-SEL-QUEUE                            VNKCS004
262800         INITIALIZE ASC-BLOCK-ENTRIES (1)                         VNKCS004
262900                    ASC-BLOCK-ENTRIES (2)                         VNKCS004
263000     END-IF.                                                      VNKCS004
263100                                                                  VNKCS004
263200*----------------------------------------------------------------*VNKCS004
263300*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *VNKCS004
263400*----------------------------------------------------------------*VNKCS004
263500 6010-DELETE-SEL-QUEUE.                                           VNKCS004
263600                                                                  VNKCS004
263700     EXEC CICS                                                    VNKCS004
263800         DELETEQ TS                                               VNKCS004
263900             QUEUE (ASC-SEL-QUEUE-NAME-OUT)                       VNKCS004
264000             RESP  (PV-CICS-RESP)                                 VNKCS004
264100     END-EXEC.                                                    VNKCS004
264200                                                                  VNKCS004
264300     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      VNKCS004
264400        (PV-CICS-RESP = DFHRESP(QIDERR)))                         VNKCS004
264500         CONTINUE                                                 VNKCS004
264600     ELSE                                                         VNKCS004
264700         SET DP013-CICS-ABEND TO TRUE                             VNKCS004
264800         SET DP013-NO-ROLLBACK TO TRUE                            VNKCS004
264900         MOVE '6010-DELETE-SEL-QUEUE'                             VNKCS004
265000                        TO DP013-PARAGRAPH                        VNKCS004
265100         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         VNKCS004
265200                        TO DP013-MESSAGE-TEXT (1)                 VNKCS004
265300         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS004
265400     END-IF.                                                      VNKCS004
265500                                                                  VNKCS004
265600*----------------------------------------------------------------*VNKCS004
265700*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *VNKCS004
265800*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *VNKCS004
265900*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *VNKCS004
266000*    THE TEMP QUEUE.                                             *VNKCS004
266100*----------------------------------------------------------------*VNKCS004
266200 6100-UPDATE-TSQ.                                                 VNKCS004
266300                                                                  VNKCS004
266400     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             VNKCS004
266500     PERFORM 6105-READ-SEL-QUEUE.                                 VNKCS004
266600     PERFORM                                                      VNKCS004
266700         VARYING VN003-IDX                                        VNKCS004
266800         FROM 1 BY 1                                              VNKCS004
266900         UNTIL ((PV-ITEMS-PROCESSED >                             VNKCS004
267000                              PV-HOLD-SELECTED-ITEMS)             VNKCS004
267100         OR (VN003-IDX GREATER THAN VN003-MAX-ITEMS))             VNKCS004
267200         IF  VN003-ACTION-SW (VN003-IDX) > SPACE                  VNKCS004
267300             PERFORM 6110-PROCESS-ITEMS                           VNKCS004
267400         END-IF                                                   VNKCS004
267500         ADD +1                TO PV-ITEMS-PROCESSED              VNKCS004
267600     END-PERFORM.                                                 VNKCS004
267700                                                                  VNKCS004
267800     PERFORM 6111-WRITE-LIST-QUEUE.                               VNKCS004
267900                                                                  VNKCS004
268000*----------------------------------------------------------------*VNKCS004
268100*    READ THE LIST QUEUE RECORD.                                 *VNKCS004
268200*----------------------------------------------------------------*VNKCS004
268300 6105-READ-SEL-QUEUE.                                             VNKCS004
268400                                                                  VNKCS004
268500     EXEC CICS                                                    VNKCS004
268600          READQ TS                                                VNKCS004
268700              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      VNKCS004
268800              INTO  (VN003-VENDOR-SEL-REC)                        VNKCS004
268900              ITEM  (PV-SEL-QUEUE-ITEM)                           VNKCS004
269000              RESP  (PV-CICS-RESP)                                VNKCS004
269100     END-EXEC.                                                    VNKCS004
269200                                                                  VNKCS004
269300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          VNKCS004
269400         CONTINUE                                                 VNKCS004
269500     ELSE                                                         VNKCS004
269600         SET DP013-CICS-ABEND      TO  TRUE                       VNKCS004
269700         SET DP013-NO-ROLLBACK     TO  TRUE                       VNKCS004
269800         MOVE '6105-READ-SEL-QUEUE'                               VNKCS004
269900                                   TO  DP013-PARAGRAPH            VNKCS004
270000         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           VNKCS004
270100                                   TO  DP013-MESSAGE-TEXT(1)      VNKCS004
270200         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS004
270300     END-IF.                                                      VNKCS004
270400                                                                  VNKCS004
270500*----------------------------------------------------------------*VNKCS004
270600*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*VNKCS004
270700*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*VNKCS004
270800*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *VNKCS004
270900*----------------------------------------------------------------*VNKCS004
271000 6110-PROCESS-ITEMS.                                              VNKCS004
271100                                                                  VNKCS004
271200     COMPUTE PV-ITEM = 1 + ((VN003-ITEM (VN003-IDX) - 1)          VNKCS004
271300                     / PC-ITEMS-PER-PANEL).                       VNKCS004
271400                                                                  VNKCS004
271500     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           VNKCS004
271600         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          VNKCS004
271700             PERFORM 6111-WRITE-LIST-QUEUE                        VNKCS004
271800         END-IF                                                   VNKCS004
271900         MOVE PV-ITEM          TO PV-SAVE-ITEM                    VNKCS004
272000                                                                  VNKCS004
272100         PERFORM 6112-READ-LIST-QUEUE                             VNKCS004
272200         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               VNKCS004
272300             CONTINUE                                             VNKCS004
272400         END-IF                                                   VNKCS004
272500     END-IF.                                                      VNKCS004
272600                                                                  VNKCS004
272700     COMPUTE PV-SUB = (VN003-ITEM (VN003-IDX)                     VNKCS004
272800                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              VNKCS004
272900     SET LQW-DESELECT (PV-SUB) TO    TRUE                         VNKCS004
273000     MOVE LQW-SELECTED-SW (PV-SUB)                                VNKCS004
273100                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  VNKCS004
273200     EVALUATE TRUE                                                VNKCS004
273300         WHEN VN003-INQ (VN003-IDX)                               VNKCS004
273400              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             VNKCS004
273500                                                                  VNKCS004
273600         WHEN VN003-UPD (VN003-IDX)                               VNKCS004
273700              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             VNKCS004
273800                                                                  VNKCS004
273900         WHEN VN003-DEL (VN003-IDX)                               VNKCS004
274000              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             VNKCS004
274100                                                                  VNKCS004
274200         WHEN VN003-ERR (VN003-IDX)                               VNKCS004
274300              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             VNKCS004
274400     END-EVALUATE.                                                VNKCS004
274500                                                                  VNKCS004
274600     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                VNKCS004
274700                                                                  VNKCS004
274800*----------------------------------------------------------------*VNKCS004
274900*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *VNKCS004
275000*----------------------------------------------------------------*VNKCS004
275100 6111-WRITE-LIST-QUEUE.                                           VNKCS004
275200                                                                  VNKCS004
275300     EXEC CICS                                                    VNKCS004
275400         WRITEQ TS                                                VNKCS004
275500             QUEUE (ASC-LIST-QUEUE-NAME)                          VNKCS004
275600             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     VNKCS004
275700             ITEM  (PV-SAVE-ITEM)                                 VNKCS004
275800             REWRITE                                              VNKCS004
275900             RESP  (PV-CICS-RESP)                                 VNKCS004
276000     END-EXEC.                                                    VNKCS004
276100                                                                  VNKCS004
276200     IF  PV-CICS-RESP = DFHRESP (NORMAL) OR                       VNKCS004
276300         PV-CICS-RESP = DFHRESP (ITEMERR)                         VNKCS004
276400         CONTINUE                                                 VNKCS004
276500     ELSE                                                         VNKCS004
276600         SET DP013-CICS-ABEND  TO  TRUE                           VNKCS004
276700         SET DP013-NO-ROLLBACK TO  TRUE                           VNKCS004
276800         MOVE '6111-WRITE-LIST-QUEUE'                             VNKCS004
276900                               TO  DP013-PARAGRAPH                VNKCS004
277000         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  VNKCS004
277100                               TO  DP013-MESSAGE-TEXT(1)          VNKCS004
277200         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS004
277300     END-IF.                                                      VNKCS004
277400                                                                  VNKCS004
277500*----------------------------------------------------------------*VNKCS004
277600*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*VNKCS004
277700*----------------------------------------------------------------*VNKCS004
277800 6112-READ-LIST-QUEUE.                                            VNKCS004
277900                                                                  VNKCS004
278000     EXEC CICS                                                    VNKCS004
278100         READQ TS                                                 VNKCS004
278200             QUEUE (ASC-LIST-QUEUE-NAME)                          VNKCS004
278300             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     VNKCS004
278400             ITEM  (PV-ITEM)                                      VNKCS004
278500             RESP  (PV-CICS-RESP)                                 VNKCS004
278600     END-EXEC.                                                    VNKCS004
278700                                                                  VNKCS004
278800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          VNKCS004
278900         CONTINUE                                                 VNKCS004
279000     ELSE                                                         VNKCS004
279100         SET DP013-CICS-ABEND        TO TRUE                      VNKCS004
279200         SET DP013-NO-ROLLBACK       TO TRUE                      VNKCS004
279300         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           VNKCS004
279400         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    VNKCS004
279500                                     TO DP013-MESSAGE-TEXT(1)     VNKCS004
279600         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS004
279700     END-IF.                                                      VNKCS004
279800                                                                  VNKCS004
279900******************************************************************VNKCS004
280000* DELETE THE LIST QUEUE WHEN PREV-SEL OR NEXT-SEL WAS ENTERED.   *VNKCS004
280100******************************************************************VNKCS004
280200 6200-DEL-LIST-QUEUE.                                             VNKCS004
280300                                                                  VNKCS004
280400     EXEC CICS                                                    VNKCS004
280500         DELETEQ TS                                               VNKCS004
280600             QUEUE (ASC-LIST-QUEUE-NAME)                          VNKCS004
280700             RESP  (PV-CICS-RESP)                                 VNKCS004
280800     END-EXEC.                                                    VNKCS004
280900                                                                  VNKCS004
281000     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      VNKCS004
281100        (PV-CICS-RESP = DFHRESP(QIDERR)))                         VNKCS004
281200         CONTINUE                                                 VNKCS004
281300     ELSE                                                         VNKCS004
281400        SET DP013-CICS-ABEND       TO TRUE                        VNKCS004
281500        SET DP013-NO-ROLLBACK      TO TRUE                        VNKCS004
281600        MOVE '6200-DEL-LIST-QUEUE' TO DP013-PARAGRAPH             VNKCS004
281700        MOVE 'ERROR TRYING TO DELETE LIST TS QUEUE'               VNKCS004
281800                                   TO DP013-MESSAGE-TEXT (1)      VNKCS004
281900        PERFORM DP013-0000-PROCESS-ABEND                          VNKCS004
282000     END-IF.                                                      VNKCS004
282100                                                                  VNKCS004
282200******************************************************************VNKCS004
282300* READ AN ITEM FROM THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *VNKCS004
282400******************************************************************VNKCS004
282500 9100-READ-SEL-QUEUE.                                             VNKCS004
282600                                                                  VNKCS004
282700     EXEC CICS                                                    VNKCS004
282800         READQ TS                                                 VNKCS004
282900             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        VNKCS004
283000             INTO  (VN003-VENDOR-SEL-REC)                         VNKCS004
283100             ITEM  (ASC-SEL-ITEM)                                 VNKCS004
283200             RESP  (PV-CICS-RESP)                                 VNKCS004
283300     END-EXEC.                                                    VNKCS004
283400                                                                  VNKCS004
283500     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        VNKCS004
283600         CONTINUE                                                 VNKCS004
283700     ELSE                                                         VNKCS004
283800         SET DP013-LOGIC-ABEND                                    VNKCS004
283900             DP013-NO-ROLLBACK     TO TRUE                        VNKCS004
284000         MOVE '9100-READ-SEL-QUEUE'                               VNKCS004
284100                                   TO DP013-PARAGRAPH             VNKCS004
284200         MOVE 'ATTEMPTING TO READ TO LIST SELECTIONS TS QUEUE'    VNKCS004
284300                                   TO DP013-MESSAGE-TEXT (1)      VNKCS004
284400         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS004
284500     END-IF.                                                      VNKCS004
284600                                                                  VNKCS004
284700******************************************************************VNKCS004
284800* UPDATE AN ITEM IN THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *VNKCS004
284900******************************************************************VNKCS004
285000 9200-REWRITE-LIST-QUEUE.                                         VNKCS004
285100                                                                  VNKCS004
285200     EXEC CICS                                                    VNKCS004
285300          WRITEQ TS                                               VNKCS004
285400              QUEUE   (ASC-SEL-QUEUE-NAME-IN)                     VNKCS004
285500              FROM    (VN003-VENDOR-SEL-REC)                      VNKCS004
285600              ITEM    (ASC-SEL-ITEM)                              VNKCS004
285700              RESP    (PV-CICS-RESP)                              VNKCS004
285800              REWRITE                                             VNKCS004
285900     END-EXEC.                                                    VNKCS004
286000                                                                  VNKCS004
286100     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    VNKCS004
286200         SET DP013-CICS-ABEND                                     VNKCS004
286300             DP013-NO-ROLLBACK     TO TRUE                        VNKCS004
286400         MOVE '9200-REWRITE-LIST-QUEUE'                           VNKCS004
286500                                   TO DP013-PARAGRAPH             VNKCS004
286600         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   VNKCS004
286700                                   TO DP013-MESSAGE-TEXT (1)      VNKCS004
286800         PERFORM DP013-0000-PROCESS-ABEND                         VNKCS004
286900     END-IF.                                                      VNKCS004
287000                                                                  VNKCS004
287100*----------------------------------------------------------------*VNKCS004
287200*    ABEND PROCESSOR MODULE                                      *VNKCS004
287300*----------------------------------------------------------------*VNKCS004
287400     COPY DPPD013.                                                VNKCS004
287500*----------------------------------------------------------------*   CL*35
