000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    AHKUT073.                                         00020000
000300 AUTHOR.        DENISE HAHN.                                      00030000
000400 INSTALLATION.  KOHLS.                                            00040000
000500 DATE-WRITTEN   APRIL, 2020                                       00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800******************************************************************00080000
000900*   AHKUT073.  ARCHIVE HISTORY EXTRACT PROGRAM:  RCT_RECDIS_ORIG *00090000
001000*                                                                *00100000
001100*   PURPOSE:                                                     *00110000
001200*   THIS PROGRAM CREATES AN EXTRACT FILE FROM: RCT_RECDIS_ORIG   *00120000
001300*   THIS EXTRACT FILE CONSISTS OF ROWS ELIGIBLE TO BE            *00130000
001400*   DELETED FROM THE OPERATIONAL VERSIONS OF THE TABLES.         *00140000
001500*                                                                *00150000
001600*   PROCESSING OVERVIEW:                                         *00160000
001700*   THIS PROGRAM READS A "DRIVER" FILE. FOR EACH RECORD READ,    *00170000
001800*   1) INCREMENT COUNT OF RECORDS READ.                          *00180000
001900*   2) ATTEMPT TO FIND RELATED ROW(S) ON THE TABLE.              *00190000
002000*      2.A) IF NO MATCH(ES):                                     *00200000
002100*           2.A.1) PROCESSING CONTINUES                          *00210000
002200*      2.B) IF MATCH(ES):                                        *00220000
002300*           2.B.1) INCREMENT COUNT OF ROW(S) FOUND.              *00230000
002400*           2.B.2) WRITE THESE ROW(S) TO THE EXTRACT FILE.       *00240000
002500*           2.B.3) INCREMENT COUNT OF RECORDS WRITTEN.           *00250000
002600*           2.B.4) DO NOT REMOVE THE ROW(S) FROM THE TABLE       *00260000
002700*                  AT THIS TIME.  THEY WILL BE REMOVED IN OTHER  *00270000
002800*                  PROCESSING, BY AHKUP073.                      *00280000
002900*   3) EVERY NTH RECORD (IE: INITIAL SETTING 5000), REPORT       *00290000
003000*      RECORD COUNT AND CURRENT DATE/TIME.  THIS WILL ASSIST     *00300000
003100*      WITH RUN-TIME ESTIMATE OF TIME REMAINING TO COMPLETE.     *00310000
003200* ************************************************************** *00320000
003300 ENVIRONMENT DIVISION.                                            00330000
003400 CONFIGURATION SECTION.                                           00340000
003500 SOURCE-COMPUTER.        IBM-3090.                                00350000
003600 OBJECT-COMPUTER.        IBM-3090.                                00360000
003700                                                                  00370000
003800 INPUT-OUTPUT SECTION.                                            00380000
003900 FILE-CONTROL.                                                    00390000
004000                                                                  00400000
004100     SELECT IN-DRIVER-FILE                ASSIGN TO IN01.         00410000
004200     SELECT OUT-EXTRACT-FILE              ASSIGN TO OUT01.        00420000
004300                                                                  00430000
004400******************************************************************00440000
004500 DATA DIVISION.                                                   00450000
004600 FILE SECTION.                                                    00460000
004700                                                                  00470000
004800 FD  IN-DRIVER-FILE                                               00480000
004900     RECORDING MODE IS F                                          00490000
005000     LABEL RECORDS ARE STANDARD                                   00500000
005100     BLOCK CONTAINS 0 RECORDS.                                    00510000
005200 01  IN-DRIVER-RECORD                PIC  X(004).                 00520000
005300                                                                  00530000
005400**** RCT_RECDIS_ORIG ****                                         00540000
005500 FD  OUT-EXTRACT-FILE                                             00550000
005600     RECORDING MODE IS F                                          00560000
005700     LABEL RECORDS ARE STANDARD                                   00570000
005800     BLOCK CONTAINS 0 RECORDS.                                    00580000
005900 01  OUT-EXTRACT-RECORD              PIC  X(50).                  00590001
006000                                                                  00600000
006100                                                                  00610000
006200                                                                  00620000
006300 WORKING-STORAGE SECTION.                                         00630000
006400                                                                  00640000
006500 01  PC-PROGRAM-CONSTANTS.                                        00650000
006600     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'AHKUT073'.  00660000
006700     05  PC-PGM-PROGRESS-DESC.                                    00670000
006800         10  PC-BEGINNING            PIC X(09) VALUE 'BEGINNING'. 00680000
006900         10  PC-CONTINUING           PIC X(10) VALUE              00690000
007000                                               'CONTINUING'.      00700000
007100         10  PC-ENDING               PIC X(06) VALUE 'ENDING'.    00710000
007200         10  PC-ABENDING             PIC X(08) VALUE 'ABENDING'.  00720000
007300     05  PC-ABEND-INFO.                                           00730000
007400         10  PC-ABEND                PIC X(11) VALUE              00740000
007500                                               '** ABEND **'.     00750000
007600         10  PC-ABEND-MSG-PARA       PIC X(15) VALUE              00760000
007700                                               '- PARA       : '. 00770000
007800         10  PC-ABEND-MSG-DISPLAY-PARA                            00780000
007900                                     PIC X(15) VALUE              00790000
008000                                               '  CALLED PARA: '. 00800000
008100         10  PC-ABEND-MSG-NUMBER     PIC X(15) VALUE              00810000
008200                                               '  FOR ABEND# : '. 00820000
008300         10  PC-ABEND-MSG-DESC       PIC X(15) VALUE              00830000
008400                                               '- ERROR IS   : '. 00840000
008500         10  PC-ABEND-MSG-INDENT-15  PIC X(15) VALUE SPACES.      00850000
008600         10  PC-ABEND-MSG-ACTION     PIC X(15) VALUE              00860000
008700                                               '- ACTION     : '. 00870000
008800     05  PC-HOW-OFTEN-TO-DISPLAY     PIC 9(9)  VALUE 5000.        00880000
008900                                                                  00890000
009000 01  PS-PROGRAM-SWITCHES.                                         00900000
009100     05  PS-IN-DRIVER-EOF-SW         PIC X(01) VALUE 'N'.         00910000
009200         88  PS-IN-DRIVER-EOF                  VALUE 'Y'.         00920000
009300         88  PS-IN-DRIVER-NOT-EOF              VALUE 'N'.         00930000
009400     05  PS-CURSOR-HAS-DATA-SW       PIC X(01) VALUE 'N'.         00940000
009500         88  PS-CURSOR-HAS-DATA                VALUE 'Y'.         00950000
009600         88  PS-CURSOR-HAS-NO-DATA             VALUE 'N'.         00960000
009700     05  PS-TABLE-LOOP-DONE-SW       PIC X(01) VALUE 'N'.         00970000
009800         88  PS-TABLE-LOOP-DONE                VALUE 'Y'.         00980000
009900         88  PS-TABLE-LOOP-NOT-DONE            VALUE 'N'.         00990000
010000                                                                  01000000
010100 01  PV-PROGRAM-VARIABLES.                                        01010000
010200     05  PV-PO-NBR-COMP              PIC S9(9) VALUE 0 COMP.      01020000
010300     05  PV-PO-NBR-NUM               PIC  9(9) VALUE 0.           01030000
010400     05  PV-IN-DRIVER-RECS-READ-CNT  PIC  9(9) VALUE 0.           01040000
010500     05  PV-RECS-WITH-MATCHES-CNT    PIC  9(9) VALUE 0.           01050000
010600     05  PV-TABLE-ROW-SELECT-CNT     PIC  9(9) VALUE 0.           01060000
010700     05  PV-EXTRACT-WRITTEN-CNT      PIC  9(9) VALUE 0.           01070000
010800                                                                  01080000
010900     05  PV-PARAGRAPH-NAME           PIC X(30) VALUE SPACES.      01090000
011000     05  PV-DB2-OPERATION-MSG-1      PIC X(79) VALUE SPACES.      01100000
011100     05  PV-DB2-TABLE-NAME           PIC X(18) VALUE SPACES.      01110000
011200     05  PV-DISPLAY-NTH-MULTIPLE     PIC 9(9)  VALUE 0.           01120000
011300     05  PV-DISPLAY-NTH-REMAINDER    PIC 9(9)  VALUE 0.           01130000
011400     05  PV-SQLCODE                  PIC +999  VALUE ZERO.        01140000
011500                                                                  01150000
011600     05  PV-TMST                     PIC X(26) VALUE SPACES.      01160000
011700     05  PV-TIMESTAMP-DETAIL                                      01170000
011800         REDEFINES                                                01180000
011900         PV-TMST.                                                 01190000
012000         10  PV-TIMESTAMP-19.                                     01200000
012100             15  PV-TMS-DATE.                                     01210000
012200                 20  PV-TMS-YEAR.                                 01220000
012300                     25  PV-TMS-CC   PIC X(02).                   01230000
012400                     25  PV-TMS-YY   PIC X(02).                   01240000
012500                 20  FILLER          PIC X(01).                   01250000
012600                 20  PV-TMS-MONTH    PIC X(02).                   01260000
012700                 20  FILLER          PIC X(01).                   01270000
012800                 20  PV-TMS-DAY      PIC X(02).                   01280000
012900             15  FILLER              PIC X(01).                   01290000
013000             15  PV-TMS-HOUR         PIC X(02).                   01300000
013100             15  FILLER              PIC X(01).                   01310000
013200             15  PV-TMS-MINUTE       PIC X(02).                   01320000
013300             15  FILLER              PIC X(01).                   01330000
013400             15  PV-TMS-SECOND       PIC X(02).                   01340000
013500         10  FILLER                  PIC X(01).                   01350000
013600         10  PV-TMS-MSECOND          PIC X(06).                   01360000
013700                                                                  01370000
013800 01  DM-DISPLAY-MESSAGE.                                          01380000
013900     05  DM-01-10.                                                01390000
014000         10  DM-PROGRAM              PIC X(08) VALUE SPACE.       01400000
014100         10  FILLER                  PIC X(02) VALUE ': '.        01410000
014200     05  DM-11-80.                                                01420000
014300         10  FILLER                  PIC X(37) VALUE              01430000
014400                        'SELECT ROWS MATCHING PO DRIVER FILE, '.  01440000
014500         10  FILLER                  PIC X(38) VALUE              01450003
014600                        'CREATING RCT_RECDIS_ORIG EXTRACT FILE.'. 01460000
014700         10  FILLER                  PIC X(01) VALUE SPACE.       01470000
014800         10  FILLER                  PIC X(01) VALUE ALL '*'.     01480000
014900     05  DM-81-120.                                               01490000
015000         10  FILLER                  PIC X(40) VALUE ALL '*'.     01500000
015100                                                                  01510000
015200 01  DP-DISPLAY-PROGRESS-MSG.                                     01520000
015300     05  DP-PROGRAM                  PIC X(08) VALUE SPACE.       01530000
015400     05  FILLER                      PIC X(02) VALUE SPACE.       01540000
015500     05  DP-STATUS-DESCRIPTION       PIC X(10) VALUE SPACE.       01550000
015600     05  FILLER                      PIC X(04) VALUE ' AT '.      01560000
015700     05  DP-TIMESTAMP-19             PIC X(19) VALUE SPACE.       01570000
015800     05  FILLER                      PIC X(03) VALUE '.  '.       01580000
015900     05  FILLER                      PIC X(03) VALUE              01590000
016000                                         'IN:'.                   01600000
016100     05  DP-IN-CNT                   PIC ZZZ,ZZZ,ZZ9              01610000
016200                                               VALUE ZERO.        01620000
016300     05  FILLER                      PIC X(02) VALUE ', '.        01630000
016400     05  FILLER                      PIC X(14) VALUE              01640000
016500                                         'ROWS SELECTED:'.        01650000
016600     05  DP-ROWS-SELECTED-CNT        PIC ZZZ,ZZZ,ZZ9              01660000
016700                                               VALUE ZERO.        01670000
016800     05  FILLER                      PIC X(02) VALUE ', '.        01680000
016900     05  FILLER                      PIC X(04) VALUE              01690000
017000                                         'OUT:'.                  01700000
017100     05  DP-OUT-CNT                  PIC ZZZ,ZZZ,ZZ9              01710000
017200                                               VALUE ZERO.        01720000
017300     05  FILLER                      PIC X(01) VALUE '.'.         01730000
017400                                                                  01740000
017500 01  ABEND-CODE                      PIC S9(04)                   01750000
017600                                               VALUE ZEROES       01760000
017700                                               COMP SYNC.         01770000
017800                                                                  01780000
017900*---------------------------------------------------------------* 01790000
018000*  DB2 FORMATTED MESSAGE AREA                                     01800000
018100*---------------------------------------------------------------* 01810000
018200     COPY DPWS004.                                                01820000
018300                                                                  01830000
018400                                                                  01840000
018500*---------------------------------------------------------------* 01850000
018600*  AHRD002  - RECORD LAYOUT FOR PO DRIVER FILE, INPUT.          * 01860000
018700*---------------------------------------------------------------* 01870000
018800     COPY AHRD002.                                                01880000
018900                                                                  01890000
019000                                                                  01900000
019100*---------------------------------------------------------------* 01910000
019200*    DB2 AREA FOR RCT_RECDIS_ORIG                               * 01920000
019300*---------------------------------------------------------------* 01930000
019400     EXEC SQL                                                     01940000
019500          INCLUDE RCT00013                                        01950000
019600     END-EXEC.                                                    01960000
019700                                                                  01970000
019800*---------------------------------------------------------------* 01980000
019900*    DB2 AREA FOR COMMUNICATIONS                                * 01990000
020000*---------------------------------------------------------------* 02000000
020100     EXEC SQL                                                     02010000
020200          INCLUDE SQLCA                                           02020000
020300     END-EXEC.                                                    02030000
020400                                                                  02040000
020500*---------------------------------------------------------------* 02050000
020600*    DEFINE CURSOR FOR RCT_RECDIS_ORIG"                         * 02060000
020700*    PULL ALL AVAILABLE COLUMNS, SO EXTRACT FILE WILL CONTAIN   * 02070000
020800*    ALL DATA TO BE ARCHIVED BY AHKUP073                        * 02080000
020900*---------------------------------------------------------------* 02090000
021000     EXEC SQL                                                     02100000
021100          DECLARE TABLE-CURSOR CURSOR FOR                         02110000
021200           SELECT ORD_NBR                                         02120000
021300                 ,ORD_LNE_NBR                                     02130000
021400                 ,REC_SEQ_NBR                                     02140000
021500                 ,OPER_UNT_ID                                     02150000
021600                 ,FCLTY_ID                                        02160000
021700                 ,STR_NBR                                         02170002
021800                 ,STR_FCLTY_ID                                    02180002
021900                 ,ORIG_EXPTED_QTY                                 02190002
022000                 ,CRE_TMST                                        02200002
022200           FROM   RCT_RECDIS_ORIG                                 02220005
022300          WHERE   ORD_NBR = :PV-PO-NBR-COMP                       02230000
022400           WITH  UR                                               02240000
022500     END-EXEC.                                                    02250000
022600                                                                  02260000
022700                                                                  02270000
022800 PROCEDURE DIVISION.                                              02280000
022900********************                                              02290000
023000                                                                  02300000
023100 0000-PROGRAM-MAINLINE.                                           02310000
023200                                                                  02320000
023300     PERFORM 1000-INITIALIZE.                                     02330000
023400                                                                  02340000
023500     SET PS-IN-DRIVER-NOT-EOF TO TRUE.                            02350000
023600     PERFORM 2000-PROCESS-DRIVER-FILE                             02360000
023700         UNTIL PS-IN-DRIVER-EOF.                                  02370000
023800                                                                  02380000
023900     PERFORM 9090-CLOSE-FILES.                                    02390000
024000                                                                  02400000
024100     MOVE PC-ENDING                 TO DP-STATUS-DESCRIPTION.     02410000
024200     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           02420000
024300                                                                  02430000
024400     STOP RUN.                                                    02440000
024500                                                                  02450000
024600                                                                  02460000
024700******************************************************************02470000
024800*                                                                *02480000
024900******************************************************************02490000
025000 1000-INITIALIZE.                                                 02500000
025100                                                                  02510000
025200     MOVE PC-CURRENT-PROGRAM-NAME TO DM-PROGRAM.                  02520000
025300     DISPLAY DM-DISPLAY-MESSAGE.                                  02530000
025400                                                                  02540000
025500     MOVE PC-BEGINNING              TO DP-STATUS-DESCRIPTION.     02550000
025600     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           02560000
025700                                                                  02570000
025800     OPEN  INPUT  IN-DRIVER-FILE.                                 02580000
025900     OPEN OUTPUT OUT-EXTRACT-FILE.                                02590000
026000                                                                  02600000
026100                                                                  02610000
026200******************************************************************02620000
026300*   1) GET NEXT RECORD FROM DRIVER FILE, AND                     *02630000
026400*      1A- POPULATE KEY (WHERE CLAUSE) FOR TABLE CURSOR          *02640000
026500*      1B- OPEN TABLE CURSOR                                     *02650000
026600*      1C- LOOP THRU TABLE CURSOR TO EXTRACT ALL                 *02660000
026700*          ROWS FOR THIS INPUT DRIVER RECORD                     *02670000
026800*      2) FOR EACH ROW,                                          *02680000
026900*         2A- INCREMENT COUNTS                                   *02690000
027000*         2B- WRITE EXTRACT RECORD                               *02700000
027100*      1D- CLOSE TABLE CURSOR                                    *02710000
027200******************************************************************02720000
027300 2000-PROCESS-DRIVER-FILE.                                        02730000
027400                                                                  02740000
027500     PERFORM 9050-READ-IN-DRIVER-FILE.                            02750000
027600     IF PS-IN-DRIVER-EOF                                          02760000
027700         CONTINUE                                                 02770000
027800     ELSE                                                         02780000
027900         MOVE AH002-PO-NBR TO         PV-PO-NBR-COMP              02790000
028000                                      PV-PO-NBR-NUM               02800000
028100         PERFORM 2100-CHECK-PGM-PROGRESS                          02810000
028200         SET PS-TABLE-LOOP-NOT-DONE   TO TRUE                     02820000
028300         SET PS-CURSOR-HAS-NO-DATA    TO TRUE                     02830000
028400         PERFORM 9100-OPEN-TABLE-CURSOR                           02840000
028500         PERFORM 3000-EXTRACT-ROWS-FROM-TABLE                     02850000
028600             UNTIL PS-TABLE-LOOP-DONE                             02860000
028700         PERFORM 9190-CLOSE-TABLE-CURSOR                          02870000
028800     END-IF.                                                      02880000
028900                                                                  02890000
029000                                                                  02900000
029100******************************************************************02910000
029200*      EVERY NTH RECORD (IE: INITIAL SETTING 1000), REPORT       *02920000
029300*      RECORD COUNT AND CURRENT DATE/TIME.  THIS WILL ASSIST     *02930000
029400*      WITH RUN-TIME ESTIMATE OF TIME REMAINING TO COMPLETE.     *02940000
029500******************************************************************02950000
029600 2100-CHECK-PGM-PROGRESS.                                         02960000
029700     DIVIDE    PV-IN-DRIVER-RECS-READ-CNT                         02970000
029800         BY        PC-HOW-OFTEN-TO-DISPLAY                        02980000
029900         GIVING    PV-DISPLAY-NTH-MULTIPLE                        02990000
030000         REMAINDER PV-DISPLAY-NTH-REMAINDER.                      03000000
030100                                                                  03010000
030200     IF PV-DISPLAY-NTH-REMAINDER = ZERO                           03020000
030300         MOVE PC-CONTINUING         TO DP-STATUS-DESCRIPTION      03030000
030400         PERFORM 6200-DISPLAY-PGM-PROGRESS                        03040000
030500     END-IF.                                                      03050000
030600                                                                  03060000
030700                                                                  03070000
030800******************************************************************03080000
030900*   EXTRACT ROWS FROM TABLE, FOR THE CURRENT DRIVER RECORD       *03090000
031000******************************************************************03100000
031100 3000-EXTRACT-ROWS-FROM-TABLE.                                    03110000
031200     INITIALIZE DCLRCT00013.                                      03120000
031300     PERFORM 9150-FETCH-TABLE-CURSOR.                             03130000
031400     IF PS-TABLE-LOOP-DONE                                        03140000
031500         CONTINUE                                                 03150000
031600     ELSE                                                         03160000
031700         PERFORM 9750-WRITE-EXTRACT-RECORD                        03170000
031800     END-IF.                                                      03180000
031900                                                                  03190000
032000                                                                  03200000
032100******************************************************************03210000
032200*   DISPLAY PROGRAM PROGRESS.                                    *03220000
032300******************************************************************03230000
032400 6200-DISPLAY-PGM-PROGRESS.                                       03240000
032500                                                                  03250000
032600     EXEC SQL                                                     03260000
032700          SET :PV-TMST = CURRENT TIMESTAMP                        03270000
032800     END-EXEC.                                                    03280000
032900                                                                  03290000
033000     MOVE PC-CURRENT-PROGRAM-NAME   TO DP-PROGRAM.                03300000
033100     MOVE PV-TIMESTAMP-19           TO DP-TIMESTAMP-19.           03310000
033200     MOVE PV-IN-DRIVER-RECS-READ-CNT                              03320000
033300                                    TO DP-IN-CNT.                 03330000
033400*    MOVE PV-RECS-WITH-MATCHES-CNT  TO DP-MATCHES-FOUND-CNT.      03340000
033500     MOVE PV-TABLE-ROW-SELECT-CNT   TO DP-ROWS-SELECTED-CNT.      03350000
033600     MOVE PV-EXTRACT-WRITTEN-CNT    TO DP-OUT-CNT.                03360000
033700                                                                  03370000
033800     DISPLAY DP-DISPLAY-PROGRESS-MSG.                             03380000
033900                                                                  03390000
034000                                                                  03400000
034100******************************************************************03410000
034200*   READ  INPUT DRIVER FILE OF ELIGIBLE DATA TO EXTRACT          *03420000
034300******************************************************************03430000
034400 9050-READ-IN-DRIVER-FILE.                                        03440000
034500     READ IN-DRIVER-FILE                                          03450000
034600          INTO AH002-DRIVER-RECORD-LAYOUT                         03460000
034700          AT END                                                  03470000
034800              SET PS-IN-DRIVER-EOF TO TRUE.                       03480000
034900                                                                  03490000
035000     IF PS-IN-DRIVER-EOF                                          03500000
035100         CONTINUE                                                 03510000
035200     ELSE                                                         03520000
035300         ADD +1 TO PV-IN-DRIVER-RECS-READ-CNT                     03530000
035400     END-IF.                                                      03540000
035500                                                                  03550000
035600                                                                  03560000
035700******************************************************************03570000
035800*   CLOSE INPUT DRIVER FILE                                      *03580000
035900******************************************************************03590000
036000 9090-CLOSE-FILES.                                                03600000
036100     CLOSE IN-DRIVER-FILE.                                        03610000
036200     CLOSE OUT-EXTRACT-FILE.                                      03620000
036300                                                                  03630000
036400                                                                  03640000
036500******************************************************************03650000
036600*   OPEN  TABLE CURSOR                                           *03660000
036700******************************************************************03670000
036800 9100-OPEN-TABLE-CURSOR.                                          03680000
036900     EXEC SQL                                                     03690000
037000          OPEN TABLE-CURSOR                                       03700000
037100     END-EXEC.                                                    03710000
037200                                                                  03720000
037300     EVALUATE TRUE                                                03730000
037400         WHEN SQLCODE = ZERO                                      03740000
037500              ADD +1 TO PV-RECS-WITH-MATCHES-CNT                  03750000
037600              SET PS-CURSOR-HAS-DATA TO TRUE                      03760000
037700         WHEN SQLCODE = +100                                      03770000
037800              SET PS-TABLE-LOOP-DONE TO TRUE                      03780000
037900         WHEN SQLWARN0 NOT EQUAL SPACE                            03790000
038000         WHEN SQLCODE  NOT EQUAL ZERO                             03800000
038100              MOVE '9100-OPEN-TABLE-CURSOR'                       03810000
038200                                 TO PV-PARAGRAPH-NAME             03820000
038300              MOVE 'OPEN TABLE CURSOR'                            03830000
038400                                 TO PV-DB2-OPERATION-MSG-1        03840000
038500              MOVE 'RCT_RECDIS_ORIG' TO PV-DB2-TABLE-NAME         03850000
038600              PERFORM 9999-DB2-ABEND                              03860000
038700     END-EVALUATE.                                                03870000
038800                                                                  03880000
038900                                                                  03890000
039000******************************************************************03900000
039100*   FETCH TABLE CURSOR                                           *03910000
039200******************************************************************03920000
039300 9150-FETCH-TABLE-CURSOR.                                         03930000
039400     EXEC SQL                                                     03940000
039500         FETCH TABLE-CURSOR                                       03950000
039600          INTO  :RCT00013-ORD-NBR                                 03960000
039700               ,:RCT00013-ORD-LNE-NBR                             03970000
039800               ,:RCT00013-REC-SEQ-NBR                             03980000
039900               ,:RCT00013-OPER-UNT-ID                             03990000
040000               ,:RCT00013-FCLTY-ID                                04000000
040100               ,:RCT00013-STR-NBR                                 04010002
040200               ,:RCT00013-STR-FCLTY-ID                            04020002
040300               ,:RCT00013-ORIG-EXPTED-QTY                         04030002
040400               ,:RCT00013-CRE-TMST                                04040002
040600     END-EXEC.                                                    04060000
040700                                                                  04070000
040800     EVALUATE TRUE                                                04080000
040900         WHEN SQLCODE = ZERO                                      04090000
041000              ADD +1                 TO PV-TABLE-ROW-SELECT-CNT   04100000
041100              SET PS-CURSOR-HAS-DATA TO TRUE                      04110000
041200         WHEN SQLCODE = +100                                      04120000
041300              SET PS-TABLE-LOOP-DONE TO TRUE                      04130000
041400         WHEN SQLWARN0 NOT EQUAL SPACE                            04140000
041500         WHEN SQLCODE NOT EQUAL ZERO                              04150000
041600              MOVE '9150-FETCH-TABLE-CURSOR'                      04160000
041700                                 TO PV-PARAGRAPH-NAME             04170000
041800              MOVE 'FETCH TABLE CURSOR'                           04180000
041900                                 TO PV-DB2-OPERATION-MSG-1        04190000
042000              MOVE 'RCT_RECDIS_ORIG' TO PV-DB2-TABLE-NAME         04200000
042100              PERFORM 9999-DB2-ABEND                              04210000
042200     END-EVALUATE.                                                04220000
042300                                                                  04230000
042400                                                                  04240000
042500******************************************************************04250000
042600*   CLOSE TABLE CURSOR                                           *04260000
042700******************************************************************04270000
042800 9190-CLOSE-TABLE-CURSOR.                                         04280000
042900     EXEC SQL                                                     04290000
043000          CLOSE TABLE-CURSOR                                      04300000
043100     END-EXEC.                                                    04310000
043200                                                                  04320000
043300     EVALUATE TRUE                                                04330000
043400         WHEN SQLCODE = ZERO                                      04340000
043500              CONTINUE                                            04350000
043600         WHEN SQLWARN0 NOT EQUAL SPACE                            04360000
043700         WHEN SQLCODE NOT EQUAL ZERO                              04370000
043800              MOVE '9190-CLOSE-TABLE-CURSOR'                      04380000
043900                                 TO PV-PARAGRAPH-NAME             04390000
044000              MOVE 'CLOSE TABLE CURSOR'                           04400000
044100                                 TO PV-DB2-OPERATION-MSG-1        04410000
044200              MOVE 'RCT_RECDIS_ORIG' TO PV-DB2-TABLE-NAME         04420000
044300              PERFORM 9999-DB2-ABEND                              04430000
044400     END-EVALUATE.                                                04440000
044500                                                                  04450000
044600                                                                  04460000
044700******************************************************************04470000
044800*   WRITE A RECORD TO THE TABLE EXTRACT FILE                     *04480000
044900******************************************************************04490000
045000 9750-WRITE-EXTRACT-RECORD.                                       04500000
045100     WRITE  OUT-EXTRACT-RECORD  FROM  DCLRCT00013.                04510000
045200     ADD +1 TO PV-EXTRACT-WRITTEN-CNT.                            04520000
045300                                                                  04530000
045400                                                                  04540000
045500******************************************************************04550000
045600*   DISPLAY INFORMATION NEEDED FOR DEBUGGING/MAINTENANCE/SUPPORT *04560000
045700*   AND CALL THE ABEND PROCESSOR IN THE EVENT THAT AN            *04570000
045800*   SQL ERROR OR WARNING CODE OCCURS.                            *04580000
045900******************************************************************04590000
046000 9999-DB2-ABEND.                                                  04600000
046100                                                                  04610000
046200     DISPLAY PC-CURRENT-PROGRAM-NAME                              04620000
046300             ' 9999-DB2-ABEND'.                                   04630000
046400     DISPLAY PC-CURRENT-PROGRAM-NAME                              04640000
046500             ' ** ABEND           **'.                            04650000
046600     DISPLAY PC-CURRENT-PROGRAM-NAME                              04660000
046700             ' ** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.       04670000
046800     DISPLAY PC-CURRENT-PROGRAM-NAME                              04680000
046900             ' ** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME.       04690000
047000     DISPLAY PC-CURRENT-PROGRAM-NAME                              04700000
047100             ' ** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.  04710000
047200                                                                  04720000
047300     DISPLAY PC-CURRENT-PROGRAM-NAME                              04730000
047400             ' ** SQLCODE         ** = ' SQLCODE.                 04740000
047500     MOVE SQLCODE TO PV-SQLCODE.                                  04750000
047600     DISPLAY PC-CURRENT-PROGRAM-NAME                              04760000
047700             ' ** PV-SQLCODE      ** = ' PV-SQLCODE '.'.          04770000
047800                                                                  04780000
047900     DISPLAY PC-CURRENT-PROGRAM-NAME                              04790000
048000             ' ** SQLWARN0        ** = ' SQLWARN0 '.'.            04800000
048100                                                                  04810000
048200                                                                  04820000
048300*----------------------------------------------------------------*04830000
048400* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *04840000
048500* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *04850000
048600* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *04860000
048700* FORMAT.                                                        *04870000
048800*----------------------------------------------------------------*04880000
048900     COPY DPPD004.                                                04890000
049000                                                                  04900000
049100     MOVE PC-ABENDING               TO DP-STATUS-DESCRIPTION.     04910000
049200     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           04920000
049300     PERFORM 9090-CLOSE-FILES.                                    04930000
049400                                                                  04940000
049500*----------------------------------------------------------------*04950000
049600* CALL ABEND                                                     *04960000
049700*----------------------------------------------------------------*04970000
049800     MOVE +4013                  TO ABEND-CODE.                   04980000
049900     CALL 'ILBOABN0' USING ABEND-CODE.                            04990000
050000*                                                                 05000000
