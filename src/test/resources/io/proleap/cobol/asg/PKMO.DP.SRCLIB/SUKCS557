000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400******************************************************************00040000
000500*  I M P O R T A N T --- WHEN COMPILING THIS PROGRAM THE SOCKET  *00050000
000600* SWITCH ON THE 2ND COMPILE SCREEN NEEDS TO BE SET TO 'Y'.  THIS  00060000
000700* PROGRAM IS USING "EZASOKET".                                    00070000
000800******************************************************************00080000
000900*   IN THE FUTURE, THIS PROGRAM WILL BE MODOFIED TO CALL RDM WHEN 00090000
001000*   CARTON DATA IS NOT FOUND.  THIS PROGRAM HAS THE LOGIC TO DO   00100000
001100*   THIS, BUT IT IS COMMENTED OUT.  ALL REFERENCES TO THE         00110000
001200*   T-U-P-C-S-K-U TABLE HAVE BEEN REMOVED SO THAT SCANS FOR THE   00120000
001300*   NI SKU PROJECT DO NOT IDENTIFY THIS PROGRAM AS NEEDING CHANGES00130000
001400                                                                  00140000
001500 PROGRAM-ID.       SUKCS557.                                      00150000
001600 AUTHOR.           LARRY SCHLEICHER.                              00160000
001700 INSTALLATION.     KOHLS.                                         00170000
001800 DATE-WRITTEN      FEBRUARY 2001.                                 00180000
001900 DATE-COMPILED.                                                   00190000
002000                                                                  00200000
002100******************************************************************00210000
002200* THIS PROGRAM RECEIVES FROM AND SENDS DATA STREAMS TO THE DC     00220000
002300* CONVEYOR SYSTEMS.  THE RECEIVED DATA REPRESENT DIVERTS FOR      00230000
002400* CARTONS TO STORE TRAILERS.  THE TRANSMIT DATA IS THE            00240000
002500* ACKNOWLEDGEMENT THAT THE DATA WAS RECEIVED.                     00250000
002600******************************************************************00260000
002500* CHANGE LOG:                                                     00261005
002500*                                                                 00261105
002500* 02/14/2023    JEAN KURK                   CHG0281369            00261205
002500*               REMOVE COPYBOOK FOR UPC CHECK DIGIT ROUTINE       00261305
002600******************************************************************00262005
002700 ENVIRONMENT DIVISION.                                            00270000
002800 DATA DIVISION.                                                   00280000
002900 WORKING-STORAGE SECTION.                                         00290000
003000                                                                  00300000
003100     COPY PCWS208.                                                00310000
003200*                                                                 00320000
003300*  SOCKET COMMANDS CODES NEED FOR THE TCP/IP SOCKET CALLS         00330000
003400*                                                                 00340000
003500     COPY DPWS081.                                                00350000
003600                                                                  00360000
004300     EJECT                                                        00430000
004400*                                                                 00440000
004500*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               00450000
004600                                                                  00460000
004700 01  TASK-START.                                                  00470000
004800     05  FILLER                         PIC X(09)                 00480000
004900      VALUE IS 'CONFIRMS '.                                       00490000
005000     05  TASK-START-TRAN                PIC X(04).                00500000
005100     05  FILLER                         PIC X(26)                 00510000
005200      VALUE IS ' CICS TCPIP INTERFACE STAR'.                      00520000
005300     05  TASK-START-CR                  PIC X(01).                00530000
005400 77  TASK-END                       PIC X(40)                     00540000
005500      VALUE IS 'CONFIRMS....CICS-TCPIP INTERFACE END...;'.        00550000
005600*                                                                 00560000
005700 01  TCP-BUF2.                                                    00570000
005800     05 TCP-BUF                          PIC  X(57)  VALUE SPACE. 00580000
005900     05 TCP-BUF-DATA                     PIC  X(13)  VALUE SPACE. 00590000
006000*                                                                 00600000
006100 01  PC-PROGRAM-CONSTANTS.                                        00610000
006200     05  PC-MAX-RETRIES                  PIC S9(03)  VALUE +3     00620000
006300                                                     COMP-3.      00630000
006400     05  PC-CURRENT-PGM-NAME             PIC  X(08)  VALUE        00640000
006500         'SUKCS557'.                                              00650000
006700     05  PC-CR                      PIC X(01) VALUE X'0D'.        00670001
006800     05  PC-DEFAULT-TMST            PIC X(26)                     00680000
006900                              VALUE '9999-09-09-09.09.09.999999'. 00690000
007000*                                                                 00700000
007100 01  DK-DB2-KEYS.                                                 00710000
007200     05  DK-BRCDE-NBR                    PIC  X(22) VALUE SPACES. 00720000
007300     05  DK-DATE                         PIC  X(10) VALUE SPACES. 00730000
007400     05  DK-TIME                         PIC  X(08) VALUE SPACES. 00740000
007500     05  DK-FUNC-CDE                     PIC  X(06) VALUE SPACES. 00750000
007600     05  DK-LOC-ID                       PIC S9(04)  COMP.        00760000
007700     05  DK-STR-NBR                      PIC S9(04)  COMP.        00770000
007800     05  DK-CTN                          PIC S9(18)V COMP-3.      00780000
007900     05  DK-SHIPT-UNT-ID                 PIC S9(18)V COMP-3       00790000
008000                                                    VALUE ZERO.   00800000
008100     05  DK-OPER-UNT-ID                  PIC S9(04)  COMP.        00810000
008200     05  DK-DIVERT-ID                    PIC S9(09)  COMP.        00820000
008300     05  DK-DOOR-ID                      PIC X(04)  VALUE SPACES. 00830000
008400     05  DK-ERROR-CODE                   PIC X(03)  VALUE ZERO.   00840000
008500     05  DK-PRC-TMST                     PIC X(26)  VALUE SPACES. 00850000
008600     05  DK-RECS-READ                    PIC S9(9)   COMP         00860000
008700                                                    VALUE ZERO.   00870000
008800                                                                  00880000
008900 01  PS-PROGRAM-SWITCHES.                                         00890000
009000     05  PS-CHILD-SW                     PIC X(01)   VALUE 'N'.   00900000
009100         88  PS-ALL-CHILD                            VALUE 'N'.   00910000
009200         88  PS-END-OF-CHILD                         VALUE 'Y'.   00920000
009300     05  PS-DEST-MATCH-FOUND-SW          PIC X(01)   VALUE 'N'.   00930000
009400         88  PS-NO-DEST-MATCH-FOUND                  VALUE 'N'.   00940000
009500         88  PS-DEST-MATCH-FOUND                     VALUE 'Y'.   00950000
009600     05  PS-CARTON-SW                    PIC X(01)   VALUE 'N'.   00960000
009700         88  PS-ALL-CARTON                           VALUE 'N'.   00970000
009800         88  PS-END-OF-CARTON                        VALUE 'Y'.   00980000
009900     05  PS-LOG-TO-ERR-FILE-SW           PIC X(01)   VALUE ' '.   00990000
010000         88  PS-LOG-TO-ERR-FILE                      VALUE 'Y'.   01000000
010100         88  PS-DO-NOT-LOG                           VALUE 'N'.   01010000
010200     05  PS-PARM-REC-FOUND-SW            PIC X(01)   VALUE ' '.   01020000
010300         88  PS-NO-PARM-REC-FOUND                    VALUE 'N'.   01030000
010400         88  PS-PARM-REC-FOUND                       VALUE 'Y'.   01040000
010500     05  PS-DUPLICATE-CARTON-SW          PIC X(01)   VALUE ' '.   01050000
010600         88  PS-NO-DUPLICATE-CARTON                  VALUE 'N'.   01060000
010700         88  PS-DUPLICATE-CARTON                     VALUE 'Y'.   01070000
010800     05  PS-RDM-FACILITY-SW              PIC X(01)   VALUE 'N'.   01080000
010900         88  PS-RDM-FACILITY-YES                     VALUE 'Y'.   01090000
011000         88  PS-RDM-FACILITY-NO                      VALUE 'N'.   01100000
011100     05  PS-RDM-RECORD-FOUND-SW          PIC X(01)   VALUE 'N'.   01110000
011200         88  PS-RDM-RECORD-FOUND                     VALUE 'Y'.   01120000
011300         88  PS-RDM-RECORD-NOT-FOUND                 VALUE 'N'.   01130000
011400     05  PS-OTBND-CART-FOUND-SW          PIC X(01)   VALUE 'N'.   01140000
011500         88  PS-OTBND-CART-FOUND-YES                 VALUE 'Y'.   01150000
011600         88  PS-OTBND-CART-FOUND-NO                  VALUE 'N'.   01160000
011700     05  PS-PART-RECEIVE-SW              PIC  X(01)  VALUE 'S'.   01170000
011800         88  PS-PART-RECEIVE                         VALUE 'P'.   01180000
011900         88  PS-COMP-RECEIVE                         VALUE 'C'.   01190000
012000         88  PS-ERROR-RECEIVE                        VALUE 'E'.   01200000
012100         88  PS-START-RECEIVE                        VALUE 'S'.   01210000
012200     05  PS-DOOR-CONVERT-NOT-FOUND-SW    PIC X(01)   VALUE 'N'.   01220000
012300         88  PS-DOOR-CONVERT-FOUND                   VALUE 'Y'.   01230000
012400         88  PS-DOOR-CONVERT-NOT-FOUND               VALUE 'N'.   01240000
012500     05  PS-STORE-NUMBER-NOT-FOUND-SW    PIC X(01)   VALUE 'N'.   01250000
012600         88  PS-STORE-NUMBER-FOUND                   VALUE 'Y'.   01260000
012700         88  PS-STORE-NUMBER-NOT-FOUND               VALUE 'N'.   01270000
012800     05  PS-SOCKET-CLOSE-SW              PIC X(01)   VALUE 'N'.   01280000
012900         88  PS-SOCKET-CLOSED                        VALUE 'Y'.   01290000
013000         88  PS-SOCKET-NOT-CLOSED                    VALUE 'N'.   01300000
013100                                                                  01310000
013200 01  PV-PROGRAM-VARIABLES.                                        01320000
013300     05  PV-OTBND-CART-SHIPT-UNT-ID      PIC S9(18)V COMP-3       01330000
013400                                                    VALUE ZERO.   01340000
013500     05  PV-SHIPT-UNIT-ID                PIC  9(18).              01350000
013600     05  PV-PRNT-CART-ID                 PIC S9(18)V COMP-3       01360000
013700                                                    VALUE ZERO.   01370000
013800     05  PV-DISP-SHIPT-UNT-ID            PIC S9(18).              01380000
013900     05  PV-DISP-TCP-COUNT               PIC  9(04).              01390000
014000     05  PV-DISPLAY-SQLCODE              PIC S9(09).              01400000
014100     05  PV-ACTV-IND                     PIC  X(01).              01410000
014200     05  PV-ENTRIES                      PIC S9(03)  VALUE ZEROS  01420000
014300                                                     COMP-3.      01430000
014400     05  PV-SQL-CODE                     PIC 9(09).               01440000
014500     05  PV-HOLD-TIMESTAMP               PIC X(26).               01450000
014600     05  PV-TIMESTAMP                    PIC X(26).               01460000
014700     05  PV-DB2-CURRENT-TMST             PIC  X(26).              01470000
014800     05  PV-CONTAINER-ID.                                         01480000
014900         10  PV-CONTAINER-00             PIC X(02).               01490000
015000         10  PV-SHIPT-UNT-ID             PIC 9(18).               01500000
015100         10  PV-CONTAINER-SPACES         PIC X(02).               01510000
015200     05  FILLER REDEFINES PV-CONTAINER-ID.                        01520000
015300         10  FILLER                      PIC X(05).               01530000
015400         10  PV-STORE-NBR                PIC 9(04).               01540000
015500         10  FILLER                      PIC X(13).               01550000
015600     05  PV-SHIPT-UNT-ID-REDEF           PIC 9(18).               01560000
015700     05  FILLER REDEFINES PV-SHIPT-UNT-ID-REDEF.                  01570000
015800         10  PV-SHIPT-UNT-ID-FIL-1       PIC 9(03).               01580000
015900         10  PV-STORE-NUMBER             PIC 9(04).               01590000
016000         10  PV-SHIPT-UNT-ID-FIL-2       PIC 9(11).               01600000
016100     05  PV-DATE.                                                 01610000
016200         10  PV-DATE-CCYY                PIC X(04).               01620000
016300         10  PV-DATE-DASH1               PIC X(01)  VALUE '-'.    01630000
016400         10  PV-DATE-MM                  PIC X(02).               01640000
016500         10  PV-DATE-DASH2               PIC X(01)  VALUE '-'.    01650000
016600         10  PV-DATE-DD                  PIC X(02).               01660000
016700     05  PV-TIME.                                                 01670000
016800         10  PV-TIME-HH                  PIC X(02).               01680000
016900         10  PV-TIME-DOT1                PIC X(01)  VALUE '.'.    01690000
017000         10  PV-TIME-MM                  PIC X(02).               01700000
017100         10  PV-TIME-DOT2                PIC X(01)  VALUE '.'.    01710000
017200         10  PV-TIME-SS                  PIC X(02).               01720000
017300     05  PV-IN-DATE                      PIC 9(08).               01730000
017400     05  FILLER REDEFINES PV-IN-DATE.                             01740000
017500         10  PV-IN-DATE-CCYY             PIC X(04).               01750000
017600         10  PV-IN-DATE-MM               PIC X(02).               01760000
017700         10  PV-IN-DATE-DD               PIC X(02).               01770000
017800     05  PV-IN-TIME                      PIC 9(06).               01780000
017900     05  FILLER REDEFINES PV-IN-TIME.                             01790000
018000         10  PV-IN-TIME-HH               PIC X(02).               01800000
018100         10  PV-IN-TIME-MM               PIC X(02).               01810000
018200         10  PV-IN-TIME-SS               PIC X(02).               01820000
018300     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  01830000
018400                                                     COMP SYNC.   01840000
018500     05  PV-OTBND-CART-INSERT-COUNT      PIC S9(07) COMP-3        01850000
018600                                             VALUE ZERO.          01860000
018700     05  PV-OTBND-CART-DUP-COUNT         PIC S9(07) COMP-3        01870000
018800                                             VALUE ZERO.          01880000
018900     05  PV-SHUUPC-INSERT-COUNT          PIC S9(07) COMP-3        01890000
019000                                             VALUE ZERO.          01900000
019100     05  PV-SHUUPC-DUP-COUNT             PIC S9(07) COMP-3        01910000
019200                                             VALUE ZERO.          01920000
019300     05  PV-PARTIAL-TCP-COUNT            PIC S9(04)  VALUE ZEROS  01930000
019400                                                     COMP SYNC.   01940000
019500     05  PV-RETRY-COUNTER                PIC S9(04)  VALUE ZEROS  01950000
019600                                                     COMP SYNC.   01960000
019700     05  PV-TASK-X.                                               01970000
019800         10  PV-TASK                     PIC 9(07)   VALUE ZERO.  01980000
019900     05  PV-RECEIVE-LENGTH               PIC S9(04)  VALUE +0     01990000
020000                                                     COMP SYNC.   02000000
020100     05  PV-CICS-MSG-AREA                PIC  X(80)  VALUE SPACE. 02010000
020200                                                                  02020000
020300     05  PV-RETCODE                      PIC  9(08)  VALUE ZEROS. 02030000
020400     05  PV-TCPLENG                      PIC  9(08)  VALUE ZEROS. 02040000
020500     05  PV-ERRNO                        PIC  9(08)  VALUE ZEROS. 02050000
020600     05  PV-TCP-BUF                      PIC  X(57)  VALUE SPACES.02060000
020700                                                                  02070000
020800     05  PV-TCP-EXP-LENGTH               PIC 9(08)   VALUE 57.    02080000
020900     05  PV-TCP-RET-LENGTH               PIC 9(08)   VALUE ZEROS. 02090000
021000     05  PV-TCP-REM-LENGTH               PIC 9(08)   VALUE ZEROS. 02100000
021100     05  PV-TCP-PRCSD-LENGTH             PIC 9(08)   VALUE ZEROS. 02110000
021200     05  PV-ABEND-CODE                   PIC S9(04)  COMP SYNC    02120000
021300                                                 VALUE ZERO.      02130000
021400     05  PV-ERROR-COUNT                  PIC 9(03)   VALUE ZERO.  02140000
021500     05  PV-SOCK-ID                      PIC 9(04).               02150000
021600     05  PV-CID-DOMAIN-LSTN              PIC 9(08).               02160000
021700     05  PV-NBR-BYTES                    PIC 9(08).               02170000
021800                                                                  02180000
021900*                                                                 02190000
022000*                                                                 02200000
022100 01  PT-MSG-TABLE.                                                02210000
022200     05  PT-MESSAGES OCCURS 40 TIMES INDEXED BY PT-MSG-IDX.       02220000
022300         10  PT-MSG.                                              02230000
022400             15 PT-MESSAGE               PIC X(52).               02240000
022500             15 FILLER                   PIC X(1).                02250000
022600             15 PT-TASK                  PIC 9(07).               02260000
022700             15 FILLER                   PIC X(1).                02270000
022800                                                                  02280000
022900                                                                  02290000
023000 01  PT-TCP-RECEIVE-TABLE.                                        02300000
023100     05  PT-TCP-RECEIVE OCCURS 50 TIMES                           02310000
023200                        INDEXED BY PT-RECEIVE-IDX.                02320000
023300         10  PT-TCP-RECEIVE-CHAR         PIC X(01).               02330000
023400                                                                  02340000
023500 01  PT-TCP-ASSEMBLE-TABLE.                                       02350000
023600     05  PT-TCP-DATA-ASSEMBLE OCCURS 50 TIMES                     02360000
023700                              INDEXED BY PT-ASSEMBLE-IDX.         02370000
023800         10  PT-TCP-DATA-CHAR            PIC X(01).               02380000
023900/                                                                 02390000
024000                                                                  02400000
024100*                                                                 02410000
024200*  LISTENER QUEUE NAMES                                           02420000
024300*                                                                 02430000
024400     COPY RFWS001.                                                02440000
024500                                                                  02450000
024600*                                                                 02460000
024700*  RECORD LAYOUT BEING TRANSMITTED FROM THE CONVEYOR SYSTEM       02470000
024800*                                                                 02480000
024900     COPY SURD014.                                                02490000
025000                                                                  02500000
025100*                                                                 02510000
025200*  RECORD LAYOUT BEING TRANSMITTED TO THE CONVEYOR SYSTEM         02520000
025300*                                                                 02530000
025400     COPY SURD015.                                                02540000
025500                                                                  02550000
025600*                                                                 02560000
025700*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                02570000
025800*                                                                 02580000
025900     COPY DPWS013.                                                02590000
026000                                                                  02600000
026100*                                                                 02610000
026200*  RECORD LAYOUT FOR SYSTEM MESSAGES FILE USED FOR CICS MESSAGES  02620000
026300*                                                                 02630000
026400     COPY DPRD507I.                                               02640000
026500                                                                  02650000
026600*                                                                 02660000
026700*  FORMATS CICS SYSTEM MESSAGES FOR NON-ARCHITECTURE PROGRAMS     02670000
026800*                                                                 02680000
026900     COPY DPWS011.                                                02690000
027000                                                                  02700000
027100*                                                                 02710000
027200*  DATE VALIDATION CALLING PARAMETER LIST                        *02720000
027300*                                                                 02730000
027400     COPY DPWS500.                                                02740000
027500                                                                  02750000
028100*                                                                 02810000
028200*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE KOHLS/RETEK        02820000
028300*  PARM TABLE                                                     02830000
028400     EXEC SQL                                                     02840000
028500          INCLUDE TKRPRPM                                         02850000
028600     END-EXEC.                                                    02860000
028700                                                                  02870000
028800*                                                                 02880000
028900*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE CONTAINER DIVERT   02890000
029000*  TABLE                                                          02900000
029100     EXEC SQL                                                     02910000
029200         INCLUDE TSUCRDV                                          02920000
029300     END-EXEC.                                                    02930000
029400                                                                  02940000
029500*                                                                 02950000
029600*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      02960000
029700*  TABLE                                                          02970000
029800     EXEC SQL                                                     02980000
029900         INCLUDE SUT00024                                         02990000
030000     END-EXEC.                                                    03000000
030100                                                                  03010000
030200*                                                                 03020000
030300*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING           03030000
030400*  UPC TABLE                                                      03040000
030500*                                                                 03050000
030600*    EXEC SQL                                                     03060000
030700*         INCLUDE TSHUUPC                                         03070000
030800*    END-EXEC.                                                    03080000
030900                                                                  03090000
031000*                                                                 03100000
031100*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE CEPLIT TABLE       03110000
031200*                                                                 03120000
031300*    EXEC SQL                                                     03130000
031400*         INCLUDE TCEPLIT                                         03140000
031500*    END-EXEC.                                                    03150000
031600                                                                  03160000
031700*                                                                 03170000
031800*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE UPC SKU TABLE      03180000
031900*                                                                 03190000
032000*    EXEC SQL                                                     03200000
032100*         INCLUDE T-U-P-C-S-K-U                                   03210000
032200*    END-EXEC.                                                    03220000
032300                                                                  03230000
032400*                                                                 03240000
032500*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE UPLOAD ERROR TABLE 03250000
032600*                                                                 03260000
032700     EXEC SQL                                                     03270000
032800         INCLUDE TUPLDER                                          03280000
032900     END-EXEC.                                                    03290000
033000                                                                  03300000
033100*                                                                 03310000
033200*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE CONTROL DC DOOR    03320000
033300*  TABLE                                                          03330000
033400     EXEC SQL                                                     03340000
033500          INCLUDE TCNDCDR                                         03350000
033600     END-EXEC.                                                    03360000
033700                                                                  03370000
033800     EXEC SQL                                                     03380000
033900          INCLUDE TCNDRST                                         03390000
034000     END-EXEC.                                                    03400000
034100                                                                  03410000
034200     EXEC SQL                                                     03420000
034300          INCLUDE TCNDRTY                                         03430000
034400     END-EXEC.                                                    03440000
034500                                                                  03450000
034600     EXEC SQL DECLARE CHILD-CSR CURSOR FOR                        03460000
034700         SELECT UNT1.SHIPT_UNT_ID                                 03470000
034800            ,   UNT1.DEST_LOC_NBR                                 03480000
034900         FROM   SUT_OTBND_CART UNT1                               03490000
035000         WHERE  UNT1.PRNT_CART_ID      = :DK-SHIPT-UNT-ID         03500000
035100          AND   UNT1.SHIPT_UNT_ID     <> :DK-SHIPT-UNT-ID         03510000
035200          AND   UNT1.ACTV_IND          = 'Y'                      03520000
035300          AND   UNT1.MSTR_CART_IND     = 'N'                      03530000
035400     END-EXEC.                                                    03540000
035500                                                                  03550000
035600*                                                                 03560000
035700*  COMMUNICATIONS AREA FOR DB2                                    03570000
035800*                                                                 03580000
035900     EXEC SQL                                                     03590000
036000         INCLUDE SQLCA                                            03600000
036100     END-EXEC.                                                    03610000
036200     COPY SQLCA2.                                                 03620000
036300*                                                                 03630000
036400 01  PC-PROGRAM-CONSTANTS.                                        03640000
036500     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        03650000
036600         'SUKCS557'.                                              03660000
036700*    05  PC-CALENDAR-PGM                 PIC  X(08)  VALUE        03670000
036800*        'DPKUT500'.                                              03680000
036900*                                                                 03690000
037000 01  PS-PROGRAM-SWITCHES.                                         03700000
037100     05  PS-ACTIVE-XREF-ROW-FOUND-SW     PIC  X(01)  VALUE 'Y'.   03710000
037200         88  PS-ACTIVE-XREF-ROW-FOUND                VALUE 'Y'.   03720000
037300         88  PS-ACTIVE-XREF-ROW-NOT-FOUND            VALUE 'N'.   03730000
037400*                                                                 03740000
037500                                                                  03750000
037600**                                                                03760000
037700 PROCEDURE DIVISION.                                              03770000
037800                                                                  03780000
037900 0000-PROGRAM-MAINLINE.                                           03790000
038000                                                                  03800000
038100     MOVE ' 0000-PROGRAM-MAINLINE'                                03810000
038200                                 TO DP013-PARAGRAPH.              03820000
038300     MOVE EIBTASKN               TO PV-TASK                       03830000
038400     STRING ' SUKCS557 STARTED - TASK = ' PV-TASK-X               03840000
038500         DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  03850000
038600     PERFORM 9990-WRITE-CICS                                      03860000
038700                                                                  03870000
038800     MOVE SPACES                 TO PT-MSG-TABLE.                 03880000
038900     SET PT-MSG-IDX              TO 1.                            03890000
039000     MOVE EIBTASKN               TO PT-TASK(PT-MSG-IDX)           03900000
039100     MOVE ' SUKCS557 - STARTED'  TO PT-MESSAGE(PT-MSG-IDX)        03910000
039200                                                                  03920000
039300     PERFORM 1000-GET-COMMAREA-FROM-LSTNR.                        03930000
039400                                                                  03940000
039500* JUST FOR TESTING - BEGIN                                        03950000
039600*    STRING ' COMMAREA = ' DP081-LSTN-TCPSOCKET-PARM              03960000
039700*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  03970000
039800*    PERFORM 9990-WRITE-CICS                                      03980000
039900* JUST FOR TESTING - END                                          03990000
040000                                                                  04000000
040100     PERFORM 1100-TAKE-SOCKET.                                    04010000
040200                                                                  04020000
040300     PERFORM 1200-CONFIRM-CONNECTION.                             04030000
040400                                                                  04040000
040500     MOVE 'CNVERR'         TO DK-FUNC-CDE.                        04050000
040600     PERFORM 7900-CHECK-PARM-TABLE.                               04060000
040700     MOVE PV-TIMESTAMP     TO PV-HOLD-TIMESTAMP.                  04070000
040800     IF PS-PARM-REC-FOUND                                         04080000
040900         IF KRPRPM-FUNC-TXT = 'Y'                                 04090000
041000             SET PS-LOG-TO-ERR-FILE  TO TRUE                      04100000
041100         ELSE                                                     04110000
041200             SET PS-DO-NOT-LOG      TO TRUE                       04120000
041300         END-IF                                                   04130000
041400     ELSE                                                         04140000
041500         SET PS-DO-NOT-LOG      TO TRUE                           04150000
041600     END-IF.                                                      04160000
041700     PERFORM 9000-SYNCPOINT.                                      04170000
041800                                                                  04180000
041900     PERFORM 2000-PROCESS-DIVERT-REQUEST                          04190000
042000         UNTIL PS-ERROR-RECEIVE.                                  04200000
042100* JUST FOR TESTING - BEGIN                                        04210000
042200*    INITIALIZE PV-CICS-MSG-AREA                                  04220000
042300*    STRING ' BEGIN OF GOOD CLOSE SOCKET '                        04230000
042400*                TCP-BUF                                          04240000
042500*    DELIMITED BY SIZE INTO PV-CICS-MSG-AREA.                     04250000
042600*    PERFORM 9990-WRITE-CICS.                                     04260000
042700* JUST FOR TESTING - END                                          04270000
042800                                                                  04280000
042900     PERFORM 1500-CLOSE-SOCKET.                                   04290000
043000                                                                  04300000
043100     SET PT-MSG-IDX              UP BY 1.                         04310000
043200     MOVE EIBTASKN               TO PT-TASK(PT-MSG-IDX)           04320000
043300     MOVE ' SUKCS557 - CLOSE SOCKET OK'                           04330000
043400                                 TO PT-MESSAGE(PT-MSG-IDX)        04340000
043500                                                                  04350000
043600     STRING ' SUKCS557 SUCCESSFUL - TASK = ' PV-TASK-X            04360000
043700         DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  04370000
043800     PERFORM 9990-WRITE-CICS                                      04380000
043900                                                                  04390000
044000     GOBACK.                                                      04400000
044100/                                                                 04410000
044200************************************************************      04420000
044300* THE LISTENER HAS BEEN STARTED AND A SOCKET HAS BEEN      *      04430000
044400* ESTABLISHED WITHIN THE LISTENER PROGRAM.  THE LISTENER   *      04440000
044500* PROGRAM IN TURN WILL START THIS PROGRAM, SO WE MUST      *      04450000
044600* DO A RETREIVE TO GET THE COMMAREA WHICH WAS PASSED.      *      04460000
044700************************************************************      04470000
044800 1000-GET-COMMAREA-FROM-LSTNR.                                    04480000
044900     MOVE ' 1000-GET-COMMAREA-FROM-LSTNR'                         04490000
045000                                 TO DP013-PARAGRAPH.              04500000
045100     MOVE LENGTH OF DP081-LSTN-TCPSOCKET-PARM                     04510000
045200                                          TO  PV-RECEIVE-LENGTH.  04520000
045300                                                                  04530000
045400     EXEC CICS                                                    04540000
045500         RETRIEVE                                                 04550000
045600             INTO    (DP081-LSTN-TCPSOCKET-PARM)                  04560000
045700             LENGTH  (PV-RECEIVE-LENGTH)                          04570000
045800             RESP    (PV-CICS-RESPONSE)                           04580000
045900     END-EXEC.                                                    04590000
046000                                                                  04600000
046100     EVALUATE TRUE                                                04610000
046200         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 04620000
046300             CONTINUE                                             04630000
046400         WHEN OTHER                                               04640000
046500             MOVE ' 1000-GET-COMMAREA-FROM-LSTNR'                 04650000
046600                 TO DP013-PARAGRAPH                               04660000
046700             MOVE 'UNABLE TO RETRIEVE COMMAREA FROM LISTENER'     04670000
046800                 TO DP013-MESSAGE-TEXT (1)                        04680000
046900             SET DP013-CICS-ABEND   TO  TRUE                      04690000
047000             SET DP013-NO-ROLLBACK  TO  TRUE                      04700000
047100             PERFORM 9999-WRITE-CICS-LOG-MSG                      04710000
047200     END-EVALUATE.                                                04720000
047300/                                                                 04730000
047400*----------------------------------------------------------------*04740000
047500*  ACQUIRE A SOCKET FROM ANOTHER PROGRAM AND CREATE A NEW SOCKET.*04750000
047600*----------------------------------------------------------------*04760000
047700 1100-TAKE-SOCKET.                                                04770000
047800                                                                  04780000
047900     MOVE ' 1100-TAKE-SOCKET'                                     04790000
048000                                 TO DP013-PARAGRAPH.              04800000
048100* JUST FOR TESTING - BEGIN                                        04810000
048200*    STRING '1100-TAKE-SOCKET' DELIMITED BY SIZE                  04820000
048300*    INTO PV-CICS-MSG-AREA                                        04830000
048400*    PERFORM 9990-WRITE-CICS                                      04840000
048500* JUST FOR TESTING - END                                          04850000
048600                                                                  04860000
048700     MOVE DP081-AF-INET               TO DP081-CID-DOMAIN-LSTN.   04870000
048800     MOVE DP081-LSTN-NAME             TO DP081-CID-NAME-LSTN.     04880000
048900****TESTING - BEGIN                                               04890000
049000         SET PT-MSG-IDX              UP BY 1                      04900000
049100         MOVE DP081-CID-DOMAIN-LSTN   TO PV-CID-DOMAIN-LSTN       04910000
049200****TESTING - END                                                 04920000
049300     MOVE DP081-LSTN-SUBTASKNAME      TO                          04930000
049400                                       DP081-CID-SUBTASKNAME-LSTN.04940000
049500     MOVE DP081-LSTN-GIVE-TAKE-SOCKET TO DP081-SOCK-ID.           04950000
049600****TESTING - BEGIN                                               04960000
049700*        SET PT-MSG-IDX              UP BY 1                      04970000
049800*        STRING                                                   04980000
049900*             '1100-TAKE-SOCKET-RES '     DELIMITED BY SIZE       04990000
050000*             DP081-CID-RES-LSTN          DELIMITED BY SIZE       05000000
050100*                             INTO PT-MESSAGE(PT-MSG-IDX)         05010000
050200****TESTING - END                                                 05020000
050300     CALL 'EZASOKET'                                              05030000
050400         USING                                                    05040000
050500                DP081-TAKESOCKET-CMD                              05050000
050600                DP081-SOCK-ID                                     05060000
050700                DP081-CLIENTID-LSTN                               05070000
050800                DP081-ERRNO                                       05080000
050900                DP081-RETCODE.                                    05090000
051000                                                                  05100000
051100* IF THE TAKESOCKET IS SUCCESSFUL, THE NEW SOCKET ID IS           05110000
051200*  CONTAINED IN THE RETCODE                                       05120000
051300                                                                  05130000
051400     IF DP081-RETCODE >= ZERO                                     05140000
051500         MOVE DP081-RETCODE           TO DP081-SOCK-ID            05150000
051600     ELSE                                                         05160000
051700         MOVE PC-CURRENT-PGM-NAME TO DP081-TCP-IP-PGM-NAME        05170000
051800         SET  DP081-TCP-IP-TAKE-ERR TO TRUE                       05180000
051900*   THE DP081-TCP-IP-ERR-NBR FIELD IS MULTIPLIED BY 10 BECAUSE THE05190000
052000*   DP081-TCP-IP-LOGGING-MSG GROUP LEVEL IS 80 CHARACTERS.  THIS  05200000
052100*   IS TRUNCATED TO 79 CHARACTERS WHEN MOVED TO THE               05210000
052200*   DP013-MESSAGE-TEXT GROUP LEVEL.                               05220000
052300         COMPUTE DP081-TCP-IP-ERR-NBR = DP081-ERRNO * 10          05230000
052400         SET  DP013-OTHER-ABEND   TO TRUE                         05240000
052500         SET  DP013-NO-ROLLBACK   TO TRUE                         05250000
052600         MOVE ' 1100-TAKE-SOCKET' TO DP013-PARAGRAPH              05260000
052700         MOVE DP081-TCP-IP-LOGGING-MSG TO DP013-MESSAGE-TEXT (1)  05270000
052800         PERFORM 9999-WRITE-CICS-LOG-MSG                          05280000
052900     END-IF.                                                      05290000
053000/                                                                 05300000
053100*----------------------------------------------------------------*05310000
053200*    CONFIRM THE CONNECTION ON THE SOCKET THAT WE RECEIVED FROM  *05320000
053300*    THE PACK TO LIGHT SYSTEM.                                   *05330000
053400*----------------------------------------------------------------*05340000
053500 1200-CONFIRM-CONNECTION.                                         05350000
053600                                                                  05360000
053700     MOVE ' 1200-CONFIRM-CONNECTION'                              05370000
053800                                 TO DP013-PARAGRAPH.              05380000
053900* JUST FOR TESTING - BEGIN                                        05390000
054000*    STRING '1200-CONFIRM-CONNECTION' DELIMITED BY SIZE           05400000
054100*    INTO PV-CICS-MSG-AREA                                        05410000
054200*    PERFORM 9990-WRITE-CICS                                      05420000
054300* JUST FOR TESTING - END                                          05430000
054400                                                                  05440000
054500     MOVE SPACES  TO  TCP-BUF2.                                   05450000
054600     MOVE PC-CR    TO TASK-START-CR.                              05460000
054700     MOVE EIBTRNID TO TASK-START-TRAN.                            05470000
054800     MOVE TASK-START TO TCP-BUF.                                  05480000
054900     MOVE 40      TO  DP081-NBR-BYTES                             05490000
055000                      DP081-TCPLENG.                              05500000
055100                                                                  05510000
055200* JUST FOR TESTING - BEGIN                                        05520000
055300*    STRING TCP-BUF  DELIMITED BY SIZE                            05530000
055400*    INTO PV-CICS-MSG-AREA                                        05540000
055500*    PERFORM 9990-WRITE-CICS                                      05550000
055600* JUST FOR TESTING - END                                          05560000
055700                                                                  05570000
055800* TRANSLATE EBCDIC TO ASCII                                       05580000
055900     CALL 'EZACIC04'                                              05590000
056000         USING  DP081-TOASCII-TOKEN                               05600000
056100                TCP-BUF                                           05610000
056200                DP081-TCPLENG.                                    05620000
056300                                                                  05630000
056400* WRITE DATA ON A CONNECTED SOCKET                                05640000
056500     CALL 'EZASOKET'                                              05650000
056600         USING  DP081-WRITE-CMD                                   05660000
056700                DP081-SOCK-ID                                     05670000
056800                DP081-NBR-BYTES                                   05680000
056900                TCP-BUF                                           05690000
057000                DP081-ERRNO                                       05700000
057100                DP081-RETCODE.                                    05710000
057200*                                                                 05720000
057300     IF DP081-RETCODE < ZERO                                      05730000
057400         MOVE PC-CURRENT-PGM-NAME TO DP081-TCP-IP-PGM-NAME        05740000
057500         SET  DP081-TCP-IP-WRITE-ERR TO TRUE                      05750000
057600*        MOVE DP081-ERRNO         TO DP081-TCP-IP-ERR-NBR         05760000
057700*   THE DP081-TCP-IP-ERR-NBR FIELD IS MULTIPLIED BY 10 BECAUSE THE05770000
057800*   DP081-TCP-IP-LOGGING-MSG GROUP LEVEL IS 80 CHARACTERS.  THIS  05780000
057900*   IS TRUNCATED TO 79 CHARACTERS WHEN MOVED TO THE               05790000
058000*   DP013-MESSAGE-TEXT GROUP LEVEL.                               05800000
058100         COMPUTE DP081-TCP-IP-ERR-NBR = DP081-ERRNO * 10          05810000
058200         SET  DP013-OTHER-ABEND   TO TRUE                         05820000
058300         SET  DP013-NO-ROLLBACK   TO TRUE                         05830000
058400         MOVE ' 1200-CONFIRM-CONNECTION'                          05840000
058500             TO DP013-PARAGRAPH                                   05850000
058600         MOVE DP081-TCP-IP-LOGGING-MSG TO DP013-MESSAGE-TEXT (1)  05860000
058700         PERFORM 9999-WRITE-CICS-LOG-MSG                          05870000
058800     END-IF.                                                      05880000
058900*----------------------------------------------------------------*05890000
059000*    CLOSE THE SOCKET GIVEN TO US BY THE PACK TO LIGHT SYSTEM.   *05900000
059100*----------------------------------------------------------------*05910000
059200 1500-CLOSE-SOCKET.                                               05920000
059300                                                                  05930000
059400     MOVE ' 1500-CLOSE-SOCKET'                                    05940000
059500                                 TO DP013-PARAGRAPH.              05950000
059600* JUST FOR TESTING - BEGIN                                        05960000
059700*    STRING '1500-CLOSE-SOCKET' DELIMITED BY SIZE                 05970000
059800*    INTO PV-CICS-MSG-AREA                                        05980000
059900*    PERFORM 9990-WRITE-CICS                                      05990000
060000* JUST FOR TESTING - END                                          06000000
060100                                                                  06010000
060200* CLOSE THE CONNECTED SOCKET                                      06020000
060300     SET PS-SOCKET-CLOSED   TO TRUE.                              06030000
060400                                                                  06040000
060500     CALL 'EZASOKET'                                              06050000
060600         USING                                                    06060000
060700                DP081-CLOSE-CMD                                   06070000
060800                DP081-SOCK-ID                                     06080000
060900                DP081-ERRNO                                       06090000
061000                DP081-RETCODE.                                    06100000
061100                                                                  06110000
061200     IF DP081-RETCODE < ZERO                                      06120000
061300         MOVE PC-CURRENT-PGM-NAME TO DP081-TCP-IP-PGM-NAME        06130000
061400         SET  DP081-TCP-IP-CLOSE-ERR TO TRUE                      06140000
061500*        MOVE DP081-ERRNO         TO DP081-TCP-IP-ERR-NBR         06150000
061600*   THE DP081-TCP-IP-ERR-NBR FIELD IS MULTIPLIED BY 10 BECAUSE THE06160000
061700*   DP081-TCP-IP-LOGGING-MSG GROUP LEVEL IS 80 CHARACTERS.  THIS  06170000
061800*   IS TRUNCATED TO 79 CHARACTERS WHEN MOVED TO THE               06180000
061900*   DP013-MESSAGE-TEXT GROUP LEVEL.                               06190000
062000         COMPUTE DP081-TCP-IP-ERR-NBR = DP081-ERRNO * 10          06200000
062100         SET  DP013-OTHER-ABEND   TO TRUE                         06210000
062200         SET  DP013-NO-ROLLBACK   TO TRUE                         06220000
062300         MOVE ' 1500-CLOSE-SOCKET'                                06230000
062400             TO DP013-PARAGRAPH                                   06240000
062500         MOVE DP081-TCP-IP-LOGGING-MSG TO DP013-MESSAGE-TEXT (1)  06250000
062600         PERFORM 9999-WRITE-CICS-LOG-MSG                          06260000
062700     END-IF.                                                      06270000
062800/                                                                 06280000
062900******************************************************************06290000
063000*    DETERMINE WHAT TYPE OF ACTION WAS REQUESTED.                 06300000
063100******************************************************************06310000
063200 2000-PROCESS-DIVERT-REQUEST.                                     06320000
063300                                                                  06330000
063400     EXEC SQL                                                     06340000
063500         SET :PV-DB2-CURRENT-TMST = CURRENT TIMESTAMP             06350000
063600     END-EXEC.                                                    06360000
063700     MOVE ' 2000-PROCESS-DIVERT-REQUEST'                          06370000
063800                                 TO DP013-PARAGRAPH.              06380000
063900     PERFORM 2100-RECEIVE-DATA-FROM-QNX.                          06390000
064000     IF SU014-DC-NUMBER = 865                                     06400000
064100         MOVE 1   TO PC-MAX-RETRIES                               06410000
064200     END-IF.                                                      06420000
064300     MOVE '000'            TO DK-ERROR-CODE.                      06430000
064400     MOVE SU014-BAR-CODE   TO  PV-CONTAINER-ID.                   06440000
064500     IF PV-SHIPT-UNT-ID IS NUMERIC AND                            06450000
064600        SU014-DC-NUMBER IS NUMERIC AND                            06460000
064700        SU014-DIVERT-NUMBER IS NUMERIC                            06470000
064800         SET PS-DOOR-CONVERT-FOUND TO TRUE                        06480000
064900         PERFORM 7800-VALIDATE-DIVERT                             06490000
065000         SET PS-STORE-NUMBER-FOUND TO TRUE                        06500000
065100         IF PS-DOOR-CONVERT-FOUND AND                             06510000
065200            CNDCDR-DOOR-TYP-CDE = 'SH'                            06520000
065300             PERFORM 8700-VALIDATE-STORE-NBR                      06530000
065400         END-IF                                                   06540000
065500         IF PS-STORE-NUMBER-NOT-FOUND                             06550000
065600             MOVE '107'    TO DK-ERROR-CODE                       06560000
065700             PERFORM 7700-WRITE-UPLOAD-ERROR-TABLE                06570000
065800         END-IF                                                   06580000
065900         IF PV-DB2-CURRENT-TMST > PV-HOLD-TIMESTAMP               06590000
066000             PERFORM 7900-CHECK-PARM-TABLE                        06600000
066100             MOVE PV-TIMESTAMP     TO PV-HOLD-TIMESTAMP           06610000
066200             IF PS-PARM-REC-FOUND                                 06620000
066300                 IF KRPRPM-FUNC-TXT = 'Y'                         06630000
066400                     SET PS-LOG-TO-ERR-FILE  TO TRUE              06640000
066500                 ELSE                                             06650000
066600                     SET PS-DO-NOT-LOG      TO TRUE               06660000
066700                 END-IF                                           06670000
066800             ELSE                                                 06680000
066900                 SET PS-DO-NOT-LOG      TO TRUE                   06690000
067000             END-IF                                               06700000
067100         END-IF                                                   06710000
067200         IF PS-DOOR-CONVERT-NOT-FOUND                             06720000
067300             MOVE '101'    TO DK-ERROR-CODE                       06730000
067400             PERFORM 7700-WRITE-UPLOAD-ERROR-TABLE                06740000
067500         ELSE                                                     06750000
067600             IF CNDRTY-DIVERT-TYP-CDE = 'D'                       06760000
067700                 IF SU014-BAR-CODE (1:4) NOT EQUAL TO '0041'      06770000
067701* JAK 09/2007 WR37075 ADD 2 LINES                                 06770104
067702                    AND                                           06770200
067703                    SU014-BAR-CODE (1:4) NOT EQUAL TO '0042'      06770300
067704                     MOVE '100'    TO DK-ERROR-CODE               06770400
067705                     PERFORM 7700-WRITE-UPLOAD-ERROR-TABLE        06770500
067706                 ELSE                                             06770600
067707                     PERFORM 2600-MOVE-DIVERT-DATA                06770700
067708                     IF PS-LOG-TO-ERR-FILE                        06770800
067709                         MOVE '104'    TO DK-ERROR-CODE           06770900
067710                         PERFORM 7700-WRITE-UPLOAD-ERROR-TABLE    06771000
067720                     ELSE                                         06772000
067730                         PERFORM 8000-SELECT-TSUCRDV              06773000
067740                         IF PS-DUPLICATE-CARTON                   06774000
067750                             MOVE '103'    TO DK-ERROR-CODE       06775000
067760                             PERFORM 7700-WRITE-UPLOAD-ERROR-TABLE06776000
067770                         END-IF                                   06777000
067780                     END-IF                                       06778000
067790                     IF PS-DUPLICATE-CARTON AND                   06779000
067800                       SUCRDV-DIVERT-SYS-DTE = PV-DATE AND        06780000
067900                       SUCRDV-DIVERT-SYS-TM = PV-TIME             06790000
068000                         CONTINUE                                 06800000
068100                     ELSE                                         06810000
068200                         PERFORM 7600-SELECT-OTBND-CART           06820000
068300                         IF PS-OTBND-CART-FOUND-YES AND           06830000
068400                            SUT00024-CART-SRC-CDE = 'MST' AND     06840000
068500                            CNDCDR-DOOR-TYP-CDE NOT = 'DS' AND    06850000
068600                            CNDCDR-DOOR-TYP-CDE NOT = 'ST'        06860000
068700***                  INACTIVATE MST RECORD - SHPUNT               06870000
068800                             MOVE SUT00024-PRNT-CART-ID           06880000
068900                                              TO PV-PRNT-CART-ID  06890000
069000                             MOVE 'N'         TO PV-ACTV-IND      06900000
069100                             PERFORM 8200-UPDATE-SHPUNT           06910000
069200                             PERFORM 8250-INACT-TSUCRDV           06920000
069300***                  INSERT NEW INACTIVE RECORD - SUCRDV          06930000
069400                             PERFORM 2600-MOVE-DIVERT-DATA        06940000
069500                             MOVE 'I'         TO  SUCRDV-ACTV-CDE 06950000
069600                             PERFORM 7000-INSERT-TSUCRDV          06960000
069700****                 SELECT ALL CHILDREN SHPUNT                   06970000
069800                             MOVE 'A'         TO  SUCRDV-ACTV-CDE 06980000
069900                             MOVE 'Y'         TO PV-ACTV-IND      06990000
070000                             PERFORM 8300-PROCESS-CHILDREN        07000000
070100****                 INSERT ACTIVE DIVERT FOR EACH CHILD - SUCRDV 07010000
070200****                 INACTIVATE CHILDREN AND SET PRNT_CART_ID     07020000
070300****                       TO ZERO - SHPUNT                       07030000
070400****                 INACTIVATE PARENT - SHPUNT                   07040000
070500                         ELSE                                     07050000
070600                             PERFORM 2600-MOVE-DIVERT-DATA        07060000
070700                             PERFORM 7000-INSERT-TSUCRDV          07070000
070800                         END-IF                                   07080000
070900                     END-IF                                       07090000
071000                 END-IF                                           07100000
071100             ELSE                                                 07110000
071200                 IF CNDCDR-DOOR-TYP-CDE = 'NR'                    07120000
071300***    NO READS  - 105                                            07130000
071400                     MOVE '105'    TO DK-ERROR-CODE               07140000
071500                 ELSE                                             07150000
071600***    CONVEYOR TO CONVEYOR - 106                                 07160000
071700                     MOVE '106'    TO DK-ERROR-CODE               07170000
071800                 END-IF                                           07180000
071900                 PERFORM 7700-WRITE-UPLOAD-ERROR-TABLE            07190000
072000             END-IF                                               07200000
072100         END-IF                                                   07210000
072200     ELSE                                                         07220000
072300         MOVE '102'    TO DK-ERROR-CODE                           07230000
072400         PERFORM 7700-WRITE-UPLOAD-ERROR-TABLE                    07240000
072500     END-IF.                                                      07250000
072600                                                                  07260000
072700**   CHECK CARTON DATA                                            07270000
072800                                                                  07280000
072900*  IF ALL OPERATIONS WERE SUCCESSFUL UP TO THIS POINT, THIS       07290000
073000*  COMPLETES A LOGICAL UNIT OF WORK.  ABENDS WILL NOT INCLUDE     07300000
073100*  A ROLLBACK COMMAND BECAUSE ANY RETRANSMISSION WILL OVERLAY     07310000
073200*  THE PACK VALUES.                                               07320000
073300                                                                  07330000
073400     PERFORM 9000-SYNCPOINT.                                      07340000
073500                                                                  07350000
073600     PERFORM 2500-SEND-CONFIRMATION-QNX.                          07360000
073700*    MOVE PV-PARTIAL-TCP-COUNT TO PV-DISP-TCP-COUNT.              07370000
073800*    INITIALIZE PV-CICS-MSG-AREA.                                 07380000
073900*    STRING ' SUKCS557: 2000- COUNT = '                           07390000
074000*            PV-DISP-TCP-COUNT                                    07400000
074100*            ' CODE = '                                           07410000
074200*            DK-ERROR-CODE                                        07420000
074300*               DELIMITED BY SIZE                                 07430000
074400*                          INTO PV-CICS-MSG-AREA.                 07440000
074500*    PERFORM 9990-WRITE-CICS.                                     07450000
074600     IF PV-PARTIAL-TCP-COUNT > 4 AND                              07460000
074700        (DK-ERROR-CODE = '101' OR                                 07470000
074800         DK-ERROR-CODE = '102')                                   07480000
074900         SET PS-ERROR-RECEIVE TO TRUE                             07490000
075000     END-IF.                                                      07500000
075100                                                                  07510000
075200/                                                                 07520000
075300*----------------------------------------------------------------*07530000
075400*    RECEIVE THE DATA FROM THE PACK TO LIGHT SYSTEM.  THIS DATA  *07540000
075500*    WILL CONSIST OF A HEADER RECORD CONTAINING INFORMATION ON   *07550000
075600*    WHEN THE LINE WAS COMPLETED IN THE PACK TO LIGHT SYSTEM.    *07560000
075700*    DETAIL RECORDS ARE ALSO SENT FOR EACH STORE ON THE RECEIVER *07570000
075800*    LINE CONTAINING THE NUMBER OF PIECES PROCESSED.  A TRAILER  *07580000
075900*    RECORD IS SENT CONTAINING THE NUMBER OF STORE RECORDS THAT  *07590000
076000*    WERE SENT TO BE USED FOR CROSS-CHECK VALIDATION.            *07600000
076100*----------------------------------------------------------------*07610000
076200 2100-RECEIVE-DATA-FROM-QNX.                                      07620000
076300                                                                  07630000
076400     MOVE ' 2100-RECEIVE-DATA-FROM-QNX'                           07640000
076500                                 TO DP013-PARAGRAPH.              07650000
076600     SET PS-START-RECEIVE TO TRUE.                                07660000
076700     MOVE ZEROS   TO  PV-TCP-RET-LENGTH                           07670000
076800                      PV-TCP-REM-LENGTH                           07680000
076900                      PV-TCP-PRCSD-LENGTH.                        07690000
077000     MOVE SPACES  TO  TCP-BUF2                                    07700000
077100                      PT-TCP-RECEIVE-TABLE                        07710000
077200                      PT-TCP-ASSEMBLE-TABLE.                      07720000
077300     MOVE PV-TCP-EXP-LENGTH TO DP081-TCPLENG                      07730000
077400                               DP081-NBR-BYTES.                   07740000
077500                                                                  07750000
077600     PERFORM 3000-RECEIVE-TCP                                     07760000
077700         UNTIL PS-COMP-RECEIVE.                                   07770000
077800                                                                  07780000
077900     INITIALIZE SU014-CONV-DIVERT-RECORD.                         07790000
078000                                                                  07800000
078100     MOVE TCP-BUF2               TO SU014-CONV-DIVERT-RECORD.     07810000
078200                                                                  07820000
078300**!! DISPLAYS ADDED BY RON KRIER ON 09/15/1999 FROM HERE TO       07830000
078400**!! THE NEXT SET OF **!!                                         07840000
078500                                                                  07850000
078600* JUST FOR TESTING - BEGIN                                        07860000
078700*    INITIALIZE PV-CICS-MSG-AREA.                                 07870000
078800*    STRING ' SUKCS557:'                                          07880000
078900*         TCP-BUF2                                                07890000
079000*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA.                 07900000
079100*    PERFORM 9990-WRITE-CICS.                                     07910000
079200*                                                                 07920000
079300*    INITIALIZE PV-CICS-MSG-AREA.                                 07930000
079400*    MOVE DP081-RETCODE TO PV-RETCODE.                            07940000
079500*    MOVE DP081-TCPLENG TO PV-TCPLENG.                            07950000
079600*    MOVE DP081-ERRNO   TO PV-ERRNO.                              07960000
079700*                                                                 07970000
079800*    STRING ' SUKCS557:'                                          07980000
079900*         ' DC='                                                  07990000
080000*         SU014-DC-NUMBER                                         08000000
080100*         ' SEQ='                                                 08010000
080200*         SU014-MESSAGE-SEQ-NUMBER                                08020000
080300*         ' LIST='                                                08030000
080400*         SU014-LISTENER-CODE                                     08040000
080500*         ' BAR='                                                 08050000
080600*         SU014-BAR-CODE                                          08060000
080700*         ' DIV='                                                 08070000
080800*         SU014-DIVERT-NUMBER                                     08080000
080900*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA.                 08090000
081000*    PERFORM 9990-WRITE-CICS.                                     08100000
081100*    STRING ' SUKCS557:'                                          08110000
081200*         ' DAT='                                                 08120000
081300*         SU014-DATE                                              08130000
081400*         ' TIM='                                                 08140000
081500*         SU014-TIME                                              08150000
081600*         ' MSG='                                                 08160000
081700*         SU014-MESSAGE-NUMBER                                    08170000
081800*         ' RETCODE='                                             08180000
081900*         PV-RETCODE                                              08190000
082000*         ' TCPLENG='                                             08200000
082100*         PV-TCPLENG                                              08210000
082200*         ' ERRNO='                                               08220000
082300*         PV-ERRNO                                                08230000
082400*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA.                 08240000
082500*    PERFORM 9990-WRITE-CICS.                                     08250000
082600* JUST FOR TESTING - END                                          08260000
082700                                                                  08270000
082800     MOVE SU014-BAR-CODE         TO DK-BRCDE-NBR.                 08280000
084000                                                                  08400000
084100******************************************************************08410000
084200*2300-ADD-SHPUNT.                                                 08420000
084300*                                                                 08430000
084400*    MOVE ' 2300-ADD-SHPUNT'                                      08440000
084500*                                TO DP013-PARAGRAPH.              08450000
084600*    MOVE SU014-BAR-CODE              TO PV-CONTAINER-ID.         08460000
084700*    MOVE PV-SHIPT-UNT-ID             TO SUT00024-SHIPT-UNT-ID    08470000
084800*                                        DK-SHIPT-UNT-ID          08480000
084900*                                                                 08490000
085000*    PERFORM 7600-SELECT-OTBND-CART.                              08500000
085100*    IF PS-OTBND-CART-FOUND-YES                                   08510000
085200*        PERFORM 7400-FIND-UPC-NBR                                08520000
085300*        PERFORM 7500-INSERT-TSHUUPC                              08530000
085400*    ELSE                                                         08540000
085500*        PERFORM 2400-CREATE-CONTAINER-ENTRIES                    08550000
085600*    END-IF.                                                      08560000
085700                                                                  08570000
085800*                                                                 08580000
085900*2400-CREATE-CONTAINER-ENTRIES.                                   08590000
086000*    MOVE ' 2400-CREATE-CONTAINER-ENTRIES'                        08600000
086100*                                TO DP013-PARAGRAPH.              08610000
086200*    MOVE 'Y'                    TO SUT00024-ACTV-IND.            08620000
086300*    PERFORM 7300-INSERT-OTBND-CART                               08630000
086400*    PERFORM 7400-FIND-UPC-NBR                                    08640000
086500*    PERFORM 7500-INSERT-TSHUUPC.                                 08650000
086600                                                                  08660000
086700*----------------------------------------------------------------*08670000
086800*    SEND A CONFIRMATION RECORD TO THE PACK TO LIGHT SYSTEM TO   *08680000
086900*    POSITIVELY ACKNOWLEDGE THE RECEIPT OF A RECORD FROM THEM.   *08690000
087000*----------------------------------------------------------------*08700000
087100 2500-SEND-CONFIRMATION-QNX.                                      08710000
087200                                                                  08720000
087300     MOVE ' 2500-SEND-CONFIRMATION-QNX'                           08730000
087400                                 TO DP013-PARAGRAPH.              08740000
087500* JUST FOR TESTING - BEGIN                                        08750000
087600*    STRING '2500-SEND-CONFIRMATION-QNX' DELIMITED BY SIZE        08760000
087700*    INTO PV-CICS-MSG-AREA.                                       08770000
087800*    PERFORM 9990-WRITE-CICS.                                     08780000
087900* JUST FOR TESTING - END                                          08790000
088000                                                                  08800000
088100     MOVE SPACES              TO TCP-BUF2.                        08810000
088200     MOVE SU014-DC-NUMBER     TO SU015-DC-NUMBER.                 08820000
088300     MOVE SU014-MESSAGE-SEQ-NUMBER                                08830000
088400                              TO SU015-MESSAGE-SEQ-NUMBER.        08840000
088500     SET SU015-ACKNOWLEDGE    TO TRUE                             08850000
088600     MOVE PC-CR               TO SU015-CARRIAGE-RETURN.           08860000
088700     MOVE SU015-CONV-DIVERT-RECORD TO TCP-BUF.                    08870000
088800     MOVE 14                  TO                                  08880000
088900                                 DP081-NBR-BYTES                  08890000
089000                                 DP081-TCPLENG.                   08900000
089100                                                                  08910000
089200* JUST FOR TESTING - BEGIN                                        08920000
089300*    INITIALIZE PV-CICS-MSG-AREA.                                 08930000
089400*    STRING ' SUKCS557:SEND GOOD CONFIRM '                        08940000
089500*                 TCP-BUF                                         08950000
089600*     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA.                    08960000
089700*     PERFORM 9990-WRITE-CICS.                                    08970000
089800* JUST FOR TESTING - BEGIN                                        08980000
089900                                                                  08990000
090000* TRANSLATE EBCDIC TO ASCII                                       09000000
090100     CALL 'EZACIC04'                                              09010000
090200         USING  DP081-TOASCII-TOKEN                               09020000
090300                TCP-BUF                                           09030000
090400                DP081-TCPLENG.                                    09040000
090500                                                                  09050000
090600* WRITE DATA ON A CONNECTED SOCKET                                09060000
090700     CALL 'EZASOKET'                                              09070000
090800         USING                                                    09080000
090900                DP081-WRITE-CMD                                   09090000
091000                DP081-SOCK-ID                                     09100000
091100                DP081-NBR-BYTES                                   09110000
091200                TCP-BUF                                           09120000
091300                DP081-ERRNO                                       09130000
091400                DP081-RETCODE.                                    09140000
091500*                                                                 09150000
091600*                                                                 09160000
091700     IF DP081-RETCODE < ZERO                                      09170000
091800         INITIALIZE PV-CICS-MSG-AREA                              09180000
091900         STRING ' SUKCS557 - '                                    09190000
092000                '1400- BAD RETURN CODE      '                     09200000
092100                     TCP-BUF                                      09210000
092200         DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  09220000
092300         PERFORM 9990-WRITE-CICS                                  09230000
092400         MOVE PC-CURRENT-PGM-NAME TO DP081-TCP-IP-PGM-NAME        09240000
092500         SET  DP081-TCP-IP-SEND-TO-ERR TO TRUE                    09250000
092600*        MOVE DP081-ERRNO         TO DP081-TCP-IP-ERR-NBR         09260000
092700*   THE DP081-TCP-IP-ERR-NBR FIELD IS MULTIPLIED BY 10 BECAUSE THE09270000
092800*   DP081-TCP-IP-LOGGING-MSG GROUP LEVEL IS 80 CHARACTERS.  THIS  09280000
092900*   IS TRUNCATED TO 79 CHARACTERS WHEN MOVED TO THE               09290000
093000*   DP013-MESSAGE-TEXT GROUP LEVEL.                               09300000
093100         COMPUTE DP081-TCP-IP-ERR-NBR = DP081-ERRNO * 10          09310000
093200         SET  DP013-OTHER-ABEND   TO TRUE                         09320000
093300         SET  DP013-NO-ROLLBACK   TO TRUE                         09330000
093400         MOVE ' 2500-SEND-CONFIRMATION-QNX'                       09340000
093500             TO DP013-PARAGRAPH                                   09350000
093600         MOVE DP081-TCP-IP-LOGGING-MSG TO DP013-MESSAGE-TEXT (1)  09360000
093700         PERFORM 9999-WRITE-CICS-LOG-MSG                          09370000
093800     END-IF.                                                      09380000
093900/                                                                 09390000
094000                                                                  09400000
094100*----------------------------------------------------------------*09410000
094200 2600-MOVE-DIVERT-DATA.                                           09420000
094300     MOVE ' 2600-MOVE-DIVERT-DATA'                                09430000
094400                                 TO DP013-PARAGRAPH.              09440000
094500     INITIALIZE DCLTSUCRDV.                                       09450000
094600     MOVE SU014-DC-NUMBER          TO  SUCRDV-OPER-UNT-ID         09460000
094700     MOVE SU014-BAR-CODE           TO  PV-CONTAINER-ID.           09470000
094800     MOVE PV-SHIPT-UNT-ID          TO  SUCRDV-SHIPT-UNT-ID        09480000
094900                                       PV-SHIPT-UNT-ID-REDEF.     09490000
095000     MOVE PV-STORE-NUMBER          TO  SUCRDV-DEST-OPER-UNT-ID.   09500000
095100     MOVE SU014-BAR-CODE           TO  SUCRDV-BRCDE-NBR.          09510000
095200     MOVE SU014-DIVERT-NUMBER      TO  SUCRDV-DIVERT-NBR.         09520000
095300     MOVE SU014-DOOR-NUMBER        TO  SUCRDV-DIVERT-LOC-ID.      09530000
095400     MOVE 'A'                      TO  SUCRDV-ACTV-CDE.           09540000
095500     MOVE CNDCDR-DOOR-ID           TO  SUCRDV-DOOR-ID.            09550000
095600     MOVE SU014-DATE (1:4)         TO  PV-DATE-CCYY.              09560000
095700     MOVE SU014-DATE (5:2)         TO  PV-DATE-MM.                09570000
095800     MOVE SU014-DATE (7:2)         TO  PV-DATE-DD.                09580000
095900     MOVE PV-DATE                  TO  SUCRDV-DIVERT-SYS-DTE.     09590000
096000     MOVE SU014-TIME (1:2)         TO  PV-TIME-HH.                09600000
096100     MOVE SU014-TIME (3:2)         TO  PV-TIME-MM.                09610000
096200     MOVE SU014-TIME (5:2)         TO  PV-TIME-SS.                09620000
096300     MOVE PV-TIME                  TO  SUCRDV-DIVERT-SYS-TM.      09630000
096400     MOVE SU014-MESSAGE-SEQ-NUMBER TO  SUCRDV-BTCH-NBR.           09640000
096500*----------------------------------------------------------------*09650000
096600*    THIS PARAGRAPH WILL CONTROL THE RECEIVES TO CAPTURE ALL     *09660000
096700*    OF THE DATA BEING PASSED TO THE MAINFRAME FROM THE QNX      *09670000
096800*    SYSTEM.  THIS PARAGRAPH IS WRITTEN WITH THE UNDERSTANDING   *09680000
096900*    THAT A RECEIVE COMMAND MAY OR MAY NOT BRING BACK AN ENTIRE  *09690000
097000*    SOCKET PACKET OF DATA.  WE ARE EXPECTING A BLOCK OF 50      *09700000
097100*    CHARACTERS TO BE RECEIVED, HOWEVER, IF LESS THAN 50 ARE     *09710000
097200*    RECEIVED, THEN THIS PARAGRAPH WILL LOOP UNTIL THE ENTIRE    *09720000
097300*    FIFTY IS RECEIVED.                                          *09730000
097400*----------------------------------------------------------------*09740000
097500                                                                  09750000
097600 3000-RECEIVE-TCP.                                                09760000
097700                                                                  09770000
097800     MOVE ' 3000-RECEIVE-TCP'                                     09780000
097900                                 TO DP013-PARAGRAPH.              09790000
098000* JUST FOR TESTING - BEGIN                                        09800000
098100*    STRING '3000-RECEIVE-TCP' DELIMITED BY SIZE                  09810000
098200*    INTO PV-CICS-MSG-AREA                                        09820000
098300*    PERFORM 9990-WRITE-CICS                                      09830000
098400* JUST FOR TESTING - END                                          09840000
098500                                                                  09850000
098600     CALL 'EZASOKET'                                              09860000
098700         USING                                                    09870000
098800                DP081-RECV-CMD                                    09880000
098900                DP081-SOCK-ID                                     09890000
099000                DP081-FLAG                                        09900000
099100                DP081-NBR-BYTES                                   09910000
099200                TCP-BUF                                           09920000
099300                DP081-ERRNO                                       09930000
099400                DP081-RETCODE.                                    09940000
099500                                                                  09950000
099600                                                                  09960000
099700     IF  DP081-RETCODE < ZERO                                     09970000
099800         SET PS-ERROR-RECEIVE TO TRUE                             09980000
099900         PERFORM 3300-SEND-ERROR-CONFIRM-QNX                      09990000
100000         PERFORM 1500-CLOSE-SOCKET                                10000000
100100         MOVE PC-CURRENT-PGM-NAME TO DP081-TCP-IP-PGM-NAME        10010000
100200         SET  DP081-TCP-IP-READ-ERR TO TRUE                       10020000
100300*        MOVE DP081-ERRNO         TO DP081-TCP-IP-ERR-NBR         10030000
100400*   THE DP081-TCP-IP-ERR-NBR FIELD IS MULTIPLIED BY 10 BECAUSE THE10040000
100500*   DP081-TCP-IP-LOGGING-MSG GROUP LEVEL IS 80 CHARACTERS.  THIS  10050000
100600*   IS TRUNCATED TO 79 CHARACTERS WHEN MOVED TO THE               10060000
100700*   DP013-MESSAGE-TEXT GROUP LEVEL.                               10070000
100800         COMPUTE DP081-TCP-IP-ERR-NBR = DP081-ERRNO * 10          10080000
100900         SET  DP013-OTHER-ABEND   TO TRUE                         10090000
101000         SET  DP013-NO-ROLLBACK   TO TRUE                         10100000
101100         MOVE ' 3000-RECEIVE-TCP'                                 10110000
101200             TO DP013-PARAGRAPH                                   10120000
101300         MOVE DP081-TCP-IP-LOGGING-MSG TO DP013-MESSAGE-TEXT (1)  10130000
101400         PERFORM 9999-WRITE-CICS-LOG-MSG                          10140000
101500     ELSE                                                         10150000
101600         IF  DP081-RETCODE = 0                                    10160000
101700             INITIALIZE PV-CICS-MSG-AREA                          10170000
101800             SET PS-ERROR-RECEIVE TO TRUE                         10180000
101900             MOVE DP081-RETCODE TO PV-RETCODE                     10190000
102000             MOVE DP081-NBR-BYTES TO PV-TCPLENG                   10200000
102100             MOVE DP081-ERRNO   TO PV-ERRNO                       10210000
102200             STRING ' SUKCS557:'                                  10220000
102300                  'SOCKET ERROR EQ 0'                             10230000
102400                  ' RETCODE='                                     10240000
102500                  PV-RETCODE                                      10250000
102600                  ' TCPLENG='                                     10260000
102700                  PV-TCPLENG                                      10270000
102800                  ' ERRNO='                                       10280000
102900                  PV-ERRNO                                        10290000
103000                 DELIMITED BY SIZE INTO PV-CICS-MSG-AREA          10300000
103100             PERFORM 9990-WRITE-CICS                              10310000
103200             MOVE PC-CURRENT-PGM-NAME TO DP081-TCP-IP-PGM-NAME    10320000
103300             SET  DP081-TCP-IP-READ-ERR TO TRUE                   10330000
103400*            MOVE DP081-ERRNO         TO DP081-TCP-IP-ERR-NBR     10340000
103500*   THE DP081-TCP-IP-ERR-NBR FIELD IS MULTIPLIED BY 10 BECAUSE THE10350000
103600*   DP081-TCP-IP-LOGGING-MSG GROUP LEVEL IS 80 CHARACTERS.  THIS  10360000
103700*   IS TRUNCATED TO 79 CHARACTERS WHEN MOVED TO THE               10370000
103800*   DP013-MESSAGE-TEXT GROUP LEVEL.                               10380000
103900             COMPUTE DP081-TCP-IP-ERR-NBR = DP081-ERRNO * 10      10390000
104000             SET  DP013-OTHER-ABEND   TO TRUE                     10400000
104100             SET  DP013-NO-ROLLBACK   TO TRUE                     10410000
104200             MOVE ' 3000-RECEIVE-TCP'                             10420000
104300                 TO DP013-PARAGRAPH                               10430000
104400             MOVE DP081-TCP-IP-LOGGING-MSG                        10440000
104500                                      TO DP013-MESSAGE-TEXT (1)   10450000
104600             PERFORM 9999-WRITE-CICS-LOG-MSG                      10460000
104700         ELSE                                                     10470000
104800             MOVE DP081-RETCODE TO PV-TCP-RET-LENGTH              10480000
104900             IF  PV-TCP-RET-LENGTH = PV-TCP-EXP-LENGTH            10490000
105000                 SET PS-COMP-RECEIVE TO TRUE                      10500000
105100*                BEGIN OF TRANSLATE ASCII TO EBCDIC               10510000
105200                 CALL 'EZACIC05'                                  10520000
105300                     USING  DP081-TOEBCDIC-TOKEN                  10530000
105400                            TCP-BUF2                              10540000
105500                            DP081-NBR-BYTES                       10550000
105600*                END OF TRANSLATE ASCII TO EBCDIC                 10560000
105700                                                                  10570000
105800* JUST FOR TESTING - BEGIN                                        10580000
105900*                INITIALIZE PV-CICS-MSG-AREA                      10590000
106000*                STRING ' SUKCS557:GOOD RECEIVE '                 10600000
106100*                     TCP-BUF                                     10610000
106200*                    DELIMITED BY SIZE INTO PV-CICS-MSG-AREA      10620000
106300*                PERFORM 9990-WRITE-CICS                          10630000
106400*                MOVE DP081-NBR-BYTES   TO PV-NBR-BYTES           10640000
106500*                INITIALIZE PV-CICS-MSG-AREA                      10650000
106600*                STRING ' SUKCS557:NBR OF BYTES '                 10660000
106700*                     PV-NBR-BYTES                                10670000
106800*                    DELIMITED BY SIZE INTO PV-CICS-MSG-AREA      10680000
106900*                PERFORM 9990-WRITE-CICS                          10690000
107000* JUST FOR TESTING - BEGIN                                        10700000
107100                                                                  10710000
107200             ELSE                                                 10720000
107300                 IF  PV-TCP-RET-LENGTH > DP081-NBR-BYTES          10730000
107400                     SET PS-ERROR-RECEIVE TO TRUE                 10740000
107500                     PERFORM 1500-CLOSE-SOCKET                    10750000
107600                     INITIALIZE PV-CICS-MSG-AREA                  10760000
107700                     MOVE DP081-RETCODE TO PV-RETCODE             10770000
107800                     MOVE DP081-NBR-BYTES TO PV-TCPLENG           10780000
107900                     MOVE DP081-ERRNO   TO PV-ERRNO               10790000
108000                     STRING ' SUKCS557:'                          10800000
108100                          'SOCKET LENGTH ERROR #1'                10810000
108200                          ' RETCODE='                             10820000
108300                          PV-RETCODE                              10830000
108400                          ' DP081-NBR-BYTES='                     10840000
108500                          PV-TCPLENG                              10850000
108600                          ' ERRNO='                               10860000
108700                          PV-ERRNO                                10870000
108800                         DELIMITED BY SIZE INTO PV-CICS-MSG-AREA  10880000
108900                     PERFORM 9990-WRITE-CICS                      10890000
109000*                    BEGIN OF TRANSLATE ASCII TO EBCDIC           10900000
109100                     CALL 'EZACIC05'                              10910000
109200                         USING  DP081-TOEBCDIC-TOKEN              10920000
109300                                TCP-BUF2                          10930000
109400                                DP081-NBR-BYTES                   10940000
109500*                    END OF TRANSLATE ASCII TO EBCDIC             10950000
109600                                                                  10960000
109700* JUST FOR TESTING - BEGIN                                        10970000
109800*                    INITIALIZE PV-CICS-MSG-AREA                  10980000
109900*                    STRING ' SUKCS557:'                          10990000
110000*                         TCP-BUF2                                11000000
110100*                        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA  11010000
110200*                    PERFORM 9990-WRITE-CICS                      11020000
110300* JUST FOR TESTING - END                                          11030000
110400                                                                  11040000
110500                     MOVE PC-CURRENT-PGM-NAME TO                  11050000
110600                                            DP081-TCP-IP-PGM-NAME 11060000
110700                     SET  DP081-TCP-IP-READ-ERR TO TRUE           11070000
110800*                    MOVE DP081-ERRNO         TO                  11080000
110900*                                            DP081-TCP-IP-ERR-NBR 11090000
111000*   THE DP081-TCP-IP-ERR-NBR FIELD IS MULTIPLIED BY 10 BECAUSE THE11100000
111100*   DP081-TCP-IP-LOGGING-MSG GROUP LEVEL IS 80 CHARACTERS.  THIS  11110000
111200*   IS TRUNCATED TO 79 CHARACTERS WHEN MOVED TO THE               11120000
111300*   DP013-MESSAGE-TEXT GROUP LEVEL.                               11130000
111400                     COMPUTE DP081-TCP-IP-ERR-NBR =               11140000
111500                                            DP081-ERRNO * 10      11150000
111600                     SET  DP013-OTHER-ABEND   TO TRUE             11160000
111700                     SET  DP013-NO-ROLLBACK   TO TRUE             11170000
111800                     MOVE ' 3000-RECEIVE-TCP'                     11180000
111900                         TO DP013-PARAGRAPH                       11190000
112000                     MOVE DP081-TCP-IP-LOGGING-MSG TO             11200000
112100                          DP013-MESSAGE-TEXT (1)                  11210000
112200                     PERFORM 9999-WRITE-CICS-LOG-MSG              11220000
112300                 ELSE                                             11230000
112400                     ADD 1 TO PV-PARTIAL-TCP-COUNT                11240000
112500                     PERFORM 3100-PROCESS-PARTIAL-TCP             11250000
112600                 END-IF                                           11260000
112700             END-IF                                               11270000
112800         END-IF                                                   11280000
112900     END-IF.                                                      11290000
113000                                                                  11300000
113100*----------------------------------------------------------------*11310000
113200*    THIS PARAGRAPH WILL BE USED WHEN WHAT IS RECEIVED VIA A     *11320000
113300*    SOCKET IS LESS THAN WHAT WAS EXPECTED TO BE RETURNED.       *11330000
113400*    THIS PARAGRAPH WILL DETERMINE IF THE PARTIAL IS A FIRST     *11340000
113500*    RECEIPT OF A NEW PACKET OR AN ADDITIONAL RECEIPT OF A       *11350000
113600*    PACKAGE AND THEN TAKE THE RECEIVED DATA AND CHARACTER BY    *11360000
113700*    CHARACTER MOVE FROM THE RECEIVED FIELD TO THE ASSEMBLE      *11370000
113800*    FIELD IN ORDER TO BUILD THE SOCKET PACKET OVER MULTIPLE     *11380000
113900*    RECEIVE COMMANDS.                                           *11390000
114000*----------------------------------------------------------------*11400000
114100                                                                  11410000
114200 3100-PROCESS-PARTIAL-TCP.                                        11420000
114300     MOVE ' 3100-PROCESS-PARTIAL-TCP'                             11430000
114400                                 TO DP013-PARAGRAPH.              11440000
114500     INITIALIZE PV-CICS-MSG-AREA.                                 11450000
114600     MOVE ' SUKCS557: 3100-PROCESS-PARTIAL-TCP'                   11460000
114700                             TO PV-CICS-MSG-AREA.                 11470000
114800     PERFORM 9990-WRITE-CICS.                                     11480000
114900     IF  PS-START-RECEIVE                                         11490000
115000         SET PS-PART-RECEIVE TO TRUE                              11500000
115100         SET PT-ASSEMBLE-IDX TO 1                                 11510000
115200         MOVE ZEROS TO PV-TCP-PRCSD-LENGTH                        11520000
115300     END-IF.                                                      11530000
115400                                                                  11540000
115500     ADD PV-TCP-RET-LENGTH TO PV-TCP-PRCSD-LENGTH.                11550000
115600                                                                  11560000
115700     IF  PV-TCP-PRCSD-LENGTH > PV-TCP-EXP-LENGTH                  11570000
115800         PERFORM 1500-CLOSE-SOCKET                                11580000
115900         INITIALIZE PV-CICS-MSG-AREA                              11590000
116000         MOVE DP081-RETCODE TO PV-RETCODE                         11600000
116100         MOVE DP081-NBR-BYTES TO PV-TCPLENG                       11610000
116200         MOVE DP081-ERRNO   TO PV-ERRNO                           11620000
116300         STRING ' SUKCS557:'                                      11630000
116400              'SOCKET TOTAL LENGTH ERROR'                         11640000
116500              ' RETCODE='                                         11650000
116600              PV-RETCODE                                          11660000
116700              ' TOTLENG='                                         11670000
116800              PV-TCP-PRCSD-LENGTH                                 11680000
116900              ' ERRNO='                                           11690000
117000              PV-ERRNO                                            11700000
117100             DELIMITED BY SIZE INTO PV-CICS-MSG-AREA              11710000
117200         PERFORM 9990-WRITE-CICS                                  11720000
117300*        BEGIN OF TRANSLATE ASCII TO EBCDIC                       11730000
117400         CALL 'EZACIC05'                                          11740000
117500             USING  DP081-TOEBCDIC-TOKEN                          11750000
117600                    TCP-BUF2                                      11760000
117700                    DP081-NBR-BYTES                               11770000
117800*        END OF TRANSLATE ASCII TO EBCDIC                         11780000
117900                                                                  11790000
118000* JUST FOR TESTING - BEGIN                                        11800000
118100*        INITIALIZE PV-CICS-MSG-AREA                              11810000
118200*        STRING ' SUKCS557:'                                      11820000
118300*             TCP-BUF2                                            11830000
118400*            DELIMITED BY SIZE INTO PV-CICS-MSG-AREA              11840000
118500*        PERFORM 9990-WRITE-CICS                                  11850000
118600* JUST FOR TESTING - END                                          11860000
118700                                                                  11870000
118800         MOVE PC-CURRENT-PGM-NAME TO DP081-TCP-IP-PGM-NAME        11880000
118900         SET  DP081-TCP-IP-READ-ERR TO TRUE                       11890000
119000*        MOVE DP081-ERRNO         TO DP081-TCP-IP-ERR-NBR         11900000
119100*   THE DP081-TCP-IP-ERR-NBR FIELD IS MULTIPLIED BY 10 BECAUSE THE11910000
119200*   DP081-TCP-IP-LOGGING-MSG GROUP LEVEL IS 80 CHARACTERS.  THIS  11920000
119300*   IS TRUNCATED TO 79 CHARACTERS WHEN MOVED TO THE               11930000
119400*   DP013-MESSAGE-TEXT GROUP LEVEL.                               11940000
119500         COMPUTE DP081-TCP-IP-ERR-NBR = DP081-ERRNO * 10          11950000
119600         SET  DP013-OTHER-ABEND   TO TRUE                         11960000
119700         SET  DP013-NO-ROLLBACK   TO TRUE                         11970000
119800         MOVE ' 3100-PROCESS-PARTIAL-TCP'                         11980000
119900             TO DP013-PARAGRAPH                                   11990000
120000         MOVE DP081-TCP-IP-LOGGING-MSG TO                         12000000
120100              DP013-MESSAGE-TEXT (1)                              12010000
120200         PERFORM 9999-WRITE-CICS-LOG-MSG                          12020000
120300     END-IF.                                                      12030000
120400                                                                  12040000
120500*  DISPLAYS ADDED TO DISPLAY A PARTIAL SOCKET RECEIVE             12050000
120600*  \/                                                             12060000
120700                                                                  12070000
120800     INITIALIZE PV-CICS-MSG-AREA.                                 12080000
120900     MOVE DP081-RETCODE TO PV-RETCODE.                            12090000
121000     MOVE DP081-NBR-BYTES TO PV-TCPLENG.                          12100000
121100     MOVE DP081-ERRNO   TO PV-ERRNO.                              12110000
121200                                                                  12120000
121300* JUST FOR TESTING - BEGIN                                        12130000
121400*    STRING ' SUKCS557:'                                          12140000
121500*         'SOCKET PARTIAL RECEIVE'                                12150000
121600*         ' RETCODE='                                             12160000
121700*         PV-RETCODE                                              12170000
121800*         ' TCPLENG='                                             12180000
121900*         PV-TCPLENG                                              12190000
122000*         ' ERRNO='                                               12200000
122100*         PV-ERRNO                                                12210000
122200*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA.                 12220000
122300*    PERFORM 9990-WRITE-CICS.                                     12230000
122400* JUST FOR TESTING - END                                          12240000
122500                                                                  12250000
122600*        BEGIN OF TRANSLATE ASCII TO EBCDIC                       12260000
122700     MOVE TCP-BUF TO PV-TCP-BUF.                                  12270000
122800     CALL 'EZACIC05'                                              12280000
122900         USING  DP081-TOEBCDIC-TOKEN                              12290000
123000                PV-TCP-BUF                                        12300000
123100                DP081-NBR-BYTES.                                  12310000
123200*        END OF TRANSLATE ASCII TO EBCDIC                         12320000
123300                                                                  12330000
123400* JUST FOR TESTING - BEGIN                                        12340000
123500*    INITIALIZE PV-CICS-MSG-AREA.                                 12350000
123600*    STRING ' SUKCS557:'                                          12360000
123700*         PV-TCP-BUF                                              12370000
123800*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA.                 12380000
123900*    PERFORM 9990-WRITE-CICS.                                     12390000
124000* JUST FOR TESTING - END                                          12400000
124100                                                                  12410000
124200*  /\                                                             12420000
124300*  DISPLAYS ADDED TO DISPLAY A PARTIAL SOCKET RECEIVE             12430000
124400                                                                  12440000
124500     MOVE TCP-BUF TO PT-TCP-RECEIVE-TABLE.                        12450000
124600                                                                  12460000
124700     PERFORM 3200-ASSEMBLE-DATA                                   12470000
124800         VARYING PT-RECEIVE-IDX FROM 1 BY 1                       12480000
124900             UNTIL PT-RECEIVE-IDX > PV-TCP-RET-LENGTH.            12490000
125000                                                                  12500000
125100     IF  PV-TCP-PRCSD-LENGTH = PV-TCP-EXP-LENGTH                  12510000
125200         SET PS-COMP-RECEIVE TO TRUE                              12520000
125300         MOVE SPACES TO TCP-BUF2                                  12530000
125400         MOVE PT-TCP-ASSEMBLE-TABLE TO TCP-BUF                    12540000
125500         MOVE PV-TCP-EXP-LENGTH TO DP081-NBR-BYTES                12550000
125600*        BEGIN OF TRANSLATE ASCII TO EBCDIC                       12560000
125700         CALL 'EZACIC05'                                          12570000
125800             USING  DP081-TOEBCDIC-TOKEN                          12580000
125900                    TCP-BUF2                                      12590000
126000                    DP081-NBR-BYTES                               12600000
126100*        END OF TRANSLATE ASCII TO EBCDIC                         12610000
126200                                                                  12620000
126300* JUST FOR TESTING - BEGIN                                        12630000
126400*        INITIALIZE PV-CICS-MSG-AREA                              12640000
126500*        STRING ' SUKCS557:STRUNG DATA  '                         12650000
126600*             TCP-BUF2                                            12660000
126700*            DELIMITED BY SIZE INTO PV-CICS-MSG-AREA              12670000
126800*        PERFORM 9990-WRITE-CICS                                  12680000
126900* JUST FOR TESTING - END                                          12690000
127000                                                                  12700000
127100     ELSE                                                         12710000
127200         SUBTRACT PV-TCP-PRCSD-LENGTH FROM                        12720000
127300                  PV-TCP-EXP-LENGTH   GIVING                      12730000
127400                  PV-TCP-REM-LENGTH                               12740000
127500         MOVE PV-TCP-REM-LENGTH TO DP081-NBR-BYTES                12750000
127600                                                                  12760000
127700* JUST FOR TESTING - BEGIN                                        12770000
127800*        INITIALIZE PV-CICS-MSG-AREA                              12780000
127900*        STRING ' SUKCS557:'                                      12790000
128000*             'SOCKET GET MORE LENGTH'                            12800000
128100*             ' PRCSD='                                           12810000
128200*             PV-TCP-PRCSD-LENGTH                                 12820000
128300*             ' EXPECT='                                          12830000
128400*             PV-TCP-EXP-LENGTH                                   12840000
128500*             ' REMAIN='                                          12850000
128600*             PV-TCP-REM-LENGTH                                   12860000
128700*            DELIMITED BY SIZE INTO PV-CICS-MSG-AREA              12870000
128800*        PERFORM 9990-WRITE-CICS                                  12880000
128900* JUST FOR TESTING - END                                          12890000
129000                                                                  12900000
129100     END-IF.                                                      12910000
129200                                                                  12920000
129300                                                                  12930000
129400*----------------------------------------------------------------*12940000
129500*    THIS PARAGRAPH WILL ASSEMBLE THE DATA THAT WAS RECEIVED     *12950000
129600*    WITH THE DATA RECEIVED FROM PREVIOUS RECEIVES FOR THE       *12960000
129700*    SOCKET PACKET.                                              *12970000
129800*----------------------------------------------------------------*12980000
129900                                                                  12990000
130000 3200-ASSEMBLE-DATA.                                              13000000
130100                                                                  13010000
130200     MOVE ' 3200-ASSEMBLE-DATA'                                   13020000
130300                                 TO DP013-PARAGRAPH.              13030000
130400     MOVE PT-TCP-RECEIVE-CHAR (PT-RECEIVE-IDX) TO                 13040000
130500          PT-TCP-DATA-CHAR (PT-ASSEMBLE-IDX).                     13050000
130600     SET PT-ASSEMBLE-IDX UP BY 1.                                 13060000
130700                                                                  13070000
130800                                                                  13080000
130900*----------------------------------------------------------------*13090000
131000*    SEND AN ERROR CONFIRMATION RECORD TO THE PACK TO LIGHT      *13100000
131100*    SYSTEM, INDICATING THERE WAS AN ERROR WITH THE DATA WE      *13110000
131200*    RECEIVED FROM THEM.                                         *13120000
131300*----------------------------------------------------------------*13130000
131400 3300-SEND-ERROR-CONFIRM-QNX.                                     13140000
131500                                                                  13150000
131600     MOVE ' 3300-SEND-ERROR-CONFIRM-QNX'                          13160000
131700                                 TO DP013-PARAGRAPH.              13170000
131800* JUST FOR TESTING - BEGIN                                        13180000
131900*    STRING '3300-SEND-ERROR-CONFIRM-QNX' DELIMITED BY SIZE       13190000
132000*    INTO PV-CICS-MSG-AREA                                        13200000
132100*    PERFORM 9990-WRITE-CICS                                      13210000
132200* JUST FOR TESTING - END                                          13220000
132300                                                                  13230000
132400     MOVE SPACES              TO TCP-BUF2.                        13240000
132500     MOVE SU014-DC-NUMBER     TO SU015-DC-NUMBER.                 13250000
132600     MOVE SU014-MESSAGE-SEQ-NUMBER                                13260000
132700                              TO SU015-MESSAGE-SEQ-NUMBER.        13270000
132800     SET SU015-NEGATIVE-ACK   TO TRUE                             13280000
132900     MOVE SU015-CONV-DIVERT-RECORD TO TCP-BUF.                    13290000
133000     MOVE 14                  TO                                  13300000
133100                                 DP081-NBR-BYTES                  13310000
133200                                 DP081-TCPLENG.                   13320000
133300                                                                  13330000
133400* TRANSLATE EBCDIC TO ASCII                                       13340000
133500     CALL 'EZACIC04'                                              13350000
133600         USING  DP081-TOASCII-TOKEN                               13360000
133700                TCP-BUF                                           13370000
133800                DP081-TCPLENG.                                    13380000
133900                                                                  13390000
134000* WRITE DATA ON A CONNECTED SOCKET                                13400000
134100     CALL 'EZASOKET'                                              13410000
134200         USING                                                    13420000
134300                DP081-WRITE-CMD                                   13430000
134400                DP081-SOCK-ID                                     13440000
134500                DP081-NBR-BYTES                                   13450000
134600                TCP-BUF                                           13460000
134700                DP081-ERRNO                                       13470000
134800                DP081-RETCODE.                                    13480000
134900*                                                                 13490000
135000     IF DP081-RETCODE < ZERO                                      13500000
135100         MOVE PC-CURRENT-PGM-NAME TO DP081-TCP-IP-PGM-NAME        13510000
135200         SET  DP081-TCP-IP-SEND-TO-ERR TO TRUE                    13520000
135300*        MOVE DP081-ERRNO         TO DP081-TCP-IP-ERR-NBR         13530000
135400*   THE DP081-TCP-IP-ERR-NBR FIELD IS MULTIPLIED BY 10 BECAUSE THE13540000
135500*   DP081-TCP-IP-LOGGING-MSG GROUP LEVEL IS 80 CHARACTERS.  THIS  13550000
135600*   IS TRUNCATED TO 79 CHARACTERS WHEN MOVED TO THE               13560000
135700*   DP013-MESSAGE-TEXT GROUP LEVEL.                               13570000
135800         COMPUTE DP081-TCP-IP-ERR-NBR = DP081-ERRNO * 10          13580000
135900         SET  DP013-OTHER-ABEND   TO TRUE                         13590000
136000         SET  DP013-NO-ROLLBACK   TO TRUE                         13600000
136100         MOVE ' 3300-SEND-ERROR-CONFIRM-QNX'                      13610000
136200             TO DP013-PARAGRAPH                                   13620000
136300         MOVE DP081-TCP-IP-LOGGING-MSG TO DP013-MESSAGE-TEXT (1)  13630000
136400         PERFORM 9999-WRITE-CICS-LOG-MSG                          13640000
136500     END-IF.                                                      13650000
136600/                                                                 13660000
136700                                                                  13670000
136800*                                                                 13680000
136900*----------------------------------------------------------------*13690000
137000*    INSERT A ROW INTO THE TSUCRDV TABLE                         *13700000
137100*----------------------------------------------------------------*13710000
137200 7000-INSERT-TSUCRDV.                                             13720000
137300     MOVE ' 7000-INSERT-TSUCRDV'                                  13730000
137400                                 TO DP013-PARAGRAPH.              13740000
137500     MOVE 0       TO PV-PARTIAL-TCP-COUNT.                        13750000
137600     PERFORM                                                      13760000
137700         WITH TEST AFTER                                          13770000
137800         VARYING PV-RETRY-COUNTER                                 13780000
137900         FROM 1 BY 1                                              13790000
138000         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES)                13800000
138100             OR (SQLCODE = +0)                                    13810000
138200                                                                  13820000
138300                                                                  13830000
138400         EXEC SQL                                                 13840000
138500              INSERT INTO TSUCRDV                                 13850000
138600                     (OPER_UNT_ID                                 13860000
138700                   ,  DIVERT_NBR                                  13870000
138800                   ,  DIVERT_LOC_ID                               13880000
138900                   ,  DIVERT_TMST                                 13890000
139000                   ,  BRCDE_NBR                                   13900000
139100                   ,  PRC_RSN_CDE                                 13910000
139200                   ,  SHIPT_UNT_ID                                13920000
139300                   ,  BTCH_NBR                                    13930000
139400                   ,  BTCH_RVSN_NBR                               13940000
139500                   ,  ACTV_CDE                                    13950000
139600                   ,  NACTV_USR_ID                                13960000
139700                   ,  DOOR_ID                                     13970000
139800                   ,  DEST_OPER_UNT_ID                            13980000
139900                   ,  DIVERT_SYS_DTE                              13990000
140000                   ,  DIVERT_SYS_TM)                              14000000
140100              VALUES (                                            14010000
140200                      :SUCRDV-OPER-UNT-ID                         14020000
140300                   ,  :SUCRDV-DIVERT-NBR                          14030000
140400                   ,  :SUCRDV-DIVERT-LOC-ID                       14040000
140500                   ,  CURRENT TIMESTAMP                           14050000
140600                   ,  :SUCRDV-BRCDE-NBR                           14060000
140700                   ,  :SUCRDV-PRC-RSN-CDE                         14070000
140800                   ,  :SUCRDV-SHIPT-UNT-ID                        14080000
140900                   ,  :SUCRDV-BTCH-NBR                            14090000
141000                   ,  :SUCRDV-BTCH-RVSN-NBR                       14100000
141100                   ,  :SUCRDV-ACTV-CDE                            14110000
141200                   ,  :SUCRDV-NACTV-USR-ID                        14120000
141300                   ,  :SUCRDV-DOOR-ID                             14130000
141400                   ,  :SUCRDV-DEST-OPER-UNT-ID                    14140000
141500                   ,  :SUCRDV-DIVERT-SYS-DTE                      14150000
141600                   ,  :SUCRDV-DIVERT-SYS-TM)                      14160000
141700         END-EXEC                                                 14170000
141800                                                                  14180000
141900         EVALUATE TRUE                                            14190000
142000             WHEN SQLCODE = +0                                    14200000
142100             WHEN SQLCODE = -904                                  14210000
142200             WHEN SQLCODE = -911                                  14220000
142300             WHEN SQLCODE = -913                                  14230000
142400                  CONTINUE                                        14240000
142500                                                                  14250000
142600             WHEN SQLWARN0 NOT = SPACES                           14260000
142700             WHEN SQLCODE < +0                                    14270000
142800             WHEN SQLCODE > +0                                    14280000
142900                  MOVE ' 7000-INSERT-TSUCRDV'                     14290000
143000                                  TO DP013-PARAGRAPH              14300000
143100                  MOVE 'UNSUCCESSFUL SELECT ON TRECEIV  '         14310000
143200                                  TO DP013-MESSAGE-TEXT (1)       14320000
143300                  MOVE SU014-DC-NUMBER                            14330000
143400                                  TO DP013-MESSAGE-TEXT (2)       14340000
143500                  MOVE SU014-DIVERT-NUMBER                        14350000
143600                                  TO DP013-MESSAGE-TEXT (3)       14360000
143700                  MOVE PV-SHIPT-UNT-ID                            14370000
143800                                  TO DP013-MESSAGE-TEXT (4)       14380000
143900                  MOVE SQLCA      TO DP013-SQLCA                  14390000
144000                  MOVE 'TSUCRDV ' TO DP013-DB2-TABLE-NAME (1)     14400000
144100                  MOVE SQLCODE    TO PV-DISPLAY-SQLCODE           14410000
144200                  MOVE PV-DISPLAY-SQLCODE                         14420000
144300                                  TO DP013-DB2-TABLE-NAME (2)     14430000
144400                  SET DP013-DB2-ABEND                             14440000
144500                      DP013-ROLLBACK       TO TRUE                14450000
144600                  PERFORM 9999-WRITE-CICS-LOG-MSG                 14460000
144700         END-EVALUATE                                             14470000
144800     END-PERFORM.                                                 14480000
144900                                                                  14490000
145000                                                                  14500000
145100     IF  (PV-RETRY-COUNTER > PC-MAX-RETRIES) AND                  14510000
145200         (SQLCODE NOT = +0)                                       14520000
145300         PERFORM 3300-SEND-ERROR-CONFIRM-QNX                      14530000
145400         PERFORM 1500-CLOSE-SOCKET                                14540000
145500         MOVE ' 7000-INSERT-TSUCRDV'                              14550000
145600                                  TO DP013-PARAGRAPH              14560000
145700         MOVE 'MAX RETRIES EXCEEDED ON TRECEIV SELECT'            14570000
145800                                  TO DP013-MESSAGE-TEXT (1)       14580000
145900         MOVE SQLCA               TO DP013-SQLCA                  14590000
146000         MOVE 'TSUCRDV '          TO DP013-DB2-TABLE-NAME (1)     14600000
146100         SET DP013-DB2-ABEND                                      14610000
146200             DP013-ROLLBACK       TO TRUE                         14620000
146300         PERFORM 9999-WRITE-CICS-LOG-MSG                          14630000
146400     END-IF.                                                      14640000
146500                                                                  14650000
146600/                                                                 14660000
146700                                                                  14670000
146800 EJECT                                                            14680000
146900 7300-INSERT-OTBND-CART.                                          14690000
147000                                                                  14700000
147100     MOVE ' 7300-INSERT-OTBND-CART'                               14710000
147200                                 TO DP013-PARAGRAPH.              14720000
147300                                                                  14730000
147400     MOVE SU014-DC-NUMBER             TO SUT00024-ORGN-LOC-NBR.   14740000
147500     MOVE SU014-DC-NUMBER             TO SUT00024-DEST-LOC-NBR.   14750000
147600     MOVE 'RDM'                       TO SUT00024-CART-SRC-CDE.   14760000
147700     MOVE 'N'                         TO SUT00024-MSTR-CART-IND.  14770000
147800     MOVE ZERO                        TO SUT00024-ORIG-CART-ID.   14780000
147900     MOVE SPACES                      TO SUT00024-CRE-USR-ID.     14790000
148000     MOVE 'SUKCS557'                  TO SUT00024-CRE-PGM-NM.     14800000
148100     MOVE ZERO                        TO SUT00024-CART-RVSN-NBR.  14810000
148200     MOVE SU014-DATE                  TO PV-IN-DATE.              14820000
148300     MOVE PV-IN-DATE-CCYY             TO PV-DATE-CCYY.            14830000
148400     MOVE PV-IN-DATE-MM               TO PV-DATE-MM.              14840000
148500     MOVE PV-IN-DATE-DD               TO PV-DATE-DD.              14850000
148600     MOVE PV-DATE                     TO DK-DATE.                 14860000
148700     MOVE SU014-TIME                  TO PV-IN-TIME.              14870000
148800     MOVE PV-IN-TIME-HH               TO PV-TIME-HH.              14880000
148900     MOVE PV-IN-TIME-MM               TO PV-TIME-MM.              14890000
149000     MOVE PV-IN-TIME-SS               TO PV-TIME-SS.              14900000
149100     MOVE PV-TIME                     TO DK-TIME.                 14910000
149200                                                                  14920000
149300     PERFORM                                                      14930000
149400         WITH TEST AFTER                                          14940000
149500         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     14950000
149600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES) OR            14960000
149700                (SQLCODE = ZERO) OR (SQLCODE = -803))             14970000
149800                                                                  14980000
149900     EXEC SQL                                                     14990000
150000         INSERT INTO SUT_OTBND_CART                               15000000
150100             (SHIPT_UNT_ID                                        15010000
150200         ,    ORGN_LOC_NBR                                        15020000
150300         ,    DEST_LOC_NBR                                        15030000
150400         ,    CART_SRC_CDE                                        15040000
150500         ,    MSTR_CART_IND                                       15050000
150600         ,    PRNT_CART_ID                                        15060000
150700         ,    ORIG_CART_ID                                        15070000
150800         ,    ACTV_IND                                            15080000
150900         ,    CRE_DTE                                             15090000
151000         ,    CRE_TM                                              15100000
151100         ,    CRE_USR_ID                                          15110000
151200         ,    CRE_PGM_NM                                          15120000
151300         ,    CART_RVSN_NBR                                       15130000
151400         ,    CART_TYP_CDE                                        15140000
151500         ,    OTBND_TRIP_ID                                       15150000
151600         )                                                        15160000
151700             VALUES                                               15170000
151800            (:DK-SHIPT-UNT-ID                                     15180000
151900         ,   :SUT00024-ORGN-LOC-NBR                               15190000
152000         ,   :SUT00024-DEST-LOC-NBR                               15200000
152100         ,   :SUT00024-CART-SRC-CDE                               15210000
152200         ,   :SUT00024-MSTR-CART-IND                              15220000
152300         ,   :DK-SHIPT-UNT-ID                                     15230000
152400         ,   :SUT00024-ORIG-CART-ID                               15240000
152500         ,   :SUT00024-ACTV-IND                                   15250000
152600         ,   :DK-DATE                                             15260000
152700         ,   :DK-TIME                                             15270000
152800         ,   :SUT00024-CRE-USR-ID                                 15280000
152900         ,   'SUKCS557'                                           15290000
153000         ,   :SUT00024-CART-RVSN-NBR                              15300000
153100         ,   'S'                                                  15310000
153200         ,   0                                                    15320000
153300         )                                                        15330000
153400         END-EXEC                                                 15340000
153500                                                                  15350000
153600         EVALUATE TRUE                                            15360000
153700             WHEN SQLCODE = ZERO                                  15370000
153800             WHEN SQLCODE = -803                                  15380000
153900             WHEN SQLCODE = -904                                  15390000
154000             WHEN SQLCODE = -911                                  15400000
154100             WHEN SQLCODE = -913                                  15410000
154200                 CONTINUE                                         15420000
154300                                                                  15430000
154400             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              15440000
154500                 DISPLAY '**************************************' 15450000
154600                 DISPLAY 'WARNING ISSD ON INSRT OF SUT_OTBND_CART'15460000
154700                 DISPLAY 'SUT00024-SHIPT-UNT-ID =  '              15470000
154800                          DK-SHIPT-UNT-ID                         15480000
154900                 DISPLAY '**********************************'     15490000
155000                 PERFORM 9800-SQL-WARNING                         15500000
155100                                                                  15510000
155200             WHEN SQLCODE < ZERO                                  15520000
155300                 DISPLAY '**************************************' 15530000
155400                 DISPLAY 'ERROR ISSD ON INSRT OF SUT_OTBND_CART'  15540000
155500                 DISPLAY 'SUT00024-SHIPT-UNT-ID =  '              15550000
155600                          DK-SHIPT-UNT-ID                         15560000
155700                 DISPLAY 'DK-DATE = '                             15570000
155800                          DK-DATE                                 15580000
155900                 DISPLAY 'DK-TIME = '                             15590000
156000                          DK-TIME                                 15600000
156100                 DISPLAY '**************************************' 15610000
156200                 PERFORM 9900-SQL-ERROR                           15620000
156300                                                                  15630000
156400         END-EVALUATE                                             15640000
156500     END-PERFORM.                                                 15650000
156600                                                                  15660000
156700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    15670000
156800         SQLCODE NOT = ZERO                                       15680000
156900         DISPLAY '**************************************'         15690000
157000         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         15700000
157100         DISPLAY 'INSERT TO SUT_OTBND_CART                     '  15710000
157200         DISPLAY 'SUT00024-SHIPT-UNT-ID =  '                      15720000
157300                  SUT00024-SHIPT-UNT-ID                           15730000
157400         DISPLAY '**************************************'         15740000
157500         PERFORM 9900-SQL-ERROR                                   15750000
157600     END-IF.                                                      15760000
157700                                                                  15770000
157800/                                                                 15780000
157900*7400-FIND-UPC-NBR.                                               15790000
158000*    MOVE ' 7400-FIND-UPC-NBR'                                    15800000
158100*                                TO DP013-PARAGRAPH.              15810000
158200*                                                                 15820000
158300**   MOVE SU011-DISTRIBUTION-NBR      TO PV-DISTRIBUTION-NBR      15830000
158400**   MOVE PV-TRN-NBR                  TO SHUUPC-TRN-NBR           15840000
158500**   MOVE PV-TRN-LNE-NBR              TO SHUUPC-TRN-LNE-NBR       15850000
158600**   MOVE SU011-UNIT-QTY              TO SHUUPC-SHPD-QTY          15860000
158700*                                                                 15870000
158800*    PERFORM                                                      15880000
158900*        WITH TEST AFTER                                          15890000
159000*        VARYING PV-RETRY-COUNTER FROM 1 BY 1                     15900000
159100*        UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES) OR            15910000
159200*               (SQLCODE = ZERO) OR (SQLCODE = -811))             15920000
159300*                                                                 15930000
159400*        EXEC SQL                                                 15940000
159500*        SELECT                                                   15950000
159600*            UPC.UPC_NBR                                          15960000
159700*        INTO                                                     15970000
159800*            :T-U-P-C-S-K-U-UPC-NBR                               15980000
159900*        FROM TCEPLIT ITM                                         15990000
160000*        ,    T-U-P-C-S-K-U UPC                                   16000000
160100*            WHERE ITM.CNSTK_REQ_PL_NBR = :SHUUPC-TRN-NBR         16010000
160200*              AND ITM.PL_LNE_NBR       = :SHUUPC-TRN-LNE-NBR     16020000
160300*              AND ITM.ITM_NBR          = UPC.ITEM_NBR            16030000
160400*        END-EXEC                                                 16040000
160500*                                                                 16050000
160600*        EVALUATE TRUE                                            16060000
160700*            WHEN SQLCODE = ZERO                                  16070000
160800*            WHEN SQLCODE = -811                                  16080000
160900*                CONTINUE                                         16090000
161000*            WHEN SQLCODE = -904                                  16100000
161100*            WHEN SQLCODE = -911                                  16110000
161200*            WHEN SQLCODE = -913                                  16120000
161300*                CONTINUE                                         16130000
161400*                                                                 16140000
161500*            WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              16150000
161600*                DISPLAY '**************************************' 16160000
161700*                DISPLAY 'WARNING ISSUED ON SELECT OF U-P-C-S-K-U'16170000
161800*                DISPLAY 'TRN-NBR =  ' SHUUPC-TRN-NBR             16180000
161900*                DISPLAY 'LNE-NBR =  ' SHUUPC-TRN-LNE-NBR         16190000
162000*                DISPLAY '**********************************'     16200000
162100*                PERFORM 9800-SQL-WARNING                         16210000
162200*                                                                 16220000
162300*            WHEN SQLCODE < ZERO                                  16230000
162400*                DISPLAY '**************************************' 16240000
162500*                DISPLAY 'ERROR ISSUED ON SELECT OF U-P-C-S-K-U ' 16250000
162600*                DISPLAY 'TRN-NBR =  ' SHUUPC-TRN-NBR             16260000
162700*                DISPLAY 'LNE-NBR =  ' SHUUPC-TRN-LNE-NBR         16270000
162800*                DISPLAY '**************************************' 16280000
162900*                PERFORM 9900-SQL-ERROR                           16290000
163000*                                                                 16300000
163100*        END-EVALUATE                                             16310000
163200*    END-PERFORM                                                  16320000
163300*                                                                 16330000
163400*    IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    16340000
163500*        SQLCODE NOT = ZERO                                       16350000
163600*        DISPLAY '**************************************'         16360000
163700*        DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO '            16370000
163800*                'SELECT T-U-P-C-S-K-U/TCEPLIT'                   16380000
163900*                DISPLAY 'TRN-NBR =  ' SHUUPC-TRN-NBR             16390000
164000*                DISPLAY 'LNE-NBR =  ' SHUUPC-TRN-LNE-NBR         16400000
164100*        DISPLAY '**************************************'         16410000
164200*        PERFORM 9900-SQL-ERROR                                   16420000
164300*    END-IF.                                                      16430000
164400/                                                                 16440000
164500*7500-INSERT-TSHUUPC.                                             16450000
164600*                                                                 16460000
164700*    MOVE ' 7500-INSERT-TSHUUPC'                                  16470000
164800*                                TO DP013-PARAGRAPH.              16480000
164900*                                                                 16490000
165000**   MOVE SU011-DISTRIBUTION-NBR      TO PV-DISTRIBUTION-NBR      16500000
165100**   MOVE PV-TRN-NBR                  TO SHUUPC-TRN-NBR           16510000
165200**   MOVE PV-TRN-LNE-NBR              TO SHUUPC-TRN-LNE-NBR       16520000
165300**   MOVE SU011-UNIT-QTY              TO SHUUPC-SHPD-QTY          16530000
165400*                                                                 16540000
165500*    PERFORM                                                      16550000
165600*        WITH TEST AFTER                                          16560000
165700*        VARYING PV-RETRY-COUNTER FROM 1 BY 1                     16570000
165800*        UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES) OR            16580000
165900*               (SQLCODE = ZERO) OR (SQLCODE = -803))             16590000
166000*                                                                 16600000
166100*    EXEC SQL                                                     16610000
166200*        INSERT INTO TSHUUPC                                      16620000
166300*            (                                                    16630000
166400*                SHIPT_UNT_ID                                     16640000
166500*            ,   TRN_NBR                                          16650000
166600*            ,   TRN_LNE_NBR                                      16660000
166700*            ,   TRN_TYP_CDE                                      16670000
166800*            ,   UPC_NBR                                          16680000
166900*            ,   SHPD_QTY                                         16690000
167000*            ,   RCVR_SEQ_NBR                                     16700000
167100*            )                                                    16710000
167200*            VALUES                                               16720000
167300*            (                                                    16730000
167400*                :DK-SHIPT-UNT-ID                                 16740000
167500*            ,   :SHUUPC-TRN-NBR                                  16750000
167600*            ,   :SHUUPC-TRN-LNE-NBR                              16760000
167700*            ,   'CS'                                             16770000
167800*            ,   :T-U-P-C-S-K-U-UPC-NBR                           16780000
167900*            ,   :SHUUPC-SHPD-QTY                                 16790000
168000*            ,   0                                                16800000
168100*            )                                                    16810000
168200*        END-EXEC                                                 16820000
168300*                                                                 16830000
168400*        EVALUATE TRUE                                            16840000
168500*            WHEN SQLCODE = ZERO                                  16850000
168600*                ADD 1                TO PV-SHUUPC-INSERT-COUNT   16860000
168700*            WHEN SQLCODE = -803                                  16870000
168800*                ADD 1                TO PV-SHUUPC-DUP-COUNT      16880000
168900*            WHEN SQLCODE = -904                                  16890000
169000*            WHEN SQLCODE = -911                                  16900000
169100*            WHEN SQLCODE = -913                                  16910000
169200*                CONTINUE                                         16920000
169300*                                                                 16930000
169400*            WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              16940000
169500*                DISPLAY '**************************************' 16950000
169600*                DISPLAY 'WARNING ISSUED ON INSERT OF TSHPUPC   ' 16960000
169700*                DISPLAY 'SHUUPC-SHIPT-UNT-ID =  '                16970000
169800*                         DK-SHIPT-UNT-ID                         16980000
169900*                DISPLAY '**********************************'     16990000
170000*                PERFORM 9800-SQL-WARNING                         17000000
170100*                                                                 17010000
170200*            WHEN SQLCODE < ZERO                                  17020000
170300*                DISPLAY '**************************************' 17030000
170400*                DISPLAY 'ERROR ISSUED ON INSERT OF TSHUUPC   '   17040000
170500*                DISPLAY 'SHUUPC-SHIPT-UNT-ID =  '                17050000
170600*                         DK-SHIPT-UNT-ID                         17060000
170700*                DISPLAY '**************************************' 17070000
170800*                PERFORM 9900-SQL-ERROR                           17080000
170900*                                                                 17090000
171000*        END-EVALUATE                                             17100000
171100*    END-PERFORM                                                  17110000
171200*                                                                 17120000
171300*    IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    17130000
171400*        SQLCODE NOT = ZERO                                       17140000
171500*        DISPLAY '**************************************'         17150000
171600*        DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         17160000
171700*        DISPLAY 'INSERT TO TSHUUPC                     '         17170000
171800*        DISPLAY 'SHUUPC-SHIPT-UNT-ID =  '                        17180000
171900*                 SUT00024-SHIPT-UNT-ID                           17190000
172000*        DISPLAY '**************************************'         17200000
172100*        PERFORM 9900-SQL-ERROR                                   17210000
172200*    END-IF.                                                      17220000
172300*                                                                 17230000
172400*-----------------------------------------------------------------17240000
172500* GET THE SHIPPING UNIT                                           17250000
172600*-----------------------------------------------------------------17260000
172700/                                                                 17270000
172800 7600-SELECT-OTBND-CART.                                          17280000
172900                                                                  17290000
173000     MOVE ' 7600-SELECT-OTBND-CART'                               17300000
173100                                 TO DP013-PARAGRAPH.              17310000
173200     MOVE SU014-BAR-CODE              TO PV-CONTAINER-ID.         17320000
173300     MOVE PV-SHIPT-UNT-ID             TO DK-SHIPT-UNT-ID.         17330000
173400                                                                  17340000
173500     EXEC SQL                                                     17350000
173600         SELECT                                                   17360000
173700              SHIPT_UNT_ID                                        17370000
173800         ,    ORGN_LOC_NBR                                        17380000
173900         ,    DEST_LOC_NBR                                        17390000
174000         ,    CART_SRC_CDE                                        17400000
174100         ,    MSTR_CART_IND                                       17410000
174200         ,    PRNT_CART_ID                                        17420000
174300         ,    ORIG_CART_ID                                        17430000
174400         ,    ACTV_IND                                            17440000
174500         ,    CRE_DTE                                             17450000
174600         ,    CRE_TM                                              17460000
174700         ,    CRE_USR_ID                                          17470000
174800         ,    CRE_PGM_NM                                          17480000
174900         ,    CART_RVSN_NBR                                       17490000
175000         ,    CART_TYP_CDE                                        17500000
175100         ,    LBL_PRT_SEQ_NBR                                     17510000
175200           INTO                                                   17520000
175300             :SUT00024-SHIPT-UNT-ID                               17530000
175400         ,   :SUT00024-ORGN-LOC-NBR                               17540000
175500         ,   :SUT00024-DEST-LOC-NBR                               17550000
175600         ,   :SUT00024-CART-SRC-CDE                               17560000
175700         ,   :SUT00024-MSTR-CART-IND                              17570000
175800         ,   :SUT00024-PRNT-CART-ID                               17580000
175900         ,   :SUT00024-ORIG-CART-ID                               17590000
176000         ,   :SUT00024-ACTV-IND                                   17600000
176100         ,   :SUT00024-CRE-DTE                                    17610000
176200         ,   :SUT00024-CRE-TM                                     17620000
176300         ,   :SUT00024-CRE-USR-ID                                 17630000
176400         ,   :SUT00024-CRE-PGM-NM                                 17640000
176500         ,   :SUT00024-CART-RVSN-NBR                              17650000
176600         ,   :SUT00024-CART-TYP-CDE                               17660000
176700         ,   :SUT00024-LBL-PRT-SEQ-NBR                            17670000
176800           FROM SUT_OTBND_CART                                    17680000
176900         WHERE                                                    17690000
177000             SHIPT_UNT_ID = :DK-SHIPT-UNT-ID                      17700000
177100     END-EXEC.                                                    17710000
177200                                                                  17720000
177300     EVALUATE TRUE                                                17730000
177400         WHEN SQLCODE = ZERO                                      17740000
177500              SET PS-OTBND-CART-FOUND-YES TO TRUE                 17750000
177600         WHEN SQLCODE = +100                                      17760000
177700              SET PS-OTBND-CART-FOUND-NO TO TRUE                  17770000
177800         WHEN SQLWARN0 NOT = SPACE                                17780000
177900         WHEN SQLCODE  NOT = ZERO                                 17790000
178000              MOVE ' 7600-SELECT-OTBND-CART'                      17800000
178100                              TO DP013-PARAGRAPH                  17810000
178200              MOVE 'UNSUCCESSFUL SELECT ON SUT_OTBND_CART  '      17820000
178300                              TO DP013-MESSAGE-TEXT (1)           17830000
178400              MOVE PV-SHIPT-UNT-ID                                17840000
178500                              TO DP013-MESSAGE-TEXT (2)           17850000
178600              MOVE SQLCA      TO DP013-SQLCA                      17860000
178700              MOVE SQLCODE      TO PV-DISPLAY-SQLCODE             17870000
178800              MOVE PV-DISPLAY-SQLCODE                             17880000
178900                              TO DP013-MESSAGE-TEXT (3)           17890000
179000              MOVE 'SUT00024' TO DP013-DB2-TABLE-NAME (1)         17900000
179100              SET DP013-DB2-ABEND                                 17910000
179200                  DP013-ROLLBACK       TO TRUE                    17920000
179300              PERFORM 9999-WRITE-CICS-LOG-MSG                     17930000
179400     END-EVALUATE.                                                17940000
179500/                                                                 17950000
179600*                                                                 17960000
179700 7700-WRITE-UPLOAD-ERROR-TABLE.                                   17970000
179800                                                                  17980000
179900     MOVE ' 7700-WRITE-UPLOAD-ERROR-TABLE'                        17990000
180000                                 TO DP013-PARAGRAPH.              18000000
180100     INITIALIZE                       UPLDER-PKT-TXT              18010000
180200                                      UPLDER-UPLD-TRN-CDE.        18020000
180300     MOVE SU014-DC-NUMBER             TO DK-OPER-UNT-ID.          18030000
180400     ADD 1                            TO PV-ERROR-COUNT.          18040000
180500     MOVE PV-ERROR-COUNT              TO UPLDER-UPLD-SEQ-NBR.     18050000
180600     MOVE SU014-CONV-DIVERT-RECORD    TO UPLDER-PKT-TXT.          18060000
180700                                                                  18070000
180800     EXEC SQL                                                     18080000
180900     INSERT INTO TUPLDER                                          18090000
181000         (                                                        18100000
181100           OPER_UNT_ID                                            18110000
181200         , UPLD_TRN_CDE                                           18120000
181300         , ERR_CDE                                                18130000
181400         , PRC_TMST                                               18140000
181500         , UPLD_SEQ_NBR                                           18150000
181600         , PKT_TXT                                                18160000
181700         )                                                        18170000
181800         VALUES                                                   18180000
181900         (                                                        18190000
182000           :DK-OPER-UNT-ID                                        18200000
182100         , 'B'                                                    18210000
182200         , :DK-ERROR-CODE                                         18220000
182300         , CURRENT TIMESTAMP                                      18230000
182400         , :DK-RECS-READ                                          18240000
182500         , :UPLDER-PKT-TXT                                        18250000
182600         )                                                        18260000
182700     END-EXEC.                                                    18270000
182800                                                                  18280000
182900     EVALUATE TRUE                                                18290000
183000         WHEN SQLCODE = ZERO                                      18300000
183100             CONTINUE                                             18310000
183200         WHEN SQLWARN0 NOT = SPACES                               18320000
183300         WHEN SQLCODE  NOT = ZERO                                 18330000
183400             MOVE ' 7700-WRITE-UPLOAD-ERROR-TABLE'                18340000
183500                                       TO DP013-PARAGRAPH         18350000
183600             MOVE 'PROBLEM WITH RETRIEVING ROW'                   18360000
183700                                 TO DP013-MESSAGE-TEXT (1)        18370000
183800             MOVE SU014-DC-NUMBER                                 18380000
183900                                 TO DP013-MESSAGE-TEXT (2)        18390000
184000             MOVE PV-ERROR-COUNT                                  18400000
184100                                 TO DP013-MESSAGE-TEXT (3)        18410000
184200             MOVE SQLCA      TO DP013-SQLCA                       18420000
184300             MOVE SQLCODE      TO PV-DISPLAY-SQLCODE              18430000
184400             MOVE PV-DISPLAY-SQLCODE                              18440000
184500                             TO DP013-MESSAGE-TEXT (4)            18450000
184600             MOVE 'TUPLDER'  TO DP013-DB2-TABLE-NAME (1)          18460000
184700             SET DP013-DB2-ABEND                                  18470000
184800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               18480000
184900             PERFORM 9999-WRITE-CICS-LOG-MSG                      18490000
185000***          PERFORM DP014-0000-PROCESS-ABEND                     18500000
185100     END-EVALUATE.                                                18510000
185200                                                                  18520000
185300 7800-VALIDATE-DIVERT.                                            18530000
185400     MOVE ' 7800-VALIDATE-DIVERT'                                 18540000
185500                                 TO DP013-PARAGRAPH.              18550000
185600      MOVE SU014-DC-NUMBER   TO DK-OPER-UNT-ID.                   18560000
185700      MOVE SU014-DIVERT-NUMBER                                    18570000
185800                             TO DK-DIVERT-ID.                     18580000
185900      MOVE SU014-DOOR-NUMBER                                      18590000
186000                             TO DK-DOOR-ID.                       18600000
186100                                                                  18610000
186200        EXEC SQL                                                  18620000
186300          SELECT  A.DOOR_ID                                       18630000
186400              ,   A.DOOR_TYP_CDE                                  18640000
186500              ,   B.DIVERT_TYP_CDE                                18650000
186600              ,   CURRENT TIMESTAMP                               18660000
186700            INTO :CNDCDR-DOOR-ID                                  18670000
186800              ,  :CNDCDR-DOOR-TYP-CDE                             18680000
186900              ,  :CNDRTY-DIVERT-TYP-CDE                           18690000
187000              ,  :PV-TIMESTAMP                                    18700000
187100            FROM  TCNDCDR A                                       18710000
187200             ,    TCNDRTY B                                       18720000
187300           WHERE  A.OPER_UNT_ID  = :DK-OPER-UNT-ID                18730000
187400             AND  A.DIVERT_LOC_ID= :DK-DOOR-ID                    18740000
187500             AND  A.DIVERT_NBR   = :DK-DIVERT-ID                  18750000
187600             AND  A.DOOR_TYP_CDE = B.DOOR_TYP_CDE                 18760000
187700        END-EXEC                                                  18770000
187800                                                                  18780000
187900        EVALUATE TRUE                                             18790000
188000            WHEN SQLCODE = +0                                     18800000
188100                CONTINUE                                          18810000
188200            WHEN SQLCODE = +100                                   18820000
188300                SET PS-DOOR-CONVERT-NOT-FOUND TO TRUE             18830000
188400            WHEN SQLCODE = -811                                   18840000
188500                PERFORM 7850-VALIDATE-DIVERT-DUP                  18850000
188600            WHEN SQLWARN0 NOT = SPACES                            18860000
188700            WHEN SQLCODE < +0                                     18870000
188800            WHEN SQLCODE > +0                                     18880000
188900                MOVE ' 7800-VALIDATE-DIVERT'                      18890000
189000                                          TO DP013-PARAGRAPH      18900000
189100                MOVE 'PROBLEM WITH RETRIEVING ROW'                18910000
189200                                    TO DP013-MESSAGE-TEXT (1)     18920000
189300                MOVE SU014-DC-NUMBER                              18930000
189400                                    TO DP013-MESSAGE-TEXT (2)     18940000
189500                MOVE SU014-DIVERT-NUMBER                          18950000
189600                                    TO DP013-MESSAGE-TEXT (3)     18960000
189700                MOVE SU014-DOOR-NUMBER                            18970000
189800                                    TO DP013-MESSAGE-TEXT (4)     18980000
189900                MOVE SQLCA      TO DP013-SQLCA                    18990000
190000                MOVE 'TCNDCDR'  TO DP013-DB2-TABLE-NAME (1)       19000000
190100                MOVE 'TCNDRTY'  TO DP013-DB2-TABLE-NAME (2)       19010000
190200                MOVE SQLCODE    TO PV-DISPLAY-SQLCODE             19020000
190300                MOVE PV-DISPLAY-SQLCODE                           19030000
190400                                TO DP013-DB2-TABLE-NAME (3)       19040000
190500                SET DP013-DB2-ABEND                               19050000
190600                    DP013-XCTL-DISPLAY-RESTART TO TRUE            19060000
190700                PERFORM 9999-WRITE-CICS-LOG-MSG                   19070000
190800***             PERFORM DP014-0000-PROCESS-ABEND                  19080000
190900        END-EVALUATE.                                             19090000
191000                                                                  19100000
191100*                                                                 19110000
191200 7850-VALIDATE-DIVERT-DUP.                                        19120000
191300     MOVE ' 7850-VALIDATE-DIVERT-DUP'                             19130000
191400                                 TO DP013-PARAGRAPH.              19140000
191500      MOVE SU014-DC-NUMBER   TO DK-OPER-UNT-ID.                   19150000
191600      MOVE SU014-DIVERT-NUMBER                                    19160000
191700                             TO DK-DIVERT-ID.                     19170000
191800      MOVE SU014-DOOR-NUMBER                                      19180000
191900                             TO DK-DOOR-ID.                       19190000
192000      MOVE PV-STORE-NBR      TO DK-STR-NBR.                       19200000
192100                                                                  19210000
192200        EXEC SQL                                                  19220000
192300          SELECT  A.DOOR_ID                                       19230000
192400              ,   B.DIVERT_TYP_CDE                                19240000
192500              ,   CURRENT TIMESTAMP                               19250000
192600            INTO :CNDCDR-DOOR-ID                                  19260000
192700              ,  :CNDRTY-DIVERT-TYP-CDE                           19270000
192800              ,  :PV-TIMESTAMP                                    19280000
192900            FROM  TCNDCDR A                                       19290000
193000              ,   TCNDRTY B                                       19300000
193100              ,   TCNDRST C                                       19310000
193200           WHERE  A.OPER_UNT_ID  = :DK-OPER-UNT-ID                19320000
193300             AND  A.DIVERT_LOC_ID= :DK-DOOR-ID                    19330000
193400             AND  A.DIVERT_NBR   = :DK-DIVERT-ID                  19340000
193500             AND  A.DOOR_TYP_CDE = B.DOOR_TYP_CDE                 19350000
193600             AND  A.OPER_UNT_ID  =  C.OPER_UNT_ID                 19360000
193700             AND  A.DOOR_ID      =  C.DOOR_ID                     19370000
193800             AND  C.STR_NBR      =  :DK-STR-NBR                   19380000
193900             AND  C.END_TMST     =  :PC-DEFAULT-TMST              19390000
194000        END-EXEC                                                  19400000
194100                                                                  19410000
194200        EVALUATE TRUE                                             19420000
194300            WHEN SQLCODE = +0                                     19430000
194400                CONTINUE                                          19440000
194500            WHEN SQLCODE = +100                                   19450000
194600                SET PS-DOOR-CONVERT-NOT-FOUND TO TRUE             19460000
194700            WHEN SQLWARN0 NOT = SPACES                            19470000
194800            WHEN SQLCODE < +0                                     19480000
194900            WHEN SQLCODE > +0                                     19490000
195000                MOVE ' 7850-VALIDATE-DIVERT-DUP'                  19500000
195100                                          TO DP013-PARAGRAPH      19510000
195200                MOVE 'PROBLEM WITH RETRIEVING ROW'                19520000
195300                                    TO DP013-MESSAGE-TEXT (1)     19530000
195400                MOVE SU014-DC-NUMBER                              19540000
195500                                    TO DP013-MESSAGE-TEXT (2)     19550000
195600                MOVE SU014-DIVERT-NUMBER                          19560000
195700                                    TO DP013-MESSAGE-TEXT (3)     19570000
195800                MOVE SU014-DOOR-NUMBER                            19580000
195900                                    TO DP013-MESSAGE-TEXT (4)     19590000
196000                MOVE SQLCA      TO DP013-SQLCA                    19600000
196100                MOVE 'TCNDCDR'  TO DP013-DB2-TABLE-NAME (1)       19610000
196200                MOVE 'TCNDRTY'  TO DP013-DB2-TABLE-NAME (2)       19620000
196300                MOVE 'TCNDRST'  TO DP013-DB2-TABLE-NAME (3)       19630000
196400                MOVE SQLCODE    TO PV-DISPLAY-SQLCODE             19640000
196500                MOVE PV-DISPLAY-SQLCODE                           19650000
196600                                TO DP013-DB2-TABLE-NAME (4)       19660000
196700                SET DP013-DB2-ABEND                               19670000
196800                    DP013-XCTL-DISPLAY-RESTART TO TRUE            19680000
196900                PERFORM 9999-WRITE-CICS-LOG-MSG                   19690000
197000***             PERFORM DP014-0000-PROCESS-ABEND                  19700000
197100        END-EVALUATE.                                             19710000
197200                                                                  19720000
197300*                                                                 19730000
197400******************************************************************19740000
197500 7900-CHECK-PARM-TABLE.                                           19750000
197600                                                                  19760000
197700     MOVE ' 7900-CHECK-PARM-TABLE'                                19770000
197800                                 TO DP013-PARAGRAPH.              19780000
197900     MOVE SU014-DC-NUMBER     TO DK-LOC-ID.                       19790000
198000                                                                  19800000
198100     EXEC SQL                                                     19810000
198200         SELECT FUNC_TXT                                          19820000
198300            ,   (CURRENT_TIMESTAMP + 1 HOUR)                      19830000
198400           INTO :KRPRPM-FUNC-TXT                                  19840000
198500            ,   :PV-TIMESTAMP                                     19850000
198600           FROM TKRPRPM                                           19860000
198700          WHERE SYS_PRC_FUNC_CDE  = :DK-FUNC-CDE                  19870000
198800            AND LOC_ID            = :DK-LOC-ID                    19880000
198900            AND INTFC_SYS_CDE     = 'RDM'                         19890000
199000            AND FUNC_PRC_STAT_CDE = 'AC'                          19900000
199100            AND (CURRENT_DATE                                     19910000
199200        BETWEEN DATE(FUNC_BEG_TMST) AND                           19920000
199300                DATE(FUNC_END_TMST) )                             19930000
199400     END-EXEC.                                                    19940000
199500                                                                  19950000
199600     EVALUATE SQLCODE                                             19960000
199700         WHEN ZERO                                                19970000
199800             SET PS-PARM-REC-FOUND   TO TRUE                      19980000
199900         WHEN +100                                                19990000
200000             SET PS-NO-PARM-REC-FOUND TO TRUE                     20000000
200100         WHEN OTHER                                               20010000
200200              MOVE ' 7900-CHECK-PARM-TABLE'                       20020000
200300                               TO DP013-PARAGRAPH                 20030000
200400              MOVE 'SELECT RDM FACILITY'                          20040000
200500                               TO DP013-MESSAGE-TEXT (1)          20050000
200600              MOVE SU014-DC-NUMBER                                20060000
200700                               TO DP013-MESSAGE-TEXT (2)          20070000
200800              MOVE SQLCA       TO DP013-SQLCA                     20080000
200900              MOVE SQLCODE     TO PV-DISPLAY-SQLCODE              20090000
201000              MOVE PV-DISPLAY-SQLCODE                             20100000
201100                               TO DP013-MESSAGE-TEXT (3)          20110000
201200              SET DP013-DB2-ABEND                                 20120000
201300                               TO TRUE                            20130000
201400              PERFORM 9999-WRITE-CICS-LOG-MSG                     20140000
201500***           PERFORM DP014-0000-PROCESS-ABEND                    20150000
201600     END-EVALUATE.                                                20160000
201700                                                                  20170000
201800*----------------------------------------------------------------*20180000
201900*    INSERT A ROW INTO THE TSUCRDV TABLE                         *20190000
202000*----------------------------------------------------------------*20200000
202100 8000-SELECT-TSUCRDV.                                             20210000
202200     MOVE ' 8000-SELECT-TSUCRDV'                                  20220000
202300                                 TO DP013-PARAGRAPH.              20230000
202400     PERFORM                                                      20240000
202500         WITH TEST AFTER                                          20250000
202600         VARYING PV-RETRY-COUNTER                                 20260000
202700         FROM 1 BY 1                                              20270000
202800         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES)                20280000
202900             OR (SQLCODE = +0)                                    20290000
203000             OR (SQLCODE = +100)                                  20300000
203100             OR (SQLCODE = -811)                                  20310000
203200                                                                  20320000
203300                                                                  20330000
203400         EXEC SQL                                                 20340000
203500              SELECT  A.DIVERT_SYS_DTE                            20350000
203600                  ,   A.DIVERT_SYS_TM                             20360000
203700              INTO    :SUCRDV-DIVERT-SYS-DTE                      20370000
203800                  ,   :SUCRDV-DIVERT-SYS-TM                       20380000
203900              FROM    TSUCRDV A                                   20390000
204000              WHERE   A.SHIPT_UNT_ID  = :SUCRDV-SHIPT-UNT-ID      20400000
204100                AND   A.DIVERT_TMST   =                           20410000
204200                 (SELECT  MAX(B.DIVERT_TMST)                      20420000
204300                  FROM    TSUCRDV B                               20430000
204400                  WHERE   B.SHIPT_UNT_ID  = :SUCRDV-SHIPT-UNT-ID) 20440000
204500         END-EXEC                                                 20450000
204600                                                                  20460000
204700         EVALUATE TRUE                                            20470000
204800             WHEN SQLCODE = +0                                    20480000
204900             WHEN SQLCODE = -811                                  20490000
205000                 SET PS-DUPLICATE-CARTON TO TRUE                  20500000
205100             WHEN SQLCODE = -904                                  20510000
205200             WHEN SQLCODE = -911                                  20520000
205300             WHEN SQLCODE = -913                                  20530000
205400                  CONTINUE                                        20540000
205500                                                                  20550000
205600             WHEN SQLCODE = +100                                  20560000
205700                 SET PS-NO-DUPLICATE-CARTON TO TRUE               20570000
205800                                                                  20580000
205900             WHEN SQLWARN0 NOT = SPACES                           20590000
206000             WHEN SQLCODE < +0                                    20600000
206100             WHEN SQLCODE > +0                                    20610000
206200                  MOVE ' 8000-SELECT-TSUCRDV'                     20620000
206300                                  TO DP013-PARAGRAPH              20630000
206400                  MOVE 'UNSUCCESSFUL SELECT ON TSUCRDV  '         20640000
206500                                  TO DP013-MESSAGE-TEXT (1)       20650000
206600                  MOVE PV-SHIPT-UNT-ID                            20660000
206700                                  TO DP013-MESSAGE-TEXT (2)       20670000
206800                  MOVE SQLCA      TO DP013-SQLCA                  20680000
206900                  MOVE SQLCODE    TO PV-DISPLAY-SQLCODE           20690000
207000                  MOVE PV-DISPLAY-SQLCODE                         20700000
207100                                  TO DP013-MESSAGE-TEXT (3)       20710000
207200                  MOVE 'TSUCRDV ' TO DP013-DB2-TABLE-NAME (1)     20720000
207300                  SET DP013-DB2-ABEND                             20730000
207400                      DP013-ROLLBACK       TO TRUE                20740000
207500                  PERFORM 9999-WRITE-CICS-LOG-MSG                 20750000
207600         END-EVALUATE                                             20760000
207700     END-PERFORM.                                                 20770000
207800                                                                  20780000
207900                                                                  20790000
208000     IF  (PV-RETRY-COUNTER > PC-MAX-RETRIES) AND                  20800000
208100         (SQLCODE NOT = +0)                                       20810000
208200         PERFORM 3300-SEND-ERROR-CONFIRM-QNX                      20820000
208300         PERFORM 1500-CLOSE-SOCKET                                20830000
208400         MOVE ' 8000-SELECT-TSUCRDV'                              20840000
208500                                  TO DP013-PARAGRAPH              20850000
208600         MOVE 'MAX RETRIES EXCEEDED ON TSUCRDV SELECT'            20860000
208700                                  TO DP013-MESSAGE-TEXT (1)       20870000
208800         MOVE SQLCA               TO DP013-SQLCA                  20880000
208900         MOVE 'TSUCRDV '          TO DP013-DB2-TABLE-NAME (1)     20890000
209000         SET DP013-DB2-ABEND                                      20900000
209100             DP013-ROLLBACK       TO TRUE                         20910000
209200         PERFORM 9999-WRITE-CICS-LOG-MSG                          20920000
209300     END-IF.                                                      20930000
209400                                                                  20940000
209500 8200-UPDATE-SHPUNT.                                              20950000
209600                                                                  20960000
209700     EXEC SQL                                                     20970000
209800         UPDATE SUT_OTBND_CART                                    20980000
209900             SET ACTV_IND      = :PV-ACTV-IND                     20990000
210000         ,   PRNT_CART_ID = :PV-PRNT-CART-ID                      21000000
210100         WHERE                                                    21010000
210200             SHIPT_UNT_ID = :SUT00024-SHIPT-UNT-ID                21020000
210300     END-EXEC.                                                    21030000
210400                                                                  21040000
210500     EVALUATE TRUE                                                21050000
210600         WHEN SQLCODE = ZERO                                      21060000
210700             CONTINUE                                             21070000
210800         WHEN SQLWARN0 NOT = SPACES                               21080000
210900         WHEN SQLCODE NOT EQUAL ZERO                              21090000
211000             MOVE ' 8200-UPDATE-SHPUNT'                           21100000
211100                              TO DP013-PARAGRAPH                  21110000
211200             MOVE 'SUKCS557 - UPDATE SUT_OTBND_CART ROW'          21120000
211300                              TO DP013-MESSAGE-TEXT (1)           21130000
211400              MOVE PV-PRNT-CART-ID                                21140000
211500                              TO PV-DISP-SHIPT-UNT-ID             21150000
211600              MOVE PV-DISP-SHIPT-UNT-ID                           21160000
211700                              TO DP013-MESSAGE-TEXT (2)           21170000
211800              MOVE SQLCA      TO DP013-SQLCA                      21180000
211900              MOVE SQLCODE    TO PV-DISPLAY-SQLCODE               21190000
212000              MOVE PV-DISPLAY-SQLCODE                             21200000
212100                              TO DP013-MESSAGE-TEXT (3)           21210000
212200              MOVE 'SUT00024' TO DP013-DB2-TABLE-NAME (1)         21220000
212300              SET DP013-DB2-ABEND                                 21230000
212400                  DP013-ROLLBACK       TO TRUE                    21240000
212500              PERFORM 9999-WRITE-CICS-LOG-MSG                     21250000
212600     END-EVALUATE.                                                21260000
212700                                                                  21270000
212800                                                                  21280000
212900 8250-INACT-TSUCRDV.                                              21290000
213000                                                                  21300000
213100     EXEC SQL                                                     21310000
213200         UPDATE TSUCRDV                                           21320000
213300             SET ACTV_CDE          = 'I'                          21330000
213400         WHERE                                                    21340000
213500             SHIPT_UNT_ID = :SUT00024-SHIPT-UNT-ID                21350000
213600     END-EXEC.                                                    21360000
213700                                                                  21370000
213800     EVALUATE TRUE                                                21380000
213900         WHEN SQLCODE = ZERO                                      21390000
214000         WHEN SQLCODE = +100                                      21400000
214100             CONTINUE                                             21410000
214200         WHEN SQLWARN0 NOT = SPACES                               21420000
214300         WHEN SQLCODE NOT EQUAL ZERO                              21430000
214400             MOVE ' 8250-INACT-TSUCRDV'                           21440000
214500                              TO DP013-PARAGRAPH                  21450000
214600             MOVE 'SUKCS557 - UPDATE TSUCRDV ROW'                 21460000
214700                              TO DP013-MESSAGE-TEXT (1)           21470000
214800              MOVE SUT00024-SHIPT-UNT-ID                          21480000
214900                              TO PV-DISP-SHIPT-UNT-ID             21490000
215000              MOVE PV-DISP-SHIPT-UNT-ID                           21500000
215100                              TO DP013-MESSAGE-TEXT (2)           21510000
215200              MOVE SQLCODE    TO PV-DISPLAY-SQLCODE               21520000
215300              MOVE PV-DISPLAY-SQLCODE                             21530000
215400                              TO DP013-MESSAGE-TEXT (3)           21540000
215500              MOVE SQLCA      TO DP013-SQLCA                      21550000
215600              MOVE 'TSUCRDV ' TO DP013-DB2-TABLE-NAME (1)         21560000
215700              SET DP013-DB2-ABEND                                 21570000
215800                  DP013-ROLLBACK       TO TRUE                    21580000
215900              PERFORM 9999-WRITE-CICS-LOG-MSG                     21590000
216000     END-EVALUATE.                                                21600000
216100                                                                  21610000
216200 8300-PROCESS-CHILDREN.                                           21620000
216300     PERFORM 8400-OPEN-CHILD-CSR.                                 21630000
216400     PERFORM 8500-FETCH-CHILD-CSR.                                21640000
216500     PERFORM 2600-MOVE-DIVERT-DATA.                               21650000
216600     MOVE PV-OTBND-CART-SHIPT-UNT-ID   TO PV-SHIPT-UNIT-ID.       21660000
216700     PERFORM UNTIL PS-END-OF-CHILD                                21670000
216800         SET PS-DEST-MATCH-FOUND TO TRUE                          21680000
216900         MOVE PV-OTBND-CART-SHIPT-UNT-ID                          21690000
217000                                       TO SUCRDV-SHIPT-UNT-ID     21700000
217100                                          PV-SHIPT-UNT-ID         21710000
217200         MOVE '00'                     TO PV-CONTAINER-00         21720000
217300         MOVE SPACES                   TO PV-CONTAINER-SPACES     21730000
217400         MOVE PV-CONTAINER-ID          TO SUCRDV-BRCDE-NBR        21740000
217500         PERFORM 7000-INSERT-TSUCRDV                              21750000
217600         MOVE PV-OTBND-CART-SHIPT-UNT-ID                          21760000
217700                                     TO SUT00024-SHIPT-UNT-ID     21770000
217800                                        PV-PRNT-CART-ID           21780000
217900         PERFORM 8200-UPDATE-SHPUNT                               21790000
218000         PERFORM 8500-FETCH-CHILD-CSR                             21800000
218100         MOVE PV-OTBND-CART-SHIPT-UNT-ID                          21810000
218200                                       TO PV-SHIPT-UNIT-ID        21820000
218300     END-PERFORM.                                                 21830000
218400     PERFORM 8600-CLOSE-CHILD-CSR.                                21840000
218500                                                                  21850000
218600 8400-OPEN-CHILD-CSR.                                             21860000
218700                                                                  21870000
218800     EXEC SQL                                                     21880000
218900         OPEN CHILD-CSR                                           21890000
219000     END-EXEC.                                                    21900000
219100                                                                  21910000
219200     EVALUATE TRUE                                                21920000
219300         WHEN SQLCODE = ZERO                                      21930000
219400             SET PS-ALL-CHILD         TO TRUE                     21940000
219500         WHEN SQLWARN0 NOT = SPACES                               21950000
219600         WHEN SQLCODE NOT EQUAL ZERO                              21960000
219700             MOVE ' 8400-OPEN-CHILD-CSR'                          21970000
219800                              TO DP013-PARAGRAPH                  21980000
219900             MOVE 'SUKCS557 - FIND ALL CHILDREN'                  21990000
220000                              TO DP013-MESSAGE-TEXT (1)           22000000
220100              MOVE DK-SHIPT-UNT-ID                                22010000
220200                              TO PV-DISP-SHIPT-UNT-ID             22020000
220300              MOVE PV-DISP-SHIPT-UNT-ID                           22030000
220400                              TO DP013-MESSAGE-TEXT (2)           22040000
220500              MOVE SQLCA      TO DP013-SQLCA                      22050000
220600              MOVE SQLCODE    TO PV-DISPLAY-SQLCODE               22060000
220700              MOVE PV-DISPLAY-SQLCODE                             22070000
220800                              TO DP013-MESSAGE-TEXT (3)           22080000
220900              MOVE 'SUT00024' TO DP013-DB2-TABLE-NAME (1)         22090000
221000              SET DP013-DB2-ABEND                                 22100000
221100                  DP013-ROLLBACK       TO TRUE                    22110000
221200              PERFORM 9999-WRITE-CICS-LOG-MSG                     22120000
221300     END-EVALUATE.                                                22130000
221400                                                                  22140000
221500 8500-FETCH-CHILD-CSR.                                            22150000
221600                                                                  22160000
221700     EXEC SQL                                                     22170000
221800         FETCH CHILD-CSR                                          22180000
221900         INTO                                                     22190000
222000             :PV-OTBND-CART-SHIPT-UNT-ID                          22200000
222100          ,  :SUT00024-DEST-LOC-NBR                               22210000
222200     END-EXEC.                                                    22220000
222300                                                                  22230000
222400     EVALUATE TRUE                                                22240000
222500         WHEN SQLCODE = ZERO                                      22250000
222600             CONTINUE                                             22260000
222700         WHEN SQLCODE = +100                                      22270000
222800             SET PS-END-OF-CHILD      TO TRUE                     22280000
222900         WHEN SQLWARN0 NOT = SPACES                               22290000
223000         WHEN SQLCODE NOT EQUAL ZERO                              22300000
223100             MOVE ' 8500-FETCH-CHILD-CSR'                         22310000
223200                              TO DP013-PARAGRAPH                  22320000
223300             MOVE 'SUKCS557 - FETCH A CHILD'                      22330000
223400                              TO DP013-MESSAGE-TEXT (1)           22340000
223500              MOVE DK-SHIPT-UNT-ID                                22350000
223600                              TO PV-DISP-SHIPT-UNT-ID             22360000
223700              MOVE PV-DISP-SHIPT-UNT-ID                           22370000
223800                              TO DP013-MESSAGE-TEXT (2)           22380000
223900              MOVE SQLCA      TO DP013-SQLCA                      22390000
224000              MOVE SQLCODE    TO PV-DISPLAY-SQLCODE               22400000
224100              MOVE PV-DISPLAY-SQLCODE                             22410000
224200                              TO DP013-MESSAGE-TEXT (3)           22420000
224300              MOVE 'SUT00024' TO DP013-DB2-TABLE-NAME (1)         22430000
224400              SET DP013-DB2-ABEND                                 22440000
224500                  DP013-ROLLBACK       TO TRUE                    22450000
224600              PERFORM 9999-WRITE-CICS-LOG-MSG                     22460000
224700     END-EVALUATE.                                                22470000
224800                                                                  22480000
224900                                                                  22490000
225000 8600-CLOSE-CHILD-CSR.                                            22500000
225100                                                                  22510000
225200     EXEC SQL                                                     22520000
225300         CLOSE CHILD-CSR                                          22530000
225400     END-EXEC.                                                    22540000
225500                                                                  22550000
225600     EVALUATE TRUE                                                22560000
225700         WHEN SQLCODE = ZERO                                      22570000
225800             CONTINUE                                             22580000
225900         WHEN SQLWARN0 NOT = SPACES                               22590000
226000         WHEN SQLCODE NOT EQUAL ZERO                              22600000
226100             MOVE ' 8600-CLOSE-CHILD-CSR'                         22610000
226200                              TO DP013-PARAGRAPH                  22620000
226300             MOVE 'SUKCS557 - CLOSE CHILD CURSOR'                 22630000
226400                              TO DP013-MESSAGE-TEXT (1)           22640000
226500             MOVE DK-SHIPT-UNT-ID                                 22650000
226600                              TO PV-DISP-SHIPT-UNT-ID             22660000
226700             MOVE PV-DISP-SHIPT-UNT-ID                            22670000
226800                              TO DP013-MESSAGE-TEXT (2)           22680000
226900             MOVE SQLCA       TO DP013-SQLCA                      22690000
227000             MOVE SQLCODE    TO PV-DISPLAY-SQLCODE                22700000
227100             MOVE PV-DISPLAY-SQLCODE                              22710000
227200                              TO DP013-MESSAGE-TEXT (3)           22720000
227300             MOVE 'SUT00024'  TO DP013-DB2-TABLE-NAME (1)         22730000
227400             SET DP013-DB2-ABEND                                  22740000
227500                 DP013-ROLLBACK       TO TRUE                     22750000
227600              PERFORM 9999-WRITE-CICS-LOG-MSG                     22760000
227700     END-EVALUATE.                                                22770000
227800                                                                  22780000
227900 8700-VALIDATE-STORE-NBR.                                         22790000
228000      MOVE PV-STORE-NBR      TO DK-STR-NBR.                       22800000
228100      EXEC SQL                                                    22810000
228200        SELECT  STR_NBR                                           22820000
228300          INTO :CNDRST-STR-NBR                                    22830000
228400          FROM  TCNDRST                                           22840000
228500         WHERE  OPER_UNT_ID  =  :DK-OPER-UNT-ID                   22850000
228600           AND  DOOR_ID      =  :CNDCDR-DOOR-ID                   22860000
228700           AND  STR_NBR      =  :DK-STR-NBR                       22870000
228800           AND  END_TMST     =  '9999-09-09-09.09.09.999999'      22880000
228900      END-EXEC.                                                   22890000
229000                                                                  22900000
229100      EVALUATE TRUE                                               22910000
229200          WHEN SQLCODE = +0                                       22920000
229300              CONTINUE                                            22930000
229400          WHEN SQLCODE = +100                                     22940000
229500              SET PS-STORE-NUMBER-NOT-FOUND TO TRUE               22950000
229600          WHEN SQLWARN0 NOT = SPACES                              22960000
229700          WHEN SQLCODE < +0                                       22970000
229800          WHEN SQLCODE > +0                                       22980000
229900              MOVE ' 8700-VALIDATE-STORE-NBR'                     22990000
230000                                        TO DP013-PARAGRAPH        23000000
230100              MOVE 'PROBLEM WITH RETRIEVING ROW'                  23010000
230200                                  TO DP013-MESSAGE-TEXT (1)       23020000
230300              MOVE SU014-DC-NUMBER                                23030000
230400                                  TO DP013-MESSAGE-TEXT (2)       23040000
230500              MOVE PV-STORE-NBR                                   23050000
230600                                  TO DP013-MESSAGE-TEXT (3)       23060000
230700              MOVE SU014-DOOR-NUMBER                              23070000
230800                                  TO DP013-MESSAGE-TEXT (4)       23080000
230900              MOVE SQLCA      TO DP013-SQLCA                      23090000
231000              MOVE 'TCNDRST'  TO DP013-DB2-TABLE-NAME (1)         23100000
231100              MOVE SQLCODE    TO PV-DISPLAY-SQLCODE               23110000
231200              MOVE PV-DISPLAY-SQLCODE                             23120000
231300                               TO DP013-DB2-TABLE-NAME (2)        23130000
231400              SET DP013-DB2-ABEND                                 23140000
231500                  DP013-XCTL-DISPLAY-RESTART TO TRUE              23150000
231600              PERFORM 9999-WRITE-CICS-LOG-MSG                     23160000
231700***             PERFORM DP014-0000-PROCESS-ABEND                  23170000
231800      END-EVALUATE.                                               23180000
231900******************************************************************23190000
232000*    LINK TO THE MESSAGE FORMAT SUB-ROUTINE FOR NON-CICS          23200000
232100*    ARCHITECTURE PROGRAMS.  THIS MESSAGE IS PASSED IN THE DATA   23210000
232200*    STREAM BEING SENT BACK TO THE PTC.                           23220000
232300******************************************************************23230000
232400                                                                  23240000
232500 9000-SYNCPOINT.                                                  23250000
232600     EXEC CICS                                                    23260000
232700         SYNCPOINT                                                23270000
232800     END-EXEC.                                                    23280000
232900/                                                                 23290000
233000 9990-WRITE-CICS.                                                 23300000
233100     EXEC CICS                                                    23310000
233200         WRITEQ TD                                                23320000
233300         QUEUE('CSSL')                                            23330000
233400         FROM(PV-CICS-MSG-AREA)                                   23340000
233500         RESP(PV-CICS-RESPONSE)                                   23350000
233600     END-EXEC.                                                    23360000
233700                                                                  23370000
233800     MOVE SPACES TO PV-CICS-MSG-AREA.                             23380000
233900                                                                  23390000
234000 9800-SQL-WARNING.                                                23400000
234100                                                                  23410000
234200      MOVE SQLCODE               TO SQLCODE2.                     23420000
234300      MOVE SQLERRD(3)            TO SQLERRD3.                     23430000
234400      DISPLAY '** ABEND **       ** = SQLWARNING'.                23440000
234500      DISPLAY '** PROGRAM        ** = ' PC-CURRENT-PGM-NAME.      23450000
234600      DISPLAY '** SQLCODE        ** = ' SQLCODE2.                 23460000
234700      DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                 23470000
234800      DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                 23480000
234900      DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                 23490000
235000      DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                 23500000
235100      DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                 23510000
235200      DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                 23520000
235300      DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                 23530000
235400      DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                 23540000
235500      DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                 23550000
235600                                                                  23560000
235700      MOVE 4013                  TO PV-ABEND-CODE                 23570000
235800      CALL 'ILBOABN0' USING PV-ABEND-CODE.                        23580000
235900                                                                  23590000
236000                                                                  23600000
236100 9900-SQL-ERROR.                                                  23610000
236200                                                                  23620000
236300      MOVE SQLCODE               TO SQLCODE2.                     23630000
236400      MOVE SQLERRD(3)            TO SQLERRD3.                     23640000
236500      DISPLAY '** ABEND **       ** = SQLERROR'.                  23650000
236600      DISPLAY '** PROGRAM        ** = ' PC-CURRENT-PGM-NAME.      23660000
236700      DISPLAY '** SQLCODE        ** = ' SQLCODE2.                 23670000
236800      DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                 23680000
236900      DISPLAY '** SQLERRM        ** = ' SQLERRM.                  23690000
237000      DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                 23700000
237100                                                                  23710000
237200      MOVE 4013                  TO PV-ABEND-CODE                 23720000
237300      CALL 'ILBOABN0' USING PV-ABEND-CODE.                        23730000
237400*                                                                 23740000
237500 9999-WRITE-CICS-LOG-MSG.                                         23750000
237600                                                                  23760000
237700     MOVE PC-CURRENT-PGM-NAME    TO DP013-PROGRAM.                23770000
237800     MOVE DP013-LOCATION         TO PV-CICS-MSG-AREA.             23780000
237900     PERFORM 9990-WRITE-CICS.                                     23790000
238000     STRING ' DC = '                                              23800000
238100            SU014-DC-NUMBER    DELIMITED BY SIZE                  23810000
238200                               INTO PV-CICS-MSG-AREA.             23820000
238300     PERFORM 9990-WRITE-CICS.                                     23830000
238400     IF DP013-MESSAGE-TEXT(1) > SPACES                            23840000
238500         MOVE DP013-MESSAGE-TEXT(1)  TO PV-CICS-MSG-AREA          23850000
238600         PERFORM 9990-WRITE-CICS                                  23860000
238700     END-IF.                                                      23870000
238800     IF DP013-MESSAGE-TEXT(2) > SPACES                            23880000
238900         MOVE DP013-MESSAGE-TEXT(2)  TO PV-CICS-MSG-AREA          23890000
239000         PERFORM 9990-WRITE-CICS                                  23900000
239100     END-IF.                                                      23910000
239200     IF DP013-MESSAGE-TEXT(3) > SPACES                            23920000
239300         MOVE DP013-MESSAGE-TEXT(3)  TO PV-CICS-MSG-AREA          23930000
239400         PERFORM 9990-WRITE-CICS                                  23940000
239500     END-IF.                                                      23950000
239600     IF DP013-MESSAGE-TEXT(4) > SPACES                            23960000
239700         MOVE DP013-MESSAGE-TEXT(4)  TO PV-CICS-MSG-AREA          23970000
239800         PERFORM 9990-WRITE-CICS                                  23980000
239900     END-IF.                                                      23990000
240000     IF DP013-DB2-TABLE-NAME(1) > SPACES                          24000000
240100         MOVE DP013-DB2-TABLE-NAME(1)                             24010000
240200                                     TO PV-CICS-MSG-AREA          24020000
240300         PERFORM 9990-WRITE-CICS                                  24030000
240400     END-IF.                                                      24040000
240500     IF DP013-DB2-TABLE-NAME(2) > SPACES                          24050000
240600         MOVE DP013-DB2-TABLE-NAME(2)                             24060000
240700                                     TO PV-CICS-MSG-AREA          24070000
240800         PERFORM 9990-WRITE-CICS                                  24080000
240900     END-IF.                                                      24090000
241000     IF SQLCODE > +0                                              24100000
241100         MOVE SQLCODE                TO PV-SQL-CODE               24110000
241200         STRING 'SQL CODE = '     DELIMITED BY SIZE               24120000
241300                PV-SQL-CODE       DELIMITED BY SIZE               24130000
241400                                   INTO PV-CICS-MSG-AREA          24140000
241500         PERFORM 9990-WRITE-CICS                                  24150000
241600     END-IF.                                                      24160000
241700     PERFORM VARYING PT-MSG-IDX FROM 1 BY 1 UNTIL                 24170000
241800                     PT-MESSAGE(PT-MSG-IDX) = SPACES              24180000
241900                     OR PT-MSG-IDX > 40                           24190000
242000         MOVE PT-MSG(PT-MSG-IDX) TO PV-CICS-MSG-AREA              24200000
242100         PERFORM 9990-WRITE-CICS                                  24210000
242200     END-PERFORM.                                                 24220000
242300                                                                  24230000
242400     IF PS-SOCKET-NOT-CLOSED                                      24240000
242500         PERFORM 1500-CLOSE-SOCKET                                24250000
242600     END-IF.                                                      24260000
242700                                                                  24270000
242800     EXEC CICS                                                    24280000
242900         RETURN                                                   24290000
243000     END-EXEC.                                                    24300000
243100*                                                                 24310000
243200*    NON-CICS ARCHITECTURE SYSTEM MESSAGE FORMAT MODULE           24320000
243300*                                                                 24330000
243400                                                                  24340000
243500     COPY DPPD011.                                                24350000
243600*                                                                 24360000
