000100******************************************************************00010011
000200 IDENTIFICATION DIVISION.                                         00020011
000300******************************************************************00030011
000400                                                                  00040011
000500 PROGRAM-ID.    SNKUT100.                                         00050011
000600 AUTHOR.        GERMAN BANDA.                                     00060011
000700 INSTALLATION.  KOHLS.                                            00070011
000800 DATE-WRITTEN   OCTOBER 2023.                                     00080011
000900 DATE-COMPILED.                                                   00090011
001000                                                                  00100011
001100******************************************************************00110011
001200*  THIS PROGRAM WILL OPEN A CURSOR AGAINST ASN HEADER AND ASN ORD*00120011
001300*  TABLES TO RETURN THE LATEST DATA LOADED TO THE ASN TABLES.    *00130011
001310*  (WHERE TASNHDR.PRINT_IND  = 'N')                              *00131011
001320*  USING THE ASNHDR_NBR A SECOND CURSOR WILL BE OPENED JOINING   *00132011
001330*  ASN DETAIL AND CONTAINER FILES TO RETURN AND COMPARE ASN      *00133011
001340*  CARTON QUANTITIES WITH CARTON QUANTITES LOADED ON THE         *00134011
001350*  CONTAINER TABLES. (TRT_IMPRT_CART)                            *00135011
001360******************************************************************00136011
001370* CURSOR WILL ONLY SELECT 'B' - BULK TYPE ORDERS AS THE IMPORT    00137011
001380* CARTONS TABLES ARE ONLY AT A PACK UPC LEVEL. IF THERE IS A UNIT 00138011
001390* COUNT DISCREPANCY WE WOULDN'T KNOW WHICH UPC IN THE PACK IS OFF 00139011
001400******************************************************************00140011
001500* PARM SYS_PRC_FUNC_CDE  = 'SNODD' TKRPRPM                        00150011
001600* SETTING FUNC_TXT = 'N' WILL NOT PROCESS AND CREATE AN EMPTY FILE00160011
001700******************************************************************00170011
001800 ENVIRONMENT DIVISION.                                            00180011
001900******************************************************************00190011
002000                                                                  00200011
002100 CONFIGURATION SECTION.                                           00210011
002200                                                                  00220011
002300 SOURCE-COMPUTER.        IBM-3090.                                00230011
002400 OBJECT-COMPUTER.        IBM-3090.                                00240011
002500                                                                  00250011
002600 INPUT-OUTPUT SECTION.                                            00260011
002700                                                                  00270011
002800 FILE-CONTROL.                                                    00280011
002900                                                                  00290011
003000     SELECT ASN-CARTON-FILE                                       00300011
003100         ASSIGN TO OUT01.                                         00310011
003200                                                                  00320011
003300                                                                  00330011
003400******************************************************************00340011
003500 DATA DIVISION.                                                   00350011
003600******************************************************************00360011
003700                                                                  00370011
003800 FILE SECTION.                                                    00380011
003900                                                                  00390011
004000 FD  ASN-CARTON-FILE                                              00400011
004100     RECORDING MODE IS F                                          00410011
004200     LABEL RECORDS ARE STANDARD                                   00420011
004300     BLOCK CONTAINS 0 RECORDS.                                    00430011
004400                                                                  00440011
004500 01  ASN-CARTON-RECORD          PIC  X(175).                      00450011
004600                                                                  00460011
004700*                                                                 00470011
004800******************************************************************00480011
004900 WORKING-STORAGE SECTION.                                         00490011
005000******************************************************************00500011
005100*  NUMERIC EDIT LAYOUT                                            00510011
005200******************************************************************00520011
005300     COPY DPWS010I.                                               00530011
005400*                                                                 00540011
005500*                                                                 00550011
005600******************************************************************00560011
005700** ASN OUTPUT FILE LAYOUT                                       **00570011
005800******************************************************************00580011
005900     COPY SNRD008.                                                00590011
006000*                                                                 00600011
006100******************************************************************00610011
006200** DB2 FORMATTED MESSAGE AREA                                   **00620011
006300******************************************************************00630011
006400     COPY DPWS004.                                                00640011
006500*                                                                 00650011
006600*                                                                 00660011
006700******************************************************************00670011
006800** COMMUNICATIONS AREA FOR DB2                                  **00680011
006900******************************************************************00690011
007000     EXEC SQL                                                     00700011
007100          INCLUDE SQLCA                                           00710011
007200     END-EXEC.                                                    00720011
007300*                                                                 00730011
007400*                                                                 00740011
007500******************************************************************00750011
007600** COBOL DECLARATION AND DCLGEN MEMBER FOR THE ASN HEADER       **00760011
007700** TABLE                                                        **00770011
007800******************************************************************00780011
007900     EXEC SQL                                                     00790011
008000          INCLUDE TASNHDR                                         00800011
008100     END-EXEC.                                                    00810011
008200*                                                                 00820011
008300*                                                                 00830011
008400******************************************************************00840011
008500*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE ASN ORD TABLE    **00850011
008600******************************************************************00860011
008700     EXEC SQL                                                     00870011
008800          INCLUDE TASNORD                                         00880011
008900     END-EXEC.                                                    00890011
009000*                                                                 00900011
009100*                                                                 00910011
009200******************************************************************00920011
009300** COBOL DECLARATION AND DCLGEN MEMBER FOR THE ASN DETAIL TABLE **00930011
009400******************************************************************00940011
009500     EXEC SQL                                                     00950011
009600          INCLUDE TASNDTL                                         00960011
009700     END-EXEC.                                                    00970011
009800*                                                                 00980011
009900*                                                                 00990011
010000******************************************************************01000011
010100** COBOL DECLARATION AND DCLGEN MEMBER FOR                      **01010011
010200** ASN DETAIL-PO ITEM ASSOC TABLE LAYOUT                        **01020011
010300******************************************************************01030011
010400     EXEC SQL                                                     01040011
010500          INCLUDE TASDTPL                                         01050011
010600     END-EXEC.                                                    01060011
010700*                                                                 01070011
010800******************************************************************01080011
010900*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE ASN CARTON TABLE **01090011
011000******************************************************************01100011
011100     EXEC SQL                                                     01110011
011200          INCLUDE TASNCAR                                         01120011
011300     END-EXEC.                                                    01130011
011310*                                                                 01131011
011320******************************************************************01132011
011330*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE ASN CRIT   TABLE **01133011
011340******************************************************************01134011
011350     EXEC SQL                                                     01135011
011360          INCLUDE TASCRIT                                         01136011
011370     END-EXEC.                                                    01137011
011380*                                                                 01138011
011390******************************************************************01139011
011391*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE IMPORT CONTAINER **01139111
011392*  PO TABLE                                                     **01139211
011393******************************************************************01139311
011394     EXEC SQL                                                     01139411
011395          INCLUDE TIMCNPO                                         01139511
011396     END-EXEC.                                                    01139611
011397*                                                                 01139711
011398******************************************************************01139811
011399*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE IMPORT CONTAINER **01139911
011400*  CARTON TABLE ( TRT_IMPRT_CART )                              **01140011
011401******************************************************************01140111
011402     EXEC SQL                                                     01140211
011403          INCLUDE TRT00008                                        01140311
011404     END-EXEC.                                                    01140411
011405******************************************************************01140511
011406*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE LEGACY           **01140611
011407*  PURCHASE ORDER TABLE                                         **01140711
011408******************************************************************01140811
011409     EXEC SQL                                                     01140911
011410          INCLUDE TPURCHS                                         01141011
011411     END-EXEC.                                                    01141111
011412******************************************************************01141211
011413*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE LEGACY           **01141311
011414*  PURCHASE ORDER ITEM TABLE                                    **01141411
011415******************************************************************01141511
011416     EXEC SQL                                                     01141611
011417          INCLUDE TPURITM                                         01141711
011418     END-EXEC.                                                    01141811
011419******************************************************************01141911
011420*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE XLT SKU TABLE    **01142011
011421******************************************************************01142111
011422     EXEC SQL                                                     01142211
011423          INCLUDE XLT00003                                        01142311
011424     END-EXEC.                                                    01142411
011425******************************************************************01142511
011426*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE XLT UPC TABLE    **01142611
011427******************************************************************01142711
011428     EXEC SQL                                                     01142811
011429          INCLUDE XLT00006                                        01142911
011430     END-EXEC.                                                    01143011
011440******************************************************************01144011
011441*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE PARAMETER TABLE  **01144111
011442******************************************************************01144211
011443     EXEC SQL                                                     01144311
011444          INCLUDE TKRPRPM                                         01144411
011445     END-EXEC.                                                    01144511
011446******************************************************************01144611
011447*                                                                 01144711
011448 01  ABEND-CODE                      PIC S9(04)    VALUE +0       01144811
011449                                                   COMP SYNC.     01144911
011450                                                                  01145011
011460 01  PS-PROGRAM-SWITCHES.                                         01146011
011470     05  PS-EOC-ASN-HDR-CSR-SW       PIC  X(01)    VALUE 'N'.     01147011
011480         88  PS-EOC-ASN-HDR-CSR                    VALUE 'Y'.     01148011
011490         88  PS-NOT-EOC-ASN-HDR-CSR                VALUE 'N'.     01149011
011500     05  PS-EOC-CTN-DTL-CSR-SW       PIC  X(01)    VALUE 'N'.     01150011
011600         88  PS-EOC-CTN-DTL-CSR                    VALUE 'Y'.     01160011
011700         88  PS-NOT-EOC-CTN-DTL-CSR                VALUE 'N'.     01170011
011800     05  PS-CONTINUE-SW              PIC  X(01)    VALUE 'N'.     01180011
011900         88  PS-CONTINUE-YES                       VALUE 'Y'.     01190011
012000         88  PS-CONTINUE-NO                        VALUE 'N'.     01200011
012100     05  PS-PROCESS-ASN              PIC  X(01)    VALUE 'N'.     01210011
012110         88  PS-PROCESS-ASN-YES                    VALUE 'Y'.     01211011
012120         88  PS-PROCESS-ASN-NO                     VALUE 'N'.     01212011
012130                                                                  01213011
012140                                                                  01214011
012150 01  PC-PROGRAM-CONSTANTS.                                        01215011
012160     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          01216011
012170         'SNKUT100'.                                              01217011
012180     05  PC-MAX-RETRIES              PIC S9(04)    VALUE +3       01218011
012190                                                   COMP SYNC.     01219011
012200     05  PC-N                        PIC  X(01)    VALUE 'N'.     01220011
012300                                                                  01230011
012400 01  PV-PROGRAM-VARIABLES.                                        01240011
012500     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  01250011
012600     05  PV-DB2-TABLE-NAME           PIC  X(30)    VALUE SPACES.  01260011
012700     05  PV-DB2-OPERATION-MESSAGE    PIC  X(30)    VALUE SPACES.  01270011
012800     05  PV-OPEN-COUNTER             PIC S9(04)    VALUE ZERO     01280011
012900                                                   COMP SYNC.     01290011
013000     05  PV-CLOSE-COUNTER            PIC S9(04)    VALUE ZERO     01300011
013100                                                   COMP SYNC.     01310011
013200     05  PV-FETCH-COUNTER            PIC S9(04)    VALUE ZERO     01320011
013300                                                   COMP SYNC.     01330011
013400     05  PV-TPURCHS-BYPASS-CNT       PIC S9(07)    VALUE ZERO     01340011
013500                                                   COMP-3.        01350011
013600     05  PV-TRECEIV-DEL-STAT-CNT     PIC S9(07)    VALUE ZERO     01360011
013700                                                   COMP-3.        01370011
013800     05  PV-TRECEIV-OTH-STAT-CNT     PIC S9(07)    VALUE ZERO     01380011
013900                                                   COMP-3.        01390011
014000     05  PV-LANDED-BULK-COUNT        PIC S9(07)    VALUE ZERO     01400011
014100                                                   COMP-3.        01410011
014200     05  PV-TASNHDR-READ-CNTR        PIC S9(07)    VALUE ZERO     01420011
014300                                                   COMP-3.        01430011
014400     05  PV-TASNHDR-WRITE-CNTR       PIC S9(07)    VALUE ZERO     01440011
014500                                                   COMP-3.        01450011
014600     05  PV-TDISTDT-WRITE-CNTR       PIC S9(07)    VALUE ZERO     01460011
014700                                                   COMP-3.        01470011
014800     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             01480011
014900                                                                  01490011
015000     05  PV-DISPLAY-ASNHDR-ID        PIC 9(9).                    01500011
015100                                                                  01510011
015200     05  PV-DB2-COUNT                PIC S9(09)    VALUE ZERO     01520011
015300                                                   COMP-3.        01530011
015400     05  PV-PREV-PO-NBR              PIC  9(09) VALUE ZEROS.      01540011
015500     05  PV-PREV-UPC-NBR             PIC  9(15)  VALUE ZEROS.     01550011
015600     05  PV-CARTON-QTY               PIC  S9(09)     VALUE +0.    01560011
015700     05  PV-IMP-CRTN-QTY             PIC  S9(9) COMP.             01570011
015800     05  PV-ASN-CRTN-QTY             PIC  S9(9) COMP.             01580011
015900     05  PV-PO-NUMBER                PIC  S9(09)     VALUE +0.    01590011
016000     05  PV-PKG-QTY-NULL             PIC  S9(04)    VALUE +0      01600011
016100                                                   COMP SYNC.     01610011
016200*                                                                 01620011
016300******************************************************************01630011
016400*  CURSOR TO RETURN UNPROCESSED ASN'S                             01640011
016500******************************************************************01650011
016600     EXEC SQL                                                     01660011
016700       DECLARE ASN_HEADER_CURSOR CURSOR FOR                       01670011
016800         SELECT DISTINCT                                          01680011
016900                A.ASNHDR_ID ,                                     01690011
017000                A.ASNHDR_NBR,                                     01700011
017100                A.ASNHDR_TMST,                                    01710011
017101                B.PO_NBR,                                         01710111
017102                B.LOC_NBR ,                                       01710211
017103                A.BOL_NBR                                         01710311
017104           FROM TASNHDR A,                                        01710411
017105                TASNORD B                                         01710511
017106           WHERE A.ASNHDR_ID  = B.ASNHDR_ID                       01710611
017107             AND A.PRINT_IND  = :PC-N                             01710723
017110           ORDER BY B.LOC_NBR,                                    01711013
017111                    B.PO_NBR                                      01711113
017112         WITH UR                                                  01711213
017120     END-EXEC.                                                    01712011
017130                                                                  01713011
017140******************************************************************01714011
017150*  CURSOR TO RETURN ASN AND IMPORT CARTONS AND QUANTITIES TO      01715011
017160*  COMPARE AND FIND UNIT QTY MISMATCHES                           01716011
017170******************************************************************01717011
017180                                                                  01718011
017190     EXEC SQL                                                     01719011
017200       DECLARE CARTON-DTL-CURSOR CURSOR FOR                       01720011
017300         SELECT  C.ASNCAR_NBR                                     01730011
017400                ,C.PKG_QTY                                        01740011
017500                ,B.ASSOC_QTY                                      01750011
017600                ,F.SSCC_ID                                        01760011
017610                ,F.UPC_NBR                                        01761011
017611                ,F.UNT_QTY                                        01761111
017612                ,F.CONTNR_ID                                      01761211
017613         FROM TASNDTL A,                                          01761311
017614              TASDTPL B,                                          01761411
017615              TASNCAR C,                                          01761511
017616              TASCRIT D,                                          01761611
017617              TIMCNPO E,                                          01761711
017618              TRT_IMPRT_CART F                                    01761811
017619         WHERE A.ASNHDR_ID         =  :ASNHDR-ASNHDR-ID           01761911
017620           AND A.ASNHDR_ID         =  B.ASNHDR_ID                 01762011
017630           AND A.ASNHDR_ID         =  C.ASNHDR_ID                 01763011
017640           AND A.ASNHDR_ID         =  D.ASNHDR_ID                 01764011
017650           AND C.ASNCAR_NBR        =  D.ASNCAR_NBR                01765011
017660           AND A.ASNDTL_NBR        =  B.ASNDTL_NBR                01766011
017670           AND B.ASNDTL_NBR        =  D.ASNDTL_NBR                01767011
017680           AND A.PO_NBR            =  :ASNORD-PO-NBR              01768011
017690           AND A.PO_NBR            =  C.PO_NBR                    01769011
017691           AND A.LOC_NBR           =  :ASNORD-LOC-NBR             01769111
017692           AND A.LOC_NBR           =  C.LOC_NBR                   01769211
017693           AND A.UPC_NBR           =  F.UPC_NBR                   01769311
017694           AND C.ASNCAR_NBR        =  F.SSCC_ID                   01769411
017695           AND INTEGER(A.PO_NBR)   =  E.PO_NBR                    01769511
017696           AND E.PO_NBR            =  F.PO_NBR                    01769611
017697           AND E.CONTNR_ID         =  F.CONTNR_ID                 01769711
017698           AND C.ASNCAR_NBR       =  F.SSCC_ID                    01769811
017699         WITH UR                                                  01769911
017700     END-EXEC.                                                    01770011
017800*                                                                 01780011
017900******************************************************************01790011
018000 PROCEDURE DIVISION.                                              01800011
018100******************************************************************01810011
018200                                                                  01820011
018300******************************************************************01830011
018400* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     01840011
018500*      PROGRAM.                                                   01850011
018600******************************************************************01860011
018700 0000-PROGRAM-MAINLINE.                                           01870011
018800                                                                  01880011
018900     PERFORM 1000-INITIALIZE.                                     01890011
019000                                                                  01900011
019100     IF PS-PROCESS-ASN-YES                                        01910011
019200        PERFORM 3000-OPEN-ASN-HDR-CURSOR                          01920011
019300                                                                  01930011
019400        SET PS-NOT-EOC-ASN-HDR-CSR TO TRUE                        01940011
019500        PERFORM 3100-FETCH-ASN-HDR-CURSOR                         01950011
019600                                                                  01960011
019700        SET PS-NOT-EOC-CTN-DTL-CSR TO TRUE                        01970011
019800        PERFORM 3300-PROCESS-ASN-HDR                              01980011
019900            UNTIL PS-EOC-ASN-HDR-CSR                              01990011
020000                                                                  02000011
020100     END-IF.                                                      02010011
020200     CLOSE ASN-CARTON-FILE.                                       02020011
020300                                                                  02030011
020400     MOVE PV-TASNHDR-READ-CNTR TO PV-DISPLAY-COUNT.               02040011
020500     DISPLAY 'TOTAL ASN HDR RECS READ......: ' PV-DISPLAY-COUNT.  02050011
020600                                                                  02060011
020700     MOVE PV-TPURCHS-BYPASS-CNT TO PV-DISPLAY-COUNT.              02070011
020800     DISPLAY 'TOTAL PURCH ORDERS BYPASSED..: ' PV-DISPLAY-COUNT.  02080011
020900                                                                  02090011
021000     MOVE PV-LANDED-BULK-COUNT    TO PV-DISPLAY-COUNT.            02100011
021100     DISPLAY 'TOTAL LANDED BULK POS........: ' PV-DISPLAY-COUNT.  02110011
021200                                                                  02120011
021300     MOVE PV-TASNHDR-WRITE-CNTR TO PV-DISPLAY-COUNT.              02130011
021400     DISPLAY 'TOTAL ODD ASN RECORDS WRITTEN: ' PV-DISPLAY-COUNT.  02140011
021500                                                                  02150011
021600     STOP RUN.                                                    02160011
021700*                                                                 02170011
021800*0000-EXIT.                                                       02180011
021900*                                                                 02190011
022000*                                                                 02200011
022100******************************************************************02210011
022200*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    02220011
022300******************************************************************02230011
022400 1000-INITIALIZE.                                                 02240011
022500*                                                                 02250011
022600     OPEN OUTPUT ASN-CARTON-FILE.                                 02260011
022700     PERFORM 1100-CHECK-IF-PROCESSING.                            02270011
022800*                                                                 02280011
022900*                                                                 02290011
023000*1000-EXIT.                                                       02300011
023100*                                                                 02310011
023200*                                                                 02320011
023300 1100-CHECK-IF-PROCESSING.                                        02330011
023400                                                                  02340011
023500                                                                  02350011
023600     EXEC SQL                                                     02360011
023700       SELECT FUNC_TXT                                            02370011
023800         INTO :KRPRPM-FUNC-TXT                                    02380011
023900       FROM   TKRPRPM                                             02390011
024000       WHERE  SYS_PRC_FUNC_CDE  = 'SNODD'                         02400011
024100         AND  INTFC_SYS_CDE     = 'KHL'                           02410011
024200         AND  FUNC_PRC_STAT_CDE = 'AC'                            02420011
024300         AND  LOC_ID            = 090                             02430011
024400     END-EXEC                                                     02440011
024500                                                                  02450011
024600     EVALUATE TRUE                                                02460011
024700         WHEN SQLCODE = ZERO                                      02470011
024800             MOVE KRPRPM-FUNC-TXT TO PS-PROCESS-ASN               02480011
024900             DISPLAY 'SNODD PARM PROCESSING ' PS-PROCESS-ASN      02490011
025000         WHEN SQLCODE = +100                                      02500011
025100             MOVE 'N'            TO PS-PROCESS-ASN                02510011
025200             DISPLAY 'SNODD PARM PROCESSING ' PS-PROCESS-ASN      02520011
025300         WHEN SQLWARN0 NOT = SPACES                               02530011
025400         WHEN SQLCODE < +0                                        02540011
025500         WHEN SQLCODE > ZERO                                      02550011
025600             MOVE '1100-CHECK-IF-PROCESSING '                     02560011
025700                                 TO PV-PARAGRAPH-NAME             02570011
025800             MOVE 'SELECT SNODD PARM '                            02580011
025900                                 TO PV-DB2-OPERATION-MESSAGE      02590011
026000             MOVE 'TKRPRPM  '    TO PV-DB2-TABLE-NAME             02600011
026100             PERFORM 9100-SQL-ABEND                               02610011
026200     END-EVALUATE.                                                02620011
026300                                                                  02630011
026400******************************************************************02640011
026500*  PROCESS THE DISTRIBUTION HEADER ROWS THAT ARE FOUND ON THE     02650011
026600*  RECEIVERS EXTRACT FILE.  WRITE THIS RECORD TO AN ARCHIVE FILE. 02660011
026700*  OPEN ANOTHER CURSOR AND PROCESS ALL DISTRIBUTION DETAIL ROWS   02670011
026800*  FOR A SPECIFIED LINE.                                          02680011
026900******************************************************************02690011
027000 3300-PROCESS-ASN-HDR.                                            02700011
027100*                                                                 02710011
027200     PERFORM 3400-CHECK-PO-NUMERIC                                02720011
027300                                                                  02730011
027400     IF PS-CONTINUE-YES                                           02740011
027500        SET PS-NOT-EOC-CTN-DTL-CSR TO TRUE                        02750011
027600        PERFORM 5000-OPEN-CARTON-DTL-CURSOR                       02760011
027700        PERFORM 5100-FETCH-CARTON-DTL-CURSOR                      02770011
027800*                                                                 02780011
027900        PERFORM 5300-PROCESS-CTN-DTL                              02790011
028000            UNTIL PS-EOC-CTN-DTL-CSR                              02800011
028100                                                                  02810011
028200        PERFORM 5500-CLOSE-CARTON-DTL-CURSOR                      02820011
028210        INITIALIZE PV-PREV-PO-NBR                                 02821022
028220                   PV-PREV-UPC-NBR                                02822022
028300     ELSE                                                         02830022
028400        ADD +1   TO PV-TPURCHS-BYPASS-CNT                         02840011
028500     END-IF                                                       02850011
028600                                                                  02860011
028700     PERFORM 3100-FETCH-ASN-HDR-CURSOR.                           02870011
028800*                                                                 02880011
028900*                                                                 02890011
029000 5300-PROCESS-CTN-DTL.                                            02900011
029100                                                                  02910011
029200     INITIALIZE SN008-ASN-UPD-RECORD.                             02920011
029300     MOVE +0 TO PV-CARTON-QTY.                                    02930011
029400     IF PV-PKG-QTY-NULL = 0                                       02940011
029500         MOVE ASNCAR-PKG-QTY TO PV-CARTON-QTY                     02950011
029600     ELSE                                                         02960011
029700         MOVE ASDTPL-ASSOC-QTY TO PV-CARTON-QTY                   02970011
029800     END-IF                                                       02980011
029900                                                                  02990011
030000     MOVE ASNORD-PO-NBR(1:8)  TO PV-PO-NUMBER                     03000011
030100                                                                  03010011
030200     IF NOT (PV-CARTON-QTY  = TRT00008-UNT-QTY )                  03020011
030300        IF (PV-PREV-PO-NBR  = PV-PO-NUMBER ) AND                  03030011
030400           (PV-PREV-UPC-NBR = TRT00008-UPC-NBR)                   03040020
030500            MOVE PURITM-PO-LNE-NBR TO SN008-LNE-NBR               03050011
030600            MOVE XLT00003-SKU-NBR  TO SN008-SKU                   03060011
030700        ELSE                                                      03070011
030800            PERFORM 5600-GET-PO-LINE-SKU                          03080011
030900            PERFORM 5700-GET-TOT-PO-LNE-QTY                       03090011
031000            MOVE PV-PO-NUMBER      TO PV-PREV-PO-NBR              03100011
031100            MOVE TRT00008-UPC-NBR  TO PV-PREV-UPC-NBR             03110011
031200        END-IF                                                    03120011
031300        MOVE ASNHDR-ASNHDR-ID       TO SN008-ASNHDR-ID            03130011
031400        MOVE ASNHDR-ASNHDR-NBR      TO SN008-ASNHDR-NBR           03140011
031500        MOVE ASNHDR-ASNHDR-TMST     TO SN008-ASNHDR-TMST          03150011
031600        MOVE ASNHDR-BOL-NBR(1:10)   TO SN008-BOL-NBR              03160011
031700        MOVE PV-PO-NUMBER           TO SN008-PO-NBR               03170011
031800        MOVE ASNORD-LOC-NBR         TO SN008-LOCATION             03180011
031900        MOVE TRT00008-UPC-NBR       TO SN008-UPC-NBR              03190011
032000        MOVE TRT00008-SSCC-ID(1:20) TO SN008-CARTON-NBR           03200011
032100        MOVE TRT00008-CONTNR-ID     TO SN008-CONTNR-ID            03210011
032200        MOVE PV-CARTON-QTY          TO SN008-ASN-UNT-QTY          03220011
032300**      MOVE ASNCAR-PKG-QTY         TO SN008-ASN-UNT-QTY          03230011
032400        MOVE TRT00008-UNT-QTY       TO SN008-IMPRT-UNT-QTY        03240011
032500        MOVE PURCHS-ENT-ID          TO SN008-PURCHS-ENT-ID        03250011
032600        MOVE PURCHS-PO-TYP-CDE      TO SN008-PO-TYP-CDE           03260011
032700        MOVE PURCHS-DEPT-NBR        TO SN008-DEPT                 03270011
032710        MOVE PV-IMP-CRTN-QTY        TO SN008-LINE-TOT-QTY         03271011
032800        IF ASNHDR-ASNHDR-ID  = PV-DISPLAY-ASNHDR-ID               03280011
032900           CONTINUE                                               03290011
033000        ELSE                                                      03300011
033100           DISPLAY 'ASNHDR-ASNHDR-ID ' ASNHDR-ASNHDR-ID           03310011
033200           MOVE ASNHDR-ASNHDR-ID  TO  PV-DISPLAY-ASNHDR-ID        03320011
033300        END-IF                                                    03330011
033400        PERFORM 8000-WRITE-ASN-CARTON-RECORD                      03340011
033500     END-IF.                                                      03350011
033600     INITIALIZE DCLTASNCAR                                        03360011
033700                DCLTASDTPL.                                       03370011
033800     PERFORM 5100-FETCH-CARTON-DTL-CURSOR.                        03380011
033900******************************************************************03390011
034000******************************************************************03400011
034100*  OPEN THE DISTRIBUTION HEADER CURSOR.                           03410011
034200******************************************************************03420011
034300 3000-OPEN-ASN-HDR-CURSOR.                                        03430011
034400                                                                  03440011
034500      EXEC SQL                                                    03450011
034600           OPEN ASN_HEADER_CURSOR                                 03460011
034700      END-EXEC                                                    03470011
034800                                                                  03480011
034900      EVALUATE TRUE                                               03490011
035000          WHEN SQLCODE = -904                                     03500011
035100          WHEN SQLCODE = -911                                     03510011
035200              CONTINUE                                            03520011
035300          WHEN SQLWARN0 NOT = SPACES                              03530011
035400          WHEN SQLCODE < ZERO                                     03540011
035500          WHEN SQLCODE > ZERO                                     03550011
035600              MOVE '3000-OPEN-ASN-HDR-CURSOR    '                 03560011
035700                              TO PV-PARAGRAPH-NAME                03570011
035800              MOVE 'OPEN THE ASN_HEADER_CURSOR    '               03580011
035900                              TO PV-DB2-OPERATION-MESSAGE         03590011
036000              MOVE 'TASNHDR'  TO PV-DB2-TABLE-NAME                03600011
036100              PERFORM 9100-SQL-ABEND                              03610011
036200          WHEN SQLCODE = ZERO                                     03620011
036300              CONTINUE                                            03630011
036400      END-EVALUATE.                                               03640011
036500                                                                  03650011
036600*                                                                 03660011
036700*3000-EXIT.                                                       03670011
036800*                                                                 03680011
036900*                                                                 03690011
037000******************************************************************03700011
037100*  FETCH THE ROW FROM THE RESULTS TABLE USING THE CURSOR.         03710011
037200******************************************************************03720011
037300 3100-FETCH-ASN-HDR-CURSOR.                                       03730011
037400                                                                  03740011
037500     INITIALIZE DCLTASNHDR.                                       03750011
037600                                                                  03760011
037700     EXEC SQL                                                     03770011
037800          FETCH ASN_HEADER_CURSOR                                 03780011
037900           INTO :ASNHDR-ASNHDR-ID                                 03790011
038000               ,:ASNHDR-ASNHDR-NBR                                03800011
038100               ,:ASNHDR-ASNHDR-TMST                               03810011
038200               ,:ASNORD-PO-NBR                                    03820011
038300               ,:ASNORD-LOC-NBR                                   03830011
038400               ,:ASNHDR-BOL-NBR                                   03840011
038500     END-EXEC.                                                    03850011
038600                                                                  03860011
038700     EVALUATE TRUE                                                03870011
038800         WHEN SQLCODE = ZERO                                      03880011
038900**           DISPLAY 'PROCESSING ASNHDR_ID: ' ASNHDR-ASNHDR-ID    03890011
039000             ADD +1                   TO PV-TASNHDR-READ-CNTR     03900011
039100         WHEN SQLCODE = +100                                      03910011
039200             SET PS-EOC-ASN-HDR-CSR                               03920011
039300                                      TO TRUE                     03930011
039400         WHEN SQLWARN0 NOT = SPACES                               03940011
039500         WHEN SQLCODE < ZERO                                      03950011
039600         WHEN SQLCODE > ZERO                                      03960011
039700             MOVE '3100-FETCH-ASN-HDR-CURSOR  '                   03970011
039800                                      TO PV-PARAGRAPH-NAME        03980011
039900             MOVE 'FETCH THE ASN_HEADER_CURSOR   '                03990011
040000                                      TO PV-DB2-OPERATION-MESSAGE 04000011
040100             MOVE 'TASNHDR'           TO PV-DB2-TABLE-NAME        04010011
040200             PERFORM 9100-SQL-ABEND                               04020011
040300     END-EVALUATE.                                                04030011
040400*                                                                 04040011
040500*3100-EXIT.                                                       04050011
040600*                                                                 04060011
040700*                                                                 04070011
040800******************************************************************04080011
040900*  CLOSE THE DISTRIBUTION HEADER CURSOR                           04090011
041000******************************************************************04100011
041100 3500-CLOSE-ASN-HDR-CURSOR.                                       04110011
041200                                                                  04120011
041300     PERFORM WITH TEST AFTER                                      04130011
041400       VARYING PV-CLOSE-COUNTER FROM 1 BY 1                       04140011
041500         UNTIL (PV-CLOSE-COUNTER > PC-MAX-RETRIES                 04150011
041600                OR                                                04160011
041700                SQLCODE = ZERO)                                   04170011
041800                                                                  04180011
041900         EXEC SQL                                                 04190011
042000              CLOSE ASN_HEADER_CURSOR                             04200011
042100         END-EXEC                                                 04210011
042200                                                                  04220011
042300         EVALUATE TRUE                                            04230011
042400             WHEN SQLCODE = -904                                  04240011
042500             WHEN SQLCODE = -911                                  04250011
042600                 CONTINUE                                         04260011
042700             WHEN SQLWARN0 NOT = SPACES                           04270011
042800             WHEN SQLCODE < ZERO                                  04280011
042900             WHEN SQLCODE > ZERO                                  04290011
043000                 MOVE '3500-CLOSE-ASN-HDR-CURSOR   '              04300011
043100                                 TO PV-PARAGRAPH-NAME             04310011
043200                 MOVE 'CLOSE THE ASN_HEADER_CURSOR    '           04320011
043300                                 TO PV-DB2-OPERATION-MESSAGE      04330011
043400                 MOVE 'TDISTHD'  TO PV-DB2-TABLE-NAME             04340011
043500                 PERFORM 9100-SQL-ABEND                           04350011
043600             WHEN SQLCODE = ZERO                                  04360011
043700                 CONTINUE                                         04370011
043800         END-EVALUATE                                             04380011
043900     END-PERFORM.                                                 04390011
044000                                                                  04400011
044100     IF PV-CLOSE-COUNTER > PC-MAX-RETRIES                         04410011
044200         MOVE '3500-CLOSE-ASN-HDR-CURSOR'                         04420011
044300                                 TO PV-PARAGRAPH-NAME             04430011
044400         MOVE 'CLOSE MAX RETRIES EXCEEDED     '                   04440011
044500                                 TO PV-DB2-OPERATION-MESSAGE      04450011
044600         MOVE 'TDISTHD'          TO PV-DB2-TABLE-NAME             04460011
044700         PERFORM 9100-SQL-ABEND                                   04470011
044800     END-IF.                                                      04480011
044900*                                                                 04490011
045000*3200-EXIT.                                                       04500011
045100*                                                                 04510011
045200 3400-CHECK-PO-NUMERIC.                                           04520011
045300       SET PS-CONTINUE-YES      TO TRUE                           04530011
045400       IF ASNORD-PO-NBR  > SPACES                                 04540011
045500          MOVE ASNORD-PO-NBR              TO DP010I-UNEDITED-FIELD04550011
045600          MOVE 8                          TO DP010I-MAXIMUM-DIGITS04560011
045700          MOVE ZERO                   TO DP010I-MAXIMUM-DECIMALS  04570011
045800          SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                 04580011
045900          CALL DP010I-NUMERIC-EDIT-ROUTINE                        04590011
046000               USING DP010I-NUMERIC-EDIT-AREA                     04600011
046100          IF DP010I-ERROR-DETECTED                                04610011
046200             SET PS-CONTINUE-NO        TO TRUE                    04620011
046300             DISPLAY 'ASNORD-PO-NBR ' ASNORD-PO-NBR               04630011
046400          ELSE                                                    04640011
046500              MOVE DP010I-NUMERIC-FIELD                           04650011
046600                                  TO PURCHS-PO-NBR                04660011
046700              PERFORM 3600-SELECT-TPURCHS                         04670011
046800          END-IF                                                  04680011
046900       ELSE                                                       04690011
047000          SET PS-CONTINUE-NO        TO TRUE                       04700011
047100       END-IF.                                                    04710011
047200******************************************************************04720011
047300*   CHECKED FOR LANDED TYPE PURCHASE ORDERS                      *04730011
047400******************************************************************04740011
047500 3600-SELECT-TPURCHS.                                             04750011
047600                                                                  04760011
047700     EXEC SQL                                                     04770011
047800       SELECT A.ENT_ID                                            04780011
047900            , A.PO_TYP_CDE                                        04790011
048000            , A.DEPT_NBR                                          04800011
048100       INTO   :PURCHS-ENT-ID                                      04810011
048200            , :PURCHS-PO-TYP-CDE                                  04820011
048300            , :PURCHS-DEPT-NBR                                    04830011
048400       FROM   TPURCHS A                                           04840011
048500       WHERE A.PO_NBR         = :PURCHS-PO-NBR                    04850011
048600         AND A.VER_STATUS_CDE = 'A'                               04860011
048700         AND A.PO_TYP_CDE IN ('LD','EC','LE')                     04870011
048800         AND A.PKGNG_CDE = 'B'                                    04880011
048900     END-EXEC.                                                    04890011
049000                                                                  04900011
049100     EVALUATE TRUE                                                04910011
049200         WHEN SQLCODE = ZERO                                      04920011
049300             SET PS-CONTINUE-YES TO TRUE                          04930011
049400             ADD +1 TO PV-LANDED-BULK-COUNT                       04940011
049500         WHEN SQLCODE = +100                                      04950011
049600             SET PS-CONTINUE-NO  TO TRUE                          04960011
049700         WHEN SQLWARN0 NOT = SPACES                               04970011
049800         WHEN SQLCODE < +0                                        04980011
049900         WHEN SQLCODE > ZERO                                      04990011
050000             MOVE '3600-SELECT-TPURCHS   '                        05000011
050100                                 TO PV-PARAGRAPH-NAME             05010011
050200             MOVE 'SELECT BULK PO NUM'                            05020011
050300                                 TO PV-DB2-OPERATION-MESSAGE      05030011
050400             MOVE 'TPURCHS  '    TO PV-DB2-TABLE-NAME             05040011
050500             DISPLAY 'PV-PO-NUMBER ' PV-PO-NUMBER                 05050011
050600             PERFORM 9100-SQL-ABEND                               05060011
050700     END-EVALUATE.                                                05070011
050800******************************************************************05080011
050900*  OPEN THE DISTRIBUTION DETAIL CURSOR.                           05090011
051000******************************************************************05100011
051100 5000-OPEN-CARTON-DTL-CURSOR.                                     05110011
051200     PERFORM WITH TEST AFTER                                      05120011
051300       VARYING PV-OPEN-COUNTER FROM 1 BY 1                        05130011
051400         UNTIL (PV-OPEN-COUNTER > PC-MAX-RETRIES                  05140011
051500                OR                                                05150011
051600                SQLCODE = ZERO)                                   05160011
051700                                                                  05170011
051800         EXEC SQL                                                 05180011
051900              OPEN CARTON-DTL-CURSOR                              05190011
052000         END-EXEC                                                 05200011
052100                                                                  05210011
052200         EVALUATE TRUE                                            05220011
052300             WHEN SQLCODE = -904                                  05230011
052400             WHEN SQLCODE = -911                                  05240011
052500                 CONTINUE                                         05250011
052600             WHEN SQLWARN0 NOT = SPACES                           05260011
052700             WHEN SQLCODE < ZERO                                  05270011
052800             WHEN SQLCODE > ZERO                                  05280011
052900                 MOVE '5000-OPEN-CARTON-DTL-CURSOR    '           05290011
053000                                 TO PV-PARAGRAPH-NAME             05300011
053100                 MOVE 'OPEN THE CARTON-DTL-CURSOR    '            05310011
053200                                 TO PV-DB2-OPERATION-MESSAGE      05320011
053300                 MOVE 'TASNDTL'  TO PV-DB2-TABLE-NAME             05330011
053400                 PERFORM 9100-SQL-ABEND                           05340011
053500             WHEN SQLCODE = ZERO                                  05350011
053600                 CONTINUE                                         05360011
053700         END-EVALUATE                                             05370011
053800     END-PERFORM.                                                 05380011
053900                                                                  05390011
054000     IF PV-OPEN-COUNTER > PC-MAX-RETRIES                          05400011
054100         MOVE '5000-OPEN-CARTON-DTL-CURSOR   '                    05410011
054200                                 TO PV-PARAGRAPH-NAME             05420011
054300         MOVE 'OPEN MAX RETRIES EXCEEDED     '                    05430011
054400                                 TO PV-DB2-OPERATION-MESSAGE      05440011
054500         MOVE 'TASNDTL'          TO PV-DB2-TABLE-NAME             05450011
054600         PERFORM 9100-SQL-ABEND                                   05460011
054700     END-IF.                                                      05470011
054800*                                                                 05480011
054900*5300-EXIT.                                                       05490011
055000*                                                                 05500011
055100*                                                                 05510011
055200******************************************************************05520011
055300*  FETCH THE ROW FROM THE RESULTS TABLE USING THE CURSOR.         05530011
055400******************************************************************05540011
055500 5100-FETCH-CARTON-DTL-CURSOR.                                    05550011
055600     EXEC SQL                                                     05560011
055700          FETCH CARTON-DTL-CURSOR                                 05570011
055800           INTO :ASNCAR-ASNCAR-NBR                                05580011
055900               ,:ASNCAR-PKG-QTY :PV-PKG-QTY-NULL                  05590011
056000               ,:ASDTPL-ASSOC-QTY                                 05600011
056100               ,:TRT00008-SSCC-ID                                 05610011
056200               ,:TRT00008-UPC-NBR                                 05620011
056300               ,:TRT00008-UNT-QTY                                 05630011
056400               ,:TRT00008-CONTNR-ID                               05640011
056500     END-EXEC.                                                    05650011
056600                                                                  05660011
056700     EVALUATE TRUE                                                05670011
056800         WHEN SQLCODE = ZERO                                      05680011
056900             CONTINUE                                             05690011
057000         WHEN SQLCODE = +100                                      05700011
057100             SET PS-EOC-CTN-DTL-CSR                               05710011
057200                                 TO TRUE                          05720011
057300         WHEN SQLWARN0 NOT = SPACES                               05730011
057400         WHEN SQLCODE < ZERO                                      05740011
057500         WHEN SQLCODE > ZERO                                      05750011
057600             MOVE '5100-FETCH-CARTON-DTL-CURSOR  '                05760011
057700                                 TO PV-PARAGRAPH-NAME             05770011
057800             MOVE 'FETCH THE CARTON-DTL-CURSOR   '                05780011
057900                                 TO PV-DB2-OPERATION-MESSAGE      05790011
058000             MOVE 'TRT_IMPRT'    TO PV-DB2-TABLE-NAME             05800011
058100              DISPLAY 'ASNHDR-ASNHDR-ID' ASNHDR-ASNHDR-ID         05810011
058200              DISPLAY 'ASNORD-PO-NBR   ' ASNORD-PO-NBR            05820011
058300              DISPLAY 'ASNORD-LOC-NBR  ' ASNORD-LOC-NBR           05830011
058400             PERFORM 9100-SQL-ABEND                               05840011
058500     END-EVALUATE.                                                05850011
058600*                                                                 05860011
058700*5400-EXIT.                                                       05870011
058800*                                                                 05880011
058900*                                                                 05890011
059000******************************************************************05900011
059100*  CLOSE THE DISTRIBUTION DETAIL CURSOR                           05910011
059200******************************************************************05920011
059300 5500-CLOSE-CARTON-DTL-CURSOR.                                    05930011
059400                                                                  05940011
059500     PERFORM WITH TEST AFTER                                      05950011
059600       VARYING PV-CLOSE-COUNTER FROM 1 BY 1                       05960011
059700         UNTIL (PV-CLOSE-COUNTER > PC-MAX-RETRIES                 05970011
059800                OR                                                05980011
059900                SQLCODE = ZERO)                                   05990011
060000                                                                  06000011
060100         EXEC SQL                                                 06010011
060200              CLOSE CARTON-DTL-CURSOR                             06020011
060300         END-EXEC                                                 06030011
060400                                                                  06040011
060500         EVALUATE TRUE                                            06050011
060600             WHEN SQLCODE = -904                                  06060011
060700             WHEN SQLCODE = -911                                  06070011
060800                 CONTINUE                                         06080011
060900             WHEN SQLWARN0 NOT = SPACES                           06090011
061000             WHEN SQLCODE < ZERO                                  06100011
061100             WHEN SQLCODE > ZERO                                  06110011
061200                 MOVE '5500-CLOSE-CARTON-DTL-CURSOR   '           06120011
061300                                 TO PV-PARAGRAPH-NAME             06130011
061400                 MOVE 'CLOSE THE CARTON-DTL-CURSOR    '           06140011
061500                                 TO PV-DB2-OPERATION-MESSAGE      06150011
061600                 MOVE 'TASNDTL'  TO PV-DB2-TABLE-NAME             06160011
061700                 PERFORM 9100-SQL-ABEND                           06170011
061800             WHEN SQLCODE = ZERO                                  06180011
061900                 CONTINUE                                         06190011
062000         END-EVALUATE                                             06200011
062100     END-PERFORM.                                                 06210011
062200                                                                  06220011
062300     IF PV-CLOSE-COUNTER > PC-MAX-RETRIES                         06230011
062400         MOVE '5500-CLOSE-CARTON-DTL-CURSOR'                      06240011
062500                                 TO PV-PARAGRAPH-NAME             06250011
062600         MOVE 'CLOSE MAX RETRIES EXCEEDED     '                   06260011
062700                                 TO PV-DB2-OPERATION-MESSAGE      06270011
062800         MOVE 'TRT_IMPRT_CRTN'   TO PV-DB2-TABLE-NAME             06280011
062900         PERFORM 9100-SQL-ABEND                                   06290011
063000     END-IF.                                                      06300011
063100*                                                                 06310011
063200*5500-EXIT.                                                       06320011
063300*                                                                 06330011
063400*                                                                 06340011
063500 5600-GET-PO-LINE-SKU.                                            06350011
063600     MOVE PV-PO-NUMBER         TO PURITM-PO-NBR                   06360011
063700     MOVE TRT00008-UPC-NBR     TO XLT00006-UPC-NBR                06370011
063800                                                                  06380011
063900     EXEC SQL                                                     06390011
064000       SELECT A.PO_LNE_NBR,                                       06400011
064100              C.SKU_NBR                                           06410011
064200       INTO   :PURITM-PO-LNE-NBR                                  06420011
064300             ,:XLT00003-SKU-NBR                                   06430011
064400       FROM   TPURITM A                                           06440011
064500             ,XLT_UPC B                                           06450011
064600             ,XLT_SKU C                                           06460011
064700       WHERE A.PO_NBR         = :PURITM-PO-NBR                    06470011
064800         AND A.VER_STATUS_CDE = 'A'                               06480011
064900         AND B.UPC_NBR        = :XLT00006-UPC-NBR                 06490011
065000         AND B.INTR_UPC_ID    = C.INTR_UPC_ID                     06500011
065100         AND A.ITM_NBR        = C.ITM_NBR                         06510011
065200     END-EXEC.                                                    06520011
065300                                                                  06530011
065400     EVALUATE TRUE                                                06540011
065500         WHEN SQLCODE = ZERO                                      06550011
065600             MOVE PURITM-PO-LNE-NBR TO SN008-LNE-NBR              06560011
065700             MOVE XLT00003-SKU-NBR  TO SN008-SKU                  06570011
065800         WHEN SQLCODE = +100                                      06580011
065900             CONTINUE                                             06590011
066000         WHEN SQLWARN0 NOT = SPACES                               06600011
066100         WHEN SQLCODE < +0                                        06610011
066200         WHEN SQLCODE > ZERO                                      06620011
066300             MOVE '5600-GET-PO-LINE-SKU  '                        06630011
066400                                 TO PV-PARAGRAPH-NAME             06640011
066500             MOVE 'GET PO LINE SKU   '                            06650011
066600                                 TO PV-DB2-OPERATION-MESSAGE      06660011
066700             MOVE 'TPURITM  '    TO PV-DB2-TABLE-NAME             06670011
066800             DISPLAY 'PV-PO-NUMBER ' PV-PO-NUMBER                 06680011
066900             DISPLAY 'UPC NUMBER      ' TRT00008-UPC-NBR          06690011
067000             PERFORM 9100-SQL-ABEND                               06700011
067100     END-EVALUATE.                                                06710011
067200******************************************************************06720011
067300 5700-GET-TOT-PO-LNE-QTY.                                         06730011
067400     MOVE PV-PO-NUMBER         TO TRT00008-PO-NBR                 06740011
067500     MOVE ZEROES               TO PV-IMP-CRTN-QTY                 06750011
067600                                  PV-ASN-CRTN-QTY.                06760011
067700     EXEC SQL                                                     06770011
067800       SELECT SUM(F.UNT_QTY)                                      06780011
067900            , A.ASNDTL_NBR                                        06790011
068000        INTO :PV-IMP-CRTN-QTY                                     06800011
068100           , :ASNDTL-ASNDTL-NBR                                   06810011
068200       FROM TASNDTL A,                                            06820011
068300            TASDTPL B,                                            06830011
068400            TASNCAR C,                                            06840011
068500            TASCRIT D,                                            06850011
068600            TIMCNPO E,                                            06860011
068700            TRT_IMPRT_CART F                                      06870011
068800       WHERE A.ASNHDR_ID        =  :ASNHDR-ASNHDR-ID              06880011
068900         AND A.ASNHDR_ID         =  B.ASNHDR_ID                   06890011
068910         AND A.ASNHDR_ID         =  C.ASNHDR_ID                   06891011
068920         AND A.ASNHDR_ID         =  D.ASNHDR_ID                   06892011
068930         AND C.ASNCAR_NBR        =  D.ASNCAR_NBR                  06893011
068940         AND A.ASNDTL_NBR        =  B.ASNDTL_NBR                  06894011
068950         AND B.ASNDTL_NBR        =  D.ASNDTL_NBR                  06895011
068960         AND A.PO_NBR            =  :ASNORD-PO-NBR                06896021
068970         AND A.PO_NBR            =  C.PO_NBR                      06897011
068980         AND A.LOC_NBR           =  :ASNORD-LOC-NBR               06898011
068990         AND A.LOC_NBR           =  C.LOC_NBR                     06899011
068991         AND A.UPC_NBR           =  F.UPC_NBR                     06899111
068992         AND C.ASNCAR_NBR        =  F.SSCC_ID                     06899211
068993         AND INTEGER(A.PO_NBR)   =  E.PO_NBR                      06899311
068994         AND E.PO_NBR            =  F.PO_NBR                      06899411
068995         AND E.CONTNR_ID         =  F.CONTNR_ID                   06899511
068996         AND C.ASNCAR_NBR       =  F.SSCC_ID                      06899611
068997         AND B.PO_LN_NBR        = :PURITM-PO-LNE-NBR              06899711
068998       GROUP BY  A.ASNDTL_NBR                                     06899811
069000     END-EXEC.                                                    06900011
069100                                                                  06910011
069200     EVALUATE TRUE                                                06920011
069300         WHEN SQLCODE = ZERO                                      06930011
069400             CONTINUE                                             06940011
069700         WHEN SQLCODE = +100                                      06970011
069800             CONTINUE                                             06980011
069900         WHEN SQLWARN0 NOT = SPACES                               06990011
070000         WHEN SQLCODE < +0                                        07000011
070100         WHEN SQLCODE > ZERO                                      07010011
070200             MOVE '5700-GET-TOT-PO-LNE-QTY '                      07020011
070300                                 TO PV-PARAGRAPH-NAME             07030011
070400             MOVE 'GET TOT FOR PO/LNE'                            07040011
070500                                 TO PV-DB2-OPERATION-MESSAGE      07050011
070600             MOVE 'TRT_IMPRT_CA' TO PV-DB2-TABLE-NAME             07060011
070700             DISPLAY 'PV-PO-NUMBER ' PV-PO-NUMBER                 07070011
070800             DISPLAY 'UPC NUMBER      ' TRT00008-UPC-NBR          07080011
070900             PERFORM 9100-SQL-ABEND                               07090011
071000     END-EVALUATE.                                                07100011
071100******************************************************************07110011
071200*  WRITE THE DISTRIBUTION HEADER RECORD                           07120011
071300******************************************************************07130011
071400 8000-WRITE-ASN-CARTON-RECORD.                                    07140011
071500                                                                  07150011
071600     WRITE ASN-CARTON-RECORD                                      07160011
071700         FROM SN008-ASN-UPD-RECORD                                07170011
071800     ADD +1 TO PV-TASNHDR-WRITE-CNTR.                             07180011
071900*                                                                 07190011
072000*8000-EXIT.                                                       07200011
072100*                                                                 07210011
072200******************************************************************07220011
072300*                                                                 07230011
072400 9100-SQL-ABEND.                                                  07240011
072500******************************************************************07250011
072600*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    07260011
072700*  ERROR OR WARNING CODE OCCURS.                                  07270011
072800******************************************************************07280011
072900     DISPLAY '9100-SQL-ABEND'.                                    07290011
073000     DISPLAY '** ABEND           **'.                             07300011
073100     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  07310011
073200     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        07320011
073300     DISPLAY '** TABLE AFFECTED  ** = ' PV-DB2-TABLE-NAME.        07330011
073400     DISPLAY '** OPERATION       ** = ' PV-DB2-OPERATION-MESSAGE  07340011
073500     DISPLAY '**                 ** = '                           07350011
073600                                                                  07360011
073700******************************************************************07370011
073800* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    07380011
073900* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         07390011
074000* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     07400011
074100* FORMAT.                                                         07410011
074200******************************************************************07420011
074300     COPY DPPD004.                                                07430011
074400                                                                  07440011
074500     MOVE +4013                  TO ABEND-CODE.                   07450011
074600     CALL 'ILBOABN0' USING ABEND-CODE.                            07460011
074700*9100-EXIT.                                                       07470011
