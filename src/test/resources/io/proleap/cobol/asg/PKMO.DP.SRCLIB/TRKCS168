000100*-----------------------*                                         00010099
000200 IDENTIFICATION DIVISION.                                         00020099
000300*-----------------------*                                         00030099
000400 PROGRAM-ID.    TRKCS168.                                         00040099
000500 AUTHOR.        ANN RAISLER.                                      00050099
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060099
000700 DATE-WRITTEN.  11/98.                                            00070099
000800 DATE-COMPILED.                                                   00080099
000900                                                                  00090099
001000*---------------------------------------------------------------* 00100099
001100*    Y168 - TRAILER LIST                                        * 00110099
001200*                                                               * 00120099
001300*    THIS PROGRAM GENERATES A LIST OF ALL THE TRAILERS AND      * 00130099
001400*    ASSOCIATED DATES FOR A PO.                                 * 00140099
001500*                                                               * 00150099
001600*    DOCUMENTATION REGARDING TRLR-CSR                           * 00160099
001700*    --------------------------------                           * 00170099
001800*    THERE ARE 8 SECTIONS OF SELECTS EACH JOINED BY A           * 00180099
001900*    UNION.                                                     * 00190099
002000*    SECTION 1 : IS GROUP I 1 OF 2                              * 00200099
002100*    SECTION 2 : IS GROUP I 2 OF 2                              * 00210099
002200*    SECTION 3 : IS GROUP II 1 OF 2                             * 00220099
002300*    SECTION 4 : IS GROUP II 2 OF 2                             * 00230099
002400*    SECTION 5 : IS GROUP III 1 OF 4                            * 00240099
002500*    SECTION 6 : IS GROUP III 2 OF 4                            * 00250099
002600*    SECTION 7 : IS GROUP III 3 OF 4                            * 00260099
002700*    SECTION 8 : IS GROUP III 4 OF 4                            * 00270099
002800*                                                               * 00280099
002900*  GROUP I AND II AND III                                       * 00290099
003000*   GROUP I, II, III DIFFER IN THAT GROUP I PULLS TRAILERS      * 00300099
003100*   WHERE THERE IS NO RECEIVER OR PACKING SLIP WHERE AS GROUP II* 00310099
003200*   & III MATCHES RECEIVERS BY TSHIPMT AND TPKSLIP.  OTHERWISE  * 00320099
003300*   THE SELECTS BETWEEN GROUP I, II AND III ARE THE SAME.  THE  * 00330099
003400*   OVERALL ORDER BY OF ALL OF THE GROUPS AND 1 OF 2 AND 2 OF 2 * 00340099
003500*   IS ETA IN DESCENDING ORDER.                                 * 00350099
003600*                                                               * 00360099
003700*  GROUP I 1 OF 2                                               * 00370099
003800*    GROUP I WILL PULL THE TRAILER AND DC FOR ALL               * 00380099
003900*    SHIPMENTS THAT DO NOT HAVE A RECEIVER.  1 OF 2 AND 2 OF 2  * 00390099
004000*    WILL SELECT SHIPMENTS WHERE RECEIVER IS 0.  IN ADDITION    * 00400099
004100*    ETA IS PULLED FROM TSHIPST.                                * 00410099
004200*                                                               * 00420099
004300*  GROUP I 2 OF 2                                               * 00430099
004400*     THE DIFFERENCE OF 2 OF 2 VERSUS 1 OF 2 IS SIMPLY          * 00440099
004500*     THE ETA DATE IS PULLED FROM TVHTRIP.                      * 00450099
004600*                                                               * 00460099
004700*  GROUP II 1 OF 2                                              * 00470099
004800*     GROUP II WILL PULL THE TRAILER AND DC FOR ALL             * 00480099
004900*     SHIPMENTS THAT HAVE A MATCHING RECEIVER ON TSHPTPO        * 00490099
005000*     AND MATCHING PRO BILL OR BILL OF LADING IN TPKSLIP.       * 00500099
005100*     1 OF 2 AND 2 OF 2 WILL SELECT SHIPMENTS WHERE RECEIVER IS * 00510099
005200*     NON 0.  IN ADDITION ETA IS PULLED FROM TSHIPST.           * 00520099
005300*                                                               * 00530099
005400*  GROUP II 2 OF 2                                              * 00540099
005500*      THE DIFFERENCE OF 2 OF 2 VERSUS 1 OF 2 IS SIMPLY         * 00550099
005600*      THE ETA DATE IS PULLED FROM TVHTRIP.                     * 00560099
005700*                                                               * 00570099
005800*  GROUP III 1 OF 4                                             * 00580099
005900*     GROUP III WILL PULL THE TRAILER AND DC FOR ALL            * 00590099
006000*     SHIPMENTS THAT HAVE A MATCHING RECEIVER ON TSHPTPO        * 00600099
006100*     AND NO MATCHING PRO BILL OR BILL OF LADING IN TPKSLIP.    * 00610099
006200*     1 OF 4 AND 2 OF 4 WILL SELECT SHIPMENTS WHERE RECEIVER IS * 00620099
006300*     NON 0.  IN ADDITION ETA IS PULLED FROM TSHIPST.           * 00630099
006400*                                                               * 00640099
006500*  GROUP III 2 OF 4                                             * 00650099
006600*      THE DIFFERENCE OF 2 OF 4 VERSUS 1 OF 4 IS SIMPLY         * 00660099
006700*      THE ETA DATE IS PULLED FROM TVHTRIP.                     * 00670099
006800*                                                               * 00680099
006900*  GROUP III 3 OF 4                                             * 00690099
007000*     GROUP III WILL PULL THE TRAILER AND DC FOR ALL            * 00700099
007100*     SHIPMENTS THAT DO NOT HAVE A MATCHING RECEIVER AND        * 00710099
007200*     PRO BILL OR BILL OF LADING IN TPKSLIP.                    * 00720099
007300*     1 OF 2 AND 2 OF 2 WILL SELECT SHIPMENTS WHERE RECEIVER IS * 00730099
007400*     NON 0.  IN ADDITION ETA IS PULLED FROM TSHIPST.           * 00740099
007500*                                                               * 00750099
007600*  GROUP III 4 OF 4                                             * 00760099
007700*      THE DIFFERENCE OF 4 OF 4 VERSUS 3 OF 4 IS SIMPLY         * 00770099
007800*      THE ETA DATE IS PULLED FROM TVHTRIP.                     * 00780099
007900*---------------------------------------------------------------* 00790099
007910***************************************************************** 00800099
007920* DATE  05/16/2011                                                00810099
007930*  CHANGE MADE: THE NEW SYSTEM OF RECORD FOR OUTER PACK QTY WILL  00820099
007940*  BE RMS AND PUBLISHED TO TPURITM.  CHANGED OUTR-PCK-CSR         00830099
007950*  TO SELECT  OUTR_PK_QTY FROM TPURITM AND REMOVED JOIN TO TUPC   00840099
007960*  AND TSKXREF.                                                   00850099
007970*  MADE BY: GERMAN BANDA                                          00860099
007980***************************************************************** 00870099
263697* CHANGED 11/08/2021    BY JIM HUNTER      WR: CHG0263697         00872099
263697* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00873099
263697* MAKING THE CALL DYNAMIC VS STATIC.                              00874099
263697*---------------------------------------------------------------* 00875099
CICS  * CHANGED  1/12/2023    BY JIM HUNTER      WR: CHG0278495         00876099
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00877099
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00878099
CICS  *-----------------------------------------------------------------00879099
008000                                                                  00880099
008100 ENVIRONMENT DIVISION.                                            00890099
008200                                                                  00900099
008300 DATA DIVISION.                                                   00910099
008400                                                                  00920099
008500 WORKING-STORAGE SECTION.                                         00930099
008600                                                                  00940099
008700 01  DK-DB2-KEYS.                                                 00950099
008800     15  DK-PO-NBR                      PIC S9(09)  COMP.         00960099
008900     15  DK-VSL-NAME                    PIC  X(20).               00970099
009000     15  DK-VOY-NO                      PIC  X(10).               00980099
009100     15  DK-TRIP-ID                     PIC S9(09)  COMP.         00990099
009200                                                                  01000099
009300 01  PC-PROGRAM-CONSTANTS.                                        01010099
009400     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         01020099
009500                                                    'TR168A  '.   01030099
009600     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         01040099
009700                                                    'TRKM168 '.   01050099
009800     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         01060099
009900                                                    'TRKCS168'.   01070099
010000     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      01080099
010100     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      01090099
010200     05  PC-LIST-FORMAT                 PIC  X(01)  VALUE '1'.    01100099
010300     05  PC-PO-CRIT-SUMM-FORMAT         PIC  X(01)  VALUE '2'.    01110099
010400     05  PC-PO-SAILING-FORMAT           PIC  X(01)  VALUE '3'.    01120099
010500     05  PC-0001                        PIC  X(04)  VALUE '0001'. 01130099
010600     05  PC-N                           PIC  X(01)  VALUE 'N'.    01140099
010700     05  PC-Y                           PIC  X(01)  VALUE 'Y'.    01150099
010800     05  PC-NEG-1                       PIC S9(03)  VALUE -1      01160099
010900                                                    COMP-3.       01170099
011000     05  PC-MULTI                       PIC  X(05)  VALUE 'MULTI'.01180099
011100     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +08     01190099
011200                                                    COMP SYNC.    01200099
011300     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      01210099
011400                                                    COMP SYNC.    01220099
011500     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         01230099
011600                                                    +1000000      01240099
011700                                                    COMP-3.       01250099
011800     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      01260099
011900                                                    COMP SYNC.    01270099
012000     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       01280099
012100                                                    COMP-3.       01290099
012200     05  PC-INIT-DATE                   PIC  X(10)  VALUE         01300099
012300                                                    '0001-01-01'. 01310099
012400     05  PC-DEFAULT-TMST                PIC  X(26)  VALUE         01320099
012500                                    '0001-01-01-00.00.00.000000'. 01330099
012600     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  01340099
012700     05  PC-P                           PIC  X(02)  VALUE 'P '.   01350099
012800     05  PC-AF                          PIC  X(02)  VALUE 'AF'.   01360099
012900     05  PC-AG                          PIC  X(02)  VALUE 'AG'.   01370099
013000     05  PC-AJ                          PIC  X(02)  VALUE 'AJ'.   01380099
013100     05  PC-AM                          PIC  X(02)  VALUE 'AM'.   01390099
013200     05  PC-AR                          PIC  X(02)  VALUE 'AR'.   01400099
013300                                                                  01410099
013400     05  PC-TSYMSG-NUMBERS.                                       01420099
013500         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  01430099
013600         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  01440099
013700         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  01450099
013800         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  01460099
013900         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  01470099
014000         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  01480099
014100         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  01490099
014200         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  01500099
014300         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  01510099
014400         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01520099
014500         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01530099
014600         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01540099
014700         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01550099
014800         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01560099
014900         10  PC-TSYMSG-01021            PIC  9(05)  VALUE 01021.  01570099
015000                                                                  01580099
015100 01  PS-PROGRAM-SWITCHES.                                         01590099
015200     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01600099
015300         88  PS-NO-ERROR                            VALUE 'Y'.    01610099
015400         88  PS-ERROR                               VALUE 'N'.    01620099
015500     05  PS-LIST-SW                     PIC  X(01)  VALUE 'N'.    01630099
015600         88  PS-LIST-END                            VALUE 'Y'.    01640099
015700         88  PS-NO-LIST-END                         VALUE 'N'.    01650099
015800     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01660099
015900         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01670099
016000         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01680099
016100                                                                  01690099
016200 01  PV-PROGRAM-VARIABLES.                                        01700099
016300     05  PV-DEPT-NBR                    PIC  X(04).               01710099
016400     05  PV-DEPT-NBR-N REDEFINES                                  01720099
016500         PV-DEPT-NBR                    PIC  9(04).               01730099
016600     05  PV-SUB                         PIC S9(04)  VALUE +0      01740099
016700                                                    COMP SYNC.    01750099
016800     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01760099
016900                                                    COMP SYNC.    01770099
017000     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01780099
017100                                                    COMP-3.       01790099
017200     05  PV-PO-COUNT                    PIC S9(09)  VALUE +0      01800099
017300                                                    COMP-3.       01810099
017400     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01820099
017500                                                    COMP-3.       01830099
017600     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01840099
017700                                                    COMP-3.       01850099
017800     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01860099
017900                                                    COMP-3.       01870099
018000     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01880099
018100                                                    COMP-3.       01890099
018200     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01900099
018300                                                    COMP-3.       01910099
018400     05  PV-LO-TRIP-NO-N PIC S9(9) COMP VALUE +0.                 01920099
018500     05  PV-HI-TRIP-NO-N PIC S9(9) COMP VALUE +0.                 01930099
018600     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01940099
018700                                                    COMP-3.       01950099
018800     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01960099
018900                                                    COMP SYNC.    01970099
019000     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01980099
019100                                                    COMP SYNC.    01990099
019200     05  PV-ITEM                        PIC S9(04)  VALUE +0      02000099
019300                                                    COMP SYNC.    02010099
019400     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      02020099
019500                                                    COMP SYNC.    02030099
019600     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      02040099
019700                                                    COMP SYNC.    02050099
019800     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      02060099
019900                                                    COMP SYNC.    02070099
020000     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      02080099
020100                                                    COMP SYNC.    02090099
020200     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      02100099
020300                                                    COMP SYNC.    02110099
020400     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02120099
020500                                                    COMP SYNC.    02130099
020600     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02140099
020700                                                    COMP SYNC.    02150099
020800     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      02160099
020900                                                    COMP SYNC.    02170099
021000     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      02180099
021100                                                    COMP SYNC.    02190099
021200     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      02200099
021300                                                    COMP SYNC.    02210099
021400     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      02220099
021500                                                    COMP SYNC.    02230099
021600     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      02240099
021700                                                    COMP SYNC.    02250099
021800     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      02260099
021900                                                    COMP SYNC.    02270099
022000     05  PV-CONTNR-NBR                  PIC  X(12)  VALUE SPACE.  02280099
022100     05  PV-CONTNR-SEQ-NBR              PIC S9(04)  COMP.         02290099
022200     05  PV-SHIPT-ID                    PIC S9(09)  COMP.         02300099
022300     05  PV-PO-NBR                      PIC S9(09)  COMP.         02310099
022400     05  PV-OPER-UNT-ID                 PIC S9(04)  COMP.         02320099
022500     05  PV-STATUS-CDE                  PIC X(02)   VALUE SPACES. 02330099
022600     05  PV-PO-TYP-CDE                  PIC X(02)   VALUE SPACES. 02340099
022700     05  PV-VEH-NBR                     PIC X(10)   VALUE SPACES. 02350099
022800     05  PV-FDR-POL-CDE                 PIC X(05)   VALUE SPACES. 02360099
022900     05  PV-MOM-POL-CDE                 PIC X(05)   VALUE SPACES. 02370099
023000     05  PV-MOM-TRIP-TYP-CDE            PIC X       VALUE SPACE.  02380099
023100     05  PV-FDR-TRIP-TYP-CDE            PIC X       VALUE SPACE.  02390099
023200     05  PV-MOM-DEST-POE-CDE            PIC X(04)   VALUE SPACES. 02400099
023300     05  PV-ACTL-POE-DELY-TMST          PIC X(26)   VALUE SPACES. 02410099
023400     05  PV-MOM-POE-DELY-TMST           PIC X(26)   VALUE SPACES. 02420099
023500     05  PV-ITEM-CART-CNT               PIC S9(04)  VALUE +0      02430099
023600                                                    COMP.         02440099
023700     05  PV-SHIP-CNT                    PIC S9(04)  VALUE +0      02450099
023800                                                    COMP.         02460099
023900     05  PV-DATE                        PIC X(5).                 02470099
024000     05  FILLER REDEFINES PV-DATE.                                02480099
024100         10  PV-DATE-MONTH              PIC XX.                   02490099
024200         10  PV-DATE-SLASH              PIC X.                    02500099
024300         10  PV-DATE-DAY                PIC XX.                   02510099
024400     05  PV-PO-CART-CNT                 PIC S9(05)  VALUE +0      02520099
024500                                                    COMP.         02530099
024600     05  PV-AD-DTE-IND                  PIC S9(04)  VALUE +0      02540099
024700                                                    COMP.         02550099
024800     05  PV-SHPMT-TYPE.                                           02560099
024900         10 PV-SHPMT-FROM-CDE           PIC  X(03).               02570099
025000         10 FILLER                      PIC  X(01)  VALUE '/'.    02580099
025100         10 PV-SHPMT-TO-CDE             PIC  X(03).               02590099
025200                                                                  02600099
025300     05  PV-DATE-BREAK.                                           02610099
025400         10 FILLER                      PIC  X(02).               02620099
025500         10 PV-DB-YY                    PIC  X(02).               02630099
025600         10 FILLER                      PIC  X(01).               02640099
025700         10 PV-DB-MM                    PIC  X(02).               02650099
025800         10 FILLER                      PIC  X(01).               02660099
025900         10 PV-DB-DD                    PIC  X(02).               02670099
026000                                                                  02680099
026100     05 PV-DATE-DISPLAY.                                          02690099
026200         10 PV-DD-MM                    PIC  X(02).               02700099
026300         10 FILLER                      PIC  X(01)  VALUE '/'.    02710099
026400         10 PV-DD-DD                    PIC  X(02).               02720099
026500         10 FILLER                      PIC  X(01)  VALUE '/'.    02730099
026600         10 PV-DD-YY                    PIC  X(02).               02740099
026700                                                                  02750099
026800 01  PV-NULLS.                                                    02760099
026900     05  PV-SHIP-CNT-NULL               PIC S9(04)   VALUE +0     02770099
027000                                                    COMP SYNC.    02780099
027100     05  PV-STATUS-DTE-NULL             PIC S9(04)   VALUE +0     02790099
027200                                                    COMP SYNC.    02800099
027300     05  PV-DEVAN-DTE-NULL              PIC S9(04)   VALUE +0     02810099
027400                                                    COMP SYNC.    02820099
027500*----------------------------------------------------------------*02830099
027600*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.    *02840099
027700*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE            *02850099
027800*   APPLICATION-SPECIFIC COMMAREA.                               *02860099
027900*----------------------------------------------------------------*02870099
028000 01  LQW-LIST-QUEUE-WORK-AREA.                                    02880099
028100     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02890099
028200     05  LQW-ITEM-ENTRIES               OCCURS 08   TIMES         02900099
028300                                        INDEXED BY  LQW-IDX.      02910099
028400         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02920099
028500         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               02930099
028600         10  LQW-SELECTED-SW            PIC  X(01).               02940099
028700             88  LQW-SELECT                         VALUE 'S'.    02950099
028800             88  LQW-DESELECT                       VALUE ' '.    02960099
028900         10  LQW-ACTION                 PIC  X(03).               02970099
029000         10  LQW-SCAC                   PIC  X(04).               02980099
029100         10  LQW-TRLR                   PIC  X(10).               02990099
029200         10  LQW-CART                   PIC  S9(7).               03000099
029300         10  LQW-CTDV                   PIC  X(05).               03010099
029400         10  LQW-TRAV                   PIC  X(05).               03020099
029500         10  LQW-TRPU                   PIC  X(05).               03030099
029600         10  LQW-SHIP                   PIC  X.                   03040099
029700         10  LQW-DC                     PIC  9(04).               03050099
029800         10  LQW-ETA                    PIC  X(05).               03060099
029900         10  LQW-ATA                    PIC  X(05).               03070099
030000         10  LQW-RC                     PIC S9(09) COMP.          03080099
030100         10  LQW-OU                     PIC S9(04) COMP.          03090099
030200         10  LQW-FI                     PIC S9(04) COMP.          03100099
030300         10  LQW-TRIP                   PIC S9(09) COMP.          03110099
030400                                                                  03120099
030500 EJECT                                                            03130099
030600*---------------------------------------------------------------* 03140099
030700*  RECORD LAYOUT FOR THE PO SELECTION TEMP STORAGE QUEUE.       * 03150099
030800*---------------------------------------------------------------* 03160099
030900                                                                  03170099
031000     COPY TRWS108.                                                03180099
031100                                                                  03190099
031200 EJECT                                                            03200099
031300*---------------------------------------------------------------* 03210099
031400*    MAP LAYOUT                                                 * 03220099
031500*---------------------------------------------------------------* 03230099
031600                                                                  03240099
031700     COPY TRKM168.                                                03250099
031800                                                                  03260099
031900 01  MR-OCCURS-LAYOUT                   REDEFINES  TR168AO.       03270099
032000**  CHG0094517  CHANGED FILLER LENGTH FROM 264 TO 265             03280099
032000     05  FILLER                         PIC X(265).               03290099
032100                                                                  03300099
032200     05  MR-SCROLL-AREA                 OCCURS 08 TIMES.          03310099
032300         10  MR-SELECTL                 PIC S9(04) COMP.          03320099
032400         10  MR-SELECTA                 PIC  X(01).               03330099
032500         10  MR-SELECTC                 PIC  X(01).               03340099
032600         10  MR-SELECTH                 PIC  X(01).               03350099
032700         10  MR-SELECTI                 PIC  X(01).               03360099
032800                                                                  03370099
032900         10  MR-ACTIONL                 PIC S9(04) COMP.          03380099
033000         10  MR-ACTIONA                 PIC  X(01).               03390099
033100         10  MR-ACTIONC                 PIC  X(01).               03400099
033200         10  MR-ACTIONH                 PIC  X(01).               03410099
033300         10  MR-ACTION                  PIC  X(03).               03420099
033400                                                                  03430099
033500         10  MR-SCACL                   PIC S9(04) COMP.          03440099
033600         10  MR-SCACA                   PIC  X(01).               03450099
033700         10  MR-SCACC                   PIC  X(01).               03460099
033800         10  MR-SCACH                   PIC  X(01).               03470099
033900         10  MR-SCAC                    PIC  X(04).               03480099
034000                                                                  03490099
034100         10  MR-TRLRL                   PIC S9(04) COMP.          03500099
034200         10  MR-TRLRA                   PIC  X(01).               03510099
034300         10  MR-TRLRC                   PIC  X(01).               03520099
034400         10  MR-TRLRH                   PIC  X(01).               03530099
034500         10  MR-TRLR                    PIC  X(10).               03540099
034600                                                                  03550099
034700         10  MR-CARTL                   PIC S9(04) COMP.          03560099
034800         10  MR-CARTA                   PIC  X(01).               03570099
034900         10  MR-CARTC                   PIC  X(01).               03580099
035000         10  MR-CARTH                   PIC  X(01).               03590099
035100         10  MR-CART                    PIC  ZZZZZZZ.             03600099
035200                                                                  03610099
035300         10  MR-CTDVL                   PIC S9(04) COMP.          03620099
035400         10  MR-CTDVA                   PIC  X(01).               03630099
035500         10  MR-CDVC                    PIC  X(01).               03640099
035600         10  MR-CDVH                    PIC  X(01).               03650099
035700         10  MR-CTDV                    PIC  X(05).               03660099
035800                                                                  03670099
035900         10  MR-TRAVL                   PIC S9(04) COMP.          03680099
036000         10  MR-TRAVA                   PIC  X(01).               03690099
036100         10  MR-TRAVC                   PIC  X(01).               03700099
036200         10  MR-TRAVH                   PIC  X(01).               03710099
036300         10  MR-TRAV                    PIC  X(05).               03720099
036400                                                                  03730099
036500         10  MR-TRPUL                   PIC S9(04) COMP.          03740099
036600         10  MR-TRPUA                   PIC  X(01).               03750099
036700         10  MR-TRPUC                   PIC  X(01).               03760099
036800         10  MR-TRPUH                   PIC  X(01).               03770099
036900         10  MR-TRPU                    PIC  X(05).               03780099
037000                                                                  03790099
037100                                                                  03800099
037200         10  MR-SHIPL                   PIC S9(04) COMP.          03810099
037300         10  MR-SHIPA                   PIC  X(01).               03820099
037400         10  MR-SHIPC                   PIC  X(01).               03830099
037500         10  MR-SHIPH                   PIC  X(01).               03840099
037600         10  MR-SHIP                    PIC  X(01).               03850099
037700                                                                  03860099
037800                                                                  03870099
037900         10  MR-RCL                     PIC S9(04) COMP.          03880099
038000         10  MR-RCA                     PIC  X(01).               03890099
038100         10  MR-RCC                     PIC  X(01).               03900099
038200         10  MR-RCH                     PIC  X(01).               03910099
038300         10  MR-RC                      PIC  ZZZZ.                03920099
038400                                                                  03930099
038500                                                                  03940099
038600         10  MR-DCL                     PIC S9(04) COMP.          03950099
038700         10  MR-DCA                     PIC  X(01).               03960099
038800         10  MR-DCC                     PIC  X(01).               03970099
038900         10  MR-DCH                     PIC  X(01).               03980099
039000         10  MR-DC                      PIC  ZZZZ.                03990099
039100                                                                  04000099
039200                                                                  04010099
039300         10  MR-ETAL                    PIC S9(04) COMP.          04020099
039400         10  MR-ETAA                    PIC  X(01).               04030099
039500         10  MR-ETAC                    PIC  X(01).               04040099
039600         10  MR-ETAH                    PIC  X(01).               04050099
039700         10  MR-ETA                     PIC  X(05).               04060099
039800                                                                  04070099
039900                                                                  04080099
040000         10  MR-ATAL                    PIC S9(04) COMP.          04090099
040100         10  MR-ATAA                    PIC  X(01).               04100099
040200         10  MR-ATAC                    PIC  X(01).               04110099
040300         10  MR-ATAH                    PIC  X(01).               04120099
040400         10  MR-ATA                     PIC  X(05).               04130099
040500                                                                  04140099
040600                                                                  04150099
040700 EJECT                                                            04160099
040800*---------------------------------------------------------------* 04170099
040900*    ATTRIBUTE SETTINGS COPYBOOK.                               * 04180099
041000*---------------------------------------------------------------* 04190099
041100                                                                  04200099
041200     COPY DPWS015.                                                04210099
041300                                                                  04220099
041400 EJECT                                                            04230099
041500*---------------------------------------------------------------* 04240099
041600*    FUNCTION KEYS COPYBOOK.                                    * 04250099
041700*---------------------------------------------------------------* 04260099
041800                                                                  04270099
041900     COPY DPWS016.                                                04280099
042000                                                                  04290099
042100 EJECT                                                            04300099
042200*---------------------------------------------------------------* 04310099
042300*    NUMERIC EDIT LAYOUT.                                       * 04320099
042400*---------------------------------------------------------------* 04330099
042500                                                                  04340099
042600     COPY DPWS010I.                                               04350099
042700                                                                  04360099
042800 EJECT                                                            04370099
042900*---------------------------------------------------------------* 04380099
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 04390099
043100*---------------------------------------------------------------* 04400099
043200                                                                  04410099
043300     COPY DPWS030.                                                04420099
CICS       COPY DPWS930.                                                04430099
043500 EJECT                                                            04440099
043600*---------------------------------------------------------------* 04450099
043700*    STANDARD COMMAREA.                                         * 04460099
043800*---------------------------------------------------------------* 04470099
043900                                                                  04480099
044000     COPY DPWS020.                                                04490099
044100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                04500099
044200                                                                  04510099
044300*---------------------------------------------------------------* 04520099
044400* INTER-APPLICATION COMMAREA.                                   * 04530099
044500*   TRWS105 - ARE THE INPUT LAYOUTS FOR THIS PROGRAM            * 04540099
044600*   TRWS109   FROM PO CRIT SPEC, SUMMARY OR SAILING LIST PGMS.  * 04550099
044700*---------------------------------------------------------------* 04560099
044800                                                                  04570099
044900         10  INTER-APPL-COMM-AREA       PIC X(200).               04580099
045000     COPY RCWS012.                                                04590099
045100     COPY TRWS105.                                                04600099
045200     COPY TRWS109.                                                04610099
045300                                                                  04620099
045400*---------------------------------------------------------------* 04630099
045500*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 04640099
045600*---------------------------------------------------------------* 04650099
045700         10  ASC-SPECIFIC-COMMAREA.                               04660099
045800             15  ASC-LIST-KEYS.                                   04670099
045900                 20  ASC-KEY-PO-NBR                  PIC S9(09)   04680099
046000                                                          COMP.   04690099
046100                 20  ASC-LO-TRIP-NO-N                PIC S9(09)   04700099
046200                                                          COMP.   04710099
046300                 20  ASC-HI-TRIP-NO-N                PIC S9(09)   04720099
046400                                                          COMP.   04730099
046500                 20  ASC-KEY-VSL-NAME                PIC  X(20).  04740099
046600                 20  ASC-KEY-VOY-NO                  PIC  X(10).  04750099
046700                 20  ASC-OUTR-PACK-X                 PIC  X(05).  04760099
046800                 20  ASC-OUTR-PACK                   PIC  9(5).   04770099
046900                 20  ASC-OUTR-PACK-N REDEFINES ASC-OUTR-PACK      04780099
047000                                                     PIC ZZZZZ.   04790099
047100             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                04800099
047200                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  04810099
047300                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   04820099
047400                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   04830099
047500                                                                  04840099
047600                 20  ASC-ITEM-ARRAY.                              04850099
047700                     25  ASC-ITEM-ENTRIES OCCURS 08 TIMES.        04860099
047800                         30  ASC-LIST-ITEM-NUMBER                 04870099
047900                                                     PIC S9(09)   04880099
048000                                                     COMP-3.      04890099
048100                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  04900099
048200                             88  ASC-VALID-SELECT    VALUE ' '    04910099
048300                                                           'S'    04920099
048400                                                           'B'    04930099
048500                                                           'E'.   04940099
048600                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   04950099
048700                             88  ASC-TEMP-SELECT     VALUE 'S'.   04960099
048800                             88  ASC-TEMP-BEGIN      VALUE 'B'.   04970099
048900                             88  ASC-TEMP-END        VALUE 'E'.   04980099
049000                         30  ASC-SELECTED-SW         PIC  X(01).  04990099
049100                             88  ASC-NO-SELECT       VALUE ' '.   05000099
049200                             88  ASC-SELECT          VALUE 'S'.   05010099
049300                             88  ASC-BEGIN           VALUE 'B'.   05020099
049400                             88  ASC-END             VALUE 'E'.   05030099
049500                         30  ASC-ACTION              PIC  X(03).  05040099
049600                         30  ASC-SCAC                PIC  X(04).  05050099
049700                         30  ASC-TRLR                PIC  X(10).  05060099
049800                         30  ASC-CART                PIC  S9(7).  05070099
049900                         30  ASC-CTDV                PIC  X(05).  05080099
050000                         30  ASC-TRAV                PIC  X(05).  05090099
050100                         30  ASC-TRPU                PIC  X(05).  05100099
050200                         30  ASC-SHIP                PIC  X.      05110099
050300                         30  ASC-DC                  PIC  9(04).  05120099
050400                         30  ASC-ETA                 PIC  X(05).  05130099
050500                         30  ASC-ATA                 PIC  X(05).  05140099
050600                         30  ASC-RC                  PIC S9(09)   05150099
050700                                                          COMP.   05160099
050800                         30  ASC-OU                  PIC S9(04)   05170099
050900                                                          COMP.   05180099
051000                         30  ASC-FI                  PIC S9(04)   05190099
051100                                                          COMP.   05200099
051200                         30  ASC-TRIP                PIC S9(09)   05210099
051300                                                          COMP.   05220099
051400                                                                  05230099
051500             15  ASC-BLK-SUB                         PIC S9(04)   05240099
051600                                                          COMP    05250099
051700                                                          SYNC.   05260099
051800             15  ASC-ITEM-SUB                        PIC S9(04)   05270099
051900                                                          COMP    05280099
052000                                                          SYNC.   05290099
052100             15  ASC-SEL-ITEM                        PIC S9(04)   05300099
052200                                                          COMP    05310099
052300                                                          SYNC.   05320099
052400             15  ASC-SEL-SUB                         PIC S9(04)   05330099
052500                                                          COMP    05340099
052600                                                          SYNC.   05350099
052700             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   05360099
052800                                                          COMP-3. 05370099
052900             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   05380099
053000                                                          COMP-3. 05390099
053100             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   05400099
053200                                                          COMP-3. 05410099
053300             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   05420099
053400                                                          COMP-3. 05430099
053500             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   05440099
053600                                                          COMP-3. 05450099
053700             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   05460099
053800                                                          COMP    05470099
053900                                                          SYNC.   05480099
054000             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   05490099
054100                                                          COMP-3. 05500099
054200             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   05510099
054300                                                          COMP-3. 05520099
054400             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  05530099
054500                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   05540099
054600                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   05550099
054700             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  05560099
054800                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   05570099
054900                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   05580099
055000             15  ASC-LIST-QUEUE-NAME.                             05590099
055100                 20  ASC-LIST-TERM-ID                PIC  X(04).  05600099
055200                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   05610099
055300                                                          COMP-3. 05620099
055400                 20  ASC-LIST-SEQ                    PIC  9(01).  05630099
055500             15  ASC-SEL-QUEUE-NAME.                              05640099
055600                 20  ASC-SEL-TERM-ID                 PIC  X(04).  05650099
055700                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   05660099
055800                                                          COMP-3. 05670099
055900                 20  ASC-SEL-SEQ                     PIC  9(01).  05680099
056000             15  ASC-USE-SEL-QUEUE-SW    PIC  X(01).              05690099
056100                 88  ASC-USE-SELECTION-QUEUE         VALUE 'Y'.   05700099
056200                 88  ASC-NO-USE-SELECTION-QUEUE      VALUE 'N'.   05710099
056300             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(09)   05720099
056400                                                          COMP-3. 05730099
056500             15  ASC-CURSOR-SW                       PIC  X(01).  05740099
056600                 88  ASC-CONTNR-CURSOR               VALUE 'C'.   05750099
056700             15  ASC-START-ITEM-REQUEST.                          05760099
056800                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  05770099
056900             15  ASC-TOT-CARTONS                     PIC  S9(05). 05780099
057000                                                                  05790099
057100 EJECT                                                            05800099
057200*---------------------------------------------------------------* 05810099
057300*    ABEND PROCESSING COPYBOOK.                                 * 05820099
057400*---------------------------------------------------------------* 05830099
057500                                                                  05840099
057600     COPY DPWS013.                                                05850099
057700                                                                  05860099
057800 EJECT                                                            05870099
057900*---------------------------------------------------------------* 05880099
058000*    DB2 AREA FOR TIMCNTK                                       * 05890099
058100*---------------------------------------------------------------* 05900099
058200     EXEC SQL                                                     05910099
058300          INCLUDE TIMCNTK                                         05920099
058400     END-EXEC.                                                    05930099
058500*---------------------------------------------------------------* 05940099
058600*    DB2 AREA FOR TSHIPMT                                       * 05950099
058700*---------------------------------------------------------------* 05960099
058800     EXEC SQL                                                     05970099
058900          INCLUDE TSHIPMT                                         05980099
059000     END-EXEC.                                                    05990099
059100*---------------------------------------------------------------* 06000099
059200*    DB2 AREA FOR TSHIPST                                       * 06010099
059300*---------------------------------------------------------------* 06020099
059400     EXEC SQL                                                     06030099
059500          INCLUDE TSHIPST                                         06040099
059600     END-EXEC.                                                    06050099
059700*---------------------------------------------------------------* 06060099
059800*    DB2 AREA FOR TSHPTPO                                       * 06070099
059900*---------------------------------------------------------------* 06080099
060000     EXEC SQL                                                     06090099
060100          INCLUDE TSHPTPO                                         06100099
060200     END-EXEC.                                                    06110099
060300*---------------------------------------------------------------* 06120099
060400*    DB2 AREA FOR TPKSLIP                                       * 06130099
060500*---------------------------------------------------------------* 06140099
060600     EXEC SQL                                                     06150099
060700          INCLUDE TPKSLIP                                         06160099
060800     END-EXEC.                                                    06170099
060900*---------------------------------------------------------------* 06180099
061000*    DB2 AREA FOR TVEHICL                                       * 06190099
061100*---------------------------------------------------------------* 06200099
061200     EXEC SQL                                                     06210099
061300          INCLUDE TVEHICL                                         06220099
061400     END-EXEC.                                                    06230099
061500*---------------------------------------------------------------* 06240099
061600*    DB2 AREA FOR TVHTRIP                                       * 06250099
061700*---------------------------------------------------------------* 06260099
061800     EXEC SQL                                                     06270099
061900          INCLUDE TVHTRIP                                         06280099
062000     END-EXEC.                                                    06290099
062100*---------------------------------------------------------------* 06300099
062200*    DB2 AREA FOR TIMCNPO                                       * 06310099
062300*---------------------------------------------------------------* 06320099
062400     EXEC SQL                                                     06330099
062500          INCLUDE TIMCNPO                                         06340099
062600     END-EXEC.                                                    06350099
062700*---------------------------------------------------------------* 06360099
062800*    DB2 AREA FOR TPURCHS                                       * 06370099
062900*---------------------------------------------------------------* 06380099
063000     EXEC SQL                                                     06390099
063100          INCLUDE TPURCHS                                         06400099
063200     END-EXEC.                                                    06410099
063300*---------------------------------------------------------------* 06420099
063400*    DB2 AREA FOR TPURITM                                       * 06430099
063500*---------------------------------------------------------------* 06440099
063600     EXEC SQL                                                     06450099
063700          INCLUDE TPURITM                                         06460099
063800     END-EXEC.                                                    06470099
063900*---------------------------------------------------------------* 06480099
064000*    DB2 AREA FOR TPLNSHP                                       * 06490099
064100*---------------------------------------------------------------* 06500099
064200     EXEC SQL                                                     06510099
064300          INCLUDE TPLNSHP                                         06520099
064400     END-EXEC.                                                    06530099
064500*---------------------------------------------------------------* 06540099
064600*    DB2 AREA FOR TENTNME                                       * 06550099
064700*---------------------------------------------------------------* 06560099
064800     EXEC SQL                                                     06570099
064900          INCLUDE TENTNME                                         06580099
065000     END-EXEC.                                                    06590099
065100*----------------------------------------------------------------*06600099
065200*    DB2 AREA FOR THE TSKXREF TABLE                              *06610099
065300*----------------------------------------------------------------*06620099
065400     EXEC SQL                                                     06630099
065500          INCLUDE TSKXREF                                         06640099
065600     END-EXEC.                                                    06650099
065700*----------------------------------------------------------------*06660099
065800*    DB2 AREA FOR THE TUPC TABLE                                 *06670099
065900*----------------------------------------------------------------*06680099
066000     EXEC SQL                                                     06690099
066100          INCLUDE TUPC                                            06700099
066200     END-EXEC.                                                    06710099
066300*---------------------------------------------------------------* 06720099
066400*    DB2 AREA FOR TIMFOB                                        * 06730099
066500*---------------------------------------------------------------* 06740099
066600     EXEC SQL                                                     06750099
066700          INCLUDE TIMFOB                                          06760099
066800     END-EXEC.                                                    06770099
066900*---------------------------------------------------------------* 06780099
067000*    DB2 AREA FOR TIMPOE                                        * 06790099
067100*---------------------------------------------------------------* 06800099
067200     EXEC SQL                                                     06810099
067300          INCLUDE TIMPOE                                          06820099
067400     END-EXEC.                                                    06830099
067410*---------------------------------------------------------------* 06840099
067420*    DB2 AREA FOR XLT_SKU                                       * 06850099
067430*---------------------------------------------------------------* 06860099
067440     EXEC SQL                                                     06870099
067450          INCLUDE XLT00003                                        06880099
067460     END-EXEC.                                                    06890099
067470*---------------------------------------------------------------* 06900099
067480*    DB2 AREA FOR XLT_VND_STYL                                  * 06910099
067490*---------------------------------------------------------------* 06920099
067491     EXEC SQL                                                     06930099
067492          INCLUDE XLT00004                                        06940099
067493     END-EXEC.                                                    06950099
067500*---------------------------------------------------------------* 06960099
067600*    DB2 AREA FOR COMMUNICATIONS                                * 06970099
067700*---------------------------------------------------------------* 06980099
067800     EXEC SQL                                                     06990099
067900          INCLUDE SQLCA                                           07000099
068000     END-EXEC.                                                    07010099
068100*---------------------------------------------------------------* 07020099
068200*  REFER TO THE TOP OF THE PROGRAM FOR DOCUMENTATION ON         * 07030099
068300*  THE FOLLOWING CURSOR                                         * 07040099
068400*---------------------------------------------------------------* 07050099
068500     EXEC SQL                                                     07060099
068600          DECLARE TRLR-CSR CURSOR                                 07070099
068700            FOR SELECT                                            07080099
068800                    F.OWNER_SCAC_ID                               07090099
068900                   ,F.VEH_NBR                                     07100099
069000                   ,F.CURR_OPER_UNT_ID                            07110099
069100                   ,F.CURR_FCLTY_ID                               07120099
069200                   ,B.TRIP_ID                                     07130099
069300                   ,0                                             07140099
069400                   ,0                                             07150099
069500                   ,MIN(DISTINCT G.STATUS_DTE)                    07160099
069600            FROM TSHPTPO A                                        07170099
069700                ,TSHIPMT B                                        07180099
069800                ,TVHTRIP E                                        07190099
069900                ,TVEHICL F                                        07200099
070000                ,TSHIPST G                                        07210099
070100            WHERE A.PO_NBR         = :DK-PO-NBR                   07220099
070200            AND   A.SHIPT_ID       = B.SHIPT_ID                   07230099
070300            AND   A.REC_SEQ_NBR    = 0                            07240099
070400            AND   B.TRIP_ID        = E.TRIP_ID                    07250099
070500            AND  (B.TRIP_ID       >= :PV-LO-TRIP-NO-N             07260099
070600            AND   B.TRIP_ID       <= :PV-HI-TRIP-NO-N)            07270099
070700            AND   E.VEH_NBR        = F.VEH_NBR                    07280099
070800            AND   E.OWNER_SCAC_ID  = F.OWNER_SCAC_ID              07290099
070900            AND   F.VEH_TYP_CDE    = 'TR'                         07300099
071000            AND   A.SHIPT_ID         = G.SHIPT_ID                 07310099
071100            AND   G.SHIPT_STATUS_CDE =  'AG'                      07320099
071200            GROUP BY                                              07330099
071300                F.OWNER_SCAC_ID                                   07340099
071400               ,F.VEH_NBR                                         07350099
071500               ,F.CURR_OPER_UNT_ID                                07360099
071600               ,F.CURR_FCLTY_ID                                   07370099
071700               ,B.TRIP_ID                                         07380099
071800            UNION                                                 07390099
071900            SELECT                                                07400099
072000                    K.OWNER_SCAC_ID                               07410099
072100                   ,K.VEH_NBR                                     07420099
072200                   ,K.CURR_OPER_UNT_ID                            07430099
072300                   ,K.CURR_FCLTY_ID                               07440099
072400                   ,I.TRIP_ID                                     07450099
072500                   ,0                                             07460099
072600                   ,0                                             07470099
072700                   ,MIN(DISTINCT DATE(J.EST_AR_TMST))             07480099
072800            FROM TSHPTPO H                                        07490099
072900                ,TSHIPMT I                                        07500099
073000                ,TVHTRIP J                                        07510099
073100                ,TVEHICL K                                        07520099
073200            WHERE H.PO_NBR         = :DK-PO-NBR                   07530099
073300            AND   H.SHIPT_ID       = I.SHIPT_ID                   07540099
073400            AND   H.REC_SEQ_NBR    = 0                            07550099
073500            AND   I.TRIP_ID        = J.TRIP_ID                    07560099
073600            AND  (I.TRIP_ID       >= :PV-LO-TRIP-NO-N             07570099
073700            AND   I.TRIP_ID       <= :PV-HI-TRIP-NO-N)            07580099
073800            AND   J.VEH_NBR        = K.VEH_NBR                    07590099
073900            AND   J.OWNER_SCAC_ID  = K.OWNER_SCAC_ID              07600099
074000            AND   K.VEH_TYP_CDE    = 'TR'                         07610099
074100            AND   NOT EXISTS                                      07620099
074200                 (SELECT *                                        07630099
074300                  FROM TSHIPST L                                  07640099
074400                  WHERE I.SHIPT_ID         = L.SHIPT_ID           07650099
074500                  AND   L.SHIPT_STATUS_CDE = 'AG')                07660099
074600            GROUP BY                                              07670099
074700                  K.OWNER_SCAC_ID                                 07680099
074800                 ,K.VEH_NBR                                       07690099
074900                 ,K.CURR_OPER_UNT_ID                              07700099
075000                 ,K.CURR_FCLTY_ID                                 07710099
075100                 ,I.TRIP_ID                                       07720099
075200            UNION                                                 07730099
075300            SELECT                                                07740099
075400                    Q.OWNER_SCAC_ID                               07750099
075500                   ,Q.VEH_NBR                                     07760099
075600                   ,O.OPER_UNT_ID                                 07770099
075700                   ,O.FCLTY_ID                                    07780099
075800                   ,N.TRIP_ID                                     07790099
075900                   ,O.REC_SEQ_NBR                                 07800099
076000                   ,SUM(DISTINCT O.EXPTED_PKG_QTY)                07810099
076100                   ,MIN(DISTINCT R.STATUS_DTE)                    07820099
076200            FROM TSHPTPO M                                        07830099
076300                ,TSHIPMT N                                        07840099
076400                ,TPKSLIP O                                        07850099
076500                ,TVHTRIP P                                        07860099
076600                ,TVEHICL Q                                        07870099
076700                ,TSHIPST R                                        07880099
076800            WHERE M.PO_NBR         = :DK-PO-NBR                   07890099
076900            AND   M.PO_NBR         = O.PO_NBR                     07900099
077000            AND   M.SHIPT_ID       = N.SHIPT_ID                   07910099
077100            AND   M.REC_SEQ_NBR    = O.REC_SEQ_NBR                07920099
077200            AND   M.REC_SEQ_NBR   <> 0                            07930099
077300            AND    (N.BOL_NBR          = O.BOL_NBR                07940099
077400            OR      N.PRO_NBR          = O.PRO_NBR)               07950099
077500            AND   O.VER_STAT_CDE   = 'A'                          07960099
077600            AND   N.TRIP_ID        = P.TRIP_ID                    07970099
077700            AND  (N.TRIP_ID       >= :PV-LO-TRIP-NO-N             07980099
077800            AND   N.TRIP_ID       <= :PV-HI-TRIP-NO-N)            07990099
077900            AND   P.VEH_NBR        = Q.VEH_NBR                    08000099
078000            AND   P.OWNER_SCAC_ID  = Q.OWNER_SCAC_ID              08010099
078100            AND   Q.VEH_TYP_CDE    = 'TR'                         08020099
078200            AND   M.SHIPT_ID         = R.SHIPT_ID                 08030099
078300            AND   R.SHIPT_STATUS_CDE =  'AG'                      08040099
078400            GROUP BY Q.OWNER_SCAC_ID                              08050099
078500                   ,Q.VEH_NBR                                     08060099
078600                   ,O.OPER_UNT_ID                                 08070099
078700                   ,O.FCLTY_ID                                    08080099
078800                   ,N.TRIP_ID                                     08090099
078900                   ,O.REC_SEQ_NBR                                 08100099
079000            UNION                                                 08110099
079100            SELECT                                                08120099
079200                    V.OWNER_SCAC_ID                               08130099
079300                   ,V.VEH_NBR                                     08140099
079400                   ,T.OPER_UNT_ID                                 08150099
079500                   ,T.FCLTY_ID                                    08160099
079600                   ,S.TRIP_ID                                     08170099
079700                   ,T.REC_SEQ_NBR                                 08180099
079800                   ,SUM(DISTINCT T.EXPTED_PKG_QTY)                08190099
079900                   ,MIN(DISTINCT DATE(U.EST_AR_TMST))             08200099
080000            FROM TSHPTPO X                                        08210099
080100                ,TSHIPMT S                                        08220099
080200                ,TPKSLIP T                                        08230099
080300                ,TVHTRIP U                                        08240099
080400                ,TVEHICL V                                        08250099
080500            WHERE X.PO_NBR         = :DK-PO-NBR                   08260099
080600            AND   X.PO_NBR         = T.PO_NBR                     08270099
080700            AND   X.SHIPT_ID       = S.SHIPT_ID                   08280099
080800            AND   X.REC_SEQ_NBR    = T.REC_SEQ_NBR                08290099
080900            AND   X.REC_SEQ_NBR   <> 0                            08300099
081000            AND    (S.BOL_NBR          = T.BOL_NBR                08310099
081100            OR      S.PRO_NBR          = T.PRO_NBR)               08320099
081200            AND   T.VER_STAT_CDE   = 'A'                          08330099
081300            AND   S.TRIP_ID        = U.TRIP_ID                    08340099
081400            AND  (S.TRIP_ID       >= :PV-LO-TRIP-NO-N             08350099
081500            AND   S.TRIP_ID       <= :PV-HI-TRIP-NO-N)            08360099
081600            AND   U.VEH_NBR        = V.VEH_NBR                    08370099
081700            AND   U.OWNER_SCAC_ID  = V.OWNER_SCAC_ID              08380099
081800            AND   V.VEH_TYP_CDE    = 'TR'                         08390099
081900            AND   NOT EXISTS                                      08400099
082000                 (SELECT *                                        08410099
082100                  FROM TSHIPST W                                  08420099
082200                  WHERE X.SHIPT_ID         = W.SHIPT_ID           08430099
082300                  AND   W.SHIPT_STATUS_CDE = 'AG')                08440099
082400            GROUP BY V.OWNER_SCAC_ID                              08450099
082500                   ,V.VEH_NBR                                     08460099
082600                   ,T.OPER_UNT_ID                                 08470099
082700                   ,T.FCLTY_ID                                    08480099
082800                   ,S.TRIP_ID                                     08490099
082900                   ,T.REC_SEQ_NBR                                 08500099
083000            UNION                                                 08510099
083100            SELECT                                                08520099
083200                    Q.OWNER_SCAC_ID                               08530099
083300                   ,Q.VEH_NBR                                     08540099
083400                   ,O.OPER_UNT_ID                                 08550099
083500                   ,O.FCLTY_ID                                    08560099
083600                   ,N.TRIP_ID                                     08570099
083700                   ,O.REC_SEQ_NBR                                 08580099
083800                   ,0                                             08590099
083900                   ,MIN(DISTINCT R.STATUS_DTE)                    08600099
084000            FROM TSHPTPO M                                        08610099
084100                ,TSHIPMT N                                        08620099
084200                ,TPKSLIP O                                        08630099
084300                ,TVHTRIP P                                        08640099
084400                ,TVEHICL Q                                        08650099
084500                ,TSHIPST R                                        08660099
084600            WHERE M.PO_NBR         = :DK-PO-NBR                   08670099
084700            AND   M.PO_NBR         = O.PO_NBR                     08680099
084800            AND   M.SHIPT_ID       = N.SHIPT_ID                   08690099
084900            AND   M.REC_SEQ_NBR    = O.REC_SEQ_NBR                08700099
085000            AND   M.REC_SEQ_NBR   <> 0                            08710099
085100            AND   N.BOL_NBR      <> O.BOL_NBR                     08720099
085200            AND   N.PRO_NBR      <> O.PRO_NBR                     08730099
085300            AND   O.VER_STAT_CDE   = 'A'                          08740099
085400            AND   N.TRIP_ID        = P.TRIP_ID                    08750099
085500            AND  (N.TRIP_ID       >= :PV-LO-TRIP-NO-N             08760099
085600            AND   N.TRIP_ID       <= :PV-HI-TRIP-NO-N)            08770099
085700            AND   P.VEH_NBR        = Q.VEH_NBR                    08780099
085800            AND   P.OWNER_SCAC_ID  = Q.OWNER_SCAC_ID              08790099
085900            AND   Q.VEH_TYP_CDE    = 'TR'                         08800099
086000            AND   M.SHIPT_ID         = R.SHIPT_ID                 08810099
086100            AND   R.SHIPT_STATUS_CDE =  'AG'                      08820099
086200            GROUP BY Q.OWNER_SCAC_ID                              08830099
086300                   ,Q.VEH_NBR                                     08840099
086400                   ,O.OPER_UNT_ID                                 08850099
086500                   ,O.FCLTY_ID                                    08860099
086600                   ,N.TRIP_ID                                     08870099
086700                   ,O.REC_SEQ_NBR                                 08880099
086800            UNION                                                 08890099
086900            SELECT                                                08900099
087000                    V.OWNER_SCAC_ID                               08910099
087100                   ,V.VEH_NBR                                     08920099
087200                   ,T.OPER_UNT_ID                                 08930099
087300                   ,T.FCLTY_ID                                    08940099
087400                   ,S.TRIP_ID                                     08950099
087500                   ,T.REC_SEQ_NBR                                 08960099
087600                   ,0                                             08970099
087700                   ,MIN(DISTINCT DATE(U.EST_AR_TMST))             08980099
087800            FROM TSHPTPO X                                        08990099
087900                ,TSHIPMT S                                        09000099
088000                ,TPKSLIP T                                        09010099
088100                ,TVHTRIP U                                        09020099
088200                ,TVEHICL V                                        09030099
088300            WHERE X.PO_NBR         = :DK-PO-NBR                   09040099
088400            AND   X.PO_NBR         = T.PO_NBR                     09050099
088500            AND   X.SHIPT_ID       = S.SHIPT_ID                   09060099
088600            AND   X.REC_SEQ_NBR    = T.REC_SEQ_NBR                09070099
088700            AND   X.REC_SEQ_NBR   <> 0                            09080099
088800            AND   S.BOL_NBR       <> T.BOL_NBR                    09090099
088900            AND   S.PRO_NBR       <> T.PRO_NBR                    09100099
089000            AND   T.VER_STAT_CDE   = 'A'                          09110099
089100            AND   S.TRIP_ID        = U.TRIP_ID                    09120099
089200            AND  (S.TRIP_ID       >= :PV-LO-TRIP-NO-N             09130099
089300            AND   S.TRIP_ID       <= :PV-HI-TRIP-NO-N)            09140099
089400            AND   U.VEH_NBR        = V.VEH_NBR                    09150099
089500            AND   U.OWNER_SCAC_ID  = V.OWNER_SCAC_ID              09160099
089600            AND   V.VEH_TYP_CDE    = 'TR'                         09170099
089700            AND   NOT EXISTS                                      09180099
089800                 (SELECT *                                        09190099
089900                  FROM TSHIPST W                                  09200099
090000                  WHERE X.SHIPT_ID         = W.SHIPT_ID           09210099
090100                  AND   W.SHIPT_STATUS_CDE = 'AG')                09220099
090200            GROUP BY V.OWNER_SCAC_ID                              09230099
090300                   ,V.VEH_NBR                                     09240099
090400                   ,T.OPER_UNT_ID                                 09250099
090500                   ,T.FCLTY_ID                                    09260099
090600                   ,S.TRIP_ID                                     09270099
090700                   ,T.REC_SEQ_NBR                                 09280099
090800            UNION                                                 09290099
090900            SELECT                                                09300099
091000                    Q.OWNER_SCAC_ID                               09310099
091100                   ,Q.VEH_NBR                                     09320099
091200                   ,Q.CURR_OPER_UNT_ID                            09330099
091300                   ,Q.CURR_FCLTY_ID                               09340099
091400                   ,N.TRIP_ID                                     09350099
091500                   ,M.REC_SEQ_NBR                                 09360099
091600                   ,0                                             09370099
091700                   ,MIN(DISTINCT R.STATUS_DTE)                    09380099
091800            FROM TSHPTPO M                                        09390099
091900                ,TSHIPMT N                                        09400099
092000                ,TVHTRIP P                                        09410099
092100                ,TVEHICL Q                                        09420099
092200                ,TSHIPST R                                        09430099
092300            WHERE M.PO_NBR         = :DK-PO-NBR                   09440099
092400            AND   M.SHIPT_ID       = N.SHIPT_ID                   09450099
092500            AND   NOT EXISTS                                      09460099
092600                 (SELECT *                                        09470099
092700                  FROM TPKSLIP A                                  09480099
092800                      ,TSHIPMT B                                  09490099
092900                      ,TSHPTPO C                                  09500099
093000                  WHERE M.PO_NBR      = A.PO_NBR                  09510099
093100                  AND   M.SHIPT_ID    = C.SHIPT_ID                09520099
093200                  AND   M.SHIPT_ID    = B.SHIPT_ID                09530099
093300                  AND   C.SHIPT_ID    = B.SHIPT_ID                09540099
093400                  AND  (N.BOL_NBR     = A.BOL_NBR                 09550099
093500                  OR    N.PRO_NBR     = A.PRO_NBR)                09560099
093600                  AND   A.VER_STAT_CDE= 'A'                       09570099
093700                  AND   A.REC_SEQ_NBR = C.REC_SEQ_NBR             09580099
093800                  AND   M.REC_SEQ_NBR = C.REC_SEQ_NBR)            09590099
093900            AND   M.REC_SEQ_NBR   <> 0                            09600099
094000            AND   N.TRIP_ID        = P.TRIP_ID                    09610099
094100            AND  (N.TRIP_ID       >= :PV-LO-TRIP-NO-N             09620099
094200            AND   N.TRIP_ID       <= :PV-HI-TRIP-NO-N)            09630099
094300            AND   P.VEH_NBR        = Q.VEH_NBR                    09640099
094400            AND   P.OWNER_SCAC_ID  = Q.OWNER_SCAC_ID              09650099
094500            AND   Q.VEH_TYP_CDE    = 'TR'                         09660099
094600            AND   M.SHIPT_ID         = R.SHIPT_ID                 09670099
094700            AND   R.SHIPT_STATUS_CDE =  'AG'                      09680099
094800            GROUP BY Q.OWNER_SCAC_ID                              09690099
094900                   ,Q.VEH_NBR                                     09700099
095000                   ,Q.CURR_OPER_UNT_ID                            09710099
095100                   ,Q.CURR_FCLTY_ID                               09720099
095200                   ,N.TRIP_ID                                     09730099
095300                   ,M.REC_SEQ_NBR                                 09740099
095400            UNION                                                 09750099
095500            SELECT                                                09760099
095600                    V.OWNER_SCAC_ID                               09770099
095700                   ,V.VEH_NBR                                     09780099
095800                   ,V.CURR_OPER_UNT_ID                            09790099
095900                   ,V.CURR_FCLTY_ID                               09800099
096000                   ,S.TRIP_ID                                     09810099
096100                   ,X.REC_SEQ_NBR                                 09820099
096200                   ,0                                             09830099
096300                   ,MIN(DISTINCT DATE(U.EST_AR_TMST))             09840099
096400            FROM TSHPTPO X                                        09850099
096500                ,TSHIPMT S                                        09860099
096600                ,TVHTRIP U                                        09870099
096700                ,TVEHICL V                                        09880099
096800            WHERE X.PO_NBR         = :DK-PO-NBR                   09890099
096900            AND   X.SHIPT_ID       = S.SHIPT_ID                   09900099
097000            AND   NOT EXISTS                                      09910099
097100                 (SELECT *                                        09920099
097200                  FROM TPKSLIP A                                  09930099
097300                      ,TSHIPMT B                                  09940099
097400                      ,TSHPTPO C                                  09950099
097500                  WHERE X.PO_NBR      = A.PO_NBR                  09960099
097600                  AND   X.SHIPT_ID    = C.SHIPT_ID                09970099
097700                  AND   X.SHIPT_ID    = B.SHIPT_ID                09980099
097800                  AND   B.SHIPT_ID    = C.SHIPT_ID                09990099
097900                  AND  (S.BOL_NBR     = A.BOL_NBR                 10000099
098000                  OR    S.PRO_NBR     = A.PRO_NBR)                10010099
098100                  AND   A.VER_STAT_CDE= 'A'                       10020099
098200                  AND   A.REC_SEQ_NBR = C.REC_SEQ_NBR             10030099
098300                  AND   X.REC_SEQ_NBR = C.REC_SEQ_NBR)            10040099
098400            AND   X.REC_SEQ_NBR   <> 0                            10050099
098500            AND   S.TRIP_ID        = U.TRIP_ID                    10060099
098600            AND  (S.TRIP_ID       >= :PV-LO-TRIP-NO-N             10070099
098700            AND   S.TRIP_ID       <= :PV-HI-TRIP-NO-N)            10080099
098800            AND   U.VEH_NBR        = V.VEH_NBR                    10090099
098900            AND   U.OWNER_SCAC_ID  = V.OWNER_SCAC_ID              10100099
099000            AND   V.VEH_TYP_CDE    = 'TR'                         10110099
099100            AND   NOT EXISTS                                      10120099
099200                 (SELECT *                                        10130099
099300                  FROM TSHIPST W                                  10140099
099400                  WHERE X.SHIPT_ID         = W.SHIPT_ID           10150099
099500                  AND   W.SHIPT_STATUS_CDE = 'AG')                10160099
099600            GROUP BY V.OWNER_SCAC_ID                              10170099
099700                   ,V.VEH_NBR                                     10180099
099800                   ,V.CURR_OPER_UNT_ID                            10190099
099900                   ,V.CURR_FCLTY_ID                               10200099
100000                   ,S.TRIP_ID                                     10210099
100100                   ,X.REC_SEQ_NBR                                 10220099
100200            ORDER BY 8 DESC                                       10230099
100300     END-EXEC.                                                    10240099
100400*----------------------------------------------------------------*10250099
100500*    CURSOR DECLARATION FOR SELECTING OUTER PACK QUANTITY        *10260099
100600*----------------------------------------------------------------*10270099
100700                                                                  10280099
100800     EXEC SQL                                                     10290099
100900          DECLARE  OUTR-PCK-CSR CURSOR                            10300099
101000             FOR   SELECT                                         10310099
101100                   A.UNT_QTY                                      10320099
101200                ,  A.OUTR_PK_QTY                                  10330099
101300             FROM  TPURITM  A                                     10340099
101600             WHERE A.PO_NBR         = :DK-PO-NBR                  10350099
102000             AND   A.VER_STATUS_CDE = 'A'                         10360099
102100             FOR   FETCH ONLY                                     10370099
102200     END-EXEC.                                                    10380099
102300                                                                  10390099
102400 EJECT                                                            10400099
102500*----------------------------------------------------------------*10410099
102600 LINKAGE SECTION.                                                 10420099
102700                                                                  10430099
102800 01  DFHCOMMAREA.                                                 10440099
102900     05  FILLER                         OCCURS  1 TO 4072 TIMES   10450099
103000                                        DEPENDING ON EIBCALEN.    10460099
103100         10  FILLER                     PIC X.                    10470099
103200                                                                  10480099
103300 EJECT                                                            10490099
103400*----------------------------------------------------------------*10500099
103500 PROCEDURE DIVISION.                                              10510099
103600*----------------------------------------------------------------*10520099
103700*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM.  *10530099
103800*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM   *10540099
103900*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT.  *10550099
104000*----------------------------------------------------------------*10560099
104100 0000-MAIN-MODULE.                                                10570099
104200                                                                  10580099
104300     INITIALIZE DP030-CICS-API-FIELDS.                            10590099
104400     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       10600099
104500     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          10610099
104600     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         10620099
104700     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       10630099
104800     MOVE LENGTH OF TR168AI        TO DP030-MAP-LENGTH (1).       10640099
104900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     10650099
105000     PERFORM 0001-CALL-CICS-ARCH-API.                             10660099
105100*                                                                 10670099
105200     PERFORM 1000-CONTROL-PROCESSING.                             10680099
105300*                                                                 10690099
105400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     10700099
105500     PERFORM 0001-CALL-CICS-ARCH-API.                             10710099
105600                                                                  10720099
105700*----------------------------------------------------------------*10730099
105800*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *10740099
105900*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *10750099
106000*----------------------------------------------------------------*10760099
106100 0001-CALL-CICS-ARCH-API.                                         10770099
106200                                                                  10780099
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      10790099
106400                                    DFHCOMMAREA                   10800099
106500                                    DP030-CICS-API-FIELDS         10810099
106600                                    DP020-STANDARD-COMMAREA       10820099
106700                                    TR168AI.                      10830099
106800*                                                                 10840099
106900     IF  DP030-RC-CALL-SUCCESSFUL                                 10850099
107000         CONTINUE                                                 10860099
107100     ELSE                                                         10870099
107200         SET DP013-NO-ROLLBACK                                    10880099
107300             DP013-XCTL-DISPLAY-RESTART                           10890099
107400             DP013-CICS-ABEND      TO TRUE                        10900099
107500         MOVE '0001-CALL-CICS-ARCH-API'                           10910099
107600                                   TO DP013-PARAGRAPH             10920099
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O10930099
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      10940099
107900         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      10950099
108000         PERFORM DP013-0000-PROCESS-ABEND                         10960099
108100     END-IF.                                                      10970099
108200                                                                  10980099
108300 EJECT                                                            10990099
108400*----------------------------------------------------------------*11000099
108500* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *11010099
108600* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *11020099
108700*                                                                *11030099
108800* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *11040099
108900*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *11050099
109000*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *11060099
109100*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *11070099
109200*----------------------------------------------------------------*11080099
109300 1000-CONTROL-PROCESSING.                                         11090099
109400                                                                  11100099
109500     EVALUATE TRUE                                                11110099
109600         WHEN DP020-NEXT-ACT-INITIAL                              11120099
109700             INITIALIZE ASC-SPECIFIC-COMMAREA                     11130099
109800             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            11140099
109900                                      ASC-SEL-TERM-ID             11150099
110000             MOVE DP020-SRC-TASK-NUMBER                           11160099
110100                                   TO ASC-LIST-TASK-NUMBER        11170099
110200                                      ASC-SEL-TASK-NUMBER         11180099
110300             MOVE PC-LIST-QUEUE-SEQ                               11190099
110400                                   TO ASC-LIST-SEQ                11200099
110500             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 11210099
110600             PERFORM 1100-PROCESS-INTER-APPL-COMM                 11220099
110700*-------$TEMPLATE NOTE$------------------------------------------*11230099
110800* IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION, *11240099
110900* SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO   *11250099
111000* TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED. *11260099
111100*----------------------------------------------------------------*11270099
111200             IF  PS-COMMAREA-NOT-VALID                            11280099
111300                 SET DP020-NEXT-ACT-APPL-ERROR                    11290099
111400                                   TO TRUE                        11300099
111500             ELSE                                                 11310099
111600                 PERFORM 4000-BUILD-INITIAL-PANEL                 11320099
111700             END-IF                                               11330099
111800                                                                  11340099
111900         WHEN DP020-NEXT-ACT-READ-MAP                             11350099
112000             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        11360099
112100                                   TO PV-TOP-ITEM                 11370099
112200             PERFORM 2000-PROCESS-PANEL                           11380099
112300                                                                  11390099
112400         WHEN DP020-NEXT-ACT-RETURN                               11400099
112500             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        11410099
112600                                   TO PV-TOP-ITEM                 11420099
112700             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    11430099
112800             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 11440099
112900             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   11450099
113000             MOVE ASC-HI-TRIP-NO-N TO PV-HI-TRIP-NO-N             11460099
113100             MOVE ASC-LO-TRIP-NO-N TO PV-LO-TRIP-NO-N             11470099
113200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11480099
113300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   11490099
113400                                                                  11500099
113500         WHEN OTHER                                               11510099
113600             SET DP013-LOGIC-ABEND TO TRUE                        11520099
113700             SET DP013-NO-ROLLBACK TO TRUE                        11530099
113800             MOVE '1000-CONTROL-PROCESSING'                       11540099
113900                                   TO DP013-PARAGRAPH             11550099
114000             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    11560099
114100                                   TO DP013-MESSAGE-TEXT(1)       11570099
114200             PERFORM DP013-0000-PROCESS-ABEND                     11580099
114300     END-EVALUATE.                                                11590099
114400                                                                  11600099
114500 EJECT                                                            11610099
114600*----------------------------------------------------------------*11620099
114700* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *11630099
114800* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *11640099
114900*----------------------------------------------------------------*11650099
115000 1100-PROCESS-INTER-APPL-COMM.                                    11660099
115100                                                                  11670099
115200     SET PS-COMMAREA-VALID         TO TRUE.                       11680099
115300     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     11690099
115400     IF DP020-INT-APPL-FORMAT-IND NOT = PC-LIST-FORMAT            11700099
115500        IF  DP020-NAV-KEY-DATA > SPACE                            11710099
115600            MOVE DP020-NAV-KEY-DATA                               11720099
115700                                   TO ASC-KEY-PO-NBR              11730099
115800                                      DK-PO-NBR                   11740099
115900        ELSE                                                      11750099
116000            MOVE TR105-PO-NBR     TO ASC-KEY-PO-NBR               11760099
116100                                      DK-PO-NBR                   11770099
116200        END-IF                                                    11780099
116300        MOVE +999999999 TO PV-HI-TRIP-NO-N                        11790099
116400                           ASC-HI-TRIP-NO-N                       11800099
116500        MOVE +000000000 TO PV-LO-TRIP-NO-N                        11810099
116600                           ASC-LO-TRIP-NO-N                       11820099
116700     ELSE                                                         11830099
116800        MOVE TR109-PO-NBR          TO ASC-KEY-PO-NBR              11840099
116900                                      DK-PO-NBR                   11850099
117000        SET ASC-USE-SELECTION-QUEUE TO TRUE                       11860099
117100        MOVE TR109-NUMBER-OF-TS-ITEMS TO ASC-NUMBER-OF-TS-ITEMS   11870099
117200        MOVE +1                       TO ASC-SEL-ITEM             11880099
117300        MOVE +0                       TO ASC-SEL-SUB              11890099
117400        PERFORM 1130-GET-NEXT-RECORD                              11900099
117500     END-IF.                                                      11910099
117600                                                                  11920099
117700 EJECT                                                            11930099
117800*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*11940099
117900*    GET THE NEXT RECORD IF A LIST OF RECORDS ARE BEING PROCESSED*11950099
118000*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*11960099
118100 1130-GET-NEXT-RECORD.                                            11970099
118200                                                                  11980099
118300     ADD +1                       TO ASC-SEL-SUB.                 11990099
118400                                                                  12000099
118500     IF  ASC-SEL-SUB > TR108-MAX-ITEMS                            12010099
118600         ADD +1                   TO ASC-SEL-ITEM                 12020099
118700         MOVE +1                  TO ASC-SEL-SUB                  12030099
118800     END-IF.                                                      12040099
118900                                                                  12050099
119000     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                12060099
119100         PERFORM 9100-READ-SEL-QUEUE                              12070099
119200         IF  TR108-ITEM (ASC-SEL-SUB) > ZERO                      12080099
119300             MOVE TR108-PO-NBR (ASC-SEL-SUB)                      12090099
119400                                  TO ASC-KEY-PO-NBR               12100099
119500                                     DK-PO-NBR                    12110099
119600             MOVE TR108-TRIP-ID (ASC-SEL-SUB)                     12120099
119700                                  TO PV-HI-TRIP-NO-N              12130099
119800                                     PV-LO-TRIP-NO-N              12140099
119900                                     ASC-HI-TRIP-NO-N             12150099
120000                                     ASC-LO-TRIP-NO-N             12160099
120100             SET TR108-INQ (ASC-SEL-SUB)                          12170099
120200                                  TO TRUE                         12180099
120300             PERFORM 9200-REWRITE-SEL-QUEUE                       12190099
120400         ELSE                                                     12200099
120500             SUBTRACT +1 FROM ASC-SEL-SUB                         12210099
120600             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             12220099
120700             SET DP020-MSG-INFORMATIONAL                          12230099
120800                 PS-LIST-END             TO TRUE                  12240099
120900         END-IF                                                   12250099
121000     ELSE                                                         12260099
121100         SUBTRACT +1 FROM ASC-SEL-ITEM                            12270099
121200         MOVE TR108-MAX-ITEMS     TO ASC-SEL-SUB                  12280099
121300         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             12290099
121400         SET DP020-MSG-INFORMATIONAL                              12300099
121500             PS-LIST-END             TO TRUE                      12310099
121600     END-IF.                                                      12320099
121700                                                                  12330099
121800/                                                                 12340099
121900*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*12350099
122000*    GET THE PREVIOUS RECORD IF A LIST OF RECORDS ARE BEING      *12360099
122100*    PROCESSED.                                                  *12370099
122200*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*12380099
122300                                                                  12390099
122400 1140-GET-PREV-RECORD.                                            12400099
122500                                                                  12410099
122600     SUBTRACT +1 FROM ASC-SEL-SUB.                                12420099
122700                                                                  12430099
122800     IF  ASC-SEL-SUB < +1                                         12440099
122900         SUBTRACT +1 FROM ASC-SEL-ITEM                            12450099
123000         MOVE TR108-MAX-ITEMS     TO ASC-SEL-SUB                  12460099
123100     END-IF.                                                      12470099
123200                                                                  12480099
123300     IF  ASC-SEL-ITEM > ZERO                                      12490099
123400         PERFORM 9100-READ-SEL-QUEUE                              12500099
123500         MOVE TR108-PO-NBR (ASC-SEL-SUB)                          12510099
123600                           TO ASC-KEY-PO-NBR                      12520099
123700                              DK-PO-NBR                           12530099
123800         MOVE TR108-TRIP-ID (ASC-SEL-SUB)                         12540099
123900                           TO PV-HI-TRIP-NO-N                     12550099
124000                              PV-LO-TRIP-NO-N                     12560099
124100                              ASC-HI-TRIP-NO-N                    12570099
124200                              ASC-LO-TRIP-NO-N                    12580099
124300         SET TR108-INQ (ASC-SEL-SUB)                              12590099
124400                                  TO TRUE                         12600099
124500         SET TR108-INQ (ASC-SEL-SUB)                              12610099
124600                                  TO TRUE                         12620099
124700         PERFORM 9200-REWRITE-SEL-QUEUE                           12630099
124800     ELSE                                                         12640099
124900         MOVE +1                  TO ASC-SEL-ITEM                 12650099
125000                                     ASC-SEL-SUB                  12660099
125100         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             12670099
125200         SET DP020-MSG-INFORMATIONAL                              12680099
125300             PS-LIST-END             TO TRUE                      12690099
125400     END-IF.                                                      12700099
125500                                                                  12710099
125600                                                                  12720099
125700                                                                  12730099
125800*----------------------------------------------------------------*12740099
125900* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITING OF THE DATA    *12750099
126000* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *12760099
126100* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *12770099
126200* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *12780099
126300* FUNCTION KEYS CAN GET THIS FAR.                                *12790099
126400*----------------------------------------------------------------*12800099
126500 2000-PROCESS-PANEL.                                              12810099
126600                                                                  12820099
126700     EVALUATE TRUE                                                12830099
126800         WHEN DP020-SRC-AID = DP016-CLEAR                         12840099
126900             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    12850099
127000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   12860099
127100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12870099
127200                                                                  12880099
127300*        WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             12890099
127400*            IF  ASC-USE-SELECTION-QUEUE                          12900099
127500*                PERFORM 1130-GET-NEXT-RECORD                     12910099
127600*                IF PS-LIST-END                                   12920099
127700*                    PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         12930099
127800*                    SET PS-NO-LIST-END TO TRUE                   12940099
127900*                ELSE                                             12950099
128000*                    PERFORM 2050-DELETE-LIST-QUEUE               12960099
128100*                    PERFORM 4000-BUILD-INITIAL-PANEL             12970099
128200*                    PERFORM 3200-RESET-ATTRIBUTES                12980099
128300*                END-IF                                           12990099
128400*             ELSE                                                13000099
128500*                --- BOTTOM OF LIST ---                           13010099
128600*                MOVE PC-TSYMSG-00070                             13020099
128700*                                  TO DP020-MSG-NUMBER            13030099
128800*                SET DP020-MSG-INFORMATIONAL                      13040099
128900*                                  TO TRUE                        13050099
129000*            END-IF                                               13060099
129100*                                                                 13070099
129200*        WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             13080099
129300*            IF  ASC-USE-SELECTION-QUEUE                          13090099
129400*                PERFORM 1140-GET-PREV-RECORD                     13100099
129500*                IF PS-LIST-END                                   13110099
129600*                    PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         13120099
129700*                    SET PS-NO-LIST-END                           13130099
129800*                                  TO TRUE                        13140099
129900*                ELSE                                             13150099
130000*                    PERFORM 2050-DELETE-LIST-QUEUE               13160099
130100*                    PERFORM 4000-BUILD-INITIAL-PANEL             13170099
130200*                    PERFORM 3200-RESET-ATTRIBUTES                13180099
130300*                END-IF                                           13190099
130400*            ELSE                                                 13200099
130500*                MOVE PC-TSYMSG-00069                             13210099
130600*                                  TO DP020-MSG-NUMBER            13220099
130700*                SET DP020-MSG-INFORMATIONAL                      13230099
130800*                                  TO TRUE                        13240099
130900*            END-IF                                               13250099
131000                                                                  13260099
131100         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    13270099
131200             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   13280099
131300             MOVE ASC-HI-TRIP-NO-N TO PV-HI-TRIP-NO-N             13290099
131400             MOVE ASC-LO-TRIP-NO-N TO PV-LO-TRIP-NO-N             13300099
131500             PERFORM 2050-DELETE-LIST-QUEUE                       13310099
131600             PERFORM 4000-BUILD-INITIAL-PANEL                     13320099
131700                                                                  13330099
131800         WHEN OTHER                                               13340099
131900             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 13350099
132000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   13360099
132100             IF  PS-NO-ERROR                                      13370099
132200                 SET DP030-CONTINUE-GO                            13380099
132300                                 TO TRUE                          13390099
132400                 PERFORM 2100-CHECK-FUNCTION-KEY                  13400099
132500             ELSE                                                 13410099
132600                 SET DP030-OVERRIDE-GO                            13420099
132700                                 TO TRUE                          13430099
132800             END-IF                                               13440099
132900     END-EVALUATE.                                                13450099
133000                                                                  13460099
133100 EJECT                                                            13470099
133200*----------------------------------------------------------------*13480099
133300*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *13490099
133400*----------------------------------------------------------------*13500099
133500 2050-DELETE-LIST-QUEUE.                                          13510099
133600                                                                  13520099
133700     EXEC CICS                                                    13530099
133800         DELETEQ TS                                               13540099
133900             QUEUE (ASC-LIST-QUEUE-NAME)                          13550099
134000             RESP  (PV-CICS-RESP)                                 13560099
134100     END-EXEC.                                                    13570099
134200                                                                  13580099
134300     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       13590099
134400        (PV-CICS-RESP = DFHRESP(QIDERR))                          13600099
134500         CONTINUE                                                 13610099
134600     ELSE                                                         13620099
134700         SET DP013-CICS-ABEND      TO TRUE                        13630099
134800         SET DP013-NO-ROLLBACK     TO TRUE                        13640099
134900                                                                  13650099
135000         MOVE '2050-DELETE-LIST-QUEUE'                            13660099
135100                                   TO DP013-PARAGRAPH             13670099
135200         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    13680099
135300                                   TO DP013-MESSAGE-TEXT (1)      13690099
135400         PERFORM DP013-0000-PROCESS-ABEND                         13700099
135500     END-IF.                                                      13710099
135600                                                                  13720099
135700     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  13730099
135800                                                                  13740099
135900 EJECT                                                            13750099
136000*----------------------------------------------------------------*13760099
136100* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*13770099
136200* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *13780099
136300* CICS ARCHITECTURE API.                                         *13790099
136400*----------------------------------------------------------------*13800099
136500 2100-CHECK-FUNCTION-KEY.                                         13810099
136600                                                                  13820099
136700     EVALUATE TRUE                                                13830099
136800                                                                  13840099
136900         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              13850099
137000            IF ASC-NUMBER-OF-SELECTED-ITEMS = 1                   13860099
137100              INITIALIZE         RC012-INTER-APPL-COMMAREA        13870099
137200              MOVE ASC-KEY-PO-NBR TO RC012-PO-NBR                 13880099
137300              PERFORM 5000-PREPARE-SEL-QUEUE                      13890099
137400            ELSE                                                  13900099
137500              IF ASC-NUMBER-OF-SELECTED-ITEMS > 1                 13910099
137600                SET DP030-OVERRIDE-GO TO TRUE                     13920099
137700                MOVE PC-TSYMSG-00047  TO DP020-MSG-NUMBER         13930099
137800                SET DP020-MSG-WARNING TO TRUE                     13940099
137900              ELSE                                                13950099
138000                IF ASC-NUMBER-OF-SELECTED-ITEMS = 0               13960099
138100                  SET DP030-OVERRIDE-GO TO TRUE                   13970099
138200                  MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER       13980099
138300                  SET DP020-MSG-WARNING TO TRUE                   13990099
138400                END-IF                                            14000099
138500              END-IF                                              14010099
138600            END-IF                                                14020099
138700                                                                  14030099
138800         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              14040099
138900            IF ASC-NUMBER-OF-SELECTED-ITEMS = 1                   14050099
139000              INITIALIZE         TR109-INTER-APPL-COMMAREA        14060099
139100              MOVE ASC-KEY-PO-NBR TO   TR109-PO-NBR               14070099
139200              PERFORM 5000-PREPARE-SEL-QUEUE                      14080099
139300            ELSE                                                  14090099
139400              IF ASC-NUMBER-OF-SELECTED-ITEMS > 1                 14100099
139500                SET DP030-OVERRIDE-GO TO TRUE                     14110099
139600                MOVE PC-TSYMSG-00047  TO DP020-MSG-NUMBER         14120099
139700                SET DP020-MSG-WARNING TO TRUE                     14130099
139800              ELSE                                                14140099
139900                IF ASC-NUMBER-OF-SELECTED-ITEMS = 0               14150099
140000                  SET DP030-OVERRIDE-GO TO TRUE                   14160099
140100                  MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER       14170099
140200                  SET DP020-MSG-WARNING TO TRUE                   14180099
140300                END-IF                                            14190099
140400              END-IF                                              14200099
140500            END-IF                                                14210099
140600                                                                  14220099
140700         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  14230099
140800             MOVE +1               TO PV-TOP-ITEM                 14240099
140900             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   14250099
141000             MOVE ASC-HI-TRIP-NO-N TO PV-HI-TRIP-NO-N             14260099
141100             MOVE ASC-LO-TRIP-NO-N TO PV-LO-TRIP-NO-N             14270099
141200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 14280099
141300             PERFORM 3200-RESET-ATTRIBUTES                        14290099
141400                                                                  14300099
141500         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   14310099
141600             PERFORM 2110-BROWSE-BACKWARD                         14320099
141700             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   14330099
141800             MOVE ASC-HI-TRIP-NO-N TO PV-HI-TRIP-NO-N             14340099
141900             MOVE ASC-LO-TRIP-NO-N TO PV-LO-TRIP-NO-N             14350099
142000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 14360099
142100             PERFORM 3200-RESET-ATTRIBUTES                        14370099
142200                                                                  14380099
142300         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   14390099
142400             PERFORM 2120-BROWSE-FORWARD                          14400099
142500             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   14410099
142600             MOVE ASC-HI-TRIP-NO-N TO PV-HI-TRIP-NO-N             14420099
142700             MOVE ASC-LO-TRIP-NO-N TO PV-LO-TRIP-NO-N             14430099
142800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 14440099
142900                                                                  14450099
143000         WHEN DP020-SRC-AID = DP016-ENTER                         14460099
143100             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   14470099
143200             IF  PS-ERROR                                         14480099
143300                 CONTINUE                                         14490099
143400             ELSE                                                 14500099
143500                 MOVE ASC-KEY-PO-NBR                              14510099
143600                                   TO DK-PO-NBR                   14520099
143700                 MOVE ASC-HI-TRIP-NO-N TO PV-HI-TRIP-NO-N         14530099
143800                 MOVE ASC-LO-TRIP-NO-N TO PV-LO-TRIP-NO-N         14540099
143900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             14550099
144000                 PERFORM 3200-RESET-ATTRIBUTES                    14560099
144100             END-IF                                               14570099
144200                                                                  14580099
144300         WHEN OTHER                                               14590099
144400             SET DP013-NO-ROLLBACK                                14600099
144500                 DP013-XCTL-DISPLAY-RESTART                       14610099
144600                 DP013-CICS-ABEND  TO TRUE                        14620099
144700             MOVE '2100-CHECK-FUNCTION-KEY'                       14630099
144800                                   TO DP013-PARAGRAPH             14640099
144900             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      14650099
145000                                   TO DP013-MESSAGE-TEXT (1)      14660099
145100             PERFORM DP013-0000-PROCESS-ABEND                     14670099
145200     END-EVALUATE.                                                14680099
145300                                                                  14690099
145400 EJECT                                                            14700099
145500*----------------------------------------------------------------*14710099
145600*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *14720099
145700*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *14730099
145800*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *14740099
145900*    MESSAGE.                                                    *14750099
146000*----------------------------------------------------------------*14760099
146100 2110-BROWSE-BACKWARD.                                            14770099
146200                                                                  14780099
146300     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    14790099
146400         GIVING PV-TOP-ITEM.                                      14800099
146500*                                                                 14810099
146600     IF  ((PV-TOP-ITEM < +1)                                      14820099
146700       OR (PV-TOP-ITEM = +1))                                     14830099
146800         MOVE +1                   TO PV-TOP-ITEM                 14840099
146900*------- TOP OF LIST -----                                        14850099
147000         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            14860099
147100         SET DP020-MSG-INFORMATIONAL TO TRUE                      14870099
147200     END-IF.                                                      14880099
147300                                                                  14890099
147400 EJECT                                                            14900099
147500*----------------------------------------------------------------*14910099
147600*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *14920099
147700*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *14930099
147800*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *14940099
147900*----------------------------------------------------------------*14950099
148000 2120-BROWSE-FORWARD.                                             14960099
148100                                                                  14970099
148200     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              14980099
148300         GIVING PV-TOP-ITEM.                                      14990099
148400     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   15000099
148500         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            15010099
148600                                   TO PV-TOP-ITEM                 15020099
148700*------- BOTTOM OF LIST -----------                               15030099
148800         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            15040099
148900         SET DP020-MSG-INFORMATIONAL                              15050099
149000                                   TO TRUE                        15060099
149100     ELSE                                                         15070099
149200         COMPUTE PV-BOTTOM-ITEM =                                 15080099
149300             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 15090099
149400         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            15100099
149500*----------- BOTTOM OF LIST ---------                             15110099
149600             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            15120099
149700             SET DP020-MSG-INFORMATIONAL                          15130099
149800                                   TO TRUE                        15140099
149900         END-IF                                                   15150099
150000     END-IF.                                                      15160099
150100                                                                  15170099
150200 EJECT                                                            15180099
150300*----------------------------------------------------------------*15190099
150400*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *15200099
150500*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *15210099
150600*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *15220099
150700*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *15230099
150800*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *15240099
150900*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *15250099
151000*----------------------------------------------------------------*15260099
151100 2130-CHECK-FOR-JUMP-BROWSE.                                      15270099
151200                                                                  15280099
151300     SET PS-NO-ERROR               TO TRUE.                       15290099
151400     IF  (ASC-START-ITEM-REQUEST = SPACE)                         15300099
151500         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            15310099
151600                                   TO PV-TOP-ITEM                 15320099
151700     ELSE                                                         15330099
151800         MOVE ASC-START-ITEM-REQUEST                              15340099
151900                                   TO DP010I-UNEDITED-FIELD       15350099
152000         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       15360099
152100         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     15370099
152200         SET DP010I-NEGATIVE-NOT-ALLOWED                          15380099
152300                                   TO TRUE                        15390099
263697         CALL DP010I-NUMERIC-EDIT-ROUTINE                         15401099
263697              USING DP010I-NUMERIC-EDIT-AREA                      15402099
152500                                                                  15410099
152600         IF  NOT DP010I-ERROR-DETECTED                            15420099
152700             MOVE DP010I-NUMERIC-FIELD                            15430099
152800                                   TO  ASC-START-ITEM-REQUEST-N   15440099
152900             IF  ASC-START-ITEM-REQUEST-N > ZERO                  15450099
153000                 IF  ASC-START-ITEM-REQUEST-N >                   15460099
153100                                          ASC-NUMBER-OF-ITEMS-READ15470099
153200                     MOVE SPACE TO ASC-START-ITEM-REQUEST         15480099
153300                     COMPUTE PV-TOP-ITEM =                        15490099
153400                             ASC-NUMBER-OF-ITEMS-READ             15500099
153500                             - PC-ITEMS-PER-PANEL + 1             15510099
153600                     IF  PV-TOP-ITEM < +1                         15520099
153700                         MOVE +1   TO PV-TOP-ITEM                 15530099
153800                         MOVE PC-TSYMSG-00070                     15540099
153900                                   TO DP020-MSG-NUMBER            15550099
154000                         SET DP020-MSG-INFORMATIONAL              15560099
154100                                   TO TRUE                        15570099
154200                     END-IF                                       15580099
154300                 ELSE                                             15590099
154400                     MOVE ASC-START-ITEM-REQUEST-N                15600099
154500                                   TO PV-TOP-ITEM                 15610099
154600                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      15620099
154700                     COMPUTE PV-BOTTOM-ITEM =                     15630099
154800                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     15640099
154900                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ15650099
155000*----------------------- BOTTOM OF LIST --------------            15660099
155100                         MOVE PC-TSYMSG-00070                     15670099
155200                                   TO DP020-MSG-NUMBER            15680099
155300                         SET DP020-MSG-INFORMATIONAL              15690099
155400                                   TO TRUE                        15700099
155500                     END-IF                                       15710099
155600                 END-IF                                           15720099
155700             ELSE                                                 15730099
155800*--------------- VALUE OUT OF RANGE ------------------            15740099
155900                 MOVE PC-TSYMSG-00101                             15750099
156000                                   TO DP020-MSG-NUMBER            15760099
156100                 MOVE -1           TO ASTRTITL                    15770099
156200                 SET DP030-SET-CURSOR-APPL-1                      15780099
156300                                   TO TRUE                        15790099
156400                 MOVE DP015-REVERSE                               15800099
156500                                   TO ASTRTITH                    15810099
156600                 MOVE DP015-RED    TO ASTRTITC                    15820099
156700                 MOVE DP015-UNP-NUM-BRT-MDT                       15830099
156800                                   TO ASTRTITA                    15840099
156900                 SET DP020-MSG-FATAL                              15850099
157000                                   TO TRUE                        15860099
157100                 SET PS-ERROR      TO TRUE                        15870099
157200             END-IF                                               15880099
157300                                                                  15890099
157400         ELSE                                                     15900099
157500             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            15910099
157600             MOVE -1               TO ASTRTITL                    15920099
157700             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  15930099
157800             MOVE DP015-REVERSE    TO ASTRTITH                    15940099
157900             MOVE DP015-RED        TO ASTRTITC                    15950099
158000             MOVE DP015-UNP-NUM-BRT-MDT                           15960099
158100                                   TO ASTRTITA                    15970099
158200             SET DP020-MSG-FATAL   TO TRUE                        15980099
158300             SET PS-ERROR          TO TRUE                        15990099
158400         END-IF                                                   16000099
158500     END-IF.                                                      16010099
158600                                                                  16020099
158700 EJECT                                                            16030099
158800*----------------------------------------------------------------*16040099
158900*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *16050099
159000*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *16060099
159100*----------------------------------------------------------------*16070099
159200 2140-DESELECT-ALL-ITEMS.                                         16080099
159300                                                                  16090099
159400     MOVE +1                       TO ASC-BLK-SUB.                16100099
159500                                                                  16110099
159600     PERFORM 2141-CLEAR-SELECTED-INDS                             16120099
159700         VARYING ASC-ITEM-SUB                                     16130099
159800         FROM 1 BY 1                                              16140099
159900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16150099
160000                                                                  16160099
160100     ADD +1                        TO ASC-BLK-SUB.                16170099
160200                                                                  16180099
160300     PERFORM 2141-CLEAR-SELECTED-INDS                             16190099
160400         VARYING ASC-ITEM-SUB                                     16200099
160500         FROM 1 BY 1                                              16210099
160600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16220099
160700                                                                  16230099
160800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               16240099
160900                                   TO PV-LIST-ITEM-NUMBER.        16250099
161000                                                                  16260099
161100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            16270099
161200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    16280099
161300                                                                  16290099
161400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     16300099
161500        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      16310099
161600         MOVE +1                   TO ASC-BLK-SUB                 16320099
161700                                                                  16330099
161800         PERFORM 5100-WRITE-TEMP-STORAGE                          16340099
161900                                                                  16350099
162000         MOVE +1                   TO PV-BLOCK-NUMBER             16360099
162100                                                                  16370099
162200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         16380099
162300             PV-FIRST-BLOCK-IN-ARRAY - 1                          16390099
162400                                                                  16400099
162500         PERFORM                                                  16410099
162600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       16420099
162700                                                                  16430099
162800             PERFORM 4410-READ-TEMP-STORAGE                       16440099
162900                                                                  16450099
163000             PERFORM 2141-CLEAR-SELECTED-INDS                     16460099
163100                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 16470099
163200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16480099
163300                                                                  16490099
163400             PERFORM 5100-WRITE-TEMP-STORAGE                      16500099
163500                                                                  16510099
163600             ADD +1                TO PV-BLOCK-NUMBER             16520099
163700                                                                  16530099
163800         END-PERFORM                                              16540099
163900                                                                  16550099
164000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         16560099
164100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     16570099
164200                                                                  16580099
164300         PERFORM                                                  16590099
164400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       16600099
164500                   ASC-HIGHEST-BLOCK-WRITTEN                      16610099
164600                                                                  16620099
164700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          16630099
164800                                   TO PV-BLOCK-NUMBER             16640099
164900                                                                  16650099
165000             PERFORM 4410-READ-TEMP-STORAGE                       16660099
165100                                                                  16670099
165200             PERFORM 2141-CLEAR-SELECTED-INDS                     16680099
165300                 VARYING ASC-ITEM-SUB                             16690099
165400                 FROM 1 BY 1                                      16700099
165500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16710099
165600                                                                  16720099
165700             PERFORM 5100-WRITE-TEMP-STORAGE                      16730099
165800                                                                  16740099
165900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      16750099
166000                                                                  16760099
166100         END-PERFORM                                              16770099
166200                                                                  16780099
166300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             16790099
166400                                   TO PV-BLOCK-NUMBER             16800099
166500                                                                  16810099
166600         PERFORM 4410-READ-TEMP-STORAGE                           16820099
166700     END-IF.                                                      16830099
166800                                                                  16840099
166900     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMS16850099
167000                                      ASC-START-OF-SELECTED-RANGE 16860099
167100                                      ASC-END-OF-SELECTED-RANGE.  16870099
167200                                                                  16880099
167300     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        16890099
167400                                                                  16900099
167500 EJECT                                                            16910099
167600*----------------------------------------------------------------*16920099
167700*    MARK EACH ITEM AS BEING NOT SELECTED.                       *16930099
167800*----------------------------------------------------------------*16940099
167900 2141-CLEAR-SELECTED-INDS.                                        16950099
168000                                                                  16960099
168100     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           16970099
168200             NOT EQUAL ZERO                                       16980099
168300         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          16990099
168400             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          17000099
168500                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    17010099
168600                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  17020099
168700                                   TO TRUE                        17030099
168800         END-IF                                                   17040099
168900     END-IF.                                                      17050099
169000                                                                  17060099
169100 EJECT                                                            17070099
169200*----------------------------------------------------------------*17080099
169300*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *17090099
169400*  FOR ALL ITEMS.                                                *17100099
169500*----------------------------------------------------------------*17110099
169600 2150-SELECT-ALL-ITEMS.                                           17120099
169700                                                                  17130099
169800     MOVE +1                       TO ASC-BLK-SUB.                17140099
169900                                                                  17150099
170000     PERFORM 2151-SET-SELECTED-INDS                               17160099
170100         VARYING ASC-ITEM-SUB                                     17170099
170200         FROM 1 BY 1                                              17180099
170300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17190099
170400                                                                  17200099
170500     ADD +1                        TO ASC-BLK-SUB.                17210099
170600                                                                  17220099
170700     PERFORM 2151-SET-SELECTED-INDS                               17230099
170800         VARYING ASC-ITEM-SUB                                     17240099
170900         FROM 1 BY 1                                              17250099
171000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17260099
171100                                                                  17270099
171200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               17280099
171300                                   TO PV-LIST-ITEM-NUMBER.        17290099
171400                                                                  17300099
171500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            17310099
171600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    17320099
171700                                                                  17330099
171800     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     17340099
171900        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    17350099
172000         MOVE +1                   TO ASC-BLK-SUB                 17360099
172100                                                                  17370099
172200         PERFORM 5100-WRITE-TEMP-STORAGE                          17380099
172300                                                                  17390099
172400         MOVE +1                   TO PV-BLOCK-NUMBER             17400099
172500                                                                  17410099
172600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         17420099
172700             PV-FIRST-BLOCK-IN-ARRAY - 1                          17430099
172800                                                                  17440099
172900         PERFORM                                                  17450099
173000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       17460099
173100                                                                  17470099
173200             PERFORM 4410-READ-TEMP-STORAGE                       17480099
173300                                                                  17490099
173400             PERFORM 2151-SET-SELECTED-INDS                       17500099
173500                 VARYING ASC-ITEM-SUB                             17510099
173600                 FROM 1 BY 1                                      17520099
173700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17530099
173800                                                                  17540099
173900             PERFORM 5100-WRITE-TEMP-STORAGE                      17550099
174000                                                                  17560099
174100             ADD +1                TO PV-BLOCK-NUMBER             17570099
174200                                                                  17580099
174300         END-PERFORM                                              17590099
174400                                                                  17600099
174500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         17610099
174600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     17620099
174700                                                                  17630099
174800         PERFORM                                                  17640099
174900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       17650099
175000                   ASC-HIGHEST-BLOCK-WRITTEN                      17660099
175100                                                                  17670099
175200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          17680099
175300                                   TO PV-BLOCK-NUMBER             17690099
175400                                                                  17700099
175500             PERFORM 4410-READ-TEMP-STORAGE                       17710099
175600                                                                  17720099
175700             PERFORM 2151-SET-SELECTED-INDS                       17730099
175800                 VARYING ASC-ITEM-SUB                             17740099
175900                 FROM 1 BY 1                                      17750099
176000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17760099
176100                                                                  17770099
176200             PERFORM 5100-WRITE-TEMP-STORAGE                      17780099
176300                                                                  17790099
176400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      17800099
176500                                                                  17810099
176600         END-PERFORM                                              17820099
176700                                                                  17830099
176800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             17840099
176900                                   TO PV-BLOCK-NUMBER             17850099
177000                                                                  17860099
177100         PERFORM 4410-READ-TEMP-STORAGE                           17870099
177200     END-IF.                                                      17880099
177300                                                                  17890099
177400     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             17900099
177500                       ASC-NUMBER-OF-SELECTED-ITEMS.              17910099
177600                                                                  17920099
177700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        17930099
177800                                                                  17940099
177900 EJECT                                                            17950099
178000*----------------------------------------------------------------*17960099
178100*    MARK EACH ITEM AS BEING SELECTED.                           *17970099
178200*----------------------------------------------------------------*17980099
178300 2151-SET-SELECTED-INDS.                                          17990099
178400                                                                  18000099
178500     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           18010099
178600             NOT EQUAL ZERO                                       18020099
178700         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             18030099
178800             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             18040099
178900                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        18050099
179000                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  18060099
179100                               TO  TRUE                           18070099
179200         END-IF                                                   18080099
179300     END-IF.                                                      18090099
179400                                                                  18100099
179500 EJECT                                                            18110099
179600*----------------------------------------------------------------*18120099
179700*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *18130099
179800*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *18140099
179900*----------------------------------------------------------------*18150099
180000 2200-MOVE-SCREEN-TO-COMMAREA.                                    18160099
180100                                                                  18170099
180200     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             18180099
180300     MOVE +1                       TO PV-SUB.                     18190099
180400*                                                                 18200099
180500     PERFORM 3100-SET-SUBSCRIPTS.                                 18210099
180600     IF  ASTRTITL > ZERO                                          18220099
180700         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          18230099
180800     ELSE                                                         18240099
180900         IF  ASTRTITF = DP015-ERASE-EOF                           18250099
181000             INITIALIZE ASC-START-ITEM-REQUEST                    18260099
181100         END-IF                                                   18270099
181200     END-IF.                                                      18280099
181300     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          18290099
181400         VARYING PV-SUB                                           18300099
181500         FROM 1 BY 1                                              18310099
181600         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      18320099
181700                                                                  18330099
181800 EJECT                                                            18340099
181900*----------------------------------------------------------------*18350099
182000*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *18360099
182100*----------------------------------------------------------------*18370099
182200 2210-MOVE-LINES-TO-COMMAREA.                                     18380099
182300                                                                  18390099
182400     IF  MR-SELECTL (PV-SUB) > ZERO                               18400099
182500         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             18410099
182600         MOVE MR-SELECTI (PV-SUB)                                 18420099
182700                                   TO ASC-TEMP-SELECTED-SW        18430099
182800                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      18440099
182900     ELSE                                                         18450099
183000         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                18460099
183100                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     18470099
183200                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        18480099
183300                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      18490099
183400         END-IF                                                   18500099
183500     END-IF.                                                      18510099
183600     ADD +1                        TO ASC-ITEM-SUB.               18520099
183700     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        18530099
183800         ADD  +1                   TO ASC-BLK-SUB                 18540099
183900         MOVE +1                   TO ASC-ITEM-SUB                18550099
184000     END-IF.                                                      18560099
184100                                                                  18570099
184200 EJECT                                                            18580099
184300*----------------------------------------------------------------*18590099
184400*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *18600099
184500*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *18610099
184600*----------------------------------------------------------------*18620099
184700 3000-EDIT-DATA-IN-COMMAREA.                                      18630099
184800                                                                  18640099
184900     SET PS-NO-ERROR               TO TRUE.                       18650099
185000     PERFORM 3200-RESET-ATTRIBUTES.                               18660099
185100     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     18670099
185200*----------------------------------------------------------------*18680099
185300* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.             *18690099
185400* EDITTING IS DONE FROM THE BOTTOM UP.                           *18700099
185500*----------------------------------------------------------------*18710099
185600     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       18720099
185700         ASC-ITEMS-DISPLAYED - 1.                                 18730099
185800     PERFORM 3100-SET-SUBSCRIPTS.                                 18740099
185900     PERFORM 3300-EDIT-SELECTIONS                                 18750099
186000         VARYING PV-SUB                                           18760099
186100         FROM PV-SUB BY -1                                        18770099
186200         UNTIL PV-SUB < +1.                                       18780099
186300*                                                                 18790099
186400     IF  PS-NO-ERROR                                              18800099
186500         PERFORM 3400-CHECK-RANGE-SEQUENCE                        18810099
186600     END-IF.                                                      18820099
186700*                                                                 18830099
186800     IF  ((PS-NO-ERROR)                                           18840099
186900       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   18850099
187000       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    18860099
187100             PERFORM 3500-MARK-RANGE-AS-SELECTED                  18870099
187200     END-IF.                                                      18880099
187300                                                                  18890099
187400 EJECT                                                            18900099
187500*----------------------------------------------------------------*18910099
187600*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *18920099
187700*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY. THIS WILL *18930099
187800*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *18940099
187900*                                                                *18950099
188000*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *18960099
188100*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *18970099
188200*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *18980099
188300*    US IN THE 2ND BLOCK OF THE ARRAY.                           *18990099
188400*----------------------------------------------------------------*19000099
188500 3100-SET-SUBSCRIPTS.                                             19010099
188600                                                                  19020099
188700     COMPUTE ASC-ITEM-SUB =                                       19030099
188800         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        19040099
188900                                                                  19050099
189000     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         19060099
189100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            19070099
189200                                                                  19080099
189300         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               19090099
189400     ELSE                                                         19100099
189500         MOVE +1                     TO ASC-BLK-SUB               19110099
189600     END-IF.                                                      19120099
189700                                                                  19130099
189800 EJECT                                                            19140099
189900*----------------------------------------------------------------*19150099
190000*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *19160099
190100*----------------------------------------------------------------*19170099
190200 3200-RESET-ATTRIBUTES.                                           19180099
190300                                                                  19190099
190400     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   19200099
190500     MOVE DP015-GREEN              TO ASTRTITC.                   19210099
190600     MOVE DP015-UNDERLINE          TO ASTRTITH.                   19220099
190700                                                                  19230099
190800     PERFORM                                                      19240099
190900         VARYING PV-SUB                                           19250099
191000         FROM 1 BY 1                                              19260099
191100         UNTIL PV-SUB > (PC-ITEMS-PER-PANEL  OR                   19270099
191200                         ASC-ITEMS-DISPLAYED)                     19280099
191300         MOVE DP015-UNP-ALP-NOR-OFF                               19290099
191400                                   TO MR-SELECTA (PV-SUB)         19300099
191500         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         19310099
191600         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         19320099
191700     END-PERFORM.                                                 19330099
191800                                                                  19340099
191900 EJECT                                                            19350099
192000*----------------------------------------------------------------*19360099
192100*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *19370099
192200*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *19380099
192300*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *19390099
192400*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *19400099
192500*----------------------------------------------------------------*19410099
192600 3300-EDIT-SELECTIONS.                                            19420099
192700                                                                  19430099
192800     EVALUATE TRUE                                                19440099
192900         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     19450099
193000             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         19460099
193100                 CONTINUE                                         19470099
193200         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         19480099
193300             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        19490099
193400                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   19500099
193500                 MOVE ASC-TEMP-SELECTED-SW                        19510099
193600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19520099
193700                                TO ASC-SELECTED-SW                19530099
193800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19540099
193900             END-IF                                               19550099
194000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     19560099
194100                                = SPACE                           19570099
194200             EVALUATE TRUE                                        19580099
194300                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       19590099
194400                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS19600099
194500                     MOVE SPACE TO ASC-SELECTED-SW                19610099
194600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19620099
194700                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        19630099
194800                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    19640099
194900                     MOVE SPACE TO ASC-SELECTED-SW                19650099
195000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19660099
195100                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          19670099
195200                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      19680099
195300                     MOVE SPACE TO ASC-SELECTED-SW                19690099
195400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19700099
195500             END-EVALUATE                                         19710099
195600         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           19720099
195700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            19730099
195800                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    19740099
195900             END-IF                                               19750099
196000             PERFORM 3310-EDIT-RANGE                              19760099
196100         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             19770099
196200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            19780099
196300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    19790099
196400             END-IF                                               19800099
196500             PERFORM 3310-EDIT-RANGE                              19810099
196600         WHEN OTHER                                               19820099
196700             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           19830099
196800             SET DP020-MSG-FATAL    TO TRUE                       19840099
196900             MOVE -1                TO MR-SELECTL (PV-SUB)        19850099
197000             SET DP030-SET-CURSOR-APPL-1                          19860099
197100                                    TO TRUE                       19870099
197200             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        19880099
197300             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        19890099
197400             SET PS-ERROR TO TRUE                                 19900099
197500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            19910099
197600                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     19920099
197700                 MOVE SPACE         TO ASC-SELECTED-SW            19930099
197800                                        (ASC-BLK-SUB ASC-ITEM-SUB)19940099
197900             END-IF                                               19950099
198000     END-EVALUATE.                                                19960099
198100                                                                  19970099
198200     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 19980099
198300     SUBTRACT +1 FROM ASC-ITEM-SUB.                               19990099
198400     IF  ASC-ITEM-SUB < 1                                         20000099
198500         SUBTRACT +1 FROM ASC-BLK-SUB                             20010099
198600         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                20020099
198700     END-IF.                                                      20030099
198800                                                                  20040099
198900 EJECT                                                            20050099
199000*----------------------------------------------------------------*20060099
199100*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *20070099
199200*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *20080099
199300*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *20090099
199400*  THE ENDING.                                                   *20100099
199500*----------------------------------------------------------------*20110099
199600 3310-EDIT-RANGE.                                                 20120099
199700                                                                  20130099
199800     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                20140099
199900         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   20150099
200000             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)20160099
200100                                   TO ASC-SELECTED-SW             20170099
200200                                        (ASC-BLK-SUB ASC-ITEM-SUB)20180099
200300             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 20190099
200400         ELSE                                                     20200099
200500             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     20210099
200600                 CONTINUE                                         20220099
200700             ELSE                                                 20230099
200800*--------------- ONLY ONE BEGINNING-OF-RANGE-ALLOWED ---          20240099
200900                 MOVE PC-TSYMSG-00054                             20250099
201000                                   TO DP020-MSG-NUMBER            20260099
201100                 SET DP020-MSG-FATAL                              20270099
201200                                   TO TRUE                        20280099
201300                 MOVE -1           TO MR-SELECTL (PV-SUB)         20290099
201400                 SET DP030-SET-CURSOR-APPL-1                      20300099
201500                                   TO TRUE                        20310099
201600                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         20320099
201700                 MOVE DP015-UNDERLINE                             20330099
201800                                   TO MR-SELECTH (PV-SUB)         20340099
201900                 SET PS-ERROR      TO TRUE                        20350099
202000             END-IF                                               20360099
202100         END-IF                                                   20370099
202200     ELSE                                                         20380099
202300         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     20390099
202400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 20400099
202500                                   TO ASC-SELECTED-SW             20410099
202600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   20420099
202700             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   20430099
202800         ELSE                                                     20440099
202900             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       20450099
203000                 CONTINUE                                         20460099
203100             ELSE                                                 20470099
203200*--------------- ONLY ONE END-OF-RANGE ALLOWED -------            20480099
203300                 MOVE PC-TSYMSG-00055                             20490099
203400                                   TO DP020-MSG-NUMBER            20500099
203500                 SET DP020-MSG-FATAL                              20510099
203600                                   TO TRUE                        20520099
203700                 MOVE -1           TO MR-SELECTL (PV-SUB)         20530099
203800                 SET DP030-SET-CURSOR-APPL-1                      20540099
203900                                   TO TRUE                        20550099
204000                 SET PS-ERROR      TO TRUE                        20560099
204100             END-IF                                               20570099
204200         END-IF                                                   20580099
204300     END-IF.                                                      20590099
204400                                                                  20600099
204500 EJECT                                                            20610099
204600*----------------------------------------------------------------*20620099
204700*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *20630099
204800*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *20640099
204900*----------------------------------------------------------------*20650099
205000 3400-CHECK-RANGE-SEQUENCE.                                       20660099
205100                                                                  20670099
205200     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       20680099
205300       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      20690099
205400       AND  ASC-START-OF-SELECTED-RANGE >                         20700099
205500                                         ASC-END-OF-SELECTED-RANGE20710099
205600*------- END-OF-RANGE BEFORE BEGINNING-OF-RANGE --                20720099
205700         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 20730099
205800         SET DP020-MSG-FATAL TO TRUE                              20740099
205900         SET PS-ERROR TO TRUE                                     20750099
206000         PERFORM 3410-POSITION-AT-ERROR                           20760099
206100     END-IF.                                                      20770099
206200                                                                  20780099
206300 EJECT                                                            20790099
206400*----------------------------------------------------------------*20800099
206500*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *20810099
206600*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *20820099
206700*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *20830099
206800*----------------------------------------------------------------*20840099
206900 3410-POSITION-AT-ERROR.                                          20850099
207000                                                                  20860099
207100     SET DP030-SET-CURSOR-APPL-1                                  20870099
207200                                   TO TRUE.                       20880099
207300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 20890099
207400                    - PV-TOP-ITEM + 1.                            20900099
207500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      20910099
207600         CONTINUE                                                 20920099
207700     ELSE                                                         20930099
207800         MOVE -1                   TO MR-SELECTL (PV-SUB)         20940099
207900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         20950099
208000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         20960099
208100     END-IF.                                                      20970099
208200*                                                                 20980099
208300     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   20990099
208400                    - PV-TOP-ITEM + 1.                            21000099
208500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      21010099
208600         CONTINUE                                                 21020099
208700     ELSE                                                         21030099
208800         MOVE -1                   TO MR-SELECTL (PV-SUB)         21040099
208900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         21050099
209000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         21060099
209100     END-IF.                                                      21070099
209200                                                                  21080099
209300 EJECT                                                            21090099
209400*----------------------------------------------------------------*21100099
209500*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *21110099
209600*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *21120099
209700*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *21130099
209800*----------------------------------------------------------------*21140099
209900 3500-MARK-RANGE-AS-SELECTED.                                     21150099
210000                                                                  21160099
210100     MOVE +1                       TO  ASC-BLK-SUB.               21170099
210200     PERFORM 3510-MARK-SELECTED-INDS                              21180099
210300         VARYING ASC-ITEM-SUB                                     21190099
210400         FROM 1 BY 1                                              21200099
210500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 21210099
210600                                                                  21220099
210700     ADD +1                        TO ASC-BLK-SUB.                21230099
210800     PERFORM 3510-MARK-SELECTED-INDS                              21240099
210900         VARYING ASC-ITEM-SUB                                     21250099
211000         FROM 1 BY 1                                              21260099
211100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 21270099
211200                                                                  21280099
211300     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               21290099
211400                                   TO  PV-LIST-ITEM-NUMBER.       21300099
211500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            21310099
211600         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         21320099
211700               PC-ITEMS-PER-PANEL).                               21330099
211800                                                                  21340099
211900     MOVE ASC-START-OF-SELECTED-RANGE                             21350099
212000                                   TO PV-START-OF-SELECTED-RANGE. 21360099
212100     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            21370099
212200         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  21380099
212300               PC-ITEMS-PER-PANEL).                               21390099
212400                                                                  21400099
212500     MOVE ASC-END-OF-SELECTED-RANGE                               21410099
212600                                   TO  PV-END-OF-SELECTED-RANGE.  21420099
212700     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             21430099
212800         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    21440099
212900               PC-ITEMS-PER-PANEL).                               21450099
213000     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             21460099
213100         PV-FIRST-BLOCK-IN-ARRAY + 1.                             21470099
213200                                                                  21480099
213300     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    21490099
213400        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        21500099
213500         MOVE +1                   TO ASC-BLK-SUB                 21510099
213600         PERFORM 5100-WRITE-TEMP-STORAGE                          21520099
213700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         21530099
213800             PV-FIRST-BLOCK-IN-ARRAY - 1                          21540099
213900                                                                  21550099
214000         PERFORM                                                  21560099
214100             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      21570099
214200                   PV-PREV-BLOCK-IN-ARRAY                         21580099
214300             MOVE PV-FIRST-BLOCK-IN-RANGE                         21590099
214400                                   TO PV-BLOCK-NUMBER             21600099
214500             PERFORM 4410-READ-TEMP-STORAGE                       21610099
214600             PERFORM 3510-MARK-SELECTED-INDS                      21620099
214700                 VARYING ASC-ITEM-SUB                             21630099
214800                 FROM 1 BY 1                                      21640099
214900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          21650099
215000             PERFORM 5100-WRITE-TEMP-STORAGE                      21660099
215100             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     21670099
215200         END-PERFORM                                              21680099
215300                                                                  21690099
215400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         21700099
215500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     21710099
215600         PERFORM                                                  21720099
215700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       21730099
215800                   PV-LAST-BLOCK-IN-RANGE                         21740099
215900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          21750099
216000                                   TO PV-BLOCK-NUMBER             21760099
216100             PERFORM 4410-READ-TEMP-STORAGE                       21770099
216200             PERFORM 3510-MARK-SELECTED-INDS                      21780099
216300                 VARYING ASC-ITEM-SUB                             21790099
216400                 FROM 1 BY 1                                      21800099
216500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          21810099
216600             PERFORM 5100-WRITE-TEMP-STORAGE                      21820099
216700             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      21830099
216800         END-PERFORM                                              21840099
216900                                                                  21850099
217000         MOVE PV-FIRST-BLOCK-IN-ARRAY                             21860099
217100                                   TO PV-BLOCK-NUMBER             21870099
217200         PERFORM 4410-READ-TEMP-STORAGE                           21880099
217300     END-IF.                                                      21890099
217400                                                                  21900099
217500     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 21910099
217600                                      ASC-END-OF-SELECTED-RANGE.  21920099
217700                                                                  21930099
217800 EJECT                                                            21940099
217900*----------------------------------------------------------------*21950099
218000* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *21960099
218100*----------------------------------------------------------------*21970099
218200 3510-MARK-SELECTED-INDS.                                         21980099
218300                                                                  21990099
218400     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         22000099
218500                                ASC-ITEM-SUB) >                   22010099
218600         ASC-START-OF-SELECTED-RANGE)                             22020099
218700     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         22030099
218800                                ASC-ITEM-SUB) =                   22040099
218900         ASC-START-OF-SELECTED-RANGE)                             22050099
219000                                                                  22060099
219100         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     22070099
219200                                    ASC-ITEM-SUB) <               22080099
219300             ASC-END-OF-SELECTED-RANGE)                           22090099
219400         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     22100099
219500                                    ASC-ITEM-SUB) =               22110099
219600             ASC-END-OF-SELECTED-RANGE)                           22120099
219700                                                                  22130099
219800             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          22140099
219900                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   22150099
220000                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   22160099
220100                               TO TRUE                            22170099
220200                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              22180099
220300                               TO TRUE                            22190099
220400                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    22200099
220500             END-IF                                               22210099
220600         END-IF                                                   22220099
220700     END-IF.                                                      22230099
220800                                                                  22240099
220900 EJECT                                                            22250099
221000*----------------------------------------------------------------*22260099
221100*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *22270099
221200*    INITIALIZE ALL COUNTERS AND FLAGS.                          *22280099
221300*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *22290099
221400*    DISPLAY THE PANEL TO USER.                                  *22300099
221500*----------------------------------------------------------------*22310099
221600 4000-BUILD-INITIAL-PANEL.                                        22320099
221700                                                                  22330099
221800     INITIALIZE                 ASC-BLOCK-ENTRIES (1)             22340099
221900                                ASC-BLOCK-ENTRIES (2)             22350099
222000                                ASC-TOT-CARTONS.                  22360099
222100     MOVE +1                 TO ASC-BLK-SUB.                      22370099
222200     SET DP030-SET-CURSOR-TRAILER TO TRUE.                        22380099
222300     SET ASC-ITEMS-LEFT-ON-DB                                     22390099
222400                             TO TRUE.                             22400099
222500                                                                  22410099
222600     MOVE +0                 TO ASC-ITEM-SUB                      22420099
222700                                ASC-NUMBER-OF-ITEMS-READ          22430099
222800                                ASC-NUMBER-OF-SELECTED-ITEMS      22440099
222900                                ASC-HIGHEST-BLOCK-WRITTEN         22450099
223000                                ASC-START-OF-SELECTED-RANGE       22460099
223100                                ASC-END-OF-SELECTED-RANGE         22470099
223200                                ASC-ITEM-AT-TOP-OF-PANEL.         22480099
223300     PERFORM 4010-OPEN-CURSOR.                                    22490099
223400                                                                  22500099
223500     PERFORM 4300-READ-ITEMS-FROM-DB.                             22510099
223600                                                                  22520099
223700     PERFORM 4020-CLOSE-CURSOR.                                   22530099
223800                                                                  22540099
223900     MOVE +1                   TO  PV-TOP-ITEM.                   22550099
224000     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          22560099
224100         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    22570099
224200         SET DP020-MSG-FATAL   TO  TRUE                           22580099
224300*------- PURCHASE ORDER DOES NOT EXIST -----                      22590099
224400         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               22600099
224500     ELSE                                                         22610099
224600*        MOVE -1               TO MR-SELECTL (1)                  22620099
224700*        SET DP030-SET-CURSOR-APPL-1                              22630099
224800*                              TO TRUE                            22640099
224900         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     22650099
225000     END-IF.                                                      22660099
225100                                                                  22670099
225200 EJECT                                                            22680099
225300*----------------------------------------------------------------*22690099
225400*   OPEN THE TRAILER CURSOR                                      *22700099
225500*----------------------------------------------------------------*22710099
225600 4010-OPEN-CURSOR.                                                22720099
225700                                                                  22730099
225800     PERFORM                                                      22740099
225900         WITH TEST AFTER                                          22750099
226000         VARYING PV-RETRY-COUNTER                                 22760099
226100         FROM 1 BY 1                                              22770099
226200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               22780099
226300             OR (SQLCODE = ZERO))                                 22790099
226400                                                                  22800099
226500         MOVE 'CURSOR:  TRLR-CSR'                                 22810099
226600                        TO DP013-MESSAGE-TEXT (2)                 22820099
226700         EXEC SQL                                                 22830099
226800                  OPEN TRLR-CSR                                   22840099
226900         END-EXEC                                                 22850099
227000                                                                  22860099
227100*                                                                 22870099
227200         EVALUATE TRUE                                            22880099
227300             WHEN SQLCODE = ZERO                                  22890099
227400             WHEN SQLCODE = -904                                  22900099
227500             WHEN SQLCODE = -913                                  22910099
227600                 CONTINUE                                         22920099
227700             WHEN SQLWARN0 NOT = SPACES                           22930099
227800             WHEN SQLCODE < ZERO                                  22940099
227900             WHEN SQLCODE > ZERO                                  22950099
228000                 MOVE '4010-OPEN-CURSOR'                          22960099
228100                                   TO DP013-PARAGRAPH             22970099
228200                 MOVE 'OPEN TRAILER CURSOR - '                    22980099
228300                                   TO DP013-MESSAGE-TEXT (1)      22990099
228400                 MOVE SQLCA        TO DP013-SQLCA                 23000099
228500                 MOVE 'TSHPTPO '   TO DP013-DB2-TABLE-NAME (1)    23010099
228600                 SET DP013-DB2-ABEND                              23020099
228700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           23030099
228800                 PERFORM DP013-0000-PROCESS-ABEND                 23040099
228900         END-EVALUATE                                             23050099
229000     END-PERFORM.                                                 23060099
229100*                                                                 23070099
229200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        23080099
229300         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             23090099
229400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   23100099
229500                                   TO DP013-MESSAGE-TEXT (1)      23110099
229600         MOVE SQLCA                TO DP013-SQLCA                 23120099
229700         MOVE 'TIMCNPO '           TO DP013-DB2-TABLE-NAME (1)    23130099
229800         SET DP013-DB2-ABEND                                      23140099
229900             DP013-XCTL-DISPLAY-RESTART                           23150099
230000                                   TO TRUE                        23160099
230100         PERFORM DP013-0000-PROCESS-ABEND                         23170099
230200     END-IF.                                                      23180099
230300                                                                  23190099
230400 EJECT                                                            23200099
230500*----------------------------------------------------------------*23210099
230600*   CLOSE THE TRAILER CURSOR                                     *23220099
230700*----------------------------------------------------------------*23230099
230800 4020-CLOSE-CURSOR.                                               23240099
230900                                                                  23250099
231000     EXEC SQL                                                     23260099
231100          CLOSE TRLR-CSR                                          23270099
231200     END-EXEC                                                     23280099
231300                                                                  23290099
231400*                                                                 23300099
231500     EVALUATE TRUE                                                23310099
231600         WHEN SQLCODE = ZERO                                      23320099
231700             CONTINUE                                             23330099
231800         WHEN SQLWARN0 NOT = SPACES                               23340099
231900         WHEN SQLCODE < ZERO                                      23350099
232000         WHEN SQLCODE > ZERO                                      23360099
232100             MOVE '4020-CLOSE-CURSOR'                             23370099
232200                               TO DP013-PARAGRAPH                 23380099
232300             MOVE 'CLOSE TRLR CURSOR '                            23390099
232400                               TO DP013-MESSAGE-TEXT (1)          23400099
232500             MOVE SQLCA        TO DP013-SQLCA                     23410099
232600             MOVE 'TSHPTPO '   TO DP013-DB2-TABLE-NAME (1)        23420099
232700             SET DP013-DB2-ABEND                                  23430099
232800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               23440099
232900             PERFORM DP013-0000-PROCESS-ABEND                     23450099
233000     END-EVALUATE.                                                23460099
233100                                                                  23470099
233200 EJECT                                                            23480099
233300*----------------------------------------------------------------*23490099
233400*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *23500099
233500*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *23510099
233600*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *23520099
233700*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *23530099
233800*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *23540099
233900*                                                                *23550099
234000*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *23560099
234100*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *23570099
234200*    UPON INITIALIZATION.                                        *23580099
234300*----------------------------------------------------------------*23590099
234400 4300-READ-ITEMS-FROM-DB.                                         23600099
234500                                                                  23610099
234600     PERFORM                                                      23620099
234700         VARYING PV-READ-COUNT                                    23630099
234800         FROM 1 BY 1                                              23640099
234900         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    23650099
235000            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         23660099
235100                                                                  23670099
235200         PERFORM 4310-FETCH                                       23680099
235300                                                                  23690099
235400         IF  ASC-ITEMS-LEFT-ON-DB                                 23700099
235500             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                23710099
235600                 ADD +1            TO ASC-ITEM-SUB                23720099
235700             ELSE                                                 23730099
235800                 ADD +1            TO ASC-BLK-SUB                 23740099
235900                 MOVE +1           TO ASC-ITEM-SUB                23750099
236000                                                                  23760099
236100                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         23770099
236200                     MOVE +1       TO ASC-BLK-SUB                 23780099
236300                     SET ASC-BLOCK-MODIFIED (1)                   23790099
236400                                   TO TRUE                        23800099
236500                     PERFORM 5100-WRITE-TEMP-STORAGE              23810099
236600                     MOVE ASC-BLOCK-ENTRIES                       23820099
236700                               (PC-MAX-BLOCKS-IN-ARRAY)           23830099
236800                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 23840099
236900                     ADD +1        TO ASC-BLK-SUB                 23850099
237000                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   23860099
237100                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      23870099
237200                                   TO  TRUE                       23880099
237300                 END-IF                                           23890099
237400             END-IF                                               23900099
237500             ADD +1                  TO  ASC-NUMBER-OF-ITEMS-READ 23910099
237600             MOVE ASC-NUMBER-OF-ITEMS-READ                        23920099
237700                                     TO  ASC-LIST-ITEM-NUMBER     23930099
237800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23940099
237900             MOVE VEHICL-VEH-NBR     TO  ASC-TRLR                 23950099
238000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23960099
238100             MOVE VEHICL-OWNER-SCAC-ID  TO  ASC-SCAC              23970099
238200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23980099
238300             MOVE PKSLIP-OPER-UNT-ID TO  ASC-DC                   23990099
238400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 24000099
238500             MOVE PKSLIP-REC-SEQ-NBR TO  ASC-RC                   24010099
238600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 24020099
238700             MOVE PKSLIP-EXPTED-PKG-QTY TO  ASC-CART              24030099
238800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 24040099
238900             ADD PKSLIP-EXPTED-PKG-QTY     TO ASC-TOT-CARTONS     24050099
239000             MOVE VHTRIP-EST-AR-TMST(9:2) TO PV-DATE-DAY          24060099
239100             MOVE VHTRIP-EST-AR-TMST(6:2) TO PV-DATE-MONTH        24070099
239200             MOVE '/'                     TO PV-DATE-SLASH        24080099
239300             MOVE PV-DATE                 TO ASC-ETA              24090099
239400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 24100099
239500                                                                  24110099
239600             MOVE PKSLIP-FCLTY-ID TO  ASC-FI                      24120099
239700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 24130099
239800             MOVE PKSLIP-OPER-UNT-ID TO  ASC-OU                   24140099
239900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 24150099
240000             MOVE SHIPMT-TRIP-ID  TO DK-TRIP-ID                   24160099
240100             MOVE SHIPMT-TRIP-ID  TO ASC-TRIP                     24170099
240200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 24180099
240300             PERFORM  4390-SELECT-CONTR-DEVAN-DATE                24190099
240400             PERFORM  4391-SELECT-TRLR-AVAIL-DATE                 24200099
240500             PERFORM  4380-SELECT-PO-TYP-CDE                      24210099
240600             PERFORM  4392-SELECT-TRLR-PCKUP-DATE                 24220099
240700             PERFORM  4393-CHECK-FOR-MULT-SHIPS                   24230099
240800             PERFORM  4396-SELECT-ATA                             24240099
240900       END-IF                                                     24250099
241000     END-PERFORM.                                                 24260099
241100                                                                  24270099
241200     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          24280099
241300         MOVE +1               TO ASC-BLK-SUB                     24290099
241400         PERFORM 5100-WRITE-TEMP-STORAGE                          24300099
241500         ADD +1                TO ASC-BLK-SUB                     24310099
241600         PERFORM 5100-WRITE-TEMP-STORAGE                          24320099
241700                                                                  24330099
241800         MOVE 1                TO ASC-BLK-SUB                     24340099
241900                                  PV-BLOCK-NUMBER                 24350099
242000         PERFORM 4410-READ-TEMP-STORAGE                           24360099
242100         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             24370099
242200             MOVE 2            TO ASC-BLK-SUB                     24380099
242300                                  PV-BLOCK-NUMBER                 24390099
242400             PERFORM 4410-READ-TEMP-STORAGE                       24400099
242500         END-IF                                                   24410099
242600     END-IF.                                                      24420099
242700                                                                  24430099
242800 EJECT                                                            24440099
242900*----------------------------------------------------------------*24450099
243000*    FETCH THE CONTAINER CURSOR                                  *24460099
243100*----------------------------------------------------------------*24470099
243200 4310-FETCH.                                                      24480099
243300                                                                  24490099
243400        EXEC SQL                                                  24500099
243500        FETCH TRLR-CSR                                            24510099
243600        INTO                                                      24520099
243700           :VEHICL-OWNER-SCAC-ID                                  24530099
243800          ,:VEHICL-VEH-NBR                                        24540099
243900          ,:PKSLIP-OPER-UNT-ID                                    24550099
244000          ,:PKSLIP-FCLTY-ID                                       24560099
244100          ,:SHIPMT-TRIP-ID                                        24570099
244200          ,:PKSLIP-REC-SEQ-NBR                                    24580099
244300          ,:PKSLIP-EXPTED-PKG-QTY                                 24590099
244400          ,:VHTRIP-EST-AR-TMST                                    24600099
244500        END-EXEC                                                  24610099
244600                                                                  24620099
244700*                                                                 24630099
244800     EVALUATE TRUE                                                24640099
244900         WHEN SQLCODE = ZERO                                      24650099
245000         WHEN SQLCODE = +100                                      24660099
245100         WHEN SQLCODE = -305                                      24670099
245200              CONTINUE                                            24680099
245300         WHEN SQLWARN0 NOT = SPACE                                24690099
245400         WHEN SQLCODE NOT = ZERO                                  24700099
245500              MOVE '4310-FETCH-CURSOR'                            24710099
245600                               TO DP013-PARAGRAPH                 24720099
245700              MOVE 'FETCH TRAILER CURSOR'                         24730099
245800                               TO DP013-MESSAGE-TEXT (1)          24740099
245900              MOVE SQLCA       TO DP013-SQLCA                     24750099
246000              SET DP013-DB2-ABEND                                 24760099
246100                               TO TRUE                            24770099
246200              PERFORM DP013-0000-PROCESS-ABEND                    24780099
246300             MOVE SQLCA        TO DP013-SQLCA                     24790099
246400             MOVE 'TSHPTPO '   TO DP013-DB2-TABLE-NAME (1)        24800099
246500             SET DP013-DB2-ABEND                                  24810099
246600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               24820099
246700             PERFORM DP013-0000-PROCESS-ABEND                     24830099
246800     END-EVALUATE.                                                24840099
246900*                                                                 24850099
247000     IF  SQLCODE EQUAL +100                                       24860099
247100         SET ASC-NO-ITEMS-LEFT-ON-DB                              24870099
247200                                   TO TRUE                        24880099
247300     END-IF.                                                      24890099
247400                                                                  24900099
247500 EJECT                                                            24910099
247600*----------------------------------------------------------------*24920099
247700*    FORMAT THE DB2 DATE TO MM/DD/YY.                            *24930099
247800*----------------------------------------------------------------*24940099
247900 4320-FORMAT-DATE.                                                24950099
248000                                                                  24960099
248100     MOVE PV-DB-MM          TO  PV-DD-MM.                         24970099
248200     MOVE PV-DB-DD          TO  PV-DD-DD.                         24980099
248300     MOVE PV-DB-YY          TO  PV-DD-YY.                         24990099
248400                                                                  25000099
248500*----------------------------------------------------------------*25010099
248600*    SELECT PO TYPE CODE.                                        *25020099
248700*----------------------------------------------------------------*25030099
248800 4380-SELECT-PO-TYP-CDE.                                          25040099
248900                                                                  25050099
249000     PERFORM                                                      25060099
249100         WITH TEST AFTER                                          25070099
249200         VARYING PV-RETRY-COUNTER                                 25080099
249300         FROM 1 BY 1                                              25090099
249400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               25100099
249500            OR  (SQLCODE = ZERO)                                  25110099
249600            OR  (SQLCODE = +100)                                  25120099
249700            OR  (SQLCODE = -811))                                 25130099
249800                                                                  25140099
249900         EXEC SQL                                                 25150099
250000              SELECT DISTINCT                                     25160099
250100                     PO_TYP_CDE                                   25170099
250200              INTO  :PV-PO-TYP-CDE                                25180099
250300              FROM   TPURCHS                                      25190099
250400              WHERE  PO_NBR         = :DK-PO-NBR                  25200099
250500                AND  VER_STATUS_CDE = 'A'                         25210099
250600         END-EXEC                                                 25220099
250700*                                                                 25230099
250800         EVALUATE TRUE                                            25240099
250900             WHEN SQLCODE = ZERO                                  25250099
251000             WHEN SQLCODE = -811                                  25260099
251100                IF PV-PO-TYP-CDE = 'IM' OR 'IF' OR 'IE' OR 'LD'   25270099
181356                                       OR 'LE'                    25280099
251200                    MOVE PC-P        TO PV-STATUS-CDE             25290099
251300                ELSE                                              25300099
251400                    MOVE PC-AF       TO PV-STATUS-CDE             25310099
251500                END-IF                                            25320099
251600             WHEN SQLCODE = +100                                  25330099
251700             WHEN SQLCODE = -904                                  25340099
251800             WHEN SQLCODE = -913                                  25350099
251900                 CONTINUE                                         25360099
252000             WHEN SQLWARN0 NOT = SPACES                           25370099
252100             WHEN SQLCODE < ZERO                                  25380099
252200             WHEN SQLCODE > ZERO                                  25390099
252300                 MOVE '4380-SELECT-PO-TYP-CDE'                    25400099
252400                                   TO DP013-PARAGRAPH             25410099
252500                 MOVE 'SQL ERROR SELECTING PO TYPE CDE'           25420099
252600                                   TO DP013-MESSAGE-TEXT (1)      25430099
252700                 MOVE SQLCA        TO DP013-SQLCA                 25440099
252800                 MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)    25450099
252900                 SET DP013-DB2-ABEND                              25460099
253000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           25470099
253100                 PERFORM DP013-0000-PROCESS-ABEND                 25480099
253200         END-EVALUATE                                             25490099
253300     END-PERFORM.                                                 25500099
253400*                                                                 25510099
253500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        25520099
253600         MOVE '4380-SELECT-PO-TYP-CDE'    TO DP013-PARAGRAPH      25530099
253700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  25540099
253800                                   TO DP013-MESSAGE-TEXT (1)      25550099
253900         MOVE SQLCA                TO DP013-SQLCA                 25560099
254000         MOVE 'TPURCHS '           TO DP013-DB2-TABLE-NAME (1)    25570099
254100         SET DP013-DB2-ABEND                                      25580099
254200             DP013-XCTL-DISPLAY-RESTART                           25590099
254300                                   TO TRUE                        25600099
254400         PERFORM DP013-0000-PROCESS-ABEND                         25610099
254500     END-IF.                                                      25620099
254600                                                                  25630099
254700 EJECT                                                            25640099
254800*----------------------------------------------------------------*25650099
254900*      SELECT DEVAN DATE FROM TIMCNTK                            *25660099
255000*----------------------------------------------------------------*25670099
255100 4390-SELECT-CONTR-DEVAN-DATE.                                    25680099
255200                                                                  25690099
255300     EXEC SQL                                                     25700099
255400         SELECT MIN(CNTK.DVN_TMST)                                25710099
255500           INTO :IMCNTK-DVN-TMST                                  25720099
255600           FROM                                                   25730099
255700              TIMCNPO CNPO                                        25740099
255800             ,TIMCNTK CNTK                                        25750099
255900             ,TPKSLIP PKSL                                        25760099
256000             ,TSHIPMT SHMT                                        25770099
256100             ,TSHPTPO SHPO                                        25780099
256200           WHERE CNPO.PO_NBR          = :DK-PO-NBR                25790099
256300             AND CNPO.DVN_CDE         = :PC-Y                     25800099
256400             AND CNTK.CONTNR_ID       = CNPO.CONTNR_ID            25810099
256500             AND CNTK.CONTNR_SEQ_NBR  = CNPO.CONTNR_SEQ_NBR       25820099
256600             AND PKSL.CONTNR_ID       = CNTK.CONTNR_ID            25830099
256700             AND PKSL.PO_NBR          = CNPO.PO_NBR               25840099
256800             AND PKSL.REC_SEQ_NBR    <> 0                         25850099
256900             AND SHPO.PO_NBR          = PKSL.PO_NBR               25860099
257000             AND SHPO.REC_SEQ_NBR     = PKSL.REC_SEQ_NBR          25870099
257100             AND SHMT.TRIP_ID         = :SHIPMT-TRIP-ID           25880099
257200             AND SHMT.SHIPT_ID        = SHPO.SHIPT_ID             25890099
257300             AND SHMT.BOL_NBR         = PKSL.BOL_NBR              25900099
257400     END-EXEC.                                                    25910099
257500*                                                                 25920099
257600     EVALUATE TRUE                                                25930099
257700         WHEN SQLCODE = ZERO                                      25940099
257800              IF IMCNTK-DVN-TMST = PC-DEFAULT-TMST                25950099
257900               MOVE SPACES TO ASC-CTDV (ASC-BLK-SUB ASC-ITEM-SUB) 25960099
258000              ELSE                                                25970099
258100               MOVE IMCNTK-DVN-TMST(9:2) TO PV-DATE-DAY           25980099
258200               MOVE IMCNTK-DVN-TMST(6:2) TO PV-DATE-MONTH         25990099
258300               MOVE '/'                  TO PV-DATE-SLASH         26000099
258400               MOVE PV-DATE              TO ASC-CTDV              26010099
258500                                     (ASC-BLK-SUB ASC-ITEM-SUB)   26020099
258600              END-IF                                              26030099
258700         WHEN SQLCODE = +100                                      26040099
258800         WHEN SQLCODE = -305                                      26050099
258900              MOVE SPACES TO ASC-CTDV  (ASC-BLK-SUB ASC-ITEM-SUB) 26060099
259000         WHEN SQLWARN0 NOT = SPACE                                26070099
259100         WHEN SQLCODE NOT = ZERO                                  26080099
259200              MOVE '4390-SELECT-CONTR-DEVAN-DATE'                 26090099
259300                               TO DP013-PARAGRAPH                 26100099
259400              MOVE 'SQL ERROR SELECTING DEVAN DATE'               26110099
259500                               TO DP013-MESSAGE-TEXT (1)          26120099
259600              MOVE SQLCA       TO DP013-SQLCA                     26130099
259700              MOVE 'TIMCNTK '   TO DP013-DB2-TABLE-NAME (1)       26140099
259800              SET DP013-DB2-ABEND                                 26150099
259900                               TO TRUE                            26160099
260000              PERFORM DP013-0000-PROCESS-ABEND                    26170099
260100     END-EVALUATE.                                                26180099
260200                                                                  26190099
260300 EJECT                                                            26200099
260400*----------------------------------------------------------------*26210099
260500*      SELECT TRLR AVAIL DATE FROM SHIPST                        *26220099
260600*----------------------------------------------------------------*26230099
260700 4391-SELECT-TRLR-AVAIL-DATE.                                     26240099
260800                                                                  26250099
260900     EXEC SQL                                                     26260099
261000         SELECT DISTINCT                                          26270099
261100                MIN(C.STATUS_DTE)                                 26280099
261200         INTO   :SHIPST-STATUS-DTE:PV-STATUS-DTE-NULL             26290099
261300         FROM   TSHPTPO A                                         26300099
261400               ,TSHIPMT B                                         26310099
261500               ,TSHIPST C                                         26320099
261600         WHERE  B.TRIP_ID       = :DK-TRIP-ID                     26330099
261700           AND  A.PO_NBR        = :DK-PO-NBR                      26340099
261800           AND  A.SHIPT_ID      = B.SHIPT_ID                      26350099
261900           AND  A.SHIPT_ID      = C.SHIPT_ID                      26360099
262000           AND  C.SHIPT_STATUS_CDE = :PC-AJ                       26370099
262100     END-EXEC.                                                    26380099
262200*                                                                 26390099
262300     EVALUATE TRUE                                                26400099
262400         WHEN SQLCODE = ZERO                                      26410099
262500              IF PV-STATUS-DTE-NULL = PC-NEG-1                    26420099
262600               MOVE SPACES TO ASC-TRAV (ASC-BLK-SUB ASC-ITEM-SUB) 26430099
262700              ELSE                                                26440099
262800               MOVE SHIPST-STATUS-DTE(9:2) TO PV-DATE-DAY         26450099
262900               MOVE SHIPST-STATUS-DTE(6:2) TO PV-DATE-MONTH       26460099
263000               MOVE '/'                    TO PV-DATE-SLASH       26470099
263100               MOVE PV-DATE                TO ASC-TRAV            26480099
263200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 26490099
263300              END-IF                                              26500099
263400         WHEN SQLCODE = +100                                      26510099
263500              MOVE SPACES TO ASC-TRAV  (ASC-BLK-SUB ASC-ITEM-SUB) 26520099
263600         WHEN SQLWARN0 NOT = SPACE                                26530099
263700         WHEN SQLCODE NOT = ZERO                                  26540099
263800              MOVE '4391-SELECT-TRLR-AVAIL-DATE'                  26550099
263900                               TO DP013-PARAGRAPH                 26560099
264000              MOVE 'SQL ERROR SELECTING TRL AVAIL DATE'           26570099
264100                               TO DP013-MESSAGE-TEXT (1)          26580099
264200              MOVE SQLCA       TO DP013-SQLCA                     26590099
264300              MOVE 'TSHIPST '   TO DP013-DB2-TABLE-NAME (1)       26600099
264400              SET DP013-DB2-ABEND                                 26610099
264500                               TO TRUE                            26620099
264600              PERFORM DP013-0000-PROCESS-ABEND                    26630099
264700     END-EVALUATE.                                                26640099
264800                                                                  26650099
264900 EJECT                                                            26660099
265000*----------------------------------------------------------------*26670099
265100*      SELECT TRLR PCKUP DATE FROM SHIPST                        *26680099
265200*----------------------------------------------------------------*26690099
265300 4392-SELECT-TRLR-PCKUP-DATE.                                     26700099
265400                                                                  26710099
265500     EXEC SQL                                                     26720099
265600         SELECT DISTINCT                                          26730099
265700                MIN(C.STATUS_DTE)                                 26740099
265800         INTO   :SHIPST-STATUS-DTE:PV-STATUS-DTE-NULL             26750099
265900         FROM   TSHPTPO A                                         26760099
266000               ,TSHIPMT B                                         26770099
266100               ,TSHIPST C                                         26780099
266200         WHERE  B.TRIP_ID       = :DK-TRIP-ID                     26790099
266300           AND  A.PO_NBR        = :DK-PO-NBR                      26800099
266400           AND  A.SHIPT_ID      = B.SHIPT_ID                      26810099
266500           AND  A.SHIPT_ID      = C.SHIPT_ID                      26820099
266600           AND  C.SHIPT_STATUS_CDE = :PV-STATUS-CDE               26830099
266700     END-EXEC.                                                    26840099
266800*                                                                 26850099
266900     EVALUATE TRUE                                                26860099
267000         WHEN SQLCODE = ZERO                                      26870099
267100              IF PV-STATUS-DTE-NULL = PC-NEG-1                    26880099
267200               MOVE SPACES TO ASC-TRPU (ASC-BLK-SUB ASC-ITEM-SUB) 26890099
267300              ELSE                                                26900099
267400               MOVE SHIPST-STATUS-DTE(9:2) TO PV-DATE-DAY         26910099
267500               MOVE SHIPST-STATUS-DTE(6:2) TO PV-DATE-MONTH       26920099
267600               MOVE '/'                    TO PV-DATE-SLASH       26930099
267700               MOVE PV-DATE                TO ASC-TRPU            26940099
267800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 26950099
267900              END-IF                                              26960099
268000         WHEN SQLCODE = +100                                      26970099
268100              MOVE SPACES TO ASC-TRPU  (ASC-BLK-SUB ASC-ITEM-SUB) 26980099
268200         WHEN SQLWARN0 NOT = SPACE                                26990099
268300         WHEN SQLCODE NOT = ZERO                                  27000099
268400              MOVE '4392-SELECT-TRLR-PCKUP-DATE'                  27010099
268500                               TO DP013-PARAGRAPH                 27020099
268600              MOVE 'SQL ERROR SELECTING TRL PICKUP DATE'          27030099
268700                               TO DP013-MESSAGE-TEXT (1)          27040099
268800              MOVE SQLCA       TO DP013-SQLCA                     27050099
268900              MOVE 'TSHIPST '   TO DP013-DB2-TABLE-NAME (1)       27060099
269000              SET DP013-DB2-ABEND                                 27070099
269100                               TO TRUE                            27080099
269200              PERFORM DP013-0000-PROCESS-ABEND                    27090099
269300     END-EVALUATE.                                                27100099
269400                                                                  27110099
269500 EJECT                                                            27120099
269600*----------------------------------------------------------------*27130099
269700*      CHECK TO SEE OF THERE ARE MULTIPLE SHIPMENTS              *27140099
269800*----------------------------------------------------------------*27150099
269900 4393-CHECK-FOR-MULT-SHIPS.                                       27160099
270000                                                                  27170099
270100     EXEC SQL                                                     27180099
270200         SELECT COUNT(*)                                          27190099
270300         INTO   :PV-SHIP-CNT:PV-SHIP-CNT-NULL                     27200099
270400         FROM   TSHPTPO A                                         27210099
270500               ,TSHIPMT B                                         27220099
270600         WHERE  A.PO_NBR        = :DK-PO-NBR                      27230099
270700           AND  A.SHIPT_ID      =  B.SHIPT_ID                     27240099
270800           AND  B.TRIP_ID       = :DK-TRIP-ID                     27250099
270900     END-EXEC.                                                    27260099
271000*                                                                 27270099
271100     EVALUATE TRUE                                                27280099
271200         WHEN SQLCODE = ZERO                                      27290099
271300              IF PV-SHIP-CNT-NULL = PC-NEG-1                      27300099
271400                 MOVE PC-N    TO ASC-SHIP                         27310099
271500                                 (ASC-BLK-SUB ASC-ITEM-SUB)       27320099
271600              ELSE                                                27330099
271700                 IF PV-SHIP-CNT > 1                               27340099
271800                    MOVE PC-Y TO ASC-SHIP                         27350099
271900                                 (ASC-BLK-SUB ASC-ITEM-SUB)       27360099
272000                 ELSE                                             27370099
272100                    MOVE PC-N TO ASC-SHIP                         27380099
272200                                 (ASC-BLK-SUB ASC-ITEM-SUB)       27390099
272300                 END-IF                                           27400099
272400              END-IF                                              27410099
272500         WHEN SQLCODE = -305                                      27420099
272600              MOVE PC-N TO ASC-SHIP  (ASC-BLK-SUB ASC-ITEM-SUB)   27430099
272700         WHEN SQLWARN0 NOT = SPACE                                27440099
272800         WHEN SQLCODE NOT = ZERO                                  27450099
272900              MOVE '4393-CHECK-FOR-MULT-SHIPS'                    27460099
273000                               TO DP013-PARAGRAPH                 27470099
273100              MOVE 'SQL ERROR SELECTING TRL PICKUP DATE'          27480099
273200                               TO DP013-MESSAGE-TEXT (1)          27490099
273300              MOVE SQLCA       TO DP013-SQLCA                     27500099
273400              MOVE 'TSHPTPO '   TO DP013-DB2-TABLE-NAME (1)       27510099
273500              SET DP013-DB2-ABEND                                 27520099
273600                               TO TRUE                            27530099
273700              PERFORM DP013-0000-PROCESS-ABEND                    27540099
273800     END-EVALUATE.                                                27550099
273900                                                                  27560099
274000 EJECT                                                            27570099
274100*----------------------------------------------------------------*27580099
274200*      SELECT ATA FROM SHIPST                                    *27590099
274300*----------------------------------------------------------------*27600099
274400 4396-SELECT-ATA.                                                 27610099
274500                                                                  27620099
274600     EXEC SQL                                                     27630099
274700         SELECT DISTINCT                                          27640099
274800                MIN(C.STATUS_DTE)                                 27650099
274900         INTO   :SHIPST-STATUS-DTE:PV-STATUS-DTE-NULL             27660099
275000         FROM   TSHPTPO A                                         27670099
275100               ,TSHIPMT B                                         27680099
275200               ,TSHIPST C                                         27690099
275300         WHERE  B.TRIP_ID       = :DK-TRIP-ID                     27700099
275400           AND  A.PO_NBR        = :DK-PO-NBR                      27710099
275500           AND  A.SHIPT_ID      = B.SHIPT_ID                      27720099
275600           AND  A.SHIPT_ID      = C.SHIPT_ID                      27730099
275700           AND  C.SHIPT_STATUS_CDE = :PC-AR                       27740099
275800     END-EXEC.                                                    27750099
275900*                                                                 27760099
276000     EVALUATE TRUE                                                27770099
276100         WHEN SQLCODE = ZERO                                      27780099
276200              IF PV-STATUS-DTE-NULL = PC-NEG-1                    27790099
276300               MOVE SPACES TO ASC-ATA  (ASC-BLK-SUB ASC-ITEM-SUB) 27800099
276400              ELSE                                                27810099
276500               MOVE SHIPST-STATUS-DTE(9:2) TO PV-DATE-DAY         27820099
276600               MOVE SHIPST-STATUS-DTE(6:2) TO PV-DATE-MONTH       27830099
276700               MOVE '/'                    TO PV-DATE-SLASH       27840099
276800               MOVE PV-DATE                TO ASC-ATA             27850099
276900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 27860099
277000              END-IF                                              27870099
277100         WHEN SQLCODE = +100                                      27880099
277200              MOVE SPACES TO ASC-ATA   (ASC-BLK-SUB ASC-ITEM-SUB) 27890099
277300         WHEN SQLWARN0 NOT = SPACE                                27900099
277400         WHEN SQLCODE NOT = ZERO                                  27910099
277500              MOVE '4396-SELECT-ATA'                              27920099
277600                               TO DP013-PARAGRAPH                 27930099
277700              MOVE 'SQL ERROR SELECTING ARRIVAL DATE'             27940099
277800                               TO DP013-MESSAGE-TEXT (1)          27950099
277900              MOVE SQLCA       TO DP013-SQLCA                     27960099
278000              MOVE 'TSHIPST '   TO DP013-DB2-TABLE-NAME (1)       27970099
278100              SET DP013-DB2-ABEND                                 27980099
278200                               TO TRUE                            27990099
278300              PERFORM DP013-0000-PROCESS-ABEND                    28000099
278400     END-EVALUATE.                                                28010099
278500                                                                  28020099
278600 EJECT                                                            28030099
278700*----------------------------------------------------------------*28040099
278800* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *28050099
278900*----------------------------------------------------------------*28060099
279000 4400-MOVE-COMMAREA-TO-SCREEN.                                    28070099
279100                                                                  28080099
279200     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             28090099
279300         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          28100099
279400         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          28110099
279500             MOVE +1    TO ASC-BLK-SUB                            28120099
279600             PERFORM 5100-WRITE-TEMP-STORAGE                      28130099
279700             ADD +1     TO ASC-BLK-SUB                            28140099
279800             PERFORM 5100-WRITE-TEMP-STORAGE                      28150099
279900             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             28160099
280000                 GIVING PV-BLOCK-NUMBER                           28170099
280100                 REMAINDER PV-REMAINDER                           28180099
280200             IF  PV-REMAINDER > ZERO                              28190099
280300                 ADD +1 TO PV-BLOCK-NUMBER                        28200099
280400             END-IF                                               28210099
280500             MOVE +1    TO ASC-BLK-SUB                            28220099
280600             PERFORM 4410-READ-TEMP-STORAGE                       28230099
280700             ADD +1     TO ASC-BLK-SUB                            28240099
280800                           PV-BLOCK-NUMBER                        28250099
280900             PERFORM 4410-READ-TEMP-STORAGE                       28260099
281000     END-IF.                                                      28270099
281100     MOVE +1            TO ASC-BLK-SUB.                           28280099
281200     COMPUTE ASC-ITEM-SUB =                                       28290099
281300         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              28300099
281400         + PC-ITEMS-PER-PANEL).                                   28310099
281500*                                                                 28320099
281600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        28330099
281700         ADD +1         TO ASC-BLK-SUB                            28340099
281800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            28350099
281900     END-IF.                                                      28360099
282000*                                                                 28370099
282100     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           28380099
282200         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                28390099
282300     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        28400099
282400     PERFORM 4420-FORMAT-LIST-LINES                               28410099
282500         VARYING PV-SUB                                           28420099
282600         FROM PC-ITEMS-PER-PANEL BY -1                            28430099
282700         UNTIL PV-SUB < +1.                                       28440099
282800*                                                                 28450099
282900     COMPUTE ASC-ITEMS-DISPLAYED =                                28460099
283000         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          28470099
283100     PERFORM 4401-SELECT-PO-DETAILS.                              28480099
283200     PERFORM 4402-SELECT-AD-DTE.                                  28490099
283300     PERFORM 4403-SELECT-VND-STYL.                                28500099
283400     MOVE SPACES TO ASC-OUTR-PACK-X.                              28510099
283500     MOVE 0 TO ASC-OUTR-PACK.                                     28520099
283600     PERFORM 4404-OPEN-OUTR-PCK-CSR.                              28530099
283700     PERFORM 4405-FETCH-OUTR-PCK.                                 28540099
283800     PERFORM 4406-CLOSE-OUTR-PCK-CSR.                             28550099
283900     PERFORM 4407-MOVE-PO-DTLS-TO-SCR.                            28560099
284000*                                                                 28570099
284100     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    28580099
284200                                      ASTRTITO.                   28590099
284300     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    28600099
284400     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    28610099
284500     MOVE ASC-TOT-CARTONS          TO ATOTCNTO.                   28620099
284600*    MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            28630099
284700*                                  TO ASELITO.                    28640099
284800*                                                                 28650099
284900     IF  DP020-MSG-NUMBER-X = SPACE                               28660099
285000         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  28670099
285100*----------- MORE ITEMS TO DISPLAY --------                       28680099
285200             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            28690099
285300             SET DP020-MSG-INFORMATIONAL TO TRUE                  28700099
285400         END-IF                                                   28710099
285500     END-IF.                                                      28720099
285600                                                                  28730099
285700 EJECT                                                            28740099
285800*----------------------------------------------------------------*28750099
285900*    SELECT PO DETAILS.                                          *28760099
286000*----------------------------------------------------------------*28770099
286100 4401-SELECT-PO-DETAILS.                                          28780099
286200                                                                  28790099
286300     PERFORM                                                      28800099
286400         WITH TEST AFTER                                          28810099
286500         VARYING PV-RETRY-COUNTER                                 28820099
286600         FROM 1 BY 1                                              28830099
286700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               28840099
286800            OR  (SQLCODE = ZERO)                                  28850099
286900            OR  (SQLCODE = +100))                                 28860099
287000                                                                  28870099
287100         EXEC SQL                                                 28880099
287200              SELECT A.DEPT_NBR,                                  28890099
287300                     A.OTB_PER_NBR,                               28900099
287400                     A.TOT_UNT_QTY,                               28910099
287500                     A.PROD_CNTRY_CDE,                            28920099
287600                     B.ENT_NAME_DESC,                             28930099
287700                     C.CAN_IFNOT_SHIP_DTE,                        28940099
287800                     C.EXT_CAN_DTE,                               28950099
287900                     C.STRT_FCTRY_DTE,                            28960099
288000                     C.LAST_FCTRY_DTE,                            28970099
288100                     C.DONT_SHIP_BEF_DTE,                         28980099
288200                     C.FOB_CDE,                                   28990099
288300                     C.POE_CDE                                    29000099
288400              INTO  :PURCHS-DEPT-NBR,                             29010099
288500                    :PURCHS-OTB-PER-NBR,                          29020099
288600                    :PURCHS-TOT-UNT-QTY,                          29030099
288700                    :PURCHS-PROD-CNTRY-CDE,                       29040099
288800                    :ENTNME-ENT-NAME-DESC,                        29050099
288900                    :PLNSHP-CAN-IFNOT-SHIP-DTE,                   29060099
289000                    :PLNSHP-EXT-CAN-DTE,                          29070099
289100                    :PLNSHP-STRT-FCTRY-DTE,                       29080099
289200                    :PLNSHP-LAST-FCTRY-DTE,                       29090099
289300                    :PLNSHP-DONT-SHIP-BEF-DTE,                    29100099
289400                    :PLNSHP-FOB-CDE,                              29110099
289500                    :PLNSHP-POE-CDE                               29120099
289600              FROM   TPURCHS A,                                   29130099
289700                     TENTNME B,                                   29140099
289800                     TPLNSHP C                                    29150099
289900              WHERE  A.PO_NBR         = :DK-PO-NBR                29160099
290000                AND  A.VER_STATUS_CDE = 'A'                       29170099
290100                AND  B.ENT_ID         =  A.ENT_ID                 29180099
290200                AND  B.TYPE_CDE       = '01'                      29190099
290300                AND  C.PO_NBR         =  A.PO_NBR                 29200099
290400                AND  C.VER_STATUS_CDE =  A.VER_STATUS_CDE         29210099
290500         END-EXEC                                                 29220099
290600*                                                                 29230099
290700         EVALUATE TRUE                                            29240099
290800             WHEN SQLCODE = ZERO                                  29250099
290900             WHEN SQLCODE = +100                                  29260099
291000             WHEN SQLCODE = -904                                  29270099
291100             WHEN SQLCODE = -913                                  29280099
291200                 CONTINUE                                         29290099
291300             WHEN SQLWARN0 NOT = SPACES                           29300099
291400             WHEN SQLCODE < ZERO                                  29310099
291500             WHEN SQLCODE > ZERO                                  29320099
291600                 MOVE '4401-SELECT-PO-DETAILS'                    29330099
291700                                   TO DP013-PARAGRAPH             29340099
291800                 MOVE 'SQL ERROR SELECTING PO DETAILS'            29350099
291900                                   TO DP013-MESSAGE-TEXT (1)      29360099
292000                 MOVE SQLCA        TO DP013-SQLCA                 29370099
292100                 MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)    29380099
292200                 SET DP013-DB2-ABEND                              29390099
292300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           29400099
292400                 PERFORM DP013-0000-PROCESS-ABEND                 29410099
292500         END-EVALUATE                                             29420099
292600     END-PERFORM.                                                 29430099
292700*                                                                 29440099
292800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        29450099
292900         MOVE '4401-SELECT-PO-DETAILS'    TO DP013-PARAGRAPH      29460099
293000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  29470099
293100                                   TO DP013-MESSAGE-TEXT (1)      29480099
293200         MOVE SQLCA                TO DP013-SQLCA                 29490099
293300         MOVE 'TPURCHS '           TO DP013-DB2-TABLE-NAME (1)    29500099
293400         SET DP013-DB2-ABEND                                      29510099
293500             DP013-XCTL-DISPLAY-RESTART                           29520099
293600                                   TO TRUE                        29530099
293700         PERFORM DP013-0000-PROCESS-ABEND                         29540099
293800     END-IF.                                                      29550099
293900                                                                  29560099
294000 EJECT                                                            29570099
294100*----------------------------------------------------------------*29580099
294200*     SELECT AD-DTE FROM TPURITM                                 *29590099
294300*----------------------------------------------------------------*29600099
294400 4402-SELECT-AD-DTE.                                              29610099
294500                                                                  29620099
294600     PERFORM                                                      29630099
294700         WITH TEST AFTER                                          29640099
294800         VARYING PV-RETRY-COUNTER                                 29650099
294900         FROM 1 BY 1                                              29660099
295000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               29670099
295100         OR     (SQLCODE = ZERO)                                  29680099
295200         OR     (SQLCODE = +100))                                 29690099
295300                                                                  29700099
295400         EXEC SQL                                                 29710099
295500              SELECT                                              29720099
295600                     MIN(AD_EVNT_DTE)                             29730099
295700              INTO  :PURITM-AD-EVNT-DTE :PV-AD-DTE-IND            29740099
295800              FROM   TPURITM                                      29750099
295900              WHERE  PO_NBR         = :DK-PO-NBR                  29760099
296000              AND    VER_STATUS_CDE = 'A'                         29770099
296100              AND    AD_EVNT_DTE   ^= '0001-01-01'                29780099
296200         END-EXEC                                                 29790099
296300*                                                                 29800099
296400         EVALUATE TRUE                                            29810099
296500             WHEN SQLCODE = ZERO                                  29820099
296600             WHEN SQLCODE = +100                                  29830099
296700             WHEN SQLCODE = -904                                  29840099
296800             WHEN SQLCODE = -913                                  29850099
296900                  CONTINUE                                        29860099
297000             WHEN SQLWARN0 NOT = SPACE                            29870099
297100             WHEN SQLCODE NOT = ZERO                              29880099
297200                  MOVE '4402-SELECT-AD-DTE'                       29890099
297300                                   TO DP013-PARAGRAPH             29900099
297400                  MOVE 'SQL ERROR SELECTING AD DATE'              29910099
297500                                   TO DP013-MESSAGE-TEXT (1)      29920099
297600                  MOVE SQLCA       TO DP013-SQLCA                 29930099
297700                  MOVE 'TPURITM '  TO DP013-DB2-TABLE-NAME (1)    29940099
297800                  SET DP013-DB2-ABEND                             29950099
297900                      DP013-XCTL-DISPLAY-RESTART TO TRUE          29960099
298000                  PERFORM DP013-0000-PROCESS-ABEND                29970099
298100         END-EVALUATE                                             29980099
298200     END-PERFORM.                                                 29990099
298300*                                                                 30000099
298400     IF SQLCODE EQUAL + 0                                         30010099
298500        MOVE PURITM-AD-EVNT-DTE    TO PV-DATE-BREAK               30020099
298600        PERFORM 4320-FORMAT-DATE                                  30030099
298700        MOVE PV-DATE-DISPLAY       TO AADDTO                      30040099
298800     ELSE                                                         30050099
298900        MOVE SPACES                TO AADDTO                      30060099
299000     END-IF.                                                      30070099
299100*                                                                 30080099
299200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        30090099
299300         MOVE '4402-SELECT-AD-DTE' TO DP013-PARAGRAPH             30100099
299400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT AD-DA30110099
299500-             'TE'                 TO DP013-MESSAGE-TEXT (1)      30120099
299600         MOVE SQLCA                TO DP013-SQLCA                 30130099
299700         MOVE 'TPURITM '           TO DP013-DB2-TABLE-NAME (1)    30140099
299800         SET DP013-DB2-ABEND                                      30150099
299900             DP013-XCTL-DISPLAY-RESTART                           30160099
300000                                   TO TRUE                        30170099
300100         PERFORM DP013-0000-PROCESS-ABEND                         30180099
300200     END-IF.                                                      30190099
300300                                                                  30200099
300400 EJECT                                                            30210099
300410*----------------------------------------------------------------*30220099
300420*     SELECT VENDOR STYLE NAME FROM XLT_VND_STYL TABLE           *30230099
300430*----------------------------------------------------------------*30240099
300440 4403-SELECT-VND-STYL.                                            30250099
300450                                                                  30260099
300460     PERFORM                                                      30270099
300470         WITH TEST AFTER                                          30280099
300480         VARYING PV-RETRY-COUNTER                                 30290099
300490         FROM 1 BY 1                                              30300099
300491         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               30310099
300492            OR  (SQLCODE = ZERO)                                  30320099
300493            OR  (SQLCODE = +100)                                  30330099
300494            OR  (SQLCODE = -811))                                 30340099
300495                                                                  30350099
300496         EXEC SQL                                                 30360099
300497              SELECT   DISTINCT                                   30370099
300498                       VS_NBR                                     30380099
300499                INTO   :XLT00004-VS-NBR                           30390099
300500                FROM   TPURITM A                                  30400099
300501                   ,   XLT_SKU B                                  30410099
300502                   ,   XLT_VND_STYL C                             30420099
300503               WHERE   A.PO_NBR       = :DK-PO-NBR                30430099
300504                 AND   A.VER_STATUS_CDE = 'A'                     30440099
300505                 AND   A.ITM_NBR = B.ITM_NBR                      30450099
300506                 AND   B.STYL_ID = C.STYL_ID                      30460099
300507         END-EXEC                                                 30470099
300508                                                                  30480099
300509         EVALUATE TRUE                                            30490099
300510             WHEN SQLCODE = ZERO                                  30500099
300511             WHEN SQLCODE = +100                                  30510099
300512             WHEN SQLCODE = -811                                  30520099
300513             WHEN SQLCODE = -904                                  30530099
300514             WHEN SQLCODE = -913                                  30540099
300515                 CONTINUE                                         30550099
300516             WHEN SQLWARN0 NOT = SPACES                           30560099
300517             WHEN SQLCODE < ZERO                                  30570099
300518             WHEN SQLCODE > ZERO                                  30580099
300519                 MOVE '4403-SELECT-VND-STYL'                      30590099
300520                                     TO DP013-PARAGRAPH           30600099
300521                 MOVE 'SQL ERROR SELECTING VENDOR STYLE'          30610099
300522                                     TO DP013-MESSAGE-TEXT (1)    30620099
300523                 MOVE SQLCA          TO DP013-SQLCA               30630099
300524                 MOVE 'XLT_VND_STYL' TO DP013-DB2-TABLE-NAME (1)  30640099
300525                 SET DP013-DB2-ABEND                              30650099
300526                     DP013-XCTL-DISPLAY-RESTART TO TRUE           30660099
300527                 PERFORM DP013-0000-PROCESS-ABEND                 30670099
300528         END-EVALUATE                                             30680099
300529     END-PERFORM.                                                 30690099
300530*                                                                 30700099
300531     IF  SQLCODE EQUAL +0                                         30710099
300532         MOVE XLT00004-VS-NBR       TO AVNDSTYO                   30720099
300533     ELSE                                                         30730099
300534         IF  SQLCODE EQUAL -811                                   30740099
300535             MOVE '*MULTIPLES*'     TO AVNDSTYO                   30750099
300536         END-IF                                                   30760099
300537     END-IF.                                                      30770099
300538*                                                                 30780099
300539     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        30790099
300540         MOVE '4403-SELECT-VND-STYL'    TO DP013-PARAGRAPH        30800099
300541         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT VENDO30810099
300542-             'R STYLE'            TO DP013-MESSAGE-TEXT (1)      30820099
300543         MOVE SQLCA                TO DP013-SQLCA                 30830099
300544         MOVE 'XLT_VND_STYL'       TO DP013-DB2-TABLE-NAME (1)    30840099
300545         SET DP013-DB2-ABEND                                      30850099
300546             DP013-XCTL-DISPLAY-RESTART                           30860099
300547                                   TO TRUE                        30870099
300548         PERFORM DP013-0000-PROCESS-ABEND                         30880099
300549     END-IF.                                                      30890099
300550                                                                  30900099
300551 EJECT                                                            30910099
307000*----------------------------------------------------------------*30920099
307100*     OPEN THE OUTER PACK CURSOR                                 *30930099
307200*----------------------------------------------------------------*30940099
307300 4404-OPEN-OUTR-PCK-CSR.                                          30950099
307400                                                                  30960099
307500     PERFORM                                                      30970099
307600         WITH TEST AFTER                                          30980099
307700         VARYING PV-RETRY-COUNTER                                 30990099
307800         FROM 1 BY 1                                              31000099
307900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               31010099
308000            OR  (SQLCODE = ZERO))                                 31020099
308100                                                                  31030099
308200         MOVE 'CURSOR:  OUTR-PCK-CSR' TO DP013-MESSAGE-TEXT (2)   31040099
308300                                                                  31050099
308400         EXEC SQL                                                 31060099
308500              OPEN OUTR-PCK-CSR                                   31070099
308600         END-EXEC                                                 31080099
308700*                                                                 31090099
308800         EVALUATE TRUE                                            31100099
308900             WHEN SQLCODE = ZERO                                  31110099
309000             WHEN SQLCODE = -904                                  31120099
309100             WHEN SQLCODE = -913                                  31130099
309200                 CONTINUE                                         31140099
309300             WHEN SQLWARN0 NOT = SPACES                           31150099
309400             WHEN SQLCODE < ZERO                                  31160099
309500             WHEN SQLCODE > ZERO                                  31170099
309600                 MOVE '4404-OPEN-OUTR-PCK-CSR'                    31180099
309700                                   TO DP013-PARAGRAPH             31190099
309800                 MOVE 'OPEN OUTER-PACK CURSOR - '                 31200099
309900                                   TO DP013-MESSAGE-TEXT (1)      31210099
310000                 MOVE SQLCA        TO DP013-SQLCA                 31220099
310100                 MOVE 'TUPC   '   TO DP013-DB2-TABLE-NAME (1)     31230099
310200                 SET DP013-DB2-ABEND                              31240099
310300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           31250099
310400                 PERFORM DP013-0000-PROCESS-ABEND                 31260099
310500         END-EVALUATE                                             31270099
310600     END-PERFORM.                                                 31280099
310700*                                                                 31290099
310800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        31300099
310900         MOVE '4404-OPEN-OUTR-PCK-CSR'   TO DP013-PARAGRAPH       31310099
311000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   31320099
311100                                   TO DP013-MESSAGE-TEXT (1)      31330099
311200         MOVE SQLCA                TO DP013-SQLCA                 31340099
311300         MOVE 'TUPC    '           TO DP013-DB2-TABLE-NAME (1)    31350099
311400         SET DP013-DB2-ABEND                                      31360099
311500             DP013-XCTL-DISPLAY-RESTART                           31370099
311600                                   TO TRUE                        31380099
311700         PERFORM DP013-0000-PROCESS-ABEND                         31390099
311800     END-IF.                                                      31400099
311900                                                                  31410099
312000 EJECT                                                            31420099
312100*----------------------------------------------------------------*31430099
312200*     FETCH THE OUTER PACK QUANTITY                              *31440099
312300*----------------------------------------------------------------*31450099
312400 4405-FETCH-OUTR-PCK.                                             31460099
312500                                                                  31470099
312600     PERFORM                                                      31480099
312700         WITH TEST AFTER                                          31490099
312800         VARYING PV-RETRY-COUNTER                                 31500099
312900         FROM 1 BY 1                                              31510099
313000         UNTIL (SQLCODE = +100)                                   31520099
313100                                                                  31530099
313200         EXEC SQL                                                 31540099
313300              FETCH OUTR-PCK-CSR                                  31550099
313400              INTO  :PURITM-UNT-QTY                               31560099
313500                 ,  :PURITM-OUTR-PK-QTY                           31570099
313600         END-EXEC                                                 31580099
313700*                                                                 31590099
313800         EVALUATE TRUE                                            31600099
313900             WHEN SQLCODE = ZERO                                  31610099
314000             WHEN SQLCODE = +100                                  31620099
314100                  CONTINUE                                        31630099
314200             WHEN SQLWARN0 NOT = SPACE                            31640099
314300             WHEN SQLCODE NOT = ZERO                              31650099
314400                  MOVE '4405-FETCH-OUTR-PCK'                      31660099
314500                                   TO DP013-PARAGRAPH             31670099
314600                  MOVE 'FETCH OUTER-PACK CURSOR'                  31680099
314700                                   TO DP013-MESSAGE-TEXT (1)      31690099
314800                  MOVE SQLCA       TO DP013-SQLCA                 31700099
314900                  SET DP013-DB2-ABEND                             31710099
315000                                   TO TRUE                        31720099
315100                  PERFORM DP013-0000-PROCESS-ABEND                31730099
315200         END-EVALUATE                                             31740099
315300*                                                                 31750099
315400         IF  SQLCODE EQUAL +0                                     31760099
315500             IF PURITM-OUTR-PK-QTY NOT = ASC-OUTR-PACK            31770099
315600                IF ASC-OUTR-PACK = 0                              31780099
315700                   MOVE PURITM-OUTR-PK-QTY TO ASC-OUTR-PACK       31790099
315800                ELSE                                              31800099
315900                   MOVE PC-MULTI TO ASC-OUTR-PACK-X               31810099
316000                END-IF                                            31820099
316100             END-IF                                               31830099
316200             IF PURITM-OUTR-PK-QTY = 0                            31840099
316300                DIVIDE 1 INTO PURITM-UNT-QTY                      31850099
316400                GIVING PV-ITEM-CART-CNT ROUNDED                   31860099
316500             ELSE                                                 31870099
316600                DIVIDE PURITM-OUTR-PK-QTY INTO PURITM-UNT-QTY     31880099
316700                GIVING PV-ITEM-CART-CNT ROUNDED                   31890099
316800             END-IF                                               31900099
316900             ADD PV-ITEM-CART-CNT TO PV-PO-CART-CNT               31910099
317000         END-IF                                                   31920099
317100     END-PERFORM.                                                 31930099
317200                                                                  31940099
317300 EJECT                                                            31950099
317400*----------------------------------------------------------------*31960099
317500*     CLOSE THE OUTER PACK CURSOR                                *31970099
317600*----------------------------------------------------------------*31980099
317700 4406-CLOSE-OUTR-PCK-CSR.                                         31990099
317800                                                                  32000099
317900     EXEC SQL                                                     32010099
318000          CLOSE OUTR-PCK-CSR                                      32020099
318100     END-EXEC.                                                    32030099
318200*                                                                 32040099
318300     EVALUATE TRUE                                                32050099
318400         WHEN SQLCODE = ZERO                                      32060099
318500             CONTINUE                                             32070099
318600         WHEN SQLWARN0 NOT = SPACES                               32080099
318700         WHEN SQLCODE < ZERO                                      32090099
318800         WHEN SQLCODE > ZERO                                      32100099
318900             MOVE '4406-CLOSE-OUTR-PCK-CSR'                       32110099
319000                               TO DP013-PARAGRAPH                 32120099
319100             MOVE 'CLOSE OUTER-PACK CURSOR '                      32130099
319200                               TO DP013-MESSAGE-TEXT (1)          32140099
319300             MOVE SQLCA        TO DP013-SQLCA                     32150099
319400             MOVE 'TUPC    '   TO DP013-DB2-TABLE-NAME (1)        32160099
319500             SET DP013-DB2-ABEND                                  32170099
319600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               32180099
319700             PERFORM DP013-0000-PROCESS-ABEND                     32190099
319800     END-EVALUATE.                                                32200099
319900                                                                  32210099
320000 EJECT                                                            32220099
320100*----------------------------------------------------------------*32230099
320200*    MOVE PO DETAILS TO SCREEN.                                  *32240099
320300*----------------------------------------------------------------*32250099
320400 4407-MOVE-PO-DTLS-TO-SCR.                                        32260099
320500                                                                  32270099
320600     MOVE ASC-KEY-PO-NBR            TO APONBRO.                   32280099
320700     MOVE PURCHS-DEPT-NBR           TO PV-DEPT-NBR-N.             32290099
320800     MOVE PV-DEPT-NBR-N             TO ADEPTO.                    32300099
320900     MOVE PURCHS-OTB-PER-NBR        TO AOTBO.                     32310099
321000     MOVE PURCHS-TOT-UNT-QTY        TO AUNTSO.                    32320099
321100     MOVE PURCHS-PROD-CNTRY-CDE     TO ACNTRYO.                   32330099
321200     MOVE ENTNME-ENT-NAME-DESC      TO AVNDNMEO.                  32340099
321300     MOVE PLNSHP-FOB-CDE            TO AFOBO.                     32350099
321400     MOVE PLNSHP-POE-CDE            TO APOEO.                     32360099
321500     MOVE PV-PO-CART-CNT            TO ACTNSO.                    32370099
321600*                                                                 32380099
321700     IF PLNSHP-CAN-IFNOT-SHIP-DTE   =  PC-INIT-DATE               32390099
321800        MOVE SPACES                 TO ACANDTO                    32400099
321900     ELSE                                                         32410099
322000        MOVE PLNSHP-CAN-IFNOT-SHIP-DTE                            32420099
322100                                    TO PV-DATE-BREAK              32430099
322200        PERFORM 4320-FORMAT-DATE                                  32440099
322300        MOVE PV-DATE-DISPLAY        TO ACANDTO                    32450099
322400     END-IF.                                                      32460099
322500*                                                                 32470099
322600     IF PLNSHP-EXT-CAN-DTE          =  PC-INIT-DATE               32480099
322700        MOVE SPACES                 TO AXCANDTO                   32490099
322800     ELSE                                                         32500099
322900        MOVE PLNSHP-EXT-CAN-DTE     TO PV-DATE-BREAK              32510099
323000        PERFORM 4320-FORMAT-DATE                                  32520099
323100        MOVE PV-DATE-DISPLAY        TO AXCANDTO                   32530099
323200     END-IF.                                                      32540099
323300*                                                                 32550099
323400     IF PLNSHP-STRT-FCTRY-DTE       =  PC-INIT-DATE               32560099
323500        MOVE SPACES                 TO ASTXFDTO                   32570099
323600     ELSE                                                         32580099
323700        MOVE PLNSHP-STRT-FCTRY-DTE  TO PV-DATE-BREAK              32590099
323800        PERFORM 4320-FORMAT-DATE                                  32600099
323900        MOVE PV-DATE-DISPLAY        TO ASTXFDTO                   32610099
324000     END-IF.                                                      32620099
324100*                                                                 32630099
324200     IF PLNSHP-LAST-FCTRY-DTE       =  PC-INIT-DATE               32640099
324300        MOVE SPACES                 TO ALTXFDTO                   32650099
324400     ELSE                                                         32660099
324500        MOVE PLNSHP-LAST-FCTRY-DTE  TO PV-DATE-BREAK              32670099
324600        PERFORM 4320-FORMAT-DATE                                  32680099
324700        MOVE PV-DATE-DISPLAY        TO ALTXFDTO                   32690099
324800     END-IF.                                                      32700099
324900*                                                                 32710099
325000     IF PLNSHP-DONT-SHIP-BEF-DTE    =  PC-INIT-DATE               32720099
325100        MOVE SPACES                 TO ADSHBEFO                   32730099
325200     ELSE                                                         32740099
325300        MOVE PLNSHP-DONT-SHIP-BEF-DTE                             32750099
325400                                    TO PV-DATE-BREAK              32760099
325500        PERFORM 4320-FORMAT-DATE                                  32770099
325600        MOVE PV-DATE-DISPLAY        TO ADSHBEFO                   32780099
325700     END-IF.                                                      32790099
325800                                                                  32800099
325900*    IF ASC-OUTR-PACK-X = SPACES                                  32810099
326000*       MOVE ASC-OUTR-PACK-N        TO ACASEO                     32820099
326100*    ELSE                                                         32830099
326200*       MOVE ASC-OUTR-PACK-X        TO ACASEO                     32840099
326300*    END-IF.                                                      32850099
326400*                                                                 32860099
326500 EJECT                                                            32870099
326600*----------------------------------------------------------------*32880099
326700*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *32890099
326800*----------------------------------------------------------------*32900099
326900 4410-READ-TEMP-STORAGE.                                          32910099
327000                                                                  32920099
327100     EXEC CICS                                                    32930099
327200         READQ TS                                                 32940099
327300             QUEUE (ASC-LIST-QUEUE-NAME)                          32950099
327400             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               32960099
327500             ITEM  (PV-BLOCK-NUMBER)                              32970099
327600             RESP  (PV-CICS-RESP)                                 32980099
327700     END-EXEC.                                                    32990099
327800*                                                                 33000099
327900     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       33010099
328000       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     33020099
328100         CONTINUE                                                 33030099
328200     ELSE                                                         33040099
328300         SET DP013-CICS-ABEND     TO TRUE                         33050099
328400         SET DP013-NO-ROLLBACK    TO TRUE                         33060099
328500         MOVE '4410-READ-TEMP-STORAGE'                            33070099
328600                                  TO DP013-PARAGRAPH              33080099
328700         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      33090099
328800                                  TO DP013-MESSAGE-TEXT(1)        33100099
328900         PERFORM DP013-0000-PROCESS-ABEND                         33110099
329000     END-IF.                                                      33120099
329100*                                                                 33130099
329200     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             33140099
329300*                                                                 33150099
329400     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         33160099
329500         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               33170099
329600     END-IF.                                                      33180099
329700                                                                  33190099
329800 EJECT                                                            33200099
329900*----------------------------------------------------------------*33210099
330000*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *33220099
330100*----------------------------------------------------------------*33230099
330200 4420-FORMAT-LIST-LINES.                                          33240099
330300                                                                  33250099
330400     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      33260099
330500         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                33270099
330600         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA    (PV-SUB)        33280099
330700         MOVE DP015-HL-OFF       TO MR-SELECTH    (PV-SUB)        33290099
330800         MOVE SPACES             TO MR-SELECTI    (PV-SUB)        33300099
330900                                    MR-ACTION     (PV-SUB)        33310099
331000                                    MR-SCAC       (PV-SUB)        33320099
331100                                    MR-TRLR       (PV-SUB)        33330099
331200                                    MR-CTDV       (PV-SUB)        33340099
331300                                    MR-TRAV       (PV-SUB)        33350099
331400                                    MR-TRPU       (PV-SUB)        33360099
331500                                    MR-SHIP       (PV-SUB)        33370099
331600                                    MR-ETA        (PV-SUB)        33380099
331700                                    MR-ATA        (PV-SUB)        33390099
331800         MOVE 0                  TO MR-CART       (PV-SUB)        33400099
331900                                    MR-DC         (PV-SUB)        33410099
332000                                    MR-RC         (PV-SUB)        33420099
332100     ELSE                                                         33430099
332200         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      33440099
332300                                                   > SPACE        33450099
332400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 33460099
332500                                 TO MR-SELECTI (PV-SUB)           33470099
332600         ELSE                                                     33480099
332700             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      33490099
332800                                 TO MR-SELECTI (PV-SUB)           33500099
332900         END-IF                                                   33510099
333000                                                                  33520099
333100         IF  DP030-SET-CURSOR-TRAILER                             33530099
333200             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)33540099
333300                 > SPACE)                                         33550099
333400               OR (PV-SUB = 1))                                   33560099
333500                SET DP030-SET-CURSOR-APPL-1 TO TRUE               33570099
333600                MOVE -1          TO MR-SELECTL (PV-SUB)           33580099
333700             END-IF                                               33590099
333800         END-IF                                                   33600099
333900                                                                  33610099
334000         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           33620099
334100             MOVE ASC-ACTION   (ASC-BLK-SUB ASC-ITEM-SUB)         33630099
334200                               TO MR-ACTION (PV-SUB)              33640099
334300             MOVE ASC-SCAC     (ASC-BLK-SUB ASC-ITEM-SUB)         33650099
334400                               TO MR-SCAC   (PV-SUB)              33660099
334500             MOVE ASC-TRLR     (ASC-BLK-SUB ASC-ITEM-SUB)         33670099
334600                               TO MR-TRLR   (PV-SUB)              33680099
334700             MOVE ASC-CART     (ASC-BLK-SUB ASC-ITEM-SUB)         33690099
334800                               TO MR-CART   (PV-SUB)              33700099
334900             MOVE ASC-CTDV     (ASC-BLK-SUB ASC-ITEM-SUB)         33710099
335000                               TO MR-CTDV   (PV-SUB)              33720099
335100             MOVE ASC-TRAV     (ASC-BLK-SUB ASC-ITEM-SUB)         33730099
335200                               TO MR-TRAV   (PV-SUB)              33740099
335300             MOVE ASC-TRPU     (ASC-BLK-SUB ASC-ITEM-SUB)         33750099
335400                               TO MR-TRPU   (PV-SUB)              33760099
335500             MOVE ASC-SHIP     (ASC-BLK-SUB ASC-ITEM-SUB)         33770099
335600                               TO MR-SHIP   (PV-SUB)              33780099
335700             MOVE ASC-DC       (ASC-BLK-SUB ASC-ITEM-SUB)         33790099
335800                               TO MR-DC     (PV-SUB)              33800099
335900             MOVE ASC-RC       (ASC-BLK-SUB ASC-ITEM-SUB)         33810099
336000                               TO MR-RC     (PV-SUB)              33820099
336100             MOVE ASC-ETA      (ASC-BLK-SUB ASC-ITEM-SUB)         33830099
336200                               TO MR-ETA    (PV-SUB)              33840099
336300             MOVE ASC-ATA      (ASC-BLK-SUB ASC-ITEM-SUB)         33850099
336400                               TO MR-ATA    (PV-SUB)              33860099
336500         END-IF                                                   33870099
336600     END-IF.                                                      33880099
336700     SUBTRACT +1 FROM ASC-ITEM-SUB                                33890099
336800     IF  ASC-ITEM-SUB < + 1                                       33900099
336900         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  33910099
337000         MOVE +1                 TO ASC-BLK-SUB                   33920099
337100     END-IF.                                                      33930099
337200                                                                  33940099
337300 EJECT                                                            33950099
337400*----------------------------------------------------------------*33960099
337500*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *33970099
337600*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *33980099
337700*  ISSUE A WARNING.                                              *33990099
337800*----------------------------------------------------------------*34000099
337900 4430-CHECK-FOR-BEGIN-AND-END.                                    34010099
338000                                                                  34020099
338100     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       34030099
338200         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     34040099
338300*----------- NO END-OF-RANGE SPECFIED ---                         34050099
338400             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            34060099
338500             SET DP020-MSG-WARNING TO TRUE                        34070099
338600             PERFORM 4431-POSITION-AT-WARNING                     34080099
338700         END-IF                                                   34090099
338800     ELSE                                                         34100099
338900         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     34110099
339000*----------- NO BEGINNING-OF-RANGE SPECFIED ---                   34120099
339100             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            34130099
339200             SET DP020-MSG-WARNING TO TRUE                        34140099
339300             PERFORM 4431-POSITION-AT-WARNING                     34150099
339400         END-IF                                                   34160099
339500     END-IF.                                                      34170099
339600                                                                  34180099
339700 EJECT                                                            34190099
339800*----------------------------------------------------------------*34200099
339900*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *34210099
340000*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *34220099
340100*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *34230099
340200*  POSITION THE CURSOR THERE.                                    *34240099
340300*----------------------------------------------------------------*34250099
340400 4431-POSITION-AT-WARNING.                                        34260099
340500                                                                  34270099
340600     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 34280099
340700                    - PV-TOP-ITEM + 1.                            34290099
340800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      34300099
340900         CONTINUE                                                 34310099
341000     ELSE                                                         34320099
341100         SET DP030-SET-CURSOR-APPL-1                              34330099
341200                                   TO TRUE                        34340099
341300         MOVE -1                   TO MR-SELECTL (PV-SUB)         34350099
341400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         34360099
341500         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         34370099
341600     END-IF.                                                      34380099
341700*                                                                 34390099
341800     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   34400099
341900                    - PV-TOP-ITEM + 1.                            34410099
342000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      34420099
342100         CONTINUE                                                 34430099
342200     ELSE                                                         34440099
342300         SET DP030-SET-CURSOR-APPL-1                              34450099
342400                                   TO TRUE                        34460099
342500         MOVE -1                   TO MR-SELECTL (PV-SUB)         34470099
342600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         34480099
342700         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         34490099
342800     END-IF.                                                      34500099
342900                                                                  34510099
343000 EJECT                                                            34520099
343100*----------------------------------------------------------------*34530099
343200* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *34540099
343300* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *34550099
343400* FOR THE SELECTED ITEMS QUEUE.                                  *34560099
343500*                                                                *34570099
343600* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *34580099
343700* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *34590099
343800* THE ARRAY IS FULL.                                             *34600099
343900*----------------------------------------------------------------*34610099
344000 5000-PREPARE-SEL-QUEUE.                                          34620099
344100                                                                  34630099
344200     MOVE +1                   TO  ASC-BLK-SUB.                   34640099
344300     PERFORM 5100-WRITE-TEMP-STORAGE.                             34650099
344400     ADD +1                    TO  ASC-BLK-SUB.                   34660099
344500     PERFORM 5100-WRITE-TEMP-STORAGE.                             34670099
344600     PERFORM 6010-DELETE-SEL-QUEUE.                               34680099
344700                                                                  34690099
344800     SET ASC-UPDATE-TSQ        TO  TRUE.                          34700099
344900                                                                  34710099
345000     SET TR108-IDX             TO  1.                             34720099
345100     MOVE ZERO                 TO PV-SEL-QUEUE-ITEM.              34730099
345200     INITIALIZE TR108-SELECTED-ITEM-ARRAY.                        34740099
345300                                                                  34750099
345400     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           34760099
345500             VARYING PV-ITEM                                      34770099
345600             FROM 1 BY 1                                          34780099
345700             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     34790099
345800                                                                  34800099
345900     IF  TR108-IDX > 1                                            34810099
346000         ADD +1        TO PV-SEL-QUEUE-ITEM                       34820099
346100         PERFORM 5205-WRITE-SEL-QUEUE                             34830099
346200     END-IF.                                                      34840099
346300*                                                                 34850099
346400 EJECT                                                            34860099
346500*----------------------------------------------------------------*34870099
346600*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *34880099
346700*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *34890099
346800*----------------------------------------------------------------*34900099
346900 5100-WRITE-TEMP-STORAGE.                                         34910099
347000                                                                  34920099
347100     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     34930099
347200                                   TO PV-LIST-ITEM-NUMBER.        34940099
347300     COMPUTE PV-BLOCK-NUMBER =                                    34950099
347400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    34960099
347500                                                                  34970099
347600     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             34980099
347700     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             34990099
347800         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      35000099
347900             PERFORM 5105-REWRITE-ASC-LISTQ                       35010099
348000         END-IF                                                   35020099
348100     ELSE                                                         35030099
348200         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       35040099
348300         ASC-HIGHEST-BLOCK-WRITTEN + 1                            35050099
348400         PERFORM 5110-WRITE-ASC-LISTQ                             35060099
348500         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   35070099
348600     END-IF.                                                      35080099
348700                                                                  35090099
348800     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             35100099
348900                                                                  35110099
349000 EJECT                                                            35120099
349100*----------------------------------------------------------------*35130099
349200*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *35140099
349300*  SPECIFIC COMMAREA.                                            *35150099
349400*----------------------------------------------------------------*35160099
349500 5105-REWRITE-ASC-LISTQ.                                          35170099
349600                                                                  35180099
349700     EXEC CICS                                                    35190099
349800         WRITEQ TS                                                35200099
349900             QUEUE (ASC-LIST-QUEUE-NAME)                          35210099
350000             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               35220099
350100             ITEM  (PV-BLOCK-NUMBER)                              35230099
350200             REWRITE                                              35240099
350300             RESP  (PV-CICS-RESP)                                 35250099
350400     END-EXEC.                                                    35260099
350500                                                                  35270099
350600     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           35280099
350700         CONTINUE                                                 35290099
350800     ELSE                                                         35300099
350900         SET DP013-CICS-ABEND            TO TRUE                  35310099
351000         SET DP013-NO-ROLLBACK           TO TRUE                  35320099
351100         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       35330099
351200         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     35340099
351300                                         TO DP013-MESSAGE-TEXT(1) 35350099
351400         PERFORM DP013-0000-PROCESS-ABEND                         35360099
351500     END-IF.                                                      35370099
351600                                                                  35380099
351700 EJECT                                                            35390099
351800*----------------------------------------------------------------*35400099
351900*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *35410099
352000*  SPECIFIC COMMAREA.                                            *35420099
352100*----------------------------------------------------------------*35430099
352200 5110-WRITE-ASC-LISTQ.                                            35440099
352300                                                                  35450099
352400     EXEC CICS                                                    35460099
352500         WRITEQ TS                                                35470099
352600             QUEUE (ASC-LIST-QUEUE-NAME)                          35480099
352700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               35490099
352800             ITEM  (PV-BLOCK-NUMBER)                              35500099
352900             RESP  (PV-CICS-RESP)                                 35510099
353000     END-EXEC.                                                    35520099
353100                                                                  35530099
353200     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      35540099
353300         SET DP013-CICS-ABEND      TO TRUE                        35550099
353400         SET DP013-NO-ROLLBACK     TO TRUE                        35560099
353500         MOVE '5110-WRITE-ASC-LISTQ'                              35570099
353600                                   TO DP013-PARAGRAPH             35580099
353700         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           35590099
353800                                   TO DP013-MESSAGE-TEXT(1)       35600099
353900         PERFORM DP013-0000-PROCESS-ABEND                         35610099
354000     END-IF.                                                      35620099
354100                                                                  35630099
354200 EJECT                                                            35640099
354300*----------------------------------------------------------------*35650099
354400* READ A LIST QUEUE RECORD AND MOVE THE KEY OF SELECTED OBJECTS  *35660099
354500* THE FIRST SELECTED ITEM IS PASSED TO RC012 RECORD.             *35670099
354600* THIS PARAGRAPH IS ONLY CALLED WHEN THERE IS ONE SELECTED       *35680099
354700* RECORD.                                                        *35690099
354800*----------------------------------------------------------------*35700099
354900 5200-FILL-SEL-QUEUE-RECORD.                                      35710099
355000                                                                  35720099
355100     PERFORM 6112-READ-LIST-QUEUE.                                35730099
355200                                                                  35740099
355300     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       35750099
355400         PERFORM                                                  35760099
355500         VARYING LQW-IDX                                          35770099
355600         FROM 1 BY 1                                              35780099
355700         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            35790099
355800           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          35800099
355900                                                                  35810099
356000             IF  LQW-SELECT (LQW-IDX)                             35820099
356100               IF DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)          35830099
356200                 MOVE LQW-TRIP (LQW-IDX) TO TR109-TRIP-ID         35840099
356300                 MOVE LQW-SCAC (LQW-IDX) TO TR109-OWNER-SCAC-ID   35850099
356400                 MOVE LQW-TRLR (LQW-IDX) TO TR109-VEH-NBR         35860099
356500                 MOVE LQW-OU (LQW-IDX)   TO TR109-OPER-UNT-ID     35870099
356600                 MOVE LQW-FI (LQW-IDX)   TO TR109-FCLTY-ID        35880099
356700               END-IF                                             35890099
356800                                                                  35900099
356900               IF DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)          35910099
357000                IF LQW-RC (LQW-IDX) = ZERO                        35920099
357100                 SET DP030-OVERRIDE-GO TO TRUE                    35930099
357200                 MOVE PC-TSYMSG-01021  TO DP020-MSG-NUMBER        35940099
357300                 SET DP020-MSG-WARNING TO TRUE                    35950099
357400                ELSE                                              35960099
357500                 MOVE LQW-RC (LQW-IDX)                            35970099
357600                                   TO RC012-REC-SEQ-NBR           35980099
357700                 MOVE LQW-OU (LQW-IDX)                            35990099
357800                                   TO RC012-OPER-UNT-ID           36000099
357900                 MOVE LQW-FI (LQW-IDX)                            36010099
358000                                   TO RC012-FCLTY-ID              36020099
358100                END-IF                                            36030099
358200               END-IF                                             36040099
358300                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              36050099
358400                                   TO TR108-ITEM (TR108-IDX)      36060099
358500                 MOVE TR109-PO-NBR TO TR108-PO-NBR (TR108-IDX)    36070099
358600                 MOVE 'I'          TO TR108-ACTION-SW (TR108-IDX) 36080099
358700                                                                  36090099
358800                 SET TR108-IDX UP BY 1                            36100099
358900                 IF  TR108-IDX > TR108-MAX-ITEMS                  36110099
359000                     ADD +1        TO PV-SEL-QUEUE-ITEM           36120099
359100                     PERFORM 5205-WRITE-SEL-QUEUE                 36130099
359200                     INITIALIZE TR108-SELECTED-ITEM-ARRAY         36140099
359300                     SET TR108-IDX TO  1                          36150099
359400                 END-IF                                           36160099
359500             END-IF                                               36170099
359600         END-PERFORM                                              36180099
359700     END-IF.                                                      36190099
359800                                                                  36200099
359900 EJECT                                                            36210099
360000*----------------------------------------------------------------*36220099
360100*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *36230099
360200*----------------------------------------------------------------*36240099
360300 5205-WRITE-SEL-QUEUE.                                            36250099
360400                                                                  36260099
360500     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            36270099
360600                                   TO TR108-SELECTED-ITEMS.       36280099
360700                                                                  36290099
360800     EXEC CICS                                                    36300099
360900          WRITEQ TS                                               36310099
361000             QUEUE (ASC-SEL-QUEUE-NAME)                           36320099
361100             FROM  (TR108-PO-SEL-REC)                             36330099
361200             ITEM  (PV-SEL-QUEUE-ITEM)                            36340099
361300             RESP  (PV-CICS-RESP)                                 36350099
361400     END-EXEC.                                                    36360099
361500                                                                  36370099
361600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          36380099
361700         CONTINUE                                                 36390099
361800     ELSE                                                         36400099
361900         SET DP013-CICS-ABEND      TO TRUE                        36410099
362000         SET DP013-NO-ROLLBACK     TO TRUE                        36420099
362100         MOVE '5205-WRITE-SEL-QUEUE'                              36430099
362200                                   TO DP013-PARAGRAPH             36440099
362300         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          36450099
362400                                   TO DP013-MESSAGE-TEXT(1)       36460099
362500         PERFORM DP013-0000-PROCESS-ABEND                         36470099
362600     END-IF.                                                      36480099
362700                                                                  36490099
362800 EJECT                                                            36500099
362900*----------------------------------------------------------------*36510099
363000*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *36520099
363100*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *36530099
363200*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *36540099
363300*  THE USER.                                                     *36550099
363400*----------------------------------------------------------------*36560099
363500 6000-REFRESH-PANEL-FROM-TEMP.                                    36570099
363600                                                                  36580099
363700     IF  ASC-UPDATE-TSQ                                           36590099
363800         SET ASC-NO-TSQ-UPDATE TO TRUE                            36600099
363900         MOVE ZERO                 TO PV-SAVE-ITEM                36610099
364000                                      PV-SEL-QUEUE-ITEM           36620099
364100         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        36630099
364200                                   TO PV-HOLD-SELECTED-ITEMS      36640099
364300         MOVE +1                   TO PV-ITEMS-PROCESSED          36650099
364400         PERFORM 6100-UPDATE-TSQ                                  36660099
364500             UNTIL PV-ITEMS-PROCESSED >                           36670099
364600                                     PV-HOLD-SELECTED-ITEMS       36680099
364700         PERFORM 6010-DELETE-SEL-QUEUE                            36690099
364800         INITIALIZE ASC-BLOCK-ENTRIES (1)                         36700099
364900                    ASC-BLOCK-ENTRIES (2)                         36710099
365000     END-IF.                                                      36720099
365100                                                                  36730099
365200 EJECT                                                            36740099
365300*----------------------------------------------------------------*36750099
365400*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *36760099
365500*----------------------------------------------------------------*36770099
365600 6010-DELETE-SEL-QUEUE.                                           36780099
365700                                                                  36790099
365800     EXEC CICS                                                    36800099
365900         DELETEQ TS                                               36810099
366000             QUEUE (ASC-SEL-QUEUE-NAME)                           36820099
366100             RESP  (PV-CICS-RESP)                                 36830099
366200     END-EXEC.                                                    36840099
366300                                                                  36850099
366400     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      36860099
366500        (PV-CICS-RESP = DFHRESP(QIDERR)))                         36870099
366600         CONTINUE                                                 36880099
366700     ELSE                                                         36890099
366800         SET DP013-CICS-ABEND TO TRUE                             36900099
366900         SET DP013-NO-ROLLBACK TO TRUE                            36910099
367000         MOVE '6010-DELETE-SEL-QUEUE'                             36920099
367100                        TO DP013-PARAGRAPH                        36930099
367200         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         36940099
367300                        TO DP013-MESSAGE-TEXT (1)                 36950099
367400         PERFORM DP013-0000-PROCESS-ABEND                         36960099
367500     END-IF.                                                      36970099
367600                                                                  36980099
367700 EJECT                                                            36990099
367800*----------------------------------------------------------------*37000099
367900*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *37010099
368000*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *37020099
368100*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *37030099
368200*    THE TEMP QUEUE.                                             *37040099
368300*----------------------------------------------------------------*37050099
368400 6100-UPDATE-TSQ.                                                 37060099
368500                                                                  37070099
368600     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             37080099
368700     PERFORM 6105-READ-SEL-QUEUE.                                 37090099
368800     PERFORM                                                      37100099
368900         VARYING TR108-IDX                                        37110099
369000         FROM 1 BY 1                                              37120099
369100         UNTIL ((PV-ITEMS-PROCESSED >                             37130099
369200                              PV-HOLD-SELECTED-ITEMS)             37140099
369300         OR (TR108-IDX GREATER THAN TR108-MAX-ITEMS))             37150099
369400         IF  TR108-ACTION-SW (TR108-IDX) > SPACE                  37160099
369500             PERFORM 6110-PROCESS-ITEMS                           37170099
369600         END-IF                                                   37180099
369700         ADD +1                TO PV-ITEMS-PROCESSED              37190099
369800     END-PERFORM.                                                 37200099
369900     PERFORM 6111-WRITE-LIST-QUEUE.                               37210099
370000                                                                  37220099
370100 EJECT                                                            37230099
370200*----------------------------------------------------------------*37240099
370300*    READ THE LIST QUEUE RECORD.                                 *37250099
370400*----------------------------------------------------------------*37260099
370500 6105-READ-SEL-QUEUE.                                             37270099
370600                                                                  37280099
370700     EXEC CICS                                                    37290099
370800          READQ TS                                                37300099
370900             QUEUE (ASC-SEL-QUEUE-NAME)                           37310099
371000             INTO  (TR108-PO-SEL-REC)                             37320099
371100             ITEM  (PV-SEL-QUEUE-ITEM)                            37330099
371200             RESP  (PV-CICS-RESP)                                 37340099
371300     END-EXEC.                                                    37350099
371400                                                                  37360099
371500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          37370099
371600         CONTINUE                                                 37380099
371700     ELSE                                                         37390099
371800         SET DP013-CICS-ABEND      TO  TRUE                       37400099
371900         SET DP013-NO-ROLLBACK     TO  TRUE                       37410099
372000         MOVE '6105-READ-SEL-QUEUE'                               37420099
372100                                   TO  DP013-PARAGRAPH            37430099
372200         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           37440099
372300                                   TO  DP013-MESSAGE-TEXT(1)      37450099
372400         PERFORM DP013-0000-PROCESS-ABEND                         37460099
372500     END-IF.                                                      37470099
372600                                                                  37480099
372700 EJECT                                                            37490099
372800*----------------------------------------------------------------*37500099
372900*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*37510099
373000*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*37520099
373100*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *37530099
373200*----------------------------------------------------------------*37540099
373300 6110-PROCESS-ITEMS.                                              37550099
373400                                                                  37560099
373500     COMPUTE PV-ITEM = 1 + ((TR108-ITEM (TR108-IDX) - 1)          37570099
373600                     / PC-ITEMS-PER-PANEL).                       37580099
373700                                                                  37590099
373800     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           37600099
373900         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          37610099
374000             PERFORM 6111-WRITE-LIST-QUEUE                        37620099
374100         END-IF                                                   37630099
374200         MOVE PV-ITEM          TO PV-SAVE-ITEM                    37640099
374300                                                                  37650099
374400         PERFORM 6112-READ-LIST-QUEUE                             37660099
374500         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               37670099
374600             CONTINUE                                             37680099
374700         END-IF                                                   37690099
374800     END-IF.                                                      37700099
374900                                                                  37710099
375000     COMPUTE PV-SUB = (TR108-ITEM (TR108-IDX)                     37720099
375100                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              37730099
375200     SET LQW-DESELECT (PV-SUB) TO    TRUE.                        37740099
375300     MOVE LQW-SELECTED-SW (PV-SUB)                                37750099
375400                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  37760099
375500                                                                  37770099
375600     IF TR108-INQ (TR108-IDX)                                     37780099
375700        MOVE PC-INQ            TO LQW-ACTION (PV-SUB)             37790099
375800     END-IF.                                                      37800099
375900                                                                  37810099
376000     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                37820099
376100                                                                  37830099
376200 EJECT                                                            37840099
376300*----------------------------------------------------------------*37850099
376400*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *37860099
376500*----------------------------------------------------------------*37870099
376600 6111-WRITE-LIST-QUEUE.                                           37880099
376700                                                                  37890099
376800     EXEC CICS                                                    37900099
376900         WRITEQ TS                                                37910099
377000             QUEUE (ASC-LIST-QUEUE-NAME)                          37920099
377100             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     37930099
377200             ITEM  (PV-SAVE-ITEM)                                 37940099
377300             REWRITE                                              37950099
377400             RESP  (PV-CICS-RESP)                                 37960099
377500     END-EXEC.                                                    37970099
377600                                                                  37980099
377700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          37990099
377800         CONTINUE                                                 38000099
377900     ELSE                                                         38010099
378000         SET DP013-CICS-ABEND  TO  TRUE                           38020099
378100         SET DP013-NO-ROLLBACK TO  TRUE                           38030099
378200         MOVE '6111-WRITE-LIST-QUEUE'                             38040099
378300                               TO  DP013-PARAGRAPH                38050099
378400         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  38060099
378500                               TO  DP013-MESSAGE-TEXT(1)          38070099
378600         PERFORM DP013-0000-PROCESS-ABEND                         38080099
378700     END-IF.                                                      38090099
378800                                                                  38100099
378900 EJECT                                                            38110099
379000*----------------------------------------------------------------*38120099
379100*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*38130099
379200*----------------------------------------------------------------*38140099
379300 6112-READ-LIST-QUEUE.                                            38150099
379400                                                                  38160099
379500     EXEC CICS                                                    38170099
379600         READQ TS                                                 38180099
379700             QUEUE (ASC-LIST-QUEUE-NAME)                          38190099
379800             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     38200099
379900             ITEM  (PV-ITEM)                                      38210099
380000             RESP  (PV-CICS-RESP)                                 38220099
380100     END-EXEC.                                                    38230099
380200                                                                  38240099
380300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          38250099
380400         CONTINUE                                                 38260099
380500     ELSE                                                         38270099
380600         SET DP013-CICS-ABEND        TO TRUE                      38280099
380700         SET DP013-NO-ROLLBACK       TO TRUE                      38290099
380800         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           38300099
380900         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    38310099
381000                                     TO DP013-MESSAGE-TEXT(1)     38320099
381100         PERFORM DP013-0000-PROCESS-ABEND                         38330099
381200     END-IF.                                                      38340099
381300                                                                  38350099
381400 EJECT                                                            38360099
381500*----------------------------------------------------------------*38370099
381600*    READ THE LIST QUEUE RECORD.                                 *38380099
381700*----------------------------------------------------------------*38390099
381800 9100-READ-SEL-QUEUE.                                             38400099
381900                                                                  38410099
382000     EXEC CICS                                                    38420099
382100          READQ TS                                                38430099
382200             QUEUE (TR109-SEL-QUEUE-NAME)                         38440099
382300             INTO  (TR108-PO-SEL-REC)                             38450099
382400             ITEM  (ASC-SEL-ITEM)                                 38460099
382500             RESP  (PV-CICS-RESP)                                 38470099
382600     END-EXEC.                                                    38480099
382700                                                                  38490099
382800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          38500099
382900         CONTINUE                                                 38510099
383000     ELSE                                                         38520099
383100         SET DP013-CICS-ABEND      TO  TRUE                       38530099
383200         SET DP013-NO-ROLLBACK     TO  TRUE                       38540099
383300         MOVE '9100-READ-SEL-QUEUE'                               38550099
383400                                   TO  DP013-PARAGRAPH            38560099
383500         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           38570099
383600                                   TO  DP013-MESSAGE-TEXT(1)      38580099
383700         PERFORM DP013-0000-PROCESS-ABEND                         38590099
383800     END-IF.                                                      38600099
383900                                                                  38610099
384000 EJECT                                                            38620099
384100*----------------------------------------------------------------*38630099
384200*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *38640099
384300*  SPECIFIC COMMAREA.                                            *38650099
384400*----------------------------------------------------------------*38660099
384500 9200-REWRITE-SEL-QUEUE.                                          38670099
384600                                                                  38680099
384700     EXEC CICS                                                    38690099
384800         WRITEQ TS                                                38700099
384900             QUEUE (TR109-SEL-QUEUE-NAME)                         38710099
385000             FROM  (TR108-PO-SEL-REC)                             38720099
385100             ITEM  (ASC-SEL-ITEM)                                 38730099
385200             REWRITE                                              38740099
385300             RESP  (PV-CICS-RESP)                                 38750099
385400     END-EXEC.                                                    38760099
385500                                                                  38770099
385600     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           38780099
385700         CONTINUE                                                 38790099
385800     ELSE                                                         38800099
385900         SET DP013-CICS-ABEND            TO TRUE                  38810099
386000         SET DP013-NO-ROLLBACK           TO TRUE                  38820099
386100         MOVE '9200-REWRITE-SEL-QUEUE'   TO DP013-PARAGRAPH       38830099
386200         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     38840099
386300                                         TO DP013-MESSAGE-TEXT(1) 38850099
386400         PERFORM DP013-0000-PROCESS-ABEND                         38860099
386500     END-IF.                                                      38870099
386600                                                                  38880099
386700 EJECT                                                            38890099
386800*----------------------------------------------------------------*38900099
386900*    ABEND PROCESSOR MODULE                                      *38910099
387000*----------------------------------------------------------------*38920099
387100                                                                  38930099
387200     COPY DPPD013.                                                38940099
