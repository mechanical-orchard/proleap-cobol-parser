000100*-----------------------*                                         00010012
000200 IDENTIFICATION DIVISION.                                         00020012
000300*-----------------------*                                         00030012
000400 PROGRAM-ID.    APKUT106.                                         00040012
000500 AUTHOR.        PAUL KEBER - STRATAGEM.                           00050012
000600 DATE-WRITTEN.  NOVEMBER, 1995.                                   00060012
000700                                                                  00070012
000800*---------------------------------------------------------------* 00080012
000900*                                                               * 00090012
001000*    COBOL II WITH SQL                                          * 00100012
001100*                                                               * 00110012
001200*         --- UNJOURNALIZED RECEIPT PO EXTRACT ---              * 00120012
001300*                                                               * 00130012
001400* DB2 TABLES:                                                   * 00140012
001500*  1. NON-INVOICED RECEIPT             (TNINREC)                * 00150012
001600*  2. RECEIVER                         (TRECEIV)                * 00160012
001700*  3. AP CONTROL                       (TAPCNTL)                * 00170012
001800*                                                               * 00180012
001900* OUTPUT:                                                       * 00190012
002000*  1. UNJRNLZD-RECEIPT-PO-FILE         (APRD106)                * 00200020
002100*  2. UNJRNLZD-RECEIPT-DATE-FILE       (APRD108)                * 00210020
002200*                                                               * 00220012
002300*---------------------------------------------------------------* 00230012
002400 EJECT                                                            00240012
002500*---------------------------------------------------------------* 00250012
002600*                                                               * 00260012
002700*    THIS PROGRAM CREATES THE UNJOURNALIZED RECEIPT PO EXTRACT  * 00270012
002800*    FILE WHICH WILL BE USED TO DETERMINE WHICH PO'S WILL       * 00280012
002900*    APPEAR ON THE UNJOURNALIZED RECEIPT ANALYSIS REPORT.       * 00290012
003000*                                                               * 00300012
003100*    FOR WEEKLY PROCESSING:                                     * 00310012
003200*    THE UNJOURNALIZED RECEIPT PO FILE WILL CONTAIN TWO TYPES   * 00320012
003300*    OF RECORDS.  THE FIRST TYPE WILL CONSIST OF UNJOURNALIZED  * 00330012
003400*    TNINREC PO'S CREATED DURING A SELECTED DATE RANGE (WHICH   * 00340012
003500*    IS OBTAINED FROM TAPCNTL FIELDS).  THE SECOND TYPE WILL    * 00350012
003600*    CONSIST OF UNJOURNALIZED AND VERIFIED TRECEIV PO'S CREATED * 00360012
003700*    DURING THE SAME DATE RANGE.                                * 00370012
003800*                                                               * 00380012
003900*    FOR MONTHLY PROCESSING:                                    * 00390012
004000*    THE UNJOURNALIZED RECEIPT PO FILE WILL CONTAIN TWO TYPES   * 00400012
004100*    OF RECORDS.  THE FIRST TYPE WILL CONSIST OF UNJOURNALIZED  * 00410012
004200*    TNINREC PO'S CREATED DURING A SELECTED DATE RANGE (WHICH   * 00420012
004300*    IS OBTAINED FROM CONTROL CARD).  THE SECOND TYPE WILL      * 00430012
004400*    CONSIST OF UNJOURNALIZED AND VERIFIED TRECEIV PO'S CREATED * 00440012
004500*    DURING THE SAME DATE RANGE.                                * 00450012
004600*                                                               * 00460012
004700*    FOR BOTH:                                                  * 00470012
004800*    THIS PROGRAM WILL ALSO CREATE THE UNJOURNALIZED RECEIPT    * 00480012
004900*    DATES FILE WHICH WILL BE USED TO PASS THE UNJOURNALIZED    * 00490012
005000*    RECEIPT START AND END DATES TO THE REPORT PROGRAM.         * 00500012
005100*                                                               * 00510012
005200*---------------------------------------------------------------* 00520012
005300*************************************************************     00530012
005400*   CHANGES:                                                *     00540012
005500*                                                           *     00550012
005600* 02/03/98   ROBIN BERNOSKI                WR/IR #: WR5703  *     00560012
005700*        - MODIFIED THE MANNER IN WHICH THE STANDARD DATE   *     00570012
005800*          ROUTINE, DPKUT500, IS TO BE CALLED WITHIN A      *     00580012
005900*          PROGRAM SO THAT THE CALL IS DYNAMIC.             *     00590012
006000*                                                           *     00600012
006100* 12/08/1999 JILL JUEL                   WR/IR #: WR6041    *     00610012
006200*            - MODIFIED THE CHECK ON THE DATE ROUTINE TO    *     00620012
006300*              CONFORM WITH Y2K STANDARDS BY ADDING         *     00630012
006400*              DPG54-WARNING-ERROR.                         *     00640012
006500*                                                           *     00650012
006600* 04/08/2002 MIKE BESKE                  WR/IR #: WR23465   *     00660013
006700*            - ADDED CODE TO PROCESS A NEW TYPE OF REPORT - *     00670013
006800*              PRE-WRITEOFF RECEIPTS.  THE DATE RANGE TO    *     00680013
006900*              EXTRACT THIS TYPE OF DATA IS 0001-01-01 THRU *     00690013
007000*              THE CURRENT DATE - 300 DAYS. (PARAS B100-    *     00700013
007100*              B175-)                                       *     00710013
007200*                                                           *     00720012
007300* 02/07/2003                                                *     00730021
007400*    CHANGE MADE: ARKPO PHASE3 PROJECT.                     *     00740020
007500*    UPDATED PGM COMMENT BLOCK WITH THE FILENAMES.          *     00750020
007600*    CHANGED -PURCHASE-ORDER TO -PO-NBR FOR THE COPYBOOK    *     00760020
007700*    FIELD NAME.                                            *     00770020
007800* MADE BY:  MIKE BESKE                          WR#: 23500  *     00780020
007810*                                                           *     00781022
007822* 02/07/2003                                                *     00782223
007823*    CHANGE MADE: ARKPO PHASE3 PROJECT.                     *     00782323
007824*    UPDATED PGM COMMENT BLOCK WITH THE FILENAMES.          *     00782423
007825*    CHANGED -PURCHASE-ORDER TO -PO-NBR FOR THE COPYBOOK    *     00782523
007826*    FIELD NAME.                                            *     00782623
007827* MADE BY:  MIKE BESKE                          WR#: 23500  *     00782723
007828*                                                           *     00782823
007830* 10/28/2005                                                *     00783065
007831*    CHANGE MADE: CALCULATION OF THE START AND END DATE     *     00783157
007832*    FROM THE CURRENT DATE FOR NEW STORES UNJOURNALIZED     *     00783257
007833*    RECEIPTS.                                                    00783357
007882*        MODIFIED B100-INITIALIZE TO ACCEPT THE CONTROL     *     00788257
007890*        CARD VALUE 'U'.                                    *     00789057
007891*        CREATED 2 NEW PARAGRAPHS:                                00789157
007892*              A) B180-CALC-NWSTR-UNJRLZD-STRTDT            *     00789259
007893*                 THE START DATE IS 300 DAYS IN THE PAST    *     00789357
007894*                 FROM THE CURRENT DATE                     *     00789457
007895*              B) B185-CALC-NWSTR-UNJRLZD-END-DT            *     00789559
007896*                 THE END DATE IS 60 DAYS IN THE PAST       *     00789657
007897*                 FROM THE CURRENT DATE                     *     00789757
007902* MADE BY:  MICHELE RINDFLEISCH                 WR#: 28546  *     00790257
007910*************************************************************     00791057
008000 EJECT                                                            00800012
008100                                                                  00810012
008200 ENVIRONMENT DIVISION.                                            00820012
008300 CONFIGURATION SECTION.                                           00830012
008400 SOURCE-COMPUTER. IBM-3090.                                       00840012
008500 OBJECT-COMPUTER. IBM-3090.                                       00850012
008600                                                                  00860012
008700*                                                                 00870012
008800 INPUT-OUTPUT SECTION.                                            00880012
008900 FILE-CONTROL.                                                    00890012
009000*                                                                 00900012
009100     SELECT UNJRNLZD-RECEIPT-PO-FILE    ASSIGN TO UT-S-OUT01.     00910012
009200     SELECT UNJRNLZD-RECEIPT-DATE-FILE  ASSIGN TO UT-S-OUT02.     00920012
009300*                                                                 00930012
009400 DATA DIVISION.                                                   00940012
009500 FILE SECTION.                                                    00950012
009600*                                                                 00960012
009700*                                                                 00970012
009800 FD  UNJRNLZD-RECEIPT-PO-FILE                                     00980012
009900     RECORDING MODE IS F                                          00990012
010000     BLOCK CONTAINS 0 CHARACTERS                                  01000012
010100     LABEL RECORDS ARE STANDARD                                   01010012
010200     DATA RECORD IS UNJRNLZD-RECEIPT-PO-RECORD.                   01020012
010300*                                                                 01030012
010400 01  UNJRNLZD-RECEIPT-PO-RECORD PIC X(20).                        01040012
010500*                                                                 01050012
010600 FD  UNJRNLZD-RECEIPT-DATE-FILE                                   01060012
010700     RECORDING MODE IS F                                          01070012
010800     BLOCK CONTAINS 0 CHARACTERS                                  01080012
010900     LABEL RECORDS ARE STANDARD                                   01090012
011000     DATA RECORD IS UNJRNLZD-RECEIPT-DATE-RECORD.                 01100012
011100*                                                                 01110012
011200 01  UNJRNLZD-RECEIPT-DATE-RECORD PIC X(41).                      01120012
011300*                                                                 01130012
011400 EJECT                                                            01140012
011500 WORKING-STORAGE SECTION.                                         01150012
011600                                                                  01160012
011700 01  PV-PROGRAM-VARIABLES.                                        01170012
011800     05  FILLER                  PIC  X(30)  VALUE                01180012
011900         '** BEGINING OF APKUT106 W/S **'.                        01190012
012000     05  PV-CURRENT-PARAGRAPH    PIC  X(35)  VALUE SPACES.        01200012
012100     05  PV-PO-NBR               PIC S9(9)   VALUE ZEROS          01210012
012200                                             COMP.                01220012
012300     05  PV-PO-NINREC-CNT        PIC S9(9)   VALUE ZEROS          01230012
012400                                             COMP.                01240012
012500     05  PV-PO-RECEIV-CNT        PIC S9(9)   VALUE ZEROS          01250012
012600                                             COMP.                01260012
012700     05  PV-NR-TOTAL-COST        PIC S9(09)V9(3)                  01270012
012800                                             VALUE ZEROS          01280012
012900                                             COMP-3.              01290012
013000     05  PV-RECEIPT-TYPE         PIC  X(02)  VALUE SPACES.        01300012
013100         88 PV-RECEIVER                      VALUE 'RV'.          01310012
013200         88 PV-NON-INVC-RECEIPT              VALUE 'NR'.          01320012
013300                                                                  01330012
013410     05  PV-START-DATE           PIC  X(10)  VALUE SPACES.        01341029
013420     05  PV-TEMP-START-DATE      PIC  X(10)  VALUE SPACES.        01342051
013500     05  PV-END-DATE             PIC  X(10)  VALUE SPACES.        01350012
013600     05  PV-CURRENT-DECR7        PIC  X(10)  VALUE SPACES.        01360012
013700     05  PV-CURRENT-DATE-10      PIC  X(10)  VALUE SPACES.        01370012
013800                                                                  01380012
013900     05  PV-RETRY-COUNT          PIC S9(04)   VALUE ZEROS         01390012
014000                                              COMP.               01400012
014100     05  PV-DATE-YYYYMMDD-9             PIC 9(08)   VALUE ZEROS.  01410012
014200     05  PV-YYYYMMDD        REDEFINES   PV-DATE-YYYYMMDD-9.       01420012
014300         10  PV-DATE-YYYY               PIC  X(04).               01430012
014400         10  PV-DATE-MM                 PIC  X(02).               01440012
014500         10  PV-DATE-DD                 PIC  X(02).               01450012
014600                                                                  01460012
014700                                                                  01470012
014800 01  PS-PROGRAM-SWITCHES.                                         01480012
014900     05  PS-OUT-OF-NINRECS-SW    PIC  X(01)  VALUE ' '.           01490012
015000         88  OUT-OF-NINRECS                  VALUE 'Y'.           01500012
015100         88  MORE-NINRECS                    VALUE ' '.           01510012
015200     05  PS-OUT-OF-RECEIPTS-SW   PIC  X(01)  VALUE ' '.           01520012
015300         88  OUT-OF-RECEIPTS                 VALUE 'Y'.           01530012
015400         88  MORE-RECEIPTS                   VALUE ' '.           01540012
015410     05  PS-OUT-OF-DATES-SW      PIC  X(01)  VALUE ' '.           01541028
015420         88  PS-OUT-OF-DATES                 VALUE 'Y'.           01542029
015500                                                                  01550012
015600 01  PC-PROGRAM-CONSTANTS.                                        01560012
015700     05  PC-RETRY-MAX            PIC S9(04)  VALUE +3             01570012
015800                                             COMP.                01580012
015900                                                                  01590012
016000 01  PV-CURRENT-DATE.                                             01600012
016100     05  PV-CURRENT-YR           PIC 9(02)   VALUE 0.             01610012
016200     05  PV-CURRENT-MM           PIC 9(02)   VALUE 0.             01620012
016300     05  PV-CURRENT-DD           PIC 9(02)   VALUE 0.             01630012
016400                                                                  01640012
016500 01  PV-CONTROL-IN-AREA.                                          01650012
016600     05  PV-CONTROL-TYPE         PIC X(01)   VALUE SPACES.        01660012
016700         88  PV-WEEKLY-TYPE-CODE             VALUE 'W'.           01670012
016800         88  PV-MONTHLY-TYPE-CODE            VALUE 'M'.           01680012
016900     05  FILLER                  PIC X(01)   VALUE SPACES.        01690012
017000     05  PV-CONTROL-DATE-BEGIN   PIC X(10)   VALUE SPACES.        01700012
017100     05  FILLER                  PIC X(02)   VALUE SPACES.        01710012
017200     05  PV-CONTOL-DATE-ENDING   PIC X(10)   VALUE SPACES.        01720012
017300     05  FILLER                  PIC X(58)   VALUE SPACES.        01730012
017400                                                                  01740012
017500 EJECT                                                            01750012
017600*                                                                 01760012
017700*    UNJOURNALIZED RECEIPT PO FILE                                01770012
017800*                                                                 01780012
017900     COPY APRD106.                                                01790012
018000/                                                                 01800012
018100*                                                                 01810012
018200*    UNJOURNALIZED RECEIPT DATE FILE                              01820012
018300*                                                                 01830012
018400     COPY APRD108.                                                01840012
018500/                                                                 01850012
018600*                                                                 01860012
018700*    TNINREC DCLGEN                                               01870012
018800*                                                                 01880012
018900     EXEC SQL                                                     01890012
019000         INCLUDE TNINREC                                          01900012
019100     END-EXEC.                                                    01910012
019200/                                                                 01920012
019300*                                                                 01930012
019400*    TRECEIV DCLGEN                                               01940012
019500*                                                                 01950012
019600     EXEC SQL                                                     01960012
019700         INCLUDE TRECEIV                                          01970012
019800     END-EXEC.                                                    01980012
019900/                                                                 01990012
020000*                                                                 02000012
020100*    TAPCNTL DCLGEN                                               02010012
020200*                                                                 02020012
020300     EXEC SQL                                                     02030012
020400         INCLUDE TAPCNTL                                          02040012
020500     END-EXEC.                                                    02050012
020600/                                                                 02060012
020700*                                                                 02070012
020800*    SQL COMMUNICATIONS AREA DCLGEN                               02080012
020900*                                                                 02090012
021000     EXEC SQL                                                     02100012
021100         INCLUDE SQLCA                                            02110012
021200     END-EXEC.                                                    02120012
021300/                                                                 02130012
021400*----------------------------------------------------------------*02140012
021500*    CURSOR DECLARATIONS                                          02150012
021600*----------------------------------------------------------------*02160012
021700*----------------------------------------------------------------*02170012
021800* NINREC_CSR RETURNS THE TNINREC PO'S TO BE PROCESSED.            02180012
021900*----------------------------------------------------------------*02190012
022000     EXEC SQL                                                     02200012
022100       DECLARE NINREC_CSR CURSOR FOR                              02210012
022200         SELECT                                                   02220012
022300              PO_NBR                                              02230012
022400             ,SUM(NON_INVC_UNT_QTY * UNT_COST_AMT)                02240012
022500         FROM                                                     02250012
022600             TNINREC                                              02260012
022901         WHERE STATUS_CDE        IN (' ','M')                     02290164
022902           AND DATE(REC_TMST)     BETWEEN :PV-START-DATE          02290264
022903                                      AND :PV-END-DATE            02290364
023000         GROUP BY PO_NBR                                          02300012
023100     END-EXEC.                                                    02310012
023200/                                                                 02320012
023300*----------------------------------------------------------------*02330012
023400* RECEIV_CSR RETURNS THE TRECEIV PO'S TO BE PROCESSED.            02340012
023500*----------------------------------------------------------------*02350012
023600     EXEC SQL                                                     02360012
023700       DECLARE RECEIV_CSR CURSOR FOR                              02370012
023800         SELECT                                                   02380012
023900              DISTINCT ORD_NBR                                    02390012
024000         FROM                                                     02400012
024100             TRECEIV                                              02410012
024200         WHERE STATUS_CDE         = 'VE'                          02420012
024300           AND VER_STATUS_CDE     = 'A'                           02430012
024400           AND AP_PRC_CDE         = ' '                           02440012
024500           AND DATE(VERFYD_TMST)  BETWEEN :PV-START-DATE          02450012
024600                                      AND :PV-END-DATE            02460012
024700     END-EXEC.                                                    02470012
024800/                                                                 02480012
024900*----------------------------------------------------------------*02490012
025000*  ABEND DATA AREAS                                              *02500012
025100*----------------------------------------------------------------*02510012
025200 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          02520012
025300                                             COMP SYNC.           02530012
025400     88  AC-DB2-ERROR                        VALUE +4013.         02540012
025500                                                                  02550012
025600 01  ABEND-AREAS.                                                 02560012
025700     05  AA-ABEND-LIT            PIC  X(40)  VALUE                02570012
025800             '*****       ABEND'.                                 02580012
025900     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                02590012
026000             '*****   PROGRAM: APKUT106'.                         02600012
026100     05  AA-PARAGRAPH-LIT.                                        02610012
026200         10  FILLER              PIC  X(17)  VALUE                02620012
026300             '***** PARAGRAPH: '.                                 02630012
026400         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        02640012
026500     05  AA-MESSAGE-LINE.                                         02650012
026600         10  FILLER              PIC  X(06)  VALUE '*****'.       02660012
026700         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        02670012
026800     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                02680012
026900             '*****    DB2 ERROR'.                                02690012
027000     05  AA-DB2-OPERATION-LIT.                                    02700012
027100         10  FILLER              PIC  X(17)  VALUE                02710012
027200             '***** OPERATION: '.                                 02720012
027300         10  AA-DB2-OPERATION.                                    02730012
027400             15  AA-DB2-OP-1     PIC  X(50)  VALUE SPACES.        02740012
027500             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        02750012
027600     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        02760012
027700     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        02770012
027800     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        02780012
027900     05  AA-DB2-TABLE-4          PIC  X(08)  VALUE SPACES.        02790012
028000     05  AA-DB2-TABLE-5          PIC  X(08)  VALUE SPACES.        02800012
028100                                                                  02810012
028200     COPY DPWS004.                                                02820012
028300                                                                  02830012
028400     EJECT                                                        02840012
028500*** GREGORIAN/JULIAN DATE CONVERSION                              02850012
028600     COPY DPWS500.                                                02860012
028700                                                                  02870012
028800 01  FILLER                      PIC  X(25)  VALUE                02880012
028900     '** END OF APKUT106 W/S **'.                                 02890012
029000 EJECT                                                            02900012
029100 PROCEDURE DIVISION.                                              02910012
029200 A100-MAIN.                                                       02920012
029300                                                                  02930012
029400     MOVE 'A100-MAIN' TO PV-CURRENT-PARAGRAPH.                    02940012
029500                                                                  02950012
029600     PERFORM B100-INITIALIZE.                                     02960012
029700                                                                  02970012
029800     SET AP106-NON-INVC-RECEIPT TO TRUE.                          02980012
029900     PERFORM Y100-OPEN-NINREC-CSR.                                02990012
030000     PERFORM R200-FETCH-NINREC.                                   03000012
030010                                                                  03001054
030100     PERFORM B200-PROCESS-NINRECS                                 03010012
030200       UNTIL OUT-OF-NINRECS.                                      03020012
030260                                                                  03026054
030300     PERFORM Y110-CLOSE-NINREC-CSR.                               03030012
030400                                                                  03040012
030500     SET AP106-RECEIVER TO TRUE.                                  03050012
030600     PERFORM Y200-OPEN-RECEIV-CSR.                                03060012
030700     PERFORM R300-FETCH-RECEIV.                                   03070012
030780                                                                  03078054
030800     PERFORM B300-PROCESS-RECEIPTS                                03080012
030900       UNTIL OUT-OF-RECEIPTS.                                     03090012
030970                                                                  03097054
031000     PERFORM Y210-CLOSE-RECEIV-CSR.                               03100012
031100                                                                  03110012
031200     PERFORM B400-END-PROGRAM.                                    03120012
031300                                                                  03130012
031400     GOBACK.                                                      03140012
031500                                                                  03150012
031600 EJECT                                                            03160012
031700*----------------------------------------------------------------*03170012
031800*    INITIALIZATION PROCESSING                                   *03180012
031900*----------------------------------------------------------------*03190012
032000 B100-INITIALIZE.                                                 03200012
032100                                                                  03210012
032200     MOVE 'B100-INITIALIZE' TO PV-CURRENT-PARAGRAPH.              03220012
032300                                                                  03230012
032400     OPEN OUTPUT UNJRNLZD-RECEIPT-PO-FILE                         03240012
032500                 UNJRNLZD-RECEIPT-DATE-FILE.                      03250012
032600                                                                  03260012
032700     MOVE SPACES TO AP106-RECORD.                                 03270012
032800     INITIALIZE DCLTNINREC                                        03280012
032900                DCLTRECEIV                                        03290012
033000                DCLTAPCNTL                                        03300012
033100                AP106-RECORD.                                     03310012
033200                                                                  03320012
033300     ACCEPT PV-CURRENT-DATE  FROM DATE.                           03330012
033400     PERFORM B125-CURRENT-DATE.                                   03340012
033500                                                                  03350012
033600     ACCEPT PV-CONTROL-IN-AREA.                                   03360012
033700                                                                  03370012
033800     IF PV-CONTROL-TYPE = 'P'                                     03380014
033900        PERFORM B175-CALC-PRE-WRITE-OFF-DATES                     03390015
034000        DISPLAY 'PRE-WRITE OFF EXTRACT DATES'                     03400015
034100     ELSE                                                         03410014
034101        IF PV-CONTROL-TYPE = 'U'                                  03410125
034123           PERFORM B180-CALC-NWSTR-UNJRLZD-STRTDT                 03412359
034124           MOVE PV-END-DATE TO PV-TEMP-START-DATE                 03412451
034131           PERFORM B185-CALC-NWSTR-UNJRLZD-END-DT                 03413159
034132           MOVE PV-TEMP-START-DATE TO PV-START-DATE               03413251
034139           DISPLAY 'UNJRNLZD DATES 60-300 DAYS FROM CURR DATE'    03413957
034140        ELSE                                                      03414025
034200          IF PV-CONTROL-TYPE = 'W'                                03420025
034300             PERFORM R100-SELECT-TAPCNTL                          03430025
034400             DISPLAY 'WEEKLY RUN CALCULATED DATES '               03440025
034540          ELSE                                                    03454025
034600            IF PV-CONTROL-TYPE = 'M'                              03460024
034700               PERFORM B150-VALIDATE-DATES                        03470025
034800               DISPLAY 'MONTHLY RUN ENTERED DATES   '             03480025
034900            ELSE                                                  03490024
035000              MOVE 'B100-INITIALIZE'    TO AA-PARAGRAPH-NAME      03500024
035100              MOVE 'CONTROL TYPE MUST BE -P- OR -W- OR -M-      ' 03510014
035200                  TO AA-MESSAGE                                   03520014
035300              PERFORM Z997-ABEND                                  03530014
035400            END-IF                                                03540024
035410          END-IF                                                  03541025
035500        END-IF                                                    03550014
035600     END-IF.                                                      03560014
035700                                                                  03570014
035800     DISPLAY 'BEGINNING DATE = '   PV-START-DATE.                 03580014
035900     DISPLAY 'ENDING DATE    = '   PV-END-DATE.                   03590014
036000                                                                  03600014
036100     MOVE PV-START-DATE             TO AP108-START-DATE.          03610014
036200     MOVE PV-END-DATE               TO AP108-END-DATE.            03620014
036300     WRITE UNJRNLZD-RECEIPT-DATE-RECORD FROM AP108-RECORD.        03630014
036400                                                                  03640014
036500     EJECT                                                        03650014
036600 B125-CURRENT-DATE.                                               03660014
036700                                                                  03670014
036800     MOVE '    -  -  '            TO PV-CURRENT-DATE-10.          03680014
036900     IF PV-CURRENT-YR < 80                                        03690014
037000        MOVE '20'                 TO PV-CURRENT-DATE-10(1:2)      03700014
037100     ELSE                                                         03710014
037200        MOVE '19'                 TO PV-CURRENT-DATE-10(1:2).     03720014
037300                                                                  03730014
037400     MOVE PV-CURRENT-YR           TO PV-CURRENT-DATE-10(3:2).     03740014
037500     MOVE PV-CURRENT-MM           TO PV-CURRENT-DATE-10(6:2).     03750014
037600     MOVE PV-CURRENT-DD           TO PV-CURRENT-DATE-10(9:2).     03760014
037700                                                                  03770014
037800                                                                  03780014
037900 B150-VALIDATE-DATES.                                             03790014
038000                                                                  03800014
038100     MOVE 'B150-VALIDATE-DATES' TO PV-CURRENT-PARAGRAPH.          03810014
038200                                                                  03820014
038300     MOVE PV-CONTROL-DATE-BEGIN(1:4)   TO PV-DATE-YYYY(1:4).      03830014
038400     MOVE PV-CONTROL-DATE-BEGIN(6:2)   TO PV-DATE-MM.             03840014
038500     MOVE PV-CONTROL-DATE-BEGIN(9:2)   TO PV-DATE-DD.             03850014
038600                                                                  03860014
038700     IF PV-YYYYMMDD                   > '19000000'                03870014
038800        SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE                   03880014
038900        SET DPG51-DO-NOT-INCR-DECR-DATE TO TRUE                   03890014
039000        SET DPG52-LK-DTE-ISO            TO TRUE                   03900014
039100        MOVE PV-YYYYMMDD                TO DPG52-LK-DATE-INPUT    03910014
039200        CALL DP500-KOHLS-CALENDAR-ROUTINE                         03920014
039300                                  USING DPG51 DPG52 DPG53         03930014
039400                                        DPG54 DPG55 DPG56         03940014
039500        IF (DPG54-SEVERE-ERROR OR                                 03950014
039600            DPG54-WARNING-ERROR)                                  03960014
039700           DISPLAY 'LK-DATE         ' DPG52-LK-DATE-INPUT         03970014
039800           DISPLAY 'INCR-DECR-DAYS  ' DPG51-INCR-DECR-DAYS-9      03980014
039900           DISPLAY 'CALENDAR-TYPE   ' DPG54-CALENDAR-TYPE-IND     03990014
040000           DISPLAY 'DATE-VALID      ' DPG54-DATE-VALID-IND        04000014
040100           DISPLAY 'CMPR-DATE-VALID ' DPG54-CMPR-DATE-VALID-IND   04010014
040200           DISPLAY 'INCR-DECR-IND   ' DPG54-INCR-DECR-IND         04020014
040300           DISPLAY 'ERROR-IND       ' DPG54-ERROR-IND             04030014
040400           DISPLAY                    DPG54-ERROR-MESSAGE         04040014
040500                                                                  04050014
040600           MOVE 'B150-VALIDATE-'     TO AA-PARAGRAPH-NAME         04060014
040700           MOVE 'UNSUCCESSFUL DATE CONVERSION BEGINNIG DATE  '    04070014
040800               TO AA-MESSAGE                                      04080014
040900           PERFORM Z997-ABEND                                     04090014
041000        ELSE                                                      04100014
041100            MOVE '    -  -  '            TO PV-START-DATE         04110014
041200            MOVE DPG55-DB2-ISO-DATE(1:4) TO PV-START-DATE(1:4)    04120014
041300            MOVE DPG55-DB2-ISO-DATE(5:2) TO PV-START-DATE(6:2)    04130014
041400            MOVE DPG55-DB2-ISO-DATE(7:2) TO PV-START-DATE(9:2)    04140014
041500        END-IF                                                    04150014
041600     END-IF.                                                      04160014
041700                                                                  04170014
041800     MOVE PV-CONTOL-DATE-ENDING(1:4)   TO PV-DATE-YYYY(1:4).      04180014
041900     MOVE PV-CONTOL-DATE-ENDING(6:2)   TO PV-DATE-MM.             04190014
042000     MOVE PV-CONTOL-DATE-ENDING(9:2)   TO PV-DATE-DD.             04200014
042100                                                                  04210014
042200     IF PV-YYYYMMDD                   > '19000000'                04220014
042300        SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE                    04230014
042400        SET DPG51-DO-NOT-INCR-DECR-DATE TO TRUE                   04240014
042500        SET DPG52-LK-DTE-ISO           TO TRUE                    04250014
042600        MOVE PV-YYYYMMDD               TO DPG52-LK-DATE-INPUT     04260014
042700        CALL DP500-KOHLS-CALENDAR-ROUTINE                         04270014
042800                                  USING DPG51 DPG52 DPG53         04280014
042900                                        DPG54 DPG55 DPG56         04290014
043000        IF (DPG54-SEVERE-ERROR OR                                 04300014
043100            DPG54-WARNING-ERROR)                                  04310014
043200           DISPLAY 'LK-DATE         ' DPG52-LK-DATE-INPUT         04320014
043300           DISPLAY 'INCR-DECR-DAYS  ' DPG51-INCR-DECR-DAYS-9      04330014
043400           DISPLAY 'CALENDAR-TYPE   ' DPG54-CALENDAR-TYPE-IND     04340014
043500           DISPLAY 'DATE-VALID      ' DPG54-DATE-VALID-IND        04350014
043600           DISPLAY 'CMPR-DATE-VALID ' DPG54-CMPR-DATE-VALID-IND   04360014
043700           DISPLAY 'INCR-DECR-IND   ' DPG54-INCR-DECR-IND         04370014
043800           DISPLAY 'ERROR-IND       ' DPG54-ERROR-IND             04380014
043900           DISPLAY                    DPG54-ERROR-MESSAGE         04390014
044000                                                                  04400014
044100           MOVE 'B150-VALIDATE-'     TO AA-PARAGRAPH-NAME         04410014
044200           MOVE 'UNSUCCESSFUL DATE CONVERSION ENDING DATE    '    04420014
044300               TO AA-MESSAGE                                      04430014
044400           PERFORM Z997-ABEND                                     04440014
044500        ELSE                                                      04450014
044600            MOVE '    -  -  '            TO PV-END-DATE           04460014
044700            MOVE DPG55-DB2-ISO-DATE(1:4) TO PV-END-DATE(1:4)      04470014
044800            MOVE DPG55-DB2-ISO-DATE(5:2) TO PV-END-DATE(6:2)      04480014
044900            MOVE DPG55-DB2-ISO-DATE(7:2) TO PV-END-DATE(9:2)      04490014
045000        END-IF                                                    04500014
045100     END-IF.                                                      04510014
045200                                                                  04520014
045300     IF PV-END-DATE   > PV-CURRENT-DATE-10  OR                    04530014
045400        PV-START-DATE > PV-CURRENT-DATE-10                        04540014
045500        MOVE 'B150-VALIDATE-'     TO AA-PARAGRAPH-NAME            04550014
045600        MOVE 'END AND/OR START DATES > THAN CURRENT DATE  '       04560014
045700            TO AA-MESSAGE                                         04570014
045800        PERFORM Z997-ABEND                                        04580014
045900     END-IF.                                                      04590014
046000                                                                  04600014
046100     IF PV-END-DATE < PV-START-DATE                               04610014
046200        MOVE 'B150-VALIDATE-'     TO AA-PARAGRAPH-NAME            04620014
046300        MOVE 'END DATE PRIOR TO START DATE '                      04630014
046400            TO AA-MESSAGE                                         04640014
046500        PERFORM Z997-ABEND                                        04650014
046600     END-IF.                                                      04660014
046700                                                                  04670014
046800     MOVE PV-CURRENT-DATE-10(1:4)      TO PV-DATE-YYYY(1:4).      04680014
046900     MOVE PV-CURRENT-DATE-10(6:2)      TO PV-DATE-MM.             04690014
047000     MOVE PV-CURRENT-DATE-10(9:2)      TO PV-DATE-DD.             04700014
047100                                                                  04710014
047200     IF PV-YYYYMMDD                   > '19000000'                04720014
047300        SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE                    04730014
047400        SET DPG51-DECREMENT-DATE       TO TRUE                    04740014
047500        SET DPG52-LK-DTE-ISO           TO TRUE                    04750014
047600        MOVE 7                         TO DPG51-INCR-DECR-DAYS-9  04760014
047700        MOVE PV-YYYYMMDD               TO DPG52-LK-DATE-INPUT     04770014
047800        CALL DP500-KOHLS-CALENDAR-ROUTINE                         04780014
047900                                  USING DPG51 DPG52 DPG53         04790014
048000                                        DPG54 DPG55 DPG56         04800014
048100        IF (DPG54-SEVERE-ERROR OR                                 04810014
048200            DPG54-WARNING-ERROR)                                  04820014
048300           DISPLAY 'LK-DATE         ' DPG52-LK-DATE-INPUT         04830014
048400           DISPLAY 'INCR-DECR-DAYS  ' DPG51-INCR-DECR-DAYS-9      04840014
048500           DISPLAY 'CALENDAR-TYPE   ' DPG54-CALENDAR-TYPE-IND     04850014
048600           DISPLAY 'DATE-VALID      ' DPG54-DATE-VALID-IND        04860014
048700           DISPLAY 'CMPR-DATE-VALID ' DPG54-CMPR-DATE-VALID-IND   04870014
048800           DISPLAY 'INCR-DECR-IND   ' DPG54-INCR-DECR-IND         04880014
048900           DISPLAY 'ERROR-IND       ' DPG54-ERROR-IND             04890014
049000           DISPLAY                    DPG54-ERROR-MESSAGE         04900014
049100                                                                  04910014
049200           MOVE 'B150-VALIDATE-'     TO AA-PARAGRAPH-NAME         04920014
049300           MOVE 'UNSUCCESSFUL DATE CONVERSION CURRENT DATE-7 '    04930015
049400               TO AA-MESSAGE                                      04940014
049500           PERFORM Z997-ABEND                                     04950014
049600        ELSE                                                      04960014
049700           MOVE '    -  -  '            TO PV-CURRENT-DECR7       04970014
049800           MOVE DPG55-DB2-ISO-DATE(1:4) TO PV-CURRENT-DECR7(1:4)  04980014
049900           MOVE DPG55-DB2-ISO-DATE(5:2) TO PV-CURRENT-DECR7(6:2)  04990014
050000           MOVE DPG55-DB2-ISO-DATE(7:2) TO PV-CURRENT-DECR7(9:2)  05000014
050100        END-IF                                                    05010014
050200     END-IF.                                                      05020014
050300                                                                  05030014
050400     IF PV-END-DATE < PV-CURRENT-DECR7                            05040014
050500        MOVE 'B150-VALIDATE-'     TO AA-PARAGRAPH-NAME            05050014
050600        MOVE 'END DATE MORE THAN 7 DAYS PRIOR TO CURRENT  '       05060014
050700            TO AA-MESSAGE                                         05070014
050800        PERFORM Z997-ABEND                                        05080014
050900     END-IF.                                                      05090014
051000                                                                  05100014
051100 EJECT                                                            05110014
051200*----------------------------------------------------------------*05120014
051300*    CALCULATES THE START AND END DATES FOR THE PRE-WRITE OFF    *05130018
051400*    EXTRACT OF UNJOURNALIZED RECEIPTS.                          *05140018
051500*----------------------------------------------------------------*05150014
051600 B175-CALC-PRE-WRITE-OFF-DATES.                                   05160015
051700                                                                  05170014
051800     MOVE 'B175-CALC-PRE-WRITE-OFF-DATES' TO                      05180017
051900          PV-CURRENT-PARAGRAPH.                                   05190016
052000                                                                  05200014
052100     MOVE '0001-01-01' TO PV-START-DATE.                          05210015
052200                                                                  05220015
052300     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         05230019
052400*    SET DPG51-ACTUAL-CALENDAR-ONLY                               05240019
052500     SET DPG51-FISCAL-454-CALENDAR                                05250019
052600         DPG51-DECREMENT-DATE                                     05260015
052700         DPG52-LK-DTE-ISO-FMT       TO TRUE.                      05270019
052800     MOVE 300                       TO DPG51-INCR-DECR-DAYS-9.    05280019
052900     MOVE PV-CURRENT-DATE-10        TO DPG52-LK-DATE-INPUT.       05290015
053000                                                                  05300019
053100     CALL DP500-KOHLS-CALENDAR-ROUTINE                            05310019
053200         USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.               05320019
053300                                                                  05330019
053400     IF (DPG54-SEVERE-ERROR OR                                    05340015
053500         DPG54-WARNING-ERROR)                                     05350015
053600        DISPLAY 'LK-DATE         ' DPG52-LK-DATE-INPUT            05360015
053700        DISPLAY 'INCR-DECR-DAYS  ' DPG51-INCR-DECR-DAYS-9         05370015
053800        DISPLAY 'DB2-ISO-DATE    ' DPG55-DB2-ISO-DATE-FMT         05380019
053900        DISPLAY 'CALENDAR-TYPE   ' DPG54-CALENDAR-TYPE-IND        05390015
054000        DISPLAY 'DATE-VALID      ' DPG54-DATE-VALID-IND           05400015
054100        DISPLAY 'CMPR-DATE-VALID ' DPG54-CMPR-DATE-VALID-IND      05410015
054200        DISPLAY 'INCR-DECR-IND   ' DPG54-INCR-DECR-IND            05420015
054300        DISPLAY 'ERROR-IND       ' DPG54-ERROR-IND                05430015
054400        DISPLAY                    DPG54-ERROR-MESSAGE            05440015
054500                                                                  05450015
054600        MOVE 'B175-CALC-PRE-WRITE-OFF-DATES' TO AA-PARAGRAPH-NAME 05460015
054700        MOVE 'UNSUCCESSFUL DATE CONVERSION CURRENT DATE   '       05470015
054800            TO AA-MESSAGE                                         05480015
054900        PERFORM Z997-ABEND                                        05490015
055000     ELSE                                                         05500015
055100        MOVE DPG55-DB2-ISO-DATE-FMT TO PV-END-DATE                05510019
055200*       MOVE '    -  -  '            TO PV-END-DATE               05520019
055300*       MOVE DPG55-DB2-ISO-DATE(1:4) TO PV-END-DATE(1:4)          05530019
055400*       MOVE DPG55-DB2-ISO-DATE(5:2) TO PV-END-DATE(6:2)          05540019
055500*       MOVE DPG55-DB2-ISO-DATE(7:2) TO PV-END-DATE(9:2)          05550019
055600     END-IF.                                                      05560015
055604                                                                  05560424
055610 EJECT                                                            05561024
055620*------------------------------------------------------------     05562057
055630*    CALCULATES THE START DATE FOR THE 60 - 300 DATE RANGE  *     05563057
055631*    OF NEW STORES UNJOURNALIZED RECEIPTS. THE START DATE   *     05563157
055632*    IS 300 DAYS BEFORE THE CURRENT DATE.                   *     05563257
055650*------------------------------------------------------------     05565057
055660 B180-CALC-NWSTR-UNJRLZD-STRTDT.                                  05566059
055670                                                                  05567047
055680     MOVE 'B180-CALC-NWSTR-UNJRLZD-STRTDT' TO                     05568059
055690          PV-CURRENT-PARAGRAPH.                                   05569047
055700                                                                  05570047
055710     MOVE '0001-01-01' TO PV-START-DATE.                          05571047
055720                                                                  05572047
055730     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         05573047
055740*    SET DPG51-ACTUAL-CALENDAR-ONLY                               05574047
055741     SET DPG51-FISCAL-454-CALENDAR                                05574147
055742         DPG51-DECREMENT-DATE                                     05574247
055743         DPG52-LK-DTE-ISO-FMT       TO TRUE.                      05574347
055744     MOVE 300                       TO DPG51-INCR-DECR-DAYS-9.    05574450
055745     MOVE PV-CURRENT-DATE-10        TO DPG52-LK-DATE-INPUT.       05574547
055746                                                                  05574647
055747     CALL DP500-KOHLS-CALENDAR-ROUTINE                            05574747
055748         USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.               05574847
055749                                                                  05574947
055750     IF (DPG54-SEVERE-ERROR OR                                    05575047
055751         DPG54-WARNING-ERROR)                                     05575147
055752        DISPLAY 'LK-DATE         ' DPG52-LK-DATE-INPUT            05575247
055753        DISPLAY 'INCR-DECR-DAYS  ' DPG51-INCR-DECR-DAYS-9         05575347
055754        DISPLAY 'DB2-ISO-DATE    ' DPG55-DB2-ISO-DATE-FMT         05575447
055755        DISPLAY 'CALENDAR-TYPE   ' DPG54-CALENDAR-TYPE-IND        05575547
055756        DISPLAY 'DATE-VALID      ' DPG54-DATE-VALID-IND           05575647
055757        DISPLAY 'CMPR-DATE-VALID ' DPG54-CMPR-DATE-VALID-IND      05575747
055758        DISPLAY 'INCR-DECR-IND   ' DPG54-INCR-DECR-IND            05575847
055759        DISPLAY 'ERROR-IND       ' DPG54-ERROR-IND                05575947
055760        DISPLAY                    DPG54-ERROR-MESSAGE            05576047
055761                                                                  05576147
055762        MOVE 'B180-CALC-NWSTR-UNJRLZD-STRTDT'                     05576259
055763                                    TO  AA-PARAGRAPH-NAME         05576357
055764        MOVE 'UNSUCCESSFUL DATE CONVERSION CURRENT DATE   '       05576447
055765            TO AA-MESSAGE                                         05576547
055766        PERFORM Z997-ABEND                                        05576647
055767     ELSE                                                         05576747
055768        MOVE DPG55-DB2-ISO-DATE-FMT TO PV-END-DATE                05576847
055769*       MOVE '    -  -  '            TO PV-END-DATE               05576947
055770*       MOVE DPG55-DB2-ISO-DATE(1:4) TO PV-END-DATE(1:4)          05577047
055771*       MOVE DPG55-DB2-ISO-DATE(5:2) TO PV-END-DATE(6:2)          05577147
055772*       MOVE DPG55-DB2-ISO-DATE(7:2) TO PV-END-DATE(9:2)          05577247
055773     END-IF.                                                      05577347
055780                                                                  05578047
055781 EJECT                                                            05578147
055782*----------------------------------------------------------------*05578247
055785*    CALCULATES THE END DATE FOR THE 60 - 300 DATE RANGE         *05578557
055786*    OF NEW STORES UNJOURNALIZED RECEIPTS. THE END DATE          *05578657
055787*    IS 60 DAYS BEFORE THE CURRENT DATE.                         *05578757
055790*----------------------------------------------------------------*05579031
055792 B185-CALC-NWSTR-UNJRLZD-END-DT.                                  05579259
055793                                                                  05579347
055794     MOVE 'B185-CALC-NWSTR-UNJRLZD-END-DT' TO                     05579459
055795          PV-CURRENT-PARAGRAPH.                                   05579547
055796                                                                  05579647
055797     MOVE '0001-01-01' TO PV-START-DATE.                          05579747
055798                                                                  05579847
055799     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         05579947
055800*    SET DPG51-ACTUAL-CALENDAR-ONLY                               05580047
055801     SET DPG51-FISCAL-454-CALENDAR                                05580147
055802         DPG51-DECREMENT-DATE                                     05580247
055803         DPG52-LK-DTE-ISO-FMT       TO TRUE.                      05580347
055804     MOVE 60                        TO DPG51-INCR-DECR-DAYS-9.    05580450
055805     MOVE PV-CURRENT-DATE-10        TO DPG52-LK-DATE-INPUT.       05580547
055806                                                                  05580647
055807     CALL DP500-KOHLS-CALENDAR-ROUTINE                            05580747
055808         USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.               05580847
055809                                                                  05580947
055810     IF (DPG54-SEVERE-ERROR OR                                    05581047
055811         DPG54-WARNING-ERROR)                                     05581147
055812        DISPLAY 'LK-DATE         ' DPG52-LK-DATE-INPUT            05581247
055813        DISPLAY 'INCR-DECR-DAYS  ' DPG51-INCR-DECR-DAYS-9         05581347
055814        DISPLAY 'DB2-ISO-DATE    ' DPG55-DB2-ISO-DATE-FMT         05581447
055815        DISPLAY 'CALENDAR-TYPE   ' DPG54-CALENDAR-TYPE-IND        05581547
055816        DISPLAY 'DATE-VALID      ' DPG54-DATE-VALID-IND           05581647
055817        DISPLAY 'CMPR-DATE-VALID ' DPG54-CMPR-DATE-VALID-IND      05581747
055818        DISPLAY 'INCR-DECR-IND   ' DPG54-INCR-DECR-IND            05581847
055819        DISPLAY 'ERROR-IND       ' DPG54-ERROR-IND                05581947
055820        DISPLAY                    DPG54-ERROR-MESSAGE            05582047
055821                                                                  05582147
055822        MOVE 'B185-CALC-NWSTR-UNJRLZD-END-DT'                     05582259
055823                                     TO AA-PARAGRAPH-NAME         05582357
055824        MOVE 'UNSUCCESSFUL DATE CONVERSION CURRENT DATE   '       05582457
055825            TO AA-MESSAGE                                         05582557
055826        PERFORM Z997-ABEND                                        05582657
055827     ELSE                                                         05582757
055828        MOVE DPG55-DB2-ISO-DATE-FMT TO PV-END-DATE                05582857
055829*       MOVE '    -  -  '            TO PV-END-DATE               05582957
055830*       MOVE DPG55-DB2-ISO-DATE(1:4) TO PV-END-DATE(1:4)          05583057
055831*       MOVE DPG55-DB2-ISO-DATE(5:2) TO PV-END-DATE(6:2)          05583157
055832*       MOVE DPG55-DB2-ISO-DATE(7:2) TO PV-END-DATE(9:2)          05583257
055833     END-IF.                                                      05583357
055893                                                                  05589345
055894 EJECT                                                            05589439
055900*----------------------------------------------------------------*05590015
056000*    CREATES UNJOURNALIZED RECEIPT PO FILE RECORDS FROM TNINREC. *05600015
056100*    CALLED FROM A100-MAIN                                       *05610015
056200*----------------------------------------------------------------*05620015
056300 B200-PROCESS-NINRECS.                                            05630015
056400                                                                  05640015
056500     MOVE 'B200-PROCESS-NINRECS'    TO PV-CURRENT-PARAGRAPH.      05650015
056600                                                                  05660015
056700     PERFORM W100-WRITE-UNJRNLZD-PO-REC.                          05670015
056800     ADD +1 TO PV-PO-NINREC-CNT.                                  05680015
056900                                                                  05690015
057000     PERFORM R200-FETCH-NINREC.                                   05700015
057100                                                                  05710015
057200 EJECT                                                            05720015
057300*----------------------------------------------------------------*05730015
057400*    CREATES UNJOURNALIZED RECEIPT PO FILE RECORDS FROM TRECEIV. *05740015
057500*    CALLED FROM A100-MAIN                                       *05750015
057600*----------------------------------------------------------------*05760015
057700 B300-PROCESS-RECEIPTS.                                           05770015
057800                                                                  05780015
057900     MOVE 'B300-PROCESS-RECEIPTS'   TO PV-CURRENT-PARAGRAPH.      05790036
058000                                                                  05800015
058100     PERFORM W100-WRITE-UNJRNLZD-PO-REC.                          05810015
058200     ADD +1 TO PV-PO-RECEIV-CNT.                                  05820015
058300                                                                  05830015
058301     PERFORM R300-FETCH-RECEIV.                                   05830164
058500                                                                  05850015
058600 EJECT                                                            05860015
058700*----------------------------------------------------------------*05870015
058800*    ENDING PROCESSING: DISPLAYS COUNT OF POS AND CLOSES FILES.  *05880015
058900*    CALLED FROM A100-MAIN                                       *05890015
059000*----------------------------------------------------------------*05900015
059100 B400-END-PROGRAM.                                                05910015
059200                                                                  05920015
059300     MOVE 'B400-END-PROGRAM' TO PV-CURRENT-PARAGRAPH.             05930015
059400                                                                  05940015
059500     DISPLAY 'NBR OF PO RECS FROM TNINREC = ' PV-PO-NINREC-CNT.   05950015
059600     DISPLAY 'NBR OF PO RECS FROM TRECEIV = ' PV-PO-RECEIV-CNT.   05960015
059700                                                                  05970015
059800     CLOSE UNJRNLZD-RECEIPT-PO-FILE                               05980015
059900           UNJRNLZD-RECEIPT-DATE-FILE.                            05990015
060000                                                                  06000015
060100 EJECT                                                            06010015
060200*----------------------------------------------------------------*06020015
060300*    CALCULATES THE START AND END DATES FOR UNJOURNALIZED        *06030015
060400*    RECEIPTS BASED ON THE CURRENT DATE AND THE MAX AND MIN      *06040015
060500*    UNJOURNALIZED NIR DAYS ON TAPCNTL.                          *06050015
060600*----------------------------------------------------------------*06060015
060700 R100-SELECT-TAPCNTL.                                             06070015
060800                                                                  06080015
060900     MOVE 'R100-SELECT-TAPCNTL' TO PV-CURRENT-PARAGRAPH.          06090015
061000                                                                  06100015
061100     PERFORM WITH TEST AFTER                                      06110015
061200             VARYING PV-RETRY-COUNT FROM 1 BY 1                   06120015
061300             UNTIL   PV-RETRY-COUNT > PC-RETRY-MAX OR             06130015
061400                     SQLCODE = ZERO                               06140015
061500                                                                  06150015
061600             EXEC SQL                                             06160015
061700                 SELECT CURRENT DATE - UJ_NIR_MIN_DAY_QTY DAYS    06170015
061800                       ,CURRENT DATE - UJ_NIR_MAX_DAY_QTY DAYS    06180015
061900                 INTO   :PV-END-DATE                              06190015
062000                       ,:PV-START-DATE                            06200015
062100                 FROM   TAPCNTL                                   06210015
062200             END-EXEC                                             06220015
062300                                                                  06230015
062400             EVALUATE TRUE                                        06240015
062500                 WHEN SQLCODE = ZERO                              06250015
062600                 WHEN SQLCODE = -904                              06260015
062700                 WHEN SQLCODE = -911                              06270015
062800                 WHEN SQLCODE = -913                              06280015
062900                      CONTINUE                                    06290015
063000                                                                  06300015
063100                 WHEN SQLWARN0 NOT = SPACES                       06310015
063200                 WHEN SQLCODE  NOT = ZERO                         06320015
063300                     MOVE PV-CURRENT-PARAGRAPH                    06330015
063400                                      TO AA-PARAGRAPH-NAME        06340015
063500                     MOVE 'UNSUCCESSFUL SELECT FOR TAPCNTL'       06350015
063600                                      TO AA-DB2-OP-1              06360015
063700                     MOVE 'TAPCNTL'   TO AA-DB2-TABLE-1           06370015
063800                     MOVE SPACES      TO AA-DB2-TABLE-2           06380015
063900                                         AA-DB2-TABLE-3           06390015
064000                                         AA-DB2-TABLE-4           06400015
064100                                         AA-DB2-TABLE-5           06410015
064200                     PERFORM Z998-DB2-ABEND                       06420015
064300             END-EVALUATE                                         06430015
064400     END-PERFORM.                                                 06440015
064500                                                                  06450015
064600     IF PV-RETRY-COUNT > PC-RETRY-MAX                             06460015
064700         MOVE PV-CURRENT-PARAGRAPH TO AA-PARAGRAPH-NAME           06470015
064800         MOVE 'MAX RETRIES EXCEEDED ON SELECT FOR TAPCNTL'        06480015
064900                                   TO AA-DB2-OP-1                 06490015
065000         MOVE 'TAPCNTL'            TO AA-DB2-TABLE-1              06500015
065100         MOVE SPACES               TO AA-DB2-TABLE-2              06510015
065200                                      AA-DB2-TABLE-3              06520015
065300                                      AA-DB2-TABLE-4              06530015
065400                                      AA-DB2-TABLE-5              06540015
065500         PERFORM Z998-DB2-ABEND                                   06550015
065600     END-IF.                                                      06560015
065700                                                                  06570015
065800 EJECT                                                            06580015
065900*----------------------------------------------------------------*06590015
066000*    RETRIEVES AN UNJOURNALIZED NINREC ROW.                       06600015
066100*----------------------------------------------------------------*06610015
066200 R200-FETCH-NINREC.                                               06620015
066300                                                                  06630015
066400     MOVE ' R200-FETCH-PRICE-CLAIM' TO PV-CURRENT-PARAGRAPH.      06640015
066500                                                                  06650015
066600     EXEC SQL                                                     06660015
066700         FETCH NINREC_CSR                                         06670015
066800         INTO :PV-PO-NBR                                          06680015
066900             ,:PV-NR-TOTAL-COST                                   06690015
067000     END-EXEC.                                                    06700015
067100                                                                  06710015
067200     EVALUATE TRUE                                                06720015
067300         WHEN SQLCODE = +100                                      06730015
067400              SET OUT-OF-NINRECS TO TRUE                          06740015
067500         WHEN SQLCODE = ZERO                                      06750015
067600              CONTINUE                                            06760015
067700                                                                  06770015
067800         WHEN SQLWARN0 NOT = SPACES                               06780015
067900         WHEN SQLCODE  NOT = ZERO                                 06790015
068000             MOVE PV-CURRENT-PARAGRAPH                            06800015
068100                              TO AA-PARAGRAPH-NAME                06810015
068200             MOVE 'UNSUCCESSFUL FETCH WITH NINREC CSR'            06820015
068300                              TO AA-DB2-OP-1                      06830015
068400             MOVE 'TNINREC'   TO AA-DB2-TABLE-1                   06840015
068500             MOVE SPACES      TO AA-DB2-TABLE-2                   06850015
068600                                 AA-DB2-TABLE-3                   06860015
068700                                 AA-DB2-TABLE-4                   06870015
068800                                 AA-DB2-TABLE-5                   06880015
068900             PERFORM Z998-DB2-ABEND                               06890015
069000     END-EVALUATE.                                                06900015
069100                                                                  06910015
069200 EJECT                                                            06920015
069300*----------------------------------------------------------------*06930015
069400*    RETRIEVES AN UNJOURNALIZED RECEIVER ROW.                     06940015
069500*----------------------------------------------------------------*06950015
069600 R300-FETCH-RECEIV.                                               06960015
069730                                                                  06973037
069800     MOVE ' R300-FETCH-PRICE-CLAIM' TO PV-CURRENT-PARAGRAPH.      06980015
069810                                                                  06981037
070000     EXEC SQL                                                     07000015
070100         FETCH RECEIV_CSR                                         07010015
070200         INTO :PV-PO-NBR                                          07020015
070300     END-EXEC.                                                    07030015
070400                                                                  07040015
070500     EVALUATE TRUE                                                07050015
070600         WHEN SQLCODE = +100                                      07060015
070700              SET OUT-OF-RECEIPTS TO TRUE                         07070015
070800         WHEN SQLCODE = ZERO                                      07080015
070900         WHEN SQLCODE = -904                                      07090015
071000         WHEN SQLCODE = -911                                      07100015
071100         WHEN SQLCODE = -913                                      07110015
071200              CONTINUE                                            07120015
071300                                                                  07130015
071400         WHEN SQLWARN0 NOT = SPACES                               07140015
071500         WHEN SQLCODE  NOT = ZERO                                 07150015
071600             MOVE PV-CURRENT-PARAGRAPH                            07160015
071700                              TO AA-PARAGRAPH-NAME                07170015
071800             MOVE 'UNSUCCESSFUL FETCH WITH RECEIV CSR'            07180015
071900                              TO AA-DB2-OP-1                      07190015
072000             MOVE 'TRECEIV'   TO AA-DB2-TABLE-1                   07200015
072100             MOVE SPACES      TO AA-DB2-TABLE-2                   07210015
072200                                 AA-DB2-TABLE-3                   07220015
072300                                 AA-DB2-TABLE-4                   07230015
072400                                 AA-DB2-TABLE-5                   07240015
072500             PERFORM Z998-DB2-ABEND                               07250015
072600     END-EVALUATE.                                                07260015
072700                                                                  07270015
072800 EJECT                                                            07280015
072900*----------------------------------------------------------------*07290015
073000*    WRITES THE UNJOURNALIZED RECEIPT PO FILE RECORDS.           *07300015
073100*----------------------------------------------------------------*07310015
073200 W100-WRITE-UNJRNLZD-PO-REC.                                      07320015
073300                                                                  07330015
073400     MOVE 'W100-WRITE-UNJRNLZD-PO-REC' TO PV-CURRENT-PARAGRAPH.   07340015
073500                                                                  07350015
073600     MOVE PV-PO-NBR                TO AP106-PO-NBR.               07360020
073700     IF AP106-NON-INVC-RECEIPT                                    07370015
073800         COMPUTE AP106-NR-TOTAL-COST ROUNDED = PV-NR-TOTAL-COST   07380015
073900     ELSE                                                         07390015
074000         MOVE ZERO                 TO AP106-NR-TOTAL-COST.        07400015
074100                                                                  07410015
074200     WRITE UNJRNLZD-RECEIPT-PO-RECORD FROM AP106-RECORD.          07420015
074300                                                                  07430015
074400 EJECT                                                            07440015
074500*----------------------------------------------------------------*07450015
074600*    OPENS THE NINREC CURSOR.                                    *07460015
074700*----------------------------------------------------------------*07470015
074800 Y100-OPEN-NINREC-CSR.                                            07480015
074900                                                                  07490015
075000     MOVE 'Y100-OPEN-NINREC-CSR' TO PV-CURRENT-PARAGRAPH.         07500015
075100                                                                  07510015
075200     PERFORM WITH TEST AFTER                                      07520015
075300             VARYING PV-RETRY-COUNT FROM 1 BY 1                   07530015
075400             UNTIL   PV-RETRY-COUNT > PC-RETRY-MAX OR             07540015
075500                     SQLCODE = ZERO                               07550015
075600                                                                  07560015
075700             EXEC SQL                                             07570015
075800                 OPEN NINREC_CSR                                  07580015
075900             END-EXEC                                             07590015
076000                                                                  07600015
076100             EVALUATE TRUE                                        07610015
076200                 WHEN SQLCODE = ZERO                              07620015
076300                 WHEN SQLCODE = -904                              07630015
076400                 WHEN SQLCODE = -911                              07640015
076500                 WHEN SQLCODE = -913                              07650015
076600                      CONTINUE                                    07660015
076700                                                                  07670015
076800                 WHEN SQLWARN0 NOT = SPACES                       07680015
076900                 WHEN SQLCODE  NOT = ZERO                         07690015
077000                     MOVE PV-CURRENT-PARAGRAPH                    07700015
077100                                         TO AA-PARAGRAPH-NAME     07710015
077200                     MOVE 'UNSUCCESSFUL OPEN ON NINREC_CSR'       07720015
077300                                         TO AA-DB2-OPERATION      07730015
077400                     MOVE 'TNINREC'      TO AA-DB2-TABLE-1        07740015
077500                     MOVE SPACES         TO AA-DB2-TABLE-2        07750015
077600                                            AA-DB2-TABLE-3        07760015
077700                                            AA-DB2-TABLE-4        07770015
077800                                            AA-DB2-TABLE-5        07780015
077900                     PERFORM Z998-DB2-ABEND                       07790015
078000             END-EVALUATE                                         07800015
078100     END-PERFORM.                                                 07810015
078200                                                                  07820015
078300     IF PV-RETRY-COUNT > PC-RETRY-MAX                             07830015
078400         MOVE PV-CURRENT-PARAGRAPH                                07840015
078500                             TO AA-PARAGRAPH-NAME                 07850015
078600         MOVE 'MAX RETRIES EXCEEDED ON OPEN FOR NINREC_CSR'       07860015
078700                             TO AA-DB2-OPERATION                  07870015
078800         MOVE 'TNINREC'      TO AA-DB2-TABLE-1                    07880015
078900         MOVE SPACES         TO AA-DB2-TABLE-2                    07890015
079000                                AA-DB2-TABLE-3                    07900015
079100                                AA-DB2-TABLE-4                    07910015
079200                                AA-DB2-TABLE-5                    07920015
079300         PERFORM Z998-DB2-ABEND                                   07930015
079400     END-IF.                                                      07940015
079500                                                                  07950015
079600 EJECT                                                            07960015
079700*----------------------------------------------------------------*07970015
079800*    CLOSES THE NINREC CURSOR                                    *07980015
079900*----------------------------------------------------------------*07990015
080000 Y110-CLOSE-NINREC-CSR.                                           08000015
080100                                                                  08010015
080200     MOVE 'Y110-CLOSE-NINREC-CSR' TO PV-CURRENT-PARAGRAPH.        08020015
080300                                                                  08030015
080400     PERFORM WITH TEST AFTER                                      08040015
080500             VARYING PV-RETRY-COUNT FROM 1 BY 1                   08050015
080600             UNTIL   PV-RETRY-COUNT > PC-RETRY-MAX OR             08060015
080700                     SQLCODE = ZERO                               08070015
080800                                                                  08080015
080900             EXEC SQL                                             08090015
081000                 CLOSE NINREC_CSR                                 08100015
081100             END-EXEC                                             08110015
081200                                                                  08120015
081300             EVALUATE TRUE                                        08130015
081400                 WHEN SQLCODE = ZERO                              08140015
081500                 WHEN SQLCODE = -904                              08150015
081600                 WHEN SQLCODE = -911                              08160015
081700                 WHEN SQLCODE = -913                              08170015
081800                      CONTINUE                                    08180015
081900                                                                  08190015
082000                 WHEN SQLWARN0 NOT = SPACES                       08200015
082100                 WHEN SQLCODE  NOT = ZERO                         08210015
082200                     MOVE PV-CURRENT-PARAGRAPH                    08220015
082300                                         TO AA-PARAGRAPH-NAME     08230015
082400                     MOVE 'UNSUCCESSFUL CLOSE ON NINREC_CSR'      08240015
082500                                         TO AA-DB2-OPERATION      08250015
082600                     MOVE 'TNINREC'      TO AA-DB2-TABLE-1        08260015
082700                     MOVE SPACES         TO AA-DB2-TABLE-2        08270015
082800                                            AA-DB2-TABLE-3        08280015
082900                                            AA-DB2-TABLE-4        08290015
083000                                            AA-DB2-TABLE-5        08300015
083100                     PERFORM Z998-DB2-ABEND                       08310015
083200             END-EVALUATE                                         08320015
083300     END-PERFORM.                                                 08330015
083400                                                                  08340015
083500     IF PV-RETRY-COUNT > PC-RETRY-MAX                             08350015
083600         MOVE PV-CURRENT-PARAGRAPH                                08360015
083700                             TO AA-PARAGRAPH-NAME                 08370015
083800         MOVE 'MAX RETRIES EXCEEDED ON CLOSE FOR NINREC_CSR'      08380015
083900                             TO AA-DB2-OPERATION                  08390015
084000         MOVE 'TNINREC'      TO AA-DB2-TABLE-1                    08400015
084100         MOVE SPACES         TO AA-DB2-TABLE-2                    08410015
084200                                AA-DB2-TABLE-3                    08420015
084300                                AA-DB2-TABLE-4                    08430015
084400                                AA-DB2-TABLE-5                    08440015
084500         PERFORM Z998-DB2-ABEND                                   08450015
084600     END-IF.                                                      08460015
084700                                                                  08470015
084800 EJECT                                                            08480015
084900*----------------------------------------------------------------*08490015
085000*    OPENS THE RECEIVE CURSOR.                                   *08500015
085100*----------------------------------------------------------------*08510015
085200 Y200-OPEN-RECEIV-CSR.                                            08520015
085300                                                                  08530015
085400     MOVE 'Y200-OPEN-RECEIV-CSR' TO PV-CURRENT-PARAGRAPH.         08540015
085500                                                                  08550015
085600     PERFORM WITH TEST AFTER                                      08560015
085700             VARYING PV-RETRY-COUNT FROM 1 BY 1                   08570015
085800             UNTIL   PV-RETRY-COUNT > PC-RETRY-MAX OR             08580015
085900                     SQLCODE = ZERO                               08590015
086000                                                                  08600015
086100             EXEC SQL                                             08610015
086200                 OPEN RECEIV_CSR                                  08620015
086300             END-EXEC                                             08630015
086400                                                                  08640015
086500             EVALUATE TRUE                                        08650015
086600                 WHEN SQLCODE = ZERO                              08660015
086700                 WHEN SQLCODE = -904                              08670015
086800                 WHEN SQLCODE = -911                              08680015
086900                 WHEN SQLCODE = -913                              08690015
087000                      CONTINUE                                    08700015
087100                                                                  08710015
087200                 WHEN SQLWARN0 NOT = SPACES                       08720015
087300                 WHEN SQLCODE  NOT = ZERO                         08730015
087400                     MOVE PV-CURRENT-PARAGRAPH                    08740015
087500                                         TO AA-PARAGRAPH-NAME     08750015
087600                     MOVE 'UNSUCCESSFUL OPEN ON RECEIV_CSR'       08760015
087700                                         TO AA-DB2-OPERATION      08770015
087800                     MOVE 'TRECEIV'      TO AA-DB2-TABLE-1        08780015
087900                     MOVE SPACES         TO AA-DB2-TABLE-2        08790015
088000                                            AA-DB2-TABLE-3        08800015
088100                                            AA-DB2-TABLE-4        08810015
088200                                            AA-DB2-TABLE-5        08820015
088300                     PERFORM Z998-DB2-ABEND                       08830015
088400             END-EVALUATE                                         08840015
088500     END-PERFORM.                                                 08850015
088600                                                                  08860015
088700     IF PV-RETRY-COUNT > PC-RETRY-MAX                             08870015
088800         MOVE PV-CURRENT-PARAGRAPH                                08880015
088900                             TO AA-PARAGRAPH-NAME                 08890015
089000         MOVE 'MAX RETRIES EXCEEDED ON OPEN FOR RECEIV_CSR'       08900015
089100                             TO AA-DB2-OPERATION                  08910015
089200         MOVE 'TRECEIV'      TO AA-DB2-TABLE-1                    08920015
089300         MOVE SPACES         TO AA-DB2-TABLE-2                    08930015
089400                                AA-DB2-TABLE-3                    08940015
089500                                AA-DB2-TABLE-4                    08950015
089600                                AA-DB2-TABLE-5                    08960015
089700         PERFORM Z998-DB2-ABEND                                   08970015
089800     END-IF.                                                      08980015
089900                                                                  08990015
090000 EJECT                                                            09000015
090100*----------------------------------------------------------------*09010015
090200*    CLOSES THE RECEIV CURSOR                                    *09020015
090300*----------------------------------------------------------------*09030015
090400 Y210-CLOSE-RECEIV-CSR.                                           09040015
090500                                                                  09050015
090600     MOVE 'Y210-CLOSE-RECEIV-CSR' TO PV-CURRENT-PARAGRAPH.        09060015
090700                                                                  09070015
090800     PERFORM WITH TEST AFTER                                      09080015
090900             VARYING PV-RETRY-COUNT FROM 1 BY 1                   09090015
091000             UNTIL   PV-RETRY-COUNT > PC-RETRY-MAX OR             09100015
091100                     SQLCODE = ZERO                               09110015
091200                                                                  09120015
091300             EXEC SQL                                             09130015
091400                 CLOSE RECEIV_CSR                                 09140015
091500             END-EXEC                                             09150015
091600                                                                  09160015
091700             EVALUATE TRUE                                        09170015
091800                 WHEN SQLCODE = ZERO                              09180015
091900                 WHEN SQLCODE = -904                              09190015
092000                 WHEN SQLCODE = -911                              09200015
092100                 WHEN SQLCODE = -913                              09210015
092200                      CONTINUE                                    09220015
092300                                                                  09230015
092400                 WHEN SQLWARN0 NOT = SPACES                       09240015
092500                 WHEN SQLCODE  NOT = ZERO                         09250015
092600                     MOVE PV-CURRENT-PARAGRAPH                    09260015
092700                                         TO AA-PARAGRAPH-NAME     09270015
092800                     MOVE 'UNSUCCESSFUL CLOSE ON RECEIV_CSR'      09280015
092900                                         TO AA-DB2-OPERATION      09290015
093000                     MOVE 'TRECEIV'      TO AA-DB2-TABLE-1        09300015
093100                     MOVE SPACES         TO AA-DB2-TABLE-2        09310015
093200                                            AA-DB2-TABLE-3        09320015
093300                                            AA-DB2-TABLE-4        09330015
093400                                            AA-DB2-TABLE-5        09340015
093500                     PERFORM Z998-DB2-ABEND                       09350015
093600             END-EVALUATE                                         09360015
093700     END-PERFORM.                                                 09370015
093800                                                                  09380015
093900     IF PV-RETRY-COUNT > PC-RETRY-MAX                             09390015
094000         MOVE PV-CURRENT-PARAGRAPH                                09400015
094100                             TO AA-PARAGRAPH-NAME                 09410015
094200         MOVE 'MAX RETRIES EXCEEDED ON CLOSE FOR RECEIV_CSR'      09420015
094300                             TO AA-DB2-OPERATION                  09430015
094400         MOVE 'TRECEIV'      TO AA-DB2-TABLE-1                    09440015
094500         MOVE SPACES         TO AA-DB2-TABLE-2                    09450015
094600                                AA-DB2-TABLE-3                    09460015
094700                                AA-DB2-TABLE-4                    09470015
094800                                AA-DB2-TABLE-5                    09480015
094900         PERFORM Z998-DB2-ABEND                                   09490015
095000     END-IF.                                                      09500015
095100                                                                  09510015
095200 EJECT                                                            09520015
095300 Z997-ABEND.                                                      09530015
095400                                                                  09540015
095500     MOVE PV-CURRENT-PARAGRAPH  TO AA-PARAGRAPH-NAME.             09550015
095600                                                                  09560015
095700     DISPLAY AA-PROGRAM-LIT.                                      09570015
095800     DISPLAY AA-PARAGRAPH-LIT.                                    09580015
095900     DISPLAY AA-MESSAGE.                                          09590015
096000                                                                  09600015
096100     CALL 'ILBOABN0' USING ABEND-CODE.                            09610015
096200                                                                  09620015
096300*----------------------------------------------------------------*09630015
096400*    ABEND ROUTINE FOR DB2 ERRORS                                *09640015
096500*----------------------------------------------------------------*09650015
096600 Z998-DB2-ABEND.                                                  09660015
096700                                                                  09670015
096800     DISPLAY AA-ABEND-LIT.                                        09680015
096900     DISPLAY AA-DB2-ERROR-LIT.                                    09690015
097000     DISPLAY AA-PROGRAM-LIT.                                      09700015
097100     DISPLAY AA-PARAGRAPH-LIT.                                    09710015
097200     DISPLAY AA-DB2-OPERATION-LIT.                                09720015
097300     DISPLAY AA-DB2-TABLE-1.                                      09730015
097400     DISPLAY AA-DB2-TABLE-2.                                      09740015
097500     DISPLAY AA-DB2-TABLE-3.                                      09750015
097600     DISPLAY AA-DB2-TABLE-4.                                      09760015
097700     SET AC-DB2-ERROR TO TRUE.                                    09770015
097800                                                                  09780015
097900     COPY DPPD004.                                                09790015
098000                                                                  09800015
098100     CALL 'ILBOABN0' USING ABEND-CODE.                            09810015
