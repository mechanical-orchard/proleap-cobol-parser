000100 IDENTIFICATION DIVISION.                                         00010039
000200*----------------------------------------------------------       00020039
000300 PROGRAM-ID.    SAKUT030.                                         00030039
000400 AUTHOR.        GAYLE HAUPT.                                      00040039
000500 DATE-WRITTEN.  MARCH, 2003.                                      00050039
000600                                                                  00060039
000700*----------------------------------------------------------       00070039
000800* THIS PROGRAM REPLACES THE PROMO EXTRACT PROGRAMS SAKUT024       00080039
000900* AND SAKUT025.                                                   00090039
001000*                                                                 00100039
001100* THIS PROGRAM WILL CREATE A PROMO RESULTS FILE USING             00110039
001200* COPYBOOK SAWS046 AS THE OUTPUT FILE LAYOUT.  SAKUT030           00120039
001300* WILL USE A CONTROL CARD TO FIND THE PROCESSING DATE FOR         00130039
001400* WHICH IT WILL SELECT ALL TRANSACTIONS, INCLUDING LATES          00140039
001500* AND CORRECTIONS, THAT CONTAIN PROMOTIONAL ITEMS.                00150039
001600* THE TRANSACTIONS WILL BE SELECTED USING THE TEPTRN,             00160039
001700* TEPPART AND TEPDKEY TABLES.  TO OBTAIN REGULAR PROMO            00170039
001800* ITEMS, SAKUT030 WILL UTILIZE THE TEPITM TABLE.                  00180039
001900*                                                                 00190039
002000* A CURSOR USING THE TEPLID TABLE IS USED TO FIND THE             00200039
002100* TIERED AND GOLDSTAR LID'S FOR THE ITEM.   WHILE IT              00210039
002200* IS NOT POSSIBLE IN THE 'OLD' PROMO SYSTEM TO HAVE A             00220039
002300* TIER ON TOP OF A GOLDSTAR PROMOTION, IT COULD OCCUR             00230039
002400* IN THE NEW PROMO SYSTEM.   THIS IS WHY A CURSOR IS              00240039
002500* NEEDED.                                                         00250039
002600*                                                                 00260039
002700* IF THE ITEM-CURSOR RETRIEVES AN ITEM THAT IS PART OF A          00270039
002800* PRICE ADJUSTMENT, A SELECT IS PERFORMED AGAINST THE             00280039
002900* TEPITM TABLE TO OBTAIN THE RETURN PORTION OF THE                00290039
003000* ADJUSTMENT.   EVEN THOUGH THE PROMO TEAM IS NOT                 00300039
003100* CURRENTLY USING THE RETURN PORTION OF THE ADJUSTMENT,           00310039
003200* IT WAS REQUESTED THAT WE INCLUDE THE ADJUSTMENT IN ITS          00320039
003300* ENTIRETY IN THE OUTPUT FILE.                                    00330039
003400*                                                                 00340039
003500* ONCE ALL INFORMATION IS OBTAINED ON THE ITEM, THE SAWS046       00350039
003600* COPYBOOK WILL BE POPULATED AND THE RECORD WILL BE WRITTEN       00360039
003700* TO THE OUTPUT FILE.                                             00370039
003800*----------------------------------------------------------       00380039
003900*----------------------------------------------------------       00390039
004000* HISTORY LOG:                                                    00400039
004100*                                                                 00410039
004200* DATE: MM/DD/YY                                                  00420039
004300* WR/IR#:                                                         00430039
004400* PROGRAMMER:                                                     00440039
004500* DESCRIPTION:                                                    00450039
004600*----------------------------------------------------------       00460039
004700* DATE: 09/05/03                                                  00470039
004800* WR/IR#:  WR25349                                                00480039
004900* PROGRAMMER:  GAYLE HAUPT                                        00490039
005000* DESCRIPTION:  EBOGO CHANGES.   THE SELECT FROM THE TEPLID       00500039
005100*   TABLE TO OBTAIN TIERED AND GOLDSTAR NOW NEEDS TO BE A         00510039
005200*   CURSOR IN ORDER TO OBTAIN TIERED, GOLDSTAR AND BOGO           00520039
005300*   MARKDOWNS.   WHILE BOGO ITEMS SHOULD NOT HAVE OVER-           00530039
005400*   LAPPING PROMOTIONS, THERE IS NOTHING IN PLACE TO PREVENT      00540039
005500*   THEM, SO A CURSOR IS NEEDED.   THE MARKDOWN SELECTED FOR      00550039
005600*   BOGO ITEMS FROM THE TEPLID TABLE WILL BE THE PRO-RATED        00560039
005700*   AMOUNT, NOT THE RECEIPT AMOUNT.                               00570039
005800*----------------------------------------------------------       00580039
JH1209* WR/IR#:  INC000000185570                                        00590039
JH1209* PROGRAMMER:  JIM HUNTER                                         00600039
JH1209* DESCRIPTION:  BYPASS IN PAR 4200-FETCH-LID-CURSOR WHEN          00610039
JH1209*   LID-PCT > 99.999.  DEFAULT IT TO 99.999.                      00620039
005900*----------------------------------------------------------       00630039
N2I201* WR/IR#:  WR 33714                                               00640039
N2I201* PROGRAMMER:  JIM HUNTER                                         00650039
N2I201* DESCRIPTION:  03/25/2008 -                                      00660039
N2I201*   EXCLUDE THIRD PARTY CARD SALES (DEPARTMENTS 833 AND 834)      00670039
003900*----------------------------------------------------------       00671039
004100*                                                                 00673039
004200* DATE: 02/22/2012                                                00674039
004300* WR/IR#:                                                         00675040
004400* PROGRAMMER: COGNIZANT                                           00676039
004500* DESCRIPTION: REMOVED THE CODE FOR PBI PBI000000016332           00677039
004500*              (TO CORRECT THE PROMO INTERFACE ID)                00677139
004600*----------------------------------------------------------       00678039
P8612 * DATE: 09/02/2014                                                00678241
P8612 * WR/IR#:  CHG0092405                                             00679042
P8612 * PROGRAMMER:  COGNIZANT                                          00679141
P8612 * DESCRIPTION: EXCLUDE NEW MARKET PLACE DEPARTMENT 070 AND        00679241
P8612 *              WAYFAIR SUBCLASS 91.                               00679341
004600*----------------------------------------------------------       00679443
MKTPLC* DATE: 07/29/2020                                                00679544
MKTPLC* WR/IR#:  CHG0246098                                             00679644
MKTPLC* PROGRAMMER:  BARB SCHULTZ                                       00679743
MKTPLC* DESCRIPTION: EXCLUDE NEW MARKET PLACE DEPARTMENT 985. ALSO      00679843
MKTPLC*              REMOVED WAYFAIR FROM THE PROGRAM.                  00679943
005900*----------------------------------------------------------       00680039
SEPHOR* DATE: 04/06/2022                                                00681046
SEPHOR* WR/IR#:  CHG0268843                                             00682047
SEPHOR* PROGRAMMER:  JIM HUNTER                                         00683046
SEPHOR* DESCRIPTION: EXCLUDE NEW SEPHORA GIFT CARD DEPARTMENT 712.      00684046
SEPHOR*----------------------------------------------------------       00686046
006000 ENVIRONMENT DIVISION.                                            00690039
006100*----------------------------------------------------------       00700039
006200 CONFIGURATION SECTION.                                           00710039
006300 SOURCE-COMPUTER. IBM-3090.                                       00720039
006400 OBJECT-COMPUTER. IBM-3090.                                       00730039
006500                                                                  00740039
006600 INPUT-OUTPUT SECTION.                                            00750039
006700                                                                  00760039
006800 FILE-CONTROL.                                                    00770039
006900                                                                  00780039
007000     SELECT DATE-CONTROL-CARD                                     00790039
007100       ASSIGN TO INP01.                                           00800039
007200                                                                  00810039
007300     SELECT PROMO-SALES-RESULTS-FILE                              00820039
007400       ASSIGN TO OUT01.                                           00830039
007500                                                                  00840039
007600*----------------------------------------------------------       00850039
007700 DATA DIVISION.                                                   00860039
007800*----------------------------------------------------------       00870039
007900 FILE SECTION.                                                    00880039
008000                                                                  00890039
008100 FD  DATE-CONTROL-CARD                                            00900039
008200     RECORDING MODE IS F                                          00910039
008300     BLOCK CONTAINS 0 CHARACTERS                                  00920039
008400     LABEL RECORDS ARE STANDARD.                                  00930039
008500                                                                  00940039
008600 01  CONTROL-RECORD                PIC X(80).                     00950039
008700                                                                  00960039
008800 FD  PROMO-SALES-RESULTS-FILE                                     00970039
008900     RECORDING MODE IS F                                          00980039
009000     BLOCK CONTAINS 0 CHARACTERS                                  00990039
009100     LABEL RECORDS ARE STANDARD.                                  01000039
009200                                                                  01010039
009300 01  PROMO-SALES-RESULTS-REC       PIC X(250).                    01020039
009400                                                                  01030039
009500 WORKING-STORAGE SECTION.                                         01040039
009600*----------------------------------------------------             01050039
009700*  SALES RESULTS TRAN FILE RECORD LAYOUT                          01060039
009800*----------------------------------------------------             01070039
009900     COPY SAWS046.                                                01080039
010000                                                                  01090039
010100*----------------------------------------------------             01100039
010200*  KOHLS DATE ROUTINE                                             01110039
010300*----------------------------------------------------             01120039
010400     COPY DPWS500.                                                01130039
010500                                                                  01140039
010600*----------------------------------------------------             01150039
010700 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      01160039
010800                                                  COMP SYNC.      01170039
010900     88  AC-CONTROL-CARD-ERROR                    VALUE +4003.    01180039
011000     88  AC-DB2-ERROR                             VALUE +4013.    01190039
011100     88  AC-CALENDAR-ROUTINE-ERROR                VALUE +4019.    01200039
011200                                                                  01210039
011300*---------------------------------------------                    01220039
011400* RECORD LAYOUT FOR INPUT DATE CARD                               01230039
011500*---------------------------------------------                    01240039
011600 01  CC-CONTROL-DATE.                                             01250039
011700     05  FILLER                           PIC X(02)  VALUE SPACES.01260039
011800     05  CD-DATE                          PIC X(10)  VALUE SPACES.01270039
011900     05  FILLER                           PIC X(68)  VALUE SPACES.01280039
012000                                                                  01290039
012100*---------------------------------------------                    01300039
012200* PC- PROGRAM CONSTANTS                                           01310039
012300*---------------------------------------------                    01320039
012400 01  PC-PROGRAM-CONSTANTS.                                        01330039
012500     05  PC-CURRENT-PROGRAM-NAME          PIC X(08)               01340039
012600                                             VALUE 'SAKUT030'.    01350039
012700                                                                  01360039
012800*---------------------------------------------                    01370039
012900* PS- PROGRAM SWITCHES                                            01380039
013000*---------------------------------------------                    01390039
013100 01  PS-PROGRAM-SWITCHES.                                         01400039
013200     05  PS-END-OF-ITEM-CURSOR-SW         PIC X(01)  VALUE 'N'.   01410039
013300         88  PS-END-OF-ITEM-CURSOR-Y                 VALUE 'Y'.   01420039
013400         88  PS-END-OF-ITEM-CURSOR-N                 VALUE 'N'.   01430039
013500     05  PS-END-OF-LID-CURSOR-SW          PIC X(01)  VALUE 'N'.   01440039
013600         88  PS-END-OF-LID-CURSOR-Y                  VALUE 'Y'.   01450039
013700         88  PS-END-OF-LID-CURSOR-N                  VALUE 'N'.   01460039
013800     05  PS-END-OF-CARD-FILE-SW           PIC X(01)  VALUE 'N'.   01470039
013900         88  PS-END-OF-CARD-FILE-Y                   VALUE 'Y'.   01480039
014000     05  PS-TIERED-SW                     PIC X(01)  VALUE 'N'.   01490039
014100         88  PS-ITEM-HAS-TIERED-Y                    VALUE 'Y'.   01500039
014200         88  PS-ITEM-HAS-TIERED-N                    VALUE 'N'.   01510039
014300     05  PS-GOLDSTAR-SW                   PIC X(01)  VALUE 'N'.   01520039
014400         88  PS-ITEM-HAS-GOLDSTAR-Y                  VALUE 'Y'.   01530039
014500         88  PS-ITEM-HAS-GOLDSTAR-N                  VALUE 'N'.   01540039
014600     05  PS-BOGO-SW                       PIC X(01)  VALUE 'N'.   01550039
014700         88  PS-ITEM-HAS-BOGO-Y                      VALUE 'Y'.   01560039
014800         88  PS-ITEM-HAS-BOGO-N                      VALUE 'N'.   01570039
014900     05  PS-PROMO-SW                      PIC X(01)  VALUE 'N'.   01580039
015000         88  PS-ITEM-HAS-PROMO-Y                     VALUE 'Y'.   01590039
015100         88  PS-ITEM-HAS-PROMO-N                     VALUE 'N'.   01600039
015200     05  PS-INTR-UPC-SW                   PIC X(01)  VALUE 'N'.   01610039
015300         88  PS-ITEM-HAS-INTR-UPC-Y                  VALUE 'Y'.   01620039
015400         88  PS-ITEM-HAS-INTR-UPC-N                  VALUE 'N'.   01630039
015500     05  PS-UNT-COST-AMT-SW               PIC X(01)  VALUE 'N'.   01640039
015600         88  PS-UNT-COST-AMT-Y                       VALUE 'Y'.   01650039
015700         88  PS-UNT-COST-AMT-N                       VALUE 'N'.   01660039
015800     05  PS-RET-ADJ-FOUND-SW              PIC X(01)  VALUE 'N'.   01670039
015900         88  PS-RET-ADJ-FOUND-Y                      VALUE 'Y'.   01680039
016000         88  PS-RET-ADJ-FOUND-N                      VALUE 'N'.   01690039
016100                                                                  01700039
016200*---------------------------------------------                    01710039
016300* PV- PROGRAM WORKING VARIABLES                                   01720039
016400*---------------------------------------------                    01730039
016500 01  PV-PROGRAM-VARIABLES.                                        01740039
016600     05  PV-COUNT-PROMO-RECS              PIC  9(09) VALUE 0.     01750039
016700     05  PV-ITEM-CURSOR-CNT               PIC  9(09) VALUE 0.     01760039
016800     05  PV-LID-CURSOR-CNT                PIC  9(09) VALUE 0.     01770039
016900     05  PV-PARTN-NBR                     PIC S9(04) VALUE +0     01780039
017000                                             COMP.                01790039
017100     05  PV-PARAGRAPH-NAME                PIC  X(30) VALUE SPACE. 01800039
017200     05  PV-OPERATION-MSG-1               PIC  X(40) VALUE SPACE. 01810039
017300     05  PV-OPERATION-MSG-2               PIC  X(40) VALUE SPACE. 01820039
017400     05  PV-DB2-OPERATION                 PIC  X(30) VALUE SPACE. 01830039
017500     05  PV-DB2-PARTN-NBR                 PIC  X(04) VALUE SPACE. 01840039
017600     05  PV-DB2-STR-NBR                   PIC  X(04) VALUE SPACE. 01850039
017700     05  PV-DB2-RGST-ID                   PIC  X(04) VALUE SPACE. 01860039
017800     05  PV-DB2-TRN-NBR                   PIC  X(04) VALUE SPACE. 01870039
017900     05  PV-DB2-SKU-NBR                   PIC  X(08) VALUE SPACE. 01880039
018000     05  PV-SQL-SUB                       PIC  9(03) VALUE ZERO.  01890039
018100     05  PV-ISO-DTE                       PIC  X(10) VALUE SPACES.01900039
018200     05  PV-SALES-DATE.                                           01910039
018300         10  PV-SD-CENTURY                PIC  9(02) VALUE ZERO.  01920039
018400         10  PV-SD-YEAR                   PIC  9(02) VALUE ZERO.  01930039
018500         10  FILLER                       PIC  X(01) VALUE SPACE. 01940039
018600         10  PV-SD-MONTH                  PIC  9(02) VALUE ZERO.  01950039
018700         10  FILLER                       PIC  X(01) VALUE SPACE. 01960039
018800         10  PV-SD-DAY                    PIC  9(02) VALUE ZERO.  01970039
018900     05  PV-TIMESTAMP-DB2                 PIC  X(26) VALUE SPACE. 01980039
019000     05  PV-TIMESTAMP.                                            01990039
019100         10  PV-TS-CENTURY                PIC  X(02) VALUE ZERO.  02000039
019200         10  PV-TS-YEAR                   PIC  9(02) VALUE ZERO.  02010039
019300         10  FILLER                       PIC  X(01) VALUE '-'.   02020039
019400         10  PV-TS-MONTH                  PIC  9(02) VALUE ZERO.  02030039
019500         10  FILLER                       PIC  X(01) VALUE '-'.   02040039
019600         10  PV-TS-DAY                    PIC  9(02) VALUE ZERO.  02050039
019700         10  FILLER                       PIC  X(01) VALUE '-'.   02060039
019800         10  PV-TS-HOUR                   PIC  9(02) VALUE ZERO.  02070039
019900         10  FILLER                       PIC  X(01) VALUE '.'.   02080039
020000         10  PV-TS-MINUTE                 PIC  9(02) VALUE ZERO.  02090039
020100         10  FILLER                       PIC  X(01) VALUE '.'.   02100039
020200         10  PV-TS-SECONDS                PIC  9(02) VALUE ZERO.  02110039
020300         10  FILLER                       PIC  X(01) VALUE '.'.   02120039
020400         10  PV-TS-MILLISEC               PIC  9(06) VALUE ZERO.  02130039
020500     05  PV-TRANSACTION-TIME              PIC  X(08).             02140039
020600     05  FILLER REDEFINES PV-TRANSACTION-TIME.                    02150039
020700         10  PV-TT-HOUR                   PIC  9(02).             02160039
020800         10  FILLER                       PIC  X(01).             02170039
020900         10  PV-TT-MINUTE                 PIC  9(02).             02180039
021000         10  FILLER                       PIC  X(01).             02190039
021100         10  PV-TT-SECONDS                PIC  9(02).             02200039
021200                                                                  02210039
021300     05  PV-TEPTRN-VARIABLES.                                     02220039
021400         10  PV-HOLD-PARTN-NBR            PIC S9(04) VALUE +0     02230039
021500                                             COMP.                02240039
021600         10  PV-HOLD-SLS-DTE              PIC  X(10) VALUE SPACES.02250039
021700         10  PV-HOLD-STR-NBR              PIC S9(04) VALUE +0     02260039
021800                                             COMP.                02270039
021900         10  PV-HOLD-RGST-ID              PIC S9(04) VALUE +0     02280039
022000                                             COMP.                02290039
022100         10  PV-HOLD-TRN-NBR              PIC S9(04) VALUE +0     02300039
022200                                             COMP.                02310039
022300         10  PV-HOLD-STRT-TM              PIC  X(08) VALUE SPACES.02320039
022400         10  PV-HOLD-SLS-CORR-SEQ-NBR     PIC S9(04) VALUE +0     02330039
022500                                             COMP.                02340039
022600     05  PV-ITEM-VARIABLES.                                       02350039
022700         10  PV-HOLD-LNE-ITM-SEQ-NBR      PIC S9(04) VALUE +0     02360039
022800                                             COMP.                02370039
022900         10  PV-HOLD-LIV-RSLU-CDE         PIC  X(01) VALUE SPACES.02380039
023000         10  PV-HOLD-DEPT-NBR             PIC  X(03) VALUE SPACES.02390039
023100         10  PV-HOLD-SUB-CL-NBR           PIC  X(02) VALUE SPACES.02400039
023200         10  PV-HOLD-VOID-SLD-QTY         PIC S9(04) VALUE +0     02410039
023300                                             COMP.                02420039
023400         10  PV-HOLD-SLD-QTY              PIC S9(04) VALUE +0     02430039
023500                                             COMP.                02440039
023600         10  PV-HOLD-NET-CHRGD-AMT        PIC S9(07)V99           02450039
023700                                             VALUE ZEROES COMP-3. 02460039
023800         10  PV-HOLD-SAL-RET-CDE          PIC  X(01) VALUE SPACE. 02470039
023900         10  PV-HOLD-ITM-STAT-CDE         PIC  X(02) VALUE SPACE. 02480039
024000         10  PV-HOLD-CUST-CHRGD-AMT       PIC  S9(07)V99          02490039
024100                                             VALUE ZEROES COMP-3. 02500039
024200         10  PV-HOLD-REG-RTL-AMT          PIC  S9(05)V99          02510039
024300                                             VALUE ZEROES COMP-3. 02520039
024400         10  PV-HOLD-MAJ-CL-NBR           PIC  S9(04)V VALUE +0   02530039
024500                                              COMP-3.             02540039
024600         10  PV-HOLD-UNT-COST-AMT         PIC S9(04)V999          02550039
024700                                             VALUE ZEROES COMP-3. 02560039
024800         10  PV-HOLD-OWND-UNT-RTL         PIC S9(05)V9(02)        02570039
024900                                             VALUE ZEROES COMP-3. 02580039
025000         10  PV-HOLD-SKU-NBR              PIC S9(08)V VALUE +0    02590039
025100                                             COMP-3.              02600039
025200         10  PV-HOLD-PROMO-INTFC-ID       PIC S9(10)V             02610039
025300                                             VALUE ZEROS COMP-3.  02620039
025400         10  PV-HOLD-PROMO-SCHM-CDE       PIC S9(04)              02630039
025500                                             VALUE ZEROS COMP-3.  02640039
025600         10  PV-HOLD-MKDN-AMT             PIC S9(05)V99           02650039
025700                                             VALUE ZEROS COMP-3.  02660039
025800         10  PV-HOLD-DISC-PCT             PIC S9(02)V999          02670039
025900                                             VALUE ZEROS COMP-3.  02680039
026000         10  PV-HOLD-INTFC-SUB-ID         PIC S9(10)V             02690039
026100                                             VALUE ZEROS COMP-3.  02700039
026200         10  PV-HOLD-SCHM-CDE             PIC S9(04)V             02710039
026300                                             VALUE ZEROS COMP-3.  02720039
026400         10  PV-PM-MKDN-AMT               PIC S9(05)V99           02730039
026500                                             VALUE ZEROS COMP-3.  02740039
026600         10  PV-PM-DISC-PCT               PIC S9(02)V999          02750039
026700                                             VALUE ZEROS COMP-3.  02760039
026800         10  PV-TIERED-INTFC-SUB-ID       PIC S9(10)V             02770039
026900                                             VALUE ZEROS COMP-3.  02780039
027000         10  PV-TIERED-SCHM-CDE           PIC S9(04)V             02790039
027100                                             VALUE ZEROS COMP-3.  02800039
027200         10  PV-TIERED-MKDN-AMT           PIC S9(05)V99           02810039
027300                                             VALUE ZEROS COMP-3.  02820039
027400         10  PV-TIERED-DISC-PCT           PIC S9(02)V999          02830039
027500                                             VALUE ZEROS COMP-3.  02840039
027600         10  PV-HOLD-LID-INTFC-ID         PIC S9(10)V             02850039
027700                                             VALUE ZEROS COMP-3.  02860039
027800         10  PV-BOGO-INTFC-ID             PIC S9(10)V             02870039
027900                                             VALUE ZEROS COMP-3.  02880039
028000         10  PV-BOGO-SCHM-CDE             PIC S9(04)V             02890039
028100                                             VALUE ZEROS COMP-3.  02900039
028200         10  PV-BOGO-MKDN-AMT             PIC S9(05)V99           02910039
028300                                             VALUE ZEROS COMP-3.  02920039
028400         10  PV-SKU-INTR-UPC-ID           PIC S9(09)              02930039
028500                                             VALUE ZEROS COMP.    02940039
028600         10  PV-SKU-REGN-PRIC-IND         PIC  X(01) VALUE SPACE. 02950039
028700         10  PV-HOLD-LOC-NBR              PIC S9(04) VALUE +0     02960039
028800                                             COMP.                02970039
028900                                                                  02980039
029000*-------------------------------------------------                02990039
029100*  WS FIELDS FOR SQLCA MESSAGE ROUTINE                            03000039
029200*-------------------------------------------------                03010039
029300     COPY DPWS004.                                                03020039
029400                                                                  03030039
029500*-------------------------------------------------                03040039
029600*  DB2 COMMUNICATION AREA.                                        03050039
029700*-------------------------------------------------                03060039
029800     EXEC SQL                                                     03070039
029900          INCLUDE SQLCA                                           03080039
030000     END-EXEC.                                                    03090039
030100                                                                  03100039
030200*-------------------------------------------------                03110039
030300*  DB2 TABLE TEPPART - PARTITION TABLE                            03120039
030400*-------------------------------------------------                03130039
030500     EXEC SQL                                                     03140039
030600          INCLUDE TEPPART                                         03150039
030700     END-EXEC.                                                    03160039
030800                                                                  03170039
030900*-------------------------------------------------------          03180039
031000*  DB2 TABLE TEPDKEY - PROCESSING DAY KEY TABLE                   03190039
031100*-------------------------------------------------------          03200039
031200     EXEC SQL                                                     03210039
031300          INCLUDE TEPDKEY                                         03220039
031400     END-EXEC.                                                    03230039
031500                                                                  03240039
031600*-------------------------------------------------------          03250039
031700*  DB2 TABLE TEPTRN - TRANSACTION TABLE                           03260039
031800*-------------------------------------------------------          03270039
031900     EXEC SQL                                                     03280039
032000          INCLUDE TEPTRN                                          03290039
032100     END-EXEC.                                                    03300039
032200                                                                  03310039
032300*-------------------------------------------------------          03320039
032400*  DB2 TABLE TEPITM - ITEM TABLE                                  03330039
032500*-------------------------------------------------------          03340039
032600     EXEC SQL                                                     03350039
032700          INCLUDE TEPITM                                          03360039
032800     END-EXEC.                                                    03370039
032900                                                                  03380039
033000*-------------------------------------------------------          03390039
033100*  DB2 TABLE TEPLID - LINE ITEM DISCOUNT TABLE                    03400039
033200*-------------------------------------------------------          03410039
033300     EXEC SQL                                                     03420039
033400          INCLUDE TEPLID                                          03430039
033500     END-EXEC.                                                    03440039
033600                                                                  03450039
033700*-------------------------------------------------------          03460039
033800*  DB2 TABLE XST_SKU - DOMAIN SKU INFORMATION TABLE               03470039
033900*-------------------------------------------------------          03480039
034000     EXEC SQL                                                     03490039
034100          INCLUDE XST00010                                        03500039
034200     END-EXEC.                                                    03510039
034300                                                                  03520039
034400*-------------------------------------------------------          03530039
034500*  DB2 TABLE XST_SKU_LOC - DOMAIN SKU INFORMATION TABLE           03540039
034600*-------------------------------------------------------          03550039
034700     EXEC SQL                                                     03560039
034800          INCLUDE XST00008                                        03570039
034900     END-EXEC.                                                    03580039
035000                                                                  03590039
035100*----------------------------------------------------------       03600039
035200*  CURSOR TO RETRIEVE KOHLS LATE SALES TRANSACTIONS               03610039
035300*  AND CURRENT DAY TRANSACTIONS (UNION OF TWO "CURSORS" TO        03620039
035400*  PRODUCE ONE TRANSACTION CURSOR).                               03630039
035500*  RETRIEVES ITEM INFORMATION ON THE ORIGINAL TRANSCACTION.       03640039
035600*  ALL ITEMS WILL BE RETRIEVED AS IT IS POSSIBLE FOR AN           03650039
035700*  ITEM TO HAVE A TIERED PROMOTION WITHOUT ANY OTHER              03660039
035800*  PROMOTIONS ASSOCIATED WITH IT.   WITH NEW PROMO, TIERED        03670039
035900*  WILL HAVE A PROMO-INTERFC-SUB-ID ON BOTH THE TEPLID AND        03680039
036000*  TEPTTD TABLES, BUT WILL NOT HAVE A PROMO-INTERFC-ID OR         03690039
036100*  PROMO-INTERFC-SUB-ID ON THE TEPITM TABLE.                      03700039
036200*----------------------------------------------------------       03710039
036300     EXEC SQL                                                     03720039
036400       DECLARE PROMO-ITEM-CURSOR CURSOR FOR                       03730039
036500            SELECT  ITM.PARTN_NBR                                 03740039
036600                   ,ITM.STR_NBR                                   03750039
036700                   ,ITM.RGST_ID                                   03760039
036800                   ,ITM.TRN_NBR                                   03770039
036900                   ,ITM.STRT_TM                                   03780039
037000                   ,ITM.SLS_CORR_SEQ_NBR                          03790039
037100                   ,ITM.LNE_ITM_SEQ_NBR                           03800039
037200                   ,ITM.LIV_RSLU_CDE                              03810039
037300                   ,ITM.DEPT_NBR                                  03820039
037400                   ,ITM.SUB_CL_NBR                                03830039
037500                   ,ITM.SLD_QTY                                   03840039
037600                   ,ITM.NET_CHRGD_AMT                             03850039
037700                   ,ITM.SAL_RET_CDE                               03860039
037800                   ,ITM.ITM_STAT_CDE                              03870039
037900                   ,ITM.CUST_CHRGD_AMT                            03880039
038000                   ,ITM.REG_RTL_AMT                               03890039
038100                   ,ITM.OWND_UNT_RTL_AMT                          03900039
038200                   ,ITM.MAJ_CL_NBR                                03910039
038300                   ,ITM.SKU_NBR                                   03920039
038400                   ,ITM.PROMO_INTFC_ID                            03930039
038500                   ,ITM.PROMO_SCHM_CDE                            03940039
038600                   ,PRT.SLS_DTE                                   03950039
038700              FROM  TEPITM  ITM                                   03960039
038800                   ,TEPPART PRT                                   03970039
038900             WHERE PRT.PARTN_NBR           = :PV-PARTN-NBR        03980039
039000              AND  PRT.DB_STRUC_CDE        = 'O'                  03990039
039100              AND  PRT.SLS_DTE             = :PV-ISO-DTE          04000039
039200              AND  ITM.PARTN_NBR           = PRT.PARTN_NBR        04010039
039300              AND  ITM.SAL_RET_CDE        IN ('A','S')            04020039
039400              AND  ITM.LIV_RSLU_CDE       IN ('+', '-')           04030039
039500              AND  ITM.SKU_ERR_CDE        IN ('0','1','2')        04040039
039600              AND  ITM.DEPT_CL_ERR_CDE    IN ('0','1','2','3')    04050039
039700              AND (ITM.CUST_CHRGD_AMT     = 0                     04060039
039800               OR  ITM.CUST_CHRGD_AMT     > 0)                    04070039
039900              AND  NOT (ITM.DEPT_NBR = '555' AND                  04080039
040000                        ITM.SUB_CL_NBR = '55')                    04090039
040100              AND  NOT (ITM.DEPT_NBR = '555' AND                  04100039
040200                        ITM.SUB_CL_NBR = '56')                    04110039
040300              AND  NOT (ITM.DEPT_NBR = '800' AND                  04120039
040400                        ITM.SUB_CL_NBR = '11')                    04130039
040500              AND  NOT (ITM.DEPT_NBR = '981' AND                  04140039
040600                        ITM.SUB_CL_NBR BETWEEN '00' AND '99')     04150039
040700              AND  NOT (ITM.DEPT_NBR = '983' AND                  04160039
040800                        ITM.SUB_CL_NBR BETWEEN '00' AND '99')     04170039
040900              AND  NOT (ITM.DEPT_NBR = '148' AND                  04180039
041000                        ITM.SUB_CL_NBR = '10')                    04190039
041100              AND  NOT (ITM.DEPT_NBR = '149' AND                  04200039
041200                        ITM.SUB_CL_NBR = '10')                    04210039
041300              AND  NOT (ITM.DEPT_NBR = '099' AND                  04220039
041400                        ITM.SUB_CL_NBR = '10')                    04230039
N2I201              AND       ITM.DEPT_NBR <> '833'                     04240039
N2I201              AND       ITM.DEPT_NBR <> '834'                     04250039
MKTPLC              AND  NOT (ITM.DEPT_NBR = '985')                     04253043
SEPHOR              AND  NOT (ITM.DEPT_NBR = '712')                     04254046
041500              AND EXISTS (SELECT 1                                04260039
041600                          FROM  TEPTRN TRN                        04270039
041700                         WHERE  ITM.PARTN_NBR = TRN.PARTN_NBR     04280039
041800                           AND  ITM.STR_NBR   = TRN.STR_NBR       04290039
041900                           AND  ITM.RGST_ID   = TRN.RGST_ID       04300039
042000                           AND  ITM.TRN_NBR   = TRN.TRN_NBR       04310039
042100                           AND  ITM.STRT_TM   = TRN.STRT_TM       04320039
042200                           AND  ITM.SLS_CORR_SEQ_NBR              04330039
042300                                           = TRN.SLS_CORR_SEQ_NBR 04340039
042400                           AND  TRN.TRN_STAT_CDE  IN ('Z')        04350039
042500                           AND  TRN.TRN_TYP_CDE   IN ('01','02',  04360039
042600                                                      '22','23',  04370039
042700                                                      '24','25')  04380039
042800                           AND  TRN.VOID_ABRT_CDE    = 'N'        04390039
042900                           AND  TRN.POS_CPBL_LVL_NBR > 11)        04400039
043000     UNION                                                        04410039
043100            SELECT  ITM.PARTN_NBR                                 04420039
043200                   ,ITM.STR_NBR                                   04430039
043300                   ,ITM.RGST_ID                                   04440039
043400                   ,ITM.TRN_NBR                                   04450039
043500                   ,ITM.STRT_TM                                   04460039
043600                   ,ITM.SLS_CORR_SEQ_NBR                          04470039
043700                   ,ITM.LNE_ITM_SEQ_NBR                           04480039
043800                   ,ITM.LIV_RSLU_CDE                              04490039
043900                   ,ITM.DEPT_NBR                                  04500039
044000                   ,ITM.SUB_CL_NBR                                04510039
044100                   ,ITM.SLD_QTY                                   04520039
044200                   ,ITM.NET_CHRGD_AMT                             04530039
044300                   ,ITM.SAL_RET_CDE                               04540039
044400                   ,ITM.ITM_STAT_CDE                              04550039
044500                   ,ITM.CUST_CHRGD_AMT                            04560039
044600                   ,ITM.REG_RTL_AMT                               04570039
044700                   ,ITM.OWND_UNT_RTL_AMT                          04580039
044800                   ,ITM.MAJ_CL_NBR                                04590039
044900                   ,ITM.SKU_NBR                                   04600039
045000                   ,ITM.PROMO_INTFC_ID                            04610039
045100                   ,ITM.PROMO_SCHM_CDE                            04620039
045200                   ,PRT.SLS_DTE                                   04630039
045300              FROM  TEPITM  ITM                                   04640039
045400                   ,TEPDKEY DKEY                                  04650039
045500                   ,TEPPART PRT                                   04660039
045600            WHERE  DKEY.PRCG_DTE          =:PV-ISO-DTE            04670039
045700             AND   DKEY.SLS_DTE           = PRT.SLS_DTE           04680039
045800             AND   PRT.PARTN_NBR          = ITM.PARTN_NBR         04690039
045900             AND   PRT.DB_STRUC_CDE       = 'O'                   04700039
046000             AND   DKEY.STR_NBR           = ITM.STR_NBR           04710039
046100             AND   DKEY.RGST_ID           = ITM.RGST_ID           04720039
046200             AND   DKEY.TRN_NBR           = ITM.TRN_NBR           04730039
046300             AND   DKEY.STRT_TM           = ITM.STRT_TM           04740039
046400             AND   DKEY.SLS_CORR_SEQ_NBR  = ITM.SLS_CORR_SEQ_NBR  04750039
046500             AND   ITM.SAL_RET_CDE       IN ('A','S')             04760039
046600             AND   ITM.LIV_RSLU_CDE      IN ('+', '-')            04770039
046700             AND   ITM.SKU_ERR_CDE       IN ('0','1','2')         04780039
046800             AND  (ITM.CUST_CHRGD_AMT     = 0                     04790039
046900              OR   ITM.CUST_CHRGD_AMT     > 0)                    04800039
047000             AND   ITM.DEPT_CL_ERR_CDE   IN ('0','1','2','3')     04810039
047100             AND   NOT (ITM.DEPT_NBR = '555' AND                  04820039
047200                         ITM.SUB_CL_NBR = '55')                   04830039
047300             AND   NOT (ITM.DEPT_NBR = '555' AND                  04840039
047400                         ITM.SUB_CL_NBR = '56')                   04850039
047500             AND   NOT (ITM.DEPT_NBR = '800' AND                  04860039
047600                         ITM.SUB_CL_NBR = '11')                   04870039
047700             AND   NOT (ITM.DEPT_NBR = '981' AND                  04880039
047800                         ITM.SUB_CL_NBR BETWEEN '00' AND '99')    04890039
047900             AND   NOT (ITM.DEPT_NBR = '983' AND                  04900039
048000                         ITM.SUB_CL_NBR BETWEEN '00' AND '99')    04910039
048100             AND   NOT (ITM.DEPT_NBR = '148' AND                  04920039
048200                         ITM.SUB_CL_NBR = '10')                   04930039
048300             AND   NOT (ITM.DEPT_NBR = '149' AND                  04940039
048400                         ITM.SUB_CL_NBR = '10')                   04950039
048500             AND   NOT (ITM.DEPT_NBR = '099' AND                  04960039
048600                         ITM.SUB_CL_NBR = '10')                   04970039
N2I201             AND        ITM.DEPT_NBR <> '833'                     04980039
N2I201             AND        ITM.DEPT_NBR <> '834'                     04990039
MKTPLC             AND   NOT (ITM.DEPT_NBR = '985')                     04993043
SEPHOR             AND   NOT (ITM.DEPT_NBR = '712')                     04994046
048700             AND   EXISTS (SELECT 1                               05000039
048800                   FROM    TEPTRN TRN                             05010039
048900                   WHERE  ITM.PARTN_NBR        = TRN.PARTN_NBR    05020039
049000                    AND   ITM.STR_NBR          = TRN.STR_NBR      05030039
049100                    AND   ITM.RGST_ID          = TRN.RGST_ID      05040039
049200                    AND   ITM.TRN_NBR          = TRN.TRN_NBR      05050039
049300                    AND   ITM.STRT_TM          = TRN.STRT_TM      05060039
049400                    AND   ITM.SLS_CORR_SEQ_NBR                    05070039
049500                                          = TRN.SLS_CORR_SEQ_NBR  05080039
049600                    AND   TRN.TRN_STAT_CDE    IN ('L','V','R')    05090039
049700                    AND   TRN.TRN_TYP_CDE     IN ('01','02',      05100039
049800                                                    '22','23',    05110039
049900                                                    '24','25')    05120039
050000                    AND   TRN.VOID_ABRT_CDE    =  'N'             05130039
050100                    AND   TRN.POS_CPBL_LVL_NBR > 11)              05140039
050200           ORDER BY SKU_NBR, STR_NBR                              05150039
050300           WITH UR                                                05160039
050400     END-EXEC.                                                    05170039
050500                                                                  05180039
050600*----------------------------------------------------------       05190039
050700*  CURSOR TO RETRIEVE TIERED, GOLDSTAR AND BOGO MARKDOWNS         05200039
050800*  (LINE ITEM DISCOUNTS).   RETRIEVES INFORMATION ON THE          05210039
050900*  ITEM PICKED UP FROM THE ITEM-CURSOR.                           05220039
051000*----------------------------------------------------------       05230039
051100     EXEC SQL                                                     05240039
051200       DECLARE LID-CURSOR CURSOR FOR                              05250039
051300            SELECT  LID.LID_AMT                                   05260039
051400                   ,LID.LID_PCT                                   05270039
051500                   ,LID.LID_TYP_CDE                               05280039
051600                   ,LID.LID_RSN_CDE                               05290039
051700                   ,LID.PROMO_INTFC_ID                            05300039
051800                   ,LID.PROMO_INTFC_SUB_ID                        05310039
051900                   ,LID.PROMO_SCHM_CDE                            05320039
052000              FROM  TEPLID  LID                                   05330039
052100             WHERE LID.PARTN_NBR           = :PV-HOLD-PARTN-NBR   05340039
052200              AND  LID.STR_NBR             = :PV-HOLD-STR-NBR     05350039
052300              AND  LID.RGST_ID             = :PV-HOLD-RGST-ID     05360039
052400              AND  LID.TRN_NBR             = :PV-HOLD-TRN-NBR     05370039
052500              AND  LID.STRT_TM             = :PV-HOLD-STRT-TM     05380039
052600              AND  LID.SLS_CORR_SEQ_NBR                           05390039
052700                                     = :PV-HOLD-SLS-CORR-SEQ-NBR  05400039
052800              AND   LID.LNE_ITM_SEQ_NBR                           05410039
052900                                     = :PV-HOLD-LNE-ITM-SEQ-NBR   05420039
053000              AND ((LID.PROMO_INTFC_SUB_ID > 0                    05430039
053100              AND   LID.LID_TYP_CDE        = 'T'                  05440039
053200              AND   LID.PROMO_SCHM_CDE IN (400, 401, 402, 403))   05450039
053300              OR   (LID.LID_RSN_CDE        = '753')               05460039
053400              OR   (LID.PROMO_INTFC_ID     > 0                    05470039
053500              AND   LID.LID_TYP_CDE        = 'F'))                05480039
053600            WITH UR                                               05490039
053700     END-EXEC.                                                    05500039
053800                                                                  05510039
053900*----------------------------------------------------------       05520039
054000 PROCEDURE DIVISION.                                              05530039
054100*----------------------------------------------------------       05540039
054200 0000-MAINLINE.                                                   05550039
054300                                                                  05560039
054400     PERFORM 1000-INITIALIZE.                                     05570039
054500                                                                  05580039
054600     PERFORM 2000-PROCESS-TRANSACTION                             05590039
054700       UNTIL PS-END-OF-ITEM-CURSOR-Y.                             05600039
054800                                                                  05610039
054900     PERFORM 9000-END-OF-JOB-ROUTINE.                             05620039
055000                                                                  05630039
055100     GOBACK.                                                      05640039
055200                                                                  05650039
055300*0000-EXIT.                                                       05660039
055400 EJECT                                                            05670039
055500                                                                  05680039
055600*----------------------------------------------------------       05690039
055700* 1000-INITIALIZE.                                                05700039
055800*     OPENS UP FILES, READS THE CONTROL CARD, INITIALIZES         05710039
055900*     RECORDS, INITIALIZES CONSTANT VARIABLES, AND OPENS          05720039
056000*     AND DOES THE FIRST FETCH OF THE TRANSACTION CURSOR.         05730039
056100*----------------------------------------------------------       05740039
056200 1000-INITIALIZE.                                                 05750039
056300                                                                  05760039
056400     OPEN INPUT  DATE-CONTROL-CARD                                05770039
056500          OUTPUT PROMO-SALES-RESULTS-FILE.                        05780039
056600                                                                  05790039
056700*** RETRIEVE DATA FOR CONTROL CARD DATE                           05800039
056800     PERFORM 1100-PROCESS-CONTROL-CARD.                           05810039
056900     PERFORM 1200-SELECT-PARTITION-NBR.                           05820039
057000                                                                  05830039
057100     MOVE SPACES                TO SA046-PM-SALES-RESULTS-REC.    05840039
057200     INITIALIZE SA046-PM-SALES-RESULTS-REC.                       05850039
057300     MOVE PV-ISO-DTE            TO SA046-SLS-DTE.                 05860039
057400     SET PS-ITEM-HAS-PROMO-N                                      05870039
057500         PS-ITEM-HAS-TIERED-N                                     05880039
057600         PS-ITEM-HAS-GOLDSTAR-N                                   05890039
057700         PS-ITEM-HAS-BOGO-N                                       05900039
057800         PS-UNT-COST-AMT-N                                        05910039
057900         PS-ITEM-HAS-INTR-UPC-N                                   05920039
058000         PS-RET-ADJ-FOUND-N     TO TRUE.                          05930039
058100                                                                  05940039
058200     PERFORM 3000-OPEN-ITEM-CURSOR.                               05950039
058300     PERFORM 3100-FETCH-ITEM-CURSOR.                              05960039
058400                                                                  05970039
058500*1000-EXIT.                                                       05980039
058600                                                                  05990039
058700*------------------------------------------------------           06000039
058800* 1100-PROCESS-CONTROL-CARD.                                      06010039
058900*     READ CONTROL CARD TO GET THE SALES DATE IN CCYY-MM-DD.      06020039
059000*------------------------------------------------------           06030039
059100 1100-PROCESS-CONTROL-CARD.                                       06040039
059200                                                                  06050039
059300     PERFORM 1110-READ-CONTROL-CARD-FILE.                         06060039
059400     CLOSE DATE-CONTROL-CARD.                                     06070039
059500     IF PS-END-OF-CARD-FILE-Y                                     06080039
059600         MOVE '1100-PROCESS-CONTROL-CARD'  TO PV-PARAGRAPH-NAME   06090039
059700         MOVE 'NO CONTROL CARD TO PROCESS' TO PV-OPERATION-MSG-1  06100039
059800         SET AC-CONTROL-CARD-ERROR TO TRUE                        06110039
059900         PERFORM 9999-ABEND                                       06120039
060000     END-IF.                                                      06130039
060100     DISPLAY PC-CURRENT-PROGRAM-NAME                              06140039
060200             ' - CONTROL CARD = (' CD-DATE ')'.                   06150039
060300     PERFORM 1115-CONVERT-INPUT-DATE.                             06160039
060400                                                                  06170039
060500*1100-EXIT.                                                       06180039
060600                                                                  06190039
060700*---------------------------------------------------------        06200039
060800* 1110-READ-CONTROL-CARD-FILE.                                    06210039
060900*     READ DATE CONTROL CARD.                                     06220039
061000*---------------------------------------------------------        06230039
061100 1110-READ-CONTROL-CARD-FILE.                                     06240039
061200                                                                  06250039
061300     READ DATE-CONTROL-CARD INTO CC-CONTROL-DATE                  06260039
061400        AT END                                                    06270039
061500           SET PS-END-OF-CARD-FILE-Y TO TRUE.                     06280039
061600                                                                  06290039
061700*1110-EXIT.                                                       06300039
061800                                                                  06310039
061900*---------------------------------------------------------------- 06320039
062000* 1115-CONVERT-INPUT-DATE                                         06330039
062100*     CALL KOHLS CALENDAR ROUTINE:                                06340039
062200*         PASS: CONTROL CARD POS DATE (CCYY-MM-DD FORMAT).        06350039
062300*---------------------------------------------------------------- 06360039
062400                                                                  06370039
062500 1115-CONVERT-INPUT-DATE.                                         06380039
062600                                                                  06390039
062700     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              06400039
062800                                                                  06410039
062900     SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   06420039
063000     SET  DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE.                   06430039
063100     SET  DPG52-LK-DTE-ISO-FMT         TO TRUE.                   06440039
063200     MOVE CD-DATE                      TO DPG52-DB2-ISO-DATE-FMT. 06450039
063300     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    06460039
063400                                             DPG54 DPG55 DPG56.   06470039
063500     EVALUATE TRUE                                                06480039
063600         WHEN DPG54-SEVERE-ERROR                                  06490039
063700         WHEN DPG54-DATE-INVALID                                  06500039
063800             MOVE '1115-CONVERT-INPUT-DATE'                       06510039
063900                                   TO PV-PARAGRAPH-NAME           06520039
064000             MOVE 'ERROR CONVERTING INPUT CARD DATE'              06530039
064100                                   TO PV-OPERATION-MSG-1          06540039
064200             SET AC-CALENDAR-ROUTINE-ERROR                        06550039
064300                                   TO TRUE                        06560039
064400             MOVE DPG54-ERROR-MESSAGE                             06570039
064500                                   TO PV-OPERATION-MSG-2          06580039
064600             PERFORM 9999-ABEND                                   06590039
064700     END-EVALUATE.                                                06600039
064800                                                                  06610039
064900     MOVE DPG55-DB2-ISO-DATE-FMT   TO PV-ISO-DTE.                 06620039
065000                                                                  06630039
065100*1115-EXIT.                                                       06640039
065200                                                                  06650039
065300*---------------------------------------------------------        06660039
065400* 1200-SELECT-PARTITION-NBR                                       06670039
065500*     FIND PARTITION NUMBER THAT CORRESPONDS WITH CONTROL CARD    06680039
065600*     DATE.                                                       06690039
065700*---------------------------------------------------------        06700039
065800 1200-SELECT-PARTITION-NBR.                                       06710039
065900                                                                  06720039
066000     EXEC SQL                                                     06730039
066100         SELECT  PARTN_NBR                                        06740039
066200           INTO :PV-PARTN-NBR                                     06750039
066300            FROM TEPPART                                          06760039
066400           WHERE SLS_DTE      = :PV-ISO-DTE                       06770039
066500             AND STR_GP_CDE   = 'A'                               06780039
066600             AND DB_STRUC_CDE = 'O'                               06790039
066700            WITH UR                                               06800039
066800     END-EXEC.                                                    06810039
066900                                                                  06820039
067000     EVALUATE TRUE                                                06830039
067100        WHEN SQLCODE = ZERO                                       06840039
067200            CONTINUE                                              06850039
067300        WHEN SQLCODE NOT EQUAL ZERO                               06860039
067400            MOVE '1200-SELECT-PARTITION-NBR'                      06870039
067500                                    TO PV-PARAGRAPH-NAME          06880039
067600            MOVE SQLCODE            TO PV-DB2-OPERATION           06890039
067700            PERFORM 9100-SQL-ABEND                                06900039
067800     END-EVALUATE.                                                06910039
067900                                                                  06920039
068000*1200-EXIT.                                                       06930039
068100                                                                  06940039
068200*----------------------------------------------------------       06950039
068300* 2000-PROCESS-TRANSACTION.                                       06960039
068400*     --INITIALIZE OUTPUT FILE LAYOUT                             06970039
068500*     --FETCH THE ITEM-CURSOR                                     06980039
068600*     --PERFORM ROUTINE THAT RETRIEVES TIERED INFORMATION         06990039
068700*     --PERFORM ROUTINES THAT RETRIEVE UNIT COST INFORMATION      07000039
068800*     --PERFORM ROUTINE THAT MOVES DATA TO OUTPUT LAYOUT          07010039
068900*     --PERFORM ROUTINE THAT WRITES THE OUTPUT FILE               07020039
069000*     --FETCH ANOTHER TRANSACTION TO PROCESS                      07030039
069100*----------------------------------------------------------       07040039
069200 2000-PROCESS-TRANSACTION.                                        07050039
069300                                                                  07060039
069400     PERFORM 2500-INITIALIZE-VALUES.                              07070039
069500     IF PV-HOLD-PROMO-INTFC-ID    > 0                             07080039
069600         SET PS-ITEM-HAS-PROMO-Y TO TRUE                          07090039
069700     END-IF.                                                      07100039
069800                                                                  07110039
069900*** AS AN ITEM CAN HAVE A TIERED PROMOTION WITHOUT                07120039
070000*** BEING ASSOCIATED WITH ANY OTHER PROMOTIONS, IT IS             07130039
070100*** NECESSARY TO RETRIEVE TIERED INFORMATION ON ALL               07140039
070200*** ITEMS WHICH THE ITEM-CURSOR RETURNS.   IF THE ITEM            07150039
070300*** BEING PROCESSED IS ON GOLDSTAR, THE GOLDSTAR LID              07160039
070400*** MARKDOWN AND PERCENT WILL BE RETRIEVED HERE AS WELL.          07170039
070500*** A TIER CANNOT BE PLACED ON TOP OF A GOLDSTAR ITEM,            07180039
070600*** SO A SELECT FROM THE TEPLID TABLE IS USED INSTEAD             07190039
070700*** OF A CURSOR.   IF PHASE II OF PROMO GOES IN, MORE             07200039
070800*** LID'S WILL BE SELECTED FROM TEPLID; THEREFORE, IN             07210039
070900*** PROMO PHASE II, THIS SELECT WILL NEED TO CHANGE TO            07220039
071000*** A CURSOR.                                                     07230039
071100*** THE EBOGO PROJECT REQUIRES A CHANGE IN THE WAY THE            07240039
071200*** LID (MARKDOWN) INFORMATION IS RETRIEVED.    A CURSOR          07250039
071300*** IS NOW NEEDED.   EVEN THOUGH OVER-LAPPING PROMOTIONS          07260039
071400*** WITH EBOGO ARE NOT SUPPOSED TO OCCUR, THERE IS NO WAY         07270039
071500*** TO BLOCK THEM.                                                07280039
071600     SET PS-END-OF-LID-CURSOR-N  TO TRUE.                         07290039
071700     PERFORM 4000-OPEN-LID-CURSOR.                                07300039
071800     PERFORM 4100-PROCESS-LID-CURSOR                              07310039
071900       UNTIL PS-END-OF-LID-CURSOR-Y.                              07320039
072000     PERFORM 4300-CLOSE-LID-CURSOR.                               07330039
072100                                                                  07340039
072200*** IF PROMOTIONAL INFORMATION IS OBTAINED                        07350039
072300*** (PROMO-INTFC-ID OR PROMO-INTFC-SUB-ID NOT                     07360039
072400*** GREATER THAN ZERO), THEN POPULATE THE PROMO                   07370039
072500*** RECORD AND WRITE THE OUTPUT FILE.                             07380039
072600     IF  (PS-ITEM-HAS-PROMO-Y)    OR                              07390039
072700         (PS-ITEM-HAS-GOLDSTAR-Y) OR                              07400039
072800         (PS-ITEM-HAS-TIERED-Y)   OR                              07410039
072900         (PS-ITEM-HAS-BOGO-Y)                                     07420039
073000         PERFORM 5000-RETRIEVE-DOMAIN-DATA                        07430039
073100         PERFORM 8000-POPULATE-PROMO-RECORD                       07440039
073200         PERFORM 8500-WRITE-PROMO-REC                             07450039
073300                                                                  07460039
073400*** RETRIEVE THE RETURN ADJUSTMENT INFORMATION IF                 07470039
073500*** THE CURRENT RECORD IS THE SALE PORTION OF THE                 07480039
073600*** ADJUSTMENT.   IF NO RETURN ADJUSTMENT IS FOUND,               07490039
073700*** DISPLAY TRANSACTION INFORMATION AND CONTINUE ON.              07500039
073800         IF PV-HOLD-SAL-RET-CDE   = 'A'                           07510039
073900             MOVE 'B'            TO PV-HOLD-SAL-RET-CDE           07520039
074000             COMPUTE PV-HOLD-LNE-ITM-SEQ-NBR                      07530039
074100                                  = (PV-HOLD-LNE-ITM-SEQ-NBR - 1) 07540039
074200             PERFORM 6000-RET-ADJUSTMENT                          07550039
074300                                                                  07560039
074400*** THE RETURN PORTION OF THE PRICE ADJUSTMENT WILL USE           07570039
074500*** MANY OF THE SAME FIELDS FROM THE SALE PORTION OF THE          07580039
074600*** ADJUSTMENT (INCLUDING ANY PROMO-INTFC-ID'S OR PROMO-          07590039
074700*** INTFC-SUB-ID'S).  CLEAR OUT MARKDOWN DOLLAR/PERCENT           07600039
074800*** RELATED FIELDS, AND USE THE FIELDS SELECTED FOR THE           07610039
074900*** RETURN ADJUSTMENT IN 6000-RET-ADJUSTMENT TO OVERWRITE         07620039
075000*** DATA FROM THE SALE PORTION OF THE ADJUSTMENT                  07630039
075100*** PRIOR TO WRITING THE RETURN ADJUSTMENT RECORD TO THE          07640039
075200*** OUTPUT FILE.                                                  07650039
075300             IF PS-RET-ADJ-FOUND-Y                                07660039
075400                 MOVE ZERO       TO PV-HOLD-MKDN-AMT              07670039
075500                                    PV-HOLD-DISC-PCT              07680039
075600                                    PV-PM-MKDN-AMT                07690039
075700                                    PV-PM-DISC-PCT                07700039
075800                                    PV-TIERED-MKDN-AMT            07710039
075900                                    PV-TIERED-DISC-PCT            07720039
076000                                    PV-BOGO-MKDN-AMT              07730039
076100                 PERFORM 8000-POPULATE-PROMO-RECORD               07740039
076200                 PERFORM 8500-WRITE-PROMO-REC                     07750039
076300             END-IF                                               07760039
076400         END-IF                                                   07770039
076500     END-IF.                                                      07780039
076600                                                                  07790039
076700     INITIALIZE PV-TEPTRN-VARIABLES                               07800039
076800                PV-ITEM-VARIABLES.                                07810039
076900     SET PS-ITEM-HAS-PROMO-N                                      07820039
077000         PS-ITEM-HAS-TIERED-N                                     07830039
077100         PS-ITEM-HAS-GOLDSTAR-N                                   07840039
077200         PS-ITEM-HAS-BOGO-N                                       07850039
077300         PS-RET-ADJ-FOUND-N      TO TRUE.                         07860039
077400     PERFORM 3100-FETCH-ITEM-CURSOR.                              07870039
077500                                                                  07880039
077600*2000-EXIT.                                                       07890039
077700                                                                  07900039
077800*---------------------------------------------------------        07910039
077900* 2500-INITIALIZE-VALUES.                                         07920039
078000*     INITIALIZE ALL VALUES IN THE COPYBOOK RECORD.               07930039
078100*---------------------------------------------------------        07940039
078200 2500-INITIALIZE-VALUES.                                          07950039
078300                                                                  07960039
078400     MOVE 0          TO SA046-STR-NBR                             07970039
078500                        SA046-RGST-ID                             07980039
078600                        SA046-TRN-NBR                             07990039
078700                        SA046-SKU-NBR                             08000039
078800                        SA046-DEPT-NBR                            08010039
078900                        SA046-MAJ-CL-NBR                          08020039
079000                        SA046-SUB-CL-NBR                          08030039
079100                        SA046-LNE-ITM-SEQ-NBR                     08040039
079200                        SA046-SLD-QTY                             08050039
079300                        SA046-REG-RTL-AMT                         08060039
079400                        SA046-OWND-UNT-RTL-AMT                    08070039
079500                        SA046-UNT-COST-AMT                        08080039
079600                        SA046-CUST-CHRGD-AMT                      08090039
079700                        SA046-NET-CHRGD-AMT                       08100039
079800                        SA046-PM-PROMO-INTFC-ID                   08110039
079900                        SA046-PM-SCHM-CDE                         08120039
080000                        SA046-PM-MKDN-AMT                         08130039
080100                        SA046-PM-DISC-PCT                         08140039
080200                        SA046-TIERED-INTFC-SUB-ID                 08150039
080300                        SA046-TIERED-SCHM-CDE                     08160039
080400                        SA046-TIERED-MKDN-AMT                     08170039
080500                        SA046-TIERED-DISC-PCT                     08180039
080600                        SA046-ADOAPO-PROMO-INTFC-ID               08190039
080700                        SA046-ADOAPO-SCHM-CDE                     08200039
080800                        SA046-ADOAPO-MKDN-AMT                     08210039
080900                        SA046-APO-DISC-PCT                        08220039
081000                        SA046-GWPPWP-INTFC-ID                     08230039
081100                        SA046-GWPPWP-SCHM-CDE                     08240039
081200                        SA046-GWPPWP-INTFC-SUB-ID                 08250039
081300                        SA046-GWPPWP-GET-MKDN-AMT                 08260039
081400                        SA046-BOGO-INTFC-ID                       08270039
081500                        SA046-BOGO-SCHM-CDE                       08280039
081600                        SA046-BOGO-PRORTD-MKDN-AMT.               08290039
081700                                                                  08300039
081800     MOVE SPACES     TO SA046-ITM-STAT-CDE                        08310039
081900                        SA046-LIV-RSLU-CDE                        08320039
082000                        SA046-SAL-RET-CDE.                        08330039
082100                                                                  08340039
082200*2500-EXIT.                                                       08350039
082300                                                                  08360039
082400*----------------------------------------------------------       08370039
082500* 3000-OPEN-ITEM-CURSOR.                                          08380039
082600*     OPEN THE ITEM CURSOR.                                       08390039
082700*----------------------------------------------------------       08400039
082800 3000-OPEN-ITEM-CURSOR.                                           08410039
082900                                                                  08420039
083000           EXEC SQL                                               08430039
083100              OPEN PROMO-ITEM-CURSOR                              08440039
083200           END-EXEC                                               08450039
083300                                                                  08460039
083400     EVALUATE TRUE                                                08470039
083500         WHEN SQLCODE = ZERO                                      08480039
083600             CONTINUE                                             08490039
083700         WHEN SQLWARN0 NOT EQUAL SPACE                            08500039
083800         WHEN SQLCODE NOT EQUAL ZERO                              08510039
083900             MOVE '3000-OPEN-ITEM-CURSOR'                         08520039
084000                                   TO PV-PARAGRAPH-NAME           08530039
084100             MOVE 'ERROR ON OPEN OF ITEM CURSOR'                  08540039
084200                                   TO PV-DB2-OPERATION            08550039
084300             PERFORM 9100-SQL-ABEND                               08560039
084400     END-EVALUATE.                                                08570039
084500                                                                  08580039
084600*3000-EXIT.                                                       08590039
084700                                                                  08600039
084800*----------------------------------------------------------       08610039
084900* 3100-FETCH-ITEM-CURSOR.                                         08620039
085000*     FETCH THE ITEM CURSOR.                                      08630039
085100*----------------------------------------------------------       08640039
085200 3100-FETCH-ITEM-CURSOR.                                          08650039
085300                                                                  08660039
085400           EXEC SQL                                               08670039
085500              FETCH PROMO-ITEM-CURSOR                             08680039
085600              INTO  :PV-HOLD-PARTN-NBR                            08690039
085700                   ,:PV-HOLD-STR-NBR                              08700039
085800                   ,:PV-HOLD-RGST-ID                              08710039
085900                   ,:PV-HOLD-TRN-NBR                              08720039
086000                   ,:PV-HOLD-STRT-TM                              08730039
086100                   ,:PV-HOLD-SLS-CORR-SEQ-NBR                     08740039
086200                   ,:PV-HOLD-LNE-ITM-SEQ-NBR                      08750039
086300                   ,:PV-HOLD-LIV-RSLU-CDE                         08760039
086400                   ,:PV-HOLD-DEPT-NBR                             08770039
086500                   ,:PV-HOLD-SUB-CL-NBR                           08780039
086600                   ,:PV-HOLD-SLD-QTY                              08790039
086700                   ,:PV-HOLD-NET-CHRGD-AMT                        08800039
086800                   ,:PV-HOLD-SAL-RET-CDE                          08810039
086900                   ,:PV-HOLD-ITM-STAT-CDE                         08820039
087000                   ,:PV-HOLD-CUST-CHRGD-AMT                       08830039
087100                   ,:PV-HOLD-REG-RTL-AMT                          08840039
087200                   ,:PV-HOLD-OWND-UNT-RTL                         08850039
087300                   ,:PV-HOLD-MAJ-CL-NBR                           08860039
087400                   ,:PV-HOLD-SKU-NBR                              08870039
087500                   ,:PV-HOLD-PROMO-INTFC-ID                       08880039
087600                   ,:PV-HOLD-PROMO-SCHM-CDE                       08890039
087700                   ,:PV-HOLD-SLS-DTE                              08900039
087800           END-EXEC                                               08910039
087900                                                                  08920039
088000     EVALUATE TRUE                                                08930039
088100         WHEN SQLCODE = ZERO                                      08940039
088200             ADD 1                  TO PV-ITEM-CURSOR-CNT         08950039
088300             SET PS-END-OF-ITEM-CURSOR-N                          08960039
088400                                    TO TRUE                       08970039
088500         WHEN SQLCODE = +100                                      08980039
088600             SET PS-END-OF-ITEM-CURSOR-Y                          08990039
088700                                    TO TRUE                       09000039
088800         WHEN SQLWARN0 NOT EQUAL SPACE                            09010039
088900         WHEN SQLCODE NOT EQUAL ZERO                              09020039
089000             MOVE '3100-FETCH-ITEM-CURSOR'                        09030039
089100                                    TO PV-PARAGRAPH-NAME          09040039
089200             MOVE 'ERROR ON FETCHING ITEM CURSOR'                 09050039
089300                                    TO PV-DB2-OPERATION           09060039
089400             MOVE PV-HOLD-PARTN-NBR TO PV-DB2-PARTN-NBR           09070039
089500             MOVE PV-HOLD-STR-NBR   TO PV-DB2-STR-NBR             09080039
089600             MOVE PV-HOLD-RGST-ID   TO PV-DB2-RGST-ID             09090039
089700             MOVE PV-HOLD-TRN-NBR   TO PV-DB2-TRN-NBR             09100039
089800             MOVE SQLCODE TO PV-DB2-OPERATION                     09110039
089900             PERFORM 9100-SQL-ABEND                               09120039
090000     END-EVALUATE.                                                09130039
090100                                                                  09140039
090200*3100-EXIT.                                                       09150039
090300                                                                  09160039
090400*-------------------------------------------------------------    09170039
090500* 3200-CLOSE-ITEM-CURSOR.                                         09180039
090600*     CLOSE THE ITEM CURSOR.                                      09190039
090700*-------------------------------------------------------------    09200039
090800 3200-CLOSE-ITEM-CURSOR.                                          09210039
090900                                                                  09220039
091000           EXEC SQL                                               09230039
091100              CLOSE PROMO-ITEM-CURSOR                             09240039
091200           END-EXEC                                               09250039
091300                                                                  09260039
091400     EVALUATE TRUE                                                09270039
091500         WHEN SQLCODE = ZERO                                      09280039
091600             CONTINUE                                             09290039
091700         WHEN SQLWARN0 NOT EQUAL SPACE                            09300039
091800         WHEN SQLCODE NOT EQUAL ZERO                              09310039
091900             MOVE '3200-CLOSE-ITEM-CURSOR'                        09320039
092000                                   TO PV-PARAGRAPH-NAME           09330039
092100             MOVE 'ERROR ON CLOSE OF ITEM CURSOR'                 09340039
092200                                   TO PV-DB2-OPERATION            09350039
092300             PERFORM 9100-SQL-ABEND                               09360039
092400     END-EVALUATE.                                                09370039
092500                                                                  09380039
092600*3200-EXIT.                                                       09390039
092700                                                                  09400039
092800*----------------------------------------------------------       09410039
092900* 4000-OPEN-LID-CURSOR.                                           09420039
093000*     OPEN THE LID CURSOR.                                        09430039
093100*----------------------------------------------------------       09440039
093200 4000-OPEN-LID-CURSOR.                                            09450039
093300                                                                  09460039
093400           EXEC SQL                                               09470039
093500              OPEN LID-CURSOR                                     09480039
093600           END-EXEC                                               09490039
093700                                                                  09500039
093800     EVALUATE TRUE                                                09510039
093900         WHEN SQLCODE = ZERO                                      09520039
094000             CONTINUE                                             09530039
094100         WHEN SQLWARN0 NOT EQUAL SPACE                            09540039
094200         WHEN SQLCODE NOT EQUAL ZERO                              09550039
094300             MOVE '4000-OPEN-LID-CURSOR'                          09560039
094400                                   TO PV-PARAGRAPH-NAME           09570039
094500             MOVE 'ERROR ON OPEN OF LID CURSOR'                   09580039
094600                                   TO PV-DB2-OPERATION            09590039
094700             PERFORM 9100-SQL-ABEND                               09600039
094800     END-EVALUATE.                                                09610039
094900                                                                  09620039
095000*4000-EXIT.                                                       09630039
095100                                                                  09640039
095200*----------------------------------------------------------       09650039
095300* 4100-PROCESS-LID-CURSOR.                                        09660039
095400*     FETCH AND PROCESS THE LINE ITEM DISCOUNTS (MARKDOWNS)       09670039
095500*     FROM THE LID-CURSOR.                                        09680039
095600*----------------------------------------------------------       09690039
095700 4100-PROCESS-LID-CURSOR.                                         09700039
095800                                                                  09710039
095900     PERFORM 4200-FETCH-LID-CURSOR.                               09720039
096000                                                                  09730039
096100     IF PS-END-OF-LID-CURSOR-N                                    09740039
096200         IF EPLID-LID-RSN-CDE = '753'                             09750039
096300             SET PS-ITEM-HAS-GOLDSTAR-Y                           09760039
096400                                   TO TRUE                        09770039
096500             MOVE PV-HOLD-MKDN-AMT TO PV-PM-MKDN-AMT              09780039
096600             MOVE PV-HOLD-DISC-PCT TO PV-PM-DISC-PCT              09790039
096700             MOVE ZEROS            TO PV-HOLD-MKDN-AMT            09800039
096800                                      PV-HOLD-DISC-PCT            09810039
096900         END-IF                                                   09820039
097000         IF ((PV-HOLD-INTFC-SUB-ID    > 0)   AND                  09830039
097100             (EPLID-LID-TYP-CDE       = 'T') AND                  09840039
097200             (PV-HOLD-SCHM-CDE        = 400  OR                   09850039
097300              PV-HOLD-SCHM-CDE        = 401  OR                   09860039
097400              PV-HOLD-SCHM-CDE        = 402  OR                   09870039
097500              PV-HOLD-SCHM-CDE        = 403))                     09880039
097600             SET PS-ITEM-HAS-TIERED-Y                             09890039
097700                                   TO TRUE                        09900039
097800             MOVE PV-HOLD-MKDN-AMT TO PV-TIERED-MKDN-AMT          09910039
097900             MOVE PV-HOLD-DISC-PCT TO PV-TIERED-DISC-PCT          09920039
098000             MOVE PV-HOLD-INTFC-SUB-ID                            09930039
098100                                   TO PV-TIERED-INTFC-SUB-ID      09940039
098200             MOVE PV-HOLD-SCHM-CDE TO PV-TIERED-SCHM-CDE          09950039
098300             MOVE ZEROS            TO PV-HOLD-MKDN-AMT            09960039
098400                                      PV-HOLD-DISC-PCT            09970039
098500         END-IF                                                   09980039
098600         IF ((PV-HOLD-LID-INTFC-ID    > 0)   AND                  09990039
098700             (EPLID-LID-TYP-CDE       = 'F'))                     10000039
098800             SET PS-ITEM-HAS-BOGO-Y                               10010039
098900                                   TO TRUE                        10020039
099000             MOVE PV-HOLD-MKDN-AMT TO PV-BOGO-MKDN-AMT            10030039
099100             MOVE PV-HOLD-LID-INTFC-ID                            10040039
099200                                   TO PV-BOGO-INTFC-ID            10050039
099300             MOVE PV-HOLD-SCHM-CDE TO PV-BOGO-SCHM-CDE            10060039
099400             MOVE ZEROS            TO PV-HOLD-MKDN-AMT            10070039
099500                                      PV-HOLD-DISC-PCT            10080039
099600         END-IF                                                   10090039
099700     END-IF.                                                      10100039
099800                                                                  10110039
099900*4100-EXIT.                                                       10120039
100000                                                                  10130039
100100*----------------------------------------------------------       10140039
100200* 4200-FETCH-LID-CURSOR.                                          10150039
100300*     FETCH THE LID CURSOR.                                       10160039
100400*----------------------------------------------------------       10170039
100500 4200-FETCH-LID-CURSOR.                                           10180039
100600                                                                  10190039
100700           EXEC SQL                                               10200039
100800              FETCH LID-CURSOR                                    10210039
100900               INTO :PV-HOLD-MKDN-AMT                             10220039
101000                   ,:PV-HOLD-DISC-PCT                             10230039
101100                   ,:EPLID-LID-TYP-CDE                            10240039
101200                   ,:EPLID-LID-RSN-CDE                            10250039
101300                   ,:PV-HOLD-LID-INTFC-ID                         10260039
101400                   ,:PV-HOLD-INTFC-SUB-ID                         10270039
101500                   ,:PV-HOLD-SCHM-CDE                             10280039
101600           END-EXEC                                               10290039
101700                                                                  10300039
101800     EVALUATE TRUE                                                10310039
101900         WHEN SQLCODE = ZERO                                      10320039
102000             ADD 1                  TO PV-LID-CURSOR-CNT          10330039
102100             SET PS-END-OF-LID-CURSOR-N                           10340039
102200                                    TO TRUE                       10350039
JH1209         WHEN SQLCODE = -304                                      10360039
JH1209             ADD 1                  TO PV-LID-CURSOR-CNT          10370039
JH1209             MOVE 99.999            TO PV-HOLD-DISC-PCT           10380039
JH1209             DISPLAY 'PERCENT > 99.999'                           10390039
JH1209             DISPLAY 'PARTN =  ' PV-HOLD-PARTN-NBR                10400039
JH1209             DISPLAY 'STORE =  ' PV-HOLD-STR-NBR                  10410039
JH1209             DISPLAY 'REG   =  ' PV-HOLD-RGST-ID                  10420039
JH1209             DISPLAY 'TRAN  =  ' PV-HOLD-TRN-NBR                  10430039
JH1209             SET PS-END-OF-LID-CURSOR-N                           10440039
JH1209                                    TO TRUE                       10450039
102300         WHEN SQLCODE = +100                                      10460039
102400             SET PS-END-OF-LID-CURSOR-Y                           10470039
102500                                    TO TRUE                       10480039
102600         WHEN SQLWARN0 NOT EQUAL SPACE                            10490039
102700         WHEN SQLCODE NOT EQUAL ZERO                              10500039
102800             MOVE '4200-FETCH-LID-CURSOR'                         10510039
102900                                    TO PV-PARAGRAPH-NAME          10520039
103000             MOVE 'ERROR ON FETCHING LID CURSOR'                  10530039
103100                                    TO PV-DB2-OPERATION           10540039
103200             MOVE PV-HOLD-PARTN-NBR TO PV-DB2-PARTN-NBR           10550039
103300             MOVE PV-HOLD-STR-NBR   TO PV-DB2-STR-NBR             10560039
103400             MOVE PV-HOLD-RGST-ID   TO PV-DB2-RGST-ID             10570039
103500             MOVE PV-HOLD-TRN-NBR   TO PV-DB2-TRN-NBR             10580039
103600             MOVE SQLCODE TO PV-DB2-OPERATION                     10590039
103700             PERFORM 9100-SQL-ABEND                               10600039
103800     END-EVALUATE.                                                10610039
103900                                                                  10620039
104000*4200-EXIT.                                                       10630039
104100                                                                  10640039
104200*-------------------------------------------------------------    10650039
104300* 4300-CLOSE-LID-CURSOR.                                          10660039
104400*     CLOSE THE LID CURSOR.                                       10670039
104500*-------------------------------------------------------------    10680039
104600 4300-CLOSE-LID-CURSOR.                                           10690039
104700                                                                  10700039
104800           EXEC SQL                                               10710039
104900              CLOSE LID-CURSOR                                    10720039
105000           END-EXEC                                               10730039
105100                                                                  10740039
105200     EVALUATE TRUE                                                10750039
105300         WHEN SQLCODE = ZERO                                      10760039
105400             CONTINUE                                             10770039
105500         WHEN SQLWARN0 NOT EQUAL SPACE                            10780039
105600         WHEN SQLCODE NOT EQUAL ZERO                              10790039
105700             MOVE '4300-CLOSE-LID-CURSOR'                         10800039
105800                                   TO PV-PARAGRAPH-NAME           10810039
105900             MOVE 'ERROR ON CLOSE OF LID CURSOR'                  10820039
106000                                   TO PV-DB2-OPERATION            10830039
106100             PERFORM 9100-SQL-ABEND                               10840039
106200     END-EVALUATE.                                                10850039
106300                                                                  10860039
106400*4300-EXIT.                                                       10870039
106500                                                                  10880039
106600*----------------------------------------------------------       10890039
106700* 5000-RETRIEVE-DOMAIN-DATA.                                      10900039
106800*     OBTAIN THE UNIT COST AMOUNT FOR EACH ITEM FROM THE          10910039
106900*     DOMAIN TABLES.                                              10920039
107000*----------------------------------------------------------       10930039
107100 5000-RETRIEVE-DOMAIN-DATA.                                       10940039
107200                                                                  10950039
107300     PERFORM 5100-GET-UPC-INFO.                                   10960039
107400                                                                  10970039
107500***  WILL USE INFORMATION FROM XST_SKU TO OBTAIN THE              10980039
107600***  UNIT COST AMOUNT FROM THE XST_SKU_LOC TABLE.                 10990039
107700***  EACH LEGITIMATE ITEM SHOULD RESIDE ON THE XST_SKU            11000039
107800***  TABLE.  HOWEVER, IF THE INTR_UPC_ID CANNOT BE                11010039
107900***  RETRIEVED FROM XST_SKU, THERE WILL NOT BE A                  11020039
108000***  SUFFICIENT AMOUNT OF INFORMATION TO OBTAIN THE               11030039
108100***  UNIT COST AMOUNT FOR THAT PARTICULAR ITEM FROM               11040039
108200***  THE XST_SKU_LOC TABLE.                                       11050039
108300     IF PS-ITEM-HAS-INTR-UPC-Y                                    11060039
108400         IF PV-SKU-REGN-PRIC-IND = 'Y'                            11070039
108500             MOVE PV-HOLD-STR-NBR TO PV-HOLD-LOC-NBR              11080039
108600         ELSE                                                     11090039
108700             MOVE ZERO            TO PV-HOLD-LOC-NBR              11100039
108800         END-IF                                                   11110039
108900         PERFORM 5200-BUILD-TIMESTAMP                             11120039
109000         PERFORM 5300-GET-UNIT-COST                               11130039
109100     END-IF.                                                      11140039
109200                                                                  11150039
109300***  EACH ITEM SHOULD HAVE A UNIT COST AMOUNT, BUT ON THE         11160039
109400***  OUTSIDE CHANCE IT DOES NOT, MOVE ZEROS TO THE UNIT           11170039
109500***  COST AMOUNT.                                                 11180039
109600     IF (PS-ITEM-HAS-INTR-UPC-N)   OR                             11190039
109700        (PS-UNT-COST-AMT-N)                                       11200039
109800         MOVE ZEROS          TO PV-HOLD-UNT-COST-AMT              11210039
109900     END-IF.                                                      11220039
110000                                                                  11230039
110100     SET PS-ITEM-HAS-INTR-UPC-N                                   11240039
110200         PS-UNT-COST-AMT-N  TO TRUE.                              11250039
110300                                                                  11260039
110400*5000-EXIT.                                                       11270039
110500                                                                  11280039
110600*----------------------------------------------------------       11290039
110700* 5100-GET-UPC-INFO.                                              11300039
110800*     NEED TO OBTAIN THE INTR_UPC_ID FROM THE XST_SKU             11310039
110900*     DOMAIN TABLE IN ORDER TO ACCESS THE UNIT COST AMOUNT        11320039
111000*     FROM THE XST_SKU_LOC TABLE.                                 11330039
111100*----------------------------------------------------------       11340039
111200 5100-GET-UPC-INFO.                                               11350039
111300                                                                  11360039
111400     EXEC SQL                                                     11370039
111500         SELECT  SKU.INTR_UPC_ID                                  11380039
111600                ,SKU.REGN_PRIC_IND                                11390039
111700           INTO :PV-SKU-INTR-UPC-ID                               11400039
111800               ,:PV-SKU-REGN-PRIC-IND                             11410039
111900           FROM  XST_SKU SKU                                      11420039
112000          WHERE  SKU.SKU_NBR        = :PV-HOLD-SKU-NBR            11430039
112100          WITH UR                                                 11440039
112200     END-EXEC.                                                    11450039
112300                                                                  11460039
112400     EVALUATE TRUE                                                11470039
112500         WHEN SQLCODE = ZERO                                      11480039
112600             SET PS-ITEM-HAS-INTR-UPC-Y                           11490039
112700                                    TO TRUE                       11500039
112800         WHEN SQLCODE = +100                                      11510039
112900             SET PS-ITEM-HAS-INTR-UPC-N                           11520039
113000                                    TO TRUE                       11530039
113100         WHEN SQLWARN0 NOT EQUAL SPACE                            11540039
113200         WHEN SQLCODE NOT EQUAL ZERO                              11550039
113300             MOVE '5100-GET-UPC-INFO'                             11560039
113400                                    TO PV-PARAGRAPH-NAME          11570039
113500             MOVE SQLCODE           TO PV-DB2-OPERATION           11580039
113600             MOVE PV-HOLD-PARTN-NBR TO PV-DB2-PARTN-NBR           11590039
113700             MOVE PV-HOLD-STR-NBR   TO PV-DB2-STR-NBR             11600039
113800             MOVE PV-HOLD-RGST-ID   TO PV-DB2-RGST-ID             11610039
113900             MOVE PV-HOLD-TRN-NBR   TO PV-DB2-TRN-NBR             11620039
114000             MOVE PV-HOLD-SKU-NBR   TO PV-DB2-SKU-NBR             11630039
114100             PERFORM 9100-SQL-ABEND                               11640039
114200     END-EVALUATE.                                                11650039
114300                                                                  11660039
114400*5100-EXIT.                                                       11670039
114500                                                                  11680039
114600*----------------------------------------------------------       11690039
114700* 5200-BUILD-TIMESTAMP.                                           11700039
114800*     BUILD TIMESTAMP IN ORDER TO SELECT CORRECT UNIT COST        11710039
114900*     FROM XST_SKU_LOC.                                           11720039
115000*----------------------------------------------------------       11730039
115100 5200-BUILD-TIMESTAMP.                                            11740039
115200                                                                  11750039
115300**  THE HOLD DATE COULD BE A DATE OTHER THAN THE CURRENT          11760039
115400**  PROCESSING DATE IN TEPDKEY.   IN ORDER TO SELECT THE          11770039
115500**  APPROPRIATE UNIT COST FROM XST_SKU_LOC, THE CORRECT           11780039
115600**  TIMESTAMP MUST BE USED.                                       11790039
115700     MOVE PV-HOLD-SLS-DTE   TO PV-SALES-DATE.                     11800039
115800     MOVE PV-SD-CENTURY     TO PV-TS-CENTURY.                     11810039
115900     MOVE PV-SD-YEAR        TO PV-TS-YEAR.                        11820039
116000     MOVE PV-SD-MONTH       TO PV-TS-MONTH.                       11830039
116100     MOVE PV-SD-DAY         TO PV-TS-DAY.                         11840039
116200     MOVE PV-HOLD-STRT-TM   TO PV-TRANSACTION-TIME.               11850039
116300     MOVE PV-TT-HOUR        TO PV-TS-HOUR.                        11860039
116400     MOVE PV-TT-MINUTE      TO PV-TS-MINUTE.                      11870039
116500     MOVE PV-TT-SECONDS     TO PV-TS-SECONDS.                     11880039
116600     MOVE ZEROS             TO PV-TS-MILLISEC.                    11890039
116700     MOVE PV-TIMESTAMP      TO PV-TIMESTAMP-DB2.                  11900039
116800                                                                  11910039
116900*5200-EXIT.                                                       11920039
117000                                                                  11930039
117100*----------------------------------------------------------       11940039
117200* 5300-GET-UNIT-COST.                                             11950039
117300*     SELECT THE UNIT COST FROM XST_SKU_LOC.                      11960039
117400*----------------------------------------------------------       11970039
117500 5300-GET-UNIT-COST.                                              11980039
117600                                                                  11990039
117700     EXEC SQL                                                     12000039
117800         SELECT  LOC.UNT_COST_AMT                                 12010039
117900           INTO :PV-HOLD-UNT-COST-AMT                             12020039
118000           FROM  XST_SKU_LOC  LOC                                 12030039
118100          WHERE  LOC.LOC_NBR        = :PV-HOLD-LOC-NBR            12040039
118200           AND   LOC.INTR_UPC_ID    = :PV-SKU-INTR-UPC-ID         12050039
118300           AND   LOC.BEG_TMST      <= :PV-TIMESTAMP-DB2           12060039
118400           AND  (LOC.END_TMST      IS NULL                        12070039
118500            OR   LOC.END_TMST      >= :PV-TIMESTAMP-DB2)          12080039
118600          WITH UR                                                 12090039
118700     END-EXEC.                                                    12100039
118800                                                                  12110039
118900     EVALUATE TRUE                                                12120039
119000         WHEN SQLCODE = ZERO                                      12130039
119100             SET PS-UNT-COST-AMT-Y  TO TRUE                       12140039
119200         WHEN SQLCODE = +100                                      12150039
119300             SET PS-UNT-COST-AMT-N  TO TRUE                       12160039
119400         WHEN SQLWARN0 NOT EQUAL SPACE                            12170039
119500         WHEN SQLCODE NOT EQUAL ZERO                              12180039
119600             MOVE '5300-GET-UNIT-COST'                            12190039
119700                                    TO PV-PARAGRAPH-NAME          12200039
119800             MOVE SQLCODE           TO PV-DB2-OPERATION           12210039
119900             MOVE PV-HOLD-PARTN-NBR TO PV-DB2-PARTN-NBR           12220039
120000             MOVE PV-HOLD-STR-NBR   TO PV-DB2-STR-NBR             12230039
120100             MOVE PV-HOLD-RGST-ID   TO PV-DB2-RGST-ID             12240039
120200             MOVE PV-HOLD-TRN-NBR   TO PV-DB2-TRN-NBR             12250039
120300             MOVE PV-HOLD-SKU-NBR   TO PV-DB2-SKU-NBR             12260039
120400             PERFORM 9100-SQL-ABEND                               12270039
120500     END-EVALUATE.                                                12280039
120600                                                                  12290039
120700*5300-EXIT.                                                       12300039
120800                                                                  12310039
120900*----------------------------------------------------------       12320039
121000* 6000-RET-ADJUSTMENT.                                            12330039
121100*     OBTAIN THE RETURN SIDE OF THE PRICE ADJUSTMENT ITEM.        12340039
121200*----------------------------------------------------------       12350039
121300 6000-RET-ADJUSTMENT.                                             12360039
121400                                                                  12370039
121500     EXEC SQL                                                     12380039
121600         SELECT  ITM.SLD_QTY                                      12390039
121700                ,ITM.NET_CHRGD_AMT                                12400039
121800                ,ITM.CUST_CHRGD_AMT                               12410039
121900                ,ITM.REG_RTL_AMT                                  12420039
122000                ,ITM.OWND_UNT_RTL_AMT                             12430039
122100           INTO :PV-HOLD-SLD-QTY                                  12440039
122200               ,:PV-HOLD-NET-CHRGD-AMT                            12450039
122300               ,:PV-HOLD-CUST-CHRGD-AMT                           12460039
122400               ,:PV-HOLD-REG-RTL-AMT                              12470039
122500               ,:PV-HOLD-OWND-UNT-RTL                             12480039
122600           FROM  TEPITM  ITM                                      12490039
122700          WHERE  ITM.PARTN_NBR        = :PV-HOLD-PARTN-NBR        12500039
122800           AND   ITM.STR_NBR          = :PV-HOLD-STR-NBR          12510039
122900           AND   ITM.RGST_ID          = :PV-HOLD-RGST-ID          12520039
123000           AND   ITM.TRN_NBR          = :PV-HOLD-TRN-NBR          12530039
123100           AND   ITM.STRT_TM          = :PV-HOLD-STRT-TM          12540039
123200           AND   ITM.SLS_CORR_SEQ_NBR = :PV-HOLD-SLS-CORR-SEQ-NBR 12550039
123300           AND   ITM.LNE_ITM_SEQ_NBR  = :PV-HOLD-LNE-ITM-SEQ-NBR  12560039
123400           AND   ITM.DEPT_NBR         = :PV-HOLD-DEPT-NBR         12570039
123500           AND   ITM.SUB_CL_NBR       = :PV-HOLD-SUB-CL-NBR       12580039
123600           AND   ITM.SKU_NBR          = :PV-HOLD-SKU-NBR          12590039
123700           AND   ITM.SAL_RET_CDE      = :PV-HOLD-SAL-RET-CDE      12600039
123800           AND   ITM.LIV_RSLU_CDE     IN ('+','-')                12610039
123900         WITH UR                                                  12620039
124000     END-EXEC.                                                    12630039
124100                                                                  12640039
124200     EVALUATE TRUE                                                12650039
124300         WHEN SQLCODE = ZERO                                      12660039
124400             SET PS-RET-ADJ-FOUND-Y TO TRUE                       12670039
124500         WHEN SQLCODE = +100                                      12680039
124600             SET PS-RET-ADJ-FOUND-N TO TRUE                       12690039
124700         WHEN SQLWARN0 NOT EQUAL SPACE                            12700039
124800         WHEN SQLCODE NOT EQUAL ZERO                              12710039
124900             MOVE '6000-RET-ADJUSTMENT'                           12720039
125000                                    TO PV-PARAGRAPH-NAME          12730039
125100             MOVE SQLCODE           TO PV-DB2-OPERATION           12740039
125200             MOVE PV-HOLD-PARTN-NBR TO PV-DB2-PARTN-NBR           12750039
125300             MOVE PV-HOLD-STR-NBR   TO PV-DB2-STR-NBR             12760039
125400             MOVE PV-HOLD-RGST-ID   TO PV-DB2-RGST-ID             12770039
125500             MOVE PV-HOLD-TRN-NBR   TO PV-DB2-TRN-NBR             12780039
125600             MOVE PV-HOLD-SKU-NBR   TO PV-DB2-SKU-NBR             12790039
125700             PERFORM 9100-SQL-ABEND                               12800039
125800     END-EVALUATE.                                                12810039
125900                                                                  12820039
126000*6000-EXIT.                                                       12830039
126100                                                                  12840039
126200*----------------------------------------------------------       12850039
126300* 8000-POPULATE-PROMO-RECORD                                      12860039
126400*     BASED ON INFORMATION RETURNED FROM CURSORS AND              12870039
126500*     SELECTS, POPULATE THE SALES RESULTS COPYBOOK.               12880039
126600*----------------------------------------------------------       12890039
126700 8000-POPULATE-PROMO-RECORD.                                      12900039
126800                                                                  12910039
126900     MOVE PV-HOLD-STR-NBR        TO SA046-STR-NBR.                12920039
127000     MOVE PV-HOLD-RGST-ID        TO SA046-RGST-ID.                12930039
127100     MOVE PV-HOLD-TRN-NBR        TO SA046-TRN-NBR.                12940039
127200     MOVE PV-HOLD-SKU-NBR        TO SA046-SKU-NBR.                12950039
127300     MOVE PV-HOLD-DEPT-NBR       TO SA046-DEPT-NBR.               12960039
127400     MOVE PV-HOLD-MAJ-CL-NBR     TO SA046-MAJ-CL-NBR.             12970039
127500     MOVE PV-HOLD-SUB-CL-NBR     TO SA046-SUB-CL-NBR.             12980039
127600     MOVE PV-HOLD-ITM-STAT-CDE   TO SA046-ITM-STAT-CDE.           12990039
127700     MOVE PV-HOLD-LNE-ITM-SEQ-NBR                                 13000039
127800                                 TO SA046-LNE-ITM-SEQ-NBR.        13010039
127900     MOVE PV-HOLD-LIV-RSLU-CDE   TO SA046-LIV-RSLU-CDE.           13020039
128000     MOVE PV-HOLD-SAL-RET-CDE    TO SA046-SAL-RET-CDE.            13030039
128100     MOVE PV-HOLD-SLD-QTY        TO SA046-SLD-QTY.                13040039
128200     MOVE PV-HOLD-REG-RTL-AMT    TO SA046-REG-RTL-AMT.            13050039
128300     MOVE PV-HOLD-OWND-UNT-RTL   TO SA046-OWND-UNT-RTL-AMT.       13060039
128400     MOVE PV-HOLD-UNT-COST-AMT   TO SA046-UNT-COST-AMT.           13070039
128500     MOVE PV-HOLD-CUST-CHRGD-AMT TO SA046-CUST-CHRGD-AMT.         13080039
128600     MOVE PV-HOLD-NET-CHRGD-AMT  TO SA046-NET-CHRGD-AMT.          13090039
128700     MOVE PV-HOLD-PROMO-INTFC-ID TO SA046-PM-PROMO-INTFC-ID.      13100039
128800     MOVE PV-HOLD-PROMO-SCHM-CDE TO SA046-PM-SCHM-CDE.            13110039
128900     MOVE PV-PM-MKDN-AMT         TO SA046-PM-MKDN-AMT.            13120039
129000     MOVE PV-PM-DISC-PCT         TO SA046-PM-DISC-PCT.            13130039
129100     MOVE PV-TIERED-INTFC-SUB-ID TO SA046-TIERED-INTFC-SUB-ID.    13140039
129200     MOVE PV-TIERED-SCHM-CDE     TO SA046-TIERED-SCHM-CDE.        13150039
129300     MOVE PV-TIERED-MKDN-AMT     TO SA046-TIERED-MKDN-AMT.        13160039
129400     MOVE PV-TIERED-DISC-PCT     TO SA046-TIERED-DISC-PCT.        13170039
129500     MOVE PV-BOGO-INTFC-ID       TO SA046-BOGO-INTFC-ID.          13180039
129600     MOVE PV-BOGO-SCHM-CDE       TO SA046-BOGO-SCHM-CDE.          13190039
129700     MOVE PV-BOGO-MKDN-AMT       TO SA046-BOGO-PRORTD-MKDN-AMT.   13200039
129800                                                                  13210039
129900*8000-EXIT.                                                       13220039
130000                                                                  13230039
130100*----------------------------------------------------------       13240039
130200* 8500-WRITE-PROMO-REC.                                           13250039
130300*     WRITES THE PROMO RECORD TO THE FILE.                        13260039
130400*----------------------------------------------------------       13270039
130500 8500-WRITE-PROMO-REC.                                            13280039
130600                                                                  13290039
130700     WRITE PROMO-SALES-RESULTS-REC                                13300039
130800         FROM SA046-PM-SALES-RESULTS-REC.                         13310039
130900                                                                  13320039
131000     ADD 1 TO PV-COUNT-PROMO-RECS.                                13330039
131100                                                                  13340039
131200*8500-EXIT.                                                       13350039
131300                                                                  13360039
131400*----------------------------------------------------------       13370039
131500* 9000-END-OF-JOB-ROUTINE.                                        13380039
131600*     CLOSES ALL FILES, CURSORS, AND DISPLAYS CURSOR COUNTS.      13390039
131700*----------------------------------------------------------       13400039
131800 9000-END-OF-JOB-ROUTINE.                                         13410039
131900                                                                  13420039
132000     PERFORM 3200-CLOSE-ITEM-CURSOR.                              13430039
132100     CLOSE PROMO-SALES-RESULTS-FILE.                              13440039
132200     DISPLAY '****************************************'.          13450039
132300     DISPLAY '*************** SAKUT030 ***************'.          13460039
132400     DISPLAY '****************************************'.          13470039
132500     DISPLAY '# OF PROMO ITEMS FETCHED: ' PV-ITEM-CURSOR-CNT.     13480039
132600     DISPLAY '# OF PROMO RECS WRITTEN : ' PV-COUNT-PROMO-RECS.    13490039
132700     DISPLAY '****************************************'.          13500039
132800     DISPLAY '****************************************'.          13510039
132900     DISPLAY '****************************************'.          13520039
133000                                                                  13530039
133100*9000-EXIT.                                                       13540039
133200                                                                  13550039
133300*---------------------------------------------------------        13560039
133400* 9100-SQL-ABEND.                                                 13570039
133500*     ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.13580039
133600*---------------------------------------------------------        13590039
133700 9100-SQL-ABEND.                                                  13600039
133800     DISPLAY '** ABEND     **'.                                   13610039
133900     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        13620039
134000     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              13630039
134100     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               13640039
134200     DISPLAY '** PARTN NBR ** = ' PV-DB2-PARTN-NBR.               13650039
134300     DISPLAY '** STORE NBR ** = ' PV-DB2-STR-NBR.                 13660039
134400     DISPLAY '** RGST NBR  ** = ' PV-DB2-RGST-ID.                 13670039
134500     DISPLAY '** TRAN NBR  ** = ' PV-DB2-TRN-NBR.                 13680039
134600                                                                  13690039
134700     COPY DPPD004.                                                13700039
134800     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         13710039
134900                                                                  13720039
135000*9100-EXIT.                                                       13730039
135100                                                                  13740039
135200*---------------------------------------------------------        13750039
135300* 9999-ABEND.                                                     13760039
135400*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  13770039
135500*---------------------------------------------------------        13780039
135600 9999-ABEND.                                                      13790039
135700     DISPLAY '** ABEND           **'.                             13800039
135800     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  13810039
135900     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        13820039
136000     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       13830039
136100     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       13840039
136200     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         13850039
136300                                                                  13860039
136400*9999-EXIT.                                                       13870039
