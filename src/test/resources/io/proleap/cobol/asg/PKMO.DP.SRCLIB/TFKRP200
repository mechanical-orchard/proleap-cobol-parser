      ******************************************************************        
       IDENTIFICATION DIVISION.                                                 
      ******************************************************************        
                                                                                
       PROGRAM-ID.              TFKRP200.                                       
       AUTHOR.                  M JOHNSON.                                      
       INSTALLATION.            KOHLS DEPARTMENT STORES.                        
       DATE-WRITTEN.            10/28/2004.                                     
       DATE-COMPILED.                                                           
                                                                                
      ******************************************************************        
      * PROGRAM DESCRIPTION:                                                    
      * --------------------                                                    
      ******************************************************************        
070711*  MODULE TYPE:   COBOL2 DB2 BATCH.                                       
      *                                                                         
      * DUPLICATE TRANSFER TO RTV REPORT                                        
      *                                                                         
      * PROGRAM OBJECTIVE:                                                      
      * ------------------                                                      
      * SEQUENTIALLY READ DATA CREATED IN PROGRAM TFKUT200 AND CREATE           
      * A REPORT OF POTENTIAL DUPLICATE TRANSFERS.                              
      *                                                                         
      *                                                                         
      ******************************************************************        
      * CHANGE LOG:                                                             
      * -----------                                                             
      * WR/PROJ DATE       PGMR        DESCRIPTION OF CHANGES                   
      * ------- ---------- ----------- --------------------------------         
      * 25943   10-28-2004 M JOHNSON   ORIGINAL IMPLEMENTATION                  
070711* 40189   07-07-2011 C PARMLEY   ADD BREAK FOR TO_LOC 2 MORE RTV          
070711*                                LOCATIONS HAVE BEEN ADDED.               
070711*                                PROGRAM BECAME DB2                       
      ******************************************************************        
                                                                                
      ******************************************************************        
       ENVIRONMENT DIVISION.                                                    
      ******************************************************************        
                                                                                
      ******************************************************************        
       CONFIGURATION SECTION.                                                   
                                                                                
      ******************************************************************        
       INPUT-OUTPUT SECTION.                                                    
                                                                                
      ******************************************************************        
       FILE-CONTROL.                                                            
                                                                                
           SELECT DUPLICATE-XFER-DTL                                            
               ASSIGN TO INP01.                                                 
                                                                                
           SELECT DUPLICATE-XFER-RPT                                            
               ASSIGN TO RPT01.                                                 
                                                                                
      /*****************************************************************        
       DATA DIVISION.                                                           
      ******************************************************************        
                                                                                
      ******************************************************************        
       FILE SECTION.                                                            
                                                                                
       FD  DUPLICATE-XFER-DTL                                                   
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
                                                                                
       01  DUPLICATE-XFER-DTL-RCD      PIC  X(135).                             
                                                                                
       FD  DUPLICATE-XFER-RPT                                                   
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
                                                                                
       01  DUPLICATE-XFER-RPT-RCD      PIC  X(133).                             
                                                                                
      ******************************************************************        
       WORKING-STORAGE SECTION.                                                 
                                                                                
      ******************************************************************        
       01  PS-PROGRAM-SWITCHES.                                                 
           05  PS-DUPLICATE-XFER-DTL-EOF-SW                                     
                                       PIC  X(01)          VALUE 'N'.           
               88  PS-DUPLICATE-XFER-DTL-EOF               VALUE 'Y'.           
070711         88  PS-NOT-DUPLICATE-XFER-DTL-EOF           VALUE 'N'.           
                                                                                
      ******************************************************************        
       01  PC-PROGRAM-CONSTANTS.                                                
           05  PC-PROGRAM-NAME         PIC  X(08)          VALUE                
               'TFKRP200'.                                                      
           05  PC-LINE-MAX             PIC S9(03)          VALUE +66            
                                                           COMP-3.              
                                                                                
      ******************************************************************        
       01  PT-PROGRAM-TOTALS.                                                   
           05  PT-FIRSTXFER-RCD-FND    PIC S9(09)          VALUE ZEROS          
                                                           COMP-3.              
           05  PT-RCD-WRTTN            PIC S9(09)          VALUE ZEROS          
                                                           COMP-3.              
           05  PT-DISPLAY-CNTR         PIC S9(09)          VALUE +0             
                                                           COMP-3.              
               88  PT-DISPLAY-CNTR-CNT                     VALUE                
                   5000000.                                                     
      *            5000.                                                        
                                                                                
      ******************************************************************        
       01  CC-DATES.                                                            
           05  CC-PROCESS-DATE         PIC X(10)           VALUE SPACE.         
                                                                                
      ******************************************************************        
       01  PV-PROGRAM-VARIABLES.                                                
           05  PV-PARAGRAPH-NAME       PIC  X(25)          VALUE SPACE.         
           05  PV-ABEND-MESSAGE        PIC  X(50)          VALUE SPACE.         
           05  PV-OPER-ATTEMPTED       PIC  X(30)          VALUE SPACE.         
           05  PV-PREV-FR-LOC-NBR      PIC S9(04)          VALUE +0             
                                                           COMP.                
           05  PV-PREV-TO-LOC-NBR      PIC S9(04)          VALUE +0             
                                                           COMP.                
           05  PV-PREV-XFER-QTY-TOTAL  PIC S9(09)          VALUE +0             
                                                           COMP.                
           05  PV-PREV-XFER-RTL-TOTAL  PIC S9(09)V99       VALUE +0             
                                                           COMP-3.              
                                                                                
           05  PV-LINE-COUNT           PIC S9(03)          VALUE +67            
                                                           COMP-3.              
           05  PV-PAGE-COUNT           PIC S9(05)          VALUE +0             
                                                           COMP-3.              
                                                                                
                                                                                
      ******************************************************************        
       01  ABEND-CODE                   PIC S9(04)  VALUE +0  COMP SYNC.        
           88  AC-DB2-ERROR                         VALUE +4013.                
070711     88  AC-NON-DB2-ERROR                     VALUE +4003.                
           88  AC-DATE-ROUTINE-ERROR                VALUE +4019.                
      ******************************************************************        
                                                                                
       01  SDT-SYSTEM-DATE-TIME.                                                
           05  SDT-YYYYMMDD            PIC  9(08)          VALUE ZEROS.         
           05  FILLER REDEFINES SDT-YYYYMMDD.                                   
               10  SDT-YYYYMMDD-CCYY.                                           
                   15  SDT-YYYYMMDD-CC PIC  X(02).                              
                   15  SDT-YYYYMMDD-YY PIC  X(02).                              
               10  SDT-YYYYMMDD-MM     PIC  X(02).                              
               10  SDT-YYYYMMDD-DD     PIC  X(02).                              
           05  SDT-HHMMSS              PIC  9(08)          VALUE ZEROS.         
           05  FILLER REDEFINES SDT-HHMMSS.                                     
               10  SDT-HHMMSS-HH       PIC  X(02).                              
               10  SDT-HHMMSS-MM       PIC  X(02).                              
               10  SDT-HHMMSS-SS       PIC  X(02).                              
               10  FILLER              PIC  X(02).                              
                                                                                
      *----------------------------------------------------------------*        
      *    VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004     *        
      *----------------------------------------------------------------*        
           COPY DPWS004.                                                        
                                                                                
      *----------------------------------------------------------------*        
      * DB2 MESSAGE AREA                                                        
      *----------------------------------------------------------------*        
           COPY SQLCA2.                                                         
                                                                                
      *----------------------------------------------------------------*        
      * STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                         
      *----------------------------------------------------------------*        
           EXEC SQL                                                             
               INCLUDE SQLCA                                                    
           END-EXEC.                                                            
                                                                                
      *----------------------------------------------------------------*        
      * XST_LOC                                                                 
      *----------------------------------------------------------------*        
           EXEC SQL                                                             
               INCLUDE XST00001                                                 
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *  DUPLICATE XFER DETAIL                                                  
      ******************************************************************        
           COPY TFRD050.                                                        
                                                                                
      ******************************************************************        
      * COPY FOR STANDARD HEADING                                               
      ******************************************************************        
           COPY DPWS132O.                                                       
                                                                                
      ******************************************************************        
       01  RHL1-RPT-HEAD-LINE1.                                                 
           05  FILLER                  PIC  X(50)          VALUE SPACE.         
           05  FILLER                  PIC  X(31)          VALUE                
               'DUPLICATE TRANSFER REPORT FOR '.                                
           05  RHL1-RTV-LOC            PIC  X(04)          VALUE SPACE.         
           05  FILLER                  PIC  X(01)          VALUE SPACE.         
           05  RHL1-RTV-NM             PIC  X(20)          VALUE SPACE.         
                                                                                
      ******************************************************************        
       01  RHL2-RPT-HEAD-LINE2.                                                 
           05  FILLER                  PIC  X(49)          VALUE SPACE.         
           05  FILLER                  PIC  X(11)          VALUE                
               'FOR PERIOD'.                                                    
           05  RHL2-DTE-BEGIN          PIC  X(10)          VALUE SPACE.         
           05  FILLER                  PIC  X(04)          VALUE                
               ' TO '.                                                          
           05  RHL2-DTE-END            PIC  X(10)          VALUE SPACE.         
                                                                                
      ******************************************************************        
       01  RHL3-RPT-HEAD-LINE3.                                                 
           05  FILLER                  PIC  X(08)          VALUE                
               'DISTRICT'.                                                      
           05  FILLER                  PIC  X(03)          VALUE SPACE.         
           05  FILLER                  PIC  X(08)          VALUE                
               'TRANSFER'.                                                      
           05  FILLER                  PIC  X(06)          VALUE SPACE.         
           05  FILLER                  PIC  X(02)          VALUE                
               'TO'.                                                            
           05  FILLER                  PIC  X(28)          VALUE SPACE.         
           05  FILLER                  PIC  X(06)          VALUE                
               'CREATE'.                                                        
           05  FILLER                  PIC  X(06)          VALUE SPACE.         
           05  FILLER                  PIC  X(08)          VALUE                
               'RECEIVED'.                                                      
           05  FILLER                  PIC  X(05)          VALUE SPACE.         
           05  FILLER                  PIC  X(05)          VALUE                
               'TOTAL'.                                                         
           05  FILLER                  PIC  X(07)          VALUE SPACE.         
           05  FILLER                  PIC  X(08)          VALUE                
               'EXTENDED'.                                                      
           05  FILLER                  PIC  X(22)          VALUE SPACE.         
           05  FILLER                  PIC  X(08)          VALUE                
               'CALLBACK'.                                                      
                                                                                
      ******************************************************************        
       01  RHL4-RPT-HEAD-LINE4.                                                 
           05  FILLER                  PIC  X(02)          VALUE SPACE.         
           05  FILLER                  PIC  X(03)          VALUE                
               'NO.'.                                                           
           05  FILLER                  PIC  X(09)          VALUE SPACE.         
           05  FILLER                  PIC  X(03)          VALUE                
               'NO.'.                                                           
           05  FILLER                  PIC  X(07)          VALUE SPACE.         
           05  FILLER                  PIC  X(12)          VALUE                
               'LOC   STATUS'.                                                  
           05  FILLER                  PIC  X(20)          VALUE SPACE.         
           05  FILLER                  PIC  X(04)          VALUE                
               'DATE'.                                                          
           05  FILLER                  PIC  X(09)          VALUE SPACE.         
           05  FILLER                  PIC  X(04)          VALUE                
               'DATE'.                                                          
           05  FILLER                  PIC  X(06)          VALUE SPACE.         
           05  FILLER                  PIC  X(08)          VALUE                
               'QUANTITY'.                                                      
           05  FILLER                  PIC  X(06)          VALUE SPACE.         
           05  FILLER                  PIC  X(06)          VALUE                
               'RETAIL'.                                                        
           05  FILLER                  PIC  X(04)          VALUE SPACE.         
           05  FILLER                  PIC  X(13)          VALUE                
               'TRANSFER TYPE'.                                                 
           05  FILLER                  PIC  X(09)          VALUE SPACE.         
           05  FILLER                  PIC  X(03)          VALUE                
               'NO.'.                                                           
                                                                                
      ******************************************************************        
       01  RHL5-RPT-HEAD-LINE5.                                                 
           05  FILLER                  PIC  X(01)          VALUE SPACE.         
           05  FILLER                  PIC  X(04)          VALUE                
               '----'.                                                          
           05  FILLER                  PIC  X(04)          VALUE SPACE.         
           05  FILLER                  PIC  X(11)          VALUE                
               '-----------'.                                                   
           05  FILLER                  PIC  X(03)          VALUE SPACE.         
           05  FILLER                  PIC  X(04)          VALUE                
               '----'.                                                          
           05  FILLER                  PIC  X(03)          VALUE SPACE.         
           05  FILLER                  PIC  X(20)          VALUE                
               '--------------------'.                                          
           05  FILLER                  PIC  X(03)          VALUE SPACE.         
           05  FILLER                  PIC  X(10)          VALUE                
               '----------'.                                                    
           05  FILLER                  PIC  X(03)          VALUE SPACE.         
           05  FILLER                  PIC  X(10)          VALUE                
               '----------'.                                                    
           05  FILLER                  PIC  X(03)          VALUE SPACE.         
           05  FILLER                  PIC  X(07)          VALUE                
               '-------'.                                                       
           05  FILLER                  PIC  X(04)          VALUE SPACE.         
           05  FILLER                  PIC  X(10)          VALUE                
               '----------'.                                                    
           05  FILLER                  PIC  X(03)          VALUE SPACE.         
           05  FILLER                  PIC  X(18)          VALUE                
               '------------------'.                                            
           05  FILLER                  PIC  X(03)          VALUE SPACE.         
           05  FILLER                  PIC  X(04)          VALUE                
               '----'.                                                          
                                                                                
      ******************************************************************        
      *  REPORT DETAIL                                                          
      ******************************************************************        
       01  XRDL-XFER-RPT-DTL-LINE.                                              
           05  FILLER                  PIC  X(01)          VALUE SPACE.         
           05  XRDL-DIST-NBR           PIC  Z(01)9(03)     VALUE ZEROS.         
           05  FILLER                  PIC  X(04)          VALUE SPACE.         
           05  XRDL-FROM-LOC-NBR       PIC  9(04)          VALUE ZEROS.         
           05  FILLER                  PIC  X(01)          VALUE '-'.           
           05  XRDL-SEQ-NBR            PIC  9(06)          VALUE ZEROS.         
           05  FILLER                  PIC  X(03)          VALUE SPACE.         
           05  XRDL-TO-LOC-NBR         PIC  9(04)          VALUE ZEROS.         
           05  FILLER                  PIC  X(03)          VALUE SPACE.         
           05  XRDL-XFER-STATUS        PIC  X(20)          VALUE SPACE.         
           05  FILLER                  PIC  X(03)          VALUE SPACE.         
           05  XRDL-DTE-CMPLT-XFER     PIC  X(10)          VALUE SPACE.         
           05  FILLER                  PIC  X(03)          VALUE SPACE.         
           05  XRDL-XFER-DTE-RCVD      PIC  X(10)          VALUE SPACE.         
           05  FILLER                  PIC  X(02)          VALUE SPACE.         
           05  XRDL-TOTAL-QTY          PIC -Z(06)9(01)     VALUE ZEROS.         
           05  FILLER                  PIC  X(03)          VALUE SPACE.         
           05  XRDL-TOTAL-RTL          PIC -Z(06)9(01).99  VALUE ZEROS.         
           05  FILLER                  PIC  X(03)          VALUE SPACE.         
           05  XRDL-TYPE-XFER          PIC  X(18)          VALUE SPACE.         
           05  FILLER                  PIC  X(03)          VALUE SPACE.         
           05  XRDL-CLBK-NBR           PIC  Z(04)          VALUE ZEROS.         
                                                                                
      ******************************************************************        
       LINKAGE SECTION.                                                         
                                                                                
      /*****************************************************************        
       PROCEDURE DIVISION.                                                      
      ******************************************************************        
                                                                                
      ******************************************************************        
      *  MAIN PROCESSING.                                                       
      ******************************************************************        
       0000-MAIN-MODULE.                                                        
                                                                                
           DISPLAY '**********************************'.                        
           DISPLAY '* START OF TFKRP200               '.                        
           DISPLAY '**********************************'.                        
                                                                                
           PERFORM 0100-INITIALIZE.                                             
                                                                                
           PERFORM 8000-OPEN-FILES.                                             
                                                                                
           PERFORM 8100-READ-DUPLICATE-XFER-DTL.                                
                                                                                
           IF NOT PS-DUPLICATE-XFER-DTL-EOF                                     
               MOVE TF050-PERIOD-BGN-DTE                                        
                                       TO RHL2-DTE-BEGIN                        
               MOVE TF050-PERIOD-END-DTE                                        
                                       TO RHL2-DTE-END                          
           END-IF.                                                              
                                                                                
           PERFORM 1000-PROCESS-DUP-XFER-DTL                                    
             UNTIL PS-DUPLICATE-XFER-DTL-EOF.                                   
                                                                                
           PERFORM 8900-CLOSE-FILES.                                            
                                                                                
           PERFORM 0900-DISPLAY-PROGRAM-TOTALS.                                 
                                                                                
           GOBACK.                                                              
                                                                                
      ******************************************************************        
      *                                                                         
      ******************************************************************        
       0100-INITIALIZE.                                                         
                                                                                
           ACCEPT SDT-YYYYMMDD         FROM DATE YYYYMMDD.                      
           ACCEPT SDT-HHMMSS           FROM TIME.                               
                                                                                
           DISPLAY 'TFKRP200 RUN DATE: ' SDT-YYYYMMDD ' - '                     
              SDT-HHMMSS.                                                       
                                                                                
           MOVE SDT-YYYYMMDD-YY        TO DP132O-RUN-YEAR.                      
           MOVE SDT-YYYYMMDD-MM        TO DP132O-RUN-MONTH.                     
           MOVE SDT-YYYYMMDD-DD        TO DP132O-RUN-DAY.                       
           MOVE SDT-HHMMSS-HH          TO DP132O-RUN-HOUR.                      
           MOVE SDT-HHMMSS-MM          TO DP132O-RUN-MINUTE.                    
           MOVE 'TFKRP200'             TO DP132O-PROGRAM-NAME.                  
           MOVE 1                      TO DP132O-REPORT-NUMBER.                 
                                                                                
      ******************************************************************        
       0900-DISPLAY-PROGRAM-TOTALS.                                             
                                                                                
           DISPLAY '**********************************'.                        
           DISPLAY '* TFKRP200 PROGRAM STATISTICS:    '.                        
           DISPLAY '**********************************'.                        
           DISPLAY '* TOTAL XFERS READ: ' PT-FIRSTXFER-RCD-FND.                 
           DISPLAY '* REPORT DETAIL WRITTEN: ' PT-RCD-WRTTN.                    
           DISPLAY '**********************************'.                        
           DISPLAY '**********************************'.                        
           DISPLAY '* END OF TFKRP200                 '.                        
           DISPLAY '**********************************'.                        
                                                                                
      /*****************************************************************        
      *                                                                         
      ******************************************************************        
       1000-PROCESS-DUP-XFER-DTL.                                               
                                                                                
           IF TF050-FR-LOC-NBR NOT = PV-PREV-FR-LOC-NBR                         
           OR TF050-TO-LOC-NBR NOT = PV-PREV-TO-LOC-NBR                         
           OR TF050-XFER-QTY-TOTAL NOT = PV-PREV-XFER-QTY-TOTAL                 
           OR TF050-XFER-RTL-TOTAL NOT = PV-PREV-XFER-RTL-TOTAL                 
               PERFORM 8210-WRITE-DTL-BREAK-LINE                                
               MOVE TF050-FR-LOC-NBR   TO PV-PREV-FR-LOC-NBR                    
               MOVE TF050-TO-LOC-NBR   TO PV-PREV-TO-LOC-NBR                    
               MOVE TF050-XFER-QTY-TOTAL                                        
                                       TO PV-PREV-XFER-QTY-TOTAL                
               MOVE TF050-XFER-RTL-TOTAL                                        
                                       TO PV-PREV-XFER-RTL-TOTAL                
           END-IF.                                                              
                                                                                
           PERFORM 2000-FMT-DUP-XFER-RPT-RCD.                                   
                                                                                
           PERFORM 8100-READ-DUPLICATE-XFER-DTL.                                
                                                                                
      ******************************************************************        
       2000-FMT-DUP-XFER-RPT-RCD.                                               
                                                                                
           INITIALIZE                  XRDL-XFER-RPT-DTL-LINE.                  
           MOVE TF050-DIST-NBR         TO XRDL-DIST-NBR.                        
           MOVE TF050-FR-LOC-NBR       TO XRDL-FROM-LOC-NBR.                    
           MOVE TF050-XFER-SEQ-NBR     TO XRDL-SEQ-NBR.                         
           MOVE TF050-TO-LOC-NBR       TO XRDL-TO-LOC-NBR.                      
           MOVE TF050-XFER-STAT-DESC   TO XRDL-XFER-STATUS.                     
           MOVE TF050-CMPT-XFER-END-TMST                                        
                                       TO XRDL-DTE-CMPLT-XFER.                  
           MOVE TF050-RCV-XFER-BEG-DTE-MAX                                      
                                       TO XRDL-XFER-DTE-RCVD.                   
           MOVE TF050-XFER-QTY-TOTAL   TO XRDL-TOTAL-QTY.                       
           MOVE TF050-XFER-RTL-TOTAL   TO XRDL-TOTAL-RTL.                       
           MOVE TF050-TYP-1ST-LNE-DESC TO XRDL-TYPE-XFER.                       
           MOVE TF050-CLBK-NBR         TO XRDL-CLBK-NBR.                        
           PERFORM 8200-WRITE-DUP-XFER-RPT-DTL.                                 
                                                                                
      /*****************************************************************        
      *                                                                         
      ******************************************************************        
       8000-OPEN-FILES.                                                         
                                                                                
           OPEN INPUT DUPLICATE-XFER-DTL.                                       
           OPEN OUTPUT DUPLICATE-XFER-RPT.                                      
                                                                                
      ******************************************************************        
      *  READ INPUT DATA                                                        
      ******************************************************************        
       8100-READ-DUPLICATE-XFER-DTL.                                            
                                                                                
           READ DUPLICATE-XFER-DTL                                              
             INTO TF050-XFER-DUP-REC                                            
               AT END                                                           
                 SET PS-DUPLICATE-XFER-DTL-EOF                                  
                                       TO TRUE.                                 
                                                                                
070711     IF PS-NOT-DUPLICATE-XFER-DTL-EOF                                     
070711         ADD +1 TO PT-FIRSTXFER-RCD-FND                                   
070711     END-IF.                                                              
                                                                                
      ******************************************************************        
      * 8200-WRITE-DUP-XFER-RPT-DTL                                             
      ******************************************************************        
       8200-WRITE-DUP-XFER-RPT-DTL.                                             
                                                                                
           IF PV-LINE-COUNT >= PC-LINE-MAX                                      
070711     OR TF050-TO-LOC-NBR NOT = PV-PREV-TO-LOC-NBR                         
               PERFORM 8220-WRITE-DUP-XFER-RPT-HDR                              
           END-IF.                                                              
                                                                                
           WRITE DUPLICATE-XFER-RPT-RCD                                         
             FROM XRDL-XFER-RPT-DTL-LINE.                                       
                                                                                
           ADD +1                      TO PT-RCD-WRTTN                          
                                          PV-LINE-COUNT.                        
                                                                                
      ******************************************************************        
      *                                                                         
      ******************************************************************        
       8210-WRITE-DTL-BREAK-LINE.                                               
                                                                                
           IF PV-LINE-COUNT >= PC-LINE-MAX                                      
070711     OR TF050-TO-LOC-NBR NOT = PV-PREV-TO-LOC-NBR                         
               PERFORM 8220-WRITE-DUP-XFER-RPT-HDR                              
           ELSE                                                                 
               MOVE SPACE              TO DUPLICATE-XFER-RPT-RCD                
               WRITE DUPLICATE-XFER-RPT-RCD                                     
                 AFTER ADVANCING 1 LINE                                         
                                                                                
               ADD +1                  TO PV-LINE-COUNT                         
           END-IF.                                                              
                                                                                
      ******************************************************************        
      * CHECK FOR NEW RTV LOCATION BREAK                                        
      ******************************************************************        
       8220-WRITE-DUP-XFER-RPT-HDR.                                             
                                                                                
070711     IF TF050-TO-LOC-NBR NOT = PV-PREV-TO-LOC-NBR                         
070711         MOVE ZERO               TO PV-PAGE-COUNT                         
070711         MOVE TF050-TO-LOC-NBR   TO XST00001-LOC-NBR                      
070711                                    RHL1-RTV-LOC                          
070711         PERFORM 8230-GET-RTV-NAME                                        
070711         MOVE XST00001-LOC-NM    TO RHL1-RTV-NM                           
070711     END-IF.                                                              
                                                                                
           ADD +1                      TO PV-PAGE-COUNT.                        
           MOVE PV-PAGE-COUNT          TO DP132O-PAGE-NUMBER.                   
                                                                                
           WRITE DUPLICATE-XFER-RPT-RCD                                         
             FROM DP132O-STANDRD-HEADER-132-COLS                                
             AFTER ADVANCING PAGE.                                              
                                                                                
           WRITE DUPLICATE-XFER-RPT-RCD                                         
             FROM RHL1-RPT-HEAD-LINE1                                           
             AFTER ADVANCING 1 LINE.                                            
                                                                                
           WRITE DUPLICATE-XFER-RPT-RCD                                         
             FROM RHL2-RPT-HEAD-LINE2                                           
             AFTER ADVANCING 1 LINE.                                            
                                                                                
           WRITE DUPLICATE-XFER-RPT-RCD                                         
             FROM RHL3-RPT-HEAD-LINE3                                           
             AFTER ADVANCING 2 LINE.                                            
                                                                                
           WRITE DUPLICATE-XFER-RPT-RCD                                         
             FROM RHL4-RPT-HEAD-LINE4                                           
             AFTER ADVANCING 1 LINE.                                            
                                                                                
           WRITE DUPLICATE-XFER-RPT-RCD                                         
             FROM RHL5-RPT-HEAD-LINE5                                           
             AFTER ADVANCING 1 LINE.                                            
                                                                                
           MOVE SPACE                  TO DUPLICATE-XFER-RPT-RCD.               
           WRITE DUPLICATE-XFER-RPT-RCD                                         
             AFTER ADVANCING 1 LINE.                                            
                                                                                
           MOVE +8                     TO PV-LINE-COUNT.                        
                                                                                
070711******************************************************************        
070711*  THIS ROUTINE GETS THE RTV LOCATION NAME                                
070711******************************************************************        
070711 8230-GET-RTV-NAME.                                                       
                                                                                
070711     EXEC SQL                                                             
070711       SELECT LOC_NM                                                      
070711       INTO :XST00001-LOC-NM                                              
070711       FROM XST_LOC                                                       
070711       WHERE LOC_NBR = :XST00001-LOC-NBR                                  
070711     END-EXEC.                                                            
                                                                                
070711     EVALUATE TRUE                                                        
070711         WHEN SQLCODE = +0                                                
070711             CONTINUE                                                     
070711         WHEN SQLCODE = +100                                              
070711             CONTINUE                                                     
070711         WHEN OTHER                                                       
070711             MOVE 'SELECT-LOC-NAME' TO PV-PARAGRAPH-NAME                  
070711             PERFORM 8100-DB2-ERROR-ROUTINE                               
070711     END-EVALUATE.                                                        
                                                                                
070711*-----------------------------------------------------------------        
070711*8100-DB2-ERROR-ROUTINE.                                                  
070711*-----------------------------------------------------------------        
070711 8100-DB2-ERROR-ROUTINE.                                                  
                                                                                
070711     PERFORM 8900-CLOSE-FILES.                                            
070711     MOVE SQLCODE TO SQLCODE2.                                            
070711     MOVE SQLERRD(3) TO SQLERRD3.                                         
                                                                                
070711     DISPLAY '** ERROR **        = SQL ERROR'.                            
070711     DISPLAY '** PROGRAM **      = '  PC-PROGRAM-NAME.                    
070711     DISPLAY '** PARAGRAPH **    = '  PV-PARAGRAPH-NAME.                  
070711     DISPLAY '** SQL ERROR **    = '  SQLCODE2.                           
070711     DISPLAY '** SQLERRM  **     = '  SQLERRM.                            
                                                                                
070711*----------------------------------------------------------------*        
070711*  THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-           
070711*  MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE                
070711* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE             
070711*  FORMAT.                                                                
070711*----------------------------------------------------------------*        
070711     COPY DPPD004.                                                        
                                                                                
070711     CALL 'DSNTIAR' USING SQLCA                                           
070711                          DP004-FORMATTED-MESSAGE                         
070711                          DP004-ERROR-LINE-LENGTH.                        
                                                                                
070711     DISPLAY DP004-ASTERISK-LINE.                                         
                                                                                
070711     PERFORM                                                              
070711        VARYING DP004-MSG-IDX                                             
070711        FROM 1 BY 1                                                       
070711        UNTIL DP004-MSG-IDX > DP004-MAX-MESSAGE-LINES                     
070711            DISPLAY '**'                                                  
070711                    DP004-MESSAGE-LINE (DP004-MSG-IDX)                    
070711                    ' **'                                                 
070711     END-PERFORM.                                                         
                                                                                
070711     DISPLAY DP004-ASTERISK-LINE.                                         
                                                                                
070711     IF SQLCODE NOT = -911                                                
070711         EXEC SQL                                                         
070711             COMMIT                                                       
070711         END-EXEC                                                         
070711     END-IF.                                                              
                                                                                
070711     SET AC-DB2-ERROR TO TRUE.                                            
                                                                                
070711     CALL 'ILBOABN0' USING ABEND-CODE.                                    
                                                                                
      ******************************************************************        
      *    CLOSE THE FILES.                                                     
      ******************************************************************        
       8900-CLOSE-FILES.                                                        
                                                                                
           CLOSE DUPLICATE-XFER-DTL                                             
                 DUPLICATE-XFER-RPT.                                            
                                                                                
      ******************************************************************        
      *  THIS ROUTINE FORCES AN ABEND DUE TO A NON-DB2 RELATED PROBLEM.         
      ******************************************************************        
       9999-ABEND.                                                              
                                                                                
           DISPLAY '**********************************'.                        
           DISPLAY '**  ABEND     **'.                                          
           DISPLAY '**  PROGRAM   **  = ' PC-PROGRAM-NAME.                      
           DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.                    
           DISPLAY '**  OPERATION **  = ' PV-OPER-ATTEMPTED.                    
           DISPLAY '**********************************'.                        
070711     SET AC-NON-DB2-ERROR TO TRUE.                                        
           CALL 'ILBOABN0'  USING ABEND-CODE.                                   
                                                                                
