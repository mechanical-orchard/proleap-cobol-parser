000100*-----------------------*                                         00010002
000200 IDENTIFICATION DIVISION.                                         00020002
000300*-----------------------*                                         00030002
000400 PROGRAM-ID.    ETKCS348.                                         00040002
000500 AUTHOR.        TESS BESTE.                                       00050002
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060002
000700 DATE-WRITTEN.  04-05-95.                                         00070002
000800 DATE-COMPILED.                                                   00080002
000900                                                                  00090002
001000*-----------------------------------------------------------------00100002
001100*             E348 - EDI P.O. LIST                                00110002
001200*                                                                 00120002
001300*  THIS PROGRAM GENERATES A LIST OF P.O.'S ON HOLD.               00130002
001400*                                                                 00140002
001500*  THE PROGRAM CAN BE ENTERED FROM THE EDI MENU, FROM A CRITERIA  00150002
001600*  SPEC SCREEN ON THE POMENU, OR FROM THE EDI DOCUMENTS ON HOLD   00160002
001700*  LIST SCREEN. IF ENTERED FROM THE EDI MENU, ALL P.O.'S ON HOLD  00170002
001800*  ARE DISPLAYED. IF ENTERED FROM THE CRITERIA SPEC, ONLY THE     00180002
001900*  P.O.'S ON HOLD FOR CERTAIN DOCUMENTS, BASED UPON THE SELECTION 00190002
002000*  CRITERIA, ARE DISPLAYED. IF ENTERED FROM THE EDI DOCUMENTS ON  00200002
002100*  HOLD LIST, ONLY THE P.O.'S ON HOLD FOR THE SELECTED DOCUMENTS  00210002
002200*  ARE DISPLAYED.                                                 00220002
002300*-----------------------------------------------------------------00230002
002310* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 00231004
002320*            - CHANGE CALL OF DPKUT100 TO                       * 00232004
002330*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00233004
002340*              MAKING THE CALL DYNAMIC VS STATIC                * 00234004
002350*                                                               * 00235004
002360*---------------------------------------------------------------* 00236004
CICS  *  CHANGED 10/28/2022    BY BARB SCHULTZ    WR: CHG0277210      * 00237005
CICS  *                                                               * 00238005
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00239005
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00239105
CICS  *---------------------------------------------------------------* 00239305
002500                                                                  00250002
002600                                                                  00260002
002700 ENVIRONMENT DIVISION.                                            00270002
002800                                                                  00280002
002900 DATA DIVISION.                                                   00290002
003000                                                                  00300002
003100 WORKING-STORAGE SECTION.                                         00310002
003200                                                                  00320002
003300 01  PC-PROGRAM-CONSTANTS.                                        00330002
003400     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00340002
003500                                                    'ET348A  '.   00350002
003600     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00360002
003700                                                    'ETKM348 '.   00370002
003800     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00380002
003900                                                    'ETKCS348'.   00390002
004000     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00400002
004100     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00410002
004200     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +12     00420002
004300                                                    COMP SYNC.    00430002
004400     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00440002
004500                                                    COMP SYNC.    00450002
004600     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00460002
004700                                                    +1000000      00470002
004800                                                    COMP-3.       00480002
004900     05  PC-ITEM-NUMBER-LENGTH          PIC S9(04)  VALUE +5      00490002
005000                                                    COMP SYNC.    00500002
005100     05  PC-RLSE-IND-NOT-RELEASED       PIC  X      VALUE 'N'.    00510002
005200     05  PC-RLSE-IND-SOME-RELEASED      PIC  X      VALUE 'P'.    00520002
005300     05  PC-RLSE-IND-DELETED            PIC  X      VALUE 'D'.    00530002
005400     05  PC-RLSE-IND-RELEASED           PIC  X      VALUE 'Y'.    00540002
005500     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00550002
005600     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00560002
005700     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00570002
005800     05  PC-REL                         PIC  X(03)  VALUE 'REL'.  00580002
005900     05  PC-OPERCO-NBR                  PIC  X(02)  VALUE '03'.   00590002
006000     05  PC-RSPLVL-CDE-BUYER            PIC  X(03)  VALUE 'BYR'.  00600002
006100     05  PC-MDSELV-CDE-DEPT             PIC  X(03)  VALUE 'DPT'.  00610002
006200     05  PC-CALENDAR-ROUTINE            PIC  X(08)  VALUE         00620002
006300                                                       'DPKUT500'.00630002
006400      05  PC-EMPTY-DATE                 PIC  X(10)  VALUE         00640002
006500                                                     '9999-09-09'.00650002
006600     05  PC-TSYMSG-NUMBERS.                                       00660002
006700         10  PC-TSYMSG-00004            PIC  9(05)  VALUE 00004.  00670002
006800         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00680002
006900         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00690002
007000         10  PC-TSYMSG-00016            PIC  9(05)  VALUE 00016.  00700002
007100         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00710002
007200         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00720002
007300         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00730002
007400         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00740002
007500         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00750002
007600         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00760002
007700         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00770002
007800         10  PC-TSYMSG-00059            PIC  9(05)  VALUE 00059.  00780002
007900         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00790002
008000         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00800002
008100         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00810002
008200         10  PC-TSYMSG-00115            PIC  9(05)  VALUE 00115.  00820002
008300         10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.  00830002
008400         10  PC-TSYMSG-00149            PIC  9(05)  VALUE 00149.  00840002
008500         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00850002
008600         10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.  00860002
008700         10  PC-TSYMSG-00660            PIC  9(05)  VALUE 00660.  00870002
008800                                                                  00880002
008900 01  PS-PROGRAM-SWITCHES.                                         00890002
009000     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00900002
009100         88  PS-NO-ERROR                            VALUE 'Y'.    00910002
009200         88  PS-ERROR                               VALUE 'N'.    00920002
009300     05  PS-START-ITEM-ERROR-SW         PIC  X(01)  VALUE 'Y'.    00930002
009400         88  PS-NO-START-ITEM-ERROR                 VALUE 'Y'.    00940002
009500         88  PS-START-ITEM-ERROR                    VALUE 'N'.    00950002
009600     05  PS-DATA-AVAILABLE-SW           PIC  X.                   00960002
009700         88  PS-DATA-AVAILABLE                      VALUE 'Y'.    00970002
009800         88  PS-DATA-NOT-AVAILABLE                  VALUE 'N'.    00980002
009900     05  PS-LIST-END-SW                 PIC X       VALUE 'N'.    00990002
010000         88  PS-LIST-END                            VALUE 'Y'.    01000002
010100         88  PS-NO-LIST-END                         VALUE 'N'.    01010002
010200                                                                  01020002
010300 01  PV-PROGRAM-VARIABLES.                                        01030002
010400     05  PV-SUB                         PIC S9(04)  VALUE +0      01040002
010500                                                    COMP SYNC.    01050002
010600     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01060002
010700                                                    COMP SYNC.    01070002
010800     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01080002
010900                                                    COMP-3.       01090002
011000     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01100002
011100                                                    COMP-3.       01110002
011200     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01120002
011300                                                    COMP-3.       01130002
011400     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01140002
011500                                                    COMP-3.       01150002
011600     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01160002
011700                                                    COMP-3.       01170002
011800     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01180002
011900                                                    COMP-3.       01190002
012000     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01200002
012100                                                    COMP-3.       01210002
012200     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01220002
012300                                                    COMP SYNC.    01230002
012400     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01240002
012500                                                    COMP SYNC.    01250002
012600     05  PV-ITEM                        PIC S9(04)  VALUE +0      01260002
012700                                                    COMP SYNC.    01270002
012800     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01280002
012900                                                    COMP SYNC.    01290002
013000     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01300002
013100                                                    COMP SYNC.    01310002
013200     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01320002
013300                                                    COMP SYNC.    01330002
013400     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01340002
013500                                                    COMP SYNC.    01350002
013600     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01360002
013700                                                    COMP SYNC.    01370002
013800     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01380002
013900                                                    COMP SYNC.    01390002
014000     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01400002
014100                                                    COMP SYNC.    01410002
014200     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01420002
014300                                                    COMP SYNC.    01430002
014400     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01440002
014500                                                    COMP SYNC.    01450002
014600     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01460002
014700                                                    COMP SYNC.    01470002
014800     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01480002
014900                                                    COMP SYNC.    01490002
015000     05  PV-RLSE-IND                    PIC  X.                   01500002
015100     05  PV-NOT-RELEASED-PO-COUNT       PIC S9(09)  COMP.         01510002
015200     05  PV-DB2-TP-DKEY                 PIC S9(09)  COMP.         01520002
015300     05  PV-DB2-TP-DKEY-TMST            PIC  X(26).               01530002
015400     05  PV-DB2-PO-NBR                  PIC  X(22).               01540002
015500                                                                  01550002
015600                                                                  01560002
015700*-----------------------------------------------------------------01570002
015800* THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE. THIS  01580002
015900* QUEUE MUST HAVE THE SAME LAYOUT AS 1 OCCURRENCE OF              01590002
016000* ASC-BLOCK-ENTRIES.                                              01600002
016100*-----------------------------------------------------------------01610002
016200                                                                  01620002
016300 01  LQW-LIST-QUEUE-WORK-AREA.                                    01630002
016400     05  LQW-BLOCK-MODIFIED             PIC  X      VALUE SPACE.  01640002
016500     05  LQW-ITEM-ENTRIES               OCCURS 12 TIMES           01650002
016600                                        INDEXED BY LQW-IDX.       01660002
016700         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01670002
016800         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01680002
016900         10  LQW-SELECTED-SW            PIC  X(01).               01690002
017000             88  LQW-SELECT                         VALUE 'S'.    01700002
017100             88  LQW-DESELECT                       VALUE ' '.    01710002
017200         10  LQW-ACTION                 PIC  X(03).               01720002
017300         10  LQW-PO-NBR                 PIC  X(22).               01730002
017400         10  LQW-DEPT-NBR               PIC  X(03).               01740002
017500         10  LQW-VENDOR-NAME            PIC  X(10).               01750002
017600         10  LQW-TSET-NME-ID            PIC  X(03).               01760002
017700         10  LQW-TRN-SET-CDE            PIC  X(03).               01770002
017800         10  LQW-HOLD-DATE              PIC  X(08).               01780002
017900         10  LQW-RELEASE-DATE           PIC  X(08).               01790002
018000         10  LQW-TP-DKEY                PIC S9(09)  COMP.         01800002
018100         10  LQW-TP-DKEY-TMST           PIC  X(26).               01810002
018200                                                                  01820002
018300                                                                  01830002
018400*-----------------------------------------------------------------01840002
018500* RECORD LAYOUT FOR THE EDI DOCUMENTS ON HOLD SELECTED ITEMS TEMP 01850002
018600* STORAGE QUEUE.                                                  01860002
018700*-----------------------------------------------------------------01870002
018800                                                                  01880002
018900     COPY ETWS346.                                                01890002
019000                                                                  01900002
019100                                                                  01910002
019200*-----------------------------------------------------------------01920002
019300* MAP LAYOUT                                                      01930002
019400*-----------------------------------------------------------------01940002
019500                                                                  01950002
019600     COPY ETKM348.                                                01960002
019700*                                                                 01970002
019800 01  MR-OCCURS-LAYOUT                   REDEFINES  ET348AO.       01980002
019900     05  FILLER                         PIC X(42).                01990002
020000     05  MR-SCROLL-AREA                 OCCURS 12 TIMES.          02000002
020100         10  MR-SELECTL                 PIC S9(04) COMP.          02010002
020200         10  MR-SELECTA                 PIC  X(01).               02020002
020300         10  MR-SELECTC                 PIC  X(01).               02030002
020400         10  MR-SELECTH                 PIC  X(01).               02040002
020500         10  MR-SELECT                  PIC  X(01).               02050002
020600                                                                  02060002
020700         10  MR-ACTIONL                 PIC S9(04) COMP.          02070002
020800         10  MR-ACTIONA                 PIC  X(01).               02080002
020900         10  MR-ACTIONC                 PIC  X(01).               02090002
021000         10  MR-ACTIONH                 PIC  X(01).               02100002
021100         10  MR-ACTION                  PIC  X(03).               02110002
021200                                                                  02120002
021300         10  MR-PO-NBRL                 PIC S9(04) COMP.          02130002
021400         10  MR-PO-NBRA                 PIC  X(01).               02140002
021500         10  MR-PO-NBRC                 PIC  X(01).               02150002
021600         10  MR-PO-NBRH                 PIC  X(01).               02160002
021700         10  MR-PO-NBR                  PIC  X(22).               02170002
021800                                                                  02180002
021900         10  MR-VENDOR-NAMEL            PIC S9(04) COMP.          02190002
022000         10  MR-VENDOR-NAMEA            PIC  X(01).               02200002
022100         10  MR-VENDOR-NAMEC            PIC  X(01).               02210002
022200         10  MR-VENDOR-NAMEH            PIC  X(01).               02220002
022300         10  MR-VENDOR-NAME             PIC  X(10).               02230002
022400                                                                  02240002
022500         10  MR-EDI-DOCUMENTL           PIC S9(04) COMP.          02250002
022600         10  MR-EDI-DOCUMENTA           PIC  X(01).               02260002
022700         10  MR-EDI-DOCUMENTC           PIC  X(01).               02270002
022800         10  MR-EDI-DOCUMENTH           PIC  X(01).               02280002
022900         10  MR-EDI-DOCUMENT            PIC  X(03).               02290002
023000                                                                  02300002
023100         10  MR-HOLD-DATEL              PIC S9(04) COMP.          02310002
023200         10  MR-HOLD-DATEA              PIC  X(01).               02320002
023300         10  MR-HOLD-DATEC              PIC  X(01).               02330002
023400         10  MR-HOLD-DATEH              PIC  X(01).               02340002
023500         10  MR-HOLD-DATE               PIC  X(08).               02350002
023600                                                                  02360002
023700         10  MR-RELEASE-DATEL           PIC S9(04) COMP.          02370002
023800         10  MR-RELEASE-DATEA           PIC  X(01).               02380002
023900         10  MR-RELEASE-DATEC           PIC  X(01).               02390002
024000         10  MR-RELEASE-DATEH           PIC  X(01).               02400002
024100         10  MR-RELEASE-DATE            PIC  X(08).               02410002
024200                                                                  02420002
024300*-----------------------------------------------------------------02430002
024400* ATTRIBUTE SETTINGS COPYBOOK                                     02440002
024500*-----------------------------------------------------------------02450002
024600                                                                  02460002
024700     COPY DPWS015.                                                02470002
024800                                                                  02480002
024900*-----------------------------------------------------------------02490002
025000* FUNCTION KEYS COPYBOOK                                          02500002
025100*-----------------------------------------------------------------02510002
025200                                                                  02520002
025300     COPY DPWS016.                                                02530002
025400                                                                  02540002
025500*----------------------------------------------------------------*02550002
025600* COPYBOOK FOR CURRENT SYSTEM DATE/TIME PROCEDURE DIVISION ROUTINE02560002
025700*----------------------------------------------------------------*02570002
025800                                                                  02580002
025900     COPY DPWS017.                                                02590002
026000                                                                  02600002
026100*----------------------------------------------------------------*02610002
026200* COPYBOOK FOR CALENDAR SUBROUTINE (DPKUT500)                     02620002
026300*----------------------------------------------------------------*02630002
026400                                                                  02640002
026500     COPY DPWS500.                                                02650002
026600                                                                  02660002
026700*-----------------------------------------------------------------02670002
026800* NUMERIC EDIT LAYOUT                                             02680002
026900*-----------------------------------------------------------------02690002
027000                                                                  02700002
027100     COPY DPWS010I.                                               02710002
027200                                                                  02720002
027300*-----------------------------------------------------------------02730002
CICS  * PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.               02740005
027500*-----------------------------------------------------------------02750002
027600                                                                  02760002
027700     COPY DPWS030.                                                02770002
CICS       COPY DPWS930.                                                02771005
027800                                                                  02780002
027900*-----------------------------------------------------------------02790002
028000* STANDARD COMMAREA                                               02800002
028100*-----------------------------------------------------------------02810002
028200                                                                  02820002
028300     COPY DPWS020.                                                02830002
028400     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02840002
028500                                                                  02850002
028600*-----------------------------------------------------------------02860002
028700* THIS IS THE INTER-APPLICATION COMMAREA FOR THE EDI DOCUMENTS    02870002
028800* ON HOLD SCREENS.                                                02880002
028900*-----------------------------------------------------------------02890002
029000                                                                  02900002
029100         10  INTER-APPL-COMM-AREA       PIC X(200).               02910002
029200     COPY ETWS345.                                                02920002
029300*-----------------------------------------------------------------02930002
029400* THIS IS THE APPLICATION-SPECIFIC COMMAREA.                      02940002
029500*-----------------------------------------------------------------02950002
029600         10  ASC-SPECIFIC-COMMAREA.                               02960002
029700             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02970002
029800                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  02980002
029900                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   02990002
030000                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03000002
030100                                                                  03010002
030200                 20  ASC-ITEM-ARRAY.                              03020002
030300                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.        03030002
030400                         30  ASC-LIST-ITEM-NUMBER                 03040002
030500                                                     PIC S9(09)   03050002
030600                                                     COMP-3.      03060002
030700                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03070002
030800                             88  ASC-VALID-SELECT    VALUE ' '    03080002
030900                                                           'S'    03090002
031000                                                           'B'    03100002
031100                                                           'E'.   03110002
031200                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03120002
031300                             88  ASC-TEMP-SELECT     VALUE 'S'.   03130002
031400                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03140002
031500                             88  ASC-TEMP-END        VALUE 'E'.   03150002
031600                         30  ASC-SELECTED-SW         PIC  X(01).  03160002
031700                             88  ASC-NO-SELECT       VALUE ' '.   03170002
031800                             88  ASC-SELECT          VALUE 'S'.   03180002
031900                             88  ASC-BEGIN           VALUE 'B'.   03190002
032000                             88  ASC-END             VALUE 'E'.   03200002
032100                         30  ASC-ACTION              PIC  X(03).  03210002
032200                         30  ASC-PO-NBR              PIC  X(22).  03220002
032300                         30  ASC-DEPT-NBR            PIC  X(03).  03230002
032400                         30  ASC-VENDOR-NAME         PIC  X(10).  03240002
032500                         30  ASC-TSET-NME-ID         PIC  X(03).  03250002
032600                             88  ASC-TSET-NME-ID-INV VALUE 'INV'. 03260002
032700                             88  ASC-TSET-NME-ID-ASN VALUE 'ASN'. 03270002
032800                             88  ASC-TSET-NME-ID-POA VALUE 'POA'. 03280002
032900                         30  ASC-TRN-SET-CDE         PIC  X(03).  03290002
033000                         30  ASC-HOLD-DATE.                       03300002
033100                             35  ASC-HOLD-DATE-MM    PIC  X(02).  03310002
033200                             35  ASC-HOLD-DATE-S1    PIC  X.      03320002
033300                             35  ASC-HOLD-DATE-DD    PIC  X(02).  03330002
033400                             35  ASC-HOLD-DATE-S2    PIC  X.      03340002
033500                             35  ASC-HOLD-DATE-YY    PIC  X(02).  03350002
033600                         30  ASC-RELEASE-DATE        PIC  X(08).  03360002
033700                         30  ASC-TP-DKEY             PIC S9(09)   03370002
033800                                                         COMP.    03380002
033900                         30  ASC-TP-DKEY-TMST        PIC  X(26).  03390002
034000                                                                  03400002
034100                                                                  03410002
034200             15  ASC-BLK-SUB                         PIC S9(04)   03420002
034300                                                          COMP    03430002
034400                                                          SYNC.   03440002
034500             15  ASC-ITEM-SUB                        PIC S9(04)   03450002
034600                                                          COMP    03460002
034700                                                          SYNC.   03470002
034800             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03480002
034900                                                          COMP-3. 03490002
035000             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03500002
035100                                                          COMP-3. 03510002
035200             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03520002
035300                                                          COMP-3. 03530002
035400             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03540002
035500                                                          COMP-3. 03550002
035600             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03560002
035700                                                          COMP-3. 03570002
035800             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03580002
035900                                                          COMP    03590002
036000                                                          SYNC.   03600002
036100             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03610002
036200                                                          COMP-3. 03620002
036300             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03630002
036400                                                          COMP-3. 03640002
036500             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03650002
036600                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03660002
036700                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03670002
036800             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03680002
036900                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03690002
037000                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03700002
037100             15  ASC-LIST-QUEUE-NAME.                             03710002
037200                 20  ASC-LIST-TERM-ID                PIC  X(04).  03720002
037300                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03730002
037400                                                          COMP-3. 03740002
037500                 20  ASC-LIST-SEQ                    PIC  9(01).  03750002
037600             15  ASC-INPUT-SEL-QUEUE-NAME            PIC  X(08).  03760002
037700             15  ASC-OUTPUT-SEL-QUEUE-NAME.                       03770002
037800                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03780002
037900                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03790002
038000                                                          COMP-3. 03800002
038100                 20  ASC-SEL-SEQ                     PIC  9(01).  03810002
038200             15  ASC-SEL-SUB                         PIC S9(04)   03820002
038300                                                     COMP.        03830002
038400             15  ASC-SEL-ITEM                        PIC S9(04)   03840002
038500                                                     COMP.        03850002
038600             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   03860002
038700                                                     COMP-3.      03870002
038800             15  ASC-USE-SELECTION-QUEUE-IND         PIC  X.      03880002
038900                 88  ASC-USE-SELECTION-QUEUE         VALUE 'Y'.   03890002
039000                                                                  03900002
039100             15  ASC-CURSOR-SW                       PIC X.       03910002
039200                 88  ASC-ALL-PO-CSR                  VALUE 'A'.   03920002
039300                 88  ASC-DEPT-CSR                    VALUE 'D'.   03930002
039400                 88  ASC-WORKER-CSR                  VALUE 'W'.   03940002
039500                 88  ASC-SEL-DOC-CSR                 VALUE 'S'.   03950002
039600             15  ASC-INT-APPL-FORMAT-IND             PIC X.       03960002
039700                 88  ASC-INT-APPL-FORMAT-CRIT-SPEC   VALUE '1'.   03970002
039800                 88  ASC-INT-APPL-FORMAT-DOC-LIST    VALUE '2'.   03980002
039900                 88  ASC-INT-APPL-FORMAT-EDI-MENU    VALUE '3'.   03990002
040000             15  ASC-RELEASE-PENDING-SW              PIC X.       04000002
040100                 88  ASC-RELEASE-PENDING             VALUE 'Y'.   04010002
040200                 88  ASC-NO-RELEASE-PENDING          VALUES 'N'   04020002
040300                                                            ' '.  04030002
040400             15  ASC-INT-APPL-DEPT-NBR               PIC  X(03).  04040002
040500             15  ASC-INT-APPL-WORKER-NBR             PIC S9(06)   04050002
040600                                                     COMP-3.      04060002
040700*            *----------------------------------------------------04070002
040800*            * THE FOLLOWING AREA IS USED TO HOLD THE SELECTION   04080002
040900*            * QUEUE DATA FOR THE SELECTED ITEM CURRENTLY BEING   04090002
041000*            * PROCESSED.                                         04100002
041100*            *----------------------------------------------------04110002
041200             15  ASC-SAVE-SEL-AREA.                               04120002
041300                 20  ASC-SAVE-SEL-TP-DKEY            PIC S9(09)   04130002
041400                                                         COMP.    04140002
041500                 20  ASC-SAVE-SEL-TP-DKEY-TMST       PIC  X(26).  04150002
041600                 20  ASC-SAVE-SEL-TRN-SET-CDE        PIC  X(03).  04160002
041700                 20  ASC-SAVE-SEL-ENT-NAME-DESC      PIC  X(10).  04170002
041800                                                                  04180002
041900             15  ASC-START-ITEM-REQUEST.                          04190002
042000                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  04200002
042100         10  FILLER                     PIC  X(404).              04210002
042200                                                                  04220002
042300                                                                  04230002
042400*-----------------------------------------------------------------04240002
042500* ABEND PROCESSING COPYBOOK.                                      04250002
042600*-----------------------------------------------------------------04260002
042700                                                                  04270002
042800     COPY DPWS013.                                                04280002
042900                                                                  04290002
043000                                                                  04300002
043100*-----------------------------------------------------------------04310002
043200* DB2 AREA FOR FG/TSET XMIT HOLD TABLE                            04320002
043300*-----------------------------------------------------------------04330002
043400     EXEC SQL                                                     04340002
043500          INCLUDE TFGTRHL                                         04350002
043600     END-EXEC.                                                    04360002
043700                                                                  04370002
043800*-----------------------------------------------------------------04380002
043900* DB2 AREA FOR DOCUMENT P.O. HOLD TABLE                           04390002
044000*-----------------------------------------------------------------04400002
044100     EXEC SQL                                                     04410002
044200          INCLUDE TTRPOHL                                         04420002
044300     END-EXEC.                                                    04430002
044400                                                                  04440002
044500*-----------------------------------------------------------------04450002
044600* DB2 AREA FOR FG/TSET HELD DATA TABLE                            04460002
044700*-----------------------------------------------------------------04470002
044800     EXEC SQL                                                     04480002
044900          INCLUDE TFGTRDT                                         04490002
045000     END-EXEC.                                                    04500002
045100                                                                  04510002
045200*-----------------------------------------------------------------04520002
045300* DB2 AREA FOR ENTITY NAME TABLE                                  04530002
045400*-----------------------------------------------------------------04540002
045500     EXEC SQL                                                     04550002
045600          INCLUDE TENTNME                                         04560002
045700     END-EXEC.                                                    04570002
045800                                                                  04580002
045900*-----------------------------------------------------------------04590002
046000* DB2 AREA FOR TRANSACTION SET TABLE                              04600002
046100*-----------------------------------------------------------------04610002
046200     EXEC SQL                                                     04620002
046300          INCLUDE TTRNSET                                         04630002
046400     END-EXEC.                                                    04640002
046500                                                                  04650002
046600*-----------------------------------------------------------------04660002
046700* DB2 AREA FOR TRADING PARTNER TABLE                              04670002
046800*-----------------------------------------------------------------04680002
046900     EXEC SQL                                                     04690002
047000          INCLUDE TTRDPRT                                         04700002
047100     END-EXEC.                                                    04710002
047200                                                                  04720002
047300*-----------------------------------------------------------------04730002
047400* DB2 AREA FOR RESPONSIBLE AREA TABLE                             04740002
047500*-----------------------------------------------------------------04750002
047600     EXEC SQL                                                     04760002
047700          INCLUDE TRSPBAR                                         04770002
047800     END-EXEC.                                                    04780002
047900                                                                  04790002
048000*-----------------------------------------------------------------04800002
048100* DB2 AREA FOR MERCHANDISE AREA TABLE                             04810002
048200*-----------------------------------------------------------------04820002
048300     EXEC SQL                                                     04830002
048400          INCLUDE TMDSEAR                                         04840002
048500     END-EXEC.                                                    04850002
048600                                                                  04860002
048700*-----------------------------------------------------------------04870002
048800* DB2 AREA FOR COMMUNICATIONS                                     04880002
048900*-----------------------------------------------------------------04890002
049000     EXEC SQL                                                     04900002
049100          INCLUDE SQLCA                                           04910002
049200     END-EXEC.                                                    04920002
049300                                                                  04930002
049400*-----------------------------------------------------------------04940002
049500* CURSOR USED WHEN ENTERING FROM THE EDI MENU OR FROM THE         04950002
049600* CRITERIA SPEC SCREEN WITH NO CRITERIA ENTERED. DISPLAYS ALL     04960002
049700* P.O.'S ON HOLD.                                                 04970002
049800*-----------------------------------------------------------------04980002
049900                                                                  04990002
050000     EXEC SQL                                                     05000002
050100         DECLARE  ALL-PO-CSR CURSOR FOR                           05010002
050200         SELECT   TTRPOHL.PO_NBR                                  05020002
050300                , TTRPOHL.DEPT_NBR                                05030002
050400                , TTRPOHL.TP_DKEY                                 05040002
050500                , TTRPOHL.TP_DKEY_TMST                            05050002
050600                , TFGTRHL.HOLD_DTE                                05060002
050700                , TFGTRHL.TRN_SET_CDE                             05070002
050800                , TENTNME.ENT_NAME_DESC                           05080002
050900                , TTRNSET.TRAN_SET_NME_ID                         05090002
051000         FROM     TTRPOHL                                         05100002
051100                , TFGTRHL                                         05110002
051200                , TENTNME                                         05120002
051300                , TTRNSET                                         05130002
051400                , TTRDPRT                                         05140002
051500         WHERE   TTRPOHL.PO_RLSE_IND  = :PC-RLSE-IND-NOT-RELEASED 05150002
051600           AND   TFGTRHL.TP_DKEY      = TTRPOHL.TP_DKEY           05160002
051700           AND   TFGTRHL.TP_DKEY_TMST = TTRPOHL.TP_DKEY_TMST      05170002
051800           AND   TFGTRHL.TP_DKEY      = TTRDPRT.TP_DKEY           05180002
051900           AND   TTRNSET.TRAN_SET_CDE = TFGTRHL.TRN_SET_CDE       05190002
052000           AND   TENTNME.ENT_ID       = TTRDPRT.ENT_ID            05200002
052100           AND   TENTNME.TYPE_CDE     = '04'                      05210002
052200         ORDER BY  TTRPOHL.PO_NBR                                 05220002
052300                 , TTRPOHL.TP_DKEY_TMST  DESC                     05230002
052400     END-EXEC.                                                    05240002
052500                                                                  05250002
052600*-----------------------------------------------------------------05260002
052700* CURSOR USED WHEN ENTERING FROM THE CRITERIA SPEC WITH A         05270002
052800* DEPARTMENT NUMBER. DISPLAYS ALL P.O.'S ON HOLD FOR THAT         05280002
052900* SPECIFIC DEPARTMENT.                                            05290002
053000*-----------------------------------------------------------------05300002
053100                                                                  05310002
053200     EXEC SQL                                                     05320002
053300         DECLARE DEPT-CSR CURSOR FOR                              05330002
053400         SELECT   TTRPOHL.PO_NBR                                  05340002
053500                , TTRPOHL.DEPT_NBR                                05350002
053600                , TTRPOHL.TP_DKEY                                 05360002
053700                , TTRPOHL.TP_DKEY_TMST                            05370002
053800                , TFGTRHL.HOLD_DTE                                05380002
053900                , TFGTRHL.TRN_SET_CDE                             05390002
054000                , TENTNME.ENT_NAME_DESC                           05400002
054100                , TTRNSET.TRAN_SET_NME_ID                         05410002
054200         FROM     TTRPOHL                                         05420002
054300                , TFGTRHL                                         05430002
054400                , TENTNME                                         05440002
054500                , TTRNSET                                         05450002
054600                , TTRDPRT                                         05460002
054700         WHERE    TTRPOHL.DEPT_NBR     = :ASC-INT-APPL-DEPT-NBR   05470002
054800           AND    TTRPOHL.PO_RLSE_IND  = :PC-RLSE-IND-NOT-RELEASED05480002
054900           AND    TTRPOHL.TP_DKEY      = TFGTRHL.TP_DKEY          05490002
055000           AND    TTRPOHL.TP_DKEY_TMST = TFGTRHL.TP_DKEY_TMST     05500002
055100           AND    TTRDPRT.TP_DKEY      = TFGTRHL.TP_DKEY          05510002
055200           AND    TTRNSET.TRAN_SET_CDE = TFGTRHL.TRN_SET_CDE      05520002
055300           AND    TENTNME.ENT_ID       = TTRDPRT.ENT_ID           05530002
055400           AND    TENTNME.TYPE_CDE     = '04'                     05540002
055500         ORDER BY  TTRPOHL.PO_NBR                                 05550002
055600                 , TTRPOHL.TP_DKEY_TMST  DESC                     05560002
055700     END-EXEC.                                                    05570002
055800                                                                  05580002
055900*-----------------------------------------------------------------05590002
056000* CURSOR USED WHEN ENTERING FROM THE CRITERIA SPEC WITH A         05600002
056100* WORKER NUMBER. DISPLAYS ALL P.O.'S ON HOLD FOR ANY OF THAT      05610002
056200* BUYER'S DEPARTMENTS.                                            05620002
056300*-----------------------------------------------------------------05630002
056400                                                                  05640002
056500     EXEC SQL                                                     05650002
056600         DECLARE WORKER-CSR CURSOR FOR                            05660002
056700         SELECT   TTRPOHL.PO_NBR                                  05670002
056800                , TTRPOHL.DEPT_NBR                                05680002
056900                , TTRPOHL.TP_DKEY                                 05690002
057000                , TTRPOHL.TP_DKEY_TMST                            05700002
057100                , TFGTRHL.HOLD_DTE                                05710002
057200                , TFGTRHL.TRN_SET_CDE                             05720002
057300                , TENTNME.ENT_NAME_DESC                           05730002
057400                , TTRNSET.TRAN_SET_NME_ID                         05740002
057500         FROM     TTRPOHL                                         05750002
057600                , TFGTRHL                                         05760002
057700                , TENTNME                                         05770002
057800                , TTRNSET                                         05780002
057900                , TTRDPRT                                         05790002
058000                , TRSPBAR                                         05800002
058100                , TMDSEAR                                         05810002
058200         WHERE    TRSPBAR.WORKER_NBR   = :ASC-INT-APPL-WORKER-NBR 05820002
058300           AND    TRSPBAR.OPERCO_NBR   = :PC-OPERCO-NBR           05830002
058400           AND    TRSPBAR.RSPLVL_CDE   = :PC-RSPLVL-CDE-BUYER     05840002
058500           AND    CURRENT DATE BETWEEN TRSPBAR.WORKER_STRT_DTE    05850002
058600                                   AND TRSPBAR.WORKER_END_DTE     05860002
058700           AND    TMDSEAR.MDSEAR_DKEY  = TRSPBAR.MDSEAR_DKEY      05870002
058800           AND    TMDSEAR.MDSELV_CDE   = :PC-MDSELV-CDE-DEPT      05880002
058900           AND    CURRENT DATE BETWEEN TMDSEAR.STRT_DTE           05890002
059000                                   AND TMDSEAR.END_DTE            05900002
059100           AND    TTRPOHL.DEPT_NBR    = TMDSEAR.DEPT_NBR          05910002
059200           AND    TTRPOHL.PO_RLSE_IND = :PC-RLSE-IND-NOT-RELEASED 05920002
059300           AND    TTRPOHL.TP_DKEY     = TFGTRHL.TP_DKEY           05930002
059400           AND    TTRPOHL.TP_DKEY_TMST = TFGTRHL.TP_DKEY_TMST     05940002
059500           AND    TTRDPRT.TP_DKEY      = TFGTRHL.TP_DKEY          05950002
059600           AND    TTRNSET.TRAN_SET_CDE = TFGTRHL.TRN_SET_CDE      05960002
059700           AND    TENTNME.ENT_ID       = TTRDPRT.ENT_ID           05970002
059800           AND    TENTNME.TYPE_CDE     = '04'                     05980002
059900         ORDER BY  TTRPOHL.PO_NBR                                 05990002
060000                 , TTRPOHL.TP_DKEY_TMST  DESC                     06000002
060100     END-EXEC.                                                    06010002
060200                                                                  06020002
060300*-----------------------------------------------------------------06030002
060400* CURSOR USED WHEN ENTERING FROM THE DOCUMENTS ON HOLD LIST.      06040002
060500* DISPLAYS ALL P.O.'S ON HOLD FOR THE SELECTED DOCUMENT.          06050002
060600*-----------------------------------------------------------------06060002
060700                                                                  06070002
060800     EXEC SQL                                                     06080002
060900         DECLARE  SEL-DOC-CSR CURSOR FOR                          06090002
061000         SELECT   TTRPOHL.PO_NBR                                  06100002
061100                , TTRPOHL.DEPT_NBR                                06110002
061200                , TFGTRHL.HOLD_DTE                                06120002
061300                , TTRNSET.TRAN_SET_NME_ID                         06130002
061400         FROM     TTRPOHL                                         06140002
061500                , TFGTRHL                                         06150002
061600                , TTRNSET                                         06160002
061700         WHERE   TTRPOHL.PO_RLSE_IND  = :PC-RLSE-IND-NOT-RELEASED 06170002
061800           AND   TTRPOHL.TP_DKEY      = :ASC-SAVE-SEL-TP-DKEY     06180002
061900           AND   TTRPOHL.TP_DKEY_TMST = :ASC-SAVE-SEL-TP-DKEY-TMST06190002
062000           AND   TTRNSET.TRAN_SET_CDE = :ASC-SAVE-SEL-TRN-SET-CDE 06200002
062100           AND   TTRPOHL.TP_DKEY      =  TFGTRHL.TP_DKEY          06210002
062200           AND   TTRPOHL.TP_DKEY_TMST =  TFGTRHL.TP_DKEY_TMST     06220002
062300         ORDER BY  TTRPOHL.PO_NBR                                 06230002
062400     END-EXEC.                                                    06240002
062500                                                                  06250002
062600                                                                  06260002
062700 LINKAGE SECTION.                                                 06270002
062800                                                                  06280002
062900 01  DFHCOMMAREA.                                                 06290002
063000     05  FILLER                         OCCURS  1 TO 4072 TIMES   06300002
063100                                        DEPENDING ON EIBCALEN.    06310002
063200         10  FILLER                     PIC X.                    06320002
063300                                                                  06330002
063400                                                                  06340002
063500 PROCEDURE DIVISION.                                              06350002
063600*-----------------------------------------------------------------06360002
063700* THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM.     06370002
063800* FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM      06380002
063900* PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT.     06390002
064000*-----------------------------------------------------------------06400002
064100                                                                  06410002
064200 0000-MAIN-MODULE.                                                06420002
064300                                                                  06430002
064400     INITIALIZE DP030-CICS-API-FIELDS.                            06440002
064500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       06450002
064600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          06460002
064700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         06470002
064800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       06480002
064900     MOVE LENGTH OF ET348AI        TO DP030-MAP-LENGTH (1).       06490002
065000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     06500002
065100     PERFORM 0001-CALL-CICS-ARCH-API.                             06510002
065200*                                                                 06520002
065300     PERFORM 1000-CONTROL-PROCESSING                              06530002
065400*                                                                 06540002
065500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     06550002
065600     PERFORM 0001-CALL-CICS-ARCH-API.                             06560002
065700                                                                  06570002
065800                                                                  06580002
065900*-----------------------------------------------------------------06590002
066000* THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE       06600002
066100* AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.             06610002
066200*-----------------------------------------------------------------06620002
066300                                                                  06630002
066400 0001-CALL-CICS-ARCH-API.                                         06640002
066500                                                                  06650002
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      06660005
066700                                    DFHCOMMAREA                   06670005
066800                                    DP030-CICS-API-FIELDS         06680005
066900                                    DP020-STANDARD-COMMAREA       06690005
067000                                    ET348AI.                      06700005
067100                                                                  06710002
067200     IF  DP030-RC-CALL-SUCCESSFUL                                 06720002
067300         CONTINUE                                                 06730002
067400     ELSE                                                         06740002
067500         SET DP013-NO-ROLLBACK                                    06750002
067600             DP013-XCTL-DISPLAY-RESTART                           06760002
067700             DP013-CICS-ABEND      TO TRUE                        06770002
067800         MOVE '0001-CALL-CICS-ARCH-API'                           06780002
067900                                   TO DP013-PARAGRAPH             06790002
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O06800005
CICS  -              'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)     06810005
068200         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      06820002
068300         PERFORM DP013-0000-PROCESS-ABEND                         06830002
068400     END-IF.                                                      06840002
068500                                                                  06850002
068600                                                                  06860002
068700*-----------------------------------------------------------------06870002
068800* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT       06880002
068900* COURSE OF ACTION IS FOR THIS TRANSACTION.                       06890002
069000*                                                                 06900002
069100* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE   06910002
069200*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS     06920002
069300*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS    06930002
069400*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS.  06940002
069500*-----------------------------------------------------------------06950002
069600                                                                  06960002
069700 1000-CONTROL-PROCESSING.                                         06970002
069800                                                                  06980002
069900     EVALUATE TRUE                                                06990002
070000         WHEN DP020-NEXT-ACT-INITIAL                              07000002
070100             INITIALIZE ASC-SPECIFIC-COMMAREA                     07010002
070200             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            07020002
070300                                      ASC-SEL-TERM-ID             07030002
070400             MOVE DP020-SRC-TASK-NUMBER                           07040002
070500                                   TO ASC-LIST-TASK-NUMBER        07050002
070600                                      ASC-SEL-TASK-NUMBER         07060002
070700             MOVE PC-LIST-QUEUE-SEQ                               07070002
070800                                   TO ASC-LIST-SEQ                07080002
070900             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 07090002
071000             PERFORM 1100-PROCESS-INTER-APPL-COMM                 07100002
071100             PERFORM 4000-BUILD-INITIAL-PANEL                     07110002
071200                                                                  07120002
071300         WHEN DP020-NEXT-ACT-READ-MAP                             07130002
071400             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        07140002
071500                                   TO PV-TOP-ITEM                 07150002
071600             PERFORM 2000-PROCESS-PANEL                           07160002
071700                                                                  07170002
071800         WHEN DP020-NEXT-ACT-RETURN                               07180002
071900             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        07190002
072000                                   TO PV-TOP-ITEM                 07200002
072100             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07210002
072200             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 07220002
072300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07230002
072400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07240002
072500             IF ASC-RELEASE-PENDING                               07250002
072600                 PERFORM 3250-SET-ATTRIBUTES-TO-PROT              07260002
072700                 SET DP020-MSG-INFORMATIONAL TO TRUE              07270002
072800*                ---- PRESS PF2 TO CONFIRM REQUEST ----           07280002
072900                 MOVE PC-TSYMSG-00004  TO DP020-MSG-NUMBER        07290002
073000             END-IF                                               07300002
073100                                                                  07310002
073200         WHEN OTHER                                               07320002
073300             SET DP013-LOGIC-ABEND TO TRUE                        07330002
073400             SET DP013-NO-ROLLBACK TO TRUE                        07340002
073500             MOVE '1000-CONTROL-PROCESSING'                       07350002
073600                                   TO DP013-PARAGRAPH             07360002
073700             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    07370002
073800                                   TO DP013-MESSAGE-TEXT(1)       07380002
073900             PERFORM DP013-0000-PROCESS-ABEND                     07390002
074000     END-EVALUATE.                                                07400002
074100                                                                  07410002
074200                                                                  07420002
074300*-----------------------------------------------------------------07430002
074400* SAVE FIELDS FROM INTER-APPL COMMAREA.                           07440002
074500*-----------------------------------------------------------------07450002
074600                                                                  07460002
074700 1100-PROCESS-INTER-APPL-COMM.                                    07470002
074800                                                                  07480002
074900     MOVE SPACE                     TO ASC-START-ITEM-REQUEST.    07490002
075000     MOVE DP020-INT-APPL-FORMAT-IND TO ASC-INT-APPL-FORMAT-IND.   07500002
075100     IF ASC-INT-APPL-FORMAT-CRIT-SPEC                             07510002
075200         MOVE ET345-DEPT-NBR        TO ASC-INT-APPL-DEPT-NBR      07520002
075300         MOVE ET345-WORKER-NBR      TO ASC-INT-APPL-WORKER-NBR    07530002
075400     ELSE                                                         07540002
075500         IF ASC-INT-APPL-FORMAT-DOC-LIST                          07550002
075600             SET ASC-USE-SELECTION-QUEUE TO TRUE                  07560002
075700             MOVE ET345-NUMBER-OF-TS-ITEMS                        07570002
075800                               TO ASC-NUMBER-OF-TS-ITEMS          07580002
075900             MOVE ET345-SEL-QUEUE-NAME                            07590002
076000                               TO ASC-INPUT-SEL-QUEUE-NAME        07600002
076100             PERFORM 1120-PREPARE-LIST-ENTRY                      07610002
076200         END-IF                                                   07620002
076300     END-IF.                                                      07630002
076400                                                                  07640002
076500                                                                  07650002
076600*-----------------------------------------------------------------07660002
076700*    GET READY TO START AT THE FIRST ITEM ON THE LIST.            07670002
076800*-----------------------------------------------------------------07680002
076900                                                                  07690002
077000 1120-PREPARE-LIST-ENTRY.                                         07700002
077100                                                                  07710002
077200     MOVE ET346-MAX-ITEMS TO ASC-SEL-SUB.                         07720002
077300     MOVE ZERO            TO ASC-SEL-ITEM.                        07730002
077400     PERFORM 2133-GET-NEXT-SEL-QUEUE-ITEM.                        07740002
077500                                                                  07750002
077600                                                                  07760002
077700*-----------------------------------------------------------------07770002
077800* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA    07780002
077900* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT    07790002
078000* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST   07800002
078100* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID       07810002
078200* FUNCTION KEYS CAN GET THIS FAR.                                 07820002
078300*-----------------------------------------------------------------07830002
078400                                                                  07840002
078500 2000-PROCESS-PANEL.                                              07850002
078600                                                                  07860002
078700     EVALUATE TRUE                                                07870002
078800         WHEN DP020-SRC-AID = DP016-CLEAR                         07880002
078900             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                07890002
079000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07900002
079100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07910002
079200             SET ASC-NO-RELEASE-PENDING TO TRUE                   07920002
079300                                                                  07930002
079400         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    07940002
079500             IF ASC-RELEASE-PENDING                               07950002
079600                 PERFORM 7200-RELEASE-SELECTED-POS                07960002
079700             ELSE                                                 07970002
079800                 PERFORM 2200-MOVE-SCREEN-TO-COMMAREA             07980002
079900                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               07990002
080000                 IF  PS-NO-ERROR                                  08000002
080100                     SET DP020-MSG-FATAL TO TRUE                  08010002
080200*                    ---- UPDATE MUST BE REQUESTED BEFORE ----    08020002
080300*                    ---- CONFIRM                         ----    08030002
080400                     MOVE PC-TSYMSG-00016  TO DP020-MSG-NUMBER    08040002
080500                END-IF                                            08050002
080600             END-IF                                               08060002
080700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08070002
080800                                                                  08080002
080900         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    08090002
081000             PERFORM 2050-DELETE-LIST-QUEUE                       08100002
081100             PERFORM 4000-BUILD-INITIAL-PANEL                     08110002
081200             SET ASC-NO-RELEASE-PENDING TO TRUE                   08120002
081300                                                                  08130002
081400         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    08140002
081500             PERFORM 2140-DESELECT-ALL-ITEMS                      08150002
081600             PERFORM 3200-RESET-ATTRIBUTES                        08160002
081700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08170002
081800             SET ASC-NO-RELEASE-PENDING TO TRUE                   08180002
081900                                                                  08190002
082000         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             08200002
082100             SET ASC-NO-RELEASE-PENDING TO TRUE                   08210002
082200             IF  ASC-USE-SELECTION-QUEUE                          08220002
082300                 PERFORM 2133-GET-NEXT-SEL-QUEUE-ITEM             08230002
082400                 IF PS-LIST-END                                   08240002
082500                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         08250002
082600                     SET PS-NO-LIST-END TO TRUE                   08260002
082700                 ELSE                                             08270002
082800                     PERFORM 2050-DELETE-LIST-QUEUE               08280002
082900                     PERFORM 3200-RESET-ATTRIBUTES                08290002
083000                     PERFORM 4000-BUILD-INITIAL-PANEL             08300002
083100                 END-IF                                           08310002
083200             ELSE                                                 08320002
083300*                ---- BOTTOM OF LIST ----                         08330002
083400                 MOVE PC-TSYMSG-00070                             08340002
083500                                  TO DP020-MSG-NUMBER             08350002
083600                 SET DP020-MSG-INFORMATIONAL TO TRUE              08360002
083700             END-IF                                               08370002
083800                                                                  08380002
083900         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             08390002
084000             SET ASC-NO-RELEASE-PENDING TO TRUE                   08400002
084100             IF  ASC-USE-SELECTION-QUEUE                          08410002
084200                 PERFORM 2137-GET-PREV-SEL-QUEUE-ITEM             08420002
084300                 IF PS-LIST-END                                   08430002
084400                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         08440002
084500                     SET PS-NO-LIST-END TO TRUE                   08450002
084600                 ELSE                                             08460002
084700                     PERFORM 2050-DELETE-LIST-QUEUE               08470002
084800                     PERFORM 3200-RESET-ATTRIBUTES                08480002
084900                     PERFORM 4000-BUILD-INITIAL-PANEL             08490002
085000                 END-IF                                           08500002
085100             ELSE                                                 08510002
085200*                ---- TOP OF LIST ----                            08520002
085300                 MOVE PC-TSYMSG-00069                             08530002
085400                                  TO DP020-MSG-NUMBER             08540002
085500                 SET DP020-MSG-INFORMATIONAL TO TRUE              08550002
085600             END-IF                                               08560002
085700                                                                  08570002
085800         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  08580002
085900             PERFORM 2150-SELECT-ALL-ITEMS                        08590002
086000             PERFORM 3200-RESET-ATTRIBUTES                        08600002
086100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08610002
086200             SET ASC-NO-RELEASE-PENDING TO TRUE                   08620002
086300                                                                  08630002
086400         WHEN OTHER                                               08640002
086500             SET ASC-NO-RELEASE-PENDING TO TRUE                   08650002
086600             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 08660002
086700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08670002
086800             IF  PS-NO-ERROR                                      08680002
086900                 SET DP030-CONTINUE-GO TO TRUE                    08690002
087000                 PERFORM 2100-CHECK-FUNCTION-KEY                  08700002
087100             ELSE                                                 08710002
087200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08720002
087300                 SET DP030-OVERRIDE-GO TO TRUE                    08730002
087400             END-IF                                               08740002
087500     END-EVALUATE.                                                08750002
087600                                                                  08760002
087700                                                                  08770002
087800*-----------------------------------------------------------------08780002
087900*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                      08790002
088000*-----------------------------------------------------------------08800002
088100                                                                  08810002
088200 2050-DELETE-LIST-QUEUE.                                          08820002
088300                                                                  08830002
088400     EXEC CICS                                                    08840002
088500         DELETEQ TS                                               08850002
088600             QUEUE (ASC-LIST-QUEUE-NAME)                          08860002
088700             RESP  (PV-CICS-RESP)                                 08870002
088800     END-EXEC.                                                    08880002
088900                                                                  08890002
089000     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       08900002
089100        (PV-CICS-RESP = DFHRESP(QIDERR))                          08910002
089200         CONTINUE                                                 08920002
089300     ELSE                                                         08930002
089400         SET DP013-CICS-ABEND      TO TRUE                        08940002
089500         SET DP013-NO-ROLLBACK     TO TRUE                        08950002
089600                                                                  08960002
089700         MOVE '2050-DELETE-LIST-QUEUE'                            08970002
089800                                   TO DP013-PARAGRAPH             08980002
089900         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    08990002
090000                                   TO DP013-MESSAGE-TEXT (1)      09000002
090100         PERFORM DP013-0000-PROCESS-ABEND                         09010002
090200     END-IF.                                                      09020002
090300                                                                  09030002
090400     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  09040002
090500                                                                  09050002
090600                                                                  09060002
090700*-----------------------------------------------------------------09070002
090800* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST. 09080002
090900* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE   09090002
091000* CICS ARCHITECTURE API.                                          09100002
091100*-----------------------------------------------------------------09110002
091200                                                                  09120002
091300 2100-CHECK-FUNCTION-KEY.                                         09130002
091400                                                                  09140002
091500     EVALUATE TRUE                                                09150002
091600         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  09160002
091700             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              09170002
091800                 INITIALIZE ET345-NUMBER-OF-TS-ITEMS              09180002
091900                            ET345-SEL-QUEUE-NAME                  09190002
092000                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                09200002
092100                                TO ET345-NUMBER-OF-SELECTED-ITEMS 09210002
092200                 PERFORM 5000-PREPARE-SEL-QUEUE                   09220002
092300             ELSE                                                 09230002
092400                 SET DP030-OVERRIDE-GO                            09240002
092500                                   TO TRUE                        09250002
092600*                ---- A LIST ITEM MUST BE SELECTED ----           09260002
092700                 MOVE PC-TSYMSG-00057                             09270002
092800                                   TO DP020-MSG-NUMBER            09280002
092900                 SET DP020-MSG-WARNING                            09290002
093000                                   TO TRUE                        09300002
093100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             09310002
093200             END-IF                                               09320002
093300                                                                  09330002
093400*        *--------------------------------------------------------09340002
093500*        * 'RELEASE' FUNCTION KEY HIT                             09350002
093600*        *--------------------------------------------------------09360002
093700                                                                  09370002
093800         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              09380002
093900             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              09390002
094000                 SET ASC-RELEASE-PENDING    TO TRUE               09400002
094100                 PERFORM 3250-SET-ATTRIBUTES-TO-PROT              09410002
094200                 SET DP020-MSG-INFORMATIONAL TO TRUE              09420002
094300*                ---- PRESS PF2 TO CONFIRM REQUEST ----           09430002
094400                 MOVE PC-TSYMSG-00004  TO DP020-MSG-NUMBER        09440002
094500             ELSE                                                 09450002
094600*                ---- A LIST ITEM MUST BE SELECTED ----           09460002
094700                 MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER        09470002
094800                 SET DP020-MSG-WARNING TO TRUE                    09480002
094900             END-IF                                               09490002
095000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09500002
095100                                                                  09510002
095200         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  09520002
095300             MOVE +1               TO PV-TOP-ITEM                 09530002
095400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09540002
095500                                                                  09550002
095600         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   09560002
095700             PERFORM 2110-BROWSE-BACKWARD                         09570002
095800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09580002
095900                                                                  09590002
096000         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   09600002
096100             PERFORM 2120-BROWSE-FORWARD                          09610002
096200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09620002
096300                                                                  09630002
096400         WHEN DP020-SRC-AID = DP016-ENTER                         09640002
096500             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   09650002
096600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09660002
096700                                                                  09670002
096800         WHEN OTHER                                               09680002
096900             SET DP013-NO-ROLLBACK                                09690002
097000                 DP013-XCTL-DISPLAY-RESTART                       09700002
097100                 DP013-CICS-ABEND  TO TRUE                        09710002
097200             MOVE '2100-CHECK-FUNCTION-KEY'                       09720002
097300                                   TO DP013-PARAGRAPH             09730002
097400             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      09740002
097500                                   TO DP013-MESSAGE-TEXT (1)      09750002
097600             PERFORM DP013-0000-PROCESS-ABEND                     09760002
097700     END-EVALUATE.                                                09770002
097800                                                                  09780002
097900                                                                  09790002
098000*-----------------------------------------------------------------09800002
098100*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP      09810002
098200*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,       09820002
098300*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST    09830002
098400*    MESSAGE.                                                     09840002
098500*-----------------------------------------------------------------09850002
098600                                                                  09860002
098700 2110-BROWSE-BACKWARD.                                            09870002
098800                                                                  09880002
098900     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    09890002
099000         GIVING PV-TOP-ITEM.                                      09900002
099100                                                                  09910002
099200     IF  ((PV-TOP-ITEM < +1)                                      09920002
099300       OR (PV-TOP-ITEM = +1))                                     09930002
099400         MOVE +1                   TO PV-TOP-ITEM                 09940002
099500*        -- TOP OF LIST --                                        09950002
099600         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            09960002
099700         SET DP020-MSG-INFORMATIONAL TO TRUE                      09970002
099800     END-IF.                                                      09980002
099900                                                                  09990002
100000                                                                  10000002
100100*-----------------------------------------------------------------10010002
100200*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP       10020002
100300*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO    10030002
100400*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.              10040002
100500*-----------------------------------------------------------------10050002
100600                                                                  10060002
100700 2120-BROWSE-FORWARD.                                             10070002
100800                                                                  10080002
100900     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              10090002
101000         GIVING PV-TOP-ITEM.                                      10100002
101100     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   10110002
101200         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            10120002
101300                                   TO PV-TOP-ITEM                 10130002
101400*        -- BOTTOM OF LIST --                                     10140002
101500         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            10150002
101600         SET DP020-MSG-INFORMATIONAL                              10160002
101700                                   TO TRUE                        10170002
101800     ELSE                                                         10180002
101900         COMPUTE PV-BOTTOM-ITEM =                                 10190002
102000             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 10200002
102100         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            10210002
102200*            -- BOTTOM OF LIST --                                 10220002
102300             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            10230002
102400             SET DP020-MSG-INFORMATIONAL                          10240002
102500                                   TO TRUE                        10250002
102600         END-IF                                                   10260002
102700     END-IF.                                                      10270002
102800                                                                  10280002
102900                                                                  10290002
103000*-----------------------------------------------------------------10300002
103100*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO     10310002
103200*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.    10320002
103300*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST   10330002
103400*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.          10340002
103500*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT      10350002
103600*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.           10360002
103700*-----------------------------------------------------------------10370002
103800                                                                  10380002
103900 2130-CHECK-FOR-JUMP-BROWSE.                                      10390002
104000                                                                  10400002
104100     IF (ASC-START-ITEM-REQUEST = SPACE)                          10410002
104200         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            10420002
104300                                   TO PV-TOP-ITEM                 10430002
104400     ELSE                                                         10440002
104500         MOVE ASC-START-ITEM-REQUEST  TO DP010I-UNEDITED-FIELD    10450002
104600         MOVE PC-ITEM-NUMBER-LENGTH   TO DP010I-MAXIMUM-DIGITS    10460002
104700         MOVE +0                      TO DP010I-MAXIMUM-DECIMALS  10470002
104800         SET DP010I-NEGATIVE-NOT-ALLOWED                          10480002
104900                                   TO TRUE                        10490002
105010         CALL DP010I-NUMERIC-EDIT-ROUTINE                         10501003
105020                         USING DP010I-NUMERIC-EDIT-AREA           10502003
105100                                                                  10510002
105200         IF  NOT DP010I-ERROR-DETECTED                            10520002
105300             MOVE DP010I-NUMERIC-FIELD                            10530002
105400                                   TO  ASC-START-ITEM-REQUEST-N   10540002
105500             IF  ASC-START-ITEM-REQUEST-N > ZERO                  10550002
105600                 IF  ASC-START-ITEM-REQUEST-N >                   10560002
105700                                          ASC-NUMBER-OF-ITEMS-READ10570002
105800                     MOVE SPACE TO ASC-START-ITEM-REQUEST         10580002
105900                     COMPUTE PV-TOP-ITEM =                        10590002
106000                             ASC-NUMBER-OF-ITEMS-READ             10600002
106100                             - PC-ITEMS-PER-PANEL + 1             10610002
106200                     IF  PV-TOP-ITEM < +1                         10620002
106300                         MOVE +1   TO PV-TOP-ITEM                 10630002
106400*                        ---- BOTTOM OF LIST ----                 10640002
106500                         MOVE PC-TSYMSG-00070                     10650002
106600                                   TO DP020-MSG-NUMBER            10660002
106700                         SET DP020-MSG-INFORMATIONAL              10670002
106800                                   TO TRUE                        10680002
106900                     END-IF                                       10690002
107000                 ELSE                                             10700002
107100                     MOVE ASC-START-ITEM-REQUEST-N                10710002
107200                                   TO PV-TOP-ITEM                 10720002
107300                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      10730002
107400                     COMPUTE PV-BOTTOM-ITEM =                     10740002
107500                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     10750002
107600                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ10760002
107700*                        -- BOTTOM OF LIST --                     10770002
107800                         MOVE PC-TSYMSG-00070                     10780002
107900                                   TO DP020-MSG-NUMBER            10790002
108000                         SET DP020-MSG-INFORMATIONAL              10800002
108100                                   TO TRUE                        10810002
108200                     END-IF                                       10820002
108300                 END-IF                                           10830002
108400             ELSE                                                 10840002
108500*                --- VALUE OUT OF RANGE ----                      10850002
108600                 MOVE PC-TSYMSG-00101     TO DP020-MSG-NUMBER     10860002
108700                 MOVE -1                  TO ASTRTITL             10870002
108800                 SET DP030-SET-CURSOR-APPL-1                      10880002
108900                                          TO TRUE                 10890002
109000                 MOVE DP015-REVERSE       TO ASTRTITH             10900002
109100                 MOVE DP015-RED           TO ASTRTITC             10910002
109200                 MOVE DP015-UNP-NUM-BRT-OFF                       10920002
109300                                          TO ASTRTITA             10930002
109400                 SET DP020-MSG-FATAL      TO TRUE                 10940002
109500                 SET PS-START-ITEM-ERROR TO TRUE                  10950002
109600             END-IF                                               10960002
109700                                                                  10970002
109800         ELSE                                                     10980002
109900*            ---- MUST BE NUMERIC ----                            10990002
110000             MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER      11000002
110100             MOVE -1                     TO ASTRTITL              11010002
110200             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  11020002
110300             MOVE DP015-REVERSE          TO ASTRTITH              11030002
110400             MOVE DP015-RED              TO ASTRTITC              11040002
110500             MOVE DP015-UNP-NUM-BRT-OFF  TO ASTRTITA              11050002
110600             SET DP020-MSG-FATAL         TO TRUE                  11060002
110700             SET PS-START-ITEM-ERROR     TO TRUE                  11070002
110800         END-IF                                                   11080002
110900     END-IF.                                                      11090002
111000                                                                  11100002
111100                                                                  11110002
111200*----------------------------------------------------------------*11120002
111300* GET THE NEXT DOCUMENT IF A LIST OF DOCMENTS IS BEING PROCESSED. 11130002
111400*----------------------------------------------------------------*11140002
111500                                                                  11150002
111600 2133-GET-NEXT-SEL-QUEUE-ITEM.                                    11160002
111700                                                                  11170002
111800     ADD +1                       TO ASC-SEL-SUB.                 11180002
111900     IF  ASC-SEL-SUB > ET346-MAX-ITEMS                            11190002
112000         ADD +1                   TO ASC-SEL-ITEM                 11200002
112100         MOVE +1                  TO ASC-SEL-SUB                  11210002
112200     END-IF.                                                      11220002
112300     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                11230002
112400         PERFORM 9100-READ-SEL-QUEUE                              11240002
112500         IF  ET346-ITEM (ASC-SEL-SUB) > ZERO                      11250002
112600             MOVE ET346-TP-DKEY      (ASC-SEL-SUB)                11260002
112700                                     TO ASC-SAVE-SEL-TP-DKEY      11270002
112800             MOVE ET346-TP-DKEY-TMST (ASC-SEL-SUB)                11280002
112900                                     TO ASC-SAVE-SEL-TP-DKEY-TMST 11290002
113000             MOVE ET346-TRN-SET-CDE  (ASC-SEL-SUB)                11300002
113100                                     TO ASC-SAVE-SEL-TRN-SET-CDE  11310002
113200             MOVE ET346-VENDOR-NAME  (ASC-SEL-SUB)                11320002
113300                                     TO ASC-SAVE-SEL-ENT-NAME-DESC11330002
113400             IF ET346-ACTION-SW (ASC-SEL-SUB) = SPACE             11340002
113500                 SET ET346-INQ  (ASC-SEL-SUB) TO TRUE             11350002
113600                 PERFORM 9200-REWRITE-SEL-QUEUE                   11360002
113700             END-IF                                               11370002
113800         ELSE                                                     11380002
113900             SUBTRACT +1 FROM ASC-SEL-SUB                         11390002
114000*            ---- BOTTOM OF LIST ----                             11400002
114100             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             11410002
114200             SET DP020-MSG-INFORMATIONAL TO TRUE                  11420002
114300             SET PS-LIST-END             TO TRUE                  11430002
114400         END-IF                                                   11440002
114500     ELSE                                                         11450002
114600         SUBTRACT +1 FROM ASC-SEL-ITEM                            11460002
114700         MOVE ET346-MAX-ITEMS     TO ASC-SEL-SUB                  11470002
114800*        ---- BOTTOM OF LIST ----                                 11480002
114900         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             11490002
115000         SET DP020-MSG-INFORMATIONAL TO TRUE                      11500002
115100         SET PS-LIST-END             TO TRUE                      11510002
115200     END-IF.                                                      11520002
115300                                                                  11530002
115400                                                                  11540002
115500*-----------------------------------------------------------------11550002
115600* GET THE PREVIOUS DOCUMENT IF A LIST OF DOCUMENTS IS BEING       11560002
115700* PROCESSED.                                                      11570002
115800*-----------------------------------------------------------------11580002
115900                                                                  11590002
116000 2137-GET-PREV-SEL-QUEUE-ITEM.                                    11600002
116100                                                                  11610002
116200     SUBTRACT +1 FROM ASC-SEL-SUB.                                11620002
116300     IF  ASC-SEL-SUB < +1                                         11630002
116400         SUBTRACT +1 FROM ASC-SEL-ITEM                            11640002
116500         MOVE ET346-MAX-ITEMS     TO ASC-SEL-SUB                  11650002
116600     END-IF.                                                      11660002
116700                                                                  11670002
116800     IF  ASC-SEL-ITEM > ZERO                                      11680002
116900*        *--------------------------------------------------------11690002
117000*        * MOVE DATA FROM THE SELECTION QUEUE INTO THE            11700002
117100*        * DCLGENS. (THE SELECTION QUEUE IS NOT USED WHEN THE     11710002
117200*        * PROGRAM IS ENTERED FROM THE EDI MENU OR THE            11720002
117300*        * CRITERIA SPEC. IN THOSE CASES, THIS DATA IS FETCHED    11730002
117400*        * FROM THE DB2 TABLES INTO THE DCLGENS.)                 11740002
117500*        *--------------------------------------------------------11750002
117600         PERFORM 9100-READ-SEL-QUEUE                              11760002
117700         MOVE ET346-TP-DKEY      (ASC-SEL-SUB)                    11770002
117800                                     TO ASC-SAVE-SEL-TP-DKEY      11780002
117900         MOVE ET346-TP-DKEY-TMST (ASC-SEL-SUB)                    11790002
118000                                     TO ASC-SAVE-SEL-TP-DKEY-TMST 11800002
118100         MOVE ET346-TRN-SET-CDE  (ASC-SEL-SUB)                    11810002
118200                                     TO ASC-SAVE-SEL-TRN-SET-CDE  11820002
118300         MOVE ET346-VENDOR-NAME  (ASC-SEL-SUB)                    11830002
118400                                     TO ASC-SAVE-SEL-ENT-NAME-DESC11840002
118500     ELSE                                                         11850002
118600         MOVE +1                  TO ASC-SEL-ITEM                 11860002
118700                                     ASC-SEL-SUB                  11870002
118800*        ---- TOP OF LIST ----                                    11880002
118900         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             11890002
119000         SET DP020-MSG-INFORMATIONAL TO TRUE                      11900002
119100         SET PS-LIST-END             TO TRUE                      11910002
119200     END-IF.                                                      11920002
119300                                                                  11930002
119400                                                                  11940002
119500*-----------------------------------------------------------------11950002
119600*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION       11960002
119700*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.          11970002
119800*-----------------------------------------------------------------11980002
119900                                                                  11990002
120000 2140-DESELECT-ALL-ITEMS.                                         12000002
120100                                                                  12010002
120200     MOVE +1                       TO ASC-BLK-SUB.                12020002
120300                                                                  12030002
120400     PERFORM 2141-CLEAR-SELECTED-INDS                             12040002
120500         VARYING ASC-ITEM-SUB                                     12050002
120600         FROM 1 BY 1                                              12060002
120700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12070002
120800                                                                  12080002
120900     ADD +1                        TO ASC-BLK-SUB.                12090002
121000                                                                  12100002
121100     PERFORM 2141-CLEAR-SELECTED-INDS                             12110002
121200         VARYING ASC-ITEM-SUB                                     12120002
121300         FROM 1 BY 1                                              12130002
121400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12140002
121500                                                                  12150002
121600     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               12160002
121700                                   TO PV-LIST-ITEM-NUMBER.        12170002
121800                                                                  12180002
121900     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            12190002
122000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    12200002
122100                                                                  12210002
122200     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     12220002
122300        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      12230002
122400         MOVE +1                   TO ASC-BLK-SUB                 12240002
122500                                                                  12250002
122600         PERFORM 5100-WRITE-TEMP-STORAGE                          12260002
122700                                                                  12270002
122800         MOVE +1                   TO PV-BLOCK-NUMBER             12280002
122900                                                                  12290002
123000         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         12300002
123100             PV-FIRST-BLOCK-IN-ARRAY - 1                          12310002
123200                                                                  12320002
123300         PERFORM                                                  12330002
123400             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       12340002
123500                                                                  12350002
123600             PERFORM 4410-READ-TEMP-STORAGE                       12360002
123700                                                                  12370002
123800             PERFORM 2141-CLEAR-SELECTED-INDS                     12380002
123900                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 12390002
124000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12400002
124100                                                                  12410002
124200             PERFORM 5100-WRITE-TEMP-STORAGE                      12420002
124300                                                                  12430002
124400             ADD +1                TO PV-BLOCK-NUMBER             12440002
124500                                                                  12450002
124600         END-PERFORM                                              12460002
124700                                                                  12470002
124800         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         12480002
124900             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     12490002
125000                                                                  12500002
125100         PERFORM                                                  12510002
125200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       12520002
125300                   ASC-HIGHEST-BLOCK-WRITTEN                      12530002
125400                                                                  12540002
125500             MOVE PV-NEXT-BLOCK-IN-ARRAY                          12550002
125600                                   TO PV-BLOCK-NUMBER             12560002
125700                                                                  12570002
125800             PERFORM 4410-READ-TEMP-STORAGE                       12580002
125900                                                                  12590002
126000             PERFORM 2141-CLEAR-SELECTED-INDS                     12600002
126100                 VARYING ASC-ITEM-SUB                             12610002
126200                 FROM 1 BY 1                                      12620002
126300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12630002
126400                                                                  12640002
126500             PERFORM 5100-WRITE-TEMP-STORAGE                      12650002
126600                                                                  12660002
126700             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12670002
126800                                                                  12680002
126900         END-PERFORM                                              12690002
127000                                                                  12700002
127100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             12710002
127200                                   TO PV-BLOCK-NUMBER             12720002
127300                                                                  12730002
127400         PERFORM 4410-READ-TEMP-STORAGE                           12740002
127500     END-IF.                                                      12750002
127600                                                                  12760002
127700                                                                  12770002
127800     MOVE +0        TO ASC-NUMBER-OF-SELECTED-ITEMS               12780002
127900                       ASC-START-OF-SELECTED-RANGE                12790002
128000                       ASC-END-OF-SELECTED-RANGE.                 12800002
128100                                                                  12810002
128200     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12820002
128300                                                                  12830002
128400                                                                  12840002
128500*-----------------------------------------------------------------12850002
128600*    MARK EACH ITEM AS BEING NOT SELECTED.                        12860002
128700*-----------------------------------------------------------------12870002
128800                                                                  12880002
128900 2141-CLEAR-SELECTED-INDS.                                        12890002
129000                                                                  12900002
129100     IF ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)            12910002
129200             NOT EQUAL ZERO                                       12920002
129300         SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)              12930002
129400             ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        12940002
129500             ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      12950002
129600                               TO TRUE                            12960002
129700     END-IF.                                                      12970002
129800                                                                  12980002
129900                                                                  12990002
130000*-----------------------------------------------------------------13000002
130100*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH   13010002
130200*  FOR ALL ITEMS.                                                 13020002
130300*-----------------------------------------------------------------13030002
130400                                                                  13040002
130500 2150-SELECT-ALL-ITEMS.                                           13050002
130600                                                                  13060002
130700     MOVE ZERO  TO  ASC-NUMBER-OF-SELECTED-ITEMS.                 13070002
130800     MOVE +1    TO  ASC-BLK-SUB.                                  13080002
130900                                                                  13090002
131000     PERFORM 2151-SET-SELECTED-INDS                               13100002
131100         VARYING ASC-ITEM-SUB                                     13110002
131200         FROM 1 BY 1                                              13120002
131300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13130002
131400                                                                  13140002
131500     ADD +1                        TO ASC-BLK-SUB.                13150002
131600                                                                  13160002
131700     PERFORM 2151-SET-SELECTED-INDS                               13170002
131800         VARYING ASC-ITEM-SUB                                     13180002
131900         FROM 1 BY 1                                              13190002
132000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13200002
132100                                                                  13210002
132200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               13220002
132300                                   TO PV-LIST-ITEM-NUMBER.        13230002
132400                                                                  13240002
132500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            13250002
132600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    13260002
132700                                                                  13270002
132800     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     13280002
132900        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    13290002
133000         MOVE +1                   TO ASC-BLK-SUB                 13300002
133100                                                                  13310002
133200         PERFORM 5100-WRITE-TEMP-STORAGE                          13320002
133300                                                                  13330002
133400         MOVE +1                   TO PV-BLOCK-NUMBER             13340002
133500                                                                  13350002
133600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         13360002
133700             PV-FIRST-BLOCK-IN-ARRAY - 1                          13370002
133800                                                                  13380002
133900         PERFORM                                                  13390002
134000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       13400002
134100                                                                  13410002
134200             PERFORM 4410-READ-TEMP-STORAGE                       13420002
134300                                                                  13430002
134400             PERFORM 2151-SET-SELECTED-INDS                       13440002
134500                 VARYING ASC-ITEM-SUB                             13450002
134600                 FROM 1 BY 1                                      13460002
134700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13470002
134800                                                                  13480002
134900             PERFORM 5100-WRITE-TEMP-STORAGE                      13490002
135000                                                                  13500002
135100             ADD +1                TO PV-BLOCK-NUMBER             13510002
135200                                                                  13520002
135300         END-PERFORM                                              13530002
135400                                                                  13540002
135500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         13550002
135600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     13560002
135700                                                                  13570002
135800         PERFORM                                                  13580002
135900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       13590002
136000                   ASC-HIGHEST-BLOCK-WRITTEN                      13600002
136100                                                                  13610002
136200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          13620002
136300                                   TO PV-BLOCK-NUMBER             13630002
136400                                                                  13640002
136500             PERFORM 4410-READ-TEMP-STORAGE                       13650002
136600                                                                  13660002
136700             PERFORM 2151-SET-SELECTED-INDS                       13670002
136800                 VARYING ASC-ITEM-SUB                             13680002
136900                 FROM 1 BY 1                                      13690002
137000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13700002
137100                                                                  13710002
137200             PERFORM 5100-WRITE-TEMP-STORAGE                      13720002
137300                                                                  13730002
137400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      13740002
137500                                                                  13750002
137600         END-PERFORM                                              13760002
137700                                                                  13770002
137800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             13780002
137900                                   TO PV-BLOCK-NUMBER             13790002
138000                                                                  13800002
138100         PERFORM 4410-READ-TEMP-STORAGE                           13810002
138200     END-IF.                                                      13820002
138300                                                                  13830002
138400     MOVE +0        TO ASC-START-OF-SELECTED-RANGE                13840002
138500                       ASC-END-OF-SELECTED-RANGE.                 13850002
138600                                                                  13860002
138700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        13870002
138800                                                                  13880002
138900                                                                  13890002
139000*-----------------------------------------------------------------13900002
139100*    MARK EACH ITEM AS BEING SELECTED.                            13910002
139200*-----------------------------------------------------------------13920002
139300                                                                  13930002
139400 2151-SET-SELECTED-INDS.                                          13940002
139500                                                                  13950002
139600     IF ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) NOT = ZERO 13960002
139700         IF ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB) = PC-REL        13970002
139800             SET ASC-NO-SELECT      (ASC-BLK-SUB ASC-ITEM-SUB)    13980002
139900                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    13990002
140000                 ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                 14000002
140100                                       TO  TRUE                   14010002
140200         ELSE                                                     14020002
140300             ADD +1  TO  ASC-NUMBER-OF-SELECTED-ITEMS             14030002
140400             SET ASC-SELECT         (ASC-BLK-SUB ASC-ITEM-SUB)    14040002
140500                 ASC-TEMP-SELECT    (ASC-BLK-SUB ASC-ITEM-SUB)    14050002
140600                 ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                 14060002
140700                                       TO  TRUE                   14070002
140800         END-IF                                                   14080002
140900     END-IF.                                                      14090002
141000                                                                  14100002
141100                                                                  14110002
141200*-----------------------------------------------------------------14120002
141300* MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE       14130002
141400* SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.    14140002
141500*-----------------------------------------------------------------14150002
141600                                                                  14160002
141700 2200-MOVE-SCREEN-TO-COMMAREA.                                    14170002
141800                                                                  14180002
141900     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             14190002
142000     MOVE +1                       TO PV-SUB.                     14200002
142100                                                                  14210002
142200     PERFORM 3100-SET-SUBSCRIPTS.                                 14220002
142300     IF  ASTRTITL > ZERO                                          14230002
142400         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          14240002
142500     ELSE                                                         14250002
142600         IF ASTRTITF = DP015-ERASE-EOF                            14260002
142700             MOVE SPACE TO ASC-START-ITEM-REQUEST                 14270002
142800         END-IF.                                                  14280002
142900                                                                  14290002
143000     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          14300002
143100         VARYING PV-SUB                                           14310002
143200         FROM 1 BY 1                                              14320002
143300         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      14330002
143400                                                                  14340002
143500                                                                  14350002
143600*-----------------------------------------------------------------14360002
143700* MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA.  14370002
143800*-----------------------------------------------------------------14380002
143900                                                                  14390002
144000 2210-MOVE-LINES-TO-COMMAREA.                                     14400002
144100                                                                  14410002
144200     IF  MR-SELECTL (PV-SUB) > ZERO                               14420002
144300         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             14430002
144400         MOVE MR-SELECT (PV-SUB)                                  14440002
144500                                   TO ASC-TEMP-SELECTED-SW        14450002
144600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      14460002
144700     ELSE                                                         14470002
144800         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                14480002
144900                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     14490002
145000                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        14500002
145100                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      14510002
145200         END-IF                                                   14520002
145300     END-IF.                                                      14530002
145400     ADD +1                        TO ASC-ITEM-SUB.               14540002
145500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        14550002
145600         ADD +1                    TO ASC-BLK-SUB                 14560002
145700         MOVE +1                   TO ASC-ITEM-SUB                14570002
145800     END-IF.                                                      14580002
145900                                                                  14590002
146000                                                                  14600002
146100*-----------------------------------------------------------------14610002
146200* EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE         14620002
146300* COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).    14630002
146400*-----------------------------------------------------------------14640002
146500                                                                  14650002
146600 3000-EDIT-DATA-IN-COMMAREA.                                      14660002
146700                                                                  14670002
146800     SET PS-NO-ERROR               TO TRUE.                       14680002
146900     PERFORM 3200-RESET-ATTRIBUTES.                               14690002
147000     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     14700002
147100                                                                  14710002
147200* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              14720002
147300* EDITTING IS DONE FROM THE BOTTOM UP.                            14730002
147400*                                                                 14740002
147500     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       14750002
147600         ASC-ITEMS-DISPLAYED - 1.                                 14760002
147700     PERFORM 3100-SET-SUBSCRIPTS.                                 14770002
147800     PERFORM 3300-EDIT-SELECTIONS                                 14780002
147900         VARYING PV-SUB                                           14790002
148000         FROM PV-SUB BY -1                                        14800002
148100         UNTIL PV-SUB < +1                                        14810002
148200                                                                  14820002
148300     IF  PS-NO-ERROR                                              14830002
148400         PERFORM 3400-CHECK-RANGE-SEQUENCE                        14840002
148500     END-IF.                                                      14850002
148600                                                                  14860002
148700     IF  ((PS-NO-ERROR)                                           14870002
148800       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   14880002
148900       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    14890002
149000             PERFORM 3500-MARK-RANGE-AS-SELECTED                  14900002
149100     END-IF.                                                      14910002
149200                                                                  14920002
149300                                                                  14930002
149400*-----------------------------------------------------------------14940002
149500*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM  14950002
149600*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL 14960002
149700*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                   14970002
149800*                                                                 14980002
149900*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS    14990002
150000*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT     15000002
150100*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION   15010002
150200*    US IN THE 2ND BLOCK OF THE ARRAY.                            15020002
150300*-----------------------------------------------------------------15030002
150400                                                                  15040002
150500 3100-SET-SUBSCRIPTS.                                             15050002
150600                                                                  15060002
150700     COMPUTE ASC-ITEM-SUB =                                       15070002
150800         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        15080002
150900                                                                  15090002
151000     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         15100002
151100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            15110002
151200                                                                  15120002
151300         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               15130002
151400     ELSE                                                         15140002
151500         MOVE +1                     TO ASC-BLK-SUB               15150002
151600     END-IF.                                                      15160002
151700                                                                  15170002
151800                                                                  15180002
151900*-----------------------------------------------------------------15190002
152000* RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.        15200002
152100*-----------------------------------------------------------------15210002
152200                                                                  15220002
152300 3200-RESET-ATTRIBUTES.                                           15230002
152400                                                                  15240002
152500     MOVE DP015-UNP-NUM-NOR-OFF    TO ASTRTITA.                   15250002
152600     MOVE DP015-GREEN              TO ASTRTITC.                   15260002
152700     MOVE DP015-UNDERLINE          TO ASTRTITH.                   15270002
152800                                                                  15280002
152900     PERFORM                                                      15290002
153000         VARYING PV-SUB                                           15300002
153100         FROM 1 BY 1                                              15310002
153200         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        15320002
153300         MOVE DP015-UNP-ALP-NOR-OFF                               15330002
153400                                   TO MR-SELECTA (PV-SUB)         15340002
153500         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         15350002
153600         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         15360002
153700     END-PERFORM.                                                 15370002
153800                                                                  15380002
153900                                                                  15390002
154000 3250-SET-ATTRIBUTES-TO-PROT.                                     15400002
154100                                                                  15410002
154200     PERFORM                                                      15420002
154300         VARYING PV-SUB FROM 1 BY 1                               15430002
154400         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        15440002
154500             MOVE DP015-PRO-NOR-OFF    TO MR-SELECTA (PV-SUB)     15450002
154600             MOVE DP015-BLUE           TO MR-SELECTC (PV-SUB)     15460002
154700             MOVE DP015-HL-OFF         TO MR-SELECTH (PV-SUB)     15470002
154800     END-PERFORM.                                                 15480002
154900     MOVE -1                           TO ASTRTITL.               15490002
155000     SET DP030-SET-CURSOR-APPL-1       TO TRUE.                   15500002
155100                                                                  15510002
155200                                                                  15520002
155300*-----------------------------------------------------------------15530002
155400* EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS       15540002
155500* WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'      15550002
155600* IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR       15560002
155700* WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.                15570002
155800*-----------------------------------------------------------------15580002
155900                                                                  15590002
156000 3300-EDIT-SELECTIONS.                                            15600002
156100                                                                  15610002
156200     EVALUATE TRUE                                                15620002
156300         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     15630002
156400             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         15640002
156500                 CONTINUE                                         15650002
156600         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         15660002
156700             IF NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)         15670002
156800                 IF ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB) = PC-REL15680002
156900*                    ---- DATA DOES NOT EXIST ----                15690002
157000                     MOVE PC-TSYMSG-00148   TO DP020-MSG-NUMBER   15700002
157100                     SET DP020-MSG-FATAL    TO TRUE               15710002
157200                     MOVE -1                TO MR-SELECTL (PV-SUB)15720002
157300                     SET DP030-SET-CURSOR-APPL-1                  15730002
157400                                            TO TRUE               15740002
157500                     MOVE DP015-RED         TO MR-SELECTC (PV-SUB)15750002
157600                     MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)15760002
157700                     SET PS-ERROR           TO TRUE               15770002
157800                 ELSE                                             15780002
157900                     ADD +1 TO ASC-NUMBER-OF-SELECTED-ITEMS       15790002
158000                     IF ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)      15800002
158100                         MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE15810002
158200                     ELSE                                         15820002
158300                         IF ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)    15830002
158400                             MOVE ZERO                            15840002
158500                                  TO ASC-END-OF-SELECTED-RANGE    15850002
158600                         END-IF                                   15860002
158700                     END-IF                                       15870002
158800                     MOVE ASC-TEMP-SELECTED-SW                    15880002
158900                                        (ASC-BLK-SUB ASC-ITEM-SUB)15890002
159000                         TO ASC-SELECTED-SW                       15900002
159100                                        (ASC-BLK-SUB ASC-ITEM-SUB)15910002
159200                 END-IF                                           15920002
159300             END-IF                                               15930002
159400         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     15940002
159500                 = SPACE                                          15950002
159600             EVALUATE TRUE                                        15960002
159700                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       15970002
159800                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS15980002
159900                     MOVE SPACE TO ASC-SELECTED-SW                15990002
160000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16000002
160100                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        16010002
160200                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    16020002
160300                     MOVE SPACE TO ASC-SELECTED-SW                16030002
160400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16040002
160500                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          16050002
160600                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      16060002
160700                     MOVE SPACE TO ASC-SELECTED-SW                16070002
160800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16080002
160900             END-EVALUATE                                         16090002
161000         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           16100002
161100             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            16110002
161200                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    16120002
161300             END-IF                                               16130002
161400             PERFORM 3310-EDIT-RANGE                              16140002
161500         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             16150002
161600             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            16160002
161700                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    16170002
161800             END-IF                                               16180002
161900             PERFORM 3310-EDIT-RANGE                              16190002
162000         WHEN OTHER                                               16200002
162100*            ---- INVALID VALUE ----                              16210002
162200             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           16220002
162300             SET DP020-MSG-FATAL    TO TRUE                       16230002
162400             MOVE -1                TO MR-SELECTL (PV-SUB)        16240002
162500             SET DP030-SET-CURSOR-APPL-1                          16250002
162600                                    TO TRUE                       16260002
162700             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        16270002
162800             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        16280002
162900             SET PS-ERROR TO TRUE                                 16290002
163000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            16300002
163100                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     16310002
163200                 MOVE SPACE         TO ASC-SELECTED-SW            16320002
163300                                        (ASC-BLK-SUB ASC-ITEM-SUB)16330002
163400             END-IF                                               16340002
163500     END-EVALUATE.                                                16350002
163600                                                                  16360002
163700     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 16370002
163800     SUBTRACT +1 FROM ASC-ITEM-SUB.                               16380002
163900     IF  ASC-ITEM-SUB < 1                                         16390002
164000         SUBTRACT +1 FROM ASC-BLK-SUB                             16400002
164100         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                16410002
164200     END-IF.                                                      16420002
164300                                                                  16430002
164400                                                                  16440002
164500*-----------------------------------------------------------------16450002
164600* IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A         16460002
164700* RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1       16470002
164800* ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)   16480002
164900* THE ENDING.                                                     16490002
165000*-----------------------------------------------------------------16500002
165100                                                                  16510002
165200 3310-EDIT-RANGE.                                                 16520002
165300                                                                  16530002
165400     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                16540002
165500         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   16550002
165600             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)16560002
165700                                   TO ASC-SELECTED-SW             16570002
165800                                        (ASC-BLK-SUB ASC-ITEM-SUB)16580002
165900             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 16590002
166000         ELSE                                                     16600002
166100             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     16610002
166200                 CONTINUE                                         16620002
166300             ELSE                                                 16630002
166400*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        16640002
166500                 MOVE PC-TSYMSG-00054                             16650002
166600                                   TO DP020-MSG-NUMBER            16660002
166700                 SET DP020-MSG-FATAL                              16670002
166800                                   TO TRUE                        16680002
166900                 MOVE -1           TO MR-SELECTL (PV-SUB)         16690002
167000                 SET DP030-SET-CURSOR-APPL-1                      16700002
167100                                   TO TRUE                        16710002
167200                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         16720002
167300                 MOVE DP015-UNDERLINE                             16730002
167400                                   TO MR-SELECTH (PV-SUB)         16740002
167500                 SET PS-ERROR      TO TRUE                        16750002
167600             END-IF                                               16760002
167700         END-IF                                                   16770002
167800     ELSE                                                         16780002
167900         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     16790002
168000             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 16800002
168100                                   TO ASC-SELECTED-SW             16810002
168200                                     (ASC-BLK-SUB ASC-ITEM-SUB)   16820002
168300             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   16830002
168400         ELSE                                                     16840002
168500             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       16850002
168600                 CONTINUE                                         16860002
168700             ELSE                                                 16870002
168800*                -- ONLY ONE END-OF-RANGE ALLOWED --              16880002
168900                 MOVE PC-TSYMSG-00055                             16890002
169000                                   TO DP020-MSG-NUMBER            16900002
169100                 SET DP020-MSG-FATAL                              16910002
169200                                   TO TRUE                        16920002
169300                 MOVE -1           TO MR-SELECTL (PV-SUB)         16930002
169400                 SET DP030-SET-CURSOR-APPL-1                      16940002
169500                                   TO TRUE                        16950002
169600                 SET PS-ERROR      TO TRUE                        16960002
169700             END-IF                                               16970002
169800         END-IF                                                   16980002
169900     END-IF.                                                      16990002
170000                                                                  17000002
170100                                                                  17010002
170200*-----------------------------------------------------------------17020002
170300* IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,       17030002
170400* MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.     17040002
170500*-----------------------------------------------------------------17050002
170600                                                                  17060002
170700 3400-CHECK-RANGE-SEQUENCE.                                       17070002
170800                                                                  17080002
170900     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       17090002
171000       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      17100002
171100       AND  ASC-START-OF-SELECTED-RANGE >                         17110002
171200                                         ASC-END-OF-SELECTED-RANGE17120002
171300*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                17130002
171400         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 17140002
171500         SET DP020-MSG-FATAL TO TRUE                              17150002
171600         SET PS-ERROR TO TRUE                                     17160002
171700         PERFORM 3410-POSITION-AT-ERROR                           17170002
171800     ELSE                                                         17180002
171900         MOVE -1 TO MR-SELECTL (1)                                17190002
172000     END-IF.                                                      17200002
172100     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       17210002
172200                                                                  17220002
172300                                                                  17230002
172400*-----------------------------------------------------------------17240002
172500* BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE       17250002
172600* PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR    17260002
172700* SHOULD BE POSITIONED ON A RANGE ERROR.                          17270002
172800*-----------------------------------------------------------------17280002
172900                                                                  17290002
173000 3410-POSITION-AT-ERROR.                                          17300002
173100                                                                  17310002
173200     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 17320002
173300                    - PV-TOP-ITEM + 1.                            17330002
173400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      17340002
173500         CONTINUE                                                 17350002
173600     ELSE                                                         17360002
173700         MOVE -1                   TO MR-SELECTL (PV-SUB)         17370002
173800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         17380002
173900         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         17390002
174000     END-IF.                                                      17400002
174100*                                                                 17410002
174200     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   17420002
174300                    - PV-TOP-ITEM + 1.                            17430002
174400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      17440002
174500         CONTINUE                                                 17450002
174600     ELSE                                                         17460002
174700         MOVE -1                   TO MR-SELECTL (PV-SUB)         17470002
174800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         17480002
174900         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         17490002
175000     END-IF.                                                      17500002
175100                                                                  17510002
175200                                                                  17520002
175300*-----------------------------------------------------------------17530002
175400*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE     17540002
175500*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS     17550002
175600*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.              17560002
175700*-----------------------------------------------------------------17570002
175800                                                                  17580002
175900 3500-MARK-RANGE-AS-SELECTED.                                     17590002
176000                                                                  17600002
176100     MOVE +1                       TO  ASC-BLK-SUB.               17610002
176200     PERFORM 3510-MARK-SELECTED-INDS                              17620002
176300         VARYING ASC-ITEM-SUB                                     17630002
176400         FROM 1 BY 1                                              17640002
176500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17650002
176600                                                                  17660002
176700     ADD +1                        TO ASC-BLK-SUB.                17670002
176800     PERFORM 3510-MARK-SELECTED-INDS                              17680002
176900         VARYING ASC-ITEM-SUB                                     17690002
177000         FROM 1 BY 1                                              17700002
177100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17710002
177200                                                                  17720002
177300     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               17730002
177400                                   TO  PV-LIST-ITEM-NUMBER.       17740002
177500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            17750002
177600         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         17760002
177700               PC-ITEMS-PER-PANEL).                               17770002
177800                                                                  17780002
177900     MOVE ASC-START-OF-SELECTED-RANGE                             17790002
178000                                   TO PV-START-OF-SELECTED-RANGE. 17800002
178100     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            17810002
178200         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  17820002
178300               PC-ITEMS-PER-PANEL).                               17830002
178400                                                                  17840002
178500     MOVE ASC-END-OF-SELECTED-RANGE                               17850002
178600                                   TO  PV-END-OF-SELECTED-RANGE.  17860002
178700     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             17870002
178800         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    17880002
178900               PC-ITEMS-PER-PANEL).                               17890002
179000     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             17900002
179100         PV-FIRST-BLOCK-IN-ARRAY + 1.                             17910002
179200                                                                  17920002
179300     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    17930002
179400        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        17940002
179500         MOVE +1                   TO ASC-BLK-SUB                 17950002
179600         PERFORM 5100-WRITE-TEMP-STORAGE                          17960002
179700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         17970002
179800             PV-FIRST-BLOCK-IN-ARRAY - 1                          17980002
179900                                                                  17990002
180000         PERFORM                                                  18000002
180100             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      18010002
180200                   PV-PREV-BLOCK-IN-ARRAY                         18020002
180300             MOVE PV-FIRST-BLOCK-IN-RANGE                         18030002
180400                                   TO PV-BLOCK-NUMBER             18040002
180500             PERFORM 4410-READ-TEMP-STORAGE                       18050002
180600             PERFORM 3510-MARK-SELECTED-INDS                      18060002
180700                 VARYING ASC-ITEM-SUB                             18070002
180800                 FROM 1 BY 1                                      18080002
180900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          18090002
181000             PERFORM 5100-WRITE-TEMP-STORAGE                      18100002
181100             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     18110002
181200         END-PERFORM                                              18120002
181300                                                                  18130002
181400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         18140002
181500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     18150002
181600         PERFORM                                                  18160002
181700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       18170002
181800                   PV-LAST-BLOCK-IN-RANGE                         18180002
181900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          18190002
182000                                   TO PV-BLOCK-NUMBER             18200002
182100             PERFORM 4410-READ-TEMP-STORAGE                       18210002
182200             PERFORM 3510-MARK-SELECTED-INDS                      18220002
182300                 VARYING ASC-ITEM-SUB                             18230002
182400                 FROM 1 BY 1                                      18240002
182500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          18250002
182600             PERFORM 5100-WRITE-TEMP-STORAGE                      18260002
182700             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      18270002
182800         END-PERFORM                                              18280002
182900                                                                  18290002
183000         MOVE PV-FIRST-BLOCK-IN-ARRAY                             18300002
183100                                   TO PV-BLOCK-NUMBER             18310002
183200         PERFORM 4410-READ-TEMP-STORAGE                           18320002
183300     END-IF.                                                      18330002
183400                                                                  18340002
183500     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 18350002
183600                                      ASC-END-OF-SELECTED-RANGE.  18360002
183700                                                                  18370002
183800                                                                  18380002
183900*-----------------------------------------------------------------18390002
184000* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.            18400002
184100*-----------------------------------------------------------------18410002
184200                                                                  18420002
184300 3510-MARK-SELECTED-INDS.                                         18430002
184400                                                                  18440002
184500     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         18450002
184600                                ASC-ITEM-SUB) >                   18460002
184700         ASC-START-OF-SELECTED-RANGE)                             18470002
184800     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         18480002
184900                                ASC-ITEM-SUB) =                   18490002
185000         ASC-START-OF-SELECTED-RANGE)                             18500002
185100                                                                  18510002
185200         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     18520002
185300                                    ASC-ITEM-SUB) <               18530002
185400             ASC-END-OF-SELECTED-RANGE)                           18540002
185500         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     18550002
185600                                    ASC-ITEM-SUB) =               18560002
185700             ASC-END-OF-SELECTED-RANGE)                           18570002
185800                                                                  18580002
185900             IF NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)         18590002
186000                 IF ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB) = PC-REL18600002
186100                     SET ASC-NO-SELECT (ASC-BLK-SUB  ASC-ITEM-SUB)18610002
186200                     ASC-TEMP-NO-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)18620002
186300                     ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              18630002
186400                               TO TRUE                            18640002
186500                 ELSE                                             18650002
186600                     SET ASC-SELECT    (ASC-BLK-SUB  ASC-ITEM-SUB)18660002
186700                     ASC-TEMP-SELECT   (ASC-BLK-SUB  ASC-ITEM-SUB)18670002
186800                     ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              18680002
186900                               TO TRUE                            18690002
187000                     ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS18700002
187100                 END-IF                                           18710002
187200             END-IF                                               18720002
187300         END-IF                                                   18730002
187400     END-IF.                                                      18740002
187500                                                                  18750002
187600                                                                  18760002
187700*-----------------------------------------------------------------18770002
187800*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                         18780002
187900*    INITIALIZE ALL COUNTERS AND FLAGS.                           18790002
188000*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.   18800002
188100*    DISPLAY THE PANEL TO USER.                                   18810002
188200*-----------------------------------------------------------------18820002
188300                                                                  18830002
188400 4000-BUILD-INITIAL-PANEL.                                        18840002
188500                                                                  18850002
188600     INITIALIZE                   ASC-BLOCK-ENTRIES (1)           18860002
188700                                  ASC-BLOCK-ENTRIES (2).          18870002
188800     MOVE +1                   TO ASC-BLK-SUB.                    18880002
188900     SET ASC-ITEMS-LEFT-ON-DB  TO TRUE.                           18890002
189000     SET PS-DATA-AVAILABLE     TO TRUE.                           18900002
189100                                                                  18910002
189200     MOVE +0                 TO ASC-ITEM-SUB                      18920002
189300                                ASC-NUMBER-OF-ITEMS-READ          18930002
189400                                ASC-NUMBER-OF-SELECTED-ITEMS      18940002
189500                                ASC-HIGHEST-BLOCK-WRITTEN         18950002
189600                                ASC-START-OF-SELECTED-RANGE       18960002
189700                                ASC-END-OF-SELECTED-RANGE         18970002
189800                                ASC-ITEM-AT-TOP-OF-PANEL.         18980002
189900                                                                  18990002
190000*    *------------------------------------------------------------19000002
190100*    * DETERMINE WHICH CURSOR SHOULD BE USED. IF THIS PROGRAM WAS 19010002
190200*    * ENTERED FROM THE EDI MENU, ALL P.O.'S SHOULD BE RETRIEVED. 19020002
190300*    * IF THIS PROGRAM WAS ENTERED FROM THE CRITERIA SPEC SCREEN, 19030002
190400*    * THE FIELDS PASSED TO THIS PROGRAM FROM THE CRITERIA SPEC   19040002
190500*    * (IN THE INTER APPL COMMAREA) ARE USED TO DETERMINE WHICH   19050002
190600*    * P.O.'S TO RETRIEVE. IF THIS PROGRAM WAS ENTERED FROM THE   19060002
190700*    * DOCUMENTS ON HOLD LIST, AN ITEM IS READ FROM THE SELECTION 19070002
190800*    * QUEUE TO DETERMINE WHICH P.O.'S TO RETRIEVE.               19080002
190900*    *------------------------------------------------------------19090002
191000                                                                  19100002
191100     EVALUATE TRUE                                                19110002
191200         WHEN ASC-INT-APPL-FORMAT-EDI-MENU                        19120002
191300             SET ASC-ALL-PO-CSR TO TRUE                           19130002
191400         WHEN ASC-INT-APPL-FORMAT-CRIT-SPEC                       19140002
191500             IF ASC-INT-APPL-WORKER-NBR = ZERO                    19150002
191600                 IF ASC-INT-APPL-DEPT-NBR = SPACE                 19160002
191700                     SET ASC-ALL-PO-CSR TO TRUE                   19170002
191800                 ELSE                                             19180002
191900                     SET ASC-DEPT-CSR TO TRUE                     19190002
192000                 END-IF                                           19200002
192100             ELSE                                                 19210002
192200                 SET ASC-WORKER-CSR TO TRUE                       19220002
192300             END-IF                                               19230002
192400         WHEN ASC-INT-APPL-FORMAT-DOC-LIST                        19240002
192500             SET  ASC-SEL-DOC-CSR       TO TRUE                   19250002
192600*            *----------------------------------------------------19260002
192700*            * THE FOLLOWING FIELDS WERE READ FROM THE SELECTION  19270002
192800*            * QUEUE AND SAVED IN THE ASC, SO THEY DO NOT HAVE    19280002
192900*            * TO BE RETRIEVED FROM THE DB2 TABLES. THEY ARE      19290002
193000*            * MOVED FROM THE ASC INTO THE DCLGENS.               19300002
193100*            *----------------------------------------------------19310002
193200             MOVE ASC-SAVE-SEL-TP-DKEY     TO TRPOHL-TP-DKEY      19320002
193300             MOVE ASC-SAVE-SEL-TP-DKEY-TMST                       19330002
193400                                           TO TRPOHL-TP-DKEY-TMST 19340002
193500             MOVE ASC-SAVE-SEL-TRN-SET-CDE TO FGTRHL-TRN-SET-CDE  19350002
193600             MOVE ASC-SAVE-SEL-ENT-NAME-DESC                      19360002
193700                                           TO ENTNME-ENT-NAME-DESC19370002
193800         WHEN OTHER                                               19380002
193900             SET ASC-ALL-PO-CSR TO TRUE                           19390002
194000     END-EVALUATE.                                                19400002
194100                                                                  19410002
194200     PERFORM Z800-OPEN-CURSOR.                                    19420002
194300                                                                  19430002
194400     IF PS-DATA-NOT-AVAILABLE                                     19440002
194500         CONTINUE                                                 19450002
194600     ELSE                                                         19460002
194700         PERFORM 4300-READ-ITEMS-FROM-DB                          19470002
194800         IF PS-DATA-NOT-AVAILABLE                                 19480002
194900             CONTINUE                                             19490002
195000         ELSE                                                     19500002
195100             PERFORM Z820-CLOSE-CURSOR                            19510002
195200                                                                  19520002
195300             MOVE +1 TO  PV-TOP-ITEM                              19530002
195400             IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                  19540002
195500                 SET DP020-MSG-FATAL        TO  TRUE              19550002
195600*                ---- NO LIST ITEMS FOUND FOR CRITERIA ----       19560002
195700                 MOVE PC-TSYMSG-00050       TO  DP020-MSG-NUMBER  19570002
195800                 IF DP020-FK-REFRESH        (DP020-SRC-AID)       19580002
195900                 OR DP020-FK-PREV-SELECTION (DP020-SRC-AID)       19590002
196000                 OR DP020-FK-NEXT-SELECTION (DP020-SRC-AID)       19600002
196100                     CONTINUE                                     19610002
196200                 ELSE                                             19620002
196300                     SET DP020-NEXT-ACT-APPL-ERROR TO TRUE        19630002
196400                 END-IF                                           19640002
196500             ELSE                                                 19650002
196600                 MOVE -1                     TO MR-SELECTL (1)    19660002
196700                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              19670002
196800             END-IF                                               19680002
196900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 19690002
197000         END-IF                                                   19700002
197100     END-IF.                                                      19710002
197200                                                                  19720002
197300     IF PS-DATA-NOT-AVAILABLE                                     19730002
197400         SET DP020-MSG-WARNING  TO TRUE                           19740002
197500*        ---- WAIT 15 SECONDS, THEN RETRY ----                    19750002
197600         MOVE PC-TSYMSG-00551   TO  DP020-MSG-NUMBER              19760002
197700         IF DP020-FK-REFRESH        (DP020-SRC-AID)               19770002
197800         OR DP020-FK-PREV-SELECTION (DP020-SRC-AID)               19780002
197900         OR DP020-FK-NEXT-SELECTION (DP020-SRC-AID)               19790002
198000             CONTINUE                                             19800002
198100         ELSE                                                     19810002
198200             SET  DP020-NEXT-ACT-APPL-ERROR TO TRUE               19820002
198300         END-IF                                                   19830002
198400     END-IF.                                                      19840002
198500                                                                  19850002
198600*-----------------------------------------------------------------19860002
198700*  READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE       19870002
198800*  BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,        19880002
198900*  WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND     19890002
199000*  BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE        19900002
199100*  2ND BLOCK MAKING IT AVAILABLE TO BE USED.                      19910002
199200*                                                                 19920002
199300*  DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE       19930002
199400*  ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM     19940002
199500*  UPON INITIALIZATION.                                           19950002
199600*-----------------------------------------------------------------19960002
199700                                                                  19970002
199800 4300-READ-ITEMS-FROM-DB.                                         19980002
199900                                                                  19990002
200000*    *------------------------------------------------------------20000002
200100*    * MOST OF THE CALENDAR ROUTINE FIELDS USED IN CALCULATING THE20010002
200200*    * RELEASE DATE FOR EACH DOCUMENT ARE INITIALIZED HERE RATHER 20020002
200300*    * THAN WHEN THE RELEASE DATE IS CALCULATED  BECAUSE THEY ONLY20030002
200400*    * NEED TO BE INITIALIZED ONCE, RATHER THAN ONCE FOR EACH     20040002
200500*    * DOCUMENT.                                                  20050002
200600*    *------------------------------------------------------------20060002
200700     INITIALIZE  DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.             20070002
200800     PERFORM DP017-0000-GET-CURR-DATE-TIME.                       20080002
200900     MOVE DP017-CURRENT-DATE-YMD TO DPG51-SYSTEM-DATE.            20090002
201000     SET  DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                     20100002
201100     SET  DPG52-LK-DTE-ISO-FMT      TO TRUE.                      20110002
201200                                                                  20120002
201300     PERFORM                                                      20130002
201400         VARYING PV-READ-COUNT                                    20140002
201500         FROM 1 BY 1                                              20150002
201600         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    20160002
201700            OR (ASC-NO-ITEMS-LEFT-ON-DB)                          20170002
201800            OR (PS-DATA-NOT-AVAILABLE))                           20180002
201900                                                                  20190002
202000         PERFORM Z810-FETCH-CURSOR                                20200002
202100                                                                  20210002
202200         IF  PS-DATA-AVAILABLE                                    20220002
202300         AND ASC-ITEMS-LEFT-ON-DB                                 20230002
202400             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                20240002
202500                 ADD +1            TO ASC-ITEM-SUB                20250002
202600             ELSE                                                 20260002
202700                 ADD +1            TO ASC-BLK-SUB                 20270002
202800                 MOVE +1           TO ASC-ITEM-SUB                20280002
202900                                                                  20290002
203000                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         20300002
203100                     MOVE +1       TO ASC-BLK-SUB                 20310002
203200                     SET ASC-BLOCK-MODIFIED (1) TO TRUE           20320002
203300                     PERFORM 5100-WRITE-TEMP-STORAGE              20330002
203400                     MOVE ASC-BLOCK-ENTRIES                       20340002
203500                                          (PC-MAX-BLOCKS-IN-ARRAY)20350002
203600                                 TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)20360002
203700                     ADD +1        TO ASC-BLK-SUB                 20370002
203800                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   20380002
203900                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      20390002
204000                                                           TO TRUE20400002
204100                 END-IF                                           20410002
204200             END-IF                                               20420002
204300             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    20430002
204400             MOVE ASC-NUMBER-OF-ITEMS-READ                        20440002
204500                         TO ASC-LIST-ITEM-NUMBER                  20450002
204600                                        (ASC-BLK-SUB ASC-ITEM-SUB)20460002
204700             MOVE TRPOHL-PO-NBR                                   20470002
204800                         TO ASC-PO-NBR  (ASC-BLK-SUB ASC-ITEM-SUB)20480002
204900             MOVE TRPOHL-DEPT-NBR                                 20490002
205000                         TO ASC-DEPT-NBR                          20500002
205100                                        (ASC-BLK-SUB ASC-ITEM-SUB)20510002
205200             MOVE FGTRHL-HOLD-DTE (3:2)                           20520002
205300                         TO ASC-HOLD-DATE-YY                      20530002
205400                                        (ASC-BLK-SUB ASC-ITEM-SUB)20540002
205500             MOVE FGTRHL-HOLD-DTE (6:2)                           20550002
205600                         TO ASC-HOLD-DATE-MM                      20560002
205700                                        (ASC-BLK-SUB ASC-ITEM-SUB)20570002
205800             MOVE FGTRHL-HOLD-DTE (9:2)                           20580002
205900                         TO ASC-HOLD-DATE-DD                      20590002
206000                                        (ASC-BLK-SUB ASC-ITEM-SUB)20600002
206100             MOVE '/' TO ASC-HOLD-DATE-S1                         20610002
206200                                        (ASC-BLK-SUB ASC-ITEM-SUB)20620002
206300                         ASC-HOLD-DATE-S2                         20630002
206400                                        (ASC-BLK-SUB ASC-ITEM-SUB)20640002
206500             MOVE ENTNME-ENT-NAME-DESC                            20650002
206600                         TO ASC-VENDOR-NAME                       20660002
206700                                        (ASC-BLK-SUB ASC-ITEM-SUB)20670002
206800             MOVE FGTRHL-TRN-SET-CDE                              20680002
206900                     TO ASC-TRN-SET-CDE (ASC-BLK-SUB ASC-ITEM-SUB)20690002
207000             MOVE TRNSET-TRAN-SET-NME-ID                          20700002
207100                     TO ASC-TSET-NME-ID (ASC-BLK-SUB ASC-ITEM-SUB)20710002
207200             PERFORM 4350-CALC-RELEASE-DATE                       20720002
207300             MOVE TRPOHL-TP-DKEY                                  20730002
207400                      TO ASC-TP-DKEY    (ASC-BLK-SUB ASC-ITEM-SUB)20740002
207500             MOVE TRPOHL-TP-DKEY-TMST                             20750002
207600                      TO ASC-TP-DKEY-TMST                         20760002
207700                                        (ASC-BLK-SUB ASC-ITEM-SUB)20770002
207800         END-IF                                                   20780002
207900     END-PERFORM.                                                 20790002
208000                                                                  20800002
208100     IF PS-DATA-NOT-AVAILABLE                                     20810002
208200         CONTINUE                                                 20820002
208300     ELSE                                                         20830002
208400         IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                      20840002
208500             MOVE +1               TO ASC-BLK-SUB                 20850002
208600             PERFORM 5100-WRITE-TEMP-STORAGE                      20860002
208700             ADD +1                TO ASC-BLK-SUB                 20870002
208800             PERFORM 5100-WRITE-TEMP-STORAGE                      20880002
208900                                                                  20890002
209000             MOVE 1                TO ASC-BLK-SUB                 20900002
209100                                      PV-BLOCK-NUMBER             20910002
209200             PERFORM 4410-READ-TEMP-STORAGE                       20920002
209300             IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1         20930002
209400                 MOVE 2            TO ASC-BLK-SUB                 20940002
209500                                      PV-BLOCK-NUMBER             20950002
209600                 PERFORM 4410-READ-TEMP-STORAGE                   20960002
209700             END-IF                                               20970002
209800         END-IF                                                   20980002
209900     END-IF.                                                      20990002
210000                                                                  21000002
210100                                                                  21010002
210200 4350-CALC-RELEASE-DATE.                                          21020002
210300                                                                  21030002
210400     IF ASC-TSET-NME-ID-INV (ASC-BLK-SUB ASC-ITEM-SUB)            21040002
210500         SET  DPG51-INCREMENT-DATE TO TRUE                        21050002
210600         MOVE 12 TO DPG51-INCR-DECR-BUS-DAYS-9                    21060002
210700     ELSE                                                         21070002
210800         IF ASC-TSET-NME-ID-ASN (ASC-BLK-SUB ASC-ITEM-SUB)        21080002
210900         OR ASC-TSET-NME-ID-POA (ASC-BLK-SUB ASC-ITEM-SUB)        21090002
211000             SET  DPG51-INCREMENT-DATE TO TRUE                    21100002
211100             MOVE 10 TO DPG51-INCR-DECR-BUS-DAYS-9                21110002
211200         ELSE                                                     21120002
211300             SET DPG51-DO-NOT-INCR-DECR-DATE TO TRUE              21130002
211400         END-IF                                                   21140002
211500     END-IF.                                                      21150002
211600                                                                  21160002
211700     MOVE FGTRHL-HOLD-DTE           TO DPG52-LK-DATE-INPUT.       21170002
211800                                                                  21180002
211900     CALL PC-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53             21190002
212000                                    DPG54 DPG55 DPG56.            21200002
212100     EVALUATE TRUE                                                21210002
212200         WHEN DPG54-SEVERE-ERROR                                  21220002
212300         WHEN DPG54-DATE-INVALID                                  21230002
212400             MOVE '4350-CALC-RELEASE-DATE'                        21240002
212500                           TO  DP013-PARAGRAPH                    21250002
212600             MOVE 'ERROR DETECTED BY CALENDAR ROUTINE:'           21260002
212700                           TO  DP013-MESSAGE-TEXT (1)             21270002
212800             MOVE DPG54-ERROR-MESSAGE                             21280002
212900                           TO  DP013-MESSAGE-TEXT (2)             21290002
213000             SET DP013-LOGIC-ABEND TO  TRUE                       21300002
213100             PERFORM DP013-0000-PROCESS-ABEND                     21310002
213200     END-EVALUATE.                                                21320002
213300                                                                  21330002
213400     MOVE DPG55-GREG-DATE-FMT TO ASC-RELEASE-DATE                 21340002
213500                                       (ASC-BLK-SUB ASC-ITEM-SUB).21350002
213600                                                                  21360002
213700                                                                  21370002
213800*-----------------------------------------------------------------21380002
213900* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.      21390002
214000*-----------------------------------------------------------------21400002
214100                                                                  21410002
214200 4400-MOVE-COMMAREA-TO-SCREEN.                                    21420002
214300                                                                  21430002
214400     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             21440002
214500         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          21450002
214600         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          21460002
214700             MOVE +1    TO ASC-BLK-SUB                            21470002
214800             PERFORM 5100-WRITE-TEMP-STORAGE                      21480002
214900             ADD +1     TO ASC-BLK-SUB                            21490002
215000             PERFORM 5100-WRITE-TEMP-STORAGE                      21500002
215100             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             21510002
215200                 GIVING PV-BLOCK-NUMBER                           21520002
215300                 REMAINDER PV-REMAINDER                           21530002
215400             IF  PV-REMAINDER > ZERO                              21540002
215500                 ADD +1 TO PV-BLOCK-NUMBER                        21550002
215600             END-IF                                               21560002
215700             MOVE +1    TO ASC-BLK-SUB                            21570002
215800             PERFORM 4410-READ-TEMP-STORAGE                       21580002
215900             ADD +1     TO ASC-BLK-SUB                            21590002
216000                           PV-BLOCK-NUMBER                        21600002
216100             PERFORM 4410-READ-TEMP-STORAGE                       21610002
216200     END-IF.                                                      21620002
216300     MOVE +1            TO ASC-BLK-SUB.                           21630002
216400     COMPUTE ASC-ITEM-SUB =                                       21640002
216500         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              21650002
216600         + PC-ITEMS-PER-PANEL).                                   21660002
216700                                                                  21670002
216800     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        21680002
216900         ADD +1         TO ASC-BLK-SUB                            21690002
217000         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            21700002
217100     END-IF.                                                      21710002
217200                                                                  21720002
217300     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           21730002
217400         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                21740002
217500     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        21750002
217600     PERFORM 4420-FORMAT-LIST-LINES                               21760002
217700         VARYING PV-SUB                                           21770002
217800         FROM PC-ITEMS-PER-PANEL BY -1                            21780002
217900         UNTIL PV-SUB < +1.                                       21790002
218000                                                                  21800002
218100     COMPUTE ASC-ITEMS-DISPLAYED =                                21810002
218200         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          21820002
218300     IF PS-NO-START-ITEM-ERROR                                    21830002
218400         MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL21840002
218500                                          ASTRTITO                21850002
218600         MOVE SPACE                    TO ASC-START-ITEM-REQUEST  21860002
218700     ELSE                                                         21870002
218800         MOVE ASC-START-ITEM-REQUEST   TO ASTRTITO                21880002
218900     END-IF.                                                      21890002
219000     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    21900002
219100     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    21910002
219200     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            21920002
219300                                   TO ASELITO.                    21930002
219400                                                                  21940002
219500     IF  DP020-MSG-NUMBER-X = SPACE                               21950002
219600         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  21960002
219700*            --- MORE ITEMS TO DISPLAY ----                       21970002
219800             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            21980002
219900             SET DP020-MSG-INFORMATIONAL TO TRUE                  21990002
220000         END-IF                                                   22000002
220100     END-IF.                                                      22010002
220200                                                                  22020002
220300                                                                  22030002
220400*-----------------------------------------------------------------22040002
220500*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.          22050002
220600*-----------------------------------------------------------------22060002
220700                                                                  22070002
220800 4410-READ-TEMP-STORAGE.                                          22080002
220900                                                                  22090002
221000     EXEC CICS                                                    22100002
221100         READQ TS                                                 22110002
221200             QUEUE (ASC-LIST-QUEUE-NAME)                          22120002
221300             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22130002
221400             ITEM  (PV-BLOCK-NUMBER)                              22140002
221500             RESP  (PV-CICS-RESP)                                 22150002
221600     END-EXEC.                                                    22160002
221700                                                                  22170002
221800     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       22180002
221900       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     22190002
222000         CONTINUE                                                 22200002
222100     ELSE                                                         22210002
222200         SET DP013-CICS-ABEND     TO TRUE                         22220002
222300         SET DP013-NO-ROLLBACK    TO TRUE                         22230002
222400         MOVE '4410-READ-TEMP-STORAGE'                            22240002
222500                                  TO DP013-PARAGRAPH              22250002
222600         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      22260002
222700                                  TO DP013-MESSAGE-TEXT(1)        22270002
222800         PERFORM DP013-0000-PROCESS-ABEND                         22280002
222900     END-IF.                                                      22290002
223000                                                                  22300002
223100     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             22310002
223200                                                                  22320002
223300     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         22330002
223400         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               22340002
223500     END-IF.                                                      22350002
223600                                                                  22360002
223700                                                                  22370002
223800*-----------------------------------------------------------------22380002
223900*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.     22390002
224000*-----------------------------------------------------------------22400002
224100                                                                  22410002
224200 4420-FORMAT-LIST-LINES.                                          22420002
224300                                                                  22430002
224400     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      22440002
224500         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                22450002
224600         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA      (PV-SUB)      22460002
224700         MOVE DP015-HL-OFF       TO MR-SELECTH      (PV-SUB)      22470002
224800         MOVE SPACE              TO MR-SELECT       (PV-SUB)      22480002
224900                                    MR-ACTION       (PV-SUB)      22490002
225000                                    MR-PO-NBR       (PV-SUB)      22500002
225100                                    MR-VENDOR-NAME  (PV-SUB)      22510002
225200                                    MR-EDI-DOCUMENT (PV-SUB)      22520002
225300                                    MR-HOLD-DATE    (PV-SUB)      22530002
225400                                    MR-RELEASE-DATE (PV-SUB)      22540002
225500     ELSE                                                         22550002
225600         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      22560002
225700                                                   > SPACE        22570002
225800             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 22580002
225900                                 TO MR-SELECT (PV-SUB)            22590002
226000         ELSE                                                     22600002
226100             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      22610002
226200                                 TO MR-SELECT (PV-SUB)            22620002
226300         END-IF                                                   22630002
226400                                                                  22640002
226500         IF  DP030-SET-CURSOR-TRAILER                             22650002
226600             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)22660002
226700                 > SPACE)                                         22670002
226800               OR (PV-SUB = 1))                                   22680002
226900                SET DP030-SET-CURSOR-APPL-1 TO TRUE               22690002
227000                MOVE -1          TO MR-SELECTL (PV-SUB)           22700002
227100             END-IF                                               22710002
227200         END-IF                                                   22720002
227300                                                                  22730002
227400         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           22740002
227500             MOVE ASC-ACTION         (ASC-BLK-SUB ASC-ITEM-SUB)   22750002
227600                  TO MR-ACTION       (PV-SUB)                     22760002
227700             MOVE ASC-PO-NBR         (ASC-BLK-SUB ASC-ITEM-SUB)   22770002
227800                  TO MR-PO-NBR       (PV-SUB)                     22780002
227900             MOVE ASC-VENDOR-NAME    (ASC-BLK-SUB ASC-ITEM-SUB)   22790002
228000                  TO MR-VENDOR-NAME  (PV-SUB)                     22800002
228100             MOVE ASC-TSET-NME-ID    (ASC-BLK-SUB ASC-ITEM-SUB)   22810002
228200                  TO MR-EDI-DOCUMENT (PV-SUB)                     22820002
228300             MOVE ASC-HOLD-DATE      (ASC-BLK-SUB ASC-ITEM-SUB)   22830002
228400                  TO MR-HOLD-DATE    (PV-SUB)                     22840002
228500             MOVE ASC-RELEASE-DATE   (ASC-BLK-SUB ASC-ITEM-SUB)   22850002
228600                  TO MR-RELEASE-DATE (PV-SUB)                     22860002
228700         END-IF                                                   22870002
228800     END-IF.                                                      22880002
228900     SUBTRACT +1 FROM ASC-ITEM-SUB                                22890002
229000     IF  ASC-ITEM-SUB < + 1                                       22900002
229100         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  22910002
229200         MOVE +1                 TO ASC-BLK-SUB                   22920002
229300     END-IF.                                                      22930002
229400                                                                  22940002
229500                                                                  22950002
229600*-----------------------------------------------------------------22960002
229700* IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF      22970002
229800* RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,         22980002
229900* ISSUE A WARNING.                                                22990002
230000*-----------------------------------------------------------------23000002
230100                                                                  23010002
230200 4430-CHECK-FOR-BEGIN-AND-END.                                    23020002
230300                                                                  23030002
230400     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       23040002
230500         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     23050002
230600*            -- NO END-OF-RANGE SPECFIED ---                      23060002
230700             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            23070002
230800             SET DP020-MSG-WARNING TO TRUE                        23080002
230900             PERFORM 4431-POSITION-AT-WARNING                     23090002
231000         END-IF                                                   23100002
231100     ELSE                                                         23110002
231200         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     23120002
231300*            -- NO BEGINNING-OF-RANGE SPECFIED ---                23130002
231400             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            23140002
231500             SET DP020-MSG-WARNING TO TRUE                        23150002
231600             PERFORM 4431-POSITION-AT-WARNING                     23160002
231700         END-IF                                                   23170002
231800     END-IF.                                                      23180002
231900                                                                  23190002
232000                                                                  23200002
232100*-----------------------------------------------------------------23210002
232200* ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,     23220002
232300* DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE      23230002
232400* IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND           23240002
232500* POSITION THE CURSOR THERE.                                      23250002
232600*-----------------------------------------------------------------23260002
232700                                                                  23270002
232800 4431-POSITION-AT-WARNING.                                        23280002
232900                                                                  23290002
233000     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 23300002
233100                    - PV-TOP-ITEM + 1.                            23310002
233200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      23320002
233300         CONTINUE                                                 23330002
233400     ELSE                                                         23340002
233500         SET DP030-SET-CURSOR-APPL-1                              23350002
233600                                   TO TRUE                        23360002
233700         MOVE -1                   TO MR-SELECTL (PV-SUB)         23370002
233800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         23380002
233900         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         23390002
234000     END-IF.                                                      23400002
234100                                                                  23410002
234200     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   23420002
234300                    - PV-TOP-ITEM + 1.                            23430002
234400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      23440002
234500         CONTINUE                                                 23450002
234600     ELSE                                                         23460002
234700         SET DP030-SET-CURSOR-APPL-1                              23470002
234800                                   TO TRUE                        23480002
234900         MOVE -1                   TO MR-SELECTL (PV-SUB)         23490002
235000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         23500002
235100         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         23510002
235200     END-IF.                                                      23520002
235300                                                                  23530002
235400                                                                  23540002
235500*-----------------------------------------------------------------23550002
235600* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-   23560002
235700* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT      23570002
235800* FOR THE SELECTED ITEMS QUEUE.                                   23580002
235900*                                                                 23590002
236000* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION      23600002
236100* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN     23610002
236200* THE ARRAY IS FULL.                                              23620002
236300*-----------------------------------------------------------------23630002
236400                                                                  23640002
236500 5000-PREPARE-SEL-QUEUE.                                          23650002
236600                                                                  23660002
236700     MOVE +1                   TO  ASC-BLK-SUB.                   23670002
236800     PERFORM 5100-WRITE-TEMP-STORAGE.                             23680002
236900     ADD +1                    TO  ASC-BLK-SUB.                   23690002
237000     PERFORM 5100-WRITE-TEMP-STORAGE.                             23700002
237100                                                                  23710002
237200     MOVE ASC-OUTPUT-SEL-QUEUE-NAME  TO  ET345-SEL-QUEUE-NAME.    23720002
237300     PERFORM 6010-DELETE-SEL-QUEUE.                               23730002
237400                                                                  23740002
237500     SET ASC-UPDATE-TSQ        TO  TRUE.                          23750002
237600                                                                  23760002
237700     SET ET346-IDX             TO  1.                             23770002
237800     MOVE ZERO                 TO ET345-NUMBER-OF-TS-ITEMS.       23780002
237900     INITIALIZE ET346-SELECTED-ITEM-ARRAY.                        23790002
238000                                                                  23800002
238100     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           23810002
238200             VARYING PV-ITEM                                      23820002
238300             FROM 1 BY 1                                          23830002
238400             UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN.           23840002
238500                                                                  23850002
238600     IF  ET346-IDX > 1                                            23860002
238700         PERFORM 5205-WRITE-SEL-QUEUE                             23870002
238800         ADD +1                TO ET345-NUMBER-OF-TS-ITEMS        23880002
238900     END-IF.                                                      23890002
239000                                                                  23900002
239100                                                                  23910002
239200*-----------------------------------------------------------------23920002
239300*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.       23930002
239400*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.     23940002
239500*-----------------------------------------------------------------23950002
239600                                                                  23960002
239700 5100-WRITE-TEMP-STORAGE.                                         23970002
239800                                                                  23980002
239900     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     23990002
240000                                   TO PV-LIST-ITEM-NUMBER.        24000002
240100     COMPUTE PV-BLOCK-NUMBER =                                    24010002
240200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    24020002
240300                                                                  24030002
240400     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             24040002
240500     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             24050002
240600         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      24060002
240700             PERFORM 5105-REWRITE-ASC-LISTQ                       24070002
240800         END-IF                                                   24080002
240900     ELSE                                                         24090002
241000         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       24100002
241100         ASC-HIGHEST-BLOCK-WRITTEN + 1                            24110002
241200         PERFORM 5110-WRITE-ASC-LISTQ                             24120002
241300         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   24130002
241400     END-IF.                                                      24140002
241500                                                                  24150002
241600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             24160002
241700                                                                  24170002
241800                                                                  24180002
241900*-----------------------------------------------------------------24190002
242000* REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       24200002
242100* SPECIFIC COMMAREA.                                              24210002
242200*-----------------------------------------------------------------24220002
242300                                                                  24230002
242400 5105-REWRITE-ASC-LISTQ.                                          24240002
242500                                                                  24250002
242600     EXEC CICS                                                    24260002
242700         WRITEQ TS                                                24270002
242800             QUEUE (ASC-LIST-QUEUE-NAME)                          24280002
242900             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               24290002
243000             ITEM  (PV-BLOCK-NUMBER)                              24300002
243100             REWRITE                                              24310002
243200             RESP  (PV-CICS-RESP)                                 24320002
243300     END-EXEC.                                                    24330002
243400                                                                  24340002
243500     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           24350002
243600         CONTINUE                                                 24360002
243700     ELSE                                                         24370002
243800         SET DP013-CICS-ABEND            TO TRUE                  24380002
243900         SET DP013-NO-ROLLBACK           TO TRUE                  24390002
244000         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       24400002
244100         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     24410002
244200                                         TO DP013-MESSAGE-TEXT(1) 24420002
244300         PERFORM DP013-0000-PROCESS-ABEND                         24430002
244400     END-IF.                                                      24440002
244500                                                                  24450002
244600                                                                  24460002
244700*-----------------------------------------------------------------24470002
244800* WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-         24480002
244900* SPECIFIC COMMAREA.                                              24490002
245000*-----------------------------------------------------------------24500002
245100                                                                  24510002
245200 5110-WRITE-ASC-LISTQ.                                            24520002
245300                                                                  24530002
245400     EXEC CICS                                                    24540002
245500         WRITEQ TS                                                24550002
245600             QUEUE (ASC-LIST-QUEUE-NAME)                          24560002
245700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               24570002
245800             ITEM  (PV-BLOCK-NUMBER)                              24580002
245900             RESP  (PV-CICS-RESP)                                 24590002
246000     END-EXEC.                                                    24600002
246100     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      24610002
246200         SET DP013-CICS-ABEND      TO TRUE                        24620002
246300         SET DP013-NO-ROLLBACK     TO TRUE                        24630002
246400         MOVE '5110-WRITE-ASC-LISTQ'                              24640002
246500                                   TO DP013-PARAGRAPH             24650002
246600         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           24660002
246700                                   TO DP013-MESSAGE-TEXT(1)       24670002
246800         PERFORM DP013-0000-PROCESS-ABEND                         24680002
246900     END-IF.                                                      24690002
247000                                                                  24700002
247100                                                                  24710002
247200*-----------------------------------------------------------------24720002
247300* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS  24730002
247400* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.                24740002
247500*-----------------------------------------------------------------24750002
247600                                                                  24760002
247700 5200-FILL-SEL-QUEUE-RECORD.                                      24770002
247800                                                                  24780002
247900     PERFORM 6112-READ-LIST-QUEUE.                                24790002
248000                                                                  24800002
248100     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       24810002
248200         PERFORM                                                  24820002
248300         VARYING LQW-IDX                                          24830002
248400         FROM 1 BY 1                                              24840002
248500         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            24850002
248600           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          24860002
248700                                                                  24870002
248800             IF  LQW-SELECT (LQW-IDX)                             24880002
248900                 MOVE LQW-LIST-ITEM-NUMBER  (LQW-IDX)             24890002
249000                      TO ET346-ITEM         (ET346-IDX)           24900002
249100                 MOVE SPACE                                       24910002
249200                      TO ET346-ACTION-SW    (ET346-IDX)           24920002
249300                 MOVE LQW-TP-DKEY           (LQW-IDX)             24930002
249400                      TO ET346-TP-DKEY      (ET346-IDX)           24940002
249500                 MOVE LQW-TP-DKEY-TMST      (LQW-IDX)             24950002
249600                      TO ET346-TP-DKEY-TMST (ET346-IDX)           24960002
249700                 MOVE LQW-TRN-SET-CDE       (LQW-IDX)             24970002
249800                      TO ET346-TRN-SET-CDE  (ET346-IDX)           24980002
249900                 MOVE LQW-VENDOR-NAME       (LQW-IDX)             24990002
250000                      TO ET346-VENDOR-NAME  (ET346-IDX)           25000002
250100                 MOVE LQW-PO-NBR            (LQW-IDX)             25010002
250200                      TO ET346-PO-NBR       (ET346-IDX)           25020002
250300                 MOVE LQW-DEPT-NBR          (LQW-IDX)             25030002
250400                      TO ET346-DEPT-NBR     (ET346-IDX)           25040002
250500                 SET ET346-IDX UP BY 1                            25050002
250600                 IF  ET346-IDX > ET346-MAX-ITEMS                  25060002
250700                     PERFORM 5205-WRITE-SEL-QUEUE                 25070002
250800                     ADD +1        TO ET345-NUMBER-OF-TS-ITEMS    25080002
250900                     INITIALIZE ET346-SELECTED-ITEM-ARRAY         25090002
251000                     SET ET346-IDX TO  1                          25100002
251100                 END-IF                                           25110002
251200             END-IF                                               25120002
251300         END-PERFORM                                              25130002
251400     END-IF.                                                      25140002
251500                                                                  25150002
251600                                                                  25160002
251700*-----------------------------------------------------------------25170002
251800*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                 25180002
251900*-----------------------------------------------------------------25190002
252000                                                                  25200002
252100 5205-WRITE-SEL-QUEUE.                                            25210002
252200                                                                  25220002
252300     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            25230002
252400                                   TO ET346-SELECTED-ITEMS.       25240002
252500                                                                  25250002
252600     EXEC CICS                                                    25260002
252700          WRITEQ TS                                               25270002
252800              QUEUE (ASC-OUTPUT-SEL-QUEUE-NAME)                   25280002
252900              FROM  (ET346-SELECTED-ITEMS-AREA)                   25290002
253000              ITEM  (PV-SEL-QUEUE-ITEM)                           25300002
253100              RESP  (PV-CICS-RESP)                                25310002
253200     END-EXEC.                                                    25320002
253300                                                                  25330002
253400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25340002
253500         CONTINUE                                                 25350002
253600     ELSE                                                         25360002
253700         SET DP013-CICS-ABEND      TO TRUE                        25370002
253800         SET DP013-NO-ROLLBACK     TO TRUE                        25380002
253900         MOVE '5205-WRITE-SEL-QUEUE'                              25390002
254000                                   TO DP013-PARAGRAPH             25400002
254100         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          25410002
254200                                   TO DP013-MESSAGE-TEXT(1)       25420002
254300         PERFORM DP013-0000-PROCESS-ABEND                         25430002
254400     END-IF.                                                      25440002
254500                                                                  25450002
254600                                                                  25460002
254700*-----------------------------------------------------------------25470002
254800* WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,    25480002
254900* SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT    25490002
255000* THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO       25500002
255100* THE USER.                                                       25510002
255200*-----------------------------------------------------------------25520002
255300                                                                  25530002
255400 6000-REFRESH-PANEL-FROM-TEMP.                                    25540002
255500                                                                  25550002
255600     IF  ASC-UPDATE-TSQ                                           25560002
255700         SET ASC-NO-TSQ-UPDATE TO TRUE                            25570002
255800         MOVE ZERO                 TO PV-SAVE-ITEM                25580002
255900                                      PV-SEL-QUEUE-ITEM           25590002
256000         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        25600002
256100                                   TO PV-HOLD-SELECTED-ITEMS      25610002
256200         PERFORM 6100-UPDATE-TSQ                                  25620002
256300             UNTIL PV-ITEMS-PROCESSED >                           25630002
256400                                     ASC-NUMBER-OF-SELECTED-ITEMS 25640002
256500         PERFORM 6010-DELETE-SEL-QUEUE                            25650002
256600         INITIALIZE ASC-BLOCK-ENTRIES (1)                         25660002
256700                    ASC-BLOCK-ENTRIES (2)                         25670002
256800                                                                  25680002
256900         DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                 25690002
257000                GIVING PV-BLOCK-NUMBER                            25700002
257100                REMAINDER PV-REMAINDER                            25710002
257200         IF  PV-REMAINDER > ZERO                                  25720002
257300             ADD +1     TO PV-BLOCK-NUMBER                        25730002
257400         END-IF                                                   25740002
257500         MOVE +1        TO ASC-BLK-SUB                            25750002
257600         PERFORM 4410-READ-TEMP-STORAGE                           25760002
257700         ADD +1         TO ASC-BLK-SUB                            25770002
257800                           PV-BLOCK-NUMBER                        25780002
257900         PERFORM 4410-READ-TEMP-STORAGE                           25790002
258000                                                                  25800002
258100     END-IF.                                                      25810002
258200                                                                  25820002
258300                                                                  25830002
258400*-----------------------------------------------------------------25840002
258500*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.                25850002
258600*-----------------------------------------------------------------25860002
258700                                                                  25870002
258800 6010-DELETE-SEL-QUEUE.                                           25880002
258900                                                                  25890002
259000     EXEC CICS                                                    25900002
259100         DELETEQ TS                                               25910002
259200             QUEUE (ASC-OUTPUT-SEL-QUEUE-NAME)                    25920002
259300             RESP  (PV-CICS-RESP)                                 25930002
259400     END-EXEC.                                                    25940002
259500                                                                  25950002
259600     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      25960002
259700        (PV-CICS-RESP = DFHRESP(QIDERR)))                         25970002
259800         CONTINUE                                                 25980002
259900     ELSE                                                         25990002
260000         SET DP013-CICS-ABEND TO TRUE                             26000002
260100         SET DP013-NO-ROLLBACK TO TRUE                            26010002
260200         MOVE '6010-DELETE-SEL-QUEUE'                             26020002
260300                        TO DP013-PARAGRAPH                        26030002
260400         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         26040002
260500                        TO DP013-MESSAGE-TEXT (1)                 26050002
260600         PERFORM DP013-0000-PROCESS-ABEND                         26060002
260700     END-IF.                                                      26070002
260800                                                                  26080002
260900*-----------------------------------------------------------------26090002
261000* INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.          26100002
261100* LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER      26110002
261200* TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN        26120002
261300* THE TEMP QUEUE.                                                 26130002
261400*-----------------------------------------------------------------26140002
261500                                                                  26150002
261600 6100-UPDATE-TSQ.                                                 26160002
261700                                                                  26170002
261800     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             26180002
261900     PERFORM 6105-READ-SEL-QUEUE.                                 26190002
262000     PERFORM                                                      26200002
262100         VARYING ET346-IDX                                        26210002
262200         FROM 1 BY 1                                              26220002
262300         UNTIL ((PV-ITEMS-PROCESSED >                             26230002
262400                              PV-HOLD-SELECTED-ITEMS)             26240002
262500         OR (ET346-IDX GREATER THAN ET346-MAX-ITEMS))             26250002
262600         IF  ET346-ACTION-SW (ET346-IDX) > SPACE                  26260002
262700             PERFORM 6110-PROCESS-ITEMS                           26270002
262800         END-IF                                                   26280002
262900         ADD +1                TO PV-ITEMS-PROCESSED              26290002
263000     END-PERFORM.                                                 26300002
263100     PERFORM 6111-WRITE-LIST-QUEUE.                               26310002
263200                                                                  26320002
263300                                                                  26330002
263400*-----------------------------------------------------------------26340002
263500*    READ THE LIST QUEUE RECORD.                                  26350002
263600*-----------------------------------------------------------------26360002
263700                                                                  26370002
263800 6105-READ-SEL-QUEUE.                                             26380002
263900                                                                  26390002
264000     EXEC CICS                                                    26400002
264100          READQ TS                                                26410002
264200              QUEUE (ASC-OUTPUT-SEL-QUEUE-NAME)                   26420002
264300              INTO  (ET346-SELECTED-ITEMS-AREA)                   26430002
264400              ITEM  (PV-SEL-QUEUE-ITEM)                           26440002
264500              RESP  (PV-CICS-RESP)                                26450002
264600     END-EXEC.                                                    26460002
264700                                                                  26470002
264800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26480002
264900         CONTINUE                                                 26490002
265000     ELSE                                                         26500002
265100         SET DP013-CICS-ABEND      TO  TRUE                       26510002
265200         SET DP013-NO-ROLLBACK     TO  TRUE                       26520002
265300         MOVE '6105-READ-SEL-QUEUE'                               26530002
265400                                   TO  DP013-PARAGRAPH            26540002
265500         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           26550002
265600                                   TO  DP013-MESSAGE-TEXT(1)      26560002
265700         PERFORM DP013-0000-PROCESS-ABEND                         26570002
265800     END-IF.                                                      26580002
265900                                                                  26590002
266000                                                                  26600002
266100*-----------------------------------------------------------------26610002
266200* CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.    26620002
266300* REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE    26630002
266400* THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.               26640002
266500*-----------------------------------------------------------------26650002
266600                                                                  26660002
266700 6110-PROCESS-ITEMS.                                              26670002
266800                                                                  26680002
266900     COMPUTE PV-ITEM = 1 + ((ET346-ITEM (ET346-IDX) - 1)          26690002
267000                     / PC-ITEMS-PER-PANEL).                       26700002
267100                                                                  26710002
267200     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           26720002
267300         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          26730002
267400             PERFORM 6111-WRITE-LIST-QUEUE                        26740002
267500         END-IF                                                   26750002
267600         MOVE PV-ITEM          TO PV-SAVE-ITEM                    26760002
267700                                                                  26770002
267800         PERFORM 6112-READ-LIST-QUEUE                             26780002
267900         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               26790002
268000             CONTINUE                                             26800002
268100         END-IF                                                   26810002
268200     END-IF.                                                      26820002
268300                                                                  26830002
268400     COMPUTE PV-SUB = (ET346-ITEM (ET346-IDX)                     26840002
268500                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              26850002
268600     SET LQW-DESELECT (PV-SUB) TO    TRUE                         26860002
268700     MOVE LQW-SELECTED-SW (PV-SUB)                                26870002
268800                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  26880002
268900     EVALUATE TRUE                                                26890002
269000         WHEN ET346-INQ (ET346-IDX)                               26900002
269100              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             26910002
269200                                                                  26920002
269300         WHEN ET346-UPD (ET346-IDX)                               26930002
269400              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             26940002
269500                                                                  26950002
269600         WHEN ET346-REL (ET346-IDX)                               26960002
269700              MOVE PC-REL      TO LQW-ACTION (PV-SUB)             26970002
269800                                                                  26980002
269900         WHEN ET346-ERR (ET346-IDX)                               26990002
270000              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             27000002
270100     END-EVALUATE.                                                27010002
270200*    *------------------------------------------------------------27020002
270300*    * IF RETURNING FROM THE DOC ON HOLD UPDATE PROGRAM (ETKCS346)27030002
270400*    * THE DEPARTMENT NUMBER MAY HAVE BEEN UPDATED, SO THE NEW    27040002
270500*    * DEPARTMENT NUMBER MUST BE MOVED FROM THE SELECTION QUEUE TO27050002
270600*    * LIST QUEUE.                                                27060002
270700*    *------------------------------------------------------------27070002
270800     MOVE ET346-DEPT-NBR (ET346-IDX)                              27080002
270900                               TO LQW-DEPT-NBR (PV-SUB).          27090002
271000                                                                  27100002
271100     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                27110002
271200                                                                  27120002
271300                                                                  27130002
271400*-----------------------------------------------------------------27140002
271500* WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.                 27150002
271600*-----------------------------------------------------------------27160002
271700                                                                  27170002
271800 6111-WRITE-LIST-QUEUE.                                           27180002
271900                                                                  27190002
272000     EXEC CICS                                                    27200002
272100         WRITEQ TS                                                27210002
272200             QUEUE (ASC-LIST-QUEUE-NAME)                          27220002
272300             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     27230002
272400             ITEM  (PV-SAVE-ITEM)                                 27240002
272500             REWRITE                                              27250002
272600             RESP  (PV-CICS-RESP)                                 27260002
272700     END-EXEC.                                                    27270002
272800*                                                                 27280002
272900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27290002
273000         CONTINUE                                                 27300002
273100     ELSE                                                         27310002
273200         SET DP013-CICS-ABEND  TO  TRUE                           27320002
273300         SET DP013-NO-ROLLBACK TO  TRUE                           27330002
273400         MOVE '6111-WRITE-LIST-QUEUE'                             27340002
273500                               TO  DP013-PARAGRAPH                27350002
273600         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  27360002
273700                               TO  DP013-MESSAGE-TEXT(1)          27370002
273800         PERFORM DP013-0000-PROCESS-ABEND                         27380002
273900     END-IF.                                                      27390002
274000                                                                  27400002
274100                                                                  27410002
274200*-----------------------------------------------------------------27420002
274300* READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.    27430002
274400*-----------------------------------------------------------------27440002
274500                                                                  27450002
274600 6112-READ-LIST-QUEUE.                                            27460002
274700                                                                  27470002
274800     EXEC CICS                                                    27480002
274900         READQ TS                                                 27490002
275000             QUEUE (ASC-LIST-QUEUE-NAME)                          27500002
275100             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     27510002
275200             ITEM  (PV-ITEM)                                      27520002
275300             RESP  (PV-CICS-RESP)                                 27530002
275400     END-EXEC.                                                    27540002
275500*                                                                 27550002
275600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27560002
275700         CONTINUE                                                 27570002
275800     ELSE                                                         27580002
275900         SET DP013-CICS-ABEND        TO TRUE                      27590002
276000         SET DP013-NO-ROLLBACK       TO TRUE                      27600002
276100         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           27610002
276200         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    27620002
276300                                     TO DP013-MESSAGE-TEXT(1)     27630002
276400         PERFORM DP013-0000-PROCESS-ABEND                         27640002
276500     END-IF.                                                      27650002
276600                                                                  27660002
276700                                                                  27670002
276800 7200-RELEASE-SELECTED-POS.                                       27680002
276900                                                                  27690002
277000     MOVE +1                   TO  ASC-BLK-SUB.                   27700002
277100     PERFORM 5100-WRITE-TEMP-STORAGE.                             27710002
277200     ADD +1                    TO  ASC-BLK-SUB.                   27720002
277300     PERFORM 5100-WRITE-TEMP-STORAGE.                             27730002
277400                                                                  27740002
277500     SET PS-DATA-AVAILABLE     TO TRUE.                           27750002
277600                                                                  27760002
277700     PERFORM                                                      27770002
277800       VARYING PV-ITEM FROM 1 BY 1                                27780002
277900       UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN                  27790002
278000          OR PS-DATA-NOT-AVAILABLE                                27800002
278100         PERFORM 6112-READ-LIST-QUEUE                             27810002
278200         IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                   27820002
278300             PERFORM                                              27830002
278400               VARYING LQW-IDX FROM 1 BY 1                        27840002
278500               UNTIL LQW-IDX > PC-ITEMS-PER-PANEL                 27850002
278600                  OR LQW-LIST-ITEM-NUMBER (LQW-IDX) = ZERO        27860002
278700                  OR PS-DATA-NOT-AVAILABLE                        27870002
278800                 IF LQW-SELECT (LQW-IDX)                          27880002
278900                     PERFORM 7300-RELEASE-PO                      27890002
279000                 END-IF                                           27900002
279100             END-PERFORM                                          27910002
279200         END-IF                                                   27920002
279300     END-PERFORM.                                                 27930002
279400                                                                  27940002
279500*    *------------------------------------------------------------27950002
279600*    * IF ALL RELEASES WERE DONE SUCCESSFULLY, GO BACK AND MARK   27960002
279700*    * THE RELEASED P.O.'S AND DESELECT THEM IN THE LIST QUEUE.   27970002
279800*    *------------------------------------------------------------27980002
279900                                                                  27990002
280000     IF PS-DATA-NOT-AVAILABLE                                     28000002
280100         SET DP020-MSG-FATAL TO TRUE                              28010002
280200*        ---- UPDATES UNSUCCESSFUL - FILE UNAVAILABLE ----        28020002
280300         MOVE PC-TSYMSG-00660  TO DP020-MSG-NUMBER                28030002
280400     ELSE                                                         28040002
280500         PERFORM                                                  28050002
280600           VARYING PV-ITEM FROM 1 BY 1                            28060002
280700           UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN              28070002
280800             PERFORM 6112-READ-LIST-QUEUE                         28080002
280900             IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)               28090002
281000                 MOVE PV-ITEM TO PV-SAVE-ITEM                     28100002
281100                 PERFORM                                          28110002
281200                   VARYING LQW-IDX FROM 1 BY 1                    28120002
281300                   UNTIL LQW-IDX > PC-ITEMS-PER-PANEL             28130002
281400                      OR LQW-LIST-ITEM-NUMBER (LQW-IDX) = ZERO    28140002
281500                                                                  28150002
281600                     IF LQW-SELECT (LQW-IDX)                      28160002
281700                         SET  LQW-DESELECT (LQW-IDX) TO TRUE      28170002
281800                         MOVE LQW-SELECTED-SW (LQW-IDX)           28180002
281900                                 TO LQW-TEMP-SELECTED-SW (LQW-IDX)28190002
282000                         MOVE PC-REL TO LQW-ACTION (LQW-IDX)      28200002
282100                         SUBTRACT 1                               28210002
282200                             FROM ASC-NUMBER-OF-SELECTED-ITEMS    28220002
282300                     END-IF                                       28230002
282400                 END-PERFORM                                      28240002
282500                 PERFORM 6111-WRITE-LIST-QUEUE                    28250002
282600             END-IF                                               28260002
282700         END-PERFORM                                              28270002
282800         SET DP020-MSG-INFORMATIONAL TO TRUE                      28280002
282900*        ---- UPDATE(S) SUCCESSFUL ----                           28290002
283000         MOVE PC-TSYMSG-00059  TO DP020-MSG-NUMBER                28300002
283100         MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL        28310002
283200         INITIALIZE ASC-BLOCK-ENTRIES (1)                         28320002
283300                    ASC-BLOCK-ENTRIES (2)                         28330002
283400                                                                  28340002
283500         DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                 28350002
283600                GIVING PV-BLOCK-NUMBER                            28360002
283700                REMAINDER PV-REMAINDER                            28370002
283800         IF  PV-REMAINDER > ZERO                                  28380002
283900             ADD +1     TO PV-BLOCK-NUMBER                        28390002
284000         END-IF                                                   28400002
284100         MOVE +1        TO ASC-BLK-SUB                            28410002
284200         PERFORM 4410-READ-TEMP-STORAGE                           28420002
284300         ADD +1         TO ASC-BLK-SUB                            28430002
284400                           PV-BLOCK-NUMBER                        28440002
284500         PERFORM 4410-READ-TEMP-STORAGE                           28450002
284600     END-IF.                                                      28460002
284700                                                                  28470002
284800     SET ASC-NO-RELEASE-PENDING TO TRUE.                          28480002
284900     PERFORM 3200-RESET-ATTRIBUTES.                               28490002
285000                                                                  28500002
285100                                                                  28510002
285200*-----------------------------------------------------------------28520002
285300* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.        28530002
285400*-----------------------------------------------------------------28540002
285500                                                                  28550002
285600 9100-READ-SEL-QUEUE.                                             28560002
285700                                                                  28570002
285800     EXEC CICS                                                    28580002
285900         READQ TS                                                 28590002
286000             QUEUE (ASC-INPUT-SEL-QUEUE-NAME)                     28600002
286100             INTO  (ET346-SELECTED-ITEMS-AREA)                    28610002
286200             ITEM  (ASC-SEL-ITEM)                                 28620002
286300             RESP  (PV-CICS-RESP)                                 28630002
286400     END-EXEC.                                                    28640002
286500                                                                  28650002
286600     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       28660002
286700         CONTINUE                                                 28670002
286800     ELSE                                                         28680002
286900         SET DP013-LOGIC-ABEND                                    28690002
287000             DP013-NO-ROLLBACK     TO TRUE                        28700002
287100         MOVE '9100-READ-SEL-QUEUE'                               28710002
287200                                   TO DP013-PARAGRAPH             28720002
287300         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   28730002
287400                                   TO DP013-MESSAGE-TEXT (1)      28740002
287500         PERFORM DP013-0000-PROCESS-ABEND                         28750002
287600     END-IF.                                                      28760002
287700                                                                  28770002
287800                                                                  28780002
287900*-----------------------------------------------------------------28790002
288000* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.        28800002
288100*-----------------------------------------------------------------28810002
288200                                                                  28820002
288300 9200-REWRITE-SEL-QUEUE.                                          28830002
288400                                                                  28840002
288500     EXEC CICS                                                    28850002
288600          WRITEQ TS                                               28860002
288700              QUEUE  (ASC-INPUT-SEL-QUEUE-NAME)                   28870002
288800              FROM   (ET346-SELECTED-ITEMS-AREA)                  28880002
288900              ITEM   (ASC-SEL-ITEM)                               28890002
289000              RESP   (PV-CICS-RESP)                               28900002
289100              REWRITE                                             28910002
289200     END-EXEC.                                                    28920002
289300                                                                  28930002
289400     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   28940002
289500         SET DP013-CICS-ABEND                                     28950002
289600             DP013-NO-ROLLBACK     TO TRUE                        28960002
289700         MOVE '9200-REWRITE-SEL-QUEUE'                            28970002
289800                                   TO DP013-PARAGRAPH             28980002
289900         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   28990002
290000                                   TO DP013-MESSAGE-TEXT (1)      29000002
290100         PERFORM DP013-0000-PROCESS-ABEND                         29010002
290200     END-IF.                                                      29020002
290300                                                                  29030002
290400                                                                  29040002
290500 7300-RELEASE-PO.                                                 29050002
290600                                                                  29060002
290700     MOVE LQW-TP-DKEY      (LQW-IDX) TO PV-DB2-TP-DKEY.           29070002
290800     MOVE LQW-TP-DKEY-TMST (LQW-IDX) TO PV-DB2-TP-DKEY-TMST.      29080002
290900     MOVE LQW-PO-NBR       (LQW-IDX) TO PV-DB2-PO-NBR.            29090002
291000                                                                  29100002
291100     PERFORM Z860-UPDATE-TTRPOHL-FOR-RLSE.                        29110002
291200     IF PS-DATA-NOT-AVAILABLE                                     29120002
291300         CONTINUE                                                 29130002
291400     ELSE                                                         29140002
291500         PERFORM Z865-COUNT-NOT-RELEASED-POS                      29150002
291600         IF PS-DATA-NOT-AVAILABLE                                 29160002
291700             CONTINUE                                             29170002
291800         ELSE                                                     29180002
291900             IF PV-NOT-RELEASED-PO-COUNT > ZERO                   29190002
292000                 MOVE PC-RLSE-IND-SOME-RELEASED  TO PV-RLSE-IND   29200002
292100             ELSE                                                 29210002
292200                 MOVE PC-RLSE-IND-RELEASED       TO PV-RLSE-IND   29220002
292300                 IF ASC-INT-APPL-FORMAT-DOC-LIST                  29230002
292400*                    *--------------------------------------------29240002
292500*                    * IF ALL PO'S FOR THE DOCUMENT HAVE BEEN     29250002
292600*                    * RELEASED, MARK THE DOCUMENT AS RELEASED IN 29260002
292700*                    * THE SELECTION QUEUE, SO THAT THE DOCUMENT  29270002
292800*                    * LIST CAN INDICATE THAT THE DOCUMENT HAS    29280002
292900*                    * BEEN RELEASED.                             29290002
293000*                    *--------------------------------------------29300002
293100                     PERFORM 9100-READ-SEL-QUEUE                  29310002
293200                     SET ET346-REL (ASC-SEL-SUB) TO TRUE          29320002
293300                     PERFORM 9200-REWRITE-SEL-QUEUE               29330002
293400                 END-IF                                           29340002
293500             END-IF                                               29350002
293600             PERFORM Z870-UPDATE-TFGTRHL-FOR-RLSE                 29360002
293700         END-IF                                                   29370002
293800     END-IF.                                                      29380002
293900                                                                  29390002
294000                                                                  29400002
294100*-----------------------------------------------------------------29410002
294200* OPEN THE APPROPRIATE CURSOR.                                    29420002
294300*-----------------------------------------------------------------29430002
294400                                                                  29440002
294500 Z800-OPEN-CURSOR.                                                29450002
294600                                                                  29460002
294700     EVALUATE TRUE                                                29470002
294800         WHEN ASC-ALL-PO-CSR                                      29480002
294900             MOVE 'CURSOR:  ALL-PO-CSR'                           29490002
295000                               TO DP013-MESSAGE-TEXT (2)          29500002
295100             EXEC SQL                                             29510002
295200                  OPEN ALL-PO-CSR                                 29520002
295300             END-EXEC                                             29530002
295400                                                                  29540002
295500         WHEN ASC-DEPT-CSR                                        29550002
295600             MOVE 'CURSOR:  DEPT-CSR'                             29560002
295700                               TO DP013-MESSAGE-TEXT (2)          29570002
295800             EXEC SQL                                             29580002
295900                  OPEN DEPT-CSR                                   29590002
296000             END-EXEC                                             29600002
296100                                                                  29610002
296200         WHEN ASC-WORKER-CSR                                      29620002
296300             MOVE 'CURSOR:  WORKER-CSR'                           29630002
296400                               TO DP013-MESSAGE-TEXT (2)          29640002
296500             EXEC SQL                                             29650002
296600                  OPEN WORKER-CSR                                 29660002
296700             END-EXEC                                             29670002
296800                                                                  29680002
296900         WHEN ASC-SEL-DOC-CSR                                     29690002
297000             MOVE 'CURSOR:  SEL-DOC-CSR'                          29700002
297100                               TO DP013-MESSAGE-TEXT (2)          29710002
297200             EXEC SQL                                             29720002
297300                  OPEN SEL-DOC-CSR                                29730002
297400             END-EXEC                                             29740002
297500                                                                  29750002
297600     END-EVALUATE.                                                29760002
297700                                                                  29770002
297800     EVALUATE TRUE                                                29780002
297900         WHEN SQLCODE = ZERO                                      29790002
298000             CONTINUE                                             29800002
298100         WHEN SQLCODE = -904                                      29810002
298200         WHEN SQLCODE = -913                                      29820002
298300             SET PS-DATA-NOT-AVAILABLE TO TRUE                    29830002
298400         WHEN SQLWARN0 NOT = SPACES                               29840002
298500         WHEN SQLCODE  NOT = ZERO                                 29850002
298600             MOVE 'Z800-OPEN-CURSOR'                              29860002
298700                               TO DP013-PARAGRAPH                 29870002
298800             MOVE SQLCA        TO DP013-SQLCA                     29880002
298900             EVALUATE TRUE                                        29890002
299000                 WHEN ASC-ALL-PO-CSR                              29900002
299100                 WHEN ASC-DEPT-CSR                                29910002
299200                 WHEN ASC-WORKER-CSR                              29920002
299300                     MOVE 'TTRPOHL'  TO DP013-DB2-TABLE-NAME (1)  29930002
299400                     MOVE 'TFGTRHL'  TO DP013-DB2-TABLE-NAME (2)  29940002
299500                     MOVE 'TTRNSET'  TO DP013-DB2-TABLE-NAME (3)  29950002
299600                     MOVE 'TENTNME'  TO DP013-DB2-TABLE-NAME (4)  29960002
299700                     MOVE 'TTRDPRT'  TO DP013-DB2-TABLE-NAME (5)  29970002
299800                 WHEN ASC-SEL-DOC-CSR                             29980002
299900                     MOVE 'TTRPOHL'  TO DP013-DB2-TABLE-NAME (1)  29990002
300000                     MOVE 'TFGTRHL'  TO DP013-DB2-TABLE-NAME (2)  30000002
300100                     MOVE 'TTRNSET'  TO DP013-DB2-TABLE-NAME (3)  30010002
300200             END-EVALUATE                                         30020002
300300             SET DP013-DB2-ABEND                                  30030002
300400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               30040002
300500             PERFORM DP013-0000-PROCESS-ABEND                     30050002
300600     END-EVALUATE.                                                30060002
300700                                                                  30070002
300800                                                                  30080002
300900*-----------------------------------------------------------------30090002
301000* FETCH THE APPROPRIATE CURSOR.                                   30100002
301100*-----------------------------------------------------------------30110002
301200                                                                  30120002
301300 Z810-FETCH-CURSOR.                                               30130002
301400                                                                  30140002
301500     EVALUATE TRUE                                                30150002
301600         WHEN ASC-ALL-PO-CSR                                      30160002
301700             MOVE 'CURSOR:  ALL-PO-CSR'                           30170002
301800                               TO DP013-MESSAGE-TEXT (2)          30180002
301900             EXEC SQL                                             30190002
302000                  FETCH ALL-PO-CSR                                30200002
302100                  INTO                                            30210002
302200                       :TRPOHL-PO-NBR                             30220002
302300                     , :TRPOHL-DEPT-NBR                           30230002
302400                     , :TRPOHL-TP-DKEY                            30240002
302500                     , :TRPOHL-TP-DKEY-TMST                       30250002
302600                     , :FGTRHL-HOLD-DTE                           30260002
302700                     , :FGTRHL-TRN-SET-CDE                        30270002
302800                     , :ENTNME-ENT-NAME-DESC                      30280002
302900                     , :TRNSET-TRAN-SET-NME-ID                    30290002
303000             END-EXEC                                             30300002
303100                                                                  30310002
303200         WHEN ASC-DEPT-CSR                                        30320002
303300             MOVE 'CURSOR:  DEPT-CSR'                             30330002
303400                               TO DP013-MESSAGE-TEXT (2)          30340002
303500             EXEC SQL                                             30350002
303600                  FETCH DEPT-CSR                                  30360002
303700                  INTO                                            30370002
303800                       :TRPOHL-PO-NBR                             30380002
303900                     , :TRPOHL-DEPT-NBR                           30390002
304000                     , :TRPOHL-TP-DKEY                            30400002
304100                     , :TRPOHL-TP-DKEY-TMST                       30410002
304200                     , :FGTRHL-HOLD-DTE                           30420002
304300                     , :FGTRHL-TRN-SET-CDE                        30430002
304400                     , :ENTNME-ENT-NAME-DESC                      30440002
304500                     , :TRNSET-TRAN-SET-NME-ID                    30450002
304600             END-EXEC                                             30460002
304700                                                                  30470002
304800         WHEN ASC-WORKER-CSR                                      30480002
304900             MOVE 'CURSOR:  WORKER-CSR'                           30490002
305000                               TO DP013-MESSAGE-TEXT (2)          30500002
305100             EXEC SQL                                             30510002
305200                  FETCH WORKER-CSR                                30520002
305300                  INTO                                            30530002
305400                       :TRPOHL-PO-NBR                             30540002
305500                     , :TRPOHL-DEPT-NBR                           30550002
305600                     , :TRPOHL-TP-DKEY                            30560002
305700                     , :TRPOHL-TP-DKEY-TMST                       30570002
305800                     , :FGTRHL-HOLD-DTE                           30580002
305900                     , :FGTRHL-TRN-SET-CDE                        30590002
306000                     , :ENTNME-ENT-NAME-DESC                      30600002
306100                     , :TRNSET-TRAN-SET-NME-ID                    30610002
306200             END-EXEC                                             30620002
306300                                                                  30630002
306400         WHEN ASC-SEL-DOC-CSR                                     30640002
306500             MOVE 'CURSOR:  SEL-DOC-CSR'                          30650002
306600                               TO DP013-MESSAGE-TEXT (2)          30660002
306700             EXEC SQL                                             30670002
306800                  FETCH SEL-DOC-CSR                               30680002
306900                  INTO                                            30690002
307000                       :TRPOHL-PO-NBR                             30700002
307100                     , :TRPOHL-DEPT-NBR                           30710002
307200                     , :FGTRHL-HOLD-DTE                           30720002
307300                     , :TRNSET-TRAN-SET-NME-ID                    30730002
307400             END-EXEC                                             30740002
307500                                                                  30750002
307600     END-EVALUATE.                                                30760002
307700                                                                  30770002
307800     EVALUATE TRUE                                                30780002
307900         WHEN SQLCODE = ZERO                                      30790002
308000             CONTINUE                                             30800002
308100         WHEN SQLCODE = +100                                      30810002
308200             SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                  30820002
308300         WHEN SQLCODE = -904                                      30830002
308400         WHEN SQLCODE = -913                                      30840002
308500             SET PS-DATA-NOT-AVAILABLE TO TRUE                    30850002
308600         WHEN SQLWARN0 NOT = SPACE                                30860002
308700         WHEN SQLCODE  NOT = ZERO                                 30870002
308800             MOVE 'Z810-FETCH-CURSOR'                             30880002
308900                                 TO DP013-PARAGRAPH               30890002
309000             MOVE 'FETCH CURSOR' TO DP013-MESSAGE-TEXT (1)        30900002
309100             MOVE SQLCA          TO DP013-SQLCA                   30910002
309200             EVALUATE TRUE                                        30920002
309300                 WHEN ASC-ALL-PO-CSR                              30930002
309400                 WHEN ASC-DEPT-CSR                                30940002
309500                 WHEN ASC-WORKER-CSR                              30950002
309600                     MOVE 'TTRPOHL'  TO DP013-DB2-TABLE-NAME (1)  30960002
309700                     MOVE 'TFGTRHL'  TO DP013-DB2-TABLE-NAME (2)  30970002
309800                     MOVE 'TTRNSET'  TO DP013-DB2-TABLE-NAME (3)  30980002
309900                     MOVE 'TENTNME'  TO DP013-DB2-TABLE-NAME (4)  30990002
310000                     MOVE 'TTRDPRT'  TO DP013-DB2-TABLE-NAME (5)  31000002
310100                 WHEN ASC-SEL-DOC-CSR                             31010002
310200                     MOVE 'TTRPOHL'  TO DP013-DB2-TABLE-NAME (1)  31020002
310300                     MOVE 'TFGTRHL'  TO DP013-DB2-TABLE-NAME (2)  31030002
310400                     MOVE 'TTRNSET'  TO DP013-DB2-TABLE-NAME (3)  31040002
310500             END-EVALUATE                                         31050002
310600             SET DP013-DB2-ABEND TO TRUE                          31060002
310700             PERFORM DP013-0000-PROCESS-ABEND                     31070002
310800     END-EVALUATE.                                                31080002
310900                                                                  31090002
311000                                                                  31100002
311100*-----------------------------------------------------------------31110002
311200* CLOSE THE APPROPRIATE CURSOR.                                   31120002
311300*-----------------------------------------------------------------31130002
311400                                                                  31140002
311500 Z820-CLOSE-CURSOR.                                               31150002
311600                                                                  31160002
311700     EVALUATE TRUE                                                31170002
311800         WHEN ASC-ALL-PO-CSR                                      31180002
311900             MOVE 'CURSOR:  ALL-PO-CSR'                           31190002
312000                               TO DP013-MESSAGE-TEXT (2)          31200002
312100             EXEC SQL                                             31210002
312200                  CLOSE ALL-PO-CSR                                31220002
312300             END-EXEC                                             31230002
312400                                                                  31240002
312500         WHEN ASC-DEPT-CSR                                        31250002
312600             MOVE 'CURSOR:  DEPT-CSR'                             31260002
312700                               TO DP013-MESSAGE-TEXT (2)          31270002
312800             EXEC SQL                                             31280002
312900                  CLOSE DEPT-CSR                                  31290002
313000             END-EXEC                                             31300002
313100                                                                  31310002
313200         WHEN ASC-WORKER-CSR                                      31320002
313300             MOVE 'CURSOR:  WORKER-CSR'                           31330002
313400                               TO DP013-MESSAGE-TEXT (2)          31340002
313500             EXEC SQL                                             31350002
313600                  CLOSE WORKER-CSR                                31360002
313700             END-EXEC                                             31370002
313800                                                                  31380002
313900         WHEN ASC-SEL-DOC-CSR                                     31390002
314000             MOVE 'CURSOR:  SEL-DOC-CSR'                          31400002
314100                               TO DP013-MESSAGE-TEXT (2)          31410002
314200             EXEC SQL                                             31420002
314300                  CLOSE SEL-DOC-CSR                               31430002
314400             END-EXEC                                             31440002
314500                                                                  31450002
314600     END-EVALUATE.                                                31460002
314700                                                                  31470002
314800     EVALUATE TRUE                                                31480002
314900         WHEN SQLCODE = ZERO                                      31490002
315000         WHEN SQLCODE = -904                                      31500002
315100         WHEN SQLCODE = -913                                      31510002
315200             CONTINUE                                             31520002
315300         WHEN SQLWARN0 NOT = SPACES                               31530002
315400         WHEN SQLCODE  NOT = ZERO                                 31540002
315500             MOVE 'Z820-CLOSE-CURSOR'                             31550002
315600                                 TO DP013-PARAGRAPH               31560002
315700             MOVE 'CLOSE CURSOR' TO DP013-MESSAGE-TEXT (1)        31570002
315800             MOVE SQLCA          TO DP013-SQLCA                   31580002
315900             EVALUATE TRUE                                        31590002
316000                 WHEN ASC-ALL-PO-CSR                              31600002
316100                 WHEN ASC-DEPT-CSR                                31610002
316200                 WHEN ASC-WORKER-CSR                              31620002
316300                     MOVE 'TTRPOHL'  TO DP013-DB2-TABLE-NAME (1)  31630002
316400                     MOVE 'TFGTRHL'  TO DP013-DB2-TABLE-NAME (2)  31640002
316500                     MOVE 'TTRNSET'  TO DP013-DB2-TABLE-NAME (3)  31650002
316600                     MOVE 'TENTNME'  TO DP013-DB2-TABLE-NAME (4)  31660002
316700                     MOVE 'TTRDPRT'  TO DP013-DB2-TABLE-NAME (5)  31670002
316800                 WHEN ASC-SEL-DOC-CSR                             31680002
316900                     MOVE 'TTRPOHL'  TO DP013-DB2-TABLE-NAME (1)  31690002
317000                     MOVE 'TFGTRHL'  TO DP013-DB2-TABLE-NAME (2)  31700002
317100                     MOVE 'TTRNSET'  TO DP013-DB2-TABLE-NAME (3)  31710002
317200             END-EVALUATE                                         31720002
317300             SET DP013-DB2-ABEND                                  31730002
317400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               31740002
317500             PERFORM DP013-0000-PROCESS-ABEND                     31750002
317600     END-EVALUATE.                                                31760002
317700                                                                  31770002
317800                                                                  31780002
317900 Z860-UPDATE-TTRPOHL-FOR-RLSE.                                    31790002
318000                                                                  31800002
318100     EXEC SQL                                                     31810002
318200         UPDATE TTRPOHL                                           31820002
318300             SET    PO_RLSE_IND     = :PC-RLSE-IND-RELEASED       31830002
318400             WHERE  TP_DKEY         = :PV-DB2-TP-DKEY             31840002
318500               AND  TP_DKEY_TMST    = :PV-DB2-TP-DKEY-TMST        31850002
318600               AND  PO_NBR          = :PV-DB2-PO-NBR              31860002
318700     END-EXEC.                                                    31870002
318800                                                                  31880002
318900     EVALUATE TRUE                                                31890002
319000         WHEN SQLCODE = ZERO                                      31900002
319100             CONTINUE                                             31910002
319200         WHEN SQLCODE = -904                                      31920002
319300         WHEN SQLCODE = -913                                      31930002
319400             EXEC CICS                                            31940002
319500                 SYNCPOINT                                        31950002
319600                     ROLLBACK                                     31960002
319700             END-EXEC                                             31970002
319800             SET PS-DATA-NOT-AVAILABLE TO TRUE                    31980002
319900         WHEN SQLWARN0 NOT = SPACES                               31990002
320000         WHEN SQLCODE  NOT = ZERO                                 32000002
320100             MOVE 'Z860-UPDATE-TTRPOHL-FOR-RLSE'                  32010002
320200                               TO DP013-PARAGRAPH                 32020002
320300             MOVE 'UPDATE A ROW ON THE DOCUMENT P.O. HOLD TABLE'  32030002
320400                               TO DP013-MESSAGE-TEXT(1)           32040002
320500             MOVE SQLCA        TO DP013-SQLCA                     32050002
320600             MOVE 'TTRPOHL'    TO DP013-DB2-TABLE-NAME (1)        32060002
320700             SET DP013-DB2-ABEND                                  32070002
320800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               32080002
320900             PERFORM DP013-0000-PROCESS-ABEND                     32090002
321000     END-EVALUATE.                                                32100002
321100                                                                  32110002
321200                                                                  32120002
321300 Z865-COUNT-NOT-RELEASED-POS.                                     32130002
321400                                                                  32140002
321500     EXEC SQL                                                     32150002
321600         SELECT COUNT(*)                                          32160002
321700         INTO  :PV-NOT-RELEASED-PO-COUNT                          32170002
321800         FROM   TTRPOHL                                           32180002
321900         WHERE  TP_DKEY         = :PV-DB2-TP-DKEY                 32190002
322000           AND  TP_DKEY_TMST    = :PV-DB2-TP-DKEY-TMST            32200002
322100           AND  PO_RLSE_IND     = :PC-RLSE-IND-NOT-RELEASED       32210002
322200     END-EXEC.                                                    32220002
322300                                                                  32230002
322400     EVALUATE TRUE                                                32240002
322500         WHEN SQLCODE = ZERO                                      32250002
322600             CONTINUE                                             32260002
322700         WHEN SQLCODE = -904                                      32270002
322800         WHEN SQLCODE = -913                                      32280002
322900             EXEC CICS                                            32290002
323000                 SYNCPOINT                                        32300002
323100                     ROLLBACK                                     32310002
323200             END-EXEC                                             32320002
323300             SET PS-DATA-NOT-AVAILABLE TO TRUE                    32330002
323400         WHEN SQLWARN0 NOT = SPACES                               32340002
323500         WHEN SQLCODE  NOT = ZERO                                 32350002
323600             MOVE 'Z865-COUNT-NOT-RELEASED-POS'                   32360002
323700                               TO DP013-PARAGRAPH                 32370002
323800             MOVE 'COUNT ROWS ON THE DOCUMENT P.O. HOLD TABLE'    32380002
323900                               TO DP013-MESSAGE-TEXT(1)           32390002
324000             MOVE SQLCA        TO DP013-SQLCA                     32400002
324100             MOVE 'TTRPOHL'    TO DP013-DB2-TABLE-NAME (1)        32410002
324200             SET DP013-DB2-ABEND                                  32420002
324300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               32430002
324400             PERFORM DP013-0000-PROCESS-ABEND                     32440002
324500     END-EVALUATE.                                                32450002
324600                                                                  32460002
324700                                                                  32470002
324800 Z870-UPDATE-TFGTRHL-FOR-RLSE.                                    32480002
324900                                                                  32490002
325000     EXEC SQL                                                     32500002
325100         UPDATE TFGTRHL                                           32510002
325200             SET    RLSE_IND        = :PV-RLSE-IND                32520002
325300                   ,RLSE_DTE        = :PC-EMPTY-DATE              32530002
325400                   ,USER_ID         = :DP020-USERID               32540002
325500             WHERE  TP_DKEY         = :PV-DB2-TP-DKEY             32550002
325600               AND  TP_DKEY_TMST    = :PV-DB2-TP-DKEY-TMST        32560002
325700     END-EXEC.                                                    32570002
325800                                                                  32580002
325900     EVALUATE TRUE                                                32590002
326000         WHEN SQLCODE = ZERO                                      32600002
326100             CONTINUE                                             32610002
326200         WHEN SQLCODE = -904                                      32620002
326300         WHEN SQLCODE = -913                                      32630002
326400             EXEC CICS                                            32640002
326500                 SYNCPOINT                                        32650002
326600                     ROLLBACK                                     32660002
326700             END-EXEC                                             32670002
326800             SET PS-DATA-NOT-AVAILABLE TO TRUE                    32680002
326900         WHEN SQLWARN0 NOT = SPACES                               32690002
327000         WHEN SQLCODE  NOT = ZERO                                 32700002
327100             MOVE 'Z870-UPDATE-TFGTRHL-FOR-RLSE'                  32710002
327200                               TO DP013-PARAGRAPH                 32720002
327300             MOVE 'UPDATE A ROW ON THE FG/TSET XMIT HOLD TABLE'   32730002
327400                               TO DP013-MESSAGE-TEXT(1)           32740002
327500             MOVE SQLCA        TO DP013-SQLCA                     32750002
327600             MOVE 'TFGTRHL'    TO DP013-DB2-TABLE-NAME (1)        32760002
327700             SET DP013-DB2-ABEND                                  32770002
327800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               32780002
327900             PERFORM DP013-0000-PROCESS-ABEND                     32790002
328000     END-EVALUATE.                                                32800002
328100                                                                  32810002
328200                                                                  32820002
328300*----------------------------------------------------------------*32830002
328400*    CURRENT SYSTEM DATE/TIME MODULE                              32840002
328500*----------------------------------------------------------------*32850002
328600                                                                  32860002
328700     COPY DPPD017.                                                32870002
328800                                                                  32880002
328900                                                                  32890002
329000*-----------------------------------------------------------------32900002
329100*    ABEND PROCESSOR MODULE                                       32910002
329200*-----------------------------------------------------------------32920002
329300                                                                  32930002
329400     COPY DPPD013.                                                32940002
