000100 IDENTIFICATION DIVISION.                                         00010004
000200 PROGRAM-ID.      EPKUT354.                                       00020004
000300 AUTHOR.          COGNIZANT.                                      00030004
000400 DATE-WRITTEN.    SEPTEMBER,2013.                                 00040004
000500                                                                  00050004
000600*-----------------------------------------------------------      00060004
000700*            ADHOC STORE CORRECTION IDENTIFIER                    00070004
000800*-----------------------------------------------------------      00080004
000900* DATE: 09/30/2013                                                00090049
001000* WR/IR#:                                                         00100049
001100* PROGRAMMER: COGNIZANT                                           00110049
001200* THIS PROGRAM IS A MODIFIED VERSION OF EPKUT117.                 00120049
001300* DESCRIPTION: REMOVED THE EMERGENCY FILE EXTRACT PROCESS IN THE  00130049
001400*   NIGHTLY CYCLE. THIS IS DONE TO AVOID SORTING ISSUE FOR PROMO  00140049
001500*   SEND TO STORES.                                               00150049
001512* DATE:                                                           00160026
001513* WR/IR#:                                                         00170026
001514* PROGRAMMER:                                                     00180026
001515* DESCRIPTION:                                                    00190026
001520*-----------------------------------------------------------      00200026
001600                                                                  00210004
001700*----------------------------------------------------------       00220004
001800 ENVIRONMENT DIVISION.                                            00230004
001900*----------------------------------------------------------       00240004
002000 CONFIGURATION SECTION.                                           00250004
002100 SOURCE-COMPUTER.        IBM-3090.                                00260004
002200 OBJECT-COMPUTER.        IBM-3090.                                00270004
002210                                                                  00280004
002220 INPUT-OUTPUT SECTION.                                            00290004
002230                                                                  00300004
002240 FILE-CONTROL.                                                    00310004
002250                                                                  00320004
002251     SELECT CONTROL-CARD-PGM-LAST-RUN-TMST                        00330004
002252       ASSIGN TO INP01.                                           00340004
002253     SELECT CONTROL-CARD-PGM-CURR-TMST                            00350049
002254       ASSIGN TO INP02.                                           00360004
002255     SELECT CONTROL-CARD-CURR-PRICG-DTE                           00370004
002256       ASSIGN TO INP03.                                           00380004
002257     SELECT CONTROL-CARD-FUTRE-CORR-DTE                           00390004
002258       ASSIGN TO INP04.                                           00400004
002259     SELECT CONTROL-CARD-CRIT-EFF-DTE                             00410004
002260       ASSIGN TO INP05.                                           00420004
002261     SELECT CONTROL-CARD-FUT-STR-OPN-DAY                          00430026
002262       ASSIGN TO INP06.                                           00440026
002263     SELECT PROMO-NIGHT-FILE                                      00450004
002264       ASSIGN TO OUT01.                                           00460004
002265                                                                  00470004
002266 DATA DIVISION.                                                   00480004
002267 FILE SECTION.                                                    00490004
002268                                                                  00500004
002269 FD  CONTROL-CARD-PGM-LAST-RUN-TMST                               00510004
002270     RECORDING MODE F                                             00520004
002271     BLOCK CONTAINS 0 RECORDS                                     00530004
002272     LABEL RECORDS ARE OMITTED                                    00540004
002273     DATA RECORD IS CNTRL-CARD-PGM-LAST-RUN-REC.                  00550004
002274 01  CNTRL-CARD-PGM-LAST-RUN-REC                   PIC  X(080).   00560004
002275                                                                  00570004
002276 FD  CONTROL-CARD-PGM-CURR-TMST                                   00580049
002277     RECORDING MODE F                                             00590004
002278     BLOCK CONTAINS 0 RECORDS                                     00600004
002279     LABEL RECORDS ARE OMITTED                                    00610004
002280     DATA RECORD IS CNTRL-CARD-PGM-CURR-RUN-REC.                  00620004
002290 01  CNTRL-CARD-PGM-CURR-RUN-REC                   PIC  X(080).   00630004
002291                                                                  00640049
002292 FD  CONTROL-CARD-CURR-PRICG-DTE                                  00650004
002293     RECORDING MODE F                                             00660004
002294     BLOCK CONTAINS 0 RECORDS                                     00670004
002295     LABEL RECORDS ARE OMITTED                                    00680004
002296     DATA RECORD IS CNTRL-CARD-CURR-PRICG-DTE-REC.                00690004
002297 01  CNTRL-CARD-CURR-PRICG-DTE-REC                 PIC  X(080).   00700004
002298                                                                  00710004
002299 FD  CONTROL-CARD-FUTRE-CORR-DTE                                  00720004
002300     RECORDING MODE F                                             00730004
002400     BLOCK CONTAINS 0 RECORDS                                     00740004
002500     LABEL RECORDS ARE OMITTED                                    00750004
002600     DATA RECORD IS CNTRL-CARD-FUTRE-CORR-DTE-REC.                00760004
002700 01  CNTRL-CARD-FUTRE-CORR-DTE-REC                 PIC  X(080).   00770004
002800                                                                  00780004
002900 FD  CONTROL-CARD-CRIT-EFF-DTE                                    00790004
003000     RECORDING MODE F                                             00800004
003010     BLOCK CONTAINS 0 RECORDS                                     00810004
003020     LABEL RECORDS ARE OMITTED                                    00820004
003030     DATA RECORD IS CNTRL-CARD-CRIT-EFF-DTE-REC.                  00830004
003040 01  CNTRL-CARD-CRIT-EFF-DTE-REC                   PIC  X(080).   00840004
003050                                                                  00850004
003051 FD  CONTROL-CARD-FUT-STR-OPN-DAY                                 00860026
003052     RECORDING MODE F                                             00870026
003053     BLOCK CONTAINS 0 RECORDS                                     00880026
003054     LABEL RECORDS ARE OMITTED                                    00890026
003055     DATA RECORD IS CNTRL-CARD-FUT-STR-OPN-DAY-REC.               00900026
003056 01  CNTRL-CARD-FUT-STR-OPN-DAY-REC                PIC  X(080).   00910026
003057                                                                  00920026
003060 FD  PROMO-NIGHT-FILE                                             00930004
003070     RECORDING MODE F                                             00940004
003080     BLOCK CONTAINS 0 RECORDS                                     00950004
003090     LABEL RECORDS ARE OMITTED                                    00960004
003100     DATA RECORD IS PROMO-NIGHT-ID-RECORD.                        00970004
003101 01  PROMO-NIGHT-RECORD                            PIC  X(200).   00980004
003102                                                                  00990004
003109                                                                  01000026
003110 WORKING-STORAGE SECTION.                                         01010026
003120*-----------------------------------------------------------      01020026
003130* PS - PROGRAM SWITCHES                                           01030026
003140*-----------------------------------------------------------      01040026
003150 01  PS-PROGRAM-SWITCHES.                                         01050026
003160     05  PS-STORE-OVRRDE-CSR-EOF-SW                PIC  X(001).   01060026
003170       88  PS-STORE-OVRRDE-CSR-EOF                   VALUE 'Y'.   01070026
003180       88  PS-STORE-OVRRDE-CSR-NOT-EOF               VALUE 'N'.   01080026
003190     05  PS-ADHOC-STORE-CSR-EOF-SW                 PIC  X(001).   01090026
003200       88  PS-ADHOC-STORE-CSR-EOF                    VALUE 'Y'.   01100026
003300       88  PS-ADHOC-STORE-CSR-NOT-EOF                VALUE 'N'.   01110026
003400     05  PS-REC-FOUND-SW                           PIC  X(001).   01120026
003500       88  PS-REC-FOUND                              VALUE 'Y'.   01130026
003600       88  PS-NO-REC-FOUND                           VALUE 'N'.   01140026
003700     05  PS-WRITE-PROMO-SW                         PIC  X(001).   01150026
003800       88  PS-WRITE-PROMO                            VALUE 'Y'.   01160026
003900       88  PS-DONT-WRITE-PROMO                       VALUE 'N'.   01170026
004000     05  PS-FILE-STATUS                            PIC  X(002).   01180026
004100       88  PS-SUCCESSFUL-COMPLETION                  VALUE '00'.  01190026
004200       88  PS-END-OF-FILE                            VALUE '10'.  01200026
004300       88  PS-SUCCESSFUL-OPEN                        VALUE '97'.  01210026
004400     05  PS-END-OF-CNTL-CRD-SW                     PIC  X(001).   01220026
004500       88  PS-END-OF-CNTL-CRD-FILE                   VALUE 'Y'.   01230026
004600       88  PS-NOT-END-OF-CNTL-CRD-FILE               VALUE 'N'.   01240026
004700                                                                  01250026
004800*-----------------------------------------------------------      01260026
004900* PROGRAM CONSTANTS                                               01270026
005000*-----------------------------------------------------------      01280026
005100 01  PC-PROGRAM-CONSTANTS.                                        01290026
005200     05  PC-CURRENT-PROGRAM-NAME                   PIC  X(008)    01300026
005300       VALUE 'EPKUT354'.                                          01310026
005400     05  PC-PRICG-BUS-EVENT                        PIC  X(003)    01320026
005500       VALUE '090'.                                               01330026
005510     05  PC-ADHOC-STR-BUS-EVENT                    PIC  X(003)    01340026
005520       VALUE '050'.                                               01350026
005530     05  PC-RMS-PRC-SETUP-IND                      PIC  X(001)    01360026
005540       VALUE 'R'.                                                 01370026
005550     05  PC-ADHOC-PRC-SETUP-IND                    PIC  X(001)    01380026
005560       VALUE 'A'.                                                 01390026
005570     05  PC-ADHOC-STR-GRP-TYP-CDE                  PIC  X(005)    01400026
005580       VALUE '99999'.                                             01410026
005590     05  PC-ADHOC-STR-SPEC-CDE                     PIC  X(004)    01420026
005600       VALUE '5000'.                                              01430026
005700     05  PC-FILE-ACT-TYPE                          PIC  X(003)    01440026
005800       VALUE 'CHG'.                                               01450026
005900     05  PC-APPLY-NIGHTLY                          PIC  X(001)    01460026
006000       VALUE 'N'.                                                 01470026
006030     05  PC-PROMO-STAT-CDE                         PIC  X(001).   01480026
006040       88  PC-SCHEDULED-STATUS                       VALUE 'S'.   01490026
006050       88  PC-DELETE-STATUS                          VALUE 'D'.   01500026
006060       88  PC-CANCEL-STATUS                          VALUE 'C'.   01510026
006070     05  PC-ADD-STAT-CDE                           PIC  X(001)    01520026
006080       VALUE 'A'.                                                 01530026
006090     05  PC-DELETE-STAT-CDE                        PIC  X(001)    01540026
006091       VALUE 'D'.                                                 01550026
006092     05  PC-MDSE-INCL-BOTH-IND                     PIC  X(001)    01560026
006093       VALUE 'B'.                                                 01570026
006094     05  PC-MDSE-INCL-IND                          PIC  X(001)    01580026
006095       VALUE 'I'.                                                 01590026
006096                                                                  01600026
006097*-----------------------------------------------------------      01610026
006098* PV- PROGRAM VARIABLES                                           01620026
006099*-----------------------------------------------------------      01630026
006100 01  PV-PROGRAM-VARAIBLES.                                        01640026
006101     05  PV-SQL-SUB                                PIC S9(004)    01650026
006102                                                     VALUE +0     01660026
006103                                                     COMP.        01670026
006106     05  PV-ACTL-STRT-TMST.                                       01680026
006107       10  PV-ACTL-STRT-TMST-DATE                  PIC  X(010)    01690026
006108                                                     VALUE SPACES.01700026
006109       10  FILLER                                  PIC  X(016)    01710026
006110                                                     VALUE SPACES.01720026
006120     05  PV-SOR-LAST-UPD-TMST                      PIC  X(026)    01730026
006130                                                     VALUE SPACES.01740026
006140     05  PV-EFF-STRT-TMST                          PIC  X(026)    01750026
006150                                                     VALUE SPACES.01760026
006160     05  PV-EFF-END-TMST                           PIC  X(026)    01770026
006170                                                     VALUE SPACES.01780026
006180     05  PV-EFF-END-NULL                           PIC S9(004)    01790026
006190                                                     VALUE ZEROS  01800026
006200                                                     COMP.        01810026
006300     05  PV-ABEND-CODE                             PIC  9999      01820026
006400                                                     VALUE ZEROS  01830026
006500                                                     COMP.        01840026
006600     05  PV-FUL-FILE-STR                           PIC  9(005)    01850026
006700                                                     VALUE ZEROS. 01860026
006800     05  EP111-CC-DATE-PLUS1                       PIC  X(010)    01870026
007400                                                     VALUE SPACES.01880004
007500     05  EP113-CC-CRNT-DTE-MINUS1                  PIC  X(010)    01890004
007600                                                     VALUE SPACES.01900004
007610     05  EP045-CC-ADV-STR-OPN-DATE                 PIC  X(010)    01910027
007620                                                     VALUE SPACES.01920027
007700                                                                  01930004
007800*----------------------------------------------------------       01940004
007900* EPRD045 CONTROL CARD LAYOUT.                                    01950027
008000*----------------------------------------------------------       01960004
008100     COPY EPRD045.                                                01970027
008200                                                                  01980004
008210*----------------------------------------------------------       01990027
008220* FULL FILE EXTRACT OUTPUT FILE.                                  02000027
008230*----------------------------------------------------------       02010027
008240     COPY EPRD072.                                                02020027
008250                                                                  02030027
008300*----------------------------------------------------------       02040004
008400* EPCC111 CONTROL CARD LAYOUT                                     02050004
008500*----------------------------------------------------------       02060004
008600     COPY EPRD111.                                                02070004
008700                                                                  02080004
008800*----------------------------------------------------------       02090004
008900* EPCC113 CONTROL CARD LAYOUT                                     02100004
009000*----------------------------------------------------------       02110004
009100     COPY EPRD113.                                                02120004
009200                                                                  02130004
009300*----------------------------------------------------------       02140004
009400* EPCC400 CONTROL CARD LAYOUT                                     02150005
009500*----------------------------------------------------------       02160004
009600     COPY EPRD400.                                                02170005
009700                                                                  02180004
009701*----------------------------------------------------------       02190049
009702* EPCC401 CONTROL CARD LAYOUT                                     02200005
009703*----------------------------------------------------------       02210004
009704     COPY EPRD401.                                                02220005
009705                                                                  02230049
009800*----------------------------------------------------------       02240004
009900* EPCC128 CONTROL CARD LAYOUT                                     02250004
010000*----------------------------------------------------------       02260004
010100     COPY EPRD128.                                                02270004
010200                                                                  02280004
010300*----------------------------------------------------------       02290004
010400* DATE ROUTINE COPY MEMBERS                                       02300004
010500*----------------------------------------------------------       02310004
010600     COPY DPWS500.                                                02320004
010700                                                                  02330004
010800*-----------------------------------------------------------      02340004
010810* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         02350004
010820*-----------------------------------------------------------      02360004
010830     COPY DPWS004.                                                02370004
010840                                                                  02380004
010850*-----------------------------------------------------------      02390004
010860* DB2 ABEND COPYBOOK                                              02400004
010870*-----------------------------------------------------------      02410004
010880     COPY DPWS900.                                                02420004
010890                                                                  02430004
010900*-----------------------------------------------------------      02440004
011000* DB2 MESSAGE AREA                                                02450004
011100*-----------------------------------------------------------      02460004
011200     COPY SQLCA2.                                                 02470004
011300                                                                  02480004
011400*-----------------------------------------------------------      02490004
011500* PROGRAM COUNTERS                                                02500004
011600*-----------------------------------------------------------      02510004
011700 01  PC-PROGRAM-COUNTERS.                                         02520004
011800     05  PC-CNT-READ-RECS                          PIC  9(009)    02530004
011900                                                     VALUE 0.     02540004
012000     05  PC-CNT-NIGHT-RECS                         PIC  9(009)    02550004
012100                                                     VALUE 0.     02560004
012400     05  PC-CNT-PROMO-RECS                         PIC  9(009)    02570004
012500                                                     VALUE 0.     02580004
012600     05  PC-CNT-OVRRDE-RECS                        PIC  9(009)    02590008
012700                                                     VALUE 0.     02600004
012800     05  PC-CNT-ADHOC-RECS                         PIC  9(009)    02610004
012900                                                     VALUE 0.     02620004
013000     05  PC-CNT-DEVT-RECS                          PIC  9(009)    02630004
013100                                                     VALUE 0.     02640004
013200     05  PC-CNT-PMAP-RECS                          PIC  9(009)    02650004
013210                                                     VALUE 0.     02660004
013220     05  PC-CNT-ERROR-RECS                         PIC  9(009)    02670004
013230                                                     VALUE 0.     02680004
013240     05  PC-CNT-ALL-RECS                           PIC  9(009)    02690004
013250                                                     VALUE 0.     02700004
013260     05  PC-CNT-SPACES                             PIC  9(009)    02710004
013270                                                     VALUE 0.     02720004
013280     05  PC-CNT-POS                                PIC  9(009)    02730004
013290                                                     VALUE 0.     02740004
013300     05  PC-MAX-RETRIES                            PIC S9(004)    02750004
013301                                                     VALUE +5     02760004
013302                                                     COMP.        02770004
013303                                                                  02780004
013304*-----------------------------------------------------------      02790004
013305* ERROR HANDLING                                                  02800004
013306*-----------------------------------------------------------      02810004
013307 01  PV-MISC-ABEND-FIELDS.                                        02820004
013308     05  PV-PARAGRAPH-NAME                         PIC  X(030)    02830004
013309                                                     VALUE SPACE. 02840004
013310     05  PV-OPERATION-MSG-1                        PIC  X(040)    02850004
013320                                                     VALUE SPACE. 02860004
013330     05  PV-OPERATION-MSG-2                        PIC  X(040)    02870004
013340                                                     VALUE SPACE. 02880004
013350     05  PV-DB2-OPERATION                          PIC  X(030)    02890004
013360                                                     VALUE SPACE. 02900004
013370 01  ABEND-CODE                                    PIC S9(004)    02910004
013380                                                     VALUE ZEROS  02920004
013390                                                     COMP         02930004
013400                                                     SYNC.        02940004
013500   88  ABEND-4003-CTRL-CARD-ERROR                    VALUE +4003. 02950004
013600   88  ABEND-4013-DB2-ERROR                          VALUE +4013. 02960004
013700   88  ABEND-4019-CAL-SUB-ERROR                      VALUE +4019. 02970004
013800   88  ABEND-4020-MQ-ERROR                           VALUE +4020. 02980004
013900   88  ABEND-4444-FORCED-ABEND                       VALUE +4444. 02990004
014000   88  ABEND-4008                                    VALUE +4008. 03000004
014100                                                                  03010004
014200                                                                  03020004
014300*-----------------------------------------------------------      03030004
014400* DB2 COMMUNICATIONS AREA                                         03040004
014500*-----------------------------------------------------------      03050004
014600     EXEC SQL                                                     03060004
014700       INCLUDE SQLCA                                              03070004
014800     END-EXEC.                                                    03080004
014900                                                                  03090004
014911*-----------------------------------------------------------      03100027
014920* DB2 TABLE XST00001(XST_LOC) - LOCATION TABLE                    03110027
014921*-----------------------------------------------------------      03120027
014940     EXEC SQL                                                     03130027
014950       INCLUDE XST00001                                           03140027
014960     END-EXEC.                                                    03150027
014970                                                                  03160027
015000*-----------------------------------------------------------      03170004
015100* DB2 TABLE XST00023(XST_STR_GP_MBSHP) - STORE GROUP              03180005
015110*                                        MEMBERSHIP TABLE         03190005
015200*-----------------------------------------------------------      03200004
015300     EXEC SQL                                                     03210004
015400       INCLUDE XST00023                                           03220005
015500     END-EXEC.                                                    03230004
015600                                                                  03240004
015700*-----------------------------------------------------------      03250004
015800* DB2 TABLE XST00028(XST_MDSE_LNE_SELN) - MERCHANDISE TABLE       03260004
015900*-----------------------------------------------------------      03270004
016000     EXEC SQL                                                     03280004
016100       INCLUDE XST00028                                           03290004
016200     END-EXEC.                                                    03300004
016300                                                                  03310004
016400*-----------------------------------------------------------      03320004
016500* DB2 TABLE XST00029(XST_PROMO_STR_GP) - STORE ZONE PRICING       03330004
016600*                                               TABLE             03340004
016700*-----------------------------------------------------------      03350004
016800     EXEC SQL                                                     03360004
016900       INCLUDE XST00029                                           03370004
017000     END-EXEC.                                                    03380004
017100                                                                  03390004
017200*-----------------------------------------------------------      03400004
017300* DB2 TABLE XST00031(XST_PROMO_ADHC_RLT) ADHOC RELATION           03410004
017400*-----------------------------------------------------------      03420004
017500     EXEC SQL                                                     03430004
017600       INCLUDE XST00031                                           03440004
017700     END-EXEC.                                                    03450004
017800                                                                  03460004
017810*-----------------------------------------------------------      03470005
017820* DB2 TABLE XST00033(XST_PROMO_ADHC_STR) ADHOC RELATION           03480005
017830*-----------------------------------------------------------      03490005
017840     EXEC SQL                                                     03500005
017850       INCLUDE XST00033                                           03510005
017860     END-EXEC.                                                    03520005
017870                                                                  03530005
021600*-----------------------------------------------------------      03540004
021700* ADHOC STORE CHANGE CURSOR.                                      03550008
021710*-----------------------------------------------------------      03560004
021720     EXEC SQL                                                     03570004
021730       DECLARE ADHOC-STORE CURSOR FOR                             03580006
021740         SELECT ADHCS.STAT_CDE                                    03590006
021750               ,ADHCS.LAST_UPD_TMST                               03600006
021760               ,ADHCS.SOR_LAST_UPD_TMST                           03610006
021770               ,ADHOC.PROMO_INTFC_ID                              03620004
021780               ,ADHOC.MDSE_LNE_ID                                 03630004
021790               ,ADHOC.ADHC_STR_GP_ID                              03640004
021800               ,ADHOC.STR_SELN_HIER_CDE                           03650004
021801               ,ADHOC.ACTL_STRT_TMST                              03660004
021802               ,ADHOC.ACTL_END_TMST                               03670004
021803               ,STRMB.STR_GP_ID                                   03680008
021804               ,MDSSEL.PRICG_TYP_CDE                              03690004
021805         FROM XST_PROMO_ADHC_STR ADHCS                            03700006
021806             ,XST_PROMO_ADHC_RLT ADHOC                            03710006
021807             ,XST_MDSE_LNE_SELN  MDSSEL                           03720006
021808             ,XST_STR_GP_MBSHP   STRMB                            03730006
021809             ,XST_LOC            LOC                              03740027
021810         WHERE ADHOC.PROMO_INTFC_ID = MDSSEL.PROMO_INTFC_ID       03750006
021811           AND ADHOC.MDSE_LNE_ID    = MDSSEL.MDSE_LNE_ID          03760006
021812           AND ADHOC.ADHC_STR_GP_ID = ADHCS.ADHC_STR_GP_ID        03770006
021813           AND STRMB.STR_NBR        = ADHCS.STR_NBR               03780006
021814           AND STRMB.STR_GP_TYP_CDE = 5000                        03790006
021815           AND STRMB.STR_NBR        = LOC.LOC_NBR                 03800027
021816           AND ADHOC.STAT_CDE IN ('S')                            03810006
021817           AND MDSSEL.STAT_CDE IN ('S')                           03820006
021830           AND (ADHCS.LAST_UPD_TMST                               03830006
021840               BETWEEN :EP400-CC-PREV-RUN-CUTOFF-TMST             03840006
021850                   AND :EP401-CC-CURR-RUN-CUTOFF-TMST)            03850006
021851           AND (LOC.OPN_DTE  <= :EP045-CC-ADV-STR-OPN-DATE)       03860027
021853           AND ((LOC.CLO_DTE >= :EP111-CC-CRNT-DTE)               03870027
021854                 OR (LOC.CLO_DTE IS NULL))                        03880028
021855           AND ((DATE(ADHOC.ACTL_STRT_TMST)                       03890027
021856               BETWEEN DATE(ADHCS.EFF_STRT_TMST)                  03900027
021857                   AND DATE(ADHCS.EFF_END_TMST))                  03910027
021858           OR  (DATE(ADHOC.ACTL_STRT_TMST) >=                     03920027
021859               DATE(ADHCS.EFF_STRT_TMST)                          03930027
021860           AND DATE(ADHCS.EFF_END_TMST)IS NULL))                  03940027
021861           AND ((:EP111-CC-CRNT-DTE                               03950006
021870               BETWEEN DATE(ADHOC.ACTL_STRT_TMST)                 03960006
021871                   AND DATE(ADHOC.ACTL_END_TMST))                 03970006
021872           OR  (DATE(ADHOC.ACTL_STRT_TMST)                        03980006
021873               BETWEEN :EP111-CC-DATE-PLUS1                       03990006
021874                   AND :EP113-CC-CRNT-DTE-MINUS1))                04000006
021875         ORDER BY ADHOC.PROMO_INTFC_ID, ADHOC.MDSE_LNE_ID,        04010010
021876                  ADHOC.ADHC_STR_GP_ID                            04020006
021877         FOR FETCH ONLY                                           04030006
021878         WITH UR                                                  04040006
021879     END-EXEC.                                                    04050004
021880                                                                  04060004
021881*-----------------------------------------------------------      04070007
021882* STORE OVERRIDE CURSOR. (RMS STORES)                             04080007
021883*-----------------------------------------------------------      04090007
021884     EXEC SQL                                                     04100007
021885       DECLARE STORE-OVRRDE CURSOR FOR                            04110007
021886         SELECT STRGP.PROMO_INTFC_ID                              04120007
021887               ,STRGP.MDSE_LNE_ID                                 04130007
021888               ,STRGP.STR_GP_TYP_CDE                              04140007
021889               ,STRGP.STR_GP_ID                                   04150007
021890               ,STRGP.STR_SELN_HIER_CDE                           04160007
021891               ,STRGP.STAT_CDE                                    04170007
021892               ,STRGP.ACTL_STRT_TMST                              04180007
021893               ,STRGP.ACTL_END_TMST                               04190007
021894               ,STRGP.LAST_UPD_TMST                               04200007
021895               ,STRGP.SOR_LAST_UPD_TMST                           04210007
021896               ,MDSSEL.PRICG_TYP_CDE                              04220007
021897         FROM XST_PROMO_STR_GP   STRGP                            04230007
021898             ,XST_MDSE_LNE_SELN  MDSSEL                           04240007
021899         WHERE MDSSEL.PROMO_INTFC_ID = STRGP.PROMO_INTFC_ID       04250007
021900           AND MDSSEL.MDSE_LNE_ID    = STRGP.MDSE_LNE_ID          04260007
021901           AND STRGP.PROMO_INTFC_ID  = :XST00031-PROMO-INTFC-ID   04270013
021902           AND STRGP.MDSE_LNE_ID     = :XST00031-MDSE-LNE-ID      04280013
021903           AND STRGP.STR_GP_TYP_CDE  = 5000                       04290022
021904           AND STRGP.STR_GP_ID = :XST00023-STR-GP-ID              04300023
021905           AND (STRGP.STR_SELN_HIER_CDE                           04310012
021906                                   > :XST00031-STR-SELN-HIER-CDE) 04320012
021907           AND STRGP.STAT_CDE IN ('S')                            04330014
021908           AND MDSSEL.STAT_CDE IN ('S')                           04340021
021909           AND STRGP.PRNT_GP_TYP_CDE = ('A')                      04350012
021910           AND STRGP.PRNT_ADHC_GP_ID = :XST00031-ADHC-STR-GP-ID   04360012
021911           AND ((:EP111-CC-CRNT-DTE                               04370012
021912               BETWEEN DATE(STRGP.ACTL_STRT_TMST)                 04380012
021913                   AND DATE(STRGP.ACTL_END_TMST))                 04390012
021914           OR  (DATE(STRGP.ACTL_STRT_TMST)                        04400012
021915               BETWEEN :EP111-CC-DATE-PLUS1                       04410012
021916                   AND :EP113-CC-CRNT-DTE-MINUS1))                04420012
021917         FOR FETCH ONLY                                           04430012
021918         WITH UR                                                  04440012
021919     END-EXEC.                                                    04450012
021920                                                                  04460012
021921 LINKAGE SECTION.                                                 04470012
021922                                                                  04480012
021923*----------------------------------------------------------       04490012
021924 PROCEDURE DIVISION.                                              04500012
021925*----------------------------------------------------------       04510012
021926 0000-MAINLINE.                                                   04520012
021927                                                                  04530012
021928     PERFORM 1000-INITIALIZATION.                                 04540012
021929                                                                  04550012
021930     PERFORM 2000-PROCESS-ADHOC-STORES.                           04560012
021931                                                                  04570012
021932     PERFORM 9999-WRAPUP.                                         04580012
021933                                                                  04590012
021934     GOBACK.                                                      04600012
021935                                                                  04610012
021936*0000-EXIT.                                                       04620012
021940 EJECT.                                                           04630004
021950                                                                  04640004
021960*----------------------------------------------------------       04650004
021970* 1000-INITIALIZATION.                                            04660004
021980*     INITIALIZATION AREA - INITIALIZES ALL VARIABLES, OPENS      04670004
021981*     FILES, READS INPUT FILES, AND PROCESSES ANY INPUT FILE      04680004
021982*     PARAMETERS IT MAY NEED TO USE TO READ THE PROMO             04690004
021983*     INTERFACE ID FILE.                                          04700004
021984*----------------------------------------------------------       04710004
021985 1000-INITIALIZATION.                                             04720004
021986                                                                  04730004
021987     OPEN INPUT  CONTROL-CARD-CURR-PRICG-DTE                      04740004
021988                 CONTROL-CARD-FUTRE-CORR-DTE                      04750004
021989                 CONTROL-CARD-PGM-CURR-TMST                       04760049
021990                 CONTROL-CARD-PGM-LAST-RUN-TMST                   04770004
021991                 CONTROL-CARD-CRIT-EFF-DTE                        04780026
021992                 CONTROL-CARD-FUT-STR-OPN-DAY.                    04790026
021993     OPEN OUTPUT PROMO-NIGHT-FILE.                                04800004
021994                                                                  04810004
021995     INITIALIZE EP072-PROMO-INTFC-RECORD.                         04820004
021996                                                                  04830004
021997     PERFORM 1010-READ-PGM-CURR-RUN-CARD.                         04840004
021998     PERFORM 1020-READ-PGM-LAST-RUN-CARD.                         04850004
021999     PERFORM 1030-READ-CURR-PRICG-DTE-CARD.                       04860004
022000     PERFORM 1040-READ-FUTRE-CORR-DTE-CARD.                       04870004
022010     PERFORM 1050-READ-CRIT-EFF-DTE-CARD.                         04880004
022020     PERFORM 1060-READ-FUT-STR-OPN-DAY-CARD.                      04890027
022100     PERFORM 6100-DATE-ROUTINE.                                   04900004
022200                                                                  04910004
022300*1000-EXIT.                                                       04920004
022400 EJECT.                                                           04930004
022500                                                                  04940004
024900*----------------------------------------------------------       04950004
025000* 1010-READ-PGM-CURR-RUN-CARD.                                    04960004
025100*     READ CONTROL CARD EPCC401. THIS CONTROL CARD CONTAINS       04970005
025200*     THE CURRENT TIMESTAMP                                       04980004
025300*----------------------------------------------------------       04990004
025400 1010-READ-PGM-CURR-RUN-CARD.                                     05000004
025500                                                                  05010004
025600     READ CONTROL-CARD-PGM-CURR-TMST                              05020004
025700                                    INTO EP401-CC-CONTROL-CARD    05030004
025800       AT END                                                     05040004
025900          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    05050004
026000                                                                  05060004
026100     IF PS-END-OF-CNTL-CRD-FILE                                   05070004
026200       DISPLAY ' '                                                05080004
026300       DISPLAY '** ABEND     **'                                  05090004
026400       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      05100004
026500       DISPLAY '** PARAGRAPH **  = 1010-READ-PGM-CURR-RUN-CARD'   05110004
026600       DISPLAY '** CONTROL FILE IS EMPTY  '                       05120004
026700       DISPLAY ' '                                                05130004
026800       MOVE +4002 TO ABEND-CODE                                   05140004
026900       CALL 'ILBOABN0' USING ABEND-CODE                           05150004
027000     ELSE                                                         05160004
027100       DISPLAY '** PROGRAM LAST RUN CONTROL CARD  **'             05170004
027200       DISPLAY '** EPCC401    **  =' EP401-CC-CURR-RUN-CUTOFF-TMST05180005
027300       DISPLAY ' '                                                05190004
027400     END-IF.                                                      05200004
027500                                                                  05210004
027600*1010-EXIT.                                                       05220004
027700 EJECT.                                                           05230004
027701*----------------------------------------------------------       05240049
027702* 1020-READ-PGM-LAST-RUN-CARD.                                    05250004
027703*     READ CONTROL CARD EPCC400. THIS CONTROL CARD CONTAINS       05260005
027704*     THE TIMESTAMP FROM THE LAST RUN OF EPKUT354                 05270004
027705*----------------------------------------------------------       05280004
027706 1020-READ-PGM-LAST-RUN-CARD.                                     05290004
027707                                                                  05300004
027708     READ CONTROL-CARD-PGM-LAST-RUN-TMST                          05310004
027709                                    INTO EP400-CC-CONTROL-CARD    05320004
027710       AT END                                                     05330004
027711          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    05340004
027712                                                                  05350004
027713     IF PS-END-OF-CNTL-CRD-FILE                                   05360004
027714       DISPLAY ' '                                                05370004
027715       DISPLAY '** ABEND     **'                                  05380004
027716       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      05390004
027717       DISPLAY '** PARAGRAPH **  = 1020-READ-PGM-LAST-RUN-CARD'   05400004
027718       DISPLAY '** CONTROL FILE IS EMPTY  '                       05410004
027719       DISPLAY ' '                                                05420004
027720       MOVE +4002 TO ABEND-CODE                                   05430004
027721       CALL 'ILBOABN0' USING ABEND-CODE                           05440004
027722     ELSE                                                         05450004
027723       DISPLAY '** PROGRAM LAST RUN CONTROL CARD  **'             05460004
027724       DISPLAY '** EPCC400    **  =' EP400-CC-PREV-RUN-CUTOFF-TMST05470005
027725       DISPLAY ' '                                                05480004
027726     END-IF.                                                      05490004
027727                                                                  05500004
027728*1020-EXIT.                                                       05510004
027729 EJECT.                                                           05520004
027800                                                                  05530004
027900*----------------------------------------------------------       05540004
028000* 1030-READ-CURR-PRICG-DTE-CARD.                                  05550004
028100*     READ CONTROL CARD EPCC111. THIS CONTROL CARD CONTAINS       05560004
028200*     THE CURRENT PRICING DATE.                                   05570004
028300*----------------------------------------------------------       05580004
028310 1030-READ-CURR-PRICG-DTE-CARD.                                   05590004
028320                                                                  05600004
028330     READ CONTROL-CARD-CURR-PRICG-DTE                             05610004
028340                               INTO EP111-CC-CONTROL-CARD         05620004
028350       AT END                                                     05630004
028351          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    05640004
028352                                                                  05650004
028353     IF PS-END-OF-CNTL-CRD-FILE                                   05660004
028354       DISPLAY ' '                                                05670004
028355       DISPLAY '** ABEND     **'                                  05680004
028356       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      05690004
028357       DISPLAY '** PARAGRAPH **  = 1030-READ-CURR-PRICG-DTE-CARD' 05700004
028358       DISPLAY '** CONTROL FILE IS EMPTY  '                       05710004
028359       DISPLAY ' '                                                05720004
028360       MOVE +4002 TO ABEND-CODE                                   05730004
028361       CALL 'ILBOABN0' USING ABEND-CODE                           05740004
028362     ELSE                                                         05750004
028363       DISPLAY '** CURRENT PRICING DATE CONTROL CARD  **'         05760004
028364       DISPLAY '** EPCC111       **  = ' EP111-CC-CRNT-DTE        05770004
028365       DISPLAY ' '                                                05780004
028366     END-IF.                                                      05790004
028367                                                                  05800004
028368*1030-EXIT.                                                       05810004
028369 EJECT.                                                           05820004
028370                                                                  05830004
028371*----------------------------------------------------------       05840004
028372* 1040-READ-FUTRE-CORR-DTE-CARD.                                  05850004
028373*     READ CONTROL CARD EPCC113. THIS CONTROL CARD CONTAINS       05860004
028374*     THE NEXT FUTURE CORRECTIONS DATE                            05870004
028375*----------------------------------------------------------       05880004
028376 1040-READ-FUTRE-CORR-DTE-CARD.                                   05890004
028377                                                                  05900004
028378     READ CONTROL-CARD-FUTRE-CORR-DTE                             05910004
028379                               INTO EP113-CC-CONTROL-CARD         05920004
028380       AT END                                                     05930004
028381          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    05940004
028382                                                                  05950004
028383     IF PS-END-OF-CNTL-CRD-FILE                                   05960004
028384       DISPLAY ' '                                                05970004
028385       DISPLAY '** ABEND     **'                                  05980004
028386       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      05990004
028387       DISPLAY '** PARAGRAPH **  = 1040-READ-FUTRE-CORR-DTE-CARD' 06000004
028388       DISPLAY '** CONTROL FILE IS EMPTY  '                       06010004
028389       DISPLAY ' '                                                06020004
028390       MOVE +4002 TO ABEND-CODE                                   06030004
028391       CALL 'ILBOABN0' USING ABEND-CODE                           06040004
028392     ELSE                                                         06050004
028393       DISPLAY '** FUTURE CORRECTION DATE CONTROL CARD  **'       06060004
028394       DISPLAY '** EPCC113       **  = ' EP113-CC-CRNT-DTE        06070004
028395       DISPLAY ' '                                                06080004
028396     END-IF.                                                      06090004
028397                                                                  06100004
028398*1040-EXIT.                                                       06110004
028399 EJECT.                                                           06120004
028400                                                                  06130004
028401*----------------------------------------------------------       06140004
028402* 1050-READ-CRIT-EFF-DTE-CARD.                                    06150004
028403*     READ CONTROL CARD EPCC128  THIS CONTROL CARD CONTAINS       06160004
028404*     THE CRITICAL EFFECTIVE DATE, WHICH DETERMINES IF CHANGES    06170004
028405*     ARE EMERGENCY OR NIGHTLY.                                   06180004
028406*----------------------------------------------------------       06190004
028407 1050-READ-CRIT-EFF-DTE-CARD.                                     06200004
028408                                                                  06210004
028409     READ CONTROL-CARD-CRIT-EFF-DTE                               06220004
028410                               INTO EP128-CC-CONTROL-CARD         06230004
028411       AT END                                                     06240004
028412          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    06250004
028413                                                                  06260004
028414     IF PS-END-OF-CNTL-CRD-FILE                                   06270004
028415       DISPLAY ' '                                                06280004
028416       DISPLAY '** ABEND     **'                                  06290004
028417       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      06300004
028418       DISPLAY '** PARAGRAPH **  = 1050-READ-CRIT-EFF-DTE-CARD'   06310004
028419       DISPLAY '** CONTROL FILE IS EMPTY  '                       06320004
028420       DISPLAY ' '                                                06330004
028421       MOVE +4002 TO ABEND-CODE                                   06340004
028422       CALL 'ILBOABN0' USING ABEND-CODE                           06350004
028423     ELSE                                                         06360004
028424       DISPLAY '** CRITICAL EFFECTIVE DATE CONTROL CARD  **'      06370004
028425       DISPLAY '** EPCC128       **  = ' EP128-CC-CRITICAL-DTE    06380004
028426       DISPLAY ' '                                                06390004
028427     END-IF.                                                      06400004
028428                                                                  06410004
028429*1050-EXIT.                                                       06420004
028430 EJECT.                                                           06430004
028432                                                                  06440027
028433*----------------------------------------------------------       06450027
028435* 1060-READ-FUT-STR-OPN-DAY-CARD.                                 06460027
028436*     READ CONTROL CARD EPCC045. THIS CONTROL CARD CONTAINS       06470027
028437*     THE NUMBER OF DAYS IN THE FUTURE FOR WHICH STORES           06480027
028438*     WILL BE SENT FILES.                                         06490027
028439*----------------------------------------------------------       06500027
028440 1060-READ-FUT-STR-OPN-DAY-CARD.                                  06510027
028441                                                                  06520027
028442     READ CONTROL-CARD-FUT-STR-OPN-DAY                            06530027
028444                               INTO EP045-ADVDAYS-TO-SND-RECORD   06540027
028445       AT END                                                     06550027
028446          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    06560027
028447                                                                  06570027
028448     IF PS-END-OF-CNTL-CRD-FILE                                   06580027
028449       DISPLAY ' '                                                06590027
028450       DISPLAY '** ABEND     **'                                  06600027
028451       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      06610027
028452       DISPLAY '** PARAGRAPH **  = 1060-READ-FUT-STR-OPN-DAY-CARD'06620027
028453       DISPLAY '** CONTROL FILE IS EMPTY  '                       06630027
028454       DISPLAY ' '                                                06640027
028455       MOVE +4002 TO ABEND-CODE                                   06650027
028456       CALL 'ILBOABN0' USING ABEND-CODE                           06660027
028457     ELSE                                                         06670027
028458       DISPLAY '** ADVANCE STORE OPEN DAYS CONTROL CARD  **'      06680027
028459       DISPLAY '** EPCC045       **  = '                          06690027
028460         EP045-DAYS-TILL-STORE-OPN                                06700029
028461       DISPLAY ' '                                                06710027
028462     END-IF.                                                      06720027
028463                                                                  06730027
028464*1060-EXIT.                                                       06740027
028465 EJECT.                                                           06750027
028466                                                                  06760027
028467*----------------------------------------------------------       06770027
028468* 2000-PROCESS-ADHOC-STORES.                                      06780027
028469*     MAIN PROCESSING AREA - EXECUTES A QUERY TO IDENTIFY ANY     06790027
028470*     CHANGES THAT WERE MADE TO THE ADHOC STORE TABLE. WHEN A     06800027
028471*     RECORD IS FOUND, A SECOND QUERY IS EXECUTED TO FIND ANY     06810027
028472*     STORE OVERRIDES WHICH MAY EXIST. IF AN OVERRIDE DOES        06820027
028473*     EXIST, AN OUTPUT FILE IS PRODUCED FROM THE SECOND QUERY,    06830027
028474*     ELSE AN OUTPUT FILE IS PRODUCED FROM THE FIRST QUERY.       06840027
028475*----------------------------------------------------------       06850027
028476 2000-PROCESS-ADHOC-STORES.                                       06860027
028477                                                                  06870027
028478     PERFORM 2010-OPEN-ADHOC-STORE-CSR.                           06880027
028479     PERFORM 2020-FETCH-ADHOC-STORE-CSR                           06890027
028480       UNTIL PS-ADHOC-STORE-CSR-EOF.                              06900027
028481     PERFORM 2030-CLOSE-ADHOC-STORE-CSR.                          06910027
028482                                                                  06920027
028483*2000-EXIT.                                                       06930027
028484 EJECT.                                                           06940027
028485                                                                  06950027
028486*----------------------------------------------------------       06960027
028487* 2010-OPEN-ADHOC-STORE-CSR.                                      06970027
028488*     OPEN THE CURSOR TO BE USED IN FINDING CHANGED OR            06980027
028489*     UPDATED ADHOC STORES.                                       06990027
028490*----------------------------------------------------------       07000027
028491 2010-OPEN-ADHOC-STORE-CSR.                                       07010027
028492                                                                  07020027
028493     PERFORM                                                      07030027
028494         WITH TEST AFTER                                          07040027
028495         VARYING PV-SQL-SUB                                       07050027
028496         FROM 1 BY 1                                              07060027
028500         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 07070004
028600                OR  SQLCODE = 0)                                  07080007
028700                                                                  07090004
028800         EXEC SQL                                                 07100004
028900           OPEN ADHOC-STORE                                       07110007
029000         END-EXEC                                                 07120004
029100                                                                  07130004
029200         EVALUATE TRUE                                            07140004
029300           WHEN SQLCODE = -904                                    07150004
029400           WHEN SQLCODE = -911                                    07160004
029500           WHEN SQLCODE = -913                                    07170004
029600             CONTINUE                                             07180004
029700           WHEN SQLCODE = 0                                       07190004
029800             SET PS-ADHOC-STORE-CSR-NOT-EOF TO TRUE               07200007
029900           WHEN SQLWARN0 NOT EQUAL SPACE                          07210004
030000           WHEN SQLCODE NOT EQUAL ZERO                            07220004
030100             MOVE '2010-OPEN-ADHOC-STORE-CSR'                     07230011
030200                                   TO PV-PARAGRAPH-NAME           07240004
030300             MOVE 'ERROR ON OPEN OF ADHOC STORE CURSOR'           07250007
030400                                   TO PV-DB2-OPERATION            07260004
030500             PERFORM 9900-SQL-ABEND-ROUTINE                       07270004
030600         END-EVALUATE                                             07280004
030700     END-PERFORM.                                                 07290004
030800                                                                  07300004
030900     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         07310004
031000       MOVE '2010-OPEN-ADHOC-STORE-CSR'                           07320011
031100                             TO  PV-PARAGRAPH-NAME                07330004
031200       MOVE 'OPEN RETRIES EXCEEDED'                               07340004
031300                              TO  PV-DB2-OPERATION                07350004
031400       PERFORM 9900-SQL-ABEND-ROUTINE                             07360004
031500     END-IF.                                                      07370004
031600                                                                  07380004
031700*2010-EXIT.                                                       07390007
031800 EJECT.                                                           07400004
031900                                                                  07410004
032000*----------------------------------------------------------       07420004
032100* 2020-FETCH-ADHOC-STORE-CSR.                                     07430007
032200*     FETCH THE DATA FROM THE ADHOC STORE CURSOR. IF A            07440007
032210*     RECORD IS FOUND USING THIS CURSOR, A SECOND QUERY IS        07450007
032220*     PERFORMED THAT WILL CHECK THE XST_PROMO_STR_GP TABLE        07460007
032230*     FOR OVERRIDES.                                              07470007
032300*----------------------------------------------------------       07480004
032400 2020-FETCH-ADHOC-STORE-CSR.                                      07490007
032500                                                                  07500004
032600     PERFORM                                                      07510004
032700         WITH TEST AFTER                                          07520004
032800         VARYING PV-SQL-SUB                                       07530004
032900         FROM 1 BY 1                                              07540004
033000         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 07550004
033100                   OR  SQLCODE = 0                                07560004
033200                   OR  SQLCODE = +100)                            07570004
033300                                                                  07580004
033400         EXEC SQL                                                 07590004
033500           FETCH ADHOC-STORE                                      07600009
033510            INTO :XST00033-STAT-CDE                               07610007
033520                ,:XST00033-LAST-UPD-TMST                          07620007
033530                ,:XST00033-SOR-LAST-UPD-TMST                      07630007
033540                ,:XST00031-PROMO-INTFC-ID                         07640007
033550                ,:XST00031-MDSE-LNE-ID                            07650007
033560                ,:XST00031-ADHC-STR-GP-ID                         07660007
033570                ,:XST00031-STR-SELN-HIER-CDE                      07670007
033580                ,:XST00031-ACTL-STRT-TMST                         07680007
033590                ,:XST00031-ACTL-END-TMST                          07690007
033591                ,:XST00023-STR-GP-ID                              07700008
033592                ,:XST00028-PRICG-TYP-CDE                          07710007
034700         END-EXEC                                                 07720004
034800                                                                  07730004
034900         EVALUATE TRUE                                            07740004
035000           WHEN SQLCODE = -904                                    07750004
035100           WHEN SQLCODE = -911                                    07760004
035200           WHEN SQLCODE = -913                                    07770004
035300             CONTINUE                                             07780004
035400           WHEN SQLCODE = ZERO                                    07790004
035600             PERFORM 2100-FIND-STORE-OVERRIDES                    07800018
035700           WHEN SQLCODE = +100                                    07810004
035800             SET PS-ADHOC-STORE-CSR-EOF TO TRUE                   07820007
035900           WHEN SQLWARN0 NOT EQUAL SPACE                          07830004
036000           WHEN SQLCODE NOT EQUAL ZERO                            07840004
036100             MOVE '2020-FETCH-ADHOC-STORE-CSR'                    07850007
036200                                    TO PV-PARAGRAPH-NAME          07860004
036300             MOVE 'ERROR ON FETCHING ADHOC STORE CURSOR'          07870007
036400                                    TO PV-DB2-OPERATION           07880004
036500             PERFORM 9900-SQL-ABEND-ROUTINE                       07890004
036600         END-EVALUATE                                             07900004
036700     END-PERFORM.                                                 07910004
036800                                                                  07920004
036900     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         07930004
037000       MOVE '2020-FETCH-ADHOC-STORE-CSR'                          07940007
037100                               TO  PV-PARAGRAPH-NAME              07950004
037200       MOVE 'FETCH RETRIES EXCEEDED'                              07960004
037300                               TO  PV-DB2-OPERATION               07970004
037400       PERFORM 9900-SQL-ABEND-ROUTINE                             07980004
037500     END-IF.                                                      07990004
037600                                                                  08000004
037700*2020-EXIT.                                                       08010007
037800 EJECT.                                                           08020004
037900                                                                  08030004
038000*-----------------------------------------------------------      08040004
038100* 2030-CLOSE-ADHOC-STORE-CSR.                                     08050007
038200*-----------------------------------------------------------      08060004
038300 2030-CLOSE-ADHOC-STORE-CSR.                                      08070007
038400                                                                  08080004
038500     PERFORM                                                      08090004
038600         WITH TEST AFTER                                          08100004
038700         VARYING PV-SQL-SUB                                       08110004
038800         FROM 1 BY 1                                              08120004
038900         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 08130004
039000                   OR  SQLCODE = 0)                               08140004
039100                                                                  08150004
039200         EXEC SQL                                                 08160004
039300           CLOSE ADHOC-STORE                                      08170007
039400         END-EXEC                                                 08180004
039500                                                                  08190004
039600         EVALUATE TRUE                                            08200004
039700           WHEN SQLCODE = -904                                    08210004
039800           WHEN SQLCODE = -911                                    08220004
039900           WHEN SQLCODE = -913                                    08230004
040000           WHEN SQLCODE = 0                                       08240004
040100             CONTINUE                                             08250004
040200           WHEN SQLWARN0 NOT EQUAL SPACE                          08260004
040300           WHEN SQLCODE NOT EQUAL ZERO                            08270004
040400             MOVE '2030-CLOSE-ADHOC-STORE-CSR'                    08280007
040500                                       TO PV-PARAGRAPH-NAME       08290004
040600             MOVE 'ERROR ON CLOSE OF ADHOC STORE CURSOR'          08300007
040700                                       TO PV-DB2-OPERATION        08310004
040800             PERFORM 9900-SQL-ABEND-ROUTINE                       08320004
040900         END-EVALUATE                                             08330004
041000     END-PERFORM.                                                 08340004
041100                                                                  08350004
041200     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         08360004
041300       MOVE '2030-CLOSE-ADHOC-STORE-CSR'                          08370007
041400                               TO  PV-PARAGRAPH-NAME              08380004
041500       MOVE 'CLOSE RETRIES EXCEEDED'                              08390004
041600                               TO  PV-DB2-OPERATION               08400004
041700       PERFORM 9900-SQL-ABEND-ROUTINE                             08410004
041800     END-IF.                                                      08420004
041900                                                                  08430004
042000*2030-EXIT.                                                       08440007
042100 EJECT.                                                           08450004
042200                                                                  08460004
042300*----------------------------------------------------------       08470004
042400* 2100-FIND-STORE-OVERRIDES.                                      08480011
042500*     ONCE AN ADHOC STORE IS FOUND USING THE ADHOC CURSOR,        08490007
042600*     A SECOND CURSOR IS EXECUTED TO SEE IF ANY STORE OVERRIDES   08500007
042610*     EXIST FOR THAT STORE. IF AN OVERRIDE IS FOUND A PROMO       08510007
042620*     RECORD IS WRITTEN FROM THE OVERRIDE CURSOR, IF NOT          08520007
042630*     FOUND A PROMO RECORD IS WRIITEN FROM THE ADHOC CURSOR.      08530007
042700*----------------------------------------------------------       08540004
042800 2100-FIND-STORE-OVERRIDES.                                       08550018
042900                                                                  08560004
043000     PERFORM 2110-OPEN-STORE-OVRRDE-CSR.                          08570018
043100     PERFORM 2120-FETCH-STORE-OVRRDE-CSR                          08580018
043200       UNTIL PS-STORE-OVRRDE-CSR-EOF.                             08590018
043300     PERFORM 2130-CLOSE-STORE-OVRRDE-CSR.                         08600018
043400                                                                  08610004
043500*2100-EXIT.                                                       08620007
043600 EJECT.                                                           08630004
043700                                                                  08640004
043800*----------------------------------------------------------       08650004
043900* 2110-OPEN-STORE-OVRRDE-CSR.                                     08660007
044000*     OPEN THE STORE OVERRIDE CURSOR.                             08670007
044100*----------------------------------------------------------       08680004
044200 2110-OPEN-STORE-OVRRDE-CSR.                                      08690007
044300                                                                  08700004
044400     PERFORM                                                      08710004
044500         WITH TEST AFTER                                          08720004
044600         VARYING PV-SQL-SUB                                       08730004
044700         FROM 1 BY 1                                              08740004
044800         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 08750004
044900                   OR  SQLCODE = 0)                               08760004
045000                                                                  08770004
045100         EXEC SQL                                                 08780004
045200           OPEN STORE-OVRRDE                                      08790007
045300         END-EXEC                                                 08800004
045400                                                                  08810004
045500         EVALUATE TRUE                                            08820004
045600           WHEN SQLCODE = -904                                    08830004
045700           WHEN SQLCODE = -911                                    08840004
045800           WHEN SQLCODE = -913                                    08850004
045900             CONTINUE                                             08860004
046000           WHEN SQLCODE = 0                                       08870004
046100             SET PS-STORE-OVRRDE-CSR-NOT-EOF TO TRUE              08880007
046200           WHEN SQLWARN0 NOT EQUAL SPACE                          08890004
046300           WHEN SQLCODE NOT EQUAL ZERO                            08900004
046400             MOVE '2110-OPEN-STORE-OVRRDE-CSR'                    08910007
046500                                     TO PV-PARAGRAPH-NAME         08920004
046600             MOVE 'ERROR ON OPEN OF STORE OVRRDE CURSOR'          08930007
046700                                     TO PV-DB2-OPERATION          08940004
046800             PERFORM 9900-SQL-ABEND-ROUTINE                       08950004
046900         END-EVALUATE                                             08960004
047000     END-PERFORM.                                                 08970004
047100                                                                  08980004
047200     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         08990004
047300       MOVE '2110-OPEN-STORE-OVRRDE-CSR'                          09000007
047400                             TO  PV-PARAGRAPH-NAME                09010004
047500       MOVE 'OPEN RETRIES EXCEEDED'                               09020004
047600                              TO  PV-DB2-OPERATION                09030004
047700       PERFORM 9900-SQL-ABEND-ROUTINE                             09040004
047800     END-IF.                                                      09050004
047900                                                                  09060004
048000*2110-EXIT.                                                       09070007
048100 EJECT.                                                           09080004
048200                                                                  09090004
048300*----------------------------------------------------------       09100004
048400* 2120-FETCH-STORE-OVRRDE-CSR.                                    09110007
048500*     FETCH THE DATA FOR THE STORE OVERRIDE CURSOR. IF A          09120007
048510*     RECORD IS FOUND WITH THIS CURSOR, A PROMO RECORD IS         09130007
048520*     WRITTEN FOR THE OVERRIDE STORE. IF AN OVERRIDE IS NOT       09140007
048530*     FOUND, A PROMO RECORD IS WRITTEN FOR THE ADHOC STORE.       09150007
048600*----------------------------------------------------------       09160004
048700 2120-FETCH-STORE-OVRRDE-CSR.                                     09170007
048800                                                                  09180004
048900     PERFORM                                                      09190004
049000         WITH TEST AFTER                                          09200004
049100         VARYING PV-SQL-SUB                                       09210004
049200         FROM 1 BY 1                                              09220004
049300         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 09230004
049400                   OR  SQLCODE = 0                                09240004
049500                   OR  SQLCODE = +100)                            09250004
049600                                                                  09260004
049700         EXEC SQL                                                 09270004
049800           FETCH STORE-OVRRDE                                     09280007
050840            INTO  :XST00029-PROMO-INTFC-ID                        09290007
050850                 ,:XST00029-MDSE-LNE-ID                           09300007
050860                 ,:XST00029-STR-GP-TYP-CDE                        09310007
050870                 ,:XST00029-STR-GP-ID                             09320007
050880                 ,:XST00029-STR-SELN-HIER-CDE                     09330007
050881                 ,:XST00029-STAT-CDE                              09340007
050882                 ,:XST00029-ACTL-STRT-TMST                        09350007
050883                 ,:XST00029-ACTL-END-TMST                         09360007
050884                 ,:XST00029-LAST-UPD-TMST                         09370007
050885                 ,:XST00029-SOR-LAST-UPD-TMST                     09380007
050892                 ,:XST00028-PRICG-TYP-CDE                         09390007
050900         END-EXEC                                                 09400004
051000                                                                  09410004
051100         EVALUATE TRUE                                            09420004
051110           WHEN SQLCODE = -904                                    09430004
051120           WHEN SQLCODE = -911                                    09440004
051130           WHEN SQLCODE = -913                                    09450004
051140             CONTINUE                                             09460004
051150           WHEN SQLCODE = ZERO                                    09470004
051160             PERFORM 3100-FORMAT-OVRRDE-OUTPUT                    09480007
051170             ADD 1 TO PC-CNT-OVRRDE-RECS                          09490007
051171             SET PS-STORE-OVRRDE-CSR-EOF TO TRUE                  09500015
051180           WHEN SQLCODE = +100                                    09510004
051191             PERFORM 3000-FORMAT-ADHOC-OUTPUT                     09520007
051192             ADD 1 TO PC-CNT-ADHOC-RECS                           09530007
051193             SET PS-STORE-OVRRDE-CSR-EOF TO TRUE                  09540008
051200           WHEN SQLWARN0 NOT EQUAL SPACE                          09550004
051300           WHEN SQLCODE NOT EQUAL ZERO                            09560004
051400             MOVE '2120-FETCH-STORE-OVRRDE-CSR'                   09570007
051500                                    TO PV-PARAGRAPH-NAME          09580004
051600             MOVE 'ERROR ON FETCHING STORE OVRRDE CURSOR'         09590007
051700                                    TO PV-DB2-OPERATION           09600004
051800             DISPLAY 'SQLCODE= ' SQLCODE                          09610004
051810             PERFORM 9900-SQL-ABEND-ROUTINE                       09620004
051820         END-EVALUATE                                             09630004
051830     END-PERFORM.                                                 09640004
051840                                                                  09650004
051850     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         09660004
051860       MOVE '2120-FETCH-STORE-OVRRDE-CSR'                         09670007
051870                              TO  PV-PARAGRAPH-NAME               09680004
051880       MOVE 'FETCH RETRIES EXCEEDED'                              09690004
051881                              TO  PV-DB2-OPERATION                09700004
051882       PERFORM 9900-SQL-ABEND-ROUTINE                             09710004
051883     END-IF.                                                      09720004
051884                                                                  09730004
051885*2120-EXIT.                                                       09740007
051886 EJECT.                                                           09750004
051887                                                                  09760004
051888*-----------------------------------------------------------      09770004
051889* 2130-CLOSE-STORE-OVRRDE-CSR.                                    09780007
051890*     CLOSE THE STORE OVERRIDE CURSOR.                            09790007
051891*-----------------------------------------------------------      09800004
051892 2130-CLOSE-STORE-OVRRDE-CSR.                                     09810007
051893                                                                  09820004
051894     PERFORM                                                      09830004
051895         WITH TEST AFTER                                          09840004
051896         VARYING PV-SQL-SUB                                       09850004
051897         FROM 1 BY 1                                              09860004
051898         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 09870004
051899                   OR  SQLCODE = 0)                               09880004
051900                                                                  09890004
051901         EXEC SQL                                                 09900004
051902           CLOSE STORE-OVRRDE                                     09910007
051903         END-EXEC                                                 09920004
051904                                                                  09930004
051905         EVALUATE TRUE                                            09940004
051906           WHEN SQLCODE = -904                                    09950004
051907           WHEN SQLCODE = -911                                    09960004
051908           WHEN SQLCODE = -913                                    09970004
051909           WHEN SQLCODE = 0                                       09980004
051910             CONTINUE                                             09990004
051911           WHEN SQLWARN0 NOT EQUAL SPACE                          10000004
051912           WHEN SQLCODE NOT EQUAL ZERO                            10010004
051913             MOVE '2130-CLOSE-STORE-OVRRDE-CSR'                   10020007
051914                                     TO PV-PARAGRAPH-NAME         10030004
051915             MOVE 'ERROR ON CLOSE OF STORE OVRRDE CURSOR'         10040007
051916                                     TO PV-DB2-OPERATION          10050004
051917             PERFORM 9900-SQL-ABEND-ROUTINE                       10060004
051918         END-EVALUATE                                             10070004
051919     END-PERFORM.                                                 10080004
051920                                                                  10090004
051921     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         10100004
051922       MOVE '2130-CLOSE-STORE-OVRRDE-CSR'                         10110017
051923                               TO  PV-PARAGRAPH-NAME              10120004
051924       MOVE 'CLOSE RETRIES EXCEEDED'                              10130004
051925                               TO  PV-DB2-OPERATION               10140004
051926       PERFORM 9900-SQL-ABEND-ROUTINE                             10150004
051927     END-IF.                                                      10160004
051928                                                                  10170004
051929*2130-EXIT.                                                       10180007
051930 EJECT.                                                           10190004
051931                                                                  10200004
052167*-----------------------------------------------------------      10210004
052168* 3000-FORMAT-ADHOC-OUTPUT.                                       10220007
052169*     POPULATE COPYBOOK EPRD072 WITH DATA FROM ADHOC CURSOR.      10230007
052170*-----------------------------------------------------------      10240004
052171 3000-FORMAT-ADHOC-OUTPUT.                                        10250007
052172                                                                  10260004
052173     INITIALIZE EP072-PROMO-INTFC-RECORD.                         10270004
052174     MOVE PC-ADHOC-STR-BUS-EVENT                                  10280007
052175                             TO EP072-BUSINESS-EVENT-ID.          10290004
052176     MOVE PC-ADHOC-PRC-SETUP-IND                                  10300004
052177                             TO EP072-PRC-SETUP-IND.              10310004
052178     MOVE PC-ADHOC-STR-GRP-TYP-CDE                                10320004
052179                             TO EP072-SETUP-STR-GRP-TYP-CDE.      10330004
052180     MOVE XST00031-ADHC-STR-GP-ID                                 10340004
052181                             TO EP072-SETUP-STR-GRP-ID.           10350004
052182     MOVE XST00031-STR-SELN-HIER-CDE                              10360004
052183                             TO EP072-STR-SELN-HIER-CDE.          10370004
052184     MOVE PC-ADHOC-STR-SPEC-CDE                                   10380008
052185                             TO EP072-DIST-STR-GRP-TYP-CDE.       10390004
052186     MOVE XST00023-STR-GP-ID                                      10400008
052187                             TO EP072-DIST-STR-GRP-ID.            10410004
052188     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               10420004
052189                                                                  10430004
052190     MOVE XST00031-ACTL-STRT-TMST                                 10440004
052200                             TO PV-ACTL-STRT-TMST.                10450004
052210                                                                  10460004
052220     IF PV-ACTL-STRT-TMST-DATE > EP128-CC-CRITICAL-DTE            10470004
052230       AND PV-ACTL-STRT-TMST-DATE < EP113-CC-CRNT-DTE             10480004
052240         MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND               10490004
052282     END-IF.                                                      10500004
052283                                                                  10510004
052284     MOVE XST00033-STAT-CDE  TO PC-PROMO-STAT-CDE                 10520008
052285                                                                  10530004
052286     IF PC-SCHEDULED-STATUS                                       10540004
052287       MOVE PC-ADD-STAT-CDE                                       10550004
052288                             TO EP072-RECORD-ACTION               10560004
052289     ELSE                                                         10570004
052290       IF PC-DELETE-STATUS OR PC-CANCEL-STATUS                    10580004
052300         MOVE PC-DELETE-STAT-CDE                                  10590004
052301                             TO EP072-RECORD-ACTION               10600004
052302       END-IF                                                     10610004
052303     END-IF.                                                      10620004
052304                                                                  10630004
052305     MOVE XST00031-PROMO-INTFC-ID                                 10640004
052306                             TO EP072-PROMO-INTFC-ID.             10650004
052307     MOVE XST00031-MDSE-LNE-ID                                    10660004
052308                             TO EP072-MERCH-LNE-ID.               10670004
052309     MOVE XST00028-PRICG-TYP-CDE                                  10680004
052310                             TO EP072-PRICG-TYP-CDE.              10690004
052311     MOVE PC-MDSE-INCL-BOTH-IND                                   10700008
052312                             TO EP072-MDSE-INC-EXC-IND.           10710004
052313     MOVE XST00031-ACTL-STRT-TMST                                 10720004
052314                             TO EP072-STR-GRP-PROMO-STRT-TMST.    10730004
052315     MOVE XST00031-ACTL-END-TMST                                  10740004
052316                             TO EP072-STR-GRP-PROMO-END-TMST.     10750004
052317     MOVE XST00033-SOR-LAST-UPD-TMST                              10760008
052318                             TO EP072-SOR-LAST-UPD-TMST.          10770004
052319                                                                  10780004
052320     IF EP072-APPLY-NIGHTLY                                       10790004
052321       PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                      10800004
052322     ELSE                                                         10810004
052324       MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND                 10820004
052325       PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                      10830004
052326     END-IF.                                                      10840004
052327                                                                  10850004
052328*3000-EXIT.                                                       10860007
052329 EJECT.                                                           10870004
052330                                                                  10880004
052331*-----------------------------------------------------------      10890007
052332* 3100-FORMAT-OVRRDE-OUTPUT.                                      10900007
052333*     POPULATE COPYBOOK EPRD072.                                  10910007
052334*-----------------------------------------------------------      10920007
052335 3100-FORMAT-OVRRDE-OUTPUT.                                       10930007
052336                                                                  10940007
052337     INITIALIZE EP072-PROMO-INTFC-RECORD.                         10950007
052338     MOVE PC-PRICG-BUS-EVENT                                      10960007
052339                             TO EP072-BUSINESS-EVENT-ID.          10970007
052340     MOVE PC-RMS-PRC-SETUP-IND                                    10980007
052341                             TO EP072-PRC-SETUP-IND.              10990007
052342     MOVE XST00029-STR-GP-TYP-CDE                                 11000007
052343                             TO EP072-SETUP-STR-GRP-TYP-CDE.      11010007
052344     MOVE XST00029-STR-GP-ID                                      11020007
052345                             TO EP072-SETUP-STR-GRP-ID.           11030007
052346     MOVE XST00029-STR-SELN-HIER-CDE                              11040007
052347                             TO EP072-STR-SELN-HIER-CDE.          11050007
052348     MOVE XST00029-STR-GP-TYP-CDE                                 11060007
052349                             TO EP072-DIST-STR-GRP-TYP-CDE.       11070007
052350     MOVE XST00023-STR-GP-ID                                      11080020
052351                             TO EP072-DIST-STR-GRP-ID.            11090007
052352     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               11100007
052353                                                                  11110007
052354     MOVE XST00029-ACTL-STRT-TMST                                 11120007
052355                             TO PV-ACTL-STRT-TMST.                11130007
052356                                                                  11140007
052357     IF PV-ACTL-STRT-TMST-DATE > EP128-CC-CRITICAL-DTE            11150007
052358       AND PV-ACTL-STRT-TMST-DATE < EP113-CC-CRNT-DTE             11160007
052359         MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND               11170007
052365     END-IF.                                                      11180007
052366                                                                  11190007
052367     MOVE PC-ADD-STAT-CDE    TO EP072-RECORD-ACTION.              11200025
052379     MOVE XST00029-PROMO-INTFC-ID                                 11210007
052380                             TO EP072-PROMO-INTFC-ID.             11220007
052381     MOVE XST00029-MDSE-LNE-ID                                    11230007
052382                             TO EP072-MERCH-LNE-ID.               11240007
052383     MOVE XST00028-PRICG-TYP-CDE                                  11250007
052384                             TO EP072-PRICG-TYP-CDE.              11260007
052385     MOVE PC-MDSE-INCL-IND                                        11270007
052386                             TO EP072-MDSE-INC-EXC-IND.           11280007
052387     MOVE XST00029-ACTL-STRT-TMST                                 11290007
052388                             TO EP072-STR-GRP-PROMO-STRT-TMST.    11300007
052389     MOVE XST00029-ACTL-END-TMST                                  11310007
052390                             TO EP072-STR-GRP-PROMO-END-TMST.     11320007
052391     MOVE XST00029-SOR-LAST-UPD-TMST                              11330008
052392                             TO EP072-SOR-LAST-UPD-TMST.          11340007
052393                                                                  11350007
052394     IF EP072-APPLY-NIGHTLY                                       11360007
052395       PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                      11370007
052396     ELSE                                                         11380007
052398       MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND                 11390007
052399       PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                      11400007
052400     END-IF.                                                      11410007
052401                                                                  11420007
052402*3100-EXIT.                                                       11430007
052403 EJECT.                                                           11440007
052405*----------------------------------------------------------       11450004
052406* 4000-WRITE-NIGHT-APPLY-RECORD.                                  11460004
052407*     WRITES THE PROMO FULL FILE RECORD TO THE FULL FILE          11470004
052408*----------------------------------------------------------       11480004
052409 4000-WRITE-NIGHT-APPLY-RECORD.                                   11490004
052410                                                                  11500004
052411     WRITE PROMO-NIGHT-RECORD FROM EP072-PROMO-INTFC-RECORD.      11510004
052412                                                                  11520004
052413     ADD 1           TO PC-CNT-NIGHT-RECS                         11530004
052414                        PC-CNT-ALL-RECS.                          11540004
052415                                                                  11550004
052416*4000-EXIT.                                                       11560004
052417 EJECT.                                                           11570004
052418                                                                  11580004
052790                                                                  11590004
052800*----------------------------------------------------------       11600004
052801* DATE ROUTINE TO SET UP THE PROCESS DATE IN                      11610004
052802* CCYYMMDD FORMAT.                                                11620004
052803*----------------------------------------------------------       11630004
052804 6100-DATE-ROUTINE.                                               11640004
052805                                                                  11650004
052806     INITIALIZE DPG51 DPG52 DPG53                                 11660004
052807                DPG54 DPG55 DPG56.                                11670004
052808                                                                  11680004
052809     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      11690004
052810     SET DPG51-INCREMENT-DATE       TO TRUE.                      11700004
052820     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      11710004
052830     MOVE 1                         TO DPG51-INCR-DECR-DAYS-9.    11720004
052840     MOVE EP111-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE-FMT.    11730004
052850                                                                  11740004
052860     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    11750004
052870                                             DPG54 DPG55 DPG56.   11760004
052880                                                                  11770004
052890     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  11780004
052900       DISPLAY '** ABEND **'                                      11790004
053000       DISPLAY '** PROGRAM = EPKUT354'                            11800004
053100       DISPLAY 'DATE = ' EP111-CC-CRNT-DTE                        11810004
053200       DISPLAY DPG54-ERROR-MESSAGE                                11820004
053210       MOVE 4019 TO PV-ABEND-CODE                                 11830004
053220       CALL 'ILBOABN0' USING PV-ABEND-CODE                        11840004
053230     END-IF.                                                      11850004
053240                                                                  11860004
053241     MOVE DPG55-DB2-ISO-DATE-FMT     TO EP111-CC-DATE-PLUS1.      11870004
053242                                                                  11880004
053243     INITIALIZE DPG51 DPG52 DPG53                                 11890004
053244                DPG54 DPG55 DPG56.                                11900004
053245                                                                  11910004
053246     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      11920004
053247     SET DPG51-DECREMENT-DATE       TO TRUE.                      11930004
053248     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      11940004
053249     MOVE 1                         TO DPG51-INCR-DECR-DAYS-9.    11950004
053250     MOVE EP113-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE-FMT.    11960004
053251                                                                  11970004
053252     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    11980004
053253                                             DPG54 DPG55 DPG56.   11990004
053254                                                                  12000004
053255     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  12010004
053256       DISPLAY '** ABEND **'                                      12020004
053257       DISPLAY '** PROGRAM = EPKUT354'                            12030004
053258       DISPLAY 'DATE = ' EP111-CC-CRNT-DTE                        12040004
053259       DISPLAY DPG54-ERROR-MESSAGE                                12050004
053260       MOVE 4019 TO PV-ABEND-CODE                                 12060004
053261       CALL 'ILBOABN0' USING PV-ABEND-CODE                        12070004
053262     END-IF.                                                      12080004
053263                                                                  12090004
053264     MOVE DPG55-DB2-ISO-DATE-FMT    TO EP113-CC-CRNT-DTE-MINUS1.  12100004
053265                                                                  12110004
053266     INITIALIZE DPG51 DPG52 DPG53                                 12120027
053267                DPG54 DPG55 DPG56.                                12130027
053268                                                                  12140027
053269     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      12150027
053270     SET DPG51-INCREMENT-DATE       TO TRUE.                      12160027
053271     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      12170027
053272     MOVE EP045-DAYS-TILL-STORE-OPN TO DPG51-INCR-DECR-DAYS-9.    12180027
053274     MOVE EP111-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE-FMT.    12190027
053275                                                                  12200027
053276     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    12210027
053277                                             DPG54 DPG55 DPG56.   12220027
053278                                                                  12230027
053279     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  12240027
053280       DISPLAY '** ABEND **'                                      12250027
053281       DISPLAY '** PROGRAM = EPKUT354'                            12260027
053282       DISPLAY 'DATE = ' EP111-CC-CRNT-DTE                        12270027
053283       DISPLAY DPG54-ERROR-MESSAGE                                12280027
053284       MOVE 4019 TO PV-ABEND-CODE                                 12290027
053285       CALL 'ILBOABN0' USING PV-ABEND-CODE                        12300027
053286     END-IF.                                                      12310027
053287                                                                  12320027
053288     MOVE DPG55-DB2-ISO-DATE-FMT TO EP045-CC-ADV-STR-OPN-DATE.    12330027
053290                                                                  12340027
053291*6100-EXIT.                                                       12350004
053292 EJECT.                                                           12360004
053293                                                                  12370004
053294*----------------------------------------------------------       12380004
053295* 9900-SQL-ABEND-ROUTINE.                                         12390004
053296*     SQL ABEND ROUTINE.                                          12400004
053297*----------------------------------------------------------       12410004
053298 9900-SQL-ABEND-ROUTINE.                                          12420004
053299                                                                  12430004
053300     DISPLAY '** ABEND     **'.                                   12440004
053301     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        12450004
053302     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              12460004
053303     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               12470004
053304                                                                  12480004
053305     COPY DPPD004.                                                12490004
053306     SET ABEND-4013-DB2-ERROR TO TRUE.                            12500004
053310     CALL 'ILBOABN0' USING ABEND-CODE.                            12510004
053400                                                                  12520004
053500*9900-EXIT.                                                       12530004
053600 EJECT.                                                           12540004
053700                                                                  12550004
053800*----------------------------------------------------------       12560004
053900* 9999-WRAPUP.                                                    12570004
054000*     END OF PROGRAM ROUTINE.  CLOSES ALL FILES AND DISPLAYS      12580004
054100*     ANY DATA FROM THE PROGRAM.                                  12590004
054200*----------------------------------------------------------       12600004
054300 9999-WRAPUP.                                                     12610004
055100                                                                  12620004
055200     CLOSE CONTROL-CARD-CURR-PRICG-DTE                            12630004
055300           CONTROL-CARD-FUTRE-CORR-DTE                            12640004
055310           CONTROL-CARD-PGM-CURR-TMST                             12650049
055400           CONTROL-CARD-PGM-LAST-RUN-TMST                         12660004
055500           CONTROL-CARD-CRIT-EFF-DTE                              12670004
055510           CONTROL-CARD-FUT-STR-OPN-DAY                           12680026
055600           PROMO-NIGHT-FILE.                                      12690004
055800                                                                  12700004
055900     DISPLAY ' '.                                                 12710004
056000     DISPLAY '*********************************************'.     12720004
056100     DISPLAY 'PROGRAM NAME: ' PC-CURRENT-PROGRAM-NAME.            12730004
056200     DISPLAY '*********************************************'.     12740004
056300     DISPLAY 'NUMBER OF NIGHT RECS WRITTEN: ' PC-CNT-NIGHT-RECS.  12750004
056500     DISPLAY 'NUMBER OF RECS FROM OVRD QUERY:' PC-CNT-OVRRDE-RECS.12760008
056600     DISPLAY 'NUMBER OF RECS FROM ADHC QUERY: ' PC-CNT-ADHOC-RECS.12770004
056800     DISPLAY 'ALL RECS WRITTEN: ' PC-CNT-ALL-RECS.                12780004
056900     DISPLAY '*********************************************'.     12790004
057000                                                                  12800004
057100*9999-EXIT.                                                       12810004
057200 EJECT.                                                           12820004
057300                                                                  12830004
