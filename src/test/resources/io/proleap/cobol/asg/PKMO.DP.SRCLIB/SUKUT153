000100 IDENTIFICATION DIVISION.                                         00010001
000200                                                                  00020001
000300 PROGRAM-ID.             SUKUT153.                                00030010
000400 AUTHOR.                 CHERI PARMLEY                            00040011
000500 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050011
000600 DATE-WRITTEN            NOVEMBER 2012.                           00060011
000700 DATE-COMPILED.                                                   00070011
000800***************************************************************** 00080011
000900*                                                                 00090011
001000******************************************************************00100011
001100*  MODULE TYPE: COBOL2 DB2 BATCH                                  00110011
001200*                                                                 00120011
001300*  DESCRIPTION:                                                   00130011
001400*                                                                 00140011
001500*  PROGRAM WILL CHECK IF THE STATUS OF THE TRUCK HAS BEEN OPENED. 00150011
001600*  IF SO IT WILL WRITE TO THE OUT01 FILE WHICH THEN IN NEXT STEP  00160011
001700*  GETS WRITTEN OUT TO THE REPORT PROGRAM.                        00170011
001800*  IF NOT IT WILL WRITE TO THE OUT02 FILE. THEN NEXT TIME JOB     00180011
001900*  SUK075 RUNS IT WILL BRING IN THOSE RECORDS AGAIN AND CHECK     00190011
002000*  IF THE STATUS IS OPEN.                                         00200011
002100*                                                                 00210011
002200*========================== CHANGE LOG ===========================00220011
002300*  BY        DATE     #                DESCRIPTION                00230011
002400*=================================================================00240011
002500*  C.PARMLEY 06-19-12 CRQ000000037068  CREATE PROGRAM             00250011
002600*                                                                 00260011
002700******************************************************************00270011
002800 ENVIRONMENT DIVISION.                                            00280001
002900 CONFIGURATION SECTION.                                           00290001
003000 SOURCE-COMPUTER.        IBM-3090.                                00300001
003100 OBJECT-COMPUTER.        IBM-3090.                                00310001
003200 INPUT-OUTPUT SECTION.                                            00320001
003300 FILE-CONTROL.                                                    00330001
003400                                                                  00340001
003500     SELECT INPUT-FILE                                            00350001
003600         ASSIGN TO INP01.                                         00360001
003700                                                                  00370001
003800     SELECT OUTPUT-FILE                                           00380001
003900         ASSIGN TO OUT01.                                         00390001
004000                                                                  00400001
004100     SELECT OUTPUT-FILE-NOT-SO                                    00410009
004200         ASSIGN TO OUT02.                                         00420001
004300                                                                  00430001
004400 DATA DIVISION.                                                   00440001
004500 FILE SECTION.                                                    00450001
004600                                                                  00460001
004700 FD  INPUT-FILE                                                   00470001
004800     RECORDING MODE IS F                                          00480001
004900     LABEL RECORDS ARE STANDARD                                   00490001
005000     BLOCK CONTAINS 0  RECORDS.                                   00500001
005100 01  INPUT-REC                        PIC X(200).                 00510003
005200                                                                  00520001
005300 FD  OUTPUT-FILE                                                  00530001
005400     RECORDING MODE IS F                                          00540001
005500     LABEL RECORDS ARE STANDARD                                   00550001
005600     BLOCK CONTAINS 0  RECORDS.                                   00560001
005700 01  OUTPUT-REC                       PIC X(200).                 00570001
005800                                                                  00580001
005900 FD  OUTPUT-FILE-NOT-SO                                           00590009
006000     RECORDING MODE IS F                                          00600001
006100     LABEL RECORDS ARE STANDARD                                   00610001
006200     BLOCK CONTAINS 0  RECORDS.                                   00620001
006300 01  OUTPUT-REC-NOT-SO                PIC X(200).                 00630009
006400                                                                  00640001
006500 WORKING-STORAGE SECTION.                                         00650001
006600 01  PS-SWITCHES.                                                 00660001
006700     05  PS-EOF-EXTRACT-SW            PIC X(01) VALUE 'N'.        00670001
006800         88  PS-EOF-EXTRACT-YES                 VALUE 'Y'.        00680001
006900     05  PS-OPEN-STATUS-SW            PIC X(01) VALUE 'N'.        00690001
007000         88  PS-OPEN-STATUS                     VALUE 'Y'.        00700001
007100         88  PS-NOT-OPEN-STATUS                 VALUE 'N'.        00710001
007200                                                                  00720001
007300 01  PROGRAM-VARIABLES.                                           00730001
007400     05  PV-DISP-NBR                  PIC Z,ZZZ,ZZ9.              00740001
007500     05  PV-ABEND-CODE                PIC S9(04) VALUE ZERO       00750001
007600                                                 COMP SYNC.       00760001
007700         88  ABEND-4013-DB2-ERROR                VALUE +4013.     00770001
007800     05  PV-INPUT-COUNT               PIC S9(09) COMP-3           00780001
007900                                          VALUE ZERO.             00790001
008000     05  PV-ABEND-PARAGRAPH           PIC X(35) VALUE SPACES.     00800001
008100     05  PV-CURRENT-TMST              PIC X(26) VALUE SPACES.     00810001
008200                                                                  00820001
008300     COPY SURD105.                                                00830001
008400                                                                  00840001
008500***DB2 ABEND COPYBOOK                                             00850001
008600     COPY DPWS900.                                                00860001
008700                                                                  00870001
008800                                                                  00880001
008900     EXEC SQL                                                     00890001
009000         INCLUDE TSUOBTS                                          00900001
009100     END-EXEC.                                                    00910001
009200                                                                  00920001
009300     EXEC SQL                                                     00930001
009400         INCLUDE SQLCA                                            00940001
009500     END-EXEC.                                                    00950001
009600                                                                  00960001
009700     COPY SQLCA2.                                                 00970001
009800     COPY DPWS004.                                                00980001
009900 EJECT                                                            00990001
010000/                                                                 01000001
010100 PROCEDURE DIVISION.                                              01010001
010200     PERFORM 1000-INITIALIZE.                                     01020001
010300     PERFORM 2000-PROCESS                                         01030001
010400             UNTIL PS-EOF-EXTRACT-YES                             01040001
010500     PERFORM 9000-EOJ.                                            01050001
010600                                                                  01060001
010700     GOBACK.                                                      01070001
010800                                                                  01080001
010900 1000-INITIALIZE.                                                 01090001
011000                                                                  01100001
011100     OPEN INPUT INPUT-FILE.                                       01110001
011200     OPEN OUTPUT OUTPUT-FILE                                      01120001
011300                 OUTPUT-FILE-NOT-SO.                              01130009
011400                                                                  01140001
011500     EXEC SQL                                                     01150001
011600         SET :PV-CURRENT-TMST = CURRENT TIMESTAMP                 01160001
011700     END-EXEC.                                                    01170001
011800                                                                  01180001
011900     PERFORM 8000-READ-EXTRACT-FILE.                              01190001
012000     IF PS-EOF-EXTRACT-YES                                        01200001
012100         DISPLAY ' SUKUT153 - INPUT FILE IS EMPTY '               01210001
012200     ELSE                                                         01220001
012300         PERFORM 2300-GET-TRUCK-STATUS                            01230001
012400         IF PS-OPEN-STATUS                                        01240001
012500             PERFORM 8100-WRITE-OUTPUT-FILE                       01250001
012600         ELSE                                                     01260001
012700             PERFORM 8200-WRITE-NOT-SO-FILE                       01270009
012800         END-IF                                                   01280001
012900     END-IF.                                                      01290001
013000                                                                  01300001
013100 2000-PROCESS.                                                    01310001
013200                                                                  01320001
013300     PERFORM 8000-READ-EXTRACT-FILE.                              01330001
013400     IF PS-EOF-EXTRACT-YES                                        01340001
013500         DISPLAY ' SUKUT153 - END OF INPUT FILE '                 01350002
013600     ELSE                                                         01360001
013700         PERFORM 2300-GET-TRUCK-STATUS                            01370002
013800         IF PS-OPEN-STATUS                                        01380005
013900             PERFORM 8100-WRITE-OUTPUT-FILE                       01390005
014000         ELSE                                                     01400005
014100             PERFORM 8200-WRITE-NOT-SO-FILE                       01410009
014200         END-IF                                                   01420005
014300     END-IF.                                                      01430001
014400                                                                  01440001
014500***********************************************************       01450001
014600*    CHECK FOR OPEN TRUCK STATUS 'SO'                     *       01460001
014700***********************************************************       01470001
014800 2300-GET-TRUCK-STATUS.                                           01480001
014900                                                                  01490001
015000     MOVE '2300-GET-TRUCK-STATUS'     TO PV-ABEND-PARAGRAPH.      01500001
015100                                                                  01510001
015200     MOVE SU105-OTBND-TRIP-ID        TO SUOBTS-OTBND-TRIP-ID.     01520001
015500     EXEC SQL                                                     01550001
015600       SELECT A.OTBND_TRIP_ID                                     01560011
015700         INTO :SUOBTS-OTBND-TRIP-ID                               01570001
015800         FROM TSUOBTS A                                           01580011
015900        WHERE                                                     01590001
016000              A.OTBND_TRIP_ID       = :SUOBTS-OTBND-TRIP-ID       01600011
016100          AND A.TRIP_STAT_CDE       = 'SO'                        01610011
016110          AND A.OTBND_STAT_TMST IN                                01611011
016120              (SELECT MAX(B.OTBND_STAT_TMST)                      01612011
016130                 FROM TSUOBTS B                                   01613011
016140                WHERE A.OTBND_TRIP_ID  =  B.OTBND_TRIP_ID         01614011
016150                  AND B.TRIP_STAT_CDE  = 'SO')                    01615011
016200     END-EXEC.                                                    01620001
016300                                                                  01630001
016400     EVALUATE TRUE                                                01640001
016500         WHEN SQLCODE = 0                                         01650001
016600*             ITS OPEN NEEDS TO GET WRITTEN TO FILE FOR RPT       01660001
016700              SET PS-OPEN-STATUS           TO TRUE                01670001
016900        WHEN SQLCODE = 100                                        01690001
017000*             ITS NOT OPEN NEEDS TO GET WRITTEN TO GDG FILE       01700001
017100*             FOR NEXT TIME COMBINED INPUT                        01710001
017200              SET PS-NOT-OPEN-STATUS       TO TRUE                01720001
017800        WHEN SQLCODE NOT EQUAL ZERO                               01780001
017900             DISPLAY '**************************************'     01790001
018000             DISPLAY '2300-ERROR ISSUED ON TSUOBTS TABLE    '     01800001
018100             DISPLAY 'TRIP ID = ' SU105-OTBND-TRIP-ID             01810001
018200             DISPLAY '**************************************'     01820001
018300             PERFORM 9900-SQL-ERROR                               01830001
018400     END-EVALUATE.                                                01840001
018500                                                                  01850001
018600 8000-READ-EXTRACT-FILE.                                          01860001
018700                                                                  01870001
018800     READ INPUT-FILE                                              01880003
018900         INTO SU105-INPUT-RECORD                                  01890001
019000     AT END                                                       01900001
019100         SET PS-EOF-EXTRACT-YES       TO TRUE                     01910001
019200     NOT AT END                                                   01920001
019300         ADD 1                        TO PV-INPUT-COUNT           01930001
019400     END-READ.                                                    01940001
019500                                                                  01950001
019600**************************************************************    01960001
019700* WRITES TO FILE WHICH IS USED TO PRINT REPORT IN SUKRP065   *    01970001
019800**************************************************************    01980001
019900 8100-WRITE-OUTPUT-FILE.                                          01990001
020000                                                                  02000001
020100     WRITE OUTPUT-REC                                             02010001
020200         FROM SU105-INPUT-RECORD.                                 02020001
020300                                                                  02030001
020400**************************************************************    02040001
020500* WRITES TO FILE WHICH WILL BE READ BACK IN TO PROCESS FOR   *    02050001
020600* NEXT TIME TO SEE IF ITS OPEN YET                           *    02060001
020700**************************************************************    02070001
020800 8200-WRITE-NOT-SO-FILE.                                          02080009
020900                                                                  02090001
021000     WRITE OUTPUT-REC-NOT-SO                                      02100009
021100         FROM SU105-INPUT-RECORD.                                 02110001
021200                                                                  02120001
021300 9000-EOJ.                                                        02130001
021400                                                                  02140001
021500     CLOSE      INPUT-FILE                                        02150001
021600                OUTPUT-FILE                                       02160001
021700                OUTPUT-FILE-NOT-SO.                               02170009
021800                                                                  02180001
021900     DISPLAY SPACES.                                              02190001
022000     DISPLAY ' SUKUT153'                                          02200001
022100     DISPLAY SPACES.                                              02210001
022200     MOVE PV-INPUT-COUNT              TO PV-DISP-NBR              02220001
022300     DISPLAY 'INPUTS READ   = ' PV-DISP-NBR.                      02230001
022400                                                                  02240001
022500 9800-SQL-WARNING.                                                02250001
022600                                                                  02260001
022700     MOVE SQLCODE               TO SQLCODE2.                      02270001
022800     MOVE SQLERRD(3)            TO SQLERRD3.                      02280001
022900     DISPLAY '** ABEND **       ** = SQLWARNING'.                 02290001
023000     DISPLAY '** PROGRAM        ** = SUKUT153'.                   02300001
023100     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.        02310001
023200     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  02320001
023300     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  02330001
023400                                                                  02340001
023500     COPY DPPD004.                                                02350001
023600     SET ABEND-4013-DB2-ERROR   TO TRUE                           02360001
023700     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02370001
023800                                                                  02380001
023900 9900-SQL-ERROR.                                                  02390001
024000                                                                  02400001
024100     MOVE SQLCODE               TO SQLCODE2.                      02410001
024200     MOVE SQLERRD(3)            TO SQLERRD3.                      02420001
024300     DISPLAY '** ABEND **       ** = SQLERROR'.                   02430001
024400     DISPLAY '** PROGRAM        ** = SUKUT153'.                   02440001
024500     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.        02450001
024600     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  02460001
024700                                                                  02470001
024800     COPY DPPD004.                                                02480001
024900     SET ABEND-4013-DB2-ERROR   TO TRUE                           02490001
025000     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02500001
