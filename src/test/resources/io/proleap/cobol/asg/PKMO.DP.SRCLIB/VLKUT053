000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.             VLKUT046.                                00020041
000300 AUTHOR.                 KRITIVEEN KUSHAL.                        00030041
000400 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00040000
000500 DATE-WRITTEN.           MAR 2019.                                00050041
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800******************************************************************00080000
001700*  PROGRAM NARRATIVE:                                             00170000
002500*  BEFORE THE PROCESSING FOR THE AP FILE IS DONE IN NEXT STEP     00250029
      *  OF THIS JOB THE INPUT FILE IS PROCESSED IN THIS PROGRAM TO     00251029
002600*  ADD UP THE NUMBER OF RECORDS AND THE SENT AMOUNTS.             00260029
002700*  THESE AMOUNTS ARE THEN COMPARED TO WHAT CMS SENT ON THE        00270029
002800*  CONTROL RECORD.IF ALL MATCH THEN PROCESSING CAN CONTINUE IN    00280029
002900*  THE NEXT STEP OF THE OF THE JOB,OTHERWISE PROGRAM WILL ABEND.  00290029
003000*                                                                 00300029
006900*    CC-CONTROL-CARD         FORMAT   BYTES                       00690000
007000*    _______________________________________                      00700000
007100*     CC-SCHEDULE-DATE       CCYYMMDD  1:8                        00710000
007200*     CC-DISP-PO-DETAILS      Y/N      9:1                        00720000
007300*     CC-DISP-PO-SUMMARY      Y/N     10:1                        00730000
007400*     CC-DISP-PRORATE-CALL    Y/N     11:1                        00740000
007500*     CC-TYPE-RUN            PO/FR    13:2                        00750000
007600*                                                                 00760000
007700*  NOTE: THE LAST 3 BYTES OF THE CONTROL CARD CAN BE USED TO      00770000
007800*        TURN THE SYSOUT DISPLAYS ON OR OFF                       00780000
007900*                                                                 00790000
011600******************************************************************01220000
011700/                                                                 01230000
011800 ENVIRONMENT DIVISION.                                            01240000
011900                                                                  01250000
012000 CONFIGURATION SECTION.                                           01260000
012100                                                                  01270000
012200 SOURCE-COMPUTER.                        IBM-3090.                01280000
012300 OBJECT-COMPUTER.                        IBM-3090.                01290000
012400                                                                  01300000
012500 INPUT-OUTPUT SECTION.                                            01310000
012600                                                                  01320000
012700 FILE-CONTROL.                                                    01330000
012800                                                                  01340000
012900     SELECT  CMS-EXT-FILE                                         01350000
013000         ASSIGN TO INP01.                                         01360000
013100                                                                  01370000
P47422     SELECT  CMS-WRAP-RECORD-FILE                                 01380032
P47422         ASSIGN TO INP02.                                         01390032
014000*                                                                 01520024
014100******************************************************************01530000
014200 DATA DIVISION.                                                   01540000
014300******************************************************************01550000
014400                                                                  01560000
014500 FILE SECTION.                                                    01570000
014600*                                                                 01580000
014700 FD  CMS-EXT-FILE                                                 01590000
014800     RECORDING MODE IS F                                          01600000
014900     LABEL RECORDS ARE STANDARD                                   01610000
015000     BLOCK CONTAINS 0 RECORDS.                                    01620000
015100 01  CMS-EXTRACT-RECORD               PIC  X(275).                01630000
015200*                                                                 01640000
P47422 FD  CMS-WRAP-RECORD-FILE                                         01650032
P47422     RECORDING MODE IS F                                          01660032
P47422     LABEL RECORDS ARE STANDARD                                   01670032
P47422     BLOCK CONTAINS 0 RECORDS.                                    01680032
P47422 01  CMS-EXTRACT-WRAP-RECORD          PIC  X(275).                01690032
P47422                                                                  01700000
017000*                                                                 01950024
017100 WORKING-STORAGE SECTION.                                         01960000
017200 01  ABEND-CODE                       PIC S9(04) VALUE ZERO       01970000
017300                                                 COMP SYNC.       01980000
017400     88  AC-BAD-WRITE                        VALUE +4001.         01990000
017500     88  AC-CONTROL-CARD-ERROR               VALUE +4003.         02000000
017600     88  AC-OPEN-ERROR                       VALUE +4005.         02010000
017700     88  AC-CLOSE-ERROR                      VALUE +4006.         02020000
017800     88  AC-BAD-DATA                         VALUE +4008.         02030000
018000     88  AC-UNSUCCESSFUL-SELECT              VALUE +4015.         02050000
018100     88  AC-MAX-RETRIES-EXCEEDED             VALUE +4016.         02060000
018200     88  AC-DATE-ERROR                       VALUE +4019.         02070000
018300 01  ABEND-AREAS.                                                 02080000
018400     05  AA-ABEND-LIT            PIC  X(40)  VALUE                02090000
018500             '*****       ABEND'.                                 02100000
018600     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                02110000
018700             '*****   PROGRAM: VLKUT046'.                         02120041
018800     05  AA-PARAGRAPH-LIT.                                        02130000
018900         10  FILLER              PIC  X(17)  VALUE                02140000
019000             '***** PARAGRAPH: '.                                 02150000
019100         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        02160000
019200     05  AA-MESSAGE-LINE.                                         02170000
019300         10  FILLER              PIC  X(06)  VALUE '*****'.       02180000
019400         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        02190000
019500         10  FILLER REDEFINES AA-MESSAGE.                         02200000
019600             15 AA-MESSAGE-1     PIC  X(45).                      02210000
019700             15 AA-MESSAGE-2     PIC  X(45).                      02220000
019800             15 AA-MESSAGE-3     PIC  X(37).                      02230000
019900                                                                  02240000
020000 01  CC-CONTROL-CARD.                                             02250000
020100     05  CC-SCHEDULE-DATE.                                        02260000
020200         10  CC-CCYY                 PIC X(04).                   02270000
020300         10  CC-MM                   PIC X(02).                   02280000
020400         10  CC-DD                   PIC X(02).                   02290000
020500     05  CC-DISP-PO-DETAILS          PIC X(01).                   02300000
020600     05  CC-DISP-PO-SUMMARY          PIC X(01).                   02310000
020700     05  CC-DISP-PRORATE-CALL        PIC X(01).                   02320000
020800     05  FILLER                      PIC X(01).                   02330000
020900     05  CC-TYPE-RUN                 PIC X(02).                   02340000
021000     05  FILLER                      PIC X(66).                   02350000
021100                                                                  02360000
021200 01  SD-SYSTEM-DATE.                                              02370000
021300     05  SD-SYSTEM-YEAR                  PIC  9(02)  VALUE ZEROS. 02380000
021400     05  SD-SYSTEM-MONTH                 PIC  9(02)  VALUE ZEROS. 02390000
021500     05  SD-SYSTEM-DAY                   PIC  9(02)  VALUE ZEROS. 02400000
021600                                                                  02410000
021700 01  ST-SYSTEM-TIME-DATE-AREA.                                    02420000
021800     05  ST-ABSTIME                      PIC S9(16)  VALUE +0     02430000
021900                                                     COMP SYNC.   02440000
022000     05  ST-SYSTEM-TIME.                                          02450000
022100         10  ST-HHMMSS-FORMAT            PIC  X(08)  VALUE SPACES.02460000
022200         10  FILLER  REDEFINES  ST-HHMMSS-FORMAT.                 02470000
022300             15  ST-SYSTEM-HOUR          PIC  X(02).              02480000
022400             15  FILLER                  PIC  X(01).              02490000
022500             15  ST-SYSTEM-MINUTE        PIC  X(02).              02500000
022600             15  FILLER                  PIC  X(01).              02510000
022700             15  ST-SYSTEM-SECOND        PIC  X(02).              02520000
022800                                                                  02530000
022900 01  PC-CONSTANTS.                                                02540000
023000     05  PC-CURRENT-PGM-VLKUT046      PIC  X(08) VALUE 'VLKUT046'.02550041
023200     05  PC-Y                         PIC  X(01) VALUE 'Y'.       02570000
023300     05  PC-CORPORATE                 PIC S9(04) VALUE  +090      02580000
023400                                                        COMP SYNC.02590000
023500 01  PS-SWITCHES.                                                 02600000
023600     05  PS-END-INPUT-SWITCH          PIC  X(01) VALUE 'N'.       02610000
023700         88  PS-END-INPUT                        VALUE 'Y'.       02620000
023800         88  PS-NOT-END-INPUT                    VALUE 'N'.       02630000
023900     05  PS-AMOUNTS-MATCH-SWITCH      PIC  X(01) VALUE 'Y'.       02640000
024000         88  PS-AMOUNTS-MATCH                    VALUE 'Y'.       02650000
024100         88  PS-AMOUNTS-NOT-MATCH                VALUE 'N'.       02660000
P47422     05  PS-INPUT-FILE-SW             PIC  X(01) VALUE 'N'.       02790000
P47422         88  PS-INPUT-I01-YES                    VALUE 'Y'.       02800000
P47422         88  PS-INPUT-I01-NO                     VALUE 'N'.       02810000
P47422     05  PS-END-OF-WRAP-RECS-SW       PIC  X(01) VALUE 'N'.       02850000
P47422         88  PS-END-OF-WRAP-RECS                 VALUE 'Y'.       02860000
P47422         88  PS-NOT-END-OF-WRAP-RECS             VALUE 'N'.       02870000
025400                                                                  02880000
026200                                                                  02960000
026300 01  PA-ACCUMULATORS.                                             02970000
026800     05  PA-TOTAL-CHARGES             PIC S9(11)V99 VALUE +0.     03030000
P47422     05  PA-TOTAL-WRAP-CHARGES        PIC S9(11)V99 VALUE +0.     03040000
027100     05  PA-TOTAL-CREDITS             PIC S9(11)V99 VALUE +0.     03070000
P47422     05  PA-TOTAL-WRAP-CREDITS        PIC S9(11)V99 VALUE +0.     03080000
028600                                                                  03230000
028700 01  PV-VARIABLES.                                                03240000
031200     05  PV-PROCESS-DATE              PIC X(10) VALUE SPACES.     03490029
032600     05  PV-READ-COUNT                PIC S9(07)    VALUE +0.     03630000
P47422     05  PV-WRAP-READ-COUNT           PIC S9(07)    VALUE +0.     03640000
032700***  THESE ARE TALLIED IN THE PROGRAM                             03660000
032800***  PV-COMPARE-DOLLAR-AMT = CHARGES + CREDITS (NET AMT = GRS AMT)03670000
032900     05  PV-COMPARE-TOTALS.                                       03680000
033000         10  PV-COMPARE-REC-CNT       PIC S9(11)    VALUE +0.     03690000
033100         10  PV-COMPARE-DOLLAR-AMT    PIC S9(11)V99 VALUE +0.     03700000
033200         10  PV-COMPARE-CHARGE-AMT    PIC S9(11)V99 VALUE +0.     03710000
033300         10  PV-COMPARE-CREDIT-AMT    PIC S9(11)V99 VALUE +0.     03720000
033400***  THESE ARE SENT FROM CMS AS VALUES IN THE FIRST REC OF INPUT  03730000
033500***  THE FIRST RECORD OF THE INPUT IS THE CONTROL RECORD.         03740000
033600     05  PV-CMS-CTL-TOTALS.                                       03750000
033700         10  PV-CMS-CTL-REC-CNT-TOT   PIC S9(11)    VALUE +0.     03760000
033800         10  PV-CMS-CTL-REC-CNT       PIC S9(11)    VALUE +0.     03770000
033900         10  PV-CMS-CTL-CHARGE-AMT    PIC S9(11)V99 VALUE +0.     03780000
034000         10  PV-CMS-CTL-CREDIT-AMT    PIC S9(11)V99 VALUE +0.     03790000
034100                                                                  03800000
034900     05  PV-DISP-NUMBER               PIC  ZZ,ZZZ,ZZZ,ZZ9.        03880000
035000     05  PV-DISP-DOLLAR               PIC  ZZ,ZZZ,ZZZ,ZZ9.99-.    03890000
035100     05  PV-RUN-TIME                  PIC  X(08) VALUE SPACES.    03900000
035400                                                                  03930000
036100                                                                  04000000
036200     05  PV-FIELD-SIGNS               PIC  X(01) VALUE ' '.       04010000
036300         88  PV-VALID-SIGNS                VALUE ' ', '-'.        04020000
036400         88  PV-POSITIVE                   VALUE ' '.             04030000
036500         88  PV-NEGATIVE                   VALUE '-'.             04040000
036600                                                                  04050000
055400                                                                  06040000
055500*** COPYBOOK FOR FILE FROM CMS                                    06050000
055600     COPY VLRD049.                                                06060000
056300                                                                  06130000
056400*** COPYBOOK FOR CALENDAR ROUTINE                                 06140000
056500     COPY DPWS500.                                                06150000
056600                                                                  06160000
056700*** COPYBOOK FOR NUMERIC EDIT ROUTINE                             06170000
056800     COPY DPWS010I.                                               06180000
056900                                                                  06190000
063400 LINKAGE SECTION.                                                 06910000
063500                                                                  06920000
063600 PROCEDURE DIVISION.                                              06930000
063700                                                                  06940000
063800 0000-MAINLINE.                                                   06950000
063900     PERFORM 1000-INITIALIZE.                                     06960028
           PERFORM 2000-COMPARE-AMOUNTS.                                06961028
064500     GOBACK.                                                      07060027
064600                                                                  07070000
064700 1000-INITIALIZE.                                                 07080000
064800     ACCEPT CC-CONTROL-CARD FROM SYSIN.                           07090000
064900                                                                  07100000
065000     DISPLAY '*********************************************'      07110000
065100     DISPLAY '*******  CONTROL CARD ====>  ' CC-CONTROL-CARD.     07120000
065200                                                                  07130000
067900*****TIME IS CONTAINED WITHIN CURRENT-DATE IN POSITION 9 FOR 8    07400000
068000     MOVE FUNCTION CURRENT-DATE(9:8) TO PV-RUN-TIME.              07410000
068100                                                                  07420000
068200     DISPLAY '*******  RUN TIME ====> '  PV-RUN-TIME.             07430000
068300     DISPLAY '*********************************************'      07440000
068400     DISPLAY ' '.                                                 07450000
068500 2000-COMPARE-AMOUNTS.                                            07460028
068600***** BEFORE CREATING AN AP FILE, DETAIL RECORDS WILL BE TOTALED  07470000
068700***** IF RECORD COUNTS, FRGT CHARGE AMT AND REVERSAL AMOUNTS ON   07480000
068800***** THE CONTROL RECORD MATCH, PROCESSING CAN CONTINUE,          07490000
068900***** ELSE ABEND.                                                 07500000
069000     OPEN INPUT CMS-EXT-FILE.                                     07510000
P47422     OPEN INPUT CMS-WRAP-RECORD-FILE.                             07520032
069100                                                                  07540000
069600     MOVE 0 TO  PV-COMPARE-REC-CNT                                07590029
069700                PV-COMPARE-DOLLAR-AMT                             07600029
069800                PV-COMPARE-CHARGE-AMT                             07610029
069900                PV-COMPARE-CREDIT-AMT.                            07620029
070100                                                                  07640000
P47422     INITIALIZE PV-WRAP-READ-COUNT.                               07650032
P47422                                                                  07660030
P47422     SET PS-INPUT-I01-NO          TO TRUE.                        07670032
P47422     PERFORM 8700-READ-INPUT-I02.                                 07680032
P47422     MOVE CMS-EXTRACT-WRAP-RECORD TO                              07690032
P47422          VL049-AP-INTERFACE-RECORD.                              07700032
P47422     IF PS-NOT-END-OF-WRAP-RECS                                   07710032
P47422        PERFORM 1100-CHECK-INPUT                                  07730032
P47422             UNTIL PS-END-OF-WRAP-RECS                            07740032
P47422     END-IF.                                                      07750032
P47422     SET PS-INPUT-I01-YES                                         07760033
P47422         PS-NOT-END-OF-WRAP-RECS  TO TRUE.                        07770032
P47422     CLOSE CMS-WRAP-RECORD-FILE.                                  07780032
P47422     OPEN INPUT CMS-WRAP-RECORD-FILE.                             07790032
P47422     INITIALIZE PV-WRAP-READ-COUNT.                               07800032
P47422     PERFORM 8700-READ-INPUT-I02.                                 07810032
070200     PERFORM 8000-READ-INPUT.                                     07820000
070300     IF PS-NOT-END-INPUT                                          07830000
070400         IF VL049-CONTROL-RECORD AND                              07840000
070500             VL049-CTL-RECORD-COUNT = 0                           07850000
070600******* THIS MEANS THERE WERE NO CHARGES OR CREDITS. CMS SENT     07860000
070700******* ONLY CONTROL RECORD WITH A ZERO RECORD COUNT              07870000
070800******* CMS WILL ALWAYS SEND AT LEAST A CONTROL RECORD, THEY WILL 07880000
070900******* NEVER SEND TOTALLY EMPTY FILE.  IF THAT HAPPENS IT'S A    07890000
071000******* PROBLEM ON THEIR SIDE.                                    07900000
071100             SET PS-END-INPUT TO TRUE                             07910000
P47422          IF PS-END-OF-WRAP-RECS                                  07920000
P47422             CLOSE CMS-EXT-FILE                                   07930000
071400             DISPLAY '*****************************************'  07950000
071500             DISPLAY '*************   EMPTY   FILE  ***********'  07960000
071600             DISPLAY '** PROGRAM = VLKUT046                    '  07970041
071700             DISPLAY '** PARAGRAPH = 1000-INITIALIZE           '  07980000
071800             DISPLAY '** NO CHARGES OR CREDITS OUT01   EMPTY   '  07990044
071900             DISPLAY '*****************************************'  08000000
P47422          END-IF                                                  08010000
072000         ELSE                                                     08050000
072100             PERFORM 1100-CHECK-INPUT                             08060000
072200                 UNTIL PS-END-INPUT                               08070000
072300             PERFORM 1350-CHECK-TOTALS                            08080000
072400             IF PS-AMOUNTS-MATCH                                  08090000
072500                 CLOSE CMS-EXT-FILE                               08100034
                       CMS-WRAP-RECORD-FILE                             08101036
076400             END-IF                                               08101141
076500         END-IF                                                   08101241
076600     ELSE                                                         08102035
076700******* THIS MEANS A VERY BAD ERROR ON CN SIDE --                 08103035
076800******* ONLY THEY CAN DETERMINE WHY A COMPLETELY EMPTY FILE CAME  08104035
076900         DISPLAY '***********************************************'08105035
077000         DISPLAY '*************   EMPTY   FILE   ****************'08106035
077100         DISPLAY '** ABEND                                       '08107035
077200         DISPLAY '** PROGRAM = VLKUT046                          '08108041
077300         DISPLAY '** PARAGRAPH = 1000-INITIALIZE                 '08109035
077400         DISPLAY '** THIS IS VERY BAD ERROR ON THE SIDE OF CN    '08110035
077500         DISPLAY '** NO CHARGES OR CREDITS -- OUT01 WILL BE EMPTY'08120035
077600         DISPLAY '***********************************************'08130035
077700         CLOSE CMS-EXT-FILE                                       08140035
077800         MOVE +4008 TO ABEND-CODE                                 08150035
077900         CALL 'ILBOABN0' USING ABEND-CODE                         08160035
078000     END-IF.                                                      08170035
078100                                                                  08180035
081000******************************************************************08950000
081100*    BEFORE DOING ANY PROCESSING SPIN THROUGH THE INPUT FILE      08960000
081200*      ADDING THE AMOUNT FIELDS. IF THE TOTALS MATCH WHAT IS ON   08970000
081300*      THE CONTROL RECORD FROM CMS, PROCESSING CAN CONTINUE TO    08980000
081400*      CREATE THE AP FILE.  WE DON'T WANT TO PASS A FILE TO AP IF 08990000
081500*      THE AMOUNTS DON'T MATCH.  THE DISCREPANCY MUST BE CORRECTED09000000
081600*      BEFORE A FILE CAN BE SENT.                                 09010000
081700******************************************************************09020000
081800 1100-CHECK-INPUT.                                                09030000
081900     EVALUATE TRUE                                                09040000
082000         WHEN VL049-DETAIL-RECORD                                 09050000
082100             PERFORM 1200-ADD-AMOUNTS                             09060000
082200         WHEN VL049-CONTROL-RECORD                                09070000
082300             PERFORM 1300-CTL-REC                                 09080000
082400     END-EVALUATE.                                                09090000
082500                                                                  09100000
082600     INITIALIZE VL049-AP-INTERFACE-RECORD.                        09110000
082700                                                                  09120000
P47422     IF PS-INPUT-I01-YES                                          09130034
P47422        PERFORM 8000-READ-INPUT                                   09140000
P47422     ELSE                                                         09150034
P47422        PERFORM 8700-READ-INPUT-I02                               09160034
P47422        MOVE CMS-EXTRACT-WRAP-RECORD TO                           09170034
P47422             VL049-AP-INTERFACE-RECORD                            09180034
P47422     END-IF.                                                      09190000
082900                                                                  09200000
083000******************************************************************09210000
083100*    ADD FRGT CHARGE AMOUNT TO TOTALS                             09220000
083200*                                                                 09230000
083300******************************************************************09240000
083400 1200-ADD-AMOUNTS.                                                09250000
083500                                                                  09260000
083600     MOVE VL049-CHRG-SIGN TO PV-FIELD-SIGNS                       09270000
083700     EVALUATE TRUE                                                09280000
083800         WHEN PV-POSITIVE                                         09290000
083900             COMPUTE PV-COMPARE-CREDIT-AMT                        09300000
084000                              = VL049-CHRG-AMT * +1               09310000
P47422         IF PS-INPUT-I01-YES                                      09320000
P47422             ADD PV-COMPARE-CREDIT-AMT TO                         09330000
P47422                 PA-TOTAL-CREDITS                                 09340000
P47422         ELSE                                                     09350000
P47422             ADD PV-COMPARE-CREDIT-AMT TO                         09360000
P47422                 PA-TOTAL-WRAP-CREDITS                            09370000
P47422         END-IF                                                   09380000
084200         WHEN PV-NEGATIVE                                         09390000
084300             COMPUTE PV-COMPARE-CHARGE-AMT                        09400000
084400                              = VL049-CHRG-AMT * -1               09410000
P47422         IF PS-INPUT-I01-YES                                      09420000
P47422             ADD PV-COMPARE-CHARGE-AMT TO                         09430000
P47422                 PA-TOTAL-CHARGES                                 09440000
P47422         ELSE                                                     09450000
P47422             ADD PV-COMPARE-CHARGE-AMT TO                         09460000
P47422                 PA-TOTAL-WRAP-CHARGES                            09470000
P47422         END-IF                                                   09480000
084600     END-EVALUATE.                                                09490000
084700                                                                  09500000
084800******************************************************************09510000
084900*  GET THE INPUT FREIGHT CHARGE & CREDIT AMOUNTS INTO THEIR       09520000
085000*  REPSECTIVE COPYBOOK FIELDS.                                    09530000
085100******************************************************************09540000
085200 1300-CTL-REC.                                                    09550000
085300                                                                  09560000
085400***  WE NEED TO HAVE THE CHARGE AMOUNT SIGNED                     09570000
085500***  CMS CANNOT PROVIDE SIGNED PACKED DATA, SO WE HAVE TO DO IT   09580000
085600     MOVE VL049-CTL-FRGT-CHRG-SIGN TO PV-FIELD-SIGNS.             09590000
085700     EVALUATE TRUE                                                09600000
085800         WHEN PV-NEGATIVE                                         09610000
085900             COMPUTE PV-CMS-CTL-CHARGE-AMT                        09620000
086000                              = VL049-CTL-FRGT-CHRG-AMT * -1      09630000
086100     END-EVALUATE.                                                09640000
086200                                                                  09650000
086300***  WE NEED TO HAVE THE REVERSAL (CREDIT) AMOUNT SIGNED          09660000
086400***  CMS CANNOT PROVIDE SIGNED PACKED DATA, SO WE HAVE TO DO IT   09670000
086500     MOVE VL049-CTL-REVERSAL-SIGN TO PV-FIELD-SIGNS.              09680000
086600     EVALUATE TRUE                                                09690000
086700         WHEN PV-POSITIVE                                         09700000
086800             COMPUTE PV-CMS-CTL-CREDIT-AMT                        09710000
086900                              = VL049-CTL-REVERSAL-AMT * +1       09720000
087000     END-EVALUATE.                                                09730000
087100                                                                  09740000
087200***  MOVE THE INPUT TOTAL REC COUNT TO HOLD FIELD                 09750000
087300     COMPUTE PV-CMS-CTL-REC-CNT-TOT = VL049-CTL-RECORD-COUNT * +1.09760000
087400                                                                  09770000
087500******************************************************************09780000
087600*  CHECK THE CONTROL RECORD FROM CMS TO WHAT WAS CALCULATED HERE  09790000
087700******************************************************************09800000
087800 1350-CHECK-TOTALS.                                               09810000
087900                                                                  09820000
088000***  CONTROL RECORD IS SUBTRACTED FROM THE RECORDS READ LEAVING   09830000
088100***  ONLY THE NBR OF DETAIL RECORDS READ                          09840000
088200     COMPUTE PV-COMPARE-REC-CNT = PV-COMPARE-REC-CNT - +1.        09850000
088300                                                                  09860000
088400***  THIS FIELD IS THE INPUT TOT REC COUNT MINUS 1 CONTROL REC    09870000
088500***  LEAVING THE TOT DETAILS SENT AS INPUT                        09880000
088600     COMPUTE PV-CMS-CTL-REC-CNT = PV-CMS-CTL-REC-CNT-TOT - +1.    09890000
088700                                                                  09900000
088800***  THIS IS THE TOTAL OF THE INPUT CHARGES AND CREDITS           09910000
088900***  THAT WERE TALLIED AS THEY WERE READ - WHICH WILL NEED        09920000
089000***  TO MATCH THE TOTAL CHARGES & TOTAL CREDITS SENT ON THE       09930000
089100***  CONTROL RECORD                                               09940000
089200     COMPUTE PV-COMPARE-DOLLAR-AMT = PA-TOTAL-CHARGES             09950000
089300                                            + PA-TOTAL-CREDITS.   09960000
089400                                                                  09970000
089500     DISPLAY '*********************************************'      09980000
089600         MOVE PV-CMS-CTL-REC-CNT         TO PV-DISP-NUMBER        09990000
089700         DISPLAY '** CMS REC CNT:  ' PV-DISP-NUMBER               10000000
089800         MOVE PV-COMPARE-REC-CNT         TO PV-DISP-NUMBER        10010000
089900         DISPLAY '** KOHLS REC CNT:  ' PV-DISP-NUMBER             10020000
090000         MOVE PV-CMS-CTL-CHARGE-AMT      TO PV-DISP-DOLLAR        10030000
090100         DISPLAY '** CMS FRGT AMT: ' PV-DISP-DOLLAR               10040000
090200         MOVE PA-TOTAL-CHARGES          TO PV-DISP-DOLLAR         10050000
090300         DISPLAY '** KOHLS FRGT AMT: ' PV-DISP-DOLLAR             10060000
P47422         MOVE PA-TOTAL-WRAP-CHARGES      TO PV-DISP-DOLLAR        10070000
P47422         DISPLAY '** KOHLS WRAP FRGT AMT : ' PV-DISP-DOLLAR       10080000
090400         MOVE PV-CMS-CTL-CREDIT-AMT      TO PV-DISP-DOLLAR        10090000
090500         DISPLAY '** CMS REVERSAL AMT: ' PV-DISP-DOLLAR           10100000
090600         MOVE PA-TOTAL-CREDITS           TO PV-DISP-DOLLAR        10110000
090700         DISPLAY '** KOHLS CREDIT AMT: ' PV-DISP-DOLLAR           10120000
P47422         MOVE PA-TOTAL-WRAP-CREDITS      TO PV-DISP-DOLLAR        10130000
P47422         DISPLAY '** KOHLS WRAP CREDIT AMT: ' PV-DISP-DOLLAR      10140000
090800         DISPLAY '**********************************************' 10150000
090900     MOVE PA-TOTAL-CHARGES            TO PV-DISP-DOLLAR           10160000
091000     DISPLAY '** TOTAL CHARGES ==> ' PV-DISP-DOLLAR               10170000
P47422     MOVE PA-TOTAL-WRAP-CHARGES       TO PV-DISP-DOLLAR           10180000
P47422     DISPLAY '** TOTAL WRAP CHARGES ==> ' PV-DISP-DOLLAR          10190000
091100     MOVE PA-TOTAL-CREDITS            TO PV-DISP-DOLLAR           10200000
091200     DISPLAY '** TOTAL CREDITS ==> ' PV-DISP-DOLLAR               10210000
P47422     MOVE PA-TOTAL-WRAP-CREDITS       TO PV-DISP-DOLLAR           10220000
P47422     DISPLAY '** TOTAL WRAP CREDITS ==> ' PV-DISP-DOLLAR          10230000
091300     MOVE PV-COMPARE-DOLLAR-AMT       TO PV-DISP-DOLLAR           10240000
091400     DISPLAY '** FREIGHT AMT   ==> ' PV-DISP-DOLLAR               10250000
091500     DISPLAY '*********************************************'      10260000
091600                                                                  10270000
091700***  GRO-COST AND NET COST WILL BE THE SAME                       10280000
091800     IF PV-COMPARE-REC-CNT = PV-CMS-CTL-REC-CNT AND               10290000
091900         PA-TOTAL-CHARGES    = PV-CMS-CTL-CHARGE-AMT AND          10300000
092000         PA-TOTAL-CREDITS    = PV-CMS-CTL-CREDIT-AMT              10310000
092100         SET PS-AMOUNTS-MATCH TO TRUE                             10320000
092200     ELSE                                                         10330000
092300         SET PS-AMOUNTS-NOT-MATCH TO TRUE                         10340000
092400         DISPLAY '**********************************************' 10350000
092500         DISPLAY '** ABEND                                      ' 10360000
092600         DISPLAY '** PROGRAM = VLKUT046                         ' 10370041
092700         DISPLAY '** PARAGRAPH = 1350-CHECK-TOTALS              ' 10380000
092800         DISPLAY '** DISCREPANCY IN CONTROL AMT FROM CMS AND    ' 10390000
092900         DISPLAY '**   CALULATED AMOUNT IN THIS PGM             ' 10400000
093000         MOVE PV-CMS-CTL-REC-CNT         TO PV-DISP-NUMBER        10410000
093100         DISPLAY '** CMS REC CNT:  ' PV-DISP-NUMBER               10420000
093200         MOVE PV-COMPARE-REC-CNT         TO PV-DISP-NUMBER        10430000
093300         DISPLAY '** KOHLS REC CNT:  ' PV-DISP-NUMBER             10440000
093400         MOVE PV-CMS-CTL-CHARGE-AMT      TO PV-DISP-DOLLAR        10450000
093500         DISPLAY '** CMS FRGT AMT: ' PV-DISP-DOLLAR               10460000
093600         MOVE PA-TOTAL-CHARGES          TO PV-DISP-DOLLAR         10470000
093700         DISPLAY '** KOHLS FRGT AMT: ' PV-DISP-DOLLAR             10480000
093800         MOVE PV-CMS-CTL-CREDIT-AMT      TO PV-DISP-DOLLAR        10490000
093900         DISPLAY '** CMS REVERSAL AMT: ' PV-DISP-DOLLAR           10500000
094000         MOVE PA-TOTAL-CREDITS           TO PV-DISP-DOLLAR        10510000
094100         DISPLAY '** KOHLS CREDIT AMT: ' PV-DISP-DOLLAR           10520000
094200         DISPLAY '**********************************************' 10530000
094300         PERFORM 9100-ABEND-BAD-AMTS                              10540000
094400     END-IF.                                                      10550000
094500                                                                  10560000
094600******************************************************************10570000
221500******************************************************************23700000
221600* READ THE EXTRACT FILE                                           23710000
221700******************************************************************23720000
221800 8000-READ-INPUT.                                                 23730024
221900     READ CMS-EXT-FILE                                            23740024
222000         INTO VL049-AP-INTERFACE-RECORD                           23750024
222100     AT END                                                       23760024
222200         SET PS-END-INPUT TO TRUE                                 23770024
222300     NOT AT END                                                   23780024
222400         ADD 1              TO PV-READ-COUNT                      23790024
222500                               PV-COMPARE-REC-CNT                 23800024
222600     END-READ.                                                    23810024
222700                                                                  23820000
222800******************************************************************23830000
P47422******************************************************************27700000
P47422* READ THE REPROCESS RECORD                                       27710000
P47422******************************************************************27720000
P47422 8700-READ-INPUT-I02.                                             27730000
P47422     READ CMS-WRAP-RECORD-FILE                                    27740000
P47422     AT END                                                       27750000
P47422         SET PS-END-OF-WRAP-RECS      TO TRUE                     27760000
P47422     NOT AT END                                                   27770000
P47422         ADD 1                        TO PV-WRAP-READ-COUNT       27780000
P47422     END-READ.                                                    27790000
P47422                                                                  27800000
265700******************************************************************28790000
265800 9100-ABEND-BAD-AMTS.                                             28800000
265900     CLOSE CMS-EXT-FILE.                                          28810000
266000     MOVE +4014 TO ABEND-CODE.                                    28820000
266100     CALL 'ILBOABN0' USING ABEND-CODE.                            28830000
266200                                                                  28840000
269200*---------------------------------------------------------------  29160000
269300*     ABEND ROUTINE USED WHEN PROBLEM WITH PRORATION ROUTINE      29170000
269400*---------------------------------------------------------------  29180000
269500 Z999-ABEND.                                                      29190000
269600                                                                  29200000
269700     DISPLAY AA-ABEND-LIT.                                        29210000
269800     DISPLAY AA-PROGRAM-LIT.                                      29220000
269900     DISPLAY AA-PARAGRAPH-LIT.                                    29230000
270000     DISPLAY AA-MESSAGE-LINE.                                     29240000
270100                                                                  29250000
270200     CALL 'ILBOABN0' USING ABEND-CODE.                            29260000
270300                                                                  29270000
270400                                                                  29280000
270500******************  END OF VLKUT046  *****************************29290041
