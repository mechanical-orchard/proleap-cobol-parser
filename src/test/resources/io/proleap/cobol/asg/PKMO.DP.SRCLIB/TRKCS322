000100*-----------------------*                                         00010006
000200 IDENTIFICATION DIVISION.                                         00020006
000300*-----------------------*                                         00030006
000400 PROGRAM-ID.    TRKCS322.                                         00040006
000500 AUTHOR.        MIKE FRIESS.                                      00050006
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060006
000700 DATE-WRITTEN.  JULY 2004.                                        00070006
000800 DATE-COMPILED.                                                   00080006
000900                                                                  00090006
001000*---------------------------------------------------------------* 00100006
001100*    Y322 - DECONSOLIDATOR CONTROL PANEL DETAIL LIST            * 00110006
001200*                                                               * 00120006
001300*    THIS PROGRAM GENERATES A LIST OF ALL THE CONTAINERS AND    * 00130006
001400*    PO NUMBERS FOR A GIVEN WEEK, POE AND VIEW.  THE VIEW CAN   * 00140006
001500*    BE CHANGED FROM WORKING, TO DEFAULT, TO ADJUSTED & BACK TO * 00150006
001600*    WORKING AGAIN BY PRESSING A FUNCTION KEY.  SUMMARY & MAINT * 00160006
001700*    SCREENS CAN BE NAVIGATED TO WHEN THE OPERATOR SELECTS AN   * 00170006
001800*    ITEM AND PRESSES A FUNCTION KEY.                           * 00180006
001900*                                                               * 00190006
002000*    LOGIC WAS ADDED TO UPDATE THE TIMPORL DCONSLR_ENT_ID WITH  * 00200006
002100*    ANY CONTNR OR VSL ADJUSTMENTS WHEN A CONTNR OR PO LEVEL    * 00210006
002200*    RETRANS IS PERFORMED - RKELLEN 3/09/2006.                  * 00220006
002300*---------------------------------------------------------------* 00230006
001300* CHANGE HISTORY                                                * 00240019
001300*     MADE BY: PRITHIVIRAJ SUBRAMANIAN (COGNIZANT)              * 00250019
001300*     DATE:    10/28/2014                                       * 00260022
001300*                                                               * 00270019
001300*      CHANGES THRU OUT THE PROGRAM TO INCREASE THE SIZE OF PO# * 00280019
001300*      FROM 7 DIGITS TO 8 DIGITS. TAGGED WITH *PS 10/28/2014    * 00290022
003250*---------------------------------------------------------------* 00300019
263697* CHANGED 11/08/2021    BY JIM HUNTER      WR: CHG0263697         00302023
263697* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00303023
263697* MAKING THE CALL DYNAMIC VS STATIC.                              00304023
263697*---------------------------------------------------------------* 00305023
CICS  * CHANGED  1/17/2023    BY JIM HUNTER      WR: CHG0278495         00306024
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00307024
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00308024
CICS  *-----------------------------------------------------------------00309024
002400                                                                  00310006
002500 ENVIRONMENT DIVISION.                                            00320006
002600                                                                  00330006
002700 DATA DIVISION.                                                   00340006
002800                                                                  00350006
002900 WORKING-STORAGE SECTION.                                         00360006
003000                                                                  00370006
003100 01  PC-PROGRAM-CONSTANTS.                                        00380006
003200     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00390006
003300                                                    'TR322A  '.   00400006
003400     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00410006
003500                                                    'TRKM322 '.   00420006
003600     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00430006
003700                                                    'TRKCS322'.   00440006
003800     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00450006
003900     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00460006
004000     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +11     00470006
004100                                                    COMP SYNC.    00480006
004200     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00490006
004300                                                    COMP SYNC.    00500006
004400     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00510006
004500                                                    +10000        00520006
004600                                                    COMP-3.       00530006
004700     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00540006
004800                                                    COMP SYNC.    00550006
004900     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00560006
005000                                                    COMP-3.       00570006
005100     05  PC-INIT-DATE                   PIC  X(10)  VALUE         00580006
005200                                                    '0001-01-01'. 00590006
005300     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00600006
005400     05  PC-A                           PIC  X(01)  VALUE 'A'.    00610006
005500     05  PC-I                           PIC  X(01)  VALUE 'I'.    00620006
005600     05  PC-SPACES                      PIC  X(02)  VALUE '  '.   00630006
005700                                                                  00640006
005800     05  PC-TSYMSG-NUMBERS.                                       00650006
005900         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00660006
006000         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00670006
006100         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  00680006
006200         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00690006
006300         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00700006
006400         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00710006
006500         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00720006
006600         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00730006
006700         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00740006
006800         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00750006
006900         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00760006
007000         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00770006
007100         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00780006
007200         10  PC-TSYMSG-00146            PIC  9(05)  VALUE 00146.  00790006
007300         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00800006
007400         10  PC-TSYMSG-01061            PIC  9(05)  VALUE 01061.  00810006
007500         10  PC-TSYMSG-03311            PIC  9(05)  VALUE 03311.  00820006
007600*            -  ONLY RETRANSMIT FROM THE ADJUSTED VIEW            00830006
007700         10  PC-TSYMSG-03312            PIC  9(05)  VALUE 03312.  00840006
007800*            -  CANNOT ADJUST A DEVANNED CONTAINER                00850006
007900         10  PC-TSYMSG-03313            PIC  9(05)  VALUE 03313.  00860006
008000*            -  ONLY ACCESS MAINTENANCE FROM WORKING VIEW         00870006
008100         10  PC-TSYMSG-03315            PIC  9(05)  VALUE 03315.  00880006
008200*            -  CANNOT RETRANSMIT - CONTAINER HAS NOT YET BEEN    00890006
008300*               TRANSMITTED                                       00900006
008400         10  PC-TSYMSG-03318            PIC  9(05)  VALUE 03318.  00910006
008500*            -  CANNOT RETRANSMIT A DEVANNED CONTAINER            00920006
008600         10  PC-TSYMSG-03319            PIC  9(05)  VALUE 03319.  00930006
008700*            -  CANNOT RETRANSMIT - PO HAS NOT YET BEEN           00940006
008800*               TRANSMITTED                                       00950006
008900         10  PC-TSYMSG-03320            PIC  9(05)  VALUE 03320.  00960006
009000*            -  CONTAINER HAS BEEN SET TO RETRANSMIT              00970006
009100         10  PC-TSYMSG-03321            PIC  9(05)  VALUE 03321.  00980006
009200*            -  PO HAS BEEN SET TO RETRANSMIT                     00990006
009300         10  PC-TSYMSG-03331            PIC  9(05)  VALUE 03331.  01000006
009400*            -  HAS ALREADY BEEN SET TO RETRANSMIT                01010006
009500         10  PC-TSYMSG-03333            PIC  9(05)  VALUE 03333.  01020006
009600*            -  CANNOT RETRANSMIT - MUST RETRANSMIT THE PO LEVEL  01030006
009700*               CONTAINER SPLIT                                   01040006
009800                                                                  01050006
009900     05  PC-DEFAULT-TMST                PIC X(26)     VALUE       01060006
010000                                    '0001-01-01-00.00.00.000000'. 01070006
010100     05  PC-DEFAULT-DTE-9               PIC X(10)     VALUE       01080006
010200                                                    '9999-09-09'. 01090006
010300     05  PC-DEFAULT-TME-9               PIC X(08)     VALUE       01100006
010400                                                      '09.09.09'. 01110006
010500     05  PC-DEFAULT-DTE                 PIC X(10)     VALUE       01120006
010600                                                    '0001-01-01'. 01130006
010700     05  PC-DEFAULT-TME                 PIC X(08)     VALUE       01140006
010800                                                      '00.00.00'. 01150006
010900                                                                  01160006
011000 01  PS-PROGRAM-SWITCHES.                                         01170006
011100     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01180006
011200         88  PS-NO-ERROR                            VALUE 'Y'.    01190006
011300         88  PS-ERROR                               VALUE 'N'.    01200006
011400     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01210006
011500         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01220006
011600         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01230006
011700     05  PS-SEASET-RULE-EXISTS-SW       PIC  X(01)  VALUE 'N'.    01240006
011800         88  PS-SEASET-RULE-EXISTS                  VALUE 'Y'.    01250006
011900         88  PS-SEASET-RULE-EXISTS-NO               VALUE 'N'.    01260006
012000     05  PS-EOC-PO-CUR-SW               PIC  X(01)  VALUE 'N'.    01270006
012100         88  PS-EOC-PO-CUR                          VALUE 'Y'.    01280006
012200         88  PS-EOC-PO-CUR-NO                       VALUE 'N'.    01290006
012300                                                                  01300006
012400     05  PS-CMN-SPLIT-DATA-FOUND-SW     PIC  X(01)  VALUE 'N'.    01310006
012500         88  PS-CMN-SPLIT-DATA-FOUND                VALUE 'Y'.    01320006
012600         88  PS-CMN-SPLIT-DATA-FOUND-NO             VALUE 'N'.    01330006
012700                                                                  01340006
012800     05  PS-CONPO-SPLIT-DATA-FOUND-SW   PIC  X(01)  VALUE 'N'.    01350006
012900         88  PS-CONPO-SPLIT-DATA-FOUND              VALUE 'Y'.    01360006
013000         88  PS-CONPO-SPLIT-DATA-FOUND-NO           VALUE 'N'.    01370006
013100                                                                  01380006
013200     05  PS-CONPO-SPLIT-CUR-AT-END-SW   PIC  X(01)  VALUE 'N'.    01390006
013300         88  PS-CONPO-SPLIT-CUR-AT-END-NO           VALUE 'N'.    01400006
013400         88  PS-CONPO-SPLIT-CUR-AT-END-YES          VALUE 'Y'.    01410006
013500                                                                  01420006
013600     05  PS-EOC-CMN-PO-CURSOR-SW        PIC  X(01)  VALUE 'N'.    01430006
013700         88  PS-EOC-CMN-PO-CURSOR                   VALUE 'Y'.    01440006
013800         88  PS-EOC-CMN-PO-CURSOR-NO                VALUE 'N'.    01450006
013900                                                                  01460006
014000     05  PS-TIMCNTK-EXISTS-SW          PIC  X(01)    VALUE 'N'.   01470006
014100         88 PS-TIMCNTK-EXISTS                        VALUE 'Y'.   01480006
014200         88 PS-TIMCNTK-EXISTS-NO                     VALUE 'N'.   01490006
014300                                                                  01500006
014400     05  PS-CMN-HAS-CON-PO-SW          PIC  X(01)    VALUE 'N'.   01510006
014500         88 PS-CMN-HAS-CON-PO                        VALUE 'Y'.   01520006
014600         88 PS-CMN-HAS-CON-PO-NO                     VALUE 'N'.   01530006
014700                                                                  01540006
014800     05  PS-CONSTR-RULE-FOUND-SW       PIC  X(01)    VALUE 'N'.   01550006
014900         88 PS-CONSTR-RULE-FOUND                     VALUE 'Y'.   01560006
015000         88 PS-CONSTR-RULE-NOT-FOUND                 VALUE 'N'.   01570006
015100                                                                  01580006
015200     05  PS-END-OF-RULE-CURS-SW        PIC  X(01)    VALUE 'N'.   01590006
015300         88 PS-END-OF-RULE-CURS                      VALUE 'Y'.   01600006
015400         88 PS-NOT-END-OF-RULE-CURS                  VALUE 'N'.   01610006
015500     05  PS-END-OF-CONT-RULE-CUR-SW     PIC  X(01)  VALUE 'N'.    01620006
015600         88  PS-END-OF-CONT-RULE-CUR                VALUE 'Y'.    01630006
015700         88  PS-END-OF-CONT-RULE-CUR-NO             VALUE 'N'.    01640006
015800     05  PS-END-OF-VSL-RULE-CUR-SW      PIC  X(01)  VALUE 'N'.    01650006
015900         88  PS-END-OF-VSL-RULE-CUR                 VALUE 'Y'.    01660006
016000         88  PS-END-OF-VSL-RULE-CUR-NO              VALUE 'N'.    01670006
016100     05  PS-ENT-ID-FOUND-SW             PIC  X(01)  VALUE 'N'.    01680006
016200         88  PS-ENT-ID-FOUND                        VALUE 'Y'.    01690006
016300         88  PS-ENT-ID-FOUND-NO                     VALUE 'N'.    01700006
016400     05  PS-PO-SPLIT-FOUND-SW           PIC  X(01)  VALUE 'N'.    01710006
016500         88  PS-PO-SPLIT-FOUND                      VALUE 'Y'.    01720006
016600         88  PS-PO-SPLIT-FOUND-NO                   VALUE 'N'.    01730006
016601** PRB0040270 - 03/20/2013  PREVENT ABEND FOR NO TIMCNPO          01740017
016602**              NEW SWITCH  MJF                                   01750017
016610     05  PS-TIMCNPO-FOUND-SW            PIC  X(01)  VALUE 'N'.    01760014
016620         88  PS-TIMCNPO-FOUND                       VALUE 'Y'.    01770014
016630         88  PS-TIMCNPO-FOUND-NO                    VALUE 'N'.    01780014
016700                                                                  01790006
016800 01  PV-PROGRAM-VARIABLES.                                        01800006
016900     05  PV-SUB                         PIC S9(04)  VALUE +0      01810006
017000                                                    COMP SYNC.    01820006
017100     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01830006
017200                                                    COMP SYNC.    01840006
017300     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01850006
017400                                                    COMP-3.       01860006
017500     05  PV-PO-COUNT                    PIC S9(09)  VALUE +0      01870006
017600                                                    COMP-3.       01880006
017700     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01890006
017800                                                    COMP-3.       01900006
017900     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01910006
018000                                                    COMP-3.       01920006
018100     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01930006
018200                                                    COMP-3.       01940006
018300     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01950006
018400                                                    COMP-3.       01960006
018500     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01970006
018600                                                    COMP-3.       01980006
018700     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01990006
018800                                                    COMP-3.       02000006
018900     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      02010006
019000                                                    COMP SYNC.    02020006
019100     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      02030006
019200                                                    COMP SYNC.    02040006
019300     05  PV-ITEM                        PIC S9(04)  VALUE +0      02050006
019400                                                    COMP SYNC.    02060006
019500     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      02070006
019600                                                    COMP SYNC.    02080006
019700     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      02090006
019800                                                    COMP SYNC.    02100006
019900     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      02110006
020000                                                    COMP SYNC.    02120006
020100     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      02130006
020200                                                    COMP SYNC.    02140006
020300     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      02150006
020400                                                    COMP SYNC.    02160006
020500     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02170006
020600                                                    COMP SYNC.    02180006
020700     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02190006
020800                                                    COMP SYNC.    02200006
020900     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      02210006
021000                                                    COMP SYNC.    02220006
021100     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      02230006
021200                                                    COMP SYNC.    02240006
021300     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      02250006
021400                                                    COMP SYNC.    02260006
021500     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      02270006
021600                                                    COMP SYNC.    02280006
021700     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      02290006
021800                                                    COMP SYNC.    02300006
021900     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      02310006
022000                                                    COMP SYNC.    02320006
022100                                                                  02330006
022200     05  PV-TOT-CONT-CARTS              PIC S9(04)  COMP          02340006
022300                                                    VALUE +0.     02350006
022400     05  PV-TOT-CONT-CBM                PIC S9(04)V99  COMP-3     02360006
022500                                                    VALUE +0.     02370006
022600     05  PV-CNT-VESSEL                  PIC X(30)   VALUE SPACES. 02380006
022700     05  PV-CNT-VOYAGE                  PIC X(30)   VALUE SPACES. 02390006
022800     05  PV-RUL-ID                      PIC S9(9)   COMP VALUE +0.02400006
022900     05  PV-RUL-TYPE                    PIC X(08)   VALUE SPACES. 02410006
023000     05  PV-CONTAINER-ID                PIC X(30)   VALUE SPACES. 02420006
023100     05  PV-CURRENT-TMST                PIC X(26)   VALUE SPACES. 02430006
023200     05  PV-CURRENT-TMST-DTE.                                     02440006
023300         10 PV-CURRENT-TMST-DTE-CC      PIC X(04)   VALUE SPACES. 02450006
023400         10 FILLER                      PIC X(01)   VALUE '-'.    02460006
023500         10 PV-CURRENT-TMST-DTE-MM      PIC X(02)   VALUE SPACES. 02470006
023600         10 FILLER                      PIC X(01)   VALUE '-'.    02480006
023700         10 PV-CURRENT-TMST-DTE-DD      PIC X(02)   VALUE SPACES. 02490006
023800                                                                  02500006
023900     05  PV-PREV-LINE.                                            02510006
024000         10 PV-PREV-RUL-ID-USED         PIC  S9(9) COMP VALUE 0.  02520006
024100         10 PV-PREV-RUL-TYP-CDE-USED    PIC  X(03) VALUE SPACES.  02530006
024200         10 PV-PREV-RUL-CDE-USED        PIC  X(04) VALUE SPACES.  02540006
024300         10 PV-PREV-RUL-ID-DEFLT        PIC  S9(9) COMP VALUE 0.  02550006
024400                                                                  02560006
024500     05  PV-CONT-CUR-RESULTS.                                     02570006
024600         10 PV-CONT-CUR-RUL-ID          PIC  S9(9) COMP VALUE 0.  02580006
024700         10 PV-CONT-CUR-CONTNR-ID       PIC  X(12) VALUE SPACES.  02590006
024800                                                                  02600006
024900     05  PV-CONSTRAINTS.                                          02610006
025000         10 PV-FOB-CDE                  PIC  X(30) VALUE SPACES.  02620006
025100         10 PV-VESSEL                   PIC  X(30) VALUE SPACES.  02630006
025200         10 PV-VOYAGE                   PIC  X(30) VALUE SPACES.  02640006
025300         10 PV-CONTNR-ID                PIC  X(12) VALUE SPACES.  02650006
025400         10 PV-CONTNR-SEQ-NBR           PIC  S9(4) COMP VALUE 0.  02660006
025500         10 PV-FULL-SEQ-NBR             PIC  X(30) VALUE SPACES.  02670006
025600         10 PV-PO-NBR                   PIC  S9(9) COMP VALUE 0.  02680006
025700         10 PV-PO-SPLIT-TYP             PIC  X(01) VALUE SPACES.  02690006
025800         10 PV-DEF-SCAC                 PIC  X(30) VALUE SPACES.  02700006
025900         10 PV-WKG-SCAC                 PIC  X(30) VALUE SPACES.  02710006
026000         10 PV-ADJ-SCAC                 PIC  X(30) VALUE SPACES.  02720006
026100         10 PV-ETA-DATE                 PIC  X(10) VALUE SPACES.  02730006
026200         10 PV-ETA-MM-DD.                                         02740006
026300            15 PV-ETA-MM                PIC  X(02) VALUE SPACES.  02750006
026400            15 FILLER                   PIC  X(01) VALUE '/'.     02760006
026500            15 PV-ETA-DD                PIC  X(02) VALUE SPACES.  02770006
026600         10 PV-SEQ-OR-ETA-VAL           PIC X(30)  VALUE SPACES.  02780006
026700         10 PV-SEQ-OR-ETA               PIC X(03).                02790006
026800            88 PV-SEQ                              VALUE 'SEQ'.   02800006
026900            88 PV-ETA                              VALUE 'ETA'.   02810006
027000                                                                  02820006
027100     05  PV-PO-CUR-RESULTS.                                       02830006
027200         10 PV-PO-CUR-PO-NBR            PIC  S9(9) COMP VALUE 0.  02840006
027300         10 PV-PO-CUR-PO-TYP-CDE        PIC  X(02) VALUE SPACES.  02850006
027400         10 PV-PO-CUR-SPLIT-TYP         PIC  X(01) VALUE SPACES.  02860006
027500         10 PV-PO-CUR-CART-CNT          PIC  S9(4) COMP VALUE 0.  02870006
027600         10 PV-PO-CUR-CBMT-QTY          PIC  S9(7)V9(2) COMP-3    02880006
027700                                                        VALUE 0.  02890006
027800         10 PV-PO-CUR-SEASET            PIC  X(05) VALUE SPACES.  02900006
027900                                                                  02910006
028000                                                                  02920006
028100                                                                  02930006
028200     05  PV-DATE-BREAK.                                           02940006
028300         10 PV-DB-YYYY                  PIC  X(02).               02950006
028400         10 FILLER                      PIC  X(01).               02960006
028500         10 PV-DB-MM                    PIC  X(02).               02970006
028600         10 FILLER                      PIC  X(01).               02980006
028700         10 PV-DB-DD                    PIC  X(02).               02990006
028800                                                                  03000006
028900     05 PV-DISPLAY-DATE.                                          03010006
029000         10 PV-MM                       PIC  X(02).               03020006
029100         10 FILLER                      PIC  X(01)  VALUE '/'.    03030006
029200         10 PV-DD                       PIC  X(02).               03040006
029300         10 FILLER                      PIC  X(01)  VALUE '/'.    03050006
029400         10 PV-YYYY                     PIC  X(04).               03060006
029500                                                                  03070006
029600     05  PV-VHTRIP-VEH-NBR-NULL       PIC S9(04)     VALUE +0     03080006
029700                                                     COMP SYNC.   03090006
029800     05  PV-VHTRIP-EST-AR-NULL        PIC S9(4)      VALUE +0     03100006
029900                                                     COMP SYNC.   03110006
030000     05  PV-CON-PO                    PIC  X(30) VALUE SPACES.    03120006
030100     05  PV-SEL-RUL-ID                PIC  S9(9) COMP VALUE 0.    03130006
030200 01  PV-SAVE-INT-APPL-COM.                                        03140006
030300     05  PV-VIEW                        PIC  X(08).               03150006
030400     05  PV-RUL-TYP                     PIC  X(03).               03160006
030500     05  PV-POE-CDE                     PIC  X(03).               03170006
030600     05  PV-WEEK-FROM-DTE               PIC  X(10).               03180006
030700     05  PV-WEEK-TO-DTE                 PIC  X(10).               03190006
030800                                                                  03200006
030900*----------------------------------------------------------------*03210006
031000*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.    *03220006
031100*   THIS MUST BE THE EXACT SAME FORMAT AS BLOCK IN THE           *03230006
031200*   APPLICATION-SPECIFIC COMMAREA.                               *03240006
031300*----------------------------------------------------------------*03250006
031400 01  LQW-LIST-QUEUE-WORK-AREA.                                    03260006
031500     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  03270006
031600     05  LQW-ITEM-ENTRIES               OCCURS 11   TIMES         03280006
031700                                        INDEXED BY  LQW-IDX.      03290006
031800         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       03300006
031900         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               03310006
032000         10  LQW-SELECTED-SW            PIC  X(01).               03320006
032100             88  LQW-SELECT           VALUE 'S'.                  03330006
032200             88  LQW-DESELECT         VALUE ' '.                  03340006
032300         10  LQW-ACTION                 PIC  X(03).               03350006
032400         10  LQW-VESSEL                 PIC  X(23).               03360021
032500         10  LQW-ETA-MM-DD              PIC  X(05).               03370006
032600         10  LQW-FOB-CDE                PIC  X(03).               03380006
032700         10  LQW-VOYAGE                 PIC  X(10).               03390006
032800         10  LQW-CONTNR-ID              PIC  X(12).               03400006
032900         10  LQW-CONTNR-SEQ-NBR         PIC  9(06).               03410006
033000         10  LQW-ETA-DATE               PIC  X(10).               03420006
033100*PS 10/28/2014 CHANGE STARTS                                      03430019
033100         10  LQW-PO-NBR                 PIC  9(08).               03440019
033100*PS 10/28/2014 CHANGE ENDS                                        03450019
033200         10  LQW-PO-TYP-CDE             PIC  X(02).               03460006
033300         10  LQW-PO-SPLIT-TYP           PIC  X(01).               03470006
033400         10  LQW-CART-CNT               PIC  9(05).               03480006
033500         10  LQW-CBM-QTY                PIC S9(04)V99.            03490006
033600         10  LQW-SEASET                 PIC  X(05).               03500006
033700         10  LQW-DECNSL-SCAC            PIC  X(04).               03510006
033800         10  LQW-RUL-ID-DEFLT           PIC  S9(9)                03520006
033900                                              COMP.               03530006
034000         10  LQW-RUL-ID-USED            PIC  S9(9)                03540006
034100                                              COMP.               03550006
034200         10  LQW-RUL-CDE-USED           PIC  X(04).               03560006
034300         10  LQW-RUL-TYP-CDE-USED       PIC  X(03).               03570006
034400                                                                  03580006
034500*---------------------------------------------------------------* 03590006
034600*  RECORD LAYOUT FOR SELECTION TEMP STORAGE QUEUE.                03600006
034700*---------------------------------------------------------------* 03610006
034800                                                                  03620006
034900     COPY TRWS322.                                                03630006
035000                                                                  03640006
035100 EJECT                                                            03650006
035200*---------------------------------------------------------------* 03660006
035300*    MAP LAYOUT                                                 * 03670006
035400*---------------------------------------------------------------* 03680006
035500                                                                  03690006
035600     COPY TRKM322.                                                03700006
035700                                                                  03710006
035800 01  MR-OCCURS-LAYOUT                   REDEFINES  TR322AO.       03720006
035900     05  FILLER                         PIC X(093).               03730006
036000                                                                  03740006
036100     05  MR-SCROLL-AREA                 OCCURS 11 TIMES.          03750006
036200         10  MR-SELECTL                 PIC S9(04) COMP.          03760006
036300         10  MR-SELECTA                 PIC  X(01).               03770006
036400         10  MR-SELECTC                 PIC  X(01).               03780006
036500         10  MR-SELECTH                 PIC  X(01).               03790006
036600         10  MR-SELECTI                 PIC  X(01).               03800006
036700                                                                  03810006
036800         10  MR-ACTIONL                 PIC S9(04) COMP.          03820006
036900         10  MR-ACTIONA                 PIC  X(01).               03830006
037000         10  MR-ACTIONC                 PIC  X(01).               03840006
037100         10  MR-ACTIONH                 PIC  X(01).               03850006
037200         10  MR-ACTION                  PIC  X(03).               03860006
037300                                                                  03870006
037400         10  MR-VES-ETA-FOBL            PIC S9(04) COMP.          03880006
037500         10  MR-VES-ETA-FOBA            PIC  X(01).               03890006
037600         10  MR-VES-ETA-FOBC            PIC  X(01).               03900006
037700         10  MR-VES-ETA-FOBH            PIC  X(01).               03910006
037800         10  MR-VES-ETA-FOB             PIC  X(20).               03920006
037900                                                                  03930006
038000         10  MR-CONTNR-IDL              PIC S9(04) COMP.          03940006
038100         10  MR-CONTNR-IDA              PIC  X(01).               03950006
038200         10  MR-CONTNR-IDC              PIC  X(01).               03960006
038300         10  MR-CONTNR-IDH              PIC  X(01).               03970006
038400         10  MR-CONTNR-ID               PIC  X(12).               03980006
038500                                                                  03990006
038600         10  MR-PO-NBRL                 PIC S9(04) COMP.          04000006
038700         10  MR-PO-NBRA                 PIC  X(01).               04010006
038800         10  MR-PO-NBRC                 PIC  X(01).               04020006
038900         10  MR-PO-NBRH                 PIC  X(01).               04030006
039000*PS 10/28/2014 CHANGE STARTS                                      04040019
039000         10  MR-PO-NBR                  PIC  ZZZZZZZ9.            04050019
039100         10  MR-PO-NBR-X REDEFINES MR-PO-NBR                      04060006
039200                                        PIC  X(08).               04070019
039000*PS 10/28/2014 CHANGE ENDS                                        04080019
039300                                                                  04090006
039400         10  MR-PO-TYPL                 PIC S9(04) COMP.          04100006
039500         10  MR-PO-TYPA                 PIC  X(01).               04110006
039600         10  MR-PO-TYPC                 PIC  X(01).               04120006
039700         10  MR-PO-TYPH                 PIC  X(01).               04130006
039800         10  MR-PO-TYP                  PIC  X(02).               04140006
039900                                                                  04150006
040000         10  MR-CTNL                    PIC S9(04) COMP.          04160006
040100         10  MR-CTNA                    PIC  X(01).               04170006
040200         10  MR-CTNC                    PIC  X(01).               04180006
040300         10  MR-CTNH                    PIC  X(01).               04190006
040400         10  MR-CTN                     PIC  ZZZZ9.               04200006
040500         10  MR-CTN-X REDEFINES MR-CTN  PIC  X(05).               04210006
040600                                                                  04220006
040700         10  MR-CBML                    PIC S9(04) COMP.          04230006
040800         10  MR-CBMA                    PIC  X(01).               04240006
040900         10  MR-CBMC                    PIC  X(01).               04250006
041000         10  MR-CBMH                    PIC  X(01).               04260006
041100         10  MR-CBM                     PIC  ZZZ9.99.             04270006
041200         10  MR-CBM-X REDEFINES MR-CBM  PIC  X(07).               04280006
041300                                                                  04290006
041400         10  MR-SPLTL                   PIC S9(04) COMP.          04300006
041500         10  MR-SPLTA                   PIC  X(01).               04310006
041600         10  MR-SPLTC                   PIC  X(01).               04320006
041700         10  MR-SPLTH                   PIC  X(01).               04330006
041800         10  MR-SPLT                    PIC  X(01).               04340006
041900                                                                  04350006
042000         10  MR-SEASETL                 PIC S9(04) COMP.          04360006
042100         10  MR-SEASETA                 PIC  X(01).               04370006
042200         10  MR-SEASETC                 PIC  X(01).               04380006
042300         10  MR-SEASETH                 PIC  X(01).               04390006
042400         10  MR-SEASET                  PIC  X(05).               04400006
042500                                                                  04410006
042600         10  MR-DECNSLL                 PIC S9(04) COMP.          04420006
042700         10  MR-DECNSLA                 PIC  X(01).               04430006
042800         10  MR-DECNSLC                 PIC  X(01).               04440006
042900         10  MR-DECNSLH                 PIC  X(01).               04450006
043000         10  MR-DECNSL                  PIC  X(04).               04460006
043100                                                                  04470006
043200 EJECT                                                            04480006
043300*---------------------------------------------------------------* 04490006
043400*    ATTRIBUTE SETTINGS COPYBOOK.                               * 04500006
043500*---------------------------------------------------------------* 04510006
043600                                                                  04520006
043700     COPY DPWS015.                                                04530006
043800                                                                  04540006
043900 EJECT                                                            04550006
044000*---------------------------------------------------------------* 04560006
044100*    FUNCTION KEYS COPYBOOK.                                    * 04570006
044200*---------------------------------------------------------------* 04580006
044300                                                                  04590006
044400     COPY DPWS016.                                                04600006
044500                                                                  04610006
044600 EJECT                                                            04620006
044700*---------------------------------------------------------------* 04630006
044800*    SECURITY SUBROUTINE PARAMETERS.                            * 04640006
044900*---------------------------------------------------------------* 04650006
045000                                                                  04660006
045100     COPY DPWS008.                                                04670006
045200                                                                  04680006
045300 EJECT                                                            04690006
045400*---------------------------------------------------------------* 04700006
045500*    NUMERIC EDIT LAYOUT.                                       * 04710006
045600*---------------------------------------------------------------* 04720006
045700                                                                  04730006
045800     COPY DPWS010I.                                               04740006
045900                                                                  04750006
046000 EJECT                                                            04760006
046100*---------------------------------------------------------------* 04770006
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 04780024
046300*---------------------------------------------------------------* 04790006
046400                                                                  04800006
046500     COPY DPWS030.                                                04810006
CICS       COPY DPWS930.                                                04820024
046700 EJECT                                                            04830006
046800*---------------------------------------------------------------* 04840006
046900*    STANDARD COMMAREA.                                         * 04850006
047000*---------------------------------------------------------------* 04860006
047100                                                                  04870006
047200     COPY DPWS020.                                                04880006
047300     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                04890006
047400                                                                  04900006
047500*---------------------------------------------------------------* 04910006
047600* INTER-APPLICATION COMMAREA.                                   * 04920006
047700*   TRWS320 - THE INPUT/OUTPUT LAYOUT THAT IS PASSED TO         * 04930006
047800*             TRKCS323 (MAINT) AND TRKCS324 (SUMMARY)           * 04940006
047900*   TRWS105 - THE OUTPUT LAYOUT THAT IS PASSED TO TRKCS162.     * 04950006
048000*              (CONTAINER LIST SCREEN)                          * 04960006
048100*   TRWS119 - THE OUTPUT LAYOUT THAT IS PASSED TO TRKCS193.     * 04970006
048200*              (PO DECONSOLIDATION/RELEASE INQUIRY SCREEN)      * 04980006
048300*---------------------------------------------------------------* 04990006
048400                                                                  05000006
048500         10  INTER-APPL-COMM-AREA       PIC X(200).               05010006
048600     COPY TRWS320.                                                05020006
048700     COPY TRWS105.                                                05030006
048800     COPY TRWS119.                                                05040006
048900                                                                  05050006
049000*---------------------------------------------------------------* 05060006
049100*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 05070006
049200*---------------------------------------------------------------* 05080006
049300         10  ASC-SPECIFIC-COMMAREA.                               05090006
049400             15  ASC-LIST-KEYS.                                   05100006
049500                 20  ASC-POE-CDE          PIC  X(03).             05110006
049600                 20  ASC-WEEK-FROM-DTE    PIC  X(10).             05120006
049700                 20  ASC-WEEK-TO-DTE      PIC  X(10).             05130006
049800                 20  ASC-VIEW             PIC  X(08).             05140006
049900                 20  ASC-RUL-TYP          PIC  X(03).             05150006
050000             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                05160020
050100                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  05170006
050200                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   05180006
050300                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   05190006
050400                                                                  05200006
050500                 20  ASC-ITEM-ARRAY.                              05210006
050600                     25  ASC-ITEM-ENTRIES OCCURS 11 TIMES.        05220006
050700                         30  ASC-LIST-ITEM-NUMBER                 05230006
050800                                                     PIC S9(09)   05240006
050900                                                     COMP-3.      05250006
051000                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  05260006
051100                             88  ASC-VALID-SELECT    VALUE ' '    05270006
051200                                                           'S'    05280006
051300                                                           'B'    05290006
051400                                                           'E'.   05300006
051500                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   05310006
051600                             88  ASC-TEMP-SELECT     VALUE 'S'.   05320006
051700                             88  ASC-TEMP-BEGIN      VALUE 'B'.   05330006
051800                             88  ASC-TEMP-END        VALUE 'E'.   05340006
051900                         30  ASC-SELECTED-SW         PIC  X(01).  05350006
052000                             88  ASC-NO-SELECT       VALUE ' '.   05360006
052100                             88  ASC-SELECT          VALUE 'S'.   05370006
052200                             88  ASC-BEGIN           VALUE 'B'.   05380006
052300                             88  ASC-END             VALUE 'E'.   05390006
052400                         30  ASC-ACTION              PIC  X(03).  05400006
052500                         30  ASC-VESSEL              PIC  X(23).  05410021
052600                         30  ASC-ETA-MM-DD           PIC  X(05).  05420006
052700                         30  ASC-FOB-CDE             PIC  X(03).  05430006
052800                         30  ASC-VOYAGE              PIC  X(10).  05440006
052900                         30  ASC-CONTNR-ID           PIC  X(12).  05450006
053000                         30  ASC-CONTNR-SEQ-NBR      PIC  9(06).  05460006
053100                         30  ASC-ETA-DATE            PIC  X(10).  05470006
053200*PS 10/28/2014 CHANGE STARTS                                      05480019
053200                         30  ASC-PO-NBR              PIC  9(08).  05490019
053200*PS 10/28/2014 CHANGE ENDS                                        05500019
053300                         30  ASC-PO-TYP-CDE          PIC  X(02).  05510006
053400                         30  ASC-PO-SPLIT-TYP        PIC  X(01).  05520006
053500                         30  ASC-CART-CNT            PIC  9(05).  05530006
053600                         30  ASC-CBM-QTY           PIC 9(04)V99.  05540006
053700                         30  ASC-SEASET              PIC  X(05).  05550006
053800                         30  ASC-DECON-SCAC-CUR      PIC  X(04).  05560006
053900                         30  ASC-RUL-ID-DEFLT        PIC  S9(9)   05570006
054000                                                           COMP.  05580006
054100                         30  ASC-RUL-ID-USED         PIC  S9(9)   05590006
054200                                                           COMP.  05600006
054300                         30  ASC-RUL-CDE-USED        PIC  X(04).  05610006
054400                         30  ASC-RUL-TYP-CDE-USED    PIC  X(03).  05620006
054500                                                                  05630006
054600             15  ASC-BLK-SUB                         PIC S9(04)   05640006
054700                                                          COMP    05650006
054800                                                          SYNC.   05660006
054900             15  ASC-ITEM-SUB                        PIC S9(04)   05670006
055000                                                          COMP    05680006
055100                                                          SYNC.   05690006
055200             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   05700006
055300                                                          COMP-3. 05710006
055400             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   05720006
055500                                                          COMP-3. 05730006
055600             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   05740006
055700                                                          COMP-3. 05750006
055800             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   05760006
055900                                                          COMP-3. 05770006
056000             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   05780006
056100                                                          COMP-3. 05790006
056200             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   05800006
056300                                                          COMP    05810006
056400                                                          SYNC.   05820006
056500             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   05830006
056600                                                          COMP-3. 05840006
056700             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   05850006
056800                                                          COMP-3. 05860006
056900             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  05870006
057000                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   05880006
057100                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   05890006
057200             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  05900006
057300                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   05910006
057400                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   05920006
057500             15  ASC-LIST-QUEUE-NAME.                             05930006
057600                 20  ASC-LIST-TERM-ID                PIC  X(04).  05940006
057700                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   05950006
057800                                                          COMP-3. 05960006
057900                 20  ASC-LIST-SEQ                    PIC  9(01).  05970006
058000             15  ASC-SEL-QUEUE-NAME.                              05980006
058100                 20  ASC-SEL-TERM-ID                 PIC  X(04).  05990006
058200                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   06000006
058300                                                          COMP-3. 06010006
058400                 20  ASC-SEL-SEQ                     PIC  9(01).  06020006
058500             15  ASC-START-ITEM-REQUEST.                          06030006
058600                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  06040006
058700                                                                  06050006
058800 EJECT                                                            06060006
058900*---------------------------------------------------------------* 06070006
059000*    ABEND PROCESSING COPYBOOK.                                 * 06080006
059100*---------------------------------------------------------------* 06090006
059200     COPY DPWS013.                                                06100006
059300 EJECT                                                            06110006
059400*---------------------------------------------------------------* 06120006
059500*    DB2 AREA FOR CONTAINER TRACKING                            * 06130006
059600*---------------------------------------------------------------* 06140006
059700     EXEC SQL                                                     06150006
059800          INCLUDE TIMCNTK                                         06160006
059900     END-EXEC.                                                    06170006
060000*---------------------------------------------------------------* 06180006
060100*    DB2 AREA FOR CONTAINER PO                                  * 06190006
060200*---------------------------------------------------------------* 06200006
060300     EXEC SQL                                                     06210006
060400          INCLUDE TIMCNPO                                         06220006
060500     END-EXEC.                                                    06230006
060600*---------------------------------------------------------------* 06240006
060700*    DB2 AREA FOR CONTAINER CONTROL                             * 06250006
060800*---------------------------------------------------------------* 06260006
060900     EXEC SQL                                                     06270006
061000          INCLUDE TIMCNRL                                         06280006
061100     END-EXEC.                                                    06290006
061200*---------------------------------------------------------------* 06300006
061300*    DB2 AREA FOR CONTAINER PO AUDIT                            * 06310006
061400*---------------------------------------------------------------* 06320006
061500     EXEC SQL                                                     06330006
061600          INCLUDE TAUCNPO                                         06340006
061700     END-EXEC.                                                    06350006
061800*---------------------------------------------------------------* 06360006
061900*    DB2 AREA FOR CONTAINER CONTROL AUDIT                       * 06370006
062000*---------------------------------------------------------------* 06380006
062100     EXEC SQL                                                     06390006
062200          INCLUDE TAUCNRL                                         06400006
062300     END-EXEC.                                                    06410006
062400*---------------------------------------------------------------* 06420006
062500*    DB2 AREA FOR PURCHASE ORDER MASTER                         * 06430006
062600*---------------------------------------------------------------* 06440006
062700     EXEC SQL                                                     06450006
062800          INCLUDE TPURCHS                                         06460006
062900     END-EXEC.                                                    06470006
063000*---------------------------------------------------------------* 06480006
063100*    DB2 AREA FOR IMPORTS PO RELEASE TABLE                      * 06490006
063200*---------------------------------------------------------------* 06500006
063300     EXEC SQL                                                     06510006
063400          INCLUDE TIMPORL                                         06520006
063500     END-EXEC.                                                    06530006
063600*---------------------------------------------------------------* 06540006
063700*    DB2 AREA FOR PO SHIPMENT TABLE                             * 06550006
063800*---------------------------------------------------------------* 06560006
063900     EXEC SQL                                                     06570006
064000          INCLUDE TSHPTPO                                         06580006
064100     END-EXEC.                                                    06590006
064200*---------------------------------------------------------------* 06600006
064300*    DB2 AREA FOR SHIPMENT TABLE                                * 06610006
064400*---------------------------------------------------------------* 06620006
064500     EXEC SQL                                                     06630006
064600          INCLUDE TSHIPMT                                         06640006
064700     END-EXEC.                                                    06650006
064701******************************************************************06660011
064711**** PRB0040279 - 03/20/2013 ALLOW CMN AFTER SHIPMENT CANCEL      06670017
064720****    ADD TABLES TSHIPST AND TSHSTYP - MJF                      06680017
064750******************************************************************06690011
064760*---------------------------------------------------------------* 06700011
064770*    DB2 AREA FOR SHIPMENT STATUS TABLE                         * 06710011
064780*---------------------------------------------------------------* 06720011
064790     EXEC SQL                                                     06730011
064791          INCLUDE TSHIPST                                         06740011
064792     END-EXEC.                                                    06750011
064793*---------------------------------------------------------------* 06760011
064794*    DB2 AREA FOR SHIPMENT STATUS TYPE TABLE                    * 06770011
064795*---------------------------------------------------------------* 06780011
064796     EXEC SQL                                                     06790011
064797          INCLUDE TSHSTYP                                         06800011
064798     END-EXEC.                                                    06810011
064799**** PRB0040270 - 03/20/2013 END                                  06820017
064801******************************************************************06830011
064810*---------------------------------------------------------------* 06840011
064900*    DB2 AREA FOR TRIP TABLE                                    * 06850006
065000*---------------------------------------------------------------* 06860006
065100     EXEC SQL                                                     06870006
065200          INCLUDE TVHTRIP                                         06880006
065300     END-EXEC.                                                    06890006
065400*---------------------------------------------------------------* 06900006
065500*    DB2 AREA FOR VEHICLE TABLE                                 * 06910006
065600*---------------------------------------------------------------* 06920006
065700     EXEC SQL                                                     06930006
065800          INCLUDE TVEHICL                                         06940006
065900     END-EXEC.                                                    06950006
066000*---------------------------------------------------------------* 06960006
066100*    DB2 AREA FOR ENTERPRISE NAME TABLE                         * 06970006
066200*---------------------------------------------------------------* 06980006
066300     EXEC SQL                                                     06990006
066400          INCLUDE TENTNME                                         07000006
066500     END-EXEC.                                                    07010006
066600*---------------------------------------------------------------* 07020006
066700*    DB2 AREA FOR STATUS CODE TABLE                             * 07030006
066800*---------------------------------------------------------------* 07040006
066900     EXEC SQL                                                     07050006
067000          INCLUDE TSTATCD                                         07060006
067100     END-EXEC.                                                    07070006
067200*---------------------------------------------------------------* 07080006
067300*    DB2 AREA FOR DECON CONTROL PANEL RULES TABLE TRT_RUL.      * 07090006
067400*---------------------------------------------------------------* 07100006
067500     EXEC SQL                                                     07110006
067600          INCLUDE TRT00014                                        07120006
067700     END-EXEC.                                                    07130006
067800*---------------------------------------------------------------* 07140006
067900*    DB2 AREA FOR DECON CONTROL RULE CONSTRAINTS TABLE.         * 07150006
068000*                                               TRT_RUL_CNSTR   * 07160006
068100*---------------------------------------------------------------* 07170006
068200     EXEC SQL                                                     07180006
068300          INCLUDE TRT00015                                        07190006
068400     END-EXEC.                                                    07200006
068500*---------------------------------------------------------------* 07210006
068600*    DB2 AREA FOR TEXTENT DB2 TALBE                             * 07220006
068700*---------------------------------------------------------------* 07230006
068800     EXEC SQL                                                     07240006
068900          INCLUDE TEXTENT                                         07250006
069000     END-EXEC.                                                    07260006
069100*---------------------------------------------------------------* 07270006
069200*    DB2 AREA FOR COMMUNICATIONS                                * 07280006
069300*---------------------------------------------------------------* 07290006
069400     EXEC SQL                                                     07300006
069500          INCLUDE SQLCA                                           07310006
069600     END-EXEC.                                                    07320006
069700*---------------------------------------------------------------* 07330006
069800*    MAIN CONTAINER CURSOR FOR DEFAULT VIEW.                    * 07340006
069900*---------------------------------------------------------------* 07350006
070000                                                                  07360006
070100     EXEC SQL                                                     07370006
070200        DECLARE CONT_CUR CURSOR                                   07380006
070300          FOR SELECT                                              07390006
070400                RT.RUL_ID                                         07400006
070500               ,CT.RUL_CNSTR_VAL_TXT                              07410006
070600               ,VS.RUL_CNSTR_VAL_TXT                              07420006
070700          FROM TRT_RUL_CNSTR CT                                   07430006
070800              ,TRT_RUL_CNSTR VS                                   07440006
070900              ,TRT_RUL RT                                         07450006
071000         WHERE CT.RUL_CNSTR_TYP_CDE = 'CONT'                      07460006
071100           AND RT.RUL_ID            =  CT.RUL_ID                  07470006
071200           AND VS.RUL_CNSTR_TYP_CDE = 'VSL'                       07480006
071300           AND RT.RUL_ID            =  VS.RUL_ID                  07490006
071400           AND RT.RUL_BEG_DTE       = :PV-WEEK-FROM-DTE           07500006
071500           AND RT.RUL_END_DTE       = :PV-WEEK-TO-DTE             07510006
071600           AND RT.RUL_CDE           = 'CONT'                      07520006
071700           AND RT.RUL_TYP_CDE       = 'DEF'                       07530006
071800           AND :PV-POE-CDE  =                                     07540006
071900                    (SELECT SUBA.RUL_CNSTR_VAL_TXT                07550006
072000                       FROM TRT_RUL_CNSTR SUBA                    07560006
072100                      WHERE SUBA.RUL_ID = RT.RUL_ID               07570006
072200                        AND SUBA.RUL_CNSTR_TYP_CDE = 'POE')       07580006
072300         ORDER BY 3,2                                             07590006
072400     END-EXEC.                                                    07600006
072500                                                                  07610006
072600*---------------------------------------------------------------* 07620006
072700*    CURSOR TO PULL PURCHASE ORDERS FOR EACH CONTAINER.         * 07630006
072800*---------------------------------------------------------------* 07640006
072900                                                                  07650006
073000     EXEC SQL                                                     07660006
073100        DECLARE PO_CUR CURSOR                                     07670006
073200          FOR                                                     07680006
073300***                                                               07690006
073400***   CON POS                                                     07700006
073500***                                                               07710006
073600           SELECT PO.PO_NBR                                       07720006
073700                 ,PO.PO_TYP_CDE                                   07730006
073800                 ,'P'                                             07740006
073900                 ,0                                               07750006
074000                 ,0                                               07760006
074100                 ,PO.SEASET_SHRT_NM                               07770006
074200            FROM TRT_RUL_CNSTR CT                                 07780006
074300                ,TPURCHS PO                                       07790013
074400           WHERE CT.RUL_ID = :PV-CONT-CUR-RUL-ID                  07800006
074500             AND CT.RUL_CNSTR_TYP_CDE = 'CONPO'                   07810006
074600             AND INTEGER(SUBSTR(CT.RUL_CNSTR_VAL_TXT,1,9))        07820006
074700                                   = PO.PO_NBR                    07830006
074800             AND PO.VER_STATUS_CDE = 'A'                          07840006
074900             AND PO.STATUS_CDE    IN ('AC','AP','CA','CM')        07850006
075000    UNION ALL                                                     07860006
075100*--                                                               07870006
075200*--  CMNS                                                         07880006
075300*--                                                               07890006
075400           SELECT PO.PO_NBR                                       07900006
075500                 ,PO.PO_TYP_CDE                                   07910006
075600                 ,'C'                                             07920006
075700                 ,CNPO.PO_CART_CNT                                07930006
075800                 ,CNPO.PO_CBMT_QTY                                07940006
075900                 ,PO.SEASET_SHRT_NM                               07950006
076000             FROM TIMCNPO CNPO                                    07960006
076100                 ,TPURCHS PO                                      07970006
076200                 ,TRT_RUL_CNSTR RC                                07980006
076300            WHERE RC.RUL_ID         = :PV-CONT-CUR-RUL-ID         07990006
076400              AND RC.RUL_CNSTR_TYP_CDE = 'SEQ'                    08000006
076500              AND CNPO.CONTNR_ID    = :PV-CONT-CUR-CONTNR-ID      08010006
076600              AND CNPO.CONTNR_SEQ_NBR  =                          08020006
076700                  INTEGER(SUBSTR(RC.RUL_CNSTR_VAL_TXT,1,6))       08030006
076800              AND PO.PO_NBR         = CNPO.PO_NBR                 08040006
076900              AND PO.VER_STATUS_CDE = 'A'                         08050006
077000              AND PO.STATUS_CDE    IN ('AC','AP','CA','CM')       08060006
077100**          ELIMINATE PO OVERIDES                                 08070006
077200              AND NOT EXISTS                                      08080006
077300                (SELECT 'X'                                       08090006
077400                   FROM TRT_RUL_CNSTR CT                          08100006
077500                  WHERE CT.RUL_ID = :PV-CONT-CUR-RUL-ID           08110006
077600                    AND CT.RUL_CNSTR_TYP_CDE = 'CONPO'            08120006
077700                    AND INTEGER(SUBSTR(CT.RUL_CNSTR_VAL_TXT,1,9)) 08130006
077800                                          = CNPO.PO_NBR           08140006
077900                 )                                                08150006
078000     END-EXEC.                                                    08160006
078100                                                                  08170006
078200*---------------------------------------------------------------* 08180006
078300*    CURSOR TO PULL POS FOR RETRAN -- CMN                       * 08190006
078400*---------------------------------------------------------------* 08200006
078402**  PRB0040270 - 03/20/2013  PREVENT ABEND FOR NO TIMCNPO  - MJF  08210018
078403**               ADD TIMCNPO TO CURSOR                            08220018
078404**  PRB0040279 - 03/20/2013  RETRAN OK IF SHIPMENT EXISTS  - MJF  08230018
078405**               DELETE NOT EXISTS CLAUSE                         08240018
078410*---------------------------------------------------------------* 08250012
078500                                                                  08260006
078600     EXEC SQL                                                     08270006
078700        DECLARE CMN_PO_CUR  CURSOR                                08280006
078800          FOR                                                     08290006
078900           SELECT                                                 08300006
079000               RL.CONTNR_ID                                       08310006
079100              ,RL.CONTNR_SEQ_NBR                                  08320006
079200              ,RL.PO_NBR                                          08330006
079300              ,RL.DCONSLR_RLSE_CDE                                08340006
079400              ,RL.DCONSLR_REQR_DTE                                08350006
079500              ,RL.DCONSLR_ACTL_DTE                                08360006
079600              ,RL.DCONSLR_ACTL_TM                                 08370006
079700              ,RL.CRE_TMST                                        08380006
079800              ,RL.CRE_BY_UID                                      08390006
079900              ,RL.LAST_UPD_TMST                                   08400006
080000              ,RL.LAST_UPD_BY_UID                                 08410006
080100              ,RL.DCONSLR_ENT_ID                                  08420006
080200           FROM TIMCNRL   RL                                      08430006
080210               ,TIMCNPO   PO                                      08440012
080300           WHERE  RL.CONTNR_ID        = :PV-CONTNR-ID             08450006
080400             AND  RL.CONTNR_SEQ_NBR   = :PV-CONTNR-SEQ-NBR        08460006
080410             AND  PO.CONTNR_ID        = RL.CONTNR_ID              08470012
080420             AND  PO.CONTNR_SEQ_NBR   = RL.CONTNR_SEQ_NBR         08480012
080430             AND  PO.PO_NBR           = RL.PO_NBR                 08490012
082200     END-EXEC.                                                    08500006
082300                                                                  08510006
082400*---------------------------------------------------------------* 08520006
082500*    CURSOR TO PULL CONPO SPLIT DATA                            * 08530006
082600*---------------------------------------------------------------* 08540006
082700                                                                  08550006
082800     EXEC SQL                                                     08560006
082900        DECLARE CONPO_SPLIT_CUR CURSOR                            08570006
083000          FOR                                                     08580006
083100            SELECT E.PO_NBR                                       08590006
083200                  ,E.LAST_UPD_PGM_ID                              08600006
083300                  ,E.SPLT_XMIT_IND                                08610006
083400                  ,A.DCONSLR_RLSE_CDE                             08620006
083500                  ,A.LAST_UPD_BY_UID                              08630006
083600                  ,C.TRIP_ID                                      08640006
083700                  ,D.SHIPT_ID                                     08650006
083800            FROM   TIMPORL A                                      08660006
083900                  ,TVEHICL B                                      08670006
084000                  ,TVHTRIP C                                      08680006
084100                  ,TSHIPMT D                                      08690006
084200                  ,TSHPTPO E                                      08700006
084300             WHERE A.PO_NBR           = :PV-PO-NBR                08710006
084400               AND A.PO_NBR           = E.PO_NBR                  08720006
084500               AND A.VER_STATUS_CDE   = 'A'                       08730006
084600               AND E.SHIPT_ID         = D.SHIPT_ID                08740006
084700               AND D.TRIP_ID          = C.TRIP_ID                 08750006
084800               AND C.VEH_NBR          = B.VEH_NBR                 08760006
084900               AND C.OWNER_SCAC_ID    = B.OWNER_SCAC_ID           08770006
085000               AND B.VEH_TYP_CDE      IN ('VS', 'AV')             08780006
085100      END-EXEC.                                                   08790006
085200*---------------------------------------------------------------* 08800006
085300*    CURSOR TO ACCESS THE RUL_ID FROM THE RUL TABLE             * 08810006
085400*---------------------------------------------------------------* 08820006
085500     EXEC SQL                                                     08830006
085600        DECLARE TRT_RULE_ID_CUR CURSOR                            08840006
085700          FOR                                                     08850006
085800            SELECT RUL_ID                                         08860006
085900            FROM   TRT_RUL                                        08870006
086000             WHERE  RUL_TYP_CDE       = :TRT00014-RUL-TYP-CDE     08880006
086100               AND  RUL_CDE           = :TRT00014-RUL-CDE         08890006
086200               AND  RUL_BEG_DTE       = :ASC-WEEK-FROM-DTE        08900006
086300               AND  RUL_END_DTE       = :ASC-WEEK-TO-DTE          08910006
086400     END-EXEC.                                                    08920006
086500*---------------------------------------------------------------* 08930006
086600*    CURSOR TO SELECT CONTAINER RULES                             08940006
086700*---------------------------------------------------------------* 08950006
086800     EXEC SQL                                                     08960006
086900        DECLARE TRT_CONT_RULE_CUR CURSOR FOR                      08970006
087000            SELECT RUL_ID                                         08980006
087100            FROM   TRT_RUL                                        08990006
087200             WHERE  RUL_TYP_CDE       = :PV-RUL-TYPE              09000006
087300               AND  RUL_CDE           = 'CONT'                    09010006
087400               AND  RUL_BEG_DTE       = :ASC-WEEK-FROM-DTE        09020006
087500               AND  RUL_END_DTE       = :ASC-WEEK-TO-DTE          09030006
087600     END-EXEC.                                                    09040006
087700                                                                  09050006
087800*---------------------------------------------------------------* 09060006
087900*    CURSOR TO SELECT VESSEL    RULES                             09070006
088000*---------------------------------------------------------------* 09080006
088100     EXEC SQL                                                     09090006
088200        DECLARE TRT_VSL_RULE_CUR CURSOR FOR                       09100006
088300            SELECT RUL_ID                                         09110006
088400            FROM   TRT_RUL                                        09120006
088500             WHERE  RUL_TYP_CDE       = :PV-RUL-TYPE              09130006
088600               AND  RUL_CDE           = 'VSL'                     09140006
088700               AND  RUL_BEG_DTE       = :ASC-WEEK-FROM-DTE        09150006
088800               AND  RUL_END_DTE       = :ASC-WEEK-TO-DTE          09160006
088900     END-EXEC.                                                    09170006
089000                                                                  09180006
089100*---------------------------------------------------------------* 09190006
089200 EJECT                                                            09200006
089300*----------------------------------------------------------------*09210006
089400 LINKAGE SECTION.                                                 09220006
089500                                                                  09230006
089600 01  DFHCOMMAREA.                                                 09240006
089700     05  FILLER                         OCCURS  1 TO 4072 TIMES   09250006
089800                                        DEPENDING ON EIBCALEN.    09260006
089900         10  FILLER                     PIC X.                    09270006
090000                                                                  09280006
090100 EJECT                                                            09290006
090200*----------------------------------------------------------------*09300006
090300 PROCEDURE DIVISION.                                              09310006
090400*----------------------------------------------------------------*09320006
090500*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM.  *09330006
090600*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM   *09340006
090700*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT.  *09350006
090800*----------------------------------------------------------------*09360006
090900 0000-MAIN-MODULE.                                                09370006
091000                                                                  09380006
091100     INITIALIZE DP030-CICS-API-FIELDS.                            09390006
091200     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       09400006
091300     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          09410006
091400     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         09420006
091500     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       09430006
091600     MOVE LENGTH OF TR322AI        TO DP030-MAP-LENGTH (1).       09440006
091700     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     09450006
091800     PERFORM 0001-CALL-CICS-ARCH-API.                             09460006
091900*                                                                 09470006
092000     PERFORM 1000-CONTROL-PROCESSING.                             09480006
092100*                                                                 09490006
092200     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     09500006
092300     PERFORM 0001-CALL-CICS-ARCH-API.                             09510006
092400                                                                  09520006
092500*----------------------------------------------------------------*09530006
092600*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *09540006
092700*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *09550006
092800*----------------------------------------------------------------*09560006
092900 0001-CALL-CICS-ARCH-API.                                         09570006
093000                                                                  09580006
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      09590024
093200                                    DFHCOMMAREA                   09600024
093300                                    DP030-CICS-API-FIELDS         09610024
093400                                    DP020-STANDARD-COMMAREA       09620024
093500                                    TR322AI.                      09630024
093600*                                                                 09640006
093700     IF  DP030-RC-CALL-SUCCESSFUL                                 09650006
093800         CONTINUE                                                 09660006
093900     ELSE                                                         09670006
094000         SET DP013-NO-ROLLBACK                                    09680006
094100             DP013-XCTL-DISPLAY-RESTART                           09690006
094200             DP013-CICS-ABEND      TO TRUE                        09700006
094300         MOVE '0001-CALL-CICS-ARCH-API'                           09710006
094400                                   TO DP013-PARAGRAPH             09720006
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O09730024
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      09740024
094700         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      09750006
094800         PERFORM DP013-0000-PROCESS-ABEND                         09760006
094900     END-IF.                                                      09770006
095000                                                                  09780006
095100 EJECT                                                            09790006
095200*----------------------------------------------------------------*09800006
095300* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *09810006
095400* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *09820006
095500*                                                                *09830006
095600* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *09840006
095700*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *09850006
095800*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *09860006
095900*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *09870006
096000*----------------------------------------------------------------*09880006
096100 1000-CONTROL-PROCESSING.                                         09890006
096200                                                                  09900006
096300     EVALUATE TRUE                                                09910006
096400         WHEN DP020-NEXT-ACT-INITIAL                              09920006
096500             INITIALIZE ASC-SPECIFIC-COMMAREA                     09930006
096600             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            09940006
096700                                      ASC-SEL-TERM-ID             09950006
096800             MOVE DP020-SRC-TASK-NUMBER                           09960006
096900                                   TO ASC-LIST-TASK-NUMBER        09970006
097000                                      ASC-SEL-TASK-NUMBER         09980006
097100             MOVE PC-LIST-QUEUE-SEQ                               09990006
097200                                   TO ASC-LIST-SEQ                10000006
097300             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 10010006
097400             PERFORM 1100-PROCESS-INTER-APPL-COMM                 10020006
097500*-------$TEMPLATE NOTE$------------------------------------------*10030006
097600* IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION, *10040006
097700* SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO   *10050006
097800* TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED. *10060006
097900*----------------------------------------------------------------*10070006
098000             IF  PS-COMMAREA-NOT-VALID                            10080006
098100                 SET DP020-NEXT-ACT-APPL-ERROR                    10090006
098200                                   TO TRUE                        10100006
098300             ELSE                                                 10110006
098400                 PERFORM 4000-BUILD-INITIAL-PANEL                 10120006
098500             END-IF                                               10130006
098600                                                                  10140006
098700         WHEN DP020-NEXT-ACT-READ-MAP                             10150006
098800             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        10160006
098900                                   TO PV-TOP-ITEM                 10170006
099000             PERFORM 2000-PROCESS-PANEL                           10180006
099100                                                                  10190006
099200         WHEN DP020-NEXT-ACT-RETURN                               10200006
099300             MOVE ASC-VIEW          TO PV-VIEW                    10210006
099400             MOVE ASC-RUL-TYP       TO PV-RUL-TYP                 10220006
099500             MOVE ASC-POE-CDE       TO PV-POE-CDE                 10230006
099600             MOVE ASC-WEEK-FROM-DTE TO PV-WEEK-FROM-DTE           10240006
099700             MOVE ASC-WEEK-TO-DTE   TO PV-WEEK-TO-DTE             10250006
099800             PERFORM 2050-DELETE-LIST-QUEUE                       10260006
099900             PERFORM 4000-BUILD-INITIAL-PANEL                     10270006
100000                                                                  10280006
100100         WHEN OTHER                                               10290006
100200             SET DP013-LOGIC-ABEND TO TRUE                        10300006
100300             SET DP013-NO-ROLLBACK TO TRUE                        10310006
100400             MOVE '1000-CONTROL-PROCESSING'                       10320006
100500                                   TO DP013-PARAGRAPH             10330006
100600             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    10340006
100700                                   TO DP013-MESSAGE-TEXT(1)       10350006
100800             PERFORM DP013-0000-PROCESS-ABEND                     10360006
100900     END-EVALUATE.                                                10370006
101000                                                                  10380006
101100 EJECT                                                            10390006
101200*----------------------------------------------------------------*10400006
101300* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *10410006
101400* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *10420006
101500*----------------------------------------------------------------*10430006
101600 1100-PROCESS-INTER-APPL-COMM.                                    10440006
101700                                                                  10450006
101800     SET PS-COMMAREA-VALID         TO TRUE.                       10460006
101900     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     10470006
102000     MOVE TR320-VIEW               TO ASC-VIEW                    10480006
102100                                      PV-VIEW.                    10490006
102200     MOVE TR320-POE-CDE            TO ASC-POE-CDE                 10500006
102300                                      PV-POE-CDE.                 10510006
102400                                                                  10520006
102500     MOVE TR320-WEEK-FROM-DTE       TO PV-WEEK-FROM-DTE           10530006
102600                                       ASC-WEEK-FROM-DTE.         10540006
102700     MOVE TR320-WEEK-TO-DTE         TO PV-WEEK-TO-DTE             10550006
102800                                       ASC-WEEK-TO-DTE.           10560006
102900                                                                  10570006
103000 EJECT                                                            10580006
103100*----------------------------------------------------------------*10590006
103200* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITING OF THE DATA    *10600006
103300* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *10610006
103400* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *10620006
103500* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *10630006
103600* FUNCTION KEYS CAN GET THIS FAR.                                *10640006
103700*----------------------------------------------------------------*10650006
103800 2000-PROCESS-PANEL.                                              10660006
103900                                                                  10670006
104000     EVALUATE TRUE                                                10680006
104100         WHEN DP020-SRC-AID = DP016-CLEAR                         10690006
104200             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    10700006
104300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   10710006
104400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10720006
104500                                                                  10730006
104600         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    10740006
104700             MOVE ASC-VIEW          TO PV-VIEW                    10750006
104800             MOVE ASC-RUL-TYP       TO PV-RUL-TYP                 10760006
104900             MOVE ASC-POE-CDE       TO PV-POE-CDE                 10770006
105000             MOVE ASC-WEEK-FROM-DTE TO PV-WEEK-FROM-DTE           10780006
105100             MOVE ASC-WEEK-TO-DTE   TO PV-WEEK-TO-DTE             10790006
105200             PERFORM 2050-DELETE-LIST-QUEUE                       10800006
105300             PERFORM 4000-BUILD-INITIAL-PANEL                     10810006
105400                                                                  10820006
105500         WHEN OTHER                                               10830006
105600             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 10840006
105700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   10850006
105800             IF  PS-NO-ERROR                                      10860006
105900                 SET DP030-CONTINUE-GO                            10870006
106000                                 TO TRUE                          10880006
106100                 PERFORM 2100-CHECK-FUNCTION-KEY                  10890006
106200             ELSE                                                 10900006
106300                 SET DP030-OVERRIDE-GO                            10910006
106400                                 TO TRUE                          10920006
106500             END-IF                                               10930006
106600     END-EVALUATE.                                                10940006
106700                                                                  10950006
106800 EJECT                                                            10960006
106900*----------------------------------------------------------------*10970006
107000*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *10980006
107100*----------------------------------------------------------------*10990006
107200 2050-DELETE-LIST-QUEUE.                                          11000006
107300                                                                  11010006
107400     EXEC CICS                                                    11020006
107500         DELETEQ TS                                               11030006
107600             QUEUE (ASC-LIST-QUEUE-NAME)                          11040006
107700             RESP  (PV-CICS-RESP)                                 11050006
107800     END-EXEC.                                                    11060006
107900                                                                  11070006
108000     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       11080006
108100        (PV-CICS-RESP = DFHRESP(QIDERR))                          11090006
108200         CONTINUE                                                 11100006
108300     ELSE                                                         11110006
108400         SET DP013-CICS-ABEND      TO TRUE                        11120006
108500         SET DP013-NO-ROLLBACK     TO TRUE                        11130006
108600                                                                  11140006
108700         MOVE '2050-DELETE-LIST-QUEUE'                            11150006
108800                                   TO DP013-PARAGRAPH             11160006
108900         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    11170006
109000                                   TO DP013-MESSAGE-TEXT (1)      11180006
109100         PERFORM DP013-0000-PROCESS-ABEND                         11190006
109200     END-IF.                                                      11200006
109300                                                                  11210006
109400     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  11220006
109500                                                                  11230006
109600 EJECT                                                            11240006
109700*----------------------------------------------------------------*11250006
109800* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*11260006
109900* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *11270006
110000* CICS ARCHITECTURE API.                                         *11280006
110100*----------------------------------------------------------------*11290006
110200 2100-CHECK-FUNCTION-KEY.                                         11300006
110300                                                                  11310006
110400     EVALUATE TRUE                                                11320006
110500****** NAVIGATE TO MAINT SCREEN                                   11330006
110600         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              11340006
110700             IF ASC-NUMBER-OF-SELECTED-ITEMS = 1                  11350006
110800                 PERFORM 4850-MAINT-EDITS-1                       11360006
110900                 IF PS-NO-ERROR                                   11370006
111000                     INITIALIZE TR320-INTER-APPL-COMMAREA         11380006
111100                     MOVE ASC-POE-CDE                             11390006
111200                                   TO TR320-POE-CDE               11400006
111300                     MOVE ASC-WEEK-FROM-DTE                       11410006
111400                                   TO TR320-WEEK-FROM-DTE         11420006
111500                     MOVE ASC-WEEK-TO-DTE                         11430006
111600                                   TO TR320-WEEK-TO-DTE           11440006
111700                     PERFORM 5000-PREPARE-SEL-QUEUE               11450006
111800**RK                 PERFORM 4860-MAINT-EDITS-2                   11460006
111900                     IF PS-NO-ERROR                               11470006
112000                         SET DP030-CONTINUE-GO TO TRUE            11480006
112100                     ELSE                                         11490006
112200                         SET DP030-OVERRIDE-GO TO TRUE            11500006
112300                     END-IF                                       11510006
112400                 END-IF                                           11520006
112500             ELSE                                                 11530006
112600                 IF ASC-NUMBER-OF-SELECTED-ITEMS > 1              11540006
112700                     SET DP030-OVERRIDE-GO TO TRUE                11550006
112800                     MOVE PC-TSYMSG-00047  TO                     11560006
112900                                    DP020-MSG-NUMBER              11570006
113000                     SET DP020-MSG-WARNING TO TRUE                11580006
113100                 ELSE                                             11590006
113200                     IF ASC-NUMBER-OF-SELECTED-ITEMS = 0          11600006
113300                         SET DP030-OVERRIDE-GO TO TRUE            11610006
113400                         MOVE PC-TSYMSG-00057  TO                 11620006
113500                                        DP020-MSG-NUMBER          11630006
113600                         SET DP020-MSG-WARNING TO TRUE            11640006
113700                     END-IF                                       11650006
113800                 END-IF                                           11660006
113900             END-IF                                               11670006
114000                                                                  11680006
114100*        ***** NAVIGATE TO CONTAINER LIST (TRKCS162) SCREEN       11690006
114200         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              11700006
114300             IF ASC-NUMBER-OF-SELECTED-ITEMS = 1                  11710006
114400                 INITIALIZE TR320-INTER-APPL-COMMAREA             11720006
114500                 MOVE ASC-POE-CDE                                 11730006
114600                               TO TR320-POE-CDE                   11740006
114700                 MOVE ASC-WEEK-FROM-DTE                           11750006
114800                               TO TR320-WEEK-FROM-DTE             11760006
114900                 MOVE ASC-WEEK-TO-DTE                             11770006
115000                               TO TR320-WEEK-TO-DTE               11780006
115100                 PERFORM 5000-PREPARE-SEL-QUEUE                   11790006
115200             ELSE                                                 11800006
115300                 IF  ASC-NUMBER-OF-SELECTED-ITEMS > 1             11810006
115400                     SET DP030-OVERRIDE-GO     TO TRUE            11820006
115500                     MOVE PC-TSYMSG-00047      TO DP020-MSG-NUMBER11830006
115600                     SET DP020-MSG-WARNING     TO TRUE            11840006
115700                 ELSE                                             11850006
115800                     IF  ASC-NUMBER-OF-SELECTED-ITEMS = 0         11860006
115900                         SET DP030-OVERRIDE-GO TO TRUE            11870006
116000                         MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER11880006
116100                         SET DP020-MSG-WARNING TO TRUE            11890006
116200                     END-IF                                       11900006
116300                 END-IF                                           11910006
116400             END-IF                                               11920006
116500                                                                  11930006
116600                                                                  11940006
116700*        ***** NAVIGATE TO SUMMARY SCREEN                         11950006
116800         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              11960006
116900             PERFORM 2140-DESELECT-ALL-ITEMS                      11970006
117000             INITIALIZE TR320-INTER-APPL-COMMAREA                 11980006
117100             MOVE ASC-POE-CDE                                     11990006
117200                           TO TR320-POE-CDE                       12000006
117300             MOVE ASC-WEEK-FROM-DTE                               12010006
117400                           TO TR320-WEEK-FROM-DTE                 12020006
117500             MOVE ASC-WEEK-TO-DTE                                 12030006
117600                           TO TR320-WEEK-TO-DTE                   12040006
117700                                                                  12050006
117800                                                                  12060006
117900*        ***** NAVIGATE TO DECONSOLIDATION/RELEASE SCREEN         12070006
118000         WHEN DP020-FK-LOCAL-FUNC-11 (DP020-SRC-AID)              12080006
118100             IF ASC-NUMBER-OF-SELECTED-ITEMS = 1                  12090006
118200                 INITIALIZE TR119-INTER-APPL-COMMAREA             12100006
118300                 PERFORM 5000-PREPARE-SEL-QUEUE                   12110006
118400                 IF TR119-PO-NBR > ZEROES                         12120006
118500                     PERFORM 2180-SELECT-DCONRLSE-DATA            12130006
118600                 ELSE                                             12140006
118700                     SET DP030-OVERRIDE-GO TO TRUE                12150006
118800                     MOVE PC-TSYMSG-00050  TO DP020-MSG-NUMBER    12160006
118900                     SET DP020-MSG-WARNING TO TRUE                12170006
119000                 END-IF                                           12180006
119100             ELSE                                                 12190006
119200                 IF  ASC-NUMBER-OF-SELECTED-ITEMS > 1             12200006
119300                     SET DP030-OVERRIDE-GO     TO TRUE            12210006
119400                     MOVE PC-TSYMSG-00047      TO DP020-MSG-NUMBER12220006
119500                     SET DP020-MSG-WARNING     TO TRUE            12230006
119600                 ELSE                                             12240006
119700                     IF  ASC-NUMBER-OF-SELECTED-ITEMS = 0         12250006
119800                         SET DP030-OVERRIDE-GO TO TRUE            12260006
119900                         MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER12270006
120000                         SET DP020-MSG-WARNING TO TRUE            12280006
120100                     END-IF                                       12290006
120200                 END-IF                                           12300006
120300             END-IF                                               12310006
120400                                                                  12320006
120500*        ***** SET TABLES FOR DC SPLITS RETRAN                    12330006
120600         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              12340006
120700             PERFORM 2170-CHECK-RACF-ACCESS                       12350006
120800             IF DP008-ACCESS-DENIED                               12360006
120900*              -- NO SECURITY CLEARANCE FOR FUNCTION --           12370006
121000                 MOVE PC-TSYMSG-01061                             12380006
121100                                 TO DP020-MSG-NUMBER              12390006
121200                 SET PS-ERROR                                     12400006
121300                     DP020-MSG-WARNING                            12410006
121400                     DP030-OVERRIDE-GO TO TRUE                    12420006
121500*                    DP020-NEXT-ACT-APPL-ERROR                    12430006
121600*                            TO TRUE                              12440006
121700             ELSE                                                 12450006
121800                 PERFORM 4690-CHECK-VIEW-FOR-RETRANS              12460006
121900                 IF PS-NO-ERROR                                   12470006
122000                     PERFORM 5000-PREPARE-SEL-QUEUE               12480006
122100                     PERFORM 4700-SPLITS-RETRAN                   12490006
122200                     IF PS-NO-ERROR                               12500006
122300                         SET DP030-CONTINUE-GO TO TRUE            12510006
122400                     ELSE                                         12520006
122500                         SET DP030-OVERRIDE-GO TO TRUE            12530006
122600                     END-IF                                       12540006
122700                 ELSE                                             12550006
122800                     SET DP030-OVERRIDE-GO TO TRUE                12560006
122900                 END-IF                                           12570006
123000             END-IF                                               12580006
123100                                                                  12590006
123200                                                                  12600006
123300*        ***** SWITCH TO DEFAULT VIEW                             12610006
123400         WHEN DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)              12620006
123500         MOVE 'DEFAULT'                TO ASC-VIEW                12630006
123600                                          PV-VIEW                 12640006
123700         MOVE 'DEF'                    TO PV-RUL-TYP              12650006
123800                                          ASC-RUL-TYP             12660006
123900         MOVE ASC-POE-CDE              TO PV-POE-CDE              12670006
124000         MOVE ASC-WEEK-FROM-DTE        TO PV-WEEK-FROM-DTE        12680006
124100         MOVE ASC-WEEK-TO-DTE          TO PV-WEEK-TO-DTE          12690006
124200         PERFORM 2050-DELETE-LIST-QUEUE                           12700006
124300         PERFORM 4000-BUILD-INITIAL-PANEL                         12710006
124400                                                                  12720006
124500*        ***** SWITCH TO WORKING VIEW                             12730006
124600         WHEN DP020-FK-LOCAL-FUNC-06 (DP020-SRC-AID)              12740006
124700         MOVE 'WORKING'                TO ASC-VIEW                12750006
124800                                          PV-VIEW                 12760006
124900         MOVE 'WKG'                    TO PV-RUL-TYP              12770006
125000                                          ASC-RUL-TYP             12780006
125100         MOVE ASC-POE-CDE              TO PV-POE-CDE              12790006
125200         MOVE ASC-WEEK-FROM-DTE        TO PV-WEEK-FROM-DTE        12800006
125300         MOVE ASC-WEEK-TO-DTE          TO PV-WEEK-TO-DTE          12810006
125400         PERFORM 2050-DELETE-LIST-QUEUE                           12820006
125500         PERFORM 4000-BUILD-INITIAL-PANEL                         12830006
125600                                                                  12840006
125700*        ***** SWITCH TO ADJUSTED VIEW                            12850006
125800         WHEN DP020-FK-LOCAL-FUNC-07 (DP020-SRC-AID)              12860006
125900         MOVE 'ADJUSTED'               TO ASC-VIEW                12870006
126000                                          PV-VIEW                 12880006
126100         MOVE 'ADJ'                    TO PV-RUL-TYP              12890006
126200                                          ASC-RUL-TYP             12900006
126300         MOVE ASC-POE-CDE              TO PV-POE-CDE              12910006
126400         MOVE ASC-WEEK-FROM-DTE        TO PV-WEEK-FROM-DTE        12920006
126500         MOVE ASC-WEEK-TO-DTE          TO PV-WEEK-TO-DTE          12930006
126600         PERFORM 2050-DELETE-LIST-QUEUE                           12940006
126700         PERFORM 4000-BUILD-INITIAL-PANEL                         12950006
126800                                                                  12960006
126900         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  12970006
127000             MOVE +1               TO PV-TOP-ITEM                 12980006
127100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12990006
127200             PERFORM 3200-RESET-ATTRIBUTES                        13000006
127300                                                                  13010006
127400         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   13020006
127500             PERFORM 2110-BROWSE-BACKWARD                         13030006
127600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13040006
127700             PERFORM 3200-RESET-ATTRIBUTES                        13050006
127800                                                                  13060006
127900         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   13070006
128000             PERFORM 2120-BROWSE-FORWARD                          13080006
128100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13090006
128200                                                                  13100006
128300         WHEN DP020-SRC-AID = DP016-ENTER                         13110006
128400             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   13120006
128500             IF  PS-ERROR                                         13130006
128600                 CONTINUE                                         13140006
128700             ELSE                                                 13150006
128800                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             13160006
128900                 PERFORM 3200-RESET-ATTRIBUTES                    13170006
129000             END-IF                                               13180006
129100                                                                  13190006
129200         WHEN OTHER                                               13200006
129300             SET DP013-NO-ROLLBACK                                13210006
129400                 DP013-XCTL-DISPLAY-RESTART                       13220006
129500                 DP013-CICS-ABEND  TO TRUE                        13230006
129600             MOVE '2100-CHECK-FUNCTION-KEY'                       13240006
129700                                   TO DP013-PARAGRAPH             13250006
129800             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      13260006
129900                                   TO DP013-MESSAGE-TEXT (1)      13270006
130000             PERFORM DP013-0000-PROCESS-ABEND                     13280006
130100     END-EVALUATE.                                                13290006
130200                                                                  13300006
130300 EJECT                                                            13310006
130400*----------------------------------------------------------------*13320006
130500*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *13330006
130600*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *13340006
130700*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *13350006
130800*    MESSAGE.                                                    *13360006
130900*----------------------------------------------------------------*13370006
131000 2110-BROWSE-BACKWARD.                                            13380006
131100                                                                  13390006
131200     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    13400006
131300         GIVING PV-TOP-ITEM.                                      13410006
131400*                                                                 13420006
131500     IF  ((PV-TOP-ITEM < +1)                                      13430006
131600       OR (PV-TOP-ITEM = +1))                                     13440006
131700         MOVE +1                   TO PV-TOP-ITEM                 13450006
131800*------- TOP OF LIST -----                                        13460006
131900         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            13470006
132000         SET DP020-MSG-INFORMATIONAL TO TRUE                      13480006
132100     END-IF.                                                      13490006
132200                                                                  13500006
132300 EJECT                                                            13510006
132400*----------------------------------------------------------------*13520006
132500*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *13530006
132600*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *13540006
132700*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *13550006
132800*----------------------------------------------------------------*13560006
132900 2120-BROWSE-FORWARD.                                             13570006
133000                                                                  13580006
133100     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              13590006
133200         GIVING PV-TOP-ITEM.                                      13600006
133300     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   13610006
133400         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            13620006
133500                                   TO PV-TOP-ITEM                 13630006
133600*------- BOTTOM OF LIST -----------                               13640006
133700         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            13650006
133800         SET DP020-MSG-INFORMATIONAL                              13660006
133900                                   TO TRUE                        13670006
134000     ELSE                                                         13680006
134100         COMPUTE PV-BOTTOM-ITEM =                                 13690006
134200             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 13700006
134300         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            13710006
134400*----------- BOTTOM OF LIST ---------                             13720006
134500             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            13730006
134600             SET DP020-MSG-INFORMATIONAL                          13740006
134700                                   TO TRUE                        13750006
134800         END-IF                                                   13760006
134900     END-IF.                                                      13770006
135000                                                                  13780006
135100 EJECT                                                            13790006
135200*----------------------------------------------------------------*13800006
135300*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *13810006
135400*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *13820006
135500*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *13830006
135600*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *13840006
135700*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *13850006
135800*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *13860006
135900*----------------------------------------------------------------*13870006
136000 2130-CHECK-FOR-JUMP-BROWSE.                                      13880006
136100                                                                  13890006
136200     SET PS-NO-ERROR               TO TRUE.                       13900006
136300     IF  (ASC-START-ITEM-REQUEST = SPACE)                         13910006
136400         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            13920006
136500                                   TO PV-TOP-ITEM                 13930006
136600     ELSE                                                         13940006
136700         MOVE ASC-START-ITEM-REQUEST                              13950006
136800                                   TO DP010I-UNEDITED-FIELD       13960006
136900         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       13970006
137000         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     13980006
137100         SET DP010I-NEGATIVE-NOT-ALLOWED                          13990006
137200                                   TO TRUE                        14000006
263697         CALL DP010I-NUMERIC-EDIT-ROUTINE                         14011023
263697              USING DP010I-NUMERIC-EDIT-AREA                      14012023
137400                                                                  14020006
137500         IF  NOT DP010I-ERROR-DETECTED                            14030006
137600             MOVE DP010I-NUMERIC-FIELD                            14040006
137700                                   TO  ASC-START-ITEM-REQUEST-N   14050006
137800             IF  ASC-START-ITEM-REQUEST-N > ZERO                  14060006
137900                 IF  ASC-START-ITEM-REQUEST-N >                   14070006
138000                                          ASC-NUMBER-OF-ITEMS-READ14080006
138100                     MOVE SPACE TO ASC-START-ITEM-REQUEST         14090006
138200                     COMPUTE PV-TOP-ITEM =                        14100006
138300                             ASC-NUMBER-OF-ITEMS-READ             14110006
138400                             - PC-ITEMS-PER-PANEL + 1             14120006
138500                     IF  PV-TOP-ITEM < +1                         14130006
138600                         MOVE +1   TO PV-TOP-ITEM                 14140006
138700                         MOVE PC-TSYMSG-00070                     14150006
138800                                   TO DP020-MSG-NUMBER            14160006
138900                         SET DP020-MSG-INFORMATIONAL              14170006
139000                                   TO TRUE                        14180006
139100                     END-IF                                       14190006
139200                 ELSE                                             14200006
139300                     MOVE ASC-START-ITEM-REQUEST-N                14210006
139400                                   TO PV-TOP-ITEM                 14220006
139500                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      14230006
139600                     COMPUTE PV-BOTTOM-ITEM =                     14240006
139700                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     14250006
139800                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ14260006
139900*----------------------- BOTTOM OF LIST --------------            14270006
140000                         MOVE PC-TSYMSG-00070                     14280006
140100                                   TO DP020-MSG-NUMBER            14290006
140200                         SET DP020-MSG-INFORMATIONAL              14300006
140300                                   TO TRUE                        14310006
140400                     END-IF                                       14320006
140500                 END-IF                                           14330006
140600             ELSE                                                 14340006
140700*--------------- VALUE OUT OF RANGE ------------------            14350006
140800                 MOVE PC-TSYMSG-00101                             14360006
140900                                   TO DP020-MSG-NUMBER            14370006
141000                 MOVE -1           TO ASTRTITL                    14380006
141100                 SET DP030-SET-CURSOR-APPL-1                      14390006
141200                                   TO TRUE                        14400006
141300                 MOVE DP015-REVERSE                               14410006
141400                                   TO ASTRTITH                    14420006
141500                 MOVE DP015-RED    TO ASTRTITC                    14430006
141600                 MOVE DP015-UNP-NUM-BRT-MDT                       14440006
141700                                   TO ASTRTITA                    14450006
141800                 SET DP020-MSG-FATAL                              14460006
141900                                   TO TRUE                        14470006
142000                 SET PS-ERROR      TO TRUE                        14480006
142100             END-IF                                               14490006
142200                                                                  14500006
142300         ELSE                                                     14510006
142400             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            14520006
142500             MOVE -1               TO ASTRTITL                    14530006
142600             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  14540006
142700             MOVE DP015-REVERSE    TO ASTRTITH                    14550006
142800             MOVE DP015-RED        TO ASTRTITC                    14560006
142900             MOVE DP015-UNP-NUM-BRT-MDT                           14570006
143000                                   TO ASTRTITA                    14580006
143100             SET DP020-MSG-FATAL   TO TRUE                        14590006
143200             SET PS-ERROR          TO TRUE                        14600006
143300         END-IF                                                   14610006
143400     END-IF.                                                      14620006
143500                                                                  14630006
143600 EJECT                                                            14640006
143700*----------------------------------------------------------------*14650006
143800*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *14660006
143900*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *14670006
144000*----------------------------------------------------------------*14680006
144100 2140-DESELECT-ALL-ITEMS.                                         14690006
144200                                                                  14700006
144300     MOVE +1                       TO ASC-BLK-SUB.                14710006
144400                                                                  14720006
144500     PERFORM 2141-CLEAR-SELECTED-INDS                             14730006
144600         VARYING ASC-ITEM-SUB                                     14740006
144700         FROM 1 BY 1                                              14750006
144800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14760006
144900                                                                  14770006
145000     ADD +1                        TO ASC-BLK-SUB.                14780006
145100                                                                  14790006
145200     PERFORM 2141-CLEAR-SELECTED-INDS                             14800006
145300         VARYING ASC-ITEM-SUB                                     14810006
145400         FROM 1 BY 1                                              14820006
145500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14830006
145600                                                                  14840006
145700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               14850006
145800                                   TO PV-LIST-ITEM-NUMBER.        14860006
145900                                                                  14870006
146000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            14880006
146100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    14890006
146200                                                                  14900006
146300     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     14910006
146400        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      14920006
146500         MOVE +1                   TO ASC-BLK-SUB                 14930006
146600                                                                  14940006
146700         PERFORM 5100-WRITE-TEMP-STORAGE                          14950006
146800                                                                  14960006
146900         MOVE +1                   TO PV-BLOCK-NUMBER             14970006
147000                                                                  14980006
147100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         14990006
147200             PV-FIRST-BLOCK-IN-ARRAY - 1                          15000006
147300                                                                  15010006
147400         PERFORM                                                  15020006
147500             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       15030006
147600                                                                  15040006
147700             PERFORM 4410-READ-TEMP-STORAGE                       15050006
147800                                                                  15060006
147900             PERFORM 2141-CLEAR-SELECTED-INDS                     15070006
148000                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 15080006
148100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15090006
148200                                                                  15100006
148300             PERFORM 5100-WRITE-TEMP-STORAGE                      15110006
148400                                                                  15120006
148500             ADD +1                TO PV-BLOCK-NUMBER             15130006
148600                                                                  15140006
148700         END-PERFORM                                              15150006
148800                                                                  15160006
148900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         15170006
149000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     15180006
149100                                                                  15190006
149200         PERFORM                                                  15200006
149300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       15210006
149400                   ASC-HIGHEST-BLOCK-WRITTEN                      15220006
149500                                                                  15230006
149600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          15240006
149700                                   TO PV-BLOCK-NUMBER             15250006
149800                                                                  15260006
149900             PERFORM 4410-READ-TEMP-STORAGE                       15270006
150000                                                                  15280006
150100             PERFORM 2141-CLEAR-SELECTED-INDS                     15290006
150200                 VARYING ASC-ITEM-SUB                             15300006
150300                 FROM 1 BY 1                                      15310006
150400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15320006
150500                                                                  15330006
150600             PERFORM 5100-WRITE-TEMP-STORAGE                      15340006
150700                                                                  15350006
150800             ADD +1  TO PV-NEXT-BLOCK-IN-ARRAY                    15360006
150900                                                                  15370006
151000         END-PERFORM                                              15380006
151100                                                                  15390006
151200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             15400006
151300                                   TO PV-BLOCK-NUMBER             15410006
151400                                                                  15420006
151500         PERFORM 4410-READ-TEMP-STORAGE                           15430006
151600     END-IF.                                                      15440006
151700                                                                  15450006
151800     MOVE +0       TO ASC-NUMBER-OF-SELECTED-ITEMS                15460006
151900                      ASC-START-OF-SELECTED-RANGE                 15470006
152000                      ASC-END-OF-SELECTED-RANGE.                  15480006
152100                                                                  15490006
152200     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        15500006
152300                                                                  15510006
152400 EJECT                                                            15520006
152500*----------------------------------------------------------------*15530006
152600*    MARK EACH ITEM AS BEING NOT SELECTED.                       *15540006
152700*----------------------------------------------------------------*15550006
152800 2141-CLEAR-SELECTED-INDS.                                        15560006
152900                                                                  15570006
153000     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           15580006
153100             NOT EQUAL ZERO                                       15590006
153200         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15600006
153300             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15610006
153400                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    15620006
153500                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  15630006
153600                                   TO TRUE                        15640006
153700         END-IF                                                   15650006
153800     END-IF.                                                      15660006
153900                                                                  15670006
154000 EJECT                                                            15680006
154100*----------------------------------------------------------------*15690006
154200*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *15700006
154300*  FOR ALL ITEMS.                                                *15710006
154400*----------------------------------------------------------------*15720006
154500 2150-SELECT-ALL-ITEMS.                                           15730006
154600                                                                  15740006
154700     MOVE +1                       TO ASC-BLK-SUB.                15750006
154800                                                                  15760006
154900     PERFORM 2151-SET-SELECTED-INDS                               15770006
155000         VARYING ASC-ITEM-SUB                                     15780006
155100         FROM 1 BY 1                                              15790006
155200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15800006
155300                                                                  15810006
155400     ADD +1                        TO ASC-BLK-SUB.                15820006
155500                                                                  15830006
155600     PERFORM 2151-SET-SELECTED-INDS                               15840006
155700         VARYING ASC-ITEM-SUB                                     15850006
155800         FROM 1 BY 1                                              15860006
155900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15870006
156000                                                                  15880006
156100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               15890006
156200                                   TO PV-LIST-ITEM-NUMBER.        15900006
156300                                                                  15910006
156400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            15920006
156500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    15930006
156600                                                                  15940006
156700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     15950006
156800        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    15960006
156900         MOVE +1                   TO ASC-BLK-SUB                 15970006
157000                                                                  15980006
157100         PERFORM 5100-WRITE-TEMP-STORAGE                          15990006
157200                                                                  16000006
157300         MOVE +1                   TO PV-BLOCK-NUMBER             16010006
157400                                                                  16020006
157500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         16030006
157600             PV-FIRST-BLOCK-IN-ARRAY - 1                          16040006
157700                                                                  16050006
157800         PERFORM                                                  16060006
157900             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       16070006
158000                                                                  16080006
158100             PERFORM 4410-READ-TEMP-STORAGE                       16090006
158200                                                                  16100006
158300             PERFORM 2151-SET-SELECTED-INDS                       16110006
158400                 VARYING ASC-ITEM-SUB                             16120006
158500                 FROM 1 BY 1                                      16130006
158600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16140006
158700                                                                  16150006
158800             PERFORM 5100-WRITE-TEMP-STORAGE                      16160006
158900                                                                  16170006
159000             ADD +1                TO PV-BLOCK-NUMBER             16180006
159100                                                                  16190006
159200         END-PERFORM                                              16200006
159300                                                                  16210006
159400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         16220006
159500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     16230006
159600                                                                  16240006
159700         PERFORM                                                  16250006
159800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       16260006
159900                   ASC-HIGHEST-BLOCK-WRITTEN                      16270006
160000                                                                  16280006
160100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          16290006
160200                                   TO PV-BLOCK-NUMBER             16300006
160300                                                                  16310006
160400             PERFORM 4410-READ-TEMP-STORAGE                       16320006
160500                                                                  16330006
160600             PERFORM 2151-SET-SELECTED-INDS                       16340006
160700                 VARYING ASC-ITEM-SUB                             16350006
160800                 FROM 1 BY 1                                      16360006
160900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16370006
161000                                                                  16380006
161100             PERFORM 5100-WRITE-TEMP-STORAGE                      16390006
161200                                                                  16400006
161300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      16410006
161400                                                                  16420006
161500         END-PERFORM                                              16430006
161600                                                                  16440006
161700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             16450006
161800                                   TO PV-BLOCK-NUMBER             16460006
161900                                                                  16470006
162000         PERFORM 4410-READ-TEMP-STORAGE                           16480006
162100     END-IF.                                                      16490006
162200                                                                  16500006
162300     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             16510006
162400                       ASC-NUMBER-OF-SELECTED-ITEMS.              16520006
162500                                                                  16530006
162600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        16540006
162700                                                                  16550006
162800 EJECT                                                            16560006
162900*----------------------------------------------------------------*16570006
163000*    MARK EACH ITEM AS BEING SELECTED.                           *16580006
163100*----------------------------------------------------------------*16590006
163200 2151-SET-SELECTED-INDS.                                          16600006
163300                                                                  16610006
163400     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           16620006
163500             NOT EQUAL ZERO                                       16630006
163600         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             16640006
163700             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             16650006
163800                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        16660006
163900                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  16670006
164000                               TO  TRUE                           16680006
164100         END-IF                                                   16690006
164200     END-IF.                                                      16700006
164300                                                                  16710006
164400 EJECT                                                            16720006
164500***************************************************************   16730006
164600*  CHECK RACF FUNCTION GROUP                                      16740006
164700***************************************************************   16750006
164800                                                                  16760006
164900 2170-CHECK-RACF-ACCESS.                                          16770006
165000     SET DP008-RSRC-TYPE-FUNC     TO TRUE                         16780006
165100     MOVE 'TRDCNUPF'              TO DP008-FUNCTION-NAME          16790006
165200     SET DP008-ACCESS-TYPE-USE    TO TRUE                         16800006
165300                                                                  16810006
165400     EXEC CICS                                                    16820006
165500        LINK PROGRAM (DP008-SECURITY-SUBROUTINE)                  16830006
165600             COMMAREA (DP008-SECURITY-COMMAREA)                   16840006
165700             LENGTH (DP008-SECURITY-COMMAREA-LENGTH)              16850006
165800     END-EXEC                                                     16860006
165900                                                                  16870006
166000     IF DP008-CALL-SUCCESSFUL                                     16880006
166100         CONTINUE                                                 16890006
166200     ELSE                                                         16900006
166300        MOVE '2170-CHECK-RACF-ACCESS'                             16910006
166400                              TO DP013-PARAGRAPH                  16920006
166500         MOVE 'UNABLE TO ACCESS CICS'                             16930006
166600                              TO DP013-MESSAGE-TEXT (1)           16940006
166700         MOVE SQLCA           TO DP013-SQLCA                      16950006
166800         SET DP013-DB2-ABEND                                      16960006
166900             DP013-XCTL-DISPLAY-RESTART                           16970006
167000                              TO TRUE                             16980006
167100         PERFORM DP013-0000-PROCESS-ABEND                         16990006
167200     END-IF.                                                      17000006
167300                                                                  17010006
167400 EJECT                                                            17020006
167500*----------------------------------------------------------------*17030006
167600*    SELECT DATA NEEDED TO TRANSFER TO DCONRLSE SCREEN.          *17040006
167700*----------------------------------------------------------------*17050006
167800 2180-SELECT-DCONRLSE-DATA.                                       17060006
167900                                                                  17070006
168000     EXEC SQL                                                     17080006
168100        SELECT A.DEPT_NBR                                         17090006
168200             , B.ENT_NAME_DESC                                    17100006
168300             , C.STATUS_DESC                                      17110006
168400         INTO  :PURCHS-DEPT-NBR                                   17120006
168500             , :ENTNME-ENT-NAME-DESC                              17130006
168600             , :STATCD-STATUS-DESC                                17140006
168700         FROM   TPURCHS A                                         17150006
168800              , TENTNME B                                         17160006
168900              , TSTATCD C                                         17170006
169000         WHERE  A.PO_NBR = :TR119-PO-NBR                          17180006
169100           AND  A.VER_STATUS_CDE = 'A'                            17190006
169200           AND  A.ENT_ID = B.ENT_ID                               17200006
169300           AND  B.TYPE_CDE = '01'                                 17210006
169400           AND  A.STATUS_CDE = C.STATUS_CDE                       17220006
169500           AND  C.STATUS_TYP_CDE = 'P'                            17230006
169600     END-EXEC.                                                    17240006
169700                                                                  17250006
169800     EVALUATE TRUE                                                17260006
169900         WHEN SQLCODE = ZERO                                      17270006
170000             MOVE PURCHS-DEPT-NBR      TO TR119-DEPT-NBR          17280006
170100             MOVE ENTNME-ENT-NAME-DESC TO TR119-VENDOR-NAME       17290006
170200             MOVE STATCD-STATUS-DESC   TO TR119-STATUS            17300006
170300         WHEN SQLCODE = +100                                      17310006
170400         WHEN SQLCODE = -811                                      17320006
170500             MOVE SPACES TO TR119-VENDOR-NAME                     17330006
170600                            TR119-DEPT-NBR                        17340006
170700                            TR119-STATUS                          17350006
170800         WHEN SQLWARN0 NOT = SPACE                                17360006
170900         WHEN SQLCODE NOT = ZERO                                  17370006
171000              MOVE '2180-SELECT-DCONRLSE-DATA'                    17380006
171100                               TO DP013-PARAGRAPH                 17390006
171200              MOVE 'SQL ERROR SELECTING DCONRLSE DATA'            17400006
171300                               TO DP013-MESSAGE-TEXT (1)          17410006
171400              MOVE SQLCA       TO DP013-SQLCA                     17420006
171500              SET DP013-DB2-ABEND                                 17430006
171600                               TO TRUE                            17440006
171700              PERFORM DP013-0000-PROCESS-ABEND                    17450006
171800     END-EVALUATE.                                                17460006
171900                                                                  17470006
172000 EJECT                                                            17480006
172100*----------------------------------------------------------------*17490006
172200*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *17500006
172300*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *17510006
172400*----------------------------------------------------------------*17520006
172500 2200-MOVE-SCREEN-TO-COMMAREA.                                    17530006
172600                                                                  17540006
172700     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             17550006
172800     MOVE +1                       TO PV-SUB.                     17560006
172900*                                                                 17570006
173000     PERFORM 3100-SET-SUBSCRIPTS.                                 17580006
173100     IF  ASTRTITL > ZERO                                          17590006
173200         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          17600006
173300     ELSE                                                         17610006
173400         IF  ASTRTITF = DP015-ERASE-EOF                           17620006
173500             INITIALIZE ASC-START-ITEM-REQUEST                    17630006
173600         END-IF                                                   17640006
173700     END-IF.                                                      17650006
173800     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          17660006
173900         VARYING PV-SUB                                           17670006
174000         FROM 1 BY 1                                              17680006
174100         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      17690006
174200                                                                  17700006
174300 EJECT                                                            17710006
174400*----------------------------------------------------------------*17720006
174500*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *17730006
174600*----------------------------------------------------------------*17740006
174700 2210-MOVE-LINES-TO-COMMAREA.                                     17750006
174800                                                                  17760006
174900     IF  MR-SELECTL (PV-SUB) > ZERO                               17770006
175000         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             17780006
175100         MOVE MR-SELECTI (PV-SUB)                                 17790006
175200                                   TO ASC-TEMP-SELECTED-SW        17800006
175300                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      17810006
175400     ELSE                                                         17820006
175500         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                17830006
175600                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     17840006
175700                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        17850006
175800                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      17860006
175900         END-IF                                                   17870006
176000     END-IF.                                                      17880006
176100     ADD +1                        TO ASC-ITEM-SUB.               17890006
176200     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        17900006
176300         ADD  +1                   TO ASC-BLK-SUB                 17910006
176400         MOVE +1                   TO ASC-ITEM-SUB                17920006
176500     END-IF.                                                      17930006
176600                                                                  17940006
176700 EJECT                                                            17950006
176800*----------------------------------------------------------------*17960006
176900*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *17970006
177000*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *17980006
177100*----------------------------------------------------------------*17990006
177200 3000-EDIT-DATA-IN-COMMAREA.                                      18000006
177300                                                                  18010006
177400     SET PS-NO-ERROR               TO TRUE.                       18020006
177500     PERFORM 3200-RESET-ATTRIBUTES.                               18030006
177600     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     18040006
177700*----------------------------------------------------------------*18050006
177800* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.             *18060006
177900* EDITTING IS DONE FROM THE BOTTOM UP.                           *18070006
178000*----------------------------------------------------------------*18080006
178100     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       18090006
178200         ASC-ITEMS-DISPLAYED - 1.                                 18100006
178300     PERFORM 3100-SET-SUBSCRIPTS.                                 18110006
178400     PERFORM 3300-EDIT-SELECTIONS                                 18120006
178500         VARYING PV-SUB                                           18130006
178600         FROM PV-SUB BY -1                                        18140006
178700         UNTIL PV-SUB < +1.                                       18150006
178800*                                                                 18160006
178900     IF ASC-NUMBER-OF-SELECTED-ITEMS > 1                          18170006
179000        SET DP030-OVERRIDE-GO     TO TRUE                         18180006
179100        MOVE PC-TSYMSG-00047      TO DP020-MSG-NUMBER             18190006
179200        SET DP020-MSG-WARNING     TO TRUE                         18200006
179300        SET PS-ERROR              TO TRUE                         18210006
179400     END-IF.                                                      18220006
179500*                                                                 18230006
179600     IF  PS-NO-ERROR                                              18240006
179700         PERFORM 3400-CHECK-RANGE-SEQUENCE                        18250006
179800     END-IF.                                                      18260006
179900*                                                                 18270006
180000     IF  ((PS-NO-ERROR)                                           18280006
180100       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   18290006
180200       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    18300006
180300             PERFORM 3500-MARK-RANGE-AS-SELECTED                  18310006
180400     END-IF.                                                      18320006
180500                                                                  18330006
180600 EJECT                                                            18340006
180700*----------------------------------------------------------------*18350006
180800*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *18360006
180900*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY. THIS WILL *18370006
181000*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *18380006
181100*                                                                *18390006
181200*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *18400006
181300*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *18410006
181400*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *18420006
181500*    US IN THE 2ND BLOCK OF THE ARRAY.                           *18430006
181600*----------------------------------------------------------------*18440006
181700 3100-SET-SUBSCRIPTS.                                             18450006
181800                                                                  18460006
181900     COMPUTE ASC-ITEM-SUB =                                       18470006
182000         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        18480006
182100                                                                  18490006
182200     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         18500006
182300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            18510006
182400                                                                  18520006
182500         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               18530006
182600     ELSE                                                         18540006
182700         MOVE +1                     TO ASC-BLK-SUB               18550006
182800     END-IF.                                                      18560006
182900                                                                  18570006
183000 EJECT                                                            18580006
183100*----------------------------------------------------------------*18590006
183200*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *18600006
183300*----------------------------------------------------------------*18610006
183400 3200-RESET-ATTRIBUTES.                                           18620006
183500                                                                  18630006
183600     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   18640006
183700     MOVE DP015-GREEN              TO ASTRTITC.                   18650006
183800     MOVE DP015-UNDERLINE          TO ASTRTITH.                   18660006
183900*                                                                 18670006
184000     PERFORM                                                      18680006
184100         VARYING PV-SUB                                           18690006
184200         FROM 1 BY 1                                              18700006
184300         UNTIL PV-SUB > (PC-ITEMS-PER-PANEL  OR                   18710006
184400                         ASC-ITEMS-DISPLAYED)                     18720006
184500         MOVE DP015-UNP-ALP-NOR-OFF                               18730006
184600                                   TO MR-SELECTA (PV-SUB)         18740006
184700         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         18750006
184800         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         18760006
184900     END-PERFORM.                                                 18770006
185000                                                                  18780006
185100 EJECT                                                            18790006
185200*----------------------------------------------------------------*18800006
185300*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *18810006
185400*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *18820006
185500*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *18830006
185600*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *18840006
185700*----------------------------------------------------------------*18850006
185800 3300-EDIT-SELECTIONS.                                            18860006
185900                                                                  18870006
186000     EVALUATE TRUE                                                18880006
186100         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     18890006
186200             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         18900006
186300                 CONTINUE                                         18910006
186400         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         18920006
186500             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        18930006
186600                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   18940006
186700                 MOVE ASC-TEMP-SELECTED-SW                        18950006
186800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18960006
186900                                TO ASC-SELECTED-SW                18970006
187000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18980006
187100             END-IF                                               18990006
187200         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     19000006
187300                                = SPACE                           19010006
187400             EVALUATE TRUE                                        19020006
187500                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       19030006
187600                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS19040006
187700                     MOVE SPACE TO ASC-SELECTED-SW                19050006
187800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19060006
187900                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        19070006
188000                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    19080006
188100                     MOVE SPACE TO ASC-SELECTED-SW                19090006
188200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19100006
188300                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          19110006
188400                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      19120006
188500                     MOVE SPACE TO ASC-SELECTED-SW                19130006
188600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19140006
188700             END-EVALUATE                                         19150006
188800         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           19160006
188900             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            19170006
189000                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    19180006
189100             END-IF                                               19190006
189200             PERFORM 3310-EDIT-RANGE                              19200006
189300         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             19210006
189400             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            19220006
189500                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    19230006
189600             END-IF                                               19240006
189700             PERFORM 3310-EDIT-RANGE                              19250006
189800         WHEN OTHER                                               19260006
189900             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           19270006
190000             SET DP020-MSG-FATAL    TO TRUE                       19280006
190100             MOVE -1                TO MR-SELECTL (PV-SUB)        19290006
190200             SET DP030-SET-CURSOR-APPL-1                          19300006
190300                                    TO TRUE                       19310006
190400             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        19320006
190500             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        19330006
190600             SET PS-ERROR TO TRUE                                 19340006
190700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            19350006
190800                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     19360006
190900                 MOVE SPACE         TO ASC-SELECTED-SW            19370006
191000                                        (ASC-BLK-SUB ASC-ITEM-SUB)19380006
191100             END-IF                                               19390006
191200     END-EVALUATE.                                                19400006
191300                                                                  19410006
191400     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 19420006
191500     SUBTRACT +1 FROM ASC-ITEM-SUB.                               19430006
191600     IF  ASC-ITEM-SUB < 1                                         19440006
191700         SUBTRACT +1 FROM ASC-BLK-SUB                             19450006
191800         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                19460006
191900     END-IF.                                                      19470006
192000                                                                  19480006
192100 EJECT                                                            19490006
192200*----------------------------------------------------------------*19500006
192300*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *19510006
192400*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *19520006
192500*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *19530006
192600*  THE ENDING.                                                   *19540006
192700*----------------------------------------------------------------*19550006
192800 3310-EDIT-RANGE.                                                 19560006
192900                                                                  19570006
193000     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                19580006
193100         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   19590006
193200             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)19600006
193300                                   TO ASC-SELECTED-SW             19610006
193400                                        (ASC-BLK-SUB ASC-ITEM-SUB)19620006
193500             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 19630006
193600         ELSE                                                     19640006
193700             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     19650006
193800                 CONTINUE                                         19660006
193900             ELSE                                                 19670006
194000*--------------- ONLY ONE BEGINNING-OF-RANGE-ALLOWED ---          19680006
194100                 MOVE PC-TSYMSG-00054                             19690006
194200                                   TO DP020-MSG-NUMBER            19700006
194300                 SET DP020-MSG-FATAL                              19710006
194400                                   TO TRUE                        19720006
194500                 MOVE -1           TO MR-SELECTL (PV-SUB)         19730006
194600                 SET DP030-SET-CURSOR-APPL-1                      19740006
194700                                   TO TRUE                        19750006
194800                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         19760006
194900                 MOVE DP015-UNDERLINE                             19770006
195000                                   TO MR-SELECTH (PV-SUB)         19780006
195100                 SET PS-ERROR      TO TRUE                        19790006
195200             END-IF                                               19800006
195300         END-IF                                                   19810006
195400     ELSE                                                         19820006
195500         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     19830006
195600             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 19840006
195700                                   TO ASC-SELECTED-SW             19850006
195800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   19860006
195900             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   19870006
196000         ELSE                                                     19880006
196100             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       19890006
196200                 CONTINUE                                         19900006
196300             ELSE                                                 19910006
196400*--------------- ONLY ONE END-OF-RANGE ALLOWED -------            19920006
196500                 MOVE PC-TSYMSG-00055                             19930006
196600                                   TO DP020-MSG-NUMBER            19940006
196700                 SET DP020-MSG-FATAL                              19950006
196800                                   TO TRUE                        19960006
196900                 MOVE -1           TO MR-SELECTL (PV-SUB)         19970006
197000                 SET DP030-SET-CURSOR-APPL-1                      19980006
197100                                   TO TRUE                        19990006
197200                 SET PS-ERROR      TO TRUE                        20000006
197300             END-IF                                               20010006
197400         END-IF                                                   20020006
197500     END-IF.                                                      20030006
197600                                                                  20040006
197700 EJECT                                                            20050006
197800*----------------------------------------------------------------*20060006
197900*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *20070006
198000*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *20080006
198100*----------------------------------------------------------------*20090006
198200 3400-CHECK-RANGE-SEQUENCE.                                       20100006
198300                                                                  20110006
198400     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       20120006
198500       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      20130006
198600       AND  ASC-START-OF-SELECTED-RANGE >                         20140006
198700                                         ASC-END-OF-SELECTED-RANGE20150006
198800*------- END-OF-RANGE BEFORE BEGINNING-OF-RANGE --                20160006
198900         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 20170006
199000         SET DP020-MSG-FATAL TO TRUE                              20180006
199100         SET PS-ERROR TO TRUE                                     20190006
199200         PERFORM 3410-POSITION-AT-ERROR                           20200006
199300     END-IF.                                                      20210006
199400                                                                  20220006
199500 EJECT                                                            20230006
199600*----------------------------------------------------------------*20240006
199700*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *20250006
199800*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *20260006
199900*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *20270006
200000*----------------------------------------------------------------*20280006
200100 3410-POSITION-AT-ERROR.                                          20290006
200200                                                                  20300006
200300     SET DP030-SET-CURSOR-APPL-1                                  20310006
200400                                   TO TRUE.                       20320006
200500     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 20330006
200600                    - PV-TOP-ITEM + 1.                            20340006
200700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      20350006
200800         CONTINUE                                                 20360006
200900     ELSE                                                         20370006
201000         MOVE -1                   TO MR-SELECTL (PV-SUB)         20380006
201100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         20390006
201200         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         20400006
201300     END-IF.                                                      20410006
201400*                                                                 20420006
201500     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   20430006
201600                    - PV-TOP-ITEM + 1.                            20440006
201700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      20450006
201800         CONTINUE                                                 20460006
201900     ELSE                                                         20470006
202000         MOVE -1                   TO MR-SELECTL (PV-SUB)         20480006
202100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         20490006
202200         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         20500006
202300     END-IF.                                                      20510006
202400                                                                  20520006
202500 EJECT                                                            20530006
202600*----------------------------------------------------------------*20540006
202700*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *20550006
202800*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *20560006
202900*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *20570006
203000*----------------------------------------------------------------*20580006
203100 3500-MARK-RANGE-AS-SELECTED.                                     20590006
203200                                                                  20600006
203300     MOVE +1                       TO  ASC-BLK-SUB.               20610006
203400     PERFORM 3510-MARK-SELECTED-INDS                              20620006
203500         VARYING ASC-ITEM-SUB                                     20630006
203600         FROM 1 BY 1                                              20640006
203700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 20650006
203800                                                                  20660006
203900     ADD +1                        TO ASC-BLK-SUB.                20670006
204000     PERFORM 3510-MARK-SELECTED-INDS                              20680006
204100         VARYING ASC-ITEM-SUB                                     20690006
204200         FROM 1 BY 1                                              20700006
204300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 20710006
204400                                                                  20720006
204500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               20730006
204600                                   TO  PV-LIST-ITEM-NUMBER.       20740006
204700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            20750006
204800         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         20760006
204900               PC-ITEMS-PER-PANEL).                               20770006
205000                                                                  20780006
205100     MOVE ASC-START-OF-SELECTED-RANGE                             20790006
205200                                   TO PV-START-OF-SELECTED-RANGE. 20800006
205300     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            20810006
205400         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  20820006
205500               PC-ITEMS-PER-PANEL).                               20830006
205600                                                                  20840006
205700     MOVE ASC-END-OF-SELECTED-RANGE                               20850006
205800                                   TO  PV-END-OF-SELECTED-RANGE.  20860006
205900     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             20870006
206000         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    20880006
206100               PC-ITEMS-PER-PANEL).                               20890006
206200     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             20900006
206300         PV-FIRST-BLOCK-IN-ARRAY + 1.                             20910006
206400                                                                  20920006
206500     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    20930006
206600        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        20940006
206700         MOVE +1                   TO ASC-BLK-SUB                 20950006
206800         PERFORM 5100-WRITE-TEMP-STORAGE                          20960006
206900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         20970006
207000             PV-FIRST-BLOCK-IN-ARRAY - 1                          20980006
207100                                                                  20990006
207200         PERFORM                                                  21000006
207300             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      21010006
207400                   PV-PREV-BLOCK-IN-ARRAY                         21020006
207500             MOVE PV-FIRST-BLOCK-IN-RANGE                         21030006
207600                                   TO PV-BLOCK-NUMBER             21040006
207700             PERFORM 4410-READ-TEMP-STORAGE                       21050006
207800             PERFORM 3510-MARK-SELECTED-INDS                      21060006
207900                 VARYING ASC-ITEM-SUB                             21070006
208000                 FROM 1 BY 1                                      21080006
208100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          21090006
208200             PERFORM 5100-WRITE-TEMP-STORAGE                      21100006
208300             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     21110006
208400         END-PERFORM                                              21120006
208500                                                                  21130006
208600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         21140006
208700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     21150006
208800         PERFORM                                                  21160006
208900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       21170006
209000                   PV-LAST-BLOCK-IN-RANGE                         21180006
209100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          21190006
209200                                   TO PV-BLOCK-NUMBER             21200006
209300             PERFORM 4410-READ-TEMP-STORAGE                       21210006
209400             PERFORM 3510-MARK-SELECTED-INDS                      21220006
209500                 VARYING ASC-ITEM-SUB                             21230006
209600                 FROM 1 BY 1                                      21240006
209700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          21250006
209800             PERFORM 5100-WRITE-TEMP-STORAGE                      21260006
209900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      21270006
210000         END-PERFORM                                              21280006
210100                                                                  21290006
210200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             21300006
210300                                   TO PV-BLOCK-NUMBER             21310006
210400         PERFORM 4410-READ-TEMP-STORAGE                           21320006
210500     END-IF.                                                      21330006
210600                                                                  21340006
210700     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 21350006
210800                                      ASC-END-OF-SELECTED-RANGE.  21360006
210900                                                                  21370006
211000 EJECT                                                            21380006
211100*----------------------------------------------------------------*21390006
211200* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *21400006
211300*----------------------------------------------------------------*21410006
211400 3510-MARK-SELECTED-INDS.                                         21420006
211500                                                                  21430006
211600     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         21440006
211700                                ASC-ITEM-SUB) >                   21450006
211800         ASC-START-OF-SELECTED-RANGE)                             21460006
211900     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         21470006
212000                                ASC-ITEM-SUB) =                   21480006
212100         ASC-START-OF-SELECTED-RANGE)                             21490006
212200                                                                  21500006
212300         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     21510006
212400                                    ASC-ITEM-SUB) <               21520006
212500             ASC-END-OF-SELECTED-RANGE)                           21530006
212600         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     21540006
212700                                    ASC-ITEM-SUB) =               21550006
212800             ASC-END-OF-SELECTED-RANGE)                           21560006
212900                                                                  21570006
213000             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          21580006
213100                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   21590006
213200                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   21600006
213300                               TO TRUE                            21610006
213400                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              21620006
213500                               TO TRUE                            21630006
213600                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    21640006
213700             END-IF                                               21650006
213800         END-IF                                                   21660006
213900     END-IF.                                                      21670006
214000                                                                  21680006
214100 EJECT                                                            21690006
214200*----------------------------------------------------------------*21700006
214300*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *21710006
214400*    INITIALIZE ALL COUNTERS AND FLAGS.                          *21720006
214500*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *21730006
214600*    DISPLAY THE PANEL TO USER.                                  *21740006
214700*----------------------------------------------------------------*21750006
214800 4000-BUILD-INITIAL-PANEL.                                        21760006
214900                                                                  21770006
215000     INITIALIZE                 ASC-BLOCK-ENTRIES (1)             21780006
215100                                ASC-BLOCK-ENTRIES (2)             21790006
215200                                PV-TOT-CONT-CARTS                 21800006
215300                                PV-TOT-CONT-CBM.                  21810006
215400     MOVE +1                 TO ASC-BLK-SUB                       21820006
215500                                ASC-ITEM-SUB.                     21830006
215600     SET ASC-ITEMS-LEFT-ON-DB                                     21840006
215700                             TO TRUE.                             21850006
215800                                                                  21860006
215900     MOVE +0                 TO ASC-NUMBER-OF-ITEMS-READ          21870006
216000                                ASC-NUMBER-OF-SELECTED-ITEMS      21880006
216100                                ASC-HIGHEST-BLOCK-WRITTEN         21890006
216200                                ASC-START-OF-SELECTED-RANGE       21900006
216300                                ASC-END-OF-SELECTED-RANGE         21910006
216400                                ASC-ITEM-AT-TOP-OF-PANEL.         21920006
216500                                                                  21930006
216600     PERFORM 4010-OPEN-CONT-CURSOR.                               21940006
216700     PERFORM 4300-PROCESS-CONT-CUR.                               21950006
216800     PERFORM 4020-CLOSE-CONT-CURSOR.                              21960006
216900                                                                  21970006
217000     MOVE +1                   TO  PV-TOP-ITEM.                   21980006
217100     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          21990006
217200         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    22000006
217300         SET DP020-MSG-FATAL   TO  TRUE                           22010006
217400*------- PURCHASE ORDER DOES NOT EXIST -----                      22020006
217500         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               22030006
217600     ELSE                                                         22040006
217700         MOVE -1               TO MR-SELECTL (1)                  22050006
217800         SET DP030-SET-CURSOR-APPL-1                              22060006
217900                               TO TRUE                            22070006
218000         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     22080006
218100     END-IF.                                                      22090006
218200                                                                  22100006
218300 EJECT                                                            22110006
218400*----------------------------------------------------------------*22120006
218500*   OPEN CONTAINER CURSOR                                        *22130006
218600*----------------------------------------------------------------*22140006
218700 4010-OPEN-CONT-CURSOR.                                           22150006
218800                                                                  22160006
218900     PERFORM                                                      22170006
219000         WITH TEST AFTER                                          22180006
219100         VARYING PV-RETRY-COUNTER                                 22190006
219200         FROM 1 BY 1                                              22200006
219300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               22210006
219400             OR (SQLCODE = ZERO))                                 22220006
219500                                                                  22230006
219600            EXEC SQL                                              22240006
219700               OPEN CONT_CUR                                      22250006
219800            END-EXEC                                              22260006
219900                                                                  22270006
220000*                                                                 22280006
220100         EVALUATE TRUE                                            22290006
220200             WHEN SQLCODE = ZERO                                  22300006
220300             WHEN SQLCODE = -904                                  22310006
220400             WHEN SQLCODE = -913                                  22320006
220500                 CONTINUE                                         22330006
220600             WHEN SQLWARN0 NOT = SPACES                           22340006
220700             WHEN SQLCODE < ZERO                                  22350006
220800             WHEN SQLCODE > ZERO                                  22360006
220900                 MOVE '4010-OPEN-CONT-CURSOR'                     22370006
221000                                   TO DP013-PARAGRAPH             22380006
221100                 MOVE 'FROM AND TO DATES - '                      22390006
221200                                   TO DP013-MESSAGE-TEXT (1)      22400006
221300                 MOVE PV-WEEK-FROM-DTE                            22410006
221400                                   TO DP013-MESSAGE-TEXT (2)      22420006
221500                 MOVE PV-WEEK-TO-DTE                              22430006
221600                                   TO DP013-MESSAGE-TEXT (3)      22440006
221700                 MOVE SQLCA        TO DP013-SQLCA                 22450006
221800                 MOVE 'TRT_RUL '   TO DP013-DB2-TABLE-NAME (1)    22460006
221900                 SET DP013-DB2-ABEND                              22470006
222000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           22480006
222100                 PERFORM DP013-0000-PROCESS-ABEND                 22490006
222200         END-EVALUATE                                             22500006
222300     END-PERFORM.                                                 22510006
222400*                                                                 22520006
222500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        22530006
222600         MOVE '4010-OPEN-CONT-CURSOR' TO DP013-PARAGRAPH          22540006
222700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   22550006
222800                                   TO DP013-MESSAGE-TEXT (1)      22560006
222900         MOVE SQLCA                TO DP013-SQLCA                 22570006
223000         MOVE 'TRT_RUL '           TO DP013-DB2-TABLE-NAME (1)    22580006
223100         SET DP013-DB2-ABEND                                      22590006
223200             DP013-XCTL-DISPLAY-RESTART                           22600006
223300                                   TO TRUE                        22610006
223400         PERFORM DP013-0000-PROCESS-ABEND                         22620006
223500     END-IF.                                                      22630006
223600                                                                  22640006
223700 EJECT                                                            22650006
223800*----------------------------------------------------------------*22660006
223900*   CLOSE CONTAINER CURSOR.                                      *22670006
224000*----------------------------------------------------------------*22680006
224100 4020-CLOSE-CONT-CURSOR.                                          22690006
224200                                                                  22700006
224300     EXEC SQL                                                     22710006
224400        CLOSE CONT_CUR                                            22720006
224500     END-EXEC                                                     22730006
224600                                                                  22740006
224700*                                                                 22750006
224800     EVALUATE TRUE                                                22760006
224900         WHEN SQLCODE = ZERO                                      22770006
225000             CONTINUE                                             22780006
225100         WHEN SQLWARN0 NOT = SPACES                               22790006
225200         WHEN SQLCODE < ZERO                                      22800006
225300         WHEN SQLCODE > ZERO                                      22810006
225400             MOVE '4020-CLOSE-CONT-CURSOR'                        22820006
225500                               TO DP013-PARAGRAPH                 22830006
225600             MOVE 'CLOSE CONTNR CURSOR '                          22840006
225700                               TO DP013-MESSAGE-TEXT (1)          22850006
225800             MOVE SQLCA        TO DP013-SQLCA                     22860006
225900             MOVE 'TRT_RUL '   TO DP013-DB2-TABLE-NAME (1)        22870006
226000             SET DP013-DB2-ABEND                                  22880006
226100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               22890006
226200             PERFORM DP013-0000-PROCESS-ABEND                     22900006
226300     END-EVALUATE.                                                22910006
226400                                                                  22920006
226500 EJECT                                                            22930006
226600*----------------------------------------------------------------*22940006
226700*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *22950006
226800*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *22960006
226900*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *22970006
227000*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *22980006
227100*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *22990006
227200*                                                                *23000006
227300*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *23010006
227400*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *23020006
227500*    UPON INITIALIZATION.                                        *23030006
227600*----------------------------------------------------------------*23040006
227700 4300-PROCESS-CONT-CUR.                                           23050006
227800                                                                  23060006
227900     PERFORM                                                      23070006
228000         UNTIL ASC-NO-ITEMS-LEFT-ON-DB                            23080006
228100                                                                  23090006
228200         PERFORM 4310-FETCH-CONT                                  23100006
228300                                                                  23110006
228400         IF ASC-ITEMS-LEFT-ON-DB                                  23120006
228500             MOVE PV-CONT-CUR-RUL-ID    TO TRT00015-RUL-ID        23130006
228600                                                                  23140006
228700             MOVE 'VSL     '  TO TRT00015-RUL-CNSTR-TYP-CDE       23150006
228800             PERFORM  4320-SELECT-RUL-CONSRAINT                   23160006
228900             MOVE TRT00015-RUL-CNSTR-VAL-TXT                      23170006
229000                                   TO  PV-VESSEL                  23180006
229100                                                                  23190006
229200             MOVE 'VOY     ' TO TRT00015-RUL-CNSTR-TYP-CDE        23200006
229300             PERFORM  4320-SELECT-RUL-CONSRAINT                   23210006
229400             MOVE TRT00015-RUL-CNSTR-VAL-TXT                      23220006
229500                                   TO  PV-VOYAGE                  23230006
229600                                                                  23240006
229700             MOVE 'ETA     ' TO TRT00015-RUL-CNSTR-TYP-CDE        23250006
229800             PERFORM  4320-SELECT-RUL-CONSRAINT                   23260006
229900             MOVE TRT00015-RUL-CNSTR-VAL-TXT     TO PV-ETA-DATE   23270006
230000             MOVE TRT00015-RUL-CNSTR-VAL-TXT (6:2) TO PV-ETA-MM   23280006
230100             MOVE TRT00015-RUL-CNSTR-VAL-TXT (9:2) TO PV-ETA-DD   23290006
230200                                                                  23300006
230300             MOVE 'FOB     ' TO TRT00015-RUL-CNSTR-TYP-CDE        23310006
230400             PERFORM  4320-SELECT-RUL-CONSRAINT                   23320006
230500             MOVE TRT00015-RUL-CNSTR-VAL-TXT                      23330006
230600                                   TO  PV-FOB-CDE                 23340006
230700                                                                  23350006
230800             MOVE 'SEQ     ' TO TRT00015-RUL-CNSTR-TYP-CDE        23360006
230900             PERFORM  4320-SELECT-RUL-CONSRAINT                   23370006
231000             INITIALIZE PV-CONTNR-SEQ-NBR                         23380006
231100                        PV-FULL-SEQ-NBR                           23390006
231200             IF TRT00015-RUL-CNSTR-VAL-TXT (1:6) NUMERIC          23400006
231300                MOVE TRT00015-RUL-CNSTR-VAL-TXT (1:6)             23410006
231400                                   TO PV-CONTNR-SEQ-NBR           23420006
231500                MOVE TRT00015-RUL-CNSTR-VAL-TXT                   23430006
231600                                   TO PV-FULL-SEQ-NBR             23440006
231700             END-IF                                               23450006
231800                                                                  23460006
231900             MOVE 'DECN    ' TO TRT00015-RUL-CNSTR-TYP-CDE        23470006
232000             PERFORM  4320-SELECT-RUL-CONSRAINT                   23480006
232100             MOVE TRT00015-RUL-CNSTR-VAL-TXT                      23490006
232200                                   TO  PV-DEF-SCAC                23500006
232300                                                                  23510006
232400             INITIALIZE     PV-TOT-CONT-CARTS                     23520006
232500                            PV-TOT-CONT-CBM                       23530006
232600                            PV-READ-COUNT                         23540006
232700             PERFORM 4330-OPEN-PO-CURSOR                          23550006
232800             PERFORM 4350-PROCESS-PO-CUR                          23560006
232900                UNTIL PS-EOC-PO-CUR                               23570006
233000                  OR PV-READ-COUNT > PC-MAX-ITEMS                 23580006
233100             PERFORM 4340-CLOSE-PO-CURSOR                         23590006
233200                                                                  23600006
233300         END-IF                                                   23610006
233400     END-PERFORM.                                                 23620006
233500                                                                  23630006
233600     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          23640006
233700         MOVE +1               TO ASC-BLK-SUB                     23650006
233800         PERFORM 5100-WRITE-TEMP-STORAGE                          23660006
233900         ADD +1                TO ASC-BLK-SUB                     23670006
234000         PERFORM 5100-WRITE-TEMP-STORAGE                          23680006
234100                                                                  23690006
234200         MOVE 1                TO ASC-BLK-SUB                     23700006
234300                                  PV-BLOCK-NUMBER                 23710006
234400         PERFORM 4410-READ-TEMP-STORAGE                           23720006
234500         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             23730006
234600             MOVE 2            TO ASC-BLK-SUB                     23740006
234700                                  PV-BLOCK-NUMBER                 23750006
234800             PERFORM 4410-READ-TEMP-STORAGE                       23760006
234900         END-IF                                                   23770006
235000     END-IF.                                                      23780006
235100                                                                  23790006
235200 EJECT                                                            23800006
235300*----------------------------------------------------------------*23810006
235400*    FETCH THE VESSEL CURSOR.                                    *23820006
235500*----------------------------------------------------------------*23830006
235600 4310-FETCH-CONT.                                                 23840006
235700                                                                  23850006
235800     EXEC SQL                                                     23860006
235900         FETCH CONT_CUR                                           23870006
236000         INTO  :PV-CONT-CUR-RUL-ID                                23880006
236100             , :PV-CONT-CUR-CONTNR-ID                             23890006
236200     END-EXEC.                                                    23900006
236300                                                                  23910006
236400*                                                                 23920006
236500     EVALUATE TRUE                                                23930006
236600         WHEN SQLCODE = ZERO                                      23940006
236700         WHEN SQLCODE = +100                                      23950006
236800              CONTINUE                                            23960006
236900         WHEN SQLWARN0 NOT = SPACE                                23970006
237000         WHEN SQLCODE NOT = ZERO                                  23980006
237100              MOVE '4310-FETCH-CONT-CURSOR'                       23990006
237200                               TO DP013-PARAGRAPH                 24000006
237300              MOVE 'FETCH CONTNR CURSOR'                          24010006
237400                               TO DP013-MESSAGE-TEXT (1)          24020006
237500              MOVE SQLCA       TO DP013-SQLCA                     24030006
237600              SET DP013-DB2-ABEND                                 24040006
237700                               TO TRUE                            24050006
237800              PERFORM DP013-0000-PROCESS-ABEND                    24060006
237900     END-EVALUATE.                                                24070006
238000*                                                                 24080006
238100     IF  SQLCODE EQUAL +100                                       24090006
238200         SET ASC-NO-ITEMS-LEFT-ON-DB                              24100006
238300                                   TO TRUE                        24110006
238400     END-IF.                                                      24120006
238500                                                                  24130006
238600 EJECT                                                            24140006
238700*----------------------------------------------------------------*24150006
238800* GIVEN A RULE ID AND CONSTRAINT TYPE - SELECT THE CONSTRAINT.   *24160006
238900*----------------------------------------------------------------*24170006
239000 4320-SELECT-RUL-CONSRAINT.                                       24180006
239100                                                                  24190006
239200     MOVE SPACES TO TRT00015-RUL-CNSTR-VAL-TXT.                   24200006
239300                                                                  24210006
239400     PERFORM                                                      24220006
239500         WITH TEST AFTER                                          24230006
239600         VARYING PV-RETRY-COUNTER                                 24240006
239700         FROM 1 BY 1                                              24250006
239800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               24260006
239900            OR  (SQLCODE = ZERO)                                  24270006
240000            OR  (SQLCODE = +100))                                 24280006
240100                                                                  24290006
240200         EXEC SQL                                                 24300006
240300          SELECT RUL_CNSTR_VAL_TXT                                24310006
240400            INTO :TRT00015-RUL-CNSTR-VAL-TXT                      24320006
240500            FROM TRT_RUL_CNSTR                                    24330006
240600           WHERE RUL_ID            = :TRT00015-RUL-ID             24340006
240700             AND RUL_CNSTR_TYP_CDE = :TRT00015-RUL-CNSTR-TYP-CDE  24350006
240800         END-EXEC                                                 24360006
240900*                                                                 24370006
241000         EVALUATE TRUE                                            24380006
241100             WHEN SQLCODE = ZERO                                  24390006
241200             WHEN SQLCODE = +100                                  24400006
241300             WHEN SQLCODE = -904                                  24410006
241400             WHEN SQLCODE = -913                                  24420006
241500                 CONTINUE                                         24430006
241600             WHEN SQLWARN0 NOT = SPACES                           24440006
241700             WHEN SQLCODE < ZERO                                  24450006
241800             WHEN SQLCODE > ZERO                                  24460006
241900                 MOVE '4320-SELECT-RUL-CONSRAINT'                 24470006
242000                                   TO DP013-PARAGRAPH             24480006
242100                 MOVE TRT00015-RUL-CNSTR-TYP-CDE                  24490006
242200                                   TO DP013-MESSAGE-TEXT (1)      24500006
242300                 MOVE SQLCA        TO DP013-SQLCA                 24510006
242400                 MOVE 'TRT_RUL_CNSTR' TO DP013-DB2-TABLE-NAME (1) 24520006
242500                 SET DP013-DB2-ABEND                              24530006
242600                     DP013-XCTL-DISPLAY-RESTART TO TRUE           24540006
242700                 PERFORM DP013-0000-PROCESS-ABEND                 24550006
242800         END-EVALUATE                                             24560006
242900     END-PERFORM.                                                 24570006
243000*                                                                 24580006
243100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        24590006
243200         MOVE '4320-SELECT-RUL.. MAX RETRIES'                     24600006
243300                                     TO DP013-PARAGRAPH           24610006
243400         MOVE TRT00015-RUL-CNSTR-TYP-CDE                          24620006
243500                                   TO DP013-MESSAGE-TEXT (1)      24630006
243600         MOVE SQLCA                TO DP013-SQLCA                 24640006
243700         MOVE 'TRT_RUL_CNSTR' TO DP013-DB2-TABLE-NAME (1)         24650006
243800         SET DP013-DB2-ABEND                                      24660006
243900             DP013-XCTL-DISPLAY-RESTART                           24670006
244000                                   TO TRUE                        24680006
244100         PERFORM DP013-0000-PROCESS-ABEND                         24690006
244200     END-IF.                                                      24700006
244300*                                                                 24710006
244400*----------------------------------------------------------------*24720006
244500*   OPEN PO CURSOR                                               *24730006
244600*----------------------------------------------------------------*24740006
244700 4330-OPEN-PO-CURSOR.                                             24750006
244800                                                                  24760006
244900     PERFORM                                                      24770006
245000         WITH TEST AFTER                                          24780006
245100         VARYING PV-RETRY-COUNTER                                 24790006
245200         FROM 1 BY 1                                              24800006
245300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               24810006
245400             OR (SQLCODE = ZERO))                                 24820006
245500                                                                  24830006
245600            EXEC SQL                                              24840006
245700               OPEN PO_CUR                                        24850006
245800            END-EXEC                                              24860006
245900                                                                  24870006
246000*                                                                 24880006
246100         EVALUATE TRUE                                            24890006
246200             WHEN SQLCODE = ZERO                                  24900006
246300             WHEN SQLCODE = -904                                  24910006
246400             WHEN SQLCODE = -913                                  24920006
246500                 CONTINUE                                         24930006
246600             WHEN SQLWARN0 NOT = SPACES                           24940006
246700             WHEN SQLCODE < ZERO                                  24950006
246800             WHEN SQLCODE > ZERO                                  24960006
246900                 MOVE '4330-OPEN-PO-CURSOR'                       24970006
247000                                   TO DP013-PARAGRAPH             24980006
247100                 MOVE 'OPEN PO CURSOR - '                         24990006
247200                                   TO DP013-MESSAGE-TEXT (1)      25000006
247300                 MOVE SQLCA        TO DP013-SQLCA                 25010006
247400                 MOVE 'TRT_RUL '   TO DP013-DB2-TABLE-NAME (1)    25020006
247500                 SET DP013-DB2-ABEND                              25030006
247600                     DP013-XCTL-DISPLAY-RESTART TO TRUE           25040006
247700                 PERFORM DP013-0000-PROCESS-ABEND                 25050006
247800         END-EVALUATE                                             25060006
247900     END-PERFORM.                                                 25070006
248000*                                                                 25080006
248100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        25090006
248200         MOVE '4030-OPEN-PO-CURSOR' TO DP013-PARAGRAPH            25100006
248300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   25110006
248400                                   TO DP013-MESSAGE-TEXT (1)      25120006
248500         MOVE SQLCA                TO DP013-SQLCA                 25130006
248600         MOVE 'TRT_RUL_CNSTR'      TO DP013-DB2-TABLE-NAME (1)    25140006
248700         SET DP013-DB2-ABEND                                      25150006
248800             DP013-XCTL-DISPLAY-RESTART                           25160006
248900                                   TO TRUE                        25170006
249000         PERFORM DP013-0000-PROCESS-ABEND                         25180006
249100     END-IF.                                                      25190006
249200                                                                  25200006
249300     IF SQLCODE = ZERO                                            25210006
249400        SET PS-EOC-PO-CUR-NO TO TRUE                              25220006
249500     END-IF.                                                      25230006
249600                                                                  25240006
249700 EJECT                                                            25250006
249800*----------------------------------------------------------------*25260006
249900*   CLOSE PO CURSOR.                                             *25270006
250000*----------------------------------------------------------------*25280006
250100 4340-CLOSE-PO-CURSOR.                                            25290006
250200                                                                  25300006
250300     EXEC SQL                                                     25310006
250400        CLOSE PO_CUR                                              25320006
250500     END-EXEC                                                     25330006
250600                                                                  25340006
250700*                                                                 25350006
250800     EVALUATE TRUE                                                25360006
250900         WHEN SQLCODE = ZERO                                      25370006
251000             CONTINUE                                             25380006
251100         WHEN SQLWARN0 NOT = SPACES                               25390006
251200         WHEN SQLCODE < ZERO                                      25400006
251300         WHEN SQLCODE > ZERO                                      25410006
251400             MOVE '4340-CLOSE-PO-CURSOR'                          25420006
251500                               TO DP013-PARAGRAPH                 25430006
251600             MOVE 'CLOSE CONTNR CURSOR '                          25440006
251700                               TO DP013-MESSAGE-TEXT (1)          25450006
251800             MOVE SQLCA        TO DP013-SQLCA                     25460006
251900             MOVE 'TIMCNPO '   TO DP013-DB2-TABLE-NAME (1)        25470006
252000             SET DP013-DB2-ABEND                                  25480006
252100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               25490006
252200             PERFORM DP013-0000-PROCESS-ABEND                     25500006
252300     END-EVALUATE.                                                25510006
252400                                                                  25520006
252500*----------------------------------------------------------------*25530006
252600 4350-PROCESS-PO-CUR.                                             25540006
252700                                                                  25550006
252800     PERFORM 4360-FETCH-PO-CURSOR.                                25560006
252900     ADD +1 TO PV-READ-COUNT                                      25570006
253000               ASC-NUMBER-OF-ITEMS-READ.                          25580006
253100     MOVE ASC-NUMBER-OF-ITEMS-READ                                25590006
253200                         TO ASC-LIST-ITEM-NUMBER                  25600006
253300                                    (ASC-BLK-SUB ASC-ITEM-SUB).   25610006
253400                                                                  25620006
253500*    *********************************************************    25630006
253600*    * THIS DATA ALL COMES FROM THE CONT/PO CURSOR OR RULE   *    25640006
253700*    * CONSTRAINTS PREVIOUSLY SELECTED.  IT WILL BE STORED   *    25650006
253800*    * IN ASC EVEN IF WE'RE AT THE END OF THE PO CURSOR AND  *    25660006
253900*    * ARE BUILDING A CONTAINER TOTAL DATA.  THIS IS IN CASE *    25670006
254000*    * THE USER SELECTS A TOTAL LINE FROM THE LIST, WE WILL  *    25680006
254100*    * HAVE THE DATA NEEDED TO SEND TO THE MAINT SCREEN.     *    25690006
254200*    *********************************************************    25700006
254300     MOVE PV-VESSEL    TO ASC-VESSEL                              25710006
254400                                    (ASC-BLK-SUB ASC-ITEM-SUB).   25720006
254500     MOVE PV-VOYAGE    TO ASC-VOYAGE                              25730006
254600                                    (ASC-BLK-SUB ASC-ITEM-SUB).   25740006
254700     MOVE PV-ETA-MM-DD TO ASC-ETA-MM-DD                           25750006
254800                                    (ASC-BLK-SUB ASC-ITEM-SUB).   25760006
254900     MOVE PV-ETA-DATE  TO ASC-ETA-DATE                            25770006
255000                                    (ASC-BLK-SUB ASC-ITEM-SUB).   25780006
255100     MOVE PV-FOB-CDE   TO ASC-FOB-CDE                             25790006
255200                                    (ASC-BLK-SUB ASC-ITEM-SUB).   25800006
255300     MOVE PV-CONT-CUR-CONTNR-ID                                   25810006
255400                         TO ASC-CONTNR-ID                         25820006
255500                                    (ASC-BLK-SUB ASC-ITEM-SUB).   25830006
255600     MOVE PV-CONTNR-SEQ-NBR   TO ASC-CONTNR-SEQ-NBR               25840006
255700                                    (ASC-BLK-SUB ASC-ITEM-SUB).   25850006
255800                                                                  25860006
255900*    ************************************************************ 25870006
256000*    * AT END OF CURSOR STORE TOTALS PLUS OTHER SCAC INFO FROM  * 25880006
256100*    * THE LAST CONTAINER/PO LINE IN THE ASC AREA.  SOME DATA   * 25890006
256200*    * WILL BE MOVED TO THE SCREEN.  OTHER DATA IS BEING SAVED  * 25900006
256300*    * IN CASE THE TOTAL LINE IS SELECTED FO MAINT.             * 25910006
256400*    ************************************************************ 25920006
256500     IF PS-EOC-PO-CUR                                             25930006
256600       MOVE ZEROS   TO ASC-PO-NBR (ASC-BLK-SUB ASC-ITEM-SUB)      25940006
256700       MOVE SPACES  TO ASC-PO-TYP-CDE (ASC-BLK-SUB ASC-ITEM-SUB)  25950006
256800       MOVE SPACES TO ASC-PO-SPLIT-TYP (ASC-BLK-SUB ASC-ITEM-SUB) 25960006
256900       MOVE PV-TOT-CONT-CARTS TO ASC-CART-CNT                     25970006
257000                                  (ASC-BLK-SUB ASC-ITEM-SUB)      25980006
257100       MOVE PV-TOT-CONT-CBM   TO ASC-CBM-QTY                      25990006
257200                                  (ASC-BLK-SUB ASC-ITEM-SUB)      26000006
257300       MOVE PV-PREV-RUL-ID-USED                                   26010006
257400          TO ASC-RUL-ID-USED(ASC-BLK-SUB ASC-ITEM-SUB)            26020006
257500       MOVE PV-PREV-RUL-TYP-CDE-USED                              26030006
257600          TO ASC-RUL-TYP-CDE-USED(ASC-BLK-SUB ASC-ITEM-SUB)       26040006
257700       MOVE PV-PREV-RUL-CDE-USED                                  26050006
257800          TO ASC-RUL-CDE-USED (ASC-BLK-SUB ASC-ITEM-SUB)          26060006
257900       MOVE PV-PREV-RUL-ID-DEFLT                                  26070006
258000          TO ASC-RUL-ID-DEFLT (ASC-BLK-SUB ASC-ITEM-SUB)          26080006
258100                                                                  26090006
258200*    ************************                                     26100006
258300*    * NOT END OF PO CURSOR *                                     26110006
258400*    ************************                                     26120006
258500     ELSE                                                         26130006
258600       MOVE PV-PO-CUR-PO-NBR       TO ASC-PO-NBR                  26140006
258700                                    (ASC-BLK-SUB ASC-ITEM-SUB)    26150006
258800       MOVE PV-PO-CUR-PO-TYP-CDE   TO ASC-PO-TYP-CDE              26160006
258900                                    (ASC-BLK-SUB ASC-ITEM-SUB)    26170006
259000       MOVE PV-PO-CUR-SPLIT-TYP    TO ASC-PO-SPLIT-TYP            26180006
259100                                    (ASC-BLK-SUB ASC-ITEM-SUB)    26190006
259200       MOVE PV-PO-CUR-CART-CNT     TO ASC-CART-CNT                26200006
259300                                    (ASC-BLK-SUB ASC-ITEM-SUB)    26210006
259400       MOVE PV-PO-CUR-CBMT-QTY     TO ASC-CBM-QTY                 26220006
259500                                    (ASC-BLK-SUB ASC-ITEM-SUB)    26230006
259600       ADD PV-PO-CUR-CART-CNT   TO PV-TOT-CONT-CARTS              26240006
259700       ADD PV-PO-CUR-CBMT-QTY   TO PV-TOT-CONT-CBM                26250006
259800                                                                  26260006
259900*4370-SELECT-SEASET WAS PART OF THE ORIGINAL CODE THAT ALLOWED    26270006
260000*THE SEASON SETS THAT TRANSPORTATION DEEMED AS IMPORT TO SHOW     26280006
260100*ON THE SCREEN.  5/4/2006 THIS WAS CHANGED TO ALLOW ANY SEASONAL  26290006
260200*SET THAT'S ON TPURCHS FOR THAT PO TO SHOW ON THE SCREEN.  THE    26300006
260300*CODE WILL BE LEFT IN THE PROGRAM IN CASE TRANSPORTATION CHANGES  26310006
260400*THEIR MIND. AME                                                  26320006
260500*      PERFORM 4370-SELECT-SEASET                                 26330006
260600*THE FOLLOWING 5 LINES OF CODE WERE ADDED WHEN 4370-SELECT-SEASET 26340006
260700*WAS REMOVED.  THEY JUST CHECK TO SEE IF THE PO IS PART OF A SET. 26350006
260800*IF YES, THE SEASET SHOWS ON THE SCREEN.  IF NOT, IT'S BLANK.     26360006
260900*IF TRANSPORTATION DECIDES TO GO BACK TO THE ORIGINAL CODE, THESE 26370006
261000*5 LINES WOULD BE REMOVED.  THE CODE WAS ALREADY GETTING PV-PO-CUR26380006
261100*-SEASET IN THE ORIGINAL CODE.   AME  5/4/2006                    26390006
261200       IF PV-PO-CUR-SEASET > SPACES                               26400006
261300          SET PS-SEASET-RULE-EXISTS     TO TRUE                   26410006
261400       ELSE                                                       26420006
261500          SET PS-SEASET-RULE-EXISTS-NO TO TRUE                    26430006
261600       END-IF                                                     26440006
261700                                                                  26450006
261800       IF PS-SEASET-RULE-EXISTS                                   26460006
261900         MOVE PV-PO-CUR-SEASET  TO ASC-SEASET                     26470006
262000                                    (ASC-BLK-SUB ASC-ITEM-SUB)    26480006
262100       ELSE                                                       26490006
262200         MOVE SPACES            TO ASC-SEASET                     26500006
262300                                    (ASC-BLK-SUB ASC-ITEM-SUB)    26510006
262400       END-IF                                                     26520006
262500                                                                  26530006
262600       MOVE PV-DEF-SCAC         TO ASC-DECON-SCAC-CUR             26540006
262700                                    (ASC-BLK-SUB ASC-ITEM-SUB)    26550006
262800       MOVE PV-CONT-CUR-RUL-ID  TO ASC-RUL-ID-DEFLT               26560006
262900                                    (ASC-BLK-SUB ASC-ITEM-SUB)    26570006
263000                                   PV-PREV-RUL-ID-DEFLT           26580006
263100                                                                  26590006
263200       IF PV-VIEW = 'DEFAULT'                                     26600006
263300         MOVE PV-CONT-CUR-RUL-ID  TO ASC-RUL-ID-USED              26610006
263400                                    (ASC-BLK-SUB ASC-ITEM-SUB)    26620006
263500         MOVE 'DEF'               TO ASC-RUL-TYP-CDE-USED         26630006
263600                                    (ASC-BLK-SUB ASC-ITEM-SUB)    26640006
263700         MOVE 'CONT'              TO ASC-RUL-CDE-USED             26650006
263800                                    (ASC-BLK-SUB ASC-ITEM-SUB)    26660006
263900       ELSE                                                       26670006
264000         PERFORM 4500-CHECK-FOR-ADJUSTMENTS                       26680006
264100         IF PV-ADJ-SCAC   NOT =  SPACES                           26690006
264200            MOVE PV-ADJ-SCAC  TO  ASC-DECON-SCAC-CUR              26700006
264300                                   (ASC-BLK-SUB ASC-ITEM-SUB)     26710006
264400            MOVE TRT00014-RUL-ID TO ASC-RUL-ID-USED               26720006
264500                                  (ASC-BLK-SUB ASC-ITEM-SUB)      26730006
264600            MOVE TRT00014-RUL-TYP-CDE TO ASC-RUL-TYP-CDE-USED     26740006
264700                                  (ASC-BLK-SUB ASC-ITEM-SUB)      26750006
264800            MOVE TRT00014-RUL-CDE TO ASC-RUL-CDE-USED             26760006
264900                                  (ASC-BLK-SUB ASC-ITEM-SUB)      26770006
265000         ELSE                                                     26780006
265100            MOVE PV-CONT-CUR-RUL-ID  TO ASC-RUL-ID-USED           26790006
265200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 26800006
265300            MOVE 'DEF'               TO ASC-RUL-TYP-CDE-USED      26810006
265400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 26820006
265500            MOVE 'CONT'              TO ASC-RUL-CDE-USED          26830006
265600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 26840006
265700         END-IF                                                   26850006
265800         IF PV-VIEW = 'WORKING'                                   26860006
265900            PERFORM 4600-CHECK-FOR-WORKING                        26870006
266000            IF PV-WKG-SCAC   NOT =  SPACES                        26880006
266100               MOVE PV-WKG-SCAC      TO  ASC-DECON-SCAC-CUR       26890006
266200                                   (ASC-BLK-SUB ASC-ITEM-SUB)     26900006
266300               MOVE TRT00014-RUL-ID TO ASC-RUL-ID-USED            26910006
266400                                  (ASC-BLK-SUB ASC-ITEM-SUB)      26920006
266500               MOVE TRT00014-RUL-TYP-CDE                          26930006
266600                                TO ASC-RUL-TYP-CDE-USED           26940006
266700                                  (ASC-BLK-SUB ASC-ITEM-SUB)      26950006
266800               MOVE TRT00014-RUL-CDE TO ASC-RUL-CDE-USED          26960006
266900                                  (ASC-BLK-SUB ASC-ITEM-SUB)      26970006
267000            END-IF                                                26980006
267100         END-IF                                                   26990006
267200       END-IF                                                     27000006
267300                                                                  27010006
267400       MOVE ASC-RUL-ID-USED (ASC-BLK-SUB ASC-ITEM-SUB)            27020006
267500                            TO PV-PREV-RUL-ID-USED                27030006
267600       MOVE ASC-RUL-TYP-CDE-USED(ASC-BLK-SUB ASC-ITEM-SUB)        27040006
267700                            TO PV-PREV-RUL-TYP-CDE-USED           27050006
267800       MOVE ASC-RUL-CDE-USED (ASC-BLK-SUB ASC-ITEM-SUB)           27060006
267900                            TO PV-PREV-RUL-CDE-USED               27070006
268000                                                                  27080006
268100     END-IF.                                                      27090006
268200                                                                  27100006
268300     PERFORM 4900-HANDLE-ASC-BLOCKS.                              27110006
268400                                                                  27120006
268500*----------------------------------------------------------------*27130006
268600 4360-FETCH-PO-CURSOR.                                            27140006
268700                                                                  27150006
268800     EXEC SQL                                                     27160006
268900         FETCH PO_CUR                                             27170006
269000         INTO  :PV-PO-CUR-PO-NBR                                  27180006
269100             , :PV-PO-CUR-PO-TYP-CDE                              27190006
269200             , :PV-PO-CUR-SPLIT-TYP                               27200006
269300             , :PV-PO-CUR-CART-CNT                                27210006
269400             , :PV-PO-CUR-CBMT-QTY                                27220006
269500             , :PV-PO-CUR-SEASET                                  27230006
269600     END-EXEC.                                                    27240006
269700                                                                  27250006
269800*                                                                 27260006
269900     EVALUATE TRUE                                                27270006
270000         WHEN SQLCODE = ZERO                                      27280006
270100         WHEN SQLCODE = +100                                      27290006
270200              CONTINUE                                            27300006
270300         WHEN SQLWARN0 NOT = SPACE                                27310006
270400         WHEN SQLCODE NOT = ZERO                                  27320006
270500              MOVE '4360-FETCH-PO-CURSOR'                         27330006
270600                               TO DP013-PARAGRAPH                 27340006
270700              MOVE 'FETCH PO CURSOR'                              27350006
270800                               TO DP013-MESSAGE-TEXT (1)          27360006
270900              MOVE SQLCA       TO DP013-SQLCA                     27370006
271000              SET DP013-DB2-ABEND                                 27380006
271100                               TO TRUE                            27390006
271200              PERFORM DP013-0000-PROCESS-ABEND                    27400006
271300     END-EVALUATE.                                                27410006
271400*                                                                 27420006
271500     IF  SQLCODE EQUAL +100                                       27430006
271600         SET PS-EOC-PO-CUR         TO TRUE                        27440006
271700     END-IF.                                                      27450006
271800                                                                  27460006
271900*4370-SELECT-SEASET WAS PART OF THE ORIGINAL CODE THAT ALLOWED    27470006
272000*THE SEASON SETS THAT TRANSPORTATION DEEMED AS IMPORT TO SHOW     27480006
272100*ON THE SCREEN.  5/4/2006 THIS WAS CHANGED TO ALLOW ANY SEASONAL  27490006
272200*SET THAT'S ON TPURCHS FOR THAT PO TO SHOW ON THE SCREEN.  THE    27500006
272300*CODE WILL BE LEFT IN THE PROGRAM IN CASE TRANSPORTATION CHANGES  27510006
272400*THEIR MIND.  THE PARAGRAPH IS NOT EXECUTED IN THE PROGRAM SO IS  27520006
272500*CURRENTLY DEAD CODE. AME                                         27530006
272600*----------------------------------------------------------------*27540006
272700 4370-SELECT-SEASET.                                              27550006
272800                                                                  27560006
272900     SET PS-SEASET-RULE-EXISTS-NO  TO TRUE.                       27570006
273000                                                                  27580006
273100     PERFORM                                                      27590006
273200         WITH TEST AFTER                                          27600006
273300         VARYING PV-RETRY-COUNTER                                 27610006
273400         FROM 1 BY 1                                              27620006
273500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               27630006
273600            OR  (SQLCODE = ZERO)                                  27640006
273700            OR  (SQLCODE = -811)                                  27650006
273800            OR  (SQLCODE = +100))                                 27660006
273900                                                                  27670006
274000         EXEC SQL                                                 27680006
274100           SELECT RT.RUL_ID                                       27690006
274200                 ,CT.RUL_CNSTR_VAL_TXT                            27700006
274300            INTO :TRT00014-RUL-ID                                 27710006
274400                ,:TRT00015-RUL-CNSTR-VAL-TXT                      27720006
274500            FROM TRT_RUL RT                                       27730006
274600                ,TRT_RUL_CNSTR CT                                 27740006
274700           WHERE CT.RUL_CNSTR_TYP_CDE = 'SET'                     27750006
274800             AND CT.RUL_CNSTR_VAL_TXT = :PV-PO-CUR-SEASET         27760006
274900             AND RT.RUL_ID            =  CT.RUL_ID                27770006
275000             AND RT.RUL_CDE           = 'SET'                     27780006
275100             AND RT.RUL_TYP_CDE       = 'DEF'                     27790006
275200         END-EXEC                                                 27800006
275300*                                                                 27810006
275400         EVALUATE TRUE                                            27820006
275500             WHEN SQLCODE = ZERO                                  27830006
275600             WHEN SQLCODE = -811                                  27840006
275700             WHEN SQLCODE = +100                                  27850006
275800             WHEN SQLCODE = -904                                  27860006
275900             WHEN SQLCODE = -913                                  27870006
276000                 CONTINUE                                         27880006
276100             WHEN SQLWARN0 NOT = SPACES                           27890006
276200             WHEN SQLCODE < ZERO                                  27900006
276300             WHEN SQLCODE > ZERO                                  27910006
276400                 MOVE '4370-SELECT-SEASET'                        27920006
276500                                   TO DP013-PARAGRAPH             27930006
276600                 MOVE PV-PO-CUR-SEASET                            27940006
276700                                   TO DP013-MESSAGE-TEXT (1)      27950006
276800                 MOVE SQLCA        TO DP013-SQLCA                 27960006
276900                 MOVE 'TRT_RUL_CNSTR' TO DP013-DB2-TABLE-NAME (1) 27970006
277000                 SET DP013-DB2-ABEND                              27980006
277100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           27990006
277200                 PERFORM DP013-0000-PROCESS-ABEND                 28000006
277300         END-EVALUATE                                             28010006
277400     END-PERFORM.                                                 28020006
277500*                                                                 28030006
277600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        28040006
277700         MOVE '4370-SELECT-SEASET.. MAX RETRIES'                  28050006
277800                                          TO DP013-PARAGRAPH      28060006
277900         MOVE TRT00015-RUL-CNSTR-TYP-CDE                          28070006
278000                                   TO DP013-MESSAGE-TEXT (1)      28080006
278100         MOVE SQLCA                TO DP013-SQLCA                 28090006
278200         MOVE 'TRT_RUL_CNSTR' TO DP013-DB2-TABLE-NAME (1)         28100006
278300         SET DP013-DB2-ABEND                                      28110006
278400             DP013-XCTL-DISPLAY-RESTART                           28120006
278500                                   TO TRUE                        28130006
278600         PERFORM DP013-0000-PROCESS-ABEND                         28140006
278700     END-IF.                                                      28150006
278800                                                                  28160006
278900     IF SQLCODE = ZERO OR -811                                    28170006
279000        SET PS-SEASET-RULE-EXISTS  TO TRUE                        28180006
279100     END-IF.                                                      28190006
279200*                                                                 28200006
279300                                                                  28210006
279400*----------------------------------------------------------------*28220006
279500* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *28230006
279600*----------------------------------------------------------------*28240006
279700 4400-MOVE-COMMAREA-TO-SCREEN.                                    28250006
279800                                                                  28260006
279900     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             28270006
280000         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          28280006
280100         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          28290006
280200             MOVE +1    TO ASC-BLK-SUB                            28300006
280300             PERFORM 5100-WRITE-TEMP-STORAGE                      28310006
280400             ADD +1     TO ASC-BLK-SUB                            28320006
280500             PERFORM 5100-WRITE-TEMP-STORAGE                      28330006
280600             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             28340006
280700                 GIVING PV-BLOCK-NUMBER                           28350006
280800                 REMAINDER PV-REMAINDER                           28360006
280900             IF  PV-REMAINDER > ZERO                              28370006
281000                 ADD +1 TO PV-BLOCK-NUMBER                        28380006
281100             END-IF                                               28390006
281200             MOVE +1    TO ASC-BLK-SUB                            28400006
281300             PERFORM 4410-READ-TEMP-STORAGE                       28410006
281400             ADD +1     TO ASC-BLK-SUB                            28420006
281500                           PV-BLOCK-NUMBER                        28430006
281600             PERFORM 4410-READ-TEMP-STORAGE                       28440006
281700     END-IF.                                                      28450006
281800                                                                  28460006
281900     MOVE +1            TO ASC-BLK-SUB.                           28470006
282000     COMPUTE ASC-ITEM-SUB =                                       28480006
282100         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              28490006
282200         + PC-ITEMS-PER-PANEL).                                   28500006
282300*                                                                 28510006
282400     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        28520006
282500         ADD +1         TO ASC-BLK-SUB                            28530006
282600         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            28540006
282700     END-IF.                                                      28550006
282800*                                                                 28560006
282900     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           28570006
283000         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                28580006
283100     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        28590006
283200     PERFORM 4420-FORMAT-LIST-LINES                               28600006
283300         VARYING PV-SUB                                           28610006
283400         FROM PC-ITEMS-PER-PANEL BY -1                            28620006
283500         UNTIL PV-SUB < +1.                                       28630006
283600*                                                                 28640006
283700     COMPUTE ASC-ITEMS-DISPLAYED =                                28650006
283800         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          28660006
283900* --------------------------------------------------------        28670006
284000*  STATIC LINES                                                   28680006
284100* --------------------------------------------------------        28690006
284200     MOVE ASC-POE-CDE              TO APOECDEO.                   28700006
284300                                                                  28710006
284400     MOVE ASC-WEEK-FROM-DTE (1:4)  TO PV-YYYY.                    28720006
284500     MOVE ASC-WEEK-FROM-DTE (6:2)  TO PV-MM.                      28730006
284600     MOVE ASC-WEEK-FROM-DTE (9:2)  TO PV-DD.                      28740006
284700     MOVE PV-DISPLAY-DATE          TO AFRMDTEO.                   28750006
284800                                                                  28760006
284900     MOVE ASC-WEEK-TO-DTE (1:4)    TO PV-YYYY.                    28770006
285000     MOVE ASC-WEEK-TO-DTE (6:2)    TO PV-MM.                      28780006
285100     MOVE ASC-WEEK-TO-DTE (9:2)    TO PV-DD.                      28790006
285200     MOVE PV-DISPLAY-DATE          TO ATODTEO.                    28800006
285300                                                                  28810006
285400     MOVE ASC-VIEW                 TO AVIEWO.                     28820006
285500* --------------------------------------------------------        28830006
285600     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    28840006
285700                                      ASTRTITO.                   28850006
285800     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    28860006
285900     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    28870006
286000     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            28880006
286100                                   TO ASELITO.                    28890006
286200*                                                                 28900006
286300     IF  DP020-MSG-NUMBER-X = SPACE                               28910006
286400         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  28920006
286500*----------- MORE ITEMS TO DISPLAY --------                       28930006
286600             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            28940006
286700             SET DP020-MSG-INFORMATIONAL TO TRUE                  28950006
286800         END-IF                                                   28960006
286900     END-IF.                                                      28970006
287000                                                                  28980006
287100*----------------------------------------------------------------*28990006
287200*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *29000006
287300*----------------------------------------------------------------*29010006
287400 4410-READ-TEMP-STORAGE.                                          29020006
287500                                                                  29030006
287600     EXEC CICS                                                    29040006
287700         READQ TS                                                 29050006
287800             QUEUE (ASC-LIST-QUEUE-NAME)                          29060006
287900             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               29070006
288000             ITEM  (PV-BLOCK-NUMBER)                              29080006
288100             RESP  (PV-CICS-RESP)                                 29090006
288200     END-EXEC.                                                    29100006
288300*                                                                 29110006
288400     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       29120006
288500       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     29130006
288600         CONTINUE                                                 29140006
288700     ELSE                                                         29150006
288800         SET DP013-CICS-ABEND     TO TRUE                         29160006
288900         SET DP013-NO-ROLLBACK    TO TRUE                         29170006
289000         MOVE '4410-READ-TEMP-STORAGE'                            29180006
289100                                  TO DP013-PARAGRAPH              29190006
289200         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      29200006
289300                                  TO DP013-MESSAGE-TEXT(1)        29210006
289400         PERFORM DP013-0000-PROCESS-ABEND                         29220006
289500     END-IF.                                                      29230006
289600*                                                                 29240006
289700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             29250006
289800*                                                                 29260006
289900     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         29270006
290000         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               29280006
290100     END-IF.                                                      29290006
290200                                                                  29300006
290300 EJECT                                                            29310006
290400*----------------------------------------------------------------*29320006
290500*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *29330006
290600*----------------------------------------------------------------*29340006
290700 4420-FORMAT-LIST-LINES.                                          29350006
290800                                                                  29360006
290900     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      29370006
291000         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                29380006
291100         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA    (PV-SUB)        29390006
291200         MOVE DP015-HL-OFF       TO MR-SELECTH    (PV-SUB)        29400006
291300         MOVE SPACES  TO MR-VES-ETA-FOB           (PV-SUB)        29410006
291400                         MR-CONTNR-ID             (PV-SUB)        29420006
291500                         MR-PO-NBR-X              (PV-SUB)        29430006
291600                         MR-PO-TYP                (PV-SUB)        29440006
291700                         MR-CTN-X                 (PV-SUB)        29450006
291800                         MR-CBM-X                 (PV-SUB)        29460006
291900                         MR-SPLT                  (PV-SUB)        29470006
292000                         MR-SEASET                (PV-SUB)        29480006
292100                         MR-DECNSL                (PV-SUB)        29490006
292200     ELSE                                                         29500006
292300         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      29510006
292400                                                   > SPACE        29520006
292500             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 29530006
292600                                 TO MR-SELECTI (PV-SUB)           29540006
292700         ELSE                                                     29550006
292800             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      29560006
292900                                 TO MR-SELECTI (PV-SUB)           29570006
293000         END-IF                                                   29580006
293100                                                                  29590006
293200*        **** MOVE CURSOR TO FIRST ITEM ON LOST                   29600006
293300         IF  DP030-SET-CURSOR-TRAILER                             29610006
293400             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)29620006
293500                 > SPACE)                                         29630006
293600               OR (PV-SUB = 1))                                   29640006
293700                SET DP030-SET-CURSOR-APPL-1 TO TRUE               29650006
293800                MOVE -1          TO MR-SELECTL (PV-SUB)           29660006
293900             END-IF                                               29670006
294000         END-IF                                                   29680006
294100                                                                  29690006
294200         IF  PV-TOP-ITEM    NOT =   ASC-ITEM-AT-TOP-OF-PANEL      29700006
294300             MOVE ASC-ACTION   (ASC-BLK-SUB ASC-ITEM-SUB)         29710006
294400                               TO MR-ACTION (PV-SUB)              29720006
294500             MOVE ASC-CONTNR-ID (ASC-BLK-SUB ASC-ITEM-SUB)        29730006
294600                               TO MR-CONTNR-ID (PV-SUB)           29740006
294700             MOVE ASC-CART-CNT (ASC-BLK-SUB ASC-ITEM-SUB)         29750006
294800                               TO MR-CTN    (PV-SUB)              29760006
294900             MOVE ASC-CBM-QTY  (ASC-BLK-SUB ASC-ITEM-SUB)         29770006
295000                               TO MR-CBM    (PV-SUB)              29780006
295100*            ***** IS THIS A CONTAINER TOTAL LINE?                29790006
295200             IF ASC-PO-NBR (ASC-BLK-SUB ASC-ITEM-SUB) = ZERO      29800006
295300               MOVE '   CONTAINER TOTALS:'                        29810006
295400                                 TO MR-VES-ETA-FOB (PV-SUB)       29820006
295500               MOVE SPACES       TO MR-PO-NBR-X (PV-SUB)          29830006
295600                                    MR-PO-TYP (PV-SUB)            29840006
295700                                    MR-SPLT (PV-SUB)              29850006
295800                                    MR-SEASET (PV-SUB)            29860006
295900                                    MR-DECNSL (PV-SUB)            29870006
296000             ELSE                                                 29880006
296100               STRING                                             29890006
296200                      ASC-VESSEL  (ASC-BLK-SUB ASC-ITEM-SUB)(1:10)29900006
296300                  ' ' ASC-ETA-MM-DD (ASC-BLK-SUB ASC-ITEM-SUB)    29910006
296400                  ' ' ASC-FOB-CDE   (ASC-BLK-SUB ASC-ITEM-SUB)    29920006
296500               DELIMITED BY SIZE INTO                             29930006
296600                                    MR-VES-ETA-FOB (PV-SUB)       29940006
296700               MOVE ASC-PO-NBR      (ASC-BLK-SUB ASC-ITEM-SUB)    29950006
296800                                 TO MR-PO-NBR (PV-SUB)            29960006
296900               MOVE ASC-PO-TYP-CDE  (ASC-BLK-SUB ASC-ITEM-SUB)    29970006
297000                                 TO MR-PO-TYP (PV-SUB)            29980006
297100               MOVE ASC-PO-SPLIT-TYP (ASC-BLK-SUB ASC-ITEM-SUB)   29990006
297200                                 TO MR-SPLT (PV-SUB)              30000006
297300               MOVE ASC-SEASET       (ASC-BLK-SUB ASC-ITEM-SUB)   30010006
297400                                 TO MR-SEASET (PV-SUB)            30020006
297500               MOVE ASC-DECON-SCAC-CUR                            30030006
297600                              (ASC-BLK-SUB ASC-ITEM-SUB)          30040006
297700                                 TO MR-DECNSL (PV-SUB)            30050006
297800               EVALUATE ASC-RUL-TYP-CDE-USED                      30060006
297900                      (ASC-BLK-SUB ASC-ITEM-SUB)                  30070006
298000                   WHEN 'DEF'                                     30080006
298100                       MOVE DP015-BLUE TO MR-DECNSLC (PV-SUB)     30090006
298200                   WHEN 'WKG'                                     30100006
298300                       MOVE DP015-YELLOW TO MR-DECNSLC (PV-SUB)   30110006
298400                   WHEN 'ADJ'                                     30120006
298500                       MOVE DP015-RED TO MR-DECNSLC (PV-SUB)      30130006
298600               END-EVALUATE                                       30140006
298700             END-IF                                               30150006
298800         END-IF                                                   30160006
298900     END-IF.                                                      30170006
299000     SUBTRACT +1 FROM ASC-ITEM-SUB                                30180006
299100     IF  ASC-ITEM-SUB < + 1                                       30190006
299200         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  30200006
299300         MOVE +1                 TO ASC-BLK-SUB                   30210006
299400     END-IF.                                                      30220006
299500                                                                  30230006
299600 EJECT                                                            30240006
299700*----------------------------------------------------------------*30250006
299800*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *30260006
299900*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *30270006
300000*  ISSUE A WARNING.                                              *30280006
300100*----------------------------------------------------------------*30290006
300200 4430-CHECK-FOR-BEGIN-AND-END.                                    30300006
300300                                                                  30310006
300400     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       30320006
300500         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     30330006
300600*----------- NO END-OF-RANGE SPECFIED ---                         30340006
300700             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            30350006
300800             SET DP020-MSG-WARNING TO TRUE                        30360006
300900             PERFORM 4431-POSITION-AT-WARNING                     30370006
301000         END-IF                                                   30380006
301100     ELSE                                                         30390006
301200         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     30400006
301300*----------- NO BEGINNING-OF-RANGE SPECFIED ---                   30410006
301400             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            30420006
301500             SET DP020-MSG-WARNING TO TRUE                        30430006
301600             PERFORM 4431-POSITION-AT-WARNING                     30440006
301700         END-IF                                                   30450006
301800     END-IF.                                                      30460006
301900                                                                  30470006
302000 EJECT                                                            30480006
302100*----------------------------------------------------------------*30490006
302200*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *30500006
302300*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *30510006
302400*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *30520006
302500*  POSITION THE CURSOR THERE.                                    *30530006
302600*----------------------------------------------------------------*30540006
302700 4431-POSITION-AT-WARNING.                                        30550006
302800                                                                  30560006
302900     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 30570006
303000                    - PV-TOP-ITEM + 1.                            30580006
303100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      30590006
303200         CONTINUE                                                 30600006
303300     ELSE                                                         30610006
303400         SET DP030-SET-CURSOR-APPL-1                              30620006
303500                                   TO TRUE                        30630006
303600         MOVE -1                   TO MR-SELECTL (PV-SUB)         30640006
303700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         30650006
303800         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         30660006
303900     END-IF.                                                      30670006
304000*                                                                 30680006
304100     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   30690006
304200                    - PV-TOP-ITEM + 1.                            30700006
304300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      30710006
304400         CONTINUE                                                 30720006
304500     ELSE                                                         30730006
304600         SET DP030-SET-CURSOR-APPL-1                              30740006
304700                                   TO TRUE                        30750006
304800         MOVE -1                   TO MR-SELECTL (PV-SUB)         30760006
304900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         30770006
305000         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         30780006
305100     END-IF.                                                      30790006
305200                                                                  30800006
305300*----------------------------------------------------------------*30810006
305400 4500-CHECK-FOR-ADJUSTMENTS.                                      30820006
305500                                                                  30830006
305600     INITIALIZE PV-ADJ-SCAC.                                      30840006
305700     MOVE 'ADJ'   TO TRT00014-RUL-TYP-CDE.                        30850006
305800     MOVE 'CONT'  TO TRT00014-RUL-CDE.                            30860006
305900     MOVE SPACES TO TRT00015-RUL-CNSTR-VAL-TXT.                   30870006
306000     PERFORM 4630-OPEN-TRT-RULE-CURSOR.                           30880006
306100     MOVE 'N' TO PS-CONSTR-RULE-FOUND-SW.                         30890006
306200     MOVE 'N' TO PS-END-OF-RULE-CURS-SW.                          30900006
306300     PERFORM 4640-FETCH-TRT-RULE-CURS-CONT                        30910006
306400       UNTIL PS-CONSTR-RULE-FOUND                                 30920006
306500         OR PS-END-OF-RULE-CURS.                                  30930006
306600     PERFORM 4650-CLOSE-TRT-RULE-CURSOR.                          30940006
306700     IF TRT00015-RUL-CNSTR-VAL-TXT = SPACES                       30950006
306800       MOVE 'ADJ'   TO TRT00014-RUL-TYP-CDE                       30960006
306900       MOVE 'VSL '  TO TRT00014-RUL-CDE                           30970006
307000       PERFORM 4630-OPEN-TRT-RULE-CURSOR                          30980006
307100       MOVE 'N' TO PS-CONSTR-RULE-FOUND-SW                        30990006
307200       MOVE 'N' TO PS-END-OF-RULE-CURS-SW                         31000006
307300       PERFORM 4670-FETCH-TRT-RULE-CURS-VSL                       31010006
307400         UNTIL PS-CONSTR-RULE-FOUND                               31020006
307500           OR PS-END-OF-RULE-CURS                                 31030006
307600       PERFORM 4650-CLOSE-TRT-RULE-CURSOR                         31040006
307700     END-IF.                                                      31050006
307800     MOVE TRT00015-RUL-CNSTR-VAL-TXT TO PV-ADJ-SCAC.              31060006
307900                                                                  31070006
308000*----------------------------------------------------------------*31080006
308100 4600-CHECK-FOR-WORKING.                                          31090006
308200                                                                  31100006
308300     INITIALIZE PV-WKG-SCAC.                                      31110006
308400     MOVE 'WKG'   TO TRT00014-RUL-TYP-CDE.                        31120006
308500     MOVE 'CONT'  TO TRT00014-RUL-CDE.                            31130006
308600     MOVE SPACES TO TRT00015-RUL-CNSTR-VAL-TXT.                   31140006
308700     PERFORM 4630-OPEN-TRT-RULE-CURSOR.                           31150006
308800     MOVE 'N' TO PS-CONSTR-RULE-FOUND-SW.                         31160006
308900     MOVE 'N' TO PS-END-OF-RULE-CURS-SW.                          31170006
309000     PERFORM 4640-FETCH-TRT-RULE-CURS-CONT                        31180006
309100         UNTIL PS-CONSTR-RULE-FOUND                               31190006
309200           OR PS-END-OF-RULE-CURS.                                31200006
309300     PERFORM 4650-CLOSE-TRT-RULE-CURSOR.                          31210006
309400                                                                  31220006
309500     IF TRT00015-RUL-CNSTR-VAL-TXT = SPACES                       31230006
309600       MOVE 'ADJ'   TO TRT00014-RUL-TYP-CDE                       31240006
309700       MOVE 'CONT'  TO TRT00014-RUL-CDE                           31250006
309800       PERFORM 4630-OPEN-TRT-RULE-CURSOR                          31260006
309900       MOVE 'N' TO PS-CONSTR-RULE-FOUND-SW                        31270006
310000       MOVE 'N' TO PS-END-OF-RULE-CURS-SW                         31280006
310100       PERFORM 4640-FETCH-TRT-RULE-CURS-CONT                      31290006
310200         UNTIL PS-CONSTR-RULE-FOUND                               31300006
310300           OR PS-END-OF-RULE-CURS                                 31310006
310400       PERFORM 4650-CLOSE-TRT-RULE-CURSOR                         31320006
310500     END-IF.                                                      31330006
310600                                                                  31340006
310700     IF TRT00015-RUL-CNSTR-VAL-TXT = SPACES                       31350006
310800       MOVE 'WKG'   TO TRT00014-RUL-TYP-CDE                       31360006
310900       MOVE 'VSL '  TO TRT00014-RUL-CDE                           31370006
311000       PERFORM 4630-OPEN-TRT-RULE-CURSOR                          31380006
311100       MOVE 'N' TO PS-CONSTR-RULE-FOUND-SW                        31390006
311200       MOVE 'N' TO PS-END-OF-RULE-CURS-SW                         31400006
311300       PERFORM 4670-FETCH-TRT-RULE-CURS-VSL                       31410006
311400         UNTIL PS-CONSTR-RULE-FOUND                               31420006
311500           OR PS-END-OF-RULE-CURS                                 31430006
311600       PERFORM 4650-CLOSE-TRT-RULE-CURSOR                         31440006
311700     END-IF.                                                      31450006
311800                                                                  31460006
311900     MOVE TRT00015-RUL-CNSTR-VAL-TXT TO PV-WKG-SCAC.              31470006
312000                                                                  31480006
312100*----------------------------------------------------------------*31490006
312200 4610-SELECT-RULE-DECN-CONT.                                      31500006
312300                                                                  31510006
312400     MOVE SPACES TO TRT00015-RUL-CNSTR-VAL-TXT.                   31520006
312500     IF PV-CONTNR-SEQ-NBR = ZERO                                  31530006
312600        MOVE 'ETA'             TO PV-SEQ-OR-ETA                   31540006
312700        MOVE PV-ETA-DATE       TO PV-SEQ-OR-ETA-VAL               31550006
312800     ELSE                                                         31560006
312900        MOVE 'SEQ'             TO PV-SEQ-OR-ETA                   31570006
313000        MOVE PV-FULL-SEQ-NBR   TO PV-SEQ-OR-ETA-VAL               31580006
313100     END-IF                                                       31590006
313200                                                                  31600006
313300     PERFORM                                                      31610006
313400         WITH TEST AFTER                                          31620006
313500         VARYING PV-RETRY-COUNTER                                 31630006
313600         FROM 1 BY 1                                              31640006
313700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               31650006
313800            OR  (SQLCODE = ZERO)                                  31660006
313900            OR  (SQLCODE = -811)                                  31670006
314000            OR  (SQLCODE = +100))                                 31680006
314100                                                                  31690006
314200         EXEC SQL                                                 31700006
314300             SELECT A.RUL_CNSTR_VAL_TXT                           31710006
314400             INTO   :TRT00015-RUL-CNSTR-VAL-TXT                   31720006
314500             FROM   TRT_RUL_CNSTR A                               31730006
314600                   ,TRT_RUL_CNSTR B                               31740006
314700                   ,TRT_RUL_CNSTR C                               31750006
314800                   ,TRT_RUL_CNSTR D                               31760006
314900             WHERE  A.RUL_ID            = :TRT00014-RUL-ID        31770006
315000               AND  A.RUL_ID            = B.RUL_ID                31780006
315100               AND  A.RUL_ID            = C.RUL_ID                31790006
315200               AND  A.RUL_ID            = D.RUL_ID                31800006
315300               AND  A.RUL_CNSTR_TYP_CDE = 'DECN'                  31810006
315400               AND  B.RUL_CNSTR_TYP_CDE = 'CONT'                  31820006
315500               AND  B.RUL_CNSTR_VAL_TXT = :PV-CONT-CUR-CONTNR-ID  31830006
315600               AND  C.RUL_CNSTR_TYP_CDE = :PV-SEQ-OR-ETA          31840006
315700               AND  SUBSTR(C.RUL_CNSTR_VAL_TXT,1,10)              31850006
315800                                        = :PV-SEQ-OR-ETA-VAL      31860006
315900               AND  D.RUL_CNSTR_TYP_CDE = 'POE'                   31870006
316000               AND  D.RUL_CNSTR_VAL_TXT = :ASC-POE-CDE            31880006
316100         END-EXEC                                                 31890006
316200*                                                                 31900006
316300         EVALUATE TRUE                                            31910006
316400             WHEN SQLCODE = ZERO                                  31920006
316500             WHEN SQLCODE = -811                                  31930006
316600               MOVE 'Y' TO PS-CONSTR-RULE-FOUND-SW                31940006
316700             WHEN SQLCODE = +100                                  31950006
316800             WHEN SQLCODE = -904                                  31960006
316900             WHEN SQLCODE = -913                                  31970006
317000               CONTINUE                                           31980006
317100             WHEN SQLWARN0 NOT = SPACES                           31990006
317200             WHEN SQLCODE < ZERO                                  32000006
317300             WHEN SQLCODE > ZERO                                  32010006
317400                 MOVE '4610-SELECT-RULE-DECN-CONT'                32020006
317500                                   TO DP013-PARAGRAPH             32030006
317600                 MOVE TRT00014-RUL-TYP-CDE                        32040006
317700                                   TO DP013-MESSAGE-TEXT (1)      32050006
317800                 MOVE SQLCA        TO DP013-SQLCA                 32060006
317900                 MOVE 'TRT_RUL'    TO DP013-DB2-TABLE-NAME (1)    32070006
318000                 SET DP013-DB2-ABEND                              32080006
318100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           32090006
318200                 PERFORM DP013-0000-PROCESS-ABEND                 32100006
318300         END-EVALUATE                                             32110006
318400     END-PERFORM.                                                 32120006
318500*                                                                 32130006
318600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        32140006
318700         MOVE 'TRT00014-RUL-TYP-CDE MAX RETRIES'                  32150006
318800                                     TO DP013-PARAGRAPH           32160006
318900         MOVE TRT00015-RUL-CNSTR-TYP-CDE                          32170006
319000                                   TO DP013-MESSAGE-TEXT (1)      32180006
319100         MOVE SQLCA                TO DP013-SQLCA                 32190006
319200         MOVE 'TRT_RUL_CNSTR' TO DP013-DB2-TABLE-NAME (1)         32200006
319300         SET DP013-DB2-ABEND                                      32210006
319400             DP013-XCTL-DISPLAY-RESTART                           32220006
319500                                   TO TRUE                        32230006
319600         PERFORM DP013-0000-PROCESS-ABEND                         32240006
319700     END-IF.                                                      32250006
319800                                                                  32260006
319900*----------------------------------------------------------------*32270006
320000 4620-SELECT-RULE-DECN-VSL.                                       32280006
320100                                                                  32290006
320200     PERFORM                                                      32300006
320300         WITH TEST AFTER                                          32310006
320400         VARYING PV-RETRY-COUNTER                                 32320006
320500         FROM 1 BY 1                                              32330006
320600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               32340006
320700            OR  (SQLCODE = ZERO)                                  32350006
320800            OR  (SQLCODE = -811)                                  32360006
320900            OR  (SQLCODE = +100))                                 32370006
321000                                                                  32380006
321100         EXEC SQL                                                 32390006
321200             SELECT A.RUL_CNSTR_VAL_TXT                           32400006
321300             INTO   :TRT00015-RUL-CNSTR-VAL-TXT                   32410006
321400             FROM   TRT_RUL_CNSTR A                               32420006
321500                   ,TRT_RUL_CNSTR B                               32430006
321600                   ,TRT_RUL_CNSTR D                               32440006
321700             WHERE  A.RUL_ID            = :TRT00014-RUL-ID        32450006
321800               AND  A.RUL_ID            = B.RUL_ID                32460006
321900               AND  A.RUL_ID            = D.RUL_ID                32470006
322000               AND  A.RUL_CNSTR_TYP_CDE = 'DECN'                  32480006
322100               AND  B.RUL_CNSTR_TYP_CDE = 'VSL'                   32490006
322200               AND  B.RUL_CNSTR_VAL_TXT = :PV-VESSEL              32500006
322300               AND  D.RUL_CNSTR_TYP_CDE = 'POE'                   32510006
322400               AND  D.RUL_CNSTR_VAL_TXT = :ASC-POE-CDE            32520006
322500         END-EXEC                                                 32530006
322600*                                                                 32540006
322700         EVALUATE TRUE                                            32550006
322800             WHEN SQLCODE = ZERO                                  32560006
322900             WHEN SQLCODE = -811                                  32570006
323000               MOVE 'Y' TO PS-CONSTR-RULE-FOUND-SW                32580006
323100             WHEN SQLCODE = +100                                  32590006
323200             WHEN SQLCODE = -904                                  32600006
323300             WHEN SQLCODE = -913                                  32610006
323400                 CONTINUE                                         32620006
323500             WHEN SQLWARN0 NOT = SPACES                           32630006
323600             WHEN SQLCODE < ZERO                                  32640006
323700             WHEN SQLCODE > ZERO                                  32650006
323800                 MOVE '4620-SELECT-RULE-DECN-VSL'                 32660006
323900                                   TO DP013-PARAGRAPH             32670006
324000                 MOVE TRT00014-RUL-TYP-CDE                        32680006
324100                                   TO DP013-MESSAGE-TEXT (1)      32690006
324200                 MOVE SQLCA        TO DP013-SQLCA                 32700006
324300                 MOVE 'TRT_RUL'    TO DP013-DB2-TABLE-NAME (1)    32710006
324400                 SET DP013-DB2-ABEND                              32720006
324500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           32730006
324600                 PERFORM DP013-0000-PROCESS-ABEND                 32740006
324700         END-EVALUATE                                             32750006
324800     END-PERFORM.                                                 32760006
324900*                                                                 32770006
325000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        32780006
325100         MOVE 'TRT00014-RUL-TYP-CDE MAX RETRIES'                  32790006
325200                                     TO DP013-PARAGRAPH           32800006
325300         MOVE TRT00015-RUL-CNSTR-TYP-CDE                          32810006
325400                                   TO DP013-MESSAGE-TEXT (1)      32820006
325500         MOVE SQLCA                TO DP013-SQLCA                 32830006
325600         MOVE 'TRT_RUL_CNSTR' TO DP013-DB2-TABLE-NAME (1)         32840006
325700         SET DP013-DB2-ABEND                                      32850006
325800             DP013-XCTL-DISPLAY-RESTART                           32860006
325900                                   TO TRUE                        32870006
326000         PERFORM DP013-0000-PROCESS-ABEND                         32880006
326100     END-IF.                                                      32890006
326200*                                                                 32900006
326300*----------------------------------------------------------------*32910006
326400 4630-OPEN-TRT-RULE-CURSOR.                                       32920006
326500                                                                  32930006
326600     PERFORM                                                      32940006
326700         WITH TEST AFTER                                          32950006
326800         VARYING PV-RETRY-COUNTER                                 32960006
326900         FROM 1 BY 1                                              32970006
327000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               32980006
327100             OR (SQLCODE = ZERO))                                 32990006
327200                                                                  33000006
327300            EXEC SQL                                              33010006
327400               OPEN TRT_RULE_ID_CUR                               33020006
327500            END-EXEC                                              33030006
327600                                                                  33040006
327700*                                                                 33050006
327800         EVALUATE TRUE                                            33060006
327900             WHEN SQLCODE = ZERO                                  33070006
328000             WHEN SQLCODE = -904                                  33080006
328100             WHEN SQLCODE = -913                                  33090006
328200                 CONTINUE                                         33100006
328300             WHEN SQLWARN0 NOT = SPACES                           33110006
328400             WHEN SQLCODE < ZERO                                  33120006
328500             WHEN SQLCODE > ZERO                                  33130006
328600                 MOVE '4630-OPEN-TRT-RULE-CURSOR'                 33140006
328700                                   TO DP013-PARAGRAPH             33150006
328800                 MOVE 'OPEN TRT RULE-CURSOR - '                   33160006
328900                                   TO DP013-MESSAGE-TEXT (1)      33170006
329000                 MOVE SQLCA        TO DP013-SQLCA                 33180006
329100                 MOVE 'TIMCNRL '   TO DP013-DB2-TABLE-NAME (1)    33190006
329200                 SET DP013-DB2-ABEND                              33200006
329300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           33210006
329400                 PERFORM DP013-0000-PROCESS-ABEND                 33220006
329500         END-EVALUATE                                             33230006
329600     END-PERFORM.                                                 33240006
329700*                                                                 33250006
329800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        33260006
329900         MOVE '4630-OPEN-TRT-RULE-CURSOR' TO DP013-PARAGRAPH      33270006
330000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   33280006
330100                                   TO DP013-MESSAGE-TEXT (1)      33290006
330200         MOVE SQLCA                TO DP013-SQLCA                 33300006
330300         MOVE 'TIMCNRL'  TO DP013-DB2-TABLE-NAME (1)              33310006
330400         SET DP013-DB2-ABEND                                      33320006
330500             DP013-XCTL-DISPLAY-RESTART                           33330006
330600                                   TO TRUE                        33340006
330700         PERFORM DP013-0000-PROCESS-ABEND                         33350006
330800     END-IF.                                                      33360006
330900                                                                  33370006
331000     IF SQLCODE = ZERO                                            33380006
331100        SET PS-EOC-CMN-PO-CURSOR-NO TO TRUE                       33390006
331200        SET PS-CMN-SPLIT-DATA-FOUND-NO TO TRUE                    33400006
331300     END-IF.                                                      33410006
331400*                                                                 33420006
331500*----------------------------------------------------------------*33430006
331600 4640-FETCH-TRT-RULE-CURS-CONT.                                   33440006
331700                                                                  33450006
331800                                                                  33460006
331900      EXEC SQL                                                    33470006
332000        FETCH TRT_RULE_ID_CUR                                     33480006
332100         INTO :TRT00014-RUL-ID                                    33490006
332200      END-EXEC                                                    33500006
332300                                                                  33510006
332400*                                                                 33520006
332500      EVALUATE TRUE                                               33530006
332600          WHEN SQLCODE = ZERO                                     33540006
332700               PERFORM 4610-SELECT-RULE-DECN-CONT                 33550006
332800          WHEN SQLCODE = -811                                     33560006
332900               PERFORM 4610-SELECT-RULE-DECN-CONT                 33570006
333000          WHEN SQLCODE = +100                                     33580006
333100            MOVE 'Y' TO PS-END-OF-RULE-CURS-SW                    33590006
333200          WHEN SQLCODE = -904                                     33600006
333300          WHEN SQLCODE = -913                                     33610006
333400               CONTINUE                                           33620006
333500          WHEN OTHER                                              33630006
333600               MOVE '4640-FETCH-TRT-RULE-CURS-CONT'               33640006
333700                                TO DP013-PARAGRAPH                33650006
333800               MOVE 'SELECT ERROR'                                33660006
333900                                TO DP013-MESSAGE-TEXT (1)         33670006
334000               MOVE SQLCA       TO DP013-SQLCA                    33680006
334100               MOVE 'TIMCNRL'   TO DP013-DB2-TABLE-NAME (1)       33690006
334200               SET DP013-DB2-ABEND                                33700006
334300                                TO TRUE                           33710006
334400               PERFORM DP013-0000-PROCESS-ABEND                   33720006
334500      END-EVALUATE                                                33730006
334600                                                                  33740006
334700      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                       33750006
334800         MOVE '4640-FETCH-TRT-RULE-CURS-CONT'                     33760006
334900                            TO DP013-PARAGRAPH                    33770006
335000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     33780006
335100                                   TO DP013-MESSAGE-TEXT (1)      33790006
335200         MOVE SQLCA                TO DP013-SQLCA                 33800006
335300         MOVE 'TIMCNRL'            TO DP013-DB2-TABLE-NAME (1)    33810006
335400         SET DP013-DB2-ABEND                                      33820006
335500             DP013-XCTL-DISPLAY-RESTART                           33830006
335600                                   TO TRUE                        33840006
335700         PERFORM DP013-0000-PROCESS-ABEND                         33850006
335800       END-IF                                                     33860006
335900                                                                  33870006
336000*                                                                 33880006
336100     IF SQLCODE  = +100                                           33890006
336200       AND PV-RETRY-COUNTER = 1                                   33900006
336300         MOVE SPACES TO TRT00015-RUL-CNSTR-VAL-TXT.               33910006
336400*                                                                 33920006
336500*----------------------------------------------------------------*33930006
336600 4650-CLOSE-TRT-RULE-CURSOR.                                      33940006
336700                                                                  33950006
336800     EXEC SQL                                                     33960006
336900        CLOSE TRT_RULE_ID_CUR                                     33970006
337000     END-EXEC                                                     33980006
337100                                                                  33990006
337200*                                                                 34000006
337300     EVALUATE TRUE                                                34010006
337400         WHEN SQLCODE = ZERO                                      34020006
337500             CONTINUE                                             34030006
337600         WHEN SQLWARN0 NOT = SPACES                               34040006
337700         WHEN SQLCODE < ZERO                                      34050006
337800         WHEN SQLCODE > ZERO                                      34060006
337900             MOVE '4650-CLOSE-TRT-RULE-CURSOR'                    34070006
338000                               TO DP013-PARAGRAPH                 34080006
338100             MOVE 'CLOSE CURSOR '                                 34090006
338200                               TO DP013-MESSAGE-TEXT (1)          34100006
338300             MOVE SQLCA        TO DP013-SQLCA                     34110006
338400             MOVE 'TIMCNRL '   TO DP013-DB2-TABLE-NAME (1)        34120006
338500             SET DP013-DB2-ABEND                                  34130006
338600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               34140006
338700             PERFORM DP013-0000-PROCESS-ABEND                     34150006
338800     END-EVALUATE.                                                34160006
338900                                                                  34170006
339000*                                                                 34180006
339100*----------------------------------------------------------------*34190006
339200 4670-FETCH-TRT-RULE-CURS-VSL.                                    34200006
339300                                                                  34210006
339400      EXEC SQL                                                    34220006
339500        FETCH TRT_RULE_ID_CUR                                     34230006
339600         INTO :TRT00014-RUL-ID                                    34240006
339700      END-EXEC                                                    34250006
339800                                                                  34260006
339900*                                                                 34270006
340000      EVALUATE TRUE                                               34280006
340100          WHEN SQLCODE = ZERO                                     34290006
340200               PERFORM 4620-SELECT-RULE-DECN-VSL                  34300006
340300          WHEN SQLCODE = -811                                     34310006
340400               PERFORM 4620-SELECT-RULE-DECN-VSL                  34320006
340500          WHEN SQLCODE = +100                                     34330006
340600            MOVE 'Y' TO PS-END-OF-RULE-CURS-SW                    34340006
340700          WHEN SQLCODE = +100                                     34350006
340800          WHEN SQLCODE = -904                                     34360006
340900          WHEN SQLCODE = -913                                     34370006
341000               CONTINUE                                           34380006
341100          WHEN OTHER                                              34390006
341200               MOVE '4670-FETCH-TRT-RULE-CURS-VSL'                34400006
341300                                TO DP013-PARAGRAPH                34410006
341400               MOVE 'SELECT ERROR'                                34420006
341500                                TO DP013-MESSAGE-TEXT (1)         34430006
341600               MOVE SQLCA       TO DP013-SQLCA                    34440006
341700               MOVE 'TIMCNRL'   TO DP013-DB2-TABLE-NAME (1)       34450006
341800               SET DP013-DB2-ABEND                                34460006
341900                                TO TRUE                           34470006
342000               PERFORM DP013-0000-PROCESS-ABEND                   34480006
342100      END-EVALUATE                                                34490006
342200                                                                  34500006
342300      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                       34510006
342400         MOVE '4670-FETCH-TRT-RULE-CURS-VSL'                      34520006
342500                            TO DP013-PARAGRAPH                    34530006
342600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     34540006
342700                                   TO DP013-MESSAGE-TEXT (1)      34550006
342800         MOVE SQLCA                TO DP013-SQLCA                 34560006
342900         MOVE 'TIMCNRL'            TO DP013-DB2-TABLE-NAME (1)    34570006
343000         SET DP013-DB2-ABEND                                      34580006
343100             DP013-XCTL-DISPLAY-RESTART                           34590006
343200                                   TO TRUE                        34600006
343300         PERFORM DP013-0000-PROCESS-ABEND                         34610006
343400       END-IF                                                     34620006
343500                                                                  34630006
343600     IF SQLCODE  = +100                                           34640006
343700       AND PV-RETRY-COUNTER = 1                                   34650006
343800         MOVE SPACES TO TRT00015-RUL-CNSTR-VAL-TXT.               34660006
343900*                                                                 34670006
344000*----------------------------------------------------------------*34680006
344100 4690-CHECK-VIEW-FOR-RETRANS.                                     34690006
344200                                                                  34700006
344300     IF ASC-VIEW = 'ADJUSTED'                                     34710006
344400         CONTINUE                                                 34720006
344500     ELSE                                                         34730006
344600         SET PS-ERROR                                             34740006
344700             DP020-MSG-FATAL   TO TRUE                            34750006
344800         MOVE PC-TSYMSG-03311  TO DP020-MSG-NUMBER                34760006
344900     END-IF.                                                      34770006
345000*                                                                 34780006
345100*----------------------------------------------------------------*34790006
345200 4700-SPLITS-RETRAN.                                              34800006
345300                                                                  34810006
345400     EVALUATE TRUE                                                34820006
345500                                                                  34830006
345600       WHEN PV-PO-SPLIT-TYP = 'C'                                 34840006
345700           PERFORM 4705-SELECT-DEVAN-DATE                         34850006
345800**RK       IF IMCNTK-DVN-TMST > PC-DEFAULT-TMST                   34860006
345900**RK           SET PS-ERROR                                       34870006
346000**RK               DP020-MSG-FATAL   TO TRUE                      34880006
346100**RK           MOVE PC-TSYMSG-03318  TO DP020-MSG-NUMBER          34890006
346200**RK       ELSE                                                   34900006
346300*              PERFORM 4707-CHECK-FOR-CON-PO                      34910006
346400*              IF PS-CMN-HAS-CON-PO                               34920006
346500*                 SET PS-ERROR                                    34930006
346600*                     DP020-MSG-FATAL   TO TRUE                   34940006
346700*                 MOVE PC-TSYMSG-03333  TO DP020-MSG-NUMBER       34950006
346800*              ELSE                                               34960006
346900                  PERFORM 4710-OPEN-CMN-PO-CURSOR                 34970006
347000                  PERFORM 4720-SET-CMN-RETRAN                     34980006
347100                    UNTIL PS-EOC-CMN-PO-CURSOR                    34990006
347200                  PERFORM 4730-CLOSE-CMN-PO-CURSOR                35000006
347300*              END-IF                                             35010006
347400**RK       END-IF                                                 35020006
347500                                                                  35030006
347600       WHEN PV-PO-SPLIT-TYP = 'P'                                 35040006
347700           PERFORM 4705-SELECT-DEVAN-DATE                         35050006
347800**RK       IF PS-TIMCNTK-EXISTS                                   35060006
347900**RK         AND IMCNTK-DVN-TMST > PC-DEFAULT-TMST                35070006
348000**RK               SET PS-ERROR                                   35080006
348100**RK                   DP020-MSG-FATAL   TO TRUE                  35090006
348200**RK               MOVE PC-TSYMSG-03318  TO DP020-MSG-NUMBER      35100006
348300**RK       ELSE                                                   35110006
348400              PERFORM 4805-SET-CONPO-RETRAN                       35120006
348500**RK       END-IF                                                 35130006
348600                                                                  35140006
348700       WHEN OTHER                                                 35150006
348800*        *** SELECTION NOT VALID FOR REQUESTED FUNCTION  ***      35160006
348900         SET DP030-OVERRIDE-GO TO TRUE                            35170006
349000         MOVE PC-TSYMSG-00146  TO DP020-MSG-NUMBER                35180006
349100         SET DP020-MSG-WARNING TO TRUE                            35190006
349200                                                                  35200006
349300     END-EVALUATE.                                                35210006
349400                                                                  35220006
349500*----------------------------------------------------------------*35230006
349600 4705-SELECT-DEVAN-DATE.                                          35240006
349700                                                                  35250006
349800     SET PS-TIMCNTK-EXISTS-NO  TO TRUE.                           35260006
349900                                                                  35270006
350000     EXEC SQL                                                     35280006
350100           SELECT  DVN_TMST                                       35290006
350200             INTO :IMCNTK-DVN-TMST                                35300006
350300             FROM  TIMCNTK                                        35310006
350400             WHERE CONTNR_ID = :PV-CONTNR-ID                      35320006
350500               AND CONTNR_SEQ_NBR = :PV-CONTNR-SEQ-NBR            35330006
350600     END-EXEC.                                                    35340006
350700                                                                  35350006
350800     EVALUATE TRUE                                                35360006
350900             WHEN SQLCODE = ZERO                                  35370006
351000                 SET PS-TIMCNTK-EXISTS     TO TRUE                35380006
351100                                                                  35390006
351200             WHEN SQLCODE = +100                                  35400006
351300                 SET PS-TIMCNTK-EXISTS-NO  TO TRUE                35410006
351400                                                                  35420006
351500             WHEN SQLWARN0 NOT = SPACES                           35430006
351600             WHEN SQLCODE < ZERO                                  35440006
351700             WHEN SQLCODE > ZERO                                  35450006
351800                 MOVE '4705-SELECT-DEVAN-DATE'                    35460006
351900                                   TO DP013-PARAGRAPH             35470006
352000                 MOVE PV-CONTNR-ID TO DP013-MESSAGE-TEXT (1)      35480006
352100                 MOVE SQLCA        TO DP013-SQLCA                 35490006
352200                 MOVE 'TIMCNTK '   TO DP013-DB2-TABLE-NAME (1)    35500006
352300                 SET DP013-DB2-ABEND                              35510006
352400                     DP013-XCTL-DISPLAY-RESTART TO TRUE           35520006
352500                 PERFORM DP013-0000-PROCESS-ABEND                 35530006
352600     END-EVALUATE.                                                35540006
352700                                                                  35550006
352800*----------------------------------------------------------------*35560006
352900 4707-CHECK-FOR-CON-PO.                                           35570006
353000                                                                  35580006
353100     SET PS-CMN-HAS-CON-PO-NO TO TRUE                             35590006
353200     MOVE TR322-RUL-ID-USED(1) TO PV-SEL-RUL-ID                   35600006
353300                                                                  35610006
353400     EXEC SQL                                                     35620006
353500           SELECT RUL_CNSTR_VAL_TXT                               35630006
353600           INTO  :PV-CON-PO                                       35640006
353700           FROM   TRT_RUL_CNSTR                                   35650006
353800           WHERE  RUL_CNSTR_TYP_CDE = 'CONPO'                     35660006
353900             AND  RUL_ID = :PV-SEL-RUL-ID                         35670006
354000     END-EXEC.                                                    35680006
354100                                                                  35690006
354200     EVALUATE TRUE                                                35700006
354300             WHEN SQLCODE = ZERO                                  35710006
354400             WHEN SQLCODE = -811                                  35720006
354500                 SET PS-CMN-HAS-CON-PO     TO TRUE                35730006
354600             WHEN SQLCODE = +100                                  35740006
354700                 SET PS-CMN-HAS-CON-PO-NO  TO TRUE                35750006
354800             WHEN SQLWARN0 NOT = SPACES                           35760006
354900             WHEN SQLCODE < ZERO                                  35770006
355000             WHEN SQLCODE > ZERO                                  35780006
355100                 MOVE '4707-CHECK-FOR-CON-PO'                     35790006
355200                                      TO DP013-PARAGRAPH          35800006
355300                 MOVE PV-CONTNR-ID    TO DP013-MESSAGE-TEXT (1)   35810006
355400                 MOVE SQLCA           TO DP013-SQLCA              35820006
355500                 MOVE 'TRT_RUL_CNSTR' TO DP013-DB2-TABLE-NAME (1) 35830006
355600                 SET DP013-DB2-ABEND                              35840006
355700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           35850006
355800                 PERFORM DP013-0000-PROCESS-ABEND                 35860006
355900     END-EVALUATE.                                                35870006
356000                                                                  35880006
356100*----------------------------------------------------------------*35890006
356200 4710-OPEN-CMN-PO-CURSOR.                                         35900006
356300                                                                  35910006
356400     PERFORM                                                      35920006
356500         WITH TEST AFTER                                          35930006
356600         VARYING PV-RETRY-COUNTER                                 35940006
356700         FROM 1 BY 1                                              35950006
356800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               35960006
356900             OR (SQLCODE = ZERO))                                 35970006
357000                                                                  35980006
357100            EXEC SQL                                              35990006
357200               OPEN CMN_PO_CUR                                    36000006
357300            END-EXEC                                              36010006
357400                                                                  36020006
357500*                                                                 36030006
357600         EVALUATE TRUE                                            36040006
357700             WHEN SQLCODE = ZERO                                  36050006
357800             WHEN SQLCODE = -904                                  36060006
357900             WHEN SQLCODE = -913                                  36070006
358000                 CONTINUE                                         36080006
358100             WHEN SQLWARN0 NOT = SPACES                           36090006
358200             WHEN SQLCODE < ZERO                                  36100006
358300             WHEN SQLCODE > ZERO                                  36110006
358400                 MOVE '4710-OPEN-CMN-PO-CURSOR'                   36120006
358500                                   TO DP013-PARAGRAPH             36130006
358600                 MOVE 'OPEN CMN PO CURSOR - '                     36140006
358700                                   TO DP013-MESSAGE-TEXT (1)      36150006
358800                 MOVE SQLCA        TO DP013-SQLCA                 36160006
358900                 MOVE 'TIMCNRL '   TO DP013-DB2-TABLE-NAME (1)    36170006
359000                 SET DP013-DB2-ABEND                              36180006
359100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           36190006
359200                 PERFORM DP013-0000-PROCESS-ABEND                 36200006
359300         END-EVALUATE                                             36210006
359400     END-PERFORM.                                                 36220006
359500*                                                                 36230006
359600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        36240006
359700         MOVE '4710-OPEN-CMN-PO-CURSOR' TO DP013-PARAGRAPH        36250006
359800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   36260006
359900                                   TO DP013-MESSAGE-TEXT (1)      36270006
360000         MOVE SQLCA                TO DP013-SQLCA                 36280006
360100         MOVE 'TIMCNRL'  TO DP013-DB2-TABLE-NAME (1)              36290006
360200         SET DP013-DB2-ABEND                                      36300006
360300             DP013-XCTL-DISPLAY-RESTART                           36310006
360400                                   TO TRUE                        36320006
360500         PERFORM DP013-0000-PROCESS-ABEND                         36330006
360600     END-IF.                                                      36340006
360700                                                                  36350006
360800     IF SQLCODE = ZERO                                            36360006
360900        SET PS-EOC-CMN-PO-CURSOR-NO TO TRUE                       36370006
361000        SET PS-CMN-SPLIT-DATA-FOUND-NO TO TRUE                    36380006
361100     END-IF.                                                      36390006
361200                                                                  36400006
361300*----------------------------------------------------------------*36410006
361400 4720-SET-CMN-RETRAN.                                             36420006
361500                                                                  36430006
361600     PERFORM 4740-FETCH-CMN-PO-CURSOR.                            36440006
361700     IF PS-EOC-CMN-PO-CURSOR                                      36450006
361800      IF PS-CMN-SPLIT-DATA-FOUND                                  36460006
361900        CONTINUE                                                  36470006
362000      ELSE                                                        36480006
362100        SET PS-ERROR                                              36490006
362200            DP020-MSG-FATAL         TO TRUE                       36500006
362300        SET PS-PO-SPLIT-FOUND-NO TO TRUE                          36510006
362400        PERFORM 6096-SELECT-FOR-PO-SPLIT                          36520006
362500        IF PS-PO-SPLIT-FOUND                                      36530006
362600*** CANNOT RETRANSMIT CONTAINER - MUST RETRANSMIT PO LEVEL SPLIT  36540006
362700          MOVE PC-TSYMSG-03333        TO DP020-MSG-NUMBER         36550006
362800          SET DP020-MSG-INFORMATIONAL TO TRUE                     36560006
362900          MOVE -1                     TO MR-SELECTL (PV-SUB)      36570006
363000          SET DP030-SET-CURSOR-APPL-1 TO TRUE                     36580006
363100          MOVE DP015-RED              TO MR-SELECTC (PV-SUB)      36590006
363200          MOVE DP015-UNDERLINE        TO MR-SELECTH (PV-SUB)      36600006
363300        ELSE                                                      36610006
363400*         *** CANNOT RETRANSMIT - CONTAINER HAS NOT YET BEEN      36620006
363500*                                               TRANSMITTED ***   36630006
363600          MOVE PC-TSYMSG-03315        TO DP020-MSG-NUMBER         36640006
363700          SET DP020-MSG-INFORMATIONAL TO TRUE                     36650006
363800          MOVE -1                     TO MR-SELECTL (PV-SUB)      36660006
363900          SET DP030-SET-CURSOR-APPL-1 TO TRUE                     36670006
364000          MOVE DP015-RED              TO MR-SELECTC (PV-SUB)      36680006
364100          MOVE DP015-UNDERLINE        TO MR-SELECTH (PV-SUB)      36690006
364200        END-IF                                                    36700006
364300      END-IF                                                      36710006
364400     ELSE                                                         36720006
364500        IF IMCNRL-DCONSLR-RLSE-CDE = 'N'                          36730006
364600*        OR (IMCNRL-DCONSLR-RLSE-CDE = 'D' AND                    36740006
364700*             IMCNRL-LAST-UPD-BY-UID   NOT =   'TRKCS322')        36750006
364800            SET PS-ERROR                                          36760006
364900                DP020-MSG-FATAL         TO TRUE                   36770006
365000*           *** CANNOT RETRANSMIT - CONTAINER HAS NOT YET BEEN    36780006
365100*                                                 TRANSMITTED *** 36790006
365200            MOVE PC-TSYMSG-03315        TO DP020-MSG-NUMBER       36800006
365300            SET DP020-MSG-INFORMATIONAL TO TRUE                   36810006
365400            MOVE -1                     TO MR-SELECTL (PV-SUB)    36820006
365500            SET DP030-SET-CURSOR-APPL-1 TO TRUE                   36830006
365600            MOVE DP015-RED              TO MR-SELECTC (PV-SUB)    36840006
365700            MOVE DP015-UNDERLINE        TO MR-SELECTH (PV-SUB)    36850006
365800            SET PS-EOC-CMN-PO-CURSOR    TO TRUE                   36860006
365900        ELSE                                                      36870006
366000*           IF IMCNRL-DCONSLR-RLSE-CDE = 'S', OR 'R', OR 'Y'      36880006
366100                PERFORM 4760-SELECT-IMCNPO-FOR-AUDIT              36890006
366102*** PRB0040270 - 03/20/2013  PREVENT ABEND FOR NO TIMCNPO - MJF   36900017
366110                IF PS-TIMCNPO-FOUND                               36910014
366200                  PERFORM 4770-CREATE-IMCNPO-AUDIT-TRAIL          36920014
366300                  PERFORM 4750-UPDATE-TIMCNPO                     36930014
366310                END-IF                                            36940014
366320*** PRB0040270 - 03/20/2013 - END                                 36950017
366400                PERFORM 4785-CREATE-IMCNRL-AUDIT-TRAIL            36960006
366500*   THIS WILL UPDATE THE TIMCNRL WITH THE CURRENT SCAC BEING      36970006
366600*   USED IN THE EVENT IT HAS BEEN ADJUSTED.                       36980006
366700                MOVE TR320-DECON-SCAC-CUR TO EXTENT-SCAC-CDE      36990006
366800                SET PS-ENT-ID-FOUND-NO TO TRUE                    37000006
366900                PERFORM 6095-SELECT-ENT-ID                        37010006
367000                MOVE EXTENT-ENT-ID TO IMCNRL-DCONSLR-ENT-ID       37020006
367100*                                                                 37030006
367200                PERFORM 4780-UPDATE-TIMCNRL                       37040006
367300*               **** CONTAINER HAS BEEN SET TO RETRANSMIT ****    37050006
367400                MOVE PC-TSYMSG-03320   TO DP020-MSG-NUMBER        37060006
367500                SET DP020-MSG-INFORMATIONAL TO TRUE               37070006
367600                PERFORM 2140-DESELECT-ALL-ITEMS                   37080006
367700*           ELSE                                                  37090006
367800*               IF (IMCNRL-DCONSLR-RLSE-CDE = 'D' AND             37100006
367900*                   IMCNRL-LAST-UPD-BY-UID = 'TRKCS322')          37110006
368000*                    **** HAS ALREADY BEEN SET TO RETRANSMIT **** 37120006
368100*                    MOVE PC-TSYMSG-03331 TO DP020-MSG-NUMBER     37130006
368200*                    SET DP020-MSG-INFORMATIONAL TO TRUE          37140006
368300*                    SET PS-EOC-CMN-PO-CURSOR    TO TRUE          37150006
368400*               END-IF                                            37160006
368500*           END-IF                                                37170006
368600        END-IF                                                    37180006
368700     END-IF.                                                      37190006
368800                                                                  37200006
368900*----------------------------------------------------------------*37210006
369000 4730-CLOSE-CMN-PO-CURSOR.                                        37220006
369100                                                                  37230006
369200     EXEC SQL                                                     37240006
369300        CLOSE CMN_PO_CUR                                          37250006
369400     END-EXEC                                                     37260006
369500                                                                  37270006
369600*                                                                 37280006
369700     EVALUATE TRUE                                                37290006
369800         WHEN SQLCODE = ZERO                                      37300006
369900             CONTINUE                                             37310006
370000         WHEN SQLWARN0 NOT = SPACES                               37320006
370100         WHEN SQLCODE < ZERO                                      37330006
370200         WHEN SQLCODE > ZERO                                      37340006
370300             MOVE '4730-CLOSE-CMN-PO-CURSOR'                      37350006
370400                               TO DP013-PARAGRAPH                 37360006
370500             MOVE 'CLOSE CURSOR '                                 37370006
370600                               TO DP013-MESSAGE-TEXT (1)          37380006
370700             MOVE SQLCA        TO DP013-SQLCA                     37390006
370800             MOVE 'TIMCNRL '   TO DP013-DB2-TABLE-NAME (1)        37400006
370900             SET DP013-DB2-ABEND                                  37410006
371000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               37420006
371100             PERFORM DP013-0000-PROCESS-ABEND                     37430006
371200     END-EVALUATE.                                                37440006
371300                                                                  37450006
371400*----------------------------------------------------------------*37460006
371500 4740-FETCH-CMN-PO-CURSOR.                                        37470006
371600                                                                  37480006
371700     PERFORM                                                      37490006
371800         WITH TEST AFTER                                          37500006
371900         VARYING PV-RETRY-COUNTER                                 37510006
372000         FROM 1 BY 1                                              37520006
372100         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  37530006
372200             OR SQLCODE  = ZERO                                   37540006
372300             OR SQLCODE  = +100                                   37550006
372400                                                                  37560006
372500      EXEC SQL                                                    37570006
372600        FETCH CMN_PO_CUR                                          37580006
372700         INTO :IMCNRL-CONTNR-ID                                   37590006
372800             ,:IMCNRL-CONTNR-SEQ-NBR                              37600006
372900             ,:IMCNRL-PO-NBR                                      37610006
373000             ,:IMCNRL-DCONSLR-RLSE-CDE                            37620006
373100             ,:IMCNRL-DCONSLR-REQR-DTE                            37630006
373200             ,:IMCNRL-DCONSLR-ACTL-DTE                            37640006
373300             ,:IMCNRL-DCONSLR-ACTL-TM                             37650006
373400             ,:IMCNRL-CRE-TMST                                    37660006
373500             ,:IMCNRL-CRE-BY-UID                                  37670006
373600             ,:IMCNRL-LAST-UPD-TMST                               37680006
373700             ,:IMCNRL-LAST-UPD-BY-UID                             37690006
373800             ,:IMCNRL-DCONSLR-ENT-ID                              37700006
373900      END-EXEC                                                    37710006
374000                                                                  37720006
374100*                                                                 37730006
374200      EVALUATE TRUE                                               37740006
374300          WHEN SQLCODE = ZERO                                     37750006
374400          WHEN SQLCODE = +100                                     37760006
374500          WHEN SQLCODE = -904                                     37770006
374600          WHEN SQLCODE = -913                                     37780006
374700               CONTINUE                                           37790006
374800          WHEN OTHER                                              37800006
374900               MOVE '4740-FETCH-CMN-PO-CURSOR'                    37810006
375000                                TO DP013-PARAGRAPH                37820006
375100               MOVE 'SELECT ERROR'                                37830006
375200                                TO DP013-MESSAGE-TEXT (1)         37840006
375300               MOVE SQLCA       TO DP013-SQLCA                    37850006
375400               MOVE 'TIMCNRL'   TO DP013-DB2-TABLE-NAME (1)       37860006
375500               SET DP013-DB2-ABEND                                37870006
375600                                TO TRUE                           37880006
375700               PERFORM DP013-0000-PROCESS-ABEND                   37890006
375800      END-EVALUATE                                                37900006
375900                                                                  37910006
376000      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                       37920006
376100         MOVE '4740-FETCH-CMN-PO-CURSOR'                          37930006
376200                            TO DP013-PARAGRAPH                    37940006
376300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     37950006
376400                                   TO DP013-MESSAGE-TEXT (1)      37960006
376500         MOVE SQLCA                TO DP013-SQLCA                 37970006
376600         MOVE 'TIMCNRL'            TO DP013-DB2-TABLE-NAME (1)    37980006
376700         SET DP013-DB2-ABEND                                      37990006
376800             DP013-XCTL-DISPLAY-RESTART                           38000006
376900                                   TO TRUE                        38010006
377000         PERFORM DP013-0000-PROCESS-ABEND                         38020006
377100       END-IF                                                     38030006
377200                                                                  38040006
377300     END-PERFORM.                                                 38050006
377400*                                                                 38060006
377500     EVALUATE TRUE                                                38070006
377600       WHEN SQLCODE EQUAL ZERO                                    38080006
377700         SET PS-CMN-SPLIT-DATA-FOUND TO TRUE                      38090006
377800       WHEN SQLCODE EQUAL +100                                    38100006
377900         SET PS-EOC-CMN-PO-CURSOR    TO TRUE                      38110006
378000     END-EVALUATE.                                                38120006
378100*                                                                 38130006
378200*----------------------------------------------------------------*38140006
378300 4750-UPDATE-TIMCNPO.                                             38150006
378400                                                                  38160006
378500         EXEC SQL                                                 38170006
378600             UPDATE TIMCNPO                                       38180006
378700                SET SPLT_XMIT_CDE    = ' '                        38190006
378800                 ,  LAST_UPD_TMST    = (CURRENT TIMESTAMP)        38200006
378900                 ,  LAST_UPD_BY_USR_ID                            38210006
379000                                     = :PC-CURRENT-PROGRAM-NAME   38220006
379100              WHERE CONTNR_ID        = :IMCNRL-CONTNR-ID          38230006
379200                AND CONTNR_SEQ_NBR   = :IMCNRL-CONTNR-SEQ-NBR     38240006
379300                AND PO_NBR           = :IMCNRL-PO-NBR             38250006
379400         END-EXEC                                                 38260006
379500                                                                  38270006
379600     EVALUATE TRUE                                                38280006
379700         WHEN SQLCODE = ZERO                                      38290006
379800             CONTINUE                                             38300006
379900                                                                  38310006
380000         WHEN SQLCODE NOT = ZERO                                  38320006
380100         WHEN SQLWARN0 NOT = SPACE                                38330006
380200         WHEN SQLCODE NOT = ZERO                                  38340006
380300              MOVE '4750-UPDATE-TIMCNPO'                          38350006
380400                               TO DP013-PARAGRAPH                 38360006
380500              MOVE 'TRYING TO RETRAN SPLITS'                      38370006
380600                               TO DP013-MESSAGE-TEXT (1)          38380006
380700              MOVE SQLCA       TO DP013-SQLCA                     38390006
380800              SET DP013-DB2-ABEND                                 38400006
380900                               TO TRUE                            38410006
381000              PERFORM DP013-0000-PROCESS-ABEND                    38420006
381100     END-EVALUATE.                                                38430006
381200                                                                  38440006
381300******************************************************************38450014
381400* SELECT IMCNPO ROW INTO AUDIT HOST VARIABLES.                   *38460006
381401*** PRB0040270 - 03/20/2013  PREVENT ABEND FOR NO TIMCNPO - MJF   38470017
381410***     SET INDICATOR FOR ROW FOUND TO TRUE                      *38480017
381420*----------------------------------------------------------------*38490014
381500******************************************************************38500006
381600 4760-SELECT-IMCNPO-FOR-AUDIT.                                    38510006
381700                                                                  38520006
381710         SET PS-TIMCNPO-FOUND-NO TO TRUE.                         38530014
381720                                                                  38540014
381800         EXEC SQL                                                 38550006
381900             SELECT CONTNR_ID                                     38560006
382000                   ,CONTNR_SEQ_NBR                                38570006
382100                   ,PO_NBR                                        38580006
382200                   ,CSTM_ENTR_ID                                  38590006
382300                   ,MSTR_BOL_NBR                                  38600006
382400                   ,HSE_BOL_NBR                                   38610006
382500                   ,LTR_OF_CR_NBR                                 38620006
382600                   ,PO_RCVD_DELY_TMST                             38630006
382700                   ,PO_C_O_PROD_CDE                               38640006
382800                   ,PO_CART_CNT                                   38650006
382900                   ,PO_CBMT_QTY                                   38660006
383000                   ,PO_WT_KGRM_QTY                                38670006
383100                   ,PO_UNT_QTY                                    38680006
383200                   ,LAST_UPD_BY_USR_ID                            38690006
383300                   ,LAST_UPD_TMST                                 38700006
383400                   ,EXTL_REF_NBR                                  38710006
383500                   ,BKR_FRGT_RLSE_CDE                             38720006
383600                   ,DO_RCVD_CDE                                   38730006
383700                   ,CONTNR_PU_CDE                                 38740006
383800                   ,ACTL_POE_DELY_CDE                             38750006
383900                   ,DVN_CDE                                       38760006
384000                   ,DCONSLR_RET_CDE                               38770006
384100                   ,SPLT_XMIT_CDE                                 38780006
384200                   ,DOC_RCVD_ORGN_TMST                            38790006
384300               INTO :AUCNPO-CONTNR-ID                             38800006
384400                   ,:AUCNPO-CONTNR-SEQ-NBR                        38810006
384500                   ,:AUCNPO-PO-NBR                                38820006
384600                   ,:AUCNPO-CSTM-ENTR-ID                          38830006
384700                   ,:AUCNPO-MSTR-BOL-NBR                          38840006
384800                   ,:AUCNPO-HSE-BOL-NBR                           38850006
384900                   ,:AUCNPO-LTR-OF-CR-NBR                         38860006
385000                   ,:AUCNPO-PO-RCVD-DELY-TMST                     38870006
385100                   ,:AUCNPO-PO-C-O-PROD-CDE                       38880006
385200                   ,:AUCNPO-PO-CART-CNT                           38890006
385300                   ,:AUCNPO-PO-CBMT-QTY                           38900006
385400                   ,:AUCNPO-PO-WT-KGRM-QTY                        38910006
385500                   ,:AUCNPO-PO-UNT-QTY                            38920006
385600                   ,:AUCNPO-LAST-UPD-BY-USR-ID                    38930006
385700                   ,:AUCNPO-LAST-UPD-TMST                         38940006
385800                   ,:AUCNPO-EXTL-REF-NBR                          38950006
385900                   ,:AUCNPO-BKR-FRGT-RLSE-CDE                     38960006
386000                   ,:AUCNPO-DO-RCVD-CDE                           38970006
386100                   ,:AUCNPO-CONTNR-PU-CDE                         38980006
386200                   ,:AUCNPO-ACTL-POE-DELY-CDE                     38990006
386300                   ,:AUCNPO-DVN-CDE                               39000006
386400                   ,:AUCNPO-DCONSLR-RET-CDE                       39010006
386500                   ,:AUCNPO-SPLT-XMIT-CDE                         39020006
386600                   ,:AUCNPO-DOC-RCVD-ORGN-TMST                    39030006
386700               FROM TIMCNPO                                       39040006
386800              WHERE CONTNR_ID        = :IMCNRL-CONTNR-ID          39050006
386900                AND CONTNR_SEQ_NBR   = :IMCNRL-CONTNR-SEQ-NBR     39060006
387000                AND PO_NBR           = :IMCNRL-PO-NBR             39070006
387100         END-EXEC                                                 39080006
387200                                                                  39090006
387300         EVALUATE TRUE                                            39100006
387400         WHEN SQLCODE = ZERO                                      39110006
387410              SET PS-TIMCNPO-FOUND TO TRUE                        39120014
387500         WHEN SQLCODE = +100                                      39130006
387600              CONTINUE                                            39140014
387700                                                                  39150006
387800         WHEN SQLWARN0 NOT EQUAL SPACE                            39160006
387900         WHEN SQLCODE NOT EQUAL ZERO                              39170006
388000              MOVE '4760-SELECT-IMCNPO-FOR-AUDIT'                 39180006
388100                               TO DP013-PARAGRAPH                 39190006
388200              MOVE 'TRYING TO RETRAN SPLITS'                      39200006
388300                               TO DP013-MESSAGE-TEXT (1)          39210006
388400              MOVE SQLCA       TO DP013-SQLCA                     39220006
388500              SET DP013-DB2-ABEND                                 39230006
388600                               TO TRUE                            39240006
388700              PERFORM DP013-0000-PROCESS-ABEND                    39250006
388800         END-EVALUATE.                                            39260006
388900                                                                  39270006
389000******************************************************************39280006
389100* INSERT A COPY OF THE IMCNPO ROW TO THE AUDIT TRAIL TABLE       *39290006
389200* AFTER UPDATING THE TIMCNPO TABLE.                              *39300006
389300******************************************************************39310006
389400 4770-CREATE-IMCNPO-AUDIT-TRAIL.                                  39320006
389500                                                                  39330006
389600         EXEC SQL                                                 39340006
389700             INSERT INTO TAUCNPO                                  39350006
389800                   (CONTNR_ID                                     39360006
389900                   ,CONTNR_SEQ_NBR                                39370006
390000                   ,PO_NBR                                        39380006
390100                   ,CSTM_ENTR_ID                                  39390006
390200                   ,MSTR_BOL_NBR                                  39400006
390300                   ,HSE_BOL_NBR                                   39410006
390400                   ,LTR_OF_CR_NBR                                 39420006
390500                   ,PO_RCVD_DELY_TMST                             39430006
390600                   ,PO_C_O_PROD_CDE                               39440006
390700                   ,PO_CART_CNT                                   39450006
390800                   ,PO_CBMT_QTY                                   39460006
390900                   ,PO_WT_KGRM_QTY                                39470006
391000                   ,PO_UNT_QTY                                    39480006
391100                   ,LAST_UPD_BY_USR_ID                            39490006
391200                   ,LAST_UPD_TMST                                 39500006
391300                   ,EXTL_REF_NBR                                  39510006
391400                   ,BKR_FRGT_RLSE_CDE                             39520006
391500                   ,DO_RCVD_CDE                                   39530006
391600                   ,CONTNR_PU_CDE                                 39540006
391700                   ,ACTL_POE_DELY_CDE                             39550006
391800                   ,DVN_CDE                                       39560006
391900                   ,DCONSLR_RET_CDE                               39570006
392000                   ,SPLT_XMIT_CDE                                 39580006
392100                   ,DOC_RCVD_ORGN_TMST                            39590006
392200                   ,AUD_FUNC_CDE                                  39600006
392300                   ,AUD_TMST)                                     39610006
392400            VALUES (:AUCNPO-CONTNR-ID                             39620006
392500                   ,:AUCNPO-CONTNR-SEQ-NBR                        39630006
392600                   ,:AUCNPO-PO-NBR                                39640006
392700                   ,:AUCNPO-CSTM-ENTR-ID                          39650006
392800                   ,:AUCNPO-MSTR-BOL-NBR                          39660006
392900                   ,:AUCNPO-HSE-BOL-NBR                           39670006
393000                   ,:AUCNPO-LTR-OF-CR-NBR                         39680006
393100                   ,:AUCNPO-PO-RCVD-DELY-TMST                     39690006
393200                   ,:AUCNPO-PO-C-O-PROD-CDE                       39700006
393300                   ,:AUCNPO-PO-CART-CNT                           39710006
393400                   ,:AUCNPO-PO-CBMT-QTY                           39720006
393500                   ,:AUCNPO-PO-WT-KGRM-QTY                        39730006
393600                   ,:AUCNPO-PO-UNT-QTY                            39740006
393700                   ,:AUCNPO-LAST-UPD-BY-USR-ID                    39750006
393800                   ,:AUCNPO-LAST-UPD-TMST                         39760006
393900                   ,:AUCNPO-EXTL-REF-NBR                          39770006
394000                   ,:AUCNPO-BKR-FRGT-RLSE-CDE                     39780006
394100                   ,:AUCNPO-DO-RCVD-CDE                           39790006
394200                   ,:AUCNPO-CONTNR-PU-CDE                         39800006
394300                   ,:AUCNPO-ACTL-POE-DELY-CDE                     39810006
394400                   ,:AUCNPO-DVN-CDE                               39820006
394500                   ,:AUCNPO-DCONSLR-RET-CDE                       39830006
394600                   ,:AUCNPO-SPLT-XMIT-CDE                         39840006
394700                   ,:AUCNPO-DOC-RCVD-ORGN-TMST                    39850006
394800                   ,'U'                                           39860006
394900                   ,(CURRENT TIMESTAMP))                          39870006
395000         END-EXEC                                                 39880006
395100                                                                  39890006
395200         EVALUATE TRUE                                            39900006
395300                                                                  39910006
395400         WHEN SQLCODE = ZERO                                      39920006
395500              CONTINUE                                            39930006
395600                                                                  39940006
395700         WHEN SQLWARN0 NOT EQUAL SPACE                            39950006
395800         WHEN SQLCODE NOT EQUAL ZERO                              39960006
395900              MOVE '4770-CREATE-IMCNPO-AUDIT-TRAIL'               39970006
396000                               TO DP013-PARAGRAPH                 39980006
396100              MOVE 'TRYING TO RETRAN SPLITS'                      39990006
396200                               TO DP013-MESSAGE-TEXT (1)          40000006
396300              MOVE SQLCA       TO DP013-SQLCA                     40010006
396400              SET DP013-DB2-ABEND                                 40020006
396500                               TO TRUE                            40030006
396600              PERFORM DP013-0000-PROCESS-ABEND                    40040006
396700         END-EVALUATE.                                            40050006
396800*-----------------------------------------------------------------40060006
396900 4780-UPDATE-TIMCNRL.                                             40070006
397000                                                                  40080006
397100         EXEC SQL                                                 40090006
397200             UPDATE TIMCNRL                                       40100006
397300                SET                                               40110006
397400                   DCONSLR_RLSE_CDE = 'D'                         40120006
397500                 , DCONSLR_ACTL_DTE = :PC-DEFAULT-DTE-9           40130006
397600                 , DCONSLR_ACTL_TM  = :PC-DEFAULT-TME-9           40140006
397700                 , LAST_UPD_TMST    = (CURRENT TIMESTAMP)         40150006
397800                 , LAST_UPD_BY_UID  = :PC-CURRENT-PROGRAM-NAME    40160006
397900                 , DCONSLR_ENT_ID   = :IMCNRL-DCONSLR-ENT-ID      40170006
398000              WHERE CONTNR_ID       = :IMCNRL-CONTNR-ID           40180006
398100                AND CONTNR_SEQ_NBR  = :IMCNRL-CONTNR-SEQ-NBR      40190006
398200                AND PO_NBR          = :IMCNRL-PO-NBR              40200006
398300         END-EXEC                                                 40210006
398400                                                                  40220006
398500     EVALUATE TRUE                                                40230006
398600         WHEN SQLCODE = ZERO                                      40240006
398700             CONTINUE                                             40250006
398800                                                                  40260006
398900         WHEN SQLWARN0 NOT EQUAL SPACE                            40270006
399000         WHEN SQLCODE NOT EQUAL ZERO                              40280006
399100              MOVE '4780-UPDATE-TIMCNRL'                          40290006
399200                               TO DP013-PARAGRAPH                 40300006
399300              MOVE 'TRYING TO RETRAN SPLITS'                      40310006
399400                               TO DP013-MESSAGE-TEXT (1)          40320006
399500              MOVE SQLCA       TO DP013-SQLCA                     40330006
399600              SET DP013-DB2-ABEND                                 40340006
399700                               TO TRUE                            40350006
399800              PERFORM DP013-0000-PROCESS-ABEND                    40360006
399900     END-EVALUATE.                                                40370006
400000                                                                  40380006
400100*----------------------------------------------------------------*40390006
400200 4785-CREATE-IMCNRL-AUDIT-TRAIL.                                  40400006
400300                                                                  40410006
400400         EXEC SQL                                                 40420006
400500             INSERT INTO TAUCNRL                                  40430006
400600                   (CONTNR_ID                                     40440006
400700                   ,CONTNR_SEQ_NBR                                40450006
400800                   ,PO_NBR                                        40460006
400900                   ,DCONSLR_RLSE_CDE                              40470006
401000                   ,DCONSLR_REQR_DTE                              40480006
401100                   ,DCONSLR_ACTL_DTE                              40490006
401200                   ,DCONSLR_ACTL_TM                               40500006
401300                   ,CRE_TMST                                      40510006
401400                   ,CRE_BY_UID                                    40520006
401500                   ,LAST_UPD_TMST                                 40530006
401600                   ,LAST_UPD_BY_UID                               40540006
401700                   ,AUD_FUNC_CDE                                  40550006
401800                   ,AUD_TMST                                      40560006
401900                   ,DCONSLR_ENT_ID)                               40570006
402000            VALUES (:IMCNRL-CONTNR-ID                             40580006
402100                   ,:IMCNRL-CONTNR-SEQ-NBR                        40590006
402200                   ,:IMCNRL-PO-NBR                                40600006
402300                   ,:IMCNRL-DCONSLR-RLSE-CDE                      40610006
402400                   ,:IMCNRL-DCONSLR-REQR-DTE                      40620006
402500                   ,:IMCNRL-DCONSLR-ACTL-DTE                      40630006
402600                   ,:IMCNRL-DCONSLR-ACTL-TM                       40640006
402700                   ,:IMCNRL-CRE-TMST                              40650006
402800                   ,:IMCNRL-CRE-BY-UID                            40660006
402900                   ,:IMCNRL-LAST-UPD-TMST                         40670006
403000                   ,:IMCNRL-LAST-UPD-BY-UID                       40680006
403100                   ,'U'                                           40690006
403200                   ,(CURRENT TIMESTAMP)                           40700006
403300                   ,:IMCNRL-DCONSLR-ENT-ID)                       40710006
403400         END-EXEC                                                 40720006
403500                                                                  40730006
403600         EVALUATE TRUE                                            40740006
403700                                                                  40750006
403800         WHEN SQLCODE = ZERO                                      40760006
403900              CONTINUE                                            40770006
404000                                                                  40780006
404100         WHEN SQLWARN0 NOT EQUAL SPACE                            40790006
404200         WHEN SQLCODE NOT EQUAL ZERO                              40800006
404300              MOVE '4785-CREATE-IMCNRL-AUDIT-TRAIL'               40810006
404400                               TO DP013-PARAGRAPH                 40820006
404500              MOVE 'TRYING TO RETRAN SPLITS'                      40830006
404600                               TO DP013-MESSAGE-TEXT (1)          40840006
404700              MOVE SQLCA       TO DP013-SQLCA                     40850006
404800              SET DP013-DB2-ABEND                                 40860006
404900                               TO TRUE                            40870006
405000              PERFORM DP013-0000-PROCESS-ABEND                    40880006
405100         END-EVALUATE.                                            40890006
405200                                                                  40900006
405300*----------------------------------------------------------------*40910006
405400 4805-SET-CONPO-RETRAN.                                           40920006
405500                                                                  40930006
405600*                                                                 40940006
405700     SET PS-CONPO-SPLIT-DATA-FOUND-NO TO TRUE.                    40950006
405800     SET PS-CONPO-SPLIT-CUR-AT-END-NO TO TRUE.                    40960006
405900                                                                  40970006
406000     PERFORM 4806-OPEN-CONPO-SPLIT-CUR.                           40980006
406100                                                                  40990006
406200     PERFORM 4815-FETCH-CONPO-SPLIT-DATA                          41000006
406300         UNTIL PS-CONPO-SPLIT-CUR-AT-END-YES.                     41010006
406400                                                                  41020006
406500     IF PS-CONPO-SPLIT-DATA-FOUND-NO                              41030006
406600       SET PS-ERROR                                               41040006
406700           DP020-MSG-FATAL                                        41050006
406800                         TO TRUE                                  41060006
406900*      ***  CANNOT RETRANSMIT - PO HAS NOT YET BEEN               41070006
407000*      ***                              TRANSMITTED ***           41080006
407100       MOVE PC-TSYMSG-03319                                       41090006
407200                         TO DP020-MSG-NUMBER                      41100006
407300       MOVE -1           TO MR-SELECTL (PV-SUB)                   41110006
407400       SET DP030-SET-CURSOR-APPL-1                                41120006
407500                         TO TRUE                                  41130006
407600       MOVE DP015-RED    TO MR-SELECTC (PV-SUB)                   41140006
407700       MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)                41150006
407800       PERFORM 4807-CLOSE-CONPO-SPLIT-CUR                         41160006
407900     ELSE                                                         41170006
408000       PERFORM 4825-SELECT-TIMPORL                                41180006
408100       PERFORM 4830-INACTIVATE-TIMPORL                            41190006
408200*   THIS WILL UPDATE THE TIMPORL WITH THE CURRENT SCAC BEING      41200006
408300*   USED IN THE EVENT IT HAS BEEN ADJUSTED.                       41210006
408400       MOVE TR320-DECON-SCAC-CUR TO EXTENT-SCAC-CDE               41220006
408500       SET PS-ENT-ID-FOUND-NO TO TRUE                             41230006
408600       PERFORM 6095-SELECT-ENT-ID                                 41240006
408700       MOVE EXTENT-ENT-ID TO IMPORL-DCONSLR-ENT-ID                41250006
408800*                                                                 41260006
408900       ADD  +1  TO IMPORL-VER-NBR                                 41270006
409000       MOVE 'A' TO IMPORL-VER-STATUS-CDE                          41280006
409100       MOVE 'D' TO IMPORL-DCONSLR-RLSE-CDE                        41290006
409200       PERFORM 4835-INSERT-TIMPORL                                41300006
409300**** PO HAS BEEN SET TO RETRANSMIT  ***                           41310006
409400       MOVE PC-TSYMSG-03321   TO DP020-MSG-NUMBER                 41320006
409500       SET DP020-MSG-INFORMATIONAL TO TRUE                        41330006
409600       PERFORM 4807-CLOSE-CONPO-SPLIT-CUR                         41340006
409700**** RESET THE SELECT FIELD ***                                   41350006
409800       PERFORM 2140-DESELECT-ALL-ITEMS                            41360006
409900     END-IF.                                                      41370006
410000                                                                  41380006
410100*----------------------------------------------------------------*41390006
410200 4806-OPEN-CONPO-SPLIT-CUR.                                       41400006
410300                                                                  41410006
410400     PERFORM                                                      41420006
410500         WITH TEST AFTER                                          41430006
410600         VARYING PV-RETRY-COUNTER                                 41440006
410700         FROM 1 BY 1                                              41450006
410800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               41460006
410900             OR (SQLCODE = ZERO))                                 41470006
411000                                                                  41480006
411100            EXEC SQL                                              41490006
411200               OPEN CONPO_SPLIT_CUR                               41500006
411300            END-EXEC                                              41510006
411400                                                                  41520006
411500*                                                                 41530006
411600         EVALUATE TRUE                                            41540006
411700             WHEN SQLCODE = ZERO                                  41550006
411800             WHEN SQLCODE = -904                                  41560006
411900             WHEN SQLCODE = -913                                  41570006
412000                 CONTINUE                                         41580006
412100             WHEN SQLWARN0 NOT = SPACES                           41590006
412200             WHEN SQLCODE < ZERO                                  41600006
412300             WHEN SQLCODE > ZERO                                  41610006
412400                 MOVE '4806-OPEN-CONPO-SPLIT-CUR'                 41620006
412500                                   TO DP013-PARAGRAPH             41630006
412600                 MOVE 'TRYING TO OPEN CUR '                       41640006
412700                                   TO DP013-MESSAGE-TEXT (1)      41650006
412800                 MOVE SPACES       TO DP013-MESSAGE-TEXT (2)      41660006
412900                 MOVE SPACES       TO DP013-MESSAGE-TEXT (3)      41670006
413000                 MOVE SQLCA        TO DP013-SQLCA                 41680006
413100                 MOVE SPACES       TO DP013-DB2-TABLE-NAME (1)    41690006
413200                 SET DP013-DB2-ABEND                              41700006
413300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           41710006
413400                 PERFORM DP013-0000-PROCESS-ABEND                 41720006
413500         END-EVALUATE                                             41730006
413600     END-PERFORM.                                                 41740006
413700*                                                                 41750006
413800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        41760006
413900         MOVE '4806-OPEN-CONPO-SPLIT-CUR  ' TO DP013-PARAGRAPH    41770006
414000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   41780006
414100                                   TO DP013-MESSAGE-TEXT (1)      41790006
414200         MOVE SQLCA                TO DP013-SQLCA                 41800006
414300         MOVE SPACES               TO DP013-DB2-TABLE-NAME (1)    41810006
414400         SET DP013-DB2-ABEND                                      41820006
414500             DP013-XCTL-DISPLAY-RESTART                           41830006
414600                                   TO TRUE                        41840006
414700         PERFORM DP013-0000-PROCESS-ABEND                         41850006
414800     END-IF.                                                      41860006
414900*----------------------------------------------------------------*41870006
415000                                                                  41880006
415100 4807-CLOSE-CONPO-SPLIT-CUR.                                      41890006
415200                                                                  41900006
415300     EXEC SQL                                                     41910006
415400        CLOSE CONPO_SPLIT_CUR                                     41920006
415500     END-EXEC                                                     41930006
415600                                                                  41940006
415700*                                                                 41950006
415800     EVALUATE TRUE                                                41960006
415900         WHEN SQLCODE = ZERO                                      41970006
416000             CONTINUE                                             41980006
416100         WHEN SQLWARN0 NOT = SPACES                               41990006
416200         WHEN SQLCODE < ZERO                                      42000006
416300         WHEN SQLCODE > ZERO                                      42010006
416400             MOVE '4807-CLOSE-CONPO-SPLIT-CUR'                    42020006
416500                               TO DP013-PARAGRAPH                 42030006
416600             MOVE 'CLOSE CURSOR '                                 42040006
416700                               TO DP013-MESSAGE-TEXT (1)          42050006
416800             MOVE SQLCA        TO DP013-SQLCA                     42060006
416900             MOVE SPACES       TO DP013-DB2-TABLE-NAME (1)        42070006
417000             SET DP013-DB2-ABEND                                  42080006
417100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               42090006
417200             PERFORM DP013-0000-PROCESS-ABEND                     42100006
417300     END-EVALUATE.                                                42110006
417400*----------------------------------------------------------------*42120006
417500 4815-FETCH-CONPO-SPLIT-DATA.                                     42130006
417600                                                                  42140006
417700     PERFORM                                                      42150006
417800         WITH TEST AFTER                                          42160006
417900         VARYING PV-RETRY-COUNTER                                 42170006
418000         FROM 1 BY 1                                              42180006
418100         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  42190006
418200             OR SQLCODE  = +100                                   42200006
418300             OR SQLCODE  = ZERO                                   42210006
418400                                                                  42220006
418500         EXEC SQL                                                 42230006
418600             FETCH CONPO_SPLIT_CUR                                42240006
418700             INTO :SHPTPO-PO-NBR                                  42250006
418800                 ,:SHPTPO-LAST-UPD-PGM-ID                         42260006
418900                 ,:SHPTPO-SPLT-XMIT-IND                           42270006
419000                 ,:IMPORL-DCONSLR-RLSE-CDE                        42280006
419100                 ,:IMPORL-LAST-UPD-BY-UID                         42290006
419200                 ,:VHTRIP-TRIP-ID                                 42300006
419300                 ,:SHIPMT-SHIPT-ID                                42310006
419400         END-EXEC                                                 42320006
419500                                                                  42330006
419600*                                                                 42340006
419700         EVALUATE TRUE                                            42350006
419800             WHEN SQLCODE = ZERO                                  42360006
419900             WHEN SQLCODE = -904                                  42370006
420000             WHEN SQLCODE = -913                                  42380006
420100             WHEN SQLCODE = +100                                  42390006
420200                 CONTINUE                                         42400006
420300             WHEN OTHER                                           42410006
420400                  MOVE '4815-FETCH-CONPO-SPLIT-DATA'              42420006
420500                                   TO DP013-PARAGRAPH             42430006
420600                  MOVE 'FETCH ERROR'                              42440006
420700                                   TO DP013-MESSAGE-TEXT (1)      42450006
420800                  MOVE SQLCA       TO DP013-SQLCA                 42460006
420900                  MOVE 'SPACES '   TO DP013-DB2-TABLE-NAME (1)    42470006
421000                  SET DP013-DB2-ABEND                             42480006
421100                                TO TRUE                           42490006
421200                  PERFORM DP013-0000-PROCESS-ABEND                42500006
421300         END-EVALUATE                                             42510006
421400                                                                  42520006
421500         IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                    42530006
421600            MOVE '4815-SELECT-CONPO-SPLIT-DATA'                   42540006
421700                               TO DP013-PARAGRAPH                 42550006
421800            MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'  42560006
421900                                      TO DP013-MESSAGE-TEXT (1)   42570006
422000            MOVE SQLCA                TO DP013-SQLCA              42580006
422100            MOVE SPACES               TO DP013-DB2-TABLE-NAME (1) 42590006
422200            SET DP013-DB2-ABEND                                   42600006
422300                 DP013-XCTL-DISPLAY-RESTART                       42610006
422400                                   TO TRUE                        42620006
422500            PERFORM DP013-0000-PROCESS-ABEND                      42630006
422600         END-IF                                                   42640006
422700                                                                  42650006
422800     END-PERFORM.                                                 42660006
422900*                                                                 42670006
423000     EVALUATE TRUE                                                42680006
423100       WHEN SQLCODE EQUAL +100                                    42690006
423200           SET PS-CONPO-SPLIT-CUR-AT-END-YES TO TRUE              42700006
423300       WHEN SQLCODE EQUAL ZERO                                    42710006
423400            SET PS-CONPO-SPLIT-DATA-FOUND TO TRUE                 42720006
423500           IF IMPORL-DCONSLR-RLSE-CDE = 'N'                       42730006
423600            OR (IMPORL-DCONSLR-RLSE-CDE = 'D' AND                 42740006
423700                IMPORL-LAST-UPD-BY-UID   NOT =   'TRKCS322')      42750006
423800               SET PS-ERROR                                       42760006
423900                   DP020-MSG-FATAL                                42770006
424000                              TO TRUE                             42780006
424100*       ***  CANNOT RETRANSMIT - PO HAS NOT YET BEEN              42790006
424200*       ***                              TRANSMITTED ***          42800006
424300               MOVE PC-TSYMSG-03319                               42810006
424400                              TO DP020-MSG-NUMBER                 42820006
424500               MOVE -1        TO MR-SELECTL (PV-SUB)              42830006
424600               SET DP030-SET-CURSOR-APPL-1                        42840006
424700                              TO TRUE                             42850006
424800               MOVE DP015-RED TO MR-SELECTC (PV-SUB)              42860006
424900               MOVE DP015-UNDERLINE                               42870006
425000                              TO MR-SELECTH (PV-SUB)              42880006
425100           ELSE                                                   42890006
425200             IF IMPORL-DCONSLR-RLSE-CDE = 'S' OR 'R' OR 'Y' OR 'D'42900006
425300                 IF SHPTPO-LAST-UPD-PGM-ID = 'TRKCS322'           42910006
425400                    AND SHPTPO-SPLT-XMIT-IND = ' '                42920006
425500*           *** HAS ALREADY BEEN SET TO RETRANSMIT ***            42930006
425600                    MOVE PC-TSYMSG-03331 TO DP020-MSG-NUMBER      42940006
425700                    SET DP020-MSG-INFORMATIONAL TO TRUE           42950006
425800                 ELSE                                             42960006
425900                    PERFORM 4845-UPDATE-TVHTRIP                   42970006
426000                    PERFORM 4820-UPDATE-TSHPTPO                   42980006
426100                 END-IF                                           42990006
426200             END-IF                                               43000006
426300           END-IF                                                 43010006
426400                                                                  43020006
426500     END-EVALUATE.                                                43030006
426600                                                                  43040006
426700*----------------------------------------------------------------*43050006
426800                                                                  43060006
426900 4820-UPDATE-TSHPTPO.                                             43070006
427000                                                                  43080006
427100         EXEC SQL                                                 43090006
427200            UPDATE TSHPTPO                                        43100006
427300               SET SPLT_XMIT_IND    = ' '                         43110006
427400                ,  SPLT_XMIT_DTE    = :PC-DEFAULT-DTE             43120006
427500                ,  SPLT_XMIT_TM     = :PC-DEFAULT-TME             43130006
427600                ,  LAST_UPD_DTE     = (CURRENT DATE)              43140006
427700                ,  LAST_UPD_TIME    = (CURRENT TIME)              43150006
427800                ,  LAST_UPD_USER_ID = :DP020-USERID               43160006
427900                ,  LAST_UPD_PGM_ID  = :PC-CURRENT-PROGRAM-NAME    43170006
428000             WHERE SHIPT_ID         = :SHIPMT-SHIPT-ID            43180006
428100               AND PO_NBR           = :SHPTPO-PO-NBR              43190006
428200         END-EXEC                                                 43200006
428300                                                                  43210006
428400     EVALUATE TRUE                                                43220006
428500         WHEN SQLCODE = ZERO                                      43230006
428600             CONTINUE                                             43240006
428700                                                                  43250006
428800         WHEN SQLCODE NOT = ZERO                                  43260006
428900         WHEN SQLWARN0 NOT = SPACE                                43270006
429000         WHEN SQLCODE NOT = ZERO                                  43280006
429100              MOVE '4820-UPDATE-TSHPTPO'                          43290006
429200                               TO DP013-PARAGRAPH                 43300006
429300              MOVE 'TRYING TO RETRAN SPLITS'                      43310006
429400                               TO DP013-MESSAGE-TEXT (1)          43320006
429500              MOVE SQLCA       TO DP013-SQLCA                     43330006
429600              SET DP013-DB2-ABEND                                 43340006
429700                               TO TRUE                            43350006
429800              PERFORM DP013-0000-PROCESS-ABEND                    43360006
429900     END-EVALUATE.                                                43370006
430000                                                                  43380006
430100******************************************************************43390006
430200 4825-SELECT-TIMPORL.                                             43400006
430300                                                                  43410006
430400         EXEC SQL                                                 43420006
430500             SELECT PO_NBR                                        43430006
430600                  , VER_NBR                                       43440006
430700                  , VER_STATUS_CDE                                43450006
430800                  , CONSLR_RLSE_CDE                               43460006
430900                  , CONSLR_REQR_DTE                               43470006
431000                  , CONSLR_ACTL_DTE                               43480006
431100                  , CONSLR_ACTL_TM                                43490006
431200                  , CSTM_BKR_RLSE_CDE                             43500006
431300                  , CSTM_BKR_REQR_DTE                             43510006
431400                  , CSTM_BKR_ACTL_DTE                             43520006
431500                  , CSTM_BKR_ACTL_TM                              43530006
431600                  , TKT_PRTR_RLSE_CDE                             43540006
431700                  , TKT_PRTR_REQR_DTE                             43550006
431800                  , TKT_PRTR_ACTL_DTE                             43560006
431900                  , TKT_PRTR_ACTL_TM                              43570006
432000                  , DCONSLR_RLSE_CDE                              43580006
432100                  , DCONSLR_REQR_DTE                              43590006
432200                  , DCONSLR_ACTL_DTE                              43600006
432300                  , DCONSLR_ACTL_TM                               43610006
432400                  , LAST_UPD_TMST                                 43620006
432500                  , LAST_UPD_BY_UID                               43630006
432600                  , DCONSLR_ENT_ID                                43640006
432700             INTO  :IMPORL-PO-NBR                                 43650006
432800                  ,:IMPORL-VER-NBR                                43660006
432900                  ,:IMPORL-VER-STATUS-CDE                         43670006
433000                  ,:IMPORL-CONSLR-RLSE-CDE                        43680006
433100                  ,:IMPORL-CONSLR-REQR-DTE                        43690006
433200                  ,:IMPORL-CONSLR-ACTL-DTE                        43700006
433300                  ,:IMPORL-CONSLR-ACTL-TM                         43710006
433400                  ,:IMPORL-CSTM-BKR-RLSE-CDE                      43720006
433500                  ,:IMPORL-CSTM-BKR-REQR-DTE                      43730006
433600                  ,:IMPORL-CSTM-BKR-ACTL-DTE                      43740006
433700                  ,:IMPORL-CSTM-BKR-ACTL-TM                       43750006
433800                  ,:IMPORL-TKT-PRTR-RLSE-CDE                      43760006
433900                  ,:IMPORL-TKT-PRTR-REQR-DTE                      43770006
434000                  ,:IMPORL-TKT-PRTR-ACTL-DTE                      43780006
434100                  ,:IMPORL-TKT-PRTR-ACTL-TM                       43790006
434200                  ,:IMPORL-DCONSLR-RLSE-CDE                       43800006
434300                  ,:IMPORL-DCONSLR-REQR-DTE                       43810006
434400                  ,:IMPORL-DCONSLR-ACTL-DTE                       43820006
434500                  ,:IMPORL-DCONSLR-ACTL-TM                        43830006
434600                  ,:IMPORL-LAST-UPD-TMST                          43840006
434700                  ,:IMPORL-LAST-UPD-BY-UID                        43850006
434800                  ,:IMPORL-DCONSLR-ENT-ID                         43860006
434900             FROM  TIMPORL                                        43870006
435000             WHERE PO_NBR          = :SHPTPO-PO-NBR               43880006
435100                AND VER_STATUS_CDE  = :PC-A                       43890006
435200         END-EXEC                                                 43900006
435300                                                                  43910006
435400     EVALUATE TRUE                                                43920006
435500         WHEN SQLCODE = ZERO                                      43930006
435600         WHEN SQLCODE = +100                                      43940006
435700             CONTINUE                                             43950006
435800                                                                  43960006
435900         WHEN SQLCODE NOT = ZERO                                  43970006
436000         WHEN SQLWARN0 NOT = SPACE                                43980006
436100         WHEN SQLCODE NOT = ZERO                                  43990006
436200              MOVE '4825-SELECT-TIMPORL'                          44000006
436300                               TO DP013-PARAGRAPH                 44010006
436400              MOVE 'TRYING TO SELECT TIMPORL'                     44020006
436500                               TO DP013-MESSAGE-TEXT (1)          44030006
436600              MOVE SQLCA       TO DP013-SQLCA                     44040006
436700              SET DP013-DB2-ABEND                                 44050006
436800                               TO TRUE                            44060006
436900              PERFORM DP013-0000-PROCESS-ABEND                    44070006
437000     END-EVALUATE.                                                44080006
437100                                                                  44090006
437200******************************************************************44100006
437300 4830-INACTIVATE-TIMPORL.                                         44110006
437400                                                                  44120006
437500         EXEC SQL                                                 44130006
437600             UPDATE TIMPORL                                       44140006
437700                SET VER_STATUS_CDE     = :PC-I                    44150006
437800             WHERE PO_NBR          = :SHPTPO-PO-NBR               44160006
437900                AND VER_STATUS_CDE  = :PC-A                       44170006
438000         END-EXEC                                                 44180006
438100                                                                  44190006
438200     EVALUATE TRUE                                                44200006
438300         WHEN SQLCODE = ZERO                                      44210006
438400             CONTINUE                                             44220006
438500                                                                  44230006
438600         WHEN SQLCODE = +100                                      44240006
438700             CONTINUE                                             44250006
438800                                                                  44260006
438900         WHEN SQLCODE NOT = ZERO                                  44270006
439000         WHEN SQLWARN0 NOT = SPACE                                44280006
439100         WHEN SQLCODE NOT = ZERO                                  44290006
439200              MOVE '4830-INACTIVATE-TIMPORL'                      44300006
439300                               TO DP013-PARAGRAPH                 44310006
439400              MOVE 'TRYING TO RETRAN SPLITS'                      44320006
439500                               TO DP013-MESSAGE-TEXT (1)          44330006
439600              MOVE SQLCA       TO DP013-SQLCA                     44340006
439700              SET DP013-DB2-ABEND                                 44350006
439800                               TO TRUE                            44360006
439900              PERFORM DP013-0000-PROCESS-ABEND                    44370006
440000     END-EVALUATE.                                                44380006
440100                                                                  44390006
440200******************************************************************44400006
440300 4835-INSERT-TIMPORL.                                             44410006
440400                                                                  44420006
440500         EXEC SQL                                                 44430006
440600             INSERT INTO TIMPORL                                  44440006
440700                   (PO_NBR                                        44450006
440800                  , VER_NBR                                       44460006
440900                  , VER_STATUS_CDE                                44470006
441000                  , CONSLR_RLSE_CDE                               44480006
441100                  , CONSLR_REQR_DTE                               44490006
441200                  , CONSLR_ACTL_DTE                               44500006
441300                  , CONSLR_ACTL_TM                                44510006
441400                  , CSTM_BKR_RLSE_CDE                             44520006
441500                  , CSTM_BKR_REQR_DTE                             44530006
441600                  , CSTM_BKR_ACTL_DTE                             44540006
441700                  , CSTM_BKR_ACTL_TM                              44550006
441800                  , TKT_PRTR_RLSE_CDE                             44560006
441900                  , TKT_PRTR_REQR_DTE                             44570006
442000                  , TKT_PRTR_ACTL_DTE                             44580006
442100                  , TKT_PRTR_ACTL_TM                              44590006
442200                  , DCONSLR_RLSE_CDE                              44600006
442300                  , DCONSLR_REQR_DTE                              44610006
442400                  , DCONSLR_ACTL_DTE                              44620006
442500                  , DCONSLR_ACTL_TM                               44630006
442600                  , LAST_UPD_TMST                                 44640006
442700                  , LAST_UPD_BY_UID                               44650006
442800                  , DCONSLR_ENT_ID)                               44660006
442900            VALUES (:IMPORL-PO-NBR                                44670006
443000                  , :IMPORL-VER-NBR                               44680006
443100                  , :IMPORL-VER-STATUS-CDE                        44690006
443200                  , :IMPORL-CONSLR-RLSE-CDE                       44700006
443300                  , :IMPORL-CONSLR-REQR-DTE                       44710006
443400                  , :IMPORL-CONSLR-ACTL-DTE                       44720006
443500                  , :IMPORL-CONSLR-ACTL-TM                        44730006
443600                  , :IMPORL-CSTM-BKR-RLSE-CDE                     44740006
443700                  , :IMPORL-CSTM-BKR-REQR-DTE                     44750006
443800                  , :IMPORL-CSTM-BKR-ACTL-DTE                     44760006
443900                  , :IMPORL-CSTM-BKR-ACTL-TM                      44770006
444000                  , :IMPORL-TKT-PRTR-RLSE-CDE                     44780006
444100                  , :IMPORL-TKT-PRTR-REQR-DTE                     44790006
444200                  , :IMPORL-TKT-PRTR-ACTL-DTE                     44800006
444300                  , :IMPORL-TKT-PRTR-ACTL-TM                      44810006
444400                  , :IMPORL-DCONSLR-RLSE-CDE                      44820006
444500                  , :IMPORL-DCONSLR-REQR-DTE                      44830006
444600                  , :PC-DEFAULT-DTE-9                             44840006
444700                  , :PC-DEFAULT-TME-9                             44850006
444800                  ,  CURRENT TIMESTAMP                            44860006
444900                  , :PC-CURRENT-PROGRAM-NAME                      44870006
445000                  , :IMPORL-DCONSLR-ENT-ID)                       44880006
445100         END-EXEC                                                 44890006
445200                                                                  44900006
445300     EVALUATE TRUE                                                44910006
445400         WHEN SQLCODE = ZERO                                      44920006
445500             CONTINUE                                             44930006
445600                                                                  44940006
445700         WHEN SQLCODE = +100                                      44950006
445800             CONTINUE                                             44960006
445900                                                                  44970006
446000         WHEN SQLCODE NOT = ZERO                                  44980006
446100         WHEN SQLWARN0 NOT = SPACE                                44990006
446200         WHEN SQLCODE NOT = ZERO                                  45000006
446300              MOVE '4835-INSERT-TIMPORL'                          45010006
446400                               TO DP013-PARAGRAPH                 45020006
446500              MOVE 'TRYING TO INSERT TIMPORL'                     45030006
446600                               TO DP013-MESSAGE-TEXT (1)          45040006
446700              MOVE SQLCA       TO DP013-SQLCA                     45050006
446800              SET DP013-DB2-ABEND                                 45060006
446900                               TO TRUE                            45070006
447000              PERFORM DP013-0000-PROCESS-ABEND                    45080006
447100     END-EVALUATE.                                                45090006
447200                                                                  45100006
447300*----------------------------------------------------------------*45110006
447400 4845-UPDATE-TVHTRIP.                                             45120006
447500                                                                  45130006
447600         EXEC SQL                                                 45140006
447700            UPDATE TVHTRIP                                        45150006
447800               SET SPLT_XMIT_IND    = ' '                         45160006
447900                ,  SPLT_XMIT_DTE    = :PC-DEFAULT-DTE             45170006
448000                ,  SPLT_XMIT_TM     = :PC-DEFAULT-TME             45180006
448100                ,  LAST_UPD_DTE     = (CURRENT DATE)              45190006
448200                ,  LAST_UPD_TME     = (CURRENT TIME)              45200006
448300                ,  LAST_UPD_UID     = :PC-CURRENT-PROGRAM-NAME    45210006
448400             WHERE TRIP_ID          = :VHTRIP-TRIP-ID             45220006
448500         END-EXEC                                                 45230006
448600                                                                  45240006
448700     EVALUATE TRUE                                                45250006
448800         WHEN SQLCODE = ZERO                                      45260006
448900         WHEN SQLCODE = +100                                      45270006
449000             CONTINUE                                             45280006
449100                                                                  45290006
449200         WHEN SQLWARN0 NOT = SPACE                                45300006
449300         WHEN SQLCODE NOT = ZERO                                  45310006
449400              MOVE '4845-UPDATE-TVHTRIP'                          45320006
449500                               TO DP013-PARAGRAPH                 45330006
449600              MOVE 'TRYING TO UPDATE TVHTRIP'                     45340006
449700                               TO DP013-MESSAGE-TEXT (1)          45350006
449800              MOVE SQLCA       TO DP013-SQLCA                     45360006
449900              SET DP013-DB2-ABEND                                 45370006
450000                               TO TRUE                            45380006
450100              PERFORM DP013-0000-PROCESS-ABEND                    45390006
450200     END-EVALUATE.                                                45400006
450300                                                                  45410006
450400******************************************************************45420006
450500 4850-MAINT-EDITS-1.                                              45430006
450600                                                                  45440006
450700     IF ASC-VIEW = 'WORKING'                                      45450006
450800         CONTINUE                                                 45460006
450900     ELSE                                                         45470006
451000         SET PS-ERROR                                             45480006
451100             DP020-MSG-FATAL   TO TRUE                            45490006
451200         MOVE PC-TSYMSG-03313  TO DP020-MSG-NUMBER                45500006
451300         SET DP030-OVERRIDE-GO TO TRUE                            45510006
451400     END-IF.                                                      45520006
451500                                                                  45530006
451600******************************************************************45540006
451700 4855-RETRIEVE-CURRENT-TMST.                                      45550006
451800                                                                  45560006
451900     EXEC SQL                                                     45570006
452000         SET :PV-CURRENT-TMST = CURRENT TIMESTAMP                 45580006
452100     END-EXEC                                                     45590006
452200                                                                  45600006
452300*                                                                 45610006
452400     EVALUATE TRUE                                                45620006
452500         WHEN SQLCODE = ZERO                                      45630006
452600             CONTINUE                                             45640006
452700         WHEN SQLWARN0 NOT = SPACES                               45650006
452800         WHEN SQLCODE < ZERO                                      45660006
452900         WHEN SQLCODE > ZERO                                      45670006
453000             MOVE '4855-RETRIEVE-CURRENT-TMST'                    45680006
453100                               TO DP013-PARAGRAPH                 45690006
453200             MOVE 'RETRIEVE CURRENT TMST'                         45700006
453300                               TO DP013-MESSAGE-TEXT (1)          45710006
453400             MOVE SQLCA        TO DP013-SQLCA                     45720006
453500             SET DP013-DB2-ABEND                                  45730006
453600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               45740006
453700             PERFORM DP013-0000-PROCESS-ABEND                     45750006
453800     END-EVALUATE.                                                45760006
453900                                                                  45770006
454000******************************************************************45780006
454100 4860-MAINT-EDITS-2.                                              45790006
454200                                                                  45800006
454300     IF PS-NO-ERROR                                               45810006
454400         PERFORM 4705-SELECT-DEVAN-DATE                           45820006
454500         IF PS-TIMCNTK-EXISTS                                     45830006
454600             IF IMCNTK-DVN-TMST > PC-DEFAULT-TMST                 45840006
454700                 SET PS-ERROR                                     45850006
454800                     DP020-MSG-FATAL   TO TRUE                    45860006
454900                 MOVE PC-TSYMSG-03312  TO DP020-MSG-NUMBER        45870006
455000             END-IF                                               45880006
455100         END-IF                                                   45890006
455200     END-IF.                                                      45900006
455300                                                                  45910006
455400*----------------------------------------------------------------*45920006
455500 4900-HANDLE-ASC-BLOCKS.                                          45930006
455600                                                                  45940006
455700     IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                        45950006
455800         ADD +1            TO ASC-ITEM-SUB                        45960006
455900     ELSE                                                         45970006
456000         ADD +1            TO ASC-BLK-SUB                         45980006
456100         MOVE +1           TO ASC-ITEM-SUB                        45990006
456200                                                                  46000006
456300         IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                 46010006
456400             MOVE +1       TO ASC-BLK-SUB                         46020006
456500             SET ASC-BLOCK-MODIFIED (1)                           46030006
456600                           TO TRUE                                46040006
456700             PERFORM 5100-WRITE-TEMP-STORAGE                      46050006
456800             MOVE ASC-BLOCK-ENTRIES                               46060006
456900                       (PC-MAX-BLOCKS-IN-ARRAY)                   46070006
457000                        TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)         46080006
457100             ADD +1        TO ASC-BLK-SUB                         46090006
457200             INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)           46100006
457300             SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)              46110006
457400                           TO  TRUE                               46120006
457500         END-IF                                                   46130006
457600     END-IF.                                                      46140006
457700 EJECT                                                            46150006
457800*----------------------------------------------------------------*46160006
457900* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *46170006
458000* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *46180006
458100* FOR THE SELECTED ITEMS QUEUE.                                  *46190006
458200*                                                                *46200006
458300* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *46210006
458400* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *46220006
458500* THE ARRAY IS FULL.                                             *46230006
458600*----------------------------------------------------------------*46240006
458700 5000-PREPARE-SEL-QUEUE.                                          46250006
458800                                                                  46260006
458900     MOVE +1                   TO  ASC-BLK-SUB.                   46270006
459000     PERFORM 5100-WRITE-TEMP-STORAGE.                             46280006
459100     ADD +1                    TO  ASC-BLK-SUB.                   46290006
459200     PERFORM 5100-WRITE-TEMP-STORAGE.                             46300006
459300     MOVE ASC-SEL-QUEUE-NAME   TO  TR320-SEL-QUEUE-NAME.          46310006
459400     PERFORM 6010-DELETE-SEL-QUEUE.                               46320006
459500                                                                  46330006
459600     SET ASC-UPDATE-TSQ        TO  TRUE.                          46340006
459700                                                                  46350006
459800     SET TR322-IDX             TO  1.                             46360006
459900                                                                  46370006
460000     MOVE ZERO                 TO TR320-NUMBER-OF-TS-ITEMS.       46380006
460100     INITIALIZE TR322-SELECTED-ITEM-ARRAY.                        46390006
460200     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           46400006
460300             VARYING PV-ITEM                                      46410006
460400             FROM 1 BY 1                                          46420006
460500             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     46430006
460600                                                                  46440006
460700     IF  TR322-IDX > 1                                            46450006
460800         PERFORM 5205-WRITE-SEL-QUEUE                             46460006
460900         ADD +1 TO TR320-NUMBER-OF-TS-ITEMS                       46470006
461000     END-IF.                                                      46480006
461100                                                                  46490006
461200 EJECT                                                            46500006
461300*----------------------------------------------------------------*46510006
461400*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *46520006
461500*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *46530006
461600*----------------------------------------------------------------*46540006
461700 5100-WRITE-TEMP-STORAGE.                                         46550006
461800                                                                  46560006
461900     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     46570006
462000                                   TO PV-LIST-ITEM-NUMBER.        46580006
462100     COMPUTE PV-BLOCK-NUMBER =                                    46590006
462200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    46600006
462300                                                                  46610006
462400     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             46620006
462500     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             46630006
462600         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      46640006
462700             PERFORM 5105-REWRITE-ASC-LISTQ                       46650006
462800         END-IF                                                   46660006
462900     ELSE                                                         46670006
463000         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       46680006
463100         ASC-HIGHEST-BLOCK-WRITTEN + 1                            46690006
463200         PERFORM 5110-WRITE-ASC-LISTQ                             46700006
463300         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   46710006
463400     END-IF.                                                      46720006
463500                                                                  46730006
463600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             46740006
463700                                                                  46750006
463800 EJECT                                                            46760006
463900*----------------------------------------------------------------*46770006
464000*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *46780006
464100*  SPECIFIC COMMAREA.                                            *46790006
464200*----------------------------------------------------------------*46800006
464300 5105-REWRITE-ASC-LISTQ.                                          46810006
464400                                                                  46820006
464500     EXEC CICS                                                    46830006
464600         WRITEQ TS                                                46840006
464700             QUEUE (ASC-LIST-QUEUE-NAME)                          46850006
464800             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               46860006
464900             ITEM  (PV-BLOCK-NUMBER)                              46870006
465000             REWRITE                                              46880006
465100             RESP  (PV-CICS-RESP)                                 46890006
465200     END-EXEC.                                                    46900006
465300                                                                  46910006
465400     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           46920006
465500         CONTINUE                                                 46930006
465600     ELSE                                                         46940006
465700         SET DP013-CICS-ABEND            TO TRUE                  46950006
465800         SET DP013-NO-ROLLBACK           TO TRUE                  46960006
465900         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       46970006
466000         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     46980006
466100                                         TO DP013-MESSAGE-TEXT(1) 46990006
466200         PERFORM DP013-0000-PROCESS-ABEND                         47000006
466300     END-IF.                                                      47010006
466400                                                                  47020006
466500 EJECT                                                            47030006
466600*----------------------------------------------------------------*47040006
466700*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *47050006
466800*  SPECIFIC COMMAREA.                                            *47060006
466900*----------------------------------------------------------------*47070006
467000 5110-WRITE-ASC-LISTQ.                                            47080006
467100                                                                  47090006
467200     EXEC CICS                                                    47100006
467300         WRITEQ TS                                                47110006
467400             QUEUE (ASC-LIST-QUEUE-NAME)                          47120006
467500             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               47130006
467600             ITEM  (PV-BLOCK-NUMBER)                              47140006
467700             RESP  (PV-CICS-RESP)                                 47150006
467800     END-EXEC.                                                    47160006
467900                                                                  47170006
468000     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      47180006
468100         SET DP013-CICS-ABEND      TO TRUE                        47190006
468200         SET DP013-NO-ROLLBACK     TO TRUE                        47200006
468300         MOVE '5110-WRITE-ASC-LISTQ'                              47210006
468400                                   TO DP013-PARAGRAPH             47220006
468500         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           47230006
468600                                   TO DP013-MESSAGE-TEXT(1)       47240006
468700         PERFORM DP013-0000-PROCESS-ABEND                         47250006
468800     END-IF.                                                      47260006
468900                                                                  47270006
469000 EJECT                                                            47280006
469100*----------------------------------------------------------------*47290006
469200* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *47300006
469300* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *47310006
469400*----------------------------------------------------------------*47320006
469500 5200-FILL-SEL-QUEUE-RECORD.                                      47330006
469600                                                                  47340006
469700     PERFORM 6112-READ-LIST-QUEUE.                                47350006
469800                                                                  47360006
469900     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       47370006
470000         PERFORM                                                  47380006
470100         VARYING LQW-IDX                                          47390006
470200         FROM 1 BY 1                                              47400006
470300         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            47410006
470400           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          47420006
470500                                                                  47430006
470600             IF  LQW-SELECT (LQW-IDX)                             47440006
470700                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              47450006
470800                        TO TR322-LIST-ITEM-NUMBER (TR322-IDX)     47460006
470900                 MOVE LQW-CONTNR-ID (LQW-IDX)                     47470006
471000                                   TO TR320-CONTNR-ID             47480006
471100                                      PV-CONTNR-ID                47490006
471200                                      TR322-CONTNR-ID             47500006
471300                                      (TR322-IDX)                 47510006
471400                 MOVE LQW-CONTNR-SEQ-NBR (LQW-IDX)                47520006
471500                                   TO TR320-CONTNR-SEQ-NBR        47530006
471600                                      PV-CONTNR-SEQ-NBR           47540006
471700                                      TR322-CONTNR-SEQ-NBR        47550006
471800                                      (TR322-IDX)                 47560006
471900                 STRING LQW-VESSEL      (LQW-IDX)(1:10)           47570006
472000                    ' ' LQW-ETA-MM-DD   (LQW-IDX)                 47580006
472100                    ' ' LQW-FOB-CDE     (LQW-IDX)                 47590006
472200                 DELIMITED BY SIZE INTO TR322-VES-ETA-FOB         47600006
472300                                                   (TR322-IDX)    47610006
472400                 MOVE LQW-VESSEL (LQW-IDX)                        47620006
472500                                   TO TR320-VESSEL                47630006
472600                 MOVE LQW-VOYAGE (LQW-IDX)                        47640006
472700                                   TO TR320-VOYAGE                47650006
472800                                      TR322-VOYAGE (TR322-IDX)    47660006
472900                 MOVE LQW-ETA-DATE (LQW-IDX)                      47670006
473000                                   TO TR320-ETA-DATE              47680006
473100                                      TR322-ETA-DATE (TR322-IDX)  47690006
473200                 MOVE LQW-PO-NBR (LQW-IDX)                        47700006
473300                                   TO TR322-PO-NBR (TR322-IDX)    47710006
473400                                      TR105-PO-NBR                47720006
473500                                      PV-PO-NBR                   47730006
473600                                      TR119-PO-NBR                47740006
473700                 MOVE LQW-PO-TYP-CDE (LQW-IDX)                    47750006
473800                                   TO TR322-PO-TYP-CDE            47760006
473900                                      (TR322-IDX)                 47770006
474000                 MOVE LQW-PO-SPLIT-TYP (LQW-IDX)                  47780006
474100                                   TO TR322-PO-SPLIT-TYP          47790006
474200                                      (TR322-IDX)                 47800006
474300                                      PV-PO-SPLIT-TYP             47810006
474400                 MOVE LQW-CART-CNT (LQW-IDX)                      47820006
474500                                   TO TR322-CART-CNT              47830006
474600                                      (TR322-IDX)                 47840006
474700                 MOVE LQW-CBM-QTY (LQW-IDX)                       47850006
474800                                   TO TR322-CBM-QTY (TR322-IDX)   47860006
474900                 MOVE LQW-SEASET (LQW-IDX)                        47870006
475000                                   TO TR322-SEASET (TR322-IDX)    47880006
475100                 MOVE LQW-DECNSL-SCAC (LQW-IDX)                   47890006
475200                                   TO TR320-DECON-SCAC-CUR        47900006
475300                                      TR322-DECNSL-SCAC           47910006
475400                                      (TR322-IDX)                 47920006
475500                 MOVE LQW-RUL-ID-DEFLT (LQW-IDX)                  47930006
475600                                   TO TR320-RUL-ID-DEFLT          47940006
475700                                      TR322-RUL-ID-DEFLT          47950006
475800                                      (TR322-IDX)                 47960006
475900                 MOVE LQW-RUL-ID-USED  (LQW-IDX)                  47970006
476000                                   TO TR320-RUL-ID-USED           47980006
476100                                      TR322-RUL-ID-USED           47990006
476200                                      (TR322-IDX)                 48000006
476300                 MOVE LQW-RUL-CDE-USED (LQW-IDX)                  48010006
476400                                   TO TR320-RUL-CDE-USED          48020006
476500                                      TR322-RUL-CDE-USED          48030006
476600                                      (TR322-IDX)                 48040006
476700                 MOVE LQW-RUL-TYP-CDE-USED (LQW-IDX)              48050006
476800                                   TO TR320-RUL-TYP-CDE-USED      48060006
476900                                      TR322-RUL-TYP-CDE-USED      48070006
477000                                      (TR322-IDX)                 48080006
477100                                                                  48090006
477200                                                                  48100006
477300                 MOVE 'I'        TO TR322-ACTION-SW (TR322-IDX)   48110006
477400                 SET TR322-IDX UP BY 1                            48120006
477500                 IF  TR322-IDX > TR322-MAX-ITEMS                  48130006
477600                     PERFORM 5205-WRITE-SEL-QUEUE                 48140006
477700                     ADD +1        TO TR320-NUMBER-OF-TS-ITEMS    48150006
477800                     INITIALIZE TR322-SELECTED-ITEM-ARRAY         48160006
477900                     SET TR322-IDX TO  1                          48170006
478000                 END-IF                                           48180006
478100             END-IF                                               48190006
478200         END-PERFORM                                              48200006
478300     END-IF.                                                      48210006
478400                                                                  48220006
478500 EJECT                                                            48230006
478600*----------------------------------------------------------------*48240006
478700*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *48250006
478800*----------------------------------------------------------------*48260006
478900 5205-WRITE-SEL-QUEUE.                                            48270006
479000                                                                  48280006
479100     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            48290006
479200                                   TO TR322-SELECTED-ITEMS.       48300006
479300                                                                  48310006
479400     EXEC CICS                                                    48320006
479500          WRITEQ TS                                               48330006
479600             QUEUE (ASC-SEL-QUEUE-NAME)                           48340006
479700             FROM  (TR322-TEMP-SEL-AREA)                          48350006
479800             ITEM  (PV-SEL-QUEUE-ITEM)                            48360006
479900             RESP  (PV-CICS-RESP)                                 48370006
480000     END-EXEC.                                                    48380006
480100                                                                  48390006
480200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          48400006
480300         CONTINUE                                                 48410006
480400     ELSE                                                         48420006
480500         SET DP013-CICS-ABEND      TO TRUE                        48430006
480600         SET DP013-NO-ROLLBACK     TO TRUE                        48440006
480700         MOVE '5205-WRITE-SEL-QUEUE'                              48450006
480800                                   TO DP013-PARAGRAPH             48460006
480900         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          48470006
481000                                   TO DP013-MESSAGE-TEXT(1)       48480006
481100         PERFORM DP013-0000-PROCESS-ABEND                         48490006
481200     END-IF.                                                      48500006
481300                                                                  48510006
481400 EJECT                                                            48520006
481500*----------------------------------------------------------------*48530006
481600*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *48540006
481700*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *48550006
481800*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *48560006
481900*  THE USER.                                                     *48570006
482000*----------------------------------------------------------------*48580006
482100 6000-REFRESH-PANEL-FROM-TEMP.                                    48590006
482200                                                                  48600006
482300     IF  ASC-UPDATE-TSQ                                           48610006
482400         SET ASC-NO-TSQ-UPDATE TO TRUE                            48620006
482500         MOVE ZERO                 TO PV-SAVE-ITEM                48630006
482600                                      PV-SEL-QUEUE-ITEM           48640006
482700         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        48650006
482800                                   TO PV-HOLD-SELECTED-ITEMS      48660006
482900         MOVE +1                   TO PV-ITEMS-PROCESSED          48670006
483000         PERFORM 6100-UPDATE-TSQ                                  48680006
483100             UNTIL PV-ITEMS-PROCESSED >                           48690006
483200                                     PV-HOLD-SELECTED-ITEMS       48700006
483300         PERFORM 6010-DELETE-SEL-QUEUE                            48710006
483400         INITIALIZE ASC-BLOCK-ENTRIES (1)                         48720006
483500                    ASC-BLOCK-ENTRIES (2)                         48730006
483600     END-IF.                                                      48740006
483700                                                                  48750006
483800 EJECT                                                            48760006
483900*----------------------------------------------------------------*48770006
484000*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *48780006
484100*----------------------------------------------------------------*48790006
484200 6010-DELETE-SEL-QUEUE.                                           48800006
484300                                                                  48810006
484400     EXEC CICS                                                    48820006
484500         DELETEQ TS                                               48830006
484600             QUEUE (ASC-SEL-QUEUE-NAME)                           48840006
484700             RESP  (PV-CICS-RESP)                                 48850006
484800     END-EXEC.                                                    48860006
484900*                                                                 48870006
485000     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      48880006
485100        (PV-CICS-RESP = DFHRESP(QIDERR)))                         48890006
485200         CONTINUE                                                 48900006
485300     ELSE                                                         48910006
485400         SET DP013-CICS-ABEND TO TRUE                             48920006
485500         SET DP013-NO-ROLLBACK TO TRUE                            48930006
485600         MOVE '6010-DELETE-SEL-QUEUE'                             48940006
485700                        TO DP013-PARAGRAPH                        48950006
485800         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         48960006
485900                        TO DP013-MESSAGE-TEXT (1)                 48970006
486000         PERFORM DP013-0000-PROCESS-ABEND                         48980006
486100     END-IF.                                                      48990006
486200                                                                  49000006
486300 EJECT                                                            49010006
486400*----------------------------------------------------------------*49020006
486500*   OPEN THE CONTAINER RULE DETAIL CURSOR                         49030006
486600*---------------------------------------------------------------- 49040006
486700 6010-OPEN-CONTAINER-CUR.                                         49050006
486800                                                                  49060006
486900     EXEC SQL                                                     49070006
487000          OPEN TRT_CONT_RULE_CUR                                  49080006
487100     END-EXEC                                                     49090006
487200                                                                  49100006
487300     EVALUATE TRUE                                                49110006
487400         WHEN SQLCODE = ZERO                                      49120006
487500         WHEN SQLCODE = -904                                      49130006
487600         WHEN SQLCODE = -913                                      49140006
487700            CONTINUE                                              49150006
487800         WHEN SQLWARN0 NOT = SPACES                               49160006
487900         WHEN SQLCODE < ZERO                                      49170006
488000         WHEN SQLCODE > ZERO                                      49180006
488100             MOVE '6010-OPEN-CONTAINER-CUR'                       49190006
488200                               TO DP013-PARAGRAPH                 49200006
488300             MOVE 'OPEN CONT CURSOR - '                           49210006
488400                               TO DP013-MESSAGE-TEXT (1)          49220006
488500             MOVE SQLCA        TO DP013-SQLCA                     49230006
488600             MOVE 'TRT_RUL '   TO DP013-DB2-TABLE-NAME (1)        49240006
488700             SET DP013-DB2-ABEND                                  49250006
488800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               49260006
488900             PERFORM DP013-0000-PROCESS-ABEND                     49270006
489000     END-EVALUATE.                                                49280006
489100                                                                  49290006
489200*----------------------------------------------------------------*49300006
489300*   FETCH THE CONTAINER RULE DETAIL CURSOR                        49310006
489400*---------------------------------------------------------------- 49320006
489500 6020-FETCH-CONTAINER-CUR.                                        49330006
489600                                                                  49340006
489700     EXEC SQL                                                     49350006
489800       FETCH TRT_CONT_RULE_CUR                                    49360006
489900        INTO :TRT00014-RUL-ID                                     49370006
490000     END-EXEC                                                     49380006
490100     EVALUATE TRUE                                                49390006
490200         WHEN SQLCODE = ZERO                                      49400006
490300              PERFORM 6080-CHECK-FOR-CONTAINER-RULE               49410006
490400         WHEN SQLCODE = +100                                      49420006
490500              SET PS-END-OF-CONT-RULE-CUR TO TRUE                 49430006
490600         WHEN SQLWARN0 NOT = SPACE                                49440006
490700         WHEN SQLCODE NOT = ZERO                                  49450006
490800              MOVE '6020-FETCH-CONTAINER-CUR'                     49460006
490900                               TO DP013-PARAGRAPH                 49470006
491000              MOVE 'FETCH CONT RULE CURSOR'                       49480006
491100                               TO DP013-MESSAGE-TEXT (1)          49490006
491200              MOVE SQLCA       TO DP013-SQLCA                     49500006
491300              SET DP013-DB2-ABEND                                 49510006
491400                               TO TRUE                            49520006
491500              PERFORM DP013-0000-PROCESS-ABEND                    49530006
491600     END-EVALUATE.                                                49540006
491700                                                                  49550006
491800*----------------------------------------------------------------*49560006
491900*   CLOSE THE CONTAINER RULE CUROSR                               49570006
492000*----------------------------------------------------------------*49580006
492100 6030-CLOSE-CONTAINER-RULE-CUR.                                   49590006
492200                                                                  49600006
492300     EXEC SQL                                                     49610006
492400          CLOSE TRT_CONT_RULE_CUR                                 49620006
492500     END-EXEC.                                                    49630006
492600*                                                                 49640006
492700     EVALUATE TRUE                                                49650006
492800         WHEN SQLCODE = ZERO                                      49660006
492900             CONTINUE                                             49670006
493000         WHEN SQLWARN0 NOT = SPACES                               49680006
493100         WHEN SQLCODE < ZERO                                      49690006
493200         WHEN SQLCODE > ZERO                                      49700006
493300             MOVE '6030-CLOSE-CONTAINER-RULE-CUR'                 49710006
493400                               TO DP013-PARAGRAPH                 49720006
493500             MOVE 'CLOSE CONT RULE CURSOR '                       49730006
493600                               TO DP013-MESSAGE-TEXT (1)          49740006
493700             MOVE SQLCA        TO DP013-SQLCA                     49750006
493800             MOVE 'TRT_RUL '   TO DP013-DB2-TABLE-NAME (1)        49760006
493900             SET DP013-DB2-ABEND                                  49770006
494000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               49780006
494100             PERFORM DP013-0000-PROCESS-ABEND                     49790006
494200     END-EVALUATE.                                                49800006
494300                                                                  49810006
494400                                                                  49820006
494500*----------------------------------------------------------------*49830006
494600*   OPEN THE VESSEL RULE DETAIL CURSOR                            49840006
494700*---------------------------------------------------------------- 49850006
494800 6040-OPEN-VESSEL-CUR.                                            49860006
494900                                                                  49870006
495000     EXEC SQL                                                     49880006
495100          OPEN TRT_VSL_RULE_CUR                                   49890006
495200     END-EXEC                                                     49900006
495300                                                                  49910006
495400     EVALUATE TRUE                                                49920006
495500         WHEN SQLCODE = ZERO                                      49930006
495600         WHEN SQLCODE = -904                                      49940006
495700         WHEN SQLCODE = -913                                      49950006
495800            CONTINUE                                              49960006
495900         WHEN SQLWARN0 NOT = SPACES                               49970006
496000         WHEN SQLCODE < ZERO                                      49980006
496100         WHEN SQLCODE > ZERO                                      49990006
496200             MOVE '6040-OPEN-VESSEL-CUR'                          50000006
496300                               TO DP013-PARAGRAPH                 50010006
496400             MOVE 'OPEN VESSEL CURSOR - '                         50020006
496500                               TO DP013-MESSAGE-TEXT (1)          50030006
496600             MOVE SQLCA        TO DP013-SQLCA                     50040006
496700             MOVE 'TRT_RUL '   TO DP013-DB2-TABLE-NAME (1)        50050006
496800             SET DP013-DB2-ABEND                                  50060006
496900                 DP013-XCTL-DISPLAY-RESTART TO TRUE               50070006
497000             PERFORM DP013-0000-PROCESS-ABEND                     50080006
497100     END-EVALUATE.                                                50090006
497200                                                                  50100006
497300*----------------------------------------------------------------*50110006
497400*   FETCH THE VESSEL RULE DETAIL CURSOR                           50120006
497500*---------------------------------------------------------------- 50130006
497600 6050-FETCH-VESSEL-CUR.                                           50140006
497700                                                                  50150006
497800     EXEC SQL                                                     50160006
497900       FETCH TRT_VSL_RULE_CUR                                     50170006
498000        INTO :TRT00014-RUL-ID                                     50180006
498100     END-EXEC                                                     50190006
498200     EVALUATE TRUE                                                50200006
498300         WHEN SQLCODE = ZERO                                      50210006
498400              PERFORM 6090-CHECK-FOR-VESSEL-RULE                  50220006
498500         WHEN SQLCODE = +100                                      50230006
498600              SET PS-END-OF-VSL-RULE-CUR TO TRUE                  50240006
498700         WHEN SQLWARN0 NOT = SPACE                                50250006
498800         WHEN SQLCODE NOT = ZERO                                  50260006
498900              MOVE '6050-FETCH-VESSEL-CUR'                        50270006
499000                               TO DP013-PARAGRAPH                 50280006
499100              MOVE 'FETCH VESSEL RULE CURSOR'                     50290006
499200                               TO DP013-MESSAGE-TEXT (1)          50300006
499300              MOVE SQLCA       TO DP013-SQLCA                     50310006
499400              SET DP013-DB2-ABEND                                 50320006
499500                               TO TRUE                            50330006
499600              PERFORM DP013-0000-PROCESS-ABEND                    50340006
499700     END-EVALUATE.                                                50350006
499800                                                                  50360006
499900*----------------------------------------------------------------*50370006
500000*   CLOSE THE VESSEL RULE CUROSR                                  50380006
500100*----------------------------------------------------------------*50390006
500200 6060-CLOSE-VESSEL-RULE-CUR.                                      50400006
500300                                                                  50410006
500400     EXEC SQL                                                     50420006
500500          CLOSE TRT_VSL_RULE_CUR                                  50430006
500600     END-EXEC.                                                    50440006
500700*                                                                 50450006
500800     EVALUATE TRUE                                                50460006
500900         WHEN SQLCODE = ZERO                                      50470006
501000             CONTINUE                                             50480006
501100         WHEN SQLWARN0 NOT = SPACES                               50490006
501200         WHEN SQLCODE < ZERO                                      50500006
501300         WHEN SQLCODE > ZERO                                      50510006
501400             MOVE '6060-CLOSE-VESSEL-RULE-CUR'                    50520006
501500                               TO DP013-PARAGRAPH                 50530006
501600             MOVE 'CLOSE VESSEL RULE CURSOR '                     50540006
501700                               TO DP013-MESSAGE-TEXT (1)          50550006
501800             MOVE SQLCA        TO DP013-SQLCA                     50560006
501900             MOVE 'TRT_RUL '   TO DP013-DB2-TABLE-NAME (1)        50570006
502000             SET DP013-DB2-ABEND                                  50580006
502100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               50590006
502200             PERFORM DP013-0000-PROCESS-ABEND                     50600006
502300     END-EVALUATE.                                                50610006
502400                                                                  50620006
502500                                                                  50630006
502600*----------------------------------------------------------------*50640006
502700* SELCT VESSEL RULES WHEN NO CONTAINER RULE                       50650006
502800*----------------------------------------------------------------*50660006
502900 6070-SELECT-VESSEL-VOYAGE.                                       50670006
503000                                                                  50680006
503100     EXEC SQL                                                     50690006
503200        SELECT A.RUL_CNSTR_VAL_TXT                                50700006
503300        INTO   :PV-CNT-VESSEL                                     50710006
503400        FROM   TRT_RUL_CNSTR A                                    50720006
503500        WHERE  A.RUL_ID            = :TRT00015-RUL-ID             50730006
503600          AND  A.RUL_CNSTR_TYP_CDE = 'VSL'                        50740006
503700        FETCH FIRST ROW ONLY                                      50750006
503800     END-EXEC.                                                    50760006
503900                                                                  50770006
504000     EVALUATE TRUE                                                50780006
504100         WHEN SQLCODE = ZERO                                      50790006
504200              CONTINUE                                            50800006
504300         WHEN SQLCODE = +100                                      50810006
504400              MOVE SPACES TO PV-ADJ-SCAC                          50820006
504500         WHEN SQLWARN0 NOT = SPACE                                50830006
504600         WHEN SQLCODE NOT = ZERO                                  50840006
504700              MOVE '1327-SELECT-VESSEL-VOYAGE'                    50850006
504800                               TO DP013-PARAGRAPH                 50860006
504900              MOVE 'SQL ERROR SELECTING RULE'                     50870006
505000                               TO DP013-MESSAGE-TEXT (1)          50880006
505100              MOVE SQLCA       TO DP013-SQLCA                     50890006
505200              SET DP013-DB2-ABEND                                 50900006
505300                               TO TRUE                            50910006
505400              PERFORM DP013-0000-PROCESS-ABEND                    50920006
505500     END-EVALUATE.                                                50930006
505600                                                                  50940006
505700 6080-CHECK-FOR-CONTAINER-RULE.                                   50950006
505800                                                                  50960006
505900     EXEC SQL                                                     50970006
506000        SELECT A.RUL_ID,                                          50980006
506100               A.RUL_CNSTR_VAL_TXT                                50990006
506200        INTO   :PV-RUL-ID                                         51000006
506300              ,:PV-ADJ-SCAC                                       51010006
506400        FROM   TRT_RUL_CNSTR A                                    51020006
506500              ,TRT_RUL_CNSTR B                                    51030006
506600              ,TRT_RUL_CNSTR C                                    51040006
506700              ,TRT_RUL_CNSTR D                                    51050006
506800        WHERE  A.RUL_ID            = B.RUL_ID                     51060006
506900          AND  A.RUL_ID            = C.RUL_ID                     51070006
507000          AND  A.RUL_ID            = D.RUL_ID                     51080006
507100          AND  A.RUL_ID            = :TRT00014-RUL-ID             51090006
507200          AND  A.RUL_CNSTR_TYP_CDE = 'DECN'                       51100006
507300          AND  B.RUL_CNSTR_TYP_CDE = 'CONT'                       51110006
507400          AND  B.RUL_CNSTR_VAL_TXT = :PV-CONTAINER-ID             51120006
507500          AND  C.RUL_CNSTR_TYP_CDE = :PV-SEQ-OR-ETA               51130006
507600          AND  C.RUL_CNSTR_VAL_TXT = :PV-SEQ-OR-ETA-VAL           51140006
507700          AND  D.RUL_CNSTR_TYP_CDE = 'POE'                        51150006
507800          AND  D.RUL_CNSTR_VAL_TXT = :ASC-POE-CDE                 51160006
507900         FETCH FIRST ROW ONLY                                     51170006
508000     END-EXEC.                                                    51180006
508100                                                                  51190006
508200     EVALUATE TRUE                                                51200006
508300         WHEN SQLCODE = ZERO                                      51210006
508400              SET PS-END-OF-CONT-RULE-CUR TO TRUE                 51220006
508500         WHEN SQLCODE = +100                                      51230006
508600              MOVE SPACES TO PV-ADJ-SCAC                          51240006
508700              MOVE ZEROES TO PV-RUL-ID                            51250006
508800         WHEN SQLWARN0 NOT = SPACE                                51260006
508900         WHEN SQLCODE NOT = ZERO                                  51270006
509000              MOVE '6080-CHECK-FOR-CONTAINER-RULE'                51280006
509100                               TO DP013-PARAGRAPH                 51290006
509200              MOVE 'SQL ERROR SELECTING RULE'                     51300006
509300                               TO DP013-MESSAGE-TEXT (1)          51310006
509400              MOVE SQLCA       TO DP013-SQLCA                     51320006
509500              SET DP013-DB2-ABEND                                 51330006
509600                               TO TRUE                            51340006
509700              PERFORM DP013-0000-PROCESS-ABEND                    51350006
509800     END-EVALUATE.                                                51360006
509900                                                                  51370006
510000*----------------------------------------------------------------*51380006
510100* SELECT SCAC FOR VESSEL RULE IF NO CONTAINER RULE                51390006
510200*----------------------------------------------------------------*51400006
510300 6090-CHECK-FOR-VESSEL-RULE.                                      51410006
510400                                                                  51420006
510500     EXEC SQL                                                     51430006
510600        SELECT A.RUL_ID                                           51440006
510700              ,A.RUL_CNSTR_VAL_TXT                                51450006
510800        INTO   :PV-RUL-ID                                         51460006
510900              ,:PV-ADJ-SCAC                                       51470006
511000        FROM   TRT_RUL_CNSTR A                                    51480006
511100              ,TRT_RUL_CNSTR B                                    51490006
511200**            ,TRT_RUL_CNSTR C                                    51500006
511300              ,TRT_RUL_CNSTR D                                    51510006
511400        WHERE  A.RUL_ID            = B.RUL_ID                     51520006
511500**        AND  A.RUL_ID            = C.RUL_ID                     51530006
511600          AND  A.RUL_ID            = D.RUL_ID                     51540006
511700          AND  A.RUL_ID            = :TRT00014-RUL-ID             51550006
511800          AND  A.RUL_CNSTR_TYP_CDE = 'DECN'                       51560006
511900          AND  B.RUL_CNSTR_TYP_CDE = 'VSL'                        51570006
512000          AND  B.RUL_CNSTR_VAL_TXT = :PV-CNT-VESSEL               51580006
512100**        AND  C.RUL_CNSTR_TYP_CDE = 'VOY'                        51590006
512200**        AND  C.RUL_CNSTR_VAL_TXT = :PV-CNT-VOYAGE               51600006
512300          AND  D.RUL_CNSTR_TYP_CDE = 'POE'                        51610006
512400          AND  D.RUL_CNSTR_VAL_TXT = :ASC-POE-CDE                 51620006
512500        FETCH FIRST ROW ONLY                                      51630006
512600     END-EXEC.                                                    51640006
512700                                                                  51650006
512800     EVALUATE TRUE                                                51660006
512900         WHEN SQLCODE = ZERO                                      51670006
513000              SET PS-END-OF-VSL-RULE-CUR TO TRUE                  51680006
513100         WHEN SQLCODE = +100                                      51690006
513200              MOVE SPACES TO PV-ADJ-SCAC                          51700006
513300              MOVE ZEROES TO PV-RUL-ID                            51710006
513400         WHEN SQLWARN0 NOT = SPACE                                51720006
513500         WHEN SQLCODE NOT = ZERO                                  51730006
513600              MOVE '6090-CHECK-FOR-VESSEL-RULE'                   51740006
513700                               TO DP013-PARAGRAPH                 51750006
513800              MOVE 'SQL ERROR SELECTING RULE'                     51760006
513900                               TO DP013-MESSAGE-TEXT (1)          51770006
514000              MOVE SQLCA       TO DP013-SQLCA                     51780006
514100              SET DP013-DB2-ABEND                                 51790006
514200                               TO TRUE                            51800006
514300              PERFORM DP013-0000-PROCESS-ABEND                    51810006
514400     END-EVALUATE.                                                51820006
514500                                                                  51830006
514600*----------------------------------------------------------------*51840006
514700* SELECT ENT_ID FOR A GIVEN SCAC CODE                             51850006
514800*----------------------------------------------------------------*51860006
514900 6095-SELECT-ENT-ID.                                              51870006
515000                                                                  51880006
515100     EXEC SQL                                                     51890006
515200        SELECT A.ENT_ID                                           51900006
515300        INTO   :EXTENT-ENT-ID                                     51910006
515400        FROM   TEXTENT A                                          51920006
515500        WHERE  A.SCAC_CDE          = :EXTENT-SCAC-CDE             51930006
515600        FETCH FIRST ROW ONLY                                      51940006
515700     END-EXEC.                                                    51950006
515800                                                                  51960006
515900     EVALUATE TRUE                                                51970006
516000         WHEN SQLCODE = ZERO                                      51980006
516100              SET PS-ENT-ID-FOUND TO TRUE                         51990006
516200         WHEN SQLWARN0 NOT = SPACE                                52000006
516300         WHEN SQLCODE NOT = ZERO                                  52010006
516400              MOVE '6095-SELECT-ENT-ID'                           52020006
516500                               TO DP013-PARAGRAPH                 52030006
516600              MOVE 'SQL ERROR SELECTING ENT-ID'                   52040006
516700                               TO DP013-MESSAGE-TEXT (1)          52050006
516800              MOVE SQLCA       TO DP013-SQLCA                     52060006
516900              SET DP013-DB2-ABEND                                 52070006
517000                               TO TRUE                            52080006
517100              PERFORM DP013-0000-PROCESS-ABEND                    52090006
517200     END-EVALUATE.                                                52100006
517300                                                                  52110006
517400*----------------------------------------------------------------*52120006
517500* CHECK FOR PO SPLIT                                              52130006
517501*----------------------------------------------------------------*52140010
517511*** PRB0040279 - 03/20/2013 ALLOW CMN AFTER SHIPMENT CANCEL - MJF 52150017
517520***    ADD TABLES TSHIPST AND TSHSTYP TO SELECT SO THAT DELETED   52160017
517530***    SHIPMENTS ARE BYPASSED.                                    52170017
517550******************************************************************52180010
517560                                                                  52190010
517700 6096-SELECT-FOR-PO-SPLIT.                                        52200006
517800                                                                  52210006
517900     EXEC SQL                                                     52220006
518000         SELECT                                                   52230006
518100            'Y'                                                   52240006
518200         INTO :PS-PO-SPLIT-FOUND-SW                               52250006
518300         FROM TIMPORL A                                           52260006
518400             ,TVEHICL B                                           52270006
518500             ,TVHTRIP C                                           52280006
518600             ,TSHIPMT D                                           52290006
518700             ,TSHPTPO E                                           52300006
518710             ,TSHSTYP Y                                           52310010
518720             ,TSHIPST S                                           52320010
518800          WHERE A.PO_NBR         = E.PO_NBR                       52330006
518900          AND A.DCONSLR_RLSE_CDE IN ('S','R','Y')                 52340006
519000          AND A.VER_STATUS_CDE   = 'A'                            52350006
519100          AND E.SHIPT_ID         = D.SHIPT_ID                     52360006
519200          AND D.TRIP_ID          = C.TRIP_ID                      52370006
519300          AND B.VEH_NBR          = C.VEH_NBR                      52380006
519400          AND B.OWNER_SCAC_ID    = C.OWNER_SCAC_ID                52390006
519500          AND B.VEH_TYP_CDE      IN ('VS', 'AV')                  52400006
519600          AND A.PO_NBR           = :PV-PO-NBR                     52410006
519610          AND S.SHIPT_ID = D.SHIPT_ID                             52420011
519620          AND Y.SHIPT_STATUS_CDE = S.SHIPT_STATUS_CDE             52430011
519630          AND Y.PRTY_CDE < '95'                                   52440011
519640          AND Y.PRTY_CDE =                                        52450011
519650                 (SELECT MAX(TY.PRTY_CDE)                         52460011
519660                    FROM TSHIPST  ST                              52470011
519670                        ,TSHSTYP  TY                              52480011
519680                   WHERE ST.SHIPT_ID = S.SHIPT_ID                 52490011
519690                     AND ST.SHIPT_STATUS_CDE =                    52500011
519691                         TY.SHIPT_STATUS_CDE)                     52510011
519700         FETCH FIRST ROW ONLY                                     52520006
519800     END-EXEC.                                                    52530006
519900                                                                  52540006
520000     EVALUATE TRUE                                                52550006
520100         WHEN SQLCODE = ZERO                                      52560006
520200              SET PS-PO-SPLIT-FOUND TO TRUE                       52570006
520300         WHEN SQLCODE = -811                                      52580006
520400              SET PS-PO-SPLIT-FOUND TO TRUE                       52590006
520410         WHEN SQLCODE = +100                                      52600009
520420              SET PS-PO-SPLIT-FOUND-NO TO TRUE                    52610009
520500         WHEN SQLWARN0 NOT = SPACE                                52620006
520600         WHEN SQLCODE NOT = ZERO                                  52630006
520700              MOVE '6096-SELECT-FOR-PO-SPLIT'                     52640006
520800                               TO DP013-PARAGRAPH                 52650006
520900              MOVE 'SQL ERROR SELECTING FOR PO SPLIT'             52660006
521000                               TO DP013-MESSAGE-TEXT (1)          52670006
521100              MOVE SQLCA       TO DP013-SQLCA                     52680006
521200              SET DP013-DB2-ABEND                                 52690006
521300                               TO TRUE                            52700006
521400              PERFORM DP013-0000-PROCESS-ABEND                    52710006
521500     END-EVALUATE.                                                52720006
521600                                                                  52730006
521700*----------------------------------------------------------------*52740006
521800*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *52750006
521900*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *52760006
522000*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *52770006
522100*    THE TEMP QUEUE.                                             *52780006
522200*----------------------------------------------------------------*52790006
522300 6100-UPDATE-TSQ.                                                 52800006
522400                                                                  52810006
522500     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             52820006
522600     PERFORM 6105-READ-SEL-QUEUE.                                 52830006
522700     PERFORM                                                      52840006
522800         VARYING TR322-IDX                                        52850006
522900         FROM 1 BY 1                                              52860006
523000         UNTIL ((PV-ITEMS-PROCESSED >                             52870006
523100                              PV-HOLD-SELECTED-ITEMS)             52880006
523200         OR (TR322-IDX GREATER THAN TR322-MAX-ITEMS))             52890006
523300         IF  TR322-CONTNR-ID (TR322-IDX) NOT =  SPACE             52900006
523400             PERFORM 6110-PROCESS-ITEMS                           52910006
523500         END-IF                                                   52920006
523600         ADD +1                TO PV-ITEMS-PROCESSED              52930006
523700     END-PERFORM.                                                 52940006
523800     PERFORM 6111-WRITE-LIST-QUEUE.                               52950006
523900                                                                  52960006
524000 EJECT                                                            52970006
524100*----------------------------------------------------------------*52980006
524200*    READ THE LIST QUEUE RECORD.                                 *52990006
524300*----------------------------------------------------------------*53000006
524400 6105-READ-SEL-QUEUE.                                             53010006
524500                                                                  53020006
524600     EXEC CICS                                                    53030006
524700          READQ TS                                                53040006
524800             QUEUE (ASC-SEL-QUEUE-NAME)                           53050006
524900             INTO  (TR322-TEMP-SEL-AREA)                          53060006
525000             ITEM  (PV-SEL-QUEUE-ITEM)                            53070006
525100             RESP  (PV-CICS-RESP)                                 53080006
525200     END-EXEC.                                                    53090006
525300*                                                                 53100006
525400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          53110006
525500         CONTINUE                                                 53120006
525600     ELSE                                                         53130006
525700         SET DP013-CICS-ABEND      TO  TRUE                       53140006
525800         SET DP013-NO-ROLLBACK     TO  TRUE                       53150006
525900         MOVE '6105-READ-SEL-QUEUE'                               53160006
526000                                   TO  DP013-PARAGRAPH            53170006
526100         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           53180006
526200                                   TO  DP013-MESSAGE-TEXT(1)      53190006
526300         PERFORM DP013-0000-PROCESS-ABEND                         53200006
526400     END-IF.                                                      53210006
526500                                                                  53220006
526600 EJECT                                                            53230006
526700*----------------------------------------------------------------*53240006
526800*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*53250006
526900*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*53260006
527000*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *53270006
527100*----------------------------------------------------------------*53280006
527200 6110-PROCESS-ITEMS.                                              53290006
527300                                                                  53300006
527400     COMPUTE PV-ITEM = 1 +                                        53310006
527500               ((TR322-LIST-ITEM-NUMBER (TR322-IDX) - 1)          53320006
527600                     / PC-ITEMS-PER-PANEL).                       53330006
527700                                                                  53340006
527800     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           53350006
527900         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          53360006
528000             PERFORM 6111-WRITE-LIST-QUEUE                        53370006
528100         END-IF                                                   53380006
528200         MOVE PV-ITEM          TO PV-SAVE-ITEM                    53390006
528300                                                                  53400006
528400         PERFORM 6112-READ-LIST-QUEUE                             53410006
528500         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               53420006
528600             CONTINUE                                             53430006
528700         END-IF                                                   53440006
528800     END-IF.                                                      53450006
528900                                                                  53460006
529000     COMPUTE PV-SUB = (TR322-LIST-ITEM-NUMBER (TR322-IDX)         53470006
529100                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              53480006
529200     SET LQW-DESELECT (PV-SUB) TO    TRUE.                        53490006
529300     MOVE LQW-SELECTED-SW (PV-SUB)                                53500006
529400                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  53510006
529500                                                                  53520006
529600     IF TR322-INQ (TR322-IDX)                                     53530006
529700        MOVE PC-INQ            TO LQW-ACTION (PV-SUB)             53540006
529800     END-IF.                                                      53550006
529900                                                                  53560006
530000     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                53570006
530100                                                                  53580006
530200 EJECT                                                            53590006
530300*----------------------------------------------------------------*53600006
530400*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *53610006
530500*----------------------------------------------------------------*53620006
530600 6111-WRITE-LIST-QUEUE.                                           53630006
530700                                                                  53640006
530800     EXEC CICS                                                    53650006
530900         WRITEQ TS                                                53660006
531000             QUEUE (ASC-LIST-QUEUE-NAME)                          53670006
531100             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     53680006
531200             ITEM  (PV-SAVE-ITEM)                                 53690006
531300             REWRITE                                              53700006
531400             RESP  (PV-CICS-RESP)                                 53710006
531500     END-EXEC.                                                    53720006
531600*                                                                 53730006
531700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          53740006
531800         CONTINUE                                                 53750006
531900     ELSE                                                         53760006
532000         SET DP013-CICS-ABEND  TO  TRUE                           53770006
532100         SET DP013-NO-ROLLBACK TO  TRUE                           53780006
532200         MOVE '6111-WRITE-LIST-QUEUE'                             53790006
532300                               TO  DP013-PARAGRAPH                53800006
532400         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  53810006
532500                               TO  DP013-MESSAGE-TEXT(1)          53820006
532600         PERFORM DP013-0000-PROCESS-ABEND                         53830006
532700     END-IF.                                                      53840006
532800                                                                  53850006
532900 EJECT                                                            53860006
533000*----------------------------------------------------------------*53870006
533100*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*53880006
533200*----------------------------------------------------------------*53890006
533300 6112-READ-LIST-QUEUE.                                            53900006
533400                                                                  53910006
533500     EXEC CICS                                                    53920006
533600         READQ TS                                                 53930006
533700             QUEUE (ASC-LIST-QUEUE-NAME)                          53940006
533800             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     53950006
533900             ITEM  (PV-ITEM)                                      53960006
534000             RESP  (PV-CICS-RESP)                                 53970006
534100     END-EXEC.                                                    53980006
534200*                                                                 53990006
534300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          54000006
534400         CONTINUE                                                 54010006
534500     ELSE                                                         54020006
534600         SET DP013-CICS-ABEND        TO TRUE                      54030006
534700         SET DP013-NO-ROLLBACK       TO TRUE                      54040006
534800         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           54050006
534900         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    54060006
535000                                     TO DP013-MESSAGE-TEXT(1)     54070006
535100         PERFORM DP013-0000-PROCESS-ABEND                         54080006
535200     END-IF.                                                      54090006
535300                                                                  54100006
535400 EJECT                                                            54110006
535500*----------------------------------------------------------------*54120006
535600*    ABEND PROCESSOR MODULE                                      *54130006
535700*----------------------------------------------------------------*54140006
535800                                                                  54150006
535900     COPY DPPD013.                                                54160006
536000                                                                  54170006
536100                                                                  54180006
