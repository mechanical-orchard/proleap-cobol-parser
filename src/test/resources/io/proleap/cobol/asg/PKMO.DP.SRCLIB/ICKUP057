000100 IDENTIFICATION DIVISION.                                         00010002
000200                                                                  00020002
000300 PROGRAM-ID.      ICKUP057.                                       00030002
000400 AUTHOR.          STEVEN NOWAK.                                   00040002
000500 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00050002
000600 DATE-WRITTEN.    04/15/10.                                       00060002
000700 DATE-COMPILED.                                                   00070002
000800                                                                  00080002
000900******************************************************************00090002
001000*  MODULE TYPE:   COBOL2 DB2 BATCH.                               00100002
001100*                                                                 00110002
001200*  UPDATE OF THE ICT_LOC_CNT_SUM TABLE                            00120003
001300*                                                                 00130002
001400*========================== CHANGE LOG ===========================00140002
001500*  AUTH        BY           DATE    DESCRIPTION                   00150004
001600*=================================================================00160002
001700* WR37120     S. NOWAK    04-15-10  CREATE PROGRAM                00170004
001800*                                                                 00180002
260107* CHG0260107  JIM HUNTER  08-19-21  ADDED COPYBOOK DPWS991 TO MAKE00181004
260107*                                   THE CALL TO DPKUT901 DYNAMIC. 00182004
001900******************************************************************00190002
002000                                                                  00200002
002100 ENVIRONMENT DIVISION.                                            00210002
002200 CONFIGURATION SECTION.                                           00220002
002300                                                                  00230002
002400 SOURCE-COMPUTER.    IBM-3090.                                    00240002
002500 OBJECT-COMPUTER.    IBM-3090.                                    00250002
002600                                                                  00260002
002700 INPUT-OUTPUT SECTION.                                            00270002
002800 FILE-CONTROL.                                                    00280002
002900                                                                  00290002
003000 DATA DIVISION.                                                   00300002
003100 FILE SECTION.                                                    00310002
003200                                                                  00320002
003300                                                                  00330002
003400***************************************************************** 00340002
003500*                       WORKING STORAGE                           00350002
003600***************************************************************** 00360002
003700 WORKING-STORAGE SECTION.                                         00370002
003800                                                                  00380002
003900 01  W-START                          PIC  X(40)                  00390002
004000     VALUE 'ICKUP057 - WORKING STORAGE BEGINS HERE'.              00400002
004100                                                                  00410002
004200                                                                  00420002
004300***************************************************************** 00430002
004400*                         SWITCHES                                00440002
004500***************************************************************** 00450002
004600 01  PROGRAM-SWITCHES.                                            00460002
004700     05  PS-RESTART-REQUIRED-SW       PIC  X(01) VALUE 'N'.       00470002
004800         88  PS-RESTART-REQUIRED                 VALUE 'Y'.       00480002
004900         88  PS-RESTART-NOT-REQUIRED             VALUE 'N'.       00490002
005000                                                                  00500002
005100******************************************************************00510002
005200*                       ACCUMULATORS                              00520002
005300******************************************************************00530002
005400 01  PROGRAM-ACCUM.                                               00540002
005500     05  PA-READ                      PIC  9(11) VALUE ZEROS.     00550002
005600     05  PA-CKPT                      PIC  9(11) VALUE ZEROS.     00560002
005700                                                                  00570002
005800******************************************************************00580002
005900*                           CONSTANTS                             00590002
006000******************************************************************00600002
006100 01  PROGRAM-CONSTANTS.                                           00610002
006200     05  PC-MAX-RETRIES               PIC S9(04) VALUE +3         00620002
006300                                                 COMP SYNC.       00630002
006400     05  PC-MAX-DEADLOCKS             PIC S9(04) VALUE +3         00640002
006500                                                 COMP SYNC.       00650002
006600                                                                  00660002
006700     05  PC-CKPT-JOB-NAME             PIC  X(08) VALUE 'ICK011  '.00670003
006800     05  PC-CKPT-PLAN-NAME            PIC  X(08) VALUE 'ICKUP057'.00680002
006900     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'ICKUP057'.00690002
007000                                                                  00700002
007100     05  PC-TRAN-PRES-FUNC-CODES.                                 00710002
007200         10  PC-TRAN-PRES-FUNC-OPEN   PIC  X(05) VALUE 'OPEN '.   00720002
007300         10  PC-TRAN-PRES-FUNC-TRANS  PIC  X(05) VALUE 'TRANS'.   00730002
007400         10  PC-TRAN-PRES-FUNC-RSTRT  PIC  X(05) VALUE 'RSTRT'.   00740002
007500         10  PC-TRAN-PRES-FUNC-CLOSE  PIC  X(05) VALUE 'CLOSE'.   00750002
007600                                                                  00760002
007700     05  PC-MINUS-ONE                 PIC S9(01) VALUE -1.        00770002
007800     05  PC-SYSTEM                    PIC  X(08) VALUE 'SYSTEM  '.00780002
007900                                                                  00790002
008000     05  PC-NOT-NULL                  PIC S9(04) VALUE +0.        00800003
008100     05  PC-NULL-DATA                 PIC S9(04) VALUE -1.        00810003
008200                                                                  00820003
008300******************************************************************00830002
008400*                          VARIABLES                              00840002
008500******************************************************************00850002
008600 01  PROGRAM-VARIABLES.                                           00860002
008700     05  PV-SQL-SUB                   PIC  9(03) VALUE ZERO.      00870002
008800     05  PV-DEADLOCK-COUNTER          PIC  9(03) VALUE ZERO.      00880002
008900     05  PV-RETRY-CNT                 PIC  9(03) VALUE ZERO.      00890002
009000     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACE.     00900002
009100     05  PV-DB2-OPER-ATTEMPTED        PIC  X(30) VALUE SPACE.     00910002
009200     05  PV-OPERATION-MSG             PIC  X(35) VALUE SPACE.     00920002
009300     05  PV-RET-CODE                  PIC  9(04) VALUE ZEROS.     00930002
009400                                                                  00940002
009500***************************************************************** 00950003
009600*                      NULL INDICATORS                            00960003
009700***************************************************************** 00970003
009800 01  PROGRAM-NULL-INDICATORS.                                     00980003
009900** INDICATOR VALUE OF -1 INDICATES VALUE IS NULL, +0              00990003
010000** INDICATES NON-NULL VALUE                                       01000003
010100                                                                  01010003
010200     05  PN-IND                       PIC S9(04) VALUE +0  COMP.  01020003
010300         88  DB2-DATA-NULL                       VALUE -1.        01030003
010400                                                                  01040003
010500     05  PN-DEPT-NBR                  PIC S9(04) VALUE +0  COMP.  01050003
010600     05  PN-MJCL-NBR                  PIC S9(04) VALUE +0  COMP.  01060003
010700     05  PN-SBCL-NBR                  PIC S9(04) VALUE +0  COMP.  01070003
010800     05  PN-STYL-NBR                  PIC S9(04) VALUE +0  COMP.  01080003
010900                                                                  01090003
011000******************************************************************01100002
011100*               SYSTEM TIME AND DATE VARIABLES                    01110002
011200******************************************************************01120002
011300 01  SYS-DATE-TIME.                                               01130002
011400     05  SYS-DATE                     PIC  X(08) VALUE SPACES.    01140002
011500     05  SYS-TIME                     PIC  X(08) VALUE SPACES.    01150002
011600                                                                  01160002
011700 01  ST-BEG-TIME.                                                 01170002
011800     05  ST-BEG-HR                    PIC  9(02) VALUE ZEROS.     01180002
011900     05  FILLER                       PIC  X(01) VALUE ':'.       01190002
012000     05  ST-BEG-MN                    PIC  9(02) VALUE ZEROS.     01200002
012100                                                                  01210002
012200 01  ST-END-TIME.                                                 01220002
012300     05  ST-END-HR                    PIC  9(02) VALUE ZEROS.     01230002
012400     05  FILLER                       PIC  X(01) VALUE ':'.       01240002
012500     05  ST-END-MN                    PIC  9(02) VALUE ZEROS.     01250002
012600                                                                  01260002
012700 01  SD-EDIT-DATE.                                                01270002
012800     05  SD-MONTH                     PIC  9(02) VALUE ZEROS.     01280002
012900     05  FILLER                       PIC  X(01) VALUE '-'.       01290002
013000     05  SD-DAY                       PIC  9(02) VALUE ZEROS.     01300002
013100     05  FILLER                       PIC  X(01) VALUE '-'.       01310002
013200     05  SD-CENT                      PIC  9(02) VALUE ZEROS.     01320002
013300     05  SD-YEAR                      PIC  9(02) VALUE ZEROS.     01330002
013400                                                                  01340002
013500******************************************************************01350002
013600*                        ERROR HANDLING                           01360002
013700******************************************************************01370002
013800 01  ABEND-CODE                       PIC S9(04) VALUE ZEROS      01380002
013900                                                 COMP SYNC.       01390002
014000     88  ABEND-4013-DB2-ERROR                    VALUE +4013.     01400002
014100     88  ABEND-4444-FORCED-ABEND                 VALUE +4444.     01410002
014200                                                                  01420002
014300                                                                  01430002
014400******************************************************************01440002
014500*  UPDATE RECORD                                                  01450002
014600******************************************************************01460002
014700     COPY ICRD048.                                                01470003
014800                                                                  01480002
014900******************************************************************01490002
015000*  DB2 FORMATTED ERROR MESSAGE                                    01500002
015100******************************************************************01510002
015200     COPY DPWS004.                                                01520002
015300                                                                  01530002
015400******************************************************************01540002
015500*  SQL COMMUNICATIONS WORK AREA                                   01550002
015600******************************************************************01560002
015700     COPY SQLCA2.                                                 01570002
015800                                                                  01580002
015900******************************************************************01590002
016000*  COMMUNICATIONS AREA FOR DB2                                    01600002
016100******************************************************************01610002
016200     EXEC SQL                                                     01620002
016300         INCLUDE SQLCA                                            01630002
016400     END-EXEC.                                                    01640002
016500                                                                  01650002
016600******************************************************************01660002
016700*  DCLGEN FOR ICT_LOC_CNT_SUM TABLE                               01670003
016800******************************************************************01680002
016900     EXEC SQL                                                     01690002
017000          INCLUDE ICT00012                                        01700003
017100     END-EXEC.                                                    01710002
017200                                                                  01720002
017300                                                                  01730002
017400******************************************************************01740002
017500*  TRANSACTION PREPARATION MODULE COMMUNICATIONS AREA             01750002
017600******************************************************************01760002
260107     COPY DPWS991.                                                01770004
017700                                                                  01770104
017700     COPY DPLS001.                                                01771004
017800     05  WORK-STORAGE-PASSED.                                     01780002
017900******************************************************************01790002
018000*PA - PROGRAM ACCUMULATORS                                        01800002
018100******************************************************************01810002
018200         10  PROGRAM-ACCUMULATORS.                                01820002
018300             15  PA-ROWS-INSERT   PIC S9(11)           VALUE ZERO 01830003
018400                                                       COMP-3.    01840002
018500                                                                  01850002
018600 01  FILLER                          PIC X(4096)  VALUE SPACE.    01860002
018700                                                                  01870002
018800                                                                  01880002
018900                                                                  01890002
019000 PROCEDURE DIVISION.                                              01900002
019100******************************************************************01910002
019200* MAINLINE-PROCESSING                                             01920002
019300******************************************************************01930002
019400                                                                  01940002
019500     PERFORM A100-INITIALIZE.                                     01950002
019600                                                                  01960002
019700     PERFORM B100-PROCESS-RECORDS                                 01970002
019800       UNTIL DP001-PREP-TRANS-EOF.                                01980002
019900                                                                  01990002
020000     PERFORM Z990-EOJ-ROUTINE.                                    02000002
020100                                                                  02010002
020200     GOBACK.                                                      02020002
020300                                                                  02030002
020400                                                                  02040002
020500******************************************************************02050002
020600* PREFORMS TASK INITIATION                                        02060002
020700******************************************************************02070002
020800 A100-INITIALIZE.                                                 02080002
020900                                                                  02090002
021000     MOVE FUNCTION CURRENT-DATE TO SYS-DATE-TIME.                 02100002
021100                                                                  02110002
021200     MOVE SYS-TIME (1:2) TO ST-BEG-HR.                            02120002
021300     MOVE SYS-TIME (3:2) TO ST-BEG-MN.                            02130002
021400                                                                  02140002
021500     MOVE SYS-DATE (1:2) TO SD-CENT.                              02150002
021600     MOVE SYS-DATE (3:2) TO SD-YEAR.                              02160002
021700     MOVE SYS-DATE (5:2) TO SD-MONTH.                             02170002
021800     MOVE SYS-DATE (7:2) TO SD-DAY.                               02180002
021900                                                                  02190002
022000     MOVE PC-TRAN-PRES-FUNC-OPEN TO DP001-FUNC-CODE.              02200002
022100                                                                  02210002
022200     PERFORM X100-BUILD-COMM-AREA-TRAN-PRES.                      02220002
022300                                                                  02230002
022400                                                                  02240002
022500******************************************************************02250002
022600* PROCESS RECORDS                                                 02260002
022700******************************************************************02270002
022800 B100-PROCESS-RECORDS.                                            02280002
022900                                                                  02290002
023000     SET PS-RESTART-NOT-REQUIRED TO TRUE.                         02300002
023100                                                                  02310002
023200     PERFORM C100-INSERT-RECS.                                    02320003
023300                                                                  02330002
023400*----------------------------------------------------------------*02340002
023500*  IF A RESTART IS REQUIRED, ISSUE A RESTART CALL RATHER THAN A  *02350002
023600*  TRANS CALL.  THIS WILL ALLOW PROCESSING TO RESUME WITH THE    *02360002
023700*  FIRST TRANSACTION AFTER THE LAST COMMIT.                      *02370002
023800*----------------------------------------------------------------*02380002
023900     IF  PS-RESTART-REQUIRED                                      02390002
024000         MOVE PC-TRAN-PRES-FUNC-RSTRT TO DP001-FUNC-CODE          02400002
024100     ELSE                                                         02410002
024200         MOVE PC-TRAN-PRES-FUNC-TRANS TO DP001-FUNC-CODE          02420002
024300     END-IF.                                                      02430002
024400                                                                  02440002
024500     PERFORM X100-BUILD-COMM-AREA-TRAN-PRES.                      02450002
024600                                                                  02460002
024700     ADD 1 TO PA-READ.                                            02470002
024800                                                                  02480002
024900                                                                  02490002
025000******************************************************************02500002
025100* INSERT PROCESS                                                  02510003
025200******************************************************************02520002
025300 C100-INSERT-RECS.                                                02530003
025400                                                                  02540002
025500     PERFORM C200-POPULATE-DCLGEN.                                02550003
025600     PERFORM C300-SET-NULL-IND.                                   02560003
025700                                                                  02570003
025800     PERFORM C400-INSERT-DATA.                                    02580003
025900                                                                  02590003
026000                                                                  02600002
026100******************************************************************02610003
026200* POPULATE THE ICT00012 DCLGEN                                    02620003
026300******************************************************************02630003
026400 C200-POPULATE-DCLGEN.                                            02640003
026500                                                                  02650003
026600     MOVE IC048-LOC-NBR            TO ICT00012-LOC-NBR.           02660003
026700     MOVE IC048-CNT-STUP-ID        TO ICT00012-CNT-STUP-ID.       02670003
026800     MOVE IC048-LAST-UPD-TMST      TO ICT00012-LAST-UPD-TMST.     02680003
026900     MOVE IC048-CNT-SEQ-NBR        TO ICT00012-CNT-SEQ-NBR.       02690003
027000     MOVE IC048-LOC-EXPTED-UNT-QTY TO ICT00012-LOC-EXPTED-UNT-QTY.02700003
027100     MOVE IC048-KYD-UNT-QTY        TO ICT00012-KYD-UNT-QTY.       02710003
027200     MOVE IC048-DEPT-NBR           TO ICT00012-DEPT-NBR.          02720003
027300     MOVE IC048-MAJ-CL-NBR         TO ICT00012-MAJ-CL-NBR.        02730003
027400     MOVE IC048-SUB-CL-NBR         TO ICT00012-SUB-CL-NBR.        02740003
027500     MOVE IC048-STYL-ID            TO ICT00012-STYL-ID.           02750003
027600     MOVE IC048-EXEC-TMST          TO ICT00012-EXEC-TMST.         02760003
027700                                                                  02770003
027800                                                                  02780003
027900******************************************************************02790003
028000* SET THE NULL INDICATORS                                         02800003
028100******************************************************************02810003
028200 C300-SET-NULL-IND.                                               02820003
028300                                                                  02830003
028400     IF  ICT00012-DEPT-NBR   = ZEROS                              02840003
028500         MOVE PC-NULL-DATA TO PN-DEPT-NBR                         02850003
028600     ELSE                                                         02860003
028700         MOVE PC-NOT-NULL  TO PN-DEPT-NBR                         02870003
028800     END-IF.                                                      02880003
028900     IF  ICT00012-MAJ-CL-NBR = ZEROS                              02890003
029000         MOVE PC-NULL-DATA TO PN-MJCL-NBR                         02900003
029100     ELSE                                                         02910003
029200         MOVE PC-NOT-NULL  TO PN-MJCL-NBR                         02920003
029300     END-IF.                                                      02930003
029400     IF  ICT00012-SUB-CL-NBR = ZEROS                              02940003
029500         MOVE PC-NULL-DATA TO PN-SBCL-NBR                         02950003
029600     ELSE                                                         02960003
029700         MOVE PC-NOT-NULL  TO PN-SBCL-NBR                         02970003
029800     END-IF.                                                      02980003
029900     IF  ICT00012-STYL-ID    = ZEROS                              02990003
030000         MOVE PC-NULL-DATA TO PN-STYL-NBR                         03000003
030100     ELSE                                                         03010003
030200         MOVE PC-NOT-NULL  TO PN-STYL-NBR                         03020003
030300     END-IF.                                                      03030003
030400                                                                  03040003
030500                                                                  03050003
030600******************************************************************03060003
030700* INSERT ICT_LOC_CNT_SUM TABLE                                    03070003
030800******************************************************************03080002
030900 C400-INSERT-DATA.                                                03090003
031000                                                                  03100002
031100     EXEC SQL                                                     03110003
031200       INSERT INTO ICT_LOC_CNT_SUM                                03120003
031300               (LOC_NBR                                           03130003
031400               ,CNT_STUP_ID                                       03140003
031500               ,LAST_UPD_TMST                                     03150003
031600               ,CNT_SEQ_NBR                                       03160003
031700               ,LOC_EXPTED_UNT_QTY                                03170003
031800               ,KYD_UNT_QTY                                       03180003
031900               ,DEPT_NBR                                          03190003
032000               ,MAJ_CL_NBR                                        03200003
032100               ,SUB_CL_NBR                                        03210003
032200               ,STYL_ID                                           03220003
032300               ,EXEC_TMST)                                        03230003
032400     VALUES                                                       03240003
032500             (:ICT00012-LOC-NBR                                   03250003
032600             ,:ICT00012-CNT-STUP-ID                               03260003
032700             ,:ICT00012-LAST-UPD-TMST                             03270003
032800             ,:ICT00012-CNT-SEQ-NBR                               03280003
032900             ,:ICT00012-LOC-EXPTED-UNT-QTY                        03290003
033000             ,:ICT00012-KYD-UNT-QTY                               03300003
033100             ,:ICT00012-DEPT-NBR    :PN-DEPT-NBR                  03310003
033200             ,:ICT00012-MAJ-CL-NBR  :PN-MJCL-NBR                  03320003
033300             ,:ICT00012-SUB-CL-NBR  :PN-SBCL-NBR                  03330003
033400             ,:ICT00012-STYL-ID     :PN-STYL-NBR                  03340003
033500             ,:ICT00012-EXEC-TMST)                                03350003
033600     END-EXEC.                                                    03360003
033700                                                                  03370003
033800                                                                  03380002
033900     EVALUATE TRUE                                                03390002
034000        WHEN SQLCODE = 0                                          03400002
034100            ADD 1 TO PA-ROWS-INSERT                               03410003
034200                                                                  03420002
034300        WHEN OTHER                                                03430002
034400            DISPLAY '          '                                  03440003
034500            DISPLAY 'LOC-NBR = ' ICT00012-LOC-NBR                 03450003
034600            DISPLAY 'STUP-ID = ' ICT00012-CNT-STUP-ID             03460003
034700            DISPLAY 'UPD-TMST= ' ICT00012-LAST-UPD-TMST           03470003
034800            DISPLAY 'SEQ-NBR = ' ICT00012-CNT-SEQ-NBR             03480003
034900            DISPLAY 'UNT-QTY = ' ICT00012-LOC-EXPTED-UNT-QTY      03490003
035000            DISPLAY 'KYD-QTY = ' ICT00012-KYD-UNT-QTY             03500003
035100            DISPLAY 'DEPT-NBR= ' ICT00012-DEPT-NBR                03510003
035200            DISPLAY 'MAJ-CL  = ' ICT00012-MAJ-CL-NBR              03520003
035300            DISPLAY 'SUB-CL  = ' ICT00012-SUB-CL-NBR              03530003
035400            DISPLAY 'STYL-ID = ' ICT00012-STYL-ID                 03540003
035500            DISPLAY 'EXEC TM = ' ICT00012-EXEC-TMST               03550003
035600                                                                  03560003
035700            MOVE 'C400-INSERT-DATA'       TO PV-PARAGRAPH-NAME    03570003
035800            MOVE 'ICT_LOC_CNT_SUM INSERT' TO PV-DB2-OPER-ATTEMPTED03580003
035900                                                                  03590002
036000            PERFORM Z200-SQL-ABEND                                03600002
036100     END-EVALUATE.                                                03610002
036200                                                                  03620002
036300                                                                  03630002
036400******************************************************************03640002
036500* BUILD THE COMMUNICATION AREA FOR A CALL TO THE TRANSACTION      03650002
036600* PRESENTATION MODULE                                             03660002
036700******************************************************************03670002
036800 X100-BUILD-COMM-AREA-TRAN-PRES.                                  03680002
036900                                                                  03690002
037000     MOVE LENGTH OF                                               03700002
037100          WORK-STORAGE-PASSED TO DP001-WORK-STRG-LENGTH.          03710002
037200     MOVE PC-CKPT-JOB-NAME    TO DP001-JOB-NAME.                  03720002
037300     MOVE PC-CKPT-PLAN-NAME   TO DP001-PLAN-NAME.                 03730002
037400                                                                  03740002
037500     PERFORM X200-CALL-TRANS-PRES-MODULE.                         03750002
037600                                                                  03760002
037700     MOVE DP001-TRANS-RECORD  TO IC048-UPDT-REC.                  03770003
037800                                                                  03780002
037900     IF  DP001-CKPT-TAKEN                                         03790002
038000         ADD 1 TO PA-CKPT                                         03800002
038100                                                                  03810002
038200         INITIALIZE PV-DEADLOCK-COUNTER                           03820002
038300     END-IF.                                                      03830002
038400                                                                  03840002
038500                                                                  03850002
038600******************************************************************03860002
038700* VERIFY THE RETURN CODE ON THE CALLED MODULE                     03870002
038800******************************************************************03880002
038900 X200-CALL-TRANS-PRES-MODULE.                                     03890002
039000                                                                  03900002
039100     PERFORM Z900-CALL-TRANS-PRES-MODULE.                         03910002
039200                                                                  03920002
039300     IF  DP001-GOOD-RET-CODE                                      03930002
039400     OR  DP001-CKPT-TAKEN                                         03940002
039500     OR  DP001-RESTART                                            03950002
039600         CONTINUE                                                 03960002
039700                                                                  03970002
039800     ELSE                                                         03980002
039900         MOVE 'X200-CALL-TRANS-PRES-MODULE' TO PV-PARAGRAPH-NAME  03990002
040000         MOVE '** BAD CALL TO TRANS PREP MODULE **'               04000002
040100                                            TO PV-OPERATION-MSG   04010002
040200         MOVE DP001-RET-CODE                TO PV-RET-CODE        04020002
040300                                                                  04030002
040400         SET ABEND-4444-FORCED-ABEND TO TRUE                      04040002
040500                                                                  04050002
040600         PERFORM Z100-ABEND                                       04060002
040700     END-IF.                                                      04070002
040800                                                                  04080002
040900                                                                  04090002
041000******************************************************************04100002
041100* NON-DB2 ABEND                                                   04110002
041200******************************************************************04120002
041300 Z100-ABEND.                                                      04130002
041400                                                                  04140002
041500     PERFORM Z999-CONTROLS.                                       04150002
041600                                                                  04160002
041700     DISPLAY '                     '.                             04170002
041800     DISPLAY '** ABEND           **'.                             04180002
041900     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          04190002
042000     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        04200002
042100     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG.         04210002
042200     DISPLAY '** RETURN CODE     ** = ' PV-RET-CODE.              04220002
042300                                                                  04230002
042400     CALL 'ILBOABN0' USING ABEND-CODE.                            04240002
042500                                                                  04250002
042600                                                                  04260002
042700******************************************************************04270002
042800* ABEND THE PROGRAM IN THE EVENT THAT A SQL ERROR OR WARNING      04280002
042900* CODE OCCURS.                                                    04290002
043000******************************************************************04300002
043100 Z200-SQL-ABEND.                                                  04310002
043200                                                                  04320002
043300     PERFORM Z999-CONTROLS.                                       04330002
043400                                                                  04340002
043500     DISPLAY '** ABEND     **'.                                   04350002
043600     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                04360002
043700     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              04370002
043800     DISPLAY '** OPERATION ** = ' PV-DB2-OPER-ATTEMPTED.          04380002
043900                                                                  04390002
044000******************************************************************04400002
044100* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    04410002
044200* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         04420002
044300* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     04430002
044400* FORMAT.                                                         04440002
044500******************************************************************04450002
044600     COPY DPPD004.                                                04460002
044700                                                                  04470002
044800     SET ABEND-4013-DB2-ERROR TO TRUE.                            04480002
044900                                                                  04490002
045000     CALL 'ILBOABN0' USING ABEND-CODE.                            04500002
045100                                                                  04510002
045200                                                                  04520002
045300******************************************************************04530002
045400* PREFORMS TASK TERMINATION PROCESSING                            04540002
045500******************************************************************04550002
045600 Z990-EOJ-ROUTINE.                                                04560002
045700                                                                  04570002
045800     MOVE PC-TRAN-PRES-FUNC-CLOSE TO DP001-FUNC-CODE.             04580002
045900                                                                  04590002
046000     PERFORM X100-BUILD-COMM-AREA-TRAN-PRES.                      04600002
046100                                                                  04610002
046200     PERFORM Z999-CONTROLS.                                       04620002
046300                                                                  04630002
046400                                                                  04640002
046500******************************************************************04650002
046600* DISPLAY CONTROLS FROM THE PROGRAM                               04660002
046700******************************************************************04670002
046800 Z999-CONTROLS.                                                   04680002
046900                                                                  04690002
047000     MOVE FUNCTION CURRENT-DATE TO SYS-DATE-TIME.                 04700002
047100                                                                  04710002
047200     MOVE SYS-TIME (1:2) TO ST-END-HR.                            04720002
047300     MOVE SYS-TIME (3:2) TO ST-END-MN.                            04730002
047400                                                                  04740002
047500     DISPLAY '                    '.                              04750002
047600     DISPLAY '**********************'.                            04760002
047700     DISPLAY '   ICKUP057 CONTROLS  '.                            04770002
047800     DISPLAY '**********************'.                            04780002
047900     DISPLAY 'RUN DATE  = ' SD-EDIT-DATE.                         04790002
048000     DISPLAY 'BEG TIME  = ' ST-BEG-TIME.                          04800002
048100     DISPLAY 'END TIME  = ' ST-END-TIME.                          04810002
048200     DISPLAY '======================'.                            04820002
048300     DISPLAY 'RECORDS READ   = ' PA-READ.                         04830002
048400     DISPLAY 'CHECKPOINTS    = ' PA-CKPT.                         04840002
048500     DISPLAY '                '.                                  04850002
048600     DISPLAY 'ROWS UPDATE  = ' PA-ROWS-INSERT.                    04860003
048700     DISPLAY '                '.                                  04870002
048800                                                                  04880002
048900******************************************************************04890002
049000* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    04900002
049100* MENTS THAT ARE REQUIRED TO INVOKE THE TRANSACTION PRESENTATION  04910002
049200* MODULE (DPKUT901) OF THE DB2 CHECKPOINT RESTART SYSTEM.         04920002
049300******************************************************************04930002
049400     COPY DPPD001.                                                04940002
049500                                                                  04950002
049600                                                                  04960002
