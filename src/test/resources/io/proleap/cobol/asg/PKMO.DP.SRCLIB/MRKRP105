000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400                                                                  00040000
000500 PROGRAM-ID.             MRKRP105.                                00050000
000600 AUTHOR.                 LINDA FRIESS.                            00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            04-02-01.                                00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100***************************************************************** 00110000
001200*                                                               * 00120000
001300*  THIS PROGRAM WILL PRINT THE INFOREM SERVICE LEVEL REPORT     * 00130000
001310*  FOR E-COMMERCE STORES THAT ARE ON MIN/MAX.  IT IS A CLONE    * 00131000
001320*  OF THE ORIGINAL SERVICE LEVEL REPORT PROGRAM, MRKRP086.      * 00132000
001330*  SERVICE LEVELS ARE CALCULATED & REPORTED BY STYLE/COLOR.     * 00133000
001340*  THE OH-LT-MIN FILE CONTAINS ALL ITEM/STORES THAT HAVE HAD    * 00134000
001350*  AN ONHAND QUANTITY < MINIMUM AT ANY TIME DURING THE PREVIOUS * 00135000
001360*  WEEK.  THIS IS USED TO DETERMINE THE SERVICE LEVEL.  COUNTS  * 00136000
001370*  ARE GENERATED FOR THE NUMBER OF ITEMS AND STORES THAT FELL   * 00137000
001380*  BELOW A SET SERVICE LEVEL LIMIT (WHICH IS INPUT THROUGH A    * 00138000
001390*  CONTROL CARD).  ANY DEPARTMENT CAN ALSO BE SUMMED UP TO THE  * 00139000
001400*  SUBCLASS LEVEL (THESE ARE ALSO INPUT THROUGH CONTROL CARDS). * 00140000
001500*                                                               * 00150000
001600***************************************************************** 00160000
001700*  CHANGE MADE:                                                 * 00170000
001800*                                                               * 00180000
001900*  CHANGED 04/02/01 BY LINDA FRIESS               WR# 21599     * 00190000
002000*    INITIAL PROGRAM CODE                                       * 00200000
002100*                                                               * 00210000
002200***************************************************************** 00220000
002210* 05/03/2002 - DON TOMLINSON  NI-SKU MR PHASE 4 CHANGES         * 00221000
002220* -  TSKXREF ADDED.                                             * 00222000
002230* -  ADDED ISWS006 COPYBOOK TO HANDLE DIFFERENT FORMATS / SIZES * 00223000
002240*    IN FIELDS.                                                 * 00224000
002250* -  SQL CHANGED FOR WHERE STATEMENTS TO REFERENCE DCLGEN       * 00225000
002260*    FIELDS INSTEAD OF PROGRAM VARAIABLES IN WORKING STORAGE    * 00226000
002270* -  REPORT FORMAT CHANGED TO ZERO SUPPRESS FOR DEPT AND SKU.   * 00227000
002200***************************************************************** 00228021
002210* 06/10/2004 - BOB FORD WR#26363 STORE NUMBER EXPANSION         * 00228121
002220*    CHANGED PROGRAM TO HANDLE 5-DIGIT STORES.  CHANGED REPORT  * 00228221
002220*    FIELD SIZES, COPYBOOKS, HOLD-AREAS.  REPLACED TSTROO WITH  * 00228321
002220*    XMT_LOC, CHANGED READS TO TSKST, TSKSTOO AND TMRITST TO    * 00228421
002220*    USE NUMERIC STORE.                                         * 00228521
002290***************************************************************** 00229000
002210* 07/19/2022 - JEAN KURK                  CHG0271937            * 00230027
002220*    RECOMPILE FOR UPCOMING COBOL UPGRADE - ADDED TABLE         * 00240027
002220*    QUALIFIER TO FIELDS FROM TMDSEBG                           * 00240127
002290***************************************************************** 00244027
002500 ENVIRONMENT DIVISION.                                            00250000
002600***************************************************************** 00260000
002700                                                                  00270000
002800 CONFIGURATION SECTION.                                           00280000
002900                                                                  00290000
003000 SOURCE-COMPUTER.        IBM-3090.                                00300000
003100 OBJECT-COMPUTER.        IBM-3090.                                00310000
003200                                                                  00320000
003300 INPUT-OUTPUT SECTION.                                            00330000
003400                                                                  00340000
003500 FILE-CONTROL.                                                    00350000
003600*                                                                 00360000
003700     SELECT CONTROL-FILE                                          00370000
003800                             ASSIGN       TO INP01.               00380000
003900                                                                  00390000
004000     SELECT OH-LT-MIN-FILE                                        00400000
004100                             ASSIGN       TO INP02                00410000
004200                             ORGANIZATION IS INDEXED              00420000
004300                             ACCESS       IS SEQUENTIAL           00430000
004400                             RECORD KEY   IS OH-LT-MIN-KEY        00440000
004500                             FILE STATUS  IS PV-VSAM-STATUS.      00450000
004600                                                                  00460000
004700     SELECT PRINT-REPORT                                          00470000
004800                             ASSIGN       TO OUT01.               00480000
004900*                                                                 00490000
005000***************************************************************** 00500000
005100 DATA DIVISION.                                                   00510000
005200***************************************************************** 00520000
005300*                                                                 00530000
005400 FILE SECTION.                                                    00540000
005500*                                                                 00550000
005600 FD  CONTROL-FILE                                                 00560000
005700     RECORDING MODE IS F                                          00570000
005800     DATA RECORD IS CONTROL-RECORD.                               00580000
005900                                                                  00590000
006000 01  CONTROL-RECORD                    PIC X(80).                 00600000
006100*                                                                 00610000
006200 FD  OH-LT-MIN-FILE                                               00620000
006300     LABEL RECORDS ARE STANDARD                                   00630000
006400     RECORD CONTAINS 65 CHARACTERS                                00640021
006500     BLOCK CONTAINS 0 RECORDS.                                    00650000
006600*                                                                 00660000
006700 01  OH-LT-MIN-RECORD.                                            00670000
006800     05  OH-LT-MIN-KEY                PIC  X(65).                 00680021
006900*                                                                 00690000
007000 FD  PRINT-REPORT                                                 00700000
007100     LABEL RECORDS ARE STANDARD                                   00710000
007200     RECORDING MODE IS F                                          00720000
007300     RECORD CONTAINS 132 CHARACTERS                               00730000
007400     BLOCK CONTAINS 0 RECORDS.                                    00740000
007500                                                                  00750000
007600 01  PRINT-LINE                       PIC X(132).                 00760000
007700*                                                                 00770000
007800*                                                                 00780000
007900 WORKING-STORAGE SECTION.                                         00790000
008000*                                                                 00800000
008100 01  CONTROL-DATA-IN.                                             00810000
008200     05 CTL-PERCENTAGES-CARD.                                     00820000
008300        10 CTL-SKU-SVC-LEVEL-PCT       PIC 9(03).                 00830000
008400        10 FILLER                      PIC X.                     00840000
008500        10 CTL-STORE-SVC-LEVEL-PCT     PIC 9(03).                 00850000
008600     05 CTL-DEPT-CARD REDEFINES CTL-PERCENTAGES-CARD.             00860000
008700        10 CTL-DEPT                    PIC X(03).                 00870000
008800        10 FILLER                      PIC X(04).                 00880000
008900     05 FILLER                         PIC X(73).                 00890000
009000*                                                                 00900000
009100*                                                                 00910000
009200     COPY MRRD113.                                                00920000
009300*                                                                 00930000
009400******************************************************            00940000
009500** STANDARD HEADER LINE - KOHLS 132 COL                           00950000
009600******************************************************            00960000
009700     COPY DPWS132.                                                00970000
009800*                                                                 00980000
009900 01  HEADING-LINE-2.                                              00990000
010000     05  FILLER                       PIC X(02)  VALUE SPACES.    01000000
010100     05  FILLER                       PIC X(07)  VALUE 'BUYER: '. 01010000
010200     05  HL2-BYR-NMBR                 PIC X(03).                  01020000
010300     05  FILLER                       PIC X(02)  VALUE SPACES.    01030000
010400     05  HL2-BYR-NAME                 PIC X(25).                  01040000
010500     05  FILLER                       PIC X(01)  VALUE SPACES.    01050000
010600     05  FILLER                       PIC X(37)  VALUE            01060000
010700         'INFOREM SERVICE LEVEL FOR E-COMMERCE '.                 01070000
010800     05  FILLER                       PIC X(17)  VALUE            01080000
010900         'STORES ON MIN/MAX'.                                     01090000
011000     05  FILLER                       PIC X(38)  VALUE SPACES.    01100000
011100*                                                                 01110000
011200 01  HEADING-LINE-3.                                              01120000
011300     05  FILLER                       PIC X(02)  VALUE SPACES.    01130000
011400     05  FILLER                       PIC X(07)  VALUE 'DEPT:  '. 01140000
011500     05  HL3-DEPT                     PIC Z(03).                  01150000
011600     05  FILLER                       PIC X(02)  VALUE SPACES.    01160000
011700     05  FILLER                       PIC X(17)  VALUE            01170000
011800         'BUSINESS GROUP:  '.                                     01180000
011900     05  HL3-BG-NUMBER                PIC X(03).                  01190000
012000     05  FILLER                       PIC X(01)  VALUE SPACES.    01200000
012100     05  HL3-BG-DESC                  PIC X(25).                  01210000
012200     05  FILLER                       PIC X(06)  VALUE SPACES.    01220000
012300     05  FILLER                       PIC X(53)  VALUE            01230000
012400         '* INDICATES SOME STORES DO NOT CONTAIN ALL THE ITEMS '. 01240000
012500     05  FILLER                       PIC X(13)  VALUE            01250000
012600         'IN THIS STYLE'.                                         01260000
012700*                                                                 01270000
012800 01  HEADING-LINE-4.                                              01280000
012900     05  FILLER                       PIC X(04)  VALUE SPACES.    01290000
013000     05  FILLER                       PIC X(56)  VALUE SPACES.    01300024
013100     05  FILLER                       PIC X(52)  VALUE            01310000
013200         'TOTAL    TOTAL    AVG     AVG          SVC    # SKUS'.  01320000
013300     05  FILLER                       PIC X(20)  VALUE            01330024
013400         ' # STORES  AVG.     '.                                  01340024
013500*                                                                 01350000
013600 01  HEADING-LINE-5.                                              01360000
013700     05  FILLER                       PIC X(01)  VALUE SPACES.    01370000
013800     05  FILLER                       PIC X(05)  VALUE 'CLASS'.   01380000
013900     05  FILLER                       PIC X(01)  VALUE SPACES.    01390000
014000     05  FILLER                       PIC X(38)  VALUE            01400000
014100         'STYLE           DESCRIPTION           '.                01410000
014200     05  FILLER                       PIC X(24)  VALUE            01420021
014300         '    COLOR      STORES   '.                              01430021
014400     05  FILLER                       PIC X(39)  VALUE            01440000
014500         'SKUS      OH      OO  CSTOCK  LVL %   <'.               01450000
014600     05  HL5-SKU-LIMIT                PIC ZZ9.                    01460000
014700     05  FILLER                       PIC X(05)  VALUE '%   <'.   01470024
014800     05  HL5-STORE-LIMIT              PIC ZZ9.                    01480000
014900     05  FILLER                       PIC X(13)  VALUE            01490000
015000         '%  OSTRAT  LT'.                                         01500000
015100*                                                                 01510000
015200 01  DETAIL-LINE-1.                                               01520000
015300     05  FILLER                       PIC X(02)  VALUE SPACES.    01530000
015400     05  DL1-CLASS                    PIC X(02).                  01540000
015500     05  FILLER                       PIC X(02)  VALUE SPACES.    01550000
015600     05  DL1-STYLE                    PIC X(15).                  01560000
015700     05  FILLER                       PIC X(01)  VALUE SPACES.    01570000
015800     05  DL1-DESC                     PIC X(25).                  01580000
015900     05  FILLER                       PIC X(01)  VALUE SPACES.    01590000
016000     05  DL1-COLOR                    PIC X(10).                  01600000
016100     05  FILLER                       PIC X(01)  VALUE SPACES.    01610000
016200     05  DL1-TOT-STORES               PIC ZZZZ9.                  01620021
016300     05  FILLER                       PIC X(01)  VALUE SPACES.    01630000
016400     05  DL1-ASTERISK                 PIC X(01)  VALUE SPACES.    01640000
016500     05  FILLER                       PIC X(02)  VALUE SPACES.    01650000
016600     05  DL1-TOT-SKUS                 PIC Z,ZZ9.                  01660000
016700     05  FILLER                       PIC X(01)  VALUE SPACES.    01670000
016800     05  DL1-AVG-OH                   PIC ZZZZ9.9-.               01680000
016900     05  DL1-AVG-OO                   PIC ZZZZ9.9-.               01690000
017000     05  DL1-CSTOCK                   PIC ZZZZZZ9.                01700000
017100     05  FILLER                       PIC X(02)  VALUE SPACES.    01710000
017200     05  DL1-SVC-LEVEL                PIC ZZ9.                    01720000
017300     05  FILLER                       PIC X(05)  VALUE SPACES.    01730000
017400     05  DL1-SKUS-BELOW               PIC Z,ZZ9.                  01740000
017500     05  FILLER                       PIC X(02)  VALUE SPACES.    01750024
017600     05  DL1-STORES-BELOW             PIC ZZ,ZZ9.                 01760024
017700     05  FILLER                       PIC X(03)  VALUE SPACES.    01770000
017800     05  DL1-AVG-OSTRAT               PIC ZZ9.9.                  01780000
017900     05  FILLER                       PIC X(01)  VALUE SPACES.    01790000
018000     05  DL1-LEAD-TIME                PIC ZZ9.                    01800000
018100*                                                                 01810000
018200 01  TOTAL-LINE-1.                                                01820000
018300     05  FILLER                       PIC X(02)  VALUE SPACES.    01830000
018400     05  TL1-CLASS                    PIC X(02).                  01840000
018500     05  FILLER                       PIC X(04)  VALUE SPACES.    01850000
018600     05  TL1-STYLE-DESC               PIC X(18).                  01860000
018700     05  FILLER                       PIC X(01)  VALUE SPACES.    01870000
018800     05  TL1-NBR-OF-STYLES            PIC ZZZZ.                   01880000
018900     05  FILLER                       PIC X(07)  VALUE SPACES.    01890000
019000     05  TL1-TOTAL-DESC               PIC X(20).                  01900000
019100     05  FILLER                       PIC X(05)  VALUE SPACES.    01910000
019200     05  TL1-TOT-SKUS                 PIC Z,ZZZ,ZZ9.              01920000
019300     05  FILLER                       PIC X(01)  VALUE SPACES.    01930000
019400     05  TL1-AVG-OH                   PIC ZZZZ9.9-.               01940000
019500     05  TL1-AVG-OO                   PIC ZZZZ9.9-.               01950000
019600     05  TL1-CSTOCK                   PIC ZZZZZZ9.                01960000
019700     05  FILLER                       PIC X(02)  VALUE SPACES.    01970000
019800     05  TL1-SVC-LEVEL                PIC ZZ9.                    01980000
019900     05  FILLER                       PIC X(01)  VALUE SPACES.    01990000
020000     05  TL1-SKUS-BELOW               PIC Z,ZZZ,ZZ9.              02000000
020100     05  FILLER                       PIC X(01)  VALUE SPACES.    02010000
020200     05  TL1-STORES-BELOW             PIC ZZZZ,ZZ9.               02020000
020300     05  FILLER                       PIC X(03)  VALUE SPACES.    02030000
020400     05  TL1-AVG-OSTRAT               PIC ZZ9.9.                  02040000
020500     05  FILLER                       PIC X(01)  VALUE SPACES.    02050000
020600     05  TL1-LEAD-TIME                PIC ZZ9.                    02060000
020700*                                                                 02070000
020800 01  TOTAL-LINE-2.                                                02080000
020900     05  FILLER                       PIC X(02)  VALUE SPACES.    02090000
021000     05  TL2-CLASS                    PIC X(02).                  02100000
021100     05  FILLER                       PIC X(34)  VALUE SPACES.    02110000
021200     05  TL2-TOTAL-DESC               PIC X(20).                  02120000
021300     05  FILLER                       PIC X(05)  VALUE SPACES.    02130000
021400     05  TL2-TOT-SKUS                 PIC Z,ZZZ,ZZ9.              02140000
021500     05  FILLER                       PIC X(26)  VALUE SPACES.    02150000
021600     05  TL2-SVC-LEVEL                PIC ZZ9.                    02160000
021700     05  FILLER                       PIC X(01)  VALUE SPACES.    02170000
021800     05  TL2-SKUS-BELOW               PIC Z,ZZZ,ZZ9.              02180000
021900     05  FILLER                       PIC X(01)  VALUE SPACES.    02190000
022000     05  TL2-STORES-BELOW             PIC ZZZZ,ZZ9.               02200000
022100     05  FILLER                       PIC X(12)  VALUE SPACES.    02210000
022200*                                                                 02220000
022300 01  DASHED-LINE.                                                 02230000
022400     05  FILLER                       PIC X(65)  VALUE SPACES.    02240000
022500     05  FILLER                       PIC X(50)  VALUE            02250000
022600         '--------------------------------------------------'.    02260000
022700     05  FILLER                       PIC X(06)  VALUE            02270000
022800         '------'.                                                02280000
022900     05  FILLER                       PIC X(11)  VALUE SPACES.    02290000
023000*                                                                 02300000
023100 01  BLANK-LINE.                                                  02310000
023200     05  FILLER                       PIC X(132) VALUE SPACES.    02320000
023300*                                                                 02330000
023400 01  END-OF-REPORT-LINE.                                          02340000
023500     05  FILLER                       PIC X(25)      VALUE        02350000
023600         ' ** END OF REPORT **     '.                             02360000
023700*                                                                 02370000
023800*                                                                 02380000
023900 01  PROGRAM-SWITCHES.                                            02390000
024000     05  PS-EOF-CONTROL-FILE         PIC  X(01)    VALUE 'N'.     02400000
024100         88  EOF-CONTROL-FILE                      VALUE 'Y'.     02410000
024200     05  PS-EOF-BG-DEPT-CURSOR       PIC  X(01)    VALUE 'N'.     02420000
024300         88  EOF-BG-DEPT-CURSOR                    VALUE 'Y'.     02430000
024400     05  PS-EOF-ITEM-CURSOR          PIC  X(01)    VALUE 'N'.     02440000
024500         88  EOF-ITEM-CURSOR                       VALUE 'Y'.     02450000
024600         88  NOT-EOF-ITEM-CURSOR                   VALUE 'N'.     02460000
024700     05  PS-EOF-STORE-CURSOR         PIC  X(01)    VALUE 'N'.     02470000
024800         88  EOF-STORE-CURSOR                      VALUE 'Y'.     02480000
024900         88  NOT-EOF-STORE-CURSOR                  VALUE 'N'.     02490000
025000     05  PS-ITEMS-FOUND-FOR-DEPT     PIC  X(01)    VALUE 'N'.     02500000
025100         88  ITEMS-FOUND-FOR-DEPT                  VALUE 'Y'.     02510000
025200         88  ITEMS-NOT-FOUND-FOR-DEPT              VALUE 'N'.     02520000
025300     05  PS-ITEMS-FOUND-FOR-BG       PIC  X(01)    VALUE 'N'.     02530000
025400         88  ITEMS-FOUND-FOR-BG                    VALUE 'Y'.     02540000
025500         88  ITEMS-NOT-FOUND-FOR-BG                VALUE 'N'.     02550000
025600     05  PS-END-OF-ITEM-STORES       PIC  X(01)    VALUE 'N'.     02560000
025700         88  END-OF-ITEM-STORES                    VALUE 'Y'.     02570000
025800         88  NOT-END-OF-ITEM-STORES                VALUE 'N'.     02580000
025900     05  PS-OH-FILE-EMPTY            PIC  X(01)    VALUE 'N'.     02590000
026000         88  OH-FILE-EMPTY                         VALUE 'Y'.     02600000
026100         88  OH-FILE-NOT-EMPTY                     VALUE 'N'.     02610000
026200     05  PS-STYLE-COLOR-CHANGE       PIC  X(01)    VALUE 'N'.     02620000
026300         88  STYLE-COLOR-CHANGE                    VALUE 'Y'.     02630000
026400     05  PS-ITEM-NBR-CHANGE          PIC  X(01)    VALUE 'N'.     02640000
026500         88  ITEM-NBR-CHANGE                       VALUE 'Y'.     02650000
026600     05  PS-PRINT-DETAIL-FOR-DEPT    PIC  X(01)    VALUE 'N'.     02660000
026700         88  PRINT-DETAIL-FOR-DEPT                 VALUE 'Y'.     02670000
026800         88  NO-DETAIL-FOR-DEPT                    VALUE 'N'.     02680000
026900*                                                                 02690000
027000 01  ABEND-CODE                       PIC S9(04)     VALUE +0     02700000
027100                                                     COMP SYNC.   02710000
027200     88  ABEND-4013                                  VALUE +4013. 02720000
027300*                                                                 02730000
027400 01  PC-CONSTANTS.                                                02740000
027500     05  PC-SKU-SVC-LEVEL-LIMIT      PIC 9(03).                   02750000
027600     05  PC-STORE-SVC-LEVEL-LIMIT    PIC 9(03).                   02760000
027700     05  PC-STORE-TABLE-MAX          PIC S9(4)  VALUE +9999       02770021
027800                                                COMP-3.           02780000
027900     05  PC-DEPT-TABLE-MAX           PIC S9(3)  VALUE +200        02790000
028000                                                COMP-3.           02800000
028100     05  PC-ROW-NOT-FOUND            PIC S9(04)    VALUE +100     02810000
028200                                                   COMP SYNC.     02820000
028300     05  PC-NOT-REF-INTEGRAL         PIC S9(04)    VALUE -530     02830000
028400                                                   COMP SYNC.     02840000
028500     05  PC-MAX-RETRIES              PIC S9(03) VALUE 3 COMP-3.   02850000
028600     05  PC-MAX-LINES                PIC S9(3)     VALUE +54      02860000
028700                                                   COMP-3.        02870000
028800     05  PC-1                        PIC S9(03)    VALUE +1       02880000
028900                                                   COMP-3.        02890000
029000     05  PC-2                        PIC S9(03)    VALUE +2       02900000
029100                                                   COMP-3.        02910000
029200     05  PC-3                        PIC S9(03)    VALUE +3       02920000
029300                                                   COMP-3.        02930000
029400     05  PC-5                        PIC S9(03)    VALUE +5       02940000
029500                                                   COMP-3.        02950000
029600     05  PC-7                        PIC S9(03)    VALUE +7       02960000
029700                                                   COMP-3.        02970000
029800     05  PC-100                      PIC S9(03)    VALUE +100     02980000
029900                                                   COMP-3.        02990000
030000     05  PC-N                        PIC  X(01)    VALUE 'N'.     03000000
030100     05  PC-Y                        PIC  X(01)    VALUE 'Y'.     03010000
030200     05  PC-MRKRP105                 PIC  X(08)    VALUE          03020000
030300                                                   'MRKRP105'.    03030000
030400     05  PC-ASTERISK                 PIC  X(01)    VALUE '*'.     03040000
030500     05  PC-STYLE-DESC               PIC  X(18)    VALUE          03050000
030600         '# OF STYLE/COLORS:'.                                    03060000
030700 EJECT                                                            03070000
030800 01  PV-ACCUMULATOR-FIELDS.                                       03080000
030900     05  PV-TOT-STORES-FOR-ITEM      PIC S9(05)    VALUE ZERO     03090000
031000                                                   COMP-3.        03100000
031100     05  PV-TOT-ITEMS-FOR-STORE      PIC S9(05)    VALUE ZERO     03110000
031200                                                   COMP-3.        03120000
031300     05  PV-TOTAL-STORES             PIC S9(05)    VALUE ZERO     03130000
031400                                                   COMP-3.        03140000
031500     05  PV-TOTAL-SKUS               PIC S9(05)    VALUE ZERO     03150000
031600                                                   COMP-3.        03160000
031700     05  PV-NBR-OH-LT-MIN            PIC S9(05)    VALUE ZERO     03170000
031800                                                   COMP-3.        03180000
031900     05  PV-NBR-INSTOCK              PIC S9(05)    VALUE ZERO     03190000
032000                                                   COMP-3.        03200000
032100     05  PV-INSTOCKS-STYLE           PIC S9(07)    VALUE ZERO     03210000
032200                                                   COMP-3.        03220000
032300     05  PV-SKU-STORE-COMBOS         PIC S9(07)    VALUE ZERO     03230000
032400                                                   COMP-3.        03240000
032500     05  PV-SKUS-BELOW               PIC S9(05)    VALUE ZERO     03250000
032600                                                   COMP-3.        03260000
032700     05  PV-STORES-BELOW             PIC S9(05)    VALUE ZERO     03270000
032800                                                   COMP-3.        03280000
032900     05  PV-SC-INSTOCKS              PIC S9(07)    VALUE ZERO     03290000
033000                                                   COMP-3.        03300000
033100     05  PV-SC-COMBOS                PIC S9(07)    VALUE ZERO     03310000
033200                                                   COMP-3.        03320000
033300     05  PV-SC-TOTAL-SKUS            PIC S9(07)    VALUE ZERO     03330000
033400                                                   COMP-3.        03340000
033500     05  PV-SC-SKUS-BELOW            PIC S9(07)    VALUE ZERO     03350000
033600                                                   COMP-3.        03360000
033700     05  PV-SC-STORES-BELOW          PIC S9(07)    VALUE ZERO     03370000
033800                                                   COMP-3.        03380000
033900     05  PV-MC-INSTOCKS              PIC S9(07)    VALUE ZERO     03390000
034000                                                   COMP-3.        03400000
034100     05  PV-MC-COMBOS                PIC S9(07)    VALUE ZERO     03410000
034200                                                   COMP-3.        03420000
034300     05  PV-MC-TOTAL-SKUS            PIC S9(07)    VALUE ZERO     03430000
034400                                                   COMP-3.        03440000
034500     05  PV-MC-SKUS-BELOW            PIC S9(07)    VALUE ZERO     03450000
034600                                                   COMP-3.        03460000
034700     05  PV-MC-STORES-BELOW          PIC S9(07)    VALUE ZERO     03470000
034800                                                   COMP-3.        03480000
034900     05  PV-DP-INSTOCKS              PIC S9(07)    VALUE ZERO     03490000
035000                                                   COMP-3.        03500000
035100     05  PV-DP-COMBOS                PIC S9(07)    VALUE ZERO     03510000
035200                                                   COMP-3.        03520000
035300     05  PV-DP-TOTAL-SKUS            PIC S9(07)    VALUE ZERO     03530000
035400                                                   COMP-3.        03540000
035500     05  PV-DP-SKUS-BELOW            PIC S9(07)    VALUE ZERO     03550000
035600                                                   COMP-3.        03560000
035700     05  PV-DP-STORES-BELOW          PIC S9(07)    VALUE ZERO     03570000
035800                                                   COMP-3.        03580000
035900     05  PV-BG-INSTOCKS              PIC S9(07)    VALUE ZERO     03590000
036000                                                   COMP-3.        03600000
036100     05  PV-BG-COMBOS                PIC S9(07)    VALUE ZERO     03610000
036200                                                   COMP-3.        03620000
036300     05  PV-BG-TOTAL-SKUS            PIC S9(07)    VALUE ZERO     03630000
036400                                                   COMP-3.        03640000
036500     05  PV-BG-SKUS-BELOW            PIC S9(07)    VALUE ZERO     03650000
036600                                                   COMP-3.        03660000
036700     05  PV-BG-STORES-BELOW          PIC S9(07)    VALUE ZERO     03670000
036800                                                   COMP-3.        03680000
036900     05  PV-NBR-OF-STYLES            PIC S9(05)    VALUE ZERO     03690000
037000                                                   COMP-3.        03700000
037100*                                                                 03710000
037200 01  PV-MISC-FIELDS.                                              03720000
037300     05  PV-DP-SUB                   PIC S9(04)  VALUE +0         03730000
037400                                                 COMP SYNC.       03740000
037500     05  PV-SQL-SUB                  PIC S9(04)  VALUE +0         03750000
037600                                                 COMP SYNC.       03760000
037700     05  PV-ST-SUB                   PIC S9(05)  COMP SYNC.       03770021
038100     05  PV-MDSEBG-NBR               PIC X(03)     VALUE SPACES.  03810000
038200     05  PV-DEPT-NBR                 PIC X(03)     VALUE SPACES.  03820000
038210     05  PV-HOLD-DEPT                PIC S9(04) COMP-3.           03821000
038300     05  PV-CLASS                    PIC X(02).                   03830000
038400     05  FILLER REDEFINES PV-CLASS.                               03840000
038500         10  PV-MAJOR-CLASS          PIC X.                       03850000
038600         10  PV-SUB-CLASS            PIC X.                       03860000
038610     05  PV-HOLD-CLASS               PIC S9(04) COMP-3.           03861000
038700     05  PV-TSKXREF-CLASS.                                        03870000
038800         10  PV-TSKXREF-MAJOR-CLASS  PIC X.                       03880000
038900         10  PV-TSKXREF-SUB-CLASS    PIC X.                       03890000
039000     05  PV-ITEM-NBR                 PIC S9(15)V   VALUE ZERO     03900000
039100                                                   COMP-3.        03910000
039200     05  PV-VENDOR-STYLE             PIC X(20).                   03920000
039210     05  PV-HOLD-VENDOR-STYLE        PIC X(20).                   03921000
039300     05  PV-COLOR-DESC               PIC X(20).                   03930000
039310     05  PV-HOLD-COLOR-DESC          PIC X(20).                   03931000
039400     05  PV-ITEM-DESC                PIC X(25).                   03940000
039500     05  PV-FIRST-STORE-COUNT        PIC S9(05)    VALUE ZERO     03950000
039600                                                   COMP-3.        03960000
039700     05  PV-HOLD-SVC-LVL             PIC S9(04)V9(03) VALUE ZERO  03970000
039800                                                   COMP-3.        03980000
039900     05  PV-SVC-LEVEL-PCT            PIC S9(03)    VALUE ZERO     03990000
040000                                                   COMP-3.        04000000
040100     05  PV-AVG-OSTRAT               PIC S9(04)V9  VALUE ZERO     04010000
040200                                                   COMP-3.        04020000
040300     05  PV-TOTAL-CSTOCK             PIC S9(13)    VALUE ZERO     04030000
040400                                                   COMP-3.        04040000
040500     05  PV-NULL-IND-OSTRAT          PIC S9(04)    COMP.          04050000
040600     05  PV-NULL-IND-CSTOCK          PIC S9(04)    COMP.          04060000
040700     05  PV-NULL-IND-ONHAND          PIC S9(04)    COMP.          04070000
040800     05  PV-NULL-IND-ONORDER         PIC S9(04)    COMP.          04080000
040900     05  PV-AVG-ONHAND               PIC S9(06)V9  VALUE ZERO     04090000
041000                                                   COMP-3.        04100000
041100     05  PV-SUM-ONORDER              PIC S9(09)    VALUE ZERO     04110000
041200                                                   COMP-3.        04120000
041300     05  PV-AVG-ONORDER              PIC S9(09)V9  VALUE ZERO     04130000
041400                                                   COMP-3.        04140000
041500     05  PV-HOLD-AVG-OO              PIC S9(09)V9(04) VALUE ZERO  04150000
041600                                                   COMP-3.        04160000
041700     05  PV-LEAD-TIME                PIC S9(03)    VALUE ZERO     04170000
041800                                                   COMP-3.        04180000
041900     05  PV-PAGE-CNT                 PIC S9(5)     VALUE +0       04190000
042000                                                   COMP-3.        04200000
042100     05  PV-LINE-CNT                 PIC S9(3)     VALUE +0       04210000
042200                                                   COMP-3.        04220000
042300     05  PV-PARAGRAPH-NAME           PIC X(30)     VALUE SPACES.  04230000
042400     05  PV-DB2-OPER-ATTEMPTED       PIC X(30)     VALUE SPACES.  04240000
042500     05  PV-VSAM-STATUS              PIC X(02)     VALUE SPACE.   04250000
042600         88  PV-VSAM-SUCCESSFUL                    VALUE '00'.    04260000
042700         88  PV-VSAM-NOT-FOUND                     VALUE '23'.    04270000
042800         88  PV-VSAM-EMPTY                         VALUE '35'.    04280000
042900     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     04290000
043000                                                   COMP SYNC.     04300000
043100     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  04310000
043200*                                                                 04320000
043300 01  CD-CPU-DATE                      PIC 9(08).                  04330000
043400 01  FILLER REDEFINES CD-CPU-DATE.                                04340000
043500     05  CD-CPU-YEAR                  PIC 9(04).                  04350000
043600     05  FILLER REDEFINES CD-CPU-YEAR.                            04360000
043700         10  CD-CPU-CC                PIC 9(02).                  04370000
043800         10  CD-CPU-YR                PIC 9(02).                  04380000
043900     05  CD-CPU-MO                    PIC 9(02).                  04390000
044000     05  CD-CPU-DY                    PIC 9(02).                  04400000
044100                                                                  04410000
044200 01  CT-CPU-TIME.                                                 04420000
044300     05  CT-CPU-HR                    PIC 9(02)     VALUE ZEROS.  04430000
044400     05  CT-CPU-MIN                   PIC 9(02)     VALUE ZEROS.  04440000
044500     05  CT-CPU-SEC                   PIC 9(02)     VALUE ZEROS.  04450000
044600     05  CT-CPU-HSEC                  PIC 9(02)     VALUE ZEROS.  04460000
044700 EJECT                                                            04470000
044710******************************************************************04471000
044720*    NI SKU WORK AREA FIELDS                                      04472000
044730******************************************************************04473000
044740     COPY ISWS006.                                                04474000
044750******************************************************************04475000
044800*                                                                 04480000
044900***********************                                           04490000
045000*  DB2 TABLE LAYOUTS  *                                           04500000
045100***********************                                           04510000
045200*                                                                 04520000
045210     EXEC SQL                                                     04521000
045220         INCLUDE TSKXREF                                          04522000
045230     END-EXEC.                                                    04523000
045240*                                                                 04524000
045300     EXEC SQL                                                     04530000
045400         INCLUDE TMDSEAR                                          04540000
045500     END-EXEC.                                                    04550000
045600*                                                                 04560000
045700     EXEC SQL                                                     04570000
045800         INCLUDE TMDSEDP                                          04580000
045900     END-EXEC.                                                    04590000
046000*                                                                 04600000
046100     EXEC SQL                                                     04610000
046200         INCLUDE TMDSEBG                                          04620000
046300     END-EXEC.                                                    04630000
046400*                                                                 04640000
046500     EXEC SQL                                                     04650000
046600         INCLUDE TRSPBAR                                          04660000
046700     END-EXEC.                                                    04670000
046800*                                                                 04680000
046900     EXEC SQL                                                     04690000
047000         INCLUDE TSK                                              04700000
047100     END-EXEC.                                                    04710000
047200*                                                                 04720000
047300     EXEC SQL                                                     04730000
047400         INCLUDE TSKST                                            04740000
047500     END-EXEC.                                                    04750000
047600*                                                                 04760000
047700     EXEC SQL                                                     04770000
047800         INCLUDE XMT00001                                         04780021
047900     END-EXEC.                                                    04790000
048000*                                                                 04800000
048100     EXEC SQL                                                     04810000
048200         INCLUDE TMRITST                                          04820000
048300     END-EXEC.                                                    04830000
048400*                                                                 04840000
048500     EXEC SQL                                                     04850000
048600         INCLUDE TMRITEM                                          04860000
048700     END-EXEC.                                                    04870000
048800*                                                                 04880000
048900     EXEC SQL                                                     04890000
049000         INCLUDE TSKSTOO                                          04900000
049100     END-EXEC.                                                    04910000
049200 EJECT                                                            04920000
049300*                                                                 04930000
049400* DB2 COMMUNICATION AREA                                          04940000
049500*                                                                 04950000
049600     EXEC SQL                                                     04960000
049700         INCLUDE SQLCA                                            04970000
049800     END-EXEC.                                                    04980000
049900*                                                                 04990000
050000* DB2 COMMUNICATION AREA2                                         05000000
050100*                                                                 05010000
050200     COPY SQLCA2.                                                 05020000
050300 EJECT                                                            05030000
050400*                                                                 05040000
050500* CURSOR FOR BUSINESS GROUP, DEPARTMENT SELECTION                 05050000
050600*                                                                 05060000
050700     EXEC SQL                                                     05070000
050800       DECLARE BG_DEPT_CSR CURSOR FOR                             05080000
050900       SELECT                                                     05090000
051000             C.MDSEBG_NBR,                                        05100000
051100             C.MDSEBG_DESC,                                       05110000
051200             A.DEPT_NBR,                                          05120000
051300             A.BYR_NBR,                                           05130000
051400             A.MDSEAR_DKEY                                        05140000
051500        FROM TMDSEAR A,                                           05150000
051600             TMDSEDP B,                                           05160000
051700             TMDSEBG C                                            05170026
051800       WHERE A.MDSELV_CDE  = 'DPT'                                05180000
051900         AND A.OPERCO_NBR  = '03'                                 05190000
052000         AND CURRENT DATE BETWEEN A.STRT_DTE AND A.END_DTE        05200000
052100         AND A.MDSEAR_DKEY = B.MDSEAR_DKEY                        05210000
052200         AND B.MDSEBG_NBR  = C.MDSEBG_NBR                         05220000
052300       ORDER BY C.MDSEBG_NBR,                                     05230000
052400                A.DEPT_NBR                                        05240000
052500       FOR FETCH ONLY                                             05250000
052600     END-EXEC.                                                    05260000
052700*                                                                 05270000
052800* CURSOR FOR CLASS, STYLE, COLOR, ITEM SELECTION                  05280000
052900*                                                                 05290000
053000     EXEC SQL                                                     05300000
053100       DECLARE ITEM_CSR CURSOR FOR                                05310000
053200       SELECT E.DEPT,                                             05320000
053300              E.SUBCLASS,                                         05330000
053400              A.LONG_VENDOR_STYLE,                                05340000
053500              A.LONG_COLOR_DESC,                                  05350000
053600              A.ITEM_NMBR,                                        05360000
053700              A.SKU_DESC,                                         05370000
053800              B.LT_QTY                                            05380000
053900         FROM TSK     A,                                          05390000
054000              TMRITEM B,                                          05400000
054100              TMRITST C,                                          05410000
054200              XMT_LOC D,                                          05420021
054210              TSKXREF E                                           05421000
054300        WHERE E.DEPT        = :PV-HOLD-DEPT                       05430021
054400          AND A.ITEM_NMBR   = B.ITEM_NBR                          05440021
054410          AND E.ITM_NBR     = B.ITEM_NBR                          05441021
054500          AND A.ITEM_NMBR   = C.ITEM_NBR                          05450021
054600          AND C.STR_NBR     = D.LOC_NBR                           05460021
054700          AND C.FT_CDE      = 'U'                                 05470021
054800          AND D.E_BUS_IND   = 'Y'                                 05480021
054900          AND D.LOC_TYP_CDE = 'DS'                                05490022
055000        GROUP BY E.DEPT,                                          05500000
055100                 E.SUBCLASS,                                      05510000
055200                 A.LONG_VENDOR_STYLE,                             05520000
055300                 A.LONG_COLOR_DESC,                               05530000
055400                 A.ITEM_NMBR,                                     05540000
055500                 A.SKU_DESC,                                      05550000
055600                 B.LT_QTY                                         05560000
055700        ORDER BY E.DEPT,                                          05570000
055800                 E.SUBCLASS,                                      05580000
055900                 A.LONG_VENDOR_STYLE,                             05590000
056000                 A.LONG_COLOR_DESC                                05600000
056100        FOR FETCH ONLY                                            05610000
056200     END-EXEC.                                                    05620000
056300*                                                                 05630000
056400* CURSOR FOR STORE SELECTION                                      05640000
056500*                                                                 05650000
056600     EXEC SQL                                                     05660000
056700       DECLARE STORE_CSR CURSOR FOR                               05670000
056800       SELECT LOC_NBR                                             05680021
056900         FROM XMT_LOC                                             05690021
057000        WHERE E_BUS_IND   = 'Y'                                   05700021
057100          AND LOC_TYP_CDE = 'DS'                                  05710021
057200        FOR FETCH ONLY                                            05720000
057300     END-EXEC.                                                    05730000
057400*                                                                 05740000
057500*---------------------------------------------------------------* 05750000
057600*   ERROR MESSAGE AREA FOR DB2                                    05760000
057700*---------------------------------------------------------------* 05770000
057800     COPY DPWS004.                                                05780000
057900*                                                                 05790000
058000 EJECT                                                            05800000
058100*                                                                 05810000
058200**************************************************************    05820000
058300*                                                                 05830000
058400*  TABLE FOR HOLDING DEPARTMENTS THAT WILL HAVE NO DETAIL         05840000
058500*  LINES ON REPORT (SUBCLASS WILL BE LOWEST LEVEL).               05850000
058600*                                                                 05860000
058700**************************************************************    05870000
058800*                                                                 05880000
058900 01  DP-DEPT-TABLE.                                               05890000
059000     05  DP-DEPT-ENTRIES OCCURS 200 TIMES                         05900000
059100                         INDEXED BY DP-INDEX.                     05910000
059200         10  DP-DEPT-NBR              PIC X(03).                  05920000
059300*                                                                 05930000
059400***************************************************************   05940000
059500*                                                                 05950000
059600*  TABLE FOR STORING NUMBER OF ITEMS THAT HAD ONHAND < MIN FOR    05960000
059700*  EACH STORE.  ACCESSED BY USING STORE NUMBER AS SUBSCRIPT.      05970000
059800*  VALID STORES ARE IDENTIFIED BY A 'Y' IN THE VALID-STORE-FLAG   05980000
059900*  FIELD.                                                         05990000
060000*                                                                 06000000
060100***************************************************************   06010000
060200*                                                                 06020000
060300 01  ST-STORE-TABLE.                                              06030000
060400     05  ST-STORE-ENTRIES OCCURS 9999 TIMES.                      06040021
060500         10  ST-VALID-STORE-FLAG      PIC X(01).                  06050000
060600         10  ST-OH-LT-MIN-ITEMS       PIC S9(05)  COMP-3.         06060000
060700*                                                                 06070000
060800 EJECT                                                            06080000
060900*                                                                 06090000
061000 LINKAGE SECTION.                                                 06100000
061100***************************************************************** 06110000
061200*PROCEDURE DIVISION.                                              06120000
061300***************************************************************** 06130000
061400 PROCEDURE DIVISION.                                              06140000
061500*                                                                 06150000
061600 A100-MAINLINE-PROCESSING.                                        06160000
061700*                                                                 06170000
061800     PERFORM B100-INITIALIZATION.                                 06180000
061900                                                                  06190000
062000     PERFORM B200-PROCESS-BG-DEPT-CURSOR                          06200000
062100             UNTIL EOF-BG-DEPT-CURSOR.                            06210000
062200*                                                                 06220000
062300     PERFORM B300-END-ROUTINE.                                    06230000
062400                                                                  06240000
062500     GOBACK.                                                      06250000
062600*                                                                 06260000
062700 EJECT                                                            06270000
062800***************************************************************** 06280000
062900*                                                                 06290000
063000*  LOAD STORE NUMBERS INTO STORE TABLE; READ CONTROL CARDS AND    06300000
063100*  PUT DEPARTMENT NUMBERS INTO TABLE                              06310000
063200*                                                                 06320000
063300***************************************************************** 06330000
063400 B100-INITIALIZATION.                                             06340000
063500*                                                                 06350000
063600     ACCEPT CT-CPU-TIME FROM TIME.                                06360000
063700     ACCEPT CD-CPU-DATE FROM DATE.                                06370000
063800                                                                  06380000
063900     MOVE CT-CPU-HR     TO DP132-RUN-HOUR.                        06390000
064000     MOVE CT-CPU-MIN    TO DP132-RUN-MINUTE.                      06400000
064100     MOVE CD-CPU-MO     TO DP132-RUN-MONTH.                       06410000
064200     MOVE CD-CPU-DY     TO DP132-RUN-DAY.                         06420000
064300     IF CD-CPU-YR > 80                                            06430000
064400        MOVE 19 TO CD-CPU-CC                                      06440000
064500     ELSE                                                         06450000
064600        MOVE 20 TO CD-CPU-CC.                                     06460000
064700     MOVE CD-CPU-YEAR   TO DP132-RUN-YEAR.                        06470000
064800                                                                  06480000
064900     MOVE 1           TO DP132-REPORT-NUMBER                      06490000
065000                         DP132-PAGE-NUMBER.                       06500000
065100     MOVE PC-MRKRP105 TO DP132-PROGRAM-NAME.                      06510000
065200*                                                                 06520000
065300     INITIALIZE DP-DEPT-TABLE                                     06530000
065400                ST-STORE-TABLE.                                   06540000
065500*                                                                 06550000
065600     SET NOT-EOF-STORE-CURSOR TO TRUE.                            06560000
065700     PERFORM X300-OPEN-STORE-CURSOR.                              06570000
065800*                                                                 06580000
065900     PERFORM C500-LOAD-STORE-TABLE                                06590000
066000         UNTIL EOF-STORE-CURSOR.                                  06600000
066100*                                                                 06610000
066200     PERFORM Y300-CLOSE-STORE-CURSOR.                             06620000
066300*                                                                 06630000
066400     PERFORM X700-OPEN-FILES.                                     06640000
066500*                                                                 06650000
066600     PERFORM Z100-READ-CONTROL-FILE                               06660000
066700         VARYING PV-DP-SUB FROM 1 BY 1                            06670000
066800         UNTIL EOF-CONTROL-FILE OR                                06680000
066900               (PV-DP-SUB > PC-DEPT-TABLE-MAX).                   06690000
067000*                                                                 06700000
067100     PERFORM X100-OPEN-BG-DEPT-CURSOR.                            06710000
067200*                                                                 06720000
067300***************************************************************** 06730000
067400*                                                                 06740000
067500*  FETCH BUSINESS GROUP/DEPT. CURSOR; CHECK FOR DEPT. BREAK AND   06750000
067600*  BUSINESS GROUP BREAK; PROCESS ALL ITEMS FOR THE DEPT.          06760000
067700*                                                                 06770000
067800***************************************************************** 06780000
067900 B200-PROCESS-BG-DEPT-CURSOR.                                     06790000
068000     PERFORM C100-FETCH-BG-DEPT-CSR                               06800000
068100*                                                                 06810000
068200     IF EOF-BG-DEPT-CURSOR                                        06820000
068300        PERFORM Y100-CLOSE-BG-DEPT-CURSOR                         06830000
068400        PERFORM C200-DEPT-BREAK                                   06840000
068500        PERFORM C300-BUSINESS-GROUP-BREAK                         06850000
068600     ELSE                                                         06860000
068700        PERFORM C200-DEPT-BREAK                                   06870000
068800                                                                  06880000
068900        IF MDSEBG-MDSEBG-NBR NOT = PV-MDSEBG-NBR                  06890027
069000           PERFORM C300-BUSINESS-GROUP-BREAK                      06900000
069100        END-IF                                                    06910000
069200                                                                  06920000
069300        MOVE MDSEAR-DEPT-NBR TO PV-DEPT-NBR                       06930000
069310                                NI-DEPT-X-3                       06931000
069320        MOVE NI-DEPT-9-3     TO PV-HOLD-DEPT                      06932000
069400                                                                  06940000
069500        SET NOT-EOF-ITEM-CURSOR TO TRUE                           06950000
069600        PERFORM X200-OPEN-ITEM-CURSOR                             06960000
069700                                                                  06970000
069800        PERFORM C400-PROCESS-ITEM-CURSOR                          06980000
069900            UNTIL EOF-ITEM-CURSOR                                 06990000
070000     END-IF.                                                      07000000
070100*                                                                 07010000
070200*                                                                 07020000
070300***************************************************************** 07030000
070400 B300-END-ROUTINE.                                                07040000
070500*                                                                 07050000
070600     WRITE PRINT-LINE FROM END-OF-REPORT-LINE                     07060000
070700         AFTER ADVANCING PC-2.                                    07070000
070800*                                                                 07080000
070900     PERFORM Y700-CLOSE-FILES.                                    07090000
071000*                                                                 07100000
071100*                                                                 07110000
071200***************************************************************** 07120000
071300 C100-FETCH-BG-DEPT-CSR.                                          07130000
071400     MOVE 'C100-FETCH-BG-DEPT-CSR'  TO PV-PARAGRAPH-NAME.         07140000
071500     MOVE 'BG CURSOR FETCH '        TO PV-DB2-OPER-ATTEMPTED.     07150000
071600     PERFORM                                                      07160000
071700         WITH TEST AFTER                                          07170000
071800         VARYING PV-SQL-SUB                                       07180000
071900         FROM 1 BY 1                                              07190000
072000         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        07200000
072100            OR SQLCODE = ZERO                                     07210000
072200            OR SQLCODE = +100                                     07220000
072300                                                                  07230000
072400         EXEC SQL                                                 07240000
072500             FETCH BG_DEPT_CSR                                    07250000
072600              INTO :MDSEBG-MDSEBG-NBR,                            07260027
072700                   :MDSEBG-MDSEBG-DESC,                           07270027
072800                   :MDSEAR-DEPT-NBR,                              07280000
072900                   :MDSEAR-BYR-NBR,                               07290000
073000                   :MDSEAR-DKEY                                   07300000
073100         END-EXEC                                                 07310000
073200         EVALUATE TRUE                                            07320000
073300             WHEN SQLCODE = ZERO                                  07330000
073400             WHEN SQLCODE = -904                                  07340000
073500             WHEN SQLCODE = -913                                  07350000
073600                 CONTINUE                                         07360000
073700             WHEN SQLCODE = +100                                  07370000
073800                 SET EOF-BG-DEPT-CURSOR TO TRUE                   07380000
073900             WHEN SQLWARN0 NOT = SPACES                           07390000
074000             WHEN SQLCODE  NOT = ZERO                             07400000
074100                  PERFORM Z999-SQL-ABEND                          07410000
074200         END-EVALUATE                                             07420000
074300     END-PERFORM.                                                 07430000
074400*                                                                 07440000
074500     IF PV-SQL-SUB > PC-MAX-RETRIES                               07450000
074600        MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'              07460000
074700                                   TO PV-DB2-OPER-ATTEMPTED       07470000
074800        PERFORM Z999-SQL-ABEND                                    07480000
074900     END-IF.                                                      07490000
075000*                                                                 07500000
075100 EJECT                                                            07510000
075200***************************************************************** 07520000
075300*                                                                 07530000
075400*  IF THERE WERE INFOREM E-COMMERCE ITEMS FOUND FOR THIS          07540000
075500*  DEPARTMENT, PRINT DEPT. TOTALS                                 07550000
075600*                                                                 07560000
075700***************************************************************** 07570000
075800 C200-DEPT-BREAK.                                                 07580000
075900*                                                                 07590000
076000     IF ITEMS-FOUND-FOR-DEPT                                      07600000
076100        SET ITEMS-FOUND-FOR-BG                                    07610000
076200            ITEMS-NOT-FOUND-FOR-DEPT TO TRUE                      07620000
076300                                                                  07630000
076400        IF PV-DP-COMBOS > ZERO                                    07640000
076500           COMPUTE PV-HOLD-SVC-LVL =                              07650000
076600                    (PV-DP-INSTOCKS / PV-DP-COMBOS) * 100         07660000
076700           COMPUTE PV-SVC-LEVEL-PCT ROUNDED = PV-HOLD-SVC-LVL     07670000
076800        ELSE                                                      07680000
076900           MOVE ZERO TO PV-SVC-LEVEL-PCT                          07690000
077000        END-IF                                                    07700000
077100*                                                                 07710000
077200        MOVE SPACES             TO TL2-CLASS                      07720000
077300        MOVE 'DEPARTMENT TOTAL' TO TL2-TOTAL-DESC                 07730000
077400        MOVE PV-DP-TOTAL-SKUS   TO TL2-TOT-SKUS                   07740000
077500        MOVE PV-SVC-LEVEL-PCT   TO TL2-SVC-LEVEL                  07750000
077600        MOVE PV-DP-SKUS-BELOW   TO TL2-SKUS-BELOW                 07760000
077700        MOVE PV-DP-STORES-BELOW TO TL2-STORES-BELOW               07770000
077800        PERFORM T300-PRINT-DEPT-TOTALS                            07780000
077900*                                                                 07790000
078000        ADD PV-DP-INSTOCKS     TO PV-BG-INSTOCKS                  07800000
078100        ADD PV-DP-COMBOS       TO PV-BG-COMBOS                    07810000
078200        ADD PV-DP-TOTAL-SKUS   TO PV-BG-TOTAL-SKUS                07820000
078300        ADD PV-DP-SKUS-BELOW   TO PV-BG-SKUS-BELOW                07830000
078400        ADD PV-DP-STORES-BELOW TO PV-BG-STORES-BELOW              07840000
078500*                                                                 07850000
078600        MOVE ZERO TO PV-DP-INSTOCKS                               07860000
078700                     PV-DP-COMBOS                                 07870000
078800                     PV-DP-TOTAL-SKUS                             07880000
078900                     PV-DP-SKUS-BELOW                             07890000
079000                     PV-DP-STORES-BELOW                           07900000
079100     END-IF.                                                      07910000
079200*                                                                 07920000
079300***************************************************************** 07930000
079400*                                                                 07940000
079500*  IF THERE WERE INFOREM E-COMMERCE ITEMS FOUND FOR THIS BUSINESS 07950000
079600*  GROUP, PRINT BUSINESS GROUP TOTALS                             07960000
079700*                                                                 07970000
079800***************************************************************** 07980000
079900 C300-BUSINESS-GROUP-BREAK.                                       07990000
080000*                                                                 08000000
080100     IF ITEMS-FOUND-FOR-BG                                        08010000
080200        SET ITEMS-NOT-FOUND-FOR-BG TO TRUE                        08020000
080300                                                                  08030000
080400        IF PV-BG-COMBOS > ZERO                                    08040000
080500           COMPUTE PV-HOLD-SVC-LVL =                              08050000
080600                    (PV-BG-INSTOCKS / PV-BG-COMBOS) * 100         08060000
080700           COMPUTE PV-SVC-LEVEL-PCT ROUNDED = PV-HOLD-SVC-LVL     08070000
080800        ELSE                                                      08080000
080900           MOVE ZERO TO PV-SVC-LEVEL-PCT                          08090000
081000        END-IF                                                    08100000
081100*                                                                 08110000
081200        MOVE SPACES                 TO TL2-CLASS                  08120000
081300        MOVE 'BUSINESS GROUP TOTAL' TO TL2-TOTAL-DESC             08130000
081400        MOVE PV-BG-TOTAL-SKUS       TO TL2-TOT-SKUS               08140000
081500        MOVE PV-SVC-LEVEL-PCT       TO TL2-SVC-LEVEL              08150000
081600        MOVE PV-BG-SKUS-BELOW       TO TL2-SKUS-BELOW             08160000
081700        MOVE PV-BG-STORES-BELOW     TO TL2-STORES-BELOW           08170000
081800        PERFORM T400-PRINT-BG-TOTALS                              08180000
081900*                                                                 08190000
082000        MOVE ZERO TO PV-BG-INSTOCKS                               08200000
082100                     PV-BG-COMBOS                                 08210000
082200                     PV-BG-TOTAL-SKUS                             08220000
082300                     PV-BG-SKUS-BELOW                             08230000
082400                     PV-BG-STORES-BELOW                           08240000
082500     END-IF.                                                      08250000
082600*                                                                 08260000
082700     MOVE MDSEBG-MDSEBG-NBR  TO PV-MDSEBG-NBR                     08270027
082800                         HL3-BG-NUMBER.                           08280000
082900     MOVE MDSEBG-MDSEBG-DESC TO HL3-BG-DESC.                      08290027
083000*                                                                 08300000
083100***************************************************************** 08310000
083200*                                                                 08320000
083300*  FETCH ITEM CURSOR; IF PV-TOTAL-SKUS = 0, IT IS THE FIRST ITEM  08330000
083400*  OF A NEW DEPT. (PERFORM "NEW DEPT." ROUTINES)                  08340000
083500*                                                                 08350000
083600*  IF PV-TOTAL-SKUS > 0, CHECK FOR A STYLE/COLOR BREAK, THEN      08360000
083700*  CHECK FOR SUBCLASS & MAJOR CLASS BREAKS.                       08370000
083800*                                                                 08380000
083900*  IF PV-TOTAL-SKUS = 1, IT IS THE FIRST ITEM OF A STYLE/COLOR.   08390000
084000*  READ THE OH-LT-MIN FILE FOR EACH E-STORE ASSOCIATED WITH THE   08400000
084100*  CURRENT ITEM, THEN CALCULATE THE ITEM'S SERVICE LEVEL.         08410000
084200*  IF BELOW THE SET LIMIT, INCREMENT COUNTER.                     08420000
084300*                                                                 08430000
084400*  FOR FIRST ITEM IN STYLE/COLOR, SAVE NUMBER OF STORES, THEN     08440000
084500*  COMPARE IT AGAINST SUBSEQUENT ITEMS;  IF DIFFERENT, MOVE * TO  08450000
084600*  REPORT LINE.                                                   08460000
084700*                                                                 08470000
084800***************************************************************** 08480000
084900 C400-PROCESS-ITEM-CURSOR.                                        08490000
085000*                                                                 08500000
085100     PERFORM D100-FETCH-ITEM-CSR                                  08510000
085200*                                                                 08520000
085300     IF EOF-ITEM-CURSOR                                           08530000
085400        PERFORM Y200-CLOSE-ITEM-CURSOR                            08540000
085500        IF ITEMS-FOUND-FOR-DEPT                                   08550000
085600           PERFORM D200-STYLE-COLOR-BREAK                         08560000
085700           PERFORM D300-SUBCLASS-BREAK                            08570000
085800           PERFORM D400-MAJOR-CLASS-BREAK                         08580000
085900        END-IF                                                    08590000
086000     ELSE                                                         08600000
086100        IF PV-TOTAL-SKUS = ZERO                                   08610000
086200           SET ITEMS-FOUND-FOR-DEPT TO TRUE                       08620000
086300           MOVE PV-DEPT-NBR    TO NI-DEPT-X-3                     08630000
086310           MOVE NI-DEPT-9-3    TO HL3-DEPT                        08631000
086400           MOVE MDSEAR-BYR-NBR TO HL2-BYR-NMBR                    08640000
086500                                                                  08650000
086600           PERFORM D600-CHECK-DEPT-TABLE                          08660000
086700           PERFORM D700-GET-BUYER-NAME                            08670000
086800           PERFORM Z400-PRINT-REPORT-HEADERS                      08680000
086900        ELSE                                                      08690000
087000           IF (TSK-LONG-VENDOR-STYLE NOT = PV-VENDOR-STYLE) OR    08700000
087100              (TSK-LONG-COLOR-DESC   NOT = PV-COLOR-DESC)         08710000
087200              PERFORM D200-STYLE-COLOR-BREAK                      08720000
087300           ELSE                                                   08730000
087310              MOVE SKXREF-SUBCLASS TO NI-SUB-CLASS-9-2            08731000
087400              IF NI-SUB-CLASS-X-2  NOT = PV-CLASS                 08740000
087500                 PERFORM D200-STYLE-COLOR-BREAK                   08750000
087600              END-IF                                              08760000
087700           END-IF                                                 08770000
087800           MOVE SKXREF-SUBCLASS  TO NI-SUB-CLASS-9-2              08780000
087900           MOVE NI-SUB-CLASS-X-2 TO PV-TSKXREF-CLASS              08790000
088000           IF NI-SUB-CLASS-X-2  NOT = PV-CLASS                    08800000
088100              PERFORM D300-SUBCLASS-BREAK                         08810000
088200           END-IF                                                 08820000
088300           IF PV-TSKXREF-MAJOR-CLASS NOT = PV-MAJOR-CLASS         08830000
088400              PERFORM D400-MAJOR-CLASS-BREAK                      08840000
088500           END-IF                                                 08850000
088600        END-IF                                                    08860000
088700*                                                                 08870000
088800        ADD PC-1 TO PV-TOTAL-SKUS                                 08880000
088900        IF PV-TOTAL-SKUS = PC-1                                   08890000
089000           MOVE TSK-LONG-VENDOR-STYLE TO PV-VENDOR-STYLE          08900000
089100           MOVE TSK-LONG-COLOR-DESC   TO PV-COLOR-DESC            08910000
089200           MOVE SKXREF-SUBCLASS       TO NI-SUB-CLASS-9-2         08920000
089210           MOVE NI-SUB-CLASS-X-2      TO PV-CLASS                 08921000
089300           MOVE MRITEM-LT-QTY         TO PV-LEAD-TIME             08930000
089400           MOVE TSK-SKU-DESC          TO PV-ITEM-DESC             08940000
089500        END-IF                                                    08950000
089600*                                                                 08960000
089700        MOVE TSK-ITEM-NMBR       TO PV-ITEM-NBR                   08970000
089800                                                                  08980000
089900        PERFORM D800-GET-STORE-COUNT                              08990000
090000*                                                                 09000000
090100        IF PV-TOT-STORES-FOR-ITEM > ZERO                          09010000
090200           IF OH-FILE-NOT-EMPTY                                   09020000
090300              SET NOT-END-OF-ITEM-STORES TO TRUE                  09030000
090400              MOVE PV-DEPT-NBR           TO MR113-DEPT-NBR        09040000
090500              MOVE PV-CLASS              TO MR113-CLASS-NBR       09050000
090600              MOVE PV-VENDOR-STYLE       TO MR113-VENDOR-STYLE    09060000
090700              MOVE PV-COLOR-DESC         TO MR113-COLOR-DESC      09070000
090800              MOVE PV-ITEM-NBR           TO MR113-ITEM-NBR        09080000
090900              MOVE ZERO                  TO MR113-STORE-NBR       09090000
091000              MOVE MR113-OH-LT-MIN-KEY   TO OH-LT-MIN-KEY         09100000
091100              PERFORM Z500-START-BROWSE-OH-FILE                   09110000
091200                                                                  09120000
091300              PERFORM D500-PROCESS-ITEM-STORES                    09130000
091400                  UNTIL END-OF-ITEM-STORES                        09140000
091500           ELSE                                                   09150000
091600              SET END-OF-ITEM-STORES TO TRUE                      09160000
091700           END-IF                                                 09170000
091800*                                                                 09180000
091900           SUBTRACT PV-NBR-OH-LT-MIN FROM PV-TOT-STORES-FOR-ITEM  09190000
092000              GIVING PV-NBR-INSTOCK                               09200000
092100           COMPUTE PV-HOLD-SVC-LVL =                              09210000
092200                  (PV-NBR-INSTOCK / PV-TOT-STORES-FOR-ITEM) * 100 09220000
092300           COMPUTE PV-SVC-LEVEL-PCT ROUNDED = PV-HOLD-SVC-LVL     09230000
092400        ELSE                                                      09240000
092500           MOVE ZERO TO PV-SVC-LEVEL-PCT                          09250000
092600                        PV-NBR-INSTOCK                            09260000
092700        END-IF                                                    09270000
092800*                                                                 09280000
092900        IF PV-SVC-LEVEL-PCT < PC-SKU-SVC-LEVEL-LIMIT              09290000
093000           ADD PC-1 TO PV-SKUS-BELOW                              09300000
093100        END-IF                                                    09310000
093200*                                                                 09320000
093300        ADD PV-NBR-INSTOCK TO PV-INSTOCKS-STYLE                   09330000
093400*                                                                 09340000
093500        IF PV-FIRST-STORE-COUNT = ZERO                            09350000
093600           MOVE PV-TOT-STORES-FOR-ITEM TO PV-FIRST-STORE-COUNT    09360000
093700        ELSE                                                      09370000
093800           IF PV-TOT-STORES-FOR-ITEM NOT = PV-FIRST-STORE-COUNT   09380000
093900              MOVE PC-ASTERISK TO DL1-ASTERISK                    09390000
094000           END-IF                                                 09400000
094100        END-IF                                                    09410000
094200                                                                  09420000
094300        MOVE ZERO TO PV-NBR-INSTOCK                               09430000
094400                     PV-TOT-STORES-FOR-ITEM                       09440000
094500                     PV-NBR-OH-LT-MIN                             09450000
094600     END-IF.                                                      09460000
094700*                                                                 09470000
094800***************************************************************** 09480000
094900*                                                                 09490000
095000*  LOAD TABLE WITH STORES FROM XMT_LOC                            09500021
095100*                                                                 09510000
095200***************************************************************** 09520000
095300 C500-LOAD-STORE-TABLE.                                           09530000
095400*                                                                 09540000
095500     PERFORM F100-FETCH-STORE-CURSOR.                             09550000
095600                                                                  09560000
095700     IF EOF-STORE-CURSOR                                          09570000
095800        CONTINUE                                                  09580000
095900     ELSE                                                         09590000
096000        MOVE XMT00001-LOC-NBR   TO PV-ST-SUB                      09600021
096200        MOVE PC-Y TO ST-VALID-STORE-FLAG (PV-ST-SUB)              09620000
096300     END-IF.                                                      09630000
096400*                                                                 09640000
096500***************************************************************** 09650000
096600 D100-FETCH-ITEM-CSR.                                             09660000
096700     MOVE 'D100-FETCH-ITEM-CSR' TO PV-PARAGRAPH-NAME.             09670000
096800     MOVE 'ITEM CURSOR FETCH '  TO PV-DB2-OPER-ATTEMPTED.         09680000
096900     PERFORM                                                      09690000
097000         WITH TEST AFTER                                          09700000
097100         VARYING PV-SQL-SUB                                       09710000
097200         FROM 1 BY 1                                              09720000
097300         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        09730000
097400            OR SQLCODE = ZERO                                     09740000
097500            OR SQLCODE = +100                                     09750000
097600                                                                  09760000
097700         EXEC SQL                                                 09770000
097800             FETCH ITEM_CSR                                       09780000
097900              INTO :SKXREF-DEPT,                                  09790000
098000                   :SKXREF-SUBCLASS,                              09800000
098100                   :TSK-LONG-VENDOR-STYLE,                        09810000
098200                   :TSK-LONG-COLOR-DESC,                          09820000
098300                   :TSK-ITEM-NMBR,                                09830000
098400                   :TSK-SKU-DESC,                                 09840000
098500                   :MRITEM-LT-QTY                                 09850000
098600         END-EXEC                                                 09860000
098700         EVALUATE TRUE                                            09870000
098800             WHEN SQLCODE = ZERO                                  09880000
098900             WHEN SQLCODE = -904                                  09890000
099000             WHEN SQLCODE = -913                                  09900000
099100                 CONTINUE                                         09910000
099200             WHEN SQLCODE = +100                                  09920000
099300                 SET EOF-ITEM-CURSOR TO TRUE                      09930000
099400             WHEN SQLWARN0 NOT = SPACES                           09940000
099500             WHEN SQLCODE  NOT = ZERO                             09950000
099600                  PERFORM Z999-SQL-ABEND                          09960000
099700         END-EVALUATE                                             09970000
099800     END-PERFORM.                                                 09980000
099900*                                                                 09990000
100000     IF PV-SQL-SUB > PC-MAX-RETRIES                               10000000
100100        MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'              10010000
100200                                   TO PV-DB2-OPER-ATTEMPTED       10020000
100300        PERFORM Z999-SQL-ABEND                                    10030000
100400     END-IF.                                                      10040000
100500*                                                                 10050000
100600***************************************************************** 10060000
100700*                                                                 10070000
100800*  OBTAIN OSTRAT, CSTOCK, ONORDER, & ONHAND FOR THE STYLE/COLOR.  10080000
100900*  READ THROUGH THE INTERNAL STORE TABLE TO CALCULATE EACH VALID  10090000
101000*  STORE'S SERVICE LEVEL.                                         10100000
101100*  THEN CALC THE SERVICE LEVEL FOR THE STYLE/COLOR AND PRINT THE  10110000
101200*  DETAIL LINE.                                                   10120000
101300*                                                                 10130000
101400***************************************************************** 10140000
101500 D200-STYLE-COLOR-BREAK.                                          10150000
101600*                                                                 10160000
101700     MOVE ZERO TO PV-AVG-OSTRAT                                   10170000
101800                  PV-TOTAL-CSTOCK                                 10180000
101900                  PV-AVG-ONORDER                                  10190000
102000                  PV-AVG-ONHAND.                                  10200000
102001*                                                                 10200100
102100*                                                                 10210000
102200     PERFORM E200-GET-OSTRAT-QTY.                                 10220000
102202*                                                                 10220200
102310*                                                                 10231000
102400     IF PRINT-DETAIL-FOR-DEPT                                     10240000
102500        PERFORM E300-GET-ONORDER-QTY                              10250000
102600        PERFORM E600-GET-ONHAND-QTY                               10260000
102700     END-IF                                                       10270000
102800*                                                                 10280000
102801*                                                                 10280100
102900     PERFORM E400-CALC-STORE-SVC-LEVELS                           10290000
103000         VARYING PV-ST-SUB FROM 1 BY 1                            10300000
103100         UNTIL PV-ST-SUB GREATER THAN PC-STORE-TABLE-MAX.         10310000
103200*                                                                 10320000
103210*                                                                 10321000
103300     IF PV-SKU-STORE-COMBOS > ZERO                                10330000
103400        COMPUTE PV-HOLD-SVC-LVL =                                 10340000
103500                 (PV-INSTOCKS-STYLE / PV-SKU-STORE-COMBOS) * 100  10350000
103600        COMPUTE PV-SVC-LEVEL-PCT ROUNDED = PV-HOLD-SVC-LVL        10360000
103700     ELSE                                                         10370000
103800        MOVE ZERO TO PV-SVC-LEVEL-PCT                             10380000
103900     END-IF                                                       10390000
104000*                                                                 10400000
104100     IF PRINT-DETAIL-FOR-DEPT                                     10410000
104200        PERFORM E500-FORMAT-DETAIL-LINE                           10420000
104300     END-IF                                                       10430000
104400*                                                                 10440000
104500     ADD PV-INSTOCKS-STYLE   TO PV-SC-INSTOCKS                    10450000
104600     ADD PV-SKU-STORE-COMBOS TO PV-SC-COMBOS                      10460000
104700     ADD PV-TOTAL-SKUS       TO PV-SC-TOTAL-SKUS                  10470000
104800     ADD PV-SKUS-BELOW       TO PV-SC-SKUS-BELOW                  10480000
104900     ADD PV-STORES-BELOW     TO PV-SC-STORES-BELOW                10490000
105000     ADD PC-1                TO PV-NBR-OF-STYLES                  10500000
105100*                                                                 10510000
105200     MOVE ZERO TO PV-INSTOCKS-STYLE                               10520000
105300                  PV-SKU-STORE-COMBOS                             10530000
105400                  PV-TOTAL-SKUS                                   10540000
105500                  PV-SKUS-BELOW                                   10550000
105600                  PV-STORES-BELOW                                 10560000
105700                  PV-FIRST-STORE-COUNT.                           10570000
105800*                                                                 10580000
105900***************************************************************** 10590000
106000*                                                                 10600000
106100*  CALCULATE THE SUBCLASS SERVICE LEVEL AND PRINT TOTALS          10610000
106200*                                                                 10620000
106300***************************************************************** 10630000
106400 D300-SUBCLASS-BREAK.                                             10640000
106500*                                                                 10650000
106600     MOVE ZERO TO PV-AVG-OSTRAT                                   10660000
106700                  PV-TOTAL-CSTOCK                                 10670000
106800                  PV-AVG-ONORDER                                  10680000
106900                  PV-AVG-ONHAND.                                  10690000
107001*                                                                 10700100
107100     PERFORM E700-GET-SUBCL-OSTRAT-QTY.                           10710000
107200     PERFORM E800-GET-SUBCL-ONORDER-QTY.                          10720000
107300     PERFORM E900-GET-SUBCL-ONHAND-QTY.                           10730000
107301*                                                                 10730100
107500     IF PV-SC-COMBOS > ZERO                                       10750000
107600        COMPUTE PV-HOLD-SVC-LVL =                                 10760000
107700                 (PV-SC-INSTOCKS / PV-SC-COMBOS) * 100            10770000
107800        COMPUTE PV-SVC-LEVEL-PCT ROUNDED = PV-HOLD-SVC-LVL        10780000
107900     ELSE                                                         10790000
108000        MOVE ZERO TO PV-SVC-LEVEL-PCT                             10800000
108100     END-IF                                                       10810000
108200*                                                                 10820000
108300     IF PRINT-DETAIL-FOR-DEPT                                     10830000
108400        MOVE SPACES TO TL1-STYLE-DESC                             10840000
108500        MOVE ZERO   TO TL1-NBR-OF-STYLES                          10850000
108600     ELSE                                                         10860000
108700        MOVE PC-STYLE-DESC    TO TL1-STYLE-DESC                   10870000
108800        MOVE PV-NBR-OF-STYLES TO TL1-NBR-OF-STYLES                10880000
108900     END-IF                                                       10890000
109000*                                                                 10900000
109100     MOVE PV-CLASS           TO TL1-CLASS.                        10910000
109200     MOVE 'SUBCLASS TOTAL'   TO TL1-TOTAL-DESC.                   10920000
109300     MOVE PV-SC-TOTAL-SKUS   TO TL1-TOT-SKUS.                     10930000
109400     MOVE PV-AVG-ONHAND      TO TL1-AVG-OH.                       10940000
109500     MOVE PV-AVG-ONORDER     TO TL1-AVG-OO.                       10950000
109600     MOVE PV-TOTAL-CSTOCK    TO TL1-CSTOCK.                       10960000
109700     MOVE PV-SVC-LEVEL-PCT   TO TL1-SVC-LEVEL.                    10970000
109800     MOVE PV-SC-SKUS-BELOW   TO TL1-SKUS-BELOW.                   10980000
109900     MOVE PV-SC-STORES-BELOW TO TL1-STORES-BELOW.                 10990000
110000     MOVE PV-AVG-OSTRAT      TO TL1-AVG-OSTRAT.                   11000000
110100     MOVE PV-LEAD-TIME       TO TL1-LEAD-TIME.                    11010000
110200     PERFORM T100-PRINT-SUBCLASS-TOTALS.                          11020000
110300*                                                                 11030000
110400     ADD PV-SC-INSTOCKS     TO PV-MC-INSTOCKS                     11040000
110500     ADD PV-SC-COMBOS       TO PV-MC-COMBOS                       11050000
110600     ADD PV-SC-TOTAL-SKUS   TO PV-MC-TOTAL-SKUS                   11060000
110700     ADD PV-SC-SKUS-BELOW   TO PV-MC-SKUS-BELOW                   11070000
110800     ADD PV-SC-STORES-BELOW TO PV-MC-STORES-BELOW                 11080000
110900*                                                                 11090000
111000     MOVE ZERO TO PV-SC-INSTOCKS                                  11100000
111100                  PV-SC-COMBOS                                    11110000
111200                  PV-SC-TOTAL-SKUS                                11120000
111300                  PV-SC-SKUS-BELOW                                11130000
111400                  PV-SC-STORES-BELOW                              11140000
111500                  PV-NBR-OF-STYLES.                               11150000
111600*                                                                 11160000
111700     MOVE PV-TSKXREF-SUB-CLASS TO PV-SUB-CLASS.                   11170000
111800*                                                                 11180000
111900***************************************************************** 11190000
112000*                                                                 11200000
112100*  CALCULATE THE MAJOR CLASS SERVICE LEVEL AND PRINT TOTALS       11210000
112200*                                                                 11220000
112300***************************************************************** 11230000
112400 D400-MAJOR-CLASS-BREAK.                                          11240000
112500*                                                                 11250000
112600     IF PV-MC-COMBOS > ZERO                                       11260000
112700        COMPUTE PV-HOLD-SVC-LVL =                                 11270000
112800                 (PV-MC-INSTOCKS / PV-MC-COMBOS) * 100            11280000
112900        COMPUTE PV-SVC-LEVEL-PCT ROUNDED = PV-HOLD-SVC-LVL        11290000
113000     ELSE                                                         11300000
113100        MOVE ZERO TO PV-SVC-LEVEL-PCT                             11310000
113200     END-IF                                                       11320000
113300*                                                                 11330000
113400     MOVE PV-MAJOR-CLASS      TO TL2-CLASS.                       11340000
113500     MOVE 'MAJOR CLASS TOTAL' TO TL2-TOTAL-DESC.                  11350000
113600     MOVE PV-MC-TOTAL-SKUS    TO TL2-TOT-SKUS.                    11360000
113700     MOVE PV-SVC-LEVEL-PCT    TO TL2-SVC-LEVEL.                   11370000
113800     MOVE PV-MC-SKUS-BELOW    TO TL2-SKUS-BELOW.                  11380000
113900     MOVE PV-MC-STORES-BELOW  TO TL2-STORES-BELOW.                11390000
114000     PERFORM T200-PRINT-MAJOR-CLASS-TOTALS.                       11400000
114100*                                                                 11410000
114200     ADD PV-MC-INSTOCKS     TO PV-DP-INSTOCKS                     11420000
114300     ADD PV-MC-COMBOS       TO PV-DP-COMBOS                       11430000
114400     ADD PV-MC-TOTAL-SKUS   TO PV-DP-TOTAL-SKUS                   11440000
114500     ADD PV-MC-SKUS-BELOW   TO PV-DP-SKUS-BELOW                   11450000
114600     ADD PV-MC-STORES-BELOW TO PV-DP-STORES-BELOW                 11460000
114700*                                                                 11470000
114800     MOVE ZERO TO PV-MC-INSTOCKS                                  11480000
114900                  PV-MC-COMBOS                                    11490000
115000                  PV-MC-TOTAL-SKUS                                11500000
115100                  PV-MC-SKUS-BELOW                                11510000
115200                  PV-MC-STORES-BELOW.                             11520000
115300*                                                                 11530000
115400     MOVE SKXREF-SUBCLASS    TO NI-SUB-CLASS-9-2.                 11540000
115410     MOVE NI-SUB-CLASS-X-2   TO PV-CLASS.                         11541000
115500*                                                                 11550000
115600***************************************************************** 11560000
115700*                                                                 11570000
115800*  READ THE OH-LT-MIN FILE FOR AN ITEM/STORE.                     11580000
115900*  IF RECORD FOUND, UPDATE THE COUNTER IN THE STORE TABLE.        11590000
116000*                                                                 11600000
116100***************************************************************** 11610000
116200 D500-PROCESS-ITEM-STORES.                                        11620000
116300*                                                                 11630000
116400     PERFORM Z600-READ-NEXT-OH-FILE.                              11640000
116500                                                                  11650000
116600     IF END-OF-ITEM-STORES                                        11660000
116700        CONTINUE                                                  11670000
116800     ELSE                                                         11680000
116900        IF MR113-ITEM-NBR NOT = PV-ITEM-NBR                       11690000
117000           SET END-OF-ITEM-STORES TO TRUE                         11700000
117100        ELSE                                                      11710000
117200           MOVE MR113-STORE-NBR  TO PV-ST-SUB                     11720021
117400           ADD PC-1 TO ST-OH-LT-MIN-ITEMS (PV-ST-SUB)             11740000
117500                       PV-NBR-OH-LT-MIN                           11750000
117600        END-IF                                                    11760000
117700     END-IF.                                                      11770000
117800*                                                                 11780000
117900***************************************************************** 11790000
118000*                                                                 11800000
118100*  IF DEPT. NUMBER IS FOUND IN TABLE, SET FLAG TO INDICATE THAT   11810000
118200*  NO STYLE/COLOR DETAIL SHOULD BE PRINTED FOR THIS DEPT.         11820000
118300*  (WILL BE SUMMED UP TO SUBCLASS LEVEL)                          11830000
118400*                                                                 11840000
118500***************************************************************** 11850000
118600 D600-CHECK-DEPT-TABLE.                                           11860000
118700*                                                                 11870000
118800     SET DP-INDEX TO 1.                                           11880000
118900     SEARCH DP-DEPT-ENTRIES                                       11890000
119000        AT END                                                    11900000
119100           SET PRINT-DETAIL-FOR-DEPT TO TRUE                      11910000
119200        WHEN DP-DEPT-NBR (DP-INDEX) = PV-DEPT-NBR                 11920000
119300           SET NO-DETAIL-FOR-DEPT TO TRUE                         11930000
119400     END-SEARCH.                                                  11940000
119500*                                                                 11950000
119600***************************************************************** 11960000
119700 D700-GET-BUYER-NAME.                                             11970000
119800*                                                                 11980000
119900     MOVE 'D700-GET-BUYER-NAME'   TO PV-PARAGRAPH-NAME.           11990000
120000     MOVE 'SELECT FOR BUYER NAME' TO PV-DB2-OPER-ATTEMPTED.       12000000
120100     MOVE SPACES                  TO HL2-BYR-NAME.                12010000
120200*                                                                 12020000
120300     PERFORM                                                      12030000
120400         WITH TEST AFTER                                          12040000
120500         VARYING PV-SQL-SUB                                       12050000
120600         FROM 1 BY 1                                              12060000
120700         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        12070000
120800            OR SQLCODE = ZERO                                     12080000
120900            OR SQLCODE = +100                                     12090000
121000                                                                  12100000
121100     EXEC SQL                                                     12110000
121200       SELECT WORKER_FIR_NAME,                                    12120000
121300              WORKER_LAST_NAME                                    12130000
121400         INTO :RSPBAR-WORKER-FIR-NAME,                            12140000
121500              :RSPBAR-WORKER-LAST-NAME                            12150000
121600         FROM TRSPBAR                                             12160000
121700        WHERE MDSEAR_DKEY = :MDSEAR-DKEY                          12170000
121800          AND RSPLVL_CDE  = 'BYR'                                 12180000
121900          AND OPERCO_NBR  = '03'                                  12190000
122000          AND CURRENT DATE BETWEEN                                12200000
122100                 WORKER_STRT_DTE AND WORKER_END_DTE               12210000
122200     END-EXEC                                                     12220000
122300         EVALUATE TRUE                                            12230000
122400             WHEN SQLCODE = ZERO                                  12240000
122500                  STRING RSPBAR-WORKER-FIR-NAME  DELIMITED BY ' ' 12250000
122600                  ' '                     DELIMITED BY SIZE       12260000
122700                  RSPBAR-WORKER-LAST-NAME DELIMITED BY SIZE       12270000
122800                          INTO HL2-BYR-NAME                       12280000
122900             WHEN SQLCODE = -904                                  12290000
123000             WHEN SQLCODE = -913                                  12300000
123100             WHEN SQLCODE = +100                                  12310000
123200                 CONTINUE                                         12320000
123300             WHEN SQLWARN0 NOT = SPACES                           12330000
123400             WHEN SQLCODE  NOT = ZERO                             12340000
123500                  PERFORM Z999-SQL-ABEND                          12350000
123600         END-EVALUATE                                             12360000
123700     END-PERFORM.                                                 12370000
123800*                                                                 12380000
123900     IF PV-SQL-SUB > PC-MAX-RETRIES                               12390000
124000        MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                    12400000
124100                                   TO PV-DB2-OPER-ATTEMPTED       12410000
124200        PERFORM Z999-SQL-ABEND                                    12420000
124300     END-IF.                                                      12430000
124400*                                                                 12440000
124500***************************************************************** 12450000
124600*                                                                 12460000
124700*  OBTAIN THE NUMBER OF STORES ASSOCIATED WITH AN ITEM            12470000
124800*                                                                 12480000
124900***************************************************************** 12490000
125000 D800-GET-STORE-COUNT.                                            12500000
125100     MOVE 'D800-GET-STORE-COUNT'   TO PV-PARAGRAPH-NAME.          12510000
125200     MOVE 'SELECT FOR STORE COUNT' TO PV-DB2-OPER-ATTEMPTED.      12520000
125210     MOVE PV-ITEM-NBR              TO MRITST-ITEM-NBR.            12521000
125300     PERFORM                                                      12530000
125400         WITH TEST AFTER                                          12540000
125500         VARYING PV-SQL-SUB                                       12550000
125600         FROM 1 BY 1                                              12560000
125700         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        12570000
125800            OR SQLCODE = ZERO                                     12580000
125900            OR SQLCODE = +100                                     12590000
126000                                                                  12600000
126100         EXEC SQL                                                 12610000
126200         SELECT COUNT (DISTINCT A.STR_NBR)                        12620000
126300           INTO :PV-TOT-STORES-FOR-ITEM                           12630000
126400           FROM TMRITST A,                                        12640000
126500                TSKST   B,                                        12650000
126600                XMT_LOC C                                         12660021
126700          WHERE A.ITEM_NBR    = :MRITST-ITEM-NBR                  12670021
126800            AND A.ITEM_NBR    = B.ITEM_NMBR                       12680021
126900            AND A.STR_NBR     = B.LOC_NBR                         12690021
127000            AND A.STR_NBR     = C.LOC_NBR                         12700021
127100            AND A.FT_CDE      = 'U'                               12710021
127200            AND C.E_BUS_IND   = 'Y'                               12720021
127300            AND C.LOC_TYP_CDE = 'DS'                              12730021
127400         END-EXEC                                                 12740000
127500         EVALUATE TRUE                                            12750000
127600             WHEN SQLCODE = ZERO                                  12760000
127700             WHEN SQLCODE = -904                                  12770000
127800             WHEN SQLCODE = -913                                  12780000
127900                 CONTINUE                                         12790000
128000             WHEN SQLCODE = +100                                  12800000
128100                  SET EOF-STORE-CURSOR TO TRUE                    12810000
128200             WHEN SQLWARN0 NOT = SPACES                           12820000
128300             WHEN SQLCODE  NOT = ZERO                             12830000
128400                  PERFORM Z999-SQL-ABEND                          12840000
128500         END-EVALUATE                                             12850000
128600     END-PERFORM.                                                 12860000
128700*                                                                 12870000
128800     IF PV-SQL-SUB > PC-MAX-RETRIES                               12880000
128900        MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'              12890000
129000                                   TO PV-DB2-OPER-ATTEMPTED       12900000
129100        PERFORM Z999-SQL-ABEND                                    12910000
129200     END-IF.                                                      12920000
129300*                                                                 12930000
129400***************************************************************** 12940000
129500*                                                                 12950000
129600*  AT THE STYLE/COLOR LEVEL (INFOREM E-COMMERCE ITEMS/STORES ONLY)12960000
129700*  OBTAIN:                                                        12970000
129800*  -- AVERAGE OSTRAT                                              12980000
129900*  -- TOTAL CSTOCK                                                12990000
130000*  -- NUMBER OF SKU/STORE COMBINATIONS                            13000000
130100*  -- NUMBER OF DISTINCT STORE NUMBERS                            13010000
130200*                                                                 13020000
130300***************************************************************** 13030000
130400 E200-GET-OSTRAT-QTY.                                             13040000
130500     MOVE 'E200-GET-OSTRAT-QTY'   TO PV-PARAGRAPH-NAME.           13050000
130600     MOVE 'SELECT FOR OSTRAT QTY' TO PV-DB2-OPER-ATTEMPTED.       13060000
130610     MOVE PV-DEPT-NBR             TO NI-DEPT-X-3.                 13061000
130620     MOVE PV-CLASS                TO NI-CLASS-X-2.                13062000
130621                                                                  13062100
130622     MOVE NI-DEPT-9-3             TO PV-HOLD-DEPT.                13062200
130623     MOVE NI-CLASS-9-2            TO PV-HOLD-CLASS.               13062300
130624                                                                  13062400
130700     PERFORM                                                      13070000
130800         WITH TEST AFTER                                          13080000
130900         VARYING PV-SQL-SUB                                       13090000
131000         FROM 1 BY 1                                              13100000
131100         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        13110000
131200            OR SQLCODE = ZERO                                     13120000
131300            OR SQLCODE = +100                                     13130000
131400                                                                  13140000
131500         EXEC SQL                                                 13150000
131600           SELECT AVG(B.OSTRAT_QTY),                              13160000
131700                  SUM(B.CSTOCK_QTY),                              13170000
131800                  COUNT (*),                                      13180000
131900                  COUNT (DISTINCT B.STR_NBR)                      13190000
132000             INTO :PV-AVG-OSTRAT:PV-NULL-IND-OSTRAT,              13200000
132100                  :PV-TOTAL-CSTOCK:PV-NULL-IND-CSTOCK,            13210000
132200                  :PV-SKU-STORE-COMBOS,                           13220000
132300                  :PV-TOTAL-STORES                                13230000
132400             FROM TSK     A,                                      13240000
132500                  TMRITST B,                                      13250000
132600                  TSKST   C,                                      13260000
132700                  XMT_LOC D,                                      13270021
132710                  TSKXREF E                                       13271000
132800            WHERE E.DEPT              = :PV-HOLD-DEPT             13280000
132900              AND E.SUBCLASS          = :PV-HOLD-CLASS            13290000
133000              AND A.LONG_VENDOR_STYLE = :PV-VENDOR-STYLE          13300000
133100              AND A.LONG_COLOR_DESC   = :PV-COLOR-DESC            13310000
133200              AND A.ITEM_NMBR       = B.ITEM_NBR                  13320021
133210              AND A.ITEM_NMBR       = E.ITM_NBR                   13321021
133300              AND B.ITEM_NBR        = C.ITEM_NMBR                 13330021
133400              AND B.STR_NBR         = C.LOC_NBR                   13340021
133500              AND B.STR_NBR         = D.LOC_NBR                   13350021
133600              AND B.FT_CDE          = 'U'                         13360021
133700              AND D.E_BUS_IND       = 'Y'                         13370021
133800              AND D.LOC_TYP_CDE     = 'DS'                        13380021
133900         END-EXEC                                                 13390000
134000         EVALUATE TRUE                                            13400000
134100             WHEN SQLCODE = ZERO                                  13410000
134200             WHEN SQLCODE = -904                                  13420000
134300             WHEN SQLCODE = -913                                  13430000
134400             WHEN SQLCODE = +100                                  13440000
134500                  CONTINUE                                        13450000
134600             WHEN SQLWARN0 NOT = SPACES                           13460000
134700             WHEN SQLCODE  NOT = ZERO                             13470000
134800                  PERFORM Z999-SQL-ABEND                          13480000
134900         END-EVALUATE                                             13490000
135000     END-PERFORM.                                                 13500000
135100*                                                                 13510000
135200     IF PV-SQL-SUB > PC-MAX-RETRIES                               13520000
135300        MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                    13530000
135400                                   TO PV-DB2-OPER-ATTEMPTED       13540000
135500        PERFORM Z999-SQL-ABEND                                    13550000
135600     END-IF.                                                      13560000
135700*                                                                 13570000
135800***************************************************************** 13580000
135900*                                                                 13590000
136000*  GET THE AVERAGE ONORDER QUANTITY FOR A STYLE/COLOR (INFOREM    13600000
136100*  E-COMMERCE ITEMS/STORES ONLY)                                  13610000
136200*                                                                 13620000
136300***************************************************************** 13630000
136400 E300-GET-ONORDER-QTY.                                            13640000
136500                                                                  13650000
136600     MOVE 'E300-GET-ONORDER-QTY' TO PV-PARAGRAPH-NAME.            13660000
136700     MOVE 'SELECT FOR ONORDER '  TO PV-DB2-OPER-ATTEMPTED.        13670000
136710     MOVE PV-DEPT-NBR             TO NI-DEPT-X-3.                 13671000
136720     MOVE PV-CLASS                TO NI-CLASS-X-2.                13672000
136721                                                                  13672100
136722     MOVE NI-DEPT-9-3             TO PV-HOLD-DEPT.                13672200
136723     MOVE NI-CLASS-9-2            TO PV-HOLD-CLASS.               13672300
136724                                                                  13672400
136800     PERFORM                                                      13680000
136900         WITH TEST AFTER                                          13690000
137000         VARYING PV-SQL-SUB                                       13700000
137100         FROM 1 BY 1                                              13710000
137200         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        13720000
137300            OR SQLCODE = ZERO                                     13730000
137400            OR SQLCODE = +100                                     13740000
137500                                                                  13750000
137600         EXEC SQL                                                 13760000
137700           SELECT SUM(A.ONORD_UNT_QTY)                            13770000
137800             INTO :PV-SUM-ONORDER:PV-NULL-IND-ONORDER             13780000
137900             FROM TSKSTOO A,                                      13790000
138000                  TSK     B,                                      13800000
138100                  XMT_LOC C,                                      13810021
138200                  TMRITST D,                                      13820000
138210                  TSKXREF E                                       13821000
138300            WHERE E.DEPT              = :PV-HOLD-DEPT             13830000
138400              AND E.SUBCLASS          = :PV-HOLD-CLASS            13840000
138500              AND B.LONG_VENDOR_STYLE = :PV-VENDOR-STYLE          13850000
138600              AND B.LONG_COLOR_DESC   = :PV-COLOR-DESC            13860000
139000              AND B.ITEM_NMBR   = D.ITEM_NBR                      13900000
139010              AND B.ITEM_NMBR   = E.ITM_NBR                       13901000
139020              AND A.ITM_NBR     = B.ITEM_NMBR                     13902000
139100              AND A.STR_NBR     = C.LOC_NBR                       13910021
139200              AND C.LOC_NBR     = D.STR_NBR                       13920021
139300              AND D.FT_CDE      = 'U'                             13930021
139400              AND C.E_BUS_IND   = 'Y'                             13940021
139500              AND C.LOC_TYP_CDE = 'DS'                            13950021
139600         END-EXEC                                                 13960000
139700         EVALUATE TRUE                                            13970000
139800             WHEN SQLCODE = ZERO                                  13980000
139900             WHEN SQLCODE = -904                                  13990000
140000             WHEN SQLCODE = -913                                  14000000
140100             WHEN SQLCODE = +100                                  14010000
140200                 CONTINUE                                         14020000
140300             WHEN SQLWARN0 NOT = SPACES                           14030000
140400             WHEN SQLCODE  NOT = ZERO                             14040000
140500                  PERFORM Z999-SQL-ABEND                          14050000
140600         END-EVALUATE                                             14060000
140700     END-PERFORM.                                                 14070000
140800                                                                  14080000
140900     IF PV-SQL-SUB > PC-MAX-RETRIES                               14090000
141000        MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                    14100000
141100                                   TO PV-DB2-OPER-ATTEMPTED       14110000
141200        PERFORM Z999-SQL-ABEND                                    14120000
141300     ELSE                                                         14130000
141400        IF SQLCODE = ZERO                                         14140000
141500           IF (PV-NULL-IND-ONORDER = -1) OR                       14150000
141600              (PV-SKU-STORE-COMBOS = ZERO)                        14160000
141700              MOVE ZERO TO PV-AVG-ONORDER                         14170000
141800           ELSE                                                   14180000
141900              DIVIDE PV-SUM-ONORDER BY PV-SKU-STORE-COMBOS        14190000
142000                  GIVING PV-HOLD-AVG-OO                           14200000
142100              COMPUTE PV-AVG-ONORDER ROUNDED = PV-HOLD-AVG-OO     14210000
142200           END-IF                                                 14220000
142300        END-IF                                                    14230000
142400     END-IF.                                                      14240000
142500*                                                                 14250000
142600***************************************************************** 14260000
142700*                                                                 14270000
142800*  FOR A VALID STORE NUMBER IN THE INTERNAL STORE TABLE,          14280000
142900*  GET THE NUMBER OF ITEMS IN THE STYLE/COLOR FOR THAT STORE.     14290000
143000*  THEN CALCULATE THE STORE'S SERVICE LEVEL.  IF BELOW THE SET    14300000
143100*  LIMIT, INCREMENT COUNTER.                                      14310000
143200*                                                                 14320000
143300***************************************************************** 14330000
143400 E400-CALC-STORE-SVC-LEVELS.                                      14340000
143500*                                                                 14350000
143600     IF ST-VALID-STORE-FLAG (PV-ST-SUB) = PC-Y                    14360000
143700        MOVE ZERO          TO PV-TOT-ITEMS-FOR-STORE              14370000
143800        MOVE PV-ST-SUB     TO MRITST-STR-NBR                      14380021
144000        PERFORM F300-GET-TOTAL-ITEMS                              14400000
144100                                                                  14410000
144200        IF PV-TOT-ITEMS-FOR-STORE GREATER THAN ZERO               14420000
144300                                                                  14430000
144400           IF ST-OH-LT-MIN-ITEMS (PV-ST-SUB) = ZERO               14440000
144500              MOVE PC-100 TO PV-SVC-LEVEL-PCT                     14450000
144600           ELSE                                                   14460000
144700              SUBTRACT ST-OH-LT-MIN-ITEMS (PV-ST-SUB)             14470000
144800                  FROM PV-TOT-ITEMS-FOR-STORE                     14480000
144900                GIVING PV-NBR-INSTOCK                             14490000
145000              COMPUTE PV-HOLD-SVC-LVL =                           14500000
145100                  (PV-NBR-INSTOCK / PV-TOT-ITEMS-FOR-STORE) * 100 14510000
145200              COMPUTE PV-SVC-LEVEL-PCT ROUNDED = PV-HOLD-SVC-LVL  14520000
145300              MOVE ZERO TO PV-NBR-INSTOCK                         14530000
145400           END-IF                                                 14540000
145500*                                                                 14550000
145600           IF PV-SVC-LEVEL-PCT < PC-STORE-SVC-LEVEL-LIMIT         14560000
145700              ADD PC-1 TO PV-STORES-BELOW                         14570000
145800           END-IF                                                 14580000
145900        END-IF                                                    14590000
146000                                                                  14600000
146100        MOVE ZERO TO ST-OH-LT-MIN-ITEMS (PV-ST-SUB)               14610000
146200     END-IF.                                                      14620000
146300*                                                                 14630000
146400***************************************************************** 14640000
146500 E500-FORMAT-DETAIL-LINE.                                         14650000
146600*                                                                 14660000
146700     MOVE PV-CLASS         TO DL1-CLASS.                          14670000
146800     MOVE PV-VENDOR-STYLE  TO DL1-STYLE.                          14680000
146900     MOVE PV-ITEM-DESC     TO DL1-DESC.                           14690000
147000     MOVE PV-COLOR-DESC    TO DL1-COLOR.                          14700000
147100     MOVE PV-TOTAL-STORES  TO DL1-TOT-STORES.                     14710000
147200     MOVE PV-TOTAL-SKUS    TO DL1-TOT-SKUS.                       14720000
147300     MOVE PV-AVG-ONHAND    TO DL1-AVG-OH.                         14730000
147400     MOVE PV-AVG-ONORDER   TO DL1-AVG-OO.                         14740000
147500     MOVE PV-TOTAL-CSTOCK  TO DL1-CSTOCK.                         14750000
147600     MOVE PV-SVC-LEVEL-PCT TO DL1-SVC-LEVEL.                      14760000
147700     MOVE PV-SKUS-BELOW    TO DL1-SKUS-BELOW.                     14770000
147800     MOVE PV-STORES-BELOW  TO DL1-STORES-BELOW.                   14780000
147900     MOVE PV-AVG-OSTRAT    TO DL1-AVG-OSTRAT.                     14790000
148000     MOVE PV-LEAD-TIME     TO DL1-LEAD-TIME.                      14800000
148100*                                                                 14810000
148200     PERFORM Z300-WRITE-DETAIL-LINE.                              14820000
148300*                                                                 14830000
148400     MOVE SPACE TO DL1-ASTERISK.                                  14840000
148500*                                                                 14850000
148600***************************************************************** 14860000
148700*                                                                 14870000
148800*  GET AVERAGE ONHAND QUANTITY FOR THE STYLE/COLOR (INFOREM       14880000
148900*  E-COMMERCE ITEMS/STORES ONLY)                                  14890000
149000*                                                                 14900000
149100***************************************************************** 14910000
149200 E600-GET-ONHAND-QTY.                                             14920000
149300     MOVE 'E600-GET-ONHAND-QTY'   TO PV-PARAGRAPH-NAME.           14930000
149400     MOVE 'SELECT FOR ONHAND QTY' TO PV-DB2-OPER-ATTEMPTED.       14940000
149410     MOVE PV-DEPT-NBR             TO NI-DEPT-X-3.                 14941000
149420     MOVE PV-CLASS                TO NI-CLASS-X-2.                14942000
149421                                                                  14942100
149422     MOVE NI-DEPT-9-3             TO PV-HOLD-DEPT.                14942200
149423     MOVE NI-CLASS-9-2            TO PV-HOLD-CLASS.               14942300
149424                                                                  14942400
149500     PERFORM                                                      14950000
149600         WITH TEST AFTER                                          14960000
149700         VARYING PV-SQL-SUB                                       14970000
149800         FROM 1 BY 1                                              14980000
149900         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        14990000
150000            OR SQLCODE = ZERO                                     15000000
150100            OR SQLCODE = +100                                     15010000
150200                                                                  15020000
150300         EXEC SQL                                                 15030000
150400           SELECT DECIMAL((AVG(B.ONHAND_QTY)+.05),6,1)            15040000
150500             INTO :PV-AVG-ONHAND:PV-NULL-IND-ONHAND               15050000
150600             FROM TSK     A,                                      15060000
150700                  TSKST   B,                                      15070000
150800                  XMT_LOC C,                                      15080021
150900                  TMRITST D,                                      15090000
150910                  TSKXREF E                                       15091000
151000            WHERE E.DEPT              = :PV-HOLD-DEPT             15100000
151100              AND E.SUBCLASS          = :PV-HOLD-CLASS            15110000
151200              AND A.LONG_VENDOR_STYLE = :PV-VENDOR-STYLE          15120000
151300              AND A.LONG_COLOR_DESC   = :PV-COLOR-DESC            15130000
151400              AND A.ITEM_NMBR   = B.ITEM_NMBR                     15140021
151500              AND A.ITEM_NMBR   = D.ITEM_NBR                      15150021
151510              AND A.ITEM_NMBR   = E.ITM_NBR                       15151021
151600              AND B.LOC_NBR     = C.LOC_NBR                       15160021
151700              AND C.LOC_NBR     = D.STR_NBR                       15170021
151800              AND C.E_BUS_IND   = 'Y'                             15180021
151900              AND C.LOC_TYP_CDE = 'DS'                            15190021
152000              AND D.FT_CDE      = 'U'                             15200021
152100         END-EXEC                                                 15210000
152200         EVALUATE TRUE                                            15220000
152300             WHEN SQLCODE = ZERO                                  15230000
152400             WHEN SQLCODE = -904                                  15240000
152500             WHEN SQLCODE = -913                                  15250000
152600             WHEN SQLCODE = +100                                  15260000
152700                 CONTINUE                                         15270000
152800             WHEN SQLWARN0 NOT = SPACES                           15280000
152900             WHEN SQLCODE  NOT = ZERO                             15290000
153000                  PERFORM Z999-SQL-ABEND                          15300000
153100         END-EVALUATE                                             15310000
153200     END-PERFORM.                                                 15320000
153300*                                                                 15330000
153400     IF PV-SQL-SUB > PC-MAX-RETRIES                               15340000
153500        MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                    15350000
153600                                   TO PV-DB2-OPER-ATTEMPTED       15360000
153700        PERFORM Z999-SQL-ABEND                                    15370000
153800     END-IF.                                                      15380000
153900***************************************************************** 15390000
154000*                                                                 15400000
154100*  AT THE SUBCLASS LEVEL (INFOREM E-COMMERCE ITEMS/STORES ONLY)   15410000
154200*  OBTAIN:                                                        15420000
154300*  -- AVERAGE OSTRAT                                              15430000
154400*  -- TOTAL CSTOCK                                                15440000
154700*                                                                 15470000
154800***************************************************************** 15480000
154900 E700-GET-SUBCL-OSTRAT-QTY.                                       15490000
155000     MOVE 'E700-GET-SUBCL-OSTRAT-QTY' TO PV-PARAGRAPH-NAME.       15500000
155100     MOVE 'SELECT FOR OSTRAT QTY'     TO PV-DB2-OPER-ATTEMPTED.   15510000
155110     MOVE PV-DEPT-NBR             TO NI-DEPT-X-3.                 15511000
155120     MOVE PV-CLASS                TO NI-CLASS-X-2.                15512000
155121                                                                  15512100
155122     MOVE NI-DEPT-9-3             TO PV-HOLD-DEPT.                15512200
155123     MOVE NI-CLASS-9-2            TO PV-HOLD-CLASS.               15512300
155124                                                                  15512400
155200     PERFORM                                                      15520000
155300         WITH TEST AFTER                                          15530000
155400         VARYING PV-SQL-SUB                                       15540000
155500         FROM 1 BY 1                                              15550000
155600         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        15560000
155700            OR SQLCODE = ZERO                                     15570000
155800            OR SQLCODE = +100                                     15580000
155900                                                                  15590000
156000         EXEC SQL                                                 15600000
156100           SELECT AVG(B.OSTRAT_QTY),                              15610000
156200                  SUM(B.CSTOCK_QTY)                               15620000
156300             INTO :PV-AVG-OSTRAT:PV-NULL-IND-OSTRAT,              15630000
156400                  :PV-TOTAL-CSTOCK:PV-NULL-IND-CSTOCK             15640000
156500             FROM TSK     A,                                      15650000
156600                  TMRITST B,                                      15660000
156700                  TSKST   C,                                      15670000
156800                  XMT_LOC D,                                      15680021
156810                  TSKXREF E                                       15681000
156900            WHERE E.DEPT        = :PV-HOLD-DEPT                   15690021
157000              AND E.SUBCLASS    = :PV-HOLD-CLASS                  15700021
157100              AND A.ITEM_NMBR   = B.ITEM_NBR                      15710021
157200              AND B.ITEM_NBR    = C.ITEM_NMBR                     15720021
157210              AND A.ITEM_NMBR   = E.ITM_NBR                       15721021
157300              AND B.STR_NBR     = C.LOC_NBR                       15730021
157400              AND B.STR_NBR     = D.LOC_NBR                       15740021
157500              AND B.FT_CDE      = 'U'                             15750021
157600              AND D.E_BUS_IND   = 'Y'                             15760021
157700              AND D.LOC_TYP_CDE = 'DS'                            15770021
157800         END-EXEC                                                 15780000
157900         EVALUATE TRUE                                            15790000
158000             WHEN SQLCODE = ZERO                                  15800000
158100             WHEN SQLCODE = -904                                  15810000
158200             WHEN SQLCODE = -913                                  15820000
158300             WHEN SQLCODE = +100                                  15830000
158400                  CONTINUE                                        15840000
158500             WHEN SQLWARN0 NOT = SPACES                           15850000
158600             WHEN SQLCODE  NOT = ZERO                             15860000
158700                  PERFORM Z999-SQL-ABEND                          15870000
158800         END-EVALUATE                                             15880000
158900     END-PERFORM.                                                 15890000
159000*                                                                 15900000
159100     IF PV-SQL-SUB > PC-MAX-RETRIES                               15910000
159200        MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                    15920000
159300                                   TO PV-DB2-OPER-ATTEMPTED       15930000
159400        PERFORM Z999-SQL-ABEND                                    15940000
159500     END-IF.                                                      15950000
159600*                                                                 15960000
159700***************************************************************** 15970000
159800*                                                                 15980000
159900*  GET THE AVERAGE ONORDER QUANTITY FOR A SUBCLASS (INFOREM       15990000
160000*  E-COMMERCE ITEMS/STORES ONLY)                                  16000000
160100*                                                                 16010000
160200***************************************************************** 16020000
160300 E800-GET-SUBCL-ONORDER-QTY.                                      16030000
160400                                                                  16040000
160500     MOVE 'E800-GET-SUBCL-ONORDER-QTY' TO PV-PARAGRAPH-NAME.      16050000
160600     MOVE 'SELECT FOR ONORDER '        TO PV-DB2-OPER-ATTEMPTED.  16060000
160610     MOVE PV-DEPT-NBR             TO NI-DEPT-X-3.                 16061000
160620     MOVE PV-CLASS                TO NI-CLASS-X-2.                16062000
160621                                                                  16062100
160622     MOVE NI-DEPT-9-3             TO PV-HOLD-DEPT.                16062200
160623     MOVE NI-CLASS-9-2            TO PV-HOLD-CLASS.               16062300
160624                                                                  16062400
160700     PERFORM                                                      16070000
160800         WITH TEST AFTER                                          16080000
160900         VARYING PV-SQL-SUB                                       16090000
161000         FROM 1 BY 1                                              16100000
161100         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        16110000
161200            OR SQLCODE = ZERO                                     16120000
161300            OR SQLCODE = +100                                     16130000
161400                                                                  16140000
161500         EXEC SQL                                                 16150000
161600           SELECT SUM(A.ONORD_UNT_QTY)                            16160000
161700             INTO :PV-SUM-ONORDER:PV-NULL-IND-ONORDER             16170000
161800             FROM TSKSTOO A,                                      16180000
161900                  TSK     B,                                      16190000
162000                  XMT_LOC C,                                      16200021
162100                  TMRITST D,                                      16210000
162110                  TSKXREF E                                       16211000
162200            WHERE E.DEPT        = :PV-HOLD-DEPT                   16220000
162300              AND E.SUBCLASS    = :PV-HOLD-CLASS                  16230000
162700              AND B.ITEM_NMBR   = D.ITEM_NBR                      16270000
162710              AND B.ITEM_NMBR   = E.ITM_NBR                       16271000
162720              AND B.ITEM_NMBR   = A.ITM_NBR                       16272000
162800              AND A.STR_NBR     = C.LOC_NBR                       16280021
162900              AND C.LOC_NBR     = D.STR_NBR                       16290021
163000              AND D.FT_CDE      = 'U'                             16300021
163100              AND C.E_BUS_IND   = 'Y'                             16310021
163200              AND C.LOC_TYP_CDE = 'DS'                            16320021
163300         END-EXEC                                                 16330000
163400         EVALUATE TRUE                                            16340000
163500             WHEN SQLCODE = ZERO                                  16350000
163600             WHEN SQLCODE = -904                                  16360000
163700             WHEN SQLCODE = -913                                  16370000
163800             WHEN SQLCODE = +100                                  16380000
163900                 CONTINUE                                         16390000
164000             WHEN SQLWARN0 NOT = SPACES                           16400000
164100             WHEN SQLCODE  NOT = ZERO                             16410000
164200                  PERFORM Z999-SQL-ABEND                          16420000
164300         END-EVALUATE                                             16430000
164400     END-PERFORM.                                                 16440000
164500                                                                  16450000
164600     IF PV-SQL-SUB > PC-MAX-RETRIES                               16460000
164700        MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                    16470000
164800                                   TO PV-DB2-OPER-ATTEMPTED       16480000
164900        PERFORM Z999-SQL-ABEND                                    16490000
165000     ELSE                                                         16500000
165100        IF SQLCODE = ZERO                                         16510000
165200           IF (PV-NULL-IND-ONORDER = -1) OR                       16520000
165300              (PV-SC-COMBOS = ZERO)                               16530000
165400              MOVE ZERO TO PV-AVG-ONORDER                         16540000
165500           ELSE                                                   16550000
165600              DIVIDE PV-SUM-ONORDER BY PV-SC-COMBOS               16560000
165700                  GIVING PV-HOLD-AVG-OO                           16570000
165800              COMPUTE PV-AVG-ONORDER ROUNDED = PV-HOLD-AVG-OO     16580000
165900           END-IF                                                 16590000
166000        END-IF                                                    16600000
166100     END-IF.                                                      16610000
166200*                                                                 16620000
166300***************************************************************** 16630000
166400*                                                                 16640000
166500*  GET AVERAGE ONHAND QUANTITY FOR THE SUBCLASS (INFOREM          16650000
166600*  E-COMMERCE ITEMS/STORES ONLY)                                  16660000
166700*                                                                 16670000
166800***************************************************************** 16680000
166900 E900-GET-SUBCL-ONHAND-QTY.                                       16690000
167000     MOVE 'E900-GET-SUBCL-ONHAND-QTY' TO PV-PARAGRAPH-NAME.       16700000
167100     MOVE 'SELECT FOR ONHAND QTY'     TO PV-DB2-OPER-ATTEMPTED.   16710000
167110     MOVE PV-DEPT-NBR             TO NI-DEPT-X-3.                 16711000
167120     MOVE PV-CLASS                TO NI-CLASS-X-2.                16712000
167130                                                                  16713000
167140     MOVE NI-DEPT-9-3             TO PV-HOLD-DEPT.                16714000
167141     MOVE NI-CLASS-9-2            TO PV-HOLD-CLASS.               16714100
167150                                                                  16715000
167200     PERFORM                                                      16720000
167300         WITH TEST AFTER                                          16730000
167400         VARYING PV-SQL-SUB                                       16740000
167500         FROM 1 BY 1                                              16750000
167600         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        16760000
167700            OR SQLCODE = ZERO                                     16770000
167800            OR SQLCODE = +100                                     16780000
167900                                                                  16790000
168000         EXEC SQL                                                 16800000
168100           SELECT DECIMAL((AVG(B.ONHAND_QTY)+.05),6,1)            16810000
168200             INTO :PV-AVG-ONHAND:PV-NULL-IND-ONHAND               16820000
168300             FROM TSK     A,                                      16830000
168400                  TSKST   B,                                      16840000
168500                  XMT_LOC C,                                      16850021
168600                  TMRITST D,                                      16860000
168610                  TSKXREF E                                       16861000
168700            WHERE E.DEPT      = :PV-HOLD-DEPT                     16870000
168800              AND E.SUBCLASS  = :PV-HOLD-CLASS                    16880000
168900              AND A.ITEM_NMBR = B.ITEM_NMBR                       16890000
168910              AND A.ITEM_NMBR = E.ITM_NBR                         16891000
169000              AND A.ITEM_NMBR = D.ITEM_NBR                        16900000
169100              AND B.LOC_NBR     = C.LOC_NBR                       16910021
169200              AND C.LOC_NBR     = D.STR_NBR                       16920021
169300              AND C.E_BUS_IND   = 'Y'                             16930021
169400              AND C.LOC_TYP_CDE = 'DS'                            16940021
169500              AND D.FT_CDE      = 'U'                             16950021
169600         END-EXEC                                                 16960000
169700         EVALUATE TRUE                                            16970000
169800             WHEN SQLCODE = ZERO                                  16980000
169900             WHEN SQLCODE = -904                                  16990000
170000             WHEN SQLCODE = -913                                  17000000
170100             WHEN SQLCODE = +100                                  17010000
170200                 CONTINUE                                         17020000
170300             WHEN SQLWARN0 NOT = SPACES                           17030000
170400             WHEN SQLCODE  NOT = ZERO                             17040000
170500                  PERFORM Z999-SQL-ABEND                          17050000
170600         END-EVALUATE                                             17060000
170700     END-PERFORM.                                                 17070000
170800*                                                                 17080000
170900     IF PV-SQL-SUB > PC-MAX-RETRIES                               17090000
171000        MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                    17100000
171100                                   TO PV-DB2-OPER-ATTEMPTED       17110000
171200        PERFORM Z999-SQL-ABEND                                    17120000
171300     END-IF.                                                      17130000
171400*                                                                 17140000
171500***************************************************************** 17150000
171600 F100-FETCH-STORE-CURSOR.                                         17160000
171700     MOVE 'F100-FETCH-STORE-CSR' TO PV-PARAGRAPH-NAME.            17170000
171800     MOVE 'STORE CURSOR FETCH '  TO PV-DB2-OPER-ATTEMPTED.        17180000
171900     PERFORM                                                      17190000
172000         WITH TEST AFTER                                          17200000
172100         VARYING PV-SQL-SUB                                       17210000
172200         FROM 1 BY 1                                              17220000
172300         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        17230000
172400            OR SQLCODE = ZERO                                     17240000
172500            OR SQLCODE = +100                                     17250000
172600                                                                  17260000
172700         EXEC SQL                                                 17270000
172800             FETCH STORE_CSR                                      17280000
172900              INTO :XMT00001-LOC-NBR                              17290021
173000         END-EXEC                                                 17300000
173100         EVALUATE TRUE                                            17310000
173200             WHEN SQLCODE = ZERO                                  17320000
173300             WHEN SQLCODE = -904                                  17330000
173400             WHEN SQLCODE = -913                                  17340000
173500                 CONTINUE                                         17350000
173600             WHEN SQLCODE = +100                                  17360000
173700                 SET EOF-STORE-CURSOR TO TRUE                     17370000
173800             WHEN SQLWARN0 NOT = SPACES                           17380000
173900             WHEN SQLCODE  NOT = ZERO                             17390000
174000                  PERFORM Z999-SQL-ABEND                          17400000
174100         END-EVALUATE                                             17410000
174200     END-PERFORM.                                                 17420000
174300*                                                                 17430000
174400     IF PV-SQL-SUB > PC-MAX-RETRIES                               17440000
174500        MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'              17450000
174600                                   TO PV-DB2-OPER-ATTEMPTED       17460000
174700        PERFORM Z999-SQL-ABEND                                    17470000
174800     END-IF.                                                      17480000
174900*                                                                 17490000
175000*                                                                 17500000
175100***************************************************************** 17510000
175200*                                                                 17520000
175300*  OBTAIN THE TOTAL NUMBER OF ITEMS IN A STYLE/COLOR FOR A        17530000
175400*  PARTICULAR STORE (INFOREM E-COMMERCE ITEMS/STORES ONLY)        17540000
175500*                                                                 17550000
175600***************************************************************** 17560000
175700 F300-GET-TOTAL-ITEMS.                                            17570000
175800*                                                                 17580000
175900     MOVE 'F300-GET-TOTAL-ITEMS'    TO PV-PARAGRAPH-NAME.         17590000
176000     MOVE 'SELECT FOR TOTAL ITEMS ' TO PV-DB2-OPER-ATTEMPTED.     17600000
176010     MOVE PV-DEPT-NBR             TO NI-DEPT-X-3.                 17601000
176020     MOVE PV-CLASS                TO NI-CLASS-X-2.                17602000
176021                                                                  17602100
176022     MOVE NI-DEPT-9-3             TO PV-HOLD-DEPT.                17602200
176023     MOVE NI-CLASS-9-2            TO PV-HOLD-CLASS.               17602300
176024                                                                  17602400
176100     PERFORM                                                      17610000
176200         WITH TEST AFTER                                          17620000
176300         VARYING PV-SQL-SUB                                       17630000
176400         FROM 1 BY 1                                              17640000
176500         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        17650000
176600            OR SQLCODE = ZERO                                     17660000
176700            OR SQLCODE = +100                                     17670000
176800                                                                  17680000
176900         EXEC SQL                                                 17690000
177000           SELECT COUNT (*)                                       17700000
177100             INTO :PV-TOT-ITEMS-FOR-STORE                         17710000
177200             FROM TMRITST A,                                      17720000
177300                  TSK     B,                                      17730000
177310                  TSKXREF C                                       17731000
177400            WHERE A.STR_NBR           = :MRITST-STR-NBR           17740021
177500              AND A.FT_CDE            = 'U'                       17750000
177600              AND C.DEPT              = :PV-HOLD-DEPT             17760000
177700              AND C.SUBCLASS          = :PV-HOLD-CLASS            17770000
177800              AND B.LONG_VENDOR_STYLE = :PV-VENDOR-STYLE          17780000
177900              AND B.LONG_COLOR_DESC   = :PV-COLOR-DESC            17790000
178000              AND A.ITEM_NBR  = B.ITEM_NMBR                       17800000
178010              AND B.ITEM_NMBR = C.ITM_NBR                         17801000
178100         END-EXEC                                                 17810000
178200         EVALUATE TRUE                                            17820000
178300             WHEN SQLCODE = ZERO                                  17830000
178400             WHEN SQLCODE = -904                                  17840000
178500             WHEN SQLCODE = -913                                  17850000
178600             WHEN SQLCODE = +100                                  17860000
178700                  CONTINUE                                        17870000
178800             WHEN SQLWARN0 NOT = SPACES                           17880000
178900             WHEN SQLCODE  NOT = ZERO                             17890000
179000                  PERFORM Z999-SQL-ABEND                          17900000
179100         END-EVALUATE                                             17910000
179200     END-PERFORM.                                                 17920000
179300*                                                                 17930000
179400     IF PV-SQL-SUB > PC-MAX-RETRIES                               17940000
179500        MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                    17950000
179600                                   TO PV-DB2-OPER-ATTEMPTED       17960000
179700        PERFORM Z999-SQL-ABEND                                    17970000
179800     END-IF.                                                      17980000
179900*                                                                 17990000
180000***************************************************************** 18000000
180100 T100-PRINT-SUBCLASS-TOTALS.                                      18010000
180200*                                                                 18020000
180300     IF NO-DETAIL-FOR-DEPT                                        18030000
180400        ADD PC-1 TO PV-LINE-CNT                                   18040000
180500     ELSE                                                         18050000
180600        ADD PC-5 TO PV-LINE-CNT                                   18060000
180700     END-IF                                                       18070000
180800*                                                                 18080000
180900     IF PV-LINE-CNT > PC-MAX-LINES                                18090000
181000        PERFORM Z400-PRINT-REPORT-HEADERS                         18100000
181100        IF NO-DETAIL-FOR-DEPT                                     18110000
181200           ADD PC-1 TO PV-LINE-CNT                                18120000
181300        ELSE                                                      18130000
181400           ADD PC-5 TO PV-LINE-CNT                                18140000
181500        END-IF                                                    18150000
181600     END-IF                                                       18160000
181700*                                                                 18170000
181800     IF PRINT-DETAIL-FOR-DEPT                                     18180000
181900        WRITE PRINT-LINE FROM DASHED-LINE                         18190000
182000            AFTER ADVANCING PC-1                                  18200000
182100     END-IF                                                       18210000
182200*                                                                 18220000
182300     WRITE PRINT-LINE FROM TOTAL-LINE-1                           18230000
182400         AFTER ADVANCING PC-1.                                    18240000
182500*                                                                 18250000
182600     IF PRINT-DETAIL-FOR-DEPT                                     18260000
182700        WRITE PRINT-LINE FROM DASHED-LINE                         18270000
182800            AFTER ADVANCING PC-1                                  18280000
182900        WRITE PRINT-LINE FROM DASHED-LINE                         18290000
183000            AFTER ADVANCING PC-1                                  18300000
183100        WRITE PRINT-LINE FROM BLANK-LINE                          18310000
183200            AFTER ADVANCING PC-1                                  18320000
183300     END-IF.                                                      18330000
183400*                                                                 18340000
183500***************************************************************** 18350000
183600 T200-PRINT-MAJOR-CLASS-TOTALS.                                   18360000
183700*                                                                 18370000
183800     ADD PC-5 TO PV-LINE-CNT.                                     18380000
183900     IF PV-LINE-CNT > PC-MAX-LINES                                18390000
184000        PERFORM Z400-PRINT-REPORT-HEADERS                         18400000
184100        ADD PC-5 TO PV-LINE-CNT                                   18410000
184200     END-IF                                                       18420000
184300*                                                                 18430000
184400     IF NO-DETAIL-FOR-DEPT                                        18440000
184500        WRITE PRINT-LINE FROM DASHED-LINE                         18450000
184600            AFTER ADVANCING PC-1                                  18460000
184700        ADD PC-1 TO PV-LINE-CNT                                   18470000
184800     END-IF.                                                      18480000
184900*                                                                 18490000
185000     WRITE PRINT-LINE FROM TOTAL-LINE-2                           18500000
185100         AFTER ADVANCING PC-1.                                    18510000
185200*                                                                 18520000
185300     WRITE PRINT-LINE FROM DASHED-LINE                            18530000
185400         AFTER ADVANCING PC-1.                                    18540000
185500     WRITE PRINT-LINE FROM DASHED-LINE                            18550000
185600         AFTER ADVANCING PC-1.                                    18560000
185700     WRITE PRINT-LINE FROM BLANK-LINE                             18570000
185800         AFTER ADVANCING PC-2.                                    18580000
185900*                                                                 18590000
186000***************************************************************** 18600000
186100 T300-PRINT-DEPT-TOTALS.                                          18610000
186200*                                                                 18620000
186300     IF PV-LINE-CNT > PC-MAX-LINES                                18630000
186400        PERFORM Z400-PRINT-REPORT-HEADERS                         18640000
186500     END-IF.                                                      18650000
186600*                                                                 18660000
186700     WRITE PRINT-LINE FROM TOTAL-LINE-2                           18670000
186800         AFTER ADVANCING PC-1.                                    18680000
186900     ADD PC-1 TO PV-LINE-CNT.                                     18690000
187000*                                                                 18700000
187100***************************************************************** 18710000
187200 T400-PRINT-BG-TOTALS.                                            18720000
187300*                                                                 18730000
187400     ADD PC-7 TO PV-LINE-CNT.                                     18740000
187500     IF PV-LINE-CNT > PC-MAX-LINES                                18750000
187600        PERFORM Z400-PRINT-REPORT-HEADERS                         18760000
187700     END-IF.                                                      18770000
187800*                                                                 18780000
187900     WRITE PRINT-LINE FROM DASHED-LINE                            18790000
188000         AFTER ADVANCING PC-1.                                    18800000
188100     WRITE PRINT-LINE FROM DASHED-LINE                            18810000
188200         AFTER ADVANCING PC-1.                                    18820000
188300     WRITE PRINT-LINE FROM BLANK-LINE                             18830000
188400         AFTER ADVANCING PC-3.                                    18840000
188500*                                                                 18850000
188600     WRITE PRINT-LINE FROM TOTAL-LINE-2                           18860000
188700         AFTER ADVANCING PC-2.                                    18870000
188800*                                                                 18880000
189000*                                                                 18900000
189100***************************************************************** 18910000
189200 X100-OPEN-BG-DEPT-CURSOR.                                        18920000
189300     MOVE 'X100-OPEN-BG-DEPT-CURSOR' TO PV-PARAGRAPH-NAME.        18930000
189400     MOVE 'OPEN BG-DEPT CURSOR'      TO PV-DB2-OPER-ATTEMPTED.    18940000
189500                                                                  18950000
189600     EXEC SQL                                                     18960000
189700         OPEN BG_DEPT_CSR                                         18970000
189800     END-EXEC                                                     18980000
189900                                                                  18990000
190000     EVALUATE TRUE                                                19000000
190100         WHEN SQLCODE = ZERO                                      19010000
190200         WHEN SQLCODE = PC-ROW-NOT-FOUND                          19020000
190300             CONTINUE                                             19030000
190400         WHEN OTHER                                               19040000
190500             PERFORM Z999-SQL-ABEND                               19050000
190600       END-EVALUATE.                                              19060000
190700*                                                                 19070000
190800***************************************************************** 19080000
190900 X200-OPEN-ITEM-CURSOR.                                           19090000
191000     MOVE 'X200-OPEN-ITEM-CURSOR' TO PV-PARAGRAPH-NAME.           19100000
191100     MOVE 'OPEN ITEM CURSOR'      TO PV-DB2-OPER-ATTEMPTED.       19110000
191200*                                                                 19120000
191300     EXEC SQL                                                     19130000
191400         OPEN ITEM_CSR                                            19140000
191500     END-EXEC                                                     19150000
191600                                                                  19160000
191700     EVALUATE TRUE                                                19170000
191800         WHEN SQLCODE = ZERO                                      19180000
191900         WHEN SQLCODE = PC-ROW-NOT-FOUND                          19190000
192000             CONTINUE                                             19200000
192100         WHEN OTHER                                               19210000
192200             PERFORM Z999-SQL-ABEND                               19220000
192300       END-EVALUATE.                                              19230000
192400*                                                                 19240000
192500***************************************************************** 19250000
192600 X300-OPEN-STORE-CURSOR.                                          19260000
192700     MOVE 'X300-OPEN-STORE-CURSOR' TO PV-PARAGRAPH-NAME.          19270000
192800     MOVE 'OPEN STORE CURSOR'      TO PV-DB2-OPER-ATTEMPTED.      19280000
192900*                                                                 19290000
193000     EXEC SQL                                                     19300000
193100         OPEN STORE_CSR                                           19310000
193200     END-EXEC                                                     19320000
193300                                                                  19330000
193400     EVALUATE TRUE                                                19340000
193500         WHEN SQLCODE = ZERO                                      19350000
193600         WHEN SQLCODE = PC-ROW-NOT-FOUND                          19360000
193700             CONTINUE                                             19370000
193800         WHEN OTHER                                               19380000
193900             PERFORM Z999-SQL-ABEND                               19390000
194000       END-EVALUATE.                                              19400000
194100*                                                                 19410000
194200***************************************************************** 19420000
194300 X700-OPEN-FILES.                                                 19430000
194400*                                                                 19440000
194500     OPEN INPUT OH-LT-MIN-FILE.                                   19450000
194600*                                                                 19460000
194700     IF PV-VSAM-SUCCESSFUL                                        19470000
194800        CONTINUE                                                  19480000
194900     ELSE                                                         19490000
195000        IF PV-VSAM-EMPTY                                          19500000
195100           SET OH-FILE-EMPTY TO TRUE                              19510000
195200        ELSE                                                      19520000
195300           DISPLAY '** ABEND **'                                  19530000
195400           DISPLAY '** PROGRAM    = MRKRP105'                     19540000
195500           DISPLAY '** PARAGRAPH  = X700-OPEN-FILES'              19550000
195600           DISPLAY '** MESSAGE    = '                             19560000
195700                   'BAD VSAM OPEN, STATUS = ' PV-VSAM-STATUS      19570000
195800           MOVE +4005           TO PV-ABEND-CODE                  19580000
195900           CALL 'ILBOABN0'      USING PV-ABEND-CODE               19590000
196000        END-IF                                                    19600000
196100     END-IF.                                                      19610000
196200*                                                                 19620000
196300     OPEN INPUT  CONTROL-FILE                                     19630000
196400          OUTPUT PRINT-REPORT.                                    19640000
196500*                                                                 19650000
196600***************************************************************** 19660000
196700 Y100-CLOSE-BG-DEPT-CURSOR.                                       19670000
196800     EXEC SQL                                                     19680000
196900         CLOSE BG_DEPT_CSR                                        19690000
197000     END-EXEC                                                     19700000
197100                                                                  19710000
197200     EVALUATE TRUE                                                19720000
197300         WHEN SQLCODE = ZERO                                      19730000
197400             CONTINUE                                             19740000
197500         WHEN OTHER                                               19750000
197600             DISPLAY 'Y100-CLOSE-BG-DEPT-CURSOR'                  19760000
197700             PERFORM Z999-SQL-ABEND                               19770000
197800       END-EVALUATE.                                              19780000
197900*                                                                 19790000
198000***************************************************************** 19800000
198100 Y200-CLOSE-ITEM-CURSOR.                                          19810000
198200*                                                                 19820000
198300     EXEC SQL                                                     19830000
198400         CLOSE ITEM_CSR                                           19840000
198500     END-EXEC                                                     19850000
198600                                                                  19860000
198700     EVALUATE TRUE                                                19870000
198800         WHEN SQLCODE = ZERO                                      19880000
198900             CONTINUE                                             19890000
199000         WHEN OTHER                                               19900000
199100             DISPLAY 'Y200-CLOSE-ITEM-CURSOR'                     19910000
199200             PERFORM Z999-SQL-ABEND                               19920000
199300       END-EVALUATE.                                              19930000
199400*                                                                 19940000
199500***************************************************************** 19950000
199600 Y300-CLOSE-STORE-CURSOR.                                         19960000
199700     EXEC SQL                                                     19970000
199800         CLOSE STORE_CSR                                          19980000
199900     END-EXEC                                                     19990000
200000                                                                  20000000
200100     EVALUATE TRUE                                                20010000
200200         WHEN SQLCODE = ZERO                                      20020000
200300             CONTINUE                                             20030000
200400         WHEN OTHER                                               20040000
200500             DISPLAY 'Y300-CLOSE-STORE-CURSOR'                    20050000
200600             PERFORM Z999-SQL-ABEND                               20060000
200700       END-EVALUATE.                                              20070000
200800*                                                                 20080000
200900***************************************************************** 20090000
201000 Y700-CLOSE-FILES.                                                20100000
201100*                                                                 20110000
201110     CLOSE CONTROL-FILE                                           20111000
201120           PRINT-REPORT.                                          20112000
201130*                                                                 20113000
201200     IF OH-FILE-NOT-EMPTY                                         20120000
201300        CLOSE OH-LT-MIN-FILE                                      20130000
201400*                                                                 20140000
201500        IF PV-VSAM-SUCCESSFUL                                     20150000
201600           CONTINUE                                               20160000
201700        ELSE                                                      20170000
201800           DISPLAY '** ABEND **'                                  20180000
201900           DISPLAY '** PROGRAM    = MRKRP105'                     20190000
202000           DISPLAY '** PARAGRAPH  = Y700-CLOSE-FILES'             20200000
202100           DISPLAY '** MESSAGE    = '                             20210000
202200                   'BAD VSAM CLOSE, STATUS = ' PV-VSAM-STATUS     20220000
202300           MOVE +4005           TO PV-ABEND-CODE                  20230000
202400           CALL 'ILBOABN0'      USING PV-ABEND-CODE               20240000
202500        END-IF                                                    20250000
202600     END-IF.                                                      20260000
202700*                                                                 20270000
203100***************************************************************** 20310000
203200*                                                                 20320000
203300*  READ CONTROL CARDS--FIRST ONE CONTAINS THE SKU SERVICE         20330000
203400*  LEVEL LIMIT AND STORE SERVICE LEVEL LIMIT, THE REST            20340000
203500*  ARE DEPARTMENT NUMBERS AND ARE PUT INTO A TABLE.  THESE        20350000
203600*  DEPARTMENTS WILL ONLY SHOW DETAIL TO THE SUBCLASS LEVEL ON     20360000
203700*  THE REPORT.                                                    20370000
203800*                                                                 20380000
203900***************************************************************** 20390000
204000 Z100-READ-CONTROL-FILE.                                          20400000
204100*                                                                 20410000
204200     READ CONTROL-FILE INTO CONTROL-DATA-IN                       20420000
204300          AT END SET EOF-CONTROL-FILE TO TRUE.                    20430000
204400*                                                                 20440000
204500     IF NOT EOF-CONTROL-FILE                                      20450000
204600        IF PV-DP-SUB = 1                                          20460000
204700           MOVE CTL-SKU-SVC-LEVEL-PCT TO PC-SKU-SVC-LEVEL-LIMIT   20470000
204800                                         HL5-SKU-LIMIT            20480000
204900           MOVE CTL-STORE-SVC-LEVEL-PCT TO                        20490000
205000                                         PC-STORE-SVC-LEVEL-LIMIT 20500000
205100                                         HL5-STORE-LIMIT          20510000
205200        ELSE                                                      20520000
205300           MOVE CTL-DEPT TO DP-DEPT-NBR (PV-DP-SUB - 1)           20530000
205400        END-IF                                                    20540000
205500     END-IF.                                                      20550000
205600*                                                                 20560000
205700***************************************************************** 20570000
205800 Z300-WRITE-DETAIL-LINE.                                          20580000
205900*                                                                 20590000
206000     IF PV-LINE-CNT > PC-MAX-LINES                                20600000
206100        PERFORM Z400-PRINT-REPORT-HEADERS                         20610000
206200     END-IF                                                       20620000
206300*                                                                 20630000
206400     WRITE PRINT-LINE FROM DETAIL-LINE-1                          20640000
206500         AFTER ADVANCING PC-1.                                    20650000
206600     ADD PC-1 TO PV-LINE-CNT.                                     20660000
206700*                                                                 20670000
206800***************************************************************** 20680000
206900 Z400-PRINT-REPORT-HEADERS.                                       20690000
207000*                                                                 20700000
207100     ADD PC-1 TO PV-PAGE-CNT.                                     20710000
207200     MOVE PV-PAGE-CNT TO DP132-PAGE-NUMBER.                       20720000
207300*                                                                 20730000
207400     WRITE PRINT-LINE FROM DP132-STANDRD-HEADER-132-COLS          20740000
207500         AFTER ADVANCING PAGE.                                    20750000
207600*                                                                 20760000
207700     WRITE PRINT-LINE FROM HEADING-LINE-2                         20770000
207800         AFTER ADVANCING PC-1.                                    20780000
207900*                                                                 20790000
208000     WRITE PRINT-LINE FROM HEADING-LINE-3                         20800000
208100         AFTER ADVANCING PC-2.                                    20810000
208200*                                                                 20820000
208300     WRITE PRINT-LINE FROM HEADING-LINE-4                         20830000
208400         AFTER ADVANCING PC-2.                                    20840000
208500*                                                                 20850000
208600     WRITE PRINT-LINE FROM HEADING-LINE-5                         20860000
208700         AFTER ADVANCING PC-1.                                    20870000
208800*                                                                 20880000
208900     WRITE PRINT-LINE FROM BLANK-LINE                             20890000
209000         AFTER ADVANCING PC-1.                                    20900000
209100*                                                                 20910000
209200     MOVE ZERO TO PV-LINE-CNT.                                    20920000
209300*                                                                 20930000
209400***************************************************************** 20940000
209500 Z500-START-BROWSE-OH-FILE.                                       20950000
209600*                                                                 20960000
209700     MOVE SPACES TO PV-VSAM-STATUS.                               20970000
209800*                                                                 20980000
209900     START OH-LT-MIN-FILE                                         20990000
210000         KEY GREATER THAN OH-LT-MIN-KEY.                          21000000
210100*                                                                 21010000
210200     IF PV-VSAM-SUCCESSFUL OR PV-VSAM-NOT-FOUND                   21020000
210300        CONTINUE                                                  21030000
210400     ELSE                                                         21040000
210500        DISPLAY '** ABEND **'                                     21050000
210600        DISPLAY '** PROGRAM    = MRKRP105'                        21060000
210700        DISPLAY '** PARAGRAPH  = Z500-START-BROWSE-OH-FILE'       21070000
210800        DISPLAY '** MESSAGE    = '                                21080000
210900                'BAD VSAM READ, STATUS = ' PV-VSAM-STATUS         21090000
211000        MOVE +4005           TO PV-ABEND-CODE                     21100000
211100        CALL 'ILBOABN0'      USING PV-ABEND-CODE                  21110000
211200     END-IF.                                                      21120000
211300*                                                                 21130000
211400***************************************************************** 21140000
211500 Z600-READ-NEXT-OH-FILE.                                          21150000
211600*                                                                 21160000
211700     MOVE SPACES TO PV-VSAM-STATUS.                               21170000
211800*                                                                 21180000
211900     READ OH-LT-MIN-FILE NEXT RECORD                              21190000
212000        INTO MR113-OH-LT-MIN-RECORD.                              21200000
212100*                                                                 21210000
212200     IF PV-VSAM-SUCCESSFUL                                        21220000
212300        CONTINUE                                                  21230000
212400     ELSE                                                         21240000
212500        SET END-OF-ITEM-STORES TO TRUE                            21250000
212600     END-IF.                                                      21260000
212700*                                                                 21270000
212800*                                                                 21280000
212900***************************************************************** 21290000
213000 Z999-SQL-ABEND.                                                  21300000
213100*                                                                 21310000
213200     SET ABEND-4013            TO TRUE.                           21320000
213300     DISPLAY '**  ABEND     **'.                                  21330000
213400     DISPLAY '**  PROGRAM   **  = MRKRP105'.                      21340000
213500     DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            21350000
213600     DISPLAY '**  OPERATION **  = ' PV-DB2-OPER-ATTEMPTED.        21360000
213700                                                                  21370000
213800*    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         21380000
213900*    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        21390000
214000                                                                  21400000
214100     COPY DPPD004.                                                21410000
214200                                                                  21420000
214300     CALL 'ILBOABN0'  USING ABEND-CODE.                           21430000
214400*                                                                 21440000
214500***************************************************************** 21450000
214600***********************END OF PROGRAM**************************** 21460000
