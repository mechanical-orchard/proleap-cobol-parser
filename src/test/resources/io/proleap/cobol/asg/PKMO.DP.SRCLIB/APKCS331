000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    APKCS331.                                         00040000
000500 AUTHOR.        KOHLS.                                            00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  06/27/94.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    A331 - INVOICE ITEM RECONCILIATION.                        * 00110000
001200*                                                               * 00120000
001300*    THIS SELECTABLE LIST PROGRAM DISPLAYS RECONCILIATION       * 00130000
001400*    RESULTS BETWEEN THE INVOICED AND RECEIPT AMOUNTS FOR A     * 00140000
001500*    PARTICULAR PURCHASE ORDER LINE FOR A SPECIFIC PURCHASE     * 00150000
001600*    ORDER.                                                     * 00160000
001700*                                                               * 00170000
001800*---------------------------------------------------------------* 00180000
001900*---------------------------------------------------------------* 00190000
002000*                                                               * 00200000
002100* CHANGE LOG:                                                   * 00210000
002200*                                                               * 00220000
002300* 10/01/94    BMW  CHANGED WHERE CLAUSE FOR RECEIPT CSR SO THAT * 00230000
002400*                  IT LOOKS FOR AP_PRC_CDE = ' ', INSTEAD OF    * 00240000
002500*                  AP_PRC_CDE NOT IN ('M', 'J', 'D')            * 00250000
002600*                                                               * 00260000
002700* 01/10/94    BMW  COMMENTED OUT REFERENCE TO MIITEM.PO_NBR FROM* 00270000
002800*                  WHERE CLAUSE WHEN UPDATING THE MIITEM ROW    * 00280000
002900*                  SEE PARA 7000-.  IT IS NOT NEEDED AND WOULD  * 00290000
003000*                  CAUSE A PROBLEM IF THE USER UPDATED THE INVC * 00300000
003100*                  HEADER'S PO NUMBER.                          * 00310000
003200*                                                               * 00320000
003300* 03/15/95  P.KEBER  CHANGED NEXT-ACT-RETURN LOGIC TO REBUILD   * 00330000
003400*                    THE SCREEN FROM THE COMMAREA.              * 00340000
003500*                    FIXED THE F8 (NEXT PAGE) LOGIC (IR#152).   * 00350000
003600*                                                               * 00360000
003700* 07/26/95    MKK  ADDED FS_POST_TMST TO RECEIPT-ITEM-CSR.      * 00370000
003800*                                                               * 00380000
003900* 11/16/95    MKK  CHANGED COMPUTATIONS OF PV-INVC-EXTD-AMT     * 00390000
004000*                  AND ASC-RCVD-EXTD-AMT TO ROUND.              * 00400000
004100*                                                               * 00410000
004200* 01/05/96    MKK  CHANGED RECEIPT-ITEM-CSR SO THAT THE TNINREC * 00420000
004300*                  PORTION USES A BETWEEN CLAUSE FOR THE STORE  * 00430000
004400*                  NUMBER AS THE TRECDIS SIDE DOES.             * 00440000
004500*                                                               * 00450000
004600* 06/26/96    DSW  ADDED PROCESSING TO RETRIEVE AND DISPLAY     * 00460000
004700*                  DEPARTMENT NUMBER.   (WR#3928)               * 00470000
004800*                                                               * 00480000
004900* 08/29/96    PDV -ADDED AN ALLOWANCE CHARGE INDICATOR IN COMM- * 00490000
005000*                  AREA. ADDED LOGIC TO DETERMINE IF ALLOWANCE  * 00500000
005100*                  CHARGES ARE ASSOCIATED WITH THE INVOICE.     * 00510000
005200*                  (IN PARAGRAOGH 4320)                         * 00520000
005300*                 -CHANGED ++INCLUDE TO COPY    WR # 4094       * 00530000
005400*                                                               * 00540000
005500* 09/17/96    PDV -CORRECTED SQL FOR COUNT ON TALCHRG TABLE     * 00550000
005600*                  IN WHERE CLAUSE ADDED PR TO PI CONNECTION    * 00560000
005700*                  FOR PO NUMBER AND PO LINE NOT NULL.          * 00570000
005800*                                               WR# 4094        * 00580000
005900*                                                               * 00590000
006000* 11/07/01        -RESTORED THE SELECTALL FUNCTION KEY TO WORK  * 00600000
006100*                  WITH THE F24 FUNCTION KEY (RCV COST) ONLY.   * 00610000
006200*                  THIS WILL ALLOW THE USERS TO UPDATE MULTIPLE * 00620000
006300*                  INVOICE LINES ON THE TMIITEM TABLE TO USE THE* 00630000
006400*                  RECEIVE UNIT COST MORE QUICKLY THAN DOING    * 00640000
006500*                  IT SELECTING ONE DETAIL LINE AT A TIME.  THE * 00650000
006600*                  USERS WANT THIS SO THAT THEY CAN INCREASE THE* 00660000
006700*                  TURN AROUND TIME FOR PAY RELEASING POS.      * 00670000
006800*                  CHANGED BY: MIKE BESKE       WR# 22441       * 00680000
006900*                                                               * 00690000
007000* 01/30/02        -TEMPORARILY FIXED HOW THE F24 KEYS WORKS.  IT* 00700000
007100*                  CURRENTLY ONLY UPDATES ONE SCREEN (8 ITEMS)  * 00710000
007200*                  TO POINT TO THE RECEIVING UNIT COST.  AS A   * 00720000
007300*                  TEMP CHANGE IT WILL UPDATE 2 SCREENS (16     * 00730000
007400*                  ITEMS).  BECAUSE OF THE LIMITATIONS OF THE   * 00740000
007500*                  COMMAREA, IT CAN ONLY DO THIS MUCH FOR AN    * 00750000
007600*                  UPDATE AT A TIME.  I WILL BE LOOKING FOR A   * 00760000
007700*                  WAY TO ALLOW AN UPDATE TO ACCESS ALL OF THE  * 00770000
007800*                  ITEMS (ANY NUMBER ABOVE 16) SO THAT THE UP-  * 00780000
007900*                  DATE WILL TAKE PLACE IN ONE EXECUTION.       * 00790000
008000*                  CHANGED BY: MIKE BESKE      PITS 446766      * 00800000
008100*                                                               * 00810000
008200* 01/31/02        -DEVELOPED THE CODE THAT WILL ALLOW THE USER  * 00820000
008300*                  TO UPDATE THE SELECT-ALL INVOICES PER PO LINE* 00830000
008400*                  LINE NUMBER AT AN ITEM LINE LEVEL TO POINT TO* 00840000
008500*                  THE RECEIVED UNIT COST.  IT IS DONE BY GOING * 00850000
008600*                  THROUGH THE TEMP STORAGE QUEUE AND LOADING IT* 00860000
008700*                  INTO THE COMMAREA.  THE ACTUAL UPDATE TO THE * 00870000
008800*                  TABLE TMIITEM WILL TAKE PLACE WITH THE COMM  * 00880000
008900*                  AREA DATA. (PARAS 4501- 4510- 4515- 4520-    * 00890000
009000*                  4525- 7005- 7006-)                           * 00900000
009100*                  CHANGED BY: MIKE BESKE      PITS 446766      * 00910000
009200*                                                               * 00920000
009300*   5/22/02  RECOMPILED TO PICK UP NEW DCLGENS FOR TINVOIC,     * 00930000
009400*            TMDINVC AND TEXINVC AS PART OF THE ARK PO PHASE ONE* 00940000
009500*            PROJECT.                                           * 00950000
009600*             BY: MIKE BESKE                     WR: 23500      * 00960000
009700*                                                               * 00970000
009800*  09/09/02  ARK PO PROJECT PHASE 2.  INSERT EXISTENCE CHECKING * 00980000
009900*            INTO SQL STATMENTS IN PARAGRAPHS 4320 AND 7100.    * 00990000
010000*       BY:  KEVIN CATLIN                   WR #: 23500         * 01000000
010100*                                                               * 01010000
010200*  09/09/02  ADDED CHECK FOR SQL CODE +100 TO EXISTENCE CHECK   * 01020000
010300*            IN PARAGRAPH 7100.                                 * 01030000
010400*       BY:  KEVIN CATLIN                 PITS #: 492764        * 01040000
010500*                                                               * 01050000
010600*  04/23/04  INCREASED THE VARIOUS STORE NUMBER FIELDS TO 4     * 01060000
010700*            DIGITS AS PART OF THE STORE CONSTRAINTS PROJECT.   * 01070000
010800*       BY:  MIKE BESKE                     WR #: 25805         * 01080000
010900*                                                               * 01090000
011000*  03/30/06  REMOVED THE F18 AND F24 FUNCTIONS KEYS FROM THE    * 01100000
011100*            APLINREC MNEMONIC FOR AP-INVC ITEM RECONCILIATION. * 01110000
011200*            REMOVED DP020-FK-LOCAL-FUNC-01 AND                 * 01120000
011300*            DP020-FK-LOCAL-FUNC-03 FROM 2100-CHECK-FUNCTION-KEY* 01130000
011400*            SO THAT NO ACTION WILL BE TAKEN FOR THESE          * 01140000
011500*            FUNCTION KEYS.                                     * 01150000
011600*       BY:  ROLF NOHE                      WR #: 29575         * 01160000
011700*                                                               * 01170000
011800*  DATE  03/11/2007                                             * 01180000
011900*      CHANGE MADE: MATCH BY DC PROJECT                         * 01190000
012000*      REMOVED TPOSTRR AND RELATED CODE BECAUSE THE PARA 7100-  * 01200000
012100*      WAS NOT BEING PERFORMED IN THIS PROGRAM.  ADDED CODE TO  * 01210000
012200*      DISPLAY DC_NBR ON THE SCREEN.  MODIFIED THE VARIOUS      * 01220000
012300*      CURSORS' WHERE CONDITIONS TO USE HIGH AND LOW STR_NBR AND* 01230000
012400*      DC_NBR INSTEAD OF DIRECT STR_NBR MATCH.  ADDED DC_NBR AND* 01240000
012500*      DC_NBR AND MTCH_LVL_CDE TO THE SELECT OF THE SAME CURSORS* 01250000
012600*      THE CODE IN PARA 4100- WAS CHANGED TO CHECK THE MATCH    * 01260000
012700*      LEVEL CODE VALUE INSTEAD OF THE STORE NUMBER TO PREPARE  * 01270000
012800*      THE VALUES FOR THE CURSORS.                              * 01280000
012900*      MOD PARAS: 1100- 2100- 4100- 4300- 4320- 4400-.          * 01290000
013000*      MADE BY: MIKE BESKE              WR/IR #: WR21578        * 01300000
013100*                                                               * 01310000
013110* DATE  02/04/08                                                * 01311000
013120*     CHANGE MADE: PRIVATE LABEL LOAD                           * 01312000
013130*     FOR DOMESTIC PO'S THE FIRST COST WILL CONTAIN THE ITEM    * 01313000
013140*     COST AND THE UNIT COST WILL CONTAIN THE ITEM COST PLUS    * 01314000
013141*     THE INTERNAL PRIVATE LABLE LOAD AMOUNT.  FOR DOMESTIC     * 01314100
013142*     PO'S THE PURITM-PRD-1ST-COST-AMT CONTAINS THE INITAL COST * 01314200
013143*     OF THE PRODUCT.  THE RECEIPT-ITEM-CSR, AND LOGIC IN 4200- * 01314300
013144*     AND 4210- HAS BEEN MODIFIED TO USE THE PRODUCT FIRST COST * 01314400
013145*     AMOUNT RATHER THAN THE UNIT COST AMOUNT.                  * 01314500
013146*     MADE BY: MICHELE RINDFLEISCH     WR/IR #: WR32664         * 01314600
013147*                                                               * 01314703
013148* DATE  05/11/21                                                * 01314803
013150*     CHANGE MADE: ADD STATUS OF 'PJ' TO ALL SELECTS FROM THE   * 01315001
013151*     TINVOIC TABLE, TO INCLUDE SEPHORA AT KOHLS TRANS           *01315101
013157*     MADE BY: JEAN KURK               CHG0256545               * 01315703
013158* DATE  09/01/2021                                                01315805
013159*            - CHANGE CALL OF 'DPKUT100' TO                     * 01315905
013160*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 01316005
013161*              MAKING THE CALL DYNAMIC VS STATIC                * 01316105
013162*     MADE BY: GERMAN BANDA            WR/IR #: CHG0261053        01316207
013163* DATE  10/24/2022                                              * 01316308
013164*     ADD COPYBOOK DPWS930                                      * 01316408
013165*     CHANGE CICS ARCHITECTURE CALL TO USE DP930-CICS-ARCH-API  * 01316508
013166*     MADE BY: BOB MCASEY              WR/IR #: CHG0276864      * 01316608
013167***************************************************************** 01316700
013168                                                                  01316800
013169 ENVIRONMENT DIVISION.                                            01316900
013170                                                                  01317000
013171 DATA DIVISION.                                                   01317100
013172                                                                  01317200
013180 WORKING-STORAGE SECTION.                                         01318000
013190                                                                  01319000
013200 01  DK-DB2-KEYS.                                                 01320000
013300     05  DK-STR-NBR                     PIC S9(4) COMP VALUE +0.  01330000
013400     05  DK-STR-NBR-LOW                 PIC S9(4) COMP VALUE +0.  01340000
013500     05  DK-STR-NBR-HIGH                PIC S9(4) COMP VALUE +0.  01350000
013600     05  DK-DC-NBR                      PIC S9(4) COMP VALUE +0.  01360000
013700     05  DK-DC-NBR-LOW                  PIC S9(4) COMP VALUE +0.  01370000
013800     05  DK-DC-NBR-HIGH                 PIC S9(4) COMP VALUE +0.  01380000
013900     05  DK-PO-NBR                      PIC S9(9) COMP VALUE +0.  01390000
014000     05  DK-PO-LNE-NBR                  PIC S9(9) COMP VALUE +0.  01400000
014100     05  DK-MTCH-LVL-CDE                PIC  X(01)  VALUE SPACE.  01410000
014200                                                                  01420000
014300 01  PC-PROGRAM-CONSTANTS.                                        01430000
014400     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         01440000
014500                                                    'AP331A  '.   01450000
014600     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         01460000
014700                                                    'APKM331 '.   01470000
014800     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         01480000
014900                                                    'APKCS331'.   01490000
015000     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      01500000
015100     05  PC-SEL-QUEUE-SEQ-OUT           PIC  9(01)  VALUE 3.      01510000
015200     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +08     01520000
015300                                                    COMP SYNC.    01530000
015400     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      01540000
015500                                                    COMP SYNC.    01550000
015600     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         01560000
015700                                                    +1000000      01570000
015800                                                    COMP-3.       01580000
015900     05  PC-MAX-RETRIES                 PIC S9(04)  VALUE  +3     01590000
016000                                                    COMP.         01600000
016100     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      01610000
016200                                                    COMP SYNC.    01620000
016300     05  PC-SHORT-DESC-CODE             PIC  X(02)  VALUE '04'.   01630000
016400     05  PC-TYP-CDE-CHARGE              PIC  X(01)  VALUE 'C'.    01640000
016500     05  PC-INQ                         PIC  X(01)  VALUE 'I'.    01650000
016600     05  PC-UPD                         PIC  X(01)  VALUE 'U'.    01660000
016700     05  PC-DEL                         PIC  X(01)  VALUE 'D'.    01670000
016800     05  PC-ERR                         PIC  X(01)  VALUE 'E'.    01680000
016900     05  PC-TSYMSG-NUMBERS.                                       01690000
017000         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  01700000
017100         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  01710000
017200         10  PC-TSYMSG-00045            PIC  9(05)  VALUE 00045.  01720000
017300         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  01730000
017400         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  01740000
017500         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  01750000
017600         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  01760000
017700         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  01770000
017800         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  01780000
017900         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  01790000
018000         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01800000
018100         10  PC-TSYMSG-00059            PIC  9(05)  VALUE 00059.  01810000
018200         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01820000
018300         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01830000
018400         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01840000
018500         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01850000
018600         10  PC-TSYMSG-00330            PIC  9(05)  VALUE 00330.  01860000
018700         10  PC-TSYMSG-00482            PIC  9(05)  VALUE 00482.  01870000
018800         10  PC-TSYMSG-00904            PIC  9(05)  VALUE 00904.  01880000
018900         10  PC-TSYMSG-00945            PIC  9(05)  VALUE 00945.  01890000
019000         10  PC-TSYMSG-02836            PIC  9(05)  VALUE 02836.  01900000
019100         10  PC-TSYMSG-02837            PIC  9(05)  VALUE 02837.  01910000
019200         10  PC-TSYMSG-02899            PIC  9(05)  VALUE 02899.  01920000
019300         10  PC-TSYMSG-02900            PIC  9(05)  VALUE 02900.  01930000
019400         10  PC-TSYMSG-02901            PIC  9(05)  VALUE 02901.  01940000
019500                                                                  01950000
019600 01  PS-PROGRAM-SWITCHES.                                         01960000
019700     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01970000
019800         88  PS-NO-ERROR                            VALUE 'Y'.    01980000
019900         88  PS-ERROR                               VALUE 'N'.    01990000
020000     05  PS-ERROR-DB2-SW                PIC  X(01)  VALUE 'Y'.    02000000
020100         88  PS-NO-ERROR-DB2                        VALUE 'Y'.    02010000
020200         88  PS-ERROR-DB2                           VALUE 'N'.    02020000
020300     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    02030000
020400         88  PS-COMMAREA-VALID                      VALUE 'Y'.    02040000
020500         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    02050000
020600     05  PS-END-OF-CALC-CSR-SW          PIC  X(01)  VALUE 'N'.    02060000
020700         88  PS-END-OF-CALC-CSR                     VALUE 'Y'.    02070000
020800         88  PS-NOT-END-OF-CALC-CSR                 VALUE 'N'.    02080000
020900                                                                  02090000
021000     05  PS-TS-PO-LNE-NBR-SW            PIC X(01)   VALUE 'N'.    02100000
021100         88  PS-TS-PO-LNE-FND                       VALUE 'Y'.    02110000
021200         88  PS-TS-PO-LNE-NOT-FND                   VALUE 'N'.    02120000
021300                                                                  02130000
021400     05  PS-TS-NEXT-PO-LNE-SW           PIC X(01)   VALUE 'N'.    02140000
021500         88  PS-TS-NEXT-PO-LNE-FND                  VALUE 'Y'.    02150000
021600         88  PS-TS-NEXT-PO-LNE-NOT-FND              VALUE 'N'.    02160000
021700                                                                  02170000
021800     05  PS-TS-PREV-PO-LNE-SW           PIC X(01)   VALUE 'N'.    02180000
021900         88  PS-TS-PREV-PO-LNE-FND                  VALUE 'Y'.    02190000
022000         88  PS-TS-PREV-PO-LNE-NOT-FND              VALUE 'N'.    02200000
022100                                                                  02210000
022200     05  PS-TS-MAX-ITEMS-READ-SW        PIC X(01)   VALUE 'N'.    02220000
022300         88  PS-TS-MAX-ITEMS-READ                   VALUE 'Y'.    02230000
022400         88  PS-TS-MAX-ITEMS-NOT-READ               VALUE 'N'.    02240000
022500                                                                  02250000
022600     05  PS-FK22-KEY-INVOKED-SW         PIC X(01)   VALUE 'N'.    02260000
022700         88  PS-FK22-KEY-INVOKED                    VALUE 'Y'.    02270000
022800         88  PS-FK22-KEY-NOT-INVOKED                VALUE 'N'.    02280000
022900                                                                  02290000
023000     05  PS-ZERO-RCVD-COST-FND-SW       PIC X(01)   VALUE 'N'.    02300000
023100         88  PS-ZERO-RCVD-COST-FND                  VALUE 'Y'.    02310000
023200         88  PS-ZERO-RCVD-COST-NOT-FND              VALUE 'N'.    02320000
023300                                                                  02330000
023400     05  PS-INV-COST-EQL-RCVD-COST-SW   PIC X(01)   VALUE 'N'.    02340000
023500         88  PS-INV-COST-EQL-RCVD-COST-FND          VALUE 'Y'.    02350000
023600         88  PS-INV-COST-EQL-RCVD-COST-NTFD         VALUE 'N'.    02360000
023700                                                                  02370000
023800 01  PV-PROGRAM-VARIABLES.                                        02380000
023900     05  PV-ONE                         PIC X(01).                02390000
024000     05  PV-SUB                         PIC S9(04)  VALUE +0      02400000
024100                                                    COMP SYNC.    02410000
024200     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      02420000
024300                                                    COMP SYNC.    02430000
024400     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      02440000
024500                                                    COMP-3.       02450000
024600     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      02460000
024700                                                    COMP SYNC.    02470000
024800     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      02480000
024900                                                    COMP-3.       02490000
025000     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      02500000
025100                                                    COMP-3.       02510000
025200     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      02520000
025300                                                    COMP-3.       02530000
025400     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      02540000
025500                                                    COMP-3.       02550000
025600     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      02560000
025700                                                    COMP-3.       02570000
025800     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      02580000
025900                                                    COMP-3.       02590000
026000     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      02600000
026100                                                    COMP SYNC.    02610000
026200     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      02620000
026300                                                    COMP SYNC.    02630000
026400     05  PV-ITEM                        PIC S9(04)  VALUE +0      02640000
026500                                                    COMP SYNC.    02650000
026600     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      02660000
026700                                                    COMP SYNC.    02670000
026800     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      02680000
026900                                                    COMP SYNC.    02690000
027000     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      02700000
027100                                                    COMP SYNC.    02710000
027200     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      02720000
027300                                                    COMP SYNC.    02730000
027400     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      02740000
027500                                                    COMP SYNC.    02750000
027600     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02760000
027700                                                    COMP SYNC.    02770000
027800     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02780000
027900                                                    COMP SYNC.    02790000
028000     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      02800000
028100                                                    COMP SYNC.    02810000
028200     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      02820000
028300                                                    COMP SYNC.    02830000
028400     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      02840000
028500                                                    COMP SYNC.    02850000
028600     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      02860000
028700                                                    COMP SYNC.    02870000
028800     05  PV-DUMMY-NBR                   PIC S9(04)  VALUE +0      02880000
028900                                                    COMP SYNC.    02890000
029000     05  PV-SUM-AL-CHRG                 PIC S9(11)V9(2)           02900000
029100                                                      COMP-3      02910000
029200                                                      VALUE +0.   02920000
029300     05  PV-SUM-AL-CHRG-ROUND           PIC S9(11)V9(2)           02930000
029400                                                      COMP-3      02940000
029500                                                      VALUE +0.   02950000
029600     05  PV-NET-INVC-AMT                PIC S9(09)V99 COMP-3      02960000
029700                                                      VALUE +0.   02970000
029800     05  PV-INVC-EXTD-AMT               PIC S9(09)V99  COMP-3     02980000
029900                                                      VALUE +0.   02990000
030000     05  PV-ENT-ID                      PIC S9(09)   USAGE COMP.  03000000
030100     05  PV-PO-NBR-Z                    PIC  Z(09).               03010000
030200     05  PV-PO-LNE-NBR-Z                PIC  Z(09).               03020000
030300     05  PV-TOTAL-INVC-QTY-Z            PIC  ZZ,ZZZ,ZZ9.          03030000
030400     05  PV-TOTAL-RCVD-QTY-Z            PIC  ZZ,ZZZ,ZZ9.          03040000
030500     05  PV-INVC-QTY-Z                  PIC  ZZZZZZ9.             03050000
030600     05  PV-RCVD-QTY-Z                  PIC  ZZZZZZ9.             03060000
030700     05  PV-INVC-UNIT-COST-Z            PIC  ZZZZZZ.99.           03070000
030800     05  PV-RCVD-UNIT-COST-Z            PIC  ZZZZZZ.99.           03080000
030900     05  PV-ADJU-UNIT-COST-Z            PIC  ZZZZZZ.99.           03090000
031000     05  PV-INVC-EXTD-AMT-Z             PIC  ZZ,ZZZ,ZZ9.99.       03100000
031100     05  PV-RCVD-EXTD-AMT-Z             PIC  ZZ,ZZZ,ZZ9.99.       03110000
031200     05  PV-UNT-COST-SEL-CDE            PIC  X.                   03120000
031300     05  PV-NBR-RECDIS-ROWS-FOUND       PIC S9(05)  COMP-3.       03130000
031400     05  PV-NBR-INVOIC-ROWS-FOUND       PIC S9(05)  COMP-3.       03140000
031500                                                                  03150000
031600*----------------------------------------------------------------*03160000
031700*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.    *03170000
031800*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE            *03180000
031900*   APPLICATION-SPECIFIC COMMAREA.                               *03190000
032000*----------------------------------------------------------------*03200000
032100 01  LQW-LIST-QUEUE-WORK-AREA.                                    03210000
032200     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  03220000
032300     05  LQW-ITEM-ENTRIES               OCCURS 08 TIMES           03230000
032400                                        INDEXED BY LQW-IDX.       03240000
032500         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       03250000
032600         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               03260000
032700         10  LQW-SELECTED-SW            PIC  X(01).               03270000
032800             88  LQW-SELECT                         VALUE 'S'.    03280000
032900             88  LQW-DESELECT                       VALUE ' '.    03290000
033000         10  LQW-INVC-ID                PIC  X(21).               03300000
033100         10  LQW-INVC-QTY               PIC  9(09)  COMP.         03310000
033200         10  LQW-INVC-UNIT-COST         PIC S9(07)V9(3) COMP.     03320000
033300         10  LQW-RCVD-UNIT-COST         PIC S9(07)V9(3) COMP.     03330000
033400         10  LQW-ADJU-UNIT-COST         PIC S9(07)V9(3) COMP.     03340000
033500         10  LQW-INVC-LNE-NBR           PIC  9(09)  COMP.         03350000
033600         10  LQW-HOLD-IND               PIC  X.                   03360000
033700         10  LQW-STORE-NBR              PIC  9(4).                03370000
033800         10  LQW-PAYT-REQ-SEQ-NBR       PIC  9(09)   COMP.        03380000
033900         10  LQW-PAYT-REQ-LNE-NBR       PIC  9(09)   COMP.        03390000
034000     EJECT                                                        03400000
034100*---------------------------------------------------------------* 03410000
034200*  RECORD LAYOUT FOR THE INVOICE SELECTION TEMP STORAGE QUEUE.  * 03420000
034300*---------------------------------------------------------------* 03430000
034400                                                                  03440000
034500     COPY APWS301.                                                03450000
034600                                                                  03460000
034700     EJECT                                                        03470000
034800*---------------------------------------------------------------* 03480000
034900*    MAP LAYOUT                                                 * 03490000
035000*---------------------------------------------------------------* 03500000
035100                                                                  03510000
035200     COPY APKM331.                                                03520000
035300                                                                  03530000
035400 01  MR-OCCURS-LAYOUT                   REDEFINES  AP331AO.       03540000
035500     05  FILLER                         PIC X(212).               03550000
035600     05  MR-SCROLL-AREA                 OCCURS 08 TIMES.          03560000
035700         10  MR-SELECTL                 PIC S9(04) COMP.          03570000
035800         10  MR-SELECTA                 PIC  X(01).               03580000
035900         10  MR-SELECTC                 PIC  X(01).               03590000
036000         10  MR-SELECTH                 PIC  X(01).               03600000
036100         10  MR-SELECTI                 PIC  X(01).               03610000
036200                                                                  03620000
036300         10  MR-INVC-NBRL               PIC S9(04) COMP.          03630000
036400         10  MR-INVC-NBRA               PIC  X(01).               03640000
036500         10  MR-INVC-NBRC               PIC  X(01).               03650000
036600         10  MR-INVC-NBRH               PIC  X(01).               03660000
036700         10  MR-INVC-NBR                PIC  X(21).               03670000
036800                                                                  03680000
036900         10  MR-INVC-QTYL               PIC S9(04) COMP.          03690000
037000         10  MR-INVC-QTYA               PIC  X(01).               03700000
037100         10  MR-INVC-QTYC               PIC  X(01).               03710000
037200         10  MR-INVC-QTYH               PIC  X(01).               03720000
037300         10  MR-INVC-QTY.                                         03730000
037400             15  MR-INVC-QTY-9          PIC  ZZZZZZ9.             03740000
037500                                                                  03750000
037600         10  MR-INVC-UNIT-COSTL         PIC S9(04) COMP.          03760000
037700         10  MR-INVC-UNIT-COSTA         PIC  X(01).               03770000
037800         10  MR-INVC-UNIT-COSTC         PIC  X(01).               03780000
037900         10  MR-INVC-UNIT-COSTH         PIC  X(01).               03790000
038000         10  MR-INVC-UNIT-COST.                                   03800000
038100             15  MR-INVC-UNIT-COST-9    PIC  ZZZZZZ.99.           03810000
038200                                                                  03820000
038300         10  MR-RCVD-UNIT-COSTL         PIC S9(04) COMP.          03830000
038400         10  MR-RCVD-UNIT-COSTA         PIC  X(01).               03840000
038500         10  MR-RCVD-UNIT-COSTC         PIC  X(01).               03850000
038600         10  MR-RCVD-UNIT-COSTH         PIC  X(01).               03860000
038700         10  MR-RCVD-UNIT-COST.                                   03870000
038800             15  MR-RCVD-UNIT-COST-9    PIC  ZZZZZZ.99.           03880000
038900                                                                  03890000
039000         10  MR-ADJU-UNIT-COSTL         PIC S9(04) COMP.          03900000
039100         10  MR-ADJU-UNIT-COSTA         PIC  X(01).               03910000
039200         10  MR-ADJU-UNIT-COSTC         PIC  X(01).               03920000
039300         10  MR-ADJU-UNIT-COSTH         PIC  X(01).               03930000
039400         10  MR-ADJU-UNIT-COST.                                   03940000
039500             15  MR-ADJU-UNIT-COST-9    PIC  ZZZZZZ.99.           03950000
039600                                                                  03960000
039700         10  MR-INVC-LINEL              PIC S9(04) COMP.          03970000
039800         10  MR-INVC-LINEA              PIC  X(01).               03980000
039900         10  MR-INVC-LINEC              PIC  X(01).               03990000
040000         10  MR-INVC-LINEH              PIC  X(01).               04000000
040100         10  MR-INVC-LINE.                                        04010000
040200             15  MR-INVC-LINE-9         PIC  ZZZ9.                04020000
040300                                                                  04030000
040400         10  MR-HOLD-INDL               PIC S9(04) COMP.          04040000
040500         10  MR-HOLD-INDA               PIC  X(01).               04050000
040600         10  MR-HOLD-INDC               PIC  X(01).               04060000
040700         10  MR-HOLD-INDH               PIC  X(01).               04070000
040800         10  MR-HOLD-IND                PIC  X(01).               04080000
040900                                                                  04090000
041000     EJECT                                                        04100000
041100*---------------------------------------------------------------* 04110000
041200*    ATTRIBUTE SETTINGS COPYBOOK.                               * 04120000
041300*---------------------------------------------------------------* 04130000
041400                                                                  04140000
041500     COPY DPWS015.                                                04150000
041600                                                                  04160000
041700*---------------------------------------------------------------* 04170000
041800*    FUNCTION KEYS COPYBOOK.                                    * 04180000
041900*---------------------------------------------------------------* 04190000
042000                                                                  04200000
042100     COPY DPWS016.                                                04210000
042200                                                                  04220000
042300*---------------------------------------------------------------* 04230000
042400*    NUMERIC EDIT LAYOUT.                                       * 04240000
042500*---------------------------------------------------------------* 04250000
042600                                                                  04260000
042700     COPY DPWS010I.                                               04270000
042800 EJECT                                                            04280000
042900*---------------------------------------------------------------* 04290000
043000*    PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).   * 04300000
043100*---------------------------------------------------------------* 04310000
043200                                                                  04320000
043300     COPY DPWS030.                                                04330000
043310     COPY DPWS930.                                                04331008
043400 EJECT                                                            04340000
043500*---------------------------------------------------------------* 04350000
043600*    STANDARD COMMAREA.                                         * 04360000
043700*---------------------------------------------------------------* 04370000
043800                                                                  04380000
043900     COPY DPWS020.                                                04390000
044000     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                04400000
044100                                                                  04410000
044200*---------------------------------------------------------------* 04420000
044300* INTER-APPLICATION COMMAREA.                                   * 04430000
044400*---------------------------------------------------------------* 04440000
044500                                                                  04450000
044600         10  INTER-APPL-COMM-AREA       PIC X(200).               04460000
044700     COPY APWS300.                                                04470000
044800                                                                  04480000
044900*---------------------------------------------------------------* 04490000
045000*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 04500000
045100*---------------------------------------------------------------* 04510000
045200         10  ASC-SPECIFIC-COMMAREA.                               04520000
045300             15  ASC-LIST-KEYS.                                   04530000
045400                 20  ASC-KEY-STR-NBR-X.                           04540000
045500                     25  ASC-KEY-STR-NBR             PIC 9(4).    04550000
045600                 20  ASC-KEY-DC-NBR-X.                            04560000
045700                     25  ASC-KEY-DC-NBR              PIC 9(4).    04570000
045800                 20  ASC-KEY-PO-NBR                  PIC S9(09)   04580000
045900                                                     COMP.        04590000
046000                 20  ASC-KEY-PO-LNE-NBR              PIC S9(09)   04600000
046100                                                     COMP.        04610000
046200             15  ASC-AP-HEADER-INFO.                              04620000
046300                 20  ASC-VENDOR-NAME                 PIC  X(25).  04630000
046400                 20  ASC-VENDOR-STYLE                PIC  X(15).  04640000
046500                 20  ASC-DEPT-NBR                    PIC  X(03).  04650000
046600                 20  ASC-AP-TOTAL-FIELDS.                         04660000
046700                     25  ASC-TOTAL-INVC-QTY          PIC 9(09)    04670000
046800                                                     COMP-3.      04680000
046900                     25  ASC-TOTAL-RCVD-QTY          PIC 9(09)    04690000
047000                                                     COMP-3.      04700000
047100                     25  ASC-INVC-EXTD-AMT           PIC 9(09)V99 04710000
047200                                                     COMP-3.      04720000
047300                     25  ASC-RCVD-EXTD-AMT           PIC 9(09)V99 04730000
047400                                                     COMP-3.      04740000
047500                     25  ASC-LOWEST-UNIT-COST        PIC S9(07)V9904750000
047600                                                     COMP-3.      04760000
047700                                                                  04770000
047800                 20  ASC-RCVS-INCOMPLETE-IND         PIC X.       04780000
047900                 20  ASC-ALLW-CHARGE-IND             PIC X.       04790000
048000                 20  ASC-MTCH-LVL-CDE                PIC X.       04800000
048100                                                                  04810000
048200             15  ASC-SELECTED-ITEM-FIELDS.                        04820000
048300                 20  ASC-SEL-PAYT-REQ-SEQ-NBR PIC  S9(09) COMP.   04830000
048400                 20  ASC-SEL-PAYT-REQ-LNE-NBR PIC  S9(09) COMP.   04840000
048500                 20  ASC-SEL-INVC-ID          PIC  X(22).         04850000
048600                 20  ASC-SEL-STORE-NBR        PIC  X(04).         04860000
048700                 20  ASC-SEL-INVC-UNIT-QTY    PIC  S9(09)         04870000
048800                                                   COMP.          04880000
048900                 20  ASC-SEL-INVC-UNIT-COST   PIC  S9(07)V9(3)    04890000
049000                                                   COMP-3.        04900000
049100                 20  ASC-SEL-RCVD-UNIT-COST   PIC  S9(07)V9(3)    04910000
049200                                                   COMP-3.        04920000
049300             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                04930000
049400                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  04940000
049500                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   04950000
049600                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   04960000
049700                                                                  04970000
049800                 20  ASC-ITEM-ARRAY.                              04980000
049900                     25  ASC-ITEM-ENTRIES OCCURS 08 TIMES.        04990000
050000                         30  ASC-LIST-ITEM-NUMBER                 05000000
050100                                                     PIC S9(09)   05010000
050200                                                     COMP-3.      05020000
050300                         30  ASC-SELECTED-SW         PIC  X(01).  05030000
050400                             88  ASC-NO-SELECT       VALUE ' '.   05040000
050500                             88  ASC-SELECT          VALUE 'S'.   05050000
050600                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  05060000
050700                             88  ASC-VALID-SELECT    VALUE ' '    05070000
050800                                                           'S'    05080000
050900                                                           'B'    05090000
051000                                                           'E'.   05100000
051100                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   05110000
051200                             88  ASC-TEMP-SELECT     VALUE 'S'.   05120000
051300                             88  ASC-TEMP-BEGIN      VALUE 'B'.   05130000
051400                             88  ASC-TEMP-END        VALUE 'E'.   05140000
051500                                                                  05150000
051600                         30  ASC-INVC-ID             PIC  X(21).  05160000
051700                         30  ASC-INVC-QTY            PIC  9(09)   05170000
051800                                                          COMP.   05180000
051900                         30  ASC-INVC-UNIT-COST      PIC S9(7)V99905190000
052000                                                          COMP.   05200000
052100                         30  ASC-RCVD-UNIT-COST      PIC S9(7)V99905210000
052200                                                          COMP.   05220000
052300                         30  ASC-ADJU-UNIT-COST      PIC S9(7)V99905230000
052400                                                          COMP.   05240000
052500                         30  ASC-INVC-LNE-NBR        PIC  9(09)   05250000
052600                                                          COMP.   05260000
052700                         30  ASC-HOLD-IND            PIC X.       05270000
052800                         30  ASC-STORE-NBR           PIC 9(4).    05280000
052900                         30  ASC-PAYT-REQ-SEQ-NBR    PIC 9(09)    05290000
053000                                                          COMP.   05300000
053100                         30  ASC-PAYT-REQ-LNE-NBR    PIC 9(09)    05310000
053200                                                          COMP.   05320000
053300                                                                  05330000
053400             15  ASC-BLK-SUB                         PIC S9(04)   05340000
053500                                                          COMP    05350000
053600                                                          SYNC.   05360000
053700             15  ASC-ITEM-SUB                        PIC S9(04)   05370000
053800                                                          COMP    05380000
053900                                                          SYNC.   05390000
054000             15  ASC-SEL-SUB                         PIC S9(04)   05400000
054100                                                          COMP.   05410000
054200             15  ASC-SEL-ITEM                        PIC S9(04)   05420000
054300                                                          COMP.   05430000
054400             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   05440000
054500                                                          COMP-3. 05450000
054600             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   05460000
054700                                                          COMP-3. 05470000
054800             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   05480000
054900                                                          COMP-3. 05490000
055000             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   05500000
055100                                                          COMP-3. 05510000
055200             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   05520000
055300                                                          COMP-3. 05530000
055400             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   05540000
055500                                                          COMP-3. 05550000
055600             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   05560000
055700                                                          COMP    05570000
055800                                                          SYNC.   05580000
055900             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   05590000
056000                                                          COMP-3. 05600000
056100             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   05610000
056200                                                          COMP-3. 05620000
056300             15  ASC-AP002-IDX                       PIC S9(04)   05630000
056400                                                         COMP.    05640000
056500             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  05650000
056600                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   05660000
056700                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   05670000
056800             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  05680000
056900                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   05690000
057000                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   05700000
057100             15  ASC-LIST-QUEUE-NAME.                             05710000
057200                 20  ASC-LIST-TERM-ID                PIC  X(04).  05720000
057300                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   05730000
057400                                                          COMP-3. 05740000
057500                 20  ASC-LIST-SEQ                    PIC  9(01).  05750000
057600             15  ASC-SEL-QUEUE-NAME-IN   PIC X(08).               05760000
057700             15  ASC-SEL-QUEUE-NAME-OUT.                          05770000
057800                 20  ASC-SEL-TERM-ID-OUT PIC X(04).               05780000
057900                 20  ASC-SEL-TASK-NUMBER-OUT                      05790000
058000                                         PIC S9(05) COMP-3.       05800000
058100                 20  ASC-SEL-SEQ-OUT     PIC 9(01).               05810000
058200                                                                  05820000
058300             15  ASC-CURSOR-SW                       PIC  X(01).  05830000
058400                 88  ASC-INVC-ITEM-CSR               VALUE '1'.   05840000
058500                 88  ASC-INVC-ITEM-NULL-CSR          VALUE '2'.   05850000
058600                                                                  05860000
058700             15  ASC-COST-SEL-CDE-SW                 PIC  X(01).  05870000
058800                 88  ASC-COST-SEL-CDE-I              VALUE '1'.   05880000
058900                 88  ASC-COST-SEL-CDE-P              VALUE '2'.   05890000
059000                                                                  05900000
059100             15  ASC-START-ITEM-REQUEST.                          05910000
059200                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  05920000
059300             15  ASC-SELECTED-ALL-INVCS-SW           PIC  X(01).  05930000
059400                 88  ASC-SELECTED-ALL-INVCS          VALUE 'Y'.   05940000
059500                 88  ASC-NOT-SELECTED-ALL-INVCS      VALUE 'N'.   05950000
059600     EJECT                                                        05960000
059700*---------------------------------------------------------------* 05970000
059800*    ABEND PROCESSING COPYBOOK.                                 * 05980000
059900*---------------------------------------------------------------* 05990000
060000                                                                  06000000
060100     COPY DPWS013.                                                06010000
060200                                                                  06020000
060300 EJECT                                                            06030000
060400*---------------------------------------------------------------* 06040000
060500*    DB2 AREA FOR PAYMENT REQUEST TABLE                         * 06050000
060600*---------------------------------------------------------------* 06060000
060700     EXEC SQL                                                     06070000
060800          INCLUDE TPAYREQ                                         06080000
060900     END-EXEC.                                                    06090000
061000                                                                  06100000
061100*---------------------------------------------------------------* 06110000
061200*    DB2 AREA FOR INVOICE TABLE                                 * 06120000
061300*---------------------------------------------------------------* 06130000
061400     EXEC SQL                                                     06140000
061500          INCLUDE TINVOIC                                         06150000
061600     END-EXEC.                                                    06160000
061700                                                                  06170000
061800*---------------------------------------------------------------* 06180000
061900*    DB2 AREA FOR MERCHANDISE INVOICE TABLE                     * 06190000
062000*---------------------------------------------------------------* 06200000
062100     EXEC SQL                                                     06210000
062200          INCLUDE TMDINVC                                         06220000
062300     END-EXEC.                                                    06230000
062400                                                                  06240000
062500*---------------------------------------------------------------* 06250000
062600*    DB2 AREA FOR PAYMENT REQUEST ITEM TABLE                    * 06260000
062700*---------------------------------------------------------------* 06270000
062800     EXEC SQL                                                     06280000
062900          INCLUDE TPREQIT                                         06290000
063000     END-EXEC.                                                    06300000
063100                                                                  06310000
063200*---------------------------------------------------------------* 06320000
063300*    DB2 AREA FOR MERCHANDISE INVOICE ITEM TABLE                * 06330000
063400*---------------------------------------------------------------* 06340000
063500     EXEC SQL                                                     06350000
063600          INCLUDE TMIITEM                                         06360000
063700     END-EXEC.                                                    06370000
063800                                                                  06380000
063900*---------------------------------------------------------------* 06390000
064000*    DB2 AREA FOR NON-INVOICED RECEIPTS TABLE                   * 06400000
064100*---------------------------------------------------------------* 06410000
064200     EXEC SQL                                                     06420000
064300          INCLUDE TNINREC                                         06430000
064400     END-EXEC.                                                    06440000
064500                                                                  06450000
064600*---------------------------------------------------------------* 06460000
064700*    DB2 AREA FOR PURCHASE ORDER TABLE                          * 06470000
064800*---------------------------------------------------------------* 06480000
064900     EXEC SQL                                                     06490000
065000          INCLUDE TPURCHS                                         06500000
065100     END-EXEC.                                                    06510000
065200                                                                  06520000
065300*---------------------------------------------------------------* 06530000
065400*    DB2 AREA FOR PURCHASE ORDER ITEM TABLE                     * 06540000
065500*---------------------------------------------------------------* 06550000
065600     EXEC SQL                                                     06560000
065700          INCLUDE TPURITM                                         06570000
065800     END-EXEC.                                                    06580000
065900                                                                  06590000
066000*---------------------------------------------------------------* 06600000
066100*    DB2 AREA FOR EXTERNAL ENTERPRISE TABLE                     * 06610000
066200*---------------------------------------------------------------* 06620000
066300     EXEC SQL                                                     06630000
066400          INCLUDE TEXTENT                                         06640000
066500     END-EXEC.                                                    06650000
066600                                                                  06660000
066700*---------------------------------------------------------------* 06670000
066800*    DB2 AREA FOR EXTERNAL ENTERPRISE NAME TABLE                * 06680000
066900*---------------------------------------------------------------* 06690000
067000     EXEC SQL                                                     06700000
067100          INCLUDE TENTNME                                         06710000
067200     END-EXEC.                                                    06720000
067300                                                                  06730000
067400*---------------------------------------------------------------* 06740000
067500*    DB2 AREA FOR RECEIVER TABLE                                * 06750000
067600*---------------------------------------------------------------* 06760000
067700     EXEC SQL                                                     06770000
067800          INCLUDE TRECEIV                                         06780000
067900     END-EXEC.                                                    06790000
068000                                                                  06800000
068100*---------------------------------------------------------------* 06810000
068200*    DB2 AREA FOR RECEIVER ITEM TABLE                           * 06820000
068300*---------------------------------------------------------------* 06830000
068400     EXEC SQL                                                     06840000
068500          INCLUDE TRECITM                                         06850000
068600     END-EXEC.                                                    06860000
068700                                                                  06870000
068800*---------------------------------------------------------------* 06880000
068900*    DB2 AREA FOR RECEIVER DISTRIBUTION TABLE                   * 06890000
069000*---------------------------------------------------------------* 06900000
069100     EXEC SQL                                                     06910000
069200          INCLUDE TRECDIS                                         06920000
069300     END-EXEC.                                                    06930000
069400                                                                  06940000
069500*---------------------------------------------------------------* 06950000
069600*    DB2 AREA FOR AP ALLOWANCE CHARGE TABLE                     * 06960000
069700*---------------------------------------------------------------* 06970000
069800     EXEC SQL                                                     06980000
069900          INCLUDE TALCHRG                                         06990000
070000     END-EXEC.                                                    07000000
070100                                                                  07010000
070200*---------------------------------------------------------------* 07020000
070300*    DB2 AREA FOR SYSDUMMY1                                     * 07030000
070400*---------------------------------------------------------------* 07040000
070500     EXEC SQL                                                     07050000
070600          INCLUDE SYSDUMMY                                        07060000
070700     END-EXEC.                                                    07070000
070800                                                                  07080000
070900*---------------------------------------------------------------* 07090000
071000*    DB2 AREA FOR COMMUNICATIONS                                * 07100000
071100*---------------------------------------------------------------* 07110000
071200     EXEC SQL                                                     07120000
071300          INCLUDE SQLCA                                           07130000
071400     END-EXEC.                                                    07140000
071500                                                                  07150000
071600*---------------------------------------------------------------* 07160000
071700*    RECEIPT ITEM CURSOR                                        * 07170000
071800*---------------------------------------------------------------* 07180000
071900                                                                  07190000
072000     EXEC SQL                                                     07200000
072100          DECLARE RECEIPT-ITEM-CSR  CURSOR                        07210000
072200          FOR SELECT                                              07220000
072300                C.AP_VERIFY_ITM_QTY                               07230000
072400              , D.PRD_1ST_COST_AMT                                07240000
072500          FROM  TRECEIV A                                         07250000
072600              , TRECITM B                                         07260000
072700              , TRECDIS C                                         07270000
072800              , TPURITM D                                         07280000
072900          WHERE A.ORD_NBR = :DK-PO-NBR                            07290000
073000            AND A.STATUS_CDE       =  'VE'                        07300000
073100            AND A.AP_PRC_CDE       =  ' '                         07310000
073200            AND A.FS_POST_TMST NOT IN                             07320000
073300                                   ('9999-09-09-09.09.09.999999') 07330000
073400            AND A.ORD_NBR = B.ORD_NBR                             07340000
073500            AND A.ORD_NBR = C.ORD_NBR                             07350000
073600            AND A.ORD_NBR = D.PO_NBR                              07360000
073700            AND C.AP_PRC_CDE       =  ' '                         07370000
073800            AND C.STR_NBR     BETWEEN :DK-STR-NBR-LOW             07380000
073900                                  AND :DK-STR-NBR-HIGH            07390000
074000            AND A.OPER_UNT_ID BETWEEN :DK-DC-NBR-LOW              07400000
074100                                  AND :DK-DC-NBR-HIGH             07410000
074200            AND A.VER_STATUS_CDE   =  'A'                         07420000
074300            AND B.VER_STATUS_CDE   =  'A'                         07430000
074400            AND C.VER_STATUS_CDE   =  'A'                         07440000
074500            AND A.REC_SEQ_NBR      = B.REC_SEQ_NBR                07450000
074600            AND A.REC_SEQ_NBR      = C.REC_SEQ_NBR                07460000
074700            AND B.OPER_UNT_ID      = C.OPER_UNT_ID                07470000
074800            AND B.FCLTY_ID         = C.FCLTY_ID                   07480000
074900            AND B.ORD_LNE_NBR      = :DK-PO-LNE-NBR               07490000
075000            AND B.ORD_LNE_NBR      = C.ORD_LNE_NBR                07500000
075100            AND B.ORD_LNE_NBR      = D.APP_PO_LNE_NBR             07510000
075200            AND B.PO_VER_NBR       = D.VER_NBR                    07520000
075300          UNION ALL                                               07530000
075400              SELECT                                              07540000
075500                 NON_INVC_UNT_QTY                                 07550000
075600               , UNT_COST_AMT                                     07560000
075700              FROM TNINREC                                        07570000
075800              WHERE PO_NBR         = :DK-PO-NBR                   07580000
075900                 AND PO_LNE_NBR    = :DK-PO-LNE-NBR               07590000
076000                 AND STR_NBR BETWEEN :DK-STR-NBR-LOW              07600000
076100                                 AND :DK-STR-NBR-HIGH             07610000
076200                 AND DC_NBR  BETWEEN :DK-DC-NBR-LOW               07620000
076300                                 AND :DK-DC-NBR-HIGH              07630000
076400                 AND STATUS_CDE    = ' '                          07640000
076500     END-EXEC.                                                    07650000
076600                                                                  07660000
076700*---------------------------------------------------------------* 07670000
076800*    CURSOR WHEN PO NUMBER IS PROVIDED (PO NBR = NOT NULL)      * 07680000
076900*---------------------------------------------------------------* 07690000
077000                                                                  07700000
077100     EXEC SQL                                                     07710000
077200          DECLARE INVC-ITEM-CSR CURSOR                            07720000
077300          FOR SELECT                                              07730000
077400                D.APP_PO_LNE_NBR                                  07740000
077500              , D.VEND_STYL_NAME                                  07750000
077600              , B.PAYT_REQ_LNE_NBR                                07760000
077700              , C.UNT_COST_SEL_CDE                                07770000
077800              , B.PAY_REQ_LNE_QTY                                 07780000
077900              , B.UNT_COST_AMT                                    07790000
078000              , E.PAYT_REQ_SEQ_NBR                                07800000
078100              , E.HOLD_IND                                        07810000
078200              , E.INVC_ID                                         07820000
078300              , E.STR_NBR                                         07830000
078400          FROM  TPREQIT B                                         07840000
078500              , TMIITEM C                                         07850000
078600              , TPURITM D                                         07860000
078700              , TINVOIC E                                         07870000
078800          WHERE E.PO_NBR           = :DK-PO-NBR                   07880000
078900            AND E.PO_NBR           IS NOT NULL                    07890000
079000            AND E.PO_NBR           =  D.PO_NBR                    07900000
079100            AND E.PAYT_REQ_SEQ_NBR =  B.PAYT_REQ_SEQ_NBR          07910000
079200            AND E.PAYT_REQ_SEQ_NBR =  C.PAYT_REQ_SEQ_NBR          07920000
079300            AND B.PAYT_REQ_LNE_NBR =  C.PAYT_REQ_LNE_NBR          07930000
079400            AND C.PO_LNE_NBR       IS NOT NULL                    07940000
079500            AND D.APP_PO_LNE_NBR   = :DK-PO-LNE-NBR               07950000
079600            AND C.PO_LNE_NBR       =  D.PO_LNE_NBR                07960000
079700            AND D.VER_STATUS_CDE   =  'A'                         07970000
079810            AND E.STATUS_CDE       IN ('EN','RC', 'PJ')           07981001
079820*           AND E.STATUS_CDE       IN ('EN','RC')                 07982002
079900            AND E.INVC_TYP_CDE     IN ('MI','RI')                 07990000
080000            AND E.STR_NBR    BETWEEN :DK-STR-NBR-LOW              08000000
080100                                 AND :DK-STR-NBR-HIGH             08010000
080200            AND E.DC_NBR     BETWEEN :DK-DC-NBR-LOW               08020000
080300                                 AND :DK-DC-NBR-HIGH              08030000
080400            AND E.MTCH_LVL_CDE     = :DK-MTCH-LVL-CDE             08040000
080500          ORDER BY                                                08050000
080600                E.INVC_ID                                         08060000
080700     END-EXEC.                                                    08070000
080800                                                                  08080000
080900*---------------------------------------------------------------* 08090000
081000*    CURSOR WHEN PO NUMBER IS PROVIDED (PO NBR = NULL)          * 08100000
081100*---------------------------------------------------------------* 08110000
081200                                                                  08120000
081300     EXEC SQL                                                     08130000
081400          DECLARE INVC-ITEM-NULL-CSR CURSOR                       08140000
081500          FOR SELECT                                              08150000
081600                B.PAYT_REQ_LNE_NBR                                08160000
081700              , C.UNT_COST_SEL_CDE                                08170000
081800              , B.PAY_REQ_LNE_QTY                                 08180000
081900              , B.UNT_COST_AMT                                    08190000
082000              , D.PAYT_REQ_SEQ_NBR                                08200000
082100              , D.HOLD_IND                                        08210000
082200              , D.INVC_ID                                         08220000
082300              , D.STR_NBR                                         08230000
082400          FROM  TPREQIT B                                         08240000
082500              , TMIITEM C                                         08250000
082600              , TINVOIC D                                         08260000
082700          WHERE D.PO_NBR           = :DK-PO-NBR                   08270000
082800            AND D.PO_NBR           IS NOT NULL                    08280000
082900            AND D.PAYT_REQ_SEQ_NBR =  B.PAYT_REQ_SEQ_NBR          08290000
083000            AND D.PAYT_REQ_SEQ_NBR =  C.PAYT_REQ_SEQ_NBR          08300000
083100            AND B.PAYT_REQ_LNE_NBR =  C.PAYT_REQ_LNE_NBR          08310000
083200            AND C.PO_LNE_NBR       IS NULL                        08320000
083310            AND D.STATUS_CDE       IN ('EN','RC','PJ')            08331001
083320*           AND D.STATUS_CDE       IN ('EN','RC')                 08332002
083400            AND D.INVC_TYP_CDE     IN ('MI','RI')                 08340000
083500            AND D.STR_NBR    BETWEEN :DK-STR-NBR-LOW              08350000
083600                                 AND :DK-STR-NBR-HIGH             08360000
083700            AND D.DC_NBR     BETWEEN :DK-DC-NBR-LOW               08370000
083800                                 AND :DK-DC-NBR-HIGH              08380000
083900            AND D.MTCH_LVL_CDE     = :DK-MTCH-LVL-CDE             08390000
084000          ORDER BY                                                08400000
084100                D.INVC_ID                                         08410000
084200     END-EXEC.                                                    08420000
084300                                                                  08430000
084400*---------------------------------------------------------------* 08440000
084500 EJECT                                                            08450000
084600 LINKAGE SECTION.                                                 08460000
084700                                                                  08470000
084800 01  DFHCOMMAREA.                                                 08480000
084900     05  FILLER                         OCCURS  1 TO 4072 TIMES   08490000
085000                                        DEPENDING ON EIBCALEN.    08500000
085100         10  FILLER                     PIC X.                    08510000
085200                                                                  08520000
085300 EJECT                                                            08530000
085400 PROCEDURE DIVISION.                                              08540000
085500                                                                  08550000
085600*----------------------------------------------------------------*08560000
085700*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM.  *08570000
085800*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM   *08580000
085900*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT.  *08590000
086000*----------------------------------------------------------------*08600000
086100                                                                  08610000
086200 0000-MAIN-MODULE.                                                08620000
086300                                                                  08630000
086400     INITIALIZE DP030-CICS-API-FIELDS.                            08640000
086500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       08650000
086600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          08660000
086700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         08670000
086800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       08680000
086900     MOVE LENGTH OF AP331AI        TO DP030-MAP-LENGTH (1).       08690000
087000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     08700000
087100                                                                  08710000
087200*    -- THE FOLLOWING IS TO HANDLE LOWER LEVEL PROGRAM'S          08720000
087300*    -- NEXT-APPL-ERROR WHEN THEY'RE NOT IN NEXT-ACT-INIT STATE   08730000
087400     SET DP030-OVERRIDE-APPL-ERROR TO TRUE.                       08740000
087500                                                                  08750000
087600     PERFORM 0001-CALL-CICS-ARCH-API.                             08760000
087700                                                                  08770000
087800     PERFORM 1000-CONTROL-PROCESSING                              08780000
087900                                                                  08790000
088000     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     08800000
088100     PERFORM 0001-CALL-CICS-ARCH-API.                             08810000
088200                                                                  08820000
088300*----------------------------------------------------------------*08830000
088400*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *08840000
088500*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *08850000
088600*----------------------------------------------------------------*08860000
088700                                                                  08870000
088800 0001-CALL-CICS-ARCH-API.                                         08880000
088900                                                                  08890000
089000     CALL DP930-CICS-ARCH-API  USING DFHEIBLK                     08900008
089100                                     DFHCOMMAREA                  08910008
089200                                     DP030-CICS-API-FIELDS        08920008
089300                                     DP020-STANDARD-COMMAREA      08930008
089400                                     AP331AI.                     08940008
089500                                                                  08950000
089600     IF  DP030-RC-CALL-SUCCESSFUL OR                              08960000
089700         DP030-RC-APPL-ERROR                                      08970000
089800         CONTINUE                                                 08980000
089900     ELSE                                                         08990000
090000         SET DP013-NO-ROLLBACK                                    09000000
090100             DP013-XCTL-DISPLAY-RESTART                           09010000
090200             DP013-CICS-ABEND      TO TRUE                        09020000
090300         MOVE '0001-CALL-CICS-ARCH-API'                           09030000
090400                                   TO DP013-PARAGRAPH             09040000
090610         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O09061008
090620-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      09062008
090700         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      09070000
090800         PERFORM DP013-0000-PROCESS-ABEND                         09080000
090900     END-IF.                                                      09090000
091000                                                                  09100000
091100*----------------------------------------------------------------*09110000
091200* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *09120000
091300* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *09130000
091400*                                                                *09140000
091500* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *09150000
091600*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *09160000
091700*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *09170000
091800*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *09180000
091900*----------------------------------------------------------------*09190000
092000                                                                  09200000
092100 1000-CONTROL-PROCESSING.                                         09210000
092200                                                                  09220000
092300     EVALUATE TRUE                                                09230000
092400                                                                  09240000
092500         WHEN DP020-NEXT-ACT-RETURN                               09250000
092600             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         09260000
092700             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                09270000
092800             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 09280000
092900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   09290000
093000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09300000
093100                                                                  09310000
093200         WHEN DP030-RC-APPL-ERROR                                 09320000
093300             PERFORM 2050-DELETE-LIST-QUEUE                       09330000
093400             INITIALIZE ASC-AP-TOTAL-FIELDS                       09340000
093500             PERFORM 4000-BUILD-INITIAL-PANEL                     09350000
093600                                                                  09360000
093700         WHEN DP020-NEXT-ACT-INITIAL                              09370000
093800             INITIALIZE ASC-SPECIFIC-COMMAREA                     09380000
093900             SET ASC-NOT-SELECTED-ALL-INVCS TO TRUE               09390000
094000             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            09400000
094100                                      ASC-SEL-TERM-ID-OUT         09410000
094200             MOVE DP020-SRC-TASK-NUMBER                           09420000
094300                                   TO ASC-LIST-TASK-NUMBER        09430000
094400                                      ASC-SEL-TASK-NUMBER-OUT     09440000
094500             MOVE PC-LIST-QUEUE-SEQ                               09450000
094600                                   TO ASC-LIST-SEQ                09460000
094700             MOVE PC-SEL-QUEUE-SEQ-OUT                            09470000
094800                                   TO ASC-SEL-SEQ-OUT             09480000
094900             PERFORM 1100-PROCESS-INTER-APPL-COMM                 09490000
095000             IF  PS-COMMAREA-NOT-VALID                            09500000
095100*                -- THIS WILL RETURN TO CALLING APPLICATION       09510000
095200*                -- WHEN API IS CALLED                            09520000
095300                 SET DP020-NEXT-ACT-APPL-ERROR                    09530000
095400                                   TO TRUE                        09540000
095500             ELSE                                                 09550000
095600                 PERFORM 4000-BUILD-INITIAL-PANEL                 09560000
095700             END-IF                                               09570000
095800                                                                  09580000
095900         WHEN DP020-NEXT-ACT-READ-MAP                             09590000
096000             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        09600000
096100                                   TO PV-TOP-ITEM                 09610000
096200             PERFORM 2000-PROCESS-PANEL                           09620000
096300                                                                  09630000
096400         WHEN OTHER                                               09640000
096500             SET DP013-LOGIC-ABEND TO TRUE                        09650000
096600             SET DP013-NO-ROLLBACK TO TRUE                        09660000
096700             MOVE '1000-CONTROL-PROCESSING'                       09670000
096800                                   TO DP013-PARAGRAPH             09680000
096900             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    09690000
097000                                   TO DP013-MESSAGE-TEXT(1)       09700000
097100             PERFORM DP013-0000-PROCESS-ABEND                     09710000
097200     END-EVALUATE.                                                09720000
097300                                                                  09730000
097400 EJECT                                                            09740000
097500*----------------------------------------------------------------*09750000
097600* EDIT DATA IN INTER-APPL COMMAREA.                              *09760000
097700*----------------------------------------------------------------*09770000
097800                                                                  09780000
097900 1100-PROCESS-INTER-APPL-COMM.                                    09790000
098000                                                                  09800000
098100     SET PS-COMMAREA-VALID         TO TRUE.                       09810000
098200     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     09820000
098300                                                                  09830000
098400     MOVE AP300-NUMBER-OF-SELECTED-ITEMS                          09840000
098500                              TO ASC-NUMBER-OF-SELECTED-ITEMS.    09850000
098600     MOVE AP300-NUMBER-OF-TS-ITEMS                                09860000
098700                              TO ASC-NUMBER-OF-TS-ITEMS.          09870000
098800     MOVE AP300-SEL-QUEUE-NAME                                    09880000
098900                              TO ASC-SEL-QUEUE-NAME-IN.           09890000
099000                                                                  09900000
099100     MOVE AP300-STORE-NBR     TO ASC-KEY-STR-NBR.                 09910000
099200     MOVE AP300-DC-NBR        TO ASC-KEY-DC-NBR.                  09920000
099300     MOVE AP300-MTCH-LVL-IND  TO ASC-MTCH-LVL-CDE.                09930000
099400                                                                  09940000
099500     EVALUATE TRUE                                                09950000
099600                                                                  09960000
099700         WHEN AP300-PO-NBR > ZERO                                 09970000
099800             IF AP300-PO-LNE-NBR  > ZEROS                         09980000
099900                MOVE AP300-PO-NBR      TO ASC-KEY-PO-NBR          09990000
100000                                          DK-PO-NBR               10000000
100100                MOVE AP300-PO-LNE-NBR  TO ASC-KEY-PO-LNE-NBR      10010000
100200                                          DK-PO-LNE-NBR           10020000
100300             ELSE                                                 10030000
100400                IF AP300-PO-LNE-NBR = ZEROS                       10040000
100500                   MOVE AP300-PO-NBR      TO  ASC-KEY-PO-NBR      10050000
100600                   MOVE AP300-PO-LNE-NBR  TO  ASC-KEY-PO-LNE-NBR  10060000
100700                ELSE                                              10070000
100800                   MOVE PC-TSYMSG-00330   TO DP020-MSG-NUMBER     10080000
100900                   SET DP020-MSG-FATAL    TO TRUE                 10090000
101000                   SET PS-COMMAREA-NOT-VALID                      10100000
101100                                          TO TRUE                 10110000
101200                END-IF                                            10120000
101300             END-IF                                               10130000
101400                                                                  10140000
101500         WHEN OTHER                                               10150000
101600*            -- ENTRY OF A FIELD REQUIRED --                      10160000
101700             MOVE PC-TSYMSG-00330      TO DP020-MSG-NUMBER        10170000
101800             SET DP020-MSG-FATAL       TO TRUE                    10180000
101900             SET PS-COMMAREA-NOT-VALID TO TRUE                    10190000
102000                                                                  10200000
102100     END-EVALUATE.                                                10210000
102200                                                                  10220000
102300 EJECT                                                            10230000
102400*----------------------------------------------------------------*10240000
102500* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *10250000
102600* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *10260000
102700* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *10270000
102800* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *10280000
102900* FUNCTION KEYS CAN GET THIS FAR.                                *10290000
103000*----------------------------------------------------------------*10300000
103100                                                                  10310000
103200 2000-PROCESS-PANEL.                                              10320000
103300                                                                  10330000
103400     EVALUATE TRUE                                                10340000
103500         WHEN DP020-SRC-AID = DP016-CLEAR                         10350000
103600             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    10360000
103700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   10370000
103800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10380000
103900                                                                  10390000
104000         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    10400000
104100             PERFORM 2050-DELETE-LIST-QUEUE                       10410000
104200             INITIALIZE ASC-AP-TOTAL-FIELDS                       10420000
104300             PERFORM 4000-BUILD-INITIAL-PANEL                     10430000
104400                                                                  10440000
104500         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    10450000
104600             PERFORM 2140-DESELECT-ALL-ITEMS                      10460000
104700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10470000
104800                                                                  10480000
104900         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  10490000
105000             PERFORM 2150-SELECT-ALL-ITEMS                        10500000
105100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10510000
105200                                                                  10520000
105300         WHEN OTHER                                               10530000
105400             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 10540000
105500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   10550000
105600             IF  PS-NO-ERROR                                      10560000
105700                 SET DP030-CONTINUE-GO                            10570000
105800                                TO TRUE                           10580000
105900                 PERFORM 2100-CHECK-FUNCTION-KEY                  10590000
106000             ELSE                                                 10600000
106100                 SET DP030-OVERRIDE-GO                            10610000
106200                                TO TRUE                           10620000
106300             END-IF                                               10630000
106400     END-EVALUATE.                                                10640000
106500 EJECT                                                            10650000
106600                                                                  10660000
106700*----------------------------------------------------------------*10670000
106800*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *10680000
106900*----------------------------------------------------------------*10690000
107000                                                                  10700000
107100 2050-DELETE-LIST-QUEUE.                                          10710000
107200                                                                  10720000
107300     EXEC CICS                                                    10730000
107400         DELETEQ TS                                               10740000
107500             QUEUE (ASC-LIST-QUEUE-NAME)                          10750000
107600             RESP  (PV-CICS-RESP)                                 10760000
107700     END-EXEC.                                                    10770000
107800                                                                  10780000
107900     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       10790000
108000        (PV-CICS-RESP = DFHRESP(QIDERR))                          10800000
108100         CONTINUE                                                 10810000
108200     ELSE                                                         10820000
108300         SET DP013-CICS-ABEND      TO TRUE                        10830000
108400         SET DP013-NO-ROLLBACK     TO TRUE                        10840000
108500                                                                  10850000
108600         MOVE '2050-DELETE-LIST-QUEUE'                            10860000
108700                                   TO DP013-PARAGRAPH             10870000
108800         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    10880000
108900                                   TO DP013-MESSAGE-TEXT (1)      10890000
109000         PERFORM DP013-0000-PROCESS-ABEND                         10900000
109100     END-IF.                                                      10910000
109200                                                                  10920000
109300     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  10930000
109400 EJECT                                                            10940000
109500                                                                  10950000
109600*----------------------------------------------------------------*10960000
109700* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*10970000
109800* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *10980000
109900* CICS ARCHITECTURE API.                                         *10990000
110000*----------------------------------------------------------------*11000000
110100                                                                  11010000
110200 2100-CHECK-FUNCTION-KEY.                                         11020000
110300                                                                  11030000
110400     EVALUATE TRUE                                                11040000
110500         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 11050000
110600             INITIALIZE AP300-INTER-APPL-COMMAREA                 11060000
110700             MOVE ASC-NUMBER-OF-SELECTED-ITEMS                    11070000
110800                                TO AP300-NUMBER-OF-SELECTED-ITEMS 11080000
110900             MOVE ASC-KEY-PO-NBR                                  11090000
111000                                TO AP300-PO-NBR                   11100000
111100             MOVE ASC-KEY-PO-LNE-NBR                              11110000
111200                                TO AP300-PO-LNE-NBR               11120000
111300             MOVE ASC-KEY-STR-NBR                                 11130000
111400                                TO AP300-STORE-NBR                11140000
111500             MOVE ASC-KEY-DC-NBR                                  11150000
111600                                TO AP300-DC-NBR                   11160000
111700                                                                  11170000
111800             MOVE ASC-SEL-INVC-ID TO AP300-INVC-ID                11180000
111900             MOVE ASC-SEL-PAYT-REQ-SEQ-NBR                        11190000
112000                                TO AP300-REC-SEQ-NBR              11200000
112100             MOVE ASC-SEL-PAYT-REQ-LNE-NBR                        11210000
112200                                TO AP300-PAYT-REQ-LNE-NBR         11220000
112300                                                                  11230000
112400             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              11240000
112500                 PERFORM 5000-PREPARE-SEL-QUEUE                   11250000
112600             END-IF                                               11260000
112700                                                                  11270000
112800         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  11280000
112900             MOVE +1               TO PV-TOP-ITEM                 11290000
113000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11300000
113100                                                                  11310000
113200         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   11320000
113300             PERFORM 2110-BROWSE-BACKWARD                         11330000
113400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11340000
113500             PERFORM 3200-RESET-ATTRIBUTES                        11350000
113600                                                                  11360000
113700         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   11370000
113800             PERFORM 2120-BROWSE-FORWARD                          11380000
113900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11390000
114000             PERFORM 3200-RESET-ATTRIBUTES                        11400000
114100                                                                  11410000
114200         WHEN DP020-SRC-AID = DP016-ENTER                         11420000
114300             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   11430000
114400             IF  PS-ERROR                                         11440000
114500                 CONTINUE                                         11450000
114600             ELSE                                                 11460000
114700                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             11470000
114800             END-IF                                               11480000
114900                                                                  11490000
115000**                                                                11500000
115100**       --- SELECT THE NEXT PO LINE NBR    --                    11510000
115200**                                                                11520000
115300         WHEN DP020-FK-LOCAL-FUNC-02  (DP020-SRC-AID)             11530000
115400             PERFORM 6200-DEL-LIST-QUEUE                          11540000
115500             PERFORM 2240-PREPARE-LIST-ENTRY                      11550000
115600                                                                  11560000
115700             PERFORM 2300-GET-NEXT-RECORD                         11570000
115800                UNTIL PS-TS-NEXT-PO-LNE-FND                       11580000
115900                   OR PS-TS-MAX-ITEMS-READ                        11590000
116000                                                                  11600000
116100             INITIALIZE ASC-AP-TOTAL-FIELDS                       11610000
116200             PERFORM 4000-BUILD-INITIAL-PANEL                     11620000
116300             PERFORM 3200-RESET-ATTRIBUTES                        11630000
116400                                                                  11640000
116500**                                                                11650000
116600**       --- SELECT THE PREV PO LINE NBR    --                    11660000
116700**                                                                11670000
116800         WHEN DP020-FK-LOCAL-FUNC-04  (DP020-SRC-AID)             11680000
116900             SET PS-FK22-KEY-INVOKED TO TRUE                      11690000
117000             PERFORM 6200-DEL-LIST-QUEUE                          11700000
117100             PERFORM 2240-PREPARE-LIST-ENTRY                      11710000
117200                                                                  11720000
117300             PERFORM 2330-GET-PO-LNE-NBR                          11730000
117400                UNTIL PS-TS-PREV-PO-LNE-FND                       11740000
117500                   OR PS-TS-MAX-ITEMS-READ                        11750000
117600                                                                  11760000
117700             INITIALIZE ASC-AP-TOTAL-FIELDS                       11770000
117800             PERFORM 4000-BUILD-INITIAL-PANEL                     11780000
117900             PERFORM 3200-RESET-ATTRIBUTES                        11790000
118000                                                                  11800000
118100         WHEN OTHER                                               11810000
118200*                --- INVALID FUNCTION KEY ---                     11820000
118300             SET DP013-NO-ROLLBACK                                11830000
118400                 DP013-XCTL-DISPLAY-RESTART                       11840000
118500                 DP013-CICS-ABEND  TO TRUE                        11850000
118600             MOVE '2100-CHECK-FUNCTION-KEY'                       11860000
118700                                   TO DP013-PARAGRAPH             11870000
118800             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      11880000
118900                                   TO DP013-MESSAGE-TEXT (1)      11890000
119000             PERFORM DP013-0000-PROCESS-ABEND                     11900000
119100     END-EVALUATE.                                                11910000
119200                                                                  11920000
119300*----------------------------------------------------------------*11930000
119400*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *11940000
119500*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *11950000
119600*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *11960000
119700*    MESSAGE.                                                    *11970000
119800*----------------------------------------------------------------*11980000
119900                                                                  11990000
120000 2110-BROWSE-BACKWARD.                                            12000000
120100                                                                  12010000
120200     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    12020000
120300         GIVING PV-TOP-ITEM.                                      12030000
120400                                                                  12040000
120500     IF  ((PV-TOP-ITEM < +1)                                      12050000
120600       OR (PV-TOP-ITEM = +1))                                     12060000
120700         MOVE +1                   TO PV-TOP-ITEM                 12070000
120800*        -- TOP OF LIST --                                        12080000
120900         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            12090000
121000         SET DP020-MSG-INFORMATIONAL TO TRUE                      12100000
121100     END-IF.                                                      12110000
121200                                                                  12120000
121300 EJECT                                                            12130000
121400*----------------------------------------------------------------*12140000
121500*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *12150000
121600*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *12160000
121700*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *12170000
121800*----------------------------------------------------------------*12180000
121900                                                                  12190000
122000 2120-BROWSE-FORWARD.                                             12200000
122100                                                                  12210000
122200     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              12220000
122300         GIVING PV-TOP-ITEM.                                      12230000
122400     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   12240000
122500         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            12250000
122600                                   TO PV-TOP-ITEM                 12260000
122700*        -- BOTTOM OF LIST --                                     12270000
122800         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            12280000
122900         SET DP020-MSG-INFORMATIONAL                              12290000
123000                                   TO TRUE                        12300000
123100     ELSE                                                         12310000
123200         COMPUTE PV-BOTTOM-ITEM =                                 12320000
123300             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 12330000
123400         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            12340000
123500*            -- BOTTOM OF LIST --                                 12350000
123600             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            12360000
123700             SET DP020-MSG-INFORMATIONAL                          12370000
123800                                   TO TRUE                        12380000
123900         END-IF                                                   12390000
124000     END-IF.                                                      12400000
124100 EJECT                                                            12410000
124200                                                                  12420000
124300*----------------------------------------------------------------*12430000
124400*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *12440000
124500*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *12450000
124600*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *12460000
124700*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *12470000
124800*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *12480000
124900*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *12490000
125000*----------------------------------------------------------------*12500000
125100                                                                  12510000
125200 2130-CHECK-FOR-JUMP-BROWSE.                                      12520000
125300                                                                  12530000
125400     SET PS-NO-ERROR               TO TRUE.                       12540000
125500     IF (ASC-START-ITEM-REQUEST = SPACE)                          12550000
125600         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            12560000
125700                                   TO PV-TOP-ITEM                 12570000
125800     ELSE                                                         12580000
125900         MOVE ASC-START-ITEM-REQUEST                              12590000
126000                                   TO DP010I-UNEDITED-FIELD       12600000
126100         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       12610000
126200         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     12620000
126300         SET DP010I-NEGATIVE-NOT-ALLOWED                          12630000
126400                                   TO TRUE                        12640000
126520         CALL DP010I-NUMERIC-EDIT-ROUTINE                         12652004
126530                         USING DP010I-NUMERIC-EDIT-AREA           12653004
126600                                                                  12660000
126700         IF  NOT DP010I-ERROR-DETECTED                            12670000
126800             MOVE DP010I-NUMERIC-FIELD                            12680000
126900                                   TO  ASC-START-ITEM-REQUEST-N   12690000
127000             IF  ASC-START-ITEM-REQUEST-N > ZERO                  12700000
127100                 IF  ASC-START-ITEM-REQUEST-N >                   12710000
127200                                          ASC-NUMBER-OF-ITEMS-READ12720000
127300                     MOVE SPACE TO ASC-START-ITEM-REQUEST         12730000
127400                     COMPUTE PV-TOP-ITEM =                        12740000
127500                             ASC-NUMBER-OF-ITEMS-READ             12750000
127600                             - PC-ITEMS-PER-PANEL + 1             12760000
127700                     IF  PV-TOP-ITEM < +1                         12770000
127800                         MOVE +1   TO PV-TOP-ITEM                 12780000
127900*                        -- BOTTOM OF LIST --                     12790000
128000                         MOVE PC-TSYMSG-00070                     12800000
128100                                   TO DP020-MSG-NUMBER            12810000
128200                         SET DP020-MSG-INFORMATIONAL              12820000
128300                                   TO TRUE                        12830000
128400                     END-IF                                       12840000
128500                 ELSE                                             12850000
128600                     MOVE ASC-START-ITEM-REQUEST-N                12860000
128700                                   TO PV-TOP-ITEM                 12870000
128800                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      12880000
128900                     COMPUTE PV-BOTTOM-ITEM =                     12890000
129000                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     12900000
129100                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ12910000
129200*                        -- BOTTOM OF LIST --                     12920000
129300                         MOVE PC-TSYMSG-00070                     12930000
129400                                   TO DP020-MSG-NUMBER            12940000
129500                         SET DP020-MSG-INFORMATIONAL              12950000
129600                                   TO TRUE                        12960000
129700                     END-IF                                       12970000
129800                 END-IF                                           12980000
129900             ELSE                                                 12990000
130000*                --- VALUE OUT OF RANGE ----                      13000000
130100                 MOVE PC-TSYMSG-00101                             13010000
130200                                   TO DP020-MSG-NUMBER            13020000
130300                 MOVE -1           TO ASTRTITL                    13030000
130400                 SET DP030-SET-CURSOR-APPL-1                      13040000
130500                                   TO TRUE                        13050000
130600                 MOVE DP015-REVERSE                               13060000
130700                                   TO ASTRTITH                    13070000
130800                 MOVE DP015-RED    TO ASTRTITC                    13080000
130900                 MOVE DP015-UNP-NUM-BRT-MDT                       13090000
131000                                   TO ASTRTITA                    13100000
131100                 SET DP020-MSG-FATAL                              13110000
131200                                   TO TRUE                        13120000
131300                 SET PS-ERROR      TO TRUE                        13130000
131400             END-IF                                               13140000
131500                                                                  13150000
131600         ELSE                                                     13160000
131700*            -- MUST BE NUMERIC --                                13170000
131800             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            13180000
131900             MOVE -1               TO ASTRTITL                    13190000
132000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  13200000
132100             MOVE DP015-REVERSE    TO ASTRTITH                    13210000
132200             MOVE DP015-RED        TO ASTRTITC                    13220000
132300             MOVE DP015-UNP-NUM-BRT-MDT                           13230000
132400                                   TO ASTRTITA                    13240000
132500             SET DP020-MSG-FATAL   TO TRUE                        13250000
132600             SET PS-ERROR          TO TRUE                        13260000
132700         END-IF                                                   13270000
132800     END-IF.                                                      13280000
132900 EJECT                                                            13290000
133000                                                                  13300000
133100*----------------------------------------------------------------*13310000
133200*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *13320000
133300*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *13330000
133400*----------------------------------------------------------------*13340000
133500                                                                  13350000
133600 2140-DESELECT-ALL-ITEMS.                                         13360000
133700                                                                  13370000
133800     MOVE +1                       TO ASC-BLK-SUB.                13380000
133900                                                                  13390000
134000     PERFORM 2141-CLEAR-SELECTED-INDS                             13400000
134100         VARYING ASC-ITEM-SUB                                     13410000
134200         FROM 1 BY 1                                              13420000
134300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13430000
134400                                                                  13440000
134500     ADD +1                        TO ASC-BLK-SUB.                13450000
134600                                                                  13460000
134700     PERFORM 2141-CLEAR-SELECTED-INDS                             13470000
134800         VARYING ASC-ITEM-SUB                                     13480000
134900         FROM 1 BY 1                                              13490000
135000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13500000
135100                                                                  13510000
135200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               13520000
135300                                   TO PV-LIST-ITEM-NUMBER.        13530000
135400                                                                  13540000
135500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            13550000
135600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    13560000
135700                                                                  13570000
135800     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     13580000
135900        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      13590000
136000         MOVE +1                   TO ASC-BLK-SUB                 13600000
136100                                                                  13610000
136200         PERFORM 5100-WRITE-TEMP-STORAGE                          13620000
136300                                                                  13630000
136400         MOVE +1                   TO PV-BLOCK-NUMBER             13640000
136500                                                                  13650000
136600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         13660000
136700             PV-FIRST-BLOCK-IN-ARRAY - 1                          13670000
136800                                                                  13680000
136900         PERFORM                                                  13690000
137000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       13700000
137100                                                                  13710000
137200             PERFORM 4410-READ-TEMP-STORAGE                       13720000
137300                                                                  13730000
137400             PERFORM 2141-CLEAR-SELECTED-INDS                     13740000
137500                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 13750000
137600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13760000
137700                                                                  13770000
137800             PERFORM 5100-WRITE-TEMP-STORAGE                      13780000
137900                                                                  13790000
138000             ADD +1                TO PV-BLOCK-NUMBER             13800000
138100                                                                  13810000
138200         END-PERFORM                                              13820000
138300                                                                  13830000
138400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         13840000
138500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     13850000
138600                                                                  13860000
138700         PERFORM                                                  13870000
138800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       13880000
138900                   ASC-HIGHEST-BLOCK-WRITTEN                      13890000
139000                                                                  13900000
139100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          13910000
139200                                   TO PV-BLOCK-NUMBER             13920000
139300                                                                  13930000
139400             PERFORM 4410-READ-TEMP-STORAGE                       13940000
139500                                                                  13950000
139600             PERFORM 2141-CLEAR-SELECTED-INDS                     13960000
139700                 VARYING ASC-ITEM-SUB                             13970000
139800                 FROM 1 BY 1                                      13980000
139900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13990000
140000                                                                  14000000
140100             PERFORM 5100-WRITE-TEMP-STORAGE                      14010000
140200                                                                  14020000
140300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      14030000
140400                                                                  14040000
140500         END-PERFORM                                              14050000
140600                                                                  14060000
140700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             14070000
140800                                   TO PV-BLOCK-NUMBER             14080000
140900                                                                  14090000
141000         PERFORM 4410-READ-TEMP-STORAGE                           14100000
141100     END-IF.                                                      14110000
141200                                                                  14120000
141300     SET ASC-NOT-SELECTED-ALL-INVCS TO TRUE.                      14130000
141400                                                                  14140000
141500     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 14150000
141600     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.14160000
141700     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  14170000
141800                                                                  14180000
141900     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        14190000
142000                                                                  14200000
142100 EJECT                                                            14210000
142200*----------------------------------------------------------------*14220000
142300*    MARK EACH ITEM AS BEING NOT SELECTED.                       *14230000
142400*----------------------------------------------------------------*14240000
142500                                                                  14250000
142600 2141-CLEAR-SELECTED-INDS.                                        14260000
142700                                                                  14270000
142800     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           14280000
142900             NOT EQUAL ZERO                                       14290000
143000         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          14300000
143100             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          14310000
143200                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    14320000
143300                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  14330000
143400                                   TO TRUE                        14340000
143500         END-IF                                                   14350000
143600     END-IF.                                                      14360000
143700                                                                  14370000
143800 EJECT                                                            14380000
143900*----------------------------------------------------------------*14390000
144000*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTION SWITCH *14400000
144100*  FOR ALL ITEMS.                                                *14410000
144200*----------------------------------------------------------------*14420000
144300                                                                  14430000
144400 2150-SELECT-ALL-ITEMS.                                           14440000
144500                                                                  14450000
144600     MOVE +1                       TO ASC-BLK-SUB.                14460000
144700                                                                  14470000
144800     PERFORM 2151-SET-SELECTED-INDS                               14480000
144900         VARYING ASC-ITEM-SUB                                     14490000
145000         FROM 1 BY 1                                              14500000
145100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14510000
145200                                                                  14520000
145300     ADD +1                        TO ASC-BLK-SUB.                14530000
145400                                                                  14540000
145500     PERFORM 2151-SET-SELECTED-INDS                               14550000
145600         VARYING ASC-ITEM-SUB                                     14560000
145700         FROM 1 BY 1                                              14570000
145800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14580000
145900                                                                  14590000
146000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               14600000
146100                                   TO PV-LIST-ITEM-NUMBER.        14610000
146200                                                                  14620000
146300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            14630000
146400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    14640000
146500                                                                  14650000
146600     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     14660000
146700        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    14670000
146800         MOVE +1                   TO ASC-BLK-SUB                 14680000
146900                                                                  14690000
147000         PERFORM 5100-WRITE-TEMP-STORAGE                          14700000
147100                                                                  14710000
147200         MOVE +1                   TO PV-BLOCK-NUMBER             14720000
147300                                                                  14730000
147400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         14740000
147500             PV-FIRST-BLOCK-IN-ARRAY - 1                          14750000
147600                                                                  14760000
147700         PERFORM                                                  14770000
147800             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       14780000
147900                                                                  14790000
148000             PERFORM 4410-READ-TEMP-STORAGE                       14800000
148100                                                                  14810000
148200             PERFORM 2151-SET-SELECTED-INDS                       14820000
148300                 VARYING ASC-ITEM-SUB                             14830000
148400                 FROM 1 BY 1                                      14840000
148500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14850000
148600                                                                  14860000
148700             PERFORM 5100-WRITE-TEMP-STORAGE                      14870000
148800                                                                  14880000
148900             ADD +1                TO PV-BLOCK-NUMBER             14890000
149000                                                                  14900000
149100         END-PERFORM                                              14910000
149200                                                                  14920000
149300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         14930000
149400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     14940000
149500                                                                  14950000
149600         PERFORM                                                  14960000
149700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       14970000
149800                   ASC-HIGHEST-BLOCK-WRITTEN                      14980000
149900                                                                  14990000
150000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          15000000
150100                                   TO PV-BLOCK-NUMBER             15010000
150200                                                                  15020000
150300             PERFORM 4410-READ-TEMP-STORAGE                       15030000
150400                                                                  15040000
150500             PERFORM 2151-SET-SELECTED-INDS                       15050000
150600                 VARYING ASC-ITEM-SUB                             15060000
150700                 FROM 1 BY 1                                      15070000
150800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15080000
150900                                                                  15090000
151000             PERFORM 5100-WRITE-TEMP-STORAGE                      15100000
151100                                                                  15110000
151200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      15120000
151300                                                                  15130000
151400         END-PERFORM                                              15140000
151500                                                                  15150000
151600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             15160000
151700                                   TO PV-BLOCK-NUMBER             15170000
151800                                                                  15180000
151900         PERFORM 4410-READ-TEMP-STORAGE                           15190000
152000     END-IF.                                                      15200000
152100                                                                  15210000
152200     SET ASC-SELECTED-ALL-INVCS    TO TRUE.                       15220000
152300                                                                  15230000
152400     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             15240000
152500                       ASC-NUMBER-OF-SELECTED-ITEMS.              15250000
152600                                                                  15260000
152700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        15270000
152800                                                                  15280000
152900 EJECT                                                            15290000
153000*----------------------------------------------------------------*15300000
153100*    MARK EACH ITEM AS BEING SELECTED.                           *15310000
153200*----------------------------------------------------------------*15320000
153300                                                                  15330000
153400 2151-SET-SELECTED-INDS.                                          15340000
153500                                                                  15350000
153600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           15360000
153700             NOT EQUAL ZERO                                       15370000
153800         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             15380000
153900             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             15390000
154000                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        15400000
154100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  15410000
154200                               TO  TRUE                           15420000
154300         END-IF                                                   15430000
154400     END-IF.                                                      15440000
154500                                                                  15450000
154600*----------------------------------------------------------------*15460000
154700*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *15470000
154800*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *15480000
154900*----------------------------------------------------------------*15490000
155000                                                                  15500000
155100 2200-MOVE-SCREEN-TO-COMMAREA.                                    15510000
155200                                                                  15520000
155300     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             15530000
155400     MOVE +1                       TO PV-SUB.                     15540000
155500                                                                  15550000
155600     PERFORM 3100-SET-SUBSCRIPTS.                                 15560000
155700     IF  ASTRTITL > ZERO                                          15570000
155800         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          15580000
155900     ELSE                                                         15590000
156000         IF  ASTRTITF = DP015-ERASE-EOF                           15600000
156100             INITIALIZE ASC-START-ITEM-REQUEST                    15610000
156200         END-IF                                                   15620000
156300     END-IF.                                                      15630000
156400     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          15640000
156500         VARYING PV-SUB                                           15650000
156600         FROM 1 BY 1                                              15660000
156700         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      15670000
156800                                                                  15680000
156900*----------------------------------------------------------------*15690000
157000*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *15700000
157100*----------------------------------------------------------------*15710000
157200                                                                  15720000
157300 2210-MOVE-LINES-TO-COMMAREA.                                     15730000
157400                                                                  15740000
157500     IF  MR-SELECTL (PV-SUB) > ZERO                               15750000
157600         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             15760000
157700         MOVE MR-SELECTI (PV-SUB)                                 15770000
157800                                   TO ASC-TEMP-SELECTED-SW        15780000
157900                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      15790000
158000     ELSE                                                         15800000
158100         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                15810000
158200                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     15820000
158300                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        15830000
158400                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      15840000
158500         END-IF                                                   15850000
158600     END-IF.                                                      15860000
158700     ADD +1                        TO ASC-ITEM-SUB.               15870000
158800     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        15880000
158900         ADD +1                    TO ASC-BLK-SUB                 15890000
159000         MOVE +1                   TO ASC-ITEM-SUB                15900000
159100     END-IF.                                                      15910000
159200                                                                  15920000
159300*----------------------------------------------------------------*15930000
159400*  ENTRY IS FROM A LIST. GET THE KEYS FROM THE TEMP STORAGE      *15940000
159500*  QUEUE PASSED FROM THE LIST.                                   *15950000
159600*----------------------------------------------------------------*15960000
159700                                                                  15970000
159800 2240-PREPARE-LIST-ENTRY.                                         15980000
159900                                                                  15990000
160000      MOVE AP301-MAX-ITEMS     TO ASC-SEL-SUB.                    16000000
160100      MOVE ZERO                TO ASC-SEL-ITEM.                   16010000
160200                                                                  16020000
160300      SET PS-TS-MAX-ITEMS-NOT-READ    TO TRUE.                    16030000
160400      SET PS-TS-PO-LNE-NOT-FND        TO TRUE.                    16040000
160500      SET PS-TS-NEXT-PO-LNE-NOT-FND   TO TRUE.                    16050000
160600      SET PS-TS-PREV-PO-LNE-NOT-FND   TO TRUE.                    16060000
160700                                                                  16070000
160800                                                                  16080000
160900******************************************************************16090000
161000* GET THE KEYS OF THE NEXT SELECTED OBJECT FROM THE              *16100000
161100* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *16110000
161200******************************************************************16120000
161300 2300-GET-NEXT-RECORD.                                            16130000
161400                                                                  16140000
161500     ADD +1                        TO ASC-SEL-SUB.                16150000
161600     IF ASC-SEL-SUB > AP301-MAX-ITEMS                             16160000
161700         ADD +1                    TO ASC-SEL-ITEM                16170000
161800         MOVE +1                   TO ASC-SEL-SUB                 16180000
161900     END-IF.                                                      16190000
162000                                                                  16200000
162100     IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                 16210000
162200         PERFORM 9100-READ-SEL-QUEUE                              16220000
162300         IF AP301-ITEM (ASC-SEL-SUB) > ZERO                       16230000
162400                                                                  16240000
162500**          -- FIND THE NEXT PO LNE NUMBER --                     16250000
162600            IF PS-TS-PO-LNE-FND                                   16260000
162700               MOVE AP301-PO-NBR      (ASC-SEL-SUB)               16270000
162800                                   TO  ASC-KEY-PO-NBR             16280000
162900               MOVE AP301-PO-LNE-NBR  (ASC-SEL-SUB)               16290000
163000                                   TO  ASC-KEY-PO-LNE-NBR         16300000
163100               SET PS-TS-NEXT-PO-LNE-FND                          16310000
163200                                   TO  TRUE                       16320000
163300            END-IF                                                16330000
163400                                                                  16340000
163500**           -- FIND THE SELECTED PO LNE NUMBER --                16350000
163600             IF AP301-PO-NBR (ASC-SEL-SUB) = ASC-KEY-PO-NBR   AND 16360000
163700                AP301-PO-LNE-NBR (ASC-SEL-SUB) =                  16370000
163800                      ASC-KEY-PO-LNE-NBR                          16380000
163900                SET PS-TS-PO-LNE-FND   TO  TRUE                   16390000
164000             END-IF                                               16400000
164100**                                                                16410000
164200                                                                  16420000
164300             SET AP301-INQ (ASC-SEL-SUB)           TO TRUE        16430000
164400             PERFORM 9200-REWRITE-LIST-QUEUE                      16440000
164500                                                                  16450000
164600         ELSE                                                     16460000
164700             SUBTRACT +1 FROM ASC-SEL-SUB                         16470000
164800*            --- BOTTOM OF LIST ---                               16480000
164900             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            16490000
165000             SET DP020-MSG-INFORMATIONAL                          16500000
165100                                   TO TRUE                        16510000
165200             SET PS-TS-MAX-ITEMS-READ                             16520000
165300                                   TO TRUE                        16530000
165400         END-IF                                                   16540000
165500     ELSE                                                         16550000
165600         SUBTRACT +1 FROM ASC-SEL-ITEM                            16560000
165700         MOVE AP301-MAX-ITEMS      TO ASC-SEL-SUB                 16570000
165800         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            16580000
165900         SET DP020-MSG-INFORMATIONAL                              16590000
166000                                   TO TRUE                        16600000
166100         SET PS-TS-MAX-ITEMS-READ                                 16610000
166200                                   TO TRUE                        16620000
166300     END-IF.                                                      16630000
166400                                                                  16640000
166500******************************************************************16650000
166600* GET THE KEYS OF THE PREVIOUS SELECTED OBJECT FROM THE          *16660000
166700* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *16670000
166800******************************************************************16680000
166900 2330-GET-PO-LNE-NBR.                                             16690000
167000                                                                  16700000
167100     ADD +1                        TO ASC-SEL-SUB.                16710000
167200     IF ASC-SEL-SUB > AP301-MAX-ITEMS                             16720000
167300         ADD +1                    TO ASC-SEL-ITEM                16730000
167400         MOVE +1                   TO ASC-SEL-SUB                 16740000
167500     END-IF.                                                      16750000
167600                                                                  16760000
167700     IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                 16770000
167800         PERFORM 9100-READ-SEL-QUEUE                              16780000
167900         IF AP301-ITEM (ASC-SEL-SUB) > ZERO                       16790000
168000                                                                  16800000
168100**           -- FIND THE SELECTED PO LNE NUMBER --                16810000
168200             IF AP301-PO-NBR (ASC-SEL-SUB) = ASC-KEY-PO-NBR   AND 16820000
168300                AP301-PO-LNE-NBR (ASC-SEL-SUB) =                  16830000
168400                      ASC-KEY-PO-LNE-NBR                          16840000
168500                PERFORM 2335-GET-PREV-RECORD                      16850000
168600                   UNTIL PS-TS-PREV-PO-LNE-FND                    16860000
168700                      OR PS-TS-MAX-ITEMS-READ                     16870000
168800             END-IF                                               16880000
168900**                                                                16890000
169000                                                                  16900000
169100             SET AP301-INQ (ASC-SEL-SUB)           TO TRUE        16910000
169200             PERFORM 9200-REWRITE-LIST-QUEUE                      16920000
169300                                                                  16930000
169400         ELSE                                                     16940000
169500             SUBTRACT +1 FROM ASC-SEL-SUB                         16950000
169600*            --- BOTTOM OF LIST ---                               16960000
169700             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            16970000
169800             SET DP020-MSG-INFORMATIONAL                          16980000
169900                                   TO TRUE                        16990000
170000             SET PS-TS-MAX-ITEMS-READ                             17000000
170100                                   TO TRUE                        17010000
170200         END-IF                                                   17020000
170300     ELSE                                                         17030000
170400         SUBTRACT +1 FROM ASC-SEL-ITEM                            17040000
170500         MOVE AP301-MAX-ITEMS      TO ASC-SEL-SUB                 17050000
170600         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            17060000
170700         SET DP020-MSG-INFORMATIONAL                              17070000
170800                                   TO TRUE                        17080000
170900         SET PS-TS-MAX-ITEMS-READ                                 17090000
171000                                   TO TRUE                        17100000
171100     END-IF.                                                      17110000
171200                                                                  17120000
171300                                                                  17130000
171400******************************************************************17140000
171500* GET THE KEYS OF THE PREVIOUS SELECTED OBJECT FROM THE          *17150000
171600* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *17160000
171700******************************************************************17170000
171800 2335-GET-PREV-RECORD.                                            17180000
171900                                                                  17190000
172000     SUBTRACT +1 FROM ASC-SEL-SUB.                                17200000
172100     IF ASC-SEL-SUB < +1                                          17210000
172200         SUBTRACT +1 FROM ASC-SEL-ITEM                            17220000
172300         MOVE AP301-MAX-ITEMS      TO ASC-SEL-SUB                 17230000
172400     END-IF.                                                      17240000
172500                                                                  17250000
172600     IF ASC-SEL-ITEM > ZERO                                       17260000
172700        PERFORM 9100-READ-SEL-QUEUE                               17270000
172800                                                                  17280000
172900        MOVE AP301-PO-NBR      (ASC-SEL-SUB)                      17290000
173000                                   TO  ASC-KEY-PO-NBR             17300000
173100        MOVE AP301-PO-LNE-NBR  (ASC-SEL-SUB)                      17310000
173200                                   TO  ASC-KEY-PO-LNE-NBR         17320000
173300        SET PS-TS-PREV-PO-LNE-FND                                 17330000
173400                                   TO  TRUE                       17340000
173500                                                                  17350000
173600     ELSE                                                         17360000
173700         MOVE +1                   TO ASC-SEL-ITEM                17370000
173800                                      ASC-SEL-SUB                 17380000
173900*        --- TOP OF LIST ---                                      17390000
174000         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            17400000
174100         SET DP020-MSG-INFORMATIONAL                              17410000
174200                                   TO TRUE                        17420000
174300         SET PS-TS-MAX-ITEMS-READ                                 17430000
174400                                   TO TRUE                        17440000
174500     END-IF.                                                      17450000
174600                                                                  17460000
174700                                                                  17470000
174800*----------------------------------------------------------------*17480000
174900*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *17490000
175000*  COMMAREA (EDITING IS NOT DONE AGAINST THE SCREEN DIRECTLY).   *17500000
175100*----------------------------------------------------------------*17510000
175200                                                                  17520000
175300 3000-EDIT-DATA-IN-COMMAREA.                                      17530000
175400                                                                  17540000
175500     SET PS-NO-ERROR             TO TRUE.                         17550000
175600     PERFORM 3200-RESET-ATTRIBUTES.                               17560000
175700     MOVE ASC-ITEMS-DISPLAYED    TO PV-SUB.                       17570000
175800**                                                                17580000
175900* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              17590000
176000* EDITING IS DONE FROM THE BOTTOM UP.                             17600000
176100**                                                                17610000
176200     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       17620000
176300         ASC-ITEMS-DISPLAYED - 1.                                 17630000
176400     PERFORM 3100-SET-SUBSCRIPTS.                                 17640000
176500     PERFORM 3300-EDIT-SELECTIONS                                 17650000
176600         VARYING PV-SUB                                           17660000
176700         FROM PV-SUB BY -1                                        17670000
176800         UNTIL PV-SUB < +1.                                       17680000
176900                                                                  17690000
177000     IF PS-NO-ERROR AND                                           17700000
177100        (ASC-NUMBER-OF-SELECTED-ITEMS > 1) AND                    17710000
177200        (NOT DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID) AND           17720000
177300         NOT DP020-FK-NEXT-PAGE(DP020-SRC-AID) AND                17730000
177400         NOT DP020-FK-PREV-PAGE(DP020-SRC-AID))                   17740000
177500*       -- MORE THAN 1 ITEM WAS SELECTED --                       17750000
177600        MOVE PC-TSYMSG-00047   TO DP020-MSG-NUMBER                17760000
177700        SET PS-ERROR           TO  TRUE                           17770000
177800     END-IF.                                                      17780000
177900                                                                  17790000
178000*??  IF  PS-NO-ERROR                                              17800000
178100*??      PERFORM 3400-CHECK-RANGE-SEQUENCE                        17810000
178200*??  END-IF.                                                      17820000
178300                                                                  17830000
178400*??  IF  ((PS-NO-ERROR)                                           17840000
178500*??    AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   17850000
178600*??    AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    17860000
178700*??          PERFORM 3500-MARK-RANGE-AS-SELECTED                  17870000
178800*??  END-IF.                                                      17880000
178900 EJECT                                                            17890000
179000                                                                  17900000
179100*----------------------------------------------------------------*17910000
179200*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *17920000
179300*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*17930000
179400*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *17940000
179500*                                                                *17950000
179600*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *17960000
179700*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *17970000
179800*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *17980000
179900*    US IN THE 2ND BLOCK OF THE ARRAY.                           *17990000
180000*----------------------------------------------------------------*18000000
180100                                                                  18010000
180200 3100-SET-SUBSCRIPTS.                                             18020000
180300                                                                  18030000
180400     COMPUTE ASC-ITEM-SUB =                                       18040000
180500         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        18050000
180600                                                                  18060000
180700     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         18070000
180800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            18080000
180900                                                                  18090000
181000         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               18100000
181100     ELSE                                                         18110000
181200         MOVE +1                     TO ASC-BLK-SUB               18120000
181300     END-IF.                                                      18130000
181400*----------------------------------------------------------------*18140000
181500*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *18150000
181600*----------------------------------------------------------------*18160000
181700                                                                  18170000
181800 3200-RESET-ATTRIBUTES.                                           18180000
181900                                                                  18190000
182000     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   18200000
182100     MOVE DP015-GREEN              TO ASTRTITC.                   18210000
182200     MOVE DP015-UNDERLINE          TO ASTRTITH.                   18220000
182300                                                                  18230000
182400     PERFORM                                                      18240000
182500         VARYING PV-SUB                                           18250000
182600         FROM 1 BY 1                                              18260000
182700         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED                       18270000
182800*        UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        18280000
182900         MOVE DP015-UNP-ALP-NOR-OFF                               18290000
183000                                   TO MR-SELECTA (PV-SUB)         18300000
183100         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         18310000
183200         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         18320000
183300     END-PERFORM.                                                 18330000
183400                                                                  18340000
183500*----------------------------------------------------------------*18350000
183600*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *18360000
183700*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *18370000
183800*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITED OR      *18380000
183900*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *18390000
184000*----------------------------------------------------------------*18400000
184100                                                                  18410000
184200 3300-EDIT-SELECTIONS.                                            18420000
184300                                                                  18430000
184400     EVALUATE TRUE                                                18440000
184500         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     18450000
184600             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         18460000
184700                 CONTINUE                                         18470000
184800                                                                  18480000
184900         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         18490000
185000             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        18500000
185100                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   18510000
185200                 MOVE ASC-TEMP-SELECTED-SW                        18520000
185300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18530000
185400                                TO ASC-SELECTED-SW                18540000
185500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18550000
185600                 PERFORM 3305-FILL-IN-HOLD-AREA-FLDS              18560000
185700             END-IF                                               18570000
185800                                                                  18580000
185900         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     18590000
186000                 = SPACE                                          18600000
186100             EVALUATE TRUE                                        18610000
186200                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       18620000
186300                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS18630000
186400                     MOVE SPACE TO ASC-SELECTED-SW                18640000
186500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18650000
186600*                WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        18660000
186700*                    MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    18670000
186800*                    MOVE SPACE TO ASC-SELECTED-SW                18680000
186900*                                     (ASC-BLK-SUB ASC-ITEM-SUB)  18690000
187000*                WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          18700000
187100*                    MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      18710000
187200*                    MOVE SPACE TO ASC-SELECTED-SW                18720000
187300*                                     (ASC-BLK-SUB ASC-ITEM-SUB)  18730000
187400             END-EVALUATE                                         18740000
187500*        WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           18750000
187600*            IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            18760000
187700*                SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    18770000
187800*            END-IF                                               18780000
187900*            PERFORM 3310-EDIT-RANGE                              18790000
188000*        WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             18800000
188100*            IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            18810000
188200*                SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    18820000
188300*            END-IF                                               18830000
188400*            PERFORM 3310-EDIT-RANGE                              18840000
188500*        WHEN OTHER                                               18850000
188600*            -- INVALID VALUE --                                  18860000
188700*            MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           18870000
188800*            SET DP020-MSG-FATAL    TO TRUE                       18880000
188900*            MOVE -1                TO MR-SELECTL (PV-SUB)        18890000
189000*            SET DP030-SET-CURSOR-APPL-1                          18900000
189100*                                   TO TRUE                       18910000
189200*            MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        18920000
189300*            MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        18930000
189400*            SET PS-ERROR TO TRUE                                 18940000
189500*            IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            18950000
189600*                SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     18960000
189700*                MOVE SPACE         TO ASC-SELECTED-SW            18970000
189800*                                       (ASC-BLK-SUB ASC-ITEM-SUB)18980000
189900*            END-IF                                               18990000
190000     END-EVALUATE.                                                19000000
190100                                                                  19010000
190200                                                                  19020000
190300     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 19030000
190400     SUBTRACT +1 FROM ASC-ITEM-SUB.                               19040000
190500     IF  ASC-ITEM-SUB < 1                                         19050000
190600         SUBTRACT +1 FROM ASC-BLK-SUB                             19060000
190700         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                19070000
190800     END-IF.                                                      19080000
190900                                                                  19090000
191000                                                                  19100000
191100                                                                  19110000
191200*----------------------------------------------------------------*19120000
191300*  -- MOVE THE SEQ AND LNE NBR, AND THE INVC/RCVD UNIT COST --   *19130000
191400*  -- AMTS TO HOLD AREAS FOR A POSSIBLE TMIITEM UPDATE.     --   *19140000
191500*  -- THE INVOICE ID AND STORE NBR FIELDS ARE MOVED TO HOLD --   *19150000
191600*  -- AREAS FOR A POSSIBLE LOCAL GOTO CONDITION.            --   *19160000
191700*----------------------------------------------------------------*19170000
191800                                                                  19180000
191900 3305-FILL-IN-HOLD-AREA-FLDS.                                     19190000
192000                                                                  19200000
192100                                                                  19210000
192200     MOVE ASC-PAYT-REQ-SEQ-NBR                                    19220000
192300                               (ASC-BLK-SUB ASC-ITEM-SUB)         19230000
192400                            TO ASC-SEL-PAYT-REQ-SEQ-NBR.          19240000
192500     MOVE ASC-INVC-LNE-NBR                                        19250000
192600                               (ASC-BLK-SUB ASC-ITEM-SUB)         19260000
192700                            TO ASC-SEL-PAYT-REQ-LNE-NBR.          19270000
192800                                                                  19280000
192900     MOVE ASC-INVC-QTY         (ASC-BLK-SUB ASC-ITEM-SUB)         19290000
193000                            TO ASC-SEL-INVC-UNIT-QTY.             19300000
193100                                                                  19310000
193200     MOVE ASC-INVC-UNIT-COST                                      19320000
193300                               (ASC-BLK-SUB ASC-ITEM-SUB)         19330000
193400                            TO ASC-SEL-INVC-UNIT-COST             19340000
193500     MOVE ASC-RCVD-UNIT-COST                                      19350000
193600                               (ASC-BLK-SUB ASC-ITEM-SUB)         19360000
193700                            TO ASC-SEL-RCVD-UNIT-COST             19370000
193800     MOVE ASC-INVC-ID                                             19380000
193900                               (ASC-BLK-SUB ASC-ITEM-SUB)         19390000
194000                            TO ASC-SEL-INVC-ID.                   19400000
194100     MOVE ASC-STORE-NBR                                           19410000
194200                               (ASC-BLK-SUB ASC-ITEM-SUB)         19420000
194300                            TO ASC-SEL-STORE-NBR.                 19430000
194400                                                                  19440000
194500                                                                  19450000
194600*----------------------------------------------------------------*19460000
194700*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *19470000
194800*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *19480000
194900*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *19490000
195000*  THE ENDING.                                                   *19500000
195100*----------------------------------------------------------------*19510000
195200                                                                  19520000
195300 3310-EDIT-RANGE.                                                 19530000
195400                                                                  19540000
195500     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                19550000
195600         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   19560000
195700             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)19570000
195800                                   TO ASC-SELECTED-SW             19580000
195900                                        (ASC-BLK-SUB ASC-ITEM-SUB)19590000
196000             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 19600000
196100         ELSE                                                     19610000
196200             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     19620000
196300                 CONTINUE                                         19630000
196400             ELSE                                                 19640000
196500*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        19650000
196600                 MOVE PC-TSYMSG-00054                             19660000
196700                                   TO DP020-MSG-NUMBER            19670000
196800                 SET DP020-MSG-FATAL                              19680000
196900                                   TO TRUE                        19690000
197000                 MOVE -1           TO MR-SELECTL (PV-SUB)         19700000
197100                 SET DP030-SET-CURSOR-APPL-1                      19710000
197200                                   TO TRUE                        19720000
197300                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         19730000
197400                 MOVE DP015-UNDERLINE                             19740000
197500                                   TO MR-SELECTH (PV-SUB)         19750000
197600                 SET PS-ERROR      TO TRUE                        19760000
197700             END-IF                                               19770000
197800         END-IF                                                   19780000
197900     ELSE                                                         19790000
198000         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     19800000
198100             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 19810000
198200                                   TO ASC-SELECTED-SW             19820000
198300                                     (ASC-BLK-SUB ASC-ITEM-SUB)   19830000
198400             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   19840000
198500         ELSE                                                     19850000
198600             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       19860000
198700                 CONTINUE                                         19870000
198800             ELSE                                                 19880000
198900*                -- ONLY ONE END-OF-RANGE ALLOWED --              19890000
199000                 MOVE PC-TSYMSG-00055                             19900000
199100                                   TO DP020-MSG-NUMBER            19910000
199200                 SET DP020-MSG-FATAL                              19920000
199300                                   TO TRUE                        19930000
199400                 MOVE -1           TO MR-SELECTL (PV-SUB)         19940000
199500                 SET DP030-SET-CURSOR-APPL-1                      19950000
199600                                   TO TRUE                        19960000
199700                 SET PS-ERROR      TO TRUE                        19970000
199800             END-IF                                               19980000
199900         END-IF                                                   19990000
200000     END-IF.                                                      20000000
200100                                                                  20010000
200200*----------------------------------------------------------------*20020000
200300*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *20030000
200400*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *20040000
200500*----------------------------------------------------------------*20050000
200600                                                                  20060000
200700 3400-CHECK-RANGE-SEQUENCE.                                       20070000
200800                                                                  20080000
200900     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       20090000
201000       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      20100000
201100       AND  ASC-START-OF-SELECTED-RANGE >                         20110000
201200                                         ASC-END-OF-SELECTED-RANGE20120000
201300*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                20130000
201400         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 20140000
201500         SET DP020-MSG-FATAL TO TRUE                              20150000
201600         SET PS-ERROR TO TRUE                                     20160000
201700         PERFORM 3410-POSITION-AT-ERROR                           20170000
201800     END-IF.                                                      20180000
201900                                                                  20190000
202000*----------------------------------------------------------------*20200000
202100*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *20210000
202200*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *20220000
202300*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *20230000
202400*----------------------------------------------------------------*20240000
202500                                                                  20250000
202600 3410-POSITION-AT-ERROR.                                          20260000
202700                                                                  20270000
202800     SET DP030-SET-CURSOR-APPL-1                                  20280000
202900                                   TO TRUE.                       20290000
203000     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 20300000
203100                    - PV-TOP-ITEM + 1.                            20310000
203200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      20320000
203300         CONTINUE                                                 20330000
203400     ELSE                                                         20340000
203500         MOVE -1                   TO MR-SELECTL (PV-SUB)         20350000
203600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         20360000
203700         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         20370000
203800     END-IF.                                                      20380000
203900                                                                  20390000
204000     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   20400000
204100                    - PV-TOP-ITEM + 1.                            20410000
204200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      20420000
204300         CONTINUE                                                 20430000
204400     ELSE                                                         20440000
204500         MOVE -1                   TO MR-SELECTL (PV-SUB)         20450000
204600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         20460000
204700         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         20470000
204800     END-IF.                                                      20480000
204900 EJECT                                                            20490000
205000                                                                  20500000
205100*----------------------------------------------------------------*20510000
205200*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *20520000
205300*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *20530000
205400*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *20540000
205500*----------------------------------------------------------------*20550000
205600                                                                  20560000
205700 3500-MARK-RANGE-AS-SELECTED.                                     20570000
205800                                                                  20580000
205900     MOVE +1                       TO  ASC-BLK-SUB.               20590000
206000     PERFORM 3510-MARK-SELECTED-INDS                              20600000
206100         VARYING ASC-ITEM-SUB                                     20610000
206200         FROM 1 BY 1                                              20620000
206300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 20630000
206400                                                                  20640000
206500     ADD +1                        TO ASC-BLK-SUB.                20650000
206600     PERFORM 3510-MARK-SELECTED-INDS                              20660000
206700         VARYING ASC-ITEM-SUB                                     20670000
206800         FROM 1 BY 1                                              20680000
206900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 20690000
207000                                                                  20700000
207100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               20710000
207200                                   TO  PV-LIST-ITEM-NUMBER.       20720000
207300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            20730000
207400         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         20740000
207500               PC-ITEMS-PER-PANEL).                               20750000
207600                                                                  20760000
207700     MOVE ASC-START-OF-SELECTED-RANGE                             20770000
207800                                   TO PV-START-OF-SELECTED-RANGE. 20780000
207900     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            20790000
208000         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  20800000
208100               PC-ITEMS-PER-PANEL).                               20810000
208200                                                                  20820000
208300     MOVE ASC-END-OF-SELECTED-RANGE                               20830000
208400                                   TO  PV-END-OF-SELECTED-RANGE.  20840000
208500     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             20850000
208600         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    20860000
208700               PC-ITEMS-PER-PANEL).                               20870000
208800     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             20880000
208900         PV-FIRST-BLOCK-IN-ARRAY + 1.                             20890000
209000                                                                  20900000
209100     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    20910000
209200        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        20920000
209300         MOVE +1                   TO ASC-BLK-SUB                 20930000
209400         PERFORM 5100-WRITE-TEMP-STORAGE                          20940000
209500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         20950000
209600             PV-FIRST-BLOCK-IN-ARRAY - 1                          20960000
209700                                                                  20970000
209800         PERFORM                                                  20980000
209900             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      20990000
210000                   PV-PREV-BLOCK-IN-ARRAY                         21000000
210100             MOVE PV-FIRST-BLOCK-IN-RANGE                         21010000
210200                                   TO PV-BLOCK-NUMBER             21020000
210300             PERFORM 4410-READ-TEMP-STORAGE                       21030000
210400             PERFORM 3510-MARK-SELECTED-INDS                      21040000
210500                 VARYING ASC-ITEM-SUB                             21050000
210600                 FROM 1 BY 1                                      21060000
210700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          21070000
210800             PERFORM 5100-WRITE-TEMP-STORAGE                      21080000
210900             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     21090000
211000         END-PERFORM                                              21100000
211100                                                                  21110000
211200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         21120000
211300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     21130000
211400         PERFORM                                                  21140000
211500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       21150000
211600                   PV-LAST-BLOCK-IN-RANGE                         21160000
211700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          21170000
211800                                   TO PV-BLOCK-NUMBER             21180000
211900             PERFORM 4410-READ-TEMP-STORAGE                       21190000
212000             PERFORM 3510-MARK-SELECTED-INDS                      21200000
212100                 VARYING ASC-ITEM-SUB                             21210000
212200                 FROM 1 BY 1                                      21220000
212300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          21230000
212400             PERFORM 5100-WRITE-TEMP-STORAGE                      21240000
212500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      21250000
212600         END-PERFORM                                              21260000
212700                                                                  21270000
212800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             21280000
212900                                   TO PV-BLOCK-NUMBER             21290000
213000         PERFORM 4410-READ-TEMP-STORAGE                           21300000
213100     END-IF.                                                      21310000
213200                                                                  21320000
213300     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 21330000
213400                                      ASC-END-OF-SELECTED-RANGE.  21340000
213500                                                                  21350000
213600 EJECT                                                            21360000
213700*----------------------------------------------------------------*21370000
213800* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *21380000
213900*----------------------------------------------------------------*21390000
214000                                                                  21400000
214100 3510-MARK-SELECTED-INDS.                                         21410000
214200                                                                  21420000
214300     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         21430000
214400                                ASC-ITEM-SUB) >                   21440000
214500         ASC-START-OF-SELECTED-RANGE)                             21450000
214600     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         21460000
214700                                ASC-ITEM-SUB) =                   21470000
214800         ASC-START-OF-SELECTED-RANGE)                             21480000
214900                                                                  21490000
215000         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     21500000
215100                                    ASC-ITEM-SUB) <               21510000
215200             ASC-END-OF-SELECTED-RANGE)                           21520000
215300         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     21530000
215400                                    ASC-ITEM-SUB) =               21540000
215500             ASC-END-OF-SELECTED-RANGE)                           21550000
215600                                                                  21560000
215700             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          21570000
215800                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   21580000
215900                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   21590000
216000                               TO TRUE                            21600000
216100                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              21610000
216200                               TO TRUE                            21620000
216300                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    21630000
216400             END-IF                                               21640000
216500         END-IF                                                   21650000
216600     END-IF.                                                      21660000
216700                                                                  21670000
216800 EJECT                                                            21680000
216900*----------------------------------------------------------------*21690000
217000*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *21700000
217100*    INITIALIZE ALL COUNTERS AND FLAGS.                          *21710000
217200*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *21720000
217300*    DISPLAY THE PANEL TO USER.                                  *21730000
217400*----------------------------------------------------------------*21740000
217500                                                                  21750000
217600 4000-BUILD-INITIAL-PANEL.                                        21760000
217700                                                                  21770000
217800     INITIALIZE                 ASC-BLOCK-ENTRIES (1)             21780000
217900                                ASC-BLOCK-ENTRIES (2)             21790000
218000                                ASC-SELECTED-ITEM-FIELDS.         21800000
218100                                                                  21810000
218200     MOVE +1                 TO ASC-BLK-SUB.                      21820000
218300                                                                  21830000
218400     SET ASC-ITEMS-LEFT-ON-DB                                     21840000
218500                             TO TRUE.                             21850000
218600                                                                  21860000
218700     MOVE +0                 TO ASC-ITEM-SUB                      21870000
218800                                ASC-NUMBER-OF-ITEMS-READ          21880000
218900                                ASC-NUMBER-OF-SELECTED-ITEMS      21890000
219000                                ASC-HIGHEST-BLOCK-WRITTEN         21900000
219100                                ASC-START-OF-SELECTED-RANGE       21910000
219200                                ASC-END-OF-SELECTED-RANGE         21920000
219300                                ASC-ITEM-AT-TOP-OF-PANEL.         21930000
219400                                                                  21940000
219500     PERFORM 4100-PREPARE-CURSOR.                                 21950000
219600*                                                                 21960000
219700     MOVE +0 TO PV-NBR-RECDIS-ROWS-FOUND                          21970000
219800                                                                  21980000
219900     IF ASC-KEY-PO-LNE-NBR > ZEROS                                21990000
220000        PERFORM 4010-RECEIPT-CSR-PROCESSING                       22000000
220100     END-IF.                                                      22010000
220200*                                                                 22020000
220300**   -- INVOICE ITEMS CURSOR PROCESSING --                        22030000
220400*                                                                 22040000
220500     IF PS-NO-ERROR-DB2                                           22050000
220600        PERFORM 4040-OPEN-INVOICE-CURSOR                          22060000
220700     END-IF.                                                      22070000
220800                                                                  22080000
220900     IF PS-NO-ERROR-DB2                                           22090000
221000         PERFORM 4300-READ-ITEMS-FROM-DB                          22100000
221100     END-IF.                                                      22110000
221200                                                                  22120000
221300     IF PS-NO-ERROR-DB2                                           22130000
221400        PERFORM 4050-CLOSE-INVOICE-CURSOR                         22140000
221500     END-IF.                                                      22150000
221600**                                                                22160000
221700     IF PS-NO-ERROR-DB2                                           22170000
221800         PERFORM 4320-FILL-IN-OTHER-FLDS                          22180000
221900     END-IF.                                                      22190000
222000**                                                                22200000
222100                                                                  22210000
222200     MOVE +1                   TO  PV-TOP-ITEM.                   22220000
222300     IF PS-ERROR-DB2                                              22230000
222400         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    22240000
222500     ELSE                                                         22250000
222600                                                                  22260000
222700         IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                      22270000
222800                                                                  22280000
222900             SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                22290000
223000             SET DP020-MSG-FATAL   TO  TRUE                       22300000
223100*            -- NO LIST ITEMS WERE FOUND FOR CRITERIA SPECIFIED   22310000
223200             MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER           22320000
223300**                                                                22330000
223400         ELSE                                                     22340000
223500             MOVE -1               TO MR-SELECTL (1)              22350000
223600             SET DP030-SET-CURSOR-APPL-1                          22360000
223700                                   TO TRUE                        22370000
223800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 22380000
223900         END-IF                                                   22390000
224000     END-IF.                                                      22400000
224100 EJECT                                                            22410000
224200                                                                  22420000
224300*----------------------------------------------------------------*22430000
224400* PROCESS THE RECEIPT CURSOR.                                    *22440000
224500*----------------------------------------------------------------*22450000
224600 4010-RECEIPT-CSR-PROCESSING.                                     22460000
224700                                                                  22470000
224800     PERFORM 4020-OPEN-RECEIPT-CURSOR.                            22480000
224900                                                                  22490000
225000     IF PS-NO-ERROR-DB2                                           22500000
225100         PERFORM 4200-FETCH-RECEIPTS                              22510000
225200     END-IF.                                                      22520000
225300                                                                  22530000
225400     IF PS-NO-ERROR-DB2                                           22540000
225500        PERFORM 4030-CLOSE-RECEIPT-CURSOR                         22550000
225600     END-IF.                                                      22560000
225700                                                                  22570000
225800*    MOVE +1                   TO  PV-TOP-ITEM.                   22580000
225900*    IF PS-ERROR-DB2                                              22590000
226000*        SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    22600000
226100*    ELSE                                                         22610000
226200*        IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                      22620000
226300*            SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                22630000
226400*            SET DP020-MSG-FATAL   TO  TRUE                       22640000
226500*            -- NO LIST ITEMS WERE FOUND FOR CRITERIA SPECIFIED   22650000
226600*            MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER           22660000
226700*        ELSE                                                     22670000
226800*            MOVE -1               TO MR-SELECTL (1)              22680000
226900*            SET DP030-SET-CURSOR-APPL-1                          22690000
227000*                                  TO TRUE                        22700000
227100*            PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 22710000
227200*        END-IF                                                   22720000
227300*    END-IF.                                                      22730000
227400                                                                  22740000
227500**   -- END OF RECEIPT CURSOR PROCESSING                          22750000
227600                                                                  22760000
227700                                                                  22770000
227800*----------------------------------------------------------------*22780000
227900* OPEN THE CURSOR.                                               *22790000
228000*   THE RECEIPT-ITEM-CSR WILL BE OPENED IN THIS MODULE.          *22800000
228100*----------------------------------------------------------------*22810000
228200                                                                  22820000
228300 4020-OPEN-RECEIPT-CURSOR.                                        22830000
228400                                                                  22840000
228500     EXEC SQL                                                     22850008
228600        OPEN RECEIPT-ITEM-CSR                                     22860000
228700     END-EXEC.                                                    22870000
228800                                                                  22880000
228900     EVALUATE TRUE                                                22890000
229000         WHEN SQLCODE = ZERO                                      22900000
229100              CONTINUE                                            22910000
229200                                                                  22920000
229300         WHEN SQLCODE = -904                                      22930000
229400         WHEN SQLCODE = -913                                      22940000
229500             MOVE '4020-OPEN-RECEIPT-CURSOR'                      22950000
229600                                 TO DP013-PARAGRAPH               22960000
229700             MOVE 'TRECEIV'      TO DP013-DB2-TABLE-NAME (1)      22970000
229800             MOVE 'TRECITM'      TO DP013-DB2-TABLE-NAME (2)      22980000
229900             MOVE 'TRECDIS'      TO DP013-DB2-TABLE-NAME (3)      22990000
230000             MOVE 'TPURITM'      TO DP013-DB2-TABLE-NAME (4)      23000000
230100             MOVE 'TNINREC'      TO DP013-DB2-TABLE-NAME (5)      23010000
230200             MOVE SQLCA          TO DP013-SQLCA                   23020000
230300             SET DP013-LINK-RETURN                                23030000
230400                 DP013-DB2-ABEND                                  23040000
230500                 DP013-ROLLBACK  TO TRUE                          23050000
230600             PERFORM DP013-0000-PROCESS-ABEND                     23060000
230700*            MOVE 'TINVOIC'      TO DP020-MSG-TEXT                23070000
230800             SET DP020-MSG-FATAL TO TRUE                          23080000
230900*            --- CONFLICT FOR DATABASE ---                        23090000
231000             MOVE PC-TSYMSG-00482                                 23100000
231100                                 TO DP020-MSG-NUMBER              23110000
231200             SET PS-ERROR-DB2    TO TRUE                          23120000
231300                                                                  23130000
231400         WHEN OTHER                                               23140000
231500             MOVE '4020-OPEN-RECEIPT-CURSOR'                      23150000
231600                                 TO DP013-PARAGRAPH               23160000
231700             MOVE 'TRECEIV'      TO DP013-DB2-TABLE-NAME (1)      23170000
231800             MOVE 'TRECITM'      TO DP013-DB2-TABLE-NAME (2)      23180000
231900             MOVE 'TRECDIS'      TO DP013-DB2-TABLE-NAME (3)      23190000
232000             MOVE 'TPURITM'      TO DP013-DB2-TABLE-NAME (4)      23200000
232100             MOVE 'TNINREC'      TO DP013-DB2-TABLE-NAME (5)      23210000
232200             MOVE SQLCA          TO DP013-SQLCA                   23220000
232300             SET DP013-DB2-ABEND                                  23230000
232400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               23240000
232500             PERFORM DP013-0000-PROCESS-ABEND                     23250000
232600     END-EVALUATE.                                                23260000
232700                                                                  23270000
232800 EJECT                                                            23280000
232900                                                                  23290000
233000                                                                  23300000
233100*----------------------------------------------------------------*23310000
233200* CLOSE THE RECEIPT CURSOR                                       *23320000
233300*----------------------------------------------------------------*23330000
233400                                                                  23340000
233500 4030-CLOSE-RECEIPT-CURSOR.                                       23350000
233600                                                                  23360000
233700     EXEC SQL                                                     23370000
233800        CLOSE RECEIPT-ITEM-CSR                                    23380000
233900     END-EXEC.                                                    23390000
234000                                                                  23400000
234100     EVALUATE TRUE                                                23410000
234200         WHEN SQLCODE = ZERO                                      23420000
234300         WHEN SQLCODE = -904                                      23430000
234400         WHEN SQLCODE = -913                                      23440000
234500             CONTINUE                                             23450000
234600                                                                  23460000
234700         WHEN OTHER                                               23470000
234800             MOVE '4030-CLOSE-RECEIPT-CURSOR'                     23480000
234900                                 TO DP013-PARAGRAPH               23490000
235000             MOVE 'TRECEIV'      TO DP013-DB2-TABLE-NAME (1)      23500000
235100             MOVE 'TRECITM'      TO DP013-DB2-TABLE-NAME (2)      23510000
235200             MOVE 'TRECDIS'      TO DP013-DB2-TABLE-NAME (3)      23520000
235300             MOVE 'TPURITM'      TO DP013-DB2-TABLE-NAME (4)      23530000
235400             MOVE 'TNINREC'      TO DP013-DB2-TABLE-NAME (5)      23540000
235500             MOVE SQLCA          TO DP013-SQLCA                   23550000
235600             SET DP013-DB2-ABEND                                  23560000
235700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               23570000
235800             PERFORM DP013-0000-PROCESS-ABEND                     23580000
235900     END-EVALUATE.                                                23590000
236000                                                                  23600000
236100 EJECT                                                            23610000
236200                                                                  23620000
236300*----------------------------------------------------------------*23630000
236400* OPEN THE INVOICE CURSOR.                                       *23640000
236500*----------------------------------------------------------------*23650000
236600                                                                  23660000
236700 4040-OPEN-INVOICE-CURSOR.                                        23670000
236800                                                                  23680000
236900     EVALUATE TRUE                                                23690000
237000                                                                  23700000
237100         WHEN ASC-INVC-ITEM-CSR                                   23710000
237200             MOVE 'OPEN INVC ITEM CURSOR'                         23720000
237300                                 TO DP013-MESSAGE-TEXT (1)        23730000
237400             EXEC SQL                                             23740000
237500                  OPEN INVC-ITEM-CSR                              23750000
237600             END-EXEC                                             23760000
237700                                                                  23770000
237800         WHEN ASC-INVC-ITEM-NULL-CSR                              23780000
237900             MOVE 'OPEN INVC ITEM NULL CURSOR'                    23790000
238000                                 TO DP013-MESSAGE-TEXT (1)        23800000
238100             EXEC SQL                                             23810000
238200                  OPEN INVC-ITEM-NULL-CSR                         23820000
238300             END-EXEC                                             23830000
238400                                                                  23840000
238500     END-EVALUATE.                                                23850000
238600                                                                  23860000
238700     EVALUATE TRUE                                                23870000
238800         WHEN SQLCODE = ZERO                                      23880000
238900              CONTINUE                                            23890000
239000                                                                  23900000
239100         WHEN SQLCODE = -904                                      23910000
239200         WHEN SQLCODE = -913                                      23920000
239300             MOVE '4040-OPEN-INVOICE-CURSOR'                      23930000
239400                                 TO DP013-PARAGRAPH               23940000
239500             MOVE 'TPAYREQ'      TO DP013-DB2-TABLE-NAME (1)      23950000
239600             MOVE 'TPREQIT'      TO DP013-DB2-TABLE-NAME (2)      23960000
239700             MOVE 'TMIITEM'      TO DP013-DB2-TABLE-NAME (3)      23970000
239800             MOVE 'TPURITM'      TO DP013-DB2-TABLE-NAME (4)      23980000
239900             MOVE 'TINVOIC'      TO DP013-DB2-TABLE-NAME (5)      23990000
240000             MOVE SQLCA          TO DP013-SQLCA                   24000000
240100             SET DP013-LINK-RETURN                                24010000
240200                 DP013-DB2-ABEND                                  24020000
240300                 DP013-ROLLBACK  TO TRUE                          24030000
240400             PERFORM DP013-0000-PROCESS-ABEND                     24040000
240500*            MOVE 'TINVOIC'      TO DP020-MSG-TEXT                24050000
240600             SET DP020-MSG-FATAL TO TRUE                          24060000
240700*            --- CONFLICT FOR DATABASE ---                        24070000
240800             MOVE PC-TSYMSG-00482                                 24080000
240900                                 TO DP020-MSG-NUMBER              24090000
241000             SET PS-ERROR-DB2    TO TRUE                          24100000
241100                                                                  24110000
241200         WHEN OTHER                                               24120000
241300             MOVE '4040-OPEN-INVOICE-CURSOR'                      24130000
241400                                 TO DP013-PARAGRAPH               24140000
241500             MOVE 'TPAYREQ'      TO DP013-DB2-TABLE-NAME (1)      24150000
241600             MOVE 'TPREQIT'      TO DP013-DB2-TABLE-NAME (2)      24160000
241700             MOVE 'TMIITEM'      TO DP013-DB2-TABLE-NAME (3)      24170000
241800             MOVE 'TPURITM'      TO DP013-DB2-TABLE-NAME (4)      24180000
241900             MOVE 'TINVOIC'      TO DP013-DB2-TABLE-NAME (5)      24190000
242000             MOVE SQLCA          TO DP013-SQLCA                   24200000
242100             SET DP013-DB2-ABEND                                  24210000
242200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               24220000
242300             PERFORM DP013-0000-PROCESS-ABEND                     24230000
242400     END-EVALUATE.                                                24240000
242500                                                                  24250000
242600 EJECT                                                            24260000
242700                                                                  24270000
242800*----------------------------------------------------------------*24280000
242900* CLOSE THE CURSOR.                                              *24290000
243000*   IN THIS PARTICULAR APPLICATION ONE OF 2 DIFFERENT CURSORS    *24300000
243100*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *24310000
243200*   USER.                                                        *24320000
243300*----------------------------------------------------------------*24330000
243400                                                                  24340000
243500 4050-CLOSE-INVOICE-CURSOR.                                       24350000
243600                                                                  24360000
243700     EVALUATE TRUE                                                24370000
243800                                                                  24380000
243900         WHEN ASC-INVC-ITEM-CSR                                   24390000
244000             MOVE 'CLOSE INVC ITEM CURSOR'                        24400000
244100                                 TO DP013-MESSAGE-TEXT (1)        24410000
244200             EXEC SQL                                             24420000
244300                  CLOSE INVC-ITEM-CSR                             24430000
244400             END-EXEC                                             24440000
244500                                                                  24450000
244600         WHEN ASC-INVC-ITEM-NULL-CSR                              24460000
244700             MOVE 'CLOSE INVC ITEM NULL CURSOR'                   24470000
244800                                 TO DP013-MESSAGE-TEXT (1)        24480000
244900             EXEC SQL                                             24490000
245000                  CLOSE INVC-ITEM-NULL-CSR                        24500000
245100             END-EXEC                                             24510000
245200                                                                  24520000
245300     END-EVALUATE.                                                24530000
245400                                                                  24540000
245500     EVALUATE TRUE                                                24550000
245600         WHEN SQLCODE = ZERO                                      24560000
245700         WHEN SQLCODE = -904                                      24570000
245800         WHEN SQLCODE = -913                                      24580000
245900             CONTINUE                                             24590000
246000                                                                  24600000
246100         WHEN OTHER                                               24610000
246200             MOVE '4050-CLOSE-INVOICE-CURSOR'                     24620000
246300                                 TO DP013-PARAGRAPH               24630000
246400             MOVE 'TPAYREQ'      TO DP013-DB2-TABLE-NAME (1)      24640000
246500             MOVE 'TPREQIT'      TO DP013-DB2-TABLE-NAME (2)      24650000
246600             MOVE 'TMIITEM'      TO DP013-DB2-TABLE-NAME (3)      24660000
246700             MOVE 'TPURITM'      TO DP013-DB2-TABLE-NAME (4)      24670000
246800             MOVE 'TINVOIC'      TO DP013-DB2-TABLE-NAME (5)      24680000
246900             MOVE SQLCA          TO DP013-SQLCA                   24690000
247000             SET DP013-DB2-ABEND                                  24700000
247100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               24710000
247200             PERFORM DP013-0000-PROCESS-ABEND                     24720000
247300     END-EVALUATE.                                                24730000
247400                                                                  24740000
247500 EJECT                                                            24750000
247600                                                                  24760000
247700                                                                  24770000
247800*----------------------------------------------------------------*24780000
247900* FETCH RECEIPT ITEMS.                                           *24790000
248000*----------------------------------------------------------------*24800000
248100 4200-FETCH-RECEIPTS.                                             24810000
248200                                                                  24820000
248300     INITIALIZE PV-READ-COUNT.                                    24830000
248400     PERFORM                                                      24840000
248500         VARYING PV-READ-COUNT                                    24850000
248600         FROM 1 BY 1                                              24860000
248700         UNTIL PV-READ-COUNT > PC-MAX-ITEMS                       24870000
248800            OR ASC-NO-ITEMS-LEFT-ON-DB                            24880000
248900            OR PS-ERROR-DB2                                       24890000
249000                                                                  24900000
249100       MOVE 'FETCH RECEIPT ITEM CURSOR'                           24910000
249200                           TO DP013-MESSAGE-TEXT (1)              24920000
249300       EXEC SQL                                                   24930000
249400            FETCH RECEIPT-ITEM-CSR                                24940000
249500            INTO  :RECDIS-AP-VERIFY-ITM-QTY                       24950000
249600                , :PURITM-PRD-1ST-COST-AMT                        24960000
249700                , :NINREC-NON-INVC-UNT-QTY                        24970000
249800                , :NINREC-UNT-COST-AMT                            24980000
249900       END-EXEC                                                   24990000
250000                                                                  25000000
250100       EVALUATE TRUE                                              25010000
250200           WHEN SQLCODE = ZERO                                    25020000
250300               ADD +1 TO PV-NBR-RECDIS-ROWS-FOUND                 25030000
250400               PERFORM 4210-CALCULATE-RECEIPT-TOTALS              25040000
250500                                                                  25050000
250600           WHEN SQLCODE = +100                                    25060000
250700               SET ASC-NO-ITEMS-LEFT-ON-DB                        25070000
250800                                   TO TRUE                        25080000
250900                                                                  25090000
251000           WHEN SQLCODE = -904                                    25100000
251100           WHEN SQLCODE = -913                                    25110000
251200               MOVE '4200-FETCH-RECEIPTS'                         25120000
251300                                   TO DP013-PARAGRAPH             25130000
251400               MOVE 'TRECEIV'      TO DP013-DB2-TABLE-NAME (1)    25140000
251500               MOVE 'TRECITM'      TO DP013-DB2-TABLE-NAME (2)    25150000
251600               MOVE 'TRECDIS'      TO DP013-DB2-TABLE-NAME (3)    25160000
251700               MOVE 'TPURITM'      TO DP013-DB2-TABLE-NAME (4)    25170000
251800               MOVE 'TNINREC'      TO DP013-DB2-TABLE-NAME (5)    25180000
251900               MOVE SQLCA          TO DP013-SQLCA                 25190000
252000               SET DP013-LINK-RETURN                              25200000
252100                   DP013-DB2-ABEND                                25210000
252200                   DP013-ROLLBACK  TO TRUE                        25220000
252300               PERFORM DP013-0000-PROCESS-ABEND                   25230000
252400*              MOVE 'TINVOIC'      TO DP020-MSG-TEXT              25240000
252500               SET DP020-MSG-FATAL TO TRUE                        25250000
252600*              --- CONFLICT FOR DATABASE ---                      25260000
252700               MOVE PC-TSYMSG-00482                               25270000
252800                                   TO DP020-MSG-NUMBER            25280000
252900               SET PS-ERROR-DB2    TO TRUE                        25290000
253000                                                                  25300000
253100           WHEN OTHER                                             25310000
253200               MOVE '4200-FETCH'   TO DP013-PARAGRAPH             25320000
253300               MOVE 'TRECEIV'      TO DP013-DB2-TABLE-NAME (1)    25330000
253400               MOVE 'TRECITM'      TO DP013-DB2-TABLE-NAME (2)    25340000
253500               MOVE 'TRECDIS'      TO DP013-DB2-TABLE-NAME (3)    25350000
253600               MOVE 'TPURITM'      TO DP013-DB2-TABLE-NAME (4)    25360000
253700               MOVE 'TNINREC'      TO DP013-DB2-TABLE-NAME (5)    25370000
253800               MOVE SQLCA          TO DP013-SQLCA                 25380000
253900               SET DP013-DB2-ABEND                                25390000
254000                   DP013-XCTL-DISPLAY-RESTART TO TRUE             25400000
254100               PERFORM DP013-0000-PROCESS-ABEND                   25410000
254200       END-EVALUATE                                               25420000
254300     END-PERFORM.                                                 25430000
254400                                                                  25440000
254500*----------------------------------------------------------------*25450000
254600* CALCULATE RECEIPT TOTALS.                                      *25460000
254700*----------------------------------------------------------------*25470000
254800 4210-CALCULATE-RECEIPT-TOTALS.                                   25480000
254900                                                                  25490000
255000     ADD RECDIS-AP-VERIFY-ITM-QTY  TO  ASC-TOTAL-RCVD-QTY.        25500000
255100     ADD NINREC-NON-INVC-UNT-QTY   TO  ASC-TOTAL-RCVD-QTY.        25510000
255200                                                                  25520000
255300     IF ASC-LOWEST-UNIT-COST = ZERO                               25530000
255400                                                                  25540000
255500        IF PURITM-PRD-1ST-COST-AMT NUMERIC AND                    25550000
255600           PURITM-PRD-1ST-COST-AMT > 0                            25560000
255700           MOVE PURITM-PRD-1ST-COST-AMT TO ASC-LOWEST-UNIT-COST   25570000
255800        ELSE                                                      25580000
255900           IF NINREC-UNT-COST-AMT NUMERIC AND                     25590000
256000              NINREC-UNT-COST-AMT  >  0                           25600000
256100              MOVE NINREC-UNT-COST-AMT                            25610000
256200                                     TO  ASC-LOWEST-UNIT-COST     25620000
256300           END-IF                                                 25630000
256400        END-IF                                                    25640000
256500     END-IF.                                                      25650000
256600                                                                  25660000
256700     IF PURITM-PRD-1ST-COST-AMT NUMERIC                           25670000
256800        IF PURITM-PRD-1ST-COST-AMT > 0 AND                        25680000
256900           PURITM-PRD-1ST-COST-AMT < ASC-LOWEST-UNIT-COST         25690000
257000           MOVE PURITM-PRD-1ST-COST-AMT                           25700000
257100                                     TO  ASC-LOWEST-UNIT-COST     25710000
257200        END-IF                                                    25720000
257300     END-IF.                                                      25730000
257400                                                                  25740000
257500     IF NINREC-UNT-COST-AMT NUMERIC                               25750000
257600        IF NINREC-UNT-COST-AMT > 0  AND                           25760000
257700           NINREC-UNT-COST-AMT < ASC-LOWEST-UNIT-COST             25770000
257800           MOVE NINREC-UNT-COST-AMT                               25780000
257900                                     TO  ASC-LOWEST-UNIT-COST     25790000
258000        END-IF                                                    25800000
258100     END-IF.                                                      25810000
258200                                                                  25820000
258300                                                                  25830000
258400                                                                  25840000
258500*----------------------------------------------------------------*25850000
258600*    SET UP THE HOST VARIABLES.                                  *25860000
258700*----------------------------------------------------------------*25870000
258800*                                                                 25880000
258900 4100-PREPARE-CURSOR.                                             25890000
259000*                                                                 25900000
259100     MOVE ASC-KEY-PO-NBR       TO  DK-PO-NBR.                     25910000
259200     MOVE ASC-KEY-PO-LNE-NBR   TO  DK-PO-LNE-NBR.                 25920000
259300                                                                  25930000
259400     MOVE ASC-KEY-STR-NBR      TO  DK-STR-NBR.                    25940000
259500     MOVE ASC-KEY-DC-NBR       TO  DK-DC-NBR.                     25950000
259600     MOVE ASC-MTCH-LVL-CDE     TO  DK-MTCH-LVL-CDE.               25960000
259700                                                                  25970000
259800     IF DK-MTCH-LVL-CDE = 'P'                                     25980000
259900        MOVE +0                TO DK-STR-NBR-LOW                  25990000
260000                                  DK-DC-NBR-LOW                   26000000
260100        MOVE +9999             TO DK-STR-NBR-HIGH                 26010000
260200                                  DK-DC-NBR-HIGH                  26020000
260300     ELSE                                                         26030000
260400        IF DK-MTCH-LVL-CDE = 'D'                                  26040000
260500           MOVE +0              TO DK-STR-NBR-LOW                 26050000
260600           MOVE +9999           TO DK-STR-NBR-HIGH                26060000
260700           MOVE ASC-KEY-DC-NBR  TO DK-DC-NBR-LOW                  26070000
260800                                   DK-DC-NBR-HIGH                 26080000
260900        ELSE                                                      26090000
261000          IF DK-MTCH-LVL-CDE = 'S'                                26100000
261100             MOVE ASC-KEY-STR-NBR TO DK-STR-NBR-LOW               26110000
261200                                     DK-STR-NBR-HIGH              26120000
261300             MOVE +0              TO DK-DC-NBR-LOW                26130000
261400             MOVE +9999           TO DK-DC-NBR-HIGH               26140000
261500          END-IF                                                  26150000
261600        END-IF                                                    26160000
261700     END-IF.                                                      26170000
261800                                                                  26180000
261900     IF ASC-KEY-PO-LNE-NBR > +0                                   26190000
262000         SET ASC-INVC-ITEM-CSR TO TRUE                            26200000
262100     ELSE                                                         26210000
262200         SET ASC-INVC-ITEM-NULL-CSR                               26220000
262300                               TO TRUE                            26230000
262400     END-IF.                                                      26240000
262500*                                                                 26250000
262600*                                                                 26260000
262700*                                                                 26270000
262800*----------------------------------------------------------------*26280000
262900*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *26290000
263000*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *26300000
263100*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *26310000
263200*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *26320000
263300*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *26330000
263400*                                                                *26340000
263500*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *26350000
263600*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *26360000
263700*    UPON INITIALIZATION.                                        *26370000
263800*----------------------------------------------------------------*26380000
263900                                                                  26390000
264000 4300-READ-ITEMS-FROM-DB.                                         26400000
264100                                                                  26410000
264200     SET ASC-ITEMS-LEFT-ON-DB   TO  TRUE.                         26420000
264300                                                                  26430000
264400     PERFORM                                                      26440000
264500         VARYING PV-READ-COUNT                                    26450000
264600         FROM 1 BY 1                                              26460000
264700         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    26470000
264800            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         26480000
264900                                                                  26490000
265000         PERFORM 4310-FETCH                                       26500000
265100                                                                  26510000
265200         IF (ASC-ITEMS-LEFT-ON-DB AND                             26520000
265300             PS-NO-ERROR-DB2) OR                                  26530000
265400            (ASC-NO-ITEMS-LEFT-ON-DB       AND                    26540000
265500             ASC-NUMBER-OF-ITEMS-READ = +0 AND                    26550000
265600             PV-NBR-RECDIS-ROWS-FOUND > +0)                       26560000
265700             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                26570000
265800                 ADD +1            TO ASC-ITEM-SUB                26580000
265900             ELSE                                                 26590000
266000                 ADD +1            TO ASC-BLK-SUB                 26600000
266100                 MOVE +1           TO ASC-ITEM-SUB                26610000
266200                                                                  26620000
266300                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         26630000
266400                     MOVE +1       TO ASC-BLK-SUB                 26640000
266500                     SET ASC-BLOCK-MODIFIED (1)                   26650000
266600                                   TO TRUE                        26660000
266700                     PERFORM 5100-WRITE-TEMP-STORAGE              26670000
266800                     MOVE ASC-BLOCK-ENTRIES                       26680000
266900                               (PC-MAX-BLOCKS-IN-ARRAY)           26690000
267000                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 26700000
267100                     ADD +1        TO ASC-BLK-SUB                 26710000
267200                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   26720000
267300                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      26730000
267400                                   TO TRUE                        26740000
267500                 END-IF                                           26750000
267600             END-IF                                               26760000
267700             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    26770000
267800             MOVE ASC-NUMBER-OF-ITEMS-READ                        26780000
267900                                   TO ASC-LIST-ITEM-NUMBER        26790000
268000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  26800000
268100                                                                  26810000
268200             IF ASC-INVC-ITEM-CSR                                 26820000
268300                MOVE PURITM-VEND-STYL-NAME                        26830000
268400                                   TO  ASC-VENDOR-STYLE           26840000
268500             ELSE                                                 26850000
268600                MOVE 'UNMATCHED'                                  26860000
268700                                   TO  ASC-VENDOR-STYLE           26870000
268800             END-IF                                               26880000
268900                                                                  26890000
269000             MOVE INVOIC-INVC-ID   TO ASC-INVC-ID                 26900000
269100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 26910000
269200             MOVE PREQIT-PAY-REQ-LNE-QTY                          26920000
269300                                   TO ASC-INVC-QTY                26930000
269400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 26940000
269500                                                                  26950000
269600             ADD  PREQIT-PAY-REQ-LNE-QTY                          26960000
269700                                   TO ASC-TOTAL-INVC-QTY          26970000
269800                                                                  26980000
269900             MOVE PREQIT-UNT-COST-AMT                             26990000
270000                                   TO ASC-INVC-UNIT-COST          27000000
270100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 27010000
270200             MOVE ASC-LOWEST-UNIT-COST                            27020000
270300                                   TO ASC-RCVD-UNIT-COST          27030000
270400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 27040000
270500**                                                                27050000
270600             IF MIITEM-UNT-COST-SEL-CDE = 'P'                     27060000
270700                MOVE ASC-LOWEST-UNIT-COST                         27070000
270800                                   TO  ASC-ADJU-UNIT-COST         27080000
270900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 27090000
271000             ELSE                                                 27100000
271100                MOVE PREQIT-UNT-COST-AMT                          27110000
271200                         TO  ASC-ADJU-UNIT-COST                   27120000
271300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 27130000
271400             END-IF                                               27140000
271500**                                                                27150000
271600             COMPUTE PV-INVC-EXTD-AMT ROUNDED =                   27160000
271700               PREQIT-PAY-REQ-LNE-QTY * ASC-ADJU-UNIT-COST        27170000
271800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 27180000
271900                                                                  27190000
272000             ADD PV-INVC-EXTD-AMT  TO  ASC-INVC-EXTD-AMT          27200000
272100**                                                                27210000
272200                                                                  27220000
272300             MOVE PREQIT-PAYT-REQ-LNE-NBR                         27230000
272400                                   TO ASC-INVC-LNE-NBR            27240000
272500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 27250000
272600             MOVE INVOIC-HOLD-IND  TO ASC-HOLD-IND                27260000
272700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 27270000
272800             MOVE INVOIC-STR-NBR   TO ASC-STORE-NBR               27280000
272900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 27290000
273000                                                                  27300000
273100             MOVE INVOIC-PAYT-REQ-SEQ-NBR                         27310000
273200                                   TO ASC-PAYT-REQ-SEQ-NBR        27320000
273300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 27330000
273400                                                                  27340000
273500         END-IF                                                   27350000
273600     END-PERFORM.                                                 27360000
273700                                                                  27370000
273800     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO AND                      27380000
273900         PS-NO-ERROR-DB2                                          27390000
274000         MOVE +1               TO ASC-BLK-SUB                     27400000
274100         PERFORM 5100-WRITE-TEMP-STORAGE                          27410000
274200         ADD +1                TO ASC-BLK-SUB                     27420000
274300         PERFORM 5100-WRITE-TEMP-STORAGE                          27430000
274400                                                                  27440000
274500         MOVE 1                TO ASC-BLK-SUB                     27450000
274600                                  PV-BLOCK-NUMBER                 27460000
274700         PERFORM 4410-READ-TEMP-STORAGE                           27470000
274800         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             27480000
274900             MOVE 2            TO ASC-BLK-SUB                     27490000
275000                                  PV-BLOCK-NUMBER                 27500000
275100             PERFORM 4410-READ-TEMP-STORAGE                       27510000
275200         END-IF                                                   27520000
275300     END-IF.                                                      27530000
275400 EJECT                                                            27540000
275500*----------------------------------------------------------------*27550000
275600*    FETCH THE INVOICE CURSOR.                                   *27560000
275700*----------------------------------------------------------------*27570000
275800                                                                  27580000
275900 4310-FETCH.                                                      27590000
276000                                                                  27600000
276100     EVALUATE TRUE                                                27610000
276200                                                                  27620000
276300         WHEN ASC-INVC-ITEM-CSR                                   27630000
276400             MOVE 'FETCH INVC ITEM CURSOR'                        27640000
276500                                 TO DP013-MESSAGE-TEXT (1)        27650000
276600             INITIALIZE  PURITM-APP-PO-LNE-NBR                    27660000
276700                         PURITM-VEND-STYL-NAME                    27670000
276800                         PREQIT-PAYT-REQ-LNE-NBR                  27680000
276900                         MIITEM-UNT-COST-SEL-CDE                  27690000
277000                         PREQIT-PAY-REQ-LNE-QTY                   27700000
277100                         PREQIT-UNT-COST-AMT                      27710000
277200                         INVOIC-PAYT-REQ-SEQ-NBR                  27720000
277300                         INVOIC-HOLD-IND                          27730000
277400                         INVOIC-INVC-ID                           27740000
277500                         INVOIC-STR-NBR                           27750000
277600             EXEC SQL                                             27760000
277700                  FETCH INVC-ITEM-CSR                             27770000
277800                  INTO  :PURITM-APP-PO-LNE-NBR                    27780000
277900                      , :PURITM-VEND-STYL-NAME                    27790000
278000                      , :PREQIT-PAYT-REQ-LNE-NBR                  27800000
278100                      , :MIITEM-UNT-COST-SEL-CDE                  27810000
278200                      , :PREQIT-PAY-REQ-LNE-QTY                   27820000
278300                      , :PREQIT-UNT-COST-AMT                      27830000
278400                      , :INVOIC-PAYT-REQ-SEQ-NBR                  27840000
278500                      , :INVOIC-HOLD-IND                          27850000
278600                      , :INVOIC-INVC-ID                           27860000
278700                      , :INVOIC-STR-NBR                           27870000
278800             END-EXEC                                             27880000
278900                                                                  27890000
279000         WHEN ASC-INVC-ITEM-NULL-CSR                              27900000
279100             MOVE 'FETCH INVC ITEM NULL CURSOR'                   27910000
279200                                 TO DP013-MESSAGE-TEXT (1)        27920000
279300             INITIALIZE  PREQIT-PAYT-REQ-LNE-NBR                  27930000
279400                         MIITEM-UNT-COST-SEL-CDE                  27940000
279500                         PREQIT-PAY-REQ-LNE-QTY                   27950000
279600                         PREQIT-UNT-COST-AMT                      27960000
279700                         INVOIC-PAYT-REQ-SEQ-NBR                  27970000
279800                         INVOIC-HOLD-IND                          27980000
279900                         INVOIC-INVC-ID                           27990000
280000                         INVOIC-STR-NBR                           28000000
280100             EXEC SQL                                             28010000
280200                  FETCH INVC-ITEM-NULL-CSR                        28020000
280300                  INTO  :PREQIT-PAYT-REQ-LNE-NBR                  28030000
280400                      , :MIITEM-UNT-COST-SEL-CDE                  28040000
280500                      , :PREQIT-PAY-REQ-LNE-QTY                   28050000
280600                      , :PREQIT-UNT-COST-AMT                      28060000
280700                      , :INVOIC-PAYT-REQ-SEQ-NBR                  28070000
280800                      , :INVOIC-HOLD-IND                          28080000
280900                      , :INVOIC-INVC-ID                           28090000
281000                      , :INVOIC-STR-NBR                           28100000
281100             END-EXEC                                             28110000
281200     END-EVALUATE.                                                28120000
281300                                                                  28130000
281400     EVALUATE TRUE                                                28140000
281500         WHEN SQLCODE = ZERO                                      28150000
281600              CONTINUE                                            28160000
281700                                                                  28170000
281800         WHEN SQLCODE = +100                                      28180000
281900             SET ASC-NO-ITEMS-LEFT-ON-DB                          28190000
282000                                   TO TRUE                        28200000
282100                                                                  28210000
282200         WHEN SQLCODE = -904                                      28220000
282300         WHEN SQLCODE = -913                                      28230000
282400             MOVE '4310-FETCH'   TO DP013-PARAGRAPH               28240000
282500             MOVE 'TPREQIT'      TO DP013-DB2-TABLE-NAME (1)      28250000
282600             MOVE 'TMIITEM'      TO DP013-DB2-TABLE-NAME (2)      28260000
282700             MOVE 'TPURITM'      TO DP013-DB2-TABLE-NAME (3)      28270000
282800             MOVE 'TINVOIC'      TO DP013-DB2-TABLE-NAME (4)      28280000
282900             MOVE SPACES         TO DP013-DB2-TABLE-NAME (5)      28290000
283000             MOVE SQLCA          TO DP013-SQLCA                   28300000
283100             SET DP013-LINK-RETURN                                28310000
283200                 DP013-DB2-ABEND                                  28320000
283300                 DP013-ROLLBACK  TO TRUE                          28330000
283400             PERFORM DP013-0000-PROCESS-ABEND                     28340000
283500*            MOVE 'TINVOIC'      TO DP020-MSG-TEXT                28350000
283600             SET DP020-MSG-FATAL TO TRUE                          28360000
283700*            --- CONFLICT FOR DATABASE ---                        28370000
283800             MOVE PC-TSYMSG-00482                                 28380000
283900                                 TO DP020-MSG-NUMBER              28390000
284000             SET PS-ERROR-DB2    TO TRUE                          28400000
284100                                                                  28410000
284200         WHEN OTHER                                               28420000
284300             MOVE '4310-FETCH'   TO DP013-PARAGRAPH               28430000
284400             MOVE 'TPREQIT'      TO DP013-DB2-TABLE-NAME (1)      28440000
284500             MOVE 'TMIITEM'      TO DP013-DB2-TABLE-NAME (2)      28450000
284600             MOVE 'TPURITM'      TO DP013-DB2-TABLE-NAME (3)      28460000
284700             MOVE 'TINVOIC'      TO DP013-DB2-TABLE-NAME (4)      28470000
284800             MOVE SPACES         TO DP013-DB2-TABLE-NAME (5)      28480000
284900             MOVE SQLCA          TO DP013-SQLCA                   28490000
285000             SET DP013-DB2-ABEND                                  28500000
285100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               28510000
285200             PERFORM DP013-0000-PROCESS-ABEND                     28520000
285300     END-EVALUATE.                                                28530000
285400                                                                  28540000
285500 EJECT                                                            28550000
285600*----------------------------------------------------------------*28560000
285700*                                                                *28570000
285800*----------------------------------------------------------------*28580000
285900                                                                  28590000
286000 4320-FILL-IN-OTHER-FLDS.                                         28600000
286100                                                                  28610000
286200*  RETRIEVE THE VENDOR NAME FROM THE TENTNME TABLE                28620000
286300                                                                  28630000
286400     MOVE SPACES  TO  ASC-VENDOR-NAME.                            28640000
286500                                                                  28650000
286600     PERFORM                                                      28660000
286700         WITH TEST AFTER                                          28670000
286800         VARYING PV-READ-COUNT                                    28680000
286900         FROM 1 BY 1                                              28690000
287000         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    28700000
287100            OR  ( SQLCODE = +0)                                   28710000
287200            OR  ( SQLCODE = +100))                                28720000
287300                                                                  28730000
287400                                                                  28740000
287500         EXEC SQL                                                 28750000
287600              SELECT  B.ENT_NAME_DESC                             28760000
287700                    , C.DEPT_NBR                                  28770000
287800                INTO :ENTNME-ENT-NAME-DESC                        28780000
287900                    ,:PURCHS-DEPT-NBR                             28790000
288000                FROM  TEXTENT A                                   28800000
288100                     ,TENTNME B                                   28810000
288200                     ,TPURCHS C                                   28820000
288300               WHERE C.PO_NBR         = :ASC-KEY-PO-NBR           28830000
288400                 AND A.ENT_ID         = C.ENT_ID                  28840000
288500                 AND B.ENT_ID         = C.ENT_ID                  28850000
288600                 AND C.VER_STATUS_CDE = 'A'                       28860000
288700                 AND B.TYPE_CDE       = '01'                      28870000
288800         END-EXEC                                                 28880000
288900                                                                  28890000
289000         EVALUATE TRUE                                            28900000
289100             WHEN SQLCODE = +0                                    28910000
289200                  MOVE ENTNME-ENT-NAME-DESC                       28920000
289300                                  TO ASC-VENDOR-NAME              28930000
289400                  MOVE PURCHS-DEPT-NBR                            28940000
289500                                  TO ASC-DEPT-NBR                 28950000
289600                                                                  28960000
289700             WHEN SQLCODE = -904                                  28970000
289800             WHEN SQLCODE = -913                                  28980000
289900                  CONTINUE                                        28990000
290000                                                                  29000000
290100             WHEN SQLCODE = +100                                  29010000
290200                  MOVE SPACES  TO  ASC-VENDOR-NAME                29020000
290300                  MOVE ZEROS   TO  ASC-DEPT-NBR                   29030000
290400                                                                  29040000
290500             WHEN SQLWARN0 NOT = SPACES                           29050000
290600             WHEN SQLCODE < +0                                    29060000
290700             WHEN SQLCODE > +0                                    29070000
290800                  MOVE '4320-FILL-IN-OTHER-FLDS'                  29080000
290900                                  TO DP013-PARAGRAPH              29090000
291000                  MOVE 'UNSUCCESSFUL SELECT ON PO HEADER'         29100000
291100                                  TO DP013-MESSAGE-TEXT (1)       29110000
291200                  MOVE SQLCA      TO DP013-SQLCA                  29120000
291300                  MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)     29130000
291400                  MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (2)     29140000
291500                  SET DP013-DB2-ABEND                             29150000
291600                      DP013-XCTL-DISPLAY-RESTART                  29160000
291700                                  TO TRUE                         29170000
291800                  PERFORM DP013-0000-PROCESS-ABEND                29180000
291900         END-EVALUATE                                             29190000
292000     END-PERFORM.                                                 29200000
292100                                                                  29210000
292200     IF  PV-READ-COUNT > PC-MAX-RETRIES                           29220000
292300         MOVE '4320-FILL-IN-OTHER-FLDS'                           29230000
292400                                  TO DP013-PARAGRAPH              29240000
292500         MOVE 'MAX RETRIES EXCEEDED ON SELECT FOR PO NBR'         29250000
292600                                  TO DP013-MESSAGE-TEXT (1)       29260000
292700         MOVE SQLCA               TO DP013-SQLCA                  29270000
292800         MOVE 'TPURCHS '          TO DP013-DB2-TABLE-NAME (1)     29280000
292900         MOVE 'TEXTENT '          TO DP013-DB2-TABLE-NAME (2)     29290000
293000         MOVE 'TENTNME '          TO DP013-DB2-TABLE-NAME (3)     29300000
293100         SET DP013-DB2-ABEND      TO TRUE                         29310000
293200         PERFORM DP013-0000-PROCESS-ABEND                         29320000
293300     END-IF.                                                      29330000
293400                                                                  29340000
293500                                                                  29350000
293600***  ---  FILL IN THE RCV(S) INCOMPLETE FIELD ---                 29360000
293700                                                                  29370000
293800     MOVE 'N'     TO  ASC-RCVS-INCOMPLETE-IND.                    29380000
293900                                                                  29390000
294000     PERFORM                                                      29400000
294100         WITH TEST AFTER                                          29410000
294200         VARYING PV-READ-COUNT                                    29420000
294300         FROM 1 BY 1                                              29430000
294400         UNTIL PV-READ-COUNT > PC-MAX-ITEMS                       29440000
294500            OR   SQLCODE = +0                                     29450000
294600            OR   SQLCODE = +100                                   29460000
294700                                                                  29470000
294800         EXEC SQL                                                 29480000
294900            SELECT '1'                                            29490000
295000              INTO  :PV-ONE                                       29500000
295100              FROM SYSIBM.SYSDUMMY1 X                             29510000
295200             WHERE EXISTS                                         29520000
295300                  (SELECT 1                                       29530000
295400                     FROM  TRECEIV A                              29540000
295500                    WHERE A.ORD_NBR        = :ASC-KEY-PO-NBR      29550000
295600                      AND A.VER_STATUS_CDE = 'A'                  29560000
295700                      AND A.STATUS_CDE NOT IN ('VE')              29570000
295800                      AND X.IBMREQD = X.IBMREQD)                  29580000
295900         END-EXEC                                                 29590000
296000                                                                  29600000
296100         EVALUATE TRUE                                            29610000
296200             WHEN SQLCODE = +0                                    29620000
296300                  MOVE 'Y'     TO  ASC-RCVS-INCOMPLETE-IND        29630000
296400                                                                  29640000
296500             WHEN SQLCODE = +100                                  29650000
296600                  MOVE 'N'     TO  ASC-RCVS-INCOMPLETE-IND        29660000
296700                                                                  29670000
296800             WHEN SQLCODE = -904                                  29680000
296900             WHEN SQLCODE = -913                                  29690000
297000                  CONTINUE                                        29700000
297100                                                                  29710000
297200             WHEN SQLWARN0 NOT = SPACES                           29720000
297300             WHEN SQLCODE < +0                                    29730000
297400             WHEN SQLCODE > +0                                    29740000
297500                  MOVE '4320-FILL-IN-OTHER-FLDS'                  29750000
297600                                  TO DP013-PARAGRAPH              29760000
297700                  MOVE 'UNSUCCESSFUL SELECT ON TRECEIV'           29770000
297800                                  TO DP013-MESSAGE-TEXT (1)       29780000
297900                  MOVE SQLCA      TO DP013-SQLCA                  29790000
298000                  MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME (1)     29800000
298100                  SET DP013-DB2-ABEND                             29810000
298200                      DP013-XCTL-DISPLAY-RESTART                  29820000
298300                                  TO TRUE                         29830000
298400                  PERFORM DP013-0000-PROCESS-ABEND                29840000
298500         END-EVALUATE                                             29850000
298600     END-PERFORM.                                                 29860000
298700                                                                  29870000
298800     IF  PV-READ-COUNT > PC-MAX-RETRIES                           29880000
298900         MOVE '4320-FILL-IN-OTHER-FLDS'                           29890000
299000                                  TO DP013-PARAGRAPH              29900000
299100         MOVE 'MAX RETRIES EXCEEDED ON SELECT COUNT FOR '         29910000
299200                                  TO DP013-MESSAGE-TEXT (1)       29920000
299300         MOVE SQLCA               TO DP013-SQLCA                  29930000
299400         MOVE 'TRECEIV '          TO DP013-DB2-TABLE-NAME (1)     29940000
299500         SET DP013-DB2-ABEND      TO TRUE                         29950000
299600         PERFORM DP013-0000-PROCESS-ABEND                         29960000
299700     END-IF.                                                      29970000
299800*                                                                 29980000
299900***  ---  FILL IN THE ALLOWANCE CHARGE INDICATOR  ----            29990000
300000*                                                                 30000000
300100*                                                                 30010000
300200     MOVE 'N'     TO  ASC-ALLW-CHARGE-IND.                        30020000
300300*                                                                 30030000
300400     PERFORM                                                      30040000
300500         WITH TEST AFTER                                          30050000
300600         VARYING PV-READ-COUNT                                    30060000
300700         FROM 1 BY 1                                              30070000
300800         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    30080000
300900                   OR (SQLCODE = ZERO)                            30090000
301000                   OR (SQLCODE = +100))                           30100000
301100                                                                  30110000
301200         EXEC SQL                                                 30120000
301300           SELECT '1'                                             30130000
301400            INTO  :PV-ONE                                         30140000
301500             FROM SYSIBM.SYSDUMMY1 X                              30150000
301600            WHERE EXISTS                                          30160000
301700                 (SELECT 1                                        30170000
301800                    FROM  TINVOIC IV                              30180000
301900                        , TALCHRG AL                              30190000
302000                   WHERE IV.PO_NBR       = :DK-PO-NBR             30200000
302100                     AND IV.INVC_ID      = :INVOIC-INVC-ID        30210000
302200                     AND IV.PO_NBR       = AL.PO_NBR              30220000
302300                     AND IV.INVC_ID      = AL.INVC_ID             30230000
302410                     AND IV.STATUS_CDE   IN ('EN','RC','PJ')      30241001
302420*                    AND IV.STATUS_CDE   IN ('EN','RC')           30242002
302500                     AND IV.INVC_TYP_CDE IN ('MI','RI')           30250000
302600                     AND IV.STR_NBR BETWEEN :DK-STR-NBR-LOW       30260000
302700                                        AND :DK-STR-NBR-HIGH      30270000
302800                     AND IV.DC_NBR  BETWEEN :DK-DC-NBR-LOW        30280000
302900                                        AND :DK-DC-NBR-HIGH       30290000
303000                     AND X.IBMREQD       = X.IBMREQD)             30300000
303100         END-EXEC                                                 30310000
303200                                                                  30320000
303300         EVALUATE TRUE                                            30330000
303400             WHEN SQLCODE = ZERO                                  30340000
303500                 MOVE 'Y'         TO ASC-ALLW-CHARGE-IND          30350000
303600             WHEN SQLCODE = -904                                  30360000
303700             WHEN SQLCODE = -913                                  30370000
303800             WHEN SQLCODE = +100                                  30380000
303900                 CONTINUE                                         30390000
304000             WHEN OTHER                                           30400000
304100                 MOVE '4320-FILL-IN-OTHER-FLDS'                   30410000
304200                                 TO DP013-PARAGRAPH               30420000
304300                 MOVE 'CHECK FOR ALLOWANCES'                      30430000
304400                                 TO DP013-MESSAGE-TEXT (1)        30440000
304500                 MOVE 'TALCHRG'      TO DP013-DB2-TABLE-NAME (1)  30450000
304600                 MOVE SQLCA          TO DP013-SQLCA               30460000
304700                 SET DP013-DB2-ABEND                              30470000
304800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           30480000
304900                 PERFORM DP013-0000-PROCESS-ABEND                 30490000
305000         END-EVALUATE                                             30500000
305100     END-PERFORM.                                                 30510000
305200                                                                  30520000
305300     IF  PV-READ-COUNT > PC-MAX-RETRIES                           30530000
305400         MOVE '4320-FILL-IN-OTHER-FLDS'                           30540000
305500                                   TO DP013-PARAGRAPH             30550000
305600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO COUNT '     30560000
305700                                   TO DP013-MESSAGE-TEXT (1)      30570000
305800         MOVE 'ALLOWANCES   '      TO DP013-MESSAGE-TEXT (2)      30580000
305900         MOVE SQLCA                TO DP013-SQLCA                 30590000
306000         MOVE 'TALCHRG'            TO DP013-DB2-TABLE-NAME (1)    30600000
306100         SET DP013-DB2-ABEND                                      30610000
306200             DP013-XCTL-DISPLAY-RESTART                           30620000
306300                                   TO TRUE                        30630000
306400         PERFORM DP013-0000-PROCESS-ABEND                         30640000
306500     END-IF.                                                      30650000
306600*                                                                 30660000
306700*----------------------------------------------------------------*30670000
306800* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *30680000
306900*----------------------------------------------------------------*30690000
307000                                                                  30700000
307100 4400-MOVE-COMMAREA-TO-SCREEN.                                    30710000
307200                                                                  30720000
307300**   --- FORMAT SCREEN HEADER FIELDS ---                          30730000
307400                                                                  30740000
307500     MOVE ASC-VENDOR-NAME          TO  AVNDNMO.                   30750000
307600     MOVE ASC-VENDOR-STYLE         TO  ASTYLEO.                   30760000
307700                                                                  30770000
307800     MOVE ASC-KEY-PO-NBR           TO  PV-PO-NBR-Z.               30780000
307900     MOVE PV-PO-NBR-Z              TO  APONBRO.                   30790000
308000                                                                  30800000
308100     MOVE ASC-TOTAL-INVC-QTY       TO  PV-TOTAL-INVC-QTY-Z.       30810000
308200     MOVE PV-TOTAL-INVC-QTY-Z      TO  ATINVQO.                   30820000
308300                                                                  30830000
308400     MOVE ASC-TOTAL-RCVD-QTY       TO  PV-TOTAL-RCVD-QTY-Z.       30840000
308500     MOVE PV-TOTAL-RCVD-QTY-Z      TO  ATRCVQO.                   30850000
308600                                                                  30860000
308700**   -- IF THE INVC EXTENDED QTY NOT = RCVD EXTD QTY   --         30870000
308800**   -- HIGHLIGHT BOTH FIELDS.                         --         30880000
308900                                                                  30890000
309000     MOVE DP015-BLUE               TO  ATINVQC                    30900000
309100                                       ATRCVQC                    30910000
309200     IF ASC-TOTAL-INVC-QTY  NOT =  ASC-TOTAL-RCVD-QTY             30920000
309300        MOVE DP015-YELLOW          TO  ATINVQC                    30930000
309400                                       ATRCVQC                    30940000
309500     END-IF.                                                      30950000
309600**                                                                30960000
309700     IF ASC-KEY-PO-LNE-NBR = ZEROS                                30970000
309800        MOVE '*********'           TO  APOLNEO                    30980000
309900        MOVE ZEROS                 TO  PV-TOTAL-RCVD-QTY-Z        30990000
310000        MOVE PV-TOTAL-RCVD-QTY-Z   TO  ATRCVQO                    31000000
310100     ELSE                                                         31010000
310200        MOVE ASC-KEY-PO-LNE-NBR    TO  PV-PO-LNE-NBR-Z            31020000
310300        MOVE PV-PO-LNE-NBR-Z       TO  APOLNEO                    31030000
310400     END-IF.                                                      31040000
310500                                                                  31050000
310600     MOVE ASC-INVC-EXTD-AMT        TO  PV-INVC-EXTD-AMT-Z.        31060000
310700     MOVE PV-INVC-EXTD-AMT-Z       TO  AINVEXO.                   31070000
310800                                                                  31080000
310900*** CALCULATE RCVD EXTENDED AMT ***                               31090000
311000                                                                  31100000
311100     COMPUTE ASC-RCVD-EXTD-AMT ROUNDED =                          31110000
311200        ASC-TOTAL-RCVD-QTY     *   ASC-LOWEST-UNIT-COST.          31120000
311300                                                                  31130000
311400     MOVE ASC-RCVD-EXTD-AMT        TO  PV-RCVD-EXTD-AMT-Z.        31140000
311500     MOVE PV-RCVD-EXTD-AMT-Z       TO  ARCVEXO.                   31150000
311600                                                                  31160000
311700**   -- IF THE INVC EXTENDED AMT NOT = RCVD EXTD AMT   --         31170000
311800**   -- HIGHLIGHT BOTH FIELDS.                         --         31180000
311900                                                                  31190000
312000     MOVE DP015-BLUE               TO AINVEXC                     31200000
312100                                      ARCVEXC                     31210000
312200     IF ASC-INVC-EXTD-AMT NOT = ASC-RCVD-EXTD-AMT                 31220000
312300        MOVE DP015-YELLOW          TO AINVEXC                     31230000
312400                                      ARCVEXC                     31240000
312500     END-IF.                                                      31250000
312600**                                                                31260000
312700     MOVE ASC-KEY-STR-NBR-X        TO  ASTRNBRO.                  31270000
312800     MOVE ASC-DEPT-NBR             TO  ADPTNBRO.                  31280000
312900     MOVE ASC-KEY-DC-NBR-X         TO  ADCNBRO.                   31290000
313000     MOVE ASC-RCVS-INCOMPLETE-IND  TO  ARCVCMO.                   31300000
313100     MOVE ASC-ALLW-CHARGE-IND      TO  ALLCHGO.                   31310000
313200***                                                               31320000
313300     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             31330000
313400         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          31340000
313500         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          31350000
313600             MOVE +1    TO ASC-BLK-SUB                            31360000
313700             PERFORM 5100-WRITE-TEMP-STORAGE                      31370000
313800             ADD +1     TO ASC-BLK-SUB                            31380000
313900             PERFORM 5100-WRITE-TEMP-STORAGE                      31390000
314000             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             31400000
314100                 GIVING PV-BLOCK-NUMBER                           31410000
314200                 REMAINDER PV-REMAINDER                           31420000
314300             IF  PV-REMAINDER > ZERO                              31430000
314400                 ADD +1 TO PV-BLOCK-NUMBER                        31440000
314500             END-IF                                               31450000
314600             MOVE +1    TO ASC-BLK-SUB                            31460000
314700             PERFORM 4410-READ-TEMP-STORAGE                       31470000
314800             ADD +1     TO ASC-BLK-SUB                            31480000
314900                           PV-BLOCK-NUMBER                        31490000
315000             PERFORM 4410-READ-TEMP-STORAGE                       31500000
315100     END-IF.                                                      31510000
315200     MOVE +1            TO ASC-BLK-SUB.                           31520000
315300     COMPUTE ASC-ITEM-SUB =                                       31530000
315400         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              31540000
315500         + PC-ITEMS-PER-PANEL).                                   31550000
315600                                                                  31560000
315700     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        31570000
315800         ADD +1         TO ASC-BLK-SUB                            31580000
315900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            31590000
316000     END-IF.                                                      31600000
316100                                                                  31610000
316200     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           31620000
316300         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                31630000
316400*    PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        31640000
316500     PERFORM 4420-FORMAT-LIST-LINES                               31650000
316600         VARYING PV-SUB                                           31660000
316700         FROM PC-ITEMS-PER-PANEL BY -1                            31670000
316800         UNTIL PV-SUB < +1.                                       31680000
316900                                                                  31690000
317000     COMPUTE ASC-ITEMS-DISPLAYED =                                31700000
317100         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          31710000
317200     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    31720000
317300                                      ASTRTITO.                   31730000
317400     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    31740000
317500     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    31750000
317600     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            31760000
317700                                   TO ASELITO.                    31770000
317800                                                                  31780000
317900     IF  DP020-MSG-NUMBER-X = SPACE                               31790000
318000         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  31800000
318100*            --- MORE ITEMS TO DISPLAY ----                       31810000
318200             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            31820000
318300             SET DP020-MSG-INFORMATIONAL TO TRUE                  31830000
318400         END-IF                                                   31840000
318500     END-IF.                                                      31850000
318600                                                                  31860000
318700*----------------------------------------------------------------*31870000
318800*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *31880000
318900*----------------------------------------------------------------*31890000
319000                                                                  31900000
319100 4410-READ-TEMP-STORAGE.                                          31910000
319200                                                                  31920000
319300     EXEC CICS                                                    31930000
319400         READQ TS                                                 31940000
319500             QUEUE (ASC-LIST-QUEUE-NAME)                          31950000
319600             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               31960000
319700             ITEM  (PV-BLOCK-NUMBER)                              31970000
319800             RESP  (PV-CICS-RESP)                                 31980000
319900     END-EXEC.                                                    31990000
320000                                                                  32000000
320100     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       32010000
320200       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     32020000
320300         CONTINUE                                                 32030000
320400     ELSE                                                         32040000
320500         SET DP013-CICS-ABEND     TO TRUE                         32050000
320600         SET DP013-NO-ROLLBACK    TO TRUE                         32060000
320700         MOVE '4410-READ-TEMP-STORAGE'                            32070000
320800                                  TO DP013-PARAGRAPH              32080000
320900         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      32090000
321000                                  TO DP013-MESSAGE-TEXT(1)        32100000
321100         PERFORM DP013-0000-PROCESS-ABEND                         32110000
321200     END-IF.                                                      32120000
321300                                                                  32130000
321400     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             32140000
321500                                                                  32150000
321600     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         32160000
321700         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               32170000
321800     END-IF.                                                      32180000
321900 EJECT                                                            32190000
322000                                                                  32200000
322100*----------------------------------------------------------------*32210000
322200*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *32220000
322300*----------------------------------------------------------------*32230000
322400                                                                  32240000
322500 4420-FORMAT-LIST-LINES.                                          32250000
322600                                                                  32260000
322700     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      32270000
322800         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                32280000
322900         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA    (PV-SUB)        32290000
323000         MOVE SPACE              TO MR-SELECTI    (PV-SUB)        32300000
323100                                    MR-INVC-NBR   (PV-SUB)        32310000
323200                                    MR-INVC-QTY   (PV-SUB)        32320000
323300                                    MR-INVC-UNIT-COST             32330000
323400                                                  (PV-SUB)        32340000
323500                                    MR-RCVD-UNIT-COST             32350000
323600                                                  (PV-SUB)        32360000
323700                                    MR-ADJU-UNIT-COST             32370000
323800                                                  (PV-SUB)        32380000
323900                                    MR-INVC-LINE  (PV-SUB)        32390000
324000                                    MR-HOLD-IND   (PV-SUB)        32400000
324100     ELSE                                                         32410000
324200         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      32420000
324300                                                   > SPACE        32430000
324400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 32440000
324500                                 TO MR-SELECTI (PV-SUB)           32450000
324600         ELSE                                                     32460000
324700             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      32470000
324800                                 TO MR-SELECTI (PV-SUB)           32480000
324900         END-IF                                                   32490000
325000                                                                  32500000
325100         IF  DP030-SET-CURSOR-TRAILER                             32510000
325200             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)32520000
325300                 > SPACE)                                         32530000
325400               OR (PV-SUB = 1))                                   32540000
325500                SET DP030-SET-CURSOR-APPL-1 TO TRUE               32550000
325600                MOVE -1          TO MR-SELECTL (PV-SUB)           32560000
325700             END-IF                                               32570000
325800         END-IF                                                   32580000
325900                                                                  32590000
326000         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           32600000
326100             MOVE ASC-INVC-ID       (ASC-BLK-SUB ASC-ITEM-SUB)    32610000
326200                                 TO MR-INVC-NBR       (PV-SUB)    32620000
326300             MOVE ASC-INVC-QTY      (ASC-BLK-SUB ASC-ITEM-SUB)    32630000
326400                                 TO MR-INVC-QTY-9     (PV-SUB)    32640000
326500             MOVE ASC-INVC-UNIT-COST (ASC-BLK-SUB ASC-ITEM-SUB)   32650000
326600                                 TO MR-INVC-UNIT-COST-9 (PV-SUB)  32660000
326700             MOVE ASC-RCVD-UNIT-COST (ASC-BLK-SUB ASC-ITEM-SUB)   32670000
326800                                 TO MR-RCVD-UNIT-COST-9 (PV-SUB)  32680000
326900             MOVE ASC-ADJU-UNIT-COST (ASC-BLK-SUB ASC-ITEM-SUB)   32690000
327000                                 TO MR-ADJU-UNIT-COST-9 (PV-SUB)  32700000
327100             MOVE ASC-INVC-LNE-NBR  (ASC-BLK-SUB ASC-ITEM-SUB)    32710000
327200                                 TO MR-INVC-LINE-9    (PV-SUB)    32720000
327300             MOVE ASC-HOLD-IND      (ASC-BLK-SUB ASC-ITEM-SUB)    32730000
327400                                 TO MR-HOLD-IND       (PV-SUB)    32740000
327500         END-IF                                                   32750000
327600     END-IF.                                                      32760000
327700     SUBTRACT +1 FROM ASC-ITEM-SUB                                32770000
327800     IF  ASC-ITEM-SUB < + 1                                       32780000
327900         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  32790000
328000         MOVE +1                 TO ASC-BLK-SUB                   32800000
328100     END-IF.                                                      32810000
328200                                                                  32820000
328300*----------------------------------------------------------------*32830000
328400*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *32840000
328500*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *32850000
328600*  ISSUE A WARNING.                                              *32860000
328700*----------------------------------------------------------------*32870000
328800                                                                  32880000
328900 4430-CHECK-FOR-BEGIN-AND-END.                                    32890000
329000                                                                  32900000
329100     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       32910000
329200         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     32920000
329300*            -- NO END-OF-RANGE SPECFIED ---                      32930000
329400             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            32940000
329500             SET DP020-MSG-WARNING TO TRUE                        32950000
329600             PERFORM 4431-POSITION-AT-WARNING                     32960000
329700         END-IF                                                   32970000
329800     ELSE                                                         32980000
329900         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     32990000
330000*            -- NO BEGINNING-OF-RANGE SPECFIED ---                33000000
330100             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            33010000
330200             SET DP020-MSG-WARNING TO TRUE                        33020000
330300             PERFORM 4431-POSITION-AT-WARNING                     33030000
330400         END-IF                                                   33040000
330500     END-IF.                                                      33050000
330600                                                                  33060000
330700*----------------------------------------------------------------*33070000
330800*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *33080000
330900*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *33090000
331000*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *33100000
331100*  POSITION THE CURSOR THERE.                                    *33110000
331200*----------------------------------------------------------------*33120000
331300                                                                  33130000
331400 4431-POSITION-AT-WARNING.                                        33140000
331500                                                                  33150000
331600     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 33160000
331700                    - PV-TOP-ITEM + 1.                            33170000
331800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      33180000
331900         CONTINUE                                                 33190000
332000     ELSE                                                         33200000
332100         SET DP030-SET-CURSOR-APPL-1                              33210000
332200                                   TO TRUE                        33220000
332300         MOVE -1                   TO MR-SELECTL (PV-SUB)         33230000
332400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         33240000
332500         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         33250000
332600     END-IF.                                                      33260000
332700                                                                  33270000
332800     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   33280000
332900                    - PV-TOP-ITEM + 1.                            33290000
333000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      33300000
333100         CONTINUE                                                 33310000
333200     ELSE                                                         33320000
333300         SET DP030-SET-CURSOR-APPL-1                              33330000
333400                                   TO TRUE                        33340000
333500         MOVE -1                   TO MR-SELECTL (PV-SUB)         33350000
333600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         33360000
333700         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         33370000
333800     END-IF.                                                      33380000
333900 EJECT                                                            33390000
334000                                                                  33400000
334100                                                                  33410000
334200*----------------------------------------------------------------*33420000
334300* THE UNIT-COST-SELECTION-CODES FROM THE TMIITEM TABLE ARE       *33430000
334400* UPDATED IN THIS PARAGRAPH.                                     *33440000
334500*----------------------------------------------------------------*33450000
334600                                                                  33460000
334700 4500-PROCESS-TMIITEM-UPDATE.                                     33470000
334800                                                                  33480000
334900     EVALUATE TRUE                                                33490000
335000                                                                  33500000
335100        WHEN ASC-NUMBER-OF-SELECTED-ITEMS = 0                     33510000
335200            MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER              33520000
335300            SET DP020-MSG-FATAL TO TRUE                           33530000
335400            SET PS-ERROR TO TRUE                                  33540000
335500            SET DP030-SET-CURSOR-TRAILER TO TRUE                  33550000
335600                                                                  33560000
335700        WHEN ASC-NUMBER-OF-SELECTED-ITEMS = 1                     33570000
335800                                                                  33580000
335900            IF PS-NO-ERROR                                        33590000
336000                IF ASC-SEL-INVC-UNIT-COST =                       33600000
336100                   ASC-SEL-RCVD-UNIT-COST                         33610000
336200                    MOVE PC-TSYMSG-02899 TO DP020-MSG-NUMBER      33620000
336300                    SET DP020-MSG-WARNING  TO  TRUE               33630000
336400                    SET PS-ERROR TO TRUE                          33640000
336500                    SET DP030-SET-CURSOR-TRAILER TO TRUE          33650000
336600                ELSE                                              33660000
336700                    PERFORM 7000-UPDATE-TMIITEM                   33670000
336800                END-IF                                            33680000
336900            END-IF                                                33690000
337000                                                                  33700000
337100        WHEN OTHER                                                33710000
337200            MOVE PC-TSYMSG-00047 TO DP020-MSG-NUMBER              33720000
337300            SET DP020-MSG-WARNING  TO  TRUE                       33730000
337400            SET PS-ERROR TO TRUE                                  33740000
337500            SET DP030-SET-CURSOR-TRAILER TO TRUE                  33750000
337600                                                                  33760000
337700     END-EVALUATE.                                                33770000
337800                                                                  33780000
337900*----------------------------------------------------------------*33790000
338000* THE UNIT-COST-SELECTION-CODES FROM THE TMIITEM TABLE ARE       *33800000
338100* UPDATED IN THIS PARAGRAPH FOR SELECTALL FUNCTION ONLY TO POINT *33810000
338200* TO THE RECEIVING UNIT COST.                                    *33820000
338300*----------------------------------------------------------------*33830000
338400                                                                  33840000
338500 4501-PROCESS-TMIITEM-UPDATE-II.                                  33850000
338600                                                                  33860000
338700     EVALUATE TRUE                                                33870000
338800        WHEN ASC-NUMBER-OF-SELECTED-ITEMS > 1                     33880000
338900            PERFORM 4510-CHECK-RCV-ZERO-UNIT-COSTS                33890000
339000            IF PS-ZERO-RCVD-COST-FND                              33900000
339100               SET PS-ZERO-RCVD-COST-NOT-FND TO TRUE              33910000
339200               MOVE PC-TSYMSG-02900 TO DP020-MSG-NUMBER           33920000
339300               SET DP020-MSG-WARNING  TO  TRUE                    33930000
339400               SET PS-ERROR TO TRUE                               33940000
339500               SET DP030-SET-CURSOR-TRAILER TO TRUE               33950000
339600            END-IF                                                33960000
339700                                                                  33970000
339800            IF PS-NO-ERROR                                        33980000
339900                PERFORM 4520-CHECK-ALL-RCVD-UNIT-COST             33990000
340000                IF PS-INV-COST-EQL-RCVD-COST-FND                  34000000
340100                   SET PS-INV-COST-EQL-RCVD-COST-NTFD TO TRUE     34010000
340200                    MOVE PC-TSYMSG-02899 TO DP020-MSG-NUMBER      34020000
340300                    SET DP020-MSG-WARNING  TO  TRUE               34030000
340400                    SET PS-ERROR TO TRUE                          34040000
340500                    SET DP030-SET-CURSOR-TRAILER TO TRUE          34050000
340600                ELSE                                              34060000
340700                    PERFORM 7005-UPDATE-ALL-RCVD-UNIT-COST        34070000
340800**   -- DISPLAY UPDATE SUCCESSFUL MESSAGE --                      34080000
340900                                                                  34090000
341000                    IF PS-NO-ERROR   AND                          34100000
341100                       PS-NO-ERROR-DB2                            34110000
341200                       MOVE PC-TSYMSG-00059 TO DP020-MSG-NUMBER   34120000
341300                       SET DP030-SET-CURSOR-APPL-1  TO TRUE       34130000
341400                       SET DP020-MSG-INFORMATIONAL  TO TRUE       34140000
341500                    END-IF                                        34150000
341600                                                                  34160000
341700                END-IF                                            34170000
341800            END-IF                                                34180000
341900                                                                  34190000
342000        WHEN OTHER                                                34200000
342100            MOVE PC-TSYMSG-00047 TO DP020-MSG-NUMBER              34210000
342200            SET DP020-MSG-WARNING  TO  TRUE                       34220000
342300            SET PS-ERROR TO TRUE                                  34230000
342400            SET DP030-SET-CURSOR-TRAILER TO TRUE                  34240000
342500                                                                  34250000
342600     END-EVALUATE.                                                34260000
342700                                                                  34270000
342800*----------------------------------------------------------------*34280000
342900* THIS PARAGRAPH CYCLES THROUGH THE TEMP STORAGE QUEUE LOOKING   *34290000
343000* TO SEE IF ANY RECEIVING UNIT COSTS EQUAL ZERO DOLLARS.  IF ANY *34300000
343100* OF THEM ARE $0, THEN THE RECEIVING UNIT COST UPDATE (PARA      *34310000
343200* 7005-) WILL NOT HAPPEN.                                        *34320000
343300*----------------------------------------------------------------*34330000
343400                                                                  34340000
343500 4510-CHECK-RCV-ZERO-UNIT-COSTS.                                  34350000
343600                                                                  34360000
343700     MOVE 1 TO ASC-BLK-SUB.                                       34370000
343800     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             34380000
343900     PERFORM 4515-CHECK-SEL-RCV-UNIT-COSTS                        34390000
344000      VARYING ASC-ITEM-SUB FROM 1 BY 1                            34400000
344100       UNTIL (ASC-ITEM-SUB > PC-ITEMS-PER-PANEL)                  34410000
344200          OR (ASC-SELECTED-SW(ASC-BLK-SUB ASC-ITEM-SUB)           34420000
344300                                             NOT = 'S').          34430000
344400                                                                  34440000
344500     ADD +1 TO ASC-BLK-SUB.                                       34450000
344600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             34460000
344700     PERFORM 4515-CHECK-SEL-RCV-UNIT-COSTS                        34470000
344800      VARYING ASC-ITEM-SUB FROM 1 BY 1                            34480000
344900       UNTIL (ASC-ITEM-SUB > PC-ITEMS-PER-PANEL)                  34490000
345000          OR (ASC-SELECTED-SW(ASC-BLK-SUB ASC-ITEM-SUB)           34500000
345100                                             NOT = 'S').          34510000
345200                                                                  34520000
345300     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               34530000
345400                                   TO PV-LIST-ITEM-NUMBER.        34540000
345500                                                                  34550000
345600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            34560000
345700         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    34570000
345800                                                                  34580000
345900     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     34590000
346000        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    34600000
346100         MOVE +1                   TO ASC-BLK-SUB                 34610000
346200                                                                  34620000
346300         PERFORM 5100-WRITE-TEMP-STORAGE                          34630000
346400                                                                  34640000
346500         MOVE +1                   TO PV-BLOCK-NUMBER             34650000
346600                                                                  34660000
346700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         34670000
346800             PV-FIRST-BLOCK-IN-ARRAY - 1                          34680000
346900                                                                  34690000
347000         PERFORM                                                  34700000
347100             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       34710000
347200                                                                  34720000
347300             PERFORM 4410-READ-TEMP-STORAGE                       34730000
347400                                                                  34740000
347500             SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE      34750000
347600             PERFORM 4515-CHECK-SEL-RCV-UNIT-COSTS                34760000
347700              VARYING ASC-ITEM-SUB FROM 1 BY 1                    34770000
347800               UNTIL (ASC-ITEM-SUB > PC-ITEMS-PER-PANEL)          34780000
347900                  OR (ASC-SELECTED-SW(ASC-BLK-SUB ASC-ITEM-SUB)   34790000
348000                                                     NOT = 'S')   34800000
348100                                                                  34810000
348200             PERFORM 5100-WRITE-TEMP-STORAGE                      34820000
348300                                                                  34830000
348400             ADD +1                TO PV-BLOCK-NUMBER             34840000
348500                                                                  34850000
348600         END-PERFORM                                              34860000
348700                                                                  34870000
348800         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         34880000
348900             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     34890000
349000                                                                  34900000
349100         PERFORM                                                  34910000
349200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       34920000
349300                   ASC-HIGHEST-BLOCK-WRITTEN                      34930000
349400                                                                  34940000
349500             MOVE PV-NEXT-BLOCK-IN-ARRAY                          34950000
349600                                   TO PV-BLOCK-NUMBER             34960000
349700                                                                  34970000
349800             PERFORM 4410-READ-TEMP-STORAGE                       34980000
349900                                                                  34990000
350000             SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE      35000000
350100             PERFORM 4515-CHECK-SEL-RCV-UNIT-COSTS                35010000
350200              VARYING ASC-ITEM-SUB FROM 1 BY 1                    35020000
350300               UNTIL (ASC-ITEM-SUB > PC-ITEMS-PER-PANEL)          35030000
350400                  OR (ASC-SELECTED-SW(ASC-BLK-SUB ASC-ITEM-SUB)   35040000
350500                                                     NOT = 'S')   35050000
350600                                                                  35060000
350700             PERFORM 5100-WRITE-TEMP-STORAGE                      35070000
350800                                                                  35080000
350900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      35090000
351000                                                                  35100000
351100         END-PERFORM                                              35110000
351200                                                                  35120000
351300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             35130000
351400                                   TO PV-BLOCK-NUMBER             35140000
351500                                                                  35150000
351600         PERFORM 4410-READ-TEMP-STORAGE                           35160000
351700     END-IF.                                                      35170000
351800                                                                  35180000
351900*----------------------------------------------------------------*35190000
352000* THIS PARAGRAPH CHECKS ALL OF THE SELECTED INVOICES FOR ANY     *35200000
352100* RECEIVING UNIT COSTS = ZERO DOLLAR AMOUNT.                     *35210000
352200*----------------------------------------------------------------*35220000
352300                                                                  35230000
352400 4515-CHECK-SEL-RCV-UNIT-COSTS.                                   35240000
352500                                                                  35250000
352600     IF ASC-RCVD-UNIT-COST(ASC-BLK-SUB ASC-ITEM-SUB) = 0          35260000
352700        SET PS-ZERO-RCVD-COST-FND TO TRUE                         35270000
352800     END-IF.                                                      35280000
352900                                                                  35290000
353000*----------------------------------------------------------------*35300000
353100* THIS PARAGRAPH CYCLES THROUGH THE TEMP STORAGE QUEUE LOOKING   *35310000
353200* TO SEE IF ANY RECEIVING UNIT COSTS EQUAL THE CORRESPONDING     *35320000
353300* INVOICE UNIT COSTS.  IF ANY OF THEM ARE EQUAL THEN THE         *35330000
353400* RECEIVING UNIT COST UPDATE (PARA 7005-) WILL NOT HAPPEN.       *35340000
353500*----------------------------------------------------------------*35350000
353600                                                                  35360000
353700 4520-CHECK-ALL-RCVD-UNIT-COST.                                   35370000
353800                                                                  35380000
353900     MOVE 1 TO ASC-BLK-SUB.                                       35390000
354000     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             35400000
354100     PERFORM 4525-COMPARE-INV-AND-RCV-COSTS                       35410000
354200      VARYING ASC-ITEM-SUB FROM 1 BY 1                            35420000
354300       UNTIL (ASC-ITEM-SUB > PC-ITEMS-PER-PANEL)                  35430000
354400          OR (ASC-SELECTED-SW(ASC-BLK-SUB ASC-ITEM-SUB)           35440000
354500                                             NOT = 'S').          35450000
354600                                                                  35460000
354700     ADD +1 TO ASC-BLK-SUB.                                       35470000
354800     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             35480000
354900     PERFORM 4525-COMPARE-INV-AND-RCV-COSTS                       35490000
355000      VARYING ASC-ITEM-SUB FROM 1 BY 1                            35500000
355100       UNTIL (ASC-ITEM-SUB > PC-ITEMS-PER-PANEL)                  35510000
355200          OR (ASC-SELECTED-SW(ASC-BLK-SUB ASC-ITEM-SUB)           35520000
355300                                             NOT = 'S').          35530000
355400                                                                  35540000
355500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               35550000
355600                                   TO PV-LIST-ITEM-NUMBER.        35560000
355700                                                                  35570000
355800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            35580000
355900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    35590000
356000                                                                  35600000
356100     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     35610000
356200        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    35620000
356300         MOVE +1                   TO ASC-BLK-SUB                 35630000
356400                                                                  35640000
356500         PERFORM 5100-WRITE-TEMP-STORAGE                          35650000
356600                                                                  35660000
356700         MOVE +1                   TO PV-BLOCK-NUMBER             35670000
356800                                                                  35680000
356900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         35690000
357000             PV-FIRST-BLOCK-IN-ARRAY - 1                          35700000
357100                                                                  35710000
357200         PERFORM                                                  35720000
357300             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       35730000
357400                                                                  35740000
357500             PERFORM 4410-READ-TEMP-STORAGE                       35750000
357600                                                                  35760000
357700             SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE      35770000
357800             PERFORM 4525-COMPARE-INV-AND-RCV-COSTS               35780000
357900              VARYING ASC-ITEM-SUB FROM 1 BY 1                    35790000
358000               UNTIL (ASC-ITEM-SUB > PC-ITEMS-PER-PANEL)          35800000
358100                  OR (ASC-SELECTED-SW(ASC-BLK-SUB ASC-ITEM-SUB)   35810000
358200                                                     NOT = 'S')   35820000
358300                                                                  35830000
358400             PERFORM 5100-WRITE-TEMP-STORAGE                      35840000
358500                                                                  35850000
358600             ADD +1                TO PV-BLOCK-NUMBER             35860000
358700                                                                  35870000
358800         END-PERFORM                                              35880000
358900                                                                  35890000
359000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         35900000
359100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     35910000
359200                                                                  35920000
359300         PERFORM                                                  35930000
359400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       35940000
359500                   ASC-HIGHEST-BLOCK-WRITTEN                      35950000
359600                                                                  35960000
359700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          35970000
359800                                   TO PV-BLOCK-NUMBER             35980000
359900                                                                  35990000
360000             PERFORM 4410-READ-TEMP-STORAGE                       36000000
360100                                                                  36010000
360200             SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE      36020000
360300             PERFORM 4525-COMPARE-INV-AND-RCV-COSTS               36030000
360400              VARYING ASC-ITEM-SUB FROM 1 BY 1                    36040000
360500               UNTIL (ASC-ITEM-SUB > PC-ITEMS-PER-PANEL)          36050000
360600                  OR (ASC-SELECTED-SW(ASC-BLK-SUB ASC-ITEM-SUB)   36060000
360700                                                     NOT = 'S')   36070000
360800                                                                  36080000
360900             PERFORM 5100-WRITE-TEMP-STORAGE                      36090000
361000                                                                  36100000
361100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      36110000
361200                                                                  36120000
361300         END-PERFORM                                              36130000
361400                                                                  36140000
361500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             36150000
361600                                   TO PV-BLOCK-NUMBER             36160000
361700                                                                  36170000
361800         PERFORM 4410-READ-TEMP-STORAGE                           36180000
361900     END-IF.                                                      36190000
362000                                                                  36200000
362100*----------------------------------------------------------------*36210000
362200* THIS PARAGRAPH COMPARES ALL OF THE SELECTED INVOICE UNIT COSTS *36220000
362300* TO THE RECEIVING UNIT COSTS.                                   *36230000
362400*----------------------------------------------------------------*36240000
362500                                                                  36250000
362600 4525-COMPARE-INV-AND-RCV-COSTS.                                  36260000
362700                                                                  36270000
362800     IF ASC-RCVD-UNIT-COST(ASC-BLK-SUB ASC-ITEM-SUB) =            36280000
362900         ASC-INVC-UNIT-COST(ASC-BLK-SUB ASC-ITEM-SUB)             36290000
363000        SET PS-INV-COST-EQL-RCVD-COST-FND TO TRUE                 36300000
363100     END-IF.                                                      36310000
363200                                                                  36320000
363300*----------------------------------------------------------------*36330000
363400* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *36340000
363500* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *36350000
363600* FOR THE SELECTED ITEMS QUEUE.                                  *36360000
363700*                                                                *36370000
363800* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *36380000
363900* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *36390000
364000* THE ARRAY IS FULL.                                             *36400000
364100*----------------------------------------------------------------*36410000
364200                                                                  36420000
364300 5000-PREPARE-SEL-QUEUE.                                          36430000
364400                                                                  36440000
364500     MOVE +1                   TO  ASC-BLK-SUB.                   36450000
364600     PERFORM 5100-WRITE-TEMP-STORAGE.                             36460000
364700     ADD +1                    TO  ASC-BLK-SUB.                   36470000
364800     PERFORM 5100-WRITE-TEMP-STORAGE.                             36480000
364900                                                                  36490000
365000     MOVE ASC-SEL-QUEUE-NAME-OUT                                  36500000
365100                               TO  AP300-SEL-QUEUE-NAME.          36510000
365200     PERFORM 6010-DELETE-SEL-QUEUE.                               36520000
365300                                                                  36530000
365400     SET ASC-UPDATE-TSQ        TO  TRUE.                          36540000
365500                                                                  36550000
365600     SET AP301-IDX             TO  1.                             36560000
365700     MOVE ZERO                 TO AP300-NUMBER-OF-TS-ITEMS.       36570000
365800     INITIALIZE AP301-SELECTED-ITEM-ARRAY.                        36580000
365900                                                                  36590000
366000     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           36600000
366100             VARYING PV-ITEM                                      36610000
366200             FROM 1 BY 1                                          36620000
366300             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     36630000
366400                                                                  36640000
366500     IF  AP301-IDX > 1                                            36650000
366600         PERFORM 5205-WRITE-SEL-QUEUE                             36660000
366700         ADD +1                TO AP300-NUMBER-OF-TS-ITEMS        36670000
366800     END-IF.                                                      36680000
366900 EJECT                                                            36690000
367000                                                                  36700000
367100*----------------------------------------------------------------*36710000
367200*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *36720000
367300*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *36730000
367400*----------------------------------------------------------------*36740000
367500                                                                  36750000
367600 5100-WRITE-TEMP-STORAGE.                                         36760000
367700                                                                  36770000
367800     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     36780000
367900                                   TO PV-LIST-ITEM-NUMBER.        36790000
368000     COMPUTE PV-BLOCK-NUMBER =                                    36800000
368100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    36810000
368200                                                                  36820000
368300     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             36830000
368400     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             36840000
368500         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      36850000
368600             PERFORM 5105-REWRITE-ASC-LISTQ                       36860000
368700         END-IF                                                   36870000
368800     ELSE                                                         36880000
368900         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       36890000
369000         ASC-HIGHEST-BLOCK-WRITTEN + 1                            36900000
369100         PERFORM 5110-WRITE-ASC-LISTQ                             36910000
369200         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   36920000
369300     END-IF.                                                      36930000
369400                                                                  36940000
369500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             36950000
369600                                                                  36960000
369700*----------------------------------------------------------------*36970000
369800*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *36980000
369900*  SPECIFIC COMMAREA.                                            *36990000
370000*----------------------------------------------------------------*37000000
370100                                                                  37010000
370200 5105-REWRITE-ASC-LISTQ.                                          37020000
370300                                                                  37030000
370400     EXEC CICS                                                    37040000
370500         WRITEQ TS                                                37050000
370600             QUEUE (ASC-LIST-QUEUE-NAME)                          37060000
370700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               37070000
370800             ITEM  (PV-BLOCK-NUMBER)                              37080000
370900             REWRITE                                              37090000
371000             RESP  (PV-CICS-RESP)                                 37100000
371100     END-EXEC.                                                    37110000
371200                                                                  37120000
371300     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           37130000
371400         CONTINUE                                                 37140000
371500     ELSE                                                         37150000
371600         SET DP013-CICS-ABEND            TO TRUE                  37160000
371700         SET DP013-NO-ROLLBACK           TO TRUE                  37170000
371800         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       37180000
371900         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     37190000
372000                                         TO DP013-MESSAGE-TEXT(1) 37200000
372100         PERFORM DP013-0000-PROCESS-ABEND                         37210000
372200     END-IF.                                                      37220000
372300                                                                  37230000
372400*----------------------------------------------------------------*37240000
372500*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *37250000
372600*  SPECIFIC COMMAREA.                                            *37260000
372700*----------------------------------------------------------------*37270000
372800                                                                  37280000
372900 5110-WRITE-ASC-LISTQ.                                            37290000
373000                                                                  37300000
373100     EXEC CICS                                                    37310000
373200         WRITEQ TS                                                37320000
373300             QUEUE (ASC-LIST-QUEUE-NAME)                          37330000
373400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               37340000
373500             ITEM  (PV-BLOCK-NUMBER)                              37350000
373600             RESP  (PV-CICS-RESP)                                 37360000
373700     END-EXEC.                                                    37370000
373800     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      37380000
373900         SET DP013-CICS-ABEND      TO TRUE                        37390000
374000         SET DP013-NO-ROLLBACK     TO TRUE                        37400000
374100         MOVE '5110-WRITE-ASC-LISTQ'                              37410000
374200                                   TO DP013-PARAGRAPH             37420000
374300         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           37430000
374400                                   TO DP013-MESSAGE-TEXT(1)       37440000
374500         PERFORM DP013-0000-PROCESS-ABEND                         37450000
374600     END-IF.                                                      37460000
374700 EJECT                                                            37470000
374800                                                                  37480000
374900*----------------------------------------------------------------*37490000
375000* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *37500000
375100* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *37510000
375200*----------------------------------------------------------------*37520000
375300                                                                  37530000
375400 5200-FILL-SEL-QUEUE-RECORD.                                      37540000
375500                                                                  37550000
375600     PERFORM 6112-READ-LIST-QUEUE.                                37560000
375700                                                                  37570000
375800     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       37580000
375900         PERFORM                                                  37590000
376000         VARYING LQW-IDX                                          37600000
376100         FROM 1 BY 1                                              37610000
376200         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            37620000
376300           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          37630000
376400                                                                  37640000
376500             IF  LQW-SELECT (LQW-IDX)                             37650000
376600                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              37660000
376700                                   TO AP301-ITEM      (AP301-IDX) 37670000
376800                 MOVE ASC-KEY-PO-NBR                              37680000
376900                                   TO AP301-PO-NBR    (AP301-IDX) 37690000
377000                 MOVE LQW-INVC-ID          (LQW-IDX)              37700000
377100                                   TO AP301-INVC-ID   (AP301-IDX) 37710000
377200*                MOVE LQW-STR-NBR          (LQW-IDX)              37720000
377300*                                  TO AP301-STORE-NBR (AP301-IDX) 37730000
377400                 MOVE SPACE        TO AP301-ACTION-SW (AP301-IDX) 37740000
377500                 SET AP301-IDX UP BY 1                            37750000
377600                 IF  AP301-IDX > AP301-MAX-ITEMS                  37760000
377700                     PERFORM 5205-WRITE-SEL-QUEUE                 37770000
377800                     ADD +1        TO AP300-NUMBER-OF-TS-ITEMS    37780000
377900                     INITIALIZE AP301-SELECTED-ITEM-ARRAY         37790000
378000                     SET AP301-IDX TO  1                          37800000
378100                 END-IF                                           37810000
378200             END-IF                                               37820000
378300         END-PERFORM                                              37830000
378400     END-IF.                                                      37840000
378500                                                                  37850000
378600*----------------------------------------------------------------*37860000
378700*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *37870000
378800*----------------------------------------------------------------*37880000
378900                                                                  37890000
379000 5205-WRITE-SEL-QUEUE.                                            37900000
379100                                                                  37910000
379200     EXEC CICS                                                    37920000
379300          WRITEQ TS                                               37930000
379400              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      37940000
379500              FROM  (AP301-INVC-LIST-TS-RCRD)                     37950000
379600              ITEM  (PV-SEL-QUEUE-ITEM)                           37960000
379700              RESP  (PV-CICS-RESP)                                37970000
379800     END-EXEC.                                                    37980000
379900                                                                  37990000
380000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          38000000
380100         CONTINUE                                                 38010000
380200     ELSE                                                         38020000
380300         SET DP013-CICS-ABEND      TO TRUE                        38030000
380400         SET DP013-NO-ROLLBACK     TO TRUE                        38040000
380500         MOVE '5205-WRITE-SEL-QUEUE'                              38050000
380600                                   TO DP013-PARAGRAPH             38060000
380700         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          38070000
380800                                   TO DP013-MESSAGE-TEXT(1)       38080000
380900         PERFORM DP013-0000-PROCESS-ABEND                         38090000
381000     END-IF.                                                      38100000
381100 EJECT                                                            38110000
381200                                                                  38120000
381300*----------------------------------------------------------------*38130000
381400*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *38140000
381500*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *38150000
381600*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *38160000
381700*  THE USER.                                                     *38170000
381800*----------------------------------------------------------------*38180000
381900                                                                  38190000
382000 6000-REFRESH-PANEL-FROM-TEMP.                                    38200000
382100                                                                  38210000
382200     IF  ASC-UPDATE-TSQ                                           38220000
382300       AND ASC-NUMBER-OF-SELECTED-ITEMS > 0                       38230000
382400         SET ASC-NO-TSQ-UPDATE TO TRUE                            38240000
382500         MOVE ZERO                 TO PV-SAVE-ITEM                38250000
382600                                      PV-SEL-QUEUE-ITEM           38260000
382700         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        38270000
382800                                   TO PV-HOLD-SELECTED-ITEMS      38280000
382900         MOVE +1                   TO PV-ITEMS-PROCESSED          38290000
383000         PERFORM 6100-UPDATE-TSQ                                  38300000
383100             UNTIL PV-ITEMS-PROCESSED >                           38310000
383200                                     PV-HOLD-SELECTED-ITEMS       38320000
383300         PERFORM 6010-DELETE-SEL-QUEUE                            38330000
383400         INITIALIZE ASC-BLOCK-ENTRIES (1)                         38340000
383500                    ASC-BLOCK-ENTRIES (2)                         38350000
383600     END-IF.                                                      38360000
383700                                                                  38370000
383800*----------------------------------------------------------------*38380000
383900*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *38390000
384000*----------------------------------------------------------------*38400000
384100                                                                  38410000
384200 6010-DELETE-SEL-QUEUE.                                           38420000
384300                                                                  38430000
384400     EXEC CICS                                                    38440000
384500         DELETEQ TS                                               38450000
384600             QUEUE (ASC-SEL-QUEUE-NAME-OUT)                       38460000
384700             RESP  (PV-CICS-RESP)                                 38470000
384800     END-EXEC.                                                    38480000
384900                                                                  38490000
385000     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      38500000
385100        (PV-CICS-RESP = DFHRESP(QIDERR)))                         38510000
385200         CONTINUE                                                 38520000
385300     ELSE                                                         38530000
385400         SET DP013-CICS-ABEND TO TRUE                             38540000
385500         SET DP013-NO-ROLLBACK TO TRUE                            38550000
385600         MOVE '6010-DELETE-SEL-QUEUE'                             38560000
385700                        TO DP013-PARAGRAPH                        38570000
385800         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         38580000
385900                        TO DP013-MESSAGE-TEXT (1)                 38590000
386000         PERFORM DP013-0000-PROCESS-ABEND                         38600000
386100     END-IF.                                                      38610000
386200                                                                  38620000
386300*----------------------------------------------------------------*38630000
386400*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *38640000
386500*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *38650000
386600*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *38660000
386700*    THE TEMP QUEUE.                                             *38670000
386800*----------------------------------------------------------------*38680000
386900                                                                  38690000
387000 6100-UPDATE-TSQ.                                                 38700000
387100                                                                  38710000
387200     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             38720000
387300     PERFORM 6105-READ-SEL-QUEUE.                                 38730000
387400     PERFORM                                                      38740000
387500         VARYING AP301-IDX                                        38750000
387600         FROM 1 BY 1                                              38760000
387700         UNTIL ((PV-ITEMS-PROCESSED >                             38770000
387800                              PV-HOLD-SELECTED-ITEMS)             38780000
387900         OR (AP301-IDX GREATER THAN AP301-MAX-ITEMS))             38790000
388000         IF  AP301-ACTION-SW (AP301-IDX) > SPACE                  38800000
388100             PERFORM 6110-PROCESS-ITEMS                           38810000
388200         END-IF                                                   38820000
388300         ADD +1                TO PV-ITEMS-PROCESSED              38830000
388400     END-PERFORM.                                                 38840000
388500                                                                  38850000
388600     IF PV-SAVE-ITEM NOT EQUAL ZERO                               38860000
388700         PERFORM 6111-WRITE-LIST-QUEUE                            38870000
388800     END-IF.                                                      38880000
388900                                                                  38890000
389000*----------------------------------------------------------------*38900000
389100*    READ THE LIST QUEUE RECORD.                                 *38910000
389200*----------------------------------------------------------------*38920000
389300                                                                  38930000
389400 6105-READ-SEL-QUEUE.                                             38940000
389500                                                                  38950000
389600     EXEC CICS                                                    38960000
389700          READQ TS                                                38970000
389800              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      38980000
389900              INTO  (AP301-INVC-LIST-TS-RCRD)                     38990000
390000              ITEM  (PV-SEL-QUEUE-ITEM)                           39000000
390100              RESP  (PV-CICS-RESP)                                39010000
390200     END-EXEC.                                                    39020000
390300                                                                  39030000
390400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          39040000
390500         CONTINUE                                                 39050000
390600     ELSE                                                         39060000
390700         SET DP013-CICS-ABEND      TO  TRUE                       39070000
390800         SET DP013-NO-ROLLBACK     TO  TRUE                       39080000
390900         MOVE '6105-READ-SEL-QUEUE'                               39090000
391000                                   TO  DP013-PARAGRAPH            39100000
391100         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           39110000
391200                                   TO  DP013-MESSAGE-TEXT(1)      39120000
391300         PERFORM DP013-0000-PROCESS-ABEND                         39130000
391400     END-IF.                                                      39140000
391500 EJECT                                                            39150000
391600                                                                  39160000
391700*----------------------------------------------------------------*39170000
391800*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*39180000
391900*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*39190000
392000*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *39200000
392100*----------------------------------------------------------------*39210000
392200                                                                  39220000
392300 6110-PROCESS-ITEMS.                                              39230000
392400                                                                  39240000
392500     COMPUTE PV-ITEM = 1 + ((AP301-ITEM (AP301-IDX) - 1)          39250000
392600                     / PC-ITEMS-PER-PANEL).                       39260000
392700                                                                  39270000
392800     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           39280000
392900         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          39290000
393000             PERFORM 6111-WRITE-LIST-QUEUE                        39300000
393100         END-IF                                                   39310000
393200         MOVE PV-ITEM          TO PV-SAVE-ITEM                    39320000
393300                                                                  39330000
393400         PERFORM 6112-READ-LIST-QUEUE                             39340000
393500         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               39350000
393600             CONTINUE                                             39360000
393700         END-IF                                                   39370000
393800     END-IF.                                                      39380000
393900                                                                  39390000
394000     COMPUTE PV-SUB = (AP301-ITEM (AP301-IDX)                     39400000
394100                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              39410000
394200     SET LQW-DESELECT (PV-SUB) TO    TRUE                         39420000
394300     MOVE LQW-SELECTED-SW (PV-SUB)                                39430000
394400                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  39440000
394500                                                                  39450000
394600*    EVALUATE TRUE                                                39460000
394700*        WHEN AP301-INQ (AP301-IDX)                               39470000
394800*             MOVE PC-INQ    TO LQW-ACTION (PV-SUB)               39480000
394900                                                                  39490000
395000*        WHEN AP301-UPD (AP301-IDX)                               39500000
395100*             MOVE PC-UPD    TO LQW-ACTION (PV-SUB)               39510000
395200                                                                  39520000
395300*        WHEN AP301-DEL (AP301-IDX)                               39530000
395400*             MOVE PC-DEL    TO LQW-ACTION (PV-SUB)               39540000
395500                                                                  39550000
395600*        WHEN AP301-ERR (AP301-IDX)                               39560000
395700*             MOVE PC-ERR    TO LQW-ACTION (PV-SUB)               39570000
395800*    END-EVALUATE.                                                39580000
395900                                                                  39590000
396000     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                39600000
396100                                                                  39610000
396200*----------------------------------------------------------------*39620000
396300*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *39630000
396400*----------------------------------------------------------------*39640000
396500                                                                  39650000
396600 6111-WRITE-LIST-QUEUE.                                           39660000
396700                                                                  39670000
396800     EXEC CICS                                                    39680000
396900         WRITEQ TS                                                39690000
397000             QUEUE (ASC-LIST-QUEUE-NAME)                          39700000
397100             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     39710000
397200             ITEM  (PV-SAVE-ITEM)                                 39720000
397300             REWRITE                                              39730000
397400             RESP  (PV-CICS-RESP)                                 39740000
397500     END-EXEC.                                                    39750000
397600                                                                  39760000
397700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          39770000
397800         CONTINUE                                                 39780000
397900     ELSE                                                         39790000
398000         SET DP013-CICS-ABEND  TO  TRUE                           39800000
398100         SET DP013-NO-ROLLBACK TO  TRUE                           39810000
398200         MOVE '6111-WRITE-LIST-QUEUE'                             39820000
398300                               TO  DP013-PARAGRAPH                39830000
398400         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  39840000
398500                               TO  DP013-MESSAGE-TEXT(1)          39850000
398600         PERFORM DP013-0000-PROCESS-ABEND                         39860000
398700     END-IF.                                                      39870000
398800                                                                  39880000
398900 EJECT                                                            39890000
399000*----------------------------------------------------------------*39900000
399100*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*39910000
399200*----------------------------------------------------------------*39920000
399300                                                                  39930000
399400 6112-READ-LIST-QUEUE.                                            39940000
399500                                                                  39950000
399600     EXEC CICS                                                    39960000
399700         READQ TS                                                 39970000
399800             QUEUE (ASC-LIST-QUEUE-NAME)                          39980000
399900             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     39990000
400000             ITEM  (PV-ITEM)                                      40000000
400100             RESP  (PV-CICS-RESP)                                 40010000
400200     END-EXEC.                                                    40020000
400300                                                                  40030000
400400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          40040000
400500         CONTINUE                                                 40050000
400600     ELSE                                                         40060000
400700         SET DP013-CICS-ABEND        TO TRUE                      40070000
400800         SET DP013-NO-ROLLBACK       TO TRUE                      40080000
400900         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           40090000
401000         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    40100000
401100                                     TO DP013-MESSAGE-TEXT(1)     40110000
401200         PERFORM DP013-0000-PROCESS-ABEND                         40120000
401300     END-IF.                                                      40130000
401400                                                                  40140000
401500 EJECT                                                            40150000
401600******************************************************************40160000
401700* DELETE THE LIST QUEUE WHEN PREV-SEL OR NEXT-SEL WAS ENTERED.   *40170000
401800******************************************************************40180000
401900 6200-DEL-LIST-QUEUE.                                             40190000
402000                                                                  40200000
402100     EXEC CICS                                                    40210000
402200         DELETEQ TS                                               40220000
402300             QUEUE (ASC-LIST-QUEUE-NAME)                          40230000
402400             RESP  (PV-CICS-RESP)                                 40240000
402500     END-EXEC.                                                    40250000
402600                                                                  40260000
402700     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      40270000
402800        (PV-CICS-RESP = DFHRESP(QIDERR)))                         40280000
402900         CONTINUE                                                 40290000
403000     ELSE                                                         40300000
403100        SET DP013-CICS-ABEND       TO TRUE                        40310000
403200        SET DP013-NO-ROLLBACK      TO TRUE                        40320000
403300        MOVE '6200-DEL-LIST-QUEUE' TO DP013-PARAGRAPH             40330000
403400        MOVE 'ERROR TRYING TO DELETE LIST TS QUEUE'               40340000
403500                                   TO DP013-MESSAGE-TEXT (1)      40350000
403600        PERFORM DP013-0000-PROCESS-ABEND                          40360000
403700     END-IF.                                                      40370000
403800                                                                  40380000
403900*----------------------------------------------------------------*40390000
404000*    UPDATE THE TMIITEM TABLE                                    *40400000
404100*    PLEASE NOTE, THE ASC-SEL-PAYT-REQ-SEQ-NBR AND               *40410000
404200*    PV-PAYT-REQ-LNE-NBR WERE RETREIVED IN THE 3300-EDIT-SELEC   *40420000
404300*    -TIONS PARAGRAPH.                                           *40430000
404400*----------------------------------------------------------------*40440000
404500 7000-UPDATE-TMIITEM.                                             40450000
404600                                                                  40460000
404700     PERFORM                                                      40470000
404800         WITH TEST AFTER                                          40480000
404900         VARYING PV-RETRY-COUNTER                                 40490000
405000         FROM 1 BY 1                                              40500000
405100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               40510000
405200             OR (SQLCODE = +0))                                   40520000
405300                                                                  40530000
405400         EXEC SQL UPDATE TMIITEM                                  40540000
405500             SET UNT_COST_SEL_CDE     = :PV-UNT-COST-SEL-CDE      40550000
405600          WHERE PAYT_REQ_SEQ_NBR      = :ASC-SEL-PAYT-REQ-SEQ-NBR 40560000
405700            AND PAYT_REQ_LNE_NBR      = :ASC-SEL-PAYT-REQ-LNE-NBR 40570000
405800****        AND PO_NBR                = :ASC-KEY-PO-NBR           40580000
405900         END-EXEC                                                 40590000
406000                                                                  40600000
406100         EVALUATE TRUE                                            40610000
406200             WHEN SQLCODE = +0                                    40620000
406300             WHEN SQLCODE = -904                                  40630000
406400             WHEN SQLCODE = -913                                  40640000
406500                 CONTINUE                                         40650000
406600                                                                  40660000
406700             WHEN SQLWARN0 NOT = SPACES                           40670000
406800             WHEN SQLCODE < +0                                    40680000
406900             WHEN SQLCODE > +0                                    40690000
407000                 MOVE '7000-UPDATE-TMIITEM'                       40700000
407100                                   TO DP013-PARAGRAPH             40710000
407200                 MOVE 'UPDATE A ROW ON TMIITEM'                   40720000
407300                                   TO DP013-MESSAGE-TEXT(1)       40730000
407400                 MOVE SQLCA        TO DP013-SQLCA                 40740000
407500                 MOVE 'TMIITEM'    TO DP013-DB2-TABLE-NAME (1)    40750000
407600                 SET DP013-DB2-ABEND                              40760000
407700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           40770000
407800                 PERFORM DP013-0000-PROCESS-ABEND                 40780000
407900         END-EVALUATE                                             40790000
408000     END-PERFORM.                                                 40800000
408100                                                                  40810000
408200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        40820000
408300         MOVE '7000-UPDATE-TMIITEM' TO DP013-PARAGRAPH            40830000
408400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              40840000
408500                                   TO DP013-MESSAGE-TEXT (1)      40850000
408600         MOVE 'TO UPDATE A TMIITEM ROW'                           40860000
408700                                   TO DP013-MESSAGE-TEXT (2)      40870000
408800         MOVE SQLCA                TO DP013-SQLCA                 40880000
408900         MOVE 'TMIITEM'            TO DP013-DB2-TABLE-NAME (1)    40890000
409000         SET DP013-DB2-ABEND                                      40900000
409100             DP013-XCTL-DISPLAY-RESTART                           40910000
409200                                   TO TRUE                        40920000
409300         PERFORM DP013-0000-PROCESS-ABEND                         40930000
409400     END-IF.                                                      40940000
409500                                                                  40950000
409600**   -- DISPLAY UPDATE SUCCESSFUL MESSAGE --                      40960000
409700                                                                  40970000
409800     IF PS-NO-ERROR   AND                                         40980000
409900        PS-NO-ERROR-DB2                                           40990000
410000        MOVE PC-TSYMSG-00059         TO DP020-MSG-NUMBER          41000000
410100        SET DP030-SET-CURSOR-APPL-1  TO TRUE                      41010000
410200        SET DP020-MSG-INFORMATIONAL  TO TRUE                      41020000
410300     END-IF.                                                      41030000
410400                                                                  41040000
410500                                                                  41050000
410600*----------------------------------------------------------------*41060000
410700*    RUN THROUGH THE TEMP STORAGE QUEUE TO UPDATE ALL OF THE     *41070000
410800*    INVOICE LINES (TO POINT TO THE RECEIVER UNIT COST) THAT     *41080000
410900*    WERE SELECTED WITH THE SELECTALL (F21) FUNCTION.  THIS WILL *41090000
411000*    BE DONE BY PROCESSING WHAT IS ALREADY IN THE ASC-COMMAREA   *41100000
411100*    FIRST, THEN THE TEMP STORAGE QUEUE WILL BE PROCESSED.  IT   *41110000
411200*    WILL BE DONE BY PICKING UP WHERE WHAT WAS IN THE COMMAREA IS*41120000
411300*    TIONED IN THE TSQ.  TWO BLOCKS OF DATA FROM THE TSQ WILL BE *41130000
411400*    MOVED TO THE ASC-COMMAREA.  THE DATABASE UPDATES WILL TAKE  *41140000
411500*    FROM WHAT IS IN THE COMMAREA.  THIS LOOP WILL CONTINUE UNTIL*41150000
411600*    EVERTHING IN THE TSQ HAS BEEN PROCESSED.  NO REWITES OF THE *41160000
411700*    TSQ SHOULD BE NEEDED.                                       *41170000
411800*----------------------------------------------------------------*41180000
411900 7005-UPDATE-ALL-RCVD-UNIT-COST.                                  41190000
412000                                                                  41200000
412100     MOVE 1 TO ASC-BLK-SUB.                                       41210000
412200     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             41220000
412300     PERFORM 7006-UPDATE-TMIITEM-II                               41230000
412400             VARYING ASC-ITEM-SUB FROM 1 BY 1                     41240000
412500             UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL OR           41250000
412600             ASC-SELECTED-SW                                      41260000
412700                         (ASC-BLK-SUB ASC-ITEM-SUB)               41270000
412800                         NOT = 'S'.                               41280000
412900                                                                  41290000
413000     ADD +1 TO ASC-BLK-SUB.                                       41300000
413100     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             41310000
413200     PERFORM 7006-UPDATE-TMIITEM-II                               41320000
413300             VARYING ASC-ITEM-SUB FROM 1 BY 1                     41330000
413400             UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL OR           41340000
413500             ASC-SELECTED-SW                                      41350000
413600                      (ASC-BLK-SUB ASC-ITEM-SUB)                  41360000
413700                         NOT = 'S'.                               41370000
413800                                                                  41380000
413900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               41390000
414000                                   TO PV-LIST-ITEM-NUMBER.        41400000
414100                                                                  41410000
414200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            41420000
414300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    41430000
414400                                                                  41440000
414500     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     41450000
414600        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    41460000
414700         MOVE +1                   TO ASC-BLK-SUB                 41470000
414800                                                                  41480000
414900         PERFORM 5100-WRITE-TEMP-STORAGE                          41490000
415000                                                                  41500000
415100         MOVE +1                   TO PV-BLOCK-NUMBER             41510000
415200                                                                  41520000
415300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         41530000
415400             PV-FIRST-BLOCK-IN-ARRAY - 1                          41540000
415500                                                                  41550000
415600         PERFORM                                                  41560000
415700             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       41570000
415800                                                                  41580000
415900             PERFORM 4410-READ-TEMP-STORAGE                       41590000
416000                                                                  41600000
416100             SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE      41610000
416200             PERFORM 7006-UPDATE-TMIITEM-II                       41620000
416300                     VARYING ASC-ITEM-SUB FROM 1 BY 1             41630000
416400                     UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL OR   41640000
416500                     ASC-SELECTED-SW                              41650000
416600                                 (ASC-BLK-SUB ASC-ITEM-SUB)       41660000
416700                                 NOT = 'S'                        41670000
416800                                                                  41680000
416900             PERFORM 5100-WRITE-TEMP-STORAGE                      41690000
417000                                                                  41700000
417100             ADD +1                TO PV-BLOCK-NUMBER             41710000
417200                                                                  41720000
417300         END-PERFORM                                              41730000
417400                                                                  41740000
417500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         41750000
417600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     41760000
417700                                                                  41770000
417800         PERFORM                                                  41780000
417900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       41790000
418000                   ASC-HIGHEST-BLOCK-WRITTEN                      41800000
418100                                                                  41810000
418200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          41820000
418300                                   TO PV-BLOCK-NUMBER             41830000
418400                                                                  41840000
418500             PERFORM 4410-READ-TEMP-STORAGE                       41850000
418600                                                                  41860000
418700             SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE      41870000
418800             PERFORM 7006-UPDATE-TMIITEM-II                       41880000
418900                     VARYING ASC-ITEM-SUB FROM 1 BY 1             41890000
419000                     UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL OR   41900000
419100                     ASC-SELECTED-SW                              41910000
419200                                 (ASC-BLK-SUB ASC-ITEM-SUB)       41920000
419300                                 NOT = 'S'                        41930000
419400                                                                  41940000
419500             PERFORM 5100-WRITE-TEMP-STORAGE                      41950000
419600                                                                  41960000
419700             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      41970000
419800                                                                  41980000
419900         END-PERFORM                                              41990000
420000                                                                  42000000
420100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             42010000
420200                                   TO PV-BLOCK-NUMBER             42020000
420300                                                                  42030000
420400         PERFORM 4410-READ-TEMP-STORAGE                           42040000
420500     END-IF.                                                      42050000
420600                                                                  42060000
420700                                                                  42070000
420800*----------------------------------------------------------------*42080000
420900*    UPDATE THE TMIITEM TABLE WHEN THE SELECTALL FUNCTION WAS    *42090000
421000*    CHOSEN TO POINT TO THE RECEIVE UNIT COST ONLY.              *42100000
421100*----------------------------------------------------------------*42110000
421200 7006-UPDATE-TMIITEM-II.                                          42120000
421300                                                                  42130000
421400     MOVE ASC-PAYT-REQ-SEQ-NBR (ASC-BLK-SUB ASC-ITEM-SUB)         42140000
421500                               TO ASC-SEL-PAYT-REQ-SEQ-NBR.       42150000
421600     MOVE ASC-INVC-LNE-NBR (ASC-BLK-SUB ASC-ITEM-SUB)             42160000
421700                               TO ASC-SEL-PAYT-REQ-LNE-NBR.       42170000
421800     PERFORM                                                      42180000
421900         WITH TEST AFTER                                          42190000
422000         VARYING PV-RETRY-COUNTER                                 42200000
422100         FROM 1 BY 1                                              42210000
422200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               42220000
422300             OR (SQLCODE = +0))                                   42230000
422400                                                                  42240000
422500         EXEC SQL UPDATE TMIITEM                                  42250000
422600             SET UNT_COST_SEL_CDE     = :PV-UNT-COST-SEL-CDE      42260000
422700          WHERE PAYT_REQ_SEQ_NBR      = :ASC-SEL-PAYT-REQ-SEQ-NBR 42270000
422800            AND PAYT_REQ_LNE_NBR      = :ASC-SEL-PAYT-REQ-LNE-NBR 42280000
422900         END-EXEC                                                 42290000
423000                                                                  42300000
423100         EVALUATE TRUE                                            42310000
423200             WHEN SQLCODE = +0                                    42320000
423300             WHEN SQLCODE = -904                                  42330000
423400             WHEN SQLCODE = -913                                  42340000
423500                 CONTINUE                                         42350000
423600                                                                  42360000
423700             WHEN SQLWARN0 NOT = SPACES                           42370000
423800             WHEN SQLCODE < +0                                    42380000
423900             WHEN SQLCODE > +0                                    42390000
424000                 MOVE '7006-UPDATE-TMIITEM-II'                    42400000
424100                                   TO DP013-PARAGRAPH             42410000
424200                 MOVE 'UPDATE A ROW ON TMIITEM'                   42420000
424300                                   TO DP013-MESSAGE-TEXT(1)       42430000
424400                 MOVE SQLCA        TO DP013-SQLCA                 42440000
424500                 MOVE 'TMIITEM'    TO DP013-DB2-TABLE-NAME (1)    42450000
424600                 SET DP013-DB2-ABEND                              42460000
424700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           42470000
424800                 PERFORM DP013-0000-PROCESS-ABEND                 42480000
424900         END-EVALUATE                                             42490000
425000     END-PERFORM.                                                 42500000
425100                                                                  42510000
425200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        42520000
425300         MOVE '7006-UPDATE-TMIITEM-II' TO DP013-PARAGRAPH         42530000
425400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              42540000
425500                                   TO DP013-MESSAGE-TEXT (1)      42550000
425600         MOVE 'TO UPDATE A TMIITEM ROW'                           42560000
425700                                   TO DP013-MESSAGE-TEXT (2)      42570000
425800         MOVE SQLCA                TO DP013-SQLCA                 42580000
425900         MOVE 'TMIITEM'            TO DP013-DB2-TABLE-NAME (1)    42590000
426000         SET DP013-DB2-ABEND                                      42600000
426100             DP013-XCTL-DISPLAY-RESTART                           42610000
426200                                   TO TRUE                        42620000
426300         PERFORM DP013-0000-PROCESS-ABEND                         42630000
426400     END-IF.                                                      42640000
426500                                                                  42650000
426600                                                                  42660000
426700******************************************************************42670000
426800* READ AN ITEM FROM THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *42680000
426900******************************************************************42690000
427000 9100-READ-SEL-QUEUE.                                             42700000
427100     EXEC CICS                                                    42710000
427200         READQ TS                                                 42720000
427300             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        42730000
427400             INTO  (AP301-INVC-LIST-TS-RCRD)                      42740000
427500             ITEM  (ASC-SEL-ITEM)                                 42750000
427600             RESP  (PV-CICS-RESP)                                 42760000
427700     END-EXEC.                                                    42770000
427800                                                                  42780000
427900     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        42790000
428000         CONTINUE                                                 42800000
428100     ELSE                                                         42810000
428200         SET DP013-LOGIC-ABEND                                    42820000
428300             DP013-NO-ROLLBACK     TO TRUE                        42830000
428400         MOVE '9100-READ-SEL-QUEUE'                               42840000
428500                                   TO DP013-PARAGRAPH             42850000
428600         MOVE 'ATTEMPTING TO READ TO LIST SELECTIONS TS QUEUE'    42860000
428700                                   TO DP013-MESSAGE-TEXT (1)      42870000
428800         PERFORM DP013-0000-PROCESS-ABEND                         42880000
428900     END-IF.                                                      42890000
429000                                                                  42900000
429100/                                                                 42910000
429200******************************************************************42920000
429300* UPDATE AN ITEM IN THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *42930000
429400******************************************************************42940000
429500 9200-REWRITE-LIST-QUEUE.                                         42950000
429600     EXEC CICS                                                    42960000
429700          WRITEQ TS                                               42970000
429800              QUEUE   (ASC-SEL-QUEUE-NAME-IN)                     42980000
429900              FROM    (AP301-INVC-LIST-TS-RCRD)                   42990000
430000              ITEM    (ASC-SEL-ITEM)                              43000000
430100              RESP    (PV-CICS-RESP)                              43010000
430200              REWRITE                                             43020000
430300     END-EXEC.                                                    43030000
430400                                                                  43040000
430500     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    43050000
430600         SET DP013-CICS-ABEND                                     43060000
430700             DP013-NO-ROLLBACK     TO TRUE                        43070000
430800         MOVE '9200-REWRITE-LIST-QUEUE'                           43080000
430900                                   TO DP013-PARAGRAPH             43090000
431000         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   43100000
431100                                   TO DP013-MESSAGE-TEXT (1)      43110000
431200         PERFORM DP013-0000-PROCESS-ABEND                         43120000
431300     END-IF.                                                      43130000
431400                                                                  43140000
431500/                                                                 43150000
431600*----------------------------------------------------------------*43160000
431700*    ABEND PROCESSOR MODULE                                      *43170000
431800*----------------------------------------------------------------*43180000
431900                                                                  43190000
432000     COPY DPPD013.                                                43200000
