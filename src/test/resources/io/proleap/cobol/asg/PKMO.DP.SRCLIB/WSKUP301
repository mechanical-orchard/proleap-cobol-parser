000100 IDENTIFICATION DIVISION.                                         00010000
000200 TITLE 'WMS ASN DOWNLOAD MODULE'.                                 00020000
000300 PROGRAM-ID.    WSKUP301.                                         00030000
000400 AUTHOR.        THERESE RAMSEYER.                                 00040000
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050000
000600 DATE-WRITTEN.  FEBRUARY 2007.                                    00060000
000700**************************************************************    00070000
000800*  THIS IS THE BATCH VERSION OF WSKCS301                     *    00080000
000800*  IF CHANGES ARE MADE HERE, CHECK TO SEE IF WSKCS301 ALSO   *    00090000
000800*  NEEDS TO BE CHANGED.                                      *    00091000
001000*                                                            *    00100000
000800*  THIS IS A CALLED MODULE.                                  *    00101000
001000*                                                            *    00102000
001100*  THIS PGM AUTOMATICALLY WRITES TO THE LOG IN THE EVENT OF  *    00110000
001200*  AN ABEND, BUT A SWITCH CONTROLS THE OTHER MESSAGES THAT   *    00120000
001300*  ARE LEFT IN PLACE FOR DEBUGGING, ETC.                     *    00130000
001400*                                                            *    00140000
001500*  PURPOSE:  THIS PROGRAM IS A CALLED MODULE THAT RECEIVES   *    00150000
001600*  --------  A SHIPMENT ID AND A TRIP ID FROM THE CALLING    *    00160000
001700*  PROGRAM.  IT CREATES ALL THE ASN TRANSMISSION RECORDS     *    00170000
001800*  NEEDED TO DOWNLOAD A SHIPMENT TO WMS.                     *    00180000
001900*                                                            *    00190000
002000*  THE DATA RECORDS CONTAINED IN WST_SHPMT_XREF_HDR -AND-    *    00200000
002100*  WST_SHPMT_XREF_DTL DRIVE THE PROCESSING.                  *    00210000
002200*                                                            *    00220000
002300*  ASN DWNLD RECORDS THAT ARE CREATED AND INSERTED TO        *    00230000
002400*  WST_ASN_DWNLD, ARE TRACKED IN WST_DAT_CNTL &              *    00240000
002500*  WST_DAT_XFER USING THE LAST 6 DIGITS OF THE DB2           *    00250000
002600*  CURRENT TMST (RETRIEVED ONCE IN PGM) FOR PRC_GP_ID.       *    00260000
002700*                                                            *    00270000
002800*  THE RECORDS CREATED FOR THE ASN DOWNLOAD WILL BE          *    00280000
002900*  PLACED INTO THE WST_ASN_DWNLD DB2 TABLE AND PROCESSED     *    00290000
003000*  BY WSKUP302. THE DOWNLOAD RECORDS INCLUDE :               *    00300000
003100*  'AP' APPOINTMENTS, 'AH' ASN HEADER, 'CH' CASE HEADER &    *    00310000
003200*  'CD' CASE DETAIL.                                         *    00320000
003300*                                                            *    00330000
003400*   EACH RECORD THAT GETS INSERTED TO THE WST_ASN_DWNLD TBL  *    00340000
003500*   WILL BE ASSIGNED 3 NUMBERS IN ORDER TO MAINTAIN THEIR    *    00350000
003600*   ASSOCIATION WITH EACH OTHER, AND TO BE SORTED IN         *    00360000
003700*   A SPECIFIC ORDER TO BE PROCESSED IN WSKUP302.            *    00370000
003800*                                                            *    00380000
003900*   ROW NBR: THIS IS INCREMENTED SEQUENTIALLY DURING         *    00390000
004000*   PROCESSING - SO IF THERE ARE 30 ROWS INSERTED INTO       *    00400000
004100*   WST_ASN_DWNLD, THEN THE ROW NBRS RANGE FROM 1 THRU 30.   *    00410000
004200*                                                            *    00420000
004300*   GROUP NBR: THIS IS INTENDED TO KEEP RELATED RECORDS      *    00430000
004400*   GROUPED TOGETHER, SUCH AS CASE HDR W/ CASE DTL.          *    00440000
004500*                                                            *    00450000
004600*   DETAIL NBR: THIS IS USED TO MATCH NBR OF CASE DETAILS    *    00460000
004700*   WITH CASE HEADERS.                                       *    00470000
004800*                                                            *    00480000
004900*  SEE EXAMPLE BELOW:                                        *    00490000
005000*                                                            *    00500000
005100*  SHPMT       ROW      GROUP      DETAIL     REC TYPE       *    00510000
005200* -------     -----    -------    --------   -----------     *    00520000
005300*  12345        1         1         99999    AP APPOINTMENT  *    00530000
005400*  12345        2         2         99999    AH ASN HEADER   *    00540000
005500*  12345        3         3         99999    AD ASN DETAIL   *    00550000
005600*  12345        4         4         99999    AD ASN DETAIL   *    00560000
005700*  12345        5         5           1      CD CASE DETAIL  *    00570000
005800*  12345        6         5           1      CH CASE HEADER  *    00580000
005900*  12345        7         6           1      CD CASE DETAIL  *    00590000
006000*  12345        8         6           1      CH CASE HEADER  *    00600000
006100*  12345        9         7           2      CD CASE DETAIL  *    00610000
006200*  12345        10        7           2      CD CASE DETAIL  *    00620000
006300*  12345        11        7           2      CH CASE HEADER  *    00630000
006400*  12345        12        8           1      CD CASE DETAIL  *    00640000
006500*  12345        13        8           1      CH CASE HEADER  *    00650000
006600*  12345        14        9           3      CD CASE DETAIL  *    00660000
006700*  12345        15        9           3      CD CASE DETAIL  *    00670000
006800*  12345        16        9           3      CD CASE DETAIL  *    00680000
006900*  12345        17        9           3      CH CASE HEADER  *    00690000
007000*  -----------------------------------------------------------    00700000
007100*                                                            *    00710000
007200*  MAIN PROCESSING:                                          *    00720000
007300*  ---------------                                           *    00730000
007400*  THE HIGHEST LEVEL LOOP IS PERFORMED FROM A CURSOR, THOUGH *    00740000
007500*  THIS WILL ONLY CYCLE ONCE TO COMPLETELY PROCESS 1         *    00750000
007600*  SHIPMENT DOWNLOAD TO WMS AT A TIME.                       *    00760000
007700*  THIS PROGRAM IS PASSED A SINGLE SHIPMENT ID.              *    00770000
007800*  THE PRIMARY KEY FOR THE WST_SHPMT_XREF_HDR TBL IS         *    00780000
007900*  EXT_SHP_ID.                                               *    00790000
008000*                                                            *    00800000
008100*  PROCESS FLOWS AS FOLLOWS:                                 *    00810000
008200*  ------------------------                                  *    00820000
008300*                                                            *    00830000
008400*  1) 1100- UPDATE THE WST_SHPMT_XREF_DTL DWNLD CODE TO 'N'  *    00840000
008500*                                                            *    00850000
008600*  2) SPIN THE TRIP_ID_CSR TO LOOK FOR TROUBLE ON ANY LEVEL. *    00860000
008700*     PARA 1200- THROUGH 1500- .                             *    00870000
008800*     (RCVR, PRE-PACK OR PO-LINE). ANY DTLS IN TROUBLE WILL  *    00880000
008900*     NOT BE DOWNLOADED, AND AN ENTIRE SHIPMENT WILL NOT     *    00890000
009000*     BE DOWNLOADED IF IT CONSISTS OF ONE SINGLE RCVR THAT   *    00900000
009100*     IS ALSO IN TROUBLE.                                    *    00910000
009200*                                                            *    00920000
009300*   3) FOR SHPMT, GET SCAC, PRO NBR & OPER UNT ID  2200-     *    00930000
009400*                                                            *    00940000
009500*   4) CHECK INTEGRATION TYPE 2400-   : THIS DETERMINES      *    00950000
009600*      WHAT GETS WRITTEN TO THE ASN_DWNLD TABLE.             *    00960000
009700*      WHEN WST00010-ATTR-ELEM-TXT = 'D' , EVERYTHING IS     *    00970000
009800*      WRITTEN. WHEN WST00010-ATTR-ELEM-TXT = 'H' , ONLY     *    00980000
009900*      THE ASN HDR RECORD IS WRITTEN. WHEN 'N', THEN NOTHING *    00990000
010000*      IS WRITTEN TO THE ASN_DWNLD TBL.                      *    01000000
010100*      IMPORTANT NOTE: THE ASN_DWNLD TABLE WAS ORIGINALLY    *    01010000
010200*      A VIRTUAL TABLE, SO IT IS REFERRED TO AS THE TEMP     *    01020000
010300*      TABLE THROUGHOUT THE PROGRAM. WHEN THE ASN_DWNLD TBL  *    01030000
010400*      WAS CHANGED TO A PERMANENT DB2 TABLE, THE 'TEMP'      *    01040000
010500*      REFERENCE WAS LEFT INTACT BECAUSE IT WAS A PART OF    *    01050000
010600*      SO MANY REFERENCES, PARAGRAPH NAMES AND SWITHCHES.    *    01060000
010700*                                                            *    01070000
010800*   5) 2500-APPOINTMENTS: CREATE AN AP REC IF THE HDR        *    01080000
010900*      DWNLD_CDE IS 'N' (FIRST TIME BEING DWNLOADED) AND     *    01090000
011000*      THIS IS NOT A DUMMY SHIPMENT (WHERE DUMMY SEQ = 0)    *    01100000
011100*      2600- INSERTS THE TBL                                 *    01110000
011200*      NOTE : FROM THE "WHEN SQLCODE = 0" CONDITION IN       *    01120000
011300*      2500- COMES THE REST OF THE RECORD CREATING AS        *    01130000
011400*      FAR AS ASN DTLS, CASE CTLS AND CASE HDRS, ETC.        *    01140000
011500*                                                            *    01150000
011600*   6) 2700-CREATE-ASN-HDR                                   *    01160000
011700*                                                            *    01170000
011800*   7) 2800-CREATE-ASN-DTL-LVL                               *    01180000
011900*                                                            *    01190000
012000*   8) 3200-CASE-LVL-PROCESSING:                             *    01200000
012100*   .      3220-FETCH-CS-DTL-CSR                             *    01210000
012200*   .           WHEN SQLCODE = 0                             *    01220000
012300*   .                PERFORM 3400-PROCESS-CS-LVL-ASNS        *    01230000
012400*   .                    PERFORMS: 3600-GET-PREPACK-CASES    *    01240000
012500*   .                                 AND/OR                 *    01250000
012600*   .                              5000-GET-LN-LVL-CASES     *    01260000
012700*   .                                 AND/OR                 *    01270000
012800*   .                              5500-GET-PBS-CASES        *    01280000
012900*   .                                                        *    01290000
013000*   .                       (THE SEQUENCE OF CASE DTL        *    01300000
013100*   .                        PARAGRAPHS IS THE SAME AS       *    01310000
013200*   .                        EXECUTED FROM THE +0 RET        *    01320000
013300*   .                        CODE FROM THE MAIN FETCH        *    01330000
013400*   .                        IN 8A, 8B, 8C)                  *    01340000
013500*   .                                                        *    01350000
013600*   .                                                        *    01360000
013700*   8A) 3600-GET-PREPACK-CASES:                              *    01370000
013800*           3820-FETCH-CARTON-PK-CSR                         *    01380000
013900*                WHEN SQLCODE = 0                            *    01390000
014000*                     PERFORMS: 6650-MULTIPLE-SKU-CHECK      *    01400000
014100*                               6000-CARTON-CONTENT-DTLS     *    01410000
014200*                                   6120-FETCH-CTN-CNTNT-CSR *    01420000
014300*                                      WHEN SQLCODE = 0      *    01430000
014400*                                         PERFORM:           *    01440000
014500*                                           6200-CREATE-CS-LVL-DTL01450000
014600*                                           (CS DTL FOR ASN_DWNLD)01460000
014700*                                      WHEN SQLCODE = 100    *    01470000
014800*                                         PERFORM:           *    01480000
014900*                                           6600-CREATE-CS-LVL-HDR01490000
015000*                                           (CS HDR FOR ASN_DWNLD)01500000
015100*                                                            *    01510000
015200*                                                            *    01520000
015300*   8B) 5000-GET-LN-LVL-CASES                                *    01530000
015400*           5020-FETCH-CARTON-CSR                            *    01540000
015500*                WHEN SQLCODE = 0                            *    01550000
015600*                     PERFORMS: 6650-MULTIPLE-SKU-CHECK      *    01560000
015700*                               6000-CARTON-CONTENT-DTLS     *    01570000
015800*                                   6120-FETCH-CTN-CNTNT-CSR *    01580000
015900*                                      WHEN SQLCODE = 0      *    01590000
016000*                                         PERFORM:           *    01600000
016100*                                           6200-CREATE-CS-LVL-DTL01610000
016200*                                           (CS DTL FOR ASN_DWNLD)01620000
016300*                                      WHEN SQLCODE = 100    *    01630000
016400*                                         PERFORM:           *    01640000
016500*                                           6600-CREATE-CS-LVL-HDR01650000
016600*                                           (CS HDR FOR ASN_DWNLD)01660000
016700*                                                            *    01670000
016800*   8C) 5500-GET-PBS-CASES                                   *    01680000
016900*           5520-FETCH-PBS-CS-CSR                            *    01690000
017000*                WHEN SQLCODE = 0                            *    01700000
017100*                     PERFORMS: 6650-MULTIPLE-SKU-CHECK      *    01710000
017200*                               6000-CARTON-CONTENT-DTLS     *    01720000
017300*                                   6120-FETCH-CTN-CNTNT-CSR *    01730000
017400*                                      WHEN SQLCODE = 0      *    01740000
017500*                                         PERFORM:           *    01750000
017600*                                           6200-CREATE-CS-LVL-DTL01760000
017700*                                           (CS DTL FOR ASN_DWNLD)01770000
017800*                                      WHEN SQLCODE = 100    *    01780000
017900*                                         PERFORM:           *    01790000
018000*                                           6600-CREATE-CS-LVL-HDR01800000
018100*                                           (CS HDR FOR ASN_DWNLD)01810000
018200*                                                            *    01820000
018300*                                                            *    01830000
018400*   9) 7100-UPD-HDR-XREF-VER-NBR - INCREMENTED EVERY TIME    *    01840000
018500*      THE SHIPMENT IS DOWNLOADED.                           *    01850000
018600*                                                            *    01860000
018700*   10) 7200-ASN-DWNLD-MODULE: CALLS WSKUP302 TO PROCESS     *    01870000
018800*       THE RECORDS IN WST_ASN_DWNLD                         *    01880000
018900*                                                            *    01890000
019000*   11) UPON SUCCESSFUL RETURN FROM WSKUP302, PERFORM        *    01900000
019100*       7420-FETCH-XREF-DTL-CSR WHICH CALLS FOR EVERY        *    01910000
019200*       DTL THE 7450-CALL-PO-RCVR-TRKG-MOD TO INSERT         *    01920000
019300*       RCT_PO_RCVR_TRKG.                                    *    01930000
019400*                                                            *    01940000
019500**************************************************************    01950000
019600 DATE-COMPILED.                                                   01960000
019700 ENVIRONMENT DIVISION.                                            01970000
019800 CONFIGURATION SECTION.                                           01980000
019900 SOURCE-COMPUTER. IBM-3090.                                       01990000
020000 OBJECT-COMPUTER. IBM-3090.                                       02000000
020100                                                                  02010000
020200 DATA DIVISION.                                                   02020000
020300 WORKING-STORAGE SECTION.                                         02030000
020400 01  PV-PROGRAM-VARIABLES-1.                                      02040000
020500     05  PV-TASK-X.                                               02050000
020600         10  PV-TASK                     PIC   9(7)  VALUE ZERO.  02060000
020700 01  PV-PROGRAM-VARIABLES.                                        02070000
020800     05  PV-UNION-TYPE                PIC  X(01).                 02080000
021100     05  PV-NULL-IND                  PIC S9(4) VALUE ZERO        02110000
021200                                                COMP SYNC.        02120000
021300     05  PV-DUMMY-VARIABLE            PIC  X(01) VALUE SPACE.     02130000
022000     05  PV-RECS-IN-TRBL-COUNT        PIC S9(04) VALUE +0         02200000
022100                                                COMP SYNC.        02210000
022200     05  PV-ROW-COUNTER               PIC S9(04) VALUE +0         02220000
022300                                                COMP SYNC.        02230000
022400     05  PV-GROUP-COUNTER             PIC S9(04) VALUE +0         02240000
022500                                                COMP SYNC.        02250000
022600     05  PV-MULT-SKU-COUNTER          PIC S9(04) VALUE +0         02260000
022700                                                COMP SYNC.        02270000
022800     05  PV-CARTON-CNTNT-COUNTER      PIC S9(04) VALUE +0         02280000
022900                                                COMP SYNC.        02290000
023000     05  PV-RCVR-COUNT                PIC S9(04) VALUE +0         02300000
023100                                                COMP SYNC.        02310000
023200     05  PV-PRC-LOD-SEQ-ID            PIC  S9(9) COMP VALUE +0.   02320000
023300     05  PV-TROUBLE-COUNT             PIC  S9(09) COMP VALUE +0.  02330000
023400     05  PV-HOLD-TRIP-CSR-PREPK-ID    PIC  S9(4) COMP VALUE +0.   02340000
023500     05  PV-HOLD-TRIP-CSR-PO-NBR      PIC  S9(09) COMP VALUE +0.  02350000
023600     05  PV-HOLD-RCVR-NBR             PIC  S9(09) COMP VALUE +0.  02360000
023700     05  PV-HOLD-CS-LVL-PREPK-ID      PIC  S9(4) COMP VALUE +0.   02370000
023800     05  PV-HOLD-CS-LVL-PO-NBR        PIC  S9(09) COMP VALUE +0.  02380000
023900     05  PV-HOLD-CS-LVL-REC-SEQ-NBR   PIC  S9(09) COMP VALUE +0.  02390000
024000     05  PV-DISP-EXT-SHP-ID           PIC  X(20) VALUE SPACE.     02400000
024100     05  PV-DISP-TRIP-ID              PIC  9(09) VALUE ZERO.      02410000
024200     05  PV-DISP-ENT-ID               PIC  9(09) VALUE ZERO.      02420000
024300     05  PV-DISP-SQLCODE              PIC -9(05) VALUE ZEROES.    02430000
024400     05  PV-DISP-PO-NBR               PIC  9(09) VALUE ZEROES.    02440000
024500     05  PV-DISP-RCVR-SEQ-NBR         PIC  9(04) VALUE ZEROES.    02450000
024600     05  PV-DISP-PREPK-ID             PIC  9(04) VALUE ZEROES.    02460000
024700     05  PV-DISP-PO-LINE-NBR          PIC  9(04) VALUE ZEROES.    02470000
024800     05  PV-DISP-OPER-UNT-ID          PIC  9(04) VALUE ZEROES.    02480000
024900     05  PV-DISP-CSE-DTL-NBR          PIC  9(04) VALUE ZEROES.    02490000
025000     05  PV-DISP-REC-TYP-GP-NBR       PIC  9(09) VALUE ZEROES.    02500000
025100     05  PV-DISP-ROW-NBR              PIC  9(09) VALUE ZEROES.    02510000
025200     05  PV-DISP-VER-NBR              PIC  9(04) VALUE ZEROES.    02520000
025300     05  PV-DISP-DMY-SEQ-NBR          PIC  9(04) VALUE ZEROES.    02530000
025400     05  PV-DISP-PRC-LOD-SEQ          PIC  9(04) VALUE ZEROES.    02540000
025500     05  PV-DISP-RECS-IN-TRBL-COUNT   PIC  9(04) VALUE ZEROES.    02550000
025600     05  PV-DISP-RCVR-COUNT           PIC  9(04) VALUE ZEROES.    02560000
025700     05  PV-DISP-LAST-HOST-INPUT-ID   PIC  9(04) VALUE ZEROES.    02570000
025800     05  PV-DISP-HOST-INPUT-ID        PIC  9(04) VALUE ZEROES.    02580000
025900     05  PV-DISP-SHIPT-UNT-ID         PIC  9(18) VALUE ZEROES.    02590000
026000     05  PV-DISP-SKU                  PIC  9(09) VALUE ZEROES.    02600000
026100     05  PV-DISP-INTR-UPC-ID          PIC  9(09) VALUE ZEROES.    02610000
026200     05  PV-DISP-TRN-TYP-CDE          PIC  X(08) VALUE SPACES.    02620000
026300     05  PV-DISP-PRC-GP-ID            PIC  9(09) VALUE ZEROES.    02630000
026400     05  PV-OPER-UNT-ID-PIC9          PIC   9(04) VALUE 0.        02640000
026500     05  PV-CURRENT-TMST              PIC   X(26) VALUE SPACE.    02650000
026600     05  PV-MSG-AREA                  PIC  X(100) VALUE SPACE.    02660000
026700     05  PV-SWITCH-IND                PIC   X(01) VALUE SPACE.    02670000
026800     05  PV-PROGRAM-NAME              PIC   X(08) VALUE SPACE.    02680000
026900     05  PV-TEMP-COPYBOOK-NAME        PIC   X(08) VALUE SPACE.    02690000
027000     05  PV-LAST-HOST-INPUT-ID        PIC   S9(04) COMP VALUE +0. 02700000
027100     05  PV-HOST-INPUT-ID             PIC   S9(04) COMP VALUE +0. 02710000
027200     05  PV-ETA-REFORMATTED           PIC   X(14) VALUE SPACE.    02720000
027300     05  PV-UNIT-WT                   PIC   9(13) VALUE 0.        02730000
027400     05  PV-CARTON-WT                 PIC   9(13) VALUE 0.        02740000
027500     05  PV-TOT-UNITS-IN-CASE         PIC   9(13) VALUE 0.        02750000
027600     05  PV-DISP-NUM                  PIC   9(09) VALUE 0.        02760000
027610     05  PV-HDR-CSR-FETCH-COUNT       PIC   9(09) VALUE 0.        02761000
027620     05  PV-TRN-LNE-CDE               PIC X(09).                  02762000
027630     05  PV-TRN-LNE-CDE-PIC           REDEFINES PV-TRN-LNE-CDE.   02763000
027640         10  PV-TRN-LNE-NBR           PIC 9(09).                  02764000
027700                                                                  02765000
027800 01  DK-DATA-KEYS.                                                02766000
027900     05  DK-TRIP-ID                   PIC  S9(09) COMP VALUE +0.  02767000
028000     05  DK-EXT-SHP-ID                PIC   X(20) VALUE SPACE.    02768000
028100                                                                  02769000
028200 01  PS-PROGRAM-SWITCHES.                                         02770000
028300     05  PS-ERROR-SW                   PIC  X(01)    VALUE 'N'.   02780000
028400         88  PS-ERROR                                VALUE 'Y'.   02790000
028500         88  PS-NO-ERROR                             VALUE 'N'.   02800000
028600     05  PS-END-OF-TRIP-ID-SW          PIC  X(01)    VALUE 'N'.   02810000
028700         88  PS-END-OF-TRIP-ID-CSR-YES               VALUE 'Y'.   02820000
028800         88  PS-END-OF-TRIP-ID-CSR-NO                VALUE 'N'.   02830000
028900     05  PS-END-OF-HDR-CSR-1-SW        PIC  X(01)    VALUE 'N'.   02840000
029000         88  PS-END-OF-HDR-CSR-1-YES                 VALUE 'Y'.   02850000
029100         88  PS-END-OF-HDR-CSR-1-NO                  VALUE 'N'.   02860000
029200     05  PS-END-OF-ASN-DTL-CSR-SW      PIC  X(01)    VALUE 'N'.   02870000
029300         88  PS-END-OF-ASN-DTL-CSR-YES               VALUE 'Y'.   02880000
029400         88  PS-END-OF-ASN-DTL-CSR-NO                VALUE 'N'.   02890000
029500     05  PS-END-OF-CS-DTL-CSR-SW       PIC  X(01)    VALUE 'N'.   02900000
029600         88  PS-END-OF-CS-DTL-CSR-YES                VALUE 'Y'.   02910000
029700         88  PS-END-OF-CS-DTL-CSR-NO                 VALUE 'N'.   02920000
029800     05  PS-PACK-BY-STORE-SW           PIC  X(01)    VALUE 'N'.   02930000
029900         88  PS-PACK-BY-STORE-YES                    VALUE 'Y'.   02940000
030000         88  PS-PACK-BY-STORE-NO                     VALUE 'N'.   02950000
030100     05  PS-END-OF-CARTON-PK-CSR-SW    PIC  X(01)    VALUE 'N'.   02960000
030200         88  PS-END-OF-CARTON-PK-CSR-YES             VALUE 'Y'.   02970000
030300         88  PS-END-OF-CARTON-PK-CSR-NO              VALUE 'N'.   02980000
030400     05  PS-END-OF-CTN-CNTNT-CSR-SW    PIC  X(01)    VALUE 'N'.   02990000
030500         88  PS-END-OF-CTN-CNTNT-CSR-YES             VALUE 'Y'.   03000000
030600         88  PS-END-OF-CTN-CNTNT-CSR-NO              VALUE 'N'.   03010000
030700     05  PS-MULTIPLE-SKU-SW            PIC  X(01)    VALUE 'N'.   03020000
030800         88  PS-MULTIPLE-SKU-YES                     VALUE 'Y'.   03030000
030900         88  PS-MULTIPLE-SKU-NO                      VALUE 'N'.   03040000
031000     05  PS-END-OF-CARTON-CSR-SW       PIC  X(01)    VALUE 'N'.   03050000
031100         88  PS-END-OF-CARTON-CSR-YES                VALUE 'Y'.   03060000
031200         88  PS-END-OF-CARTON-CSR-NO                 VALUE 'N'.   03070000
031300     05  PS-END-OF-PBS-CS-CSR-SW       PIC  X(01)    VALUE 'N'.   03080000
031400         88  PS-END-OF-PBS-CS-CSR-YES                VALUE 'Y'.   03090000
031500         88  PS-END-OF-PBS-CS-CSR-NO                 VALUE 'N'.   03100000
031600     05  PS-END-OF-XREF-DTL-CSR-SW     PIC  X(01)    VALUE 'N'.   03110000
031700         88  PS-END-OF-XREF-DTL-CSR-YES              VALUE 'Y'.   03120000
031800         88  PS-END-OF-XREF-DTL-CSR-NO               VALUE 'N'.   03130000
031900     05  PS-THIS-IS-ASN-HDR-SW         PIC  X(01)    VALUE 'N'.   03140000
032000         88  PS-THIS-IS-ASN-HDR-YES                  VALUE 'Y'.   03150000
032100         88  PS-THIS-IS-ASN-HDR-NO                   VALUE 'N'.   03160000
032200     05  PS-WRITE-TO-LOG-SW            PIC  X(01)    VALUE 'N'.   03170000
032300         88  PS-WRITE-TO-LOG-YES                     VALUE 'Y'.   03180000
032400         88  PS-WRITE-TO-LOG-NO                      VALUE 'N'.   03190000
032500     05  PS-INTEGRATION-TYP-CDE-SW     PIC  X(01)    VALUE ' '.   03200000
032600         88  PS-WRITE-ALL-TO-TEMP                    VALUE 'D'.   03210000
032700         88  PS-WRITE-HDR-ONLY-TO-TEMP               VALUE 'H'.   03220000
032800         88  PS-WRITE-NOTHING-TO-TEMP                VALUE 'N'.   03230000
032900     05  PS-DAT-CNTL-REC-INSERTED-SW   PIC  X(01)    VALUE ' '.   03240000
033000         88  PS-DAT-CNTL-REC-INSERTED-YES            VALUE 'Y'.   03250000
033100         88  PS-DAT-CNTL-REC-INSERTED-NO             VALUE 'N'.   03260000
033200     05  PS-TROUBLE-SW                 PIC  X(01)    VALUE ' '.   03270000
033300         88  PS-TROUBLE-FOUND-YES                    VALUE 'Y'.   03280000
033400         88  PS-TROUBLE-FOUND-NO                     VALUE 'N'.   03290000
033500     05  PS-BYPASS-SW                  PIC  X(01)    VALUE ' '.   03300000
033600         88  PS-BYPASS-YES                           VALUE 'Y'.   03310000
033700         88  PS-BYPASS-NO                            VALUE 'N'.   03320000
033800                                                                  03330000
033900 01  PC-PROGRAM-CONSTANTS.                                        03340000
034000     05  PC-MAX-RETRIES              PIC S9(04) VALUE +3 COMP.    03350000
034100     05  PC-HIGH-NINES               PIC S9(04) VALUE +9999 COMP. 03360000
034200     05  PC-TEMP-TBL-DESC-LENGTH     PIC S9(04) COMP VALUE +300.  03370000
034300     05  PC-PROGRAM-NAME             PIC  X(08) VALUE 'WSKUP301'. 03380000
034400     05  PC-ASN-DWNLD-PGM            PIC  X(08) VALUE 'WSKUP302'. 03390000
034500     05  PC-PRC-TYP-CDE              PIC  X(08) VALUE 'ASN     '. 03400000
034600     05  PC-DEFAULT-NINES            PIC  X(26) VALUE             03410000
034700                                     '9999-09-09-09.09.09.999999'.03420000
034800     05  PC-DAT-LOAD-VER-NBR      PIC  S9(2)V9(2) COMP-3 VALUE +1.03430000
034900     05  PC-DC-FUNC-CDE-DWNLD        PIC   X(02) VALUE '0I'.      03440000
035000     05  PC-DC-FUNC-CDE-TRBL         PIC   X(02) VALUE '0J'.      03450000
035100     05  PC-APPL-FUNC-DESC          PIC  X(10) VALUE 'REPOSITORY'.03460000
035200     05  PC-INTGRTN-TYP-CDE         PIC  X(10) VALUE 'VNDRASN   '.03470000
035300     05  PC-ATTR-DEFN-SEQ-NBR        PIC S9(04) COMP VALUE +1.    03480000
035400     05  PC-STAT-CDE                 PIC  X(06) VALUE 'LOADIN'.   03490000
035500     05  PC-A                        PIC  X(01) VALUE 'A'.        03500000
035600     05  PC-Y                        PIC  X(01) VALUE 'Y'.        03510000
035700     05  PC-D                        PIC  X(01) VALUE 'D'.        03520000
035800     05  PC-H                        PIC  X(01) VALUE 'H'.        03530000
035900     05  PC-P                        PIC  X(01) VALUE 'P'.        03540000
036000     05  PC-AP                       PIC  X(02) VALUE 'AP'.       03550000
036100     05  PC-AH                       PIC  X(02) VALUE 'AH'.       03560000
036200     05  PC-AD                       PIC  X(02) VALUE 'AD'.       03570000
036300     05  PC-CD                       PIC  X(02) VALUE 'CD'.       03580000
036400     05  PC-CH                       PIC  X(02) VALUE 'CH'.       03590000
036500     05  PC-M                        PIC  X(01) VALUE 'M'.        03600000
036600     05  PC-N                        PIC  X(01) VALUE 'N'.        03610000
036700     05  PC-T                        PIC  X(01) VALUE 'T'.        03620000
036800                                                                  03630000
036900******************************************************************03640000
037000*  COMMUNICATIONS AREA FOR DB2                                    03650000
037100******************************************************************03660000
037200     EXEC SQL                                                     03670000
037300          INCLUDE SQLCA                                           03680000
037400     END-EXEC.                                                    03690000
037500                                                                  03700000
037600******************************************************************03710000
037700*  DB2 TABLE DECLARATION - IT-WEB ITEM ATTRIBUTES                 03720000
037800*      (TWEBITM)                                                  03730000
037900******************************************************************03740000
038000     EXEC SQL                                                     03750000
038100          INCLUDE TWEBITM                                         03760000
038200     END-EXEC.                                                    03770000
038300                                                                  03780000
038400******************************************************************03790000
038500*  DB2 TABLE DECLARATION - PO-PREPACK                             03800000
038600*      (TPOPRPK)                                                  03810000
038700******************************************************************03820000
038800     EXEC SQL                                                     03830000
038900          INCLUDE TPOPRPK                                         03840000
039000     END-EXEC.                                                    03850000
039100                                                                  03860000
039200******************************************************************03870000
039300*  DB2 TABLE DECLARATION - RC-RECEIVER                            03880000
039400*      (TRECEIV)                                                  03890000
039500******************************************************************03900000
039600     EXEC SQL                                                     03910000
039700          INCLUDE TRECEIV                                         03920000
039800     END-EXEC.                                                    03930000
039900                                                                  03940000
040000******************************************************************03950000
040100*  DB2 TABLE DECLARATION - SU-SHIPMENT UNIT LOCATION              03960000
040200*      (TSHUNLO)                                                  03970000
040300******************************************************************03980000
040400     EXEC SQL                                                     03990000
040500          INCLUDE TSHUNLO                                         04000000
040600     END-EXEC.                                                    04010000
040700                                                                  04020000
040800******************************************************************04030000
040900*  DB2 TABLE DECLARATION - SU-SHIPMENT UNIT/UPC ASSOCIATION       04040000
041000*      (TSHUUPC)                                                  04050000
041100******************************************************************04060000
041200     EXEC SQL                                                     04070000
041300          INCLUDE TSHUUPC                                         04080000
041400     END-EXEC.                                                    04090000
041500                                                                  04100000
041600******************************************************************04110000
041700*  DB2 TABLE DECLARATION - SU-SHIPMENT UNIT                       04120000
041800*      (TSHPUNT)                                                  04130000
041900******************************************************************04140000
042000     EXEC SQL                                                     04150000
042100          INCLUDE TSHPUNT                                         04160000
042200     END-EXEC.                                                    04170000
042300                                                                  04180000
042400******************************************************************04190000
042500*  DB2 TABLE DECLARATION - SU-INBOUND EDI PACKLIST/VENDOR SHIPMENT04200000
042600*                                                 UNIT ASSOCIATION04210000
042700*      (TINPKSU)                                                  04220000
042800******************************************************************04230000
042900     EXEC SQL                                                     04240000
043000          INCLUDE TINPKSU                                         04250000
043100     END-EXEC.                                                    04260000
043200                                                                  04270000
043300******************************************************************04280000
043400*  DB2 TABLE DECLARATION - RC-PACK SLIP                           04290000
043500*      (TPKSLIP)                                                  04300000
043600******************************************************************04310000
043700     EXEC SQL                                                     04320000
043800          INCLUDE TPKSLIP                                         04330000
043900     END-EXEC.                                                    04340000
044000                                                                  04350000
044100******************************************************************04360000
044200*  DB2 TABLE DECLARATION - TR-SHIPMENT - PO ASSOCIATION           04370000
044300*      (TSHPTPO)                                                  04380000
044400******************************************************************04390000
044500     EXEC SQL                                                     04400000
044600          INCLUDE TSHPTPO                                         04410000
044700     END-EXEC.                                                    04420000
044800                                                                  04430000
044900******************************************************************04440000
045000*  DB2 TABLE DECLARATION - RECEIPT ITEM                           04450000
045100*      (TRECITM)                                                  04460000
045200******************************************************************04470000
045300     EXEC SQL                                                     04480000
045400          INCLUDE TRECITM                                         04490000
045500     END-EXEC.                                                    04500000
045600                                                                  04510000
045700******************************************************************04520000
045800*  DB2 TABLE DECLARATION - PO PURCHASE ORDER                      04530000
045900*      (TPURCHS)                                                  04540000
046000******************************************************************04550000
046100     EXEC SQL                                                     04560000
046200          INCLUDE TPURCHS                                         04570000
046300     END-EXEC.                                                    04580000
046400                                                                  04590000
046500******************************************************************04600000
046600*  DB2 TABLE DECLARATION - LOGISTICS - SKU.                       04610000
046700*      (XLT_SKU)                                                  04620000
046800******************************************************************04630000
046900     EXEC SQL                                                     04640000
047000          INCLUDE XLT00003                                        04650000
047100     END-EXEC.                                                    04660000
047200                                                                  04670000
047300******************************************************************04680000
047400*  DB2 TABLE DECLARATION - LOGISTICS - UPC.                       04690000
047500*      (XLT_UPC)                                                  04700000
047600******************************************************************04710000
047700     EXEC SQL                                                     04720000
047800          INCLUDE XLT00006                                        04730000
047900     END-EXEC.                                                    04740000
048000                                                                  04750000
048100******************************************************************04760000
048200*  DB2 TABLE DECLARATION - PURCHASE ITEM TABLE                    04770000
048300*      (TPURITM)                                                  04780000
048400******************************************************************04790000
048500     EXEC SQL                                                     04800000
048600          INCLUDE TPURITM                                         04810000
048700     END-EXEC.                                                    04820000
048800                                                                  04830000
048900******************************************************************04840000
049000*  DB2 TABLE DECLARATION - TROUBLE NOTIFICATION                   04850000
049100*      (TTRBNTF)                                                  04860000
049200******************************************************************04870000
049300     EXEC SQL                                                     04880000
049400          INCLUDE TTRBNTF                                         04890000
049500     END-EXEC.                                                    04900000
049600                                                                  04910000
049700******************************************************************04920000
049800*  DB2 TABLE DECLARATION - TROUBLE REASON                         04930000
049900*      (TTRBRSN)                                                  04940000
050000******************************************************************04950000
050100     EXEC SQL                                                     04960000
050200          INCLUDE TTRBRSN                                         04970000
050300     END-EXEC.                                                    04980000
050400                                                                  04990000
050500******************************************************************05000000
050600*  DB2 TABLE DECLARATION - TROUBLE REPORTING CONTROL TABLE        05010000
050700*      (TTRBRCN)                                                  05020000
050800******************************************************************05030000
050900     EXEC SQL                                                     05040000
051000          INCLUDE TTRBRCN                                         05050000
051100     END-EXEC.                                                    05060000
051200                                                                  05070000
051300******************************************************************05080000
051400*  DB2 TABLE DECLARATION - VEHICLE TRIP                           05090000
051500*      (TVHTRIP)                                                  05100000
051600******************************************************************05110000
051700     EXEC SQL                                                     05120000
051800          INCLUDE TVHTRIP                                         05130000
051900     END-EXEC.                                                    05140000
052000                                                                  05150000
052100******************************************************************05160000
052200*  DB2 TABLE DECLARATION - SHIPMENT                               05170000
052300*      (TSHIPMT)                                                  05180000
052400******************************************************************05190000
052500     EXEC SQL                                                     05200000
052600          INCLUDE TSHIPMT                                         05210000
052700     END-EXEC.                                                    05220000
052800                                                                  05230000
052900******************************************************************05240000
053000*  DB2 TABLE DECLARATION - TRIP STATUS                            05250000
053100*      (TTRIPST)                                                  05260000
053200******************************************************************05270000
053300     EXEC SQL                                                     05280000
053400          INCLUDE TTRIPST                                         05290000
053500     END-EXEC.                                                    05300000
053600                                                                  05310000
053700******************************************************************05320000
053800*  DB2 TABLE DECLARATION - HEADER SHIPMENT CROSS REFERENCE        05330000
053900*      (WST_SHPMT_XREF_HDR)                                       05340000
054000******************************************************************05350000
054100     EXEC SQL                                                     05360000
054200          INCLUDE WST00001                                        05370000
054300     END-EXEC.                                                    05380000
054400                                                                  05390000
054500******************************************************************05400000
054600*  DB2 TABLE DECLARATION - DETAIL SHIPMENT CROSS REFERENCE        05410000
054700*      (WST_SHPMT_XREF_DTL)                                       05420000
054800******************************************************************05430000
054900     EXEC SQL                                                     05440000
055000          INCLUDE WST00002                                        05450000
055100     END-EXEC.                                                    05460000
055200                                                                  05470000
055300******************************************************************05480000
055400*  DB2 TABLE DECLARATION - WMS DOWNLOAD DATA CONTROL              05490000
055500*      (WST_DAT_CNTL)                                             05500000
055600******************************************************************05510000
055700     EXEC SQL                                                     05520000
055800          INCLUDE WST00003                                        05530000
055900     END-EXEC.                                                    05540000
056000                                                                  05550000
056100******************************************************************05560000
056200*  DB2 TABLE DECLARATION - WMS DOWNLOAD DATA TRANSFER             05570000
056300*      (WST_DAT_XFER)                                             05580000
056400******************************************************************05590000
056500     EXEC SQL                                                     05600000
056600          INCLUDE WST00004                                        05610000
056700     END-EXEC.                                                    05620000
056800                                                                  05630000
057700******************************************************************05640000
057800*  DB2 TABLE DECLARATION - TABLE FOR ASN DOWNLOADS                05650000
057900*      (WST_ASN_DWNLD)                                            05660000
058000******************************************************************05670000
058100     EXEC SQL                                                     05680000
058200          INCLUDE WST00011                                        05690000
058300     END-EXEC.                                                    05700000
058400                                                                  05710000
058500******************************************************************05720000
058600*  DB2 TABLE DECLARATION - WMS INTEGRATION TYPE                   05730000
058700*      (WST_INTGRTN_TYP)                                          05740000
058800******************************************************************05750000
058900     EXEC SQL                                                     05760000
059000          INCLUDE WST00008                                        05770000
059100     END-EXEC.                                                    05780000
059200                                                                  05790000
059300******************************************************************05800000
059400*  DB2 TABLE DECLARATION - WMS ATTRIBUTE DEFINITION               05810000
059500*      (WST_ATTR_DEFN)                                            05820000
059600******************************************************************05830000
059700     EXEC SQL                                                     05840000
059800          INCLUDE WST00009                                        05850000
059900     END-EXEC.                                                    05860000
060000                                                                  05870000
060100******************************************************************05880000
060200*  DB2 TABLE DECLARATION - WMS ATTRIBUTE ELEMENT                  05890000
060300*      (WST_ATTR_ELEM)                                            05900000
060400******************************************************************05910000
060500     EXEC SQL                                                     05920000
060600          INCLUDE WST00010                                        05930000
060700     END-EXEC.                                                    05940000
060800                                                                  05950000
060900******************************************************************05960000
061000*  DB2 FORMATTED MESSAGE AREA                                     05970000
061100******************************************************************05980000
061200     COPY DPWS004.                                                05990000
061300                                                                  06000000
062400******************************************************************06110000
062500*  ASN HEADER - TRAILER INTO WMOS                                 06120000
062600******************************************************************06130000
062700     COPY WSRD004.                                                06140000
062800                                                                  06150000
062900******************************************************************06160000
063000*  ASN DETAIL - TRAILER INTO WMOS                                 06170000
063100******************************************************************06180000
063200     COPY WSRD005.                                                06190000
063300                                                                  06200000
063400******************************************************************06210000
063500*  CASE HEADER - INTO WMOS                                        06220000
063600******************************************************************06230000
063700     COPY WSRD006.                                                06240000
063800                                                                  06250000
063900******************************************************************06260000
064000*  CASE DETAIL - INTO WMOS                                        06270000
064100******************************************************************06280000
064200     COPY WSRD007.                                                06290000
064300                                                                  06300000
064400******************************************************************06310000
064500*  APPOINTMENT - TRAILER INTO WMOS                                06320000
064600******************************************************************06330000
064700     COPY WSRD008.                                                06340000
064800                                                                  06350000
064900******************************************************************06360000
065000*  USED TO CALL THE ASN TRANSMISSION MODULE                       06370000
065100******************************************************************06380000
065200     COPY WSWS006.                                                06390000
065300                                                                  06400000
065400******************************************************************06410000
065500*  USED TO CALL THE PO-RCVR-TRKG  MODULE                          06420000
065600******************************************************************06430000
065700     COPY RCWS071.                                                06440000
065800                                                                  06450000
065900*-----------------------------------------------------------------06460000
066000*  ASN DOWNLOAD CONTROL TABLE MAINTENANCE                         06470000
066100*-----------------------------------------------------------------06480000
066200     COPY WSWS001.                                                06490000
066300                                                                  06500000
066400**DECLARE THE TRIP_ID_CSR                                         06510000
066500     EXEC SQL                                                     06520000
066600          DECLARE TRIP_ID_CSR CURSOR FOR                          06530000
066700           SELECT  PO_NBR                                         06540000
066800                  ,PO_LNE_NBR                                     06550000
066900                  ,RCVR_SEQ_NBR                                   06560000
067000                  ,ASN_LVL_CDE                                    06570000
067100                  ,PREPK_ID                                       06580000
067200           FROM    WST_SHPMT_XREF_HDR H                           06590000
067300                  ,WST_SHPMT_XREF_DTL D                           06600000
067400           WHERE   H.EXT_SHP_ID    =  D.EXT_SHP_ID                06610000
067500           AND     H.EXT_SHP_ID    = :DK-EXT-SHP-ID               06620000
067600           AND     H.INTR_TRIP_ID  = :DK-TRIP-ID                  06630000
067700           AND     H.RCPT_TMST     = :PC-DEFAULT-NINES            06640000
067800           AND     D.ACTV_CDE      = 'A'                          06650000
067900           ORDER BY D.PO_NBR                                      06660000
068000                  , D.RCVR_SEQ_NBR                                06670000
068100                  , D.PREPK_ID                                    06680000
068200                  , D.PO_LNE_NBR                                  06690000
068300     END-EXEC.                                                    06700000
068400                                                                  06710000
068500**DECLARE THE HDR_CSR_1                                           06720000
068600     EXEC SQL                                                     06730000
068700          DECLARE HDR_CSR_1 CURSOR FOR                            06740000
068800           SELECT  SOR_CDE                                        06750000
068900                  ,DMY_SEQ_NBR                                    06760000
069000                  ,DEST_LOC_NBR                                   06770000
069100                  ,DWNLD_CDE                                      06780000
069200                  ,RCPT_TMST                                      06790000
069300                  ,CRE_USR_ID                                     06800000
069400                  ,CRE_TMST                                       06810000
069500                  ,DWNLD_TMST                                     06820000
069600                  ,LAST_PRCG_TMST                                 06830000
069700                  ,PRC_CDE                                        06840000
069800                  ,VER_NBR                                        06850000
069900           FROM    WST_SHPMT_XREF_HDR H                           06860000
070000           WHERE   H.EXT_SHP_ID   = :DK-EXT-SHP-ID                06870000
070100           AND     H.INTR_TRIP_ID = :DK-TRIP-ID                   06880000
070200           AND     H.RCPT_TMST    = :PC-DEFAULT-NINES             06890000
070300           AND     H.DWNLD_CDE       IN ('N','P','C')             06900000
070400     END-EXEC.                                                    06910000
070500                                                                  06920000
070600**DECLARE THE ASN_DTL_CSR                                         06930000
070700     EXEC SQL                                                     06940000
070800          DECLARE ASN_DTL_CSR CURSOR FOR                          06950000
070900           SELECT  B.PO_NBR                                       06960000
071000                  ,B.PO_LNE_NBR                                   06970000
071100                  ,RCVR_SEQ_NBR                                   06980000
071200                  ,ASN_LVL_CDE                                    06990000
071300                  ,PREPK_ID                                       07000000
071400                  ,CRE_USR_ID                                     07010000
071500                  ,B.CRE_TMST                                     07020000
071600                  ,DWNLD_CDE                                      07030000
071700                  ,ACTV_CDE                                       07040000
071800                  ,SKU_NBR                                        07050000
071900           FROM    WST_SHPMT_XREF_DTL B                           07060000
072000                  ,TPURITM C                                      07070000
072100                  ,XLT_SKU D                                      07080000
072200           WHERE B.EXT_SHP_ID      = :DK-EXT-SHP-ID               07090000
072300              AND B.ASN_LVL_CDE    = 'S'                          07100000
072400              AND B.DWNLD_CDE NOT IN ('T')                        07110000
072500              AND B.ACTV_CDE       = 'A'                          07120000
072600              AND B.PO_NBR         = C.PO_NBR                     07130000
072700              AND B.PO_LNE_NBR     = C.PO_LNE_NBR                 07140000
072800              AND C.VER_STATUS_CDE = 'A'                          07150000
072900              AND C.ITM_NBR        = D.ITM_NBR                    07160000
073000     END-EXEC.                                                    07170000
073100                                                                  07180000
073200**DECLARE THE CS_DTL_CSR                                          07190000
073300     EXEC SQL                                                     07200000
073400          DECLARE CS_DTL_CSR CURSOR FOR                           07210000
073500           SELECT  PO_NBR                                         07220000
073600                  ,PO_LNE_NBR                                     07230000
073700                  ,RCVR_SEQ_NBR                                   07240000
073800                  ,ASN_LVL_CDE                                    07250000
073900                  ,PREPK_ID                                       07260000
074000                  ,CRE_USR_ID                                     07270000
074100                  ,CRE_TMST                                       07280000
074200                  ,DWNLD_CDE                                      07290000
074300                  ,ACTV_CDE                                       07300000
074400           FROM    WST_SHPMT_XREF_DTL B                           07310000
074500           WHERE B.EXT_SHP_ID      = :DK-EXT-SHP-ID               07320000
074600              AND B.ASN_LVL_CDE    = 'C'                          07330000
074700              AND B.DWNLD_CDE NOT IN ('T')                        07340000
074800              AND B.ACTV_CDE       = 'A'                          07350000
074900           ORDER BY B.PO_NBR                                      07360000
075000                  , B.RCVR_SEQ_NBR                                07370000
075100                  , B.PREPK_ID                                    07380000
075200                  , B.PO_LNE_NBR                                  07390000
075300     END-EXEC.                                                    07400000
075400                                                                  07410000
075500**DECLARE THE CARTON_PK_CSR                                       07420000
075600     EXEC SQL                                                     07430000
075700          DECLARE CARTON_PK_CSR CURSOR FOR                        07440000
075800          SELECT 'A'                                              07450000
075900                , H.SHIPT_UNT_ID                                  07460000
076000             FROM TSHIPMT A                                       07470000
076100                , TSHPTPO B                                       07480000
076200                , TPKSLIP C                                       07490000
076300                , TINPKSU D                                       07500000
076400                , TSHUNLO E                                       07510000
076500                , TVHTRIP F                                       07520000
076600                , TSHPUNT H                                       07530000
076700                , TSHUUPC I                                       07540000
076800                , TRECITM J                                       07550000
076900            WHERE A.SHIPT_ID      = B.SHIPT_ID                    07560000
077000              AND A.TRIP_ID       = F.TRIP_ID                     07570000
077100              AND B.PO_NBR        = :WST00002-PO-NBR              07580000
077200              AND B.REC_SEQ_NBR   = :WST00002-RCVR-SEQ-NBR        07590000
077300              AND B.PO_NBR        = C.PO_NBR                      07600000
077400              AND B.REC_SEQ_NBR   = C.REC_SEQ_NBR                 07610000
077500              AND C.VER_STAT_CDE  = 'A'                           07620000
077600              AND B.PO_NBR        = D.PO_NBR                      07630000
077700              AND D.SEQ_NBR       = C.SEQ_NBR                     07640000
077800              AND E.SHIPT_UNT_ID  = D.SHIPT_UNT_ID                07650000
077900              AND E.SHIPT_UNT_ID  = H.SHIPT_UNT_ID                07660000
078000              AND E.SCN_LOC_ID    = 'RECV'                        07670000
078100              AND E.ACTV_CDE      = 'A'                           07680000
078200              AND H.SHIPT_UNT_ID  = I.SHIPT_UNT_ID                07690000
078300              AND I.TRN_LNE_NBR   = J.ORD_LNE_NBR                 07700000
078400              AND J.PREPK_ID      = :WST00002-PREPK-ID            07710000
078500              AND B.PO_NBR        = J.ORD_NBR                     07720000
078600              AND B.REC_SEQ_NBR   = J.REC_SEQ_NBR                 07730000
078700              AND H.ACTV_IND      = 'A'                           07740000
078800            UNION                                                 07750000
078900           SELECT 'B'                                             07760000
079000                , G.SHIPT_UNT_ID                                  07770000
079100             FROM TSHIPMT A                                       07780000
079200                , TSHPTPO B                                       07790000
079300                , TPKSLIP C                                       07800000
079400                , TINPKSU D                                       07810000
079500                , TVHTRIP F                                       07820000
079600                , TSHPUNT G                                       07830000
079700                , TSHUUPC H                                       07840000
079800                , TRECITM J                                       07850000
079900           WHERE A.SHIPT_ID     = B.SHIPT_ID                      07860000
080000             AND A.TRIP_ID      = F.TRIP_ID                       07870000
080100             AND B.PO_NBR       = :WST00002-PO-NBR                07880000
080200             AND B.REC_SEQ_NBR  = :WST00002-RCVR-SEQ-NBR          07890000
080300             AND B.PO_NBR       = C.PO_NBR                        07900000
080400             AND B.REC_SEQ_NBR  = C.REC_SEQ_NBR                   07910000
080500             AND C.VER_STAT_CDE = 'A'                             07920000
080600             AND B.PO_NBR       = D.PO_NBR                        07930000
080700             AND D.SEQ_NBR      = C.SEQ_NBR                       07940000
080800             AND D.SHIPT_UNT_ID = G.SHIPT_UNT_ID                  07950000
080900             AND G.SHIPT_UNT_ID = H.SHIPT_UNT_ID                  07960000
081000             AND H.TRN_LNE_NBR  = J.ORD_LNE_NBR                   07970000
081100             AND J.PREPK_ID     = :WST00002-PREPK-ID              07980000
081200             AND B.PO_NBR       = J.ORD_NBR                       07990000
081300             AND B.REC_SEQ_NBR  = J.REC_SEQ_NBR                   08000000
081400             AND G.ACTV_IND     = 'A'                             08010000
081500             AND NOT EXISTS                                       08020000
081600               (SELECT G.SHIPT_UNT_ID                             08030000
081700                FROM TSHUNLO G                                    08040000
081800                WHERE G.SHIPT_UNT_ID = D.SHIPT_UNT_ID             08050000
081900                  AND G.ACTV_CDE     = 'A'                        08060000
082000                  AND G.SCN_LOC_ID   = 'RECV')                    08070000
082100     END-EXEC.                                                    08080000
082200                                                                  08090000
082300**DECLARE THE CARTON_CNTNT_CSR                                    08100000
082400     EXEC SQL                                                     08110000
082500          DECLARE CARTON_CNTNT_CSR CURSOR FOR                     08120000
082600          SELECT    C.SKU_NBR                                     08130000
082700                   ,A.SHPD_QTY                                    08140000
082800                   ,C.INTR_UPC_ID                                 08150000
082810                   ,A.TRN_LNE_NBR                                 08160000
082900           FROM     TSHUUPC A                                     08170000
083000                   ,XLT_UPC B                                     08180000
083100                   ,XLT_SKU C                                     08190000
083200           WHERE    A.SHIPT_UNT_ID = :SHPUNT-SHIPT-UNT-ID         08200000
083300             AND    A.SHPD_QTY     > 0                            08210000
083400             AND    A.UPC_NBR      = B.UPC_NBR                    08220000
083500             AND    B.INTR_UPC_ID  = C.INTR_UPC_ID                08230000
083600     END-EXEC.                                                    08240000
083700                                                                  08250000
083800**DECLARE THE CARTON_CSR                                          08260000
083900     EXEC SQL                                                     08270000
084000          DECLARE CARTON_CSR CURSOR FOR                           08280000
084100          SELECT 'A'                                              08290000
084200                , H.SHIPT_UNT_ID                                  08300000
084300             FROM TSHIPMT A                                       08310000
084400                , TSHPTPO B                                       08320000
084500                , TPKSLIP C                                       08330000
084600                , TINPKSU D                                       08340000
084700                , TSHUNLO E                                       08350000
084800                , TVHTRIP F                                       08360000
084900                , TSHPUNT H                                       08370000
085000                , TSHUUPC I                                       08380000
085100            WHERE A.SHIPT_ID      = B.SHIPT_ID                    08390000
085200              AND A.TRIP_ID       = F.TRIP_ID                     08400000
085300              AND B.PO_NBR        = :WST00002-PO-NBR              08410000
085400              AND B.REC_SEQ_NBR   = :WST00002-RCVR-SEQ-NBR        08420000
085500              AND B.PO_NBR        = C.PO_NBR                      08430000
085600              AND B.REC_SEQ_NBR   = C.REC_SEQ_NBR                 08440000
085700              AND C.VER_STAT_CDE  = 'A'                           08450000
085800              AND B.PO_NBR        = D.PO_NBR                      08460000
085900              AND D.SEQ_NBR       = C.SEQ_NBR                     08470000
086000              AND E.SHIPT_UNT_ID  = D.SHIPT_UNT_ID                08480000
086100              AND E.SHIPT_UNT_ID  = H.SHIPT_UNT_ID                08490000
086200              AND E.SCN_LOC_ID    = 'RECV'                        08500000
086300              AND E.ACTV_CDE      = 'A'                           08510000
086400              AND H.SHIPT_UNT_ID  = I.SHIPT_UNT_ID                08520000
086500              AND I.TRN_LNE_NBR   = :WST00002-PO-LNE-NBR          08530000
086600              AND H.ACTV_IND      = 'A'                           08540000
086700            UNION                                                 08550000
086800           SELECT 'B'                                             08560000
086900                , G.SHIPT_UNT_ID                                  08570000
087000             FROM TSHIPMT A                                       08580000
087100                , TSHPTPO B                                       08590000
087200                , TPKSLIP C                                       08600000
087300                , TINPKSU D                                       08610000
087400                , TVHTRIP F                                       08620000
087500                , TSHPUNT G                                       08630000
087600                , TSHUUPC H                                       08640000
087700           WHERE A.SHIPT_ID     = B.SHIPT_ID                      08650000
087800             AND A.TRIP_ID      = F.TRIP_ID                       08660000
087900             AND B.PO_NBR       = :WST00002-PO-NBR                08670000
088000             AND B.REC_SEQ_NBR  = :WST00002-RCVR-SEQ-NBR          08680000
088100             AND B.PO_NBR       = C.PO_NBR                        08690000
088200             AND B.REC_SEQ_NBR  = C.REC_SEQ_NBR                   08700000
088300             AND C.VER_STAT_CDE = 'A'                             08710000
088400             AND B.PO_NBR       = D.PO_NBR                        08720000
088500             AND D.SEQ_NBR      = C.SEQ_NBR                       08730000
088600             AND D.SHIPT_UNT_ID = G.SHIPT_UNT_ID                  08740000
088700             AND G.SHIPT_UNT_ID = H.SHIPT_UNT_ID                  08750000
088800             AND H.TRN_LNE_NBR  = :WST00002-PO-LNE-NBR            08760000
088900             AND G.ACTV_IND      = 'A'                            08770000
089000             AND NOT EXISTS                                       08780000
089100               (SELECT G.SHIPT_UNT_ID                             08790000
089200                FROM TSHUNLO G                                    08800000
089300                WHERE G.SHIPT_UNT_ID = D.SHIPT_UNT_ID             08810000
089400                  AND G.ACTV_CDE      = 'A'                       08820000
089500                  AND G.SCN_LOC_ID   = 'RECV')                    08830000
089600     END-EXEC.                                                    08840000
089700                                                                  08850000
089800**DECLARE THE PSB_CS_CSR                                          08860000
089900     EXEC SQL                                                     08870000
090000          DECLARE PBS_CS_CSR CURSOR FOR                           08880000
090100     SELECT                                                       08890000
090200            C.SHIPT_UNT_ID                                        08900000
090300       FROM TPKSLIP A                                             08910000
090400          , TINPKSU B                                             08920000
090500          , TSHPUNT C                                             08930000
090600          , TSHUUPC D                                             08940000
090700      WHERE A.PO_NBR       = :WST00002-PO-NBR                     08950000
090800        AND A.REC_SEQ_NBR  = :WST00002-RCVR-SEQ-NBR               08960000
090900        AND A.VER_STAT_CDE = 'A'                                  08970000
091000        AND A.PO_NBR       = B.PO_NBR                             08980000
091100        AND A.SEQ_NBR      = B.SEQ_NBR                            08990000
091200        AND B.SHIPT_UNT_ID = C.SHIPT_UNT_ID                       09000000
091300        AND B.SHIPT_UNT_ID = D.SHIPT_UNT_ID                       09010000
091400  GROUP BY A.REC_SEQ_NBR                                          09020000
091500        ,C.SHIPT_UNT_ID                                           09030000
091600        ,C.ACTV_IND                                               09040000
091700        ,C.DEST_OPER_UNT_ID                                       09050000
091800        ,A.CRE_TMST                                               09060000
091900        ,C.CRE_DTE                                                09070000
092000        ,C.CRE_TM                                                 09080000
092100     END-EXEC.                                                    09090000
092200                                                                  09100000
092300**DECLARE THE XREF_DTL_CSR                                        09110000
092400     EXEC SQL                                                     09120000
092500          DECLARE XREF_DTL_CSR CURSOR FOR                         09130000
092600           SELECT  PO_NBR                                         09140000
092700                  ,PO_LNE_NBR                                     09150000
092800                  ,RCVR_SEQ_NBR                                   09160000
092900                  ,ASN_LVL_CDE                                    09170000
093000                  ,PREPK_ID                                       09180000
093100                  ,CRE_USR_ID                                     09190000
093200                  ,CRE_TMST                                       09200000
093300                  ,DWNLD_CDE                                      09210000
093400                  ,ACTV_CDE                                       09220000
093500           FROM    WST_SHPMT_XREF_DTL B                           09230000
093600           WHERE B.EXT_SHP_ID      = :DK-EXT-SHP-ID               09240000
093700           AND   B.ACTV_CDE = 'A'                                 09250000
093800           ORDER BY B.PO_NBR                                      09260000
093900                  , B.RCVR_SEQ_NBR                                09270000
094000                  , B.PREPK_ID                                    09280000
094100                  , B.PO_LNE_NBR                                  09290000
094200     END-EXEC.                                                    09300000
094300                                                                  09310000
094400******************************************************************09320000
094500 LINKAGE SECTION.                                                 09330000
094600                                                                  09340000
061900******************************************************************09341000
062000*  COMMAREA                                                       09342000
062100******************************************************************09343000
062200     COPY WSWS003.                                                09344000
062300                                                                  09345000
095300******************************************************************09410000
095400 PROCEDURE DIVISION USING WS003-SHIPT-COMMAREA.                   09420000
095500******************************************************************09430000
095600******************************************************************09440000
095700*  0000-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM.  *09450000
095800******************************************************************09460000
095900 0000-PROGRAM-MAINLINE.                                           09470000
096000                                                                  09480000
097200     MOVE WS003-WM-SHIPT-NBR TO DK-EXT-SHP-ID.                    09600001
097300     MOVE WS003-TRIP-ID      TO DK-TRIP-ID.                       09610001
097400     PERFORM 1000-INITIALIZE.                                     09620001
097500                                                                  09630000
097500* JAK 06/2007 - ADD LOGIC FOR A CANCELED SHIPMENT                 09631002
097100     IF  WS003-CANCEL-SHPMT-YES                                   09632002
097200        PERFORM 1080-PROCESS-CANCEL                               09632104
097100     ELSE                                                         09634002
097200        PERFORM 1070-PROCESS-UPDATE                               09635002
097100     END-IF.                                                      09636002
110800                                                                  10998000
110900     STRING ' WSKUP301 ENDED  - TASK = ' WS003-SRC-TASK-NUMBER    10999000
111000         DELIMITED BY SIZE INTO PV-MSG-AREA.                      11000001
111100     PERFORM 9200-WRITE-TO-LOG.                                   11010001
111200                                                                  11020000
111300     GOBACK.                                                      11030000
111400                                                                  11040000
111500******************************************************************11050000
111600* INIT DCLGENS, GET TMST ONLY ONCE FOR PRC-GP-ID FOR DAT_CNTL/XFER11060000
111700******************************************************************11070000
111800 1000-INITIALIZE.                                                 11080000
111900                                                                  11090000
112000     INITIALIZE DCLTVHTRIP                                        11100000
112100                DCLTSHIPMT                                        11110000
112200                DCLTTRIPST.                                       11120000
112300                                                                  11130000
112400     INITIALIZE PV-PROGRAM-VARIABLES.                             11140000
112410     MOVE 0 TO PV-HDR-CSR-FETCH-COUNT.                            11150000
112500                                                                  11160000
112600     PERFORM 1010-CHECK-LOGGING.                                  11170000
112700                                                                  11180000
112800     PERFORM 1050-GET-CURRENT-TMST.                               11190000
112900                                                                  11200000
113000     IF PS-WRITE-TO-LOG-YES                                       11210000
113100         STRING   ' ' WS003-SRC-TASK-NUMBER                       11220000
113200                  ' WSKUP301 CALLED FROM '                        11230000
113300                  WS003-CALLING-PROGRAM-NAME                      11240000
113400                  DELIMITED BY SIZE                               11250000
113500                  INTO PV-MSG-AREA                                11260000
113600         PERFORM 9200-WRITE-TO-LOG                                11270000
113700         MOVE  WS003-OPER-UNT-ID  TO PV-DISP-OPER-UNT-ID          11280000
113800         MOVE DK-EXT-SHP-ID       TO PV-DISP-EXT-SHP-ID           11290000
113900         MOVE DK-TRIP-ID          TO PV-DISP-TRIP-ID              11300000
114000         STRING   ' ' WS003-SRC-TASK-NUMBER                       11310000
114100                  ' WSKUP301-1000:'                               11320000
114200                  ' ' PV-DISP-OPER-UNT-ID                         11330000
114300                  ' ' WS003-USERID                                11340000
114400                  ' LOGGING TURNED ON'                            11350000
114500         DELIMITED BY SIZE                                        11360000
114600         INTO PV-MSG-AREA                                         11370000
114700         PERFORM 9200-WRITE-TO-LOG                                11380000
114800         STRING   '==> KEY EXT SHP ID: '                          11390000
114900                  PV-DISP-EXT-SHP-ID                              11400000
115000                  '==> KEY TRIP ID: '                             11410000
115100                  PV-DISP-TRIP-ID                                 11420000
115200         DELIMITED BY SIZE                                        11430000
115300         INTO PV-MSG-AREA                                         11440000
115400         PERFORM 9200-WRITE-TO-LOG                                11450000
115500         STRING   '==> KEY DWNLD TMST: '                          11460000
115600                  PV-CURRENT-TMST                                 11470000
115700         DELIMITED BY SIZE                                        11480000
115800         INTO PV-MSG-AREA                                         11490000
115900         PERFORM 9200-WRITE-TO-LOG                                11500000
116000     END-IF.                                                      11510000
116100                                                                  11520000
116200******************************************************************11530000
116300** CSSL MSGS FOR DEBUGGING ARE CONTROLLED WITH A SWITCH,        **11540000
116400** AN ABEND WILL AUTOMATICALLY WRITE MSGS TO CSSL               **11550000
116500******************************************************************11560000
116600 1010-CHECK-LOGGING.                                              11570000
116700                                                                  11580000
116800     INITIALIZE WST00010-ATTR-ELEM-TXT-TEXT.                      11590000
116900                                                                  11600000
117000     EXEC SQL                                                     11610000
117100         SELECT A.INTGRTN_TYP_CDE                                 11620000
117200              , A.INTGRTN_TYP_DESC                                11630000
117300              , C.ATTR_ELEM_TXT    AS PROGRAM_NAME                11640000
117400              , D.ATTR_ELEM_TXT    AS SWITCH_IND                  11650000
117500         INTO  :WST00008-INTGRTN-TYP-CDE                          11660000
117600              ,:WST00008-INTGRTN-TYP-DESC                         11670000
117700              ,:PV-PROGRAM-NAME                                   11680000
117800              ,:PV-SWITCH-IND                                     11690000
117900         FROM   WST_INTGRTN_TYP   A                               11700000
118000              , WST_ATTR_DEFN     B                               11710000
118100              , WST_ATTR_ELEM     C                               11720000
118200              , WST_ATTR_ELEM     D                               11730000
118300         WHERE A.INTGRTN_TYP_CDE    =  'CSSLLOG'                  11740000
118400           AND A.INTGRTN_TYP_CDE    =  B.INTGRTN_TYP_CDE          11750000
118500           AND B.ATTR_DEFN_SEQ_NBR  =  1                          11760000
118600           AND B.INTGRTN_TYP_CDE    =  C.INTGRTN_TYP_CDE          11770000
118700           AND C.ATTR_DEFN_SEQ_NBR  =  1                          11780000
118800           AND B.INTGRTN_TYP_CDE    =  D.INTGRTN_TYP_CDE          11790000
118900           AND D.ATTR_DEFN_SEQ_NBR  =  2                          11800000
119000           AND C.ATTR_ELEM_SEQ_NBR  =  D.ATTR_ELEM_SEQ_NBR        11810000
119100           AND C.ATTR_ELEM_TXT      = 'WSKUP301'                  11820000
119200     END-EXEC                                                     11830000
119300                                                                  11840000
119400     EVALUATE TRUE                                                11850000
119500         WHEN SQLCODE = ZERO                                      11860000
119600              IF PV-SWITCH-IND = PC-Y                             11870000
119700                 SET PS-WRITE-TO-LOG-YES   TO TRUE                11880000
119800              END-IF                                              11890000
119900         WHEN SQLWARN0 NOT = SPACES                               11900000
120000         WHEN SQLCODE NOT = ZERO                                  11910000
120100              SET  PS-ERROR         TO TRUE                       11920000
120200              MOVE SQLCODE       TO PV-DISP-SQLCODE               11930000
120300              STRING ' ' WS003-SRC-TASK-NUMBER                    11940000
120400                     ' WSKUP301-1010: CHECK-LOGGING'              11950000
120500                     ' CALLED BY-'                                11960000
120600                       WS003-CALLING-PROGRAM-NAME                 11970000
120700                     ' SQLCODE='                                  11980000
120800                       PV-DISP-SQLCODE                            11990000
120900                     ' SUCC='                                     12000000
121000                       WS003-SUCCESS-IND                          12010000
121100               DELIMITED BY SIZE                                  12020000
121200               INTO PV-MSG-AREA                                   12030000
121300              PERFORM 9200-WRITE-TO-LOG                           12040000
123200              PERFORM 9999-ABEND                                  12230000
123300     END-EVALUATE.                                                12240000
123400                                                                  12250000
123500     IF PS-WRITE-TO-LOG-YES                                       12260000
123600         MOVE DK-EXT-SHP-ID       TO PV-DISP-EXT-SHP-ID           12270000
123700         STRING   ' ' WS003-SRC-TASK-NUMBER                       12280000
123800                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   12290000
123900                  ' WSKUP301-1010: CHECK-LOGGING'                 12300000
124000         DELIMITED BY SIZE                                        12310000
124100         INTO PV-MSG-AREA                                         12320000
124200         PERFORM 9200-WRITE-TO-LOG                                12330000
124300     END-IF.                                                      12340000
124400                                                                  12350000
124500******************************************************************12360000
124600** GET CURRENT DB2 TIMESTAMP (SAME TMST IS USED FOR ALL INSERTS)**12370000
124700******************************************************************12380000
124800 1050-GET-CURRENT-TMST.                                           12390000
124900                                                                  12400000
125000     EXEC SQL                                                     12410000
125100         SET :PV-CURRENT-TMST = CURRENT TIMESTAMP                 12420000
125200     END-EXEC                                                     12430000
125300                                                                  12440000
125400     EVALUATE TRUE                                                12450000
125500         WHEN SQLCODE = ZERO                                      12460000
125600              CONTINUE                                            12470000
125700         WHEN SQLWARN0 NOT = SPACES                               12480000
125800         WHEN SQLCODE NOT = ZERO                                  12490000
125900              SET  PS-ERROR         TO TRUE                       12500000
126000              MOVE SQLCODE       TO PV-DISP-SQLCODE               12510000
126100              STRING ' ' WS003-SRC-TASK-NUMBER                    12520000
126200                     ' WSKUP301-1050: GET-CURRENT-TMST'           12530000
126300                     ' CALLED BY-'                                12540000
126400                       WS003-CALLING-PROGRAM-NAME                 12550000
126500                     ' SQLCODE='                                  12560000
126600                       PV-DISP-SQLCODE                            12570000
126700                     ' SUCC='                                     12580000
126800                       WS003-SUCCESS-IND                          12590000
126900               DELIMITED BY SIZE                                  12600000
127000               INTO PV-MSG-AREA                                   12610000
127100              PERFORM 9200-WRITE-TO-LOG                           12620000
128800              PERFORM 9999-ABEND                                  12790000
128900     END-EVALUATE.                                                12800000
129000                                                                  12810000
129100     IF PS-WRITE-TO-LOG-YES                                       12820000
129200         MOVE DK-EXT-SHP-ID       TO PV-DISP-EXT-SHP-ID           12830000
129300         STRING   ' ' WS003-SRC-TASK-NUMBER                       12840000
129400                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   12850000
129500                  ' WSKUP301-1050: GET-CURRENT-TMST= '            12860000
129600                  PV-CURRENT-TMST                                 12870000
129700         DELIMITED BY SIZE                                        12880000
129800         INTO PV-MSG-AREA                                         12890000
129900         PERFORM 9200-WRITE-TO-LOG                                12900000
130000     END-IF.                                                      12910000
130100                                                                  12920000
130100* JAK 06/2007 - MOVE LOGIC FROM MAINLINE TO SEPARATE PARAGRAPH    12921002
797200 1070-PROCESS-UPDATE.                                             12922002
097600**UPD DOWNLOAD CODES TO 'N' FOR THE EXT-SHP-ID THAT WAS PASSED    12923002
097700     PERFORM 1100-UPD-DOWNLOAD-CODES.                             12924002
097800                                                                  12925002
097900     PERFORM 1200-OPEN-TRIP-ID-CSR.                               12926002
098000                                                                  12927002
098100     PERFORM 1300-FETCH-TRIP-ID-CSR.                              12928002
098200                                                                  12929002
098300**SPIN THRU THE CSR TO CHECK FOR TROUBLE ON ANY LEVEL             12929102
098400**AND UPD DOWNLOAD CODE TO 'T' AT THE APPROPRIATE LEVEL           12929202
098500**IF TROUBLE IS FOUND AND THERE IS ONLY ONE RCVR,BYPASS THE       12929302
098600**REC TO BE SURE THERE ISN'T AN APPOINTMENT & ASN HDR             12929402
098700     SET PS-TROUBLE-FOUND-NO                                      12929502
098800         PS-BYPASS-NO TO TRUE.                                    12929602
098900     PERFORM 1500-PROCESS-TRIP-ID-CSR                             12929702
099000         UNTIL PS-END-OF-TRIP-ID-CSR-YES.                         12929802
099100                                                                  12929902
099200     PERFORM 1400-CLOSE-TRIP-ID-CSR.                              12930002
099300                                                                  12930102
099400     IF PS-TROUBLE-FOUND-YES                                      12930202
099500       AND PV-RCVR-COUNT = +1                                     12930302
099600        SET PS-BYPASS-YES TO TRUE                                 12930402
099700     END-IF.                                                      12930502
099800                                                                  12930602
099900     IF PS-WRITE-TO-LOG-YES                                       12930702
100000        AND SQLCODE = 0                                           12930802
100100         MOVE PV-RCVR-COUNT      TO PV-DISP-RCVR-COUNT            12930902
100200         STRING  ' ' WS003-SRC-TASK-NUMBER                        12931002
100300                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    12931102
100400                 ' 0000 MAINLINE COUNT DISTINCT RCVRS : '         12931202
100500                 PV-DISP-RCVR-COUNT                               12931302
100600                 ' TRBL FOUND Y OR N :'                           12931402
100700                    PS-TROUBLE-SW                                 12931502
100800                                                                  12931602
100900         DELIMITED BY SIZE                                        12931702
101000         INTO PV-MSG-AREA                                         12931802
101100         PERFORM 9200-WRITE-TO-LOG                                12931902
101200     END-IF.                                                      12932002
101300                                                                  12932102
101400     IF PS-BYPASS-YES                                             12932202
101500         IF PS-WRITE-TO-LOG-YES                                   12932302
101600           AND SQLCODE = 0                                        12932402
101700             MOVE PV-RCVR-COUNT      TO PV-DISP-RCVR-COUNT        12932502
101800             STRING  ' ' WS003-SRC-TASK-NUMBER                    12932602
101900                     ' ' PV-DISP-EXT-SHP-ID (1:10)                12932702
102000                     ' 0000 MAINLINE BYPASS SHPMT'                12932802
102100                     ' ONLY 1 RCVR THAT IS IN TRBL = BYPASS'      12932902
102200             DELIMITED BY SIZE                                    12933002
102300             INTO PV-MSG-AREA                                     12933102
102400             PERFORM 9200-WRITE-TO-LOG                            12933202
102500         END-IF                                                   12933302
102600     ELSE                                                         12933402
102700         PERFORM 2000-GET-TRIP-INFO                               12933502
102800         PERFORM 2400-CHECK-INTEGRATION-TYP                       12933602
102900         PERFORM 2500-APPOINTMENTS                                12933702
102901** TCR 5/03 ADDED 'IF' LOGIC AROUND PERF OF 7100- BELOW           12933802
102910         IF PS-BYPASS-NO                                          12933902
103000             PERFORM 7100-UPD-HDR-XREF-VER-NBR                    12934002
103010         END-IF                                                   12934102
103030                                                                  12934202
103100**CALL WSKUP302 - PGM TO PROCESS THE ENTRIES IN THE TEMP TBL      12934302
103200         IF PS-NO-ERROR AND PS-BYPASS-NO                          12934402
103210*TCR 5/03  IF PS-NO-ERROR                                         12934502
103300             PERFORM 7200-ASN-DWNLD-MODULE                        12934602
103400             IF WS006-SUCCESSFUL                                  12934702
103500                 CONTINUE                                         12934802
103600             ELSE                                                 12934902
103700                 STRING ' ' WS003-SRC-TASK-NUMBER                 12935002
103800                        ' WSKUP301-0000: MAINLINE'                12935102
103900                        ' INVALID RETURN FROM WSKUP302'           12935202
104000                        ' WS006-SUCCESS-IND: '                    12935302
104100                        WS006-SUCCESS-IND                         12935402
104200                 DELIMITED BY SIZE                                12935502
104300                 INTO PV-MSG-AREA                                 12935602
104400                 PERFORM 9200-WRITE-TO-LOG                        12935702
107400                 PERFORM 9999-ABEND                               12935802
107500             END-IF                                               12935902
107600             SET PS-END-OF-XREF-DTL-CSR-NO TO TRUE                12936002
107700             PERFORM 7410-OPEN-XREF-DTL-CSR                       12936102
107800                                                                  12936202
107900             PERFORM 7420-FETCH-XREF-DTL-CSR                      12936302
108000                 UNTIL PS-END-OF-XREF-DTL-CSR-YES                 12936402
108100                                                                  12936502
108200             PERFORM 7430-CLOSE-XREF-DTL-CSR                      12936602
108300         ELSE                                                     12936702
108301*TCR 5/03 ADDED 'IF PS-BYPASS-NO' BELOW                           12936802
108310             IF PS-BYPASS-NO                                      12936902
109900                 PERFORM 9999-ABEND                               12937002
109901             ELSE                                                 12937102
109902                 IF PS-WRITE-TO-LOG-YES                           12937202
109903                   AND SQLCODE = 0                                12937302
109904                     MOVE PV-RCVR-COUNT      TO PV-DISP-RCVR-COUNT12937402
109905                     STRING  ' ' WS003-SRC-TASK-NUMBER            12937502
109906                             ' ' PV-DISP-EXT-SHP-ID (1:10)        12937602
109907                             ' 0000 MAINLINE BYPASS SHPMT'        12937702
109908                             ' SHPMT FOUND ON HDR TABLE = BYPASS' 12937802
109909                     DELIMITED BY SIZE                            12937902
109910                     INTO PV-MSG-AREA                             12938002
109911                     PERFORM 9200-WRITE-TO-LOG                    12938102
109912                 END-IF                                           12938202
109920*TCR 5/03 ADDED 'END-IF' BELOW                                    12938302
110000             END-IF                                               12938402
110100         END-IF                                                   12938502
110700     END-IF.                                                      12938602
130100* JAK 06/2007 - END - NEW PARAGRAPH                               12938702
130700                                                                  12938802
130100* JAK 06/2007 - NEW PARAGRAPH TO PROCESS CANCELS                  12938904
097200 1080-PROCESS-CANCEL.                                             12939004
102800     PERFORM 2400-CHECK-INTEGRATION-TYP.                          12939105
102700     PERFORM 2000-GET-TRIP-INFO.                                  12939204
130600     PERFORM 1150-READ-XREF-HDR.                                  12939304
130600     MOVE 1             TO PV-GROUP-COUNTER.                      12939404
130600     MOVE 1             TO PV-ROW-COUNTER.                        12939504
097200     PERFORM 2700-CREATE-ASN-HDR.                                 12939604
103000     PERFORM 7100-UPD-HDR-XREF-VER-NBR.                           12939704
205100     MOVE PV-CURRENT-TMST (21:6)  TO WST00003-PRC-GP-ID.          12939804
103300     PERFORM 7200-ASN-DWNLD-MODULE.                               12939904
110000* JAK 06/2007 - END OF NEW PARAGRAPH                              12940004
130700                                                                  12940104
130200******************************************************************12940600
130300* UPDATE THE WST_SHIPT_XER_DTL.DWNLD_CDE TO 'N' FOR THE EXT_SHP_ID12941000
130400* THE +100 RETURN CODE WOULD BE AN ERROR                          12950000
130500******************************************************************12960000
130600 1100-UPD-DOWNLOAD-CODES.                                         12970000
130700                                                                  12980000
130800     EXEC SQL                                                     12990000
130900          UPDATE WST_SHPMT_XREF_DTL                               13000000
131000            SET  DWNLD_CDE = :PC-N                                13010000
131100           WHERE EXT_SHP_ID = :DK-EXT-SHP-ID                      13020000
131200     END-EXEC                                                     13030000
131300                                                                  13040000
131400     EVALUATE TRUE                                                13050000
131500         WHEN SQLCODE = ZERO                                      13060000
131600             CONTINUE                                             13070000
131700         WHEN SQLWARN0 NOT = SPACES                               13080000
131800         WHEN SQLCODE NOT = ZERO                                  13090000
131900              SET  PS-ERROR         TO TRUE                       13100000
132000              MOVE SQLCODE            TO PV-DISP-SQLCODE          13110000
132100              STRING ' ' WS003-SRC-TASK-NUMBER                    13120000
132200                     ' WSKUP301-1100: UPD-DOWNLOAD-CODES'         13130000
132300                     ' CALLED BY-'                                13140000
132400                      WS003-CALLING-PROGRAM-NAME                  13150000
132500                     ' SQLCODE='                                  13160000
132600                      PV-DISP-SQLCODE                             13170000
132700                     ' SUCC='                                     13180000
132800                      WS003-SUCCESS-IND                           13190000
132900              DELIMITED BY SIZE                                   13200000
133000              INTO PV-MSG-AREA                                    13210000
133100              PERFORM 9200-WRITE-TO-LOG                           13220000
134800              PERFORM 9999-ABEND                                  13390000
134900     END-EVALUATE.                                                13400000
135000                                                                  13410000
135100     IF PS-WRITE-TO-LOG-YES                                       13420000
135200         STRING   ' ' WS003-SRC-TASK-NUMBER                       13430000
135300                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   13440000
135400                  ' WSKUP301-1100: UPD-DOWNLOAD-CODES'            13450000
135500                  ' XREF DTL DWNLD CODES UPDATED TO N'            13460000
135600         DELIMITED BY SIZE                                        13470000
135700         INTO PV-MSG-AREA                                         13480000
135800         PERFORM 9200-WRITE-TO-LOG                                13490000
135900     END-IF.                                                      13500000
136000                                                                  13510000
130200* JAK 06/2007 - ADD PARAGRAPH 1150 TO READ XREF HDR TABLE         13511003
130200******************************************************************13512003
130300* READ THE XREF HEADER TO GET INFORMATION FOR ASN CANCEL TRANS    13513003
130500******************************************************************13514003
130600 1150-READ-XREF-HDR.                                              13515003
130700                                                                  13516003
130800     EXEC SQL                                                     13517003
130900          SELECT CRE_USR_ID                                       13518003
130900               , CRE_TMST                                         13519003
130900               , DWNLD_CDE                                        13519104
130900               , VER_NBR                                          13519204
130900            INTO :WST00001-CRE-USR-ID                             13519303
130900               , :WST00001-CRE-TMST                               13519403
130900               , :WST00001-DWNLD-CDE                              13519504
130900               , :WST00001-VER-NBR                                13519604
130900            FROM WST_SHPMT_XREF_HDR                               13519703
131100           WHERE EXT_SHP_ID = :DK-EXT-SHP-ID                      13519803
131200     END-EXEC.                                                    13519903
131300                                                                  13520003
131400     EVALUATE TRUE                                                13520103
131500         WHEN SQLCODE = ZERO                                      13520203
215800**INCREMENT HOST-ID FIELD FOR LATER UPDATE OF HDR XREF VER-NBR    13520404
215900             IF WST00001-DWNLD-CDE = PC-N                         13520504
216000                 MOVE +1 TO PV-HOST-INPUT-ID                      13520604
216100             ELSE                                                 13520704
216200                 MOVE WST00001-VER-NBR                            13520904
216300                            TO PV-LAST-HOST-INPUT-ID              13521004
216400                 COMPUTE PV-HOST-INPUT-ID =                       13521104
216500                            PV-LAST-HOST-INPUT-ID + 1             13521204
216600             END-IF                                               13521304
131700         WHEN SQLWARN0 NOT = SPACES                               13521403
131800         WHEN SQLCODE NOT = ZERO                                  13521503
131900              SET  PS-ERROR         TO TRUE                       13521603
132000              MOVE SQLCODE            TO PV-DISP-SQLCODE          13521703
132100              STRING ' ' WS003-SRC-TASK-NUMBER                    13521803
132200                     ' WSKCS301-1150: READ-XREF-HDR'              13521909
132500                     ' SQLCODE='                                  13522103
132600                      PV-DISP-SQLCODE                             13522203
132900              DELIMITED BY SIZE                                   13522303
133000              INTO PV-MSG-AREA                                    13522403
145600              PERFORM 9200-WRITE-TO-LOG                           13522803
147300              PERFORM 9999-ABEND                                  13522903
134900     END-EVALUATE.                                                13523003
135000                                                                  13523103
135100     IF PS-WRITE-TO-LOG-YES                                       13523203
135200         STRING   ' ' WS003-SRC-TASK-NUMBER                       13523303
135300                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   13523403
135400                  ' WSKCS301-1150: READ-XREF-HDR'                 13523509
133900                  ' EXT SHIP ID: ' DK-EXT-SHP-ID                  13523703
135600         DELIMITED BY SIZE                                        13523803
135700         INTO PV-MSG-AREA                                         13523903
135800         PERFORM 9200-WRITE-TO-LOG                                13524003
135900     END-IF.                                                      13524103
110000* JAK 06/2007 - END OF NEW PARAGRAPH                              13524203
135000                                                                  13524303
131300                                                                  13530103
136100******************************************************************13530200
136200* OPEN TRIP_ID_CSR                                               *13531000
136300******************************************************************13540000
136400 1200-OPEN-TRIP-ID-CSR.                                           13550000
136500                                                                  13560000
136600     EXEC SQL                                                     13570000
136700          OPEN TRIP_ID_CSR                                        13580000
136800     END-EXEC                                                     13590000
136900                                                                  13600000
137000     EVALUATE TRUE                                                13610000
137100         WHEN SQLCODE = ZERO                                      13620000
137200              CONTINUE                                            13630000
137300         WHEN SQLWARN0 NOT = SPACES                               13640000
137400         WHEN SQLCODE NOT = ZERO                                  13650000
137500         SET  PS-ERROR         TO TRUE                            13660000
137600         MOVE SQLCODE            TO PV-DISP-SQLCODE               13670000
137700         STRING ' ' WS003-SRC-TASK-NUMBER                         13680000
137800                ' WSKUP301-1200: OPEN-TRIP-ID-CSR'                13690000
137900                ' CALLED BY-'                                     13700000
138000                 WS003-CALLING-PROGRAM-NAME                       13710000
138100                ' SQLCODE='                                       13720000
138200                 PV-DISP-SQLCODE                                  13730000
138300                ' SUCC='                                          13740000
138400                 WS003-SUCCESS-IND                                13750000
138500          DELIMITED BY SIZE                                       13760000
138600          INTO PV-MSG-AREA                                        13770000
138700          PERFORM 9200-WRITE-TO-LOG                               13780000
140400          PERFORM 9999-ABEND                                      13950000
140500     END-EVALUATE.                                                13960000
140600                                                                  13970000
140700******************************************************************13980000
140800* FETCH  TRIP_ID_CSR                                             *13990000
140900******************************************************************14000000
141000 1300-FETCH-TRIP-ID-CSR.                                          14010000
141100                                                                  14020000
141200     EXEC SQL                                                     14030000
141300          FETCH TRIP_ID_CSR                                       14040000
141400          INTO                                                    14050000
141500                :WST00002-PO-NBR                                  14060000
141600               ,:WST00002-PO-LNE-NBR                              14070000
141700               ,:WST00002-RCVR-SEQ-NBR                            14080000
141800               ,:WST00002-ASN-LVL-CDE                             14090000
141900               ,:WST00002-PREPK-ID                                14100000
142000     END-EXEC                                                     14110000
142100                                                                  14120000
142200     EVALUATE TRUE                                                14130000
142300         WHEN SQLCODE = ZERO                                      14140000
142400             CONTINUE                                             14150000
142500         WHEN SQLCODE = +100                                      14160000
142600             SET PS-END-OF-TRIP-ID-CSR-YES TO TRUE                14170000
142700             MOVE 0 TO PV-HOLD-TRIP-CSR-PREPK-ID                  14180000
142800                       PV-HOLD-TRIP-CSR-PO-NBR                    14190000
142900         WHEN SQLWARN0 NOT = SPACES                               14200000
143000         WHEN SQLCODE NOT = ZERO                                  14210000
143100         WHEN SQLCODE NOT = +100                                  14220000
143200         SET  PS-ERROR         TO TRUE                            14230000
143300         MOVE SQLCODE            TO PV-DISP-SQLCODE               14240000
143400         MOVE WST00002-PO-NBR    TO PV-DISP-PO-NBR                14250000
143500         MOVE WST00002-RCVR-SEQ-NBR TO PV-DISP-RCVR-SEQ-NBR       14260000
143600         MOVE WST00002-PREPK-ID   TO PV-DISP-PREPK-ID             14270000
143700         MOVE WST00002-PO-LNE-NBR TO PV-DISP-PO-LINE-NBR          14280000
143800         STRING ' ' WS003-SRC-TASK-NUMBER                         14290000
143900                ' WSKUP301-1300: FETCH-TRIP-ID-CSR'               14300000
144000                ' CALLED BY-'                                     14310000
144100                 WS003-CALLING-PROGRAM-NAME                       14320000
144200                ' SQLCODE='                                       14330000
144300                 PV-DISP-SQLCODE                                  14340000
144400                ' SUCC='                                          14350000
144500                 WS003-SUCCESS-IND                                14360000
144600                 ' PO='                                           14370000
144700                 PV-DISP-PO-NBR                                   14380000
144800                 ' RCVR='                                         14390000
144900                 PV-DISP-RCVR-SEQ-NBR                             14400000
145000                 ' PRPK='                                         14410000
145100                 PV-DISP-PREPK-ID                                 14420000
145200                 ' PO LNE='                                       14430000
145300                 PV-DISP-PO-LINE-NBR                              14440000
145400           DELIMITED BY SIZE                                      14450000
145500           INTO PV-MSG-AREA                                       14460000
145600           PERFORM 9200-WRITE-TO-LOG                              14470000
147300           PERFORM 9999-ABEND                                     14640000
147400     END-EVALUATE.                                                14650000
147500                                                                  14660000
147600     IF PS-WRITE-TO-LOG-YES                                       14670000
147700      AND SQLCODE = 0                                             14680000
147800         STRING   ' ' WS003-SRC-TASK-NUMBER                       14690000
147900                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   14700000
148000                  ' WSKUP301-1300: FETCH-TRIP-ID-CSR'             14710000
148100         DELIMITED BY SIZE                                        14720000
148200         INTO PV-MSG-AREA                                         14730000
148300         PERFORM 9200-WRITE-TO-LOG                                14740000
148400         MOVE WST00002-PO-NBR       TO PV-DISP-PO-NBR             14750000
148500         MOVE WST00002-RCVR-SEQ-NBR TO PV-DISP-RCVR-SEQ-NBR       14760000
148600         MOVE WST00002-PREPK-ID     TO PV-DISP-PREPK-ID           14770000
148700         MOVE WST00002-PO-LNE-NBR   TO PV-DISP-PO-LINE-NBR        14780000
148800         STRING   ' ' PV-DISP-EXT-SHP-ID (1:10)                   14790000
148900                  ' PO NBR: '                                     14800000
149000                  PV-DISP-PO-NBR                                  14810000
149100                  ' RCVR: '                                       14820000
149200                  PV-DISP-RCVR-SEQ-NBR                            14830000
149300                  ' PRE PACK ID: '                                14840000
149400                  PV-DISP-PREPK-ID                                14850000
149500                  ' PO LINE: '                                    14860000
149600                  PV-DISP-PO-LINE-NBR                             14870000
149700         DELIMITED BY SIZE                                        14880000
149800         INTO PV-MSG-AREA                                         14890000
149900         PERFORM 9200-WRITE-TO-LOG                                14900000
150000     END-IF.                                                      14910000
150100                                                                  14920000
150200******************************************************************14930000
150300* CLOSE TRIP_ID_CSR                                              *14940000
150400******************************************************************14950000
150500 1400-CLOSE-TRIP-ID-CSR.                                          14960000
150600                                                                  14970000
150700     EXEC SQL                                                     14980000
150800          CLOSE TRIP_ID_CSR                                       14990000
150900     END-EXEC                                                     15000000
151000                                                                  15010000
151100     EVALUATE TRUE                                                15020000
151200         WHEN SQLCODE = ZERO                                      15030000
151300              CONTINUE                                            15040000
151400         WHEN SQLWARN0 NOT = SPACES                               15050000
151500         WHEN SQLCODE NOT = ZERO                                  15060000
151600         SET  PS-ERROR         TO TRUE                            15070000
151700         MOVE SQLCODE            TO PV-DISP-SQLCODE               15080000
151800         STRING ' ' WS003-SRC-TASK-NUMBER                         15090000
151900                ' WSKUP301-1400: CLOSE-TRIP-ID-CSR'               15100000
152000                ' CALLED BY-'                                     15110000
152100                 WS003-CALLING-PROGRAM-NAME                       15120000
152200                ' SQLCODE='                                       15130000
152300                 PV-DISP-SQLCODE                                  15140000
152400                ' SUCC='                                          15150000
152500                 WS003-SUCCESS-IND                                15160000
152600         DELIMITED BY SIZE                                        15170000
152700         INTO PV-MSG-AREA                                         15180000
152800         PERFORM 9200-WRITE-TO-LOG                                15190000
154500         PERFORM 9999-ABEND                                       15360000
154600     END-EVALUATE.                                                15370000
154700                                                                  15380000
154800******************************************************************15390000
154900* -CHECK FOR TROUBLE AT THE PACK, PO LINE & RCVR LEVELS          *15400000
155000******************************************************************15410000
155100 1500-PROCESS-TRIP-ID-CSR.                                        15420000
155200                                                                  15430000
155300     IF WST00002-PO-NBR = PV-HOLD-TRIP-CSR-PO-NBR                 15440000
155400        IF WST00002-RCVR-SEQ-NBR = PV-HOLD-RCVR-NBR               15450000
155500           CONTINUE                                               15460000
155600        ELSE                                                      15470000
155700           PERFORM 1800-CHECK-FOR-TROUBLE                         15480000
155800           MOVE WST00002-RCVR-SEQ-NBR TO PV-HOLD-RCVR-NBR         15490000
155900           ADD +1 TO PV-RCVR-COUNT                                15500000
156000        END-IF                                                    15510000
156100     ELSE                                                         15520000
156200        PERFORM 1800-CHECK-FOR-TROUBLE                            15530000
156300        MOVE WST00002-PO-NBR TO PV-HOLD-TRIP-CSR-PO-NBR           15540000
156400        MOVE WST00002-RCVR-SEQ-NBR TO PV-HOLD-RCVR-NBR            15550000
156500        ADD +1 TO PV-RCVR-COUNT                                   15560000
156600     END-IF.                                                      15570000
156700                                                                  15580000
156800     PERFORM 1300-FETCH-TRIP-ID-CSR.                              15590000
156900                                                                  15600000
157000******************************************************************15610000
157100** CHECK FOR TROUBLE AT ANY LEVEL - RCVR, PK OR LN LEVEL        **15620000
157200******************************************************************15630000
157300 1800-CHECK-FOR-TROUBLE.                                          15640000
157400                                                                  15650000
157500     MOVE 0                   TO PV-TROUBLE-COUNT.                15660000
157600                                                                  15670000
157700     EXEC SQL                                                     15680000
157800        SELECT COUNT(*)                                           15690000
157900          INTO :PV-TROUBLE-COUNT                                  15700000
158000          FROM TTRBNTF A                                          15710000
158100              ,TTRBRSN C                                          15720000
158200         WHERE A.PO_NBR       =  :WST00002-PO-NBR                 15730000
158300           AND A.REC_SEQ_NBR  =  :WST00002-RCVR-SEQ-NBR           15740000
158400           AND A.RESOLVED_IND IN ('N','I','R')                    15750000
158500           AND A.TRBL_RSN_CDE = C.TRBL_RSN_CDE                    15760000
158600           AND C.NOTIF_IND    =  :PC-T                            15770000
158700           AND NOT EXISTS                                         15780000
158800              ( SELECT *                                          15790000
158900                FROM  TTRBRCN B                                   15800000
159000                WHERE B.RPT_PGM_NM  = :PC-PROGRAM-NAME            15810000
159100                  AND A.TRBL_RSN_CDE  =  B.TRBL_RSN_CDE )         15820000
159200     END-EXEC                                                     15830000
159300                                                                  15840000
159400     EVALUATE TRUE                                                15850000
159500         WHEN SQLCODE = +100                                      15860000
159600              CONTINUE                                            15870000
159700         WHEN SQLCODE = ZERO                                      15880000
159800         WHEN SQLCODE = -811                                      15890000
159900              IF PV-TROUBLE-COUNT > 0                             15900000
160000                 PERFORM 1810-UPD-DTL-FOR-TROUBLE                 15910000
160100                 SET PS-TROUBLE-FOUND-YES TO TRUE                 15920000
160200              END-IF                                              15930000
160300         WHEN SQLWARN0 NOT = SPACES                               15940000
160400         WHEN SQLCODE NOT = ZERO                                  15950000
160500         WHEN SQLCODE NOT = +100                                  15960000
160600         WHEN SQLCODE NOT = -811                                  15970000
160700         SET  PS-ERROR         TO TRUE                            15980000
160800         MOVE SQLCODE            TO PV-DISP-SQLCODE               15990000
160900         MOVE WST00002-PO-NBR    TO PV-DISP-PO-NBR                16000000
161000         MOVE WST00002-RCVR-SEQ-NBR TO PV-DISP-RCVR-SEQ-NBR       16010000
161100         STRING ' ' WS003-SRC-TASK-NUMBER                         16020000
161200               ' WSKUP301-1800: 1800-CHECK-FOR-TROUBLE'           16030000
161300                ' CALLED BY-'                                     16040000
161400                 WS003-CALLING-PROGRAM-NAME                       16050000
161500                ' SQLCODE='                                       16060000
161600                 PV-DISP-SQLCODE                                  16070000
161700                ' SUCC='                                          16080000
161800                 WS003-SUCCESS-IND                                16090000
161900                 ' PO='                                           16100000
162000                 PV-DISP-PO-NBR                                   16110000
162100                 ' RCVR='                                         16120000
162200                 PV-DISP-RCVR-SEQ-NBR                             16130000
162300         DELIMITED BY SIZE                                        16140000
162400         INTO PV-MSG-AREA                                         16150000
162500         PERFORM 9200-WRITE-TO-LOG                                16160000
164200         PERFORM 9999-ABEND                                       16330000
164300     END-EVALUATE.                                                16340000
164400                                                                  16350000
164500******************************************************************16360000
164600* UPDATE THE WST_SHIPT_XER_DTL.DWNLD_CDE TO 'T' FOR THE EXT_SHP_ID16370000
164700* PO_NBR, RCVR_SEQ.                                               16380000
164800******************************************************************16390000
164900 1810-UPD-DTL-FOR-TROUBLE.                                        16400000
165000                                                                  16410000
165100     EXEC SQL                                                     16420000
165200          UPDATE WST_SHPMT_XREF_DTL                               16430000
165300            SET  DWNLD_CDE = :PC-T                                16440000
165400           WHERE EXT_SHP_ID   = :DK-EXT-SHP-ID                    16450000
165500           AND   PO_NBR       = :WST00002-PO-NBR                  16460000
165600           AND   RCVR_SEQ_NBR = :WST00002-RCVR-SEQ-NBR            16470000
165700     END-EXEC                                                     16480000
165800                                                                  16490000
165900     EVALUATE TRUE                                                16500000
166000         WHEN SQLCODE = ZERO                                      16510000
166100             CONTINUE                                             16520000
166200         WHEN SQLWARN0 NOT = SPACES                               16530000
166300         WHEN SQLCODE NOT = ZERO                                  16540000
166400         SET  PS-ERROR         TO TRUE                            16550000
166500         MOVE SQLCODE            TO PV-DISP-SQLCODE               16560000
166600         STRING ' ' WS003-SRC-TASK-NUMBER                         16570000
166700                ' WSKUP301-1810: 1810-UPD-DTL-FOR-TROUBLE'        16580000
166800                ' CALLED BY-'                                     16590000
166900                 WS003-CALLING-PROGRAM-NAME                       16600000
167000                ' SQLCODE='                                       16610000
167100                 PV-DISP-SQLCODE                                  16620000
167200                ' SUCC='                                          16630000
167300                 WS003-SUCCESS-IND                                16640000
167400         DELIMITED BY SIZE                                        16650000
167500         INTO PV-MSG-AREA                                         16660000
167600         PERFORM 9200-WRITE-TO-LOG                                16670000
169300         PERFORM 9999-ABEND                                       16840000
169400     END-EVALUATE.                                                16850000
169500                                                                  16860000
169600     IF PS-WRITE-TO-LOG-YES                                       16870000
169700      AND SQLCODE = 0                                             16880000
169800         STRING   ' ' WS003-SRC-TASK-NUMBER                       16890000
169900                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   16900000
170000                  ' WSKUP301-1810: UPD-DTL-FOR-TROUBLE'           16910000
170100         DELIMITED BY SIZE                                        16920000
170200         INTO PV-MSG-AREA                                         16930000
170300         PERFORM 9200-WRITE-TO-LOG                                16940000
170400         MOVE WST00002-PO-NBR    TO PV-DISP-PO-NBR                16950000
170500         MOVE WST00002-RCVR-SEQ-NBR TO PV-DISP-RCVR-SEQ-NBR       16960000
170600         STRING   ' ' WS003-SRC-TASK-NUMBER                       16970000
170700                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   16980000
170800                  ' DTL XREF UPD TO T FOR PO NBR: '               16990000
170900                  PV-DISP-PO-NBR                                  17000000
171000                  ' RCVR: '                                       17010000
171100                  PV-DISP-RCVR-SEQ-NBR                            17020000
171200         DELIMITED BY SIZE                                        17030000
171300         INTO PV-MSG-AREA                                         17040000
171400         PERFORM 9200-WRITE-TO-LOG                                17050000
171500     END-IF.                                                      17060000
171600                                                                  17070000
171700******************************************************************17080000
171800** GATHER VARIOUS TRIP SPECIFICS FOR THE TRIP THAT IS PASSED IN **17090000
171900******************************************************************17100000
172000 2000-GET-TRIP-INFO.                                              17110000
172100                                                                  17120000
172200** GET SCAC, VEHICLE_NBR & ETA_DATE FROM TVHTRIP                  17130000
172300     PERFORM 2100-GET-SCAC.                                       17140000
172400                                                                  17150000
172500** GET DISTINCT PRO_NBR FROM TSHIPMT                              17160000
172600     PERFORM 2200-GET-PRO-NBR.                                    17170000
172700                                                                  17180000
172800** GET OPER_UNT_ID FROM TTRIPST                                   17190000
172900     PERFORM 2300-GET-OPER-UNT-ID.                                17200000
173000                                                                  17210000
173100******************************************************************17220000
173200** THE STD DB2 TMST MUST BE REFORMATTED TO 14 CHAR.             **17230000
173300** SO PV-ETA-REFORMATTED IS CCYYMMDDHHMMSS                      **17240000
173400******************************************************************17250000
173500 2100-GET-SCAC.                                                   17260000
173600                                                                  17270000
173700     INITIALIZE VHTRIP-OWNER-SCAC-ID                              17280000
173800                VHTRIP-VEH-NBR                                    17290000
173900                VHTRIP-EST-AR-TMST                                17300000
174000                PV-ETA-REFORMATTED.                               17310000
174100                                                                  17320000
174200     EXEC SQL                                                     17330000
174300        SELECT   OWNER_SCAC_ID                                    17340000
174400               , VEH_NBR                                          17350000
174500               , EST_AR_TMST                                      17360000
174600          INTO  :VHTRIP-OWNER-SCAC-ID                             17370000
174700               ,:VHTRIP-VEH-NBR                                   17380000
174800               ,:VHTRIP-EST-AR-TMST                               17390000
174900          FROM TVHTRIP                                            17400000
175000         WHERE TRIP_ID = :DK-TRIP-ID                              17410000
175100     END-EXEC                                                     17420000
175200                                                                  17430000
175300     EVALUATE TRUE                                                17440000
175400         WHEN SQLCODE = ZERO                                      17450000
175500              MOVE VHTRIP-EST-AR-TMST (1:4)                       17460000
175600                TO PV-ETA-REFORMATTED (1:4)                       17470000
175700                                                                  17480000
175800              MOVE VHTRIP-EST-AR-TMST (6:2)                       17490000
175900                TO PV-ETA-REFORMATTED (5:2)                       17500000
176000                                                                  17510000
176100              MOVE VHTRIP-EST-AR-TMST (9:2)                       17520000
176200                TO PV-ETA-REFORMATTED (7:2)                       17530000
176300                                                                  17540000
176400              MOVE VHTRIP-EST-AR-TMST (12:2)                      17550000
176500                TO PV-ETA-REFORMATTED (9:2)                       17560000
176600                                                                  17570000
176700              MOVE VHTRIP-EST-AR-TMST (15:2)                      17580000
176800                TO PV-ETA-REFORMATTED (11:2)                      17590000
176900                                                                  17600000
177000              MOVE VHTRIP-EST-AR-TMST (18:2)                      17610000
177100                TO PV-ETA-REFORMATTED (13:2)                      17620000
177200                                                                  17630000
177300         IF PS-WRITE-TO-LOG-YES                                   17640000
177400          AND SQLCODE = 0                                         17650000
177500              STRING ' ' WS003-SRC-TASK-NUMBER                    17660000
177600                     ' WSKUP301-2100: GET-SCAC'                   17670000
177700                     ' PV-ETA-REFORMATTED:'                       17680000
177800                     PV-ETA-REFORMATTED                           17690000
177900              DELIMITED BY SIZE                                   17700000
178000              INTO PV-MSG-AREA                                    17710000
178100              PERFORM 9200-WRITE-TO-LOG                           17720000
178200         END-IF                                                   17730000
178300                                                                  17740000
178400         WHEN SQLCODE = +100                                      17750000
178500              CONTINUE                                            17760000
178600         WHEN SQLWARN0 NOT = SPACES                               17770000
178700         WHEN SQLCODE NOT = ZERO                                  17780000
178800         WHEN SQLCODE NOT = +100                                  17790000
178900         SET  PS-ERROR         TO TRUE                            17800000
179000         MOVE SQLCODE            TO PV-DISP-SQLCODE               17810000
179100         STRING ' ' WS003-SRC-TASK-NUMBER                         17820000
179200                ' WSKUP301-2100: GET-SCAC'                        17830000
179300                ' CALLED BY-'                                     17840000
179400                 WS003-CALLING-PROGRAM-NAME                       17850000
179500                ' SQLCODE='                                       17860000
179600                 PV-DISP-SQLCODE                                  17870000
179700                ' SUCC='                                          17880000
179800                 WS003-SUCCESS-IND                                17890000
179900         DELIMITED BY SIZE                                        17900000
180000         INTO PV-MSG-AREA                                         17910000
180100         PERFORM 9200-WRITE-TO-LOG                                17920000
181800         PERFORM 9999-ABEND                                       18090000
181900     END-EVALUATE.                                                18100000
182000                                                                  18110000
182100     IF PS-WRITE-TO-LOG-YES                                       18120000
182200      AND SQLCODE = 0                                             18130000
182300         STRING ' ' WS003-SRC-TASK-NUMBER                         18140000
182400                ' ' PV-DISP-EXT-SHP-ID (1:10)                     18150000
182500                ' WSKUP301-2100: GET-SCAC'                        18160000
182600                ' SCAC :'                                         18170000
182700                 VHTRIP-OWNER-SCAC-ID                             18180000
182800                ' VHTRIP VEH-NBR :'                               18190000
182900                 VHTRIP-VEH-NBR                                   18200000
183000         DELIMITED BY SIZE                                        18210000
183100         INTO PV-MSG-AREA                                         18220000
183200         PERFORM 9200-WRITE-TO-LOG                                18230000
183300     END-IF.                                                      18240000
183400                                                                  18250000
183500******************************************************************18260000
183600**                                                              **18270000
183700******************************************************************18280000
183800 2200-GET-PRO-NBR.                                                18290000
183900                                                                  18300000
184000     INITIALIZE SHIPMT-PRO-NBR.                                   18310000
184100                                                                  18320000
184200     EXEC SQL                                                     18330000
184300        SELECT DISTINCT(PRO_NBR)                                  18340000
184400          INTO  :SHIPMT-PRO-NBR                                   18350000
184500          FROM TSHIPMT                                            18360000
184600         WHERE TRIP_ID = :DK-TRIP-ID                              18370000
184700     END-EXEC                                                     18380000
184800                                                                  18390000
184900     EVALUATE TRUE                                                18400000
185000         WHEN SQLCODE = ZERO                                      18410000
185100         WHEN SQLCODE = +100                                      18420000
185200         WHEN SQLCODE = -811                                      18430000
185300              CONTINUE                                            18440000
185400         WHEN SQLWARN0 NOT = SPACES                               18450000
185500         WHEN SQLCODE NOT = ZERO                                  18460000
185600         WHEN SQLCODE NOT = +100                                  18470000
185700         WHEN SQLCODE NOT = -811                                  18480000
185800         SET  PS-ERROR         TO TRUE                            18490000
185900         MOVE SQLCODE            TO PV-DISP-SQLCODE               18500000
186000         STRING ' ' WS003-SRC-TASK-NUMBER                         18510000
186100                ' WSKUP301-2200: GET-PRO-NBR'                     18520000
186200                ' CALLED BY-'                                     18530000
186300                 WS003-CALLING-PROGRAM-NAME                       18540000
186400                ' SQLCODE='                                       18550000
186500                 PV-DISP-SQLCODE                                  18560000
186600                ' SUCC='                                          18570000
186700                 WS003-SUCCESS-IND                                18580000
186800         DELIMITED BY SIZE                                        18590000
186900         INTO PV-MSG-AREA                                         18600000
187000         PERFORM 9200-WRITE-TO-LOG                                18610000
188700         PERFORM 9999-ABEND                                       18780000
188800     END-EVALUATE.                                                18790000
188900                                                                  18800000
189000******************************************************************18810000
189100**                                                              **18820000
189200******************************************************************18830000
189300 2300-GET-OPER-UNT-ID.                                            18840000
189400                                                                  18850000
189500     INITIALIZE TRIPST-OPER-UNT-ID.                               18860000
189600                                                                  18870000
189700     EXEC SQL                                                     18880000
189800        SELECT OPER_UNT_ID                                        18890000
189900               , A.STATUS_TME                                     18900000
190000               , A.STATUS_DTE                                     18910000
190100         INTO   :TRIPST-OPER-UNT-ID                               18920000
190200               ,:TRIPST-STATUS-TME                                18930000
190300               ,:TRIPST-STATUS-DTE                                18940000
190400            FROM TTRIPST A                                        18950000
190500           WHERE TRIP_ID = :DK-TRIP-ID                            18960000
190600            AND A.STATUS_TME =                                    18970000
190700                  (SELECT MAX(F.STATUS_TME)                       18980000
190800                   FROM   TTRIPST F                               18990000
190900                  WHERE A.TRIP_ID       = F.TRIP_ID               19000000
191000                   AND F.STATUS_DTE =                             19010000
191100                  (SELECT MAX(D.STATUS_DTE)                       19020000
191200                   FROM   TTRIPST D                               19030000
191300                   WHERE A.TRIP_ID       = D.TRIP_ID))            19040000
191400     END-EXEC                                                     19050000
191500                                                                  19060000
191600     EVALUATE TRUE                                                19070000
191700         WHEN SQLCODE = ZERO                                      19080000
191800              MOVE TRIPST-OPER-UNT-ID                             19090000
191900                TO PV-OPER-UNT-ID-PIC9                            19100000
192000         WHEN SQLCODE = +100                                      19110000
192100              CONTINUE                                            19120000
192200         WHEN SQLWARN0 NOT = SPACES                               19130000
192300         WHEN SQLCODE NOT = ZERO                                  19140000
192400         WHEN SQLCODE NOT = +100                                  19150000
192500         SET  PS-ERROR         TO TRUE                            19160000
192600         MOVE SQLCODE            TO PV-DISP-SQLCODE               19170000
192700         STRING ' ' WS003-SRC-TASK-NUMBER                         19180000
192800                ' WSKUP301-2300: GET-OPER-UNT-ID'                 19190000
192900                ' CALLED BY-'                                     19200000
193000                 WS003-CALLING-PROGRAM-NAME                       19210000
193100                ' SQLCODE='                                       19220000
193200                 PV-DISP-SQLCODE                                  19230000
193300                ' SUCC='                                          19240000
193400                 WS003-SUCCESS-IND                                19250000
193500         DELIMITED BY SIZE                                        19260000
193600         INTO PV-MSG-AREA                                         19270000
193700         PERFORM 9200-WRITE-TO-LOG                                19280000
195400         PERFORM 9999-ABEND                                       19450000
195500     END-EVALUATE.                                                19460000
195600                                                                  19470000
195700******************************************************************19480000
195800** THIS DETERMINES WHAT GETS DOWNLOADED TO WST_ASN_DWNLD        **19490000
195900******************************************************************19500000
196000 2400-CHECK-INTEGRATION-TYP.                                      19510000
196100                                                                  19520000
196200     INITIALIZE WST00010-ATTR-ELEM-TXT-TEXT.                      19530000
196300                                                                  19540000
196400     EXEC SQL                                                     19550000
196500         SELECT A.INTGRTN_TYP_CDE                                 19560000
196600              , A.INTGRTN_TYP_DESC                                19570000
196700              , A.APPL_FUNC_DESC                                  19580000
196800              , B.ATTR_ELEM_TXT                                   19590000
196900          INTO :WST00008-INTGRTN-TYP-CDE                          19600000
197000              ,:WST00008-INTGRTN-TYP-DESC                         19610000
197100              ,:WST00008-APPL-FUNC-DESC                           19620000
197200              ,:WST00010-ATTR-ELEM-TXT                            19630000
197300          FROM  WST_INTGRTN_TYP   A                               19640000
197400              , WST_ATTR_ELEM     B                               19650000
197500              , WST_ATTR_DEFN     C                               19660000
197600         WHERE  A.APPL_FUNC_DESC     = :PC-APPL-FUNC-DESC         19670000
197700         AND    A.INTGRTN_TYP_CDE    = B.INTGRTN_TYP_CDE          19680000
197800         AND    A.INTGRTN_TYP_CDE    = C.INTGRTN_TYP_CDE          19690000
197900         AND    C.ATTR_DEFN_SEQ_NBR  = :PC-ATTR-DEFN-SEQ-NBR      19700000
198000         AND    A.INTGRTN_TYP_CDE    = :PC-INTGRTN-TYP-CDE        19710000
198100     END-EXEC                                                     19720000
198200                                                                  19730000
198300     EVALUATE TRUE                                                19740000
198400         WHEN SQLCODE = ZERO                                      19750000
198500              EVALUATE TRUE                                       19760000
198600                 WHEN WST00010-ATTR-ELEM-TXT-TEXT = PC-D          19770000
198700                      SET PS-WRITE-ALL-TO-TEMP      TO TRUE       19780000
198800                      PERFORM 2450-PREP-DAT-CNTL-TBLS             19790000
198900                 WHEN WST00010-ATTR-ELEM-TXT-TEXT = PC-H          19800000
199000                      SET PS-WRITE-HDR-ONLY-TO-TEMP TO TRUE       19810000
199100                      PERFORM 2450-PREP-DAT-CNTL-TBLS             19820000
199200                 WHEN WST00010-ATTR-ELEM-TXT-TEXT = PC-N          19830000
199300                      SET PS-WRITE-NOTHING-TO-TEMP  TO TRUE       19840000
199400              END-EVALUATE                                        19850000
199500         WHEN SQLWARN0 NOT = SPACES                               19860000
199600         WHEN SQLCODE NOT = ZERO                                  19870000
199700         SET  PS-ERROR         TO TRUE                            19880000
199800         MOVE SQLCODE            TO PV-DISP-SQLCODE               19890000
199900         STRING ' ' WS003-SRC-TASK-NUMBER                         19900000
200000                ' WSKUP301-2400: CHECK-INTEGRATION-TYP'           19910000
200100                ' CALLED BY-'                                     19920000
200200                 WS003-CALLING-PROGRAM-NAME                       19930000
200300                ' SQLCODE='                                       19940000
200400                 PV-DISP-SQLCODE                                  19950000
200500                ' SUCC='                                          19960000
200600                 WS003-SUCCESS-IND                                19970000
200700         DELIMITED BY SIZE                                        19980000
200800         INTO PV-MSG-AREA                                         19990000
200900         PERFORM 9200-WRITE-TO-LOG                                20000000
202600         PERFORM 9999-ABEND                                       20170000
202700     END-EVALUATE.                                                20180000
202800                                                                  20190000
202900     IF PS-WRITE-TO-LOG-YES                                       20200000
203000      AND SQLCODE = 0                                             20210000
203100         STRING   ' ' WS003-SRC-TASK-NUMBER                       20220000
203200                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   20230000
203300                  ' WSKUP301-2400: CHECK-INTEGRATION-TYP'         20240000
203400         DELIMITED BY SIZE                                        20250000
203500         INTO PV-MSG-AREA                                         20260000
203600         PERFORM 9200-WRITE-TO-LOG                                20270000
203700         STRING   ' INTEGRATION TYPE: '                           20280000
203800                  WST00010-ATTR-ELEM-TXT-TEXT                     20290000
203900         DELIMITED BY SIZE                                        20300000
204000         INTO PV-MSG-AREA                                         20310000
204100         PERFORM 9200-WRITE-TO-LOG                                20320000
204200     END-IF.                                                      20330000
204300                                                                  20340000
204400******************************************************************20350000
204500**  LOAD THE DAT CNTL DCLGEN VALUES THAT ARE COMMON TO THIS TRANS*20360000
204600******************************************************************20370000
204700 2450-PREP-DAT-CNTL-TBLS.                                         20380000
204800                                                                  20390000
204900     MOVE PC-PRC-TYP-CDE          TO WST00003-TRN-TYP-CDE         20400000
205000                                     WST00004-TRN-TYP-CDE.        20410000
205100     MOVE PV-CURRENT-TMST (21:6)  TO WST00003-PRC-GP-ID           20420000
205200                                     WST00004-PRC-GP-ID.          20430000
205300     MOVE PV-CURRENT-TMST         TO WST00003-PRC-CNTL-TMST       20440000
205400                                     WST00003-BEG-PRC-TMST        20450000
205500                                     WST00004-PRC-CNTL-TMST.      20460000
205600     MOVE PV-OPER-UNT-ID-PIC9     TO WST00003-LOC-NBR.            20470000
205700     MOVE PC-STAT-CDE             TO WST00003-STAT-CDE.           20480000
205800     MOVE PC-DEFAULT-NINES        TO WST00003-END-PRC-TMST.       20490000
205900     MOVE PC-DAT-LOAD-VER-NBR     TO WST00003-DAT-LOD-VER-NBR.    20500000
206000     MOVE PC-TEMP-TBL-DESC-LENGTH TO WST00004-LOD-DAT-TXT-LEN.    20510000
206100                                                                  20520000
206200                                                                  20530000
206300******************************************************************20540000
206400** ONLY CREATE APPOINTMENTS FOR A FIRST TIME DWNLD WHERE THE    **20550000
206500** SHIPMENT IS NOT A DUMMY SHIPMENT.                            **20560000
206600******************************************************************20570000
206700 2500-APPOINTMENTS.                                               20580000
206800                                                                  20590000
206900     MOVE +1 TO PV-ROW-COUNTER                                    20600000
207000                PV-GROUP-COUNTER.                                 20610000
207100                                                                  20620000
207200     MOVE 0  TO PV-HOST-INPUT-ID                                  20630000
207300                PV-LAST-HOST-INPUT-ID .                           20640000
207400                                                                  20650000
207500     PERFORM 2510-OPEN-HDR-CSR-1.                                 20660000
207600                                                                  20670000
207700     SET PS-END-OF-HDR-CSR-1-NO TO TRUE.                          20680000
207800     PERFORM 2520-FETCH-HDR-CSR-1                                 20690000
207900       UNTIL PS-END-OF-HDR-CSR-1-YES.                             20700000
208000                                                                  20710000
208100     PERFORM 2540-CLOSE-HDR-CSR-1.                                20720000
208200                                                                  20730000
208300******************************************************************20740000
208400* OPEN HDR_CSR_1                                                 *20750000
208500******************************************************************20760000
208600 2510-OPEN-HDR-CSR-1.                                             20770000
208700                                                                  20780000
208800     EXEC SQL                                                     20790000
208900          OPEN HDR_CSR_1                                          20800000
209000     END-EXEC                                                     20810000
209100                                                                  20820000
209200     EVALUATE TRUE                                                20830000
209300         WHEN SQLCODE = ZERO                                      20840000
209400              CONTINUE                                            20850000
209500         WHEN SQLWARN0 NOT = SPACES                               20860000
209600         WHEN SQLCODE NOT = ZERO                                  20870000
209700         SET  PS-ERROR         TO TRUE                            20880000
209800         MOVE SQLCODE            TO PV-DISP-SQLCODE               20890000
209900         STRING ' ' WS003-SRC-TASK-NUMBER                         20900000
210000                ' WSKUP301-2510: OPEN-HDR-CSR-1'                  20910000
210100                ' CALLED BY-'                                     20920000
210200                 WS003-CALLING-PROGRAM-NAME                       20930000
210300                ' SQLCODE='                                       20940000
210400                 PV-DISP-SQLCODE                                  20950000
210500                ' SUCC='                                          20960000
210600                 WS003-SUCCESS-IND                                20970000
210700         DELIMITED BY SIZE                                        20980000
210800         INTO PV-MSG-AREA                                         20990000
210900         PERFORM 9200-WRITE-TO-LOG                                21000000
212600         PERFORM 9999-ABEND                                       21170000
212700     END-EVALUATE.                                                21180000
212800                                                                  21190000
212900******************************************************************21200000
213000* FETCH  HDR_CSR_1                                               *21210000
213100******************************************************************21220000
213200 2520-FETCH-HDR-CSR-1.                                            21230000
213300                                                                  21240000
213400     EXEC SQL                                                     21250000
213500          FETCH HDR_CSR_1                                         21260000
213600          INTO                                                    21270000
213700                :WST00001-SOR-CDE                                 21280000
213800               ,:WST00001-DMY-SEQ-NBR                             21290000
213900               ,:WST00001-DEST-LOC-NBR                            21300000
214000               ,:WST00001-DWNLD-CDE                               21310000
214100               ,:WST00001-RCPT-TMST                               21320000
214200               ,:WST00001-CRE-USR-ID                              21330000
214300               ,:WST00001-CRE-TMST                                21340000
214400               ,:WST00001-DWNLD-TMST                              21350000
214500               ,:WST00001-LAST-PRCG-TMST                          21360000
214600               ,:WST00001-PRC-CDE                                 21370000
214700               ,:WST00001-VER-NBR                                 21380000
214800     END-EXEC                                                     21390000
214900                                                                  21400000
215000     EVALUATE TRUE                                                21410000
215100         WHEN SQLCODE = ZERO                                      21420000
215110         ADD 1 TO PV-HDR-CSR-FETCH-COUNT                          21430000
215200**CREATE APPOINTMENT                                              21440000
215300              IF WST00001-DWNLD-CDE = PC-N                        21450000
215400**DO NOT CREATE APPOINTMENTS FOR DUMMY SHIPMENTS (DMY-SEQ-NBR>0)  21460000
215500                 AND WST00001-DMY-SEQ-NBR = 0                     21470000
215600                 PERFORM 2600-CREATE-APPOINTMENT                  21480000
215700              END-IF                                              21490000
215800**INCREMENT HOST-ID FIELD FOR LATER UPDATE OF HDR XREF VER-NBR    21500000
215900              IF WST00001-DWNLD-CDE = PC-N                        21510000
216000                 MOVE +1 TO PV-HOST-INPUT-ID                      21520000
216100              ELSE                                                21530000
216200                 MOVE WST00001-VER-NBR                            21540000
216300                   TO PV-LAST-HOST-INPUT-ID                       21550000
216400                 COMPUTE PV-HOST-INPUT-ID =                       21560000
216500                         PV-LAST-HOST-INPUT-ID + 1                21570000
216600              END-IF                                              21580000
216700                                                                  21590000
216800**CREATE ASN HEADER                                               21600000
216900              PERFORM 2700-CREATE-ASN-HDR                         21610000
217000**CREATE ASN DETAILS                                              21620000
217100              PERFORM 2800-CREATE-ASN-DTL-LVL                     21630000
217200**CASE LEVEL PROCESSING                                           21640000
217300              PERFORM 3200-CASE-LVL-PROCESSING                    21650000
217400                                                                  21660000
217500         WHEN SQLCODE = +100                                      21670000
217600              SET PS-END-OF-HDR-CSR-1-YES TO TRUE                 21680000
217601*TCR 5/03 BELOW                                                   21690000
217602              IF PV-HDR-CSR-FETCH-COUNT = 0                       21700000
217610                 SET PS-BYPASS-YES           TO TRUE              21710000
217620              END-IF                                              21720000
217630              MOVE 0 TO PV-HDR-CSR-FETCH-COUNT                    21730000
217700         WHEN SQLWARN0 NOT = SPACES                               21740000
217800         WHEN SQLCODE NOT = ZERO                                  21750000
217900         SET  PS-ERROR         TO TRUE                            21760000
218000         MOVE SQLCODE            TO PV-DISP-SQLCODE               21770000
218100         STRING ' ' WS003-SRC-TASK-NUMBER                         21780000
218200                ' WSKUP301-2520: FETCH-HDR-CSR-1'                 21790000
218300                ' CALLED BY-'                                     21800000
218400                 WS003-CALLING-PROGRAM-NAME                       21810000
218500                ' SQLCODE='                                       21820000
218600                 PV-DISP-SQLCODE                                  21830000
218700                ' SUCC='                                          21840000
218800                 WS003-SUCCESS-IND                                21850000
218900         DELIMITED BY SIZE                                        21860000
219000         INTO PV-MSG-AREA                                         21870000
219100         PERFORM 9200-WRITE-TO-LOG                                21880000
220800         PERFORM 9999-ABEND                                       22050000
220900     END-EVALUATE.                                                22060000
221000                                                                  22070000
221100     IF PS-WRITE-TO-LOG-YES                                       22080000
221200      AND SQLCODE = 0                                             22090000
221300         STRING   ' ' WS003-SRC-TASK-NUMBER                       22100000
221400                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   22110000
221500                  ' WSKUP301-2520: FETCH-HDR-CSR-1'               22120000
221600         DELIMITED BY SIZE                                        22130000
221700         INTO PV-MSG-AREA                                         22140000
221800         PERFORM 9200-WRITE-TO-LOG                                22150000
221900         MOVE WST00001-DMY-SEQ-NBR  TO PV-DISP-DMY-SEQ-NBR        22160000
222000         MOVE WST00001-VER-NBR      TO PV-DISP-VER-NBR            22170000
222100         STRING   ' DWNLD CODE: '                                 22180000
222200                  WST00001-DWNLD-CDE                              22190000
222300                  ' DMY SEQ NBR: '                                22200000
222400                  PV-DISP-DMY-SEQ-NBR                             22210000
222500                  ' VER NBR: '                                    22220000
222600                  PV-DISP-VER-NBR                                 22230000
222700         DELIMITED BY SIZE                                        22240000
222800         INTO PV-MSG-AREA                                         22250000
222900         PERFORM 9200-WRITE-TO-LOG                                22260000
223000     END-IF.                                                      22270000
223100                                                                  22280000
223200******************************************************************22290000
223300* CLOSE HDR_CSR_1                                                *22300000
223400******************************************************************22310000
223500 2540-CLOSE-HDR-CSR-1.                                            22320000
223600                                                                  22330000
223700     EXEC SQL                                                     22340000
223800          CLOSE HDR_CSR_1                                         22350000
223900     END-EXEC                                                     22360000
224000                                                                  22370000
224100     EVALUATE TRUE                                                22380000
224200         WHEN SQLCODE = ZERO                                      22390000
224300              CONTINUE                                            22400000
224400         WHEN SQLWARN0 NOT = SPACES                               22410000
224500         WHEN SQLCODE NOT = ZERO                                  22420000
224600         SET  PS-ERROR         TO TRUE                            22430000
224700         MOVE SQLCODE            TO PV-DISP-SQLCODE               22440000
224800         STRING ' ' WS003-SRC-TASK-NUMBER                         22450000
224900                ' WSKUP301-2540: CLOSE-HDR-CSR-1'                 22460000
225000                ' CALLED BY-'                                     22470000
225100                 WS003-CALLING-PROGRAM-NAME                       22480000
225200                 ' SQLCODE='                                      22490000
225300                 PV-DISP-SQLCODE                                  22500000
225400                ' SUCC='                                          22510000
225500                 WS003-SUCCESS-IND                                22520000
225600         DELIMITED BY SIZE                                        22530000
225700         INTO PV-MSG-AREA                                         22540000
225800         PERFORM 9200-WRITE-TO-LOG                                22550000
227300         PERFORM 9999-ABEND                                       22700000
227400     END-EVALUATE.                                                22710000
227500                                                                  22720000
227600******************************************************************22730000
227700* INSERT APPOINTMENT TO WST_ASN_DWNLD                            *22740000
227800******************************************************************22750000
227900 2600-CREATE-APPOINTMENT.                                         22760000
228000                                                                  22770000
228100     PERFORM 2605-LOAD-APPT-REC.                                  22780000
228200                                                                  22790000
228300     PERFORM 2610-LOAD-APPT-REC-TO-TEMP.                          22800000
228400                                                                  22810000
228500     EXEC SQL                                                     22820000
228600          INSERT INTO WST_ASN_DWNLD                               22830000
228700               (  EXT_SHP_ID                                      22840000
228800                , CRE_TMST                                        22850000
228900                , ROW_NBR                                         22860000
229000                , REC_TYP_GP_NBR                                  22870000
229100                , REC_TYP_CDE                                     22880000
229200                , CSE_DTL_NBR                                     22890000
229300                , REC_TYP_DESC                                    22900000
229400               )                                                  22910000
229500             VALUES                                               22920000
229600               ( :WST00011-EXT-SHP-ID                             22930000
229700                ,:WST00011-CRE-TMST                               22940000
229800                ,:WST00011-ROW-NBR                                22950000
229900                ,:WST00011-REC-TYP-GP-NBR                         22960000
230000                ,:WST00011-REC-TYP-CDE                            22970000
230100                ,:WST00011-CSE-DTL-NBR                            22980000
230200                ,:WST00011-REC-TYP-DESC                           22990000
230300               )                                                  23000000
230400     END-EXEC                                                     23010000
230500                                                                  23020000
230600     IF PS-WRITE-TO-LOG-YES                                       23030000
230700      AND SQLCODE = 0                                             23040000
230800        MOVE WST00011-ROW-NBR        TO  PV-DISP-ROW-NBR          23050000
230900        MOVE WST00011-REC-TYP-GP-NBR TO  PV-DISP-REC-TYP-GP-NBR   23060000
231000        MOVE WST00011-CSE-DTL-NBR    TO  PV-DISP-CSE-DTL-NBR      23070000
231100        STRING   ' ' WS003-SRC-TASK-NUMBER                        23080000
231200                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    23090000
231300                 ' WSKUP301-2600: CREATE-APPOINTMENT'             23100000
231400        DELIMITED BY SIZE                                         23110000
231500        INTO PV-MSG-AREA                                          23120000
231600        PERFORM 9200-WRITE-TO-LOG                                 23130000
231700        STRING   ' ' WS003-SRC-TASK-NUMBER                        23140000
231800               ' ' PV-DISP-EXT-SHP-ID (1:10)                      23150000
231900               ' # REC TYP CDE    : '                             23160000
232000               WST00011-REC-TYP-CDE                               23170000
232100               ' # ROW NBR        : '                             23180000
232200               PV-DISP-ROW-NBR                                    23190000
232300        DELIMITED BY SIZE                                         23200000
232400        INTO PV-MSG-AREA                                          23210000
232500        PERFORM 9200-WRITE-TO-LOG                                 23220000
232600        STRING ' ' WS003-SRC-TASK-NUMBER                          23230000
232700               ' ' PV-DISP-EXT-SHP-ID (1:10)                      23240000
232800               ' # REC TYP GP NBR : '                             23250000
232900               PV-DISP-REC-TYP-GP-NBR                             23260000
233000               ' # CSE DTL NBR    : '                             23270000
233100               PV-DISP-CSE-DTL-NBR                                23280000
233200        DELIMITED BY SIZE                                         23290000
233300        INTO PV-MSG-AREA                                          23300000
233400        PERFORM 9200-WRITE-TO-LOG                                 23310000
233500     END-IF.                                                      23320000
233600                                                                  23330000
233700     EVALUATE TRUE                                                23340000
233800         WHEN SQLCODE = ZERO                                      23350000
233900              ADD 1 TO PV-ROW-COUNTER                             23360000
234000                       PV-GROUP-COUNTER                           23370000
234100         WHEN SQLWARN0 NOT = SPACES                               23380000
234200         WHEN SQLCODE NOT = ZERO                                  23390000
234300         SET  PS-ERROR         TO TRUE                            23400000
234400         MOVE SQLCODE            TO PV-DISP-SQLCODE               23410000
234500         STRING ' ' WS003-SRC-TASK-NUMBER                         23420000
234600                ' WSKUP301-2600: CREATE-APPOINTMENT'              23430000
234700               ' CALLED BY-'                                      23440000
234800                 WS003-CALLING-PROGRAM-NAME                       23450000
234900                ' SQLCODE='                                       23460000
235000                 PV-DISP-SQLCODE                                  23470000
235100                ' SUCC='                                          23480000
235200                 WS003-SUCCESS-IND                                23490000
235300         DELIMITED BY SIZE                                        23500000
235400         INTO PV-MSG-AREA                                         23510000
235500         PERFORM 9200-WRITE-TO-LOG                                23520000
237200         PERFORM 9999-ABEND                                       23690000
237300     END-EVALUATE.                                                23700000
237400                                                                  23710000
237500******************************************************************23720000
237600* MOVES TO CREATE AN APPOINTMENT.                                *23730000
237700******************************************************************23740000
237800 2605-LOAD-APPT-REC.                                              23750000
237900                                                                  23760000
238000     INITIALIZE WS008-APPOINTMENT-REC.                            23770000
238100     MOVE 'WSRD008 '  TO PV-TEMP-COPYBOOK-NAME.                   23780000
238200                                                                  23790000
238300     SET WS008-AP-ADD              TO TRUE.                       23800000
238400     SET WS008-AP-APPOINTMT        TO TRUE.                       23810000
238500     MOVE WST00001-CRE-USR-ID      TO WS008-AP-CREATE-USERID.     23820000
238600     MOVE WST00001-CRE-TMST        TO WS008-AP-CREATE-TMST.       23830000
238700     MOVE DK-EXT-SHP-ID            TO WS008-AP-SHIPMT-NBR.        23840000
238800     MOVE PV-ETA-REFORMATTED       TO WS008-AP-EXPCT-STRT-DT-TM.  23850000
238900     SET WS008-AP-NO-PRIORITY      TO TRUE.                       23860000
239000     MOVE VHTRIP-OWNER-SCAC-ID     TO WS008-AP-SCAC.              23870000
239100     MOVE VHTRIP-VEH-NBR           TO WS008-AP-TRLR-NBR.          23880000
239200     MOVE SHIPMT-PRO-NBR           TO WS008-AP-PRO-NBR            23890000
239300     SET WS008-AP-INS-UPD          TO TRUE.                       23900000
239400     MOVE TRIPST-OPER-UNT-ID       TO PV-OPER-UNT-ID-PIC9.        23910000
239500     MOVE PV-OPER-UNT-ID-PIC9      TO WS008-AP-WHSE.              23920000
239600     MOVE SPACES                   TO WS008-AP-BOL.               23930000
239700     MOVE SPACES                   TO WS008-AP-SEAL-NBR.          23940000
239800                                                                  23950000
239900******************************************************************23960000
240000* MOVES TO LOAD THE FIELDS TO PREP FOR AN INSERT                 *23970000
240100******************************************************************23980000
240200 2610-LOAD-APPT-REC-TO-TEMP.                                      23990000
240300                                                                  24000000
240400     INITIALIZE DCLWST00011.                                      24010000
240500                                                                  24020000
240600     MOVE DK-EXT-SHP-ID             TO WST00011-EXT-SHP-ID.       24030000
240700     MOVE PV-CURRENT-TMST           TO WST00011-CRE-TMST.         24040000
240800     MOVE PV-ROW-COUNTER            TO WST00011-ROW-NBR.          24050000
240900     MOVE PV-GROUP-COUNTER          TO WST00011-REC-TYP-GP-NBR.   24060000
241000     MOVE PC-AP                     TO WST00011-REC-TYP-CDE.      24070000
241100     MOVE PC-TEMP-TBL-DESC-LENGTH   TO WST00011-REC-TYP-DESC-LEN. 24080000
241200     MOVE WS008-APPOINTMENT-REC     TO WST00011-REC-TYP-DESC-TEXT.24090000
241300     MOVE PC-HIGH-NINES             TO WST00011-CSE-DTL-NBR.      24100000
241400                                                                  24110000
241500******************************************************************24120000
241600*                                                                *24130000
241700******************************************************************24140000
241800 2700-CREATE-ASN-HDR.                                             24150000
241900                                                                  24160000
242000     MOVE +1 TO PV-PRC-LOD-SEQ-ID.                                24170000
242100     SET PS-DAT-CNTL-REC-INSERTED-NO  TO TRUE.                    24180000
242200                                                                  24190000
242300     PERFORM 2705-LOAD-ASN-HDR-REC.                               24200000
242400                                                                  24210000
242500     PERFORM 2710-LOAD-ASN-HDR-REC-TO-TEMP.                       24220000
242600                                                                  24230000
242700     EXEC SQL                                                     24240000
242800          INSERT INTO WST_ASN_DWNLD                               24250000
242900               (  EXT_SHP_ID                                      24260000
243000                , CRE_TMST                                        24270000
243100                , ROW_NBR                                         24280000
243200                , REC_TYP_GP_NBR                                  24290000
243300                , REC_TYP_CDE                                     24300000
243400                , CSE_DTL_NBR                                     24310000
243500                , REC_TYP_DESC                                    24320000
243600               )                                                  24330000
243700             VALUES                                               24340000
243800               ( :WST00011-EXT-SHP-ID                             24350000
243900                ,:WST00011-CRE-TMST                               24360000
244000                ,:WST00011-ROW-NBR                                24370000
244100                ,:WST00011-REC-TYP-GP-NBR                         24380000
244200                ,:WST00011-REC-TYP-CDE                            24390000
244300                ,:WST00011-CSE-DTL-NBR                            24400000
244400                ,:WST00011-REC-TYP-DESC                           24410000
244500               )                                                  24420000
244600     END-EXEC                                                     24430000
244700                                                                  24440000
244800     IF PS-WRITE-TO-LOG-YES                                       24450000
244900      AND SQLCODE = 0                                             24460000
245000        MOVE WST00011-ROW-NBR        TO  PV-DISP-ROW-NBR          24470000
245100        MOVE WST00011-REC-TYP-GP-NBR TO  PV-DISP-REC-TYP-GP-NBR   24480000
245200        MOVE WST00011-CSE-DTL-NBR    TO  PV-DISP-CSE-DTL-NBR      24490000
245300        STRING ' ' WS003-SRC-TASK-NUMBER                          24500000
245400               ' ' PV-DISP-EXT-SHP-ID (1:10)                      24510000
245500               ' WSKUP301-2700: CREATE-ASN-HDR'                   24520000
245600        DELIMITED BY SIZE                                         24530000
245700        INTO PV-MSG-AREA                                          24540000
245800        PERFORM 9200-WRITE-TO-LOG                                 24550000
245900        STRING   ' ' WS003-SRC-TASK-NUMBER                        24560000
246000               ' ' PV-DISP-EXT-SHP-ID (1:10)                      24570000
246100               ' # REC TYP CDE    : '                             24580000
246200               WST00011-REC-TYP-CDE                               24590000
246300               ' # ROW NBR        : '                             24600000
246400               PV-DISP-ROW-NBR                                    24610000
246500        DELIMITED BY SIZE                                         24620000
246600        INTO PV-MSG-AREA                                          24630000
246700        PERFORM 9200-WRITE-TO-LOG                                 24640000
246800        STRING ' ' WS003-SRC-TASK-NUMBER                          24650000
246900               ' ' PV-DISP-EXT-SHP-ID (1:10)                      24660000
247000               ' # REC TYP GP NBR : '                             24670000
247100               PV-DISP-REC-TYP-GP-NBR                             24680000
247200               ' # CSE DTL NBR    : '                             24690000
247300               PV-DISP-CSE-DTL-NBR                                24700000
247400        DELIMITED BY SIZE                                         24710000
247500        INTO PV-MSG-AREA                                          24720000
247600        PERFORM 9200-WRITE-TO-LOG                                 24730000
247700     END-IF.                                                      24740000
247800                                                                  24750000
247900     EVALUATE TRUE                                                24760000
248000         WHEN SQLCODE = ZERO                                      24770000
507200              SET PS-THIS-IS-ASN-HDR-YES TO TRUE                  24771005
248100              PERFORM 7500-DAT-CNTL-TBLS                          24780000
248200              ADD 1 TO PV-ROW-COUNTER                             24790000
248300                       PV-GROUP-COUNTER                           24800000
248400         WHEN SQLWARN0 NOT = SPACES                               24810000
248500         WHEN SQLCODE NOT = ZERO                                  24820000
248600         SET  PS-ERROR         TO TRUE                            24830000
248700         MOVE SQLCODE            TO PV-DISP-SQLCODE               24840000
248800         STRING ' ' WS003-SRC-TASK-NUMBER                         24850000
248900                ' WSKUP301-2700: CREATE-ASN-HDR'                  24860000
249000                ' CALLED BY-'                                     24870000
249100                 WS003-CALLING-PROGRAM-NAME                       24880000
249200                ' SQLCODE='                                       24890000
249300                 PV-DISP-SQLCODE                                  24900000
249400                ' SUCC='                                          24910000
249500                 WS003-SUCCESS-IND                                24920000
249600         DELIMITED BY SIZE                                        24930000
249700         INTO PV-MSG-AREA                                         24940000
249800         PERFORM 9200-WRITE-TO-LOG                                24950000
251500         PERFORM 9999-ABEND                                       25120000
251600     END-EVALUATE.                                                25130000
251700                                                                  25140000
251800******************************************************************25150000
251900* MOVES TO CREATE ASN HEADER REC.                                *25160000
252000******************************************************************25170000
252100 2705-LOAD-ASN-HDR-REC.                                           25180000
252200                                                                  25190000
252300     INITIALIZE WS004-ASN-REC.                                    25200000
252400     MOVE 'WSRD004 '  TO PV-TEMP-COPYBOOK-NAME.                   25210000
252500                                                                  25220000
252600     SET WS004-AH-ADD               TO TRUE.                      25230000
252700     SET WS004-AH-ASN-HDR           TO TRUE.                      25240000
252800     MOVE WST00001-CRE-USR-ID       TO WS004-AH-CREATE-USERID.    25250000
252900     MOVE WST00001-CRE-TMST         TO WS004-AH-CREATE-TMST.      25260000
253000     MOVE DK-EXT-SHP-ID             TO WS004-AH-SHIPMT-NBR.       25270000
253100     MOVE PV-OPER-UNT-ID-PIC9       TO WS004-AH-WHSE.             25280000
253200     MOVE SPACES                    TO WS004-AH-BOL-NBR.          25290000
253300     MOVE VHTRIP-OWNER-SCAC-ID      TO WS004-AH-CARRIER-SHIP-VIA. 25300000
253400     MOVE VHTRIP-VEH-NBR            TO WS004-AH-TRLR-NBR.         25310000
253500     MOVE DK-TRIP-ID                TO WS004-AH-TRIP-ID.          25320000
253600     MOVE SHIPMT-PRO-NBR            TO WS004-AH-PRO-NBR.          25330000
253700     MOVE PV-ETA-REFORMATTED        TO WS004-AH-SHIP-DATE         25340000
253800                                       WS004-AH-EXPT-START-DATE.  25350000
253900                                                                  25360000
254000     MOVE +0 TO PV-RECS-IN-TRBL-COUNT.                            25370000
254100     PERFORM 2715-COUNT-RECS-IN-TRBL.                             25380000
254200                                                                  25390000
254300     IF PV-RECS-IN-TRBL-COUNT > 0                                 25400000
254400        SET WS004-AH-TROUBLE-SHPMT TO TRUE                        25410000
254500        PERFORM 2720-UPD-HDR-XREF-DWNLD-CDE                       25420000
254600     ELSE                                                         25430000
254700        SET WS004-AH-NO-TROUBLE TO TRUE                           25440000
254800     END-IF.                                                      25450000
254900                                                                  25460000
254900* JAK 06/2007 - SET CODE BASED ON WS003 INPUT                     25461002
255000     IF WS003-CANCEL-SHPMT-YES                                    25470002
255000        SET WS004-AH-CANCEL     TO TRUE                           25471002
255000     ELSE                                                         25472002
255000        SET WS004-AH-IN-TRANSIT TO TRUE                           25473002
255000     END-IF.                                                      25474002
254900                                                                  25475002
255100     SET WS004-AH-DONT-CREATE-APPT                                25480002
255200         WS004-AH-VENDOR-SHIPMT TO TRUE.                          25490000
255300                                                                  25500000
255400     MOVE PV-HOST-INPUT-ID          TO WS004-AH-HOST-INPT-ID.     25510000
255500                                                                  25520000
255600******************************************************************25530000
255700* MOVES TO LOAD THE FIELDS TO PREP FOR AN INSERT                 *25540000
255800******************************************************************25550000
255900 2710-LOAD-ASN-HDR-REC-TO-TEMP.                                   25560000
256000                                                                  25570000
256100     INITIALIZE DCLWST00011.                                      25580000
256200                                                                  25590000
256300     MOVE DK-EXT-SHP-ID             TO WST00011-EXT-SHP-ID.       25600000
256400     MOVE PV-CURRENT-TMST           TO WST00011-CRE-TMST.         25610000
256500     MOVE PV-ROW-COUNTER            TO WST00011-ROW-NBR.          25620000
256600     MOVE PV-GROUP-COUNTER          TO WST00011-REC-TYP-GP-NBR.   25630000
256700     MOVE PC-AH                     TO WST00011-REC-TYP-CDE.      25640000
256800     MOVE PC-TEMP-TBL-DESC-LENGTH   TO WST00011-REC-TYP-DESC-LEN. 25650000
256900     MOVE WS004-ASN-REC             TO WST00011-REC-TYP-DESC-TEXT.25660000
257000     MOVE PC-HIGH-NINES             TO WST00011-CSE-DTL-NBR.      25670000
257100                                                                  25680000
257200******************************************************************25690000
257300*                                                                *25700000
257400******************************************************************25710000
257500 2715-COUNT-RECS-IN-TRBL.                                         25720000
257600                                                                  25730000
257700     EXEC SQL                                                     25740000
257800          SELECT COUNT (*)                                        25750000
257900          INTO :PV-RECS-IN-TRBL-COUNT                             25760000
258000          FROM WST_SHPMT_XREF_DTL                                 25770000
258100          WHERE DWNLD_CDE  = :PC-T                                25780000
258200          AND   EXT_SHP_ID = :DK-EXT-SHP-ID                       25790000
258300     END-EXEC                                                     25800000
258400                                                                  25810000
258500     EVALUATE TRUE                                                25820000
258600         WHEN SQLCODE = ZERO                                      25830000
258700         WHEN SQLCODE = +100                                      25840000
258800              CONTINUE                                            25850000
258900         WHEN SQLWARN0 NOT = SPACES                               25860000
259000         WHEN SQLCODE NOT = ZERO                                  25870000
259100         WHEN SQLCODE NOT = +100                                  25880000
259200         SET  PS-ERROR         TO TRUE                            25890000
259300         MOVE SQLCODE            TO PV-DISP-SQLCODE               25900000
259400         STRING ' ' WS003-SRC-TASK-NUMBER                         25910000
259500                ' WSKUP301-2715: COUNT-RECS-IN-TRBL'              25920000
259600                ' CALLED BY-'                                     25930000
259700                 WS003-CALLING-PROGRAM-NAME                       25940000
259800                ' SQLCODE='                                       25950000
259900                 PV-DISP-SQLCODE                                  25960000
260000                ' SUCC='                                          25970000
260100                 WS003-SUCCESS-IND                                25980000
260200         DELIMITED BY SIZE                                        25990000
260300         INTO PV-MSG-AREA                                         26000000
260400         PERFORM 9200-WRITE-TO-LOG                                26010000
262100         PERFORM 9999-ABEND                                       26180000
262200     END-EVALUATE.                                                26190000
262300                                                                  26200000
262400******************************************************************26210000
262500* UPDATE THE WST_SHIPT_XER_HDR.DWNLD_CDE TO 'P' BECAUSE TROUBLE   26220000
262600* EXISTS ON THE SHIPMENT AT SOME LEVEL.                           26230000
262700******************************************************************26240000
262800 2720-UPD-HDR-XREF-DWNLD-CDE.                                     26250000
262900                                                                  26260000
263000     EXEC SQL                                                     26270000
263100          UPDATE WST_SHPMT_XREF_HDR                               26280000
263200            SET  DWNLD_CDE    = :PC-P                             26290000
263300           WHERE EXT_SHP_ID   = :DK-EXT-SHP-ID                    26300000
263400     END-EXEC                                                     26310000
263500                                                                  26320000
263600     EVALUATE TRUE                                                26330000
263700         WHEN SQLCODE = ZERO                                      26340000
263800             CONTINUE                                             26350000
263900         WHEN SQLWARN0 NOT = SPACES                               26360000
264000         WHEN SQLCODE NOT = ZERO                                  26370000
264100         SET  PS-ERROR         TO TRUE                            26380000
264200         MOVE SQLCODE            TO PV-DISP-SQLCODE               26390000
264300         STRING ' ' WS003-SRC-TASK-NUMBER                         26400000
264400                ' WSKUP301-2720: UPD-HDR-XREF-DWNLD-CDE'          26410000
264500                ' CALLED BY-'                                     26420000
264600                 WS003-CALLING-PROGRAM-NAME                       26430000
264700                ' SQLCODE='                                       26440000
264800                 PV-DISP-SQLCODE                                  26450000
264900                ' SUCC='                                          26460000
265000                 WS003-SUCCESS-IND                                26470000
265100         DELIMITED BY SIZE                                        26480000
265200         INTO PV-MSG-AREA                                         26490000
265300         PERFORM 9200-WRITE-TO-LOG                                26500000
267000         PERFORM 9999-ABEND                                       26670000
267100     END-EVALUATE.                                                26680000
267200                                                                  26690000
267300     IF PS-WRITE-TO-LOG-YES                                       26700000
267400      AND SQLCODE = 0                                             26710000
267500        STRING   ' ' WS003-SRC-TASK-NUMBER                        26720000
267600                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    26730000
267700                 ' WSKUP301-2720: UPD-HDR-XREF-DWNLD-CDE TO P'    26740000
267800         DELIMITED BY SIZE                                        26750000
267900         INTO PV-MSG-AREA                                         26760000
268000         PERFORM 9200-WRITE-TO-LOG                                26770000
268100     END-IF.                                                      26780000
268200                                                                  26790000
268300******************************************************************26800000
268400*                                                                *26810000
268500******************************************************************26820000
268600 2800-CREATE-ASN-DTL-LVL.                                         26830000
268700                                                                  26840000
268800     PERFORM 2810-OPEN-ASN-DTL-CSR.                               26850000
268900                                                                  26860000
269000     SET PS-END-OF-ASN-DTL-CSR-NO TO TRUE.                        26870000
269100     PERFORM 2820-FETCH-ASN-DTL-CSR                               26880000
269200       UNTIL PS-END-OF-ASN-DTL-CSR-YES.                           26890000
269300                                                                  26900000
269400     PERFORM 2830-CLOSE-ASN-DTL-CSR.                              26910000
269500                                                                  26920000
269600******************************************************************26930000
269700* OPEN ASN_DTL_CSR     SKU LEVEL                                 *26940000
269800******************************************************************26950000
269900 2810-OPEN-ASN-DTL-CSR.                                           26960000
270000                                                                  26970000
270100     EXEC SQL                                                     26980000
270200          OPEN ASN_DTL_CSR                                        26990000
270300     END-EXEC                                                     27000000
270400                                                                  27010000
270500     EVALUATE TRUE                                                27020000
270600         WHEN SQLCODE = ZERO                                      27030000
270700              CONTINUE                                            27040000
270800         WHEN SQLWARN0 NOT = SPACES                               27050000
270900         WHEN SQLCODE NOT = ZERO                                  27060000
271000         SET  PS-ERROR         TO TRUE                            27070000
271100         MOVE SQLCODE            TO PV-DISP-SQLCODE               27080000
271200         STRING ' ' WS003-SRC-TASK-NUMBER                         27090000
271300                ' WSKUP301-2810: OPEN-ASN-DTL-CSR'                27100000
271400                ' CALLED BY-'                                     27110000
271500                 WS003-CALLING-PROGRAM-NAME                       27120000
271600                ' SQLCODE='                                       27130000
271700                 PV-DISP-SQLCODE                                  27140000
271800                ' SUCC='                                          27150000
271900                 WS003-SUCCESS-IND                                27160000
272000         DELIMITED BY SIZE                                        27170000
272100         INTO PV-MSG-AREA                                         27180000
272200         PERFORM 9200-WRITE-TO-LOG                                27190000
273900         PERFORM 9999-ABEND                                       27360000
274000     END-EVALUATE.                                                27370000
274100                                                                  27380000
274200******************************************************************27390000
274300* FETCH  ASN_DTL_CSR    SKU LEVEL                                *27400000
274400******************************************************************27410000
274500 2820-FETCH-ASN-DTL-CSR.                                          27420000
274600                                                                  27430000
274700     EXEC SQL                                                     27440000
274800          FETCH ASN_DTL_CSR                                       27450000
274900          INTO                                                    27460000
275000                :WST00002-PO-NBR                                  27470000
275100               ,:WST00002-PO-LNE-NBR                              27480000
275200               ,:WST00002-RCVR-SEQ-NBR                            27490000
275300               ,:WST00002-ASN-LVL-CDE                             27500000
275400               ,:WST00002-PREPK-ID                                27510000
275500               ,:WST00002-CRE-USR-ID                              27520000
275600               ,:WST00002-CRE-TMST                                27530000
275700               ,:WST00002-DWNLD-CDE                               27540000
275800               ,:WST00002-ACTV-CDE                                27550000
275900               ,:XLT00003-SKU-NBR                                 27560000
276000     END-EXEC                                                     27570000
276100                                                                  27580000
276200     EVALUATE TRUE                                                27590000
276300         WHEN SQLCODE = ZERO                                      27600000
276400              PERFORM 3000-CREATE-ASN-DTLS                        27610000
276500         WHEN SQLCODE = +100                                      27620000
276600             SET PS-END-OF-ASN-DTL-CSR-YES TO TRUE                27630000
276700         WHEN SQLWARN0 NOT = SPACES                               27640000
276800         WHEN SQLCODE NOT = ZERO                                  27650000
276900         SET  PS-ERROR         TO TRUE                            27660000
277000         MOVE SQLCODE            TO PV-DISP-SQLCODE               27670000
277100         MOVE WST00002-PO-NBR    TO PV-DISP-PO-NBR                27680000
277200         MOVE WST00002-RCVR-SEQ-NBR TO PV-DISP-RCVR-SEQ-NBR       27690000
277300         MOVE WST00002-PREPK-ID   TO PV-DISP-PREPK-ID             27700000
277400         MOVE WST00002-PO-LNE-NBR TO PV-DISP-PO-LINE-NBR          27710000
277500         STRING ' ' WS003-SRC-TASK-NUMBER                         27720000
277600                ' WSKUP301-2820: FETCH-ASN-DTL-CSR'               27730000
277700                ' CALLED BY-'                                     27740000
277800                 WS003-CALLING-PROGRAM-NAME                       27750000
277900                ' SQLCODE='                                       27760000
278000                 PV-DISP-SQLCODE                                  27770000
278100                ' SUCC='                                          27780000
278200                 WS003-SUCCESS-IND                                27790000
278300                 ' PO='                                           27800000
278400                 PV-DISP-PO-NBR                                   27810000
278500                 ' RCVR='                                         27820000
278600                 PV-DISP-RCVR-SEQ-NBR                             27830000
278700                ' PRPK='                                          27840000
278800                 PV-DISP-PREPK-ID                                 27850000
278900                 ' LNE='                                          27860000
279000                 PV-DISP-PO-LINE-NBR                              27870000
279100         DELIMITED BY SIZE                                        27880000
279200         INTO PV-MSG-AREA                                         27890000
279300         PERFORM 9200-WRITE-TO-LOG                                27900000
281000         PERFORM 9999-ABEND                                       28070000
281100     END-EVALUATE.                                                28080000
281200                                                                  28090000
281300     IF PS-WRITE-TO-LOG-YES                                       28100000
281400      AND SQLCODE = 0                                             28110000
281500        STRING   ' ' WS003-SRC-TASK-NUMBER                        28120000
281600                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    28130000
281700                 ' WSKUP301-2820: FETCH-ASN-DTL-CSR '             28140000
281800         DELIMITED BY SIZE                                        28150000
281900         INTO PV-MSG-AREA                                         28160000
282000         PERFORM 9200-WRITE-TO-LOG                                28170000
282100         MOVE XLT00003-SKU-NBR  TO PV-DISP-SKU                    28180000
282200         STRING   ' ' WS003-SRC-TASK-NUMBER                       28190000
282300                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   28200000
282400                  ' SKU NBR : '                                   28210000
282500                  PV-DISP-SKU                                     28220000
282600         DELIMITED BY SIZE                                        28230000
282700         INTO PV-MSG-AREA                                         28240000
282800         PERFORM 9200-WRITE-TO-LOG                                28250000
282900     END-IF.                                                      28260000
283000                                                                  28270000
283100******************************************************************28280000
283200* CLOSE ASN_DTL_CSR       SKU_LEVEL                              *28290000
283300******************************************************************28300000
283400 2830-CLOSE-ASN-DTL-CSR.                                          28310000
283500                                                                  28320000
283600     EXEC SQL                                                     28330000
283700          CLOSE ASN_DTL_CSR                                       28340000
283800     END-EXEC                                                     28350000
283900                                                                  28360000
284000     EVALUATE TRUE                                                28370000
284100         WHEN SQLCODE = ZERO                                      28380000
284200              CONTINUE                                            28390000
284300         WHEN SQLWARN0 NOT = SPACES                               28400000
284400         WHEN SQLCODE NOT = ZERO                                  28410000
284500         SET  PS-ERROR         TO TRUE                            28420000
284600         MOVE SQLCODE            TO PV-DISP-SQLCODE               28430000
284700         STRING ' ' WS003-SRC-TASK-NUMBER                         28440000
284800                ' WSKUP301-2830: CLOSE-ASN-DTL-CSR'               28450000
284900                ' CALLED BY-'                                     28460000
285000                 WS003-CALLING-PROGRAM-NAME                       28470000
285100                ' SQLCODE='                                       28480000
285200                 PV-DISP-SQLCODE                                  28490000
285300                ' SUCC='                                          28500000
285400                 WS003-SUCCESS-IND                                28510000
285500         DELIMITED BY SIZE                                        28520000
285600         INTO PV-MSG-AREA                                         28530000
285700         PERFORM 9200-WRITE-TO-LOG                                28540000
287400         PERFORM 9999-ABEND                                       28710000
287500     END-EVALUATE.                                                28720000
287600                                                                  28730000
287700******************************************************************28740000
287800*                                                                *28750000
287900******************************************************************28760000
288000 3000-CREATE-ASN-DTLS.                                            28770000
288100                                                                  28780000
288200     PERFORM 3005-LOAD-ASN-DTL-REC.                               28790000
288300                                                                  28800000
288400     PERFORM 3010-LOAD-ASN-DTL-REC-TO-TEMP.                       28810000
288500                                                                  28820000
288600     EXEC SQL                                                     28830000
288700          INSERT INTO WST_ASN_DWNLD                               28840000
288800               (  EXT_SHP_ID                                      28850000
288900                , CRE_TMST                                        28860000
289000                , ROW_NBR                                         28870000
289100                , REC_TYP_GP_NBR                                  28880000
289200                , REC_TYP_CDE                                     28890000
289300                , CSE_DTL_NBR                                     28900000
289400                , REC_TYP_DESC                                    28910000
289500               )                                                  28920000
289600             VALUES                                               28930000
289700               ( :WST00011-EXT-SHP-ID                             28940000
289800                ,:WST00011-CRE-TMST                               28950000
289900                ,:WST00011-ROW-NBR                                28960000
290000                ,:WST00011-REC-TYP-GP-NBR                         28970000
290100                ,:WST00011-REC-TYP-CDE                            28980000
290200                ,:WST00011-CSE-DTL-NBR                            28990000
290300                ,:WST00011-REC-TYP-DESC                           29000000
290400               )                                                  29010000
290500     END-EXEC                                                     29020000
290600                                                                  29030000
290700     IF PS-WRITE-TO-LOG-YES                                       29040000
290800      AND SQLCODE = 0                                             29050000
290900        MOVE WST00011-ROW-NBR        TO  PV-DISP-ROW-NBR          29060000
291000        MOVE WST00011-REC-TYP-GP-NBR TO  PV-DISP-REC-TYP-GP-NBR   29070000
291100        MOVE WST00011-CSE-DTL-NBR    TO  PV-DISP-CSE-DTL-NBR      29080000
291200        STRING   ' ' WS003-SRC-TASK-NUMBER                        29090000
291300                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    29100000
291400                 ' WSKUP301-3000: CREATE-ASN-DTLS '               29110000
291500        DELIMITED BY SIZE                                         29120000
291600        INTO PV-MSG-AREA                                          29130000
291700        PERFORM 9200-WRITE-TO-LOG                                 29140000
291800        STRING   ' ' WS003-SRC-TASK-NUMBER                        29150000
291900               ' ' PV-DISP-EXT-SHP-ID (1:10)                      29160000
292000               ' # REC TYP CDE    : '                             29170000
292100               WST00011-REC-TYP-CDE                               29180000
292200               ' # ROW NBR        : '                             29190000
292300               PV-DISP-ROW-NBR                                    29200000
292400        DELIMITED BY SIZE                                         29210000
292500        INTO PV-MSG-AREA                                          29220000
292600        PERFORM 9200-WRITE-TO-LOG                                 29230000
292700        STRING ' ' WS003-SRC-TASK-NUMBER                          29240000
292800               ' ' PV-DISP-EXT-SHP-ID (1:10)                      29250000
292900               ' # REC TYP GP NBR : '                             29260000
293000               PV-DISP-REC-TYP-GP-NBR                             29270000
293100               ' # CSE DTL NBR    : '                             29280000
293200               PV-DISP-CSE-DTL-NBR                                29290000
293300        DELIMITED BY SIZE                                         29300000
293400        INTO PV-MSG-AREA                                          29310000
293500        PERFORM 9200-WRITE-TO-LOG                                 29320000
293600     END-IF.                                                      29330000
293700                                                                  29340000
293800     EVALUATE TRUE                                                29350000
293900         WHEN SQLCODE = ZERO                                      29360000
294000              PERFORM 7500-DAT-CNTL-TBLS                          29370000
294100              ADD 1 TO PV-ROW-COUNTER                             29380000
294200                       PV-GROUP-COUNTER                           29390000
294300         WHEN SQLWARN0 NOT = SPACES                               29400000
294400         WHEN SQLCODE NOT = ZERO                                  29410000
294500         SET  PS-ERROR         TO TRUE                            29420000
294600         MOVE SQLCODE            TO PV-DISP-SQLCODE               29430000
294700         STRING ' ' WS003-SRC-TASK-NUMBER                         29440000
294800                ' WSKUP301-3000: CREATE-ASN-DTLS'                 29450000
294900                ' CALLED BY-'                                     29460000
295000                 WS003-CALLING-PROGRAM-NAME                       29470000
295100                ' SQLCODE='                                       29480000
295200                 PV-DISP-SQLCODE                                  29490000
295300                ' SUCC='                                          29500000
295400                 WS003-SUCCESS-IND                                29510000
295500         DELIMITED BY SIZE                                        29520000
295600         INTO PV-MSG-AREA                                         29530000
295700         PERFORM 9200-WRITE-TO-LOG                                29540000
297400         PERFORM 9999-ABEND                                       29710000
297500     END-EVALUATE.                                                29720000
297600                                                                  29730000
297700******************************************************************29740000
297800* MOVES TO CREATE ASN DETAIL REC.                                *29750000
297900******************************************************************29760000
298000 3005-LOAD-ASN-DTL-REC.                                           29770000
298100                                                                  29780000
298200     INITIALIZE WS005-ASN-DTL-REC.                                29790000
298300     MOVE 'WSRD005 '  TO PV-TEMP-COPYBOOK-NAME.                   29800000
298400                                                                  29810000
298500     SET WS005-AD-ADD         TO TRUE.                            29820000
298600     SET WS005-AD-ASN-DTL     TO TRUE.                            29830000
298700     MOVE WST00001-CRE-USR-ID TO WS005-AD-CREATE-USERID.          29840000
298800     MOVE WST00001-CRE-TMST   TO WS005-AD-CREATE-TMST.            29850000
298900     MOVE DK-EXT-SHP-ID       TO WS005-AD-SHIPMT-NBR.             29860000
299000     MOVE XLT00003-SKU-NBR    TO WS005-AD-SKU-ID.                 29870000
299100     MOVE XLT00003-SKU-NBR    TO WS005-AD-SKU-NBR.                29880000
299200     PERFORM 3015-GET-ITM-QTYS.                                   29890000
299300                                                                  29900000
299400     IF RECITM-DTL-CK-ITM-QTY > 0                                 29910000
299500        MOVE RECITM-DTL-CK-ITM-QTY  TO WS005-AD-UNITS-SHIPPED     29920000
299600     ELSE                                                         29930000
299700        MOVE RECITM-PKSL-ITM-QTY    TO WS005-AD-UNITS-SHIPPED     29940000
299800     END-IF.                                                      29950000
299900                                                                  29960000
300000     SET WS005-CHECK-IMMED-NEEDS TO TRUE.                         29970000
300100                                                                  29980000
300200     MOVE WST00002-PO-NBR           TO WS005-AD-PO-NBR.           29990000
300300     MOVE WST00002-PO-LNE-NBR       TO WS005-AD-PO-LINE-NBR.      30000000
300400                                                                  30010000
300500     MOVE DK-TRIP-ID                TO WS005-AD-TRIP-ID.          30020000
300600                                                                  30030000
300700     MOVE WST00002-RCVR-SEQ-NBR     TO WS005-AD-RCVR-SEQ-NBR.     30040000
300800                                                                  30050000
300900     PERFORM 7820-GET-VENDOR-ID.                                  30060000
301000     MOVE PURCHS-ENT-ID             TO WS005-AD-VENDOR-ID.        30070000
301100     SET  WS005-AD-ADD-CDE          TO TRUE.                      30080000
301200     MOVE PV-HOST-INPUT-ID          TO WS005-AD-HOST-INPT-ID.     30090000
301300     MOVE PV-OPER-UNT-ID-PIC9       TO WS005-AD-WHSE.             30100000
301400     SET WS005-AD-VENDOR-SHIPMT     TO TRUE.                      30110000
301500                                                                  30120000
301600******************************************************************30130000
301700* MOVES TO LOAD THE FIELDS TO PREP FOR AN INSERT                 *30140000
301800******************************************************************30150000
301900 3010-LOAD-ASN-DTL-REC-TO-TEMP.                                   30160000
302000                                                                  30170000
302100     INITIALIZE DCLWST00011.                                      30180000
302200                                                                  30190000
302300     MOVE DK-EXT-SHP-ID             TO WST00011-EXT-SHP-ID.       30200000
302400     MOVE PV-CURRENT-TMST           TO WST00011-CRE-TMST.         30210000
302500     MOVE PV-ROW-COUNTER            TO WST00011-ROW-NBR.          30220000
302600     MOVE PV-GROUP-COUNTER          TO WST00011-REC-TYP-GP-NBR.   30230000
302700     MOVE PC-AD                     TO WST00011-REC-TYP-CDE.      30240000
302800     MOVE PC-TEMP-TBL-DESC-LENGTH   TO WST00011-REC-TYP-DESC-LEN. 30250000
302900     MOVE WS005-ASN-DTL-REC         TO WST00011-REC-TYP-DESC-TEXT.30260000
303000     MOVE PC-HIGH-NINES             TO WST00011-CSE-DTL-NBR.      30270000
303100                                                                  30280000
303200******************************************************************30290000
303300*                                                                *30300000
303400******************************************************************30310000
303500 3015-GET-ITM-QTYS.                                               30320000
303600                                                                  30330000
303700     EXEC SQL                                                     30340000
303800          SELECT PKSL_ITM_QTY                                     30350000
303900               , DTL_CK_ITM_QTY                                   30360000
304000          INTO  :RECITM-PKSL-ITM-QTY                              30370000
304100               ,:RECITM-DTL-CK-ITM-QTY                            30380000
304200          FROM TRECITM                                            30390000
304300          WHERE ORD_NBR        = :WST00002-PO-NBR                 30400000
304400          AND   ORD_LNE_NBR    = :WST00002-PO-LNE-NBR             30410000
304500          AND   REC_SEQ_NBR    = :WST00002-RCVR-SEQ-NBR           30420000
304600     END-EXEC                                                     30430000
304700                                                                  30440000
304800     EVALUATE TRUE                                                30450000
304900         WHEN SQLCODE = ZERO                                      30460000
305000         WHEN SQLCODE = +100                                      30470000
305100              CONTINUE                                            30480000
305200         WHEN SQLWARN0 NOT = SPACES                               30490000
305300         WHEN SQLCODE NOT = ZERO                                  30500000
305400         WHEN SQLCODE NOT = +100                                  30510000
305500         SET  PS-ERROR         TO TRUE                            30520000
305600         MOVE SQLCODE            TO PV-DISP-SQLCODE               30530000
305700         STRING ' ' WS003-SRC-TASK-NUMBER                         30540000
305800                ' WSKUP301-3015: GET-ITM-QTYS'                    30550000
305900                ' CALLED BY-'                                     30560000
306000                 WS003-CALLING-PROGRAM-NAME                       30570000
306100                ' SQLCODE='                                       30580000
306200                 PV-DISP-SQLCODE                                  30590000
306300                ' SUCC='                                          30600000
306400                 WS003-SUCCESS-IND                                30610000
306500         DELIMITED BY SIZE                                        30620000
306600         INTO PV-MSG-AREA                                         30630000
306700         PERFORM 9200-WRITE-TO-LOG                                30640000
308400         PERFORM 9999-ABEND                                       30810000
308500     END-EVALUATE.                                                30820000
308600                                                                  30830000
308700******************************************************************30840000
308800*                                                                *30850000
308900******************************************************************30860000
309000 3200-CASE-LVL-PROCESSING.                                        30870000
309100                                                                  30880000
309200     PERFORM 3210-OPEN-CS-DTL-CSR.                                30890000
309300                                                                  30900000
309400     MOVE +0 TO PV-HOLD-CS-LVL-PREPK-ID                           30910000
309500                PV-HOLD-CS-LVL-PO-NBR                             30920000
309600                PV-HOLD-CS-LVL-REC-SEQ-NBR.                       30930000
309700                                                                  30940000
309800     SET PS-END-OF-CS-DTL-CSR-NO TO TRUE.                         30950000
309900     PERFORM 3220-FETCH-CS-DTL-CSR                                30960000
310000       UNTIL PS-END-OF-CS-DTL-CSR-YES.                            30970000
310100                                                                  30980000
310200     PERFORM 3230-CLOSE-CS-DTL-CSR.                               30990000
310300                                                                  31000000
310400******************************************************************31010000
310500* OPEN CS_DTL_CSR                                                *31020000
310600******************************************************************31030000
310700 3210-OPEN-CS-DTL-CSR.                                            31040000
310800                                                                  31050000
310900     EXEC SQL                                                     31060000
311000          OPEN CS_DTL_CSR                                         31070000
311100     END-EXEC                                                     31080000
311200                                                                  31090000
311300     EVALUATE TRUE                                                31100000
311400         WHEN SQLCODE = ZERO                                      31110000
311500              CONTINUE                                            31120000
311600         WHEN SQLWARN0 NOT = SPACES                               31130000
311700         WHEN SQLCODE NOT = ZERO                                  31140000
311800         SET  PS-ERROR         TO TRUE                            31150000
311900         MOVE SQLCODE            TO PV-DISP-SQLCODE               31160000
312000         STRING ' ' WS003-SRC-TASK-NUMBER                         31170000
312100                ' WSKUP301-3210: OPEN-CS-DTL-CSR'                 31180000
312200                ' CALLED BY-'                                     31190000
312300                 WS003-CALLING-PROGRAM-NAME                       31200000
312400                ' SQLCODE='                                       31210000
312500                 PV-DISP-SQLCODE                                  31220000
312600                ' SUCC='                                          31230000
312700                 WS003-SUCCESS-IND                                31240000
312800         DELIMITED BY SIZE                                        31250000
312900         INTO PV-MSG-AREA                                         31260000
313000         PERFORM 9200-WRITE-TO-LOG                                31270000
314700         PERFORM 9999-ABEND                                       31440000
314800     END-EVALUATE.                                                31450000
314900                                                                  31460000
315000******************************************************************31470000
315100* FETCH  CS_DTL_CSR                                              *31480000
315200******************************************************************31490000
315300 3220-FETCH-CS-DTL-CSR.                                           31500000
315400                                                                  31510000
315500     EXEC SQL                                                     31520000
315600          FETCH CS_DTL_CSR                                        31530000
315700          INTO                                                    31540000
315800                :WST00002-PO-NBR                                  31550000
315900               ,:WST00002-PO-LNE-NBR                              31560000
316000               ,:WST00002-RCVR-SEQ-NBR                            31570000
316100               ,:WST00002-ASN-LVL-CDE                             31580000
316200               ,:WST00002-PREPK-ID                                31590000
316300               ,:WST00002-CRE-USR-ID                              31600000
316400               ,:WST00002-CRE-TMST                                31610000
316500               ,:WST00002-DWNLD-CDE                               31620000
316600               ,:WST00002-ACTV-CDE                                31630000
316700     END-EXEC                                                     31640000
316800                                                                  31650000
316900     EVALUATE TRUE                                                31660000
317000         WHEN SQLCODE = ZERO                                      31670000
317100              PERFORM 3400-PROCESS-CS-LVL-ASNS                    31680000
317200         WHEN SQLCODE = +100                                      31690000
317300             SET PS-END-OF-CS-DTL-CSR-YES TO TRUE                 31700000
317400         WHEN SQLWARN0 NOT = SPACES                               31710000
317500         WHEN SQLCODE NOT = ZERO                                  31720000
317600         WHEN SQLCODE NOT = +100                                  31730000
317700         SET  PS-ERROR         TO TRUE                            31740000
317800         MOVE SQLCODE            TO PV-DISP-SQLCODE               31750000
317900         MOVE WST00002-PO-NBR    TO PV-DISP-PO-NBR                31760000
318000         MOVE WST00002-RCVR-SEQ-NBR TO PV-DISP-RCVR-SEQ-NBR       31770000
318100         MOVE WST00002-PREPK-ID   TO PV-DISP-PREPK-ID             31780000
318200         MOVE WST00002-PO-LNE-NBR TO PV-DISP-PO-LINE-NBR          31790000
318300         STRING ' ' WS003-SRC-TASK-NUMBER                         31800000
318400                ' WSKUP301-3220: FETCH-CS-DTL-CSR'                31810000
318500                ' CALLED BY-'                                     31820000
318600                 WS003-CALLING-PROGRAM-NAME                       31830000
318700                ' SQLCODE='                                       31840000
318800                 PV-DISP-SQLCODE                                  31850000
318900                ' SUCC='                                          31860000
319000                 WS003-SUCCESS-IND                                31870000
319100                 ' PO='                                           31880000
319200                 PV-DISP-PO-NBR                                   31890000
319300                 ' RCVR='                                         31900000
319400                 PV-DISP-RCVR-SEQ-NBR                             31910000
319500                 ' PRPK='                                         31920000
319600                 PV-DISP-PREPK-ID                                 31930000
319700                 ' LNE='                                          31940000
319800                 PV-DISP-PO-LINE-NBR                              31950000
319900         DELIMITED BY SIZE                                        31960000
320000         INTO PV-MSG-AREA                                         31970000
320100         PERFORM 9200-WRITE-TO-LOG                                31980000
321800         PERFORM 9999-ABEND                                       32150000
321900     END-EVALUATE.                                                32160000
322000                                                                  32170000
322100     IF PS-WRITE-TO-LOG-YES                                       32180000
322200      AND SQLCODE = 0                                             32190000
322300         STRING   ' ' WS003-SRC-TASK-NUMBER                       32200000
322400                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   32210000
322500                  ' WSKUP301-3220: FETCH-CS-DTL-CSR'              32220000
322600         DELIMITED BY SIZE                                        32230000
322700         INTO PV-MSG-AREA                                         32240000
322800         PERFORM 9200-WRITE-TO-LOG                                32250000
322900         MOVE WST00002-PO-NBR    TO PV-DISP-PO-NBR                32260000
323000         MOVE WST00002-RCVR-SEQ-NBR TO PV-DISP-RCVR-SEQ-NBR       32270000
323100         MOVE WST00002-PREPK-ID   TO PV-DISP-PREPK-ID             32280000
323200         MOVE WST00002-PO-LNE-NBR TO PV-DISP-PO-LINE-NBR          32290000
323300         STRING   ' ' WS003-SRC-TASK-NUMBER                       32300000
323400                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   32310000
323500                  ' PO NBR: '                                     32320000
323600                  PV-DISP-PO-NBR                                  32330000
323700                  ' RCVR NBR: '                                   32340000
323800                  PV-DISP-RCVR-SEQ-NBR                            32350000
323900                  'PREPACK ID: '                                  32360000
324000                  PV-DISP-PREPK-ID                                32370000
324100                  'PO LINE: '                                     32380000
324200                  PV-DISP-PO-LINE-NBR                             32390000
324300         DELIMITED BY SIZE                                        32400000
324400         INTO PV-MSG-AREA                                         32410000
324500         PERFORM 9200-WRITE-TO-LOG                                32420000
324600     END-IF.                                                      32430000
324700                                                                  32440000
324800******************************************************************32450000
324900* CLOSE CS_DTL_CSR                                               *32460000
325000******************************************************************32470000
325100 3230-CLOSE-CS-DTL-CSR.                                           32480000
325200                                                                  32490000
325300     EXEC SQL                                                     32500000
325400          CLOSE CS_DTL_CSR                                        32510000
325500     END-EXEC                                                     32520000
325600                                                                  32530000
325700     EVALUATE TRUE                                                32540000
325800         WHEN SQLCODE = ZERO                                      32550000
325900              CONTINUE                                            32560000
326000         WHEN SQLWARN0 NOT = SPACES                               32570000
326100         WHEN SQLCODE NOT = ZERO                                  32580000
326200         SET  PS-ERROR         TO TRUE                            32590000
326300         MOVE SQLCODE            TO PV-DISP-SQLCODE               32600000
326400         STRING ' ' WS003-SRC-TASK-NUMBER                         32610000
326500                ' WSKUP301-3230: FETCH-CS-DTL-CSR'                32620000
326600                ' CALLED BY-'                                     32630000
326700                 WS003-CALLING-PROGRAM-NAME                       32640000
326800                ' SQLCODE='                                       32650000
326900                 PV-DISP-SQLCODE                                  32660000
327000                ' SUCC='                                          32670000
327100                 WS003-SUCCESS-IND                                32680000
327200         DELIMITED BY SIZE                                        32690000
327300         INTO PV-MSG-AREA                                         32700000
327400         PERFORM 9200-WRITE-TO-LOG                                32710000
329100         PERFORM 9999-ABEND                                       32880000
329200     END-EVALUATE.                                                32890000
329300                                                                  32900000
329400******************************************************************32910000
329500* PROCESS CASE LEVEL ASNS                                        *32920000
329600* 3600-, 5000- & 5500- EACH EXEC A MAIN CURSOR - FROM EACH FETCH,*32930000
329700* THE CASE LEVEL RECORD CREATION PROCESS IS THE SAME:            *32940000
329800* SEE 8A - 8C IN PGM DOC ABOVE...                                *32950000
329900*        6650-MULTIPLE-SKU-CHECK                                 *32960000
330000*        6000-CARTON-CONTENT-DTLS                                *32970000
330100*            6120-FETCH-CTN-CNTNT-CSR                            *32980000
330200*               WHEN SQLCODE = 0                                 *32990000
330300*                  PERFORM:                                      *33000000
330400*                    6200-CREATE-CS-LVL-DTL                      *33010000
330500*                    (CS DTL FOR ASN_DWNLD)                      *33020000
330600*               WHEN SQLCODE = 100                               *33030000
330700*                  PERFORM:                                      *33040000
330800*                    6600-CREATE-CS-LVL-HDR                      *33050000
330900*                    (CS HDR FOR ASN_DWNLD)                      *33060000
331000******************************************************************33070000
331100 3400-PROCESS-CS-LVL-ASNS.                                        33080000
331200                                                                  33090000
331300     IF WST00002-PO-NBR = PV-HOLD-CS-LVL-PO-NBR                   33100000
331400        IF WST00002-RCVR-SEQ-NBR = PV-HOLD-CS-LVL-REC-SEQ-NBR     33110000
331500           IF PS-PACK-BY-STORE-YES                                33120000
331600              CONTINUE                                            33130000
331700           ELSE                                                   33140000
331800              IF WST00002-PREPK-ID > 0                            33150000
331900                 IF WST00002-PREPK-ID = PV-HOLD-CS-LVL-PREPK-ID   33160000
332000                    CONTINUE                                      33170000
332100                 ELSE                                             33180000
332200                    PERFORM 3600-GET-PREPACK-CASES                33190000
332300                    MOVE WST00002-PREPK-ID                        33200000
332400                             TO PV-HOLD-CS-LVL-PREPK-ID           33210000
332500                 END-IF                                           33220000
332600              ELSE                                                33230000
332700                 PERFORM 5000-GET-LN-LVL-CASES                    33240000
332800              END-IF                                              33250000
332900           END-IF                                                 33260000
333000        ELSE                                                      33270000
333100           PERFORM 3450-DETERMINE-PBS                             33280000
333200           IF PS-PACK-BY-STORE-YES                                33290000
333300              PERFORM 5500-GET-PBS-CASES                          33300000
333400           END-IF                                                 33310000
333500           MOVE WST00002-RCVR-SEQ-NBR                             33320000
333600                   TO PV-HOLD-CS-LVL-REC-SEQ-NBR                  33330000
333700           MOVE +0 TO PV-HOLD-CS-LVL-PREPK-ID                     33340000
333800        END-IF                                                    33350000
333900     ELSE                                                         33360000
334000        PERFORM 3450-DETERMINE-PBS                                33370000
334100        IF PS-PACK-BY-STORE-YES                                   33380000
334200           PERFORM 5500-GET-PBS-CASES                             33390000
334300        ELSE                                                      33400000
334400           IF WST00002-PREPK-ID > 0                               33410000
334500             PERFORM 3600-GET-PREPACK-CASES                       33420000
334600             MOVE WST00002-PREPK-ID                               33430000
334700                TO PV-HOLD-CS-LVL-PREPK-ID                        33440000
334800           ELSE                                                   33450000
334900             PERFORM 5000-GET-LN-LVL-CASES                        33460000
335000           END-IF                                                 33470000
335100        END-IF                                                    33480000
335200        MOVE WST00002-PO-NBR       TO PV-HOLD-CS-LVL-PO-NBR       33490000
335300        MOVE WST00002-RCVR-SEQ-NBR TO PV-HOLD-CS-LVL-REC-SEQ-NBR  33500000
335400        MOVE WST00002-PREPK-ID     TO PV-HOLD-CS-LVL-PREPK-ID     33510000
335500     END-IF.                                                      33520000
335600                                                                  33530000
335700******************************************************************33540000
335800*                                                                *33550000
335900******************************************************************33560000
336000 3450-DETERMINE-PBS.                                              33570000
336100                                                                  33580000
336200     SET PS-PACK-BY-STORE-NO TO TRUE.                             33590000
336300                                                                  33600000
336400     EXEC SQL                                                     33610000
336500          SELECT PACK_BY_ST_IND                                   33620000
336600          INTO  :RECEIV-PACK-BY-ST-IND                            33630000
336700          FROM TRECEIV                                            33640000
336800          WHERE ORD_NBR        = :WST00002-PO-NBR                 33650000
336900          AND   REC_SEQ_NBR    = :WST00002-RCVR-SEQ-NBR           33660000
337000     END-EXEC                                                     33670000
337100                                                                  33680000
337200     EVALUATE TRUE                                                33690000
337300         WHEN SQLCODE = ZERO                                      33700000
337400              IF RECEIV-PACK-BY-ST-IND = PC-Y                     33710000
337500                 SET PS-PACK-BY-STORE-YES TO TRUE                 33720000
337600              END-IF                                              33730000
337700         WHEN SQLCODE = +100                                      33740000
337800              CONTINUE                                            33750000
337900         WHEN SQLWARN0 NOT = SPACES                               33760000
338000         WHEN SQLCODE NOT = ZERO                                  33770000
338100         WHEN SQLCODE NOT = +100                                  33780000
338200            SET  PS-ERROR         TO TRUE                         33790000
338300            MOVE SQLCODE            TO PV-DISP-SQLCODE            33800000
338400            STRING ' ' WS003-SRC-TASK-NUMBER                      33810000
338500                   ' WSKUP301-3450: DETERMINE-PBS'                33820000
338600                   ' CALLED BY-'                                  33830000
338700                    WS003-CALLING-PROGRAM-NAME                    33840000
338800                   ' SQLCODE='                                    33850000
338900                    PV-DISP-SQLCODE                               33860000
339000                   ' SUCC='                                       33870000
339100                    WS003-SUCCESS-IND                             33880000
339200            DELIMITED BY SIZE                                     33890000
339300            INTO PV-MSG-AREA                                      33900000
339400            PERFORM 9200-WRITE-TO-LOG                             33910000
341100            PERFORM 9999-ABEND                                    34080000
341200     END-EVALUATE.                                                34090000
341300                                                                  34100000
341400******************************************************************34110000
341500* GET PREPACK CASES                                              *34120000
341600******************************************************************34130000
341700 3600-GET-PREPACK-CASES.                                          34140000
341800                                                                  34150000
341900     PERFORM 3810-OPEN-CARTON-PK-CSR.                             34160000
342000                                                                  34170000
342100     SET PS-END-OF-CARTON-PK-CSR-NO TO TRUE.                      34180000
342200     PERFORM 3820-FETCH-CARTON-PK-CSR                             34190000
342300       UNTIL PS-END-OF-CARTON-PK-CSR-YES.                         34200000
342400                                                                  34210000
342500     PERFORM 3830-CLOSE-CARTON-PK-CSR.                            34220000
342600                                                                  34230000
342700******************************************************************34240000
342800* OPEN CARTON_PK_CSR                                             *34250000
342900******************************************************************34260000
343000 3810-OPEN-CARTON-PK-CSR.                                         34270000
343100                                                                  34280000
343200     EXEC SQL                                                     34290000
343300          OPEN CARTON_PK_CSR                                      34300000
343400     END-EXEC                                                     34310000
343500                                                                  34320000
343600     EVALUATE TRUE                                                34330000
343700         WHEN SQLCODE = ZERO                                      34340000
343800              CONTINUE                                            34350000
343900         WHEN SQLWARN0 NOT = SPACES                               34360000
344000         WHEN SQLCODE NOT = ZERO                                  34370000
344100         SET  PS-ERROR         TO TRUE                            34380000
344200         MOVE SQLCODE            TO PV-DISP-SQLCODE               34390000
344300         STRING ' ' WS003-SRC-TASK-NUMBER                         34400000
344400                ' WSKUP301-3810: OPEN-CARTON-PK-CSR'              34410000
344500                ' CALLED BY-'                                     34420000
344600                 WS003-CALLING-PROGRAM-NAME                       34430000
344700                ' SQLCODE='                                       34440000
344800                 PV-DISP-SQLCODE                                  34450000
344900                ' SUCC='                                          34460000
345000                 WS003-SUCCESS-IND                                34470000
345100         DELIMITED BY SIZE                                        34480000
345200         INTO PV-MSG-AREA                                         34490000
345300         PERFORM 9200-WRITE-TO-LOG                                34500000
347000         PERFORM 9999-ABEND                                       34670000
347100     END-EVALUATE.                                                34680000
347200                                                                  34690000
347300******************************************************************34700000
347400* FETCH  CARTON_PK_CSR                                           *34710000
347500******************************************************************34720000
347600 3820-FETCH-CARTON-PK-CSR.                                        34730000
347700                                                                  34740000
347800     EXEC SQL                                                     34750000
347900          FETCH CARTON_PK_CSR                                     34760000
348000          INTO  :PV-UNION-TYPE                                    34770000
348100               ,:SHPUNT-SHIPT-UNT-ID                              34780000
348200     END-EXEC                                                     34790000
348300                                                                  34800000
348400     EVALUATE TRUE                                                34810000
348500         WHEN SQLCODE = ZERO                                      34820000
348600              PERFORM 6650-MULTIPLE-SKU-CHECK                     34830000
348700              PERFORM 6000-CARTON-CONTENT-DTLS                    34840000
348800         WHEN SQLCODE = +100                                      34850000
348900             SET PS-END-OF-CARTON-PK-CSR-YES TO TRUE              34860000
349000         WHEN SQLWARN0 NOT = SPACES                               34870000
349100         WHEN SQLCODE NOT = ZERO                                  34880000
349200         WHEN SQLCODE NOT = +100                                  34890000
349300         SET  PS-ERROR         TO TRUE                            34900000
349400         MOVE SQLCODE            TO PV-DISP-SQLCODE               34910000
349500         STRING ' ' WS003-SRC-TASK-NUMBER                         34920000
349600                ' WSKUP301-3820: FETCH-CARTON-PK-CSR'             34930000
349700                ' CALLED BY-'                                     34940000
349800                 WS003-CALLING-PROGRAM-NAME                       34950000
349900                ' SQLCODE='                                       34960000
350000                 PV-DISP-SQLCODE                                  34970000
350100                ' SUCC='                                          34980000
350200                 WS003-SUCCESS-IND                                34990000
350300         DELIMITED BY SIZE                                        35000000
350400         INTO PV-MSG-AREA                                         35010000
350500         PERFORM 9200-WRITE-TO-LOG                                35020000
352200         PERFORM 9999-ABEND                                       35190000
352300     END-EVALUATE.                                                35200000
352400                                                                  35210000
352500     IF PS-WRITE-TO-LOG-YES                                       35220000
352600      AND SQLCODE = 0                                             35230000
352700         STRING   ' ' WS003-SRC-TASK-NUMBER                       35240000
352800                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   35250000
352900                  ' WSKUP301-3280: FETCH-CARTON-PK-CSR'           35260000
353000         DELIMITED BY SIZE                                        35270000
353100         INTO PV-MSG-AREA                                         35280000
353200         PERFORM 9200-WRITE-TO-LOG                                35290000
353300         MOVE SHPUNT-SHIPT-UNT-ID  TO PV-DISP-SHIPT-UNT-ID        35300000
353400         STRING ' ' WS003-SRC-TASK-NUMBER                         35310000
353500                ' SHIP UNT ID: '                                  35320000
353600                PV-DISP-SHIPT-UNT-ID                              35330000
353700         DELIMITED BY SIZE                                        35340000
353800         INTO PV-MSG-AREA                                         35350000
353900         PERFORM 9200-WRITE-TO-LOG                                35360000
354000     END-IF.                                                      35370000
354100                                                                  35380000
354200******************************************************************35390000
354300* CLOSE CARTON_PK_CSR                                            *35400000
354400******************************************************************35410000
354500 3830-CLOSE-CARTON-PK-CSR.                                        35420000
354600                                                                  35430000
354700     EXEC SQL                                                     35440000
354800          CLOSE CARTON_PK_CSR                                     35450000
354900     END-EXEC                                                     35460000
355000                                                                  35470000
355100     EVALUATE TRUE                                                35480000
355200         WHEN SQLCODE = ZERO                                      35490000
355300              CONTINUE                                            35500000
355400         WHEN SQLWARN0 NOT = SPACES                               35510000
355500         WHEN SQLCODE NOT = ZERO                                  35520000
355600         SET  PS-ERROR         TO TRUE                            35530000
355700         MOVE SQLCODE            TO PV-DISP-SQLCODE               35540000
355800         STRING ' ' WS003-SRC-TASK-NUMBER                         35550000
355900                ' WSKUP301-3830: CLOSE-CARTON-PK-CSR'             35560000
356000               ' CALLED BY-'                                      35570000
356100                 WS003-CALLING-PROGRAM-NAME                       35580000
356200                ' SQLCODE='                                       35590000
356300                 PV-DISP-SQLCODE                                  35600000
356400                ' SUCC='                                          35610000
356500                 WS003-SUCCESS-IND                                35620000
356600         DELIMITED BY SIZE                                        35630000
356700         INTO PV-MSG-AREA                                         35640000
356800         PERFORM 9200-WRITE-TO-LOG                                35650000
358500         PERFORM 9999-ABEND                                       35820000
358600     END-EVALUATE.                                                35830000
358700                                                                  35840000
358800******************************************************************35850000
358900* GET LINE LEVEL CASES                                           *35860000
359000******************************************************************35870000
359100 5000-GET-LN-LVL-CASES.                                           35880000
359200                                                                  35890000
359300     PERFORM 5010-OPEN-CARTON-CSR.                                35900000
359400                                                                  35910000
359500     SET PS-END-OF-CARTON-CSR-NO TO TRUE.                         35920000
359600     PERFORM 5020-FETCH-CARTON-CSR                                35930000
359700       UNTIL PS-END-OF-CARTON-CSR-YES.                            35940000
359800                                                                  35950000
359900     PERFORM 5030-CLOSE-CARTON-CSR.                               35960000
360000                                                                  35970000
360100******************************************************************35980000
360200* OPEN CARTON_CSR                                                *35990000
360300******************************************************************36000000
360400 5010-OPEN-CARTON-CSR.                                            36010000
360500                                                                  36020000
360600     EXEC SQL                                                     36030000
360700          OPEN CARTON_CSR                                         36040000
360800     END-EXEC                                                     36050000
360900                                                                  36060000
361000     EVALUATE TRUE                                                36070000
361100         WHEN SQLCODE = ZERO                                      36080000
361200              CONTINUE                                            36090000
361300         WHEN SQLWARN0 NOT = SPACES                               36100000
361400         WHEN SQLCODE NOT = ZERO                                  36110000
361500         SET  PS-ERROR         TO TRUE                            36120000
361600         MOVE SQLCODE            TO PV-DISP-SQLCODE               36130000
361700         STRING ' ' WS003-SRC-TASK-NUMBER                         36140000
361800                ' WSKUP301-5010: OPEN-CARTON-CSR'                 36150000
361900                ' CALLED BY-'                                     36160000
362000                 WS003-CALLING-PROGRAM-NAME                       36170000
362100                ' SQLCODE='                                       36180000
362200                 PV-DISP-SQLCODE                                  36190000
362300                ' SUCC='                                          36200000
362400                 WS003-SUCCESS-IND                                36210000
362500         DELIMITED BY SIZE                                        36220000
362600         INTO PV-MSG-AREA                                         36230000
362700         PERFORM 9200-WRITE-TO-LOG                                36240000
364400         PERFORM 9999-ABEND                                       36410000
364500     END-EVALUATE.                                                36420000
364600                                                                  36430000
364700******************************************************************36440000
364800* FETCH  CARTON_CSR                                              *36450000
364900******************************************************************36460000
365000 5020-FETCH-CARTON-CSR.                                           36470000
365100                                                                  36480000
365200     EXEC SQL                                                     36490000
365300          FETCH CARTON_CSR                                        36500000
365400          INTO  :PV-UNION-TYPE                                    36510000
365500               ,:SHPUNT-SHIPT-UNT-ID                              36520000
365600     END-EXEC                                                     36530000
365700                                                                  36540000
365800     EVALUATE TRUE                                                36550000
365900         WHEN SQLCODE = ZERO                                      36560000
366000              PERFORM 6650-MULTIPLE-SKU-CHECK                     36570000
366100              PERFORM 6000-CARTON-CONTENT-DTLS                    36580000
366200         WHEN SQLCODE = +100                                      36590000
366300             SET PS-END-OF-CARTON-CSR-YES TO TRUE                 36600000
366400         WHEN SQLWARN0 NOT = SPACES                               36610000
366500         WHEN SQLCODE NOT = ZERO                                  36620000
366600         WHEN SQLCODE NOT = +100                                  36630000
366700         SET  PS-ERROR         TO TRUE                            36640000
366800         MOVE SQLCODE            TO PV-DISP-SQLCODE               36650000
366900         STRING ' ' WS003-SRC-TASK-NUMBER                         36660000
367000                ' WSKUP301-5020: FETCH-CARTON-CSR'                36670000
367100                ' CALLED BY-'                                     36680000
367200                 WS003-CALLING-PROGRAM-NAME                       36690000
367300                ' SQLCODE='                                       36700000
367400                 PV-DISP-SQLCODE                                  36710000
367500                ' SUCC='                                          36720000
367600                 WS003-SUCCESS-IND                                36730000
367700         DELIMITED BY SIZE                                        36740000
367800         INTO PV-MSG-AREA                                         36750000
367900         PERFORM 9200-WRITE-TO-LOG                                36760000
369600         PERFORM 9999-ABEND                                       36930000
369700     END-EVALUATE.                                                36940000
369800                                                                  36950000
369900     IF PS-WRITE-TO-LOG-YES                                       36960000
370000      AND SQLCODE = 0                                             36970000
370100         STRING ' ' WS003-SRC-TASK-NUMBER                         36980000
370200                ' ' PV-DISP-EXT-SHP-ID (1:10)                     36990000
370300                ' WSKUP301-5020: FETCH-CARTON-DSR'                37000000
370400         DELIMITED BY SIZE                                        37010000
370500         INTO PV-MSG-AREA                                         37020000
370600         PERFORM 9200-WRITE-TO-LOG                                37030000
370700         MOVE SHPUNT-SHIPT-UNT-ID  TO PV-DISP-SHIPT-UNT-ID        37040000
370800         STRING  ' ' WS003-SRC-TASK-NUMBER                        37050000
370900                 ' SHIP UNT ID: '                                 37060000
371000                 PV-DISP-SHIPT-UNT-ID                             37070000
371100         DELIMITED BY SIZE                                        37080000
371200         INTO PV-MSG-AREA                                         37090000
371300         PERFORM 9200-WRITE-TO-LOG                                37100000
371400     END-IF.                                                      37110000
371500                                                                  37120000
371600******************************************************************37130000
371700* CLOSE CARTON_CSR                                               *37140000
371800******************************************************************37150000
371900 5030-CLOSE-CARTON-CSR.                                           37160000
372000                                                                  37170000
372100     EXEC SQL                                                     37180000
372200          CLOSE CARTON_CSR                                        37190000
372300     END-EXEC                                                     37200000
372400                                                                  37210000
372500     EVALUATE TRUE                                                37220000
372600         WHEN SQLCODE = ZERO                                      37230000
372700              CONTINUE                                            37240000
372800         WHEN SQLWARN0 NOT = SPACES                               37250000
372900         WHEN SQLCODE NOT = ZERO                                  37260000
373000         SET  PS-ERROR         TO TRUE                            37270000
373100         MOVE SQLCODE            TO PV-DISP-SQLCODE               37280000
373200         STRING ' ' WS003-SRC-TASK-NUMBER                         37290000
373300                ' WSKUP301-5030: CLOSE-CARTON-CSR'                37300000
373400                ' CALLED BY-'                                     37310000
373500                 WS003-CALLING-PROGRAM-NAME                       37320000
373600                ' SQLCODE='                                       37330000
373700                 PV-DISP-SQLCODE                                  37340000
373800                ' SUCC='                                          37350000
373900                 WS003-SUCCESS-IND                                37360000
374000         DELIMITED BY SIZE                                        37370000
374100         INTO PV-MSG-AREA                                         37380000
374200         PERFORM 9200-WRITE-TO-LOG                                37390000
375900         PERFORM 9999-ABEND                                       37560000
376000     END-EVALUATE.                                                37570000
376100                                                                  37580000
376200******************************************************************37590000
376300* GET PACK BY STORE CASES                                        *37600000
376400******************************************************************37610000
376500 5500-GET-PBS-CASES.                                              37620000
376600                                                                  37630000
376700     PERFORM 5510-OPEN-PBS-CS-CSR.                                37640000
376800                                                                  37650000
376900     SET PS-END-OF-PBS-CS-CSR-NO TO TRUE.                         37660000
377000     PERFORM 5520-FETCH-PBS-CS-CSR                                37670000
377100       UNTIL PS-END-OF-PBS-CS-CSR-YES.                            37680000
377200                                                                  37690000
377300     PERFORM 5530-CLOSE-PBS-CS-CSR.                               37700000
377400                                                                  37710000
377500******************************************************************37720000
377600* OPEN PBS_CS_CSR                                                *37730000
377700******************************************************************37740000
377800 5510-OPEN-PBS-CS-CSR.                                            37750000
377900                                                                  37760000
378000     EXEC SQL                                                     37770000
378100          OPEN PBS_CS_CSR                                         37780000
378200     END-EXEC                                                     37790000
378300                                                                  37800000
378400     EVALUATE TRUE                                                37810000
378500         WHEN SQLCODE = ZERO                                      37820000
378600         WHEN SQLCODE = +100                                      37830000
378700              CONTINUE                                            37840000
378800         WHEN SQLWARN0 NOT = SPACES                               37850000
378900         WHEN SQLCODE NOT = ZERO                                  37860000
379000         WHEN SQLCODE NOT = +100                                  37870000
379100         SET  PS-ERROR         TO TRUE                            37880000
379200         MOVE SQLCODE            TO PV-DISP-SQLCODE               37890000
379300         STRING ' ' WS003-SRC-TASK-NUMBER                         37900000
379400                ' WSKUP301-5510: OPEN-PBS-CS-CSR'                 37910000
379500                ' CALLED BY-'                                     37920000
379600                 WS003-CALLING-PROGRAM-NAME                       37930000
379700                ' SQLCODE='                                       37940000
379800                 PV-DISP-SQLCODE                                  37950000
379900                ' SUCC='                                          37960000
380000                 WS003-SUCCESS-IND                                37970000
380100         DELIMITED BY SIZE                                        37980000
380200         INTO PV-MSG-AREA                                         37990000
380300         PERFORM 9200-WRITE-TO-LOG                                38000000
382000         PERFORM 9999-ABEND                                       38170000
382100     END-EVALUATE.                                                38180000
382200                                                                  38190000
382300******************************************************************38200000
382400* FETCH  PACK BY STORE CSR                                       *38210000
382500******************************************************************38220000
382600 5520-FETCH-PBS-CS-CSR.                                           38230000
382700                                                                  38240000
382800     EXEC SQL                                                     38250000
382900          FETCH PBS_CS_CSR                                        38260000
383000          INTO  :SHPUNT-SHIPT-UNT-ID                              38270000
383100     END-EXEC                                                     38280000
383200                                                                  38290000
383300     EVALUATE TRUE                                                38300000
383400         WHEN SQLCODE = ZERO                                      38310000
383500              PERFORM 6650-MULTIPLE-SKU-CHECK                     38320000
383600              PERFORM 6000-CARTON-CONTENT-DTLS                    38330000
383700         WHEN SQLCODE = +100                                      38340000
383800             SET PS-END-OF-PBS-CS-CSR-YES TO TRUE                 38350000
383900         WHEN SQLWARN0 NOT = SPACES                               38360000
384000         WHEN SQLCODE NOT = ZERO                                  38370000
384100         WHEN SQLCODE NOT = +100                                  38380000
384200         SET  PS-ERROR         TO TRUE                            38390000
384300         MOVE SQLCODE            TO PV-DISP-SQLCODE               38400000
384400         STRING ' ' WS003-SRC-TASK-NUMBER                         38410000
384500                ' WSKUP301-5520: FETCH-PBS-CS-CSR'                38420000
384600                ' CALLED BY-'                                     38430000
384700                 WS003-CALLING-PROGRAM-NAME                       38440000
384800                ' SQLCODE='                                       38450000
384900                 PV-DISP-SQLCODE                                  38460000
385000                ' SUCC='                                          38470000
385100                 WS003-SUCCESS-IND                                38480000
385200         DELIMITED BY SIZE                                        38490000
385300         INTO PV-MSG-AREA                                         38500000
385400         PERFORM 9200-WRITE-TO-LOG                                38510000
387100         PERFORM 9999-ABEND                                       38680000
387200     END-EVALUATE.                                                38690000
387300                                                                  38700000
387400     IF PS-WRITE-TO-LOG-YES                                       38710000
387500      AND SQLCODE = 0                                             38720000
387600         STRING  ' ' WS003-SRC-TASK-NUMBER                        38730000
387700                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    38740000
387800                 ' WSKUP301-5520: FETCH-PBS-CS-CSR'               38750000
387900         DELIMITED BY SIZE                                        38760000
388000         INTO PV-MSG-AREA                                         38770000
388100         PERFORM 9200-WRITE-TO-LOG                                38780000
388200         MOVE SHPUNT-SHIPT-UNT-ID  TO PV-DISP-SHIPT-UNT-ID        38790000
388300         STRING  ' ' WS003-SRC-TASK-NUMBER                        38800000
388400                  ' SHIP UNT ID: '                                38810000
388500                  PV-DISP-SHIPT-UNT-ID                            38820000
388600         DELIMITED BY SIZE                                        38830000
388700         INTO PV-MSG-AREA                                         38840000
388800         PERFORM 9200-WRITE-TO-LOG                                38850000
388900     END-IF.                                                      38860000
389000                                                                  38870000
389100******************************************************************38880000
389200* CLOSE PACK BY STORE CSR                                        *38890000
389300******************************************************************38900000
389400 5530-CLOSE-PBS-CS-CSR.                                           38910000
389500                                                                  38920000
389600     EXEC SQL                                                     38930000
389700          CLOSE PBS_CS_CSR                                        38940000
389800     END-EXEC                                                     38950000
389900                                                                  38960000
390000     EVALUATE TRUE                                                38970000
390100         WHEN SQLCODE = ZERO                                      38980000
390200              CONTINUE                                            38990000
390300         WHEN SQLWARN0 NOT = SPACES                               39000000
390400         WHEN SQLCODE NOT = ZERO                                  39010000
390500         SET  PS-ERROR         TO TRUE                            39020000
390600         MOVE SQLCODE            TO PV-DISP-SQLCODE               39030000
390700         STRING ' ' WS003-SRC-TASK-NUMBER                         39040000
390800                ' WSKUP301-5530: CLOSE-PBS-CS-CSR'                39050000
390900                ' CALLED BY-'                                     39060000
391000                 WS003-CALLING-PROGRAM-NAME                       39070000
391100                ' SQLCODE='                                       39080000
391200                 PV-DISP-SQLCODE                                  39090000
391300                ' SUCC='                                          39100000
391400                 WS003-SUCCESS-IND                                39110000
391500         DELIMITED BY SIZE                                        39120000
391600         INTO PV-MSG-AREA                                         39130000
391700         PERFORM 9200-WRITE-TO-LOG                                39140000
393400         PERFORM 9999-ABEND                                       39310000
393500     END-EVALUATE.                                                39320000
393600                                                                  39330000
393700******************************************************************39340000
393800*                                                                *39350000
393900******************************************************************39360000
394000 6000-CARTON-CONTENT-DTLS.                                        39370000
394100                                                                  39380000
394200     PERFORM 6110-OPEN-CTN-CNTNT-CSR.                             39390000
394300                                                                  39400000
394400     INITIALIZE PV-UNIT-WT                                        39410000
394500                PV-CARTON-WT                                      39420000
394600                PV-TOT-UNITS-IN-CASE.                             39430000
394700                                                                  39440000
394800     SET PS-END-OF-CTN-CNTNT-CSR-NO TO TRUE.                      39450000
394900     PERFORM 6120-FETCH-CTN-CNTNT-CSR                             39460000
395000       UNTIL PS-END-OF-CTN-CNTNT-CSR-YES.                         39470000
395100                                                                  39480000
395200     PERFORM 6130-CLOSE-CTN-CNTNT-CSR.                            39490000
395300                                                                  39500000
395400******************************************************************39510000
395500* OPEN CARTON_CNTNT_CSR                                          *39520000
395600******************************************************************39530000
395700 6110-OPEN-CTN-CNTNT-CSR.                                         39540000
395800                                                                  39550000
395900     MOVE 0 TO PV-CARTON-CNTNT-COUNTER.                           39560000
396000                                                                  39570000
396100     EXEC SQL                                                     39580000
396200          OPEN CARTON_CNTNT_CSR                                   39590000
396300     END-EXEC                                                     39600000
396400                                                                  39610000
396500     EVALUATE TRUE                                                39620000
396600         WHEN SQLCODE = ZERO                                      39630000
396700              CONTINUE                                            39640000
396800         WHEN SQLWARN0 NOT = SPACES                               39650000
396900         WHEN SQLCODE NOT = ZERO                                  39660000
397000         SET  PS-ERROR         TO TRUE                            39670000
397100         MOVE SQLCODE            TO PV-DISP-SQLCODE               39680000
397200         STRING ' ' WS003-SRC-TASK-NUMBER                         39690000
397300                ' WSKUP301-6110: OPEN-CTN-CNTNT-CSR'              39700000
397400                ' CALLED BY-'                                     39710000
397500                 WS003-CALLING-PROGRAM-NAME                       39720000
397600                ' SQLCODE='                                       39730000
397700                 PV-DISP-SQLCODE                                  39740000
397800                ' SUCC='                                          39750000
397900                 WS003-SUCCESS-IND                                39760000
398000         DELIMITED BY SIZE                                        39770000
398100         INTO PV-MSG-AREA                                         39780000
398200         PERFORM 9200-WRITE-TO-LOG                                39790000
399900         PERFORM 9999-ABEND                                       39960000
400000     END-EVALUATE.                                                39970000
400100                                                                  39980000
400200******************************************************************39990000
400300* FETCH  CARTON_CNTNT_CSR                                        *40000000
400400******************************************************************40010000
400500 6120-FETCH-CTN-CNTNT-CSR.                                        40020000
400600                                                                  40030000
400700     EXEC SQL                                                     40040000
400800          FETCH CARTON_CNTNT_CSR                                  40050000
400900          INTO  :XLT00003-SKU-NBR                                 40060000
401000               ,:SHUUPC-SHPD-QTY                                  40070000
401100               ,:XLT00003-INTR-UPC-ID                             40080000
401110               ,:SHUUPC-TRN-LNE-NBR                               40090000
401200     END-EXEC                                                     40100000
401300                                                                  40110000
401400     EVALUATE TRUE                                                40120000
401500         WHEN SQLCODE = ZERO                                      40130000
401600              INITIALIZE PV-UNIT-WT                               40140000
401700              PERFORM 6200-CREATE-CS-LVL-DTL                      40150000
401800         WHEN SQLCODE = +100                                      40160000
401900             SET PS-END-OF-CTN-CNTNT-CSR-YES TO TRUE              40170000
402000             IF PV-TOT-UNITS-IN-CASE > 0                          40180000
402100                PERFORM 6600-CREATE-CS-LVL-HDR                    40190000
402200                INITIALIZE PV-TOT-UNITS-IN-CASE                   40200000
402300                           PV-CARTON-WT                           40210000
402400             END-IF                                               40220000
402500         WHEN SQLWARN0 NOT = SPACES                               40230000
402600         WHEN SQLCODE NOT = ZERO                                  40240000
402700         WHEN SQLCODE NOT = +100                                  40250000
402800         SET  PS-ERROR         TO TRUE                            40260000
402900         SET  PS-ERROR             TO TRUE                        40270000
403000         MOVE SQLCODE              TO PV-DISP-SQLCODE             40280000
403100         MOVE SHPUNT-SHIPT-UNT-ID  TO PV-DISP-SHIPT-UNT-ID        40290000
403200         MOVE XLT00003-SKU-NBR     TO PV-DISP-SKU                 40300000
403300         MOVE XLT00003-INTR-UPC-ID TO PV-DISP-INTR-UPC-ID         40310000
403400         STRING ' ' WS003-SRC-TASK-NUMBER                         40320000
403500                ' WSKUP301-6120: FETCH-CTN-CNTNT-CSR'             40330000
403600                ' CALLED BY-'                                     40340000
403700                 WS003-CALLING-PROGRAM-NAME                       40350000
403800                ' SQLCODE='                                       40360000
403900                 PV-DISP-SQLCODE                                  40370000
404000                ' SUCC='                                          40380000
404100                 WS003-SUCCESS-IND                                40390000
404200                ' SHP UNT='                                       40400000
404300                 PV-DISP-SHIPT-UNT-ID                             40410000
404400                ' SKU='                                           40420000
404500                 PV-DISP-SKU                                      40430000
404600                'INTR UPC='                                       40440000
404700                 PV-DISP-INTR-UPC-ID                              40450000
404800         DELIMITED BY SIZE                                        40460000
404900         INTO PV-MSG-AREA                                         40470000
405000         PERFORM 9200-WRITE-TO-LOG                                40480000
406700         PERFORM 9999-ABEND                                       40650000
406800     END-EVALUATE.                                                40660000
406900                                                                  40670000
407000     IF PS-WRITE-TO-LOG-YES                                       40680000
407100      AND SQLCODE = 0                                             40690000
407200         STRING  ' ' WS003-SRC-TASK-NUMBER                        40700000
407300                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    40710000
407400                 ' WSKUP301-6120: FETCH-CTN-CNTNT-CSR'            40720000
407500         DELIMITED BY SIZE                                        40730000
407600         INTO PV-MSG-AREA                                         40740000
407700         PERFORM 9200-WRITE-TO-LOG                                40750000
407800         MOVE XLT00003-SKU-NBR  TO PV-DISP-SKU                    40760000
407900         STRING   ' ' WS003-SRC-TASK-NUMBER                       40770000
408000                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   40780000
408100                  ' SKU NBR: '                                    40790000
408200                  PV-DISP-SKU                                     40800000
408300         DELIMITED BY SIZE                                        40810000
408400         INTO PV-MSG-AREA                                         40820000
408500         PERFORM 9200-WRITE-TO-LOG                                40830000
408600     END-IF.                                                      40840000
408700                                                                  40850000
408800******************************************************************40860000
408900* CLOSE CARTON_CNTNT_CSR                                         *40870000
409000******************************************************************40880000
409100 6130-CLOSE-CTN-CNTNT-CSR.                                        40890000
409200                                                                  40900000
409300     EXEC SQL                                                     40910000
409400          CLOSE CARTON_CNTNT_CSR                                  40920000
409500     END-EXEC                                                     40930000
409600                                                                  40940000
409700     EVALUATE TRUE                                                40950000
409800         WHEN SQLCODE = ZERO                                      40960000
409900              CONTINUE                                            40970000
410000         WHEN SQLWARN0 NOT = SPACES                               40980000
410100         WHEN SQLCODE NOT = ZERO                                  40990000
410200         SET  PS-ERROR         TO TRUE                            41000000
410300         MOVE SQLCODE            TO PV-DISP-SQLCODE               41010000
410400         STRING ' ' WS003-SRC-TASK-NUMBER                         41020000
410500                ' WSKUP301-6130: CLOSE-CTN-CNTNT-CSR'             41030000
410600                ' CALLED BY-'                                     41040000
410700                 WS003-CALLING-PROGRAM-NAME                       41050000
410800                ' SQLCODE='                                       41060000
410900                 PV-DISP-SQLCODE                                  41070000
411000                ' SUCC='                                          41080000
411100                 WS003-SUCCESS-IND                                41090000
411200         DELIMITED BY SIZE                                        41100000
411300         INTO PV-MSG-AREA                                         41110000
411400         PERFORM 9200-WRITE-TO-LOG                                41120000
413100         PERFORM 9999-ABEND                                       41290000
413200     END-EVALUATE.                                                41300000
413300                                                                  41310000
413400******************************************************************41320000
413500*                                                                *41330000
413600******************************************************************41340000
413700 6200-CREATE-CS-LVL-DTL.                                          41350000
413800                                                                  41360000
413900     PERFORM 6205-LOAD-CS-DTL-REC.                                41370000
414000                                                                  41380000
414100     PERFORM 6210-LOAD-CS-DTL-REC-TO-TEMP.                        41390000
414200                                                                  41400000
414300     EXEC SQL                                                     41410000
414400          INSERT INTO WST_ASN_DWNLD                               41420000
414500               (  EXT_SHP_ID                                      41430000
414600                , CRE_TMST                                        41440000
414700                , ROW_NBR                                         41450000
414800                , REC_TYP_GP_NBR                                  41460000
414900                , REC_TYP_CDE                                     41470000
415000                , CSE_DTL_NBR                                     41480000
415100                , REC_TYP_DESC                                    41490000
415200               )                                                  41500000
415300             VALUES                                               41510000
415400               ( :WST00011-EXT-SHP-ID                             41520000
415500                ,:WST00011-CRE-TMST                               41530000
415600                ,:WST00011-ROW-NBR                                41540000
415700                ,:WST00011-REC-TYP-GP-NBR                         41550000
415800                ,:WST00011-REC-TYP-CDE                            41560000
415900                ,:WST00011-CSE-DTL-NBR                            41570000
416000                ,:WST00011-REC-TYP-DESC                           41580000
416100               )                                                  41590000
416200     END-EXEC                                                     41600000
416300                                                                  41610000
416400     IF PS-WRITE-TO-LOG-YES                                       41620000
416500      AND SQLCODE = 0                                             41630000
416600        MOVE WST00011-ROW-NBR        TO  PV-DISP-ROW-NBR          41640000
416700        MOVE WST00011-REC-TYP-GP-NBR TO  PV-DISP-REC-TYP-GP-NBR   41650000
416800        MOVE WST00011-CSE-DTL-NBR    TO  PV-DISP-CSE-DTL-NBR      41660000
416900        STRING  ' ' WS003-SRC-TASK-NUMBER                         41670000
417000                ' ' PV-DISP-EXT-SHP-ID (1:10)                     41680000
417100                ' WSKUP301-6200: CREATE-CS-LVL-DTL'               41690000
417200        DELIMITED BY SIZE                                         41700000
417300        INTO PV-MSG-AREA                                          41710000
417400        PERFORM 9200-WRITE-TO-LOG                                 41720000
417500        STRING  ' ' WS003-SRC-TASK-NUMBER                         41730000
417600               ' ' PV-DISP-EXT-SHP-ID (1:10)                      41740000
417700               ' # REC TYP CDE    : '                             41750000
417800               WST00011-REC-TYP-CDE                               41760000
417900               ' # ROW NBR        : '                             41770000
418000               PV-DISP-ROW-NBR                                    41780000
418100        DELIMITED BY SIZE                                         41790000
418200        INTO PV-MSG-AREA                                          41800000
418300        PERFORM 9200-WRITE-TO-LOG                                 41810000
418400        STRING ' ' WS003-SRC-TASK-NUMBER                          41820000
418500               ' ' PV-DISP-EXT-SHP-ID (1:10)                      41830000
418600               ' # REC TYP GP NBR : '                             41840000
418700               PV-DISP-REC-TYP-GP-NBR                             41850000
418800               ' # CSE DTL NBR    : '                             41860000
418900               PV-DISP-CSE-DTL-NBR                                41870000
419000        DELIMITED BY SIZE                                         41880000
419100        INTO PV-MSG-AREA                                          41890000
419200        PERFORM 9200-WRITE-TO-LOG                                 41900000
419300     END-IF.                                                      41910000
419400                                                                  41920000
419500     EVALUATE TRUE                                                41930000
419600         WHEN SQLCODE = ZERO                                      41940000
419700              PERFORM 7500-DAT-CNTL-TBLS                          41950000
419800              ADD 1 TO PV-ROW-COUNTER                             41960000
419900         WHEN SQLWARN0 NOT = SPACES                               41970000
420000         WHEN SQLCODE NOT = ZERO                                  41980000
420100         WHEN SQLCODE NOT = +100                                  41990000
420200         SET  PS-ERROR         TO TRUE                            42000000
420300         MOVE SQLCODE            TO PV-DISP-SQLCODE               42010000
420400         STRING  ' ' WS003-SRC-TASK-NUMBER                        42020000
420500                 ' WSKUP301-6200: CREATE-CS-LVL-DTL'              42030000
420600                ' CALLED BY-'                                     42040000
420700                 WS003-CALLING-PROGRAM-NAME                       42050000
420800                ' SQLCODE='                                       42060000
420900                 PV-DISP-SQLCODE                                  42070000
421000                ' SUCC='                                          42080000
421100                 WS003-SUCCESS-IND                                42090000
421200         DELIMITED BY SIZE                                        42100000
421300         INTO PV-MSG-AREA                                         42110000
421400         PERFORM 9200-WRITE-TO-LOG                                42120000
423100         PERFORM 9999-ABEND                                       42290000
423200     END-EVALUATE.                                                42300000
423300                                                                  42310000
423400******************************************************************42320000
423500* MOVES TO CREATE CASE LEVEL DETAIL RECORD                       *42330000
423600******************************************************************42340000
423700 6205-LOAD-CS-DTL-REC.                                            42350000
423800                                                                  42360000
423900     INITIALIZE WS007-CASE-DTL-REC.                               42370000
424000     MOVE 'WSRD007 '  TO PV-TEMP-COPYBOOK-NAME.                   42380000
424100                                                                  42390000
424200     SET WS007-CD-ADD            TO TRUE.                         42400000
424300     SET WS007-CD-CSE-DTL        TO TRUE.                         42410000
424400     MOVE WST00002-CRE-USR-ID    TO WS007-CD-CREATE-USERID.       42420000
424500     MOVE WST00002-CRE-TMST      TO WS007-CD-CREATE-TMST.         42430000
424600     MOVE '00'                   TO WS007-CD-CASE-NBR (1:2).      42440000
424700     MOVE SHPUNT-SHIPT-UNT-ID    TO WS007-CD-CASE-NBR (3:18).     42450000
424800     MOVE XLT00003-SKU-NBR       TO WS007-CD-SKU-NBR              42460000
424900                                    WS007-CD-SKU-ID.              42470000
425000     MOVE SHUUPC-TRN-LNE-NBR     TO PV-TRN-LNE-NBR.               42480000
425001     MOVE PV-TRN-LNE-CDE(6:4)    TO WS007-CD-PO-LINE-NBR.         42490000
425010     MOVE SHUUPC-SHPD-QTY        TO WS007-CD-SHIPD-UNT-QTY.       42500000
425100     ADD SHUUPC-SHPD-QTY         TO PV-TOT-UNITS-IN-CASE.         42510000
425200     IF WST00002-PREPK-ID > 0                                     42520000
425300        PERFORM 6400-GET-POPRPK-SKU                               42530000
425400     END-IF.                                                      42540000
425500     MOVE POPRPK-PK-SKU-NBR      TO WS007-CD-PACK-SKU.            42550000
425600                                                                  42560000
425700     PERFORM 6450-GET-SHIP-WT-QTY.                                42570000
425800                                                                  42580000
425900     COMPUTE PV-UNIT-WT = WEBITM-SHIP-WT-QTY * SHUUPC-SHPD-QTY.   42590000
426000                                                                  42600000
426100     COMPUTE PV-CARTON-WT = PV-CARTON-WT +                        42610000
426200                            PV-UNIT-WT.                           42620000
426300                                                                  42630000
426400**THIS IS NEEDED TO PUT DTL NBR ON THE DTL LVL TEMP TBL REC       42640000
426500** THINK                                                          42650000
426600**   PERFORM 6650-MULTIPLE-SKU-CHECK.                             42660000
426700                                                                  42670000
426800     MOVE PV-HOST-INPUT-ID          TO WS007-CD-HOST-INPT-ID.     42680000
426900                                                                  42690000
427000******************************************************************42700000
427100* MOVES TO LOAD THE FIELDS TO PREP FOR AN INSERT                 *42710000
427200******************************************************************42720000
427300 6210-LOAD-CS-DTL-REC-TO-TEMP.                                    42730000
427400                                                                  42740000
427500     INITIALIZE DCLWST00011.                                      42750000
427600                                                                  42760000
427700     MOVE DK-EXT-SHP-ID             TO WST00011-EXT-SHP-ID.       42770000
427800     MOVE PV-CURRENT-TMST           TO WST00011-CRE-TMST.         42780000
427900     MOVE PV-ROW-COUNTER            TO WST00011-ROW-NBR.          42790000
428000     MOVE PV-GROUP-COUNTER          TO WST00011-REC-TYP-GP-NBR.   42800000
428100     MOVE PC-CD                     TO WST00011-REC-TYP-CDE.      42810000
428200     MOVE PC-TEMP-TBL-DESC-LENGTH   TO WST00011-REC-TYP-DESC-LEN. 42820000
428300     MOVE WS007-CASE-DTL-REC        TO WST00011-REC-TYP-DESC-TEXT.42830000
428400     MOVE PV-MULT-SKU-COUNTER       TO WST00011-CSE-DTL-NBR.      42840000
428500                                                                  42850000
428600******************************************************************42860000
428700*                                                                *42870000
428800******************************************************************42880000
428900 6400-GET-POPRPK-SKU.                                             42890000
429000                                                                  42900000
429100     INITIALIZE POPRPK-PK-SKU-NBR.                                42910000
429200                                                                  42920000
429300     EXEC SQL                                                     42930000
429400          SELECT PK_SKU_NBR                                       42940000
429500          INTO  :POPRPK-PK-SKU-NBR                                42950000
429600          FROM TPOPRPK                                            42960000
429700          WHERE PO_NBR         = :WST00002-PO-NBR                 42970000
429800          AND   PO_PREPK_ID    = :WST00002-PREPK-ID               42980000
429900          AND   PREPK_STAT_CDE = 'A'                              42990000
430000     END-EXEC                                                     43000000
430100                                                                  43010000
430200     EVALUATE TRUE                                                43020000
430300         WHEN SQLCODE = ZERO                                      43030000
430400         WHEN SQLCODE = +100                                      43040000
430500              CONTINUE                                            43050000
430600         WHEN SQLWARN0 NOT = SPACES                               43060000
430700         WHEN SQLCODE NOT = ZERO                                  43070000
430800         WHEN SQLCODE NOT = +100                                  43080000
430900         SET  PS-ERROR         TO TRUE                            43090000
431000         MOVE SQLCODE            TO PV-DISP-SQLCODE               43100000
431100         STRING  ' ' WS003-SRC-TASK-NUMBER                        43110000
431200                 ' WSKUP301-6400: GET-POPRPK-SKU'                 43120000
431300                ' CALLED BY-'                                     43130000
431400                 WS003-CALLING-PROGRAM-NAME                       43140000
431500                ' SQLCODE='                                       43150000
431600                 PV-DISP-SQLCODE                                  43160000
431700                ' SUCC='                                          43170000
431800                 WS003-SUCCESS-IND                                43180000
431900         DELIMITED BY SIZE                                        43190000
432000         INTO PV-MSG-AREA                                         43200000
432100         PERFORM 9200-WRITE-TO-LOG                                43210000
433800         PERFORM 9999-ABEND                                       43380000
433900     END-EVALUATE.                                                43390000
434000                                                                  43400000
434100******************************************************************43410000
434200*                                                                *43420000
434300******************************************************************43430000
434400 6450-GET-SHIP-WT-QTY.                                            43440000
434500                                                                  43450000
434600     INITIALIZE WEBITM-SHIP-WT-QTY.                               43460000
RG1950     INITIALIZE WEBITM-SHIP-DPTH-QTY.                             43461008
RG1950     INITIALIZE WEBITM-SHIP-HT-QTY.                               43462008
RG1950     INITIALIZE WEBITM-SHIP-WD-QTY.                               43463008
434700                                                                  43470000
434800     EXEC SQL                                                     43480000
434900          SELECT SHIP_WT_QTY                                      43490000
RG1950             ,   SHIP_DPTH_QTY                                    43491008
RG1950             ,   SHIP_HT_QTY                                      43492008
RG1950             ,   SHIP_WD_QTY                                      43493008
435000          INTO  :WEBITM-SHIP-WT-QTY                               43500000
RG1950             ,  :WEBITM-SHIP-DPTH-QTY                             43501008
RG1950             ,  :WEBITM-SHIP-HT-QTY                               43502008
RG1950             ,  :WEBITM-SHIP-WD-QTY                               43503008
435100          FROM TWEBITM                                            43510000
435200          WHERE INTR_UPC_ID    = :XLT00003-INTR-UPC-ID            43520000
435300          AND   EFF_END_TMST   IS NULL                            43530000
435400     END-EXEC                                                     43540000
435500                                                                  43550000
435600     EVALUATE TRUE                                                43560000
435700         WHEN SQLCODE = ZERO                                      43570000
435800         WHEN SQLCODE = +100                                      43580000
435900              CONTINUE                                            43590000
436000         WHEN SQLWARN0 NOT = SPACES                               43600000
436100         WHEN SQLCODE NOT = ZERO                                  43610000
436200         WHEN SQLCODE NOT = +100                                  43620000
436300         SET  PS-ERROR         TO TRUE                            43630000
436400         MOVE SQLCODE            TO PV-DISP-SQLCODE               43640000
436500         STRING  ' ' WS003-SRC-TASK-NUMBER                        43650000
436600                 ' WSKUP301-6450: GET-SHIP-WT-QTY'                43660000
436700                ' CALLED BY-'                                     43670000
436800                 WS003-CALLING-PROGRAM-NAME                       43680000
436900                ' SQLCODE='                                       43690000
437000                 PV-DISP-SQLCODE                                  43700000
437100                ' SUCC='                                          43710000
437200                 WS003-SUCCESS-IND                                43720000
437300         DELIMITED BY SIZE                                        43730000
437400         INTO PV-MSG-AREA                                         43740000
437500         PERFORM 9200-WRITE-TO-LOG                                43750000
439200         PERFORM 9999-ABEND                                       43920000
439300     END-EVALUATE.                                                43930000
439400                                                                  43940000
439500******************************************************************43950000
439600*                                                                *43960000
439700******************************************************************43970000
439800 6600-CREATE-CS-LVL-HDR.                                          43980000
439900                                                                  43990000
440000     PERFORM 6605-LOAD-CS-HDR-REC.                                44000000
440100                                                                  44010000
440200     PERFORM 6610-LOAD-CS-HDR-REC-TO-TEMP.                        44020000
440300                                                                  44030000
440400     EXEC SQL                                                     44040000
440500          INSERT INTO WST_ASN_DWNLD                               44050000
440600               (  EXT_SHP_ID                                      44060000
440700                , CRE_TMST                                        44070000
440800                , ROW_NBR                                         44080000
440900                , REC_TYP_GP_NBR                                  44090000
441000                , REC_TYP_CDE                                     44100000
441100                , CSE_DTL_NBR                                     44110000
441200                , REC_TYP_DESC                                    44120000
441300               )                                                  44130000
441400             VALUES                                               44140000
441500               ( :WST00011-EXT-SHP-ID                             44150000
441600                ,:WST00011-CRE-TMST                               44160000
441700                ,:WST00011-ROW-NBR                                44170000
441800                ,:WST00011-REC-TYP-GP-NBR                         44180000
441900                ,:WST00011-REC-TYP-CDE                            44190000
442000                ,:WST00011-CSE-DTL-NBR                            44200000
442100                ,:WST00011-REC-TYP-DESC                           44210000
442200               )                                                  44220000
442300     END-EXEC                                                     44230000
442400                                                                  44240000
442500     IF PS-WRITE-TO-LOG-YES                                       44250000
442600      AND SQLCODE = 0                                             44260000
442700        MOVE WST00011-ROW-NBR        TO  PV-DISP-ROW-NBR          44270000
442800        MOVE WST00011-REC-TYP-GP-NBR TO  PV-DISP-REC-TYP-GP-NBR   44280000
442900        MOVE WST00011-CSE-DTL-NBR    TO  PV-DISP-CSE-DTL-NBR      44290000
443000        STRING  ' ' WS003-SRC-TASK-NUMBER                         44300000
443100                ' ' PV-DISP-EXT-SHP-ID (1:10)                     44310000
443200                ' WSKUP301-6600: CREATE-CS-LVL-HDR'               44320000
443300        DELIMITED BY SIZE                                         44330000
443400        INTO PV-MSG-AREA                                          44340000
443500        PERFORM 9200-WRITE-TO-LOG                                 44350000
443600        STRING  ' ' WS003-SRC-TASK-NUMBER                         44360000
443700               ' ' PV-DISP-EXT-SHP-ID (1:10)                      44370000
443800               ' # REC TYP CDE    : '                             44380000
443900               WST00011-REC-TYP-CDE                               44390000
444000               ' # ROW NBR        : '                             44400000
444100               PV-DISP-ROW-NBR                                    44410000
444200        DELIMITED BY SIZE                                         44420000
444300        INTO PV-MSG-AREA                                          44430000
444400        PERFORM 9200-WRITE-TO-LOG                                 44440000
444500        STRING ' ' WS003-SRC-TASK-NUMBER                          44450000
444600               ' ' PV-DISP-EXT-SHP-ID (1:10)                      44460000
444700               ' # REC TYP GP NBR : '                             44470000
444800               PV-DISP-REC-TYP-GP-NBR                             44480000
444900               ' # CSE DTL NBR    : '                             44490000
445000               PV-DISP-CSE-DTL-NBR                                44500000
445100        DELIMITED BY SIZE                                         44510000
445200        INTO PV-MSG-AREA                                          44520000
445300        PERFORM 9200-WRITE-TO-LOG                                 44530000
445400     END-IF.                                                      44540000
445500                                                                  44550000
445600     EVALUATE TRUE                                                44560000
445700         WHEN SQLCODE = ZERO                                      44570000
445800              PERFORM 7500-DAT-CNTL-TBLS                          44580000
445900              ADD 1 TO PV-ROW-COUNTER                             44590000
446000                       PV-GROUP-COUNTER                           44600000
446100**INCR BOTH FOR NEW CS DTL/HDR COMBO                              44610000
446200         WHEN SQLWARN0 NOT = SPACES                               44620000
446300         WHEN SQLCODE NOT = ZERO                                  44630000
446400         SET  PS-ERROR         TO TRUE                            44640000
446500         MOVE SQLCODE            TO PV-DISP-SQLCODE               44650000
446600         STRING  ' ' WS003-SRC-TASK-NUMBER                        44660000
446700                 ' WSKUP301-6650: CREATE-CS-LVL-HDR'              44670000
446800                ' CALLED BY-'                                     44680000
446900                 WS003-CALLING-PROGRAM-NAME                       44690000
447000                ' SQLCODE='                                       44700000
447100                 PV-DISP-SQLCODE                                  44710000
447200                ' SUCC='                                          44720000
447300                 WS003-SUCCESS-IND                                44730000
447400         DELIMITED BY SIZE                                        44740000
447500         INTO PV-MSG-AREA                                         44750000
447600         PERFORM 9200-WRITE-TO-LOG                                44760000
449300         PERFORM 9999-ABEND                                       44930000
449400     END-EVALUATE.                                                44940000
449500                                                                  44950000
449600******************************************************************44960000
449700* MOVES TO CREATE CASE LEVEL HEADER RECORD                       *44970000
449800******************************************************************44980000
449900 6605-LOAD-CS-HDR-REC.                                            44990000
450000                                                                  45000000
450100     INITIALIZE WS006-CASE-HDR-REC.                               45010000
450200     MOVE 'WSRD006 '  TO PV-TEMP-COPYBOOK-NAME.                   45020000
450300                                                                  45030000
450400     SET WS006-CH-ADD                TO TRUE.                     45040000
450500     SET WS006-CH-CSE-HDR            TO TRUE.                     45050000
450600     MOVE WST00002-CRE-USR-ID        TO WS006-CH-CREATE-USERID.   45060000
450700     MOVE WST00002-CRE-TMST          TO WS006-CH-CREATE-TMST.     45070000
450800     MOVE DK-EXT-SHP-ID              TO WS006-CH-ORIG-SHPMT-NBR.  45080000
450900     MOVE PV-OPER-UNT-ID-PIC9        TO WS006-CH-WHSE.            45090000
451000     MOVE '00'                       TO WS006-CH-CASE-NBR (1:2).  45100000
451100     MOVE SHPUNT-SHIPT-UNT-ID        TO WS006-CH-CASE-NBR (3:18). 45110000
451200     MOVE WST00002-RCVR-SEQ-NBR      TO WS006-CH-RCVR-SEQ-NBR.    45120000
451300     MOVE DK-TRIP-ID                 TO WS006-CH-TRIP-ID          45130000
451400     MOVE WST00002-PO-NBR            TO WS006-CH-PO-NBR           45140000
451500     MOVE VHTRIP-OWNER-SCAC-ID       TO WS006-CH-SCAC.            45150000
451600     MOVE VHTRIP-VEH-NBR             TO WS006-CH-TRLR-ID.         45160000
451700     PERFORM 7820-GET-VENDOR-ID.                                  45170000
451800     MOVE PURCHS-ENT-ID              TO WS006-CH-VENDOR-ID.       45180000
451900     MOVE PV-TOT-UNITS-IN-CASE       TO WS006-CH-SHPD-UNT-QTY.    45190000
452000     MOVE PV-CARTON-WT               TO WS006-CH-EST-WEIGHT.      45200000
452100     IF PS-MULTIPLE-SKU-YES                                       45210000
452200        SET WS006-CH-MULT-SKU   TO TRUE                           45220000
RG1950        MOVE PV-TOT-UNITS-IN-CASE TO WS006-CH-SHPD-UNT-VOL        45221008
452300     ELSE                                                         45230000
452400        SET WS006-CH-SNGL-SKU    TO TRUE                          45230107
RG1950        IF (WEBITM-SHIP-WD-QTY = 0 OR WEBITM-SHIP-DPTH-QTY = 0    45231008
RG1950            OR WEBITM-SHIP-HT-QTY = 0)                            45232008
RG1950            MOVE PV-TOT-UNITS-IN-CASE TO WS006-CH-SHPD-UNT-VOL    45233008
RG1950        ELSE                                                      45234008
RG1950            COMPUTE WS006-CH-SHPD-UNT-VOL = WEBITM-SHIP-WD-QTY *  45235008
RG1950            WEBITM-SHIP-DPTH-QTY * WEBITM-SHIP-HT-QTY *           45236008
RG1950            WS006-CH-SHPD-UNT-QTY                                 45237008
RG1950        END-IF                                                    45238008
452500     END-IF.                                                      45250000
452600     MOVE PV-HOST-INPUT-ID       TO WS006-CH-HOST-INPT-ID.        45260000
452700     SET WS006-CH-VENDOR-SHIPMT  TO TRUE.                         45270000
452800                                                                  45280000
452900******************************************************************45290000
453000* MOVES TO LOAD THE FIELDS TO PREP FOR AN INSERT                 *45300000
453100******************************************************************45310000
453200 6610-LOAD-CS-HDR-REC-TO-TEMP.                                    45320000
453300                                                                  45330000
453400     INITIALIZE DCLWST00011.                                      45340000
453500                                                                  45350000
453600     MOVE DK-EXT-SHP-ID             TO WST00011-EXT-SHP-ID.       45360000
453700     MOVE PV-CURRENT-TMST           TO WST00011-CRE-TMST.         45370000
453800     MOVE PV-ROW-COUNTER            TO WST00011-ROW-NBR.          45380000
453900     MOVE PV-GROUP-COUNTER          TO WST00011-REC-TYP-GP-NBR.   45390000
454000     MOVE PC-CH                     TO WST00011-REC-TYP-CDE.      45400000
454100     MOVE PC-TEMP-TBL-DESC-LENGTH   TO WST00011-REC-TYP-DESC-LEN. 45410000
454200     MOVE WS006-CASE-HDR-REC        TO WST00011-REC-TYP-DESC-TEXT.45420000
454300     MOVE PV-MULT-SKU-COUNTER       TO WST00011-CSE-DTL-NBR.      45430000
454400                                                                  45440000
454500******************************************************************45450000
454600*                                                                *45460000
454700******************************************************************45470000
454800 6650-MULTIPLE-SKU-CHECK.                                         45480000
454900                                                                  45490000
455000     SET PS-MULTIPLE-SKU-NO TO TRUE.                              45500000
455100     MOVE 0                 TO PV-MULT-SKU-COUNTER.               45510000
455200                                                                  45520000
455300     EXEC SQL                                                     45530000
455400          SELECT   COUNT(DISTINCT(C.SKU_NBR))                     45540000
455500          INTO    :PV-MULT-SKU-COUNTER                            45550000
455600          FROM     TSHUUPC A                                      45560000
455700                  ,XLT_UPC B                                      45570000
455800                  ,XLT_SKU C                                      45580000
455900          WHERE   A.SHIPT_UNT_ID = :SHPUNT-SHIPT-UNT-ID           45590000
456000            AND   A.SHPD_QTY > 0                                  45600000
456100            AND   A.UPC_NBR  = B.UPC_NBR                          45610000
456200            AND   B.INTR_UPC_ID = C.INTR_UPC_ID                   45620000
456300     END-EXEC                                                     45630000
456400                                                                  45640000
456500     EVALUATE TRUE                                                45650000
456600         WHEN SQLCODE = ZERO                                      45660000
456700         WHEN SQLCODE = +100                                      45670000
456800         WHEN SQLCODE = -811                                      45680000
456900              IF PV-MULT-SKU-COUNTER > 1                          45690000
457000                 SET PS-MULTIPLE-SKU-YES TO TRUE                  45700000
457100              END-IF                                              45710000
457200         WHEN SQLWARN0 NOT = SPACES                               45720000
457300         WHEN SQLCODE NOT = ZERO                                  45730000
457400         WHEN SQLCODE NOT = +100                                  45740000
457500         SET  PS-ERROR         TO TRUE                            45750000
457600         MOVE SQLCODE            TO PV-DISP-SQLCODE               45760000
457700         MOVE SHPUNT-SHIPT-UNT-ID TO PV-DISP-SHIPT-UNT-ID         45770000
457800         STRING  ' ' WS003-SRC-TASK-NUMBER                        45780000
457900                 ' WSKUP301-6650: MULTIPLE-SKU-CHECK'             45790000
458000                ' CALLED BY-'                                     45800000
458100                 WS003-CALLING-PROGRAM-NAME                       45810000
458200                ' SQLCODE='                                       45820000
458300                 PV-DISP-SQLCODE                                  45830000
458400                ' SUCC='                                          45840000
458500                 WS003-SUCCESS-IND                                45850000
458600                ' SHP UNT='                                       45860000
458700                 PV-DISP-SHIPT-UNT-ID                             45870000
458800         DELIMITED BY SIZE                                        45880000
458900         INTO PV-MSG-AREA                                         45890000
459000         PERFORM 9200-WRITE-TO-LOG                                45900000
460700         PERFORM 9999-ABEND                                       46070000
460800     END-EVALUATE.                                                46080000
460900                                                                  46090000
461000******************************************************************46100000
461100* UPDATE THE VERSION NUMBER ON THE HDR XREF. EVERYTIME A SHIPMENT 46110000
461200* IS DOWNLOADED TO WMS, THE VER-NBR SHOULD BE INCREMENTED BY +1.  46120000
461300******************************************************************46130000
461400 7100-UPD-HDR-XREF-VER-NBR.                                       46140000
461500                                                                  46150000
461600     EXEC SQL                                                     46160000
461700          UPDATE WST_SHPMT_XREF_HDR                               46170000
461800            SET  VER_NBR = :PV-HOST-INPUT-ID                      46180000
461900           WHERE EXT_SHP_ID = :DK-EXT-SHP-ID                      46190000
462000     END-EXEC                                                     46200000
462100                                                                  46210000
462200     EVALUATE TRUE                                                46220000
462300         WHEN SQLCODE = ZERO                                      46230000
462400             CONTINUE                                             46240000
462500         WHEN SQLWARN0 NOT = SPACES                               46250000
462600         WHEN SQLCODE NOT = ZERO                                  46260000
462700              SET  PS-ERROR         TO TRUE                       46270000
462800              MOVE SQLCODE            TO PV-DISP-SQLCODE          46280000
462900              STRING ' ' WS003-SRC-TASK-NUMBER                    46290000
463000                     ' 7100-UPD-HDR-XREF-VER-NBR'                 46300000
463100                     ' CALLED BY-'                                46310000
463200                      WS003-CALLING-PROGRAM-NAME                  46320000
463300                     ' SQLCODE='                                  46330000
463400                      PV-DISP-SQLCODE                             46340000
463500                     ' SUCC='                                     46350000
463600                      WS003-SUCCESS-IND                           46360000
463700              DELIMITED BY SIZE                                   46370000
463800              INTO PV-MSG-AREA                                    46380000
463900              PERFORM 9200-WRITE-TO-LOG                           46390000
465600              PERFORM 9999-ABEND                                  46560000
465700     END-EVALUATE.                                                46570000
465800                                                                  46580000
465900     IF PS-WRITE-TO-LOG-YES                                       46590000
466000         STRING   ' ' WS003-SRC-TASK-NUMBER                       46600000
466100                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   46610000
466200                  ' WSKUP301-7100: UPD-HDR-XREF-VER-NBR'          46620000
466300                  ' INCREMENT HDR XREF CER BVR'                   46630000
466400         DELIMITED BY SIZE                                        46640000
466500         INTO PV-MSG-AREA                                         46650000
466600         PERFORM 9200-WRITE-TO-LOG                                46660000
466700         MOVE PV-LAST-HOST-INPUT-ID TO PV-DISP-LAST-HOST-INPUT-ID 46670000
466800         MOVE PV-HOST-INPUT-ID      TO PV-DISP-HOST-INPUT-ID      46680000
466900         STRING   ' ' WS003-SRC-TASK-NUMBER                       46690000
467000                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   46700000
467100                  ' VER-NBR ON HDR REC: '                         46710000
467200                  PV-DISP-LAST-HOST-INPUT-ID                      46720000
467300                  ' INCREMENTED VER NBR: '                        46730000
467400                  PV-DISP-HOST-INPUT-ID                           46740000
467500         DELIMITED BY SIZE                                        46750000
467600         INTO PV-MSG-AREA                                         46760000
467700         PERFORM 9200-WRITE-TO-LOG                                46770000
467800     END-IF.                                                      46780000
467900                                                                  46790000
468000******************************************************************46800000
468100* THIS CALLS WSKUP302 TO PROCESS THE WST_ASN_DWNLD RECS           46810000
468300******************************************************************46820000
468400 7200-ASN-DWNLD-MODULE.                                           46830000
468500                                                                  46840000
468600     INITIALIZE WS006-TRANS-COMMAREA.                             46850000
468700                                                                  46860000
468800     MOVE DK-EXT-SHP-ID         TO WS006-EXT-SHP-ID.              46870000
468900     MOVE PC-PROGRAM-NAME       TO WS006-CALLING-PROGRAM-NAME.    46880000
469000     MOVE PC-PRC-TYP-CDE        TO WS006-TRN-TYP-CDE.             46890000
469100     MOVE WST00003-PRC-GP-ID    TO WS006-PRC-GP-ID.               46900000
469200     MOVE WS003-OPER-UNT-ID     TO WS006-OPER-UNT-ID.             46910000
469300     MOVE WS003-USERID          TO WS006-USERID.                  46920000
469400     MOVE WS003-SRC-TASK-NUMBER TO WS006-SRC-TASK-NUMBER.         46930000
469500     MOVE PV-CURRENT-TMST       TO WS006-DWNLD-TMST.              46940000
469600     IF PV-RECS-IN-TRBL-COUNT > 0                                 46950000
469700        SET WS006-TROUBLE-SHPMT  TO TRUE                          46960000
469800     ELSE                                                         46970000
469900        SET WS006-NO-TROUBLE     TO TRUE                          46980000
470000     END-IF.                                                      46990000
470100                                                                  47000000
470200     IF PS-WRITE-TO-LOG-YES                                       47010000
470300         MOVE PV-RECS-IN-TRBL-COUNT                               47020000
470400                        TO PV-DISP-RECS-IN-TRBL-COUNT             47030000
470500         STRING  ' ' WS003-SRC-TASK-NUMBER                        47040000
470600                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    47050000
470700                 ' PV-RECS-IN-TRBL-COUNT:'                        47060000
470800                 PV-DISP-RECS-IN-TRBL-COUNT                       47070000
470900         DELIMITED BY SIZE                                        47080000
471000         INTO PV-MSG-AREA                                         47090000
471100         PERFORM 9200-WRITE-TO-LOG                                47100000
471200     END-IF.                                                      47110000
471300                                                                  47120000
471400     IF PS-WRITE-TO-LOG-YES                                       47130000
471500         STRING  ' ' WS003-SRC-TASK-NUMBER                        47140000
471600                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    47150000
471700                 ' WSKUP301-7200: ASN-DWNLD-MODULE'               47160000
471800                 ' ========>  WSKUP301 CALLING WSKUP302'          47170000
471900         DELIMITED BY SIZE                                        47180000
472000         INTO PV-MSG-AREA                                         47190000
472100         PERFORM 9200-WRITE-TO-LOG                                47200000
472200     END-IF.                                                      47210000
472300                                                                  47220000
472400     CALL PC-ASN-DWNLD-PGM USING WS006-TRANS-COMMAREA.            47230001
473200                                                                  47310000
473400     IF PS-WRITE-TO-LOG-YES                                       47320000
473500         STRING  ' ' WS003-SRC-TASK-NUMBER                        47330000
473600                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    47340000
473700                 ' WSKUP301-7200: ASN-DWNLD-MODULE'               47350000
473800                 ' ===>  RE ENTERING WSKUP301 '                   47360000
473900         DELIMITED BY SIZE                                        47370000
474000         INTO PV-MSG-AREA                                         47380000
474100         PERFORM 9200-WRITE-TO-LOG                                47390000
474200         STRING  ' ' WS003-SRC-TASK-NUMBER                        47400000
474300                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    47410000
474400                 ' WSKUP301-7200: ASN-DWNLD-MODULE'               47420000
474500                 ' --->  SUCCESS IND=' WS006-SUCCESS-IND          47430001
474600         DELIMITED BY SIZE                                        47440000
474700         INTO PV-MSG-AREA                                         47450000
474800         PERFORM 9200-WRITE-TO-LOG                                47460000
475300         STRING  ' COMMAREA: ' WS006-TRANS-COMMAREA               47510000
475400         DELIMITED BY SIZE                                        47520000
475500         INTO PV-MSG-AREA                                         47530000
475600         PERFORM 9200-WRITE-TO-LOG                                47540000
475700     END-IF.                                                      47550000
475800                                                                  47560000
477500******************************************************************47730000
477600* OPEN XREF_DTL_CSR                                               47740000
477700******************************************************************47750000
477800 7410-OPEN-XREF-DTL-CSR.                                          47760000
477900                                                                  47770000
478000     EXEC SQL                                                     47780000
478100          OPEN XREF_DTL_CSR                                       47790000
478200     END-EXEC                                                     47800000
478300                                                                  47810000
478400     EVALUATE TRUE                                                47820000
478500         WHEN SQLCODE = ZERO                                      47830000
478600              CONTINUE                                            47840000
478700         WHEN SQLWARN0 NOT = SPACES                               47850000
478800         WHEN SQLCODE NOT = ZERO                                  47860000
478900         SET  PS-ERROR         TO TRUE                            47870000
479000         MOVE SQLCODE            TO PV-DISP-SQLCODE               47880000
479100         STRING ' ' WS003-SRC-TASK-NUMBER                         47890000
479200                ' WSKUP301-7410: OPEN-XREF-DTL-CSR'               47900000
479300                ' CALLED BY-'                                     47910000
479400                 WS003-CALLING-PROGRAM-NAME                       47920000
479500                ' SQLCODE='                                       47930000
479600                 PV-DISP-SQLCODE                                  47940000
479700                ' SUCC='                                          47950000
479800                 WS003-SUCCESS-IND                                47960000
479900         DELIMITED BY SIZE                                        47970000
480000         INTO PV-MSG-AREA                                         47980000
480100         PERFORM 9200-WRITE-TO-LOG                                47990000
481800         PERFORM 9999-ABEND                                       48160000
481900     END-EVALUATE.                                                48170000
482000                                                                  48180000
482100******************************************************************48190000
482200* FETCH  XREF_DTL_CSR                                             48200000
482300******************************************************************48210000
482400 7420-FETCH-XREF-DTL-CSR.                                         48220000
482500                                                                  48230000
482600     EXEC SQL                                                     48240000
482700          FETCH XREF_DTL_CSR                                      48250000
482800          INTO                                                    48260000
482900                :WST00002-PO-NBR                                  48270000
483000               ,:WST00002-PO-LNE-NBR                              48280000
483100               ,:WST00002-RCVR-SEQ-NBR                            48290000
483200               ,:WST00002-ASN-LVL-CDE                             48300000
483300               ,:WST00002-PREPK-ID                                48310000
483400               ,:WST00002-CRE-USR-ID                              48320000
483500               ,:WST00002-CRE-TMST                                48330000
483600               ,:WST00002-DWNLD-CDE                               48340000
483700               ,:WST00002-ACTV-CDE                                48350000
483800     END-EXEC                                                     48360000
483900                                                                  48370000
484000     EVALUATE TRUE                                                48380000
484100         WHEN SQLCODE = ZERO                                      48390000
484200              PERFORM 7450-CALL-PO-RCVR-TRKG-MOD                  48400000
484300         WHEN SQLCODE = +100                                      48410000
484400             SET PS-END-OF-XREF-DTL-CSR-YES TO TRUE               48420000
484500         WHEN SQLWARN0 NOT = SPACES                               48430000
484600         WHEN SQLCODE NOT = ZERO                                  48440000
484700         WHEN SQLCODE NOT = +100                                  48450000
484800         SET  PS-ERROR         TO TRUE                            48460000
484900         MOVE SQLCODE            TO PV-DISP-SQLCODE               48470000
485000         MOVE WST00002-PO-NBR    TO PV-DISP-PO-NBR                48480000
485100         MOVE WST00002-RCVR-SEQ-NBR TO PV-DISP-RCVR-SEQ-NBR       48490000
485200         MOVE WST00002-PREPK-ID   TO PV-DISP-PREPK-ID             48500000
485300         MOVE WST00002-PO-LNE-NBR TO PV-DISP-PO-LINE-NBR          48510000
485400         STRING ' ' WS003-SRC-TASK-NUMBER                         48520000
485500                ' WSKUP301-7420: FETCH-XREF-DTL-CSR'              48530000
485600                ' CALLED BY-'                                     48540000
485700                 WS003-CALLING-PROGRAM-NAME                       48550000
485800                ' SQLCODE='                                       48560000
485900                 PV-DISP-SQLCODE                                  48570000
486000                ' SUCC='                                          48580000
486100                 WS003-SUCCESS-IND                                48590000
486200                 ' PO='                                           48600000
486300                 PV-DISP-PO-NBR                                   48610000
486400                 ' RCVR='                                         48620000
486500                 PV-DISP-RCVR-SEQ-NBR                             48630000
486600                 ' PRPK='                                         48640000
486700                 PV-DISP-PREPK-ID                                 48650000
486800                 ' LNE='                                          48660000
486900                 PV-DISP-PO-LINE-NBR                              48670000
487000         DELIMITED BY SIZE                                        48680000
487100         INTO PV-MSG-AREA                                         48690000
487200         PERFORM 9200-WRITE-TO-LOG                                48700000
488900         PERFORM 9999-ABEND                                       48870000
489000     END-EVALUATE.                                                48880000
489100                                                                  48890000
489200     IF PS-WRITE-TO-LOG-YES                                       48900000
489300      AND SQLCODE = 0                                             48910000
489400         STRING   ' ' WS003-SRC-TASK-NUMBER                       48920000
489500                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   48930000
489600                  ' WSKUP301-7420: FETCH-XREF-DTL-CSR'            48940000
489700         DELIMITED BY SIZE                                        48950000
489800         INTO PV-MSG-AREA                                         48960000
489900         PERFORM 9200-WRITE-TO-LOG                                48970000
490000         MOVE WST00002-PO-NBR    TO PV-DISP-PO-NBR                48980000
490100         MOVE WST00002-RCVR-SEQ-NBR TO PV-DISP-RCVR-SEQ-NBR       48990000
490200         MOVE WST00002-PREPK-ID   TO PV-DISP-PREPK-ID             49000000
490300         MOVE WST00002-PO-LNE-NBR TO PV-DISP-PO-LINE-NBR          49010000
490400         STRING   ' ' WS003-SRC-TASK-NUMBER                       49020000
490500                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   49030000
490600                  ' PO NBR: '                                     49040000
490700                  PV-DISP-PO-NBR                                  49050000
490800                  ' RCVR NBR: '                                   49060000
490900                  PV-DISP-RCVR-SEQ-NBR                            49070000
491000                  'PREPACK ID: '                                  49080000
491100                  PV-DISP-PREPK-ID                                49090000
491200                  'PO LINE: '                                     49100000
491300                  PV-DISP-PO-LINE-NBR                             49110000
491400         DELIMITED BY SIZE                                        49120000
491500         INTO PV-MSG-AREA                                         49130000
491600         PERFORM 9200-WRITE-TO-LOG                                49140000
491700     END-IF.                                                      49150000
491800                                                                  49160000
491900******************************************************************49170000
492000* CLOSE XREF_DTL_CSR                                              49180000
492100******************************************************************49190000
492200 7430-CLOSE-XREF-DTL-CSR.                                         49200000
492300                                                                  49210000
492400     EXEC SQL                                                     49220000
492500          CLOSE XREF_DTL_CSR                                      49230000
492600     END-EXEC                                                     49240000
492700                                                                  49250000
492800     EVALUATE TRUE                                                49260000
492900         WHEN SQLCODE = ZERO                                      49270000
493000              CONTINUE                                            49280000
493100         WHEN SQLWARN0 NOT = SPACES                               49290000
493200         WHEN SQLCODE NOT = ZERO                                  49300000
493300         SET  PS-ERROR         TO TRUE                            49310000
493400         MOVE SQLCODE            TO PV-DISP-SQLCODE               49320000
493500         STRING ' ' WS003-SRC-TASK-NUMBER                         49330000
493600                ' WSKUP301-7430: FETCH-XREF-DTL-CSR'              49340000
493700                ' CALLED BY-'                                     49350000
493800                 WS003-CALLING-PROGRAM-NAME                       49360000
493900                ' SQLCODE='                                       49370000
494000                 PV-DISP-SQLCODE                                  49380000
494100                ' SUCC='                                          49390000
494200                 WS003-SUCCESS-IND                                49400000
494300         DELIMITED BY SIZE                                        49410000
494400         INTO PV-MSG-AREA                                         49420000
494500         PERFORM 9200-WRITE-TO-LOG                                49430000
496200         PERFORM 9999-ABEND                                       49600000
496300     END-EVALUATE.                                                49610000
496400                                                                  49620000
496500******************************************************************49630000
496600* CALL PO-RCVR-TRKING-MODULE TO INSERT RCT_PO_RCVR_TRKG          *49640000
496700******************************************************************49650000
496800 7450-CALL-PO-RCVR-TRKG-MOD.                                      49660000
496900                                                                  49670000
497000     INITIALIZE RC071-FIELDS.                                     49680000
497100     MOVE WST00002-PO-NBR           TO RC071-PO-NBR               49690000
497200     MOVE WST00002-RCVR-SEQ-NBR     TO RC071-PO-RCVR              49700000
497300     MOVE WST00002-PREPK-ID         TO RC071-PREPK-ID             49710000
497400     MOVE WST00002-PO-LNE-NBR       TO RC071-PO-LINE              49720000
497500     MOVE PV-OPER-UNT-ID-PIC9       TO RC071-SIGNON-LOCATION      49730000
497600     MOVE WST00002-CRE-USR-ID       TO RC071-USER-ID              49740000
497700     MOVE PC-PROGRAM-NAME           TO RC071-CALLING-PROGRAM      49750000
497800     IF WST00002-DWNLD-CDE = PC-T                                 49760000
497900        MOVE PC-DC-FUNC-CDE-TRBL  TO RC071-DC-FUNCTION-CODE       49770000
498000     ELSE                                                         49780000
498100        MOVE PC-DC-FUNC-CDE-DWNLD TO RC071-DC-FUNCTION-CODE       49790000
498200     END-IF.                                                      49800000
498300                                                                  49810000
498600     CALL RC071-PO-RCVR-TRACKING USING RC071-FIELDS.              49840001
498900                                                                  49870000
499200          IF RC071-SUCCESSFUL                                     49900000
499300             CONTINUE                                             49910000
499400          ELSE                                                    49920000
499500             SET  PS-ERROR           TO TRUE                      49930000
499600             MOVE SQLCODE            TO PV-DISP-SQLCODE           49940000
499700             MOVE WST00002-PO-NBR    TO PV-DISP-PO-NBR            49950000
499800             MOVE WST00002-RCVR-SEQ-NBR TO PV-DISP-RCVR-SEQ-NBR   49960000
499900             MOVE WST00002-PREPK-ID   TO PV-DISP-PREPK-ID         49970000
500000             MOVE WST00002-PO-LNE-NBR TO PV-DISP-PO-LINE-NBR      49980000
500100             STRING ' ' WS003-SRC-TASK-NUMBER                     49990000
500200                    ' WSKUP301-7450: CALL-PO-RCVR-TRKL-MOD'       50000000
500300                    ' CALLED BY-'                                 50010000
500400                     WS003-CALLING-PROGRAM-NAME                   50020000
500500                    ' SQLCODE='                                   50030000
500600                     PV-DISP-SQLCODE                              50040000
500700                    ' SUCC='                                      50050000
500800                     WS003-SUCCESS-IND                            50060000
500900                     ' PO='                                       50070000
501000                     PV-DISP-PO-NBR                               50080000
501100                     ' RCVR='                                     50090000
501200                     PV-DISP-RCVR-SEQ-NBR                         50100000
501300                     ' PRPK='                                     50110000
501400                     PV-DISP-PREPK-ID                             50120000
501500                     ' LNE='                                      50130000
501600                     PV-DISP-PO-LINE-NBR                          50140000
501700             DELIMITED BY SIZE                                    50150000
501800             INTO PV-MSG-AREA                                     50160000
501900             PERFORM 9200-WRITE-TO-LOG                            50170000
503600             PERFORM 9999-ABEND                                   50340000
503700          END-IF.                                                 50350001
503900                                                                  50370000
504000     IF PS-WRITE-TO-LOG-YES                                       50380000
504100      AND SQLCODE = 0                                             50390000
504200         STRING   ' ' WS003-SRC-TASK-NUMBER                       50400000
504300                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   50410000
504400                  ' WSKUP301-7450: CALL-PO-RCVR-TRKG-MOD'         50420000
504500         DELIMITED BY SIZE                                        50430000
504600         INTO PV-MSG-AREA                                         50440000
504700         PERFORM 9200-WRITE-TO-LOG                                50450000
504800         MOVE SHPUNT-SHIPT-UNT-ID  TO PV-DISP-SHIPT-UNT-ID        50460000
504900         STRING ' ' WS003-SRC-TASK-NUMBER                         50470000
505000                ' ' PV-DISP-EXT-SHP-ID                            50480000
505100                ' SHIP UNT ID: '                                  50490000
505200                PV-DISP-SHIPT-UNT-ID                              50500000
505300         DELIMITED BY SIZE                                        50510000
505400         INTO PV-MSG-AREA                                         50520000
505500         PERFORM 9200-WRITE-TO-LOG                                50530000
505600     END-IF.                                                      50540000
505700                                                                  50550000
505800******************************************************************50560000
505900** TRACK WHAT WAS DOWNLOADED TO WMS THRU THESE DATA CNTL TABLES **50570000
506000******************************************************************50580000
506100 7500-DAT-CNTL-TBLS.                                              50590000
506200                                                                  50600000
506300     IF PS-WRITE-HDR-ONLY-TO-TEMP                                 50610000
506400      AND PS-THIS-IS-ASN-HDR-YES                                  50620000
506500        MOVE PV-PRC-LOD-SEQ-ID TO WST00004-PRC-LOD-SEQ-ID         50630000
506600        MOVE 'WSRD004'         TO WST00004-RDM-PRC-TYP-CDE        50640000
506700        MOVE WS004-ASN-REC     TO WST00004-LOD-DAT-TXT-TEXT       50650000
506800        IF PS-DAT-CNTL-REC-INSERTED-NO                            50660000
506900           PERFORM 7600-INSERT-DAT-CNTL                           50670000
507000        END-IF                                                    50680000
507100        PERFORM 7650-INSERT-DAT-XFER                              50690000
507200        SET PS-THIS-IS-ASN-HDR-NO TO TRUE                         50700000
507300     END-IF.                                                      50710000
507400                                                                  50720000
507500     IF PS-WRITE-ALL-TO-TEMP                                      50730000
507600        MOVE PV-PRC-LOD-SEQ-ID      TO WST00004-PRC-LOD-SEQ-ID    50740000
507700        STRING 'ASN '                                             50750000
507800               PV-TEMP-COPYBOOK-NAME                              50760000
507900        DELIMITED BY SIZE                                         50770000
508000        INTO WST00004-RDM-PRC-TYP-CDE                             50780000
508100        MOVE WST00011-REC-TYP-DESC-TEXT                           50790000
508200                                    TO WST00004-LOD-DAT-TXT-TEXT  50800000
508300        IF PS-DAT-CNTL-REC-INSERTED-NO                            50810000
508400           PERFORM 7600-INSERT-DAT-CNTL                           50820000
508500        END-IF                                                    50830000
508600        PERFORM 7650-INSERT-DAT-XFER                              50840000
508700        SET PS-THIS-IS-ASN-HDR-NO   TO TRUE                       50850000
508800     END-IF.                                                      50860000
508900                                                                  50870000
509000******************************************************************50880000
509100* INSERT WST_DAT_CNTL                                            *50890000
509200******************************************************************50900000
509300 7600-INSERT-DAT-CNTL.                                            50910000
509400                                                                  50920000
509500     EXEC SQL                                                     50930000
509600          INSERT INTO WST_DAT_CNTL                                50940000
509700               ( TRN_TYP_CDE                                      50950000
509800                ,PRC_GP_ID                                        50960000
509900                ,PRC_CNTL_TMST                                    50970000
510000                ,LOC_NBR                                          50980000
510100                ,STAT_CDE                                         50990000
510200                ,BEG_PRC_TMST                                     51000000
510300                ,END_PRC_TMST                                     51010000
510400                ,DAT_LOD_VER_NBR                                  51020000
510500               )                                                  51030000
510600             VALUES                                               51040000
510700               ( :WST00003-TRN-TYP-CDE                            51050000
510800                ,:WST00003-PRC-GP-ID                              51060000
510900                ,:WST00003-PRC-CNTL-TMST                          51070000
511000                ,:WST00003-LOC-NBR                                51080000
511100                ,:WST00003-STAT-CDE                               51090000
511200                ,:WST00003-BEG-PRC-TMST                           51100000
511300                ,:WST00003-END-PRC-TMST                           51110000
511400                ,:WST00003-DAT-LOD-VER-NBR                        51120000
511500               )                                                  51130000
511600     END-EXEC                                                     51140000
511700                                                                  51150000
511800     EVALUATE TRUE                                                51160000
511900         WHEN SQLCODE = ZERO                                      51170000
512000              SET PS-DAT-CNTL-REC-INSERTED-YES TO TRUE            51180000
512100         WHEN SQLCODE = -803                                      51190000
512200              ADD  1 TO WST00003-PRC-GP-ID                        51200000
512300                        WST00004-PRC-GP-ID                        51210000
512400              PERFORM 7601-INSERT-DAT-CNTL-RETRY                  51220000
512500         WHEN SQLWARN0 NOT = SPACES                               51230000
512600         WHEN SQLCODE NOT = ZERO                                  51240000
512700         WHEN SQLCODE NOT = -803                                  51250000
512800         SET  PS-ERROR         TO TRUE                            51260000
512900         MOVE SQLCODE            TO PV-DISP-SQLCODE               51270000
513000         MOVE WST00003-TRN-TYP-CDE TO PV-DISP-TRN-TYP-CDE         51280000
513100         MOVE WST00003-PRC-GP-ID   TO PV-DISP-PRC-GP-ID           51290000
513200         MOVE WST00003-LOC-NBR     TO PV-DISP-OPER-UNT-ID         51300000
513300         STRING  ' ' WS003-SRC-TASK-NUMBER                        51310000
513400                 ' WSKUP301-7600: INSERT-DAT-CNTL'                51320000
513500                ' CALLED BY-'                                     51330000
513600                 WS003-CALLING-PROGRAM-NAME                       51340000
513700                ' SQLCODE='                                       51350000
513800                 PV-DISP-SQLCODE                                  51360000
513900                ' SUCC='                                          51370000
514000                 WS003-SUCCESS-IND                                51380000
514100                ' TRN TYP='                                       51390000
514200                 PV-DISP-TRN-TYP-CDE                              51400000
514300                ' PRC GP='                                        51410000
514400                 PV-DISP-PRC-GP-ID                                51420000
514500                ' OPER UNT='                                      51430000
514600                 PV-DISP-OPER-UNT-ID                              51440000
514700         DELIMITED BY SIZE                                        51450000
514800         INTO PV-MSG-AREA                                         51460000
514900         PERFORM 9200-WRITE-TO-LOG                                51470000
516600         PERFORM 9999-ABEND                                       51640000
516700     END-EVALUATE.                                                51650000
516800                                                                  51660000
516900     IF PS-WRITE-TO-LOG-YES                                       51670000
517000      AND (SQLCODE = 0 OR SQLCODE = -803)                         51680000
517100         STRING  ' ' WS003-SRC-TASK-NUMBER                        51690000
517200                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    51700000
517300                 ' WSKUP301-7600: INSERT-DAT-CNTL'                51710000
517400         DELIMITED BY SIZE                                        51720000
517500         INTO PV-MSG-AREA                                         51730000
517600         PERFORM 9200-WRITE-TO-LOG                                51740000
517700         MOVE WST00003-PRC-GP-ID  TO PV-DISP-PRC-GP-ID            51750000
517800         STRING  ' ' WS003-SRC-TASK-NUMBER                        51760000
517900                 ' ' PV-DISP-EXT-SHP-ID                           51770000
518000                 ' PRC GP ID: '                                   51780000
518100                  PV-DISP-PRC-GP-ID                               51790000
518200         DELIMITED BY SIZE                                        51800000
518300         INTO PV-MSG-AREA                                         51810000
518400         PERFORM 9200-WRITE-TO-LOG                                51820000
518500     END-IF.                                                      51830000
518600                                                                  51840000
518700     IF PS-WRITE-TO-LOG-YES                                       51850000
518800       AND SQLCODE = 0                                            51860000
518900         MOVE WST00003-PRC-GP-ID TO PV-DISP-PRC-GP-ID             51870000
519000         STRING  ' ' WS003-SRC-TASK-NUMBER                        51880000
519100                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    51890000
519200                 ' 7600-INSERT-DAT-CNTL '                         51900000
519300                 ' WST00003-PRC-GP-ID : '                         51910000
519400                 PV-DISP-PRC-GP-ID                                51920000
519500                 ' WST00003-TRN-TYP-CDE :'                        51930000
519600                 WST00003-TRN-TYP-CDE                             51940000
519700         DELIMITED BY SIZE                                        51950000
519800         INTO PV-MSG-AREA                                         51960000
519900         PERFORM 9200-WRITE-TO-LOG                                51970000
520000     END-IF.                                                      51980000
520100                                                                  51990000
520200******************************************************************52000000
520300* INSERT WST_DAT_CNTL - RETRY BECAUSE OF -803 IN PARA 7600-      *52010000
520400*                       THE PRC-GP-ID NBR, WHICH IS THE LAST     *52020000
520500*                       6 BYTES OF THE PRC_CNTL_TMST WAS INCRE-  *52030000
520600*                       MENTED BY 1 BEOFRE THE RETRY.            *52040000
520700******************************************************************52050000
520800 7601-INSERT-DAT-CNTL-RETRY.                                      52060000
520900                                                                  52070000
521000     EXEC SQL                                                     52080000
521100          INSERT INTO WST_DAT_CNTL                                52090000
521200               ( TRN_TYP_CDE                                      52100000
521300                ,PRC_GP_ID                                        52110000
521400                ,PRC_CNTL_TMST                                    52120000
521500                ,LOC_NBR                                          52130000
521600                ,STAT_CDE                                         52140000
521700                ,BEG_PRC_TMST                                     52150000
521800                ,END_PRC_TMST                                     52160000
521900                ,DAT_LOD_VER_NBR                                  52170000
522000               )                                                  52180000
522100             VALUES                                               52190000
522200               ( :WST00003-TRN-TYP-CDE                            52200000
522300                ,:WST00003-PRC-GP-ID                              52210000
522400                ,:WST00003-PRC-CNTL-TMST                          52220000
522500                ,:WST00003-LOC-NBR                                52230000
522600                ,:WST00003-STAT-CDE                               52240000
522700                ,:WST00003-BEG-PRC-TMST                           52250000
522800                ,:WST00003-END-PRC-TMST                           52260000
522900                ,:WST00003-DAT-LOD-VER-NBR                        52270000
523000               )                                                  52280000
523100     END-EXEC                                                     52290000
523200                                                                  52300000
523300     EVALUATE TRUE                                                52310000
523400         WHEN SQLCODE = ZERO                                      52320000
523500              CONTINUE                                            52330000
523600         WHEN SQLWARN0 NOT = SPACES                               52340000
523700         WHEN SQLCODE NOT = ZERO                                  52350000
523800         WHEN SQLCODE NOT = -803                                  52360000
523900         SET  PS-ERROR         TO TRUE                            52370000
524000         MOVE SQLCODE            TO PV-DISP-SQLCODE               52380000
524100         MOVE WST00003-TRN-TYP-CDE TO PV-DISP-TRN-TYP-CDE         52390000
524200         MOVE WST00003-PRC-GP-ID   TO PV-DISP-PRC-GP-ID           52400000
524300         MOVE WST00003-LOC-NBR     TO PV-DISP-OPER-UNT-ID         52410000
524400         STRING  ' ' WS003-SRC-TASK-NUMBER                        52420000
524500                 ' WSKUP301-7601: INSERT-DAT-CNTL-RETRY'          52430000
524600                ' CALLED BY-'                                     52440000
524700                 WS003-CALLING-PROGRAM-NAME                       52450000
524800                ' SQLCODE='                                       52460000
524900                 PV-DISP-SQLCODE                                  52470000
525000                ' SUCC='                                          52480000
525100                 WS003-SUCCESS-IND                                52490000
525200                ' TRN TYP='                                       52500000
525300                 PV-DISP-TRN-TYP-CDE                              52510000
525400                ' PRC GP='                                        52520000
525500                 PV-DISP-PRC-GP-ID                                52530000
525600                ' OPER UNT='                                      52540000
525700                 PV-DISP-OPER-UNT-ID                              52550000
525800         DELIMITED BY SIZE                                        52560000
525900         INTO PV-MSG-AREA                                         52570000
526000         PERFORM 9200-WRITE-TO-LOG                                52580000
527700         PERFORM 9999-ABEND                                       52750000
527800     END-EVALUATE.                                                52760000
527900                                                                  52770000
528000     IF PS-WRITE-TO-LOG-YES                                       52780000
528100      AND SQLCODE = 0                                             52790000
528200         STRING  ' ' WS003-SRC-TASK-NUMBER                        52800000
528300                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    52810000
528400                 ' WSKUP301-7601: INSERT-DAT-CNTL-RETRY'          52820000
528500         DELIMITED BY SIZE                                        52830000
528600         INTO PV-MSG-AREA                                         52840000
528700         PERFORM 9200-WRITE-TO-LOG                                52850000
528800         MOVE WST00003-PRC-GP-ID  TO PV-DISP-PRC-GP-ID            52860000
528900         STRING  ' ' WS003-SRC-TASK-NUMBER                        52870000
529000                 ' ' PV-DISP-EXT-SHP-ID                           52880000
529100                 ' PRC GP ID: '                                   52890000
529200                  PV-DISP-PRC-GP-ID                               52900000
529300         DELIMITED BY SIZE                                        52910000
529400         INTO PV-MSG-AREA                                         52920000
529500         PERFORM 9200-WRITE-TO-LOG                                52930000
529600     END-IF.                                                      52940000
529700                                                                  52950000
529800     IF PS-WRITE-TO-LOG-YES                                       52960000
529900       AND SQLCODE = 0                                            52970000
530000         MOVE WST00003-PRC-GP-ID TO PV-DISP-PRC-GP-ID             52980000
530100         STRING  ' ' WS003-SRC-TASK-NUMBER                        52990000
530200                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    53000000
530300                 ' 7601-INSERT-DAT-CNTL '                         53010000
530400                 ' WST00003-PRC-GP-ID : '                         53020000
530500                 PV-DISP-PRC-GP-ID                                53030000
530600                 ' WST00003-TRN-TYP-CDE :'                        53040000
530700                 WST00003-TRN-TYP-CDE                             53050000
530800         DELIMITED BY SIZE                                        53060000
530900         INTO PV-MSG-AREA                                         53070000
531000         PERFORM 9200-WRITE-TO-LOG                                53080000
531100     END-IF.                                                      53090000
531200                                                                  53100000
531300******************************************************************53110000
531400* INSERT WST_DAT_XFER - THERE IS NO RETRY LOGIC FOR -803         *53120000
531500* BECAUSE THE PRC-GP-ID MUST BE THE SAME FOR THESE 2 INSERTS     *53130000
531600******************************************************************53140000
531700 7650-INSERT-DAT-XFER.                                            53150000
531800                                                                  53160000
531900     EXEC SQL                                                     53170000
532000          INSERT INTO WST_DAT_XFER                                53180000
532100               ( TRN_TYP_CDE                                      53190000
532200                ,PRC_GP_ID                                        53200000
532300                ,PRC_LOD_SEQ_ID                                   53210000
532400                ,PRC_CNTL_TMST                                    53220000
532500                ,RDM_PRC_TYP_CDE                                  53230000
532600                ,LOD_DAT_TXT                                      53240000
532700               )                                                  53250000
532800             VALUES                                               53260000
532900               ( :WST00004-TRN-TYP-CDE                            53270000
533000                ,:WST00004-PRC-GP-ID                              53280000
533100                ,:WST00004-PRC-LOD-SEQ-ID                         53290000
533200                ,:WST00004-PRC-CNTL-TMST                          53300000
533300                ,:WST00004-RDM-PRC-TYP-CDE                        53310000
533400                ,:WST00004-LOD-DAT-TXT                            53320000
533500               )                                                  53330000
533600     END-EXEC                                                     53340000
533700                                                                  53350000
533800     EVALUATE TRUE                                                53360000
533900         WHEN SQLCODE = ZERO                                      53370000
534000              ADD +1 TO PV-PRC-LOD-SEQ-ID                         53380000
534100         WHEN SQLWARN0 NOT = SPACES                               53390000
534200         WHEN SQLCODE NOT = ZERO                                  53400000
534300         SET  PS-ERROR         TO TRUE                            53410000
534400         MOVE SQLCODE            TO PV-DISP-SQLCODE               53420000
534500         MOVE WST00003-TRN-TYP-CDE TO PV-DISP-TRN-TYP-CDE         53430000
534600         MOVE WST00003-PRC-GP-ID   TO PV-DISP-PRC-GP-ID           53440000
534700         MOVE WST00003-LOC-NBR     TO PV-DISP-OPER-UNT-ID         53450000
534800         STRING  ' ' WS003-SRC-TASK-NUMBER                        53460000
534900                 ' WSKUP301-7650: 7650-INSERT-DAT-XFER'           53470000
535000                ' CALLED BY-'                                     53480000
535100                 WS003-CALLING-PROGRAM-NAME                       53490000
535200                ' SQLCODE='                                       53500000
535300                 PV-DISP-SQLCODE                                  53510000
535400                ' SUCC='                                          53520000
535500                 WS003-SUCCESS-IND                                53530000
535600                ' TRN TYP='                                       53540000
535700                 PV-DISP-TRN-TYP-CDE                              53550000
535800                ' PRC GP='                                        53560000
535900                 PV-DISP-PRC-GP-ID                                53570000
536000                ' OPER UNT='                                      53580000
536100                 PV-DISP-OPER-UNT-ID                              53590000
536200         DELIMITED BY SIZE                                        53600000
536300         INTO PV-MSG-AREA                                         53610000
536400         PERFORM 9200-WRITE-TO-LOG                                53620000
538100         PERFORM 9999-ABEND                                       53790000
538200     END-EVALUATE.                                                53800000
538300                                                                  53810000
538400     IF PS-WRITE-TO-LOG-YES                                       53820000
538500       AND SQLCODE = 0                                            53830000
538600         MOVE WST00003-PRC-GP-ID TO PV-DISP-PRC-GP-ID             53840000
538700         MOVE PV-PRC-LOD-SEQ-ID  TO PV-DISP-PRC-LOD-SEQ           53850000
538800         STRING  ' ' WS003-SRC-TASK-NUMBER                        53860000
538900                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    53870000
539000                 ' 7650-INSERT-DAT-XFER '                         53880000
539100                 ' WST00003-PRC-GP-ID : '                         53890000
539200                 PV-DISP-PRC-GP-ID                                53900000
539300                 ' PRC LOD SEQ : '                                53910000
539400                 PV-DISP-PRC-LOD-SEQ                              53920000
539500         DELIMITED BY SIZE                                        53930000
539600         INTO PV-MSG-AREA                                         53940000
539700         PERFORM 9200-WRITE-TO-LOG                                53950000
539800     END-IF.                                                      53960000
539900                                                                  53970000
540000******************************************************************53980000
540100*                                                                *53990000
540200******************************************************************54000000
540300 7820-GET-VENDOR-ID.                                              54010000
540400                                                                  54020000
540500     EXEC SQL                                                     54030000
540600          SELECT DISTINCT(ENT_ID)                                 54040000
540700          INTO  :PURCHS-ENT-ID                                    54050000
540800          FROM TPURCHS                                            54060000
540900          WHERE PO_NBR         = :WST00002-PO-NBR                 54070000
541000     END-EXEC                                                     54080000
541100                                                                  54090000
541200     EVALUATE TRUE                                                54100000
541300         WHEN SQLCODE = ZERO                                      54110000
541400              IF PS-WRITE-TO-LOG-YES                              54120000
541500                 STRING   ' ' WS003-SRC-TASK-NUMBER               54130000
541600                          ' ' PV-DISP-EXT-SHP-ID (1:10)           54140000
541700                          ' WSKUP301-7820: GET-VENDOR-ID'         54150000
541800                  DELIMITED BY SIZE                               54160000
541900                  INTO PV-MSG-AREA                                54170000
542000                  PERFORM 9200-WRITE-TO-LOG                       54180000
542100                  MOVE WST00002-PO-NBR   TO PV-DISP-PO-NBR        54190000
542200                  MOVE PURCHS-ENT-ID     TO PV-DISP-ENT-ID        54200000
542300                  STRING   ' ' WS003-SRC-TASK-NUMBER              54210000
542400                           ' ' PV-DISP-EXT-SHP-ID (1:10)          54220000
542500                           ' PO NBR : '                           54230000
542600                           PV-DISP-PO-NBR                         54240000
542700                           ' ENT ID : '                           54250000
542800                           PV-DISP-ENT-ID                         54260000
542900                  DELIMITED BY SIZE                               54270000
543000                  INTO PV-MSG-AREA                                54280000
543100                  PERFORM 9200-WRITE-TO-LOG                       54290000
543200              END-IF                                              54300000
543300         WHEN SQLCODE = +100                                      54310000
543400              CONTINUE                                            54320000
543500         WHEN SQLWARN0 NOT = SPACES                               54330000
543600         WHEN SQLCODE NOT = ZERO                                  54340000
543700         WHEN SQLCODE NOT = +100                                  54350000
543800         SET  PS-ERROR         TO TRUE                            54360000
543900         MOVE SQLCODE            TO PV-DISP-SQLCODE               54370000
544000         STRING ' ' WS003-SRC-TASK-NUMBER                         54380000
544100                ' WSKUP301-7820: GET-VENDOR-ID'                   54390000
544200                ' CALLED BY-'                                     54400000
544300                 WS003-CALLING-PROGRAM-NAME                       54410000
544400                ' SQLCODE='                                       54420000
544500                 PV-DISP-SQLCODE                                  54430000
544600                ' SUCC='                                          54440000
544700                 WS003-SUCCESS-IND                                54450000
544800         DELIMITED BY SIZE                                        54460000
544900         INTO PV-MSG-AREA                                         54470000
545000         PERFORM 9200-WRITE-TO-LOG                                54480000
546700         PERFORM 9999-ABEND                                       54650000
546800     END-EVALUATE.                                                54660000
546900                                                                  54670000
547000******************************************************************54680000
547100**  WRITE TO LOG IF PV-SWITCH-IND = Y                           **54690000
547200******************************************************************54700000
547300 9200-WRITE-TO-LOG.                                               54710000
547400                                                                  54720000
547500     DISPLAY PV-MSG-AREA.                                         54730000
548400                                                                  54820000
548500     MOVE SPACES TO PV-MSG-AREA.                                  54830000
548600                                                                  54840000
548700******************************************************************54850000
548800*   STANDARD ABEND ROUTINE                                        54860000
548900* ==> PROCESSES:                                                  54870000
549000*   - ISSUES THE ABEND.                                           54880000
549100******************************************************************54890000
549200 9999-ABEND.                                                      54900000
549900                                                                  54970000
361910     DISPLAY 'ERROR IN WSKUP301 - ROLLING BACK'.                  54971000
363300                                                                  54972000
550000     EXEC SQL                                                     54980000
550100         ROLLBACK                                                 54990000
550500     END-EXEC.                                                    55030000
550600                                                                  55040000
550700     GOBACK.                                                      55050000
551100                                                                  55090000
551200******************************************************************55100000
551300**            E N D   O F   P R O G R A M                       **55110000
551400******************************************************************55120000
